import{d as F,n as Q,a3 as Z,p as ce,s as X,j as w,r as B,D as Y,o as V,c as K,w as l,g as a,E as ee,h as f,t as I,i as A,$ as M,F as ve,aK as me,aA as L,aB as H,J as fe,Z as ge,B as G,N as q,O as _e,ad as te,ae as he,az as J,e as j,am as Ie,aC as ye,an as ae,aD as Se,S as we,av as be,P as xe,Q as Ae,f as le,R as ne}from"./index-DDEZcIDk.js";import{_ as ke,l as oe}from"./lodash-C9OIpBfr.js";import{_ as Ee}from"./round-search-CDbshWs7.js";import{_ as De}from"./round-refresh-D90vUZc5.js";import{c as Ce,a as Te,f as ze}from"./common-DGjn2hxJ.js";import{_ as $e}from"./Cascader-Dxxi-cZG.js";import{_ as Pe}from"./FormItemGridItem-CAn5t1zp.js";import{_ as Ne}from"./DatePicker-7MrOxGIu.js";import{_ as Le}from"./Grid-CeZW69aQ.js";import{f as Ve}from"./system-log-Cia6MrMP.js";import{v as Ue,f as Me,w as Oe}from"./events-DQGCpIVC.js";import{T as Re}from"./basicconf-DQUdjSL-.js";import{e as Be}from"./exportExcel-D6OyA9oJ.js";import{_ as Ge}from"./originlogInfo.vue_vue_type_script_setup_true_lang-OGw5CeoP.js";import{S as He,t as W}from"./alarm-D64SkAP_.js";import{_ as je,a as Fe}from"./DescriptionsItem-DpNZ9tqj.js";import"./TimePicker-HiQAxUfD.js";import"./defineProperty--qfRCXJb.js";import"./collection-D1C5OR7D.js";import"./CollapseItem-BLizT0i2.js";const Ke=F({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["search"],["update:model"]),setup(S,{emit:E}){const k=E,c=Z(),{formRef:D,restoreValidation:y}=ce(),e=X(S,"model"),v=w();(async()=>{const{data:r,error:n}=await Ce();n||(v.value=r.map(i=>({...i,id:"-"+i.id,type:i.cname})))})();const x=B({eventsTypeDataList:[],eventsCategoryData:[]});async function T(){const{data:r,error:n}=await Te();n||(x.eventsTypeDataList=r)}T();async function z(){const{data:r,error:n}=await ze();n||(x.eventsCategoryData=r.map(i=>({value:i.id,label:i.pname})))}z();function $(){e.value.fuzzy=void 0,_()}async function b(r,n){r?(e.value.startTime=r[0],e.value.endTime=r[1]):(e.value.startTime=null,e.value.endTime=null),k("search")}async function P(){await y(),e.value.lsid=null,e.value.etype=null,e.value.elevel=null,e.value.fuzzy=null,e.value.startAndEndSendSourceIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.timeRange=null,e.value.ectgr=null,e.value.startSourceIp=null,e.value.endSourceIp=null,e.value.startAimIp=null,e.value.endAimIp=null,e.value.startSIp=null,e.value.endSIp=null,e.value.startTime=null,e.value.endTime=null,me(()=>{k("search")})}const s=()=>{e.value.startAndEndSendSourceIp=null,_()},p=()=>{e.value.startAndEndSourceIp=null,_()},o=()=>{e.value.startAndEndAimSourceIp=null,_()};async function _(){var r,n,i,m,t,g,N,O,U,R;if(e.value.startAndEndSendSourceIp&&e.value.startAndEndSendSourceIp.length>0?(e.value.startSIp=e.value.startAndEndSendSourceIp[0]||null,e.value.endSIp=e.value.startAndEndSendSourceIp[1]||null):(e.value.startSIp=null,e.value.endSIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=void 0,e.value.endSourceIp=void 0),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimIp=void 0,e.value.endAimIp=void 0),e.value.startSIp&&!L(e.value.startSIp)||e.value.startSourceIp&&!L(e.value.startSourceIp)||e.value.startAimIp&&!L(e.value.startAimIp))return(r=window.$message)==null||r.destroyAll(),(n=window.$message)==null||n.error("请输入正确的IP地址"),!1;if(e.value.endSIp&&!L(e.value.endSIp)||e.value.endSourceIp&&!L(e.value.endSourceIp)||e.value.endAimIp&&!L(e.value.endAimIp))return(i=window.$message)==null||i.destroyAll(),(m=window.$message)==null||m.error("请输入正确的IP地址"),!1;if(e.value.startSIp&&e.value.endSIp&&H(e.value.startSIp,e.value.endSIp)>0)return(t=window.$message)==null||t.destroyAll(),(g=window.$message)==null||g.error("发生源起始IP不能大于发生源终止IP"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&H(e.value.startSourceIp,e.value.endSourceIp)>0)return(N=window.$message)==null||N.destroyAll(),(O=window.$message)==null||O.error("源起始IP不能大于源终止IP"),!1;if(e.value.startAimIp&&e.value.endAimIp&&H(e.value.startAimIp,e.value.endAimIp)>0)return(U=window.$message)==null||U.destroyAll(),(R=window.$message)==null||R.error("目的起始IP不能大于目的终止IP"),!1;k("search")}const u=r=>{e.value.ectgr=r,k("search")},d=ke.debounce(_,1e3,{leading:!0,trailing:!1});return(r,n)=>{const i=$e,m=Pe,t=fe,g=ge,N=Ne,O=De,U=G,R=Ee,ie=q,re=Le,ue=_e,de=te,pe=Y("no-space");return V(),K(de,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[a(ue,{ref_key:"formRef",ref:D,model:e.value,"label-placement":"left","label-width":A(c).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:ve(A(d),["enter"])},{default:l(()=>[a(re,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:l(()=>[a(m,{span:"24 s:12 m:8 l:6",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:l(()=>[a(i,{value:e.value.lsid,"onUpdate:value":[n[0]||(n[0]=h=>e.value.lsid=h),_],placeholder:"请选择日志源设备",options:v.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),a(m,{span:"24 s:12 m:8 l:6",label:"事件名称",path:"fuzzy",class:"pr-24px"},{default:l(()=>[ee(a(t,{value:e.value.fuzzy,"onUpdate:value":n[1]||(n[1]=h=>e.value.fuzzy=h),placeholder:"请输入事件名称",clearable:"",onClear:$},null,8,["value"]),[[pe]])]),_:1}),a(m,{span:"24 s:12 m:8 l:6",label:"事件类型",path:"etype",class:"pr-24px"},{default:l(()=>[a(g,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.etype,"onUpdate:value":[n[2]||(n[2]=h=>e.value.etype=h),_],"value-field":"id","label-field":"pname",options:x.eventsTypeDataList},null,8,["value","options"])]),_:1}),a(m,{span:"24 s:12 m:8 l:6",label:"事件类别",path:"ectgr",class:"pr-24px"},{default:l(()=>[a(g,{filterable:"",clearable:"",placeholder:"请选择事件类别",value:e.value.ectgr,"onUpdate:value":[n[3]||(n[3]=h=>e.value.ectgr=h),u],options:x.eventsCategoryData},null,8,["value","options"])]),_:1}),a(m,{span:"24 s:12 m:10 l:8",label:"发生源IP",path:"startAndEndSendSourceIp",class:"pr-24px"},{default:l(()=>[a(t,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSendSourceIp,"onUpdate:value":n[4]||(n[4]=h=>e.value.startAndEndSendSourceIp=h),onClear:p},null,8,["value"])]),_:1}),a(m,{span:"24 s:12 m:10 l:8",label:"源IP",path:"startAndEndSourceIp",class:"pr-24px"},{default:l(()=>[a(t,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":n[5]||(n[5]=h=>e.value.startAndEndSourceIp=h),onClear:s},null,8,["value"])]),_:1}),a(m,{span:"24 s:12 m:10 l:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px"},{default:l(()=>[a(t,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":n[6]||(n[6]=h=>e.value.startAndEndAimSourceIp=h),onClear:o},null,8,["value"])]),_:1}),a(m,{span:"24 s:12 m:10 l:8",label:"产生时间",path:"timeRange",class:"pr-24px"},{default:l(()=>[a(N,{clearable:"",value:e.value.timeRange,"onUpdate:value":n[7]||(n[7]=h=>e.value.timeRange=h),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":b},null,8,["value"])]),_:1}),a(m,{span:"24 s:12 m:10 l:6",class:"pr-24px"},{default:l(()=>[a(ie,{class:"w-full",align:"center"},{default:l(()=>[a(U,{onClick:P},{icon:l(()=>[a(O,{class:"text-icon"})]),default:l(()=>[f(" "+I(A(M)("common.reset")),1)]),_:1}),a(U,{type:"primary",ghost:"",onClick:A(d)},{icon:l(()=>[a(R,{class:"text-icon"})]),default:l(()=>[f(" "+I(A(M)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width","onKeyup"])]),_:1})}}}),se=S=>(xe("data-v-c879b29f"),S=S(),Ae(),S),qe=se(()=>le("span",null,"基本信息",-1)),Je=se(()=>le("span",null,"原始日志信息",-1)),We={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"480px"}},Qe={key:1,class:"h-500px"};function Ze(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Ie(S)}const Xe=F({__name:"detailInfo",props:Q({detailInfo:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(S){const E=X(S,"detailVisible"),k=S,c=w();he(()=>E.value,async s=>{s&&(c.value=k.detailInfo,await v(),C())});const D=[{title:"",key:"index",width:50,render:(s,p)=>`${p+1}`},{key:"osubject",title:"事件主体",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"oobject",title:"事件客体",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"odescribe",title:"事件描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"oresult",title:"事件结果",align:"center",width:180,ellipsis:{tooltip:!0},render:s=>{var p,o;return a(J,{size:"small",type:(p=s.oresult)!=null&&p.includes("成功")?"success":(o=s.oresult)!=null&&o.includes("失败")?"error":"warning"},{default:()=>[s.oresult]})}},{key:"level",title:"安全级别",align:"center",width:120,render:s=>{const p=He[s.level];let o={color:W[s.level],textColor:"#ffffff",borderColor:W[s.level]};return a(J,{size:"small",color:o},Ze(p)?p:{default:()=>[p]})}},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:140},{key:"sourceip",title:"发生源IP",align:"center",width:120},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"operate",title:M("common.operate"),align:"center",width:80,fixed:"right",render:s=>a("div",{class:"flex-center gap-8px"},[a(G,{type:"info",ghost:!0,size:"small",onClick:()=>P(s)},{default:()=>[f("详情")]})])}],y=w(!1);let e=w([]);const v=async s=>{var _;if(!y.value)y.value=!0;else return;const{data:p,error:o}=await Ue({aggid:(_=c.value)==null?void 0:_.aggid,limit:20,pageId:s});o||(y.value=!1,s?e.value=[...e.value,...p]:e.value=p)},C=async()=>{var s,p,o;e.value.length<450/44&&e.value.length<((s=c.value)==null?void 0:s.aggre)&&v(((o=(p=e.value)==null?void 0:p[e.value.length-1])==null?void 0:o.id)??void 0)};function x(s){var o;Math.abs(s.target.scrollTop+s.target.offsetHeight-s.target.scrollHeight)<=20&&((o=c.value)==null?void 0:o.aggre)>e.value.length&&T()}const T=oe.debounce(()=>{v(e.value[e.value.length-1].id)},300),z=B({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:s,endIndex:p,page:o,pageSize:_,pageCount:u,itemCount:d}){var r;return`已加载${e.value.length}条 共计${(r=c.value)==null?void 0:r.aggre} 条`}}),$=w(!1),b=w(),P=async s=>{$.value=!0,b.value=s};return(s,p)=>{const o=je,_=Fe,u=q,d=ye,r=ae,n=Se,i=we,m=be;return V(),K(m,{show:E.value,"onUpdate:show":p[1]||(p[1]=t=>E.value=t),title:"事件详情",preset:"card",class:"w-1000px"},{default:l(()=>[a(i,{class:"max-h-600px pr-20px"},{default:l(()=>[a(n,{type:"line",animated:""},{default:l(()=>[a(d,{name:"1"},{tab:l(()=>[qe]),default:l(()=>[a(u,{vertical:"",size:12},{default:l(()=>[a(_,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:l(()=>[a(o,{label:"事件名称"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.ename),1)]}),_:1}),a(o,{label:"事件类型"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.pname1),1)]}),_:1}),a(o,{label:"事件类别"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.pname2),1)]}),_:1}),a(o,{label:"日志源设备"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.type),1)]}),_:1}),a(o,{label:"聚合开始时间"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.aggrestarttime),1)]}),_:1}),a(o,{label:"聚合结束时间"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.aggreendtime),1)]}),_:1}),a(o,{label:"聚合数量"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.aggre),1)]}),_:1}),a(o,{label:"发生源IP"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.sip),1)]}),_:1}),a(o,{label:"源IP"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.sourceip),1)]}),_:1}),a(o,{label:"源端口"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.sourceport),1)]}),_:1}),a(o,{label:"目的IP"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.aimip),1)]}),_:1}),a(o,{label:"目的端口"},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.aimport),1)]}),_:1}),a(o,{label:"事件描述",span:3},{default:l(()=>{var t;return[f(I((t=c.value)==null?void 0:t.aimip),1)]}),_:1})]),_:1})]),_:1})]),_:1}),a(d,{name:"2"},{tab:l(()=>[Je]),default:l(()=>[A(e).length==0?(V(),j("div",We," 暂无原始日志信息 ")):(V(),j("div",Qe,[a(r,{columns:D,data:A(e),size:"small","row-key":t=>t.id,"virtual-scroll":"",class:"sm:h-full",pagination:z,onScroll:x,"scroll-x":D.reduce((t,g)=>t+g.width,0),loading:y.value,"max-height":480,remote:""},null,8,["data","row-key","pagination","scroll-x","loading"])])),a(Ge,{detailVisible:$.value,"onUpdate:detailVisible":p[0]||(p[0]=t=>$.value=t),detailInfo:b.value},null,8,["detailVisible","detailInfo"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ye=ne(Xe,[["__scopeId","data-v-c879b29f"]]),et={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},tt=F({name:"eventalarm_eventalarm",__name:"index",setup(S){const E=Z(),k=w(window.innerHeight-306),c=w(!1),D=w(),y=B({pageId:void 0,limit:100,lsid:void 0,etype:void 0,ectgr:void 0,elevel:void 0,startSIp:void 0,endSIp:void 0,startSourceIp:void 0,endSourceIp:void 0,startAimIp:void 0,endAimIp:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),e=[{title:"",key:"index",width:80,align:"center",render:u=>`${u.index}`},{key:"pname1",title:"事件名称",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:160},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"sip",title:"发生源IP",align:"center",width:160},{key:"aggreendtime",title:"聚合结束时间",align:"center",width:160},{key:"operate",title:M("common.operate"),align:"center",width:100,fixed:"right",render:u=>a("div",{class:"flex-center gap-8px"},[a(G,{type:"primary",ghost:!0,size:"small",onClick:()=>o(u)},{default:()=>[f("查看")]})])}],v=w([]),C=w(!1),x=w(0),T=async(u=!1)=>{if(!C.value)C.value=!0;else return;const{data:d,error:r}=await Me(y);r||(x.value=d.length,u?v.value=[...v.value,...d]:v.value=d,v.value=v.value.sort((n,i)=>i.id-n.id).map((n,i)=>(n.index=i+1,n)),C.value=!1)};T();const z=w(!0),$=()=>{v.value=[],y.pageId=void 0,(d=>Object.keys(d).filter(i=>i!=="limit"&&i!=="_t").some(i=>d[i]!==void 0&&d[i]!==""&&d[i]!==null))(y)?z.value=!1:(z.value=!0,P()),T()},b=B({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:u,endIndex:d,page:r,pageSize:n,pageCount:i,itemCount:m}){return`已加载${v.value.length}条`+(v.value.length?z.value?` 共计 ${v.value.length>0?m??0:0} 条`:x.value==y.limit?"  预计还有更多":"  没有更多了":"")}});async function P(){const{data:u,error:d}=await Oe();d||(b.pageCount=20,b.total=Number(u),b.itemCount=Number(u))}P();function s(u){Math.abs(u.target.scrollTop+u.target.offsetHeight-u.target.scrollHeight)<=20&&b.total>v.value.length&&p()}const p=oe.debounce(()=>{var u;((u=v.value)==null?void 0:u.length)<b.total&&(y.pageId=v.value[v.value.length-1].id,T(!0))},300);async function o(u){D.value=u,c.value=!0}async function _(){const u=new Date().getTime();if(!v.value.length)return;const d=JSON.parse(JSON.stringify(v.value)),r=[];d.forEach(m=>{const t={};e.forEach(g=>{if(m.hasOwnProperty(g.key)){const N=g.key=="elevel"?m[g.key]!=null?M(Re[m[g.key]]):"":m[g.key];t[g.title]=N}}),r.push(t)}),Be(r,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50},{wpx:100},{wpx:150}],"安全事件_"+new Date().getTime());const i=new Date().getTime();await Ve({operation:"导出安全事件日志",userAgent:navigator.userAgent,status:1,requestTime:i-u<1?1:i-u})}return(u,d)=>{const r=q,n=ae,i=te,m=Y("no-auth");return V(),j("div",et,[a(Ke,{model:y,"onUpdate:model":d[0]||(d[0]=t=>y=t),onSearch:$},null,8,["model"]),a(i,{title:"安全事件",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[a(r,null,{default:l(()=>[ee((V(),K(A(G),{type:"primary",size:"small",ghost:"",onClick:_,title:"导出已加载"},{default:l(()=>[f("导出已加载")]),_:1})),[[m,"sys:log:operation.insert"]])]),_:1})]),default:l(()=>[a(n,{columns:e,data:v.value,size:"small","flex-height":!A(E).isMobile,loading:C.value,remote:"","scroll-x":e.reduce((t,g)=>t+g.width,0),"row-key":t=>t.id,pagination:b,"virtual-scroll":"",onScroll:s,class:"sm:h-full","max-height":k.value},null,8,["data","flex-height","loading","scroll-x","row-key","pagination","max-height"])]),_:1}),a(Ye,{detailVisible:c.value,"onUpdate:detailVisible":d[1]||(d[1]=t=>c.value=t),detailInfo:D.value},null,8,["detailVisible","detailInfo"])])}}}),wt=ne(tt,[["__scopeId","data-v-2e6db09e"]]);export{wt as default};
