import{_ as ae}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Dm2SPuTO.js";import{d as j,aG as F,aI as L,A as te,D as oe,aE as P,a as z,$ as t,C as ne,bQ as H,c as E,o as O,w as o,f as e,bh as le,L as J,N as se,h as a,G as Q,I as K,B as I,g as M,t as U,bj as re,bR as ie,bS as Z,a7 as X,bL as W,a9 as ce,bT as me,bU as de,aT as ue,bN as pe,s as fe,b as _e,aU as $,aJ as ge,bV as he,bW as be,aZ as ve}from"./index-CYktWG4g.js";import{u as we,a as ye}from"./table-5HkGqXjJ.js";import{_ as ke}from"./round-search-DE64LlxI.js";import{_ as De}from"./round-refresh-BIWjpXWE.js";import{_ as Ne}from"./Grid-yccwcNrM.js";import{_ as xe}from"./FormItemGridItem-CEINFz71.js";import{_ as Ce}from"./Tree-CnH-bhFH.js";import{N as Re}from"./Popconfirm-CztqIDpP.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DtGc5Ytf.js";import"./export-ImUVtEbD.js";import"./round-delete-tdauvCgt.js";import"./round-plus-DbKPFX6F.js";const Se=j({name:"RoleOperateDrawer",__name:"operate-drawer",props:F({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:F(["submitted"],["update:visible"]),setup(p,{emit:D}){const n=p,d=D,f=L(p,"visible"),{formRef:g,validate:N,restoreValidation:v}=te(),{defaultRequiredRule:w}=oe();P(()=>n.rowData,()=>{h()});const S=z(()=>({add:t("page.manage.role.addRole"),edit:t("page.manage.role.editRole")})[n.operateType]),l=ne(c());function c(){return{name:"",remark:""}}const s={name:w};z(()=>{var m;return((m=n.rowData)==null?void 0:m.id)||-1}),z(()=>n.operateType==="add"||n.operateType==="edit");async function h(){if(Object.assign(l,c()),n.operateType==="edit"&&n.rowData){const{data:m,error:r}=await H(n.rowData.id);r?Object.assign(l,n.rowData):Object.assign(l,m)}}function y(){f.value=!1}async function _(){var m,r,x,T;if(await N(),n.operateType==="add"){const{data:B,error:k}=await ie({name:l.name,remark:l.remark});k||((m=window.$message)==null||m.destroyAll(),(r=window.$message)==null||r.success(t("common.addSuccess")),y(),d("submitted"))}else{const{data:B,error:k}=await Z({id:n.rowData.id,name:l.name,remark:l.remark});k||((x=window.$message)==null||x.destroyAll(),(T=window.$message)==null||T.success(t("common.updateSuccess")),y(),d("submitted"))}}return P(f,()=>{f.value&&(h(),v())}),(m,r)=>{const x=Q,T=se,B=J,k=I,G=K,A=le,V=re;return O(),E(V,{show:f.value,"onUpdate:show":r[2]||(r[2]=C=>f.value=C),"display-directive":"show",width:360},{default:o(()=>[e(A,{title:S.value,"native-scrollbar":!1,closable:""},{footer:o(()=>[e(G,{size:16},{default:o(()=>[e(k,{onClick:y},{default:o(()=>[M(U(a(t)("common.cancel")),1)]),_:1}),e(k,{type:"primary",onClick:_},{default:o(()=>[M(U(a(t)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(B,{ref_key:"formRef",ref:g,model:l,rules:s},{default:o(()=>[e(T,{label:a(t)("page.manage.role.name"),path:"name"},{default:o(()=>[e(x,{clearable:"",value:l.name,"onUpdate:value":r[0]||(r[0]=C=>l.name=C),placeholder:a(t)("page.manage.role.form.name")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(T,{label:a(t)("page.manage.role.remark"),path:"remark"},{default:o(()=>[e(x,{clearable:"",value:l.remark,"onUpdate:value":r[1]||(r[1]=C=>l.remark=C),placeholder:a(t)("page.manage.role.form.remark")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Te=j({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:F(["reset","search"],["update:model"]),setup(p,{emit:D}){const n=D,d=L(p,"model");function f(){d.value.name=null,N()}function g(){n("reset")}function N(){n("search")}return(v,w)=>{const S=Q,l=xe,c=De,s=I,h=ke,y=K,_=Ne,m=J,r=X;return O(),E(r,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[e(m,{model:d.value,"label-placement":"left","label-width":100,"show-feedback":!1},{default:o(()=>[e(_,{responsive:"screen","item-responsive":""},{default:o(()=>[e(l,{span:"24 s:12 m:6",label:a(t)("page.manage.role.name"),path:"name",class:"pr-24px"},{default:o(()=>[e(S,{value:d.value.name,"onUpdate:value":w[0]||(w[0]=x=>d.value.name=x),placeholder:a(t)("page.manage.role.form.name"),onClear:f},null,8,["value","placeholder"])]),_:1},8,["label"]),e(l,{span:"24 s:12 m:6"},{default:o(()=>[e(y,{class:"w-full"},{default:o(()=>[e(s,{onClick:g},{icon:o(()=>[e(c,{class:"text-icon"})]),default:o(()=>[M(" "+U(a(t)("common.reset")),1)]),_:1}),e(s,{type:"primary",ghost:"",onClick:N},{icon:o(()=>[e(h,{class:"text-icon"})]),default:o(()=>[M(" "+U(a(t)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Me=j({name:"MenuAuthModal",__name:"menu-auth-modal",props:F({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(p){const D=p,n=L(p,"visible");function d(){n.value=!1}const f=z(()=>t("common.edit")+t("page.manage.role.menuAuth")),g=W([]);async function N(){const{error:c,data:s}=await me({_t:new Date().getTime()});c||(g.value=de(s))}const v=W([]);async function w(){const{error:c,data:s}=await H(D.rowData.id);c||(v.value=s.menuIdList)}function S(){console.log(v.value,D.rowData.id),Z({...D.rowData,menuIdList:v.value}).then(c=>{var s,h;c.error||((h=(s=window.$message)==null?void 0:s.success)==null||h.call(s,t("common.modifySuccess")),d())})}function l(){N(),w()}return P(n,c=>{c&&l()}),(c,s)=>{const h=Ce,y=I,_=K,m=ce;return O(),E(m,{show:n.value,"onUpdate:show":s[1]||(s[1]=r=>n.value=r),title:f.value,preset:"card",class:"w-480px"},{footer:o(()=>[e(_,{justify:"end"},{default:o(()=>[e(y,{size:"small",class:"mt-16px",onClick:d},{default:o(()=>[M(U(a(t)("common.cancel")),1)]),_:1}),e(y,{type:"primary",size:"small",class:"mt-16px",onClick:S},{default:o(()=>[M(U(a(t)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(h,{cascade:"","checked-keys":v.value,"onUpdate:checkedKeys":s[0]||(s[0]=r=>v.value=r),data:g.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"",class:"h-280px","label-field":"name","key-field":"id","children-field":"children"},null,8,["checked-keys","data"])]),_:1},8,["show","title"])}}}),Ie={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function q(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!ve(p)}const Ke=j({name:"manage_role",__name:"index",setup(p){const D=ue(),{columns:n,columnChecks:d,data:f,getData:g,loading:N,mobilePagination:v,searchParams:w,resetSearchParams:S}=we({apiFn:be,apiParams:{page:1,pageSize:3,limit:3,name:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:t("page.manage.role.name"),align:"center",minWidth:120},{key:"remark",title:t("page.manage.role.remark"),align:"center",minWidth:120},{key:"createDate",title:t("page.manage.user.createDate"),align:"center",width:160},{key:"operate",title:t("common.operate"),align:"center",width:200,render:u=>{let i;return e("div",{class:"flex-center gap-8px"},[e(I,{type:"primary",ghost:!0,size:"small",onClick:()=>B(u.id)},q(i=t("common.edit"))?i:{default:()=>[i]}),e(I,{type:"primary",ghost:!0,size:"small",onClick:()=>V(u)},{default:()=>[M("分配菜单")]}),e(Re,{onPositiveClick:()=>T(u.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let R;return e(I,{type:"error",ghost:!0,size:"small"},q(R=t("common.delete"))?R:{default:()=>[R]})}})])}}]}),{drawerVisible:l,operateType:c,editingData:s,handleAdd:h,handleEdit:y,checkedRowKeys:_,onBatchDeleted:m,onDeleted:r}=ye(f,g);async function x(){console.log(_.value),C(_.value,u=>{m()})}function T(u){console.log(u),C([u],i=>{r()})}function B(u){y(u)}const{bool:k,setTrue:G}=pe(),A=fe({}),V=u=>{A.value=u,G()};async function C(u,i){const R=await he(u);console.log("data",R),i&&i(R)}return(u,i)=>{const R=ae,Y=ge,ee=X;return O(),_e("div",Ie,[e(Te,{model:a(w),"onUpdate:model":i[0]||(i[0]=b=>$(w)?w.value=b:null),onReset:a(S),onSearch:a(g)},null,8,["model","onReset","onSearch"]),e(ee,{title:a(t)("page.manage.role.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[e(R,{columns:a(d),"onUpdate:columns":i[1]||(i[1]=b=>$(d)?d.value=b:null),"disabled-delete":a(_).length===0,loading:a(N),onAdd:a(h),onDelete:x,onRefresh:a(g)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:o(()=>[e(Y,{"checked-row-keys":a(_),"onUpdate:checkedRowKeys":i[2]||(i[2]=b=>$(_)?_.value=b:null),columns:a(n),data:a(f),size:"small","flex-height":!a(D).isMobile,"scroll-x":702,loading:a(N),remote:"","row-key":b=>b.id,pagination:a(v),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Se,{visible:a(l),"onUpdate:visible":i[3]||(i[3]=b=>$(l)?l.value=b:null),"operate-type":a(c),"row-data":a(s),onSubmitted:a(g)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(Me,{visible:a(k),"onUpdate:visible":i[4]||(i[4]=b=>$(k)?k.value=b:null),rowData:A.value},null,8,["visible","rowData"])]),_:1},8,["title"])])}}});export{Ke as default};
