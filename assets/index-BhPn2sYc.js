import{_ as Me}from"./round-search-D_VWcob1.js";import{d as me,Z as ke,s as A,a as re,at as ye,i as ge,dY as _e,b as L,o as C,e as l,G as V,f as d,B as xe,w as z,g as F,aO as he,a_ as be,t as S,d4 as Ce,aL as $e,a7 as De,aF as Te,W as pe,av as Ee,ax as Se,c as Z,aD as ue,aB as fe,a3 as Fe,bM as je,a4 as Oe,fa as Ae,aI as ze,aR as de,fb as Pe,fc as Be,aP as Ne,h as W,ay as Ie,J as Re,N as Ue,au as Ve,$ as Le,a2 as We,fd as Ye,aE as qe,aS as Ze,aQ as He}from"./index-BTeMkgsf.js";import{u as Ge}from"./usePageData-BtaN_wXr.js";import{_ as ce}from"./RadioButton-DjWiQ3TF.js";import{_ as ve}from"./DatePicker-ABP-mfiZ.js";const Je={class:"map-wrapper",style:{height:"100%",position:"relative"}},Ke={class:"map-legend"},Xe={class:"legend-header"},Qe={class:"legend-actions"},et={class:"legend-list"},tt=["onClick","onContextmenu"],at={key:0,class:"visibility-icon"},st={key:1,class:"solo-icon"},nt={class:"legend-name"},lt={class:"visibility-toggle"},ot={key:0,class:"solo-notice"},rt=me({__name:"historyMap",props:{trackData:{}},setup(H){const Q=ke(),r=A(null);let b=null;const Y=H,$=A([]),i=["#FF6B9D","#6BCF7F","#4A90E2","#FFD166","#7B68EE","#00D4AA","#FF8C42","#BA68C8","#4ECDC4","#FFA726","#42B883","#FF5252","#536DFE","#00E5FF","#69F0AE","#FF4081","#18FFFF","#B388FF","#76FF03","#FF9100","#EA80FC","#84FFFF","#CCFF90","#FF9E80","#80D8FF","#FFFF8D","#A7FFEB","#FF80AB","#8C9EFF","#B9F6CA"],M=A({}),I=A(""),R=re(()=>{const n={};return Object.keys($.value).forEach((k,t)=>{n[k]=i[t%i.length],M.value[k]===void 0&&(M.value[k]=!0)}),n});function j(n){if(I.value){c(n);return}M.value[n]=!M.value[n],h()}function c(n){I.value===n?D():(I.value=n,Object.keys(M.value).forEach(u=>{M.value[u]=u===n}),h())}function D(){I.value="",Object.keys(M.value).forEach(n=>{M.value[n]=!0}),h()}function U(){Object.keys(M.value).forEach(n=>{M.value[n]=!M.value[n]}),I.value="",h()}function G(){Object.keys(M.value).forEach(n=>{M.value[n]=!0}),I.value="",h()}function te(){Object.keys(M.value).forEach(n=>{M.value[n]=!1}),I.value="",h()}const J=re(()=>{const n=[];return Object.values($.value).forEach(u=>{n.push(...u)}),n.sort((u,k)=>new Date(u.dbtime).getTime()-new Date(k.dbtime).getTime())}),ae=re(()=>{if(J.value.length===0)return[120.370086,30.305716];const n=J.value.map(e=>e.longitude),u=J.value.map(e=>e.latitude),k=(Math.min(...n)+Math.max(...n))/2,t=(Math.min(...u)+Math.max(...u))/2;return console.log(k,t),[k,t]});async function y(){const n="/map-sdk.json",{data:u}=await Te.get(`${n}?_t=${Date.now()}`);return u}function a(n){return new Promise((u,k)=>{if(window.AMap)return u(window.AMap);const t=document.createElement("script");t.src=`https://webapi.amap.com/maps?v=2.0&key=${n}&plugin=AMap.PolylineEditor`,t.defer=!0,t.onload=()=>window.AMap?u(window.AMap):k(new Error("AMapåŠ è½½å¤±è´¥")),t.onerror=()=>k(new Error("AMapè„šæœ¬åŠ è½½é”™è¯¯")),document.head.appendChild(t)})}const x=A({});function E(n,u){const k=u.lng-n.lng,t=u.lat-n.lat;return(Math.atan2(-t,k)*180/Math.PI-90+360)%360-175}function N(n,u,k,t){const e=document.createElement("div");return e.style.cssText=`
    width: 12px;
    height: 18px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 18px solid ${t};
    transform: translate(-50%, -50%) rotate(${k}deg);
    transform-origin: center center;
  `,new n.Marker({position:[u.lng,u.lat],content:e,offset:new n.Pixel(0,0)})}function o(n,u,k,t,e){const s=document.createElement("div");return s.className="custom-marker",s.style.transform="translate(calc(-50% + 4px),-120%)",s.innerHTML=`
    <div class="avatar-wrapper" style="border-color: ${t};box-shadow: 0 0 5px ${t}, 0 0 6px ${t};">
      <img src="${e||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"}" class="marker-avatar" />
    </div>
    <div class="marker-name" style="color: ${t};">${k}</div>
  `,new n.Marker({position:[u.lng,u.lat],content:s})}function T(){r.value&&r.value.clearMap(),x.value={}}function h(){!window.AMap||!r.value||Object.keys(x.value).forEach(n=>{const u=M.value[n];(x.value[n]||[]).forEach(t=>{u?t.show():t.hide()})})}function q(n){if(!r.value)return;T();const u={};Object.entries($.value).forEach(([t,e])=>{u[t]=e.map(s=>({lng:s.longitude,lat:s.latitude,address:s.address,dbtime:s.dbtime,proname:s.proname||"æœªæŒ‡å®šé¡¹ç›®",duration:s.duration||0,userimage:s.userimage,longitude:s.longitude,latitude:s.latitude}))}),Object.keys(u).forEach(t=>{const e=u[t],s=R.value[t];if(e.length===0)return;const _=[];if(e.length>1){const w=new n.Polyline({path:e.map(v=>[v.lng,v.lat]),strokeColor:s,strokeWeight:4,strokeOpacity:.7,strokeStyle:"solid",lineJoin:"round",lineCap:"round",isOutline:!0,outlineColor:"#FFFFFF",borderWeight:2});w.setMap(r.value),_.push(w)}e.forEach((w,v)=>{const P=new n.Marker({position:[w.longitude,w.latitude],content:'<div class="marker-dot"></div>',anchor:"center",offset:new n.Pixel(0,0)});P.setMap(r.value),_.push(P);const B=o(n,w,t,s,e[0].userimage);B.setMap(r.value),_.push(B),B.on("click",()=>{const ee=`
          <div style="min-width:220px; background:#fff; padding:12px 14px; font-size:13px; color:#333; line-height:1.6">
            <div style="font-weight:bold; color:${s}; font-size:15px; margin-bottom:6px; border-bottom:1px solid #f0f0f0; padding-bottom:4px">
              ${t}
            </div>
            <div><b style="color:#555">åœ°ç‚¹ï¼š</b>${w.address}</div>
            <div><b style="color:#555">æ—¶é—´ï¼š</b>${w.dbtime}</div>
            <div><b style="color:#555">é¡¹ç›®ï¼š</b>${w.proname}</div>
            <div><b style="color:#555">ç»çº¬åº¦ï¼š</b><span style="font-size:12px;color:#666">${w.longitude}, ${w.latitude}</span></div>

          </div>
          <div style="margin-top:8px; text-align:right; font-size:12px; color:#999">ç¬¬ ${v+1} ä¸ªæ‰“å¡ç‚¹</div>
        `;b.setContent(ee),b.setOffset(new n.Pixel(4,-60)),b.open(r.value,B.getPosition())}),B.on("dblclick",()=>{b.open(r.value,B.getPosition()),r.value.setCenter(B.getPosition()),r.value.setZoom(14)})});for(let w=1;w<e.length;w++){const v=e[w-1],P=e[w];if(ne(v,P))continue;const B={lng:(v.lng+P.lng)/2,lat:(v.lat+P.lat)/2},ee=E(v,P),K=N(n,B,ee,s);K.isArrow=!0,K.setMap(r.value),_.push(K)}Object.keys(u).length==1&&r.value.setFitView(_,!1,[60,60,60,60]),x.value[t]=_});const k=()=>{const e=r.value.getZoom()>=7,s=se(x.value,M.value);Object.values(s).forEach(_=>{_==null||_.forEach(w=>{w.isArrow&&(e?w.show():w.hide())})})};r.value.on("zoomend",k),k(),Object.keys(x.value).forEach(t=>{(x.value[t]||[]).forEach(s=>{s.isArrow||(M.value[t]?s.show():s.hide())})})}function se(n,u){const k={};for(const t in n)u[t]&&(k[t]=n[t]);return k}function ne(n,u,k=1e-7){return Math.abs(n.lng-u.lng)<k&&Math.abs(n.lat-u.lat)<k}async function oe(){try{const n=await y(),u=await a(n.AMAP_SDK_KEY);r.value=new u.Map("amap-container",{viewMode:"2D",center:ae.value,zoom:5,features:["bg","point"]}),Q.themeScheme==="dark"&&r.value.setMapStyle("amap://styles/dark"),u.plugin(["AMap.Scale","AMap.ToolBar"],()=>{r.value.addControl(new u.Scale),r.value.addControl(new u.ToolBar)}),r.value.on("zoomend",()=>{const t=r.value.getZoom()>=12,e=se(x.value,M.value);Object.values(e).forEach(s=>{s.forEach(_=>{_.isArrow&&(t?_.show():_.hide())})})}),b=new u.InfoWindow({anchor:"bottom-center",closeWhenClickMap:!0}),q(u)}catch(n){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",n)}}return ye(()=>Y.trackData??[],n=>{console.log(n,"så¤„ç†æ•°æ®æˆ–æ¸²æŸ“å†…å®¹"),$.value=n,window.AMap&&r.value&&q(window.AMap)},{immediate:!0,deep:!0}),ge(()=>{oe()}),_e(()=>{r.value&&r.value.destroy()}),(n,u)=>{const k=xe;return C(),L("div",Je,[u[4]||(u[4]=l("div",{id:"amap-container",style:{width:"100%",height:"100%","border-radius":"8px"}},null,-1)),l("div",Ke,[l("div",Xe,[u[3]||(u[3]=l("div",{class:"legend-title"},"äººå‘˜è½¨è¿¹",-1)),l("div",Qe,[d(k,{type:"primary",onClick:G},{default:z(()=>u[0]||(u[0]=[F("å…¨æ˜¾")])),_:1,__:[0]}),d(k,{type:"primary",onClick:te},{default:z(()=>u[1]||(u[1]=[F("å…¨éš")])),_:1,__:[1]}),d(k,{type:"primary",onClick:U},{default:z(()=>u[2]||(u[2]=[F("åé€‰")])),_:1,__:[2]})])]),l("div",et,[(C(!0),L(he,null,be(R.value,(t,e)=>(C(),L("div",{key:e,class:$e(["legend-item",{"legend-item-hidden":!M.value[e],"legend-item-solo":I.value===e}]),onClick:s=>j(e),onContextmenu:Ce(s=>c(e),["prevent"])},[l("div",{class:"legend-color",style:De({backgroundColor:t})},[M.value[e]?V("",!0):(C(),L("span",at,"ğŸ‘ï¸â€ğŸ—¨ï¸")),I.value===e?(C(),L("span",st,"â­")):V("",!0)],4),l("span",nt,S(e),1),l("span",lt,S(M.value[e]?"éšè—":"æ˜¾ç¤º"),1)],42,tt))),128))]),I.value?(C(),L("div",ot,[F(" ä»…æ˜¾ç¤º: "+S(I.value)+" ",1),l("button",{class:"cancel-solo-btn",onClick:D},"å–æ¶ˆ")])):V("",!0)])])}}}),it=pe(rt,[["__scopeId","data-v-3d111cdc"]]),ut={class:"map-wrapper",style:{height:"100%",position:"relative"}},dt=me({__name:"map",props:{trackData:{},username:{},projectName:{}},setup(H){const Q=ke(),r=A(null);let b=null;const Y=H,$=[{id:25,pid:10,longitude:120.367925,latitude:30.300161,address:"æµ™æ±Ÿçœæ­å·å¸‚é’±å¡˜åŒºç™½æ¨è¡—é“ç•™å­¦ç”Ÿåˆ›ä¸š",dbtime:"2025-10-28 22:38:57",username:"auditor",daytime:"2025-10-28"},{id:25,pid:10,ctype:2,longitude:120.373554,latitude:30.288942,address:"ä¸‰èŠ±-é“è·¯åœè½¦ä½",dbtime:"2025-10-28 22:38:57",username:"auditor",daytime:"2025-10-28"}],i=A(Y.trackData??$),M=["#FFA726","#6BCF7F"],I=re(()=>{if(i.value.length===0)return[120.370086,30.305716];const y=i.value.map(x=>x.longitude),a=i.value.map(x=>x.latitude);return[(Math.min(...y)+Math.max(...y))/2,(Math.min(...a)+Math.max(...a))/2]});async function R(){const y="/map-sdk.json",{data:a}=await Te.get(`${y}?_t=${Date.now()}`);return a}function j(y){return new Promise((a,x)=>{if(window.AMap)return a(window.AMap);const E=document.createElement("script");E.src=`https://webapi.amap.com/maps?v=2.0&key=${y}&plugin=AMap.PolylineEditor`,E.defer=!0,E.onload=()=>window.AMap?a(window.AMap):x(new Error("AMapåŠ è½½å¤±è´¥")),E.onerror=()=>x(new Error("AMapè„šæœ¬åŠ è½½é”™è¯¯")),document.head.appendChild(E)})}const c=A({});function D(y,a,x,E,N){const o=document.createElement("div");return o.className="custom-marker",o.style.transform="translate(calc(-50% + 4px), -110%)",o.innerHTML=`
    <div class="avatar-wrapper" style="border-color: ${E}; box-shadow: 0 0 10px ${E}, 0 0 20px ${E};">
      <img src="${N||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"}" class="marker-avatar" />
    </div>
    <div class="marker-name" style="color: ${E};">${x}</div>
  `,new y.Marker({position:[a.lng,a.lat],content:o})}function U(y,a){const x=document.createElement("div");return x.className="custom-marker",x.style.transform="translateX(-50%)",x.innerHTML='<div class="marker-dot"></div>',new y.Marker({position:[a.lng,a.lat],content:x})}function G(){r.value&&r.value.clearMap(),c.value={}}function te(y){G();const a=i.value.map(o=>({lng:o.longitude,lat:o.latitude,address:o.address,dbtime:o.dbtime,proname:o.proname||"æœªæŒ‡å®šé¡¹ç›®",duration:o.duration||0,distanse:o.distanse.toFixed(2)||0,userimage:o.userimage,status:o.status,ctype:o.ctype||1})),x=M[0],E=[];if(a.length>1){const o=new y.Polyline({path:a.map(T=>[T.lng,T.lat]),strokeColor:x,strokeWeight:3,strokeOpacity:.7,strokeStyle:"solid",lineJoin:"round",lineCap:"round",isOutline:!0,outlineColor:"#FFFFFF",borderWeight:2});o.setMap(r.value),E.push(o)}a.forEach(o=>{let T;o.ctype!=2?(T=D(y,o,Y.username,x,a[0].userimage),new y.Marker({position:[o.lng,o.lat],content:'<div class="marker-dot"></div>',anchor:"center"}).setMap(r.value)):T=U(y,o),T.setMap(r.value),E.push(T),T.on("click",()=>{b.open(r.value,T.getPosition());const h=`
        <div style="min-width:220px; background:#fff; padding:12px 14px; font-size:13px;">
          <div style="font-weight:bold; color:${x}; font-size:15px; margin-bottom:6px;">
            ${Y.username}
          </div>
          <div><b>åœ°ç‚¹ï¼š</b>${o.address}</div>
          <div><b>æ—¶é—´ï¼š</b>${o.dbtime}</div>
          <div><b>é¡¹ç›®ï¼š</b>${Y.projectName||"æœªæŒ‡å®šé¡¹ç›®"}</div>
          <div><b>ç±»å‹ï¼š</b>${o.ctype==0&&(o.status==0||o.status==1)?"ä¸Šç­æ‰“å¡":o.status==2?"å‡ºå‘":o.ctype==1&&(o.status==0||o.status==1)?"ä¸‹ç­æ‰“å¡":o.status==3?"åˆ°è¾¾":"ç³»ç»Ÿä¸ŠæŠ¥"}</div>
          <div><b>ç»çº¬åº¦ï¼š</b>${o.lng}, ${o.lat}</div>
          ${o.status==2||o.status==3?`<div><b>è¯¯å·®ï¼š</b>${o.distanse||0}ç±³</div>`:`<div><b>æ‰“å¡è¯¯å·®ï¼š</b>${o.distanse||0}ç±³</div>`}
          ${o.duration?`<div><b>å·¥æ—¶ï¼š</b>${o.duration} å°æ—¶</div>`:""}
        </div>
      `;b.setContent(h),o.ctype!=2?b.setOffset(new y.Pixel(4,-60)):b.setOffset(new y.Pixel(0,0))})});for(let o=1;o<a.length;o++){const T=a[o-1],h=a[o];if(Math.abs(T.lng-h.lng)<1e-7&&Math.abs(T.lat-h.lat)<1e-7)continue;const q={lng:(T.lng+h.lng)/2,lat:(T.lat+h.lat)/2},se=Math.atan2(-(h.lat-T.lat),h.lng-T.lng)*180/Math.PI-90,ne=J(y,q,se,"#1890ff");ne.setMap(r.value),E.push(ne)}r.value.setFitView(E,!1,[60,60,60,60]),c.value.single=E;const N=i.value[0]?{address:i.value[0].caddress,lng:i.value[0].clongitude,lat:i.value[0].clatitude}:null;if(N&&N.lng&&N.lat){const o=new y.Marker({position:[N.lng,N.lat],offset:new y.Pixel(-13,-30),icon:new y.Icon({size:new y.Size(26,30),imageSize:new y.Size(26,30),image:"https://cdn-icons-png.flaticon.com/512/684/684908.png"})}),T=new y.InfoWindow({isCustom:!1,anchor:"bottom-center",offset:new y.Pixel(0,-30),content:`
        <div style="font-size:14px; white-space:nowrap;">
          ğŸ“ é¡¹ç›®ä½ç½®ï¼š${N.address}
        </div>
      `});o.on("click",()=>{const h=o.getPosition();setTimeout(()=>{T.open(r.value,h)},0)}),r.value.add(o),a.forEach(h=>{if(h.ctype===0||h.ctype===1){const q=new y.Polyline({path:[[h.lng,h.lat],[N.lng,N.lat]],strokeColor:h.status==1?"#FF4500":"#00BCD4",strokeOpacity:1,strokeWeight:3,strokeStyle:"dashed",showDir:!0});q.setMap(r.value),E.push(q);const se=(h.lng+N.lng)/2,ne=(h.lat+N.lat)/2,oe=new y.Marker({position:[se,ne],content:`<div style="white-space: pre;padding:2px 4px; background:#fff; border:1px solid ${h.status==1?"#FF4500":"#00BCD4"}; border-radius:3px; font-size:12px;">${h.distanse} m</div>`,offset:new y.Pixel(0,-10)});oe.setMap(r.value),E.push(oe)}})}}function J(y,a,x,E){const N=document.createElement("div");N.style.cssText=`
    position: relative; width:60px; height:24px; display:flex; align-items:center;
    transform: translate(-50%, -50%) rotate(${x+90}deg); transform-origin:center center;
  `;for(let T=0;T<3;T++){const h=document.createElement("div");h.style.cssText=`
      position:absolute;width:0;height:0;
      border-top:8px solid transparent; border-bottom:8px solid transparent;
      border-left:12px solid ${E};
      opacity:${.3+T*.2};
      left:${T*8}px;
      animation: arrowFlow 1.5s infinite; animation-delay:${T*.2}s;
    `,N.appendChild(h)}const o=document.createElement("style");return o.textContent=`
    @keyframes arrowFlow {
      0%{opacity:0.3; transform:translateX(0px) scale(1);}
      50%{opacity:1; transform:translateX(4px) scale(1.1);}
      100%{opacity:0.3; transform:translateX(0px) scale(1);}
    }
  `,document.head.appendChild(o),new y.Marker({position:[a.lng,a.lat],content:N,offset:new y.Pixel(0,0)})}async function ae(){try{const y=await R(),a=await j(y.AMAP_SDK_KEY);r.value=new a.Map("amap-container",{viewMode:"2D",zoom:15,center:I.value,features:["bg","point"]}),Q.themeScheme==="dark"&&r.value.setMapStyle("amap://styles/dark"),a.plugin(["AMap.Scale","AMap.ToolBar"],()=>{r.value.addControl(new a.Scale),r.value.addControl(new a.ToolBar)}),b=new a.InfoWindow({anchor:"bottom-center",closeWhenClickMap:!0}),te(a)}catch(y){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",y)}}return ge(()=>{i.value=Y.trackData??$,ae()}),_e(()=>{r.value&&r.value.destroy()}),(y,a)=>(C(),L("div",ut,a[0]||(a[0]=[l("div",{id:"amap-container",style:{width:"100%",height:"100%","border-radius":"8px"}},null,-1)])))}}),ct=pe(dt,[["__scopeId","data-v-0931ee16"]]),mt={class:"p-1 border-b border-gray-100 last:border-b-0 font-size-16px"},pt={class:"flex mb-3 items-center"},vt={class:"flex-col justify-center items-center mr-20px"},ft=["src"],yt={class:"font-bold mt-10px text-[#000] calendarName"},gt={class:"flex mb-1"},ht={class:"c-#4169e1 font-bold"},bt={class:"flex mb-1"},wt={class:"c-#4169e1 font-bold"},kt={class:"flex mb-1"},_t={class:"mr-20px"},xt={class:"c-#4169e1 font-bold"},Tt={class:"c-#4169e1 font-bold"},Ft={class:"flex mb-1"},Mt={class:"c-#4169e1 font-bold"},Ct={key:0,class:"mx-20px flex items-center"},$t={key:1,class:"mx-20px flex items-center"},Dt={class:"flex items-center"},Et={class:"flex mb-1"},St={key:0},jt={key:0},Ot={class:"fontC"},At={class:"fontC"},zt={class:"fontC"},Pt={class:"fontC"},Bt={key:1},Nt={class:"fontC"},It={class:"fontC"},Rt={class:"fontC"},Ut=me({__name:"calendarModal",props:Ee({lookdetail:{},creater:{},dayRecords:{}},{dialogVisible:{type:Boolean,default:!1},dialogVisibleModifiers:{}}),emits:["update:dialogVisible"],setup(H){const Q=Se(H,"dialogVisible"),r=H,b=A({pid:0,address:"",startTime:void 0,endTime:void 0,duration:0,status:0,dailyReport:0,username:"",daytime:"",projectName:"",userImage:"",ctype:0});function Y(){const{dayRecords:j,lookdetail:c}=r,D=j.findIndex(U=>U.time===c.endTime||U.time===c.startTime);return D>0?j[D-1].endTime||j[D-1].startTime:null}function $(){const{dayRecords:j,lookdetail:c}=r,D=j.findIndex(U=>U.time===c.startTime||U.time===c.endTime);return D<j.length-1?j[D+1].startTime||j[D+1].endTime:null}const i=A([]),M=async()=>{var D;const{data:j,error:c}=await Ae({startTime:r.lookdetail.startTime?r.lookdetail.startTime:Y()||r.lookdetail.daytime+" 00:00:00",endTime:r.lookdetail.endTime?r.lookdetail.endTime:$()||r.lookdetail.daytime+" 23:59:59",pid:r.lookdetail.pid,creater:r.creater});j&&(i.value=j.filter(U=>{const G=b.value.status;return(G===2||G===3?[2,3]:[0,1]).includes(U.status)}),b.value.address=(D=j[0])==null?void 0:D.caddress)};ye(()=>Q.value,async j=>{j&&(Object.assign(b.value,r.lookdetail),R.value="table",i.value=[],M())});const I=()=>{Q.value=!1,setTimeout(()=>{b.value={pid:0,address:"",startTime:void 0,endTime:void 0,duration:0,status:0,dailyReport:0,username:"",daytime:"",projectName:"",userImage:"",ctype:0}},200)},R=A("table");return(j,c)=>{const D=ue,U=ue,G=ce,te=fe,J=je,ae=Fe,y=Oe;return C(),Z(y,{show:Q.value,"onUpdate:show":c[1]||(c[1]=a=>Q.value=a),class:"w-1000px",preset:"card",onClose:I,"modal-animation-name":"el-fade"},{header:z(()=>c[2]||(c[2]=[F(" è¯¦æƒ… ")])),default:z(()=>[l("div",mt,[l("div",pt,[l("div",vt,[l("img",{class:"w-60px h-60px rounded-full shadow-sm",src:b.value.userImage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"},null,8,ft),l("div",yt,S(b.value.username),1)]),l("div",null,[l("div",gt,[c[3]||(c[3]=l("span",{class:"mr-2"}," ğŸ—ï¸ é¡¹ç›®åç§°ï¼š ",-1)),l("span",ht,S(b.value.projectName||"æš‚æ— é¡¹ç›®"),1)]),l("div",bt,[c[4]||(c[4]=l("span",{style:{"white-space":"nowrap"}},"ğŸ“ é¡¹ç›®åœ°å€ï¼š",-1)),l("span",wt,S(b.value.address),1)]),l("div",kt,[l("div",_t,[l("span",null,"ğŸ“… "+S(b.value.status==2||b.value.status==3?"å‡ºå‘":"ä¸Šç­")+"æ‰“å¡æ—¶é—´ï¼š",1),l("span",xt,S(b.value.startTime||"æ— "),1)]),l("div",null,[l("span",null,"ğŸ“… "+S(b.value.status==2||b.value.status==3?"åˆ°è¾¾":"ä¸‹ç­")+"æ‰“å¡æ—¶é—´ï¼š",1),l("span",Tt,S(b.value.endTime||"æ— "),1)])]),l("div",Ft,[l("div",null,[c[5]||(c[5]=l("span",null,"â³ å·¥æ—¶ï¼š",-1)),l("span",Mt,S(b.value.duration||0)+"å°æ—¶",1)]),b.value.status==0||b.value.status==1?(C(),L("div",Ct,[c[9]||(c[9]=l("span",null,"ğŸ”” æ‰“å¡çŠ¶æ€ï¼š",-1)),l("span",null,[b.value.status==1?(C(),Z(D,{key:0,type:"error",size:"small"},{default:z(()=>c[6]||(c[6]=[l("span",{class:"mr-1"},null,-1),F("å¼‚å¸¸ ")])),_:1,__:[6]})):V("",!0),b.value.status==0?(C(),Z(D,{key:1,type:"success",size:"small"},{default:z(()=>c[7]||(c[7]=[l("span",{class:"mr-1"},null,-1),F("æ­£å¸¸ ")])),_:1,__:[7]})):V("",!0),i.value.some(a=>a.status==2||a.status==3)?(C(),Z(D,{key:2,class:"ml-1",color:{color:"#a43cf9",textColor:"#fff",borderColor:"#a43cf9"},size:"small"},{default:z(()=>c[8]||(c[8]=[l("span",null,null,-1),F("è¡Œç¨‹ ")])),_:1,__:[8]})):V("",!0)])])):V("",!0),b.value.status==2||b.value.status==3?(C(),L("div",$t,[d(D,{color:{color:"#a43cf9",textColor:"#fff",borderColor:"#a43cf9"},size:"small"},{default:z(()=>c[10]||(c[10]=[F(" è¡Œç¨‹ ")])),_:1,__:[10]})])):V("",!0),l("div",Dt,[c[11]||(c[11]=l("span",null,"ğŸ“ æ—¥æŠ¥ï¼š",-1)),l("span",null,[d(U,{size:"small",type:b.value.dailyReport==1?"success":"error"},{default:z(()=>[F(S(b.value.dailyReport==1?"å·²æäº¤":"æœªæäº¤"),1)]),_:1},8,["type"])])])])])]),l("div",Et,[c[12]||(c[12]=l("div",{class:"mr-15px"},"å†å²è½¨è¿¹",-1)),d(te,{size:"small",value:R.value,"onUpdate:value":c[0]||(c[0]=a=>R.value=a),name:"radiobuttongroup1"},{default:z(()=>[d(G,{value:"table",label:"è¡¨æ ¼"}),d(G,{value:"map",label:"åœ°å›¾"})]),_:1},8,["value"])]),R.value=="table"?(C(),L("div",St,[d(ae,{style:{height:"600px"},trigger:"hover"},{default:z(()=>[(C(!0),L(he,null,be(i.value,a=>(C(),L("div",{class:"tableItem",key:a.id},[a.status==0||a.status==1?(C(),L("div",jt,[l("div",null,[c[13]||(c[13]=F("æ‰“å¡ç±»å‹ï¼š")),l("span",Ot,S(a.ctype==0?"ä¸Šç­æ‰“å¡":a.ctype==1?"ä¸‹ç­æ‰“å¡":"ç³»ç»Ÿä¸ŠæŠ¥"),1)]),l("div",null,[c[14]||(c[14]=F("æ‰“å¡çŠ¶æ€ï¼š")),d(D,{type:a.status==1?"error":"success"},{default:z(()=>[l("div",null,S(a.status==0?"æ­£å¸¸":"å¼‚å¸¸"),1)]),_:2},1032,["type"])]),l("div",null,[c[15]||(c[15]=F("åœ°å€ï¼š ")),l("span",At,S(a.address),1)]),l("div",null,[c[16]||(c[16]=F("æ‰“å¡æ—¶é—´ï¼š")),l("span",zt,S(a.dbtime),1)]),l("div",null,[c[17]||(c[17]=F("æ‰“å¡è¯¯å·®å€¼ï¼š")),l("span",Pt,S(a.distanse?a.distanse.toFixed(2)+"ç±³":"æ— "),1)])])):V("",!0),a.status==2||a.status==3?(C(),L("div",Bt,[l("div",null,[c[18]||(c[18]=F("ç±»å‹ï¼š")),d(D,{type:"info"},{default:z(()=>[l("div",null,S(a.status==2?"å‡ºå‘":"åˆ°è¾¾"),1)]),_:2},1024)]),l("div",null,[F(S(a.status==2?"å‡ºå‘":"åˆ°è¾¾")+"åœ°å€ï¼š ",1),l("span",Nt,S(a.address),1)]),l("div",null,[F(S(a.status==2?"å‡ºå‘":"åˆ°è¾¾")+"æ—¶é—´ï¼š",1),l("span",It,S(a.dbtime),1)]),l("div",null,[F(S(a.status==2?"å‡ºå‘":"åˆ°è¾¾")+"è¯¯å·®å€¼ï¼š",1),l("span",Rt,S(a.distanse?a.distanse.toFixed(2)+"ç±³":"æ— "),1)])])):V("",!0)]))),128)),i.value.length==0?(C(),Z(J,{key:0,description:"æš‚æ— æ•°æ®"})):V("",!0)]),_:1})])):V("",!0),R.value=="map"?(C(),Z(ct,{key:1,trackData:i.value,projectName:b.value.projectName,username:r.lookdetail.username,class:"map"},null,8,["trackData","projectName","username"])):V("",!0)])]),_:1},8,["show"])}}}),Vt=pe(Ut,[["__scopeId","data-v-a8a6bff8"]]),Lt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Wt(H){return typeof H=="function"||Object.prototype.toString.call(H)==="[object Object]"&&!He(H)}const Yt=me({name:"reportmanagement_calendar",__name:"index",setup(H){const Q=ze();function r(t){return t.getFullYear()}function b(t){const e=new Date(t.getFullYear(),0,1),s=(t.getTime()-e.getTime())/864e5,_=e.getDay()||7;return Math.ceil((s+_)/7)}function Y(){const t=new Date,e=r(t),s=b(t).toString().padStart(2,"0");return`${e}-${s}å‘¨`}const $=A("week"),i=A({dayTime:String(de(0,null)),monthTime:String(de(3,null)),weekTime:Y(),startTime:null,endTime:null,dates:null,creater:null}),M=A([{label:"æ—¥",value:"day"},{label:"å‘¨",value:"week"},{label:"æœˆ",value:"month"}]),I=A("table"),R=A({}),j=A({}),c=re(()=>Object.keys(R.value||{}).map(t=>{var e,s;return{key:t,name:t,userimage:(s=(e=R.value[t])==null?void 0:e[0])==null?void 0:s.userimage}})),D=re(()=>{const t=[{title:"ç”¨æˆ·å",key:"name",width:120,align:"center",fixed:"left",render(s){return d("div",{class:"text-blue-600 flex-col items-center font-medium"},[d(Ne,{width:"60",height:"60","preview-disabled":!0,src:s.userimage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png",class:"rounded-md object-cover"},null),d("span",null,[s.name])])}}];let e=[];switch($.value){case"week":i.value.startTime&&i.value.endTime&&(e=Be(i.value.startTime,i.value.endTime).map(_=>U(_)));break;case"month":i.value.monthTime&&(e=Pe(i.value.monthTime).map(_=>U(_)));break;case"day":default:i.value.dayTime&&(e=[U(i.value.dayTime)]);break}return[...t,...e]}),U=t=>({title:G(t),key:t,width:340,align:"center",render:e=>te(e.name,t)}),G=t=>{const e=de(0,new Date),s=new Date(t),_=s.getMonth()+1,w=s.getDate(),v=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][s.getDay()];return d("div",{class:"py-8px",style:"background-color:"+(t==e&&$.value!="day"?"rgba(24, 144, 255,.15)":"")},[`${_}/${w} å‘¨${v}`])},te=(t,e)=>{let s;const _=de(0,new Date),w=R.value[t]||[];console.log(w,"userRecords");const v=w.filter(p=>p.daytime===e);if(console.log(v,"dayRecords"),v.length===0)return d("div",{class:"text-gray-400 text-sm"},[F("æ— è®°å½•")]);const P=v.every(p=>p.dailyReport==1),B=v.some(p=>p.status==1),ee=v.some(p=>p.status==0||p.status==1),K=v.some(p=>p.status==2||p.status==3);return d("div",{class:"text-left space-y-1 bg py-8px",style:"background-color:"+(e==_&&$.value!="day"?"rgba(24, 144, 255,.15)":"")},[d("div",{class:"flex justify-between px-8px"},[d("div",null,[F("æ‰“å¡çŠ¶æ€ï¼š"),ee&&d(ue,{size:"small",type:B?"error":"success"},{default:()=>[B?"å¼‚å¸¸":"æ­£å¸¸"]}),K&&d(ue,{size:"small",color:{color:"#a43cf9",textColor:"#fff",borderColor:"#a43cf9"},class:"ml-3px"},{default:()=>[F("è¡Œç¨‹")]})]),d(ue,{size:"small",type:P?"success":"error"},{default:()=>[P?"æ—¥æŠ¥å·²æäº¤":"æ—¥æŠ¥æœªæäº¤"]})]),d(Fe,{style:"max-height: 250px;",trigger:"none"},Wt(s=v.map((p,le)=>d("div",{key:le,class:"tableItem p-1 border-b border-gray-100 last:border-b-0",onClick:()=>x(p,t,v)},[d("div",{class:"flex justify-between items-center"},[d("div",null,[F("è°ƒè¯•äººï¼š"),d("span",null,[p==null?void 0:p.username])]),d("div",null,[F("å·¥æ—¶ï¼š"),d("span",null,[(p==null?void 0:p.duration)||0,F("å°æ—¶")])])]),d("div",null,[F("é¡¹ç›®åç§°ï¼š "),d("span",null,[(p==null?void 0:p.projectName)||"æš‚æ— é¡¹ç›®"]),F(" ")]),d("div",null,[p.status==2||p.status==3?"å‡ºå‘åœ°å€ï¼š":"ä¸Šç­æ‰“å¡åœ°å€ï¼š",F(" "),d("span",null,[p.nowaddress?p.nowaddress:"æ— "])]),d("div",null,[p.status==2||p.status==3?"å‡ºå‘æ—¶é—´ï¼š":"ä¸Šç­æ‰“å¡æ—¶é—´ï¼š",d("span",null,[p.startTime?p.startTime:"æ— "])]),d("div",null,[p.status==2||p.status==3?"å‡ºå‘æ‰“å¡è¯¯å·®å€¼ï¼š":"ä¸Šç­æ‰“å¡è¯¯å·®å€¼ï¼š",d("span",null,[p.nowdistanse?p.nowdistanse.toFixed(2)+"ç±³":"æ— "])]),d("div",null,[p.status==2||p.status==3?"åˆ°è¾¾åœ°å€ï¼š":"ä¸‹ç­æ‰“å¡åœ°å€ï¼š",d("span",null,[p.nextaddress?p.nextaddress:"æ— "])]),d("div",null,[p.status==2||p.status==3?"åˆ°è¾¾æ—¶é—´ï¼š":"ä¸‹ç­æ‰“å¡æ—¶é—´ï¼š",d("span",null,[p.endTime||"æ— "])]),d("div",null,[p.status==2||p.status==3?"åˆ°è¾¾æ‰“å¡è¯¯å·®å€¼ï¼š":"ä¸‹ç­æ‰“å¡è¯¯å·®å€¼ï¼š",d("span",null,[p.nextdistanse?p.nextdistanse.toFixed(2)+"ç±³":"æ— "])])])))?s:{default:()=>[s]})])},J=A(!1),ae=A(),y=A([]),a=A(),x=async(t,e,s)=>{a.value=t,s.value=s,console.log(s.value,"dayRecords.value"),ae.value=q.data.find(_=>_.username==e).id,J.value=!0},E=t=>{const e=t.match(/^(\d{4})-(\d{1,2})å‘¨$/);if(!e)return null;const s=Number(e[1]),_=Number(e[2]),w=new Date(s,0,1+(_-1)*7),v=w.getDay(),P=new Date(w);v<=4?P.setDate(w.getDate()-w.getDay()+1):P.setDate(w.getDate()+8-w.getDay());const B=new Date(P);B.setDate(P.getDate()+6);const ee=K=>{const p=K.getFullYear(),le=String(K.getMonth()+1).padStart(2,"0"),g=String(K.getDate()).padStart(2,"0");return`${p}-${le}-${g}`};return{start:ee(P),end:ee(B)}},N=t=>{R.value={},$.value=t,T()},o=t=>{T(t),h()},T=t=>{switch($.value){case"week":if(t){const e=E(t);e&&(i.value.startTime=e.start,i.value.endTime=e.end)}break;case"month":i.value.dates=t||i.value.monthTime;break;case"day":default:i.value.dates=t||i.value.dayTime;break}},h=async()=>{var t;try{const e={};i.value.creater&&(e.creater=i.value.creater),$.value==="week"?(e.startTime=i.value.startTime+" 00:00:00",e.endTime=i.value.endTime+" 23:59:59"):$.value==="month"?e.dates=i.value.monthTime:e.dates=i.value.dayTime;const{data:s,error:_}=await Ye(e);if(!_){if(JSON.stringify(s)=="{}")return R.value={},j.value={},(t=window.$message)==null?void 0:t.warning("æ— æ•°æ®");R.value=k(s),console.log(R.value,"userData.value"),j.value=s}}catch(e){console.error("æœç´¢è€ƒå‹¤æŠ¥è¡¨å¤±è´¥:",e)}},{pageData:q,getData:se,nextPage:ne}=Ge(Ze),oe=async t=>{const e=t.currentTarget,s=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&q.data.length<q.total&&(await ne(),await qe(),setTimeout(()=>{e.scrollTop=s}))},n=A(1),u=async t=>{i.value.creater=t,t||setTimeout(()=>{n.value++},500),h()};ye([$,()=>i.value.dates],()=>{if($.value=="week"&&i.value.weekTime){const t=E(i.value.weekTime);t&&(i.value.startTime=t.start,i.value.endTime=t.end),h()}else($.value=="month"&&i.value.monthTime||$.value=="day"&&i.value.dayTime)&&h()},{immediate:!0}),ge(()=>{i.value.weekTime=Y(),se({usertypes:"2,3"}),h()});const k=t=>{const e={};for(const s in t){const _=t[s],w=new Map;_.forEach(g=>{const O=`${g.pid}_${g.ctype}_${g.status}_${g.dbtime}_${g.daytime}`;w.has(O)||w.set(O,g)});const P=Array.from(w.values()).sort((g,O)=>g.daytime===O.daytime?g.dbtime.localeCompare(O.dbtime):g.daytime.localeCompare(O.daytime)),B=[],ee=P.filter(g=>g.status===0||g.status===1),K=P.filter(g=>g.status===2||g.status===3),p={};ee.forEach(g=>{p[g.pid]||(p[g.pid]=[]),p[g.pid].push(g)}),Object.values(p).forEach(g=>{g.sort((O,f)=>O.daytime.localeCompare(f.daytime)||O.ctype-f.ctype);for(let O=0;O<g.length;O++){const f=g[O],m=g[O+1];f.ctype===0&&m&&m.ctype===1&&f.daytime===m.daytime?(B.push({nowaddress:f.address,nextaddress:m.address,startTime:f.dbtime,endTime:m.dbtime,status:m.status===1||f.status===1?1:m.status,duration:m.duration||0,dailyReport:m.dailyReport,username:f.username,daytime:f.daytime,projectName:f.proname,userImage:f.userimage,ctype:m.ctype,pid:f.pid,nowdistanse:f.distanse,nextdistanse:m.distanse}),O++):B.push({nowaddress:f.ctype===0?f.address:"",nextaddress:f.ctype===1?f.address:"",startTime:f.ctype===0?f.dbtime:"",endTime:f.ctype===1?f.dbtime:"",duration:f.duration||0,status:f.status,dailyReport:f.dailyReport,username:f.username,daytime:f.daytime,projectName:f.proname,userImage:f.userimage,ctype:f.ctype,pid:f.pid,nowdistanse:f.ctype===0?f.distanse:"",nextdistanse:f.ctype===1?f.distanse:""})}});const le={};K.forEach(g=>{le[g.pid]||(le[g.pid]=[]),le[g.pid].push(g)}),Object.values(le).forEach(g=>{g.sort((f,m)=>f.dbtime.localeCompare(m.dbtime));const O=new Set;for(let f=0;f<g.length;f++){if(O.has(f))continue;const m=g[f];let we=!1;for(let ie=f+1;ie<g.length;ie++){if(O.has(ie))continue;const X=g[ie];if(m.status===2&&X.status===3){B.push({nowaddress:m.status===2?m.address:X.address,nextaddress:m.status===3?m.address:X.address,startTime:m.status===2?m.dbtime:X.dbtime,endTime:m.status===3?m.dbtime:X.dbtime,status:m.status,nextStatus:X.status,duration:X.duration||0,dailyReport:X.dailyReport,username:m.username,daytime:m.daytime,projectName:m.proname,userImage:m.userimage,pid:m.pid,ctype:X.ctype,nowdistanse:m.status===2?m.distanse:X.distanse,nextdistanse:m.status===3?m.distanse:X.distanse}),O.add(f),O.add(ie),we=!0;break}}we||B.push({nowaddress:m.status===2?m.address:"",nextaddress:m.status===3?m.address:"",startTime:m.status===2?m.dbtime:"",endTime:m.status===3?m.dbtime:"",duration:m.duration||0,status:m.status,dailyReport:m.dailyReport,username:m.username,daytime:m.daytime,projectName:m.proname,userImage:m.userimage,pid:m.pid,nowdistanse:m.status===2?m.distanse:"",nextdistanse:m.status===3?m.distanse:""})}}),e[s]=B.sort((g,O)=>(g.startTime||g.endTime).localeCompare(O.startTime||O.endTime))}return e};return(t,e)=>{const s=Ve,_=Ue,w=Me;return C(),L("div",Lt,[d(W(We),{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper h-full"},{header:z(()=>[d(W(Re),{align:"center"},{default:z(()=>[e[7]||(e[7]=l("div",{class:"font-semibold"},"è€ƒå‹¤æŠ¥è¡¨",-1)),d(_,{label:"ç”¨æˆ·",path:"creater","label-placement":"left","show-feedback":!1},{default:z(()=>[d(s,{clearable:"",filterable:"",value:i.value.creater,"onUpdate:value":[e[0]||(e[0]=v=>i.value.creater=v),u],placeholder:"è¯·é€‰æ‹©","label-field":"username",size:"small","value-field":"id",options:W(q).data,onScroll:oe},null,8,["value","options"])]),_:1}),d(W(fe),{value:$.value,"onUpdate:value":[e[1]||(e[1]=v=>$.value=v),N],size:"small"},{default:z(()=>[(C(!0),L(he,null,be(M.value,v=>(C(),Z(W(ce),{key:v.value,value:v.value,label:v.label},null,8,["value","label"]))),128))]),_:1},8,["value"]),$.value==="day"?(C(),Z(W(ve),{key:0,size:"small","formatted-value":i.value.dayTime,"onUpdate:formattedValue":[e[2]||(e[2]=v=>i.value.dayTime=v),o],type:"date","value-format":"yyyy-MM-dd",style:{width:"140px"}},null,8,["formatted-value"])):V("",!0),$.value==="week"?(C(),Z(W(ve),{key:1,size:"small","formatted-value":i.value.weekTime,"onUpdate:formattedValue":[e[3]||(e[3]=v=>i.value.weekTime=v),o],type:"week",style:{width:"140px"}},null,8,["formatted-value"])):V("",!0),$.value==="month"?(C(),Z(W(ve),{key:2,size:"small","formatted-value":i.value.monthTime,"onUpdate:formattedValue":[e[4]||(e[4]=v=>i.value.monthTime=v),o],type:"month","value-format":"yyyy-MM",style:{width:"140px"}},null,8,["formatted-value"])):V("",!0),d(W(xe),{type:"primary",onClick:h,size:"small",class:"w-full sm:w-auto"},{icon:z(()=>[d(w,{class:"text-icon"})]),default:z(()=>[F(" "+S(W(Le)("common.search")),1)]),_:1}),d(W(fe),{size:"small",value:I.value,"onUpdate:value":e[5]||(e[5]=v=>I.value=v),name:"radiobuttongroup1"},{default:z(()=>[d(W(ce),{value:"table",label:"è¡¨æ ¼"}),d(W(ce),{value:"map",label:"å†å²è½¨è¿¹"})]),_:1},8,["value"])]),_:1,__:[7]})]),default:z(()=>[d(Vt,{"dialog-visible":J.value,"onUpdate:dialogVisible":e[6]||(e[6]=v=>J.value=v),lookdetail:a.value,creater:ae.value,dayRecords:y.value},null,8,["dialog-visible","lookdetail","creater","dayRecords"]),I.value=="table"?(C(),Z(W(Ie),{key:0,"bottom-bordered":"",bordered:"",columns:D.value,data:c.value,size:"small","flex-height":!W(Q).isMobile,"scroll-x":D.value.reduce((v,P)=>v+P.width,0),remote:"","row-key":v=>v.key,class:"h-full",striped:""},null,8,["columns","data","flex-height","scroll-x","row-key"])):(C(),Z(it,{trackData:j.value,key:n.value},null,8,["trackData"]))]),_:1})])}}}),Kt=pe(Yt,[["__scopeId","data-v-3b78119f"]]);export{Kt as default};
