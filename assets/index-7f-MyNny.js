import{_ as _t}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Bk37bVO0.js";import{_ as ft}from"./export-lJYoUW7j.js";import{_ as vt}from"./round-delete-CPxm39Yk.js";import{_ as bt}from"./round-add-D-HFwpbW.js";import{_ as yt}from"./round-search-CE9t6Enn.js";import{d as ut,s as nt,v as ht,r as gt,x as St,y as wt,ac as ot,a as Dt,$ as p,o as V,c as et,w as a,g as t,h as D,t as x,f as i,ed as Ot,ee as kt,ao as Ct,aF as xt,R as W,aG as jt,T as dt,B as w,ap as Ut,m as lt,z as Tt,ef as Nt,b0 as H,D as Q,C as Y,eg as it,b as Et,ag as Z,aq as tt,ar as Mt,eh as $t,at as Pt,a7 as Ft,_ as qt}from"./index-iIYMoLzQ.js";import{u as It,a as zt}from"./table-CBHvhyYP.js";import{e as Bt}from"./exportExcel-Bv4G4H50.js";import{_ as ct}from"./DatePicker-cnrRC2Re.js";import{_ as pt}from"./FormItemGridItem-BLJ4oWeP.js";import{_ as mt}from"./Grid-BxBcT_du.js";import{N as st}from"./Popconfirm-BZhMqmej.js";const Ht=ut({__name:"siteModel",props:nt({operateType:{},rowData:{},unitObj:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:nt(["submitted"],["update:visible"]),setup(y,{emit:d}){const h=ht(y,"visible"),U=d,l=y,n=gt(O());function O(){return{dbtime:void 0,stationP:void 0,stationQ:void 0,stationS:void 0,stationCOS:void 0,stationU:void 0,stationI:void 0,stationFreq:void 0,stationDayE:void 0,stationTotalE:void 0,stationControlled:0}}function g(){Object.assign(n,O()),l.operateType==="edit"&&l.rowData&&(Object.assign(n,l.rowData),n.dbtime=n.dbtime.replace(/:00$/,""))}const{formRef:R,validate:j,restoreValidation:at}=St();wt(),ot(()=>l.rowData,()=>{g()}),ot(h,()=>{h.value&&(g(),at())});const k=()=>{h.value=!1},G=async()=>{var s;await j();const S=JSON.parse(JSON.stringify(n));if(S.dbtime=S.dbtime+":00",l.operateType==="add"){const{data:C,error:c}=await Ot([S]);if(c)return}else{const{data:C,error:c}=await kt([S]);if(c)return}(s=window.$message)==null||s.success(l.operateType==="add"?"添加成功":"修改成功"),k(),U("submitted")},J={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},T={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},A={dbtime:J,ratpower:T,devid:T},v=Dt(()=>({add:p("common.add"),edit:p("common.edit")})[l.operateType]);return(S,s)=>{const C=ct,c=pt,f=Ct,N=xt,E=W,K=jt,L=mt,X=dt,e=w,o=W,r=Ut;return V(),et(r,{show:h.value,"onUpdate:show":s[11]||(s[11]=m=>h.value=m),title:v.value,preset:"card",class:"w-50%"},{footer:a(()=>[t(o,{size:16,justify:"center"},{default:a(()=>[t(e,{onClick:k,class:"w-100px"},{default:a(()=>[D(x(i(p)("common.cancel")),1)]),_:1}),t(e,{type:"primary",class:"w-100px",onClick:G},{default:a(()=>[D(x(i(p)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(X,{ref_key:"formRef",ref:R,model:n,rules:A,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:a(()=>[t(L,{responsive:"screen","item-responsive":""},{default:a(()=>{var m,_,M,$,P,F,q,I,z,B;return[t(c,{span:"24 m:12",label:"数据更新时间",path:"dbtime"},{default:a(()=>[t(C,{"formatted-value":n.dbtime,"onUpdate:formattedValue":s[0]||(s[0]=u=>n.dbtime=u),"value-format":"yyyy-MM-dd HH:mm",type:"datetime",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),t(c,{span:"24 m:12",label:"总有功功率"+((m=l.unitObj)!=null&&m.StationP?"("+l.unitObj.StationP+")":"(MW)"),path:"stationP"},{default:a(()=>[t(f,{clearable:"",value:n.stationP,"onUpdate:value":s[1]||(s[1]=u=>n.stationP=u),placeholder:"请输入",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 m:12",label:"总无功功率"+((_=l.unitObj)!=null&&_.StationQ?"("+l.unitObj.StationQ+")":"(MVar)"),path:"stationQ"},{default:a(()=>[t(f,{clearable:"",value:n.stationQ,"onUpdate:value":s[2]||(s[2]=u=>n.stationQ=u),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 m:12",label:"总视在功率"+((M=l.unitObj)!=null&&M.StationS?"("+l.unitObj.StationS+")":"(MW)"),path:"stationS"},{default:a(()=>[t(f,{clearable:"",value:n.stationS,"onUpdate:value":s[3]||(s[3]=u=>n.stationS=u),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 m:12",label:"总功率因数"+((($=l.unitObj)==null?void 0:$.StationCOS)=="-"?"":(P=l.unitObj)!=null&&P.StationCOS?"("+l.unitObj.StationCOS+")":""),path:"stationCOS"},{default:a(()=>[t(f,{clearable:"",value:n.stationCOS,"onUpdate:value":s[4]||(s[4]=u=>n.stationCOS=u),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 m:12",label:"总电压"+((F=l.unitObj)!=null&&F.StationU?"("+l.unitObj.StationU+")":"(V)"),path:"stationU"},{default:a(()=>[t(f,{clearable:"",value:n.stationU,"onUpdate:value":s[5]||(s[5]=u=>n.stationU=u),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 m:12",label:"总电流"+((q=l.unitObj)!=null&&q.StationI?"("+l.unitObj.StationI+")":"(A)"),path:"stationI"},{default:a(()=>[t(f,{clearable:"",value:n.stationI,"onUpdate:value":s[6]||(s[6]=u=>n.stationI=u),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 m:12",label:"频率"+((I=l.unitObj)!=null&&I.StationFreq?"("+l.unitObj.StationFreq+")":"(Hz)"),path:"stationFreq"},{default:a(()=>[t(f,{clearable:"",value:n.stationFreq,"onUpdate:value":s[7]||(s[7]=u=>n.stationFreq=u),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 m:12",label:"日发电量"+((z=l.unitObj)!=null&&z.StationDayE?"("+l.unitObj.StationDayE+")":"(MWh)"),path:"stationDayE"},{default:a(()=>[t(f,{clearable:"",value:n.stationDayE,"onUpdate:value":s[8]||(s[8]=u=>n.stationDayE=u),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 m:12",label:"总发电量"+((B=l.unitObj)!=null&&B.StationTotalE?"("+l.unitObj.StationTotalE+")":"(MWh)"),path:"stationTotalE"},{default:a(()=>[t(f,{clearable:"",value:n.stationTotalE,"onUpdate:value":s[9]||(s[9]=u=>n.stationTotalE=u),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 m:12",label:"是否限电",path:"stationControlled"},{default:a(()=>[t(K,{value:n.stationControlled,"onUpdate:value":s[10]||(s[10]=u=>n.stationControlled=u),name:"radiogroup"},{default:a(()=>[t(E,null,{default:a(()=>[t(N,{label:i(p)("common.yesOrNo.yes"),value:1},null,8,["label"]),t(N,{label:i(p)("common.yesOrNo.no"),value:0},null,8,["label"])]),_:1})]),_:1},8,["value"])]),_:1})]}),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Qt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function rt(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Mt(y)}const Vt=ut({name:"realtimequery_sitehistoryquery",__name:"index",setup(y){const d=lt(),h=async()=>{const{data:e,error:o}=await $t();o||(d.value=e)};Tt(()=>{h(),l.value.forEach(e=>{typeof e.title=="function"&&(e.title=e.title().children[0])})});const{columns:U,columnChecks:l,data:n,getData:O,loading:g,mobilePagination:R,searchParams:j,resetSearchParams:at}=It({apiFn:Nt,apiParams:{page:1,limit:20,pageSize:20,startTime:H(1,Date.now()-864e5*3)||null,endTime:H(1,Date.now())||null,_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",width:50,disabled:e=>e.mtype==1},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"stationP",title:()=>{var e;return t("span",null,[`总有功功率${(e=d.value)!=null&&e.StationP?"("+d.value.StationP+")":"(MW)"}`])},align:"center",width:120},{key:"stationQ",title:()=>{var e;return t("span",null,[`总无功功率${(e=d.value)!=null&&e.StationQ?"("+d.value.StationQ+")":"(MW)"}`])},align:"center",width:120},{key:"stationS",title:()=>{var e;return t("span",null,[`总视在功率${(e=d.value)!=null&&e.StationS?"("+d.value.StationS+")":"(MW)"}`])},align:"center",width:120},{key:"stationCOS",title:()=>{var e,o;return t("span",null,[`总功率因数${((e=d.value)==null?void 0:e.StationCOS)=="-"?"":(o=d.value)!=null&&o.StationCOS?"("+d.value.StationCOS+")":""}`])},align:"center",width:120},{key:"stationU",title:()=>{var e,o;return t("span",null,[`总电压${(e=d.value)!=null&&e.StationU?"("+((o=d.value)==null?void 0:o.StationU)+")":"(V)"}`])},align:"center",width:120},{key:"stationI",title:()=>{var e,o;return t("span",null,[`总电流${(e=d.value)!=null&&e.StationI?"("+((o=d.value)==null?void 0:o.StationI)+")":"(A)"}`])},align:"center",width:120},{key:"stationFreq",title:()=>{var e;return t("span",null,[`频率${(e=d.value)!=null&&e.StationFreq?"("+d.value.StationFreq+")":"(Hz)"}`])},align:"center",width:100},{key:"stationDayE",title:()=>{var e;return t("span",null,[`日发电量${(e=d.value)!=null&&e.StationDayE?"("+d.value.StationDayE+")":"(MWh)"}`])},align:"center",width:120},{key:"stationTotalE",title:()=>{var e;return t("span",null,[`总发电量${(e=d.value)!=null&&e.StationTotalE?"("+d.value.StationTotalE+")":"(MWh)"}`])},align:"center",width:140},{key:"stationControlled",title:"是否限电",align:"center",width:140,render:e=>t("span",null,[e.stationControlled?e.stationControlled==1?"是":"否":""])},{key:"operate",title:p("common.operate"),align:"center",width:200,fixed:"right",render:e=>{let o;return t("div",{class:"flex-center gap-8px"},[e.mtype==0?t(W,null,{default:()=>[Q(t(w,{type:"primary",ghost:!0,size:"small",onClick:()=>N(e.id)},rt(o=p("common.edit"))?o:{default:()=>[o]}),[[Y("no-auth"),"station:his:update"]]),Q(t(st,{onPositiveClick:()=>f(e.id)},{default:()=>p("common.confirmDelete"),trigger:()=>{let r;return t(w,{type:"error",ghost:!0,size:"small"},rt(r=p("common.delete"))?r:{default:()=>[r]})}}),[[Y("no-auth"),"station:his:delete"]])]}):""])}}]}),{drawerVisible:k,operateType:G,editingData:J,handleAdd:T,handleEdit:A,checkedRowKeys:v,onBatchDeleted:S,onDeleted:s}=zt(n,O),C=()=>{O()},c=async()=>{const e=v.value.join(","),{data:o,error:r}=await it({ids:e});r||(s(),v.value=[])},f=async e=>{const{data:o,error:r}=await it({ids:e});r||s()},N=e=>{A(e)},E=lt([Date.now()-864e5*3,Date.now()]);async function K(e,o){j.startTime=H(1,o[0]),j.endTime=H(1,o[1]),O()}const L=()=>{const e={};U.value.forEach(r=>{r.key!="index"&&r.key!="operation"&&r.type!=="selection"&&(e[r.key]=typeof r.title=="string"?r.title:r.title().children[0])});const o=[];n.value.forEach(r=>{if(v.value.includes(r.id)){const m=JSON.parse(JSON.stringify(e));for(const _ in m)r.hasOwnProperty(_)?_=="stationControlled"?m[_]=r[_]==1?"是":"否":m[_]=r[_]:m[_]="";o.push(m)}}),Bt(o,e,"站点历史数据")},X={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()]};return(e,o)=>{const r=ct,m=yt,_=pt,M=mt,$=dt,P=bt,F=vt,q=ft,I=_t,z=Pt,B=Ft,u=Y("no-auth");return V(),Et("div",Qt,[t(B,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t($,{ref:"formRef",model:i(j),"label-placement":"left","show-feedback":!1},{default:a(()=>[t(M,{"y-gap":16,responsive:"screen","item-responsive":""},{default:a(()=>[t(_,{span:"24 s:12 m:12",label:"起止时间",path:"startTime"},{default:a(()=>[t(r,{value:E.value,"onUpdate:value":o[0]||(o[0]=b=>E.value=b),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":K,shortcuts:X,"default-time":["00:00:00","23:59:59"]},null,8,["value"]),t(i(w),{type:"primary",ghost:"",onClick:C,class:"ml-20px"},{icon:a(()=>[t(m,{class:Z(["text-icon",{"animate-spin":i(g)}])},null,8,["class"])]),default:a(()=>[D(" "+x(i(p)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),"header-extra":a(()=>[t(i(W),{justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[Q((V(),et(i(w),{onClick:i(T),size:"small",ghost:"",type:"primary"},{icon:a(()=>[t(P,{class:Z(["text-icon",{"animate-spin":i(g)}])},null,8,["class"])]),default:a(()=>[D(" "+x(i(p)("common.add")),1)]),_:1},8,["onClick"])),[[u,"station:his:insert"]]),Q((V(),et(i(st),{onPositiveClick:c},{trigger:a(()=>[t(i(w),{size:"small",ghost:"",type:"error",disabled:i(v).length==0},{icon:a(()=>[t(F,{class:Z(["text-icon",{"animate-spin":i(g)}])},null,8,["class"])]),default:a(()=>[D(" "+x(i(p)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:a(()=>[D(" 确认删除选中的项吗？ ")]),_:1})),[[u,"station:his:delete"]]),t(i(w),{onClick:L,size:"small",disabled:i(v).length==0},{icon:a(()=>[t(q,{class:"text-icon"})]),default:a(()=>[D(" "+x(i(p)("common.export")),1)]),_:1},8,["disabled"]),t(I,{columns:i(l),"onUpdate:columns":o[1]||(o[1]=b=>tt(l)?l.value=b:null)},null,8,["columns"])]),_:1})]),default:a(()=>[t(z,{"checked-row-keys":i(v),"onUpdate:checkedRowKeys":o[2]||(o[2]=b=>tt(v)?v.value=b:null),columns:i(U),data:i(n),size:"small",loading:i(g),remote:"","row-key":b=>b.id,pagination:i(n).length?i(R):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1}),t(Ht,{visible:i(k),"onUpdate:visible":o[3]||(o[3]=b=>tt(k)?k.value=b:null),onSubmitted:C,"operate-type":i(G),"row-data":i(J),unitObj:d.value},null,8,["visible","operate-type","row-data","unitObj"])])}}}),ae=qt(Vt,[["__scopeId","data-v-4124c1cb"]]);export{ae as default};
