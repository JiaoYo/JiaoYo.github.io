import{_ as Se}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CZS90eyC.js";import{_ as je}from"./round-delete-BUe9s3DM.js";import{_ as Te}from"./round-add-DYiCOkQk.js";import{d as ie,aB as oe,z as fe,C as Ue,s as R,aP as se,A as me,a as Pe,aD as ve,az as $e,d1 as Be,d2 as Re,c as D,o as _,w as l,f as t,a8 as qe,L as ge,h as n,aA as _e,G as T,b as Z,F as te,g as b,e as B,t as k,aF as Fe,B as U,aG as Ie,I as re,$ as F,a9 as Le,cu as ye,aK as he,aM as Me,K as Oe,a7 as be,aO as Ve,i as Ae,E as ne,aQ as ae,aE as Ee,H as le,aR as Ge,d3 as de,d4 as Ke,aV as He}from"./index-CF5MLTcW.js";import{u as Qe,a as Je}from"./table-CjO67JuQ.js";import{u as we}from"./usePageData-Ci1OCWwf.js";import{_ as ke}from"./Grid-C1MGDjD6.js";import{_ as xe}from"./FormItemGridItem-zqSggTEs.js";import{_ as We}from"./round-search-ZJkui7sH.js";import{_ as Xe}from"./round-refresh-BsyOm5rL.js";import{N as pe}from"./Popconfirm-DN_sr8cS.js";const Ye={key:0,style:{"margin-left":"20px"}},Ze={key:0,style:{"margin-left":"20px"}},et={key:0,style:{"margin-left":"20px"}},tt={key:0,style:{"margin-left":"20px"}},at=ie({name:"OperateDrawer",__name:"operate-drawer",props:oe({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:oe(["submitted"],["update:visible"]),setup(P,{emit:G}){const N=G,I=fe(),x=P,e=Ue(S());R();function S(){return{pid:void 0,id:"",affectedbusiness:"",devname:"",apidocument:"",uid:void 0,period:"",notes:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const f=R([]),{pageData:v,getData:y,nextPage:L}=we(ye),K=async o=>{const a=o.currentTarget,u=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&v.data.length<v.total&&(await L(),f.value=v.data,await he(),setTimeout(()=>{a.scrollTop=u}))},H=async()=>{var o;await y({fuzzy:I.userInfo.pname,page:1}),f.value=v.data,e.pid=x.pid?x.pid:(o=f.value[0])==null?void 0:o.id},Q=se.debounce(async o=>{await y({fuzzy:o,page:1}),f.value=v.data},300),$=R(!1),w=R(!1),J=o=>{if(e.pid=null,$.value=!0,w.value=!1,!o){M();return}Q(o)},W=async()=>{$.value&&!w.value&&(await y({page:1}),f.value=v.data,$.value=!1)},M=async()=>{await y({page:1}),f.value=v.data},ee=async o=>{e.pid=o,w.value=!0};async function X(){H(),Object.assign(e,S()),x.operateType==="edit"&&x.rowData&&Object.assign(e,x.rowData)}const{formRef:Y,validate:A,restoreValidation:p}=me(),d={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},affectedbusiness:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},apidocument:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},period:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},uid:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},c=Pe(()=>({add:"新增需要开发",edit:"修改需要开发"})[x.operateType]),i=ve(P,"visible");async function g(o){if(o)try{const u=await(await fetch(o==null?void 0:o.split("?")[0],{mode:"cors"})).blob(),z=URL.createObjectURL(u),j=document.createElement("a");j.href=z,j.download=o==null?void 0:o.split("?")[1],j.style.display="none",document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(z)}catch(a){console.error("下载失败:",a)}}$e(i,()=>{i.value&&(X(),setTimeout(()=>{const o=document.querySelector(".n-scrollbar-content");o==null||o.scrollTo(0,0)},300),p())});const r=R(0),m=R("");async function q({file:o},a){r.value=0,m.value=a;const u=await Me(o.file,o.name,"",z=>{r.value=z});u&&(e[a]=u,r.value=0)}function O(){i.value=!1}async function V(o){var a;return o.file.file.size>100*1024*1024?((a=window.$message)==null||a.error("文件大小不能超过100M"),!1):!0}const E=se.debounce(async()=>{await C()},1e3,{leading:!0,trailing:!1});async function C(){var o,a;if(await A(),x.operateType==="edit"){const{data:u,error:z}=await Be([e]);z||(O(),N("submitted"),(o=window.$message)==null||o.success("修改成功"))}else{const{data:u,error:z}=await Re([{...e}]);z||(O(),N("submitted"),(a=window.$message)==null||a.success("添加成功"))}}return(o,a)=>{const u=xe,z=Fe,j=Ie,ue=ke,Ce=ge,ze=qe,De=re,Ne=Le;return _(),D(Ne,{show:i.value,"onUpdate:show":a[19]||(a[19]=s=>i.value=s),title:c.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:l(()=>[t(De,{justify:"end",size:16},{default:l(()=>[t(n(U),{onClick:O},{default:l(()=>[b(k(n(F)("common.cancel")),1)]),_:1}),t(n(U),{type:"primary",onClick:n(E)},{default:l(()=>[b(k(n(F)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:l(()=>[t(ze,{class:"pr-20px"},{default:l(()=>[t(Ce,{ref_key:"formRef",ref:Y,model:e,rules:d,"label-placement":"left","label-width":120},{default:l(()=>[t(ue,{responsive:"screen","item-responsive":""},{default:l(()=>[t(u,{span:"24 m:12",label:"项目列表",path:"pid"},{default:l(()=>[t(n(_e),{clearable:"",filterable:"",value:e.pid,"onUpdate:value":[a[0]||(a[0]=s=>e.pid=s),ee],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:M,onSearch:J,onBlur:W,options:f.value,onScroll:K},null,8,["value","options"])]),_:1}),t(u,{span:"24 m:12",label:"影响的业务",path:"affectedbusiness"},{default:l(()=>[t(n(T),{value:e.affectedbusiness,"onUpdate:value":a[1]||(a[1]=s=>e.affectedbusiness=s),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"设备名称",path:"devname"},{default:l(()=>[t(n(T),{value:e.devname,"onUpdate:value":a[2]||(a[2]=s=>e.devname=s),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"接口文档",path:"apidocument"},{default:l(()=>[t(n(T),{value:e.apidocument,"onUpdate:value":a[3]||(a[3]=s=>e.apidocument=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"研发对接人",path:"uid"},{default:l(()=>[t(n(T),{value:e.uid,"onUpdate:value":a[4]||(a[4]=s=>e.uid=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"研发周期",path:"period"},{default:l(()=>[t(n(T),{value:e.period,"onUpdate:value":a[5]||(a[5]=s=>e.period=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"备注",path:"notes"},{default:l(()=>[t(n(T),{value:e.notes,"onUpdate:value":a[6]||(a[6]=s=>e.notes=s),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:l(()=>[t(ue,{responsive:"screen","item-responsive":""},{default:l(()=>[t(u,{span:"24 m:12",label:"附件1",path:"notes"},{default:l(()=>[t(n(T),{value:e.re1,"onUpdate:value":a[7]||(a[7]=s=>e.re1=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var s;return[e.fl1?(_(),Z("span",Ye,[b(k((s=e.fl1)==null?void 0:s.split("?")[1])+" ",1),B("span",{class:"cursor-pointer c-#c92a2a",onClick:a[8]||(a[8]=h=>e.fl1="")},"删除"),B("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[9]||(a[9]=h=>g(e.fl1))},"下载")])):(_(),D(z,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":h=>q(h,"fl1"),"show-file-list":!1,onBeforeUpload:V},{default:l(()=>[t(n(U),{loading:r.value>0&&!e.fl1&&m.value=="fl1",size:"small",ghost:"",type:"primary"},{default:l(()=>[b(k(r.value>0&&!e.fl1&&m.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),r.value&&!e.fl1&&m.value=="fl1"?(_(),D(j,{key:2,type:"line",percentage:r.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):te("",!0)]}),_:1})]),_:1})]),_:1}),t(u,{span:"24 m:12",label:"附件2",path:"notes"},{default:l(()=>[t(n(T),{value:e.re2,"onUpdate:value":a[10]||(a[10]=s=>e.re2=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var s;return[e.fl2?(_(),Z("span",Ze,[b(k((s=e.fl2)==null?void 0:s.split("?")[1])+" ",1),B("span",{class:"cursor-pointer c-#c92a2a",onClick:a[11]||(a[11]=h=>e.fl2="")},"删除"),B("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[12]||(a[12]=h=>g(e.fl2))},"下载")])):(_(),D(z,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":h=>q(h,"fl2"),"show-file-list":!1,onBeforeUpload:V},{default:l(()=>[t(n(U),{loading:r.value>0&&!e.fl2&&m.value=="fl2",size:"small",ghost:"",type:"primary"},{default:l(()=>[b(k(r.value>0&&!e.fl2&&m.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),r.value&&!e.fl2&&m.value=="fl2"?(_(),D(j,{key:2,type:"line",percentage:r.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):te("",!0)]}),_:1}),t(u,{span:"24 m:12",label:"附件3",path:"notes"},{default:l(()=>[t(n(T),{value:e.re3,"onUpdate:value":a[13]||(a[13]=s=>e.re3=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var s;return[e.fl3?(_(),Z("span",et,[b(k((s=e.fl3)==null?void 0:s.split("?")[1])+" ",1),B("span",{class:"cursor-pointer c-#c92a2a",onClick:a[14]||(a[14]=h=>e.fl3="")},"删除"),B("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[15]||(a[15]=h=>g(e.fl3))},"下载")])):(_(),D(z,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":h=>q(h,"fl3"),"show-file-list":!1,onBeforeUpload:V},{default:l(()=>[t(n(U),{loading:r.value>0&&!e.fl3&&m.value=="fl3",size:"small",ghost:"",type:"primary"},{default:l(()=>[b(k(r.value>0&&!e.fl3&&m.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),r.value&&!e.fl3&&m.value=="fl3"?(_(),D(j,{key:2,type:"line",percentage:r.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):te("",!0)]}),_:1}),t(u,{span:"24 m:12",label:"附件4",path:"notes"},{default:l(()=>[t(n(T),{value:e.re4,"onUpdate:value":a[16]||(a[16]=s=>e.re4=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var s;return[e.fl4?(_(),Z("span",tt,[b(k((s=e.fl4)==null?void 0:s.split("?")[1])+" ",1),B("span",{class:"cursor-pointer c-#c92a2a",onClick:a[17]||(a[17]=h=>e.fl4="")},"删除"),B("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[18]||(a[18]=h=>g(e.fl4))},"下载")])):(_(),D(z,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":h=>q(h,"fl4"),"show-file-list":!1},{default:l(()=>[t(n(U),{loading:r.value>0&&!e.fl4&&m.value=="fl4",size:"small",ghost:"",type:"primary"},{default:l(()=>[b(k(r.value>0&&!e.fl4&&m.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),r.value&&!e.fl4&&m.value=="fl4"?(_(),D(j,{key:2,type:"line",percentage:r.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):te("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),lt=ie({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:oe(["reset","search","clear"],["update:model"]),setup(P,{emit:G}){const N=G,{formRef:I,restoreValidation:x}=me(),e=ve(P,"model"),S=fe(),f=R([]),{pageData:v,getData:y,nextPage:L}=we(ye),K=async p=>{const d=p.currentTarget,c=d.scrollTop;d.scrollTop+d.offsetHeight>=d.scrollHeight&&v.data.length<v.total&&(await L(),f.value=v.data,await he(),setTimeout(()=>{d.scrollTop=c}))},H=async p=>{var d;w.value=!0,p?(e.value.pid=p,N("search"),S.setProjectInfo({pname:(d=f.value.find(c=>c.id==p))==null?void 0:d.proname,pid:p})):N("clear")},Q=se.debounce(async p=>{await y({fuzzy:p,page:1}),f.value=v.data},300),$=R(!1),w=R(!1),J=p=>{if(e.value.pid=null,$.value=!0,w.value=!1,!p){M();return}Q(p)},W=async()=>{$.value&&!w.value&&(await y({page:1}),f.value=v.data,$.value=!1)},M=async()=>{await y({page:1}),f.value=v.data};(async()=>{var p,d;await y({fuzzy:S.userInfo.pname}),f.value=v.data,e.value.pid=S.userInfo.pid?S.userInfo.pid:(p=f.value[0])==null?void 0:p.id,S.setProjectInfo({pid:e.value.pid,pname:(d=f.value.find(c=>c.id==e.value.pid))==null?void 0:d.proname}),N("search")})();async function X(){await x(),e.value.fuzzy="",N("reset")}const Y=()=>{e.value.fuzzy="",N("search")};async function A(){var p,d;e.value.pid?N("search"):((p=window.$message)==null||p.destroyAll(),(d=window.$message)==null||d.warning("请选择项目"))}return(p,d)=>{const c=_e,i=xe,g=T,r=Xe,m=U,q=We,O=re,V=ke,E=ge,C=be;return _(),D(C,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[t(E,{ref_key:"formRef",ref:I,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Oe(A,["enter"])},{default:l(()=>[t(V,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[t(i,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:l(()=>[t(c,{filterable:"",clearable:"",value:e.value.pid,"onUpdate:value":[d[0]||(d[0]=o=>e.value.pid=o),H],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:f.value,onScroll:K,onClear:M,onSearch:J,onBlur:W},null,8,["value","options"])]),_:1}),t(i,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:l(()=>[t(g,{value:e.value.fuzzy,"onUpdate:value":d[1]||(d[1]=o=>e.value.fuzzy=o),placeholder:"请输入",clearable:"",onClear:Y},null,8,["value"])]),_:1}),t(i,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[t(O,{class:"w-full"},{default:l(()=>[t(m,{onClick:X},{icon:l(()=>[t(r,{class:"text-icon"})]),default:l(()=>[b(" "+k(n(F)("common.reset")),1)]),_:1}),t(m,{type:"primary",ghost:"",onClick:A},{icon:l(()=>[t(q,{class:"text-icon"})]),default:l(()=>[b(" "+k(n(F)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),nt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ce(P){return typeof P=="function"||Object.prototype.toString.call(P)==="[object Object]"&&!He(P)}const gt=ie({name:"projectmanagement_need",__name:"index",setup(P){const G=Ve(),{columns:N,columnChecks:I,data:x,getData:e,loading:S,pagination:f,mobilePagination:v,searchParams:y}=Qe({showTotal:!0,immediate:!1,apiFn:Ke,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"affectedbusiness",title:"影响的业务",align:"center",width:120},{key:"devname",title:"设备名称",align:"center",width:120},{key:"apidocument",title:"接口文档",align:"center",width:120},{key:"uid",title:"研发对接人",align:"center",width:120},{key:"period",title:"研发周期",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"操作人",align:"center",width:120},{key:"dbtime",title:"操作时间",align:"center",width:120},{key:"operate",title:F("common.operate"),align:"center",width:140,fixed:"right",render:c=>{let i;return t("div",{class:"flex-center gap-8px"},[le(t(U,{type:"primary",ghost:!0,size:"small",onClick:()=>X(c.id)},ce(i=F("common.edit"))?i:{default:()=>[i]}),[[ne("no-auth"),"project:Development:update"]]),t(pe,{onPositiveClick:()=>ee(c.id)},{default:()=>F("common.confirmDelete"),trigger:()=>{let g;return le(t(U,{type:"error",ghost:!0,size:"small"},ce(g=F("common.delete"))?g:{default:()=>[g]}),[[ne("no-auth"),"project:Development:delete"]])}})])}}]}),{drawerVisible:L,operateType:K,editingData:H,handleAdd:Q,handleEdit:$,checkedRowKeys:w,onBatchDeleted:J,onDeleted:W}=Je(x,e);Ae(async()=>{});async function M(){console.log(w.value),Y(w.value.join(","),c=>{J()})}async function ee(c){const{data:i,error:g}=await de(c,y.pid);g||W()}function X(c){$(c)}async function Y(c,i){const{data:g,error:r}=await de(c,y.pid);if(!r)i&&i(g);else return!1}const A=c=>{e()},p=()=>{x.value=[],f.itemCount=0},d=()=>{e()};return(c,i)=>{const g=re,r=Te,m=je,q=Se,O=Ee,V=be,E=ne("no-auth");return _(),Z("div",nt,[t(lt,{model:n(y),"onUpdate:model":i[0]||(i[0]=C=>ae(y)?y.value=C:null),onReset:d,onSearch:n(e),onClear:p},null,8,["model","onSearch"]),t(V,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[t(g,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>i[4]||(i[4]=[B("div",null,"需要开发",-1)])),_:1,__:[4]})]),"header-extra":l(()=>[t(g,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[le((_(),D(n(U),{onClick:n(Q),size:"small",ghost:"",type:"primary"},{icon:l(()=>[t(r,{class:"text-icon"})]),default:l(()=>[i[5]||(i[5]=b(" "+k("新增")))]),_:1,__:[5]},8,["onClick"])),[[E,"project:Development:insert"]]),t(n(pe),{onPositiveClick:M},{trigger:l(()=>[le((_(),D(n(U),{size:"small",ghost:"",type:"error",disabled:n(w).length==0},{icon:l(()=>[t(m,{class:Ge(["text-icon",{"animate-spin":n(S)}])},null,8,["class"])]),default:l(()=>[i[6]||(i[6]=b(" "+k("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[E,"project:Development:delete"]])]),default:l(()=>[i[7]||(i[7]=b(" 确定要删除选中的吗？ "))]),_:1,__:[7]}),t(q,{columns:n(I),"onUpdate:columns":i[1]||(i[1]=C=>ae(I)?I.value=C:null)},null,8,["columns"])]),_:1})]),default:l(()=>[t(O,{"checked-row-keys":n(w),"onUpdate:checkedRowKeys":i[2]||(i[2]=C=>ae(w)?w.value=C:null),columns:n(N),data:n(x),size:"small","flex-height":!n(G).isMobile,loading:n(S),remote:"","row-key":C=>C.id,pagination:n(v),class:"sm:h-full","onUpdate:filters":A},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(at,{visible:n(L),"onUpdate:visible":i[3]||(i[3]=C=>ae(L)?L.value=C:null),onSubmitted:n(e),pid:n(y).pid,"operate-type":n(K),"row-data":n(H)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{gt as default};
