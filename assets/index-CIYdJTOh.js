import{_ as _e}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Ntj8nZ22.js";import{_ as fe}from"./refresh-CPyYuWsO.js";import{_ as he}from"./round-delete-DZdga6lq.js";import{_ as ge}from"./round-plus-HFh9aqSG.js";import{d as E,p as A,q as Z,s as ee,b as ve,r as be,ab as ye,z as L,o as V,c as O,w as t,g as e,h as u,t as x,i as a,$ as r,C as te,A as D,d_ as ae,d$ as we,e0 as ke,L as ne,M as Ce,aW as xe,P as J,aX as De,Q as oe,B as I,c1 as Ne,c2 as ze,a6 as se,a0 as Se,e1 as $e,b8 as Ie,k as X,e2 as Pe,e3 as Ue,e as Te,aI as K,f as le,af as Be,aJ as Re,cb as Me,aL as je}from"./index-9S47JhTf.js";import{u as Fe,a as Le}from"./table-misYQNHI.js";import{a as Ve,b as Ge}from"./basic_config-Ch5JbFT5.js";import{_ as ie}from"./lodash-CW-qCLeC.js";import{_ as Ke}from"./round-search-CqQ3ZuTv.js";import{_ as Oe}from"./round-refresh-DMZtC-A5.js";import{_ as We}from"./FormItemGridItem-ZqYwlEbq.js";import{_ as qe}from"./Grid-DcLB23nJ.js";import{N as H}from"./Popconfirm-D6sKuIk9.js";const Ae=E({name:"OperateDrawer",__name:"operate-drawer",props:A({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:A(["submitted"],["update:visible"]),setup(h,{emit:R}){const d=h,k=R,_=Z(h,"visible"),{formRef:s,validate:P,restoreValidation:M}=ee(),N=ve(()=>({add:"新增白名单",edit:"编辑白名单"})[d.operateType]),i=be(z());function z(){return{ip:"",status:0,sysparam:0,dscb:""}}const f={ip:{required:!0,validator:ae,trigger:["input","change","blur","password-input"]}};function g(){Object.assign(i,z()),d.operateType==="edit"&&d.rowData&&Object.assign(i,d.rowData)}function v(){_.value=!1}async function b(){var y,c;if(await P(),d.operateType==="add"){const{data:C,error:l}=await we([i]);l||((y=window.$message)==null||y.success(r("common.addSuccess")),v(),k("submitted"))}else{const{data:C,error:l}=await ke([i]);l||((c=window.$message)==null||c.success(r("common.updateSuccess")),v(),k("submitted"))}}const U=ie.debounce(b,1e3,{leading:!0,trailing:!1});return ye(_,()=>{_.value&&(g(),M())}),(y,c)=>{const C=ne,l=Ce,T=xe,B=J,j=De,S=oe,G=I,W=Ne,q=ze,F=L("no-space");return V(),O(q,{show:_.value,"onUpdate:show":c[3]||(c[3]=w=>_.value=w),"display-directive":"show",width:360},{default:t(()=>[e(W,{title:N.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(B,{size:16},{default:t(()=>[e(G,{onClick:v},{default:t(()=>[u(x(a(r)("common.cancel")),1)]),_:1}),e(G,{type:"primary",onClick:a(U),ghost:""},{default:t(()=>[u(x(a(r)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(S,{ref_key:"formRef",ref:s,model:i,rules:f,onKeyup:te(a(U),["enter"])},{default:t(()=>[e(l,{label:"IP",path:"ip"},{default:t(()=>[D(e(C,{clearable:"",value:i.ip,"onUpdate:value":c[0]||(c[0]=w=>i.ip=w),placeholder:"请输入IP"},null,8,["value"]),[[F]])]),_:1}),e(l,{label:"状态"},{default:t(()=>[e(j,{value:i.status,"onUpdate:value":c[1]||(c[1]=w=>i.status=w),name:"radiogroup"},{default:t(()=>[e(B,null,{default:t(()=>[e(T,{value:0},{default:t(()=>[u("启用")]),_:1}),e(T,{value:1},{default:t(()=>[u("禁用")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),e(l,{label:"描述",path:"dscb"},{default:t(()=>[D(e(C,{clearable:"",value:i.dscb,"onUpdate:value":c[2]||(c[2]=w=>i.dscb=w),placeholder:"请输入描述"},null,8,["value"]),[[F]])]),_:1})]),_:1},8,["model","onKeyup"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ee=E({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:A(["reset","search"],["update:model"]),setup(h,{emit:R}){const d=R,{formRef:k,restoreValidation:_}=ee(),s=Z(h,"model"),P={ip:[{validator:ae,trigger:["blur","change","input"]}]};function M(){s.value.fuzzy=void 0,s.value.ip=s.value.ip==""?void 0:s.value.ip,d("search")}function N(){s.value.ip=void 0,d("search")}async function i(){await _(),d("reset")}async function z(){d("search")}return(f,g)=>{const v=ne,b=We,U=Oe,y=I,c=Ke,C=J,l=qe,T=oe,B=se,j=L("no-space");return V(),O(B,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(T,{ref_key:"formRef",ref:k,model:s.value,"label-placement":"left",rules:P,"label-width":80,"show-require-mark":!1,onKeyup:te(z,["enter"])},{default:t(()=>[e(l,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:t(()=>[e(b,{span:"24 s:12 m:8 l:6",label:"名称",path:"fuzzy"},{default:t(()=>[D(e(v,{clearable:"",value:s.value.fuzzy,"onUpdate:value":g[0]||(g[0]=S=>s.value.fuzzy=S),placeholder:"请输入关键字",onClear:M},null,8,["value"]),[[j]])]),_:1}),e(b,{span:"24 s:12 m:8 l:6",label:"IP",path:"ip"},{default:t(()=>[D(e(v,{clearable:"",value:s.value.ip,"onUpdate:value":g[1]||(g[1]=S=>s.value.ip=S),placeholder:"请输入IP",onClear:N},null,8,["value"]),[[j]])]),_:1}),e(b,{span:"24  s:12 m:8 l:6"},{default:t(()=>[e(C,{class:"w-full"},{default:t(()=>[e(y,{onClick:i},{icon:t(()=>[e(U,{class:"text-icon"})]),default:t(()=>[u(" "+x(a(r)("common.reset")),1)]),_:1}),e(y,{type:"primary",ghost:"",onClick:z},{icon:t(()=>[e(c,{class:"text-icon"})]),default:t(()=>[u(" "+x(a(r)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Je={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"},Qe=le("div",null,"白名单",-1),Xe={class:"font-size-14px flex align-center gap-8px"};function Y(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Re(h)}const ut=E({name:"manage_whitelist",__name:"index",setup(h){const R=Se(),{columns:d,columnChecks:k,data:_,getData:s,loading:P,mobilePagination:M,searchParams:N,resetSearchParams:i}=Fe({apiFn:$e,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,ip:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,disabled:n=>n.sysparam==0},{key:"ip",title:"IP地址",align:"center",width:240},{key:"dscb",title:"描述",align:"center",width:240},{key:"status",title:"状态",width:100,align:"center",render:n=>(n.status===null&&(n.status=0),e(Ie,{type:{0:"success",1:"error"}[n.status]},{default:()=>[n.status==0?"启用":"禁用"]}))},{key:"operate",title:r("common.operate"),align:"center",width:130,render:n=>{let o;return e("div",{class:"flex-center gap-8px"},[D(e(I,{type:"primary",ghost:!0,size:"small",onClick:()=>q(n.id),disabled:n.sysparam==0||f.value==0},Y(o=r("common.edit"))?o:{default:()=>[o]}),[[L("no-auth"),"sys.white.list.update"]]),e(H,{onPositiveClick:()=>W(n.id)},{default:()=>r("common.confirmDelete"),trigger:()=>{let p;return D(e(I,{type:"error",ghost:!0,size:"small",disabled:n.sysparam==0||f.value==0},Y(p=r("common.delete"))?p:{default:()=>[p]}),[[L("no-auth"),"sys.white.list.delete"]])}})])}}]}),z=()=>{s()},f=X(),g=X(),v=async()=>{const{data:n,error:o}=await Ve();if(!o)f.value=n.whiteenable,g.value=n.id;else return!1};v();const{drawerVisible:b,operateType:U,editingData:y,handleAdd:c,handleEdit:C,checkedRowKeys:l,onBatchDeleted:T,onDeleted:B,closeDrawer:j}=Le(_,s),S=async n=>{var $;const{data:o,error:p}=await Ge({whiteenable:n?1:0,id:g.value});if(!p)($=window.$message)==null||$.success("操作成功"),v();else return!1};async function G(){console.log(l.value),F(l.value.join(","),n=>{T()})}function W(n){console.log(n),F(n,o=>{B()})}function q(n){C(n),Pe({id:n}).then(({data:o,error:p})=>{p||console.log(o)})}async function F(n,o){const{data:p,error:$}=await Ue(n);if(!$)o&&o(p);else return!1}const w=ie.debounce(s,1e3,{leading:!0,trailing:!1});return(n,o)=>{const p=Me,$=J,ce=ge,re=he,ue=fe,de=_e,pe=je,me=se,Q=L("no-auth");return V(),Te("div",Je,[e(Ee,{model:a(N),"onUpdate:model":o[0]||(o[0]=m=>K(N)?N.value=m:null),onReset:a(i),onSearch:a(w)},null,8,["model","onReset","onSearch"]),e(me,{bordered:!1,size:"small",class:"sm:flex-1-hidden"},{header:t(()=>[e($,{align:"center"},{default:t(()=>[Qe,le("div",Xe,[u(" 是否启用白名单"),e(p,{value:f.value,"onUpdate:value":[o[1]||(o[1]=m=>f.value=m),S],"checked-value":1,"unchecked-value":0},{checked:t(()=>[u(" 是 ")]),unchecked:t(()=>[u(" 否 ")]),_:1},8,["value"])])]),_:1})]),"header-extra":t(()=>[e($,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[D((V(),O(a(I),{size:"small",ghost:"",type:"primary",onClick:a(c),disabled:f.value==0},{icon:t(()=>[e(ce,{class:"text-icon"})]),default:t(()=>[u(" "+x(a(r)("common.add")),1)]),_:1},8,["onClick","disabled"])),[[Q,"sys.white.list.insert"]]),D((V(),O(a(H),{onPositiveClick:G},{trigger:t(()=>[e(a(I),{size:"small",ghost:"",type:"error",disabled:a(l).length===0||f.value==0},{icon:t(()=>[e(re,{class:"text-icon"})]),default:t(()=>[u(" "+x(a(r)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:t(()=>[u(" "+x(a(r)("common.confirmDelete")),1)]),_:1})),[[Q,"sys.white.list.delete"]]),e(a(I),{size:"small",onClick:z},{icon:t(()=>[e(ue,{class:Be(["text-icon",{"animate-spin":a(P)}])},null,8,["class"])]),default:t(()=>[u(" "+x(a(r)("common.refresh")),1)]),_:1}),e(de,{columns:a(k),"onUpdate:columns":o[2]||(o[2]=m=>K(k)?k.value=m:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(pe,{"checked-row-keys":a(l),"onUpdate:checkedRowKeys":o[3]||(o[3]=m=>K(l)?l.value=m:null),columns:a(d),data:a(_),size:"small","flex-height":!a(R).isMobile,"scroll-x":962,loading:a(P),remote:"","row-key":m=>m.id,pagination:a(M),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ae,{visible:a(b),"onUpdate:visible":o[4]||(o[4]=m=>K(b)?b.value=m:null),"operate-type":a(U),"row-data":a(y),onSubmitted:a(s)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{ut as default};
