import{_ as il}from"./round-refresh-Bsy-Eh7C.js";import{_ as ol}from"./round-add-CfYkVrv9.js";import{_ as ul}from"./table-column-setting.vue_vue_type_script_setup_true_lang-D0lRqPz4.js";import{_ as dl}from"./round-delete-Dxr52Tdg.js";import{_ as cl}from"./round-search-Digdfr9X.js";import{d as Ct,av as vt,D as K,s as F,A as pl,a as Ee,at as fl,au as zt,c as N,o as R,w as s,f as l,M as St,L as ml,a3 as gl,G as P,h as i,H as Oe,az as Ut,g as p,B as y,b as $t,aA as yl,aB as Rt,J as Dt,aC as At,t as I,$ as D,a4 as Tt,aE as ae,aG as Ge,z as vl,aK as Pe,i as hl,n as f,I as G,a5 as ht,F as j,aQ as wt,aD as wl,aO as bl,aS as bt,ay as _l,a2 as kl,ax as Ll,aL as qe,e as Fl,N as xl,aN as Cl,aT as _t,aU as zl,aR as Sl}from"./index-DCPTYPg6.js";import{h as Ul,i as je,N as $l,v as Rl,c as S,g as at,l as Dl,m as Al,n as Tl,o as Il,s as Nl,t as Bl,q as Pl}from"./maskstr-CXQbeDvN.js";import{u as kt,a as Lt}from"./table-wEqNRbcE.js";import{_ as It}from"./Grid-p0WIMYG_.js";import{_ as Nt}from"./FormItemGridItem-C8JcVRRJ.js";import{h as fe}from"./permission-dOyevU_s.js";import{u as nt}from"./usePageData-BUYwLNSk.js";import{_ as ql}from"./Spin-9RCJl4QO.js";import{_ as Ol}from"./DatePicker-BbdERBWx.js";import{N as Ft}from"./Popconfirm-BQoV-jsN.js";const Gl=["src"],jl=Ct({name:"UpdateSn",__name:"update-sn",props:vt({rowId:{},rowMtype:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:vt(["submitted"],["update:visible"]),setup(Y,{emit:me}){const ge=me,U=Y,a=K(M()),ye=F(100),Z=F(0);function M(){return{id:0,sn:"",fault:"",details:0,accessory:"",returnnum:"",re1:"",re2:"",re3:"",re4:"",re5:"",re6:"",re7:"",rsn:"",rdetails:0,raccessory:"",videoSrc:"",fileList:[],uploadVideoFileList:[],analyzeFileList:[],notes:""}}async function V(){a.videoSrc="",a.fileList=[],a.uploadVideoFileList=[],a.analyzeFileList=[],Object.assign(a,M()),await J()}const{formRef:ne,validate:Me,restoreValidation:Ve}=pl(),A={sn:{validator:(n,r)=>{if(!r||r.trim().length===0)return new Error("请输入设备编号");const g=ze(r);for(const w of g){if(!w||w.trim().length===0)return new Error("存在空的设备编号，请检查输入");if(w==="null"||w==="undefined")return new Error("存在无效的设备编号，请检查输入");if(w.length<9)return new Error("设备编号长度至少 9 位")}return!0},trigger:["input","blur"]},fault:{type:"string",required:!0,trigger:["blur","change"],message:"请输入故障现象"},accessory:{type:"string",required:!1,trigger:["blur","change"],message:"请输入客户寄件配件详情"},raccessory:{type:"string",required:!1,trigger:["blur","change"],message:"请输入寄件配件详情"}},ee=Ee(()=>{const n={sn:A.sn,fault:A.fault};return U.rowMtype===0?(a.details===1?n.accessory={...A.accessory,required:!0}:n.accessory={...A.accessory,required:!1},a.rdetails===1?n.raccessory={...A.raccessory,required:!0}:n.raccessory={...A.raccessory,required:!1}):U.rowMtype===1?a.details===1?n.accessory={...A.accessory,required:!0}:n.accessory={...A.accessory,required:!1}:U.rowMtype===2?(a.details===1?n.accessory={...A.accessory,required:!0}:n.accessory={...A.accessory,required:!1},a.rdetails===1?n.raccessory={...A.raccessory,required:!0}:n.raccessory={...A.raccessory,required:!1}):U.rowMtype===3&&(a.rdetails===1?n.raccessory={...A.raccessory,required:!0}:n.raccessory={...A.raccessory,required:!1}),n});async function J(){const{data:n,error:r}=await Ul({id:U.rowId,_t:new Date().getTime()});r||(Object.assign(a,n),a.rdetails=Number(a.rdetails),n.re1&&a.fileList.push({id:"0",name:"0",url:n.re1,status:"finished"}),n.re2&&a.fileList.push({id:"1",name:"1",url:n.re2,status:"finished"}),n.re3&&a.fileList.push({id:"2",name:"2",url:n.re2,status:"finished"}),n.re4&&(a.videoSrc=n.re4,a.uploadVideoFileList.push({id:"0",name:"0",url:n.re4,status:"finished"})),n.re5&&a.analyzeFileList.push({id:"0",name:"0",url:n.re5,status:"finished"}),n.re6&&a.analyzeFileList.push({id:"1",name:"1",url:n.re6,status:"finished"}),n.re7&&a.analyzeFileList.push({id:"2",name:"2",url:n.re7,status:"finished"}))}const ve=Ee(()=>{if(!a.sn)return[];let n=a.sn.trim();return n===""?[]:(n=n.replace(/，|、/g,","),n[n.length-1]===","&&(n=n.substring(0,n.length-1)),n.split(",").map(r=>r.trim().replace(/\u3000/g,"").trim()).filter(r=>r!==""))}),te=fl(Y,"visible");zt(te,()=>{te.value&&(V(),Ve())});function He(n){let r=n.replace(/，/g,",").replace(/、/g,",").replace(/　/g," ");const g=ze(r),w=r[r.length-1];if(g.length>=ye.value&&w===","){ae(()=>{a.sn=n.substring(0,n.length-1)});return}if(g.length>ye.value){const T=g.slice(0,ye.value).join(", ");ae(()=>{a.sn=T});return}r!==n&&ae(()=>{a.sn=r})}function ze(n){return n?(n=n.trim(),n===""?[]:n.split(",").map(r=>r.trim().replace(/\u3000/g,"").trim()).filter(r=>r!=="")):[]}function Ke(n){var T,L,C,v;const r=["image/jpeg","image/png","image/jpg","image/x-icon"];console.log("data.file.file",n.file.file);const g=r.includes(n.file.file.type),w=n.file.file.size/1024/1024<100;return g||((T=window.$message)==null||T.destroyAll(),(L=window.$message)==null||L.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片")),w||((C=window.$message)==null||C.destroyAll(),(v=window.$message)==null||v.error("上传图片大小不能超过 100MB")),g&&w}async function Je(n){var L,C;const{file:r,onFinish:g,onError:w}=n;new FormData().append("multipartFile",r.file);try{const v=await Ge(r.file,r.name,"aftermarket/image");v&&(r.url=v,g({...r,url:v}),(L=window.$message)==null||L.destroyAll(),(C=window.$message)==null||C.success("上传成功"))}catch(v){w(v)}}function Se(n){var T,L,C,v;const g=["video/mp4","video/avi","video/mov","video/mpeg"].includes(n.file.file.type),w=n.file.file.size/1024/1024<100;return g||((T=window.$message)==null||T.destroyAll(),(L=window.$message)==null||L.error("格式错误，请上传视频！")),w||((C=window.$message)==null||C.destroyAll(),(v=window.$message)==null||v.error("上传视频大小不能超过 100MB！")),g&&w}async function Ue(n){Z.value=0;const{file:r,onFinish:g,onError:w}=n;new FormData().append("multipartFile",r.file);try{const L=await Ge(r.file,r.name,"aftermarket/image/",C=>{Z.value=C});L&&(g({...r,url:L}),a.videoSrc=L,Z.value=0)}catch(L){w(L)}}async function We(n){var L,C;const{file:r,onFinish:g,onError:w}=n;new FormData().append("multipartFile",r.file);try{const v=await Ge(r.file,r.name,"aftermarket/image");v&&(r.url=v,g({...r,url:v}),(L=window.$message)==null||L.destroyAll(),(C=window.$message)==null||C.success("上传成功"))}catch(v){w(v)}}function $e(){te.value=!1}function W(n){return new Promise((r,g)=>{We({file:n,onFinish:()=>r(!0),onError:w=>g(w)})})}function re(n){return new Promise((r,g)=>{Ue({file:n,onFinish:()=>r(!0),onError:w=>g(w)})})}async function Re(){var L,C;await Me();let n=[];await Promise.all([...a.fileList.map(v=>(v.url&&!v.url.startsWith("https://pictures.linkqi.cn")||!v.url)&&W(v)),...a.uploadVideoFileList.map(v=>(v.url&&!v.url.startsWith("https://pictures.linkqi.cn")||!v.url)&&re(v))]);let r=ve.value;for(var g=0;g<r.length;g++)U.rowMtype===0?n.push({id:U.rowId,sn:r[g],details:a.details,accessory:a.accessory,fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null}):U.rowMtype===1?n.push({id:U.rowId,sn:r[g],details:a.details,accessory:a.accessory,fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null}):U.rowMtype===2?n.push({id:U.rowId,sn:r[g],details:a.details,accessory:a.accessory,fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null}):U.rowMtype===3&&n.push({id:U.rowId,sn:r[g],fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null});const{data:w,error:T}=await je(n);T||((L=window.$message)==null||L.destroyAll(),(C=window.$message)==null||C.success("修改成功"),$e(),ge("submitted"))}return(n,r)=>{const g=Nt,w=Ut,T=yl,L=At,C=Dt,v=Rt,he=It,ie=gl,we=St,De=Tt;return R(),N(De,{show:te.value,"onUpdate:show":r[6]||(r[6]=z=>te.value=z),title:"修改",preset:"card",class:"w-60%"},{footer:s(()=>[l(C,{justify:"end",size:16,class:"pr-20px"},{default:s(()=>[l(i(y),{onClick:$e},{default:s(()=>[p(I(i(D)("common.cancel")),1)]),_:1}),l(i(y),{type:"primary",onClick:Re},{default:s(()=>[p(I(i(D)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(we,{ref_key:"formRef",ref:ne,model:a,rules:ee.value,"label-placement":"left","label-width":140,onKeyup:ml(Re,["enter"])},{default:s(()=>[l(ie,{style:{"max-height":"600px"},class:"pr-20px"},{default:s(()=>[l(he,{responsive:"screen","item-responsive":""},{default:s(()=>[l(g,{span:"24 m:24 s:24",label:"设备编号",path:"sn"},{default:s(()=>[l(i(Oe),{clearable:"",value:a.sn,"onUpdate:value":r[0]||(r[0]=z=>a.sn=z),placeholder:"请输入设备编号",disabled:"",onInput:He},null,8,["value"])]),_:1}),l(g,{span:"24 m:24 s:24",label:"故障现象",path:"fault"},{default:s(()=>[l(i(Oe),{type:"textarea",value:a.fault,"onUpdate:value":r[1]||(r[1]=z=>a.fault=z),placeholder:"请输入故障现象",clearable:""},null,8,["value"])]),_:1}),l(g,{span:"24 m:24 s:24",label:"现场照片"},{default:s(()=>[l(w,{multiple:"",max:3,"file-list":a.fileList,"onUpdate:fileList":r[2]||(r[2]=z=>a.fileList=z),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ke,"custom-request":Je},{default:s(()=>r[7]||(r[7]=[p(" 点击上传 ")])),_:1,__:[7]},8,["file-list"])]),_:1}),l(g,{span:"24 m:24 s:24",label:"现场视频"},{default:s(()=>[l(w,{"show-file-list":!a.videoSrc,"file-list":a.uploadVideoFileList,"onUpdate:fileList":r[3]||(r[3]=z=>a.uploadVideoFileList=z),"default-upload":!1,onBeforeUpload:Se,"custom-request":Ue},{default:s(()=>[l(i(y),{type:"primary"},{default:s(()=>r[8]||(r[8]=[p(" 上传视频 ")])),_:1,__:[8]})]),_:1},8,["show-file-list","file-list"])]),_:1}),l(g,{span:"24 m:24 s:24",label:"","label-width":"0"},{default:s(()=>[Z.value&&!a.videoSrc?(R(),N(T,{key:0,type:"line",percentage:Z.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):P("",!0),a.videoSrc?(R(),$t("video",{key:1,src:a.videoSrc,autoplay:"",style:{width:"100%"}},null,8,Gl)):P("",!0)]),_:1}),U.rowMtype!==3?(R(),N(g,{key:0,span:"24 m:24 s:24",label:"客户寄件类型"},{default:s(()=>[l(v,{value:a.details,"onUpdate:value":r[4]||(r[4]=z=>a.details=z),name:"radiogroup"},{default:s(()=>[l(C,null,{default:s(()=>[l(L,{value:0},{default:s(()=>r[9]||(r[9]=[p("仅裸机")])),_:1,__:[9]}),l(L,{value:1},{default:s(()=>r[10]||(r[10]=[p("含配件")])),_:1,__:[10]})]),_:1})]),_:1},8,["value"])]),_:1})):P("",!0),a.details==1&&U.rowMtype!==3?(R(),N(g,{key:1,span:"24 m:24 s:24",label:"客户寄件配件详情",path:"accessory"},{default:s(()=>[l(i(Oe),{value:a.accessory,"onUpdate:value":r[5]||(r[5]=z=>a.accessory=z),placeholder:"请输入客户寄件配件详情",clearable:""},null,8,["value"])]),_:1})):P("",!0)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show"])}}}),El={class:"gap-16px overflow-auto lt-sm:overflow-auto"};function xt(Y){return typeof Y=="function"||Object.prototype.toString.call(Y)==="[object Object]"&&!Sl(Y)}const ns=Ct({name:"aftersales_aftersalesdevice",__name:"index",setup(Y){const me=vl(),ge=F(!1),U=F(0),a=F([]),ye=K([{label:"已受理",value:0},{label:"分析中",value:1},{label:"维修中",value:2},{label:"维修完成",value:3},{label:"待客户收件",value:4},{label:"处理完毕",value:5}]),Z={当日:()=>{const e=new Date().getTime();return[e,e]},本周:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*7,e]},上月:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*30,e]},近一年:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*365,e]},近三年:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*365*3,e]}},M=F([]),{pageData:V,getData:ne,nextPage:Me}=nt(Il),Ve=async e=>{const t=e.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&V.data.length<V.total&&(await Me(),M.value=V.data,await ae(),setTimeout(()=>{t.scrollTop=c}))},A=async()=>{await ne({page:1,limit:100,_t:new Date().getTime()}),M.value=V.data};nt(zl);const ee=F([]),{pageData:J,getData:ve,nextPage:te}=nt(Nl),He=async()=>{await ve(),ee.value=J.data.map(e=>({label:e,value:e}))},ze=async e=>{const t=e.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&J.data.length<J.total&&(await te(),await ae(),ee.value=J.data.map(b=>({label:b,value:b})),setTimeout(()=>{t.scrollTop=c}))},Ke=Pe.debounce(async e=>{await ve({fuzzy:e,page:1}),ee.value=J.data.map(t=>({label:t,value:t}))},300),Je=e=>{if(k.gws=null,W.value=!0,re.value=!1,!e){Se();return}Ke(e)},Se=()=>{k.gws=null,$()},Ue=Pe.debounce(e=>{var t;k.gws1=e||void 0,k.gws=(t=k.gws1)==null?void 0:t.join(","),$()},300),We=async()=>{W.value&&!re.value&&(await ve({page:1}),ee.value=J.data.map(e=>({label:e,value:e})),W.value=!1)},$e=Pe.debounce(async e=>{await ne({fuzzy:e,page:1}),M.value=V.data},300),W=F(!1),re=F(!1),Re=e=>{if(k.cid=null,W.value=!0,re.value=!1,!e){r();return}$e(e)},n=async()=>{W.value&&!re.value&&(await ne({page:1}),M.value=V.data,W.value=!1)},r=async()=>{await ne({page:1}),M.value=V.data};async function g(e,t){if(!e){k.startTime=void 0,k.endTime=void 0,$();return}k.startTime=String(_t(1,t[0])),k.endTime=String(_t(1,t[1])),$()}const w=async e=>{k.cid=e,$()},T=()=>{k.sn=null,$()},L=Pe.debounce(e=>{k.sn=e||void 0,$()},300),C=()=>{k.status=null,$()},v=e=>{k.status=e,$()};hl(async()=>{await A(),await $(),await He()});const he=F(!1),ie=K({id:0,mtype:0}),we=F(!1),De=F([{key:"responsibleperson",title:()=>f("div",{class:"cursor-pointer select-none"},[f(y,{text:!0,onClick:rt,class:"position-absolute left--15px top-50% translate-y--50%",circle:!0},{default:()=>l(y,{type:"primary",circle:!0},{default:()=>[">"]})}),f("span",null,"售后处理")]),align:"center",resizable:!0,fixed:"right",width:160,render:e=>le&&l("div",{class:"flex-center gap-8px"},[l(ht,{trigger:"hover","onUpdate:show":t=>{t&&ae(async()=>{we.value=!0,be.value=[],ue.aid=e.id,Q(),setTimeout(()=>{we.value=!1},1e3)})}},{trigger:()=>G(l(y,{type:"primary",ghost:!0,size:"small",onClick:()=>Zt(e,"option")},{default:()=>["查看"+(e.rescount>0?`(${e.rescount})`:"")]}),[[j("no-auth"),"aftermarketRes:select:permission.do"]]),default:()=>l("div",{style:{padding:"8px"}},[be.value.length>0?be.value.map(t=>l("div",{key:t.id,style:{marginBottom:"4px"}},[p("责任人："),t.username,p(" "),l("br",null,null),p("原因分析："),t.reason,p(" "),l("br",null,null),p("处理意见："),t.resolution,p(" "),l("br",null,null),p("改进措施："),t.improvement])):we.value?l(ql,{size:"large"},null):"暂无数据"])}),G(l(y,{type:"primary",ghost:!0,size:"small",onClick:()=>tt(e,"add")},{default:()=>[p("添加")]}),[[j("no-auth"),"aftermarketRes:insert:permission.do"]])])},{key:"operate",title:D("common.operate"),align:"center",width:220,fixed:"right",render:e=>le&&l("div",{class:"flex-center gap-8px"},[G(l(y,{type:"primary",ghost:!0,size:"small",onClick:()=>pt(e.id,e.notes,"sn")},{default:()=>["修改备注"]}),[[j("no-auth"),"aftermarket:update:permission.do"]]),G(l(y,{type:"primary",ghost:!0,size:"small",onClick:()=>tl(e.id,e.mtype)},{default:()=>["修改"]}),[[j("no-auth"),"aftermarket:update:permission.do"]]),l(Ft,{onPositiveClick:()=>mt(e.id)},{default:()=>D("common.confirmDelete"),trigger:()=>{let t;return G(l(y,{type:"error",ghost:!0,size:"small"},xt(t=D("common.delete"))?t:{default:()=>[t]}),[[j("no-auth"),"aftermarket:delete:permission.do"]])}})])}]),z=F([{type:"selection",align:"center",width:48,fixed:"left",resizable:!0},{key:"comp",title:"客户公司名称",align:"center",width:220,resizable:!0,ellipsis:{tooltip:!0}},{key:"sn",title:"客户设备信息",width:240,titleAlign:"center",ellipsis:{tooltip:!0},resizable:!0,render:e=>l("div",{class:"flex flex-col items-start justify-start gap-1"},[l("div",{class:"w-full truncate",title:`设备编号：${e.sn}`},[p("设备编号："),e.sn?e.rsn?e.rsn==e.sn||e.rsn.includes("无")?e.sn:l("span",null,[e.sn,p(" ("),l("span",{style:"color: red; font-weight: bold;"},[p("更换")]),p(")")]):e.sn:"--"]),l("div",{class:"w-full truncate",title:`设备型号：${e.model||"--"}`},[p("设备型号："),e.model||"--"])])},{key:"fault",title:"故障现象",align:"center",width:220,resizable:!0,ellipsis:{tooltip:!0}},{key:"re1",title:"现场照片",align:"center",width:300,resizable:!0,render:e=>l("div",{class:"flex items-center justify-center gap-4px"},[e.re1||e.re2||e.re3?l("div",{style:{cursor:"pointer"},onClick:()=>ut([e.re1,e.re2,e.re3].filter(t=>t),0)},[l(wt,{width:70,src:e.re1||e.re2||e.re3,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)]):null])},{key:"re4",title:"现场视频",align:"center",width:300,resizable:!0,render:e=>l("div",{class:"flex items-center justify-center gap-4px"},[e.re4?l("video",{src:e.re4,style:{height:"70px",width:"100%",cursor:"pointer",objectFit:"cover"},onClick:()=>Et(e.re4)},null):null])},{key:"status",align:"center",width:120,resizable:!0,title:()=>f("div",{class:"flex flex-col items-center justify-center"},[f("span","当前状态"),f("span",{style:"font-size: 11px; color: #FF0000; margin-top: 2px;"},"悬浮查看详情")]),render:e=>{const t=()=>{const{status:c}=e;return e.mtype===0?[f(S,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),f(S,{type:c>=1?"success":"default",time:e.redbtime},{default:()=>["分析中",e.receipt&&f("span",{style:{marginLeft:"5px"}},["(寄出单号: ",f("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.receipt)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.receipt),")"])]}),f(S,{type:c>=2?"success":"default"},{default:()=>"维修中"}),f(S,{type:c>=3?"success":"default"},{default:()=>"维修完成"}),f(S,{type:c>=4?"success":"default"},{default:()=>"待客户收件"}),f(S,{type:c>=5?"success":"default",time:e.rdbtime},{default:()=>["处理完毕",e.returnnum&&f("span",{style:{marginLeft:"5px"}},["(寄出单号: ",f("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.returnnum)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.returnnum),")"])]})]:e.mtype===1?[f(S,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),f(S,{type:c>=1?"success":"default",time:e.return_time||e.complete_time},{default:()=>"处理完毕"})]:e.mtype===2?[f(S,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),f(S,{type:c>=1?"success":"default"},{default:()=>"待客户收件"}),f(S,{type:c>=2?"success":"default"},{default:()=>"待我司收件"}),f(S,{type:c>=3?"success":"default",time:e.return_time||e.complete_time},{default:()=>"处理完毕"})]:e.mtype===3?[f(S,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),f(S,{type:c>=1?"success":"default"},{default:()=>"待客户收件"}),f(S,{type:c>=2?"success":"default",time:e.return_time||e.complete_time},{default:()=>"处理完毕"})]:[f(S,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),f(S,{type:c>=1?"success":"default",time:e.redbtime},{default:()=>["分析中",e.receipt&&f("span",{style:{marginLeft:"5px"}},["(寄出单号: ",f("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.receipt)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.receipt),")"])]}),f(S,{type:c>=2?"success":"default"},{default:()=>"维修中"}),f(S,{type:c>=3?"success":"default"},{default:()=>"维修完成"}),f(S,{type:c>=4?"success":"default"},{default:()=>"待客户收件"}),f(S,{type:c>=5?"success":"default",time:e.rdbtime},{default:()=>["处理完毕",e.returnnum&&f("span",{style:{marginLeft:"5px"}},["(寄出单号: ",f("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.returnnum)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.returnnum),")"])]})]};return f(ht,{placement:"top",style:{maxWidth:"450px"}},{trigger:()=>f(wl,{type:"primary",style:{cursor:"pointer"}},{default:()=>ft(e.mtype,e.status)}),default:()=>f("div",{class:"custom-timeline",style:{padding:"12px"}},[f("p",{style:{marginBottom:"12px",fontWeight:"bold"}},[f("strong",null,"当前状态："),ft(e.mtype,e.status)]),f($l,null,{default:()=>t()})])})}},{key:"returnnum",title:"物流信息",align:"center",width:220,resizable:!0,titleAlign:"center",ellipsis:{tooltip:!0},render:e=>l("div",{class:"flex flex-col items-start justify-start gap-1"},[e.returnnum&&e.mtype!==1&&l("div",{class:"flex items-center gap-4px"},[Rl(e.returnnum)?l("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.returnnum)}`,target:"_blank",style:"color: #4169E1;"},[e.returnnum||"--"]):l("span",null,[e.returnnum||"--"]),l(bl,{trigger:"hover",placement:"right"},{trigger:()=>G(l(y,{text:!0,type:"primary",onClick:()=>dt(e.id,e,"returnnum")},{default:()=>[l("span",{class:"akar-icons--edit"},null)]}),[[j("no-auth"),"aftermarket:update:permission.do"]]),default:()=>D("common.update")})]),e.returnnum&&l("div",null,[`时间：${e.rdbtime?e.rdbtime:""}`]),e.returnnum&&l("div",null,[`寄件类型：${e.rdetails==0?"仅裸机":e.raccessory?"含配件("+e.raccessory+")":"未知"}`]),!e.returnnum&&G(l(y,{text:!0,type:"primary",onClick:()=>dt(e.id,null,"returnnum")},{default:()=>["填写"]}),[[j("no-auth"),"aftermarket:update:permission.do"]])])},{key:"re8",title:"分析照片",align:"center",width:300,resizable:!0,render:e=>l("div",{class:"flex items-center justify-center gap-4px"},[e.re5||e.re6||e.re7?l("div",{style:{cursor:"pointer"},onClick:()=>ut([e.re5||e.re6||e.re7].filter(t=>t),0)},[l(wt,{width:70,src:e.re5||e.re6||e.re7,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)]):null,l("div",null,[!e.re5&&!e.re6&&!e.re7&&G(l(y,{size:"small",type:"primary",onClick:()=>ct(e,"analyze")},{default:()=>[p("点击上传")]}),[[j("no-auth"),"aftermarket:update:permission.do"]]),(e.re5||e.re6||e.re7)&&G(l(y,{size:"small",type:"primary",onClick:()=>ct(e,"analyze"),style:{marginLeft:"5px"}},{default:()=>[p("编辑图片")]}),[[j("no-auth"),"aftermarket:update:permission.do"]])])])},{key:"rsn",title:"设备信息",width:200,resizable:!0,titleAlign:"center",ellipsis:{tooltip:!0},render:e=>l("div",{class:"flex flex-col items-start justify-start gap-1"},[l("div",{class:"w-full truncate",title:`设备编号：${e.rsn||"--"}`},[p("设备编号："),e.rsn||"--"]),l("div",{class:"w-full truncate",title:`设备型号：${e.rmodel||"--"}`},[p("设备型号："),e.rmodel||"--"])])},{key:"notes",title:"备注",align:"center",width:180,resizable:!0,ellipsis:{tooltip:!0},render:e=>l("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[e.notes?l("div",{class:"w-full truncate",title:`${e.notes}`},[e.notes]):G(l(y,{text:!0,type:"primary",size:"small",onClick:()=>pt(e.id,"","sn")},{default:()=>[p("填写")]}),[[j("no-auth"),"aftermarket:update:permission.do"]])])},{key:"duration",title:"处理时长",align:"center",width:180,resizable:!0,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:180,resizable:!0,ellipsis:{tooltip:!0}},{key:"ckdbtime",title:"审核时间",align:"center",width:180,resizable:!0,ellipsis:{tooltip:!0}}]),le=F(bt.get("afterSalesDeviceHandleColsVisible")==="true"),rt=()=>{le.value=!le.value,bt.set("afterSalesDeviceHandleColsVisible",le.value.toString())};zt(le,e=>{e?ae(()=>{z.value=[...z.value,...De.value]}):z.value=z.value.filter(t=>!De.value.find(c=>c.key===t.key))},{immediate:!0});const Bt=Ee(()=>z.value.reduce((e,t)=>e+(t.width||100),0)),{columnChecks:Qe,data:it,getData:$,loading:Pt,mobilePagination:qt,searchParams:k}=kt({showTotal:!0,immediate:!1,apiFn:Bl,apiParams:{page:1,pageSize:20,limit:20,cid:null,gws:void 0,gws1:[],sn:null,status:null,uid:null,dbtime:null,startAndTimeRange:null,startTime:null,endTime:null,_t:new Date().getTime()},columns:()=>z.value}),{checkedRowKeys:oe}=Lt(it,$),{columns:Ot,columnChecks:Xe,data:be,getData:Q,loading:Gt,mobilePagination:Ae,searchParams:ue}=kt({showTotal:!0,immediate:!1,apiFn:Pl,apiParams:{page:1,pageSize:20,limit:20,aid:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"username",title:"责任人",width:200,align:"center",ellipsis:{tooltip:!0}},{key:"reason",title:"原因分析",align:"center",width:300,ellipsis:{tooltip:!0}},{key:"resolution",title:"处理意见",align:"center",width:300,ellipsis:{tooltip:!0}},{key:"improvement",title:"改进措施",align:"center",width:300,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:160},{key:"operate",title:D("common.operate"),align:"center",width:160,fixed:"right",render:e=>l("div",{class:"flex-center gap-8px"},[G(l(y,{type:"primary",ghost:!0,size:"small",onClick:()=>tt(e,"edit")},{default:()=>["修改"]}),[[j("no-auth"),"aftermarketRes:update:permission.do"]]),l(Ft,{onPositiveClick:()=>gt(e.id)},{default:()=>D("common.confirmDelete"),trigger:()=>{let t;return G(l(y,{type:"error",ghost:!0,size:"small"},xt(t=D("common.delete"))?t:{default:()=>[t]}),[[j("no-auth"),"aftermarketRes:delete:permission.do"]])}})])}]}),{checkedRowKeys:_e}=Lt(be,Q),ot=F(null),de=F(!1),u=K({id:0,type:"",returnOrder:"",returnOrderType:1,rsn:"",rdetails:0,raccessory:""}),ke={rsn:{required:!1,trigger:["blur","change"],message:"请输入寄出设备编号"},raccessory:{required:!1,trigger:["blur","change"],message:""}},jt=Ee(()=>{const e={};return u.type==="receipt"&&(e.returnOrder={...ke.rsn,message:u.type==="receipt"?"请输入客户寄出信息":"请输入寄出信息"}),u.type==="returnnum"?e.rsn=[{...ke.rsn,required:!0},{min:9,trigger:["blur","change"],message:"寄出设备编号长度至少 9 位"}]:e.raccessory={...ke.raccessory,required:!1},u.rdetails===1?e.raccessory={...ke.raccessory,required:!0,message:u.type==="returnnum"?"请输出寄出配件详情":"请输入寄件配件详情"}:e.raccessory={...ke.raccessory,required:!1,message:u.type==="returnnum"?"请输出寄出配件详情":"请输入寄件配件详情"},e});function Et(e){window.open(e,"_blank")}const ut=(e,t=0)=>{a.value=e,U.value=t,ge.value=!0},Mt=e=>{U.value=e};function dt(e,t,c){u.type=c,u.returnOrder=t?t.returnnum:"",u.returnOrderType=t&&t.returnnum.includes("无")?2:1,u.id=e,u.rsn=t&&t.hasOwnProperty("rsn")?t.rsn:"",u.rdetails=t&&t.hasOwnProperty("rdetails")?Number(t.rdetails):0,u.raccessory=t&&t.hasOwnProperty("raccessory")?t.raccessory:"",de.value=!0}function Vt(){de.value=!1,u.id=0,u.type="",u.returnOrder="",u.returnOrderType=1,u.rsn="",u.rdetails=0,u.raccessory=""}async function Ht(){var t,c,b,h;await ot.value.validate();let e=u.type=="receipt"?u.rdetails===0?[{id:u.id,receipt:u.returnOrder,details:u.rdetails}]:[{id:u.id,receipt:u.returnOrder,details:u.rdetails,accessory:u.raccessory}]:u.rdetails===0?[{id:u.id,returnnum:u.returnOrder,rsn:u.rsn,rdetails:u.rdetails}]:[{id:u.id,returnnum:u.returnOrder,rsn:u.rsn,rdetails:u.rdetails,raccessory:u.raccessory}];if(u.type=="receipt"){const{data:x,error:_}=await at(e);_||((t=window.$message)==null||t.destroyAll(),(c=window.$message)==null||c.success(x.msg||"操作成功"),de.value=!1,u.type="",u.returnOrder="",u.id=0)}else{const{data:x,error:_}=await je(e);_||((b=window.$message)==null||b.destroyAll(),(h=window.$message)==null||h.success(x.msg||"操作成功"),$(),de.value=!1,u.type="",u.returnOrder="",u.id=0)}}const ce=F(!1),o=K({id:0,type:"",sendFileList:[],receiveFileList:[],analyzeFileList:[]}),Te=F(!1),q=K({id:0,type:"",notes:""}),Kt=F(!1),Ye=K({id:[],type:"",password:""}),Ie=F(!1),se=F(!1),m=K({id:0,uid:0,aid:0,type:"add",username:"",sn:"",reason:"",resolution:"",improvement:""}),Jt=F(""),Le=F(!1),Ne=K({aid:null,uid:null,sn:""});function ct(e,t){o.sendFileList=[],o.receiveFileList=[],o.analyzeFileList=[],o.id=e.id,o.type=t,e.re5&&o.analyzeFileList.push({id:"0",name:"0",url:e.re5,status:"finished"}),e.re6&&o.analyzeFileList.push({id:"1",name:"1",url:e.re6,status:"finished"}),e.re7&&o.analyzeFileList.push({id:"2",name:"2",url:e.re7,status:"finished"}),ce.value=!0}function Ze(e){var h,x,_,E;const t=["image/jpeg","image/png","image/jpg","image/x-icon"];console.log("data.file.file",e.file.file);const c=t.includes(e.file.file.type),b=e.file.file.size/1024/1024<100;return c||((h=window.$message)==null||h.destroyAll(),(x=window.$message)==null||x.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片")),b||((_=window.$message)==null||_.destroyAll(),(E=window.$message)==null||E.error("上传图片大小不能超过 100MB")),c&&b}async function Be(e){var h,x;const{file:t,onFinish:c,onError:b}=e;if(!t.file)return c({...t});try{const _=await Ge(t.file,t.name,"aftermarket/image");_&&(t.url=_,c({...t,url:_}),(h=window.$message)==null||h.destroyAll(),(x=window.$message)==null||x.success("上传成功"))}catch(_){b(_)}}function Wt(){ce.value=!1,o.sendFileList=[],o.receiveFileList=[],o.analyzeFileList=[]}function Qt(e){return new Promise((t,c)=>{Be({file:e,onFinish:()=>t(!0),onError:b=>c(b)})})}async function Xt(){var h,x,_,E,O,Fe,X,xe;let e=[{id:o.id}];const t=o.type==="customer"?o.sendFileList:o.type==="company"?o.receiveFileList:o.analyzeFileList;if(await Promise.all([...t.map(B=>Qt(B))]),t.some(B=>B.url&&B.url.startsWith("blob:"))){(h=window.$message)==null||h.destroyAll(),(x=window.$message)==null||x.warning("还有文件正在上传或上传失败，请稍后提交");return}if(t.some(B=>!B.url||B.url.trim()==="")){(_=window.$message)==null||_.destroyAll(),(E=window.$message)==null||E.warning("存在上传失败的文件，请重新上传");return}if(o.type==="customer"?(o.sendFileList.length==0&&(e[0].re1="",e[0].re2="",e[0].re3=""),o.sendFileList.length==1&&(e[0].re1=o.sendFileList[0].url,e[0].re2="",e[0].re3=""),o.sendFileList.length==2&&(e[0].re1=o.sendFileList[0].url,e[0].re2=o.sendFileList[1].url,e[0].re3=""),o.sendFileList.length==3&&(e[0].re1=o.sendFileList[0].url,e[0].re2=o.sendFileList[1].url,e[0].re3=o.sendFileList[2].url)):o.type==="company"?(o.receiveFileList.length==0&&(e[0].re4="",e[0].re5="",e[0].re6=""),o.receiveFileList.length==1&&(e[0].re4=o.receiveFileList[0].url,e[0].re5="",e[0].re6=""),o.receiveFileList.length==2&&(e[0].re4=o.receiveFileList[0].url,e[0].re5=o.receiveFileList[1].url,e[0].re6=""),o.receiveFileList.length==3&&(e[0].re4=o.receiveFileList[0].url,e[0].re5=o.receiveFileList[1].url,e[0].re6=o.receiveFileList[2].url)):(o.analyzeFileList.length==0&&(e[0].re5="",e[0].re6="",e[0].re7=""),o.analyzeFileList.length==1&&(e[0].re5=o.analyzeFileList[0].url,e[0].re6="",e[0].re7=""),o.analyzeFileList.length==2&&(e[0].re5=o.analyzeFileList[0].url,e[0].re6=o.analyzeFileList[1].url,e[0].re7=""),o.analyzeFileList.length==3&&(e[0].re5=o.analyzeFileList[0].url,e[0].re6=o.analyzeFileList[1].url,e[0].re7=o.analyzeFileList[2].url)),o.type==="customer"||o.type==="company"){const{data:B,error:pe}=await at(e);pe||((O=window.$message)==null||O.destroyAll(),(Fe=window.$message)==null||Fe.success(B.msg||"操作成功"),ce.value=!1,o.id=0,o.sendFileList=[],o.receiveFileList=[])}else{const{data:B,error:pe}=await je(e);pe||((X=window.$message)==null||X.destroyAll(),(xe=window.$message)==null||xe.success(B.msg||"操作成功"),$(),ce.value=!1,o.id=0,o.analyzeFileList=[])}}function pt(e,t,c){q.id=e,q.notes=t,q.type=c,Te.value=!0}function et(){Te.value=!1,q.id=0,q.notes="",q.type=""}async function Yt(){var b,h;if(!q.notes){(b=window.$message)==null||b.destroyAll(),(h=window.$message)==null||h.error("请输入备注");return}const{id:e,notes:t,type:c}=q;if(c==="comp"){const{data:x,error:_}=await at([{id:e,notes:t}]);_||et()}else{const{data:x,error:_}=await je([{id:e,notes:t}]);_||(et(),$())}}const ft=(e,t)=>e===0?t===0?"已受理":t===1?"分析中":t===2?"维修中":t===3?" 维修完成":t===4?"待客户收件":t===5?"处理完毕":"未知":e===1?t===0?"已受理":t===5?"处理完毕":"未知":e===2?t===0?"已受理":t===1?"待客户收件":t===2?"待我司收件":t===5?"处理完毕":"未知":e===3?t===0?"已受理":t===1?"待客户收件":t===5?"处理完毕":"未知":t===0?"已受理":t===1?"分析中":t===2?"维修中":t===3?"维修完成":t===4?"待客户收件":t===5?"处理完毕":"未知";function mt(e){Ye.id=e?[e]:oe.value,Ye.type="deleteSn",Ye.password="",Kt.value=!0}function Zt(e,t){Jt.value=t,Ne.aid=e.id,Ne.uid="",Le.value=!0,ue.page=1,ue.aid=e.id,Q()}function tt(e,t){console.log("row",e),se.value=!1,m.type=t,t==="edit"?(m.uid=e.uid,m.username=e.username,m.aid=e.aid,m.id=e.id,m.reason=e.reason,m.resolution=e.resolution,m.improvement=e.improvement):(m.uid=Number(me.userInfo.id),m.username=me.userInfo.username,m.aid=e.id,m.id=0,m.reason="",m.resolution="",m.improvement=""),Ie.value=!0}function lt(){Ie.value=!1,se.value=!1,m.id=0,m.username="",m.reason="",m.resolution="",m.improvement=""}async function el(){var t,c,b,h;let e=[{aid:m.aid,uid:me.userInfo.id,reason:m.reason,resolution:m.resolution,improvement:m.improvement}];if(se.value=!0,m.id){e[0].id=m.id;const{data:x,error:_}=await Dl(e);_?se.value=!1:(se.value=!1,(t=window.$message)==null||t.destroyAll(),(c=window.$message)==null||c.success(x.msg||"操作成功"),lt(),Le.value&&(Ae.value.page=1,ue.aid=m.aid,Q()),$())}else{const{data:x,error:_}=await Al(e);_?se.value=!1:(se.value=!1,(b=window.$message)==null||b.destroyAll(),(h=window.$message)==null||h.success(x.msg||"操作成功"),lt(),Le.value&&(Ae.value.page=1,ue.aid=m.aid,Q()),$())}}async function gt(e){var h,x,_,E;let t={};if(e)t.arrIds=[e];else{if(_e.value.length===0)return(h=window.$message)==null||h.destroyAll(),(x=window.$message)==null||x.error("请选择要删除的数据"),!1;t.arrIds=_e.value}const{data:c,error:b}=await Tl(t.arrIds);if(!b)(_=window.$message)==null||_.destroyAll(),(E=window.$message)==null||E.success(c.msg||"操作成功"),Ae.value.page=1,ue.aid=m.aid,Q(),$();else return!1}const tl=(e,t)=>{ie.id=e,ie.mtype=t,he.value=!0},ll=F(window.innerHeight-420);return(e,t)=>{const c=_l,b=Nt,h=Oe,x=Ol,_=cl,E=dl,O=Dt,Fe=It,X=St,xe=kl,B=ul,pe=Ll,H=xl,yt=At,sl=Rt,Ce=Tt,st=Ut,al=ol,nl=il,rl=Cl;return R(),$t("div",El,[l(xe,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[l(X,{ref:"formRef",model:i(k),"label-placement":"left","label-width":100,"show-feedback":!1},{default:s(()=>[l(Fe,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[l(b,{span:"24 s:12 m:6",label:"客户公司",path:"status"},{default:s(()=>[l(c,{filterable:"",clearable:"",value:i(k).cid,"onUpdate:value":[t[0]||(t[0]=d=>i(k).cid=d),w],placeholder:"请选择客户公司","label-field":"comp","value-field":"id",onClear:r,onSearch:Re,onBlur:n,options:M.value,onScroll:Ve},null,8,["value","options"])]),_:1}),l(b,{span:"24 s:12 m:6",label:"设备编号",path:"sn"},{default:s(()=>[l(h,{clearable:"",value:i(k).sn,"onUpdate:value":[t[1]||(t[1]=d=>i(k).sn=d),i(L)],onClear:T,placeholder:"请输入设备编号"},null,8,["value","onUpdate:value"])]),_:1}),l(b,{span:"24 s:12 m:6",label:"网关型号",path:"gws1"},{default:s(()=>[l(c,{clearable:"",filterable:"",multiple:"",value:i(k).gws1,"onUpdate:value":[t[2]||(t[2]=d=>i(k).gws1=d),i(Ue)],placeholder:"请选择网关型号","label-field":"label","value-field":"value",options:ee.value,onSearch:Je,onBlur:We,onScroll:ze,onClear:Se},null,8,["value","options","onUpdate:value"])]),_:1}),l(b,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:s(()=>[l(c,{clearable:"",filterable:"",value:i(k).status,"onUpdate:value":[t[3]||(t[3]=d=>i(k).status=d),v],placeholder:"请选择状态","label-field":"label","value-field":"value",options:ye,onClear:C},null,8,["value","options"])]),_:1}),l(b,{span:"24 s:12 m:8",label:"起止时间"},{default:s(()=>[l(x,{value:i(k).startAndTimeRange,"onUpdate:value":t[4]||(t[4]=d=>i(k).startAndTimeRange=d),type:"datetimerange",clearable:"",shortcuts:Z,"onUpdate:formattedValue":g},null,8,["value"])]),_:1}),l(b,{span:"24 s:12 m:5"},{default:s(()=>[l(O,{class:"w-full"},{default:s(()=>[i(fe)("aftermarket:select:permission.do")?(R(),N(i(y),{key:0,ghost:"",onClick:i($)},{icon:s(()=>[l(_,{class:"text-icon"})]),default:s(()=>[t[31]||(t[31]=p(" "+I("查询")))]),_:1,__:[31]},8,["onClick"])):P("",!0),i(fe)("aftermarket:delete:permission.do")?(R(),N(i(y),{key:1,type:"error",disabled:i(oe).length===0,onClick:mt},{icon:s(()=>[l(E,{class:"text-icon"})]),default:s(()=>[t[32]||(t[32]=p(" "+I("批量删除")))]),_:1,__:[32]},8,["disabled"])):P("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(xe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:s(()=>[l(O,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:s(()=>t[33]||(t[33]=[Fl("div",null,"售后设备",-1)])),_:1,__:[33]})]),"header-extra":s(()=>[l(O,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[l(B,{columns:i(Qe),"onUpdate:columns":t[5]||(t[5]=d=>qe(Qe)?Qe.value=d:null),ctype:4},null,8,["columns"])]),_:1})]),default:s(()=>[l(pe,{"checked-row-keys":i(oe),"onUpdate:checkedRowKeys":t[6]||(t[6]=d=>qe(oe)?oe.value=d:null),columns:z.value,data:i(it),size:"small",loading:i(Pt),remote:"","max-height":ll.value,"scroll-x":Bt.value,"row-key":d=>d.id,pagination:i(qt),class:"sm:h-full",striped:""},null,8,["checked-row-keys","columns","data","loading","max-height","scroll-x","row-key","pagination"]),le.value?P("",!0):(R(),N(i(y),{key:0,type:"primary",circle:"",class:"position-absolute top-65px right-5px z-40",onClick:rt},{default:s(()=>t[34]||(t[34]=[p(" < ")])),_:1,__:[34]}))]),_:1}),l(Ce,{show:de.value,"onUpdate:show":t[11]||(t[11]=d=>de.value=d),title:u.type==="receipt"?"填写客户寄出信息":"填写寄出信息",preset:"card",class:"w-800px"},{footer:s(()=>[l(O,{justify:"end"},{default:s(()=>[l(i(y),{size:"small",class:"mt-16px",onClick:Vt},{default:s(()=>[p(I(i(D)("common.cancel")),1)]),_:1}),l(i(y),{type:"primary",size:"small",class:"mt-16px",onClick:Ht},{default:s(()=>[p(I(i(D)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(X,{ref_key:"returnOrderFormRef",ref:ot,rules:jt.value,model:u,"label-placement":"left"},{default:s(()=>[l(H,{label:u.type==="receipt"?"客户寄出信息":"寄出信息",path:"returnOrder",required:""},{default:s(()=>[l(h,{value:u.returnOrder,"onUpdate:value":t[7]||(t[7]=d=>u.returnOrder=d),placeholder:u.type==="receipt"?"请输入客户寄出信息":"请输入寄出信息",clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),u.type==="returnnum"?(R(),N(H,{key:0,label:"寄出设备编号",path:"rsn"},{default:s(()=>[l(h,{value:u.rsn,"onUpdate:value":t[8]||(t[8]=d=>u.rsn=d),placeholder:"请输入寄出设备编号",clearable:""},null,8,["value"])]),_:1})):P("",!0),l(H,{label:(u.type==="returnnum","寄件类型"),path:"rdetails"},{default:s(()=>[l(sl,{value:u.rdetails,"onUpdate:value":t[9]||(t[9]=d=>u.rdetails=d)},{default:s(()=>[l(O,null,{default:s(()=>[l(yt,{value:0},{default:s(()=>t[35]||(t[35]=[p("仅裸机")])),_:1,__:[35]}),l(yt,{value:1},{default:s(()=>t[36]||(t[36]=[p("含配件")])),_:1,__:[36]})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),u.rdetails===1?(R(),N(H,{key:1,required:"",label:u.type==="returnnum"?"寄出配件详情":"寄件配件详情",path:"raccessory"},{default:s(()=>[l(h,{value:u.raccessory,"onUpdate:value":t[10]||(t[10]=d=>u.raccessory=d),placeholder:u.type==="returnnum"?"请输出寄出配件详情":"请输入寄件配件详情",clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])):P("",!0)]),_:1},8,["rules","model"])]),_:1},8,["show","title"]),l(Ce,{show:ce.value,"onUpdate:show":t[15]||(t[15]=d=>ce.value=d),title:o.type==="customer"?"客户寄出照片上传":o.type==="company"?"寄出照片上传":"分析照片上传",preset:"card",class:"w-800px"},{footer:s(()=>[l(O,{justify:"end"},{default:s(()=>[l(i(y),{size:"small",class:"mt-16px",onClick:Wt},{default:s(()=>[p(I(i(D)("common.cancel")),1)]),_:1}),l(i(y),{type:"primary",size:"small",class:"mt-16px",onClick:Xt},{default:s(()=>[p(I(i(D)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[o.type==="customer"?(R(),N(st,{key:0,multiple:"",max:3,"file-list":o.sendFileList,"onUpdate:fileList":t[12]||(t[12]=d=>o.sendFileList=d),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ze,"custom-request":Be},{default:s(()=>t[37]||(t[37]=[p(" 点击上传 ")])),_:1,__:[37]},8,["file-list"])):o.type==="company"?(R(),N(st,{key:1,multiple:"",max:3,"file-list":o.receiveFileList,"onUpdate:fileList":t[13]||(t[13]=d=>o.receiveFileList=d),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ze,"custom-request":Be},{default:s(()=>t[38]||(t[38]=[p(" 点击上传 ")])),_:1,__:[38]},8,["file-list"])):(R(),N(st,{key:2,multiple:"",max:3,"file-list":o.analyzeFileList,"onUpdate:fileList":t[14]||(t[14]=d=>o.analyzeFileList=d),"list-type":"image-card",onBeforeUpload:Ze,"default-upload":!1,"custom-request":Be},{default:s(()=>t[39]||(t[39]=[p(" 点击上传 ")])),_:1,__:[39]},8,["file-list"]))]),_:1},8,["show","title"]),l(Ce,{show:Te.value,"onUpdate:show":t[17]||(t[17]=d=>Te.value=d),title:"备注",preset:"card",class:"w-600px"},{footer:s(()=>[l(O,{justify:"end"},{default:s(()=>[l(i(y),{size:"small",class:"mt-16px",onClick:et},{default:s(()=>[p(I(i(D)("common.cancel")),1)]),_:1}),l(i(y),{type:"primary",size:"small",class:"mt-16px",onClick:Yt},{default:s(()=>[p(I(i(D)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(X,{ref:"formRef",model:q,"label-placement":"left"},{default:s(()=>[l(H,{label:"备注",path:"notes",required:""},{default:s(()=>[l(h,{type:"textarea",value:q.notes,"onUpdate:value":t[16]||(t[16]=d=>q.notes=d),placeholder:"请输入备注",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),l(Ce,{show:Le.value,"onUpdate:show":t[22]||(t[22]=d=>Le.value=d),title:"售后处理",preset:"card",class:"w-85%"},{default:s(()=>[l(X,{ref:"formRef",model:Ne,"label-placement":"left","label-width":100,"show-feedback":!1},{default:s(()=>[l(Fe,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[l(b,{span:"24 s:24 m:24"},{default:s(()=>[l(O,{class:"w-full"},{default:s(()=>[i(fe)("aftermarketRes:select:permission.do")?(R(),N(i(y),{key:0,ghost:"",onClick:i(Q)},{icon:s(()=>[l(_,{class:"text-icon"})]),default:s(()=>[t[40]||(t[40]=p(" "+I("查询")))]),_:1,__:[40]},8,["onClick"])):P("",!0),i(fe)("aftermarketRes:insert:permission.do")?(R(),N(i(y),{key:1,type:"primary",ghost:"",onClick:t[18]||(t[18]=d=>tt({id:Ne.aid||m.aid},"add"))},{icon:s(()=>[l(al,{class:"text-icon"})]),default:s(()=>[t[41]||(t[41]=p(" "+I("添加")))]),_:1,__:[41]})):P("",!0),i(fe)("aftermarketRes:delete:permission.do")?(R(),N(i(y),{key:2,type:"error",disabled:i(oe).length===0,onClick:t[19]||(t[19]=d=>gt(void 0))},{icon:s(()=>[l(E,{class:"text-icon"})]),default:s(()=>[t[42]||(t[42]=p(" "+I("批量删除")))]),_:1,__:[42]},8,["disabled"])):P("",!0),i(fe)("aftermarketRes:select:permission.do")?(R(),N(i(y),{key:3,onClick:i(Q)},{icon:s(()=>[l(nl,{class:"text-icon"})]),default:s(()=>[t[43]||(t[43]=p(" "+I("刷新")))]),_:1,__:[43]},8,["onClick"])):P("",!0)]),_:1}),l(B,{columns:i(Xe),"onUpdate:columns":t[20]||(t[20]=d=>qe(Xe)?Xe.value=d:null),ctype:14},null,8,["columns"])]),_:1})]),_:1})]),_:1},8,["model"]),l(pe,{"checked-row-keys":i(_e),"onUpdate:checkedRowKeys":t[21]||(t[21]=d=>qe(_e)?_e.value=d:null),columns:i(Ot),data:i(be),size:"small",loading:i(Gt),remote:"",style:{"margin-top":"20px"},"max-height":400,"row-key":d=>d.id,pagination:i(Ae),class:"sm:h-full",striped:""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1},8,["show"]),l(Ce,{show:Ie.value,"onUpdate:show":t[27]||(t[27]=d=>Ie.value=d),title:m.type==="add"?"添加责任人":"修改责任人",preset:"card",class:"w-600px"},{footer:s(()=>[l(O,{justify:"end"},{default:s(()=>[l(i(y),{size:"small",class:"mt-16px",onClick:lt},{default:s(()=>[p(I(i(D)("common.cancel")),1)]),_:1}),l(i(y),{type:"primary",size:"small",class:"mt-16px",onClick:el},{default:s(()=>[p(I(i(D)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(X,{ref:"formRef",model:q,"label-placement":"left"},{default:s(()=>[l(H,{label:"责任人",path:"notes",required:""},{default:s(()=>[l(h,{disabled:"",value:m.username,"onUpdate:value":t[23]||(t[23]=d=>m.username=d),placeholder:"请输入责任人",clearable:""},null,8,["value"])]),_:1}),l(H,{label:"原因分析",path:"notes"},{default:s(()=>[l(h,{type:"textarea",value:m.reason,"onUpdate:value":t[24]||(t[24]=d=>m.reason=d),placeholder:"请输入原因分析",clearable:""},null,8,["value"])]),_:1}),l(H,{label:"处理意见",path:"notes"},{default:s(()=>[l(h,{type:"textarea",value:m.resolution,"onUpdate:value":t[25]||(t[25]=d=>m.resolution=d),placeholder:"请输入处理意见",clearable:""},null,8,["value"])]),_:1}),l(H,{label:"改进措施",path:"notes"},{default:s(()=>[l(h,{type:"textarea",value:m.improvement,"onUpdate:value":t[26]||(t[26]=d=>m.improvement=d),placeholder:"请输入改进措施",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),l(jl,{visible:he.value,"onUpdate:visible":t[28]||(t[28]=d=>he.value=d),onSubmitted:i($),"row-id":ie.id,"row-mtype":ie.mtype},null,8,["visible","onSubmitted","row-id","row-mtype"]),l(rl,{show:ge.value,"onUpdate:show":t[29]||(t[29]=d=>ge.value=d),current:U.value,"onUpdate:current":[t[30]||(t[30]=d=>U.value=d),Mt],"src-list":a.value},null,8,["show","current","src-list"])])}}});export{ns as default};
