import{_ as xe,a as Ce}from"./close-small-rounded-Ccmn1yNp.js";import{d as A,p as Y,r as H,A as $e,D as F,o as b,c as $,w as t,f as U,g as e,h as _,i as N,E as P,L as Se,b1 as te,K as O,B as R,ap as ee,bb as ne,N as B,O as L,S as Q,P as Te,Q as Ue,R as ae,j as D,t as G,ad as W,q as Ne,e as J,G as V,ao as se,bc as Ie,bd as De,aD as Ee,a1 as z,J as K,ar as Ve,a_ as Pe,be as le,bf as oe,aB as qe,bg as ie,bh as re,as as Me,aq as Re,Z,aj as ue,av as Be,ae as je,bi as Oe,bj as Ae,M as Ge,H as Fe,bk as He,y as ze,ay as Je,az as Le}from"./index-Bz3vrfZ5.js";import{h as We,i as Ke,j as Qe,k as Ze,l as Xe,m as Ye,n as et,o as tt,p as nt,q as at,r as st,s as lt,t as ot,u as it,v as rt,w as ut,x as ct,y as dt,z as mt,A as pt,B as _t,C as ft,D as gt}from"./basic-config-DnfoSqAr.js";import{M as vt}from"./shield-question-outline-rounded-ezt4dwwk.js";import{_ as yt}from"./Table-C7lby0hv.js";import{f as ce}from"./reportForm-CPeoLbGm.js";import{f as de}from"./scheduleTask-CXFe_r6c.js";import{_ as bt}from"./DatePicker-BKBNhUW3.js";import{_ as me}from"./TimePicker-Cwg0Lx0E.js";import{u as pe}from"./table-C3QHMy2L.js";import{_ as ht}from"./Popconfirm-Dozjg1Dm.js";import{u as wt}from"./usePageData--m2G6yA-.js";import{a as kt}from"./events-B7XePQVu.js";import{_ as xt}from"./Progress-C0yQXaSW.js";import{_ as Ct}from"./Upload-L7MO-gA7.js";import"./defineProperty-BlKSrWcZ.js";const _e=q=>(Te("data-v-8912ff50"),q=q(),Ue(),q),$t={class:"flex justify-center"},St=_e(()=>U("span",{class:"font-bold"},"提示：",-1)),Tt=_e(()=>U("span",{style:{"text-decoration":"underline"}},"被锁定的账号会在设定的时间周期后自动解锁",-1)),Ut=A({name:"basicConfig",__name:"basicConfig",setup(q){const{formRef:p,validate:h,restoreValidation:l}=Y(),o=H(x());function x(){return{enablelock:1,locktime:5,lockcount:3,unlockeanble:1,unlocktime:5,aceffective:1,pwdexpire:1,expiretime:1,whiteenable:1,cputhreshold:80,memthreshold:80,captcha:1,tokentime:30}}const i={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},C={locktime:i,lockcount:i,unlocktime:i,expiretime:i,cputhreshold:i,memthreshold:i,tokentime:i},v=async()=>{const{data:r,error:a}=await We();a||(Object.assign(o,r),o.locktime=r.locktime/60,o.unlocktime=r.unlocktime/60/24)};$e(()=>{v()});const n=async()=>{var f;const r=o.locktime*60,a=o.unlocktime*60*24;await h();const{error:y}=await Ke({...o,locktime:r,unlocktime:a});y||(f=window.$message)==null||f.success("设置成功")};return(r,a)=>{const y=Se,f=te,c=O,d=R,g=ee,w=ne,S=B,k=L,s=Q,m=F("no-auth");return b(),$(s,{style:{"max-height":"calc(100vh - 245px)"}},{default:t(()=>[U("div",$t,[e(k,{ref_key:"formRef",ref:p,"label-width":180,"label-placement":"left",model:o,rules:C},{default:t(()=>[e(c,{label:"是否开启自动解锁",path:"unlockeanble"},{label:t(()=>[_(" 是否开启自动解锁 "),e(y,{trigger:"hover",placement:"top","content-style":"padding: 5px;"},{trigger:t(()=>[e(N(vt),{class:"text-xl cursor-pointer c-#7a7b78"})]),default:t(()=>[St,Tt]),_:1})]),default:t(()=>[e(f,{value:o.unlockeanble,"onUpdate:value":a[0]||(a[0]=u=>o.unlockeanble=u),disabled:"","checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(c,{label:"解锁时间",path:"unlocktime"},{default:t(()=>[e(w,{class:"flex items-center"},{default:t(()=>[e(d,{onClick:a[1]||(a[1]=u=>o.unlocktime--),disabled:o.unlocktime==1},{default:t(()=>[_(" − ")]),_:1},8,["disabled"]),e(g,{"show-button":!1,value:o.unlocktime,"onUpdate:value":a[2]||(a[2]=u=>o.unlocktime=u),placeholder:"",min:1,max:3},null,8,["value"]),e(d,{onClick:a[3]||(a[3]=u=>o.unlocktime++),class:"mr-5px",disabled:o.unlocktime==3},{default:t(()=>[_(" + ")]),_:1},8,["disabled"]),_(" 天 ")]),_:1})]),_:1}),e(c,{label:"是否开启验证码",path:"captcha"},{default:t(()=>[e(f,{value:o.captcha,"onUpdate:value":a[4]||(a[4]=u=>o.captcha=u),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(c,{label:"是否开启白名单",path:"whiteenable"},{default:t(()=>[e(f,{value:o.whiteenable,"onUpdate:value":a[5]||(a[5]=u=>o.whiteenable=u),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(c,{label:"密码过期时间",path:"expiretime"},{default:t(()=>[e(w,{class:"flex items-center"},{default:t(()=>[e(d,{onClick:a[6]||(a[6]=u=>o.expiretime--),disabled:o.expiretime==1},{default:t(()=>[_(" − ")]),_:1},8,["disabled"]),e(g,{"show-button":!1,value:o.expiretime,"onUpdate:value":a[7]||(a[7]=u=>o.expiretime=u),placeholder:"",min:1,max:90},null,8,["value"]),e(d,{onClick:a[8]||(a[8]=u=>o.expiretime++),class:"mr-5px",disabled:o.expiretime==90},{default:t(()=>[_(" + ")]),_:1},8,["disabled"]),_(" 天 ")]),_:1})]),_:1}),e(c,{label:"CPU阈值",path:"cputhreshold"},{default:t(()=>[e(w,{class:"flex items-center"},{default:t(()=>[e(d,{onClick:a[9]||(a[9]=u=>o.cputhreshold--),disabled:o.cputhreshold==0},{default:t(()=>[_(" − ")]),_:1},8,["disabled"]),e(g,{"show-button":!1,value:o.cputhreshold,"onUpdate:value":a[10]||(a[10]=u=>o.cputhreshold=u),placeholder:"",min:0,precision:0,max:100},null,8,["value"]),e(d,{onClick:a[11]||(a[11]=u=>o.cputhreshold++),disabled:o.cputhreshold==100,class:"mr-5px"},{default:t(()=>[_(" + ")]),_:1},8,["disabled"]),_(" % ")]),_:1})]),_:1}),e(c,{label:"MEM阈值",path:"memthreshold"},{default:t(()=>[e(w,{class:"flex items-center"},{default:t(()=>[e(d,{onClick:a[12]||(a[12]=u=>o.memthreshold--),disabled:o.memthreshold==0},{default:t(()=>[_(" − ")]),_:1},8,["disabled"]),e(g,{"show-button":!1,value:o.memthreshold,"onUpdate:value":a[13]||(a[13]=u=>o.memthreshold=u),placeholder:"",min:0,precision:0,max:100},null,8,["value"]),e(d,{onClick:a[14]||(a[14]=u=>o.memthreshold++),disabled:o.memthreshold==100,class:"mr-5px"},{default:t(()=>[_(" + ")]),_:1},8,["disabled"]),_(" % ")]),_:1})]),_:1}),e(c,{label:"token过期时间",path:"tokentime"},{default:t(()=>[e(w,{class:"flex items-center"},{default:t(()=>[e(d,{onClick:a[15]||(a[15]=u=>o.tokentime--),disabled:o.tokentime==1},{default:t(()=>[_(" − ")]),_:1},8,["disabled"]),e(g,{"show-button":!1,value:o.tokentime,"onUpdate:value":a[16]||(a[16]=u=>o.tokentime=u),placeholder:"",min:1},null,8,["value"]),e(d,{onClick:a[17]||(a[17]=u=>o.tokentime++),class:"mr-5px"},{default:t(()=>[_(" + ")]),_:1}),_(" 小时 ")]),_:1})]),_:1}),e(c,{label:" "},{default:t(()=>[e(S,null,{default:t(()=>[P((b(),$(d,{type:"default",ghost:"",onClick:v},{default:t(()=>[_(" 刷新 ")]),_:1})),[[m,"system.conf.select"]]),P((b(),$(d,{type:"info",ghost:"",onClick:n},{default:t(()=>[_(" 保存 ")]),_:1})),[[m,"system.conf.update"]])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})}}}),Nt=ae(Ut,[["__scopeId","data-v-8912ff50"]]),It=U("td",null,"产品名称",-1),Dt=U("td",null,"产品版本",-1),Et=U("td",null,"build号",-1),Vt=U("td",null,"产品型号",-1),Pt=A({name:"basicInfo",__name:"basicInfo",setup(q){const p=D({id:1,pname:"",pversion:"",pbuild:"",pmodel:""});(async()=>{const{data:x,error:i}=await Qe();i||(p.value=x)})(),D(0);const l=async()=>{var C,v;const{data:x,error:i}=await Ze();i||(x==="重启失败"?(C=window.$message)==null||C.error(x):(v=window.$message)==null||v.success(x))},o=async()=>{var C,v;const{data:x,error:i}=await Xe();i||(x==="关机失败"?(C=window.$message)==null||C.error(x):(v=window.$message)==null||v.success(x))};return(x,i)=>{const C=yt,v=R,n=B,r=W,a=F("no-auth");return b(),$(r,{class:"w-600px text-center m-auto mt-20px"},{default:t(()=>[e(C,{bordered:!0,"single-line":!1},{default:t(()=>[U("tbody",null,[U("tr",null,[It,U("td",null,G(p.value.pname||""),1)]),U("tr",null,[Dt,U("td",null,G(p.value.pversion),1)]),U("tr",null,[Et,U("td",null,G(p.value.pbuild),1)]),U("tr",null,[Vt,U("td",null,G(p.value.pmodel),1)])])]),_:1}),e(n,{justify:"center",class:"mt-50px"},{default:t(()=>[P((b(),$(v,{type:"info",ghost:"",onClick:l},{default:t(()=>[_("重启")]),_:1})),[[a,"sysmanger.basicInfo.restart"]]),P((b(),$(v,{type:"info",ghost:"",onClick:o},{default:t(()=>[_("关机")]),_:1})),[[a,"sysmanger.basicInfo.shutdown"]])]),_:1})]),_:1})}}}),qt=A({name:"emailService",__name:"emailSever",setup(q){const{createConfirmPwdRule:p,defaultRequiredRule:h,patternRules:l}=Ne(),{formRef:o,validate:x}=Y(),i=D({port:null,pwd:"",sendserver:"",essl:0,uname:""}),C={sendserver:[{required:!0,validator:(k,s,m)=>s?Ie(s)?m():m(new Error("请输入正确的IP地址或域名")):new Error("请输入服务器地址"),trigger:["blur","input"]}],port:{type:"number",required:!0,trigger:["blur","input"],validator:(k,s,m)=>s==null||s==null?new Error("请输入端口号"):De(s)?!0:new Error("请输入在0-65535之间的数字")},uname:[{required:!0,message:"请输入账号",trigger:"blur"}],pwd:[{required:!0,message:"请输入密码",trigger:"blur"}],sendaddr:[{required:!0,message:"请输入发件邮箱",trigger:["blur","input"]},{validator:Ee,trigger:["blur","input"]}]},v=D(!1),n=H({pwd:""}),r={pwd:[{required:!0,message:"请输入密码",trigger:"blur"},l.passwordL]},a=()=>{n.pwd="",v.value=!0},y=D(),f=D(!1),c=async()=>{var u,I;await((u=y.value)==null?void 0:u.validate());const k=z(n.pwd),{data:s,error:m}=await Ye({pwd:k});m||(s!=null&&s.id||(I=window.$message)==null||I.warning("未查询到邮件服务,请先添加邮件服务"),i.value.sendserver=(s==null?void 0:s.sendserver)??i.value.sendserver,i.value.port=(s==null?void 0:s.port)??i.value.port,i.value.pwd=(s==null?void 0:s.pwd)??i.value.pwd,i.value.essl=(s==null?void 0:s.essl)??i.value.essl,i.value.uname=(s==null?void 0:s.uname)??i.value.uname,i.value.id=(s==null?void 0:s.id)??i.value.id,f.value=!0,v.value=!1)},d=async()=>{var m,u,I,M;await x();const k=z(i.value.pwd),s=z(i.value.uname);if(i.value.id){const{data:T,error:j}=await et({...i.value,pwd:k,uname:s});j||((m=window.$message)==null||m.destroyAll(),(u=window.$message)==null||u.success("保存成功"),c())}else{const{data:T,error:j}=await tt({...i.value,pwd:k,uname:s});j||((I=window.$message)==null||I.destroyAll(),(M=window.$message)==null||M.success("保存成功"),c())}},g=async()=>{var m,u;const{data:k,error:s}=await nt();s||((m=window.$message)==null||m.destroyAll(),(u=window.$message)==null||u.success("重置成功"),i.value={port:null,pwd:"",sendserver:"",essl:0,uname:"",id:void 0})},w=D(!1),S=async()=>{var m,u;const k=z(i.value.pwd),s=z(i.value.uname);await x();try{w.value=!0;const{data:I,error:M}=await at({...i.value,pwd:k,uname:s});M||((m=window.$message)==null||m.destroyAll(),(u=window.$message)==null||u.success("测试成功"))}finally{w.value=!1}};return(k,s)=>{const m=K,u=O,I=ee,M=te,T=L,j=R,fe=B,ge=K,ve=O,ye=L,be=Q,he=R,we=B,ke=Ve,X=F("no-auth");return b(),J(se,null,[e(T,{ref_key:"formRef",ref:o,"label-width":150,model:i.value,rules:C,"label-placement":"left",class:"w-400px",style:{margin:"50px auto"}},{default:t(()=>[e(u,{label:"发送邮件服务器",path:"sendserver"},{default:t(()=>[e(m,{value:i.value.sendserver,"onUpdate:value":s[0]||(s[0]=E=>i.value.sendserver=E),placeholder:"输入服务器或IP地址"},null,8,["value"])]),_:1}),e(u,{label:"端口",path:"port"},{default:t(()=>[e(I,{value:i.value.port,"onUpdate:value":s[1]||(s[1]=E=>i.value.port=E),placeholder:"输入端口",style:{width:"100%"}},null,8,["value"])]),_:1}),e(u,{label:"用户名",path:"uname"},{default:t(()=>[e(m,{value:i.value.uname,"onUpdate:value":s[2]||(s[2]=E=>i.value.uname=E),placeholder:"用户名"},null,8,["value"])]),_:1}),e(u,{label:"密码",path:"pwd"},{default:t(()=>[e(m,{type:"password",value:i.value.pwd,"onUpdate:value":s[3]||(s[3]=E=>i.value.pwd=E),placeholder:"密码","show-password-on":"click"},null,8,["value"])]),_:1}),e(u,{label:"ssl",path:"essl"},{default:t(()=>[e(M,{value:i.value.essl,"onUpdate:value":s[4]||(s[4]=E=>i.value.essl=E),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"]),e(fe,{justify:"center"},{default:t(()=>[e(j,{type:"info",ghost:"",onClick:a},{default:t(()=>[_("查询")]),_:1}),f.value?P((b(),$(j,{key:0,type:"info",ghost:"",onClick:S},{default:t(()=>[_("测试")]),_:1})),[[X,"sysmanger.basicInfo.test.mailInfo"]]):V("",!0),f.value?P((b(),$(j,{key:1,type:"info",ghost:"",onClick:d},{default:t(()=>[_("保存")]),_:1})),[[X,"sysmanger.mailInfo.update"]]):V("",!0),f.value?P((b(),$(j,{key:2,type:"info",ghost:"",onClick:g},{default:t(()=>[_("重置")]),_:1})),[[X,"sysmanger.mailInfo.delete"]]):V("",!0)]),_:1}),e(ke,{show:v.value,"onUpdate:show":s[6]||(s[6]=E=>v.value=E),title:"查询邮件地址",preset:"card",class:"w-420px"},{footer:t(()=>[e(we,{justify:"center",size:16},{default:t(()=>[e(he,{type:"primary",onClick:c},{default:t(()=>[_(G(k.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(be,{class:"max-h-480px pr-20px"},{default:t(()=>[e(ye,{ref_key:"checkformRef",ref:y,model:n,"label-placement":"left",rules:r,"label-width":80,"require-mark-placement":"left"},{default:t(()=>[e(ve,{label:k.$t("page.login.common.password"),path:"pwd"},{default:t(()=>[e(ge,{type:"password","show-password-on":"click",class:"eipaddrCss",clearable:"",value:n.pwd,"onUpdate:value":s[5]||(s[5]=E=>n.pwd=E),placeholder:"请输入当前登录账号密码"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])],64)}}}),Mt=A({name:"TimingConfig",__name:"timingConfig",setup(q){const{formRef:p,validate:h}=Y(),l=H({automatic:1,time:Pe(1,new Date),ip:"",taskId:"",showCron:!1,setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),o={time:{required:!0,message:"请选择时间",trigger:"blur"},ip:[{required:!0,message:"请输入IP",trigger:"blur"},{validator:qe,trigger:"blur"}],task:{required:!0,message:"请设置表达式",trigger:"blur"},setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}},x=async()=>{const{data:v,error:n}=await st();n||(l.time=v)};x(),(async()=>{const{data:v,error:n}=await lt();if(n)return;const{id:r,params:a}=v;try{if(a){const{cron:y,ip:f}=JSON.parse(a),c=ie(y);l.setting.settingCycle=c==null?void 0:c.settingCycle,l.setting.settingTime=c==null?void 0:c.settingTime,l.setting.settingCycleValue=c==null?void 0:c.settingCycleValue,l.ip=f,l.taskId=r}}catch(y){console.error("Error parsing params:",y)}})();const C=async()=>{var v,n;if(await h(),l.automatic){const{data:r,error:a}=await ot({dtime:l.time});a||(v=window.$message)==null||v.success(r)}else{const r=re(l.setting.settingCycle==1?{dayOfWeek:l.setting.settingCycleValue,time:l.setting.settingTime}:null,l.setting.settingCycle==2?{dayOfMonth:l.setting.settingCycleValue,time:l.setting.settingTime}:null,l.setting.settingCycle==3?{time:l.setting.settingTime}:null);l.taskId?await de({id:l.taskId,beanName:"NtpTask",cronExpression:r,remark:"",status:1,params:JSON.stringify({ip:l.ip,cron:r})}):await ce({beanName:"NtpTask",cronExpression:r,remark:"",status:1,params:JSON.stringify({ip:l.ip,cron:r})});const{data:a,error:y}=await it({ip:l.ip});y||(n=window.$message)==null||n.success(a)}};return(v,n)=>{const r=Me,a=B,y=Re,f=O,c=bt,d=K,g=Z,w=me,S=R,k=L,s=F("no-auth");return b(),$(k,{ref_key:"formRef",ref:p,"label-width":180,"label-placement":"left",model:l,class:"m-auto w-600px mt-20px",rules:o},{default:t(()=>[e(f,{label:"校时",path:"enablelock"},{default:t(()=>[e(y,{value:l.automatic,"onUpdate:value":n[0]||(n[0]=m=>l.automatic=m),name:"radiogroup"},{default:t(()=>[e(a,null,{default:t(()=>[e(r,{value:1},{default:t(()=>[_("手动校时")]),_:1}),e(r,{value:0},{default:t(()=>[_("自动校时")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),l.automatic?(b(),$(f,{key:0,label:"设置中心服务器时间",path:"time"},{default:t(()=>[e(c,{"formatted-value":l.time,"onUpdate:formattedValue":n[1]||(n[1]=m=>l.time=m),format:"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:""},null,8,["formatted-value"])]),_:1})):V("",!0),l.automatic?V("",!0):(b(),J(se,{key:1},[e(f,{label:"NTP服务器设置",path:"ip"},{default:t(()=>[e(d,{value:l.ip,"onUpdate:value":n[2]||(n[2]=m=>l.ip=m),placeholder:"输入NTP服务器设置",style:{width:"200px"}},null,8,["value"])]),_:1}),e(f,{label:"设置周期",path:"setting.settingCycle"},{default:t(()=>[e(a,{justify:"space-between"},{default:t(()=>[e(g,{value:l.setting.settingCycle,"onUpdate:value":[n[3]||(n[3]=m=>l.setting.settingCycle=m),n[4]||(n[4]=m=>l.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"200px"}},null,8,["value"]),e(f,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:t(()=>[e(a,null,{default:t(()=>[l.setting.settingCycle==1?(b(),$(g,{key:0,value:l.setting.settingCycleValue,"onUpdate:value":n[5]||(n[5]=m=>l.setting.settingCycleValue=m),options:N(le)(),style:{width:"200px"}},null,8,["value","options"])):V("",!0),l.setting.settingCycle==2?(b(),$(g,{key:1,value:l.setting.settingCycleValue,"onUpdate:value":n[6]||(n[6]=m=>l.setting.settingCycleValue=m),options:N(oe)(),style:{width:"200px"}},null,8,["value","options"])):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{label:"设置时间",path:"setting.settingTime"},{default:t(()=>[e(w,{"formatted-value":l.setting.settingTime,"onUpdate:formattedValue":n[7]||(n[7]=m=>l.setting.settingTime=m)},null,8,["formatted-value"])]),_:1})],64)),e(f,null,{label:t(()=>[l.automatic?P((b(),$(S,{key:0,type:"info",ghost:"",onClick:x},{default:t(()=>[_(" 查看服务器时间 ")]),_:1})),[[s,"sysmanger.basicInfo.gettiming"]]):V("",!0)]),default:t(()=>[e(a,null,{default:t(()=>[P((b(),$(S,{type:"info",ghost:"",onClick:C},{default:t(()=>[_(" 保存 ")]),_:1})),[[s,"sysmanger.basicInfo.manu.timing"]])]),_:1})]),_:1})]),_:1},8,["model"])}}}),Rt=A({name:"dataBase",__name:"dataBase",setup(q){const p=()=>[...Array(12).keys()].map(f=>({label:`${f+1}个月`,value:f+1})),h=H({space:80,retention:void 0,id:void 0}),{columns:l,columnChecks:o,data:x,getData:i,loading:C,mobilePagination:v,searchParams:n,resetSearchParams:r}=pe({apiFn:rt,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center"}]});(async()=>{const{data:f,error:c}=await ut();c||(h.space=f.space,h.retention=f.retention,h.id=f.id)})();const y=async()=>{var d;const{data:f,error:c}=await ct({space:h.space,retention:h.retention,id:h.id});c||(d=window.$message)==null||d.success("保存成功")};return(f,c)=>{const d=R,g=ee,w=ne,S=O,k=Z,s=B,m=W,u=ue,I=Q,M=F("no-auth");return b(),$(I,{class:"h-full flex-col",style:{maxHeight:"calc(100vh - 220px)"}},{default:t(()=>[e(m,{title:"数据库维护配置",bordered:!1,class:"mb-20px","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:t(()=>[e(s,{class:"ml-50px"},{default:t(()=>[e(S,{label:"已用空间超过","label-placement":"left"},{default:t(()=>[e(w,{class:"flex items-center"},{default:t(()=>[e(d,{onClick:c[0]||(c[0]=T=>h.space--),disabled:h.space==1},{default:t(()=>[_(" − ")]),_:1},8,["disabled"]),e(g,{"show-button":!1,value:h.space,"onUpdate:value":c[1]||(c[1]=T=>h.space=T),placeholder:"",min:1,max:100,style:{width:"100px","text-align":"center"}},null,8,["value"]),e(d,{onClick:c[2]||(c[2]=T=>h.space++),disabled:h.space==100,class:"mr-5px"},{default:t(()=>[_(" + ")]),_:1},8,["disabled"]),_(" % 时自动维护 ")]),_:1})]),_:1}),e(S,{label:"数据保留时间","label-placement":"left",class:"mx-20px"},{default:t(()=>[e(k,{value:h.retention,"onUpdate:value":c[3]||(c[3]=T=>h.retention=T),placeholder:"请选择",options:p(),style:{width:"150px"}},null,8,["value","options"])]),_:1}),e(S,{label:" ","label-placement":"left"},{default:t(()=>[P((b(),$(d,{type:"info",ghost:"",onClick:y},{default:t(()=>[_("保存")]),_:1})),[[M,"sysmanger.basicInfo.insert.dataBaseMaintenance"]])]),_:1})]),_:1})]),_:1}),e(m,{title:"数据库维护列表",bordered:!1,class:"flex-1","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:t(()=>[e(u,{columns:N(l),data:N(x),size:"small","scroll-x":462,"max-height":420,loading:N(C),remote:"","row-key":T=>T.id,pagination:N(v),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})]),_:1})}}}),Bt=A({name:"systemSnapshot",__name:"systemSnapshot",setup(q){const{columns:p,columnChecks:h,data:l,getData:o,loading:x,mobilePagination:i,searchParams:C,resetSearchParams:v}=pe({apiFn:dt,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center",render:d=>e(Be,{type:d.resultmsg==1?"error":"success"},{default:()=>[d.resultmsg==1?"失败":"成功"]})},{title:"操作",key:"operate",align:"center",width:100,fixed:"right",render:d=>e(ht,{onPositiveClick:()=>c(d.id)},{default:()=>"确定恢复吗?恢复后将重启系统",trigger:()=>e(R,{type:"info",ghost:!0,size:"small"},{default:()=>[_("恢复")]})})}]}),n=H({id:"",setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),r=D(n),a={setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:["blur","change"]},settingCycleValue:{type:"number",required:!1,message:"请选择设置周期值",trigger:["blur","change"]},settingTime:{required:!0,message:"请选择设置时间",trigger:["blur","change"]}}};(async()=>{const{data:d,error:g}=await mt();if(g)return;console.log(d,"asdas");const w=ie(d.cronExpression);Object.assign(n,{id:d.id,setting:w})})();const f=async()=>{var g,w,S;await((g=r.value)==null?void 0:g.validate());const d=re(n.setting.settingCycle==1?{dayOfWeek:n.setting.settingCycleValue,time:n.setting.settingTime}:null,n.setting.settingCycle==2?{dayOfMonth:n.setting.settingCycleValue,time:n.setting.settingTime}:null,n.setting.settingCycle==3?{time:n.setting.settingTime}:null);if(n.id){const{data:k,error:s}=await de({id:n.id,beanName:"SnapshotTask",cronExpression:d,status:1,params:JSON.stringify({corn:d})});s||(w=window.$message)==null||w.success("设置成功")}else{const{data:k,error:s}=await ce({beanName:"SnapshotTask",cronExpression:d,remark:"",status:1,params:JSON.stringify({corn:d})});s||(S=window.$message)==null||S.success("设置成功")}},c=async d=>{var S;const{data:g,error:w}=await pt({id:d});w||(S=window.$message)==null||S.success("恢复成功")};return(d,g)=>{const w=Z,S=O,k=B,s=me,m=L,u=W,I=ue,M=Q;return b(),$(M,{class:"h-full flex-col",style:{maxHeight:"calc(100vh - 220px)"}},{default:t(()=>[e(u,{title:"应用配置设置",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:t(()=>[e(k,{class:"ml-50px"},{default:t(()=>[e(m,{"label-placement":"left",inline:"",model:n,rules:a,ref_key:"formRef",ref:r,"label-width":150,class:"px-100px"},{default:t(()=>[e(S,{label:"设置周期",path:"setting.settingCycle"},{default:t(()=>[e(k,{justify:"space-between"},{default:t(()=>[e(w,{value:n.setting.settingCycle,"onUpdate:value":[g[0]||(g[0]=T=>n.setting.settingCycle=T),g[1]||(g[1]=T=>n.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"140px"}},null,8,["value"]),e(S,{label:"",path:"","show-feedback":!1},{default:t(()=>[n.setting.settingCycle==1?(b(),$(w,{key:0,value:n.setting.settingCycleValue,"onUpdate:value":g[2]||(g[2]=T=>n.setting.settingCycleValue=T),options:N(le)(),style:{width:"140px"}},null,8,["value","options"])):V("",!0),n.setting.settingCycle==2?(b(),$(w,{key:1,value:n.setting.settingCycleValue,"onUpdate:value":g[3]||(g[3]=T=>n.setting.settingCycleValue=T),options:N(oe)(),style:{width:"140px"}},null,8,["value","options"])):V("",!0)]),_:1})]),_:1})]),_:1}),e(S,{label:"设置时间",path:"setting.settingTime"},{default:t(()=>[e(s,{"formatted-value":n.setting.settingTime,"onUpdate:formattedValue":g[4]||(g[4]=T=>n.setting.settingTime=T)},null,8,["formatted-value"])]),_:1}),e(S,{label:" ","label-placement":"left"},{default:t(()=>[e(N(R),{type:"info",ghost:"",onClick:f},{default:t(()=>[_("保存")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(u,{title:"应用配置列表",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"},class:"flex-1"},{default:t(()=>[e(I,{columns:N(p),data:N(l),size:"small","scroll-x":462,"max-height":420,loading:N(x),remote:"","row-key":T=>T.id,pagination:N(i),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})]),_:1})}}}),jt=A({__name:"sysStatus",setup(q){const p=H({mailaddr:"",snmpaddr:void 0,stype:0,tmail:0,tsnmp:0});(async()=>{const{data:n,error:r}=await _t();r||(p.mailaddr=(n==null?void 0:n.mailaddr)??p.mailaddr,p.snmpaddr=(n==null?void 0:n.snmpaddr)??p.snmpaddr,p.stype=(n==null?void 0:n.stype)??p.stype,p.tmail=(n==null?void 0:n.tmail)??p.tmail,p.tsnmp=(n==null?void 0:n.tsnmp)??p.tsnmp)})();const l=async()=>{var a;const{data:n,error:r}=await ft(p);r||(a=window.$message)==null||a.success("保存成功")},{pageData:o,getData:x,nextPage:i}=wt(kt),C=async n=>{const r=n.currentTarget;r.scrollTop+r.offsetHeight>=r.scrollHeight&&o.data.length<o.total&&i()},v=D();return je(()=>o.data,n=>{n&&(v.value=n.filter(r=>r.ftype===1))}),x(),(n,r)=>{const a=Ae,y=Ge,f=K,c=O,d=Z,g=R,w=B,S=W,k=F("no-auth");return b(),$(w,{justify:"center"},{default:t(()=>[e(S,{title:"通知方式",class:"w-600px"},{default:t(()=>[e(a),e(y,{checked:p.tmail,"onUpdate:checked":r[0]||(r[0]=s=>p.tmail=s),"checked-value":1,"unchecked-value":0},{default:t(()=>[_(" 邮件 ")]),_:1},8,["checked"]),p.tmail?(b(),$(c,{key:0,label:"邮件地址","label-placement":"left","label-width":"120",class:"mt-30px",rule:{required:!0,validator:()=>{if(!p.mailaddr)return new Error("请输入邮件地址");if(!N(Oe)(p.mailaddr))return new Error("请输入正确的邮件地址")},trigger:["blur","input"]}},{default:t(()=>[e(f,{value:p.mailaddr,"onUpdate:value":r[1]||(r[1]=s=>p.mailaddr=s)},null,8,["value"])]),_:1},8,["rule"])):V("",!0),e(a),e(y,{checked:p.tsnmp,"onUpdate:checked":r[2]||(r[2]=s=>p.tsnmp=s),"checked-value":1,"unchecked-value":0},{default:t(()=>[_(" snmp trap ")]),_:1},8,["checked"]),p.tsnmp?(b(),$(c,{key:1,label:"通知服务器","label-placement":"left","label-width":"120",class:"mt-30px"},{default:t(()=>[e(d,{value:p.snmpaddr,"onUpdate:value":r[3]||(r[3]=s=>p.snmpaddr=s),options:v.value,"label-field":"ipaddr","value-field":"ipaddr",onScroll:C},null,8,["value","options"])]),_:1})):V("",!0),e(a),e(w,{justify:"end"},{default:t(()=>[P((b(),$(g,{type:"info",ghost:"",onClick:l},{default:t(()=>[_("保存")]),_:1})),[[k,"sysmanger.basicInfo.alarmNotification"]])]),_:1})]),_:1})]),_:1})}}}),Ot={class:"h-full"},At={class:"flex flex-col justify-center items-center"},Gt={key:0,style:{width:"300px"}},Ft=A({name:"basicconfig_system-config",__name:"index",setup(q){const p=D("基本信息"),h=D(""),l=D(null),o=({file:r})=>{l.value=r.file,h.value=r.name},x=r=>{r.stopPropagation(),h.value="",l.value=null},i=D(0),C=D(!1),v=r=>{C.value=!0,i.value=r},n=async()=>{var r;try{const a=new FormData,y=await He(l.value),f=ze(y);a.append("file",l.value),a.append("signature",f);const{data:c,error:d}=await gt(a,v);if(d)return;(r=window.$message)==null||r.success(c),h.value="",l.value=null,C.value=!1}catch{C.value=!1}finally{C.value=!1}};return(r,a)=>{const y=Je,f=xe,c=Ce,d=R,g=Ct,w=O,S=xt,k=B,s=Le,m=W,u=F("no-auth");return b(),J("div",Ot,[e(m,{style:{"margin-bottom":"16px"},class:"h-full","content-style":{height:"100%"}},{default:t(()=>[e(s,{type:"card",animated:"",class:"h-100%",value:p.value,"onUpdate:value":a[1]||(a[1]=I=>p.value=I)},{default:t(()=>[e(y,{name:"基本信息",tab:"基本信息"},{default:t(()=>[e(Pt)]),_:1}),e(y,{name:"安全设置",tab:"安全设置"},{default:t(()=>[e(Nt)]),_:1}),e(y,{name:"邮件服务",tab:"邮件服务"},{default:t(()=>[e(qt)]),_:1}),e(y,{name:"校时配置",tab:"校时配置"},{default:t(()=>[e(Mt)]),_:1}),e(y,{name:"数据库维护",tab:"数据库维护",class:"h-100%"},{default:t(()=>[e(Rt)]),_:1}),e(y,{name:"应用配置备份",tab:"应用配置备份",class:"h-100%"},{default:t(()=>[e(Bt)]),_:1}),e(y,{name:"漏洞信息库",tab:"漏洞信息库"},{default:t(()=>[e(k,{justify:"center",class:"pt-20px important-flex-col items-center"},{default:t(()=>[e(w,{label:"上传漏洞信息文件:","label-placement":"left"},{default:t(()=>[e(g,{action:"","custom-request":o,"show-file-list":!1,accept:".xlsx"},{default:t(()=>[h.value?(b(),J("div",{key:0,onClick:a[0]||(a[0]=Fe(()=>{},["stop"]))},[_(G(h.value)+" ",1),e(f,{class:"font-size-30px cursor-pointer",onClick:x})])):(b(),$(d,{key:1},{icon:t(()=>[e(c,{class:"text-icon"})]),default:t(()=>[_(" 选择文件")]),_:1}))]),_:1})]),_:1}),e(w,{label:"","label-placement":"left",class:"ml-20px"},{default:t(()=>[U("div",At,[C.value?(b(),J("div",Gt,[e(S,{"indicator-placement":"inside",type:"line",percentage:i.value},null,8,["percentage"])])):V("",!0),P((b(),$(d,{type:"info",loading:C.value,style:{width:"140px","margin-top":"10px"},ghost:"",disabled:!h.value,onClick:n},{default:t(()=>[_(G(C.value?"上传中":"上传"),1)]),_:1},8,["loading","disabled"])),[[u,"cnnvd.import"]])])]),_:1})]),_:1})]),_:1}),e(y,{name:"系统告警通知",tab:"系统告警通知"},{default:t(()=>[e(jt)]),_:1})]),_:1},8,["value"])]),_:1})])}}}),on=ae(Ft,[["__scopeId","data-v-72f76881"]]);export{on as default};
