import{_ as Me}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DqNZty8-.js";import{d as W,dw as Ue,j as z,aK as oe,F as re,bm as ue,dx as ce,dy as pe,bj as Z,c8 as Ae,ai as Y,ct as $e,r as xe,q as le,s as Re,v as Te,x as ze,b as Ie,y as Pe,b1 as me,b0 as fe,K as te,o as O,c as V,w as n,g as e,h,t as b,i as o,$ as I,L,e as ee,ag as _e,U as P,N as ve,at as je,G as Ee,aT as ye,A as Ce,C as he,X as Le,D as Ne,S as Be,B as G,E as De,b3 as Ke,M as Fe,a9 as se,Z as qe,ac as Q,f as ge}from"./index-ClKiVTJI.js";import{c as Ve,d as Ge,f as We,e as He,g as Je,h as be,i as Xe}from"./reportForm-ClcsYTEU.js";import{u as Ze,a as Qe}from"./table-CtVha77_.js";import{T as ie,a as Se,S as Oe}from"./task-CKjPYYVQ.js";import{a as Ye,b as et,_ as tt}from"./DataTable-W6X70lwR.js";import{_ as at}from"./TimePicker-nlZsFMPZ.js";import{_ as nt}from"./round-search-CMwyc___.js";import{_ as ot}from"./round-refresh-hHhFfqfD.js";import{_ as lt}from"./FormItemGridItem-OIGZ-ZEg.js";import{_ as st}from"./Grid-D0xzNjlx.js";import{h as ke}from"./permission-BDwqe94O.js";import{_ as it}from"./Popconfirm-DggMJhcu.js";import{_ as rt,a as ut}from"./DescriptionsItem-DDbtUdFr.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-BSmP24o3.js";import"./setting-outlined-BdAhLNLQ.js";import"./round-delete-6AS2k1fI.js";import"./refresh-BUsjz2D4.js";import"./round-plus-zqxfLO2L.js";import"./Upload-CQ7n1buy.js";import"./Progress-Cc0k7jh2.js";import"./Forward-CgMA_ruy.js";import"./defineProperty-CrCCF3kl.js";const dt=W({name:"ModalEnvironment",props:Object.assign(Object.assign({},Ue),{internalKey:{type:String,required:!0},onInternalAfterLeave:{type:Function,required:!0}}),setup(p){const _=z(!0);function d(){const{onInternalAfterLeave:l,internalKey:c,onAfterLeave:t}=p;l&&l(c),t&&t()}function s(){const{onPositiveClick:l}=p;l?Promise.resolve(l()).then(c=>{c!==!1&&r()}):r()}function v(){const{onNegativeClick:l}=p;l?Promise.resolve(l()).then(c=>{c!==!1&&r()}):r()}function m(){const{onClose:l}=p;l?Promise.resolve(l()).then(c=>{c!==!1&&r()}):r()}function R(l){const{onMaskClick:c,maskClosable:t}=p;c&&(c(l),t&&r())}function T(){const{onEsc:l}=p;l&&l()}function r(){_.value=!1}function g(l){_.value=l}return{show:_,hide:r,handleUpdateShow:g,handleAfterLeave:d,handleCloseClick:m,handleNegativeClick:v,handlePositiveClick:s,handleMaskClick:R,handleEsc:T}},render(){const{handleUpdateShow:p,handleAfterLeave:_,handleMaskClick:d,handleEsc:s,show:v}=this;return oe(re,Object.assign({},this.$props,{show:v,onUpdateShow:p,onMaskClick:d,onEsc:s,onAfterLeave:_,internalAppear:!0,internalModal:!0}))}}),we=ue("n-modal-provider"),ct=ue("n-modal-api"),pt=ue("n-modal-reactive-list"),mt={to:[String,Object]},ft=W({name:"ModalProvider",props:mt,setup(){const p=ce(64),_=pe(),d=z([]),s={};function v(r={}){const g=$e(),l=xe(Object.assign(Object.assign({},r),{key:g,destroy:()=>{var c;(c=s[`n-modal-${g}`])===null||c===void 0||c.hide()}}));return d.value.push(l),l}function m(r){const{value:g}=d;g.splice(g.findIndex(l=>l.key===r),1)}function R(){Object.values(s).forEach(r=>{r==null||r.hide()})}const T={create:v,destroyAll:R};return Z(ct,T),Z(we,{clickedRef:ce(64),clickedPositionRef:pe()}),Z(pt,d),Z(we,{clickedRef:p,clickedPositionRef:_}),Object.assign(Object.assign({},T),{modalList:d,modalInstRefs:s,handleAfterLeave:m})},render(){var p,_;return oe(Y,null,[this.modalList.map(d=>{var s;return oe(dt,Ae(d,["destroy"],{to:(s=d.to)!==null&&s!==void 0?s:this.to,ref:v=>{v===null?delete this.modalInstRefs[`n-modal-${d.key}`]:this.modalInstRefs[`n-modal-${d.key}`]=v},internalKey:d.key,onInternalAfterLeave:this.handleAfterLeave}))}),(_=(p=this.$slots).default)===null||_===void 0?void 0:_.call(p)])}}),_t=W({name:"TaskModal",__name:"task_modal",props:le({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:le(["submitted"],["update:visible"]),setup(p,{expose:_,emit:d}){const s=p,v=d,m=Re(p,"visible"),{formRef:R,validate:T,restoreValidation:r}=Te(),{defaultRequiredRule:g,patternRules:l}=ze(),c=Ie(()=>({add:"新增任务",edit:"编辑任务"})[s.operateType]),t=xe(j());function j(){return{id:void 0,rname:"",rtype:0,ttype:0,starttime:void 0,endtime:void 0,excute:1,stype:0,recipient:"",rdesc:"",tid:void 0}}const E={rname:g,starttime:g,cron:g,rtype:{type:"number",required:!0,trigger:["input","blur"],message:"请选择实例"},ttype:{type:"number",required:!0,trigger:["input","blur"],message:"请选择任务类型"},stype:{type:"number",required:!0,trigger:["input","blur"],message:"请选择发送类型"},recipient:{required:!0,validator:je,trigger:["input","change","blur","password-input"]}};function D(){Object.assign(t,j()),U.value=Ee(),s.operateType==="edit"&&s.rowData&&(s.rowData.starttime=s.rowData.starttime.substring(11,19),Object.assign(t,s.rowData))}function M(){m.value=!1}const U=z(""),H=async()=>{const w=Ke(t.ttype==0?{dayOfWeek:t.excute,time:t.starttime}:null,t.ttype==1?{dayOfMonth:t.excute,time:t.starttime}:null,t.ttype==2?{time:t.starttime}:null),{data:i,error:C}=await We({beanName:"ReportTask",remark:U.value,cronExpression:w,params:JSON.stringify({cron:w})});return C?!1:(await A(),!0)},A=async()=>{const{data:w,error:i}=await He({uuid:U.value});t.tid=w};async function $(){var w,i;if(await T(),s.operateType==="add"&&!await H())return!1;if(t.ttype!==1&&t.ttype!==2&&delete t.excute,s.operateType==="add"){const{data:C,error:k}=await Ve({...t,starttime:ye(1,new Date)});k||((w=window.$message)==null||w.success(I("common.addSuccess")),M(),v("submitted"))}else{const{data:C,error:k}=await Ge({...t,starttime:ye(1,new Date)});k||((i=window.$message)==null||i.success(I("common.updateSuccess")),M(),v("submitted"))}}const y=w=>{t.excute=1};return Pe(m,()=>{m.value&&(D(),r())}),_({monthOption:me,weekOption:fe}),(w,i)=>{const C=Ce,k=he,J=et,B=Ye,f=Le,u=at,x=he,K=Ne,S=Be,X=G,ae=De,ne=re,F=te("no-space");return O(),V(ne,{show:m.value,"onUpdate:show":i[8]||(i[8]=a=>m.value=a),title:c.value,preset:"card",class:"w-600px"},{footer:n(()=>[e(ae,{justify:"end",size:16},{default:n(()=>[e(X,{onClick:M},{default:n(()=>[h(b(o(I)("common.cancel")),1)]),_:1}),e(X,{type:"primary",onClick:$},{default:n(()=>[h(b(o(I)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(S,{class:"max-h-520px pr-20px"},{default:n(()=>[e(K,{ref_key:"formRef",ref:R,model:t,rules:E,"label-placement":"left","label-width":110,"require-mark-placement":"left"},{default:n(()=>[e(k,{label:"任务名称",path:"rname"},{default:n(()=>[L(e(C,{value:t.rname,"onUpdate:value":i[0]||(i[0]=a=>t.rname=a),placeholder:"请输入任务名称",clearable:""},null,8,["value"]),[[F]])]),_:1}),e(k,{label:"实例选择",path:"rtype"},{default:n(()=>[e(B,{value:t.rtype,"onUpdate:value":i[1]||(i[1]=a=>t.rtype=a),name:"radiogroup"},{default:n(()=>[(O(!0),ee(Y,null,_e(o(P)(o(ie)),(a,N)=>(O(),V(J,{key:N,value:a.value},{default:n(()=>[h(b(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s.operateType==="add"?(O(),ee(Y,{key:0},[e(k,{label:"任务类型",path:"ttype"},{default:n(()=>[e(B,{value:t.ttype,"onUpdate:value":[i[2]||(i[2]=a=>t.ttype=a),y],name:"radiogroup"},{default:n(()=>[(O(!0),ee(Y,null,_e(o(P)(o(Se)),(a,N)=>(O(),V(J,{key:N,value:a.value},{default:n(()=>[h(b(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t.ttype==1||t.ttype==2?(O(),V(k,{key:0,label:t.ttype==1?"每周":t.ttype==2?"每月":"",path:"excute"},{default:n(()=>[e(f,{filterable:"",value:t.excute,"onUpdate:value":i[3]||(i[3]=a=>t.excute=a),placeholder:"请选择",options:t.ttype==2?o(me)():o(fe)(),style:{width:"100%"}},null,8,["value","options"])]),_:1},8,["label"])):ve("",!0),e(x,{label:"开始时间",path:"starttime"},{default:n(()=>[e(u,{"formatted-value":t.starttime,"onUpdate:formattedValue":i[4]||(i[4]=a=>t.starttime=a),placeholder:"选择开始时间"},null,8,["formatted-value"])]),_:1})],64)):ve("",!0),e(k,{label:"收件人",path:"recipient"},{default:n(()=>[L(e(C,{value:t.recipient,"onUpdate:value":i[5]||(i[5]=a=>t.recipient=a),placeholder:"请输入收件人",clearable:""},null,8,["value"]),[[F]])]),_:1}),e(k,{label:"发送类型",path:"stype"},{default:n(()=>[e(f,{filterable:"",value:t.stype,"onUpdate:value":i[6]||(i[6]=a=>t.stype=a),placeholder:"请选择发送类型",options:o(P)(o(Oe)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(k,{label:"任务描述",path:"rdesc"},{default:n(()=>[L(e(C,{type:"textarea",value:t.rdesc,"onUpdate:value":i[7]||(i[7]=a=>t.rdesc=a),placeholder:"请输入任务描述",clearable:""},null,8,["value"]),[[F]])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),vt=W({name:"TaskSearch",__name:"task_search",props:{model:{required:!0},modelModifiers:{}},emits:le(["reset","search"],["update:model"]),setup(p,{emit:_}){const d=_,{formRef:s,restoreValidation:v}=Te(),m=Re(p,"model");function R(){m.value.fuzzy=void 0,d("search")}async function T(){await v(),d("reset")}async function r(){d("search")}return(g,l)=>{const c=Ce,t=lt,j=ot,E=G,D=nt,M=De,U=st,H=Ne,A=se,$=te("no-space");return O(),V(A,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(H,{ref_key:"formRef",ref:s,model:m.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Fe(r,["enter"])},{default:n(()=>[e(U,{responsive:"screen","item-responsive":""},{default:n(()=>[e(t,{span:"24 s:12 m:6",label:"任务名称",path:"fuzzy",class:"pr-24px"},{default:n(()=>[L(e(c,{value:m.value.fuzzy,"onUpdate:value":l[0]||(l[0]=y=>m.value.fuzzy=y),placeholder:"请输入任务名称关键字",clearable:"",onClear:R},null,8,["value"]),[[$]])]),_:1}),e(t,{span:"24 m:6",class:"pr-24px"},{default:n(()=>[e(M,{class:"w-full"},{default:n(()=>[e(E,{onClick:T},{icon:n(()=>[e(j,{class:"text-icon"})]),default:n(()=>[h(" "+b(o(I)("common.reset")),1)]),_:1}),e(E,{type:"primary",ghost:"",onClick:r},{icon:n(()=>[e(D,{class:"text-icon"})]),default:n(()=>[h(" "+b(o(I)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),yt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ht=ge("div",{style:{display:"flex","align-items":"center"}},[ge("div",null,"报表任务")],-1),Kt=W({name:"reportmanagement_reporttask",__name:"index",setup(p){const _=qe(),{columns:d,columnChecks:s,data:v,getData:m,loading:R,mobilePagination:T,searchParams:r,resetSearchParams:g}=Ze({apiFn:Je,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"rname",title:"任务名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:f=>{var u;return e("div",null,[(u=P(ie).find(x=>x.value===f.rtype))==null?void 0:u.label])}},{key:"starttime",title:"执行时间",align:"center",width:160},{key:"operate",title:I("common.operate"),align:"center",width:160,render:f=>e("div",{class:"flex-center gap-8px"},[e(ft,null,{default:()=>[e(G,{type:"info",ghost:!0,size:"small",onClick:()=>w(f.id)},{default:()=>[h("详情")]})]}),L(e(G,{type:"warning",ghost:!0,size:"small",onClick:()=>C(f.id)},{default:()=>[h("修改")]}),[[te("no-auth"),"sys.report.task.update"]]),e(it,{onPositiveClick:()=>k(f.id)},{default:()=>"确定要删除改数据吗？",trigger:()=>L(e(G,{type:"error",ghost:!0,size:"small"},{default:()=>[h("删除")]}),[[te("no-auth"),"sys.report.task.delete"]])})])}]}),{drawerVisible:l,operateType:c,editingData:t,handleAdd:j,handleEdit:E,checkedRowKeys:D,onBatchDeleted:M,onDeleted:U,closeDrawer:H}=Qe(v,m),A=z(),$=z(!1),y=z({id:void 0,rname:"",rtype:0,ttype:0,starttime:void 0,endtime:void 0,excute:0,stype:0,recipient:"",rdesc:"",tid:void 0}),w=async f=>{$.value=!0;const{data:u,error:x}=await be(f);x||(y.value=u)},i=z();async function C(f){const{data:u,error:x}=await be(f);x||(i.value=u),E(f)}function k(f){B(f,u=>{U()})}async function J(){B(D.value.join(","),f=>{M()})}async function B(f,u){const{data:x,error:K}=await Xe(f);K||u&&u(x)}return(f,u)=>{const x=Me,K=tt,S=rt,X=ut,ae=se,ne=re,F=se;return O(),ee("div",yt,[e(vt,{model:o(r),"onUpdate:model":u[0]||(u[0]=a=>Q(r)?r.value=a:null),onReset:o(g),onSearch:o(m)},null,8,["model","onReset","onSearch"]),e(F,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[ht]),"header-extra":n(()=>[e(x,{columns:o(s),"onUpdate:columns":u[1]||(u[1]=a=>Q(s)?s.value=a:null),"disabled-delete":o(D).length===0,loading:o(R),onAdd:o(j),onRefresh:o(m),"is-view-add-button":o(ke)("sys.report.task.insert"),isViewDeleteButton:o(ke)("sys.report.task.delete"),onDelete:J},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","isViewDeleteButton"])]),default:n(()=>[e(K,{"checked-row-keys":o(D),"onUpdate:checkedRowKeys":u[2]||(u[2]=a=>Q(D)?D.value=a:null),columns:o(d),data:o(v),size:"small","flex-height":!o(_).isMobile,"scroll-x":962,loading:o(R),remote:"","row-key":a=>a.id,pagination:o(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(_t,{ref_key:"TaskModalRef",ref:A,visible:o(l),"onUpdate:visible":u[3]||(u[3]=a=>Q(l)?l.value=a:null),"operate-type":o(c),"row-data":i.value,onSubmitted:o(m)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(ne,{show:$.value,"onUpdate:show":u[4]||(u[4]=a=>$.value=a),preset:"card",class:"w-500px",title:"报表任务详情"},{default:n(()=>[e(ae,null,{default:n(()=>[e(X,{"label-placement":"left",column:1,"label-style":{width:"100px",display:"inline-block",textAlign:"right",marginRight:"10px"}},{default:n(()=>[e(S,{label:"任务名称"},{default:n(()=>[h(b(y.value.rname),1)]),_:1}),e(S,{label:"实例"},{default:n(()=>{var a;return[h(b((a=o(P)(o(ie)).find(N=>N.value===y.value.rtype))==null?void 0:a.label),1)]}),_:1}),e(S,{label:"开始时间"},{default:n(()=>[h(b(y.value.starttime),1)]),_:1}),e(S,{label:"任务类型"},{default:n(()=>{var a,N,de;return[h(b((a=o(P)(o(Se)).find(q=>q.value===y.value.ttype))==null?void 0:a.label)+" "+b(y.value.ttype==1?(N=A.value.weekOption().find(q=>q.value==y.value.excute))==null?void 0:N.label:y.value.ttype==2?(de=A.value.monthOption().find(q=>q.value==y.value.excute))==null?void 0:de.label:""),1)]}),_:1}),e(S,{label:"发送类型"},{default:n(()=>{var a;return[h(b((a=o(P)(o(Oe)).find(N=>N.value===y.value.stype))==null?void 0:a.label),1)]}),_:1}),e(S,{label:"收件人"},{default:n(()=>[h(b(y.value.recipient),1)]),_:1}),e(S,{label:"描述"},{default:n(()=>[h(b(y.value.rdesc),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})])}}});export{Kt as default};
