import{_ as Y}from"./round-plus--T3dOesv.js";import{_ as Z}from"./round-search-U_wZ0GRt.js";import{_ as ee}from"./round-refresh-BRVSTvae.js";import{d as te,a4 as ne,j as $,r as f,$ as c,ay as ae,g as t,at as oe,L as m,K as D,B as _,J as se,o as E,e as le,w as a,i as r,h,t as b,c as re,ah as ie,a2 as ce,A as pe,E as ue,D as de,ad as me,ai as _e,C as fe,ae as ge,af as ye,V as ve}from"./index-ByfxsQvj.js";import{_ as he}from"./lodash-21GmhknM.js";import{f as be,a as we,c as Ce,d as xe,e as De}from"./common-lZBul0dM.js";import{_ as ze}from"./Popconfirm-Bx1fZnQD.js";import{_ as ke}from"./FormItemGridItem-Dtr_7n7z.js";import{_ as Le}from"./Grid-B9K_tFX2.js";const Te={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function k(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!ie(w)}const Ne=te({name:"eventalarm_eventtype",__name:"index",setup(w){const F=ne(),g=$(!1),d=$(!1),u=f({fuzzy:"",pid:null}),l=f({pid:null,pname:null,id:null}),I=f({pid:{type:"number",required:!0,message:"请选择事件类别",trigger:["blur","change"]},pname:{type:"string",required:!0,message:"请输入事件类型",trigger:["blur","change"]}}),p=f({eventsCategoryDataList:[],eventsTypeDataList:[]}),A=f({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:n,endIndex:e,page:o,pageSize:s,pageCount:v,itemCount:C}){return`${p.eventsTypeDataList.length}条`}}),B=f([{key:"pid",title:"事件类别",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:n=>{var o;return(o=p.eventsCategoryDataList.find(s=>s.id===n.pid))==null?void 0:o.pname}},{key:"pname",title:"事件类型",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"sysparam",title:"系统内置",align:"center",width:120,render:n=>{const e={0:"success",1:"info"},o=c(ae[n.sysparam]);return t(oe,{size:"small",type:e[n.sysparam]},k(o)?o:{default:()=>[o]})}},{key:"operate",title:c("common.operate"),align:"center",width:160,render:n=>{let e;return n.sysparam!=0?t("div",{class:"flex-center gap-8px"},[m(t(_,{type:"primary",ghost:!0,size:"small",onClick:()=>M(n)},k(e=c("common.edit"))?e:{default:()=>[e]}),[[D("no-auth"),"event.type.update"]]),t(ze,{onPositiveClick:()=>R(n.id)},{default:()=>c("common.confirmDelete"),trigger:()=>{let o;return m(t(_,{type:"error",ghost:!0,size:"small"},k(o=c("common.delete"))?o:{default:()=>[o]}),[[D("no-auth"),"event.type.delete"]])}})]):null}}]);se(()=>{U(),y()});async function U(){try{const{data:n,error:e}=await be();e||(p.eventsCategoryDataList=n)}catch(n){console.error("Failed to fetch event categories:",n)}}async function y(){try{g.value=!0;const{data:n,error:e}=await we();e||(p.eventsTypeDataList=n)}catch(n){console.error("Failed to fetch event types:",n)}finally{g.value=!1}}const j=()=>{d.value=!0},V=async()=>{var n,e;try{if(l.id){const{data:o,error:s}=await De([l]);s||((e=window.$message)==null||e.success("修改成功"),d.value=!1,y())}else{const{data:o,error:s}=await xe([{pname:l.pname,pid:l.pid}]);s||((n=window.$message)==null||n.success("添加成功"),d.value=!1,y())}}catch(o){console.error("Failed to submit event type:",o)}},G=()=>{d.value=!1,l.pid=null,l.pname=null},R=async n=>{var e;try{const{data:o,error:s}=await Ce({ids:n});s||((e=window.$message)==null||e.success("删除成功"),y())}catch(o){console.error("Failed to delete event type:",o)}},M=n=>{d.value=!0,Object.assign(l,n)},O=()=>{u.fuzzy=null,u.pid=null,z()},z=()=>{g.value=!0;const{fuzzy:n,pid:e}=u;if(!n&&!e){y();return}const o=p.eventsTypeDataList.filter(s=>{const v=e?s.pid===e:!0,C=n?s.pname.toLowerCase().includes(n.toLowerCase()):!0;return v&&C});p.eventsTypeDataList=o,g.value=!1},q=he.throttle(z,1e3,{trailing:!1});return(n,e)=>{const o=ce,s=ke,v=pe,C=ee,W=Z,L=ue,J=Le,T=de,N=me,K=Y,P=_e,S=fe,H=ge,Q=ye,x=D("no-space"),X=D("no-auth");return E(),le("div",Te,[t(N,{title:"",bordered:!1,size:"small"},{header:a(()=>[t(T,{ref:"formRef",model:u,"label-placement":"left","label-width":"auto","show-feedback":!1},{default:a(()=>[t(J,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":12},{default:a(()=>[t(s,{span:"24 s:12 m:8 l:6",label:"类别",path:"pid"},{default:a(()=>[m(t(o,{clearable:"",value:u.pid,"onUpdate:value":[e[0]||(e[0]=i=>u.pid=i),z],placeholder:"请选择事件类别",options:p.eventsCategoryDataList,"reset-menu-on-options-change":!1,"value-field":"id","label-field":"pname"},null,8,["value","options"]),[[x]])]),_:1}),t(s,{span:"24 s:12 m:8 l:6",label:"类型",path:"fuzzy"},{default:a(()=>[m(t(v,{value:u.fuzzy,"onUpdate:value":e[1]||(e[1]=i=>u.fuzzy=i),placeholder:"请输入事件类型"},null,8,["value"]),[[x]])]),_:1}),t(s,{span:"24 s:12 m:8 l:6"},{default:a(()=>[t(L,{class:"w-full"},{default:a(()=>[t(r(_),{onClick:O},{icon:a(()=>[t(C,{class:"text-icon"})]),default:a(()=>[h(" "+b(r(c)("common.reset")),1)]),_:1}),t(r(_),{type:"primary",ghost:"",onClick:r(q)},{icon:a(()=>[t(W,{class:"text-icon"})]),default:a(()=>[h(" "+b(r(c)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(N,{title:"事件类型",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[m((E(),re(r(_),{size:"small",ghost:"",type:"primary",onClick:j},{icon:a(()=>[t(K,{class:"text-icon"})]),default:a(()=>[h(" "+b(r(c)("common.add")),1)]),_:1})),[[X,"event.type.insert"]])]),default:a(()=>[t(P,{columns:B,data:p.eventsTypeDataList,size:"small",pagination:A,"flex-height":!r(F).isMobile,"scroll-x":962,loading:g.value,remote:"","row-key":i=>i.id,class:"sm:h-full"},null,8,["columns","data","pagination","flex-height","loading","row-key"])]),_:1}),t(Q,{show:d.value,"onUpdate:show":e[4]||(e[4]=i=>d.value=i),"display-directive":"show",width:300},{default:a(()=>[t(H,{title:l.id?"编辑":"添加","native-scrollbar":!1,closable:""},{footer:a(()=>[t(L,{size:16},{default:a(()=>[t(r(_),{onClick:G},{default:a(()=>[h(b(r(c)("common.cancel")),1)]),_:1}),t(r(_),{type:"primary",onClick:V},{default:a(()=>[h(b(r(c)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(T,{ref:"formRef",model:l,rules:I},{default:a(()=>[t(S,{label:"事件类别",path:"pid"},{default:a(()=>[m(t(o,{clearable:"",value:l.pid,"onUpdate:value":e[2]||(e[2]=i=>l.pid=i),placeholder:"请选择事件类别",options:p.eventsCategoryDataList,"reset-menu-on-options-change":!1,"value-field":"id","label-field":"pname"},null,8,["value","options"]),[[x]])]),_:1}),t(S,{label:"事件类型",path:"pname"},{default:a(()=>[m(t(v,{value:l.pname,"onUpdate:value":e[3]||(e[3]=i=>l.pname=i),placeholder:"请输入事件类型"},null,8,["value"]),[[x]])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])])}}}),Ve=ve(Ne,[["__scopeId","data-v-dcf279de"]]);export{Ve as default};
