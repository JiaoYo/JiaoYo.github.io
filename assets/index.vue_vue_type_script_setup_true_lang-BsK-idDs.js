import{_ as me}from"./round-add--_pSpbF_.js";import{d as W,at as Q,q as X,v as le,s as se,a as fe,au as ee,a2 as J,c as U,o as w,w as t,f as e,G as te,z as A,A as re,h as o,aw as ie,C as O,N as ae,B as z,g as D,t as b,$ as R,b9 as _e,c0 as de,dK as ve,dL as ge,c4 as ye,r as G,cl as he,dM as be,y as H,av as we,D as q,e as v,b as K,T as xe,F as ce,cm as Se,a5 as ke,a4 as Ce,ay as je,dN as De,dO as Pe,U as ue,b_ as Ne,M as ze,i as Te,aB as Y,cn as $e,ad as Ie,dP as Ue,dQ as Le,aF as Me}from"./index-DMk9ecAg.js";import{u as Be,a as Fe}from"./table-C6eerTnn.js";import{u as Z}from"./usePageData-KTtgYQ98.js";import{_ as Re}from"./Avatar-BkzHb7bh.js";import{_ as qe}from"./text-DB5ihSVv.js";import{N as pe}from"./Popconfirm-ZXnEhqzl.js";import{_ as Ee}from"./round-search-D0NIJO1w.js";import{_ as Oe}from"./Grid-BIOqdWqR.js";import{_ as Ke}from"./FormItemGridItem-CblRT5zG.js";const Ve=W({name:"OperateDrawer",__name:"operate-drawer",props:Q({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(S,{emit:M}){const s=X(),T=M,r=S,a=le(y());function y(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null}}const f={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施"}},{pageData:m,getData:$,nextPage:I}=Z(de),k=async c=>{const n=c.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&m.data.length<m.total&&I()},P=async c=>{c?a.pid=c:a.value.pid=null},B=async()=>{var c,n;if(await $({fuzzy:(c=s.userInfo)==null?void 0:c.pname,page:1}),m.data.length==0)return(n=window.$message)==null?void 0:n.warning("没有项目")},_=()=>{$({page:1})};async function l(){Object.assign(a,y()),await B(),r.pid&&(m.data.forEach(c=>{c.id==r.pid&&(c.disabled=!0)}),a.pid=r.pid),r.operateType==="edit"&&r.rowData&&Object.assign(a,r.rowData)}const{formRef:x,validate:h,restoreValidation:F}=se(),L=fe(()=>({add:"新增项目总结",edit:"修改项目总结"})[r.operateType]),p=ee(S,"visible"),d=()=>{p.value=!1},C=async()=>{var c,n;if(await h(),r.operateType==="edit"){const{data:i,error:u}=await ve([{...a}]);u||((c=window.$message)==null||c.success("修改成功"),T("submitted"),d())}else{const{data:i,error:u}=await ge([{pid:a.pid,content1:a.content1,content2:a.content2,content3:a.content3,content4:a.content4,content5:a.content5}]);u||((n=window.$message)==null||n.success("添加成功"),T("submitted"),d())}};return J(p,()=>{p.value&&(l(),setTimeout(()=>{const c=document.querySelector(".n-scrollbar-content");c==null||c.scrollTo(0,0)},300),F())}),(c,n)=>{const i=re,u=te,j=ae,E=_e;return w(),U(E,{show:p.value,"onUpdate:show":n[6]||(n[6]=g=>p.value=g),title:L.value,preset:"card",class:"w-570px"},{footer:t(()=>[e(j,{justify:"end"},{default:t(()=>[e(o(z),{size:"small",class:"mt-16px",onClick:d},{default:t(()=>[D(b(o(R)("common.cancel")),1)]),_:1}),e(o(z),{type:"primary",size:"small",class:"mt-16px",onClick:C},{default:t(()=>[D(b(o(R)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(u,{ref_key:"formRef",ref:x,model:a,rules:f},{default:t(()=>[r.operateType==="add"?(w(),U(i,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:t(()=>[e(o(ie),{clearable:"",filterable:"",value:a.pid,"onUpdate:value":[n[0]||(n[0]=g=>a.pid=g),P],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:_,options:o(m).data,onScroll:k},null,8,["value","options"])]),_:1})):A("",!0),e(i,{label:"前期准备阶段描述",path:"content1"},{default:t(()=>[e(o(O),{clearable:"",type:"textarea",value:a.content1,"onUpdate:value":n[1]||(n[1]=g=>a.content1=g),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),e(i,{label:"遇到问题及对项目的影响",path:"content2"},{default:t(()=>[e(o(O),{clearable:"",type:"textarea",value:a.content2,"onUpdate:value":n[2]||(n[2]=g=>a.content2=g),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),e(i,{label:"经验教训与改进方案或措施",path:"content3"},{default:t(()=>[e(o(O),{clearable:"",type:"textarea",value:a.content3,"onUpdate:value":n[3]||(n[3]=g=>a.content3=g),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(i,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:t(()=>[e(o(O),{clearable:"",type:"textarea",value:a.content4,"onUpdate:value":n[4]||(n[4]=g=>a.content4=g),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(i,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:t(()=>[e(o(O),{clearable:"",type:"textarea",value:a.content5,"onUpdate:value":n[5]||(n[5]=g=>a.content5=g),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ae={class:"mt-4 border-t pt-3"},He={class:"flex items-start gap-2 mb-3"},Ge={class:"ml-2 flex-1"},Qe={class:"flex items-center"},Je={class:"font-medium font-size-16px font-bold"},We={class:"text-gray-600 mt-1"},Xe=W({name:"drawerLog",__name:"drawerLog",props:Q({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(S){const M=X();ye();const s=le({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""}),T=S,r={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},a=G({});async function y(){f.value=[],Object.assign(s,T.rowData),k()}const f=G([]),m=ee(S,"visible");J(m,()=>{m.value?y():(f.value=[],s.id=void 0)});function $(_){_||I()}function I(){m.value=!1}const k=async()=>{const{data:_,error:l}=await De({page:1,limit:100,pid:s.id});_&&(f.value=_.list)},P=he.debounce(async()=>{var h;const _=a.value[s.id];if(!(_!=null&&_.trim()))return(h=window.$message)==null?void 0:h.warning("请输入评论内容");const{data:l,error:x}=await be([{pid:s.id,content:_}]);l&&(a.value[s.id]="",s.num++,k())},1e3,{leading:!0,trailing:!1}),B=async _=>{var h;const{data:l,error:x}=await Pe(_.id);l&&(k(),s.num--,(h=window.$message)==null||h.success("删除成功"))};return(_,l)=>{const x=re,h=te,F=Re,L=qe,p=we,d=je,C=H("i"),c=H("no-auth");return w(),U(d,{show:m.value,"onUpdate:show":[l[1]||(l[1]=n=>m.value=n),$],"display-directive":"show",width:600,onMaskClick:I,onEsc:I},{default:t(()=>[e(p,{title:s.username+"的项目总结","native-scrollbar":!1,closable:""},{default:t(()=>[e(h,{ref:"formRef",model:s},{default:t(()=>[e(x,{label:"",path:"contractname"},{label:t(()=>l[2]||(l[2]=[v("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:t(()=>[v("span",null,b(s.proname),1)]),_:1}),e(x,{label:"前期准备阶段描述",path:"content1"},{label:t(()=>l[3]||(l[3]=[v("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:t(()=>[v("span",null,b(s.content1),1)]),_:1}),e(x,{label:"遇到问题及对项目的影响",path:"content2"},{label:t(()=>l[4]||(l[4]=[v("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:t(()=>[v("span",null,b(s.content2),1)]),_:1}),e(x,{label:"经验教训与改进方案或措施",path:"content3"},{label:t(()=>l[5]||(l[5]=[v("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:t(()=>[v("span",null,b(s.content3),1)]),_:1}),e(x,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:t(()=>l[6]||(l[6]=[v("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:t(()=>[v("span",null,b(s.content4),1)]),_:1}),e(x,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:t(()=>l[7]||(l[7]=[v("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:t(()=>[v("span",null,b(s.content5),1)]),_:1})]),_:1},8,["model"]),q((w(),K("div",null,[D(b(s.num)+"评论",1)])),[[C,s.num]]),e(xe,{name:"fade"},{default:t(()=>[v("div",Ae,[q((w(),K("div",He,[v("div",null,[e(F,{size:"small",src:r.avatar},null,8,["src"])]),e(o(O),{type:"textarea",id:`comment-input-${s.id}`,value:a.value[s.id],"onUpdate:value":l[0]||(l[0]=n=>a.value[s.id]=n),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ce(Se(o(P),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),e(o(z),{type:"primary",ghost:"",onClick:o(P)},{default:t(()=>l[8]||(l[8]=[D("发送")])),_:1,__:[8]},8,["onClick"])])),[[c,"project:Summary:Comment:insert"]]),(w(!0),K(ke,null,Ce(f.value,n=>(w(),K("div",{key:n.id,class:"flex mb-3"},[e(F,{size:"small",src:r.avatar},null,8,["src"]),v("div",Ge,[v("div",Qe,[v("span",Je,b(n.username),1),e(L,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:t(()=>[D(b(n.dbtime),1)]),_:2},1024),o(M).userInfo.id==n.creater?(w(),U(o(pe),{key:0,onPositiveClick:i=>B(n)},{trigger:t(()=>[q((w(),U(o(z),{quaternary:"",type:"error",size:"small"},{default:t(()=>l[9]||(l[9]=[D(" 删除 ")])),_:1,__:[9]})),[[c,"project:Summary:Comment:delete"]])]),default:t(()=>[l[10]||(l[10]=D(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):A("",!0)]),v("div",We,b(n.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ye=W({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["reset","search","clear"],["update:model"]),setup(S,{emit:M}){const s=M,{formRef:T}=se(),r=ee(S,"model"),a=X(),y=G([]),{pageData:f,getData:m,nextPage:$}=Z(de),I=async p=>{const d=p.currentTarget;d.scrollTop+d.offsetHeight>=d.scrollHeight&&f.data.length<f.total&&($(),y.value=f.data)},{pageData:k,getData:P}=Z(Ne),B=async p=>{const d=p.currentTarget;d.scrollTop+d.offsetHeight>=d.scrollHeight&&f.data.length<f.total&&$()},_=async p=>{r.value.creater=p,s("search")},l=async p=>{var d;p?(r.value.pid=p,s("search"),a.setProjectInfo({pname:(d=y.value.find(C=>C.id==p))==null?void 0:d.proname,pid:p})):s("search")},x=async p=>{await m({fuzzy:p,page:1}),y.value=f.data},h=async()=>{await m({page:1}),y.value=f.data};(async()=>{var p,d;await m({fuzzy:a.userInfo.pname}),y.value=f.data,r.value.pid=a.userInfo.pid?a.userInfo.pid:(p=y.value[0])==null?void 0:p.id,a.setProjectInfo({pid:r.value.pid,pname:(d=y.value.find(C=>C.id==r.value.pid))==null?void 0:d.proname}),s("search")})(),P({usertypes:"0,1,2,3,4"});async function L(){s("search")}return(p,d)=>{const C=ie,c=Ke,n=Ee,i=z,u=ae,j=Oe,E=te,g=ue;return w(),U(g,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(E,{ref_key:"formRef",ref:T,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ce(L,["enter"])},{default:t(()=>[e(j,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(c,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:t(()=>[e(C,{filterable:"",clearable:"",value:r.value.pid,"onUpdate:value":[d[0]||(d[0]=V=>r.value.pid=V),l],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:y.value,onScroll:I,onClear:h,onSearch:x},null,8,["value","options"])]),_:1}),e(c,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:t(()=>[e(C,{clearable:"",filterable:"",value:r.value.creater,"onUpdate:value":[d[1]||(d[1]=V=>r.value.creater=V),_],placeholder:"请选择","label-field":"username","value-field":"id",options:o(k).data,onScroll:B},null,8,["value","options"])]),_:1}),e(c,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(u,{class:"w-full"},{default:t(()=>[e(i,{type:"primary",ghost:"",onClick:L},{icon:t(()=>[e(n,{class:"text-icon"})]),default:t(()=>[D(" "+b(o(R)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ze={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},et={key:0};function oe(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Me(S)}const ut=W({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(S,{emit:M}){const s=ze(),T=X(),r=S,a=M,{columns:y,data:f,getData:m,loading:$,mobilePagination:I,searchParams:k}=Be({showTotal:!0,immediate:!1,apiFn:Ue,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:i=>e("div",null,[i.username+"的项目总结"])},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:R("common.operate"),align:"center",width:140,fixed:"right",render:i=>{let u;return e("div",{class:"flex-center gap-8px"},[e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>c(i)},{default:()=>[D("查看详情")]}),T.userInfo.id==i.creater&&q(e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>p(i.id)},oe(u=R("common.edit"))?u:{default:()=>[u]}),[[H("no-auth"),"project:Summary:update"]]),T.userInfo.id==i.creater&&e(pe,{onPositiveClick:()=>L(i.id)},{default:()=>R("common.confirmDelete"),trigger:()=>{let j;return q(e(z,{type:"error",ghost:!0,size:"small"},oe(j=R("common.delete"))?j:{default:()=>[j]}),[[H("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:P,operateType:B,editingData:_,handleAdd:l,handleEdit:x,checkedRowKeys:h,onDeleted:F}=Fe(f,m);async function L(i){const{data:u,error:j}=await Le(i);j||F()}function p(i){x(i)}const d=G(!1),C=G({}),c=i=>{d.value=!0,C.value=i},n=()=>{m()};return J(()=>r.pid,async i=>{i&&(k.pid=i,await m())}),J(()=>f.value,async i=>{i.length>0?a("thereIsData",1):a("thereIsData",0)}),Te(()=>{r.type!="externalLiaison"&&m()}),(i,u)=>{const j=ae,E=me,g=Ie,V=ue,ne=H("no-auth");return w(),K("div",Ze,[r.pid?A("",!0):(w(),U(Ye,{key:0,model:o(k),"onUpdate:model":u[0]||(u[0]=N=>Y(k)?k.value=N:null),onReset:n,onSearch:o(m),onClear:u[1]||(u[1]=N=>f.value=[])},null,8,["model","onSearch"])),e(V,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},$e({header:t(()=>[e(j,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[r.pid?A("",!0):(w(),K("div",et,"项目总结"))]),_:1}),r.pid?q((w(),U(o(z),{key:0,onClick:o(l),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(E,{class:"text-icon"})]),default:t(()=>[u[5]||(u[5]=D(" "+b("新增")))]),_:1,__:[5]},8,["onClick"])),[[ne,"project:Summary:insert"]]):A("",!0)]),default:t(()=>[e(g,{"checked-row-keys":o(h),"onUpdate:checkedRowKeys":u[2]||(u[2]=N=>Y(h)?h.value=N:null),columns:o(y),data:o(f),size:"small","flex-height":!o(s).isMobile,loading:o($),remote:"","row-key":N=>N.id,pagination:o(I),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ve,{visible:o(P),"onUpdate:visible":u[3]||(u[3]=N=>Y(P)?P.value=N:null),onSubmitted:o(m),"operate-type":o(B),pid:r.pid||o(k).pid,"row-data":o(_)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),e(Xe,{visible:d.value,"onUpdate:visible":u[4]||(u[4]=N=>d.value=N),"row-data":C.value},null,8,["visible","row-data"])]),_:2},[r.pid?void 0:{name:"header-extra",fn:t(()=>[e(j,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[q((w(),U(o(z),{onClick:o(l),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(E,{class:"text-icon"})]),default:t(()=>[u[6]||(u[6]=D(" "+b("新增")))]),_:1,__:[6]},8,["onClick"])),[[ne,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{ut as _};
