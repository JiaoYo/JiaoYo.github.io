import{_ as ze}from"./table-column-setting.vue_vue_type_script_setup_true_lang-OcyqE_AA.js";import{_ as Se}from"./round-delete-BqBuDm3k.js";import{_ as $e}from"./round-add-Br-lguCK.js";import{d as te,av as X,D as pe,A as ue,a as Re,at as ce,au as je,aQ as Le,d2 as qe,d3 as Pe,s as V,c as C,o as m,w as t,f as e,a3 as de,M as ae,h as n,H as R,aH as me,b as A,G as K,g as v,e as D,t as _,ay as Te,B as N,aB as Be,J as le,$ as S,a4 as fe,aG as Fe,bj as Me,L as Ie,a2 as ve,aI as Oe,E as Ve,F as ee,aJ as Q,az as Ee,I as W,aK as Ge,N as Ae,aS as Ke,d4 as se,Q as He,aT as Je,d5 as Qe,aP as We}from"./index-DdfiWQes.js";import{u as Xe,a as Ye}from"./table-CXVEJiiW.js";import{_ as _e}from"./Grid-CPKP2Pfd.js";import{_ as ge}from"./FormItemGridItem-DIoGuRnG.js";import{_ as Ze}from"./round-search-Cus0un5g.js";import{_ as et}from"./round-refresh-CRuVV6u5.js";import{N as re}from"./Popconfirm-DY3Dc_PH.js";const tt={key:0,style:{"margin-left":"20px"}},at={key:0,style:{"margin-left":"20px"}},lt={key:0,style:{"margin-left":"20px"}},nt={key:0,style:{"margin-left":"20px"}},ot=te({name:"OperateDrawer",__name:"operate-drawer",props:X({operateType:{},rowData:{},provinceList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(z,{emit:E}){const B=E,y=z,a=pe(F());function F(){return{id:"",dname:"",dcon:"",province:null,region:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}async function h(){Object.assign(a,F()),y.operateType==="edit"&&y.rowData&&Object.assign(a,y.rowData)}const{formRef:M,validate:$,restoreValidation:I}=ue(),T={dname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},province:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dcon:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},region:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},O=Re(()=>({add:"新增调度",edit:"修改调度"})[y.operateType]),g=ce(z,"visible");je(g,()=>{g.value&&(h(),setTimeout(()=>{const i=document.querySelector(".n-scrollbar-content");i==null||i.scrollTo(0,0)},300),I())});function j(){g.value=!1}const L=Le.debounce(async()=>{var i,l;if(await $(),y.operateType==="edit"){const{data:p,error:c}=await qe([a]);c||(j(),B("submitted"),(i=window.$message)==null||i.success("修改成功"))}else{const{data:p,error:c}=await Pe([{...a}]);c||(j(),B("submitted"),(l=window.$message)==null||l.success("添加成功"))}},1e3,{leading:!0,trailing:!0}),u=V(0),f=V("");async function w({file:i},l){u.value=0,f.value=l;const p=await Fe(i.file,i.name,"",c=>{u.value=c});p&&(a[l]=p,u.value=0)}async function q(i){return!0}async function P(i){if(i)try{const p=await(await fetch(i==null?void 0:i.split("?")[0],{mode:"cors"})).blob(),c=URL.createObjectURL(p),x=document.createElement("a");x.href=c,x.download=i==null?void 0:i.split("?")[1],x.style.display="none",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(c)}catch(l){console.error("下载失败:",l)}}return(i,l)=>{const p=ge,c=Te,x=Be,H=_e,G=ae,U=de,J=le,Y=fe;return m(),C(Y,{show:g.value,"onUpdate:show":l[16]||(l[16]=s=>g.value=s),title:O.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:t(()=>[e(J,{justify:"end",size:16},{default:t(()=>[e(n(N),{onClick:j},{default:t(()=>[v(_(n(S)("common.cancel")),1)]),_:1}),e(n(N),{type:"primary",onClick:n(L)},{default:t(()=>[v(_(n(S)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(U,{class:"pr-20px"},{default:t(()=>[e(G,{ref_key:"formRef",ref:M,model:a,rules:T,"label-placement":"left","label-width":120},{default:t(()=>[e(H,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 m:12",label:"主站名称",path:"dname"},{default:t(()=>[e(n(R),{value:a.dname,"onUpdate:value":l[0]||(l[0]=s=>a.dname=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"主站联系方式",path:"dcon"},{default:t(()=>[e(n(R),{value:a.dcon,"onUpdate:value":l[1]||(l[1]=s=>a.dcon=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"省份",path:"province"},{default:t(()=>[e(n(me),{filterable:"",options:y.provinceList,clearable:"",value:a.province,"onUpdate:value":l[2]||(l[2]=s=>a.province=s),"value-field":"id","label-field":"name"},null,8,["options","value"])]),_:1}),e(p,{span:"24 m:12",label:"地区",path:"region"},{default:t(()=>[e(n(R),{value:a.region,"onUpdate:value":l[3]||(l[3]=s=>a.region=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(p,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:t(()=>[e(H,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 m:12",label:"附件1",path:"notes"},{default:t(()=>[e(n(R),{value:a.re1,"onUpdate:value":l[4]||(l[4]=s=>a.re1=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var s;return[a.fl1?(m(),A("span",tt,[v(_((s=a.fl1)==null?void 0:s.split("?")[1])+" ",1),D("span",{class:"cursor-pointer c-#c92a2a",onClick:l[5]||(l[5]=d=>a.fl1="")},"删除"),D("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:l[6]||(l[6]=d=>P(a.fl1))},"下载")])):(m(),C(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":d=>w(d,"fl1"),"show-file-list":!1,onBeforeUpload:q},{default:t(()=>[e(n(N),{loading:u.value>0&&!a.fl1&&f.value=="fl1",size:"small",ghost:"",type:"primary"},{default:t(()=>[v(_(u.value>0&&!a.fl1&&f.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),u.value&&!a.fl1&&f.value=="fl1"?(m(),C(x,{key:2,type:"line",percentage:u.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):K("",!0)]}),_:1})]),_:1})]),_:1}),e(p,{span:"24 m:12",label:"附件2",path:"notes"},{default:t(()=>[e(n(R),{value:a.re2,"onUpdate:value":l[7]||(l[7]=s=>a.re2=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var s;return[a.fl2?(m(),A("span",at,[v(_((s=a.fl2)==null?void 0:s.split("?")[1])+" ",1),D("span",{class:"cursor-pointer c-#c92a2a",onClick:l[8]||(l[8]=d=>a.fl2="")},"删除"),D("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:l[9]||(l[9]=d=>P(a.fl2))},"下载")])):(m(),C(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":d=>w(d,"fl2"),"show-file-list":!1,onBeforeUpload:q},{default:t(()=>[e(n(N),{loading:u.value>0&&!a.fl2&&f.value=="fl2",size:"small",ghost:"",type:"primary"},{default:t(()=>[v(_(u.value>0&&!a.fl2&&f.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),u.value&&!a.fl2&&f.value=="fl2"?(m(),C(x,{key:2,type:"line",percentage:u.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):K("",!0)]}),_:1}),e(p,{span:"24 m:12",label:"附件3",path:"notes"},{default:t(()=>[e(n(R),{value:a.re3,"onUpdate:value":l[10]||(l[10]=s=>a.re3=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var s;return[a.fl3?(m(),A("span",lt,[v(_((s=a.fl3)==null?void 0:s.split("?")[1])+" ",1),D("span",{class:"cursor-pointer c-#c92a2a",onClick:l[11]||(l[11]=d=>a.fl3="")},"删除"),D("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:l[12]||(l[12]=d=>P(a.fl3))},"下载")])):(m(),C(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":d=>w(d,"fl3"),"show-file-list":!1,onBeforeUpload:q},{default:t(()=>[e(n(N),{loading:u.value>0&&!a.fl3&&f.value=="fl3",size:"small",ghost:"",type:"primary"},{default:t(()=>[v(_(u.value>0&&!a.fl3&&f.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),u.value&&!a.fl3&&f.value=="fl3"?(m(),C(x,{key:2,type:"line",percentage:u.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):K("",!0)]}),_:1}),e(p,{span:"24 m:12",label:"附件4",path:"notes"},{default:t(()=>[e(n(R),{value:a.re4,"onUpdate:value":l[13]||(l[13]=s=>a.re4=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var s;return[a.fl4?(m(),A("span",nt,[v(_((s=a.fl4)==null?void 0:s.split("?")[1])+" ",1),D("span",{class:"cursor-pointer c-#c92a2a",onClick:l[14]||(l[14]=d=>a.fl4="")},"删除"),D("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:l[15]||(l[15]=d=>P(a.fl4))},"下载")])):(m(),C(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":d=>w(d,"fl4"),"show-file-list":!1,onBeforeUpload:q},{default:t(()=>[e(n(N),{loading:u.value>0&&!a.fl4&&f.value=="fl4",size:"small",ghost:"",type:"primary"},{default:t(()=>[v(_(u.value>0&&!a.fl4&&f.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),u.value&&!a.fl4&&f.value=="fl4"?(m(),C(x,{key:2,type:"line",percentage:u.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):K("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),st=te({name:"FormSearch",__name:"form-search",props:X({provinceList:{}},{model:{required:!0},modelModifiers:{}}),emits:X(["reset","search"],["update:model"]),setup(z,{emit:E}){const B=z;Me();const y=E,{formRef:a,restoreValidation:F}=ue(),h=ce(z,"model");function M(){h.value.fuzzy="",y("search")}const $=()=>{h.value.region="",y("search")};async function I(){await F(),y("reset")}async function T(){y("search")}return(O,g)=>{const j=R,L=ge,u=me,f=et,w=N,q=Ze,P=le,i=_e,l=ae,p=ve;return m(),C(p,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(l,{ref_key:"formRef",ref:a,model:h.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ie(T,["enter"])},{default:t(()=>[e(i,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(L,{span:"24 s:12 m:6",label:"调度名称",path:"fuzzy"},{default:t(()=>[e(j,{clearable:"",value:h.value.fuzzy,"onUpdate:value":g[0]||(g[0]=c=>h.value.fuzzy=c),placeholder:"请输入调度名称",onClear:M},null,8,["value"])]),_:1}),e(L,{span:"24 s:12 m:4",label:"省份",path:"province"},{default:t(()=>[e(u,{clearable:"",filterable:"",value:h.value.province,"onUpdate:value":[g[1]||(g[1]=c=>h.value.province=c),T],placeholder:"请选择省份","label-field":"name","value-field":"id",options:B.provinceList},null,8,["value","options"])]),_:1}),e(L,{span:"24 s:12 m:6",label:"地区",path:"region"},{default:t(()=>[e(j,{clearable:"",value:h.value.region,"onUpdate:value":g[2]||(g[2]=c=>h.value.region=c),placeholder:"请输入地区",onClear:$},null,8,["value"])]),_:1}),e(L,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(P,{class:"w-full"},{default:t(()=>[e(w,{onClick:I},{icon:t(()=>[e(f,{class:"text-icon"})]),default:t(()=>[v(" "+_(n(S)("common.reset")),1)]),_:1}),e(w,{type:"primary",ghost:"",onClick:T},{icon:t(()=>[e(q,{class:"text-icon"})]),default:t(()=>[v(" "+_(n(S)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),rt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},it={style:{"font-weight":"500",color:"#1890ff","margin-right":"15px","font-size":"20px"}};function ie(z){return typeof z=="function"||Object.prototype.toString.call(z)==="[object Object]"&&!We(z)}const ht=te({name:"projectmanagement_dispatch",__name:"index",setup(z){const E=Oe(),{patternRules:B}=Ve(),y=V([]);(async()=>{const{data:r}=await Ke();r&&(y.value=r)})();const{columns:F,columnChecks:h,data:M,getData:$,loading:I,mobilePagination:T,searchParams:O}=Xe({showTotal:!0,apiFn:Qe,apiParams:{page:1,pageSize:20,limit:20,province:void 0,region:"",fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"dname",title:"主站名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"dcon",title:"主站联系方式",align:"center",width:120,ellipsis:{tooltip:!0},render:r=>e("span",{style:"cursor: pointer;color: #1890ff",onClick:()=>s(r)},[r.dcon])},{key:"provinceName",title:"省份",align:"center",width:120},{key:"region",title:"地区",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:S("common.operate"),align:"center",width:140,fixed:"right",render:r=>{let o;return e("div",{class:"flex-center gap-8px"},[W(e(N,{type:"primary",ghost:!0,size:"small",onClick:()=>p(r.id)},ie(o=S("common.edit"))?o:{default:()=>[o]}),[[ee("no-auth"),"project:Dispatch:update"]]),e(re,{onPositiveClick:()=>l(r.id)},{default:()=>S("common.confirmDelete"),trigger:()=>{let b;return W(e(N,{type:"error",ghost:!0,size:"small"},ie(b=S("common.delete"))?b:{default:()=>[b]}),[[ee("no-auth"),"project:Dispatch:delete"]])}})])}}]}),{drawerVisible:g,operateType:j,editingData:L,handleAdd:u,handleEdit:f,checkedRowKeys:w,onBatchDeleted:q,onDeleted:P}=Ye(M,$);async function i(){console.log(w.value),c(w.value.join(","),r=>{q()})}async function l(r){const{data:o,error:b}=await se(r);b||P()}function p(r){f(r)}async function c(r,o){const{data:b,error:Z}=await se(r);if(!Z)o&&o(b);else return!1}const x=r=>{$()},H=()=>{$()},G=V(!1),U=pe({id:"",name:"",pwd:""}),J=V(null),Y={pwd:[{required:!0,message:"请输入密码",trigger:"blur"},B.password]},s=r=>{U.id=r.id,G.value=!0,U.name=r.dname,U.pwd="",d.value=""},d=V(""),ye=async()=>{var b;await((b=J.value)==null?void 0:b.validate());const r=He(U.pwd),o=await Je({id:U.id,pwd:r});o.error||(d.value=o.data)},he=r=>{r&&navigator.clipboard.writeText(r).then(()=>{var o;(o=window.$message)==null||o.success("已复制到剪贴板")}).catch(()=>{var o;(o=window.$message)==null||o.error("复制失败，请手动复制")})};return(r,o)=>{const b=le,Z=$e,we=Se,be=ze,ke=Ee,xe=ve,Ce=R,ne=Ae,Ne=ae,De=de,Ue=fe,oe=ee("no-auth");return m(),A("div",rt,[e(st,{model:n(O),"onUpdate:model":o[0]||(o[0]=k=>Q(O)?O.value=k:null),onReset:H,onSearch:n($),provinceList:y.value},null,8,["model","onSearch","provinceList"]),e(xe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(b,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>o[7]||(o[7]=[D("div",null,"主站联系人",-1)])),_:1,__:[7]})]),"header-extra":t(()=>[e(b,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[W((m(),C(n(N),{onClick:n(u),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(Z,{class:"text-icon"})]),default:t(()=>[o[8]||(o[8]=v(" "+_("新增")))]),_:1,__:[8]},8,["onClick"])),[[oe,"project:Dispatch:insert"]]),e(n(re),{onPositiveClick:i},{trigger:t(()=>[W((m(),C(n(N),{size:"small",ghost:"",type:"error",disabled:n(w).length==0},{icon:t(()=>[e(we,{class:Ge(["text-icon",{"animate-spin":n(I)}])},null,8,["class"])]),default:t(()=>[o[9]||(o[9]=v(" "+_("批量删除")))]),_:1,__:[9]},8,["disabled"])),[[oe,"project:Dispatch:delete"]])]),default:t(()=>[o[10]||(o[10]=v(" 确定要删除选中的调度吗？ "))]),_:1,__:[10]}),e(be,{columns:n(h),"onUpdate:columns":o[1]||(o[1]=k=>Q(h)?h.value=k:null),ctype:10},null,8,["columns"])]),_:1})]),default:t(()=>[e(ke,{"checked-row-keys":n(w),"onUpdate:checkedRowKeys":o[2]||(o[2]=k=>Q(w)?w.value=k:null),columns:n(F),data:n(M),size:"small","flex-height":!n(E).isMobile,loading:n(I),remote:"","row-key":k=>k.id,pagination:n(T),class:"sm:h-full","onUpdate:filters":x},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(ot,{visible:n(g),"onUpdate:visible":o[3]||(o[3]=k=>Q(g)?g.value=k:null),onSubmitted:n($),"operate-type":n(j),provinceList:y.value,"row-data":n(L)},null,8,["visible","onSubmitted","operate-type","provinceList","row-data"])]),_:1}),e(Ue,{show:G.value,"onUpdate:show":o[6]||(o[6]=k=>G.value=k),title:"查看主站联系方式",preset:"card",class:"w-420px"},{footer:t(()=>[e(b,{justify:"end",size:16},{default:t(()=>[e(n(N),{type:"primary",onClick:ye},{default:t(()=>[v(_(n(S)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(De,{class:"max-h-480px pr-20px"},{default:t(()=>[e(Ne,{ref_key:"checkformRef",ref:J,model:U,"label-placement":"left",rules:Y,"label-width":80,"require-mark-placement":"left"},{default:t(()=>[e(ne,{label:n(S)("page.login.common.password"),path:"pwd"},{default:t(()=>[e(Ce,{type:"password","show-password-on":"click",clearable:"",value:U.pwd,"onUpdate:value":o[4]||(o[4]=k=>U.pwd=k),placeholder:"请输入当前登录账号密码"},null,8,["value"])]),_:1},8,["label"]),d.value?(m(),C(ne,{key:0,label:" "},{default:t(()=>[D("div",null,[D("span",null,_(`${U.name}的主站联系方式为：`),1),D("span",it,_(d.value),1),e(n(N),{size:"tiny",type:"primary",ghost:"",onClick:o[5]||(o[5]=k=>he(d.value))},{default:t(()=>o[11]||(o[11]=[v(" 复制 ")])),_:1,__:[11]})])]),_:1})):K("",!0)]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}});export{ht as default};
