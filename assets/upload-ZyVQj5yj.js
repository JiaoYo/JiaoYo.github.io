import{as as be,eo as Y}from"./index--GDXRx9n.js";import{v as Q}from"./v4-FuVw324d.js";var he=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},r(t,e)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),w;(function(r){r.InvalidFile="InvalidFile",r.InvalidToken="InvalidToken",r.InvalidMetadata="InvalidMetadata",r.InvalidChunkSize="InvalidChunkSize",r.InvalidCustomVars="InvalidCustomVars",r.NotAvailableUploadHost="NotAvailableUploadHost",r.ReadCacheFailed="ReadCacheFailed",r.InvalidCacheData="InvalidCacheData",r.WriteCacheFailed="WriteCacheFailed",r.RemoveCacheFailed="RemoveCacheFailed",r.GetCanvasContextFailed="GetCanvasContextFailed",r.UnsupportedFileType="UnsupportedFileType",r.FileReaderReadFailed="FileReaderReadFailed",r.NotAvailableXMLHttpRequest="NotAvailableXMLHttpRequest",r.InvalidProgressEventTarget="InvalidProgressEventTarget",r.RequestError="RequestError"})(w||(w={}));var _=function(){function r(t,e){this.name=t,this.message=e,this.stack=new Error().stack}return r}(),q=function(r){he(t,r);function t(e,i,o,n){var f=r.call(this,w.RequestError,o)||this;return f.code=e,f.reqId=i,f.isRequestError=!0,f.data=n,f}return t}(_),we=function(r){he(t,r);function t(e,i){return i===void 0&&(i=""),r.call(this,0,i,e)||this}return t}(q),_e=function(){function r(t,e){this.runTask=t,this.limit=e,this.aborted=!1,this.queue=[],this.processing=[]}return r.prototype.enqueue=function(t){var e=this;return new Promise(function(i,o){e.queue.push({task:t,resolve:i,reject:o}),e.check()})},r.prototype.run=function(t){var e=this;this.queue=this.queue.filter(function(i){return i!==t}),this.processing.push(t),this.runTask(t.task).then(function(){e.processing=e.processing.filter(function(i){return i!==t}),t.resolve(),e.check()},function(i){return t.reject(i)})},r.prototype.check=function(){var t=this;if(!this.aborted){var e=this.processing.length,i=this.limit-e;this.queue.slice(0,i).forEach(function(o){t.run(o)})}},r.prototype.abort=function(){this.queue=[],this.aborted=!0},r}(),xe=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},r(t,e)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),T=function(){return T=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},T.apply(this,arguments)},Ce=function(){function r(){this.closed=!1}return r.prototype.unsubscribe=function(){this.closed||(this.closed=!0,this._unsubscribe&&this._unsubscribe())},r.prototype.add=function(t){this._unsubscribe=t},r}(),Se=function(r){xe(t,r);function t(e,i,o){var n=r.call(this)||this;return n.isStopped=!1,e&&typeof e=="object"?n.destination=e:n.destination=T(T(T({},e&&{next:e}),i&&{error:i}),o&&{complete:o}),n}return t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this))},t.prototype.next=function(e){!this.isStopped&&this.destination.next&&this.destination.next(e)},t.prototype.error=function(e){!this.isStopped&&this.destination.error&&(this.isStopped=!0,this.destination.error(e))},t.prototype.complete=function(e){!this.isStopped&&this.destination.complete&&(this.isStopped=!0,this.destination.complete(e))},t}(Ce),Ae=function(){function r(t){this._subscribe=t}return r.prototype.subscribe=function(t,e,i){var o=new Se(t,e,i);return o.add(this._subscribe(o)),o},r}();function ke(r){if(r===null||typeof r>"u")return"";var t=r+"",e="",i,o,n=0;i=o=0,n=t.length;for(var f=0;f<n;f++){var d=t.charCodeAt(f),g=null;if(d<128)o++;else if(d>127&&d<2048)g=String.fromCharCode(d>>6|192,d&63|128);else if((d&63488^55296)>0)g=String.fromCharCode(d>>12|224,d>>6&63|128,d&63|128);else{if((d&64512^55296)>0)throw new RangeError("Unmatched trail surrogate at "+f);var a=t.charCodeAt(++f);if((a&64512^56320)>0)throw new RangeError("Unmatched lead surrogate at "+(f-1));d=((d&1023)<<10)+(a&1023)+65536,g=String.fromCharCode(d>>18|240,d>>12&63|128,d>>6&63|128,d&63|128)}g!==null&&(o>i&&(e+=t.slice(i,o)),e+=g,i=o=f+1)}return o>i&&(e+=t.slice(i,n)),e}function Ie(r){var t=[],e=0,i=0,o=0;for(r+="";e<r.length;){i=r.charCodeAt(e)&255,o=0,i<=191?(i=i&127,o=1):i<=223?(i=i&31,o=2):i<=239?(i=i&15,o=3):(i=i&7,o=4);for(var n=1;n<o;++n)i=i<<6|r.charCodeAt(n+e)&63;o===4?(i-=65536,t.push(String.fromCharCode(55296|i>>10&1023)),t.push(String.fromCharCode(56320|i&1023))):t.push(String.fromCharCode(i)),e+=o}return t.join("")}function Ue(r){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e,i,o,n,f,d,g,a,h=0,v=0,m="",x=[];if(!r)return r;r=ke(r+"");do e=r.charCodeAt(h++),i=r.charCodeAt(h++),o=r.charCodeAt(h++),a=e<<16|i<<8|o,n=a>>18&63,f=a>>12&63,d=a>>6&63,g=a&63,x[v++]=t.charAt(n)+t.charAt(f)+t.charAt(d)+t.charAt(g);while(h<r.length);switch(m=x.join(""),r.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"=";break}return m}function Fe(r){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e,i,o,n,f,d,g,a,h=0,v=0,m="",x=[];if(!r)return r;r+="";do n=t.indexOf(r.charAt(h++)),f=t.indexOf(r.charAt(h++)),d=t.indexOf(r.charAt(h++)),g=t.indexOf(r.charAt(h++)),a=n<<18|f<<12|d<<6|g,e=a>>16&255,i=a>>8&255,o=a&255,d===64?x[v++]=String.fromCharCode(e):g===64?x[v++]=String.fromCharCode(e,i):x[v++]=String.fromCharCode(e,i,o);while(h<r.length);return m=x.join(""),Ie(m)}function de(r){return r=Ue(r),r.replace(/\//g,"_").replace(/\+/g,"-")}function Oe(r){return r=r.replace(/_/g,"/").replace(/-/g,"+"),Fe(r)}var V={exports:{}},ee;function ze(){return ee||(ee=1,function(r,t){(function(e){r.exports=e()})(function(e){var i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function o(y,p){var u=y[0],s=y[1],l=y[2],c=y[3];u+=(s&l|~s&c)+p[0]-680876936|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&l)+p[1]-389564586|0,c=(c<<12|c>>>20)+u|0,l+=(c&u|~c&s)+p[2]+606105819|0,l=(l<<17|l>>>15)+c|0,s+=(l&c|~l&u)+p[3]-1044525330|0,s=(s<<22|s>>>10)+l|0,u+=(s&l|~s&c)+p[4]-176418897|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&l)+p[5]+1200080426|0,c=(c<<12|c>>>20)+u|0,l+=(c&u|~c&s)+p[6]-1473231341|0,l=(l<<17|l>>>15)+c|0,s+=(l&c|~l&u)+p[7]-45705983|0,s=(s<<22|s>>>10)+l|0,u+=(s&l|~s&c)+p[8]+1770035416|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&l)+p[9]-1958414417|0,c=(c<<12|c>>>20)+u|0,l+=(c&u|~c&s)+p[10]-42063|0,l=(l<<17|l>>>15)+c|0,s+=(l&c|~l&u)+p[11]-1990404162|0,s=(s<<22|s>>>10)+l|0,u+=(s&l|~s&c)+p[12]+1804603682|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&l)+p[13]-40341101|0,c=(c<<12|c>>>20)+u|0,l+=(c&u|~c&s)+p[14]-1502002290|0,l=(l<<17|l>>>15)+c|0,s+=(l&c|~l&u)+p[15]+1236535329|0,s=(s<<22|s>>>10)+l|0,u+=(s&c|l&~c)+p[1]-165796510|0,u=(u<<5|u>>>27)+s|0,c+=(u&l|s&~l)+p[6]-1069501632|0,c=(c<<9|c>>>23)+u|0,l+=(c&s|u&~s)+p[11]+643717713|0,l=(l<<14|l>>>18)+c|0,s+=(l&u|c&~u)+p[0]-373897302|0,s=(s<<20|s>>>12)+l|0,u+=(s&c|l&~c)+p[5]-701558691|0,u=(u<<5|u>>>27)+s|0,c+=(u&l|s&~l)+p[10]+38016083|0,c=(c<<9|c>>>23)+u|0,l+=(c&s|u&~s)+p[15]-660478335|0,l=(l<<14|l>>>18)+c|0,s+=(l&u|c&~u)+p[4]-405537848|0,s=(s<<20|s>>>12)+l|0,u+=(s&c|l&~c)+p[9]+568446438|0,u=(u<<5|u>>>27)+s|0,c+=(u&l|s&~l)+p[14]-1019803690|0,c=(c<<9|c>>>23)+u|0,l+=(c&s|u&~s)+p[3]-187363961|0,l=(l<<14|l>>>18)+c|0,s+=(l&u|c&~u)+p[8]+1163531501|0,s=(s<<20|s>>>12)+l|0,u+=(s&c|l&~c)+p[13]-1444681467|0,u=(u<<5|u>>>27)+s|0,c+=(u&l|s&~l)+p[2]-51403784|0,c=(c<<9|c>>>23)+u|0,l+=(c&s|u&~s)+p[7]+1735328473|0,l=(l<<14|l>>>18)+c|0,s+=(l&u|c&~u)+p[12]-1926607734|0,s=(s<<20|s>>>12)+l|0,u+=(s^l^c)+p[5]-378558|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^l)+p[8]-2022574463|0,c=(c<<11|c>>>21)+u|0,l+=(c^u^s)+p[11]+1839030562|0,l=(l<<16|l>>>16)+c|0,s+=(l^c^u)+p[14]-35309556|0,s=(s<<23|s>>>9)+l|0,u+=(s^l^c)+p[1]-1530992060|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^l)+p[4]+1272893353|0,c=(c<<11|c>>>21)+u|0,l+=(c^u^s)+p[7]-155497632|0,l=(l<<16|l>>>16)+c|0,s+=(l^c^u)+p[10]-1094730640|0,s=(s<<23|s>>>9)+l|0,u+=(s^l^c)+p[13]+681279174|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^l)+p[0]-358537222|0,c=(c<<11|c>>>21)+u|0,l+=(c^u^s)+p[3]-722521979|0,l=(l<<16|l>>>16)+c|0,s+=(l^c^u)+p[6]+76029189|0,s=(s<<23|s>>>9)+l|0,u+=(s^l^c)+p[9]-640364487|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^l)+p[12]-421815835|0,c=(c<<11|c>>>21)+u|0,l+=(c^u^s)+p[15]+530742520|0,l=(l<<16|l>>>16)+c|0,s+=(l^c^u)+p[2]-995338651|0,s=(s<<23|s>>>9)+l|0,u+=(l^(s|~c))+p[0]-198630844|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~l))+p[7]+1126891415|0,c=(c<<10|c>>>22)+u|0,l+=(u^(c|~s))+p[14]-1416354905|0,l=(l<<15|l>>>17)+c|0,s+=(c^(l|~u))+p[5]-57434055|0,s=(s<<21|s>>>11)+l|0,u+=(l^(s|~c))+p[12]+1700485571|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~l))+p[3]-1894986606|0,c=(c<<10|c>>>22)+u|0,l+=(u^(c|~s))+p[10]-1051523|0,l=(l<<15|l>>>17)+c|0,s+=(c^(l|~u))+p[1]-2054922799|0,s=(s<<21|s>>>11)+l|0,u+=(l^(s|~c))+p[8]+1873313359|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~l))+p[15]-30611744|0,c=(c<<10|c>>>22)+u|0,l+=(u^(c|~s))+p[6]-1560198380|0,l=(l<<15|l>>>17)+c|0,s+=(c^(l|~u))+p[13]+1309151649|0,s=(s<<21|s>>>11)+l|0,u+=(l^(s|~c))+p[4]-145523070|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~l))+p[11]-1120210379|0,c=(c<<10|c>>>22)+u|0,l+=(u^(c|~s))+p[2]+718787259|0,l=(l<<15|l>>>17)+c|0,s+=(c^(l|~u))+p[9]-343485551|0,s=(s<<21|s>>>11)+l|0,y[0]=u+y[0]|0,y[1]=s+y[1]|0,y[2]=l+y[2]|0,y[3]=c+y[3]|0}function n(y){var p=[],u;for(u=0;u<64;u+=4)p[u>>2]=y.charCodeAt(u)+(y.charCodeAt(u+1)<<8)+(y.charCodeAt(u+2)<<16)+(y.charCodeAt(u+3)<<24);return p}function f(y){var p=[],u;for(u=0;u<64;u+=4)p[u>>2]=y[u]+(y[u+1]<<8)+(y[u+2]<<16)+(y[u+3]<<24);return p}function d(y){var p=y.length,u=[1732584193,-271733879,-1732584194,271733878],s,l,c,C,k,I;for(s=64;s<=p;s+=64)o(u,n(y.substring(s-64,s)));for(y=y.substring(s-64),l=y.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<l;s+=1)c[s>>2]|=y.charCodeAt(s)<<(s%4<<3);if(c[s>>2]|=128<<(s%4<<3),s>55)for(o(u,c),s=0;s<16;s+=1)c[s]=0;return C=p*8,C=C.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(C[2],16),I=parseInt(C[1],16)||0,c[14]=k,c[15]=I,o(u,c),u}function g(y){var p=y.length,u=[1732584193,-271733879,-1732584194,271733878],s,l,c,C,k,I;for(s=64;s<=p;s+=64)o(u,f(y.subarray(s-64,s)));for(y=s-64<p?y.subarray(s-64):new Uint8Array(0),l=y.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<l;s+=1)c[s>>2]|=y[s]<<(s%4<<3);if(c[s>>2]|=128<<(s%4<<3),s>55)for(o(u,c),s=0;s<16;s+=1)c[s]=0;return C=p*8,C=C.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(C[2],16),I=parseInt(C[1],16)||0,c[14]=k,c[15]=I,o(u,c),u}function a(y){var p="",u;for(u=0;u<4;u+=1)p+=i[y>>u*8+4&15]+i[y>>u*8&15];return p}function h(y){var p;for(p=0;p<y.length;p+=1)y[p]=a(y[p]);return y.join("")}h(d("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function y(p,u){return p=p|0||0,p<0?Math.max(p+u,0):Math.min(p,u)}ArrayBuffer.prototype.slice=function(p,u){var s=this.byteLength,l=y(p,s),c=s,C,k,I,Z;return u!==e&&(c=y(u,s)),l>c?new ArrayBuffer(0):(C=c-l,k=new ArrayBuffer(C),I=new Uint8Array(k),Z=new Uint8Array(this,l,C),I.set(Z),k)}}();function v(y){return/[\u0080-\uFFFF]/.test(y)&&(y=unescape(encodeURIComponent(y))),y}function m(y,p){var u=y.length,s=new ArrayBuffer(u),l=new Uint8Array(s),c;for(c=0;c<u;c+=1)l[c]=y.charCodeAt(c);return p?l:s}function x(y){return String.fromCharCode.apply(null,new Uint8Array(y))}function S(y,p,u){var s=new Uint8Array(y.byteLength+p.byteLength);return s.set(new Uint8Array(y)),s.set(new Uint8Array(p),y.byteLength),s}function A(y){var p=[],u=y.length,s;for(s=0;s<u-1;s+=2)p.push(parseInt(y.substr(s,2),16));return String.fromCharCode.apply(String,p)}function b(){this.reset()}return b.prototype.append=function(y){return this.appendBinary(v(y)),this},b.prototype.appendBinary=function(y){this._buff+=y,this._length+=y.length;var p=this._buff.length,u;for(u=64;u<=p;u+=64)o(this._hash,n(this._buff.substring(u-64,u)));return this._buff=this._buff.substring(u-64),this},b.prototype.end=function(y){var p=this._buff,u=p.length,s,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c;for(s=0;s<u;s+=1)l[s>>2]|=p.charCodeAt(s)<<(s%4<<3);return this._finish(l,u),c=h(this._hash),y&&(c=A(c)),this.reset(),c},b.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},b.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},b.prototype.setState=function(y){return this._buff=y.buff,this._length=y.length,this._hash=y.hash,this},b.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},b.prototype._finish=function(y,p){var u=p,s,l,c;if(y[u>>2]|=128<<(u%4<<3),u>55)for(o(this._hash,y),u=0;u<16;u+=1)y[u]=0;s=this._length*8,s=s.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(s[2],16),c=parseInt(s[1],16)||0,y[14]=l,y[15]=c,o(this._hash,y)},b.hash=function(y,p){return b.hashBinary(v(y),p)},b.hashBinary=function(y,p){var u=d(y),s=h(u);return p?A(s):s},b.ArrayBuffer=function(){this.reset()},b.ArrayBuffer.prototype.append=function(y){var p=S(this._buff.buffer,y),u=p.length,s;for(this._length+=y.byteLength,s=64;s<=u;s+=64)o(this._hash,f(p.subarray(s-64,s)));return this._buff=s-64<u?new Uint8Array(p.buffer.slice(s-64)):new Uint8Array(0),this},b.ArrayBuffer.prototype.end=function(y){var p=this._buff,u=p.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l,c;for(l=0;l<u;l+=1)s[l>>2]|=p[l]<<(l%4<<3);return this._finish(s,u),c=h(this._hash),y&&(c=A(c)),this.reset(),c},b.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},b.ArrayBuffer.prototype.getState=function(){var y=b.prototype.getState.call(this);return y.buff=x(y.buff),y},b.ArrayBuffer.prototype.setState=function(y){return y.buff=m(y.buff,!0),b.prototype.setState.call(this,y)},b.ArrayBuffer.prototype.destroy=b.prototype.destroy,b.ArrayBuffer.prototype._finish=b.prototype._finish,b.ArrayBuffer.hash=function(y,p){var u=g(new Uint8Array(y)),s=h(u);return p?A(s):s},b})}(V)),V.exports}var Re=ze();const Ee=be(Re);var M=function(){return M=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},M.apply(this,arguments)},Pe=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(f){f(n)})}return new(e||(e=Promise))(function(n,f){function d(h){try{a(i.next(h))}catch(v){f(v)}}function g(h){try{a(i.throw(h))}catch(v){f(v)}}function a(h){h.done?n(h.value):o(h.value).then(d,g)}a((i=i.apply(r,t||[])).next())})},Le=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return g([a,h])}}function g(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=a[0]&2?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(r,e)}catch(h){a=[6,h],o=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},R=Math.pow(1024,2);function Te(r,t){var e=t*R;if(e>r.size)e=r.size;else for(;r.size>e*1e4;)e*=2;for(var i=[],o=Math.ceil(r.size/e),n=0;n<o;n++){var f=r.slice(e*n,n===o-1?r.size:e*(n+1));i.push(f)}return i}function He(r){return Object.keys(r).every(function(t){return t.indexOf("x-qn-meta-")===0})}function qe(r){return Object.keys(r).every(function(t){return t.indexOf("x:")===0})}function De(r){return r.reduce(function(t,e){return t+e},0)}function Be(r,t,e){try{localStorage.setItem(r,JSON.stringify(t))}catch{e.warn(new _(w.WriteCacheFailed,"setLocalFileInfo failed: "+r))}}function Me(r,t,e){var i=t==null?"_":"_key_"+t+"_";return"qiniu_js_sdk_upload_file_name_"+r+i+"size_"+e}function J(r,t){try{localStorage.removeItem(r)}catch{t.warn(new _(w.RemoveCacheFailed,"removeLocalFileInfo failed. key: "+r))}}function je(r,t){var e=null;try{e=localStorage.getItem(r)}catch{t.warn(new _(w.ReadCacheFailed,"getLocalFileInfo failed. key: "+r))}if(e==null)return null;var i=null;try{i=JSON.parse(e)}catch{J(r,t),t.warn(new _(w.InvalidCacheData,"getLocalFileInfo failed to parse. key: "+r))}return i}function $(r){var t="UpToken "+r;return{Authorization:t}}function $e(r){var t=$(r);return M({"content-type":"application/octet-stream"},t)}function Ve(r){var t=$(r);return M({"content-type":"application/json"},t)}function pe(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)return new window.ActiveXObject("Microsoft.XMLHTTP");throw new _(w.NotAvailableXMLHttpRequest,"the current environment does not support.")}function Ge(r){return Pe(this,void 0,void 0,function(){var t,e;return Le(this,function(i){switch(i.label){case 0:return[4,Ne(r)];case 1:return t=i.sent(),e=new Ee.ArrayBuffer,e.append(t),[2,e.end()]}})})}function Ne(r){return new Promise(function(t,e){var i=new FileReader;i.onload=function(o){if(o.target){var n=o.target.result;t(n)}else e(new _(w.InvalidProgressEventTarget,"progress event target is undefined"))},i.onerror=function(){e(new _(w.FileReaderReadFailed,"fileReader read failed"))},i.readAsArrayBuffer(r)})}function D(r,t){return new Promise(function(e,i){var o=pe();if(o.open(t.method,r),t.onCreate&&t.onCreate(o),t.headers){var n=t.headers;Object.keys(n).forEach(function(f){o.setRequestHeader(f,n[f])})}o.upload.addEventListener("progress",function(f){f.lengthComputable&&t.onProgress&&t.onProgress({loaded:f.loaded,total:f.total})}),o.onreadystatechange=function(){var f=o.responseText;if(o.readyState===4){var d=o.getResponseHeader("x-reqId")||"";if(o.status===0){i(new we("network error.",d));return}if(o.status!==200){var g="xhr request failed, code: "+o.status;f&&(g+=" response: "+f);var a=void 0;try{a=JSON.parse(f)}catch{}i(new q(o.status,d,g,a));return}try{e({data:JSON.parse(f),reqId:d})}catch(h){i(h)}}},o.send(t.body)})}function Xe(r){if(r&&r.match){var t=r.match(/(^https?)/);if(!t)return"";var e=t[1];return t=r.match(/^https?:\/\/([^:^/]*):(\d*)/),t?t[2]:e==="http"?"80":"443"}return""}function Ke(r){if(r&&r.match){var t=r.match(/^https?:\/\/([^:^/]*)/);return t?t[1]:""}return""}function W(r){if(!r)throw new _(w.InvalidToken,"invalid token.");var t=r.split(":");if(t.length===1)throw new _(w.InvalidToken,"invalid token segments.");var e=t.length>3?t[1]:t[0];if(!e)throw new _(w.InvalidToken,"missing assess key field.");var i=null;try{i=JSON.parse(Oe(t[t.length-1]))}catch{throw new _(w.InvalidToken,"token parse failed.")}if(i==null)throw new _(w.InvalidToken,"putPolicy is null.");if(i.scope==null)throw new _(w.InvalidToken,"scope field is null.");var o=i.scope.split(":")[0];if(!o)throw new _(w.InvalidToken,"resolve bucketName failed.");return{assessKey:e,bucketName:o,scope:i.scope}}var U,F={z0:"z0",z1:"z1",z2:"z2",na0:"na0",as0:"as0",cnEast2:"cn-east-2"},Je=(U={},U[F.z0]={srcUphost:["up.qiniup.com"],cdnUphost:["upload.qiniup.com"]},U[F.z1]={srcUphost:["up-z1.qiniup.com"],cdnUphost:["upload-z1.qiniup.com"]},U[F.z2]={srcUphost:["up-z2.qiniup.com"],cdnUphost:["upload-z2.qiniup.com"]},U[F.na0]={srcUphost:["up-na0.qiniup.com"],cdnUphost:["upload-na0.qiniup.com"]},U[F.as0]={srcUphost:["up-as0.qiniup.com"],cdnUphost:["upload-as0.qiniup.com"]},U[F.cnEast2]={srcUphost:["up-cn-east-2.qiniup.com"],cdnUphost:["upload-cn-east-2.qiniup.com"]},U),z={},G,te;function We(){if(te)return G;te=1;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}return G=function(t,e,i,o){e=e||"&",i=i||"=";var n={};if(typeof t!="string"||t.length===0)return n;var f=/\+/g;t=t.split(e);var d=1e3;o&&typeof o.maxKeys=="number"&&(d=o.maxKeys);var g=t.length;d>0&&g>d&&(g=d);for(var a=0;a<g;++a){var h=t[a].replace(f,"%20"),v=h.indexOf(i),m,x,S,A;v>=0?(m=h.substr(0,v),x=h.substr(v+1)):(m=h,x=""),S=decodeURIComponent(m),A=decodeURIComponent(x),r(n,S)?Array.isArray(n[S])?n[S].push(A):n[S]=[n[S],A]:n[S]=A}return n},G}var N,ne;function Ze(){if(ne)return N;ne=1;var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};return N=function(t,e,i,o){return e=e||"&",i=i||"=",t===null&&(t=void 0),typeof t=="object"?Object.keys(t).map(function(n){var f=encodeURIComponent(r(n))+i;return Array.isArray(t[n])?t[n].map(function(d){return f+encodeURIComponent(r(d))}).join(e):f+encodeURIComponent(r(t[n]))}).filter(Boolean).join(e):o?encodeURIComponent(r(o))+i+encodeURIComponent(r(t)):""},N}var re;function Ye(){return re||(re=1,z.decode=z.parse=We(),z.encode=z.stringify=Ze()),z}var Qe=Ye(),O=function(){return O=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},O.apply(this,arguments)},et=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(f){f(n)})}return new(e||(e=Promise))(function(n,f){function d(h){try{a(i.next(h))}catch(v){f(v)}}function g(h){try{a(i.throw(h))}catch(v){f(v)}}function a(h){h.done?n(h.value):o(h.value).then(d,g)}a((i=i.apply(r,t||[])).next())})},tt=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return g([a,h])}}function g(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=a[0]&2?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(r,e)}catch(h){a=[6,h],o=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function nt(r,t,e){return et(this,void 0,void 0,function(){var i,o;return tt(this,function(n){return i=Qe.stringify({ak:r,bucket:t}),o=e+"://api.qiniu.com/v2/query?"+i,[2,D(o,{method:"GET"})]})})}function ye(r,t,e){var i=e.url,o=e.id;return i+"/buckets/"+r+"/objects/"+(t!=null?de(t):"~")+"/uploads/"+o}function rt(r,t,e,i){var o=i+"/buckets/"+t+"/objects/"+(e!=null?de(e):"~")+"/uploads";return D(o,{method:"POST",headers:$(r)})}function it(r,t,e,i,o){var n=W(r).bucketName,f=ye(n,t,i)+("/"+e),d=$e(r);return o.md5&&(d["Content-MD5"]=o.md5),D(f,O(O({},o),{method:"PUT",headers:d}))}function ot(r,t,e,i){var o=W(r).bucketName,n=ye(o,t,e);return D(n,O(O({},i),{method:"POST",headers:Ve(r)}))}function at(r,t,e){return D(r,O({method:"POST",body:t},e))}var j=function(){return j=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},j.apply(this,arguments)},ie=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(f){f(n)})}return new(e||(e=Promise))(function(n,f){function d(h){try{a(i.next(h))}catch(v){f(v)}}function g(h){try{a(i.throw(h))}catch(v){f(v)}}function a(h){h.done?n(h.value):o(h.value).then(d,g)}a((i=i.apply(r,t||[])).next())})},oe=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return g([a,h])}}function g(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=a[0]&2?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(r,e)}catch(h){a=[6,h],o=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},st=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,n=[],f;try{for(;(t===void 0||t-- >0)&&!(o=i.next()).done;)n.push(o.value)}catch(d){f={error:d}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(f)throw f.error}}return n},ut=function(){for(var r=[],t=0;t<arguments.length;t++)r=r.concat(st(arguments[t]));return r},ct=4,ge=[0,502,503,504,599],ft=ut(ge,[406]),lt=Math.pow(1024,3),ve=function(){function r(t,e,i,o){this.hostPool=i,this.logger=o,this.aborted=!1,this.retryCount=0,this.xhrList=[],this.config=t.config,o.info("config inited.",this.config),this.putExtra=j({fname:""},t.putExtra),o.info("putExtra inited.",this.putExtra),this.key=t.key,this.file=t.file,this.token=t.token,this.onData=e.onData,this.onError=e.onError,this.onComplete=e.onComplete;try{var n=W(this.token);this.bucketName=n.bucketName,this.assessKey=n.assessKey}catch(f){o.error("get putPolicy from token failed.",f),this.onError(f)}}return r.prototype.checkAndUpdateUploadHost=function(){return ie(this,void 0,void 0,function(){var t;return oe(this,function(e){switch(e.label){case 0:return this.logger.info("get available upload host."),[4,this.hostPool.getUp(this.assessKey,this.bucketName,this.config.upprotocol)];case 1:if(t=e.sent(),t==null)throw new _(w.NotAvailableUploadHost,"no available upload host.");return this.uploadHost!=null&&this.uploadHost.host!==t.host?this.logger.warn("host switches from "+this.uploadHost.host+" to "+t.host+"."):this.logger.info("use host "+t.host+"."),this.uploadHost=t,[2]}})})},r.prototype.checkAndUnfreezeHost=function(){this.logger.info("check unfreeze host."),this.uploadHost!=null&&this.uploadHost.isFrozen()&&(this.logger.warn(this.uploadHost.host+" will be unfrozen."),this.uploadHost.unfreeze())},r.prototype.checkAndFreezeHost=function(t){this.logger.info("check freeze host."),t instanceof q&&this.uploadHost!=null&&ge.includes(t.code)&&(this.logger.warn(this.uploadHost.host+" will be temporarily frozen."),this.uploadHost.freeze())},r.prototype.handleError=function(t){this.logger.error(t.message),this.onError(t)},r.prototype.putFile=function(){return ie(this,void 0,void 0,function(){var t,e,i,o;return oe(this,function(n){switch(n.label){case 0:if(this.aborted=!1,this.putExtra.fname||(this.logger.info("use file.name as fname."),this.putExtra.fname=this.file.name),this.file.size>1e4*lt)return this.handleError(new _(w.InvalidFile,"file size exceed maximum value 10000G")),[2];if(this.putExtra.customVars&&!qe(this.putExtra.customVars))return this.handleError(new _(w.InvalidCustomVars,"customVars key should start width x:")),[2];if(this.putExtra.metadata&&!He(this.putExtra.metadata))return this.handleError(new _(w.InvalidMetadata,"metadata key should start with x-qn-meta-")),[2];n.label=1;case 1:return n.trys.push([1,4,,5]),this.uploadAt=new Date().getTime(),[4,this.checkAndUpdateUploadHost()];case 2:return n.sent(),[4,this.run()];case 3:return t=n.sent(),this.onComplete(t.data),this.checkAndUnfreezeHost(),this.sendLog(t.reqId,200),[2];case 4:return e=n.sent(),this.aborted?(this.logger.warn("upload is aborted."),this.sendLog("",-2),[2]):(this.clear(),this.logger.error(e),e instanceof q&&(this.sendLog(e.reqId,e.code),this.checkAndFreezeHost(e),i=++this.retryCount<=this.config.retryCount,o=ft.includes(e.code),o&&i)?(this.logger.warn("error auto retry: "+this.retryCount+"/"+this.config.retryCount+"."),this.putFile(),[2]):(this.onError(e),[3,5]));case 5:return[2]}})})},r.prototype.clear=function(){this.xhrList.forEach(function(t){t.onreadystatechange=null,t.abort()}),this.xhrList=[],this.logger.info("cleanup uploading xhr.")},r.prototype.stop=function(){this.logger.info("aborted."),this.clear(),this.aborted=!0},r.prototype.addXhr=function(t){this.xhrList.push(t)},r.prototype.sendLog=function(t,e){var i,o;this.logger.report({code:e,reqId:t,remoteIp:"",upType:"jssdk-h5",size:this.file.size,time:Math.floor(this.uploadAt/1e3),port:Xe((i=this.uploadHost)===null||i===void 0?void 0:i.getUrl()),host:Ke((o=this.uploadHost)===null||o===void 0?void 0:o.getUrl()),bytesSent:this.progress?this.progress.total.loaded:0,duration:Math.floor((new Date().getTime()-this.uploadAt)/1e3)})},r.prototype.getProgressInfoItem=function(t,e,i){return j({size:e,loaded:t,percent:t/e*100},i==null?{}:{fromCache:i})},r}(),ht=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},r(t,e)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),H=function(){return H=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},H.apply(this,arguments)},P=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(f){f(n)})}return new(e||(e=Promise))(function(n,f){function d(h){try{a(i.next(h))}catch(v){f(v)}}function g(h){try{a(i.throw(h))}catch(v){f(v)}}function a(h){h.done?n(h.value):o(h.value).then(d,g)}a((i=i.apply(r,t||[])).next())})},L=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return g([a,h])}}function g(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=a[0]&2?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(r,e)}catch(h){a=[6,h],o=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function dt(r){var t=/^[1-9]\d*$/;return t.test(String(r))}var pt=function(r){ht(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return P(this,void 0,void 0,function(){var e,i,o,n,f,d=this;return L(this,function(g){switch(g.label){case 0:if(this.logger.info("start run Resume."),!this.config.chunkSize||!dt(this.config.chunkSize))throw new _(w.InvalidChunkSize,"chunkSize must be a positive integer");if(this.config.chunkSize>1024)throw new _(w.InvalidChunkSize,"chunkSize maximum value is 1024");return[4,this.initBeforeUploadChunks()];case 1:g.sent(),e=new _e(function(a){return P(d,void 0,void 0,function(){return L(this,function(h){switch(h.label){case 0:if(this.aborted)throw e.abort(),new Error("pool is aborted");return[4,this.uploadChunk(a)];case 1:return h.sent(),[2]}})})},this.config.concurrentRequestLimit),i=null,o=this.getLocalKey(),n=this.chunks.map(function(a,h){return e.enqueue({chunk:a,index:h})}),g.label=2;case 2:return g.trys.push([2,5,,6]),[4,Promise.all(n)];case 3:return g.sent(),[4,this.mkFileReq()];case 4:return i=g.sent(),[3,6];case 5:throw f=g.sent(),f instanceof q&&(f.code===612||f.code===400)&&J(o,this.logger),f;case 6:return J(o,this.logger),[2,i]}})})},t.prototype.uploadChunk=function(e){return P(this,void 0,void 0,function(){var i,o,n,f,d,g,a,h,v,m=this;return L(this,function(x){switch(x.label){case 0:return i=e.index,o=e.chunk,n=this.cachedUploadedList[i],this.logger.info("upload part "+i+", cache:",n),f=this.config.checkByMD5,d=function(){m.usedCacheList[i]=!0,m.updateChunkProgress(o.size,i),m.uploadedList[i]=n,m.updateLocalCache()},n&&!f?(d(),[2]):[4,Ge(o)];case 1:return g=x.sent(),this.logger.info("computed part md5.",g),n&&g===n.md5?(d(),[2]):(this.usedCacheList[i]=!1,a=function(S){m.updateChunkProgress(S.loaded,i)},h={body:o,md5:this.config.checkByServer?g:void 0,onProgress:a,onCreate:function(S){return m.addXhr(S)}},this.logger.info("part "+i+" start uploading."),[4,it(this.token,this.key,e.index+1,this.getUploadInfo(),h)]);case 2:return v=x.sent(),this.logger.info("part "+i+" upload completed."),a({loaded:o.size,total:o.size}),this.uploadedList[i]={etag:v.data.etag,md5:v.data.md5,size:o.size},this.updateLocalCache(),[2]}})})},t.prototype.mkFileReq=function(){return P(this,void 0,void 0,function(){var e,i,o=this;return L(this,function(n){switch(n.label){case 0:return e=H(H(H({parts:this.uploadedList.map(function(f,d){return{etag:f.etag,partNumber:d+1}}),fname:this.putExtra.fname},this.putExtra.mimeType&&{mimeType:this.putExtra.mimeType}),this.putExtra.customVars&&{customVars:this.putExtra.customVars}),this.putExtra.metadata&&{metadata:this.putExtra.metadata}),this.logger.info("parts upload completed, make file.",e),[4,ot(this.token,this.key,this.getUploadInfo(),{onCreate:function(f){return o.addXhr(f)},body:JSON.stringify(e)})];case 1:return i=n.sent(),this.logger.info("finish Resume Progress."),this.updateMkFileProgress(1),[2,i]}})})},t.prototype.initBeforeUploadChunks=function(){return P(this,void 0,void 0,function(){var e,i,o;return L(this,function(n){switch(n.label){case 0:return this.uploadedList=[],this.usedCacheList=[],e=je(this.getLocalKey(),this.logger),e?[3,2]:(this.logger.info("init upload parts from api."),[4,rt(this.token,this.bucketName,this.key,this.uploadHost.getUrl())]);case 1:return i=n.sent(),this.logger.info("initd upload parts of id: "+i.data.uploadId+"."),this.uploadId=i.data.uploadId,this.cachedUploadedList=[],[3,3];case 2:o=["resume upload parts from local cache,","total "+e.data.length+" part,","id is "+e.id+"."],this.logger.info(o.join(" ")),this.cachedUploadedList=e.data,this.uploadId=e.id,n.label=3;case 3:return this.chunks=Te(this.file,this.config.chunkSize),this.loaded={mkFileProgress:0,chunks:this.chunks.map(function(f){return 0})},this.notifyResumeProgress(),[2]}})})},t.prototype.getUploadInfo=function(){return{id:this.uploadId,url:this.uploadHost.getUrl()}},t.prototype.getLocalKey=function(){return Me(this.file.name,this.key,this.file.size)},t.prototype.updateLocalCache=function(){Be(this.getLocalKey(),{id:this.uploadId,data:this.uploadedList},this.logger)},t.prototype.updateChunkProgress=function(e,i){this.loaded.chunks[i]=e,this.notifyResumeProgress()},t.prototype.updateMkFileProgress=function(e){this.loaded.mkFileProgress=e,this.notifyResumeProgress()},t.prototype.notifyResumeProgress=function(){var e=this;this.progress={total:this.getProgressInfoItem(De(this.loaded.chunks)+this.loaded.mkFileProgress,this.file.size+1),chunks:this.chunks.map(function(i,o){var n=e.usedCacheList[o];return e.getProgressInfoItem(e.loaded.chunks[o],i.size,n)}),uploadInfo:{id:this.uploadId,url:this.uploadHost.getUrl()}},this.onData(this.progress)},t}(ve),ae=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(f){f(n)})}return new(e||(e=Promise))(function(n,f){function d(h){try{a(i.next(h))}catch(v){f(v)}}function g(h){try{a(i.throw(h))}catch(v){f(v)}}function a(h){h.done?n(h.value):o(h.value).then(d,g)}a((i=i.apply(r,t||[])).next())})},se=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return g([a,h])}}function g(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=a[0]&2?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(r,e)}catch(h){a=[6,h],o=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},yt=function(){function r(){this.crc=-1,this.table=this.makeTable()}return r.prototype.makeTable=function(){for(var t=new Array,e=0;e<256;e++){for(var i=e,o=0;o<8;o++)i&1?i=i>>>1^3988292384:i>>>=1;t[e]=i}return t},r.prototype.append=function(t){for(var e=this.crc,i=0;i<t.byteLength;i++)e=e>>>8^this.table[(e^t[i])&255];this.crc=e},r.prototype.compute=function(){return(this.crc^-1)>>>0},r.prototype.readAsUint8Array=function(t){return ae(this,void 0,void 0,function(){var e;return se(this,function(i){switch(i.label){case 0:return typeof t.arrayBuffer!="function"?[3,2]:(e=Uint8Array.bind,[4,t.arrayBuffer()]);case 1:return[2,new(e.apply(Uint8Array,[void 0,i.sent()]))];case 2:return[2,new Promise(function(o,n){var f=new FileReader;f.onload=function(){if(f.result==null){n();return}if(typeof f.result=="string"){n();return}o(new Uint8Array(f.result))},f.readAsArrayBuffer(t)})]}})})},r.prototype.file=function(t){return ae(this,void 0,void 0,function(){var e,i,o,n,f,d;return se(this,function(g){switch(g.label){case 0:return t.size<=R?(e=this.append,[4,this.readAsUint8Array(t)]):[3,2];case 1:return e.apply(this,[g.sent()]),[2,this.compute()];case 2:i=Math.ceil(t.size/R),o=0,g.label=3;case 3:return o<i?(n=o*R,f=o===i-1?t.size:n+R,[4,this.readAsUint8Array(t.slice(n,f))]):[3,6];case 4:d=g.sent(),this.append(new Uint8Array(d)),g.label=5;case 5:return o++,[3,3];case 6:return[2,this.compute()]}})})},r.file=function(t){var e=new r;return e.file(t)},r}(),gt=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n])},r(t,e)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),vt=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(f){f(n)})}return new(e||(e=Promise))(function(n,f){function d(h){try{a(i.next(h))}catch(v){f(v)}}function g(h){try{a(i.throw(h))}catch(v){f(v)}}function a(h){h.done?n(h.value):o(h.value).then(d,g)}a((i=i.apply(r,t||[])).next())})},mt=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return g([a,h])}}function g(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=a[0]&2?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(r,e)}catch(h){a=[6,h],o=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},ue=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return vt(this,void 0,void 0,function(){var e,i,o,n,f,d=this;return mt(this,function(g){switch(g.label){case 0:return this.logger.info("start run Direct."),e=new FormData,e.append("file",this.file),e.append("token",this.token),this.key!=null&&e.append("key",this.key),e.append("fname",this.putExtra.fname),this.config.checkByServer?[4,yt.file(this.file)]:[3,2];case 1:i=g.sent(),e.append("crc32",i.toString()),g.label=2;case 2:return this.putExtra.customVars&&(this.logger.info("init customVars."),o=this.putExtra.customVars,Object.keys(o).forEach(function(a){return e.append(a,o[a].toString())}),this.logger.info("customVars inited.")),this.putExtra.metadata&&(this.logger.info("init metadata."),n=this.putExtra.metadata,Object.keys(n).forEach(function(a){return e.append(a,n[a].toString())})),this.logger.info("formData inited."),[4,at(this.uploadHost.getUrl(),e,{onProgress:function(a){d.updateDirectProgress(a.loaded,a.total)},onCreate:function(a){return d.addXhr(a)}})];case 3:return f=g.sent(),this.logger.info("Direct progress finish."),this.finishDirectProgress(),[2,f]}})})},t.prototype.updateDirectProgress=function(e,i){this.progress={total:this.getProgressInfoItem(e,i+1)},this.onData(this.progress)},t.prototype.finishDirectProgress=function(){if(!this.progress){this.logger.warn("progress is null."),this.progress={total:this.getProgressInfoItem(this.file.size,this.file.size)},this.onData(this.progress);return}var e=this.progress.total;this.progress={total:this.getProgressInfoItem(e.loaded+1,e.size)},this.onData(this.progress)},t}(ve);function me(r,t,e){e===void 0&&(e=3);var i=pe();i.open("POST","https://uplog.qbox.me/log/3"),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.setRequestHeader("Authorization",$(r).Authorization),i.onreadystatechange=function(){i.readyState===4&&i.status!==200&&e>0&&me(r,t,e-1)};var o=[t.code||"",t.reqId||"",t.host||"",t.remoteIp||"",t.port||"",t.duration||"",t.time||"",t.bytesSent||"",t.upType||"",t.size||""].join(",");i.send(o)}var bt=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,n=[],f;try{for(;(t===void 0||t-- >0)&&!(o=i.next()).done;)n.push(o.value)}catch(d){f={error:d}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(f)throw f.error}}return n},X=function(){for(var r=[],t=0;t<arguments.length;t++)r=r.concat(bt(arguments[t]));return r},wt=function(){function r(t,e,i,o){e===void 0&&(e=!0),i===void 0&&(i="OFF"),o===void 0&&(o="UPLOAD"),this.token=t,this.disableReport=e,this.level=i,this.prefix=o,this.id=++r.id}return r.prototype.getPrintPrefix=function(t){return"Qiniu-JS-SDK ["+t+"]["+this.prefix+"#"+this.id+"]:"},r.prototype.report=function(t,e){if(!this.disableReport)try{me(this.token,t,e)}catch(i){this.warn(i)}},r.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=["INFO"];i.includes(this.level)&&console.log.apply(console,X([this.getPrintPrefix("INFO")],t))},r.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=["INFO","WARN"];i.includes(this.level)&&console.warn.apply(console,X([this.getPrintPrefix("WARN")],t))},r.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=["INFO","WARN","ERROR"];i.includes(this.level)&&console.error.apply(console,X([this.getPrintPrefix("ERROR")],t))},r.id=0,r}(),ce=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(f){f(n)})}return new(e||(e=Promise))(function(n,f){function d(h){try{a(i.next(h))}catch(v){f(v)}}function g(h){try{a(i.throw(h))}catch(v){f(v)}}function a(h){h.done?n(h.value):o(h.value).then(d,g)}a((i=i.apply(r,t||[])).next())})},fe=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(a){return function(h){return g([a,h])}}function g(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=a[0]&2?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(r,e)}catch(h){a=[6,h],o=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},_t=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,n=[],f;try{for(;(t===void 0||t-- >0)&&!(o=i.next()).done;)n.push(o.value)}catch(d){f={error:d}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(f)throw f.error}}return n},xt=function(){for(var r=[],t=0;t<arguments.length;t++)r=r.concat(_t(arguments[t]));return r},B=new Map,Ct=function(){function r(t,e){this.host=t,this.protocol=e}return r.prototype.isFrozen=function(){var t=new Date().getTime(),e=B.get(this.host);return e!=null&&e>=t},r.prototype.freeze=function(t){t===void 0&&(t=20);var e=new Date().getTime()+t*1e3;B.set(this.host,e)},r.prototype.unfreeze=function(){B.delete(this.host)},r.prototype.getUrl=function(){return this.protocol+"://"+this.host},r.prototype.getUnfreezeTime=function(){return B.get(this.host)},r}(),St=function(){function r(t){t===void 0&&(t=[]),this.initHosts=t,this.cachedHostsMap=new Map}return r.prototype.register=function(t,e,i,o){this.cachedHostsMap.set(t+"@"+e,i.map(function(n){return new Ct(n,o)}))},r.prototype.refresh=function(t,e,i){var o,n,f,d;return ce(this,void 0,void 0,function(){var g,a,h;return fe(this,function(v){switch(v.label){case 0:return g=this.cachedHostsMap.get(t+"@"+e)||[],g.length>0?[2]:this.initHosts.length>0?(this.register(t,e,this.initHosts,i),[2]):[4,nt(t,e,i)];case 1:return a=v.sent(),(a==null?void 0:a.data)!=null&&(h=xt(((n=(o=a.data.up)===null||o===void 0?void 0:o.acc)===null||n===void 0?void 0:n.main)||[],((d=(f=a.data.up)===null||f===void 0?void 0:f.acc)===null||d===void 0?void 0:d.backup)||[]),this.register(t,e,h,i)),[2]}})})},r.prototype.getUp=function(t,e,i){return ce(this,void 0,void 0,function(){var o,n,f;return fe(this,function(d){switch(d.label){case 0:return[4,this.refresh(t,e,i)];case 1:return d.sent(),o=this.cachedHostsMap.get(t+"@"+e)||[],o.length===0?[2,null]:(n=o.filter(function(g){return!g.isFrozen()}),n.length>0?[2,n[0]]:(f=o.slice().sort(function(g,a){return(g.getUnfreezeTime()||0)-(a.getUnfreezeTime()||0)}),[2,f[0]]))}})})},r}();function At(r,t,e,i){return r.config&&r.config.forceDirect?(i.info("ues forceDirect mode."),new ue(r,t,e,i)):r.file.size>4*R?(i.info("file size over 4M, use Resume."),new pt(r,t,e,i)):(i.info("file size less or equal than 4M, use Direct."),new ue(r,t,e,i))}function kt(r,t,e,i,o){var n=new wt(e,o==null?void 0:o.disableStatisticsReport,o==null?void 0:o.debugLogLevel,r.name),f={file:r,key:t,token:e,putExtra:i,config:Ft(o,n)},d=new St(f.config.uphost);return new Ae(function(g){var a=At(f,{onData:function(h){return g.next(h)},onError:function(h){return g.error(h)},onComplete:function(h){return g.complete(h)}},d,n);return a.putFile(),a.stop.bind(a)})}var E=function(){return E=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},E.apply(this,arguments)},It=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(r);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(r,i[o])&&(e[i[o]]=r[i[o]]);return e},Ut=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,n=[],f;try{for(;(t===void 0||t-- >0)&&!(o=i.next()).done;)n.push(o.value)}catch(d){f={error:d}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(f)throw f.error}}return n},K=function(){for(var r=[],t=0;t<arguments.length;t++)r=r.concat(Ut(arguments[t]));return r};function Ft(r,t){var e=E({},r),i=e.upprotocol,o=e.uphost,n=It(e,["upprotocol","uphost"]),f=E({uphost:[],retryCount:3,checkByMD5:!1,forceDirect:!1,useCdnDomain:!0,checkByServer:!0,concurrentRequestLimit:3,chunkSize:ct,upprotocol:"https",debugLogLevel:"OFF",disableStatisticsReport:!1},n);i&&(f.upprotocol=i.replace(/:$/,""));var d=[];if(t&&(r==null?void 0:r.uphost)!=null&&(r==null?void 0:r.region)!=null&&t.warn("do not use both the uphost and region config."),o)Array.isArray(o)?d.push.apply(d,K(o)):d.push(o);else if(f!=null&&f.region){var g=Je[f==null?void 0:f.region];f.useCdnDomain?d.push.apply(d,K(g.cdnUphost)):d.push.apply(d,K(g.srcUphost))}return E(E({},f),{uphost:d.filter(Boolean)})}var le={PNG:"image/png",JPEG:"image/jpeg",WEBP:"image/webp",BMP:"image/bmp"};Object.keys(le).map(function(r){return le[r]});const Ot="wLAAdpyMPP890Sl5pmfFNGuEKYDE1Xe3bqdvCLMF",zt="nigIAKP3_M9jeWSVZ9kNvHgRm_0Mk2Bs8k-Jz4BV",Rt="pictures-cloud",Et="https://pictures.linkqi.cn/";function Pt(){const r={scope:Rt,deadline:Math.floor(Date.now()/1e3)+3600},t=JSON.stringify(r),e=btoa(Lt(t)),o=Y.HmacSHA1(e,zt).toString(Y.enc.Base64);return`${Ot}:${Tt(o)}:${e}`}function Lt(r){return unescape(encodeURIComponent(r))}function Tt(r){return r.replace(/\+/g,"-").replace(/\//g,"_")}async function Dt(r,t,e,i){const o=Pt(),n=e?e+Q()+"/"+r.name:"work-project/image/"+Q()+"/"+r.name;return new Promise((f,d)=>{const g={},a={useCdnDomain:!0,region:F.z2};kt(r,n,o,g,a).subscribe({next(v){const m=parseFloat(v.total.percent.toFixed(2));console.log(":",m),i==null||i(m)},error(v){console.error(":",v),d(v)},complete(v){console.log(":",v),f(Et+v.key+"?"+(t||r.name))}})})}export{Dt as u};
