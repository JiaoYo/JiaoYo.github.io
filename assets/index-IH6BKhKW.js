import{_ as Ye}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Dw2asHZY.js";import{aA as T,aB as ve,aD as oe,aC as me,bz as he,bs as Qe,d as pe,aF as Oe,b3 as Ze,aG as Pe,ba as et,aL as S,bA as tt,bB as nt,bc as at,bC as ot,bd as it,be as lt,b as le,b4 as B,aK as st,aP as Ie,bD as $e,aM as _e,bE as rt,bF as Te,bG as ct,bH as ut,q as ye,v as je,s as Ee,j as W,r as ue,L as we,o as U,c as se,w as c,g as n,i as r,V as Fe,aV as dt,M as Se,h as re,t as ce,$ as E,N as Ue,Y as ze,A as ke,B as X,E as Ve,D as Be,aa as Ge,x as pt,y as Le,O as ie,f as xe,e as de,aj as be,ah as mt,a7 as Re,ax as ft,aX as Ke,C as gt,ab as vt,ac as ht,a0 as _t,ad as fe,ae as xt}from"./index-BnSz7Y_4.js";import{u as bt,a as yt}from"./table-CGckSXml.js";import{_ as wt}from"./round-search-CvTE-qpz.js";import{_ as St}from"./round-refresh-CK8bnbYD.js";import{u as He}from"./usePageData-BNjxXKHr.js";import{b as Ce,a as zt}from"./common-CJq6igRq.js";import{f as De}from"./multipe-z1MB5t4Y.js";import{_ as We}from"./Cascader-C44WWaqA.js";import{_ as kt}from"./FormItemGridItem-a_SjN6vX.js";import{_ as Ct}from"./Grid-BveQzKgs.js";import{a as Dt}from"./basicconf-ByjLqmES.js";import{m as Nt,n as It,o as $t,p as Tt}from"./events-BQRvwyB3.js";import{_ as qe}from"./DataTable-B8T65ZKt.js";import{h as Ae}from"./permission-CSxOo-9N.js";import{_ as Lt}from"./Popconfirm-Bm5bEO-I.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-B3AdPguz.js";import"./setting-outlined-DIaxeCTg.js";import"./round-delete-B8SvH4rf.js";import"./refresh-B97bVwEJ.js";import"./round-plus-D-7hBhY1.js";import"./Upload-DqMbT48O.js";import"./Progress-BWNeuNH-.js";import"./Forward-Bw2rGkfM.js";const Rt=T("steps",`
 width: 100%;
 display: flex;
`,[T("step",`
 position: relative;
 display: flex;
 flex: 1;
 `,[ve("disabled","cursor: not-allowed"),ve("clickable",`
 cursor: pointer;
 `),oe("&:last-child",[T("step-splitor","display: none;")])]),T("step-splitor",`
 background-color: var(--n-splitor-color);
 margin-top: calc(var(--n-step-header-font-size) / 2);
 height: 1px;
 flex: 1;
 align-self: flex-start;
 margin-left: 12px;
 margin-right: 12px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `),T("step-content","flex: 1;",[T("step-content-header",`
 color: var(--n-header-text-color);
 margin-top: calc(var(--n-indicator-size) / 2 - var(--n-step-header-font-size) / 2);
 line-height: var(--n-step-header-font-size);
 font-size: var(--n-step-header-font-size);
 position: relative;
 display: flex;
 font-weight: var(--n-step-header-font-weight);
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `,[me("title",`
 white-space: nowrap;
 flex: 0;
 `)]),me("description",`
 color: var(--n-description-text-color);
 margin-top: 12px;
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `)]),T("step-indicator",`
 background-color: var(--n-indicator-color);
 box-shadow: 0 0 0 1px var(--n-indicator-border-color);
 height: var(--n-indicator-size);
 width: var(--n-indicator-size);
 border-radius: 50%;
 display: flex;
 align-items: center;
 justify-content: center;
 transition:
 background-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 `,[T("step-indicator-slot",`
 position: relative;
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 font-size: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 `,[me("index",`
 display: inline-block;
 text-align: center;
 position: absolute;
 left: 0;
 top: 0;
 white-space: nowrap;
 font-size: var(--n-indicator-index-font-size);
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[he()]),T("icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[he()]),T("base-icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[he()])])]),ve("vertical","flex-direction: column;",[Qe("show-description",[oe(">",[T("step","padding-bottom: 8px;")])]),oe(">",[T("step","margin-bottom: 16px;",[oe("&:last-child","margin-bottom: 0;"),oe(">",[T("step-indicator",[oe(">",[T("step-splitor",`
 position: absolute;
 bottom: -8px;
 width: 1px;
 margin: 0 !important;
 left: calc(var(--n-indicator-size) / 2);
 height: calc(100% - var(--n-indicator-size));
 `)])]),T("step-content",[me("description","margin-top: 8px;")])])])])])]);function At(e,z){return typeof e!="object"||e===null||Array.isArray(e)?null:(e.props||(e.props={}),e.props.internalIndex=z+1,e)}function Mt(e){return e.map((z,u)=>At(z,u))}const Ot=Object.assign(Object.assign({},Pe.props),{current:Number,status:{type:String,default:"process"},size:{type:String,default:"medium"},vertical:Boolean,"onUpdate:current":[Function,Array],onUpdateCurrent:[Function,Array]}),Je=at("n-steps"),Pt=pe({name:"Steps",props:Ot,setup(e,{slots:z}){const{mergedClsPrefixRef:u,mergedRtlRef:k}=Oe(e),d=Ze("Steps",k,u),h=Pe("Steps","-steps",Rt,ot,e,u);return et(Je,{props:e,mergedThemeRef:h,mergedClsPrefixRef:u,stepsSlots:z}),{mergedClsPrefix:u,rtlEnabled:d}},render(){const{mergedClsPrefix:e}=this;return S("div",{class:[`${e}-steps`,this.rtlEnabled&&`${e}-steps--rtl`,this.vertical&&`${e}-steps--vertical`]},Mt(tt(nt(this))))}}),jt={status:String,title:String,description:String,disabled:Boolean,internalIndex:{type:Number,default:0}},Et=pe({name:"Step",props:jt,setup(e){const z=it(Je,null);z||lt("step","`n-step` must be placed inside `n-steps`.");const{inlineThemeDisabled:u}=Oe(),{props:k,mergedThemeRef:d,mergedClsPrefixRef:h,stepsSlots:N}=z,A=le(()=>k.vertical),G=le(()=>{const{status:f}=e;if(f)return f;{const{internalIndex:_}=e,{current:I}=k;if(I===void 0)return"process";if(_<I)return"finish";if(_===I)return k.status||"process";if(_>I)return"wait"}return"process"}),F=le(()=>{const{value:f}=G,{size:_}=k,{common:{cubicBezierEaseInOut:I},self:{stepHeaderFontWeight:L,[B("stepHeaderFontSize",_)]:O,[B("indicatorIndexFontSize",_)]:P,[B("indicatorSize",_)]:V,[B("indicatorIconSize",_)]:j,[B("indicatorTextColor",f)]:Y,[B("indicatorBorderColor",f)]:q,[B("headerTextColor",f)]:Q,[B("splitorColor",f)]:Z,[B("indicatorColor",f)]:ee,[B("descriptionTextColor",f)]:K}}=d.value;return{"--n-bezier":I,"--n-description-text-color":K,"--n-header-text-color":Q,"--n-indicator-border-color":q,"--n-indicator-color":ee,"--n-indicator-icon-size":j,"--n-indicator-index-font-size":P,"--n-indicator-size":V,"--n-indicator-text-color":Y,"--n-splitor-color":Z,"--n-step-header-font-size":O,"--n-step-header-font-weight":L}}),M=u?st("step",le(()=>{const{value:f}=G,{size:_}=k;return`${f[0]}${_[0]}`}),F,k):void 0,t=le(()=>{if(e.disabled)return;const{onUpdateCurrent:f,"onUpdate:current":_}=k;return f||_?()=>{f&&Ie(f,e.internalIndex),_&&Ie(_,e.internalIndex)}:void 0});return{stepsSlots:N,mergedClsPrefix:h,vertical:A,mergedStatus:G,handleStepClick:t,cssVars:u?void 0:F,themeClass:M==null?void 0:M.themeClass,onRender:M==null?void 0:M.onRender}},render(){const{mergedClsPrefix:e,onRender:z,handleStepClick:u,disabled:k}=this,d=$e(this.$slots.default,h=>{const N=h||this.description;return N?S("div",{class:`${e}-step-content__description`},N):null});return z==null||z(),S("div",{class:[`${e}-step`,k&&`${e}-step--disabled`,!k&&u&&`${e}-step--clickable`,this.themeClass,d&&`${e}-step--show-description`,`${e}-step--${this.mergedStatus}-status`],style:this.cssVars,onClick:u},S("div",{class:`${e}-step-indicator`},S("div",{class:`${e}-step-indicator-slot`},S(rt,null,{default:()=>$e(this.$slots.icon,h=>{const{mergedStatus:N,stepsSlots:A}=this;return N==="finish"||N==="error"?N==="finish"?S(Te,{clsPrefix:e,key:"finish"},{default:()=>_e(A["finish-icon"],()=>[S(ct,null)])}):N==="error"?S(Te,{clsPrefix:e,key:"error"},{default:()=>_e(A["error-icon"],()=>[S(ut,null)])}):null:h||S("div",{key:this.internalIndex,class:`${e}-step-indicator-slot__index`},this.internalIndex)})})),this.vertical?S("div",{class:`${e}-step-splitor`}):null),S("div",{class:`${e}-step-content`},S("div",{class:`${e}-step-content-header`},S("div",{class:`${e}-step-content-header__title`},_e(this.$slots.title,()=>[this.title])),this.vertical?null:S("div",{class:`${e}-step-splitor`})),d))}}),Ft=pe({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ye(["reset","search"],["update:model"]),setup(e,{emit:z}){const u=z,{formRef:k,restoreValidation:d}=je(),h=Ee(e,"model"),N=W();(async()=>{const{data:I,error:L}=await Ce();L||(N.value=I.map(O=>({...O,id:"-"+O.id,type:O.cname})))})();const{pageData:G,getData:F,nextPage:M}=He(De);F(),ue({multipeGroupList:[]});function t(){h.value.fuzzy="",u("search")}async function f(){await d(),u("reset")}async function _(){u("search")}return(I,L)=>{const O=We,P=kt,V=ze,j=ke,Y=St,q=X,Q=wt,Z=Ve,ee=Ct,K=Be,b=Ge,J=we("no-space");return U(),se(b,{bordered:!1,size:"small",class:"card-wrapper"},{default:c(()=>[n(K,{ref_key:"formRef",ref:k,model:h.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ue(_,["enter"])},{default:c(()=>[n(ee,{responsive:"screen","item-responsive":""},{default:c(()=>[n(P,{span:"24 s:12 m:6",label:"日志源设备",path:"lid",class:"pr-24px"},{default:c(()=>[n(O,{value:h.value.lid,"onUpdate:value":[L[0]||(L[0]=l=>h.value.lid=l),_],placeholder:"请选择日志源设备",options:N.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),n(P,{span:"24 s:12 m:6",label:"状态",path:"status",class:"pr-24px"},{default:c(()=>[n(V,{filterable:"",value:h.value.status,"onUpdate:value":[L[1]||(L[1]=l=>h.value.status=l),_],placeholder:"请选择状态",options:r(Fe)(r(dt)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),n(P,{span:"24 s:12 m:6",label:"字段值",path:"fuzzy",class:"pr-24px"},{default:c(()=>[Se(n(j,{clearable:"",value:h.value.fuzzy,"onUpdate:value":L[2]||(L[2]=l=>h.value.fuzzy=l),placeholder:"请输入字段值",onClear:t},null,8,["value"]),[[J]])]),_:1}),n(P,{span:"24 m:4",class:"pr-24px"},{default:c(()=>[n(Z,{class:"w-full"},{default:c(()=>[n(q,{onClick:f},{icon:c(()=>[n(Y,{class:"text-icon"})]),default:c(()=>[re(" "+ce(r(E)("common.reset")),1)]),_:1}),n(q,{type:"primary",ghost:"",onClick:_},{icon:c(()=>[n(Q,{class:"text-icon"})]),default:c(()=>[re(" "+ce(r(E)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ut={class:"ml-30px h-100%"},Vt={style:{width:"800px",height:"125px",border:"1px solid #ccc",padding:"8px","white-space":"pre-wrap","user-select":"none"}},Bt=pe({name:"OperateDrawer",__name:"operate-drawer",props:ye({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ye(["submitted"],["update:visible"]),setup(e,{emit:z}){const u=e,k=z,d=ue({current:1}),h=Ee(e,"visible"),{formRef:N,validate:A,restoreValidation:G}=je(),{defaultRequiredRule:F}=pt(),M=le(()=>({add:"新增自定义解析",edit:"修改自定义解析"})[u.operateType]),t=ue(f());function f(){return{lid:void 0,cvalue:"",orilog:"",multi:"",multicon:void 0,expre:"",status:1,re1:"",re2:""}}const _={lid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"},orilog:F},I=W(),L=async()=>{const{data:o,error:i}=await Ce();i||(I.value=o.map(a=>({...a,id:"-"+a.id,type:a.cname})))},O=[{id:1,value:"%{mask1->}"},{id:2,value:"%{mask2->}"},{id:3,value:"%{ip1->}"},{id:4,value:"%{ip2->}"},{id:5,value:"%{port1->}"},{id:6,value:"%{port2->}"},{id:7,value:"%{mac1->}"},{id:8,value:"%{mac2->}"},{id:9,value:"%{level->}"},{id:10,value:"%{protocol->}"},{id:11,value:"%{code->}"},{id:12,value:"%{type2Name->}"},{id:13,value:"%{user->}"},{id:14,value:"%{resultName->}"},{id:15,value:"%{targetName->}"},{id:16,value:"%{log_time->}"},{id:17,value:"%{targetObject->}"}],P=W([]),{pageData:V,getData:j,nextPage:Y}=He(De),q=async o=>{const i=o.currentTarget;i.scrollTop+i.offsetHeight>=i.scrollHeight&&V.data.length<V.total&&Y()},Q=ue({eventsTypeDataList:[]});async function Z(){const{data:o,error:i}=await zt();i||(Q.eventsTypeDataList=o)}async function ee(){if(d.current=1,await L(),await j(),await Z(),$.list=[],b.value=new Set([]),Object.assign(t,f()),u.operateType==="edit"&&u.rowData&&(Object.assign(t,u.rowData),u.rowData.multicon)){let o=JSON.parse(u.rowData.multicon);b.value=t.re1?new Set(t.re1.split(",").map(Number)):new Set([]),$.list=o}}function K(){h.value=!1}const b=W(new Set),J=W(null),l=W([]);function p(o){var ne,ae;let i=!0;const a=t.orilog,y=window.getSelection();if(!y.rangeCount)return;const g=y.getRangeAt(0),s=g.startContainer,m=g.endContainer;if(y.removeAllRanges(),!J.value.contains(s)||!J.value.contains(m))return;const w=Array.from(J.value.childNodes),x=w.indexOf(s.parentNode)-1,D=w.indexOf(m.parentNode);if(console.log("startIndex",x),console.log("endIndex",D),D-x==0)return!1;for(let v=x;v<D;v++)b.value.has(v)&&(console.log("尝试选择已禁用的字符，操作被阻止"),i=!1);if(i){if(x>=0&&D>=0&&x<=D)for(let v=x;v<D;v++)l.value.push(v);for(let v=x;v<D;v++)b.value.add(v);x>0&&b.value.add(x-1),D<a.length&&b.value.add(D),$.list.push({startIndex:x,endIndex:D,name:a.substring(x,D),multipegroup:null,value:null})}else return(ne=window.$message)==null||ne.destroyAll(),(ae=window.$message)==null||ae.warning("相邻划词不允许选中。"),!1;console.log("当前选中的文本:",a.substring(x,D)),console.log("已禁用的字符索引:",Array.from(b.value))}async function C(){var o,i,a;if(await A(),u.operateType==="add"){const{data:y,error:g}=await Nt([{lid:t.lid,cvalue:t.cvalue,orilog:t.orilog,multi:t.multi,multicon:t.multicon,expre:t.expre,status:t.status,re1:Array.from(b.value).length>0?Array.from(b.value).join(","):""}]);g||((o=window.$message)==null||o.success(E("common.addSuccess")),K(),k("submitted"))}else{const{data:y,error:g}=await It([{id:(i=u.rowData)==null?void 0:i.id,lid:t.lid,cvalue:t.cvalue,orilog:t.orilog,multi:t.multi,multicon:t.multicon,expre:t.expre,status:t.status,re1:Array.from(b.value).length>0?Array.from(b.value).join(","):""}]);g||((a=window.$message)==null||a.success(E("common.updateSuccess")),K(),k("submitted"))}}Le(h,()=>{h.value&&(ee(),G())}),Le(V,(o,i)=>{P.value=V.data.map(a=>{var y;return{id:a.id,value:O.find(g=>g.id===a.id)?(y=O.find(g=>g.id===a.id))==null?void 0:y.value:"",label:a.tname}})},{deep:!0});const H=W([{title:"字段值",key:"name",width:160,align:"center",ellipsis:{tooltip:!0}},{title:"多元组",key:"multipegroup",align:"center",width:160,render(o,i){return S(ze,{size:"small",clearable:!0,valueField:"id",filterable:!0,options:P.value,defaultValue:o.multipegroup,onScroll:q,"onUpdate:value":a=>{o.multipegroup=a,o.value=null,console.log(o.multipegroup)}})}},{title:"值",key:"value",align:"center",width:160,render(o,i){return o.multipegroup===11||o.multipegroup===9?S(ze,{size:"small",key:o.multipegroup,clearable:!0,filterable:!0,valueField:o.multipegroup===11?"id":"value",labelField:o.multipegroup===11?"pname":"label",options:o.multipegroup===11?Q.eventsTypeDataList:Fe(Dt),defaultValue:o.value,"onUpdate:value":a=>{o.value=a}}):null}},{key:"operate",title:E("common.operate"),align:"center",width:80,fixed:"right",render(o,i){return S(X,{size:"small",type:"error",ghost:!0,onClick:()=>R(o,i)},{default:()=>E("common.delete")})}}]);function te(o,i){return o.filter(a=>!i.includes(a))}function R(o,i){let a=[o.startIndex-1,o.endIndex];$.list.splice(i,1);for(let s=o.startIndex;s<o.endIndex;s++)a.push(s);const y=Math.max(...a),g=Math.min(...a);b.value.has(y+1)&&(a=a.filter(s=>s!==y)),b.value.has(g-1)&&(a=a.filter(s=>s!==g)),b.value=new Set(te(Array.from(b.value),a)),l.value=[],$.list.forEach(s=>{for(let m=s.startIndex;m<s.endIndex;m++)l.value.push(m)})}const $=ue({list:[]});function ge(o,i){let a=o.split(""),y=0;for(const{startIndex:g,endIndex:s,replacement:m}of i){const w=g+y,x=s+y;if(w<0||x>=a.length||w>x)throw new Error("Invalid index range");const D=x-w+1,ne=a.slice(0,w).join(""),ae=a.slice(x+1).join("");a=(ne+m+ae).split(""),y+=m.length-D}return a.join("")}async function Xe(){var o,i,a,y;if(d.current==1)await A(),d.current++,ft(()=>{var g;(g=u.rowData)!=null&&g.id&&(l.value=[],$.list.forEach(s=>{for(let m=s.startIndex;m<s.endIndex;m++)l.value.push(m)}))});else{let g=!0;if($.list.length>0){for(let s=0;s<$.list.length;s++){let m=$.list[s];if(m.multipegroup){if((m.multipegroup===11||m.multipegroup===9)&&(console.log(m.value),!m.value&&m.value!=0)){g=!1;break}}else{g=!1;break}}if(g){t.cvalue="",t.multi="";let s={},m=[];P.value.forEach(w=>{s[w.id]=w.value}),$.list.forEach((w,x)=>{t.cvalue+=w.name+"，",t.multi+=w.multipegroup+",",m.push({startIndex:w.startIndex,endIndex:w.endIndex-1,replacement:w.multipegroup==11?"%{?x"+x+1+"}":w.multipegroup==9?"%{level->}":s[w.multipegroup]})}),console.log("finallyTransArr",m),t.cvalue=t.cvalue.substring(0,t.cvalue.length-1),t.multi=t.multi.substring(0,t.multi.length-1),t.multicon=JSON.stringify($.list),t.expre=ge(t.orilog,m),console.log(t.expre),d.current&&d.current++}else return(o=window.$message)==null||o.destroyAll(),(i=window.$message)==null||i.warning("请补充完整内容。"),!1}else return(a=window.$message)==null||a.destroyAll(),(y=window.$message)==null||y.warning("请添加日志划词。"),!1}}return(o,i)=>{const a=Et,y=Pt,g=Ke,s=gt,m=We,w=qe,x=Be,D=Ve,ne=vt,ae=ht;return U(),se(ae,{show:h.value,"onUpdate:show":i[5]||(i[5]=v=>h.value=v),"display-directive":"show",width:1e3,"content-style":{height:"100%"}},{default:c(()=>[n(ne,{title:M.value,"native-scrollbar":!1,closable:"","body-content-style":{height:"100%"}},{footer:c(()=>[n(D,{size:16},{default:c(()=>[n(r(X),{onClick:K},{default:c(()=>[re(ce(r(E)("common.cancel")),1)]),_:1}),d.current===2||d.current===3?(U(),se(r(X),{key:0,onClick:i[4]||(i[4]=v=>d.current--)},{default:c(()=>[re("上一步")]),_:1})):ie("",!0),d.current===1||d.current===2?(U(),se(r(X),{key:1,type:"primary",onClick:Xe},{default:c(()=>[re(ce(d.current===1?"下一步":"生成解析"),1)]),_:1})):ie("",!0),d.current===3?(U(),se(r(X),{key:2,type:"primary",onClick:C},{default:c(()=>[re(ce(r(E)("common.confirm")),1)]),_:1})):ie("",!0)]),_:1})]),default:c(()=>[n(D,{class:"h-100%"},{default:c(()=>[n(y,{vertical:"",current:d.current,class:"h-400px"},{default:c(()=>[n(a,{title:"基本信息"}),n(a,{title:"日志划词"}),n(a,{title:"生成解析"})]),_:1},8,["current"]),xe("div",Ut,[n(x,{ref_key:"formRef",ref:N,model:t,rules:_,onKeyup:Ue(C,["enter"]),style:{height:"100%",display:"flex","flex-direction":"column"}},{default:c(()=>[d.current===1?(U(),de(be,{key:0},[n(s,{label:"使用状态",path:"status"},{default:c(()=>[n(g,{value:t.status,"onUpdate:value":i[0]||(i[0]=v=>t.status=v),"checked-value":0,"unchecked-value":1},null,8,["value"])]),_:1}),n(s,{label:"日志源设备",path:"lid"},{default:c(()=>[n(m,{value:t.lid,"onUpdate:value":i[1]||(i[1]=v=>t.lid=v),placeholder:"请选择日志源设备",options:I.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"800px"},"show-path":!1},null,8,["value","options"])]),_:1}),n(s,{label:"日志原文",path:"orilog"},{default:c(()=>[n(r(ke),{type:"textarea",value:t.orilog,"onUpdate:value":i[2]||(i[2]=v=>t.orilog=v),placeholder:"请输入日志原文",clearable:"",autosize:{minRows:5,maxRows:7},style:{width:"800px"}},null,8,["value"])]),_:1})],64)):ie("",!0),d.current===2?(U(),de(be,{key:1},[n(s,{label:"日志原文",path:"orilog"},{default:c(()=>[xe("div",Vt,[xe("div",{class:"w-100%",ref_key:"editableDiv",ref:J,style:{"user-select":"text"},onMouseup:p},[(U(!0),de(be,null,mt(t.orilog,(v,Ne)=>(U(),de("span",{key:Ne,style:Re({color:l.value.includes(Ne)?"#f00":"#000"})},ce(v),5))),128))],544)])]),_:1}),n(s,{label:"划词信息",style:{flex:"1"}},{default:c(()=>[n(w,{columns:H.value,data:$.list,style:Re([{width:"800px"},{height:"100%"}]),"scroll-x":702,"flex-height":""},null,8,["columns","data"])]),_:1})],64)):ie("",!0),d.current===3?(U(),se(s,{key:2,label:"表达式",path:"expre"},{default:c(()=>[n(r(ke),{type:"textarea",value:t.expre,"onUpdate:value":i[3]||(i[3]=v=>t.expre=v),placeholder:"请输入表达式",clearable:"",style:{width:"800px"},readonly:"",autosize:{minRows:5,maxRows:7}},null,8,["value"])]),_:1})):ie("",!0)]),_:1},8,["model"])])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Gt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Me(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!xt(e)}const vn=pe({name:"eventalarm_customparsing",__name:"index",setup(e){const z=_t(),u=W();(async()=>{const{data:l,error:p}=await Ce();p||(u.value=l.map(C=>C.data).flat())})();const d=W();(async()=>{const{data:l,error:p}=await De({page:1,limit:1e3});p||(d.value=JSON.parse(JSON.stringify(l)).list)})();const{columns:N,columnChecks:A,data:G,getData:F,loading:M,mobilePagination:t,searchParams:f,resetSearchParams:_}=bt({apiFn:$t,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,lid:null,multis:null,status:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"cvalue",title:"字段值",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"multi",title:"多元组",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:l=>{const p=l.multi.split(",").map(Number);return n("span",null,[p.map((C,H)=>{var R,$;const te=($=(R=d.value)==null?void 0:R.find(ge=>ge.id===C))==null?void 0:$.tname;return te?`${te}${H!==p.length-1?"，":""}`:""})])}},{key:"lid",title:"日志源设备",align:"center",minWidth:180,ellipsis:{tooltip:!0},render:l=>{var p,C;return n("span",null,[((C=(p=u.value)==null?void 0:p.find(H=>H.id===l.lid))==null?void 0:C.type)||l.lid])}},{key:"dbtime",title:"入库时间",align:"center",width:160},{key:"status",title:"使用状态",align:"center",width:160,render:l=>n(Ke,{disabled:!0,value:l.status,checkedValue:0,uncheckedValue:1},null)},{key:"operate",title:E("common.operate"),align:"center",width:160,fixed:"right",render:l=>{let p;return n("div",{class:"flex-center gap-8px"},[Se(n(X,{type:"info",ghost:!0,size:"small",onClick:()=>ee(l.id)},Me(p=E("common.edit"))?p:{default:()=>[p]}),[[we("no-auth"),"custorm.parsing.update"]]),n(Lt,{onPositiveClick:()=>K(l.id)},{default:()=>E("common.confirmDelete"),trigger:()=>{let C;return Se(n(X,{type:"error",ghost:!0,size:"small"},Me(C=E("common.delete"))?C:{default:()=>[C]}),[[we("no-auth"),"custorm.parsing.delete"]])}})])}}]}),{drawerVisible:I,operateType:L,editingData:O,handleAdd:P,handleEdit:V,checkedRowKeys:j,onBatchDeleted:Y,onDeleted:q,closeDrawer:Q}=yt(G,F);async function Z(){console.log(j.value),b(j.value,l=>{Y()})}function ee(l){V(l)}function K(l){console.log(l),b([l],p=>{q()})}async function b(l,p){const{data:C,error:H}=await Tt(l);if(!H)p&&p(C);else return!1}async function J(){}return(l,p)=>{const C=Ye,H=qe,te=Ge;return U(),de("div",Gt,[n(Ft,{model:r(f),"onUpdate:model":p[0]||(p[0]=R=>fe(f)?f.value=R:null),onReset:r(_),onSearch:r(F)},null,8,["model","onReset","onSearch"]),n(te,{title:"自定义解析",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":c(()=>[n(C,{columns:r(A),"onUpdate:columns":p[1]||(p[1]=R=>fe(A)?A.value=R:null),"disabled-delete":r(j).length===0,loading:r(M),onAdd:r(P),onDelete:Z,onRefresh:r(F),"is-view-export-button":!0,onExportHandler:J,"is-view-add-button":r(Ae)("custorm.parsing.insert"),"is-view-delete-button":r(Ae)("custorm.parsing.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:c(()=>[n(H,{"checked-row-keys":r(j),"onUpdate:checkedRowKeys":p[2]||(p[2]=R=>fe(j)?j.value=R:null),columns:r(N),data:r(G),size:"small","flex-height":!r(z).isMobile,"scroll-x":962,loading:r(M),remote:"","row-key":R=>R.id,pagination:r(t),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),n(Bt,{visible:r(I),"onUpdate:visible":p[3]||(p[3]=R=>fe(I)?I.value=R:null),"operate-type":r(L),"row-data":r(O),onSubmitted:r(F)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{vn as default};
