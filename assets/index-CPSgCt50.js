import{_ as pe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CQ_-UHEA.js";import{_ as me}from"./round-delete-CmjEbq5v.js";import{_ as ce}from"./round-add-BZSUji5j.js";import{d as te,p as W,q as _e,r as ve,aw as P,s as fe,v as ge,k as Q,ab as H,ag as be,aF as he,b as we,$ as _,z as j,o as z,c as R,w as n,g as e,h as y,t as O,i as s,A as D,f as ae,eq as ye,er as ke,L as Ne,aI as xe,b1 as De,O as Ue,aU as $e,P as G,aV as Te,Q as Ce,B as U,aJ as Se,es as Pe,et as X,e as je,af as Y,aN as L,aO as ze,aT as Oe,a6 as Me}from"./index-DpQqTUwv.js";import{u as Be,a as Ie}from"./table-D_LxFwsQ.js";import{_ as Ve}from"./lodash-DG-BS0UC.js";import{_ as qe}from"./FormItemGridItem-CaDVclKw.js";import{_ as Ae}from"./Cascader-Cyn8ld5q.js";import{_ as Fe}from"./DatePicker-Cdu-4eUF.js";import{_ as Le}from"./Grid-DJ9dd8u4.js";import{N as Z}from"./Popconfirm-BuwS6evT.js";const Re=ae("span",null,"批量新增：格式为（名称1-10）",-1),Ge=ae("span",null,"匹配前缀",-1),Je=te({__name:"inverter-model",props:W({operateType:{},rowData:{},Pagination:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:W(["submitted"],["update:visible"]),setup(h,{emit:M}){const g=_e(h,"visible"),$=M,v=h,a=ve(k());function k(){return{iname:"",model:"",manu:"",dbtime:P(0,new Date),isrep:0,ratpower:void 0,transformer:void 0,collline:void 0,pvmodule:void 0,pvcount:void 0,devid:void 0,prename:"",pre:1,unum:""}}function B(){Object.assign(a,k()),v.operateType==="edit"&&v.rowData&&(Object.assign(a,v.rowData),a.dbtime=P(0,a.dbtime))}const{formRef:J,validate:N,restoreValidation:I}=fe();ge();const x=Q(!1);H(()=>v.rowData,()=>{B()}),H(g,()=>{g.value?(v.operateType==="add"&&be(()=>{setTimeout(()=>{x.value=!0},200)}),q(),B(),I()):x.value=!1});const T=()=>{g.value=!1};function V(r){const t=r.match(/^(.*?)(\d+)\s*-\s*(\d+)$/);if(!t)return[r];const[,i,f,o]=t,d=Number(f),p=Number(o);return p<d?[]:Array.from({length:p-d+1},(S,w)=>`${i}${d+w}`)}const b=async()=>{var t,i,f;await N();const r=JSON.parse(JSON.stringify(a));if(r.dbtime=P(1,r.dbtime),v.operateType==="add"){const o=V(r.iname);if(o.length>1e3){(t=window.$message)==null||t.destroyAll(),(i=window.$message)==null||i.warning("批量添加最多仅支持1000条");return}const d=o.map(w=>({...r,iname:w})),{data:p,error:S}=await ye(d);if(S)return}else{const{data:o,error:d}=await ke([r]);if(d)return}(f=window.$message)==null||f.success(v.operateType==="add"?"添加成功":"修改成功"),T(),$("submitted")},E=Ve.debounce(b,1e3,{leading:!0,trailing:!1}),C=Q(),q=async()=>{const{data:r,error:t}=await he({type:0});function i(f){return f.map(o=>{var d;return{label:o.chlName,value:o.chlName,children:(d=o.devicePojoList)!=null&&d.length?o.devicePojoList.map(p=>({label:p.devName,value:p.id})):[]}})}C.value=i(r)},A=(r,t)=>{r&&(a.devid=r,a.prename=t==null?void 0:t.label)},F={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},u={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},m={iname:F,ratpower:u,devid:u},c=we(()=>({add:_("common.add"),edit:_("common.edit")})[v.operateType]);return(r,t)=>{const i=Ne,f=xe,o=qe,d=De,p=Ae,S=Ue,w=$e,ne=G,le=Te,oe=Fe,se=Le,re=Ce,K=U,ie=G,ue=Se,de=j("no-space");return z(),R(ue,{show:g.value,"onUpdate:show":t[14]||(t[14]=l=>g.value=l),title:c.value,preset:"card",class:"w-50%"},{footer:n(()=>[e(ie,{size:16,justify:"center"},{default:n(()=>[e(K,{onClick:T,class:"w-100px"},{default:n(()=>[y(O(s(_)("common.cancel")),1)]),_:1}),e(K,{type:"primary",class:"w-100px",onClick:s(E)},{default:n(()=>[y(O(s(_)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:n(()=>[e(re,{ref_key:"formRef",ref:J,model:a,rules:m,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:n(()=>[e(se,{responsive:"screen","item-responsive":""},{default:n(()=>[e(o,{span:"24 m:12",label:"名称",path:"iname"},{default:n(()=>[e(f,{show:x.value,placement:"top-start"},{trigger:n(()=>[D(e(i,{clearable:"",value:a.iname,"onUpdate:value":t[0]||(t[0]=l=>a.iname=l),maxlength:"64",placeholder:"请输入名称"},null,8,["value"]),[[de]])]),default:n(()=>[Re]),_:1},8,["show"])]),_:1}),e(o,{span:"24 m:12",label:"额定功率(MW)",path:"ratpower"},{default:n(()=>[e(d,{clearable:"",value:a.ratpower,"onUpdate:value":t[1]||(t[1]=l=>a.ratpower=l),placeholder:"请输入",precision:3,style:{width:"100%"}},null,8,["value"])]),_:1}),e(o,{span:"24 m:12",label:"所属设备",path:"devid"},{default:n(()=>[e(p,{value:a.devid,"onUpdate:value":[t[2]||(t[2]=l=>a.devid=l),A],placeholder:"请选择所属设备","expand-trigger":"click",options:C.value,"check-strategy":"child","show-path":!1},null,8,["value","options"])]),_:1}),e(o,{span:"24 m:12",label:"匹配前缀"},{label:n(()=>[e(S,{checked:a.pre,"onUpdate:checked":t[3]||(t[3]=l=>a.pre=l),"checked-value":0,"unchecked-value":1,class:"mr-5px"},null,8,["checked"]),Ge]),default:n(()=>[e(i,{clearable:"",value:a.prename,"onUpdate:value":t[4]||(t[4]=l=>a.prename=l),maxlength:"16",disabled:a.pre==1,placeholder:"请输入匹配前缀"},null,8,["value","disabled"])]),_:1}),e(o,{span:"24 m:12",label:"型号",path:"model"},{default:n(()=>[e(i,{clearable:"",value:a.model,"onUpdate:value":t[5]||(t[5]=l=>a.model=l),placeholder:"请输入",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1}),e(o,{span:"24 m:12",label:"样板逆变器 ",path:"isrep"},{default:n(()=>[e(le,{value:a.isrep,"onUpdate:value":t[6]||(t[6]=l=>a.isrep=l),name:"radiogroup"},{default:n(()=>[e(ne,null,{default:n(()=>[e(w,{label:s(_)("common.yesOrNo.yes"),value:1},null,8,["label"]),e(w,{label:s(_)("common.yesOrNo.no"),value:0},null,8,["label"])]),_:1})]),_:1},8,["value"])]),_:1}),e(o,{span:"24 m:12",label:"安装时间",path:"dbtime"},{default:n(()=>[e(oe,{"formatted-value":a.dbtime,"onUpdate:formattedValue":t[7]||(t[7]=l=>a.dbtime=l),"value-format":"yyyy-MM-dd",type:"date",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),e(o,{span:"24 m:12",label:"生产商",path:"manu"},{default:n(()=>[e(i,{clearable:"",value:a.manu,"onUpdate:value":t[8]||(t[8]=l=>a.manu=l),placeholder:"请输入",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1}),e(o,{span:"24 m:12",label:"箱式变压器",path:"transformer"},{default:n(()=>[e(i,{value:a.transformer,"onUpdate:value":t[9]||(t[9]=l=>a.transformer=l),placeholder:"请输入",precision:0,style:{width:"100%"}},null,8,["value"])]),_:1}),e(o,{span:"24 m:12",label:"集电线路",path:"collline"},{default:n(()=>[e(i,{clearable:"",value:a.collline,"onUpdate:value":t[10]||(t[10]=l=>a.collline=l),placeholder:"请输入",precision:0,style:{width:"100%"}},null,8,["value"])]),_:1}),e(o,{span:"24 m:12",label:"机组编号",path:"unum"},{default:n(()=>[e(i,{clearable:"",value:a.unum,"onUpdate:value":t[11]||(t[11]=l=>a.unum=l),placeholder:"请输入",precision:0,style:{width:"100%"}},null,8,["value"])]),_:1}),e(o,{span:"24 m:12",label:"光组型号",path:"pvmodule"},{default:n(()=>[e(i,{clearable:"",value:a.pvmodule,"onUpdate:value":t[12]||(t[12]=l=>a.pvmodule=l),placeholder:"请输入",precision:0,style:{width:"100%"}},null,8,["value"])]),_:1}),e(o,{span:"24 m:12",label:"光组个数",path:"pvcount"},{default:n(()=>[e(d,{clearable:"",value:a.pvcount,"onUpdate:value":t[13]||(t[13]=l=>a.pvcount=l),placeholder:"请输入",precision:0,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ee={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ee(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!ze(h)}const lt=te({name:"stationmanagement_inverterinformation",__name:"index",setup(h){const{columns:M,columnChecks:g,data:$,getData:v,loading:a,mobilePagination:k,searchParams:B,resetSearchParams:J}=Be({apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"iname",title:"名称",align:"center",width:140},{key:"model",title:"型号",align:"center",width:100},{key:"devName",title:"设备名称",align:"center",width:100},{key:"ratpower",title:"额定功率(MW)",align:"center",width:140},{key:"manu",title:"生产商",align:"center",width:140},{key:"dbtime",title:"安装时间",align:"center",width:140,render:u=>e("span",null,[P(0,u.dbtime)])},{key:"isrep",title:"样板逆变器",align:"center",width:100,render:u=>e("span",null,[u.isrep==1?"是":"否"])},{key:"transformer",title:"箱式变压器",align:"center",width:100},{key:"collline",title:"集电线路",align:"center",width:100},{key:"unum",title:"机组编号",align:"center",width:180},{key:"pvmodule",title:"光组型号",align:"center",width:100},{key:"pvcount",title:"光组数量",align:"center",width:100},{key:"operate",title:_("common.operate"),align:"center",width:200,fixed:"right",render:u=>{let m;return e("div",{class:"flex-center gap-8px"},[D(e(U,{type:"primary",ghost:!0,size:"small",onClick:()=>F(u.id)},ee(m=_("common.edit"))?m:{default:()=>[m]}),[[j("no-auth"),"inverter:update"]]),D(e(Z,{onPositiveClick:()=>A(u.id)},{default:()=>_("common.confirmDelete"),trigger:()=>{let c;return e(U,{type:"error",ghost:!0,size:"small"},ee(c=_("common.delete"))?c:{default:()=>[c]})}}),[[j("no-auth"),"inverter:delete"]])])}}]}),{drawerVisible:N,operateType:I,editingData:x,handleAdd:T,handleEdit:V,checkedRowKeys:b,onBatchDeleted:E,onDeleted:C}=Ie($,v),q=async()=>{const u=b.value.join(","),{data:m,error:c}=await X({ids:u});c||(b.value=[])},A=async u=>{const{data:m,error:c}=await X({ids:u});c||C()},F=u=>{V(u)};return(u,m)=>{const c=G,r=ce,t=me,i=pe,f=Oe,o=Me,d=j("no-auth");return z(),je("div",Ee,[e(o,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[e(c,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:n(()=>[y(" 逆变器设置 ")]),_:1})]),"header-extra":n(()=>[e(c,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[D((z(),R(s(U),{onClick:s(T),size:"small",ghost:"",type:"primary"},{icon:n(()=>[e(r,{class:Y(["text-icon",{"animate-spin":s(a)}])},null,8,["class"])]),default:n(()=>[y(" "+O(s(_)("common.add")),1)]),_:1},8,["onClick"])),[[d,"inverter:insert"]]),D((z(),R(s(Z),{onPositiveClick:q},{trigger:n(()=>[e(s(U),{size:"small",ghost:"",type:"error",disabled:s(b).length==0},{icon:n(()=>[e(t,{class:Y(["text-icon",{"animate-spin":s(a)}])},null,8,["class"])]),default:n(()=>[y(" "+O(s(_)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:n(()=>[y(" 确认删除选中的项吗？ ")]),_:1})),[[d,"inverter:delete"]]),e(i,{columns:s(g),"onUpdate:columns":m[0]||(m[0]=p=>L(g)?g.value=p:null)},null,8,["columns"])]),_:1})]),default:n(()=>[e(f,{"checked-row-keys":s(b),"onUpdate:checkedRowKeys":m[1]||(m[1]=p=>L(b)?b.value=p:null),columns:s(M),data:s($),size:"small",loading:s(a),remote:"","flex-height":"","row-key":p=>p.id,pagination:s(k),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Je,{visible:s(N),"onUpdate:visible":m[2]||(m[2]=p=>L(N)?N.value=p:null),onSubmitted:s(v),"operate-type":s(I),"row-data":s(x),Pagination:s(k)},null,8,["visible","onSubmitted","operate-type","row-data","Pagination"])]),_:1})])}}});export{lt as default};
