import{_ as ut}from"./table-column-setting.vue_vue_type_script_setup_true_lang-RLvYZSGJ.js";import{_ as rt}from"./round-delete-DDXstZni.js";import{_ as it}from"./round-add-CDuxp0E4.js";import{d as qe,av as Ae,z as Ue,D as dt,s as $,aJ as Ee,A as Me,a as pt,ax as He,at as Oe,c as q,o as g,w as t,f as e,a3 as ct,M as Ve,G as N,h as u,au as oe,H as V,b as U,g as i,e as _,t as c,az as ft,B,aA as mt,J as Ne,$ as Z,a4 as Ge,aS as gt,aE as ce,cx as vt,cu as yt,cy as Je,cz as bt,cA as Pe,aG as ht,cB as Ke,cC as _t,Y as We,X as Qe,L as kt,a2 as Xe,aI as wt,i as Ct,F as Y,aK as xe,ay as Dt,I as O,aL as xt,aB as Tt,aD as $e,cD as Ie,cE as Ft,n as je,aQ as St}from"./index-CddQmI-c.js";import{u as Bt,a as zt}from"./table-DDoF-sKE.js";import{u as fe}from"./usePageData-BKzmIEAP.js";import{_ as Ye}from"./Grid-CG_YWdVR.js";import{_ as Ze}from"./FormItemGridItem-CBPP8HMS.js";import{_ as jt}from"./DatePicker-D516kcb4.js";import{_ as At}from"./round-search-DnVu2ZZt.js";import{_ as qt}from"./round-refresh-BklTS0D6.js";import{h as Re}from"./permission-C3pQCx4P.js";import{_ as Ut,a as Nt}from"./DescriptionsItem-Dl1iqQsU.js";import{N as pe}from"./Popconfirm-CkfL-ZaH.js";import{_ as Pt}from"./RadioButton-Dnz1Sa4x.js";const $t={key:0,style:{"margin-left":"20px"}},It={key:0,style:{"margin-left":"20px"}},Rt={key:0,style:{"margin-left":"20px"}},Lt={key:0,style:{"margin-left":"20px"}},Et=qe({name:"OperateDrawer",__name:"operate-drawer",props:Ae({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Ae(["submitted"],["update:visible"]),setup(M,{emit:me}){const F=me,D=Ue(),v=M,l=dt(G());function G(){return{pid:void 0,id:"",debugname:"",docker:void 0,dockcharge:"",dockcontact:"",status:0,notes:"",debugresult:0,dtype:void 0,starttime:null,endtime:null,dbcreater:void 0,startAndTimeRange:void 0,eqmid:void 0,re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const{pageData:H,getData:m,nextPage:P}=fe(gt),I=async()=>{await m({usertypes:"2,3"})},J=async o=>{const a=o.currentTarget,p=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&H.data.length<H.total&&(await P(),await ce(),setTimeout(()=>{a.scrollTop=p}))},{pageData:y,getData:ee,nextPage:ge}=fe(vt),ue=async o=>{const a=o.currentTarget,p=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&y.data.length<y.total&&(await ge(),y.data=y.data.map(T=>({...T,value:T.docker+"&id="+T.id})),await ce(),setTimeout(()=>{a.scrollTop=p}))},te=async()=>{await ee({pid:l.pid}),y.data=y.data.map(o=>({...o,value:o.docker+"&id="+o.id}))},ae=async o=>{var a;if(l.docker=o,l.docker){const[p,T]=(a=l.docker)==null?void 0:a.split("&id="),h=y.data.find(X=>X.docker==p&&X.id==T);h?(l.dockcharge=h.pname,l.dockcontact=h.pcontact):(l.dockcharge="",l.dockcontact="")}},{pageData:z,getData:ve,nextPage:re}=fe(yt),ye=async o=>{const a=o.currentTarget,p=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&z.data.length<z.total&&(await re(),await ce(),setTimeout(()=>{a.scrollTop=p}))},be=async()=>{await ve()},R=$([]),{pageData:A,getData:K,nextPage:ie}=fe(Je),w=async o=>{const a=o.currentTarget,p=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&A.data.length<A.total&&(await ie(),R.value=A.data,await ce(),setTimeout(()=>{a.scrollTop=p}))},b=async()=>{var o;await K({fuzzy:(o=v.rowData)==null?void 0:o.proname,page:1}),R.value=A.data},L=Ee.debounce(async o=>{await K({fuzzy:o,page:1}),R.value=A.data},300),E=$(!1),le=$(!1),he=o=>{if(l.pid=null,E.value=!0,le.value=!1,!o){r();return}L(o)},de=async()=>{E.value&&!le.value&&(await K({page:1}),R.value=A.data,E.value=!1)},r=async()=>{await K({page:1}),R.value=A.data},ne=async o=>{l.pid=o,le.value=!0,l.pid&&(W(),l.eqmid=null)},{pageData:_e,getData:n,nextPage:s}=fe(bt),x=async o=>{const a=o.currentTarget,p=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&z.data.length<z.total&&(await s(),await ce(),setTimeout(()=>{a.scrollTop=p}))},W=async()=>{await n({pid:l.pid})},Q=$(void 0);async function Te(){b(),be(),I(),Object.assign(l,G()),v.operateType==="add"&&(l.pid=v.pid?v.pid:void 0),v.operateType==="edit"&&v.rowData&&(Object.assign(l,v.rowData),Q.value=l.status,v.rowData.starttime&&v.rowData.endtime?l.startAndTimeRange=[Pe(v.rowData.starttime),Pe(v.rowData.endtime)]:l.startAndTimeRange=null),te(),l.pid&&W()}const{formRef:Fe,validate:we,restoreValidation:Se}=Me(),Be={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},eqmid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dbcreater:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"},debugname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcharge:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"}},C=pt(()=>({add:"新增待调试业务",edit:"修改待调试业务"})[v.operateType]),se=He(M,"visible");Oe(se,()=>{se.value&&(Te(),setTimeout(()=>{const o=document.querySelector(".n-scrollbar-content");o==null||o.scrollTo(0,0)},300),Se())});const k=$(0),S=$("");async function f({file:o},a){k.value=0,S.value=a;const p=await ht(o.file,o.name,"",T=>{k.value=T});p&&(l[a]=p,k.value=0)}function ke(){se.value=!1}async function Ce(o){if(o)try{const p=await(await fetch(o==null?void 0:o.split("?")[0],{mode:"cors"})).blob(),T=URL.createObjectURL(p),h=document.createElement("a");h.href=T,h.download=o==null?void 0:o.split("?")[1],h.style.display="none",document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(T)}catch(a){console.error("下载失败:",a)}}async function et(){var o;await we(),(o=window.$dialog)==null||o.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await tt()}})}async function tt(){var o,a,p,T;if(await we(),v.operateType==="edit"){const h=JSON.parse(JSON.stringify(l));Q.value==h.status&&delete h.status,h.docker=(o=h.docker)==null?void 0:o.split("&id=")[0];const{data:X,error:ze}=await Ke([h]);ze||(ke(),F("submitted"),(a=window.$message)==null||a.success("修改成功"))}else{const{data:h,error:X}=await _t([{...l,docker:(p=l.docker)==null?void 0:p.split("&id=")[0]}]);X||(ke(),F("submitted"),(T=window.$message)==null||T.success("添加成功"))}}async function De(o){var a;return o.file.file.size>100*1024*1024?((a=window.$message)==null||a.error("文件大小不能超过100M"),!1):!0}const at=o=>{var a;l.debugname=(a=z.data.find(p=>p.id==o))==null?void 0:a.tname,l.dtype=o};async function lt(o,a){l.startAndTimeRange=o,l.starttime=o==null?void 0:o[0],l.endtime=o==null?void 0:o[1]}return(o,a)=>{const p=Ze,T=ft,h=mt,X=Ye,ze=Ve,nt=ct,st=Ne,ot=Ge;return g(),q(ot,{show:se.value,"onUpdate:show":a[23]||(a[23]=d=>se.value=d),title:C.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:t(()=>[e(st,{justify:"end",size:16},{default:t(()=>[e(u(B),{onClick:ke},{default:t(()=>[i(c(u(Z)("common.cancel")),1)]),_:1}),e(u(B),{type:"primary",onClick:et},{default:t(()=>[i(c(u(Z)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(nt,{class:"pr-20px"},{default:t(()=>[e(ze,{ref_key:"formRef",ref:Fe,model:l,rules:Be,"label-placement":"left","label-width":120},{default:t(()=>[e(X,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 m:12",label:"项目列表",path:"pid"},{default:t(()=>[e(u(oe),{filterable:"",clearable:"",value:l.pid,"onUpdate:value":[a[0]||(a[0]=d=>l.pid=d),ne],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:r,onSearch:he,onBlur:de,options:R.value,onScroll:w},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"权重",path:"dtype"},{default:t(()=>[e(u(oe),{filterable:"",value:l.dtype,"onUpdate:value":[a[1]||(a[1]=d=>l.dtype=d),at],tag:"",placeholder:"请选择权重","label-field":"tname","value-field":"id",options:u(z).data,onScroll:ye},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"业务名称",path:"debugname"},{default:t(()=>[e(u(V),{value:l.debugname,"onUpdate:value":a[2]||(a[2]=d=>l.debugname=d),placeholder:"请输入"},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"调试人",path:"dbcreater"},{default:t(()=>[e(u(oe),{filterable:"",value:l.dbcreater,"onUpdate:value":a[3]||(a[3]=d=>l.dbcreater=d),placeholder:"请选择调试人","label-field":"username","value-field":"id",options:u(H).data,onScroll:J},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"待调试设备",path:"eqmid"},{default:t(()=>[e(u(oe),{filterable:"",clearable:"",value:l.eqmid,"onUpdate:value":a[4]||(a[4]=d=>l.eqmid=d),placeholder:"请选择待调试设备","label-field":"devname","value-field":"id",options:u(_e).data,onScroll:x},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"对接方",path:"docker"},{default:t(()=>[e(u(oe),{filterable:"",value:l.docker,"onUpdate:value":[a[5]||(a[5]=d=>l.docker=d),ae],clearable:"",tag:"",placeholder:"请选择或输入对接方","label-field":"docker","value-field":"value",options:u(y).data,onScroll:ue},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"对接方负责人",path:"dockcharge"},{default:t(()=>[e(u(V),{value:l.dockcharge,"onUpdate:value":a[6]||(a[6]=d=>l.dockcharge=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"联系方式",path:"dockcontact"},{default:t(()=>[e(u(V),{value:l.dockcontact,"onUpdate:value":a[7]||(a[7]=d=>l.dockcontact=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),v.operateType=="edit"?(g(),q(p,{key:0,span:"24 m:12",label:"状态",path:"status"},{default:t(()=>[e(u(oe),{clearable:"",value:l.status,"onUpdate:value":a[8]||(a[8]=d=>l.status=d),placeholder:"请选择",options:u(D).userInfo.usertype==0||u(D).userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}]},null,8,["value","options"])]),_:1})):N("",!0),e(p,{span:"24 m:24",label:"起止时间",path:"startAndTimeRange"},{default:t(()=>[e(u(jt),{clearable:"",value:l.startAndTimeRange,"onUpdate:value":a[9]||(a[9]=d=>l.startAndTimeRange=d),type:"daterange","value-format":"yyyy-MM-dd",style:{width:"100%"},"onUpdate:formattedValue":lt},null,8,["value"])]),_:1}),e(p,{span:"24 m:24",label:"备注",path:"notes"},{default:t(()=>[e(u(V),{value:l.notes,"onUpdate:value":a[10]||(a[10]=d=>l.notes=d),placeholder:"请输入"},null,8,["value"])]),_:1}),e(p,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:t(()=>[e(X,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 m:12",label:"附件1",path:"notes"},{default:t(()=>[e(u(V),{value:l.re1,"onUpdate:value":a[11]||(a[11]=d=>l.re1=d),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var d;return[l.fl1?(g(),U("span",$t,[i(c((d=l.fl1)==null?void 0:d.split("?")[1])+" ",1),_("span",{class:"cursor-pointer c-#c92a2a",onClick:a[12]||(a[12]=j=>l.fl1="")},"删除"),_("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[13]||(a[13]=j=>Ce(l.fl1))},"下载")])):(g(),q(T,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":j=>f(j,"fl1"),"show-file-list":!1,onBeforeUpload:De},{default:t(()=>[e(u(B),{loading:k.value>0&&!l.fl1&&S.value=="fl1",size:"small",ghost:"",type:"primary"},{default:t(()=>[i(c(k.value>0&&!l.fl1&&S.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),k.value&&!l.fl1&&S.value=="fl1"?(g(),q(h,{key:2,type:"line",percentage:k.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):N("",!0)]}),_:1})]),_:1})]),_:1}),e(p,{span:"24 m:12",label:"附件2",path:"notes"},{default:t(()=>[e(u(V),{value:l.re2,"onUpdate:value":a[14]||(a[14]=d=>l.re2=d),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var d;return[l.fl2?(g(),U("span",It,[i(c((d=l.fl2)==null?void 0:d.split("?")[1])+" ",1),_("span",{class:"cursor-pointer c-#c92a2a",onClick:a[15]||(a[15]=j=>l.fl2="")},"删除"),_("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[16]||(a[16]=j=>Ce(l.fl2))},"下载")])):(g(),q(T,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":j=>f(j,"fl2"),"show-file-list":!1,onBeforeUpload:De},{default:t(()=>[e(u(B),{loading:k.value>0&&!l.fl2&&S.value=="fl2",size:"small",ghost:"",type:"primary"},{default:t(()=>[i(c(k.value>0&&!l.fl2&&S.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),k.value&&!l.fl2&&S.value=="fl2"?(g(),q(h,{key:2,type:"line",percentage:k.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):N("",!0)]}),_:1}),e(p,{span:"24 m:12",label:"附件3",path:"notes"},{default:t(()=>[e(u(V),{value:l.re3,"onUpdate:value":a[17]||(a[17]=d=>l.re3=d),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var d;return[l.fl3?(g(),U("span",Rt,[i(c((d=l.fl3)==null?void 0:d.split("?")[1])+" ",1),_("span",{class:"cursor-pointer c-#c92a2a",onClick:a[18]||(a[18]=j=>l.fl3="")},"删除"),_("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[19]||(a[19]=j=>Ce(l.fl3))},"下载")])):(g(),q(T,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":j=>f(j,"fl3"),"show-file-list":!1,onBeforeUpload:De},{default:t(()=>[e(u(B),{loading:k.value>0&&!l.fl3&&S.value=="fl3",size:"small",ghost:"",type:"primary"},{default:t(()=>[i(c(k.value>0&&!l.fl3&&S.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),k.value&&!l.fl3&&S.value=="fl3"?(g(),q(h,{key:2,type:"line",percentage:k.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):N("",!0)]}),_:1}),e(p,{span:"24 m:12",label:"附件4",path:"notes"},{default:t(()=>[e(u(V),{value:l.re4,"onUpdate:value":a[20]||(a[20]=d=>l.re4=d),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var d;return[l.fl4?(g(),U("span",Lt,[i(c((d=l.fl4)==null?void 0:d.split("?")[1])+" ",1),_("span",{class:"cursor-pointer c-#c92a2a",onClick:a[21]||(a[21]=j=>l.fl4="")},"删除"),_("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[22]||(a[22]=j=>Ce(l.fl4))},"下载")])):(g(),q(T,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":j=>f(j,"fl4"),"show-file-list":!1,onBeforeUpload:De},{default:t(()=>[e(u(B),{loading:k.value>0&&!l.fl4&&S.value=="fl4",size:"small",ghost:"",type:"primary"},{default:t(()=>[i(c(k.value>0&&!l.fl4&&S.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),k.value&&!l.fl4&&S.value=="fl4"?(g(),q(h,{key:2,type:"line",percentage:k.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):N("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Mt=qe({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Ae(["reset","search","search1","clear"],["update:model"]),setup(M,{emit:me}){const F=We(),D=Qe(),v=me,l=Ue(),{formRef:G,restoreValidation:H}=Me(),m=He(M,"model"),P=$([]),{pageData:I,getData:J,nextPage:y}=fe(Je),ee=async w=>{const b=w.currentTarget,L=b.scrollTop;b.scrollTop+b.offsetHeight>=b.scrollHeight&&I.data.length<I.total&&(await y(),P.value=I.data,await ce(),setTimeout(()=>{b.scrollTop=L}))},ge=async w=>{var b;ae.value=!0,w?(m.value.pid=w,v("search1"),l.setProjectInfo({pname:(b=P.value.find(L=>L.id==w))==null?void 0:b.proname,pid:w})):v("clear")},ue=Ee.debounce(async w=>{await J({fuzzy:w,page:1}),P.value=I.data},300),te=$(!1),ae=$(!1),z=w=>{if(m.value.pid=null,te.value=!0,ae.value=!1,!w){re();return}ue(w)},ve=async()=>{te.value&&!ae.value&&(await J({page:1}),P.value=I.data,te.value=!1)},re=async()=>{await J({page:1}),P.value=I.data,v("search1")},ye=async w=>{m.value.status=w,v("search1")},be=async()=>{m.value.status=null},R=async()=>{await J({fuzzy:D.query.pname?D.query.pname:""}),P.value=I.data,m.value.pid=D.query.prjId?Number(D.query.prjId):void 0,m.value.fuzzy=D.query.debugname?D.query.debugname:"",l.setProjectInfo({pid:m.value.pid,pname:D.query.pname?D.query.pname:""}),v("search"),setTimeout(()=>{F.replace({path:D.path,query:{}})},10)};R();async function A(){await H(),m.value.fuzzy="",m.value.pid=null,m.value.status=null,v("reset")}const K=()=>{m.value.fuzzy="",v("search")};async function ie(){v("search")}return Oe(()=>D.query,w=>{w.pname&&R()}),(w,b)=>{const L=oe,E=Ze,le=V,he=qt,de=B,r=At,ne=Ne,_e=Ye,n=Ve,s=Xe;return g(),q(s,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(n,{ref_key:"formRef",ref:G,model:m.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:kt(ie,["enter"])},{default:t(()=>[e(_e,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(E,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:t(()=>[e(L,{filterable:"",clearable:"",value:m.value.pid,"onUpdate:value":[b[0]||(b[0]=x=>m.value.pid=x),ge],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:re,onSearch:z,onBlur:ve,options:P.value,onScroll:ee},null,8,["value","options"])]),_:1}),e(E,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:t(()=>[e(L,{clearable:"",filterable:"",value:m.value.status,"onUpdate:value":[b[1]||(b[1]=x=>m.value.status=x),ye],placeholder:"请选择状态",onClear:be,options:[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]},null,8,["value"])]),_:1}),e(E,{span:"24 s:12 m:6",label:"业务名称",path:"fuzzy"},{default:t(()=>[e(le,{value:m.value.fuzzy,"onUpdate:value":b[2]||(b[2]=x=>m.value.fuzzy=x),placeholder:"请输入",clearable:"",onClear:K},null,8,["value"])]),_:1}),e(E,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(ne,{class:"w-full"},{default:t(()=>[e(de,{onClick:A},{icon:t(()=>[e(he,{class:"text-icon"})]),default:t(()=>[i(" "+c(u(Z)("common.reset")),1)]),_:1}),e(de,{type:"primary",ghost:"",onClick:ie},{icon:t(()=>[e(r,{class:"text-icon"})]),default:t(()=>[i(" "+c(u(Z)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ht={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ot={key:0},Vt={key:1},Gt={key:0},Jt={key:1},Kt={key:0},Wt={key:1},Qt={key:0},Xt={key:1};function Le(M){return typeof M=="function"||Object.prototype.toString.call(M)==="[object Object]"&&!St(M)}const fa=qe({name:"projectmanagement_business",__name:"index",setup(M){const me=wt(),F=Ue(),D=Qe(),v=We(),{columns:l,columnChecks:G,data:H,getData:m,loading:P,pagination:I,mobilePagination:J,searchParams:y}=Bt({showTotal:!0,immediate:!1,apiFn:Ft,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",status:null,dbcreater:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"debugname",title:"业务名称",align:"center",width:160},{key:"proname",title:"所属项目",align:"center",width:160,render(n){return e("span",{class:"cursor-pointer",onClick:()=>ye(n)},[n.proname])}},{key:"status",title:"状态",align:"center",width:100,render(n){return e($e,{color:{color:n.status==-1?"rgba(251, 146, 60, 0.15)":n.status==0?"rgba(156, 163, 175, 0.15)":n.status==1?"rgba(59, 130, 246, 0.15)":n.status==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:n.status==-1?"#FB923C":n.status==0?"#9CA3AF":n.status==1?"#3B82F6":n.status==2?"#FACC15":"#10B981",borderColor:n.status==-1?"#FB923C":n.status==0?"#9CA3AF":n.status==1?"#3B82F6":n.status==2?"#FACC15":"#10B981"}},{default:()=>[n.status==-1?"申请中":n.status==0?"待调试":n.status==1?"开始调试":n.status==2?"待审核":"审核完成"]})}},{key:"eqmname",title:"调试设备",align:"center",width:150},{key:"docker",title:"对接信息",align:"left",width:200,render:n=>e("div",{style:"line-height: 1.4;"},[e("div",null,[e("span",{style:"color:#666"},[i("对接方：")]),e("span",{style:"font-weight:500"},[n.docker||"-"])]),e("div",null,[e("span",{style:"color:#666"},[i("负责人：")]),e("span",{style:"font-weight:500"},[n.dockcharge||"-"])]),e("div",null,[e("span",{style:"color:#666"},[i("联系方式：")]),e("span",{style:"font-weight:500"},[n.dockcontact||"-"])])])},{key:"dbusername",title:"调试信息",align:"left",width:200,render(n){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[i("调试人：")]),e("span",{style:"font-weight:500"},[n.dbusername||"-"])]),e("div",null,[e("span",{style:"color:#666"},[i("工时：")]),e("span",{style:"color:#1890ff; font-weight:500"},[n.duration||"-"])]),e("div",null,[e("span",{style:"color:#666"},[i("开始：")]),e("span",null,[n.dbdbtime||"-"])]),e("div",null,[e("span",{style:"color:#666"},[i("结束：")]),e("span",null,[n.dedbtime||"-"])])])}},{key:"ckusername",title:"审核信息",align:"left",width:200,render(n){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[i("审核人：")]),e("span",{style:"font-weight:500"},[n.ckusername||"-"])]),e("div",null,[e("span",{style:"color:#666"},[i("时间：")]),e("span",{style:" font-weight:500"},[n.ckdbtime||"-"])])])}},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(n){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[i("创建人：")]),e("span",{style:"font-weight:500"},[n.username||"-"])]),e("div",null,[e("span",{style:"color:#666"},[i("时间：")]),e("span",{style:" font-weight:500"},[n.dbtime||"-"])])])}},{key:"operate",title:Z("common.operate"),align:"center",width:Re("project:Debug:update")||Re("project:Debug:delete")?280:0,fixed:"right",render:n=>{let s;return e("div",{class:"flex-center gap-8px"},[n.status==-1&&(F.userInfo.usertype==0||F.userInfo.usertype==2)&&e(pe,{onPositiveClick:()=>A(n,0)},{default:()=>"确定通过申请吗？",trigger:()=>O(e(B,{type:"warning",ghost:!0,size:"small"},{default:()=>["通过申请"]}),[[Y("no-auth"),"project:Debug:update"]])}),n.status==0&&n.dbcreater==F.userInfo.id&&e(pe,{onPositiveClick:()=>A(n,1)},{default:()=>"确定开始调试吗？",trigger:()=>O(e(B,{type:"success",ghost:!0,size:"small"},{default:()=>["开始"]}),[[Y("no-auth"),"project:Debug:update"]])}),n.status==1&&n.dbcreater==F.userInfo.id&&e(pe,{onPositiveClick:()=>A(n,2)},{default:()=>je("div",[je("div","确定完成调试？"),je("div",{style:{color:"#d03050",fontWeight:"500",marginTop:"6px"}},"请确认资料已提交，否则将拒绝审核！")]),trigger:()=>O(e(B,{type:"success",ghost:!0,size:"small"},{default:()=>["完成"]}),[[Y("no-auth"),"project:Debug:update"]])}),n.status==2&&(F.userInfo.usertype==0||F.userInfo.usertype==2)&&e(pe,{onPositiveClick:()=>A(n,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>O(e(B,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[Y("no-auth"),"project:Debug:update"]])}),O(e(B,{type:"primary",ghost:!0,size:"small",onClick:()=>_e(n)},{default:()=>[i("详情")]}),[[Y("no-auth"),"project:Debug:select"]]),O(e(B,{type:"primary",ghost:!0,size:"small",onClick:()=>K(n.id)},Le(s=Z("common.edit"))?s:{default:()=>[s]}),[[Y("no-auth"),"project:Debug:update"]]),(F.userInfo.usertype==0||F.userInfo.usertype==2)&&e(pe,{onPositiveClick:()=>R(n)},{default:()=>Z("common.confirmDelete"),trigger:()=>{let x;return O(e(B,{type:"error",ghost:!0,size:"small"},Le(x=Z("common.delete"))?x:{default:()=>[x]}),[[Y("no-auth"),"project:Debug:delete"]])}})])}}]}),{drawerVisible:ee,operateType:ge,editingData:ue,handleAdd:te,handleEdit:ae,checkedRowKeys:z,onBatchDeleted:ve,onDeleted:re}=zt(H,m);Ct(async()=>{});const ye=n=>{F.setProjectInfo({pid:n.pid,pname:n.proname}),v.push("/projectmanagement/orderdetail?prjId="+n.pid+`&pname=${n.proname}&IsScroll=1`)};async function be(){console.log(z.value),w(z.value.join(","),n=>{ve()})}async function R(n){const{data:s,error:x}=await Ie(n.id,n.pid);x||re()}const A=async(n,s)=>{var Q;const{data:x,error:W}=await Ke([{id:n.id,status:s,pid:n.pid}]);W||((Q=window.$message)==null||Q.success("操作成功"),m(),s==3?window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:n.pid,type:"debug"}})):(s==1||s==2)&&window.dispatchEvent(new CustomEvent("refreshTodo")))};function K(n){ae(n)}function ie(){te(),ue.value=null}async function w(n,s){const{data:x,error:W}=await Ie(n,y.pid);if(!W)s&&s(x);else return!1}const b=$(-1),L=n=>{n>0?(b.value=n,y.dbcreater=JSON.parse(JSON.stringify(n)),m()):(y.dbcreater=void 0,b.value=-1,m())},E=n=>{m()},le=()=>{if(console.log(D.query.prjId,"route.query.prjId"),D.query.debug){y.status=Number(D.query.debug),y.dbcreater=F.userInfo.id,L(F.userInfo.id);return}D.query.types=="2"&&(y.status=2),D.query.types=="-1"&&(y.status=-1),m()},he=()=>{m()},de=()=>{H.value=[],I.itemCount=0},r=$(null),ne=$(!1),_e=n=>{r.value=n,ne.value=!0};return(n,s)=>{const x=Pt,W=Tt,Q=Ne,Te=it,Fe=rt,we=ut,Se=Dt,Be=Xe,C=Nt,se=Ut,k=Ge,S=Y("no-auth");return g(),U("div",Ht,[e(Mt,{model:u(y),"onUpdate:model":s[0]||(s[0]=f=>xe(y)?y.value=f:null),onReset:he,onSearch:le,onSearch1:u(m),onClear:de},null,8,["model","onSearch1"]),e(Be,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(Q,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[s[6]||(s[6]=_("div",null,"待调试业务",-1)),e(W,{size:"small",value:b.value,"onUpdate:value":[s[1]||(s[1]=f=>b.value=f),L],name:"radiobuttongroup1"},{default:t(()=>[e(x,{value:-1,label:"默认"}),e(x,{value:u(F).userInfo.id,label:"我的调试"},null,8,["value"])]),_:1},8,["value"])]),_:1,__:[6]})]),"header-extra":t(()=>[e(Q,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[O((g(),q(u(B),{onClick:ie,size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(Te,{class:"text-icon"})]),default:t(()=>[s[7]||(s[7]=i(" "+c("新增")))]),_:1,__:[7]})),[[S,"project:Debug:insert"]]),e(u(pe),{onPositiveClick:be},{trigger:t(()=>[O((g(),q(u(B),{size:"small",ghost:"",type:"error",disabled:u(z).length==0},{icon:t(()=>[e(Fe,{class:xt(["text-icon",{"animate-spin":u(P)}])},null,8,["class"])]),default:t(()=>[s[8]||(s[8]=i(" "+c("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[S,"project:Debug:delete"]])]),default:t(()=>[s[9]||(s[9]=i(" 确定要删除选中的吗？ "))]),_:1,__:[9]}),e(we,{columns:u(G),"onUpdate:columns":s[2]||(s[2]=f=>xe(G)?G.value=f:null),ctype:3},null,8,["columns"])]),_:1})]),default:t(()=>[e(Se,{"checked-row-keys":u(z),"onUpdate:checkedRowKeys":s[3]||(s[3]=f=>xe(z)?z.value=f:null),columns:u(l),data:u(H),size:"small","flex-height":!u(me).isMobile,loading:u(P),remote:"","row-key":f=>f.id,"scroll-x":u(l).reduce((f,ke)=>f+(ke.width||100),0),pagination:u(J),class:"sm:h-full","onUpdate:filters":E},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","scroll-x","pagination"]),e(Et,{visible:u(ee),"onUpdate:visible":s[4]||(s[4]=f=>xe(ee)?ee.value=f:null),onSubmitted:u(m),"operate-type":u(ge),pid:u(y).pid,"row-data":u(ue)},null,8,["visible","onSubmitted","operate-type","pid","row-data"])]),_:1}),e(k,{show:ne.value,"onUpdate:show":s[5]||(s[5]=f=>ne.value=f),title:"查看详情",preset:"card",class:"w-1200px"},{default:t(()=>[e(se,{bordered:"","label-placement":"left","label-align":"center",columns:2,"label-style":{width:"160px"}},{default:t(()=>[e(C,null,{label:t(()=>s[10]||(s[10]=[i(" 权重 ")])),default:t(()=>[_("span",null,c(r.value.tname),1)]),_:1}),e(C,null,{label:t(()=>s[11]||(s[11]=[i(" 业务名称 ")])),default:t(()=>[_("span",null,c(r.value.debugname),1)]),_:1}),e(C,null,{label:t(()=>s[12]||(s[12]=[i(" 计划起止时间 ")])),default:t(()=>[_("span",null,c(r.value.starttime)+"--"+c(r.value.endtime),1)]),_:1}),e(C,null,{label:t(()=>s[13]||(s[13]=[i(" 对接方 ")])),default:t(()=>[_("span",null,c(r.value.docker.split("&id=")[0]),1)]),_:1}),e(C,null,{label:t(()=>s[14]||(s[14]=[i(" 对接方负责人 ")])),default:t(()=>[_("span",null,c(r.value.dockcharge),1)]),_:1}),e(C,null,{label:t(()=>s[15]||(s[15]=[i(" 联系方式 ")])),default:t(()=>[_("span",null,c(r.value.dockcontact),1)]),_:1}),e(C,null,{label:t(()=>s[16]||(s[16]=[i(" 状态 ")])),default:t(()=>[e(u($e),{color:{color:r.value.status==-1?"rgba(251, 146, 60, 0.15)":r.value.status==0?"rgba(156, 163, 175, 0.15)":r.value.status==1?"rgba(59, 130, 246, 0.15)":r.value.status==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:r.value.status==-1?"#FB923C":r.value.status==0?"#9CA3AF":r.value.status==1?"#3B82F6":r.value.status==2?"#FACC15":"#10B981",borderColor:r.value.status==-1?"#FB923C":r.value.status==0?"#9CA3AF":r.value.status==1?"#3B82F6":r.value.status==2?"#FACC15":"#10B981"}},{default:t(()=>[i(c(r.value.status==-1?"申请中":r.value.status==0?"待调试":r.value.status==1?"开始调试":r.value.status==2?"待审核":"审核完成"),1)]),_:1},8,["color"])]),_:1}),e(C,null,{label:t(()=>s[17]||(s[17]=[i(" 备注 ")])),default:t(()=>[_("span",null,c(r.value.notes),1)]),_:1}),e(C,null,{label:t(()=>s[18]||(s[18]=[i(" 调试人 ")])),default:t(()=>[_("span",null,c(r.value.dbusername),1)]),_:1}),e(C,null,{label:t(()=>s[19]||(s[19]=[i(" 调试开始时间 ")])),default:t(()=>[_("span",null,c(r.value.dbdbtime),1)]),_:1}),e(C,null,{label:t(()=>s[20]||(s[20]=[i(" 调试结束时间 ")])),default:t(()=>[_("span",null,c(r.value.dedbtime),1)]),_:1}),e(C,null,{label:t(()=>s[21]||(s[21]=[i(" 调试工时 ")])),default:t(()=>[_("span",null,c(r.value.duration),1)]),_:1}),e(C,null,{label:t(()=>s[22]||(s[22]=[i(" 审核人 ")])),default:t(()=>[_("span",null,c(r.value.ckusername),1)]),_:1}),e(C,null,{label:t(()=>s[23]||(s[23]=[i(" 审核时间 ")])),default:t(()=>[_("span",null,c(r.value.ckdbtime),1)]),_:1}),e(C,null,{label:t(()=>s[24]||(s[24]=[i(" 附件1 ")])),default:t(()=>{var f;return[r.value.re1?(g(),U("span",Ot,"文件别名"+c(r.value.re1),1)):N("",!0),r.value.fl1?(g(),U("span",Vt,c((f=r.value.fl1)==null?void 0:f.split("?")[1]),1)):N("",!0)]}),_:1}),e(C,null,{label:t(()=>s[25]||(s[25]=[i(" 附件2 ")])),default:t(()=>{var f;return[r.value.re2?(g(),U("span",Gt,"文件别名"+c(r.value.re2),1)):N("",!0),r.value.fl2?(g(),U("span",Jt,c((f=r.value.fl2)==null?void 0:f.split("?")[1]),1)):N("",!0)]}),_:1}),e(C,null,{label:t(()=>s[26]||(s[26]=[i(" 附件3 ")])),default:t(()=>{var f;return[r.value.re3?(g(),U("span",Kt,"文件别名"+c(r.value.re3),1)):N("",!0),r.value.fl3?(g(),U("span",Wt,c((f=r.value.fl3)==null?void 0:f.split("?")[1]),1)):N("",!0)]}),_:1}),e(C,null,{label:t(()=>s[27]||(s[27]=[i(" 附件4 ")])),default:t(()=>{var f;return[r.value.re4?(g(),U("span",Qt,"文件别名"+c(r.value.re4),1)):N("",!0),r.value.fl4?(g(),U("span",Xt,c((f=r.value.fl4)==null?void 0:f.split("?")[1]),1)):N("",!0)]}),_:1})]),_:1})]),_:1},8,["show"])])}}});export{fa as default};
