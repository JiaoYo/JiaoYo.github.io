import{aq as S,d as je,q as Ue,r as k,bU as te,i as We,y as Le,b as y,o as i,f as o,e as r,w as s,G as Ne,F as ne,h as a,az as Ae,N as Pe,B as w,g as p,t as m,U as F,z as b,ax as Te,c as g,bB as qe,aR as oe,aV as se,D as T,aQ as Re,V as De,T as Be,C as W,cG as Ee,cU as Ve,A as Ge,cV as Fe,aA as Ie,aB as Ke,aE as Me,aH as ae,cl as Oe,aL as He}from"./index--GDXRx9n.js";import{_ as Je,a as Qe,b as Xe,c as Ye}from"./edit-BcmcS24K.js";import{_ as Ze}from"./round-search-6gH5MaEH.js";import{u as et}from"./upload-ZyVQj5yj.js";import{u as tt}from"./usePageData-GADHvGie.js";import{_ as nt}from"./Grid-BGC0jP0v.js";import{_ as ot}from"./FormItemGridItem-E0R4IJbx.js";import{_ as I,a as st}from"./text-zWUA8Q-w.js";import{N as at}from"./Popconfirm-qjJSRAua.js";import"./v4-FuVw324d.js";function lt(v){return S({url:"/projectWeek/getPage.do",method:"get",params:v})}function it(v){return S({url:"/projectWeek/insert.do",method:"post",data:v})}function rt(v){return S({url:"/projectWeek/update.do",method:"put",data:v})}function ct(v){return S({url:"/projectWeek/delete.do",method:"delete",params:{arrIds:v}})}function ut(v){return S({url:"/projectWeekComment/getPage.do",method:"get",params:v})}function dt(v){return S({url:"/projectWeekComment/insert.do",method:"post",data:v})}function pt(v){return S({url:"/projectWeekComment/delete.do",method:"delete",params:{arrIds:v}})}const mt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto p-20px"},ft={style:{display:"flex",height:"100%"}},_t={key:1},vt={class:"flex items-center"},yt={class:"flex items-center"},gt={class:"flex-col ml-10px"},ht={class:"font-size-18px font-bold"},wt={class:"c-#868e96 font-size-14px"},xt={key:0},kt={class:"mt-3 mb-3 text-gray-700 preview-text"},bt={class:"mt-3 mb-3 text-gray-700 preview-text"},Ct={class:"mt-3 mb-3 text-gray-700 preview-text"},zt={class:"mt-3 mb-3 text-gray-700 preview-text"},$t={class:"mt-3 mb-3 text-gray-700 preview-text"},St={key:1,class:"mt-3 mb-3 text-gray-700 preview-text"},jt={key:2,class:"mt-3 mb-3 text-gray-700 preview-text"},Ut={key:1,class:"mt-1 flex items-center gap-3 text-sm text-gray-500"},Wt=["onClick"],Lt={key:0,class:"mt-4 border-t pt-3"},Nt={class:"flex items-start gap-2 mb-3"},At={class:"ml-2 flex-1"},Pt={class:"flex items-center"},Tt={class:"font-medium font-size-16px font-bold"},qt={class:"text-gray-600 mt-1"},Rt={key:0,style:{display:"flex","justify-content":"flex-end","margin-top":"10px"}},Dt={key:0,class:"relative inline-block group"},Bt={key:0,class:""},Et={key:1,class:"flex items-center w-300px"},Vt=je({name:"projectmanagement_memberlog",__name:"index",setup(v){const K=Ue(),L=k({creater:void 0}),{pageData:N,getData:le,nextPage:ie}=tt(Oe),re=async n=>{const e=n.currentTarget,c=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&N.data.length<N.total&&(await ie(),await ae(),setTimeout(()=>{e.scrollTop=c}))},ce=async n=>{L.value.creater=n,C()},ue=async()=>{le({usertypes:"2,3"}),N.data=N.data.map(n=>(n.avatar="https://cdn-icons-png.flaticon.com/128/3135/3135715.png",n))},D={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},de={content1:{required:!0,message:"请输入",trigger:"blur"}},B=k("add"),A=k(!1),E=k(-1),z=k([]),h=k({page:1,limit:10,total:0}),V=k(null),l=k({id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}),pe=n=>{h.value.page=n,C()},me=n=>{h.value.limit=n,C()},C=async()=>{const{data:n,error:e}=await lt({page:h.value.page,limit:h.value.limit,creater:L.value.creater});n&&(z.value=n.list.map((c,u)=>(E.value!=u?c.showAll=!1:c.showAll=!0,c.showCommentSection=!1,c)),h.value.total=n.total)},j=k(0);async function M({file:n},e){const c=await et(n.file,n.name,"",u=>{j.value=u});c&&(console.log("文件上传成功"),e=="file1"?l.value.file1=c:l.value.file2=c,j.value=0)}const fe=(n,e)=>{A.value=!0,B.value="edit",l.value=JSON.parse(JSON.stringify(n)),E.value=e},_e=async n=>{var u;const{data:e,error:c}=await ct(n.id);e&&((u=window.$message)==null||u.success("删除成功"),z.value.length===1&&h.value.page>1&&h.value.page--,C())},ve=()=>{A.value=!0,B.value="add",l.value={id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""},E.value=-1},ye=te.debounce(async()=>{var n,e,c;if(await((n=V.value)==null?void 0:n.validate()),l.value.id){const{data:u,error:d}=await rt([l.value]);u&&((e=window.$message)==null||e.success("编辑成功"))}else{const{data:u,error:d}=await it([l.value]);u&&((c=window.$message)==null||c.success("新增成功"))}await C(),O()},1e3,{leading:!0,trailing:!1}),O=()=>{A.value=!1,l.value={id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}};We(async()=>{await ue(),C()});const G=async n=>{const{data:e,error:c}=await ut({page:1,limit:100,pid:n});if(e){const u=z.value.find(d=>d.id===n);u&&(u.comments=e.list)}},ge=async n=>{G(n.id),z.value.forEach(e=>{e.id!==n.id&&(e.showCommentSection=!1)}),n.showCommentSection=!n.showCommentSection,n.showCommentSection&&await we(`comment-input-${n.id}`)},he=async(n,e)=>{var d;const{data:c,error:u}=await pt(n.id);c&&(G(n.pid),e.num--,(d=window.$message)==null||d.success("删除成功"))},q=k({}),H=te.debounce(async n=>{var d,x;const e=q.value[n.id];if(!(e!=null&&e.trim()))return(d=window.$message)==null?void 0:d.warning("请输入评论内容");const{data:c,error:u}=await dt([{pid:n.id,content:e}]);c&&((x=window.$message)==null||x.success("评论成功"),q.value[n.id]="",n.num++,G(n.id))},1e3,{leading:!0,trailing:!1});async function we(n,e=8,c=30){var d;await ae();for(let x=0;x<e;x++){const _=document.querySelector(`#${n} textarea`);if(_&&typeof _.focus=="function"){_.focus();const U=_.value;if(U&&_.setSelectionRange){const R=U.length;_.setSelectionRange(R,R)}return!0}await new Promise(U=>setTimeout(U,c))}const u=document.getElementById(n);return u&&(u.tabIndex=-1,(d=u.focus)==null||d.call(u)),!1}async function J(n){if(!n)return;const e=n.split("?")[0],c=n.split("?")[1];try{const d=await(await fetch(e,{mode:"cors"})).blob(),x=URL.createObjectURL(d),_=document.createElement("a");_.href=x,_.download=c,_.style.display="none",document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(x)}catch(u){console.error("下载失败:",u)}}return(n,e)=>{const c=ot,u=Ze,d=Pe,x=nt,_=Ne,U=Ye,R=Je,xe=Qe,Q=Re,ke=Xe,X=at,be=Ve,$=Ge,Ce=Fe,Y=Ie,ze=Ke,$e=Me,P=Le("no-auth");return i(),y("div",mt,[o(a(F),{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[o(_,{ref_key:"formRef",ref:V,model:L.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(C,["enter"])},{default:s(()=>[o(x,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[o(c,{span:"24 s:12 m:6",label:"调试人员",path:"pid"},{default:s(()=>[o(a(Ae),{clearable:"",filterable:"",value:L.value.creater,"onUpdate:value":[e[0]||(e[0]=t=>L.value.creater=t),ce],placeholder:"请选择","label-field":"username","value-field":"id",options:a(N).data,onScroll:re},null,8,["value","options"])]),_:1}),o(c,{span:"24  s:12 m:6",class:"pr-24px"},{default:s(()=>[o(d,{class:"w-full"},{default:s(()=>[o(a(w),{type:"primary",ghost:"",onClick:C},{icon:s(()=>[o(u,{class:"text-icon"})]),default:s(()=>[p(" "+m(n.$t("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),r("div",ft,[o(a(F),null,{header:s(()=>e[11]||(e[11]=[p("技术支持周报")])),"header-extra":s(()=>[T((i(),g(a(w),{type:"primary",ghost:"",onClick:ve},{icon:s(()=>[o(U)]),default:s(()=>[e[12]||(e[12]=p(" 写周报 "))]),_:1,__:[12]})),[[P,"project:Week:insert"]])]),default:s(()=>[o(a(Te),{style:{height:"calc(100vh - 350px)"}},{default:s(()=>[z.value.length?(i(),y("div",_t,[(i(!0),y(oe,null,se(z.value,(t,Se)=>(i(),g(a(F),{key:t.id,class:"mb-4",title:"",size:"small"},{default:s(()=>{var Z,ee;return[r("div",vt,[r("div",yt,[t.showAll?(i(),g(R,{key:0,class:"font-size-20px mr-10px cursor-pointer",onClick:f=>t.showAll=!t.showAll},null,8,["onClick"])):(i(),g(xe,{key:1,class:"font-size-20px mr-10px cursor-pointer",onClick:f=>t.showAll=!t.showAll},null,8,["onClick"])),o(a(I),{src:D.avatar},null,8,["src"]),r("div",gt,[r("span",ht,m(t.username)+"的技术支持周报",1),r("span",wt,m(t.dbtime),1)])])]),t.showAll?(i(),y("div",xt,[e[15]||(e[15]=r("h3",{class:"font-size-16px font-bold mt-2"},"本周完成：",-1)),r("div",kt,m(t.content1),1),e[16]||(e[16]=r("h3",{class:"font-size-16px font-bold mt-2"},"本周对你帮助最大的人，具体描述一下对你的帮助：",-1)),r("div",bt,m(t.content2),1),e[17]||(e[17]=r("h3",{class:"font-size-16px font-bold mt-2"},"未完成项目",-1)),r("div",Ct,m(t.content3),1),e[18]||(e[18]=r("h3",{class:"font-size-16px font-bold mt-2"},"下周计划：",-1)),r("div",zt,m(t.content4),1),e[19]||(e[19]=r("h3",{class:"font-size-16px font-bold mt-2"},"需协调与帮助：",-1)),r("div",$t,m(t.content5),1),e[20]||(e[20]=r("h3",{class:"font-size-16px font-bold mt-2"},"图片：",-1)),t.file1?(i(),g(Q,{key:0,width:"80",height:"80",src:t.file1,class:"rounded-md object-cover"},null,8,["src"])):b("",!0),t.file1?(i(),y("div",St,[p(m((Z=t.file1)==null?void 0:Z.split("?")[1])+" ",1),o(a(w),{text:"",type:"primary",size:"small",onClick:f=>J(t.file1)},{default:s(()=>e[13]||(e[13]=[p("下载")])),_:2,__:[13]},1032,["onClick"])])):b("",!0),e[21]||(e[21]=r("h3",{class:"font-size-16px font-bold mt-2"},"附件：",-1)),t.file2?(i(),y("div",jt,[p(m((ee=t.file2)==null?void 0:ee.split("?")[1])+" ",1),o(a(w),{text:"",type:"primary",size:"small",onClick:f=>J(t.file2)},{default:s(()=>e[14]||(e[14]=[p("下载")])),_:2,__:[14]},1032,["onClick"])])):b("",!0)])):b("",!0),t.showAll?(i(),y("div",Ut,[r("span",{class:"cursor-pointer hover:text-blue-500",style:De({color:t.showCommentSection?"#1890ff":""}),onClick:f=>ge(t)},[o(ke,{class:"font-size-18px"}),p(" "+m(t.num==0?"":t.num),1)],12,Wt),a(K).userInfo.id==t.creater?(i(),g(d,{key:0},{default:s(()=>[T((i(),g(a(w),{quaternary:"",type:"info",size:"small",onClick:f=>fe(t,Se)},{default:s(()=>e[22]||(e[22]=[p(" 编辑 ")])),_:2,__:[22]},1032,["onClick"])),[[P,"project:Week:update"]]),o(X,{onPositiveClick:f=>_e(t)},{trigger:s(()=>[T((i(),g(a(w),{quaternary:"",type:"error",size:"small"},{default:s(()=>e[23]||(e[23]=[p(" 删除 ")])),_:1,__:[23]})),[[P,"project:Week:delete"]])]),default:s(()=>[e[24]||(e[24]=p(" 确定删除吗？ "))]),_:2,__:[24]},1032,["onPositiveClick"])]),_:2},1024)):b("",!0)])):b("",!0),T((i(),g(Be,{name:"fade"},{default:s(()=>[t.showCommentSection?(i(),y("div",Lt,[r("div",Nt,[r("div",null,[o(a(I),{size:"small",src:D.avatar},null,8,["src"])]),o(a(W),{type:"textarea",id:`comment-input-${t.id}`,value:q.value[t.id],"onUpdate:value":f=>q.value[t.id]=f,placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ne(Ee(f=>a(H)(t),["exact","prevent"]),["enter"])},null,8,["id","value","onUpdate:value","onKeydown"]),o(a(w),{type:"primary",ghost:"",onClick:f=>a(H)(t)},{default:s(()=>e[25]||(e[25]=[p("发送")])),_:2,__:[25]},1032,["onClick"])]),(i(!0),y(oe,null,se(t.comments,f=>(i(),y("div",{key:f.id,class:"flex mb-3"},[o(a(I),{size:"small",src:D.avatar},null,8,["src"]),r("div",At,[r("div",Pt,[r("span",Tt,m(f.username),1),o(a(st),{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:s(()=>[p(m(f.dbtime),1)]),_:2},1024),a(K).userInfo.id==f.creater?(i(),g(X,{key:0,onPositiveClick:Gt=>he(f,t)},{trigger:s(()=>[T((i(),g(a(w),{quaternary:"",type:"error",size:"small"},{default:s(()=>e[26]||(e[26]=[p(" 删除 ")])),_:1,__:[26]})),[[P,"project:Week:Comment:delete"]])]),default:s(()=>[e[27]||(e[27]=p(" 确定删除吗？ "))]),_:2,__:[27]},1032,["onPositiveClick"])):b("",!0)]),r("div",qt,m(f.content),1)])]))),128))])):b("",!0)]),_:2},1024)),[[P,"project:Week:Comment:insert"]])]}),_:2},1024))),128))])):(i(),g(a(qe),{key:0,description:"暂无信息"}))]),_:1}),z.value.length>0?(i(),y("div",Rt,[o(be,{page:h.value.page,"onUpdate:page":[e[1]||(e[1]=t=>h.value.page=t),pe],"page-size":h.value.limit,"onUpdate:pageSize":[e[2]||(e[2]=t=>h.value.limit=t),me],"item-count":h.value.total,"show-size-picker":"","page-sizes":[10,20,50],prefix:()=>`共 ${h.value.total} 条`},null,8,["page","page-size","item-count","prefix"])])):b("",!0)]),_:1})]),o($e,{show:A.value,"onUpdate:show":e[10]||(e[10]=t=>A.value=t),title:B.value==="add"?"新增":"编辑",preset:"card",class:"w-570px"},{footer:s(()=>[o(d,{justify:"end"},{default:s(()=>[o(a(w),{size:"small",class:"mt-16px",onClick:O},{default:s(()=>[p(m(n.$t("common.cancel")),1)]),_:1}),o(a(w),{type:"primary",size:"small",class:"mt-16px",onClick:a(ye)},{default:s(()=>[p(m(n.$t("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:s(()=>[o(_,{ref_key:"formRef",ref:V,model:l.value,rules:de},{default:s(()=>[o($,{label:"本周完成",path:"content1"},{default:s(()=>[o(a(W),{value:l.value.content1,"onUpdate:value":e[3]||(e[3]=t=>l.value.content1=t),type:"textarea",placeholder:"请输入内容",rows:3},null,8,["value"])]),_:1}),o($,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{default:s(()=>[o(a(W),{value:l.value.content2,"onUpdate:value":e[4]||(e[4]=t=>l.value.content2=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o($,{label:"未完成项目",path:"content3"},{default:s(()=>[o(a(W),{value:l.value.content3,"onUpdate:value":e[5]||(e[5]=t=>l.value.content3=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o($,{label:"下周计划",path:"content4"},{default:s(()=>[o(a(W),{value:l.value.content4,"onUpdate:value":e[6]||(e[6]=t=>l.value.content4=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o($,{label:"需协调与帮助:",path:"content5"},{default:s(()=>[o(a(W),{value:l.value.content5,"onUpdate:value":e[7]||(e[7]=t=>l.value.content5=t),type:"textarea",placeholder:"请输入内容",rows:1},null,8,["value"])]),_:1}),o($,{label:"图片:",path:"file1"},{default:s(()=>[o(d,{justify:"center"},{default:s(()=>[l.value.file1?(i(),y("div",Dt,[o(Q,{width:"100",height:"100","preview-disabled":"",src:l.value.file1,class:"rounded-md object-cover"},null,8,["src"]),r("div",{class:"absolute inset-0 flex w-100px items-center justify-center bg-black/50 opacity-0 c-#ccc group-hover:opacity-100 transition-opacity duration-200 cursor-pointer rounded-md",onClick:e[8]||(e[8]=t=>l.value.file1="")},[o(Ce,{class:"font-size-24px"})])])):(i(),g(Y,{key:1,ref:"uploadRef",action:"#","list-type":"image-card","custom-request":t=>M(t,"file1")},null,8,["custom-request"]))]),_:1})]),_:1}),o($,{label:"附件:",path:"file2"},{default:s(()=>[l.value.file2?(i(),y("div",Bt,[r("span",null,m(l.value.file2.split("?")[1]),1),o(a(w),{text:"",type:"error",onClick:e[9]||(e[9]=t=>l.value.file2="")},{default:s(()=>e[28]||(e[28]=[p("删除")])),_:1,__:[28]})])):(i(),y("div",Et,[o(Y,{ref:"uploadRef",action:"#","show-file-list":!1,"custom-request":t=>M(t,"file2")},{default:s(()=>[o(a(w),{loading:j.value>0&&!l.value.file2},{default:s(()=>[p(m(j.value>0&&!l.value.file2?"上传中":"上传文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"]),j.value&&!l.value.file2?(i(),g(ze,{key:0,type:"line",percentage:j.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):b("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}}),Zt=He(Vt,[["__scopeId","data-v-f20ffdd9"]]);export{Zt as default};
