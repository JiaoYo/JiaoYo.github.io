import{_ as se}from"./table-column-setting.vue_vue_type_script_setup_true_lang-rgBDZvjO.js";import{_ as re}from"./round-delete-vxljK2J6.js";import{_ as ie}from"./round-add-XwPZokqe.js";import{d as q,at as O,v as ce,s as H,a as ue,av as J,aw as de,y as V,c as P,o as T,w as t,f as e,ax as me,G as Q,z as pe,D as M,h as n,C as W,az as X,N as A,B as N,g as k,t as S,$ as x,aE as _e,b7 as fe,b8 as ge,b9 as ve,r as he,F as be,U as Y,aZ as K,M as ye,b as we,aM as R,ay as xe,aN as Ce,e as Ne,ba as E,bb as ke,aF as De,aS as Te}from"./index-BHFXhhrx.js";import{u as Se,a as ze}from"./table-02_NjBh1.js";import{_ as ee}from"./Grid-DeUxXMwD.js";import{_ as te}from"./FormItemGridItem-CfqayFMK.js";import{_ as Ue}from"./round-search-Dzp6xJh-.js";import{_ as je}from"./round-refresh-bYfHOtol.js";import{N as $e}from"./DatePicker-CSWbZL6L.js";import{N as L}from"./Popconfirm-BQM7uy2f.js";import"./utils-Ck3BJELy.js";const Be=q({name:"OperateDrawer",__name:"operate-drawer",props:O({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:O(["submitted"],["update:visible"]),setup(f,{emit:z}){const g=z,m=f,u=ce(r());function r(){return{id:0,connum:"",edbtime:void 0,execute:void 0}}async function D(){Object.assign(u,r()),m.operateType==="edit"&&m.rowData&&Object.assign(u,m.rowData)}const{formRef:U,validate:h,restoreValidation:b}=H(),j={connum:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},execute:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},edbtime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"}},C=ue(()=>({add:"新增合同变更",edit:"修改合同变更"})[m.operateType]),o=J(f,"visible");de(o,()=>{o.value&&(D(),setTimeout(()=>{const c=document.querySelector(".n-scrollbar-content");c==null||c.scrollTo(0,0)},300),b())});function i(){o.value=!1}async function p(){var c;await h(),(c=window.$dialog)==null||c.info({title:"提示",content:"提交后即时执行,不可回滚是否继续?",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await y()}})}async function y(){var c,d;if(await h(),m.operateType==="edit"){const{data:w,error:_}=await fe([u]);_||(i(),g("submitted"),(c=window.$message)==null||c.success("修改成功"))}else{const{data:w,error:_}=await ge([{...u}]);_||(i(),g("submitted"),(d=window.$message)==null||d.success("添加成功"))}}return(c,d)=>{const w=te,_=ee,$=Q,B=me,F=A,s=_e,a=V("no-space");return T(),P(s,{show:o.value,"onUpdate:show":d[2]||(d[2]=l=>o.value=l),title:C.value,preset:"card",class:"w-600px"},{footer:t(()=>[e(F,{justify:"end",size:16},{default:t(()=>[e(n(N),{onClick:i},{default:t(()=>[k(S(n(x)("common.cancel")),1)]),_:1}),e(n(N),{type:"primary",onClick:p},{default:t(()=>[k(S(n(x)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(B,{class:"pr-20px"},{default:t(()=>[e($,{ref_key:"formRef",ref:U,model:u,rules:j,"label-placement":"left","label-width":120},{default:t(()=>[e(_,{responsive:"screen","item-responsive":""},{default:t(()=>[e(w,{span:"24 m:24",label:"合同编号",path:"connum"},{default:t(()=>[M(e(n(W),{value:u.connum,"onUpdate:value":d[0]||(d[0]=l=>u.connum=l),placeholder:"请输入"},null,8,["value"]),[[a]])]),_:1}),m.operateType=="edit"?(T(),P(w,{key:0,span:"24 m:24",label:"执行状态",path:"execute"},{default:t(()=>[e(n(X),{filterable:"",options:[{label:"未执行",value:0},{label:"执行成功",value:1},{label:"未执失败",value:2}],clearable:"",value:u.execute,"onUpdate:value":d[1]||(d[1]=l=>u.execute=l)},null,8,["value"])]),_:1})):pe("",!0)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Fe=q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:O(["reset","search"],["update:model"]),setup(f,{emit:z}){ve();const g=z,{formRef:m,restoreValidation:u}=H(),r=J(f,"model"),D={当日:()=>{const o=new Date().getTime();return[o,o]},本周:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*7,o]},上月:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*30,o]},近一年:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*365,o]},近三年:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*365*3,o]}};function U(){r.value.fuzzy="",g("search")}async function h(){await u(),g("reset")}const b=he(null);async function j(o,i){i?(r.value.startTime=String(K(0,i[0])),r.value.endTime=String(K(0,i[1]))):(r.value.startTime=null,r.value.endTime=null),g("search")}async function C(){g("search")}return(o,i)=>{const p=W,y=te,c=X,d=$e,w=je,_=N,$=Ue,B=A,F=ee,s=Q,a=Y;return T(),P(a,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(s,{ref_key:"formRef",ref:m,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:be(C,["enter"])},{default:t(()=>[e(F,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(y,{span:"24 s:12 m:6",label:"名称",path:"fuzzy"},{default:t(()=>[e(p,{clearable:"",value:r.value.fuzzy,"onUpdate:value":i[0]||(i[0]=l=>r.value.fuzzy=l),placeholder:"请输入名称",onClear:U},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:4",label:"执行状态",path:"execute"},{default:t(()=>[e(c,{clearable:"",filterable:"",value:r.value.execute,"onUpdate:value":[i[1]||(i[1]=l=>r.value.execute=l),C],placeholder:"请选择执行状态",options:[{label:"未执行",value:0},{label:"执行成功",value:1},{label:"未执失败",value:2}]},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:t(()=>[e(d,{value:b.value,"onUpdate:value":i[2]||(i[2]=l=>b.value=l),type:"daterange",clearable:"",class:"w-100%",shortcuts:D,"onUpdate:formattedValue":j},null,8,["value"])]),_:1}),e(y,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(B,{class:"w-full"},{default:t(()=>[e(_,{onClick:h},{icon:t(()=>[e(w,{class:"text-icon"})]),default:t(()=>[k(" "+S(n(x)("common.reset")),1)]),_:1}),e(_,{type:"primary",ghost:"",onClick:C},{icon:t(()=>[e($,{class:"text-icon"})]),default:t(()=>[k(" "+S(n(x)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Me={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Z(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!Te(f)}const He=q({name:"manage_contractamendment",__name:"index",setup(f){const z=ye(),{columns:g,columnChecks:m,data:u,getData:r,loading:D,mobilePagination:U,searchParams:h}=Se({showTotal:!0,apiFn:ke,apiParams:{page:1,pageSize:20,limit:20,execute:void 0,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"connum",title:"合同编号",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"execute",title:"执行状态",align:"center",width:120,render:s=>e(De,{type:s.execute==0?"warning":s.execute==1?"success":"error",round:!0},{default:()=>[s.execute==0?"未执行":s.execute==1?"执行成功":"执行失败"]})},{key:"edbtime",title:"执行时间",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:x("common.operate"),align:"center",width:140,fixed:"right",render:s=>{let a;return e("div",{class:"flex-center gap-8px"},[M(e(N,{type:"primary",ghost:!0,size:"small",onClick:()=>_(s.id)},Z(a=x("common.edit"))?a:{default:()=>[a]}),[[V("no-auth"),"project:Change:Contract:update"]]),e(L,{onPositiveClick:()=>w(s.id)},{default:()=>x("common.confirmDelete"),trigger:()=>{let l;return M(e(N,{type:"error",ghost:!0,size:"small"},Z(l=x("common.delete"))?l:{default:()=>[l]}),[[V("no-auth"),"project:Change:Contract:delete"]])}})])}}]}),{drawerVisible:b,operateType:j,editingData:C,handleAdd:o,handleEdit:i,checkedRowKeys:p,onBatchDeleted:y,onDeleted:c}=ze(u,r);async function d(){console.log(p.value),$(p.value.join(","),s=>{y()})}async function w(s){const{data:a,error:l}=await E(s);l||c()}function _(s){i(s)}async function $(s,a){const{data:l,error:G}=await E(s);if(!G)a&&a(l);else return!1}const B=s=>{r()},F=()=>{r()};return(s,a)=>{const l=A,G=ie,ae=re,ne=se,oe=xe,le=Y,I=V("no-auth");return T(),we("div",Me,[e(Fe,{model:n(h),"onUpdate:model":a[0]||(a[0]=v=>R(h)?h.value=v:null),onReset:F,onSearch:n(r)},null,8,["model","onSearch"]),e(le,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(l,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>a[4]||(a[4]=[Ne("div",null,"合同变更",-1)])),_:1,__:[4]})]),"header-extra":t(()=>[e(l,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[M((T(),P(n(N),{onClick:n(o),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(G,{class:"text-icon"})]),default:t(()=>[a[5]||(a[5]=k(" "+S("新增")))]),_:1,__:[5]},8,["onClick"])),[[I,"project:Change:Contract:insert"]]),e(n(L),{onPositiveClick:d},{trigger:t(()=>[M((T(),P(n(N),{size:"small",ghost:"",type:"error",disabled:n(p).length==0},{icon:t(()=>[e(ae,{class:Ce(["text-icon",{"animate-spin":n(D)}])},null,8,["class"])]),default:t(()=>[a[6]||(a[6]=k(" "+S("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[I,"project:Change:Contract:delete"]])]),default:t(()=>[a[7]||(a[7]=k(" 确定要删除选中的数据吗？ "))]),_:1,__:[7]}),e(ne,{columns:n(m),"onUpdate:columns":a[1]||(a[1]=v=>R(m)?m.value=v:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(oe,{"checked-row-keys":n(p),"onUpdate:checkedRowKeys":a[2]||(a[2]=v=>R(p)?p.value=v:null),columns:n(g),data:n(u),size:"small","flex-height":!n(z).isMobile,loading:n(D),remote:"","row-key":v=>v.id,pagination:n(U),class:"sm:h-full","onUpdate:filters":B},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Be,{visible:n(b),"onUpdate:visible":a[3]||(a[3]=v=>R(b)?b.value=v:null),onSubmitted:n(r),"operate-type":n(j),"row-data":n(C)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{He as default};
