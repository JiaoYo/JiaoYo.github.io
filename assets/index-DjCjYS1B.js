import{_ as pe,a as me}from"./close-small-rounded-C0B1zb_R.js";import{d as E,v as W,r as A,J as _e,K as F,o as g,c as w,w as n,f as V,g as t,h as m,L as D,aV as K,C as B,B as q,aj as X,aZ as ue,E as P,D as J,S as fe,ay as Z,j as M,t as H,a9 as R,e as j,ai as re,a_ as ge,a$ as ve,au as be,A as L,aT as ye,N as I,i as T,b0 as Q,b1 as Y,as as de,b2 as ee,b3 as te,X as z,y as ke,b4 as he,b5 as we,P as Ce,b6 as xe,ap as $e,aq as Te}from"./index-D4ngyqj9.js";import{h as Se,i as Ue,j as Ve,k as De,l as Ie,m as Ne,n as Ee,o as Be,p as qe,q as Pe,r as Oe,s as Ge,t as Me,u as je,v as Ae,w as Fe,x as Re,y as He,z as Je,A as ze,B as Le,C as We,D as Ke,E as Xe,F as Ze,G as Qe}from"./basic-config-C6gcyKGa.js";import{_ as Ye}from"./Table-CqHZRGoR.js";import{f as ne}from"./reportForm-CO97p3Pj.js";import{f as ae}from"./scheduleTask-BnIoRLwi.js";import{b as et,a as tt,_ as le}from"./DataTable-Bkf-sC_U.js";import{_ as nt}from"./DatePicker-B7b2SSSF.js";import{_ as se}from"./TimePicker-C4_2UWv_.js";import{u as oe}from"./table-B-O-KQBR.js";import{_ as at}from"./FormItemGridItem-tGN8LyML.js";import{_ as lt}from"./Grid-3ti0RnUO.js";import{u as st}from"./usePageData-C8tvUOsP.js";import{a as ot}from"./events-BF-GCmFQ.js";import{_ as it}from"./Upload-B89re_JK.js";import"./Forward-Bpby_coU.js";import"./defineProperty-Dw3Ai0tz.js";import"./Progress-Q6s-Jzjc.js";const ut={class:"flex justify-center"},rt=E({name:"basicConfig",__name:"basicConfig",setup(O){const{formRef:p,validate:b,restoreValidation:l}=W(),i=A($());function $(){return{enablelock:1,locktime:5,lockcount:3,unlockeanble:1,unlocktime:5,aceffective:1,pwdexpire:1,expiretime:1,cputhreshold:80,memthreshold:80,captcha:1,tokentime:30}}const x={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},v={locktime:x,lockcount:x,unlocktime:x,expiretime:x,cputhreshold:x,memthreshold:x,tokentime:x},_=async()=>{const{data:s,error:a}=await Se();a||Object.assign(i,s)};_e(()=>{_()});const e=async()=>{var a;await b();const{error:s}=await Ue(i);s||(a=window.$message)==null||a.success("设置成功")};return(s,a)=>{const c=K,d=B,o=q,r=X,f=ue,y=P,h=J,k=fe,C=F("no-auth");return g(),w(k,{style:{"max-height":"calc(100vh - 245px)"}},{default:n(()=>[V("div",ut,[t(h,{ref_key:"formRef",ref:p,"label-width":180,"label-placement":"left",model:i,rules:v},{default:n(()=>[t(d,{label:"是否开启账号锁定",path:"enablelock"},{default:n(()=>[t(c,{value:i.enablelock,"onUpdate:value":a[0]||(a[0]=u=>i.enablelock=u),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),t(d,{label:"锁定周期",path:"locktime"},{default:n(()=>[t(f,{class:"flex items-center"},{default:n(()=>[t(o,{onClick:a[1]||(a[1]=u=>i.locktime--),disabled:i.locktime==1},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),t(r,{"show-button":!1,value:i.locktime,"onUpdate:value":a[2]||(a[2]=u=>i.locktime=u),placeholder:"",min:1,max:5},null,8,["value"]),t(o,{onClick:a[3]||(a[3]=u=>i.locktime++),disabled:i.locktime==5,class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1},8,["disabled"]),m(" 分钟 ")]),_:1})]),_:1}),t(d,{label:"锁定次数",path:"lockcount"},{default:n(()=>[t(f,{class:"flex items-center"},{default:n(()=>[t(o,{onClick:a[4]||(a[4]=u=>i.lockcount--),disabled:i.lockcount==2},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),t(r,{"show-button":!1,value:i.lockcount,"onUpdate:value":a[5]||(a[5]=u=>i.lockcount=u),placeholder:"",min:2,max:5},null,8,["value"]),t(o,{onClick:a[6]||(a[6]=u=>i.lockcount++),disabled:i.lockcount==5,class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1},8,["disabled"]),m(" 次 ")]),_:1})]),_:1}),t(d,{label:"是否开启自动解锁",path:"unlockeanble"},{default:n(()=>[t(c,{value:i.unlockeanble,"onUpdate:value":a[7]||(a[7]=u=>i.unlockeanble=u),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),t(d,{label:"解锁时间",path:"unlocktime"},{default:n(()=>[t(f,{class:"flex items-center"},{default:n(()=>[t(o,{onClick:a[8]||(a[8]=u=>i.unlocktime--),disabled:i.unlocktime==i.locktime},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),t(r,{"show-button":!1,value:i.unlocktime,"onUpdate:value":a[9]||(a[9]=u=>i.unlocktime=u),placeholder:"",min:i.locktime},null,8,["value","min"]),t(o,{onClick:a[10]||(a[10]=u=>i.unlocktime++),class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1}),m(" 分钟 ")]),_:1})]),_:1}),t(d,{label:"是否开启账号有效期登录",path:"aceffective"},{default:n(()=>[t(c,{value:i.aceffective,"onUpdate:value":a[11]||(a[11]=u=>i.aceffective=u),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),t(d,{label:"是否开启密码过期",path:"pwdexpire"},{default:n(()=>[t(c,{value:i.pwdexpire,"onUpdate:value":a[12]||(a[12]=u=>i.pwdexpire=u),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),t(d,{label:"密码过期时间",path:"expiretime"},{default:n(()=>[t(f,{class:"flex items-center"},{default:n(()=>[t(o,{onClick:a[13]||(a[13]=u=>i.expiretime--),disabled:i.expiretime==1},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),t(r,{"show-button":!1,value:i.expiretime,"onUpdate:value":a[14]||(a[14]=u=>i.expiretime=u),placeholder:"",min:1},null,8,["value"]),t(o,{onClick:a[15]||(a[15]=u=>i.expiretime++),class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1}),m(" 天 ")]),_:1})]),_:1}),t(d,{label:"CPU阈值",path:"cputhreshold"},{default:n(()=>[t(f,{class:"flex items-center"},{default:n(()=>[t(o,{onClick:a[16]||(a[16]=u=>i.cputhreshold--),disabled:i.cputhreshold==0},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),t(r,{"show-button":!1,value:i.cputhreshold,"onUpdate:value":a[17]||(a[17]=u=>i.cputhreshold=u),placeholder:"",min:0,max:100},null,8,["value"]),t(o,{onClick:a[18]||(a[18]=u=>i.cputhreshold++),disabled:i.cputhreshold==100,class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1},8,["disabled"]),m(" % ")]),_:1})]),_:1}),t(d,{label:"MEM阈值",path:"memthreshold"},{default:n(()=>[t(f,{class:"flex items-center"},{default:n(()=>[t(o,{onClick:a[19]||(a[19]=u=>i.memthreshold--),disabled:i.memthreshold==0},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),t(r,{"show-button":!1,value:i.memthreshold,"onUpdate:value":a[20]||(a[20]=u=>i.memthreshold=u),placeholder:"",min:0,max:100},null,8,["value"]),t(o,{onClick:a[21]||(a[21]=u=>i.memthreshold++),disabled:i.memthreshold==100,class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1},8,["disabled"]),m(" % ")]),_:1})]),_:1}),t(d,{label:"是否开启验证码",path:"captcha"},{default:n(()=>[t(c,{value:i.captcha,"onUpdate:value":a[22]||(a[22]=u=>i.captcha=u),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),t(d,{label:"token过期时间",path:"tokentime"},{default:n(()=>[t(f,{class:"flex items-center"},{default:n(()=>[t(o,{onClick:a[23]||(a[23]=u=>i.tokentime--),disabled:i.tokentime==1},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),t(r,{"show-button":!1,value:i.tokentime,"onUpdate:value":a[24]||(a[24]=u=>i.tokentime=u),placeholder:"",min:1},null,8,["value"]),t(o,{onClick:a[25]||(a[25]=u=>i.tokentime++),class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1}),m(" 小时 ")]),_:1})]),_:1}),t(d,{label:" "},{default:n(()=>[t(y,null,{default:n(()=>[D((g(),w(o,{type:"default",ghost:"",onClick:_},{default:n(()=>[m(" 刷新 ")]),_:1})),[[C,"system.conf.select"]]),D((g(),w(o,{type:"info",ghost:"",onClick:e},{default:n(()=>[m(" 保存 ")]),_:1})),[[C,"system.conf.update"]])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})}}}),dt=Z(rt,[["__scopeId","data-v-3c461f33"]]),ct=V("td",null,"产品名称",-1),pt=V("td",null,"产品版本",-1),mt=V("td",null,"build号",-1),_t=V("td",null,"产品型号",-1),ft=E({name:"basicInfo",__name:"basicInfo",setup(O){const p=M({id:1,pname:"",pversion:"",pbuild:"",pmodel:""});(async()=>{const{data:v,error:_}=await Ve();_||(p.value=v)})();const l=M(0),i=async()=>{var e,s;const{data:v,error:_}=await De();_||(v==="重启失败"?(e=window.$message)==null||e.error(v):(s=window.$message)==null||s.success(v))},$=async()=>{var e,s;const{data:v,error:_}=await Ie();_||(v==="关机失败"?(e=window.$message)==null||e.error(v):(s=window.$message)==null||s.success(v))},x=async v=>{var _,e,s,a;if(v){const{data:c,error:d}=await Ne();if(d)return;c==="打开SSH失败"?(_=window.$message)==null||_.error(c):(e=window.$message)==null||e.success(c)}else{const{data:c,error:d}=await Ee();if(d)return;c==="关闭SSH失败"?(s=window.$message)==null||s.error(c):(a=window.$message)==null||a.success(c)}};return(v,_)=>{const e=Ye,s=K,a=B,c=q,d=P,o=R,r=F("no-auth");return g(),w(o,{class:"w-600px text-center m-auto mt-20px"},{default:n(()=>[t(e,{bordered:!0,"single-line":!1},{default:n(()=>[V("tbody",null,[V("tr",null,[ct,V("td",null,H(p.value.pname||""),1)]),V("tr",null,[pt,V("td",null,H(p.value.pversion),1)]),V("tr",null,[mt,V("td",null,H(p.value.pbuild),1)]),V("tr",null,[_t,V("td",null,H(p.value.pmodel),1)])])]),_:1}),t(d,{justify:"center",class:"mt-50px"},{default:n(()=>[D((g(),w(a,{label:"SSH服务","label-placement":"left"},{default:n(()=>[t(s,{value:l.value,"onUpdate:value":[_[0]||(_[0]=f=>l.value=f),x],"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})),[[r,"sysmanger.basicInfo.ssh.start"]]),D((g(),w(c,{type:"info",ghost:"",onClick:i},{default:n(()=>[m("重启")]),_:1})),[[r,"sysmanger.basicInfo.restart"]]),D((g(),w(c,{type:"info",ghost:"",onClick:$},{default:n(()=>[m("关机")]),_:1})),[[r,"sysmanger.basicInfo.shutdown"]])]),_:1})]),_:1})}}}),gt=E({name:"emailService",__name:"emailSever",setup(O){const{formRef:p,validate:b}=W(),l=M({port:void 0,pwd:"",sendserver:"",essl:0,uname:""}),i={sendserver:[{required:!0,validator:(e,s,a)=>s?ge(s)?a():a(new Error("请输入正确的IP地址或域名")):new Error("请输入服务器地址"),trigger:["blur","input"]}],port:{type:"number",required:!0,trigger:["blur","input"],validator:(e,s,a)=>s==null||s==null?new Error("请输入端口号"):ve(s)?!0:new Error("请输入在0-65535之间的数字")},uname:[{required:!0,message:"请输入账号",trigger:"blur"}],pwd:[{required:!0,message:"请输入密码",trigger:"blur"}],sendaddr:[{required:!0,message:"请输入发件邮箱",trigger:["blur","input"]},{validator:be,trigger:["blur","input"]}]},$=async()=>{const{data:e,error:s}=await Be();s||(l.value.sendserver=(e==null?void 0:e.sendserver)??l.value.sendserver,l.value.port=(e==null?void 0:e.port)??l.value.port,l.value.pwd=(e==null?void 0:e.pwd)??l.value.pwd,l.value.essl=(e==null?void 0:e.essl)??l.value.essl,l.value.uname=(e==null?void 0:e.uname)??l.value.uname,l.value.id=(e==null?void 0:e.id)??l.value.id)};$();const x=async()=>{var e,s,a,c;if(await b(),l.value.id){const{data:d,error:o}=await qe(l.value);o||((e=window.$message)==null||e.destroyAll(),(s=window.$message)==null||s.success("保存成功"))}else{const{data:d,error:o}=await Pe(l.value);o||((a=window.$message)==null||a.destroyAll(),(c=window.$message)==null||c.success("保存成功"))}},v=async()=>{var a,c;const{data:e,error:s}=await Oe();s||((a=window.$message)==null||a.destroyAll(),(c=window.$message)==null||c.success("重置成功"),$())},_=async()=>{var a,c;await b();const{data:e,error:s}=await Ge(l.value);s||((a=window.$message)==null||a.destroyAll(),(c=window.$message)==null||c.success("测试成功"))};return(e,s)=>{const a=L,c=B,d=X,o=K,r=J,f=q,y=P,h=F("no-auth");return g(),j(re,null,[t(r,{ref_key:"formRef",ref:p,"label-width":150,model:l.value,rules:i,"label-placement":"left",class:"w-400px",style:{margin:"50px auto"}},{default:n(()=>[t(c,{label:"发送邮件服务器",path:"sendserver"},{default:n(()=>[t(a,{value:l.value.sendserver,"onUpdate:value":s[0]||(s[0]=k=>l.value.sendserver=k),placeholder:"输入服务器或IP地址"},null,8,["value"])]),_:1}),t(c,{label:"端口",path:"port"},{default:n(()=>[t(d,{value:l.value.port,"onUpdate:value":s[1]||(s[1]=k=>l.value.port=k),placeholder:"输入端口",style:{width:"100%"}},null,8,["value"])]),_:1}),t(c,{label:"用户名",path:"uname"},{default:n(()=>[t(a,{value:l.value.uname,"onUpdate:value":s[2]||(s[2]=k=>l.value.uname=k),placeholder:"用户名"},null,8,["value"])]),_:1}),t(c,{label:"密码",path:"pwd"},{default:n(()=>[t(a,{type:"password",value:l.value.pwd,"onUpdate:value":s[3]||(s[3]=k=>l.value.pwd=k),placeholder:"密码","show-password-on":"click"},null,8,["value"])]),_:1}),t(c,{label:"ssl",path:"essl"},{default:n(()=>[t(o,{value:l.value.essl,"onUpdate:value":s[4]||(s[4]=k=>l.value.essl=k),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"]),t(y,{justify:"center"},{default:n(()=>[D((g(),w(f,{type:"info",ghost:"",onClick:_},{default:n(()=>[m("测试")]),_:1})),[[h,"sysmanger.basicInfo.test.mailInfo"]]),D((g(),w(f,{type:"info",ghost:"",onClick:x},{default:n(()=>[m("保存")]),_:1})),[[h,"sysmanger.mailInfo.update"]]),D((g(),w(f,{type:"info",ghost:"",onClick:v},{default:n(()=>[m("重置")]),_:1})),[[h,"sysmanger.mailInfo.delete"]])]),_:1})],64)}}}),vt=E({name:"TimingConfig",__name:"timingConfig",setup(O){const{formRef:p,validate:b}=W(),l=A({automatic:1,time:ye(1,new Date),ip:"",taskId:"",showCron:!1,setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),i={time:{required:!0,message:"请选择时间",trigger:"blur"},ip:[{required:!0,message:"请输入IP",trigger:"blur"},{validator:de,trigger:"blur"}],task:{required:!0,message:"请设置表达式",trigger:"blur"},setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}},$=async()=>{const{data:_,error:e}=await Me();e||(l.time=_)};$(),(async()=>{const{data:_,error:e}=await je();if(e)return;const{id:s,params:a}=_;try{if(a){const{cron:c,ip:d}=JSON.parse(a),o=ee(c);l.setting.settingCycle=o==null?void 0:o.settingCycle,l.setting.settingTime=o==null?void 0:o.settingTime,l.setting.settingCycleValue=o==null?void 0:o.settingCycleValue,l.ip=d,l.taskId=s}}catch(c){console.error("Error parsing params:",c)}})();const v=async()=>{var _,e;if(await b(),l.automatic){const{data:s,error:a}=await Ae({dtime:l.time});a||(_=window.$message)==null||_.success(s)}else{const s=te(l.setting.settingCycle==1?{dayOfWeek:l.setting.settingCycleValue,time:l.setting.settingTime}:null,l.setting.settingCycle==2?{dayOfMonth:l.setting.settingCycleValue,time:l.setting.settingTime}:null,l.setting.settingCycle==3?{time:l.setting.settingTime}:null);l.taskId?await ae({id:l.taskId,beanName:"NtpTask",cronExpression:s,remark:"",status:1,params:JSON.stringify({ip:l.ip,cron:s})}):await ne({beanName:"NtpTask",cronExpression:s,remark:"",status:1,params:JSON.stringify({ip:l.ip,cron:s})});const{data:a,error:c}=await Fe({ip:l.ip});c||(e=window.$message)==null||e.success(a)}};return(_,e)=>{const s=et,a=P,c=tt,d=B,o=nt,r=L,f=z,y=se,h=q,k=J,C=F("no-auth");return g(),w(k,{ref_key:"formRef",ref:p,"label-width":180,"label-placement":"left",model:l,class:"m-auto w-600px mt-20px",rules:i},{default:n(()=>[t(d,{label:"校时",path:"enablelock"},{default:n(()=>[t(c,{value:l.automatic,"onUpdate:value":e[0]||(e[0]=u=>l.automatic=u),name:"radiogroup"},{default:n(()=>[t(a,null,{default:n(()=>[t(s,{value:1},{default:n(()=>[m("手动校时")]),_:1}),t(s,{value:0},{default:n(()=>[m("自动校时")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),l.automatic?(g(),w(d,{key:0,label:"设置中心服务器时间",path:"time"},{default:n(()=>[t(o,{"formatted-value":l.time,"onUpdate:formattedValue":e[1]||(e[1]=u=>l.time=u),format:"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:""},null,8,["formatted-value"])]),_:1})):I("",!0),l.automatic?I("",!0):(g(),j(re,{key:1},[t(d,{label:"NTP服务器设置",path:"ip"},{default:n(()=>[t(r,{value:l.ip,"onUpdate:value":e[2]||(e[2]=u=>l.ip=u),placeholder:"输入NTP服务器设置"},null,8,["value"])]),_:1}),t(d,{label:"设置周期",path:"setting.settingCycle"},{default:n(()=>[t(a,{justify:"space-between"},{default:n(()=>[t(f,{value:l.setting.settingCycle,"onUpdate:value":[e[3]||(e[3]=u=>l.setting.settingCycle=u),e[4]||(e[4]=u=>l.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"200px"}},null,8,["value"]),t(d,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:n(()=>[t(a,null,{default:n(()=>[l.setting.settingCycle==1?(g(),w(f,{key:0,value:l.setting.settingCycleValue,"onUpdate:value":e[5]||(e[5]=u=>l.setting.settingCycleValue=u),options:T(Q)(),style:{width:"200px"}},null,8,["value","options"])):I("",!0),l.setting.settingCycle==2?(g(),w(f,{key:1,value:l.setting.settingCycleValue,"onUpdate:value":e[6]||(e[6]=u=>l.setting.settingCycleValue=u),options:T(Y)(),style:{width:"200px"}},null,8,["value","options"])):I("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(d,{label:"设置时间",path:"setting.settingTime"},{default:n(()=>[t(y,{"formatted-value":l.setting.settingTime,"onUpdate:formattedValue":e[7]||(e[7]=u=>l.setting.settingTime=u)},null,8,["formatted-value"])]),_:1})],64)),t(d,null,{label:n(()=>[l.automatic?D((g(),w(h,{key:0,type:"info",ghost:"",onClick:$},{default:n(()=>[m(" 查看服务器时间 ")]),_:1})),[[C,"sysmanger.basicInfo.gettiming"]]):I("",!0)]),default:n(()=>[t(a,null,{default:n(()=>[D((g(),w(h,{type:"info",ghost:"",onClick:v},{default:n(()=>[m(" 保存 ")]),_:1})),[[C,"sysmanger.basicInfo.manu.timing"]])]),_:1})]),_:1})]),_:1},8,["model"])}}}),bt={class:"h-full flex-col"},yt=E({name:"dataBase",__name:"dataBase",setup(O){const p=()=>[...Array(12).keys()].map(d=>({label:`${d+1}个月`,value:d+1})),b=A({space:80,retention:void 0,id:void 0}),{columns:l,columnChecks:i,data:$,getData:x,loading:v,mobilePagination:_,searchParams:e,resetSearchParams:s}=oe({apiFn:Re,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dbdesc",align:"center"},{title:"结果",key:"dbstatus",align:"center"}]});(async()=>{const{data:d,error:o}=await He();o||(b.space=d.space,b.retention=d.retention,b.id=d.id)})();const c=async()=>{var r;const{data:d,error:o}=await Je({space:b.space,retention:b.retention,id:b.id});o||(r=window.$message)==null||r.success("保存成功")};return(d,o)=>{const r=q,f=X,y=ue,h=B,k=z,C=P,u=R,G=le,U=F("no-auth");return g(),j("div",bt,[t(u,{title:"数据库维护配置",bordered:!1,class:"mb-20px","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[t(C,{class:"ml-50px"},{default:n(()=>[t(h,{label:"已用空间超过","label-placement":"left"},{default:n(()=>[t(y,{class:"flex items-center"},{default:n(()=>[t(r,{onClick:o[0]||(o[0]=N=>b.space--),disabled:b.space==1},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),t(f,{"show-button":!1,value:b.space,"onUpdate:value":o[1]||(o[1]=N=>b.space=N),placeholder:"",min:1,max:100,style:{width:"100px","text-align":"center"}},null,8,["value"]),t(r,{onClick:o[2]||(o[2]=N=>b.space++),disabled:b.space==100,class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1},8,["disabled"]),m(" % 时自动维护 ")]),_:1})]),_:1}),t(h,{label:"数据保留时间","label-placement":"left",class:"mx-20px"},{default:n(()=>[t(k,{value:b.retention,"onUpdate:value":o[3]||(o[3]=N=>b.retention=N),placeholder:"请选择",options:p(),style:{width:"150px"}},null,8,["value","options"])]),_:1}),t(h,{label:" ","label-placement":"left"},{default:n(()=>[D((g(),w(r,{type:"info",ghost:"",onClick:c},{default:n(()=>[m("保存")]),_:1})),[[U,"sysmanger.basicInfo.insert.dataBaseMaintenance"]])]),_:1})]),_:1})]),_:1}),t(u,{title:"数据库维护列表",bordered:!1,class:"flex-1","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[t(G,{columns:T(l),data:T($),size:"small","scroll-x":462,loading:T(v),remote:"","row-key":N=>N.id,pagination:T(_),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})])}}}),kt={class:"h-full flex-col"},ht=E({name:"dataBackup",__name:"dataBackup",setup(O){const{columns:p,columnChecks:b,data:l,getData:i,loading:$,mobilePagination:x,searchParams:v,resetSearchParams:_}=oe({apiFn:ze,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dbdesc",align:"center"},{title:"结果",key:"dbstatus",align:"center"}]}),e=A({id:"",ip:"",username:"",pwd:"",path:"",cron:"",showCron:!1,setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),s=M(null),a={ip:[{required:!0,message:"请输入IP",trigger:"blur"},{validator:de,trigger:"blur"}],cron:{required:!0,message:"请设置表达式",trigger:"blur"},username:{required:!0,message:"请输入账号",trigger:"blur"},pwd:{required:!0,message:"请输入密码",trigger:"blur"},path:{required:!0,message:"请输入路径",trigger:"blur"},setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}};(async()=>{const{data:o,error:r}=await Le();if(r)return;const{id:f,params:y}=o;if(e.id=f,y)try{const{ip:h,username:k,pwd:C,path:u,cron:G}=JSON.parse(y),U=ee(G);Object.assign(e,{ip:h,username:k,pwd:C,path:u,cron:G,setting:U})}catch(h){console.error("Error parsing params:",h)}})();const d=async()=>{var r,f,y;await((r=s.value)==null?void 0:r.validate());const o=te(e.setting.settingCycle==1?{dayOfWeek:e.setting.settingCycleValue,time:e.setting.settingTime}:null,e.setting.settingCycle==2?{dayOfMonth:e.setting.settingCycleValue,time:e.setting.settingTime}:null,e.setting.settingCycle==3?{time:e.setting.settingTime}:null);if(e.id){const{data:h,error:k}=await ae({beanName:"DataBackUpsTask",id:e.id,cronExpression:o,remark:"",status:1,params:JSON.stringify({ip:e.ip,username:e.username,pwd:e.pwd,path:e.path,cron:o})});k||(f=window.$message)==null||f.success("备份设置成功")}else{const{data:h,error:k}=await ne({beanName:"DataBackUpsTask",cronExpression:o,remark:"",status:1,params:JSON.stringify({ip:e.ip,username:e.username,pwd:e.pwd,path:e.path,cron:o})});k||(y=window.$message)==null||y.success("备份设置成功")}};return(o,r)=>{const f=L,y=at,h=z,k=B,C=P,u=se,G=q,U=lt,N=J,ie=R,ce=le;return g(),j("div",kt,[t(ie,{title:"FTP备份",bordered:!1,class:"mb-20px","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[t(N,{"label-placement":"left",model:e,rules:a,"label-width":150,class:"px-100px"},{default:n(()=>[t(U,{cols:24,"x-gap":24},{default:n(()=>[t(y,{span:8,label:"IP地址",path:"ip"},{default:n(()=>[t(f,{value:e.ip,"onUpdate:value":r[0]||(r[0]=S=>e.ip=S),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(y,{span:8,label:"账号",path:"username"},{default:n(()=>[t(f,{value:e.username,"onUpdate:value":r[1]||(r[1]=S=>e.username=S),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(y,{span:8,label:"密码",path:"pwd"},{default:n(()=>[t(f,{type:"password","show-password-on":"mousedown",value:e.pwd,"onUpdate:value":r[2]||(r[2]=S=>e.pwd=S),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(y,{span:8,label:"路径",path:"path"},{default:n(()=>[t(f,{value:e.path,"onUpdate:value":r[3]||(r[3]=S=>e.path=S),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(y,{span:8,label:"设置周期",path:"setting.settingCycle"},{default:n(()=>[t(C,{justify:"space-between"},{default:n(()=>[t(h,{value:e.setting.settingCycle,"onUpdate:value":[r[4]||(r[4]=S=>e.setting.settingCycle=S),r[5]||(r[5]=S=>e.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"140px"}},null,8,["value"]),t(k,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:n(()=>[e.setting.settingCycle==1?(g(),w(h,{key:0,value:e.setting.settingCycleValue,"onUpdate:value":r[6]||(r[6]=S=>e.setting.settingCycleValue=S),options:T(Q)(),style:{width:"140px"}},null,8,["value","options"])):I("",!0),e.setting.settingCycle==2?(g(),w(h,{key:1,value:e.setting.settingCycleValue,"onUpdate:value":r[7]||(r[7]=S=>e.setting.settingCycleValue=S),options:T(Y)(),style:{width:"140px"}},null,8,["value","options"])):I("",!0)]),_:1})]),_:1})]),_:1}),t(y,{span:8,label:"设置时间",path:"setting.settingTime"},{default:n(()=>[t(C,{justify:"space-between"},{default:n(()=>[t(u,{"formatted-value":e.setting.settingTime,"onUpdate:formattedValue":r[8]||(r[8]=S=>e.setting.settingTime=S)},null,8,["formatted-value"]),t(G,{type:"info",ghost:"",onClick:d},{default:n(()=>[m("保存")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(ie,{title:"数据备份列表",bordered:!1,class:"flex-1","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[t(ce,{columns:T(p),data:T(l),size:"small","scroll-x":462,loading:T($),remote:"","row-key":S=>S.id,pagination:T(x),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})])}}}),wt=Z(ht,[["__scopeId","data-v-65bf7d24"]]),Ct={class:"h-full flex-col"},xt=E({name:"systemSnapshot",__name:"systemSnapshot",setup(O){const{columns:p,columnChecks:b,data:l,getData:i,loading:$,mobilePagination:x,searchParams:v,resetSearchParams:_}=oe({apiFn:We,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dbdesc",align:"center"},{title:"结果",key:"dbstatus",align:"center"}]}),e=A({id:"",setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),s={setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}};(async()=>{const{data:d,error:o}=await Ke();if(o)return;console.log(d,"asdas");const r=ee(d.cronExpression);Object.assign(e,{id:d.id,setting:r})})();const c=async()=>{var o,r;const d=te(e.setting.settingCycle==1?{dayOfWeek:e.setting.settingCycleValue,time:e.setting.settingTime}:null,e.setting.settingCycle==2?{dayOfMonth:e.setting.settingCycleValue,time:e.setting.settingTime}:null,e.setting.settingCycle==3?{time:e.setting.settingTime}:null);if(e.id){const{data:f,error:y}=await ae({id:e.id,beanName:"SnapshotTask",cronExpression:d,status:1,params:JSON.stringify({corn:d})});y||(o=window.$message)==null||o.success("设置成功")}else{const{data:f,error:y}=await ne({beanName:"SnapshotTask",cronExpression:d,remark:"",status:1,params:JSON.stringify({corn:d})});y||(r=window.$message)==null||r.success("设置成功")}};return(d,o)=>{const r=z,f=B,y=P,h=se,k=q,C=J,u=R,G=le;return g(),j("div",Ct,[t(u,{title:"快照备份设置",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[t(y,{class:"ml-50px"},{default:n(()=>[t(C,{"label-placement":"left",inline:"",model:e,rules:s,"label-width":150,class:"px-100px"},{default:n(()=>[t(f,{label:"设置周期",path:"setting.settingCycle"},{default:n(()=>[t(y,{justify:"space-between"},{default:n(()=>[t(r,{value:e.setting.settingCycle,"onUpdate:value":[o[0]||(o[0]=U=>e.setting.settingCycle=U),o[1]||(o[1]=U=>e.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"140px"}},null,8,["value"]),t(f,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:n(()=>[e.setting.settingCycle==1?(g(),w(r,{key:0,value:e.setting.settingCycleValue,"onUpdate:value":o[2]||(o[2]=U=>e.setting.settingCycleValue=U),options:T(Q)(),style:{width:"140px"}},null,8,["value","options"])):I("",!0),e.setting.settingCycle==2?(g(),w(r,{key:1,value:e.setting.settingCycleValue,"onUpdate:value":o[3]||(o[3]=U=>e.setting.settingCycleValue=U),options:T(Y)(),style:{width:"140px"}},null,8,["value","options"])):I("",!0)]),_:1})]),_:1})]),_:1}),t(f,{label:"设置时间",path:"setting.settingTime"},{default:n(()=>[t(h,{"formatted-value":e.setting.settingTime,"onUpdate:formattedValue":o[4]||(o[4]=U=>e.setting.settingTime=U)},null,8,["formatted-value"])]),_:1}),t(f,{label:" ","label-placement":"left"},{default:n(()=>[t(k,{type:"info",ghost:"",onClick:c},{default:n(()=>[m("保存")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),t(u,{title:"快照备份列表",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"},class:"flex-1"},{default:n(()=>[t(G,{columns:T(p),data:T(l),size:"small","scroll-x":462,loading:T($),remote:"","row-key":U=>U.id,pagination:T(x),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})])}}}),$t=E({__name:"sysStatus",setup(O){const p=A({mailaddr:"",snmpaddr:void 0,stype:0,tmail:0,tsnmp:0});(async()=>{const{data:e,error:s}=await Xe();s||(p.mailaddr=(e==null?void 0:e.mailaddr)??p.mailaddr,p.snmpaddr=(e==null?void 0:e.snmpaddr)??p.snmpaddr,p.stype=(e==null?void 0:e.stype)??p.stype,p.tmail=(e==null?void 0:e.tmail)??p.tmail,p.tsnmp=(e==null?void 0:e.tsnmp)??p.tsnmp)})();const l=async()=>{var a;const{data:e,error:s}=await Ze(p);s||(a=window.$message)==null||a.success("保存成功")},{pageData:i,getData:$,nextPage:x}=st(ot),v=async e=>{const s=e.currentTarget;s.scrollTop+s.offsetHeight>=s.scrollHeight&&i.data.length<i.total&&x()},_=M();return ke(()=>i.data,e=>{e&&(_.value=e.filter(s=>s.ftype===1))}),$(),(e,s)=>{const a=we,c=Ce,d=L,o=B,r=z,f=q,y=P,h=R,k=F("no-auth");return g(),w(y,{justify:"center"},{default:n(()=>[t(h,{title:"通知方式",class:"w-600px"},{default:n(()=>[t(a),t(c,{checked:p.tmail,"onUpdate:checked":s[0]||(s[0]=C=>p.tmail=C),"checked-value":1,"unchecked-value":0},{default:n(()=>[m(" 邮件 ")]),_:1},8,["checked"]),p.tmail?(g(),w(o,{key:0,label:"邮件地址","label-placement":"left","label-width":"120",rule:{required:!0,validator:()=>{if(!p.mailaddr)return new Error("请输入邮件地址");if(!T(he)(p.mailaddr))return new Error("请输入正确的邮件地址")},trigger:["blur","input"]}},{default:n(()=>[t(d,{value:p.mailaddr,"onUpdate:value":s[1]||(s[1]=C=>p.mailaddr=C)},null,8,["value"])]),_:1},8,["rule"])):I("",!0),t(a),t(c,{checked:p.tsnmp,"onUpdate:checked":s[2]||(s[2]=C=>p.tsnmp=C),"checked-value":1,"unchecked-value":0},{default:n(()=>[m(" snmp trap ")]),_:1},8,["checked"]),p.tsnmp?(g(),w(o,{key:1,label:"通知服务器","label-placement":"left","label-width":"120"},{default:n(()=>[t(r,{value:p.snmpaddr,"onUpdate:value":s[3]||(s[3]=C=>p.snmpaddr=C),options:_.value,"label-field":"ipaddr","value-field":"ipaddr",onScroll:v},null,8,["value","options"])]),_:1})):I("",!0),t(a),t(c,{checked:p.stype,"onUpdate:checked":s[4]||(s[4]=C=>p.stype=C),"checked-value":1,"unchecked-value":0},{default:n(()=>[m(" 声、光、电 ")]),_:1},8,["checked"]),t(a),t(y,{justify:"end"},{default:n(()=>[D((g(),w(f,{type:"info",ghost:"",onClick:l},{default:n(()=>[m("保存")]),_:1})),[[k,"sysmanger.basicInfo.alarmNotification"]])]),_:1})]),_:1})]),_:1})}}}),Tt={class:"h-full"},St=E({name:"basicconfig_system-config",__name:"index",setup(O){const p=M("基本信息"),b=M(""),l=M(null),i=({file:v})=>{l.value=v.file,b.value=v.name},$=v=>{v.stopPropagation(),b.value="",l.value=null};A({fs:""});const x=async()=>{var v;try{const _=new FormData;_.append("fi",l.value);const{data:e,error:s}=await Qe({name:b.value},_);if(s)return;(v=window.$message)==null||v.success(e)}catch{}};return(v,_)=>{const e=$e,s=pe,a=me,c=q,d=it,o=B,r=P,f=Te,y=R,h=F("no-auth");return g(),j("div",Tt,[t(y,{style:{"margin-bottom":"16px"},class:"h-full","content-style":{height:"100%"}},{default:n(()=>[t(f,{type:"card",animated:"",class:"h-100%",value:p.value,"onUpdate:value":_[1]||(_[1]=k=>p.value=k)},{default:n(()=>[t(e,{name:"基本信息",tab:"基本信息"},{default:n(()=>[t(ft)]),_:1}),t(e,{name:"基础配置",tab:"基础配置"},{default:n(()=>[t(dt)]),_:1}),t(e,{name:"邮件服务",tab:"邮件服务"},{default:n(()=>[t(gt)]),_:1}),t(e,{name:"校时配置",tab:"校时配置"},{default:n(()=>[t(vt)]),_:1}),t(e,{name:"数据库维护",tab:"数据库维护",class:"h-100%"},{default:n(()=>[t(yt)]),_:1}),t(e,{name:"数据备份",tab:"数据备份",class:"h-100%"},{default:n(()=>[t(wt)]),_:1}),t(e,{name:"系统快照",tab:"系统快照",class:"h-100%"},{default:n(()=>[t(xt)]),_:1}),t(e,{name:"情报库",tab:"情报库"},{default:n(()=>[t(r,{justify:"center",class:"pt-20px important-flex-col items-center"},{default:n(()=>[t(o,{label:"上传情报库文件","label-placement":"left"},{default:n(()=>[t(d,{action:"","custom-request":i,"show-file-list":!1,accept:".zip"},{default:n(()=>[b.value?(g(),j("div",{key:0,onClick:_[0]||(_[0]=xe(()=>{},["stop"]))},[m(H(b.value)+" ",1),t(s,{class:"font-size-30px cursor-pointer",onClick:$})])):(g(),w(c,{key:1},{icon:n(()=>[t(a,{class:"text-icon"})]),default:n(()=>[m(" 选择文件")]),_:1}))]),_:1})]),_:1}),t(o,{label:"","label-placement":"left",class:"ml-20px"},{default:n(()=>[D((g(),w(c,{type:"info",ghost:"",disabled:!b.value,onClick:x},{default:n(()=>[m("提交")]),_:1},8,["disabled"])),[[h,"sysmanger.basicInfo.intelligence"]])]),_:1})]),_:1})]),_:1}),t(e,{name:"系统告警通知",tab:"系统告警通知"},{default:n(()=>[t($t)]),_:1})]),_:1},8,["value"])]),_:1})])}}}),zt=Z(St,[["__scopeId","data-v-57360ddd"]]);export{zt as default};
