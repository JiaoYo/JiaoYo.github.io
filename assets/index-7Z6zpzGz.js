import{_ as me}from"./round-add-Dxx1Q5ac.js";import{aq as O,d as X,aw as J,q as Z,v as ae,s as le,a as fe,ay as Y,bZ as se,at as H,r as A,c as L,o as v,w as t,f as e,az as _e,G as ee,A as ie,h as s,C as G,aB as ve,b as $,e as g,t as y,B as S,g as b,z as I,aC as ge,N as te,$ as W,aF as ye,aK as be,aN as we,y as V,bh as he,D as q,aP as K,aS as xe,T as ke,F as re,cJ as Ce,aT as Se,aX as Ne,bj as De,av as je,U as de,au as ze,b4 as Te,aI as Ue,M as $e,i as Le,aO as Q,cO as Pe,aA as Re,aU as Ie}from"./index-BG16ZifG.js";import{u as Me,a as Be}from"./table-B-6Bq47M.js";import{_ as Fe,a as We}from"./text-WD1kSkGM.js";import{N as ce}from"./Popconfirm-CW7rsSN1.js";import{_ as qe}from"./round-search-0CRuG0ER.js";import{u as Oe}from"./usePageData-D966OD4e.js";import{_ as Ee}from"./Grid-52o7xY5h.js";import{_ as Ge}from"./FormItemGridItem-CVMlyKk-.js";function Ae(d){return O({url:"/projectWeek/getPage.do",method:"get",params:d})}function Ke(d){return O({url:"/projectWeek/insert.do",method:"post",data:d})}function Ve(d){return O({url:"/projectWeek/update.do",method:"put",data:d})}function Je(d){return O({url:"/projectWeek/delete.do",method:"delete",params:{arrIds:d}})}function He(d){return O({url:"/projectWeekComment/getPage.do",method:"get",params:d})}function Xe(d){return O({url:"/projectWeekComment/insert.do",method:"post",data:d})}function Ze(d){return O({url:"/projectWeekComment/delete.do",method:"delete",params:{arrIds:d}})}const Qe={key:0,class:""},Ye={key:1,class:"flex items-center w-300px"},et=X({name:"OperateDrawer",__name:"operate-drawer",props:J({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(d,{emit:M}){Z();const a=M,j=d,o=ae(k());function k(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}}const B={content1:{required:!0,message:"请输入",trigger:"blur"}};async function N(){Object.assign(o,k()),j.operateType==="edit"&&j.rowData&&Object.assign(o,j.rowData)}const{formRef:x,validate:F,restoreValidation:T}=le(),w=fe(()=>({add:"新增项目周报",edit:"修改项目周报"})[j.operateType]),f=Y(d,"visible"),z=()=>{f.value=!1},P=se.debounce(async()=>{var m,l;if(await F(),j.operateType==="edit"){const{data:r,error:h}=await Ve([{...o}]);h||((m=window.$message)==null||m.success("修改成功"),a("submitted"),z())}else{const{data:r,error:h}=await Ke([{pid:o.pid,content1:o.content1,content2:o.content2,content3:o.content3,content4:o.content4,content5:o.content5,file1:o.file1,file2:o.file2}]);h||((l=window.$message)==null||l.success("添加成功"),a("submitted"),z())}},1e3,{leading:!0,trailing:!1});H(f,()=>{f.value&&(N(),setTimeout(()=>{const m=document.querySelector(".n-scrollbar-content");m==null||m.scrollTo(0,0)},300),T())});const p=A([]),n=A(0);async function _({file:m},l){const r=await be(m.file,m.name,"",h=>{l=="file2"&&(n.value=h)});r&&(l=="file1"?o.value.file1=r:o.value.file2=r,n.value=0)}async function C(m,l){var r,h,R;return l=="file1"&&!["image/jpeg","image/png","image/jpg","image/x-icon"].includes(m.file.file.type)?((r=window.$message)==null||r.destroyAll(),(h=window.$message)==null||h.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1):m.file.file.size>100*1024*1024?((R=window.$message)==null||R.error("文件大小不能超过100M"),!1):!0}return(m,l)=>{const r=ie,h=ve,R=ge,E=ee,c=_e,i=te,D=ye;return v(),L(D,{show:f.value,"onUpdate:show":l[9]||(l[9]=u=>f.value=u),title:w.value,preset:"card",class:"w-800px"},{footer:t(()=>[e(i,{justify:"end"},{default:t(()=>[e(s(S),{size:"small",class:"mt-16px",onClick:z},{default:t(()=>[b(y(s(W)("common.cancel")),1)]),_:1}),e(s(S),{type:"primary",size:"small",class:"mt-16px",onClick:s(P)},{default:t(()=>[b(y(s(W)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(c,{style:{height:"70vh","padding-right":"10px"}},{default:t(()=>[e(E,{ref_key:"formRef",ref:x,model:o,rules:B},{default:t(()=>[e(r,{label:"本周完成",path:"content1"},{default:t(()=>[e(s(G),{clearable:"",type:"textarea",rows:3,value:o.content1,"onUpdate:value":l[0]||(l[0]=u=>o.content1=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),e(r,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{default:t(()=>[e(s(G),{clearable:"",type:"textarea",rows:2,value:o.content2,"onUpdate:value":l[1]||(l[1]=u=>o.content2=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),e(r,{label:"未完成项目",path:"content3"},{default:t(()=>[e(s(G),{clearable:"",type:"textarea",rows:2,value:o.content3,"onUpdate:value":l[2]||(l[2]=u=>o.content3=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),e(r,{label:"下周计划",path:"content4"},{default:t(()=>[e(s(G),{clearable:"",type:"textarea",rows:2,value:o.content4,"onUpdate:value":l[3]||(l[3]=u=>o.content4=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),e(r,{label:"需协调与帮助",path:"content5"},{default:t(()=>[e(s(G),{clearable:"",type:"textarea",rows:2,value:o.content5,"onUpdate:value":l[4]||(l[4]=u=>o.content5=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),e(r,{label:"图片:",path:"file1"},{default:t(()=>[e(h,{ref:"uploadRef",action:"#","list-type":"image-card","default-upload":!1,max:1,"file-list":p.value,"onUpdate:fileList":l[5]||(l[5]=u=>p.value=u),"custom-request":u=>_(u,"file1"),onBeforeUpload:l[6]||(l[6]=u=>C(u,"file1"))},null,8,["file-list","custom-request"])]),_:1}),e(r,{label:"附件:",path:"file2"},{default:t(()=>[o.file2?(v(),$("div",Qe,[g("span",null,y(o.file2.split("?")[1]),1),e(s(S),{text:"",type:"error",onClick:l[7]||(l[7]=u=>o.file2="")},{default:t(()=>l[10]||(l[10]=[b("删除")])),_:1,__:[10]})])):(v(),$("div",Ye,[e(h,{ref:"uploadRef",action:"#","show-file-list":!1,"custom-request":u=>_(u,"file2"),onBeforeUpload:l[8]||(l[8]=u=>C(u,"file2"))},{default:t(()=>[e(s(S),{loading:n.value>0&&!o.file2},{default:t(()=>[b(y(n.value>0&&!o.file2?"上传中":"上传文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"]),n.value&&!o.file2?(v(),L(R,{key:0,type:"line",percentage:n.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):I("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),tt={key:1,class:"mt-3 mb-3 text-gray-700 preview-text"},nt={key:0,class:"mt-3 mb-3 text-gray-700 preview-text"},ot={class:"mt-4 border-t pt-3"},at={class:"flex items-start gap-2 mb-3"},lt={class:"ml-2 flex-1"},st={class:"flex items-center"},it={class:"font-medium font-size-16px font-bold"},rt={class:"text-gray-600 mt-1"},dt=X({name:"drawerLog",__name:"drawerLog",props:J({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(d){const M=Z();we();const a=ae({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""}),j=d,o={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},k=A({});async function B(){N.value=[],Object.assign(a,j.rowData),w()}const N=A([]),x=Y(d,"visible");H(x,()=>{x.value?B():(N.value=[],a.id=void 0)});function F(p){p||T()}function T(){x.value=!1}const w=async()=>{const{data:p,error:n}=await He({page:1,limit:100,pid:a.id});p&&(N.value=p.list)},f=se.debounce(async()=>{var C;const p=k.value[a.id];if(!(p!=null&&p.trim()))return(C=window.$message)==null?void 0:C.warning("请输入评论内容");const{data:n,error:_}=await Xe([{pid:a.id,content:p}]);n&&(k.value[a.id]="",a.num++,w())},1e3,{leading:!0,trailing:!1}),z=async p=>{const{data:n,error:_}=await Ze(p.id);n&&(w(),a.num--,console.log("删除成功"))};async function P(p){if(!p)return;const n=p.split("?")[0],_=p.split("?")[1];try{const m=await(await fetch(n,{mode:"cors"})).blob(),l=URL.createObjectURL(m),r=document.createElement("a");r.href=l,r.download=_,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)}catch(C){console.error("下载失败:",C)}}return(p,n)=>{const _=ie,C=xe,m=ee,l=Fe,r=We,h=he,R=De,E=V("i"),c=V("no-auth");return v(),L(R,{show:x.value,"onUpdate:show":[n[3]||(n[3]=i=>x.value=i),F],"display-directive":"show",width:600,onMaskClick:T,onEsc:T},{default:t(()=>[e(h,{title:a.username+"的项目周报","native-scrollbar":!1,closable:""},{default:t(()=>[e(m,{ref:"formRef",model:a,"show-feedback":!1},{default:t(()=>[e(_,{label:"本周完成",path:"content1"},{label:t(()=>n[4]||(n[4]=[g("div",{class:"font-size-16px font-bold"},"本周完成",-1)])),default:t(()=>[g("span",{class:K(["preview-text",{textstyle:a.content1}])},y(a.content1),3)]),_:1}),e(_,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{label:t(()=>n[5]||(n[5]=[g("div",{class:"font-size-16px font-bold"},"本周对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:t(()=>[g("span",{class:K(["preview-text",{textstyle:a.content2}])},y(a.content2),3)]),_:1}),e(_,{label:"未完成项目",path:"content3"},{label:t(()=>n[6]||(n[6]=[g("div",{class:"font-size-16px font-bold"},"未完成项目",-1)])),default:t(()=>[g("span",{class:K(["preview-text",{textstyle:a.content3}])},y(a.content3),3)]),_:1}),e(_,{label:"下周计划",path:"content4"},{label:t(()=>n[7]||(n[7]=[g("div",{class:"font-size-16px font-bold"},"下周计划",-1)])),default:t(()=>[g("span",{class:K(["preview-text",{textstyle:a.content4}])},y(a.content4),3)]),_:1}),e(_,{label:"需协调与帮助",path:"content5"},{label:t(()=>n[8]||(n[8]=[g("div",{class:"font-size-16px font-bold"},"需协调与帮助",-1)])),default:t(()=>[g("span",{class:K(["preview-text",{textstyle:a.content5}])},y(a.content5),3)]),_:1}),e(_,{label:"图片",path:"content5"},{label:t(()=>n[9]||(n[9]=[g("div",{class:"font-size-16px font-bold"},"图片",-1)])),default:t(()=>{var i;return[a.file1?(v(),L(C,{key:0,width:"80",height:"80",src:a.file1,class:"rounded-md object-cover"},null,8,["src"])):I("",!0),a.file1?(v(),$("div",tt,[b(y((i=a.file1)==null?void 0:i.split("?")[1])+" ",1),e(s(S),{text:"",type:"primary",size:"small",onClick:n[0]||(n[0]=D=>P(a.file1))},{default:t(()=>n[10]||(n[10]=[b("下载")])),_:1,__:[10]})])):I("",!0)]}),_:1}),e(_,{label:"附件",path:"content5"},{label:t(()=>n[11]||(n[11]=[g("div",{class:"font-size-16px font-bold"},"附件",-1)])),default:t(()=>{var i;return[a.file2?(v(),$("div",nt,[b(y((i=a.file2)==null?void 0:i.split("?")[1])+" ",1),e(s(S),{text:"",type:"primary",size:"small",onClick:n[1]||(n[1]=D=>P(a.file2))},{default:t(()=>n[12]||(n[12]=[b("下载")])),_:1,__:[12]})])):I("",!0)]}),_:1})]),_:1},8,["model"]),q((v(),$("div",null,[b(y(a.num)+"评论",1)])),[[E,a.num]]),e(ke,{name:"fade"},{default:t(()=>[g("div",ot,[q((v(),$("div",at,[g("div",null,[e(l,{size:"small",src:o.avatar},null,8,["src"])]),e(s(G),{type:"textarea",id:`comment-input-${a.id}`,value:k.value[a.id],"onUpdate:value":n[2]||(n[2]=i=>k.value[a.id]=i),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:re(Ce(s(f),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),e(s(S),{type:"primary",ghost:"",onClick:s(f)},{default:t(()=>n[13]||(n[13]=[b("发送")])),_:1,__:[13]},8,["onClick"])])),[[c,"project:Summary:Comment:insert"]]),(v(!0),$(Se,null,Ne(N.value,i=>(v(),$("div",{key:i.id,class:"flex mb-3"},[e(l,{size:"small",src:o.avatar},null,8,["src"]),g("div",lt,[g("div",st,[g("span",it,y(i.username),1),e(r,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:t(()=>[b(y(i.dbtime),1)]),_:2},1024),s(M).userInfo.id==i.creater?(v(),L(s(ce),{key:0,onPositiveClick:D=>z(i)},{trigger:t(()=>[q((v(),L(s(S),{quaternary:"",type:"error",size:"small"},{default:t(()=>n[14]||(n[14]=[b(" 删除 ")])),_:1,__:[14]})),[[c,"project:Summary:Comment:delete"]])]),default:t(()=>[n[15]||(n[15]=b(" 确定删除吗？ "))]),_:2,__:[15]},1032,["onPositiveClick"])):I("",!0)]),g("div",rt,y(i.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),ct=je(dt,[["__scopeId","data-v-27017745"]]),ut=X({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search","clear"],["update:model"]),setup(d,{emit:M}){const a=M,{formRef:j}=le(),o=Y(d,"model");Z();const{pageData:k,getData:B,nextPage:N}=Oe(Te),x=async w=>{const f=w.currentTarget,z=f.scrollTop;f.scrollTop+f.offsetHeight>=f.scrollHeight&&k.data.length<k.total&&(await N(),await Ue(),setTimeout(()=>{f.scrollTop=z}))},F=async w=>{o.value.creater=w,a("search")};B({usertypes:"2,3"});async function T(){a("search")}return(w,f)=>{const z=ze,P=Ge,p=qe,n=S,_=te,C=Ee,m=ee,l=de;return v(),L(l,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(m,{ref_key:"formRef",ref:j,model:o.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:re(T,["enter"])},{default:t(()=>[e(C,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(P,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:t(()=>[e(z,{clearable:"",filterable:"",value:o.value.creater,"onUpdate:value":[f[0]||(f[0]=r=>o.value.creater=r),F],placeholder:"请选择","label-field":"username","value-field":"id",options:s(k).data,onScroll:x},null,8,["value","options"])]),_:1}),e(P,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(_,{class:"w-full"},{default:t(()=>[e(n,{type:"primary",ghost:"",onClick:T},{icon:t(()=>[e(p,{class:"text-icon"})]),default:t(()=>[b(" "+y(s(W)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),pt={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},mt={key:0};function oe(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!Ie(d)}const kt=X({name:"projectmanagement_memberlog",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(d,{emit:M}){const a=$e(),j=Z(),o=d,k=M,{columns:B,data:N,getData:x,loading:F,mobilePagination:T,searchParams:w}=Me({showTotal:!0,immediate:!0,apiFn:Ae,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:c=>e("div",null,[c.username+"的项目周报"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:W("common.operate"),align:"center",width:140,fixed:"right",render:c=>{let i;return e("div",{class:"flex-center gap-8px"},[e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>R(c)},{default:()=>[b("查看详情")]}),j.userInfo.id==c.creater&&q(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>l(c.id)},oe(i=W("common.edit"))?i:{default:()=>[i]}),[[V("no-auth"),"project:Summary:update"]]),j.userInfo.id==c.creater&&e(ce,{onPositiveClick:()=>m(c.id)},{default:()=>W("common.confirmDelete"),trigger:()=>{let D;return q(e(S,{type:"error",ghost:!0,size:"small"},oe(D=W("common.delete"))?D:{default:()=>[D]}),[[V("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:f,operateType:z,editingData:P,handleAdd:p,handleEdit:n,checkedRowKeys:_,onDeleted:C}=Be(N,x);async function m(c){const{data:i,error:D}=await Je(c);D||C()}function l(c){n(c)}const r=A(!1),h=A({}),R=c=>{r.value=!0,h.value=c},E=()=>{x()};return H(()=>o.pid,async c=>{c&&(w.pid=c,await x())}),H(()=>N.value,async c=>{c.length>0?k("thereIsData",1):k("thereIsData",0)}),Le(()=>{o.type!="externalLiaison"}),(c,i)=>{const D=te,u=me,ue=Re,pe=de,ne=V("no-auth");return v(),$("div",pt,[o.pid?I("",!0):(v(),L(ut,{key:0,model:s(w),"onUpdate:model":i[0]||(i[0]=U=>Q(w)?w.value=U:null),onReset:E,onSearch:s(x),onClear:i[1]||(i[1]=U=>N.value=[])},null,8,["model","onSearch"])),e(pe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Pe({header:t(()=>[e(D,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[o.pid?I("",!0):(v(),$("div",mt,"项目周报"))]),_:1}),o.pid?q((v(),L(s(S),{key:0,onClick:s(p),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(u,{class:"text-icon"})]),default:t(()=>[i[5]||(i[5]=b(" "+y("新增")))]),_:1,__:[5]},8,["onClick"])),[[ne,"project:Summary:insert"]]):I("",!0)]),default:t(()=>[e(ue,{"checked-row-keys":s(_),"onUpdate:checkedRowKeys":i[2]||(i[2]=U=>Q(_)?_.value=U:null),columns:s(B),data:s(N),size:"small","flex-height":!s(a).isMobile,loading:s(F),remote:"","row-key":U=>U.id,pagination:s(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(et,{visible:s(f),"onUpdate:visible":i[3]||(i[3]=U=>Q(f)?f.value=U:null),onSubmitted:s(x),"operate-type":s(z),pid:o.pid||s(w).pid,"row-data":s(P)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),e(ct,{visible:r.value,"onUpdate:visible":i[4]||(i[4]=U=>r.value=U),"row-data":h.value},null,8,["visible","row-data"])]),_:2},[o.pid?void 0:{name:"header-extra",fn:t(()=>[e(D,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[q((v(),L(s(S),{onClick:s(p),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(u,{class:"text-icon"})]),default:t(()=>[i[6]||(i[6]=b(" "+y("新增")))]),_:1,__:[6]},8,["onClick"])),[[ne,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{kt as default};
