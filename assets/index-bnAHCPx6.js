import{_ as _e}from"./table-column-setting.vue_vue_type_script_setup_true_lang-D0lRqPz4.js";import{_ as he}from"./round-delete-Dxr52Tdg.js";import{_ as we}from"./round-add-CfYkVrv9.js";import{d as te,av as Q,D as be,aT as xe,aK as Z,s as E,A as re,a as ke,at as ie,au as je,c as B,o as N,w as o,f as e,a3 as Se,M as ue,h as r,ay as pe,H as j,bh as le,g as m,J as ae,B as w,t as H,$ as D,a4 as ze,cC as de,aE as ce,X as Ce,Y as Te,C as De,z as me,L as Ne,a2 as fe,aU as Pe,aJ as Ue,E as Be,F as X,b as Fe,aL as W,ax as Ie,I as K,aM as Me,e as Oe,aO as Y,aD as $e,aR as Re}from"./index-DCPTYPg6.js";import{e as qe,a as Le,d as ne,f as Ve}from"./mojicb-D3Twkl-F.js";import{u as Ae,a as Ee}from"./table-wEqNRbcE.js";import{u as ee}from"./usePageData-BUYwLNSk.js";import{_ as ge}from"./Grid-p0WIMYG_.js";import{_ as ye}from"./FormItemGridItem-C8JcVRRJ.js";import{_ as He}from"./DatePicker-BbdERBWx.js";import{_ as Ge}from"./round-search-Digdfr9X.js";import{N as oe}from"./Popconfirm-BQoV-jsN.js";const We=te({name:"OperateDrawer",__name:"operate-drawer",props:Q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(b,{emit:F}){const f=F,g=b,n=be(S());function S(){return{id:"",pid:null,cusname:"",token:"",passward:"",longitude:void 0,latitude:void 0,pro:void 0,jsonfmt:"",csvfmt:"",expiare:xe(0,new Date().getTime()+864e5*365),notes:""}}const{pageData:_,getData:u,nextPage:I}=ee(de),d=async t=>{const a=t.currentTarget,i=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&_.data.length<_.total&&(await I(),await ce(),setTimeout(()=>{a.scrollTop=i}))},c=t=>{n.pid=t},h=()=>{u({page:1})},M=Z.debounce(async t=>{await u({fuzzy:t,page:1})},300),O=t=>{if(!t){n.pid=null,h();return}M(t)},z=E(!1);async function $(){var t;Object.assign(n,S()),z.value=!1,u({page:1,fuzzy:((t=g.rowData)==null?void 0:t.pro)||""}),g.operateType==="edit"&&g.rowData&&(g.rowData.expiare=="已到期"&&(z.value=!0),Object.assign(n,g.rowData))}const{formRef:y,validate:C,restoreValidation:R}=re(),v={type:"string",required:!0,trigger:["blur","change"],message:"请输入"},P={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},cusname:v,token:v,passward:v,longitude:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},latitude:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},pro:v,expiare:v,notes:v,jsonfmt:v,csvfmt:v},G=ke(()=>({add:"新增气象信息",edit:"修改气象信息"})[g.operateType]),x=ie(b,"visible");je(x,()=>{x.value&&($(),setTimeout(()=>{const t=document.querySelector(".n-scrollbar-content");t==null||t.scrollTo(0,0)},300),R())});function T(){x.value=!1}const k=E(!1),l=async()=>{var t,a;if(!k.value)try{if(await C(),k.value=!0,g.operateType==="edit"){const{data:i,error:p}=await qe([n]);p||(T(),f("submitted"),(t=window.$message)==null||t.success("修改成功"))}else{const{data:i,error:p}=await Le([{...n}]);p||(T(),f("submitted"),(a=window.$message)==null||a.success("添加成功"))}}catch{}finally{k.value=!1}};return(t,a)=>{const i=ye,p=ge,q=ue,L=Se,V=ae,U=ze;return N(),B(U,{show:x.value,"onUpdate:show":a[11]||(a[11]=s=>x.value=s),title:G.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:o(()=>[e(V,{justify:"end",size:16},{default:o(()=>[e(r(w),{onClick:T},{default:o(()=>[m(H(r(D)("common.cancel")),1)]),_:1}),e(r(w),{type:"primary",onClick:l,loading:k.value},{default:o(()=>[m(H(r(D)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:o(()=>[e(L,{class:"pr-20px"},{default:o(()=>[e(q,{ref_key:"formRef",ref:y,model:n,rules:P,"label-placement":"top","label-width":140},{default:o(()=>[e(p,{responsive:"screen","item-responsive":"","x-gap":"20"},{default:o(()=>[e(i,{span:"24 m:12",label:"关联项目",path:"pid"},{default:o(()=>[e(r(pe),{clearable:"",filterable:"",value:n.pid,"onUpdate:value":[a[0]||(a[0]=s=>n.pid=s),c],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:h,onSearch:O,options:r(_).data,onScroll:d},null,8,["value","options"])]),_:1}),e(i,{span:"24 m:12",label:"客户名称",path:"cusname"},{default:o(()=>[e(r(j),{value:n.cusname,"onUpdate:value":a[1]||(a[1]=s=>n.cusname=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(i,{span:"24 m:24",label:"气象信息Token",path:"token"},{default:o(()=>[e(r(j),{value:n.token,"onUpdate:value":a[2]||(a[2]=s=>n.token=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(i,{span:"24 m:24",label:"气象信息Passward",path:"passward"},{default:o(()=>[e(r(j),{value:n.passward,"onUpdate:value":a[3]||(a[3]=s=>n.passward=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(i,{span:"24 m:12",label:"经度",path:"longitude"},{default:o(()=>[e(r(le),{value:n.longitude,"onUpdate:value":a[4]||(a[4]=s=>n.longitude=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),e(i,{span:"24 m:12",label:"维度",path:"latitude"},{default:o(()=>[e(r(le),{value:n.latitude,"onUpdate:value":a[5]||(a[5]=s=>n.latitude=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),e(i,{span:"24 m:12",label:"合同项目名称",path:"pro"},{default:o(()=>[e(r(j),{value:n.pro,"onUpdate:value":a[6]||(a[6]=s=>n.pro=s),placeholder:"请输入"},null,8,["value"])]),_:1}),z.value?(N(),B(i,{key:1,span:"24 m:12",label:"过期时间",path:"expiare"},{default:o(()=>a[12]||(a[12]=[m(" 已到期 ")])),_:1,__:[12]})):(N(),B(i,{key:0,span:"24 m:12",label:"过期时间",path:"expiare"},{default:o(()=>[e(r(He),{size:"small","formatted-value":n.expiare,"onUpdate:formattedValue":a[7]||(a[7]=s=>n.expiare=s),type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})),e(i,{span:"24 m:12",label:"JSON格式",path:"jsonfmt"},{default:o(()=>[e(r(j),{type:"textarea",rows:2,value:n.jsonfmt,"onUpdate:value":a[8]||(a[8]=s=>n.jsonfmt=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(i,{span:"24 m:12",label:"CSV格式",path:"csvfmt"},{default:o(()=>[e(r(j),{type:"textarea",rows:2,value:n.csvfmt,"onUpdate:value":a[9]||(a[9]=s=>n.csvfmt=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(i,{span:"24 m:24",label:"备注",path:""},{default:o(()=>[e(r(j),{type:"textarea",value:n.notes,"onUpdate:value":a[10]||(a[10]=s=>n.notes=s),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ke=te({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["reset","search","clear"],["update:model"]),setup(b,{emit:F}){const f=Ce(),g=Te(),n=F,{formRef:S}=re(),_=De("pname"),u=ie(b,"model"),I=me(),d=E([]),{pageData:c,getData:h,nextPage:M}=ee(de),O=async t=>{const a=t.currentTarget,i=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&c.data.length<c.total&&(await M(),d.value=c.data,await ce(),setTimeout(()=>{a.scrollTop=i}))};ee(Pe);const z=async t=>{var a,i;C.value=!0,t?(u.value.pid=t,n("search"),I.setProjectInfo({pname:(a=d.value.find(p=>p.id==t))==null?void 0:a.proname,pid:t}),_.value=(i=d.value.find(p=>p.id==t))==null?void 0:i.proname):n("search")},$=Z.debounce(async t=>{await h({fuzzy:t,page:1}),d.value=c.data},300),y=E(!1),C=E(!1),R=t=>{if(u.value.pid=null,y.value=!0,C.value=!1,!t){P();return}$(t)},v=async()=>{y.value&&!C.value&&(await h({page:1}),d.value=c.data,y.value=!1)},P=async()=>{await h({page:1}),d.value=c.data};(async()=>{await h(),d.value=c.data,u.value.pid=f.query.prjId?Number(f.query.prjId):void 0,u.value.fuzzy=f.query.pname?f.query.pname:"",n("search"),setTimeout(()=>{g.replace({path:f.path,query:{}})},10)})();function x(){u.value.fuzzy=void 0,n("search")}const T=Z.debounce(t=>{n("search")},1e3,{leading:!0,trailing:!1}),k=t=>{if(!t)return n("search");u.value.fuzzy=t||void 0,T(t)};async function l(){n("search")}return(t,a)=>{const i=j,p=ye,q=pe,L=Ge,V=w,U=ae,s=ge,A=ue,ve=fe;return N(),B(ve,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[e(A,{ref_key:"formRef",ref:S,model:u.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ne(l,["enter"])},{default:o(()=>[e(s,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[e(p,{span:"24 s:12 m:7",label:"合同项目名称",path:"fuzzy","label-width":"180px"},{default:o(()=>[e(i,{clearable:"",value:u.value.fuzzy,"onUpdate:value":a[0]||(a[0]=J=>u.value.fuzzy=J),placeholder:"请输入合同项目名称",onClear:x,onInput:k},null,8,["value"])]),_:1}),e(p,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:o(()=>[e(q,{filterable:"",clearable:"",value:u.value.pid,"onUpdate:value":[a[1]||(a[1]=J=>u.value.pid=J),z],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:d.value,onScroll:O,onClear:P,onSearch:R,onBlur:v},null,8,["value","options"])]),_:1}),e(p,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[e(U,{class:"w-full"},{default:o(()=>[e(V,{type:"primary",ghost:"",onClick:l},{icon:o(()=>[e(L,{class:"text-icon"})]),default:o(()=>[m(" "+H(r(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function se(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!Re(b)}const it=te({name:"projectmanagement_mojicb",__name:"index",setup(b){const F=Ue();Be();const f=me(),{columns:g,columnChecks:n,data:S,getData:_,loading:u,mobilePagination:I,searchParams:d}=Ae({showTotal:!0,apiFn:Ve,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"cusname",title:"客户名称",align:"center",width:140},{key:"pro",title:"墨迹合同项目名称",align:"center",width:140},{key:"token",title:"气象信息Token",align:"center",width:200,render(l){return e("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[e("span",null,[l.token||"-"]),l.token&&e(Y,{trigger:"hover"},{trigger:()=>e(w,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>c(l.token)},{default:()=>[m("复制")]}),default:()=>"复制 token"})])}},{key:"passward",title:"气象信息Passward",align:"center",width:200,render(l){return e("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[e("span",null,[l.passward||"-"]),l.passward&&e(w,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>c(l.passward)},{default:()=>[m("复制")]})])}},{key:"longitude",title:"经度",align:"center",width:120},{key:"latitude",title:"维度",align:"center",width:120},{key:"expiare",title:"过期时间",align:"center",width:120},{key:"status",title:"是否过期",align:"center",width:80,render:l=>l.status===null?null:e($e,{type:l.status==0?"success":"error"},{default:()=>[l.status==0?"正常":"过期"]})},{key:"jsonfmt",title:"JSON格式",align:"center",width:200,render(l){return e("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[e(Y,{trigger:"hover"},{trigger:()=>e("span",{style:{maxWidth:"120px",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-all",lineHeight:"18px",cursor:"pointer"}},[l.jsonfmt||"-"]),default:()=>e("span",null,[l.jsonfmt||"-"])}),l.jsonfmt&&e(w,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>c(l.jsonfmt)},{default:()=>[m("复制")]})])}},{key:"csvfmt",title:"CVS格式",align:"center",width:200,render(l){return e("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[e(Y,{trigger:"hover"},{trigger:()=>e("span",{style:{maxWidth:"120px",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-all",lineHeight:"18px",cursor:"pointer"}},[l.csvfmt||"-"]),default:()=>e("span",null,[l.csvfmt||"-"])}),l.csvfmt&&e(w,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>c(l.csvfmt)},{default:()=>[m("复制")]})])}},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(l){return e("div",{style:"display:flex; flex-direction:column; font-size:13px; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[m("创建人：")]),e("span",{style:"font-weight:500"},[l.username||"-"])]),e("div",null,[e("span",{style:"color:#666"},[m("时间：")]),e("span",{style:" font-weight:500"},[l.dbtime||"-"])])])}},{key:"operate",title:D("common.operate"),align:"center",width:f.userInfo.usertype==0?140:0,fixed:"right",render:l=>{let t;return e("div",{class:"flex-center gap-8px"},[f.userInfo.usertype==0&&K(e(w,{type:"primary",ghost:!0,size:"small",onClick:()=>G(l.id)},se(t=D("common.edit"))?t:{default:()=>[t]}),[[X("no-auth"),"project:moji:update"]]),f.userInfo.usertype==0&&e(oe,{onPositiveClick:()=>P(l.id)},{default:()=>D("common.confirmDelete"),trigger:()=>{let a;return K(e(w,{type:"error",ghost:!0,size:"small"},se(a=D("common.delete"))?a:{default:()=>[a]}),[[X("no-auth"),"project:moji:delete"]])}})])}}]}),c=async l=>{var t;l&&(await navigator.clipboard.writeText(l),(t=window.$message)==null||t.success("已复制"))},{drawerVisible:h,operateType:M,editingData:O,handleAdd:z,handleEdit:$,checkedRowKeys:y,onBatchDeleted:C,onDeleted:R}=Ee(S,_);async function v(){console.log(y.value),x(y.value.join(","),l=>{C()})}async function P(l){const{data:t,error:a}=await ne(l);a||R()}function G(l){$(l)}async function x(l,t){const{data:a,error:i}=await ne(l);if(!i)t&&t(a);else return!1}const T=l=>{_()},k=()=>{_()};return(l,t)=>{const a=ae,i=we,p=he,q=_e,L=Ie,V=fe,U=X("no-auth");return N(),Fe("div",Je,[e(Ke,{model:r(d),"onUpdate:model":t[0]||(t[0]=s=>W(d)?d.value=s:null),onReset:k,onSearch:r(_)},null,8,["model","onSearch"]),e(V,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[e(a,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>t[4]||(t[4]=[Oe("div",null,"气象信息列表",-1)])),_:1,__:[4]})]),"header-extra":o(()=>[e(a,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[K((N(),B(r(w),{onClick:r(z),size:"small",ghost:"",type:"primary"},{icon:o(()=>[e(i,{class:"text-icon"})]),default:o(()=>[t[5]||(t[5]=m(" "+H("新增")))]),_:1,__:[5]},8,["onClick"])),[[U,"project:moji:insert"]]),e(r(oe),{onPositiveClick:v},{trigger:o(()=>[K((N(),B(r(w),{size:"small",ghost:"",type:"error",disabled:r(y).length==0},{icon:o(()=>[e(p,{class:Me(["text-icon",{"animate-spin":r(u)}])},null,8,["class"])]),default:o(()=>[t[6]||(t[6]=m(" "+H("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[U,"project:moji:delete"]])]),default:o(()=>[t[7]||(t[7]=m(" 确定要删除选中的数据吗？ "))]),_:1,__:[7]}),e(q,{columns:r(n),"onUpdate:columns":t[1]||(t[1]=s=>W(n)?n.value=s:null),ctype:8},null,8,["columns"])]),_:1})]),default:o(()=>[e(L,{"checked-row-keys":r(y),"onUpdate:checkedRowKeys":t[2]||(t[2]=s=>W(y)?y.value=s:null),columns:r(g),data:r(S),size:"small","flex-height":!r(F).isMobile,loading:r(u),remote:"","row-key":s=>s.id,pagination:r(I),class:"sm:h-full","onUpdate:filters":T,"scroll-x":r(g).reduce((s,A)=>s+((A==null?void 0:A.width)||100),0)},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination","scroll-x"]),e(We,{visible:r(h),"onUpdate:visible":t[3]||(t[3]=s=>W(h)?h.value=s:null),onSubmitted:r(_),"operate-type":r(M),"row-data":r(O)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{it as default};
