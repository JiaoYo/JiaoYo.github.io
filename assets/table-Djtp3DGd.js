import{dq as L,bU as $,D as B,dr as M,s as z,a as O,bd as I,aN as U,$ as T}from"./index-BhODWnwk.js";function H(s){const{loading:h,startLoading:f,endLoading:m}=L(),{bool:D,setBool:g}=$(),{apiFn:y,apiParams:u,transformer:w,immediate:k=!0,getColumnChecks:S,getColumns:C}=s,o=B(M({...u})),c=z(s.columns()),P=z([]),l=z(S(s.columns())),b=O(()=>C(c.value,l.value));function v(){c.value=s.columns();const r=new Map(l.value.map(e=>[e.key,e.checked])),p=S(c.value);l.value=p.map(e=>({...e,checked:r.get(e.key)??e.checked}))}async function x(){var t;f();const r=a(o),p=await y(r),e=w(p);P.value=e.data,g(e.data.length===0),await((t=s.onFetched)==null?void 0:t.call(s,e)),m()}function a(r){const p={};return Object.entries(r).forEach(([e,t])=>{t!=null&&(p[e]=t)}),p}function _(r){Object.assign(o,r)}function E(){Object.assign(o,M(u))}return k&&x(),{loading:h,empty:D,data:P,columns:b,columnChecks:l,reloadColumns:v,getData:x,searchParams:o,updateSearchParams:_,resetSearchParams:E}}function q(s){I();const h=U(),f=O(()=>h.isMobile),{apiFn:m,apiParams:D,immediate:g,showTotal:y=!0}=s,u="__selection__",w="__expand__",{loading:k,empty:S,data:C,columns:o,columnChecks:c,reloadColumns:P,getData:l,searchParams:b,updateSearchParams:v,resetSearchParams:x}=H({apiFn:m,apiParams:D,columns:s.columns,transformer:e=>{e.hasOwnProperty("total")||(e.total=0);const{pageNum:t=1,pageSize:n=50,total:d=0,list:i=[]}=e.data||{},F=e.data instanceof Array?e.data:i.map((j,K)=>({...j,index:(t-1)*n+K+1}));let A=b;return{data:F,pageNum:A.page,pageSize:A.pageSize,total:Number(d)}},getColumnChecks:e=>{const t=[];return e.forEach(n=>{N(n)?t.push({key:n.key,title:n.title,checked:!0}):n.type==="selection"?t.push({key:u,title:T("common.check"),checked:!0}):n.type==="expand"&&t.push({key:w,title:T("common.expandColumn"),checked:!0})}),t},getColumns:(e,t)=>{const n=new Map;return e.forEach(i=>{N(i)?n.set(i.key,i):i.type==="selection"?n.set(u,i):i.type==="expand"&&n.set(w,i)}),t.filter(i=>i.checked).map(i=>n.get(i.key))},onFetched:async e=>{const{pageNum:t,pageSize:n,total:d}=e;r({page:t,pageSize:n,itemCount:d})},immediate:g});let a=B({page:1,pageSize:50,showSizePicker:!0,itemCount:0,pageSizes:[10,20,50,100],onUpdatePage:async e=>{a.page=e,v({page:e,pageSize:a.pageSize||50,limit:a.pageSize||50,_t:new Date().getTime()}),_()},onUpdatePageSize:async e=>{a.pageSize=e,a.page=1,v({page:a.page,pageSize:e,limit:e,_t:new Date().getTime()}),_()},...y?{prefix:e=>T("datatable.itemCount",{total:e.itemCount})}:{}});const _=async()=>{const e=a.page,t=a.pageSize;await l();const n=a.itemCount,d=Math.ceil(n/t);e>d&&e>1?(a.page=d,b.page=d,await l()):C.value.length===0&&e>1&&(a.page=e-1,b.page=e-1,await l())},E=O(()=>({...a,pageSlot:f.value?3:9,prefix:!f.value&&y?a.prefix:void 0}));function r(e){Object.assign(a,e)}async function p(e=1){r({page:e}),v({page:e,pageSize:a.pageSize,limit:a.pageSize,_t:new Date().getTime()}),await l()}return{loading:k,empty:S,data:C,columns:o,columnChecks:c,reloadColumns:P,pagination:a,mobilePagination:E,updatePagination:r,getData:_,getDataByPage:p,searchParams:b,updateSearchParams:v,resetSearchParams:x}}function G(s,h){const{bool:f,setTrue:m,setFalse:D}=$(),g=z("add");function y(){g.value="add",m()}const u=z(null);function w(o){g.value="edit";const c=s.value.find(P=>P.id===o)||null;u.value=M(c),m()}const k=z([]);async function S(){var o,c;(o=window.$message)==null||o.destroyAll(),(c=window.$message)==null||c.success(T("common.deleteSuccess")),k.value=[],await h()}async function C(){var o,c;(o=window.$message)==null||o.destroyAll(),(c=window.$message)==null||c.success(T("common.deleteSuccess")),await h()}return{drawerVisible:f,openDrawer:m,closeDrawer:D,operateType:g,handleAdd:y,editingData:u,handleEdit:w,checkedRowKeys:k,onBatchDeleted:S,onDeleted:C}}function N(s){return!!s.key}export{G as a,q as u};
