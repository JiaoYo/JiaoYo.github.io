import{_ as me}from"./table-column-setting.vue_vue_type_script_setup_true_lang-QrHefyna.js";import{_ as fe}from"./round-delete-Dc4nvDdb.js";import{_ as _e}from"./round-add-C2zJSyfQ.js";import{d as Z,aE as Y,m as ee,r as ge,H as te,n as ae,a as he,aG as oe,aC as ve,bY as ne,cy as ye,cz as we,c as E,o as V,w as o,f as t,a0 as be,C as le,h as n,aD as se,x as O,N as J,B as T,g as z,t as D,$ as b,a1 as Ce,cs as re,aO as ie,A as ke,Z as ce,aS as xe,i as Se,q as K,b as Te,aT as G,aH as ze,y as H,aU as je,e as De,cA as Q,cr as Ne,aY as Pe}from"./index-JAJtFREg.js";import{u as Ue,a as $e}from"./table-BRXBK7jy.js";import{u as pe}from"./usePageData-Bdo4iRgJ.js";import{_ as de}from"./Grid-2TTZqiUQ.js";import{_ as ue}from"./FormItemGridItem-B9mm_V6-.js";import{_ as Ie}from"./round-search-DvvXtTQ6.js";import{_ as Be}from"./round-refresh-CUGhkg0t.js";import{N as W}from"./Popconfirm-DTB2ANQW.js";const Fe=Z({name:"OperateDrawer",__name:"operate-drawer",props:Y({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(y,{emit:N}){const f=N,C=ee(),u=y,a=ge(v());function v(){return{pid:void 0,id:"",pname:"",pcontact:"",proposition:"",docker:""}}const c=te([]),{pageData:p,getData:_,nextPage:k}=pe(re),P=async s=>{const e=s.currentTarget,i=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&p.data.length<p.total&&(await k(),c.value=p.data,await ie(),setTimeout(()=>{e.scrollTop=i}))},U=async()=>{await _({fuzzy:C.userInfo.pname,page:1}),c.value=p.data},$=async()=>{await _({page:1}),c.value=p.data},I=async s=>{a.pid=s};async function g(){U(),Object.assign(a,v()),u.operateType==="add"&&(a.pid=u.pid),u.operateType==="edit"&&u.rowData&&Object.assign(a,u.rowData)}const{formRef:A,validate:B,restoreValidation:F}=ae(),j={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},pname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},pcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},r=he(()=>({add:"新增联系人",edit:"修改联系人"})[u.operateType]),l=oe(y,"visible");ve(l,()=>{l.value&&(g(),setTimeout(()=>{const s=document.querySelector(".n-scrollbar-content");s==null||s.scrollTo(0,0)},300),F())});function m(){l.value=!1}const x=ne.debounce(async()=>{await M()},1e3,{leading:!0,trailing:!1});async function M(){var s,e;if(await B(),u.operateType==="edit"){const{data:i,error:h}=await ye([a]);h||(m(),f("submitted"),(s=window.$message)==null||s.success("修改成功"))}else{const{data:i,error:h}=await we([{...a}]);h||(m(),f("submitted"),(e=window.$message)==null||e.success("添加成功"))}}return(s,e)=>{const i=ue,h=de,R=le,q=be,L=J,S=Ce;return V(),E(S,{show:l.value,"onUpdate:show":e[5]||(e[5]=d=>l.value=d),title:r.value,preset:"card",class:"w-500px","mask-closable":!1,draggable:!0},{footer:o(()=>[t(L,{justify:"end",size:16},{default:o(()=>[t(n(T),{onClick:m},{default:o(()=>[z(D(n(b)("common.cancel")),1)]),_:1}),t(n(T),{type:"primary",onClick:n(x)},{default:o(()=>[z(D(n(b)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:o(()=>[t(q,{class:"pr-20px"},{default:o(()=>[t(R,{ref_key:"formRef",ref:A,model:a,rules:j,"label-placement":"left","label-width":120},{default:o(()=>[t(h,{responsive:"screen","item-responsive":""},{default:o(()=>[t(i,{span:"24 m:24",label:"项目列表",path:"pid"},{default:o(()=>[t(n(se),{clearable:"",filterable:"",value:a.pid,"onUpdate:value":[e[0]||(e[0]=d=>a.pid=d),I],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:$,options:c.value,onScroll:P},null,8,["value","options"])]),_:1}),t(i,{span:"24 m:24",label:"对接方",path:"docker"},{default:o(()=>[t(n(O),{value:a.docker,"onUpdate:value":e[1]||(e[1]=d=>a.docker=d),placeholder:"请输入"},null,8,["value"])]),_:1}),t(i,{span:"24 m:24",label:"姓名",path:"pname"},{default:o(()=>[t(n(O),{value:a.pname,"onUpdate:value":e[2]||(e[2]=d=>a.pname=d),placeholder:"请输入"},null,8,["value"])]),_:1}),t(i,{span:"24 m:24",label:"联系方式",path:"pcontact"},{default:o(()=>[t(n(O),{value:a.pcontact,"onUpdate:value":e[3]||(e[3]=d=>a.pcontact=d),placeholder:"请输入"},null,8,["value"])]),_:1}),t(i,{span:"24 m:24",label:"备注",path:"proposition"},{default:o(()=>[t(n(O),{value:a.proposition,"onUpdate:value":e[4]||(e[4]=d=>a.proposition=d),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Me=Z({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Y(["reset","search","clear"],["update:model"]),setup(y,{emit:N}){const f=N,{formRef:C,restoreValidation:u}=ae(),a=oe(y,"model"),v=ee(),c=te([]),{pageData:p,getData:_,nextPage:k}=pe(re),P=async r=>{const l=r.currentTarget,m=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&p.data.length<p.total&&(await k(),c.value=p.data,await ie(),setTimeout(()=>{l.scrollTop=m}))},U=async r=>{var l;r?(a.value.pid=r,f("search"),v.setProjectInfo({pname:(l=c.value.find(m=>m.id==r))==null?void 0:l.proname,pid:r})):f("clear")},$=ne.debounce(async r=>{await _({fuzzy:r,page:1}),c.value=p.data},300),I=r=>{if(!r){a.value.pid=null,g();return}$(r)},g=async()=>{await _({page:1}),c.value=p.data};(async()=>{var r,l;await _({fuzzy:v.userInfo.pname}),c.value=p.data,a.value.pid=v.userInfo.pid?v.userInfo.pid:(r=c.value[0])==null?void 0:r.id,v.setProjectInfo({pid:a.value.pid,pname:(l=c.value.find(m=>m.id==a.value.pid))==null?void 0:l.proname}),f("search")})();async function B(){await u(),a.value.fuzzy="",f("reset")}const F=()=>{a.value.fuzzy="",f("search")};async function j(){var r,l;a.value.pid?f("search"):((r=window.$message)==null||r.destroyAll(),(l=window.$message)==null||l.warning("请选择项目"))}return(r,l)=>{const m=se,x=ue,M=O,s=Be,e=T,i=Ie,h=J,R=de,q=le,L=ce;return V(),E(L,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[t(q,{ref_key:"formRef",ref:C,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ke(j,["enter"])},{default:o(()=>[t(R,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[t(x,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:o(()=>[t(m,{filterable:"",clearable:"",value:a.value.pid,"onUpdate:value":[l[0]||(l[0]=S=>a.value.pid=S),U],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:c.value,onScroll:P,onClear:g,onSearch:I},null,8,["value","options"])]),_:1}),t(x,{span:"24 s:12 m:6",label:"姓名",path:"fuzzy"},{default:o(()=>[t(M,{value:a.value.fuzzy,"onUpdate:value":l[1]||(l[1]=S=>a.value.fuzzy=S),placeholder:"请输入",clearable:"",onClear:F},null,8,["value"])]),_:1}),t(x,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[t(h,{class:"w-full"},{default:o(()=>[t(e,{onClick:B},{icon:o(()=>[t(s,{class:"text-icon"})]),default:o(()=>[z(" "+D(n(b)("common.reset")),1)]),_:1}),t(e,{type:"primary",ghost:"",onClick:j},{icon:o(()=>[t(i,{class:"text-icon"})]),default:o(()=>[z(" "+D(n(b)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Re={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function X(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Pe(y)}const Je=Z({name:"projectmanagement_contact",__name:"index",setup(y){const N=xe(),{columns:f,columnChecks:C,data:u,getData:a,pagination:v,loading:c,mobilePagination:p,searchParams:_}=Ue({showTotal:!0,immediate:!1,apiFn:Ne,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"docker",title:"对接方",align:"center",width:120},{key:"pname",title:"姓名",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pcontact",title:"联系方式",align:"center",width:120},{key:"proposition",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:b("common.operate"),align:"center",width:140,fixed:"right",render:s=>{let e;return t("div",{class:"flex-center gap-8px"},[H(t(T,{type:"primary",ghost:!0,size:"small",onClick:()=>r(s.id)},X(e=b("common.edit"))?e:{default:()=>[e]}),[[K("no-auth"),"project:Contact:update"]]),t(W,{onPositiveClick:()=>j(s.id)},{default:()=>b("common.confirmDelete"),trigger:()=>{let i;return H(t(T,{type:"error",ghost:!0,size:"small"},X(i=b("common.delete"))?i:{default:()=>[i]}),[[K("no-auth"),"project:Contact:delete"]])}})])}}]}),{drawerVisible:k,operateType:P,editingData:U,handleAdd:$,handleEdit:I,checkedRowKeys:g,onBatchDeleted:A,onDeleted:B}=$e(u,a);Se(async()=>{});async function F(){console.log(g.value),l(g.value.join(","),s=>{A()})}async function j(s){const{data:e,error:i}=await Q(s);i||B()}function r(s){I(s)}async function l(s,e){const{data:i,error:h}=await Q(s);if(!h)e&&e(i);else return!1}const m=s=>{a()},x=()=>{u.value=[],v.itemCount=0},M=()=>{a()};return(s,e)=>{const i=J,h=_e,R=fe,q=me,L=ze,S=ce,d=K("no-auth");return V(),Te("div",Re,[t(Me,{model:n(_),"onUpdate:model":e[0]||(e[0]=w=>G(_)?_.value=w:null),onReset:M,onSearch:n(a),onClear:x},null,8,["model","onSearch"]),t(S,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[t(i,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>e[4]||(e[4]=[De("div",null,"项目联系人",-1)])),_:1,__:[4]})]),"header-extra":o(()=>[t(i,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[H((V(),E(n(T),{onClick:n($),size:"small",ghost:"",type:"primary"},{icon:o(()=>[t(h,{class:"text-icon"})]),default:o(()=>[e[5]||(e[5]=z(" "+D("新增")))]),_:1,__:[5]},8,["onClick"])),[[d,"project:Contact:insert"]]),t(n(W),{onPositiveClick:F},{trigger:o(()=>[H((V(),E(n(T),{size:"small",ghost:"",type:"error",disabled:n(g).length==0},{icon:o(()=>[t(R,{class:je(["text-icon",{"animate-spin":n(c)}])},null,8,["class"])]),default:o(()=>[e[6]||(e[6]=z(" "+D("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[d,"project:Contact:delete"]])]),default:o(()=>[e[7]||(e[7]=z(" 确定要删除选中的联系人吗？ "))]),_:1,__:[7]}),t(q,{columns:n(C),"onUpdate:columns":e[1]||(e[1]=w=>G(C)?C.value=w:null)},null,8,["columns"])]),_:1})]),default:o(()=>[t(L,{"checked-row-keys":n(g),"onUpdate:checkedRowKeys":e[2]||(e[2]=w=>G(g)?g.value=w:null),columns:n(f),data:n(u),size:"small","flex-height":!n(N).isMobile,loading:n(c),remote:"","row-key":w=>w.id,pagination:n(p),class:"sm:h-full","onUpdate:filters":m},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Fe,{visible:n(k),"onUpdate:visible":e[3]||(e[3]=w=>G(k)?k.value=w:null),onSubmitted:n(a),pid:n(_).pid,"operate-type":n(P),"row-data":n(U)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{Je as default};
