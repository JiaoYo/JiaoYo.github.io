import{_ as he}from"./table-column-setting.vue_vue_type_script_setup_true_lang-3wfWTgiM.js";import{_ as xe}from"./refresh-CU7cSF-I.js";import{d as U,q as ye,s as be,x as Ce,F,o as V,c as Pe,w as r,g as o,G as K,h as D,t as M,i as l,$ as G,H as we,L as Ne,B as A,P as O,Q as Le,af as je,dI as ke,a6 as Se,j as $,ag as $e,f as B,ac as Re,b0 as z,S as ge,at as ze,R as De,T as Te,U as Ee,a5 as Ie,Y as Be,r as me,e as Ae,aj as _e,bm as Fe,aI as Ke,al as Oe}from"./index-b-tEOQea.js";import{a as Ge,c as Me,d as Ue,e as fe,g as Ve}from"./reportForm-yrcD-mrD.js";import{u as Je}from"./table-BfCfNean.js";import{_ as qe}from"./round-search-BOrpJEk6.js";import{_ as He}from"./round-refresh-CerSsMY0.js";import{_ as We}from"./lodash-CqSdoX1d.js";import{_ as Qe}from"./FormItemGridItem-BGGD_lC8.js";import{_ as Ye}from"./Grid-BHUm-qXA.js";import{T as Xe}from"./task-IxzlqUWR.js";import{_ as Ze,a as ea,b as aa,c as ta}from"./file-pdf-BZEj0lut.js";import{_ as ve}from"./Popconfirm-CdcvVkbL.js";import"./setting-outlined-SXeXtAqu.js";import"./echarts.vue_vue_type_script_setup_true_lang-A_ISdOY2.js";import"./index-BS8KoN7o.js";import"./installCanvasRenderer-iCPGNWhM.js";const oa=U({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:ye(["reset","search"],["update:model"]),setup(b,{emit:T}){const E=T,{formRef:_,restoreValidation:w}=be(),d=Ce(b,"model"),R=()=>{d.value.fuzzy="",g()};async function j(){await w(),E("reset")}async function g(){E("search")}const N=We.debounce(g,1e3,{leading:!0,trailing:!1});return(y,I)=>{const C=Ne,t=Qe,e=He,u=A,c=qe,h=O,L=Ye,k=Le,S=je,n=F("no-space");return V(),Pe(S,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[o(k,{ref_key:"formRef",ref:_,model:d.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:we(l(N),["enter"])},{default:r(()=>[o(L,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:r(()=>[o(t,{span:"24 s:12 m:8 l:6",label:"实例名称",path:"alatype"},{default:r(()=>[K(o(C,{autofocus:"",value:d.value.fuzzy,"onUpdate:value":I[0]||(I[0]=s=>d.value.fuzzy=s),placeholder:"请输入实例名称关键字",clearable:"",onClear:R},null,8,["value"]),[[n]])]),_:1}),o(t,{span:"24 s:12 m:8 l:6"},{default:r(()=>[o(h,{class:"w-full"},{default:r(()=>[o(u,{onClick:j},{icon:r(()=>[o(e,{class:"text-icon"})]),default:r(()=>[D(" "+M(l(G)("common.reset")),1)]),_:1}),o(u,{type:"primary",ghost:"",onClick:l(N)},{icon:r(()=>[o(c,{class:"text-icon"})]),default:r(()=>[D(" "+M(l(G)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),na=b=>(De("data-v-acdae960"),b=b(),Te(),b),sa=na(()=>B("span",{class:"mr-20px"},"报表预览",-1)),la={title:"导出PDF"},ra={title:"导出Word"},ua={title:"导出Excel"},ia=U({name:"reportPreview",__name:"reportPreview",props:ye({data:{},detaliParams:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(b){ke(t=>({e70f7700:l(E)}));const T=Se(),E=T.themeScheme=="dark"?"#001428":"#fff",_=b,w=Ce(b,"visible"),d=$([]),R=async t=>{const{data:e,error:u}=await Ge({rtype:t});u||(e.forEach(c=>{c.rtext=JSON.parse(c.rtext)}),d.value=e[0].rtext)},j=["一般","低级","中级","高级","严重"],g=["#99CC00","#1e90ff","#FF9900","#FF6666","#CC0033"],N=$(),y=$(""),I=async()=>{if(_.detaliParams.rtype=1,_.detaliParams.rtype==0)await R(0),d.value.forEach(t=>{t.type=="chart"&&t.dataName=="assetType"&&(t.value.data.series[0].data=Object.entries(_.data.assetType).map(([e,u],c)=>({value:u,name:e}))),t.type=="table"&&t.dataName=="baseInfo"&&(t.value.body=_.data.baseInfo.map(e=>t.value.tableHeaderValue.map(u=>e[u])))}),N.value=d.value,y.value=_.detaliParams.name+"_资产信息表";else if(_.detaliParams.rtype==1){await R(1),y.value=_.detaliParams.name+"_审计信息表";const t=_.data;d.value.forEach(e=>{var u,c,h,L,k,S,n,s,p,m,f,x,P,J,q,H,W,Q,Y,X,Z,ee,ae,te,oe,ne,se,le,re,ue,ie,de,ce;e.type=="chart"&&(e.dataName=="secureCountPojo"&&(e.value.data.series[0].data=j.map((a,v)=>{const i=`e${v+1}`;return{value:t.secureCountPojo[i]==0||t.secureCountPojo[i]==null?null:t.secureCountPojo[i],name:a,itemStyle:{color:g[v]}}})),e.dataName=="secureCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data=(c=(u=t.secureCountPojo)==null?void 0:u.typeCountPojoList)==null?void 0:c.map(a=>a.tname),e.value.data.series[0].data=(L=(h=t.secureCountPojo)==null?void 0:h.typeCountPojoList)==null?void 0:L.map(a=>a.tcount)),e.dataName=="secureCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(S=(k=t.secureCountPojo)==null?void 0:k.dayCountPojoList)==null?void 0:S.map(a=>z(0,a.date)),e.value.data.series[0].data=(s=(n=t.secureCountPojo)==null?void 0:n.dayCountPojoList)==null?void 0:s.map(a=>a.dailycount)),e.dataName=="auditCountPojo"&&(e.value.data.series[0].data=j.map((a,v)=>{const i=`e${v+1}`;return{value:t.auditCountPojo[i]==0||t.auditCountPojo[i]==null?null:t.auditCountPojo[i],name:a,itemStyle:{color:g[v]}}})),e.dataName=="auditCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data=(m=(p=t.auditCountPojo)==null?void 0:p.typeCountPojoList)==null?void 0:m.map(a=>a.tname),e.value.data.series[0].data=(x=(f=t.auditCountPojo)==null?void 0:f.typeCountPojoList)==null?void 0:x.map(a=>a.tcount)),e.dataName=="auditCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(J=(P=t.auditCountPojo)==null?void 0:P.dayCountPojoList)==null?void 0:J.map(a=>z(0,a.date)),e.value.data.series[0].data=(H=(q=t.auditCountPojo)==null?void 0:q.dayCountPojoList)==null?void 0:H.map(a=>a.dailycount)),e.dataName=="alarmCountPojo"&&(e.value.data.series[0].data=j.map((a,v)=>{const i=`e${v+1}`;return{value:t.alarmCountPojo[i]==0||t.alarmCountPojo[i]==null?null:t.alarmCountPojo[i],name:a,itemStyle:{color:g[v]}}})),e.dataName=="alarmCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data=(Q=(W=t.alarmCountPojo)==null?void 0:W.typeCountPojoList)==null?void 0:Q.map(a=>a.tname),e.value.data.series[0].data=(X=(Y=t.alarmCountPojo)==null?void 0:Y.typeCountPojoList)==null?void 0:X.map(a=>a.tcount)),e.dataName=="alarmCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(ee=(Z=t.alarmCountPojo)==null?void 0:Z.dayCountPojoList)==null?void 0:ee.map(a=>z(0,a.date)),e.value.data.series[0].data=(te=(ae=t.alarmCountPojo)==null?void 0:ae.dayCountPojoList)==null?void 0:te.map(a=>a.dailycount))),e.type=="table"&&(e.dataName==""&&(e.value.body=[["安全事件",t.e1],["审计事件",t.e3],["告警事件",t.e4]]),e.dataName=="secureCountPojo"&&(e.value.body=j.map((a,v)=>{const i=t.secureCountPojo[`e${v+1}`];return[a,i]})),e.dataName=="secureCountPojo_typeCountPojoList"&&(e.value.body=(ne=(oe=t.secureCountPojo)==null?void 0:oe.typeCountPojoList)==null?void 0:ne.map(a=>[a.tname,a.tcount])),e.dataName=="secureCountPojo_dayCountPojoList"&&(e.value.body=(se=t.secureCountPojo.dayCountPojoList)==null?void 0:se.map(a=>[z(0,a.date),a.dailycount])),e.dataName=="auditCountPojo"&&(e.value.body=j.map((a,v)=>{const i=t.auditCountPojo[`e${v+1}`];return[a,i]})),e.dataName=="auditCountPojo_typeCountPojoList"&&(e.value.body=(re=(le=t.auditCountPojo)==null?void 0:le.typeCountPojoList)==null?void 0:re.map(a=>[a.tname,a.tcount])),e.dataName=="auditCountPojo_dayCountPojoList"&&(e.value.body=(ue=t.auditCountPojo.dayCountPojoList)==null?void 0:ue.map(a=>[z(0,a.date),a.dailycount])),e.dataName=="alarmCountPojo"&&(e.value.body=j.map((a,v)=>{const i=t.alarmCountPojo[`e${v+1}`];return[a,i]})),e.dataName=="alarmCountPojo_typeCountPojoList"&&(e.value.body=(de=(ie=t.alarmCountPojo)==null?void 0:ie.typeCountPojoList)==null?void 0:de.map(a=>[a.tname,a.tcount])),e.dataName=="alarmCountPojo_dayCountPojoList"&&(e.value.body=(ce=t.alarmCountPojo.dayCountPojoList)==null?void 0:ce.map(a=>[z(0,a.date),a.dailycount])))}),N.value=d.value}};$e(w,()=>{w.value&&I()});const C=$();return(t,e)=>{const u=Ze,c=ea,h=aa,L=ta,k=ge,S=ze;return V(),Pe(S,{show:w.value,"onUpdate:show":e[3]||(e[3]=n=>w.value=n),preset:"card",class:"w-1000px reportPreview",style:Re({"background-color":l(T).themeScheme=="dark"?"#001428":"#fff"})},{header:r(()=>[sa,B("span",la,[o(u,{class:"text-32px c-#d63031 cursor-pointer",onClick:e[0]||(e[0]=n=>C.value.toPdf(y.value))})]),B("span",ra,[o(c,{class:"text-32px c-#1e90ff cursor-pointer",onClick:e[1]||(e[1]=n=>C.value.toWord(y.value))})]),B("span",ua,[o(h,{class:"text-32px c-#15703d cursor-pointer",onClick:e[2]||(e[2]=n=>C.value.toExcel(y.value))})])]),default:r(()=>[o(k,{class:"max-h-600px"},{default:r(()=>[o(L,{ref_key:"filePreviewExportRef",ref:C,width:800,data:N.value},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),da=Ee(ia,[["__scopeId","data-v-acdae960"]]),ca={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},pa=B("div",{style:{display:"flex","align-items":"center"}},[B("div",null,"报表实例")],-1),$a=U({name:"reportmanagement_reportlist",__name:"index",setup(b){const T=Ie(),{columns:E,columnChecks:_,data:w,getData:d,loading:R,mobilePagination:j,searchParams:g,resetSearchParams:N}=Je({apiFn:Me,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:n=>!0,renderExpand:n=>o("div",{class:"detailList"},[o(ge,{style:"max-height: 360px"},{default:()=>[C.value.length>0?C.value.map((s,p)=>o(O,{justify:"space-between",style:{marginBottom:"8px",padding:"0px 50px 8px 50px",borderBottom:p!==C.value.length-1?"1px dashed #ccc":"none"},key:s.sn},{default:()=>[o("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[s.sn]),o(O,null,{default:()=>[K(o(A,{type:"info",size:"small",ghost:!0,onClick:()=>L(s.sn,n.rtype)},{default:()=>[D("查看")]}),[[F("no-auth"),"sys.report.instance.select"]]),o(ve,{onPositiveClick:()=>S(s.sn,n.rtype,n.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>K(o(A,{type:"error",size:"small",ghost:!0},{default:()=>[D("删除")]}),[[F("no-auth"),"sys.report.instance.delete"]])})]})]})):o("div",{style:{textAlign:"center",padding:"10px"}},[D("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:n=>{var s;return o("div",null,[(s=Be(Xe).find(p=>p.value===n.rtype))==null?void 0:s.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:G("common.operate"),align:"center",width:160,render:n=>o("div",{class:"flex-center gap-8px"},[o(ve,{onPositiveClick:()=>k(n.tid,n.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>K(o(A,{type:"primary",ghost:!0,size:"small"},{default:()=>[D("清空")]}),[[F("no-auth"),"sys.report.instance.delete"]])})])}]}),y=$([]),I=n=>{y.value=[n[n.length-1]],y.value[0]&&(C.value=[],e())},C=$([]),t=me({page:1,limit:10}),e=async()=>{const n=JSON.parse(JSON.stringify(w.value)).find(m=>m.tid===y.value[0]),{data:s,error:p}=await Ve({tid:y.value[0],page:t.page,limit:Number(n.num)||10});p||(C.value=s.list,Ke(()=>{const m=document.querySelector(".detailList");if(m){const{height:f}=m.getBoundingClientRect();m.animate([{height:"0px"},{height:`${f}px`}],{duration:300,easing:"linear"})}}))},u=$(!1),c=$({}),h=me({name:"",rtype:0}),L=async(n,s)=>{var f;const{data:p,error:m}=await Ue({name:n,type:s,tid:y.value[0]});h.name=n,h.rtype=s,m||(u.value=!0,c.value=JSON.parse(p),c.value.baseInfo=(f=c.value.baseInfo)==null?void 0:f.map(x=>({...x,dbtime:z(1,x.dbtime)})))},k=async(n,s)=>{var f;const{data:p,error:m}=await fe({tid:n,type:s});m||((f=window.$message)==null||f.success("清空成功"),C.value=[],d())},S=async(n,s,p)=>{var x;const{data:m,error:f}=await fe({fname:n,type:s,tid:p});f||((x=window.$message)==null||x.success("删除成功"),d(),e())};return(n,s)=>{const p=xe,m=he,f=Oe,x=je;return V(),Ae("div",ca,[o(oa,{model:l(g),"onUpdate:model":s[0]||(s[0]=P=>_e(g)?g.value=P:null),onReset:l(N),onSearch:l(d)},null,8,["model","onReset","onSearch"]),o(x,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:r(()=>[pa]),"header-extra":r(()=>[o(l(O),null,{default:r(()=>[o(l(A),{size:"small",onClick:s[1]||(s[1]=P=>l(d)())},{icon:r(()=>[o(p,{class:Fe(["text-icon",{"animate-spin":l(R)}])},null,8,["class"])]),default:r(()=>[D(" "+M(l(G)("common.refresh")),1)]),_:1}),o(m,{columns:l(_),"onUpdate:columns":s[2]||(s[2]=P=>_e(_)?_.value=P:null)},null,8,["columns"])]),_:1})]),default:r(()=>[o(f,{columns:l(E),data:l(w),size:"small","flex-height":!l(T).isMobile,"scroll-x":962,loading:l(R),remote:"","row-key":P=>P.tid,pagination:l(j),class:"sm:h-full","expanded-row-keys":y.value,"onUpdate:expandedRowKeys":I},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),o(da,{visible:u.value,"onUpdate:visible":s[3]||(s[3]=P=>u.value=P),data:c.value,detaliParams:h},null,8,["visible","data","detaliParams"])]),_:1})])}}});export{$a as default};
