import{_ as me}from"./round-add-C39zxNhK.js";import{d as Y,aq as H,s as te,r as q,q as ae,a as fe,ar as J,a1 as G,c as U,o as h,w as t,f as e,F as Q,y as A,z as ne,h as o,at as oe,A as O,N as W,B as P,g as C,t as b,$ as E,b6 as _e,p as le,bY as ve,c1 as ge,x as K,as as ye,C as R,e as v,b as V,T as be,E as se,c2 as he,a5 as we,a4 as xe,aw as je,U as re,L as ke,i as Se,az as Z,c3 as Ce,av as De,aC as Pe}from"./index-CKR2IDhL.js";import{f as ie,Y as Ne,Z as ze,_ as Ie,$ as Te,a0 as $e,a1 as Ue,a2 as Le}from"./project-u8e2XwXH.js";import{u as Me,a as Be}from"./table-DL4dTkzV.js";import{u as ce}from"./usePageData-2V6Iaoub.js";import{_ as Fe}from"./Avatar-BDKFFbYy.js";import{_ as Ee}from"./text-CNMhau8K.js";import{N as de}from"./Popconfirm-qcN6-Wmq.js";import{_ as Re}from"./round-search-Bcuze01M.js";import{_ as qe}from"./Grid-C0u5attG.js";import{_ as Oe}from"./FormItemGridItem-t2jnramH.js";const Ve=Y({name:"OperateDrawer",__name:"operate-drawer",props:H({operateType:{},rowData:{},pid:{},prjId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(x,{emit:B}){const l=B,m=x,a=te(j());function j(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pids:[]}}const N={pids:{type:"array",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施"}},f=q(),{pageData:p,getData:F,nextPage:z}=ce(ie),k=async r=>{const s=r.currentTarget;s.scrollTop+s.offsetHeight>=s.scrollHeight&&p.data.length<p.total&&z()},I=async r=>{r?f.value=r:a.value.pid=null},L=async()=>{var r;if(await F(),p.data.length==0)return(r=window.$message)==null?void 0:r.warning("没有项目")};async function u(){f.value=null,Object.assign(a,j()),await L(),console.log(m.prjId,"sssssssssssssss"),m.prjId&&(f.value=m.prjId),m.pid&&(p.data.forEach(r=>{r.id==m.pid&&(r.disabled=!0)}),a.pids=[m.pid]),m.operateType==="edit"&&m.rowData&&Object.assign(a,m.rowData)}const{formRef:n,validate:w,restoreValidation:g}=ae(),M=fe(()=>({add:"新增项目总结",edit:"修改项目总结"})[m.operateType]),S=J(x,"visible"),T=()=>{S.value=!1},$=async()=>{var r,s;if(await w(),m.operateType==="edit"){const{data:i,error:c}=await Ne([{...a}]);c||((r=window.$message)==null||r.success("修改成功"),l("submitted"),T())}else{const i=a.pids.map(_=>({pid:_}));i.forEach(_=>{_.content1=a.content1,_.content2=a.content2,_.content3=a.content3,_.content4=a.content4,_.content5=a.content5});const{data:c,error:d}=await ze(i);d||((s=window.$message)==null||s.success("添加成功"),l("submitted"),T())}};return G(S,()=>{S.value&&(u(),setTimeout(()=>{const r=document.querySelector(".n-scrollbar-content");r==null||r.scrollTo(0,0)},300),g())}),(r,s)=>{const i=ne,c=Q,d=W,_=_e;return h(),U(_,{show:S.value,"onUpdate:show":s[6]||(s[6]=y=>S.value=y),title:M.value,preset:"card",class:"w-570px"},{footer:t(()=>[e(d,{justify:"end"},{default:t(()=>[e(o(P),{size:"small",class:"mt-16px",onClick:T},{default:t(()=>[C(b(o(E)("common.cancel")),1)]),_:1}),e(o(P),{type:"primary",size:"small",class:"mt-16px",onClick:$},{default:t(()=>[C(b(o(E)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(c,{ref_key:"formRef",ref:n,model:a,rules:N},{default:t(()=>[m.operateType==="add"?(h(),U(i,{key:0,label:"项目",path:"pids","label-placement":"left"},{default:t(()=>[e(o(oe),{clearable:"",multiple:"",filterable:"",value:a.pids,"onUpdate:value":[s[0]||(s[0]=y=>a.pids=y),I],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:o(p).data,onScroll:k},null,8,["value","options"])]),_:1})):A("",!0),e(i,{label:"前期准备阶段描述",path:"content1"},{default:t(()=>[e(o(O),{clearable:"",type:"textarea",value:a.content1,"onUpdate:value":s[1]||(s[1]=y=>a.content1=y),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),e(i,{label:"遇到问题及对项目的影响",path:"content2"},{default:t(()=>[e(o(O),{clearable:"",type:"textarea",value:a.content2,"onUpdate:value":s[2]||(s[2]=y=>a.content2=y),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),e(i,{label:"经验教训与改进方案或措施",path:"content3"},{default:t(()=>[e(o(O),{clearable:"",type:"textarea",value:a.content3,"onUpdate:value":s[3]||(s[3]=y=>a.content3=y),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(i,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:t(()=>[e(o(O),{clearable:"",type:"textarea",value:a.content4,"onUpdate:value":s[4]||(s[4]=y=>a.content4=y),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(i,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:t(()=>[e(o(O),{clearable:"",type:"textarea",value:a.content5,"onUpdate:value":s[5]||(s[5]=y=>a.content5=y),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ae={class:"mt-4 border-t pt-3"},Ke={class:"flex items-start gap-2 mb-3"},He={class:"ml-2 flex-1"},Ge={class:"flex items-center"},Ye={class:"font-medium font-size-16px font-bold"},Ze={class:"text-gray-600 mt-1"},Je=Y({name:"drawerLog",__name:"drawerLog",props:H({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(x){const B=le();ve();const l=te({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""}),m=x,a={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},j=q({});async function N(){f.value=[],Object.assign(l,m.rowData),k()}const f=q([]),p=J(x,"visible");G(p,()=>{p.value?N():(f.value=[],l.id=void 0)});function F(u){u||z()}function z(){p.value=!1}const k=async()=>{const{data:u,error:n}=await Te({page:1,limit:100,pid:l.id});u&&(f.value=u.list)},I=ge.debounce(async()=>{var g;const u=j.value[l.id];if(!(u!=null&&u.trim()))return(g=window.$message)==null?void 0:g.warning("请输入评论内容");const{data:n,error:w}=await Ie([{pid:l.id,content:u}]);n&&(j.value[l.id]="",l.num++,k())},1e3,{leading:!0,trailing:!1}),L=async u=>{var g;const{data:n,error:w}=await $e(u.id);n&&(k(),l.num--,(g=window.$message)==null||g.success("删除成功"))};return(u,n)=>{const w=ne,g=Q,M=Fe,S=Ee,T=ye,$=je,r=K("i"),s=K("no-auth");return h(),U($,{show:p.value,"onUpdate:show":[n[1]||(n[1]=i=>p.value=i),F],"display-directive":"show",width:600,onMaskClick:z,onEsc:z},{default:t(()=>[e(T,{title:l.username+"的项目总结","native-scrollbar":!1,closable:""},{default:t(()=>[e(g,{ref:"formRef",model:l},{default:t(()=>[e(w,{label:"",path:"contractname"},{label:t(()=>n[2]||(n[2]=[v("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:t(()=>[v("span",null,b(l.proname),1)]),_:1}),e(w,{label:"前期准备阶段描述",path:"content1"},{label:t(()=>n[3]||(n[3]=[v("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:t(()=>[v("span",null,b(l.content1),1)]),_:1}),e(w,{label:"遇到问题及对项目的影响",path:"content2"},{label:t(()=>n[4]||(n[4]=[v("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:t(()=>[v("span",null,b(l.content2),1)]),_:1}),e(w,{label:"经验教训与改进方案或措施",path:"content3"},{label:t(()=>n[5]||(n[5]=[v("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:t(()=>[v("span",null,b(l.content3),1)]),_:1}),e(w,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:t(()=>n[6]||(n[6]=[v("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:t(()=>[v("span",null,b(l.content4),1)]),_:1}),e(w,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:t(()=>n[7]||(n[7]=[v("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:t(()=>[v("span",null,b(l.content5),1)]),_:1})]),_:1},8,["model"]),R((h(),V("div",null,[C(b(l.num)+"评论",1)])),[[r,l.num]]),e(be,{name:"fade"},{default:t(()=>[v("div",Ae,[R((h(),V("div",Ke,[v("div",null,[e(M,{size:"small",src:a.avatar},null,8,["src"])]),e(o(O),{type:"textarea",id:`comment-input-${l.id}`,value:j.value[l.id],"onUpdate:value":n[0]||(n[0]=i=>j.value[l.id]=i),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:se(he(o(I),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),e(o(P),{type:"primary",ghost:"",onClick:o(I)},{default:t(()=>n[8]||(n[8]=[C("发送")])),_:1,__:[8]},8,["onClick"])])),[[s,"project:Summary:Comment:insert"]]),(h(!0),V(we,null,xe(f.value,i=>(h(),V("div",{key:i.id,class:"flex mb-3"},[e(M,{size:"small",src:a.avatar},null,8,["src"]),v("div",He,[v("div",Ge,[v("span",Ye,b(i.username),1),e(S,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:t(()=>[C(b(i.dbtime),1)]),_:2},1024),o(B).userInfo.id==i.creater?(h(),U(o(de),{key:0,onPositiveClick:c=>L(i)},{trigger:t(()=>[R((h(),U(o(P),{quaternary:"",type:"error",size:"small"},{default:t(()=>n[9]||(n[9]=[C(" 删除 ")])),_:1,__:[9]})),[[s,"project:Summary:Comment:delete"]])]),default:t(()=>[n[10]||(n[10]=C(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):A("",!0)]),v("div",Ze,b(i.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Qe=Y({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:H(["reset","search","clear"],["update:model"]),setup(x,{emit:B}){const l=B,{formRef:m}=ae(),a=J(x,"model"),j=q(),N=q([]),{pageData:f,getData:p,nextPage:F}=ce(ie),z=async u=>{const n=u.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&f.data.length<f.total&&(F(),N.value=f.data)},k=async u=>{u?(a.value.pid=u,l("search")):(a.value.pid=null,l("search"))};(async()=>{await p(),N.value=f.data})();async function L(){l("search")}return(u,n)=>{const w=oe,g=Oe,M=Re,S=P,T=W,$=qe,r=Q,s=re;return h(),U(s,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(r,{ref_key:"formRef",ref:m,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:se(L,["enter"])},{default:t(()=>[e($,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(g,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:t(()=>[e(w,{clearable:"",filterable:"",value:j.value,"onUpdate:value":[n[0]||(n[0]=i=>j.value=i),k],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:N.value,onScroll:z},null,8,["value","options"])]),_:1}),e(g,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(T,{class:"w-full"},{default:t(()=>[e(S,{type:"primary",ghost:"",onClick:L},{icon:t(()=>[e(M,{class:"text-icon"})]),default:t(()=>[C(" "+b(o(E)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),We={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Xe={key:0};function ee(x){return typeof x=="function"||Object.prototype.toString.call(x)==="[object Object]"&&!Pe(x)}const ut=Y({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(x,{emit:B}){const l=ke(),m=le(),a=x,j=B,{columns:N,data:f,getData:p,loading:F,mobilePagination:z,searchParams:k}=Me({showTotal:!0,immediate:!1,apiFn:Ue,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:c=>e("div",null,[c.username+"的项目总结"])},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:E("common.operate"),align:"center",width:140,fixed:"right",render:c=>{let d;return e("div",{class:"flex-center gap-8px"},[e(P,{type:"primary",ghost:!0,size:"small",onClick:()=>s(c)},{default:()=>[C("查看详情")]}),m.userInfo.id==c.creater&&R(e(P,{type:"primary",ghost:!0,size:"small",onClick:()=>T(c.id)},ee(d=E("common.edit"))?d:{default:()=>[d]}),[[K("no-auth"),"project:Summary:update"]]),m.userInfo.id==c.creater&&e(de,{onPositiveClick:()=>S(c.id)},{default:()=>E("common.confirmDelete"),trigger:()=>{let _;return R(e(P,{type:"error",ghost:!0,size:"small"},ee(_=E("common.delete"))?_:{default:()=>[_]}),[[K("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:I,operateType:L,editingData:u,handleAdd:n,handleEdit:w,checkedRowKeys:g,onDeleted:M}=Be(f,p);async function S(c){const{data:d,error:_}=await Le(c);_||M()}function T(c){w(c)}const $=q(!1),r=q({}),s=c=>{$.value=!0,r.value=c},i=()=>{p()};return G(()=>a.pid,async c=>{c&&(k.pid=c,await p())}),G(()=>f.value,async c=>{c.length>0?j("thereIsData",1):j("thereIsData",0)}),Se(()=>{a.type!="externalLiaison"&&p()}),(c,d)=>{const _=W,y=me,ue=De,pe=re,X=K("no-auth");return h(),V("div",We,[a.pid?A("",!0):(h(),U(Qe,{key:0,model:o(k),"onUpdate:model":d[0]||(d[0]=D=>Z(k)?k.value=D:null),onReset:i,onSearch:o(p),onClear:d[1]||(d[1]=D=>f.value=[])},null,8,["model","onSearch"])),e(pe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Ce({header:t(()=>[e(_,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[a.pid?A("",!0):(h(),V("div",Xe,"项目总结"))]),_:1}),a.pid?R((h(),U(o(P),{key:0,onClick:o(n),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(y,{class:"text-icon"})]),default:t(()=>[d[5]||(d[5]=C(" "+b("新增")))]),_:1,__:[5]},8,["onClick"])),[[X,"project:Summary:insert"]]):A("",!0)]),default:t(()=>[e(ue,{"checked-row-keys":o(g),"onUpdate:checkedRowKeys":d[2]||(d[2]=D=>Z(g)?g.value=D:null),columns:o(N),data:o(f),size:"small","flex-height":!o(l).isMobile,loading:o(F),remote:"","row-key":D=>D.id,pagination:o(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ve,{visible:o(I),"onUpdate:visible":d[3]||(d[3]=D=>Z(I)?I.value=D:null),onSubmitted:o(p),"operate-type":o(L),prjId:a.prjId,pid:a.pid,"row-data":o(u)},null,8,["visible","onSubmitted","operate-type","prjId","pid","row-data"]),e(Je,{visible:$.value,"onUpdate:visible":d[4]||(d[4]=D=>$.value=D),"row-data":r.value},null,8,["visible","row-data"])]),_:2},[a.pid?void 0:{name:"header-extra",fn:t(()=>[e(_,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[R((h(),U(o(P),{onClick:o(n),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(y,{class:"text-icon"})]),default:t(()=>[d[6]||(d[6]=C(" "+b("新增")))]),_:1,__:[6]},8,["onClick"])),[[X,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{ut as _};
