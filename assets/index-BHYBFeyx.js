import{d as b,_ as j}from"./debounce-CkiqoS6t.js";import{_ as z}from"./round-search-CZR-1APx.js";import{d as U,r as q,a$ as D,j as p,aa as E,y as G,o as N,e as J,g as i,w as u,h,i as w,B as C,ae as I,t as S,z as P,c as A,ej as H,bI as L,ek as Q,ar as W,O as F,as as R,a5 as X,aQ as y,an as Y,S as Z}from"./index-DrKdOclc.js";import{_ as K}from"./DatePicker-DAZ241cA.js";const ee={class:"min-h-500px flex-col-stretch gap-16px lt-sm:overflow-auto"},ae=U({name:"stationmanagement_reportingdatarestrictions",__name:"index",setup(te){const _=q({dateTime:D(0,Date.now()),type:1}),c=(e,n,t,l)=>{const a=e[n];if(!(a!=null&&a.dbtime))return null;const r=b(s=>{a[t]=s,!(t==="maxValue"&&a.minValue&&s<a.minValue&&s)&&t==="minValue"&&a.maxValue&&s>a.maxValue},300);return a[l]?y(Y,{value:a[t],onUpdateValue:r,status:a.maxValue&&a.minValue&&a.maxValue<a.minValue?"error":"success",onBlur:()=>{a.maxValue&&a.minValue&&a.maxValue<a.minValue||(a[l]=!1)},min:1,max:k.value}):y("span",{style:{cursor:"pointer",width:"100%",display:"inline-block",height:"40px",lineHeight:"40px"},onClick:()=>{a[l]=!0,setTimeout(()=>{const s=document.querySelectorAll("input");s.length&&s[s.length-1].focus()},0)}},a[t]||y("span",{style:{color:"rgba(194, 194, 194,.7)",fontSize:"12px"}},"未设置"))},T=[{title:"时间",key:"dbtime",render:e=>{var n;return i("span",null,[(n=e[0])==null?void 0:n.dbtime])}},{title:"上限值",key:"maxValue",render:e=>c(e,0,"maxValue","isedit"),className:"inputInt"},{title:"下限值",key:"minValue",render:e=>c(e,0,"minValue","isedit1"),className:"inputInt"},{title:"时间",key:"key",render:e=>{var n;return i("span",null,[(n=e[1])==null?void 0:n.dbtime])}},{title:"上限值",key:"value",minWidth:180,render:e=>c(e,1,"maxValue","isedit"),className:"inputInt"},{title:"下限值",key:"value",render:e=>c(e,1,"minValue","isedit1"),className:"inputInt"},{title:"时间",key:"key",render:e=>{var n;return i("span",null,[(n=e[2])==null?void 0:n.dbtime])}},{title:"上限值",key:"maxValue",render:e=>c(e,2,"maxValue","isedit"),className:"inputInt"},{title:"下限值",key:"minValue",render:e=>c(e,2,"minValue","isedit1"),className:"inputInt"}],k=p(0);(async()=>{const{data:e,error:n}=await H({_t:new Date().getTime()});n||(k.value=e.maxeqmt)})();const m=p(!1);let d=p([]);const g=p([]),f=async()=>{m.value=!0,d.value=[];const{data:e,error:n}=await L({date:_.dateTime});if(!n){g.value=JSON.parse(JSON.stringify(e)),e.forEach(t=>{t.maxValue=t.maxValue?t.maxValue:null,t.minValue=t.minValue?t.minValue:null,t.isedit=!1,t.isedit1=!1});for(let t=0;t<e.length;t+=3)d.value.push(e.slice(t,t+3));m.value=!1}};f();const B=e=>{_.dateTime=D(0,e),f()},M=async()=>{var a,r,s;let e=d.value.flat();const n=new Map;if(g.value.forEach(o=>{n.set(o.id,[o.maxValue,o.minValue])}),e=e.filter(o=>{const V=n.get(o.id);return V[0]!==o.maxValue&&o.maxValue!==null||V[1]!==o.minValue&&o.minValue!==null}),e.some(o=>o.isedit1||o.isedit))return(a=window.$message)==null?void 0:a.warning("请填写符合逻辑的数据");if(e.length==0)return(r=window.$message)==null?void 0:r.warning("请填写数据");const{data:t,error:l}=await Q(e);l||((s=window.$message)==null||s.success("设置成功"),f())},v=p(!1),O=b(e=>{let n=e==null?void 0:e.flat();const t=new Map;g.value.forEach(l=>{t.set(l.id,[l.maxValue,l.minValue])}),n=n.filter(l=>{const a=t.get(l.id);return a[0]!==l.maxValue&&l.maxValue!==null||a[1]!==l.minValue&&l.minValue!==null}),v.value=n.length>0},300);return E(()=>d.value,e=>{O(e)},{deep:!0}),(e,n)=>{const t=K,l=z,a=W,r=F,s=j,o=R,V=X,$=G("no-auth");return N(),J("div",ee,[i(V,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:u(()=>[i(r,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:u(()=>[h(" 上报数据限制 "),i(a,null,{default:u(()=>[i(t,{"formatted-value":_.dateTime,"onUpdate:formattedValue":n[0]||(n[0]=x=>_.dateTime=x),"value-format":"yyyy-MM-dd",type:"date","onUpdate:value":B,style:{width:"200px"}},null,8,["formatted-value"]),i(w(C),{type:"primary",ghost:"",onClick:f},{icon:u(()=>[i(l,{class:I(["text-icon",{"animate-spin":m.value}])},null,8,["class"])]),default:u(()=>[h(" "+S(e.$t("common.search")),1)]),_:1})]),_:1})]),_:1})]),"header-extra":u(()=>[i(r,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:u(()=>[P((N(),A(w(C),{onClick:M,ghost:"",type:"primary",disabled:!v.value},{icon:u(()=>[i(s,{class:I(["text-icon",{"animate-spin":m.value}])},null,8,["class"])]),default:u(()=>[h(" "+S(e.$t("common.save")),1)]),_:1},8,["disabled"])),[[$,"power.update"]])]),_:1})]),default:u(()=>[i(o,{columns:T,data:w(d),bordered:!1,"flex-height":!0,class:"sm:h-full","row-key":x=>x.id,loading:m.value},null,8,["data","row-key","loading"])]),_:1})])}}}),ue=Z(ae,[["__scopeId","data-v-502919b3"]]);export{ue as default};
