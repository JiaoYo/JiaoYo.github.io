import{d as E,m as J,H as N,i as L,r as W,n as H,p as Q,b as y,o as _,f as a,w as s,h as e,T as X,W as j,C,A as U,N as p,y as Z,e as g,c as Y,s as ee,aX as ae,aI as le,fe as se,t as f,aM as oe,g as b,$ as r,v as h,B as $,Z as ne,a0 as te,a1 as re,ff as ue,aQ as de,fg as pe,fh as ie,F as ce,fi as me,M as fe}from"./index-B5bfYqYu.js";const we={class:"profile-wrapper"},_e={class:"avatar-wrapper group"},ge={key:1,class:"upload-wrapper"},ve={class:"font-size-16px"},ye={key:1,class:"c-#a19f9d"},be=E({name:"userinfo",__name:"index",setup(he){const k=J(),o=N({id:"",username:"",nickname:"",phnum:"",userimage:"",usertype:""}),I=async()=>{const{data:d,error:l}=await ue();l||Object.assign(o.value,d)};L(()=>{I()});async function A(d){var c,m,w;const l=d.file.file.size/1024/1024<100;return["image/jpeg","image/png","image/jpg","image/x-icon"].includes(d.file.file.type)?l?!0:((w=window.$message)==null||w.error("文件大小不能超过100M"),!1):((c=window.$message)==null||c.destroyAll(),(m=window.$message)==null||m.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1)}async function q({file:d}){var u,i,c;const l=await de(d.file,d.name,"");if(l){Object.prototype.hasOwnProperty.call(l,"result")?(u=window.$message)==null||u.destroyAll():console.log("文件上传成功");const{data:m,error:w}=await pe({id:o.value.id,image:l});w||((i=window.$message)==null||i.destroyAll(),(c=window.$message)==null||c.success("头像修改成功"),k.setUserImage(l),I())}}const P=N(!1),v=N({pwd:""}),M=async()=>{var u;const{data:d,error:l}=await ie({pwd:ce(v.value.pwd)});l||(R(),(u=window.$message)==null||u.success("解绑成功"))},F=()=>{P.value=!0,v.value.pwd=""},R=()=>{P.value=!1},n=W(V());function V(){return{username:k.userInfo.username,pwd:"",newPwd:"",comfirmPassword:""}}const{formRef:S,validate:z}=H(),{createConfirmPwdRule:G,defaultRequiredRule:T,patternRules:K}=Q(),B={pwd:T,newPwd:{...T,...K.password}};async function x(){var u,i;await z();const{data:d,error:l}=await me(n.username,n.pwd,n.newPwd,k.userInfo.id);l||((u=window.$message)==null||u.destroyAll(),(i=window.$message)==null||i.success("密码修改成功, 即将返回登录页"),setTimeout(()=>{k.resetStore()},1e3))}return(d,l)=>{const u=ae,i=le,c=se,m=Z,w=oe,O=te,D=re;return _(),y("div",we,[a(e(ne),{class:"card"},{default:s(()=>[a(e(X),{type:"segment",animated:""},{default:s(()=>[a(e(j),{name:"profile",tab:"个人中心"},{default:s(()=>[a(e(C),{model:o.value,"label-placement":"left",style:{width:"400px",margin:"20px auto 0"},"label-width":100,"require-mark-placement":"left",onKeyup:U(x,["enter"])},{default:s(()=>[a(e(p),{label:"头像"},{default:s(()=>[a(m,{justify:"center"},{default:s(()=>[g("div",_e,[o.value.userimage?(_(),Y(u,{key:0,src:o.value.userimage,class:"avatar-img","preview-disabled":""},null,8,["src"])):(_(),y("div",ge,[a(i,{ref:"uploadRef",action:"#","list-type":"picture-card","before-upload":A,"custom-request":q},{default:s(()=>l[7]||(l[7]=[g("div",{class:"upload-inner"},[g("span",null,"点击上传")],-1)])),_:1,__:[7]},512)])),o.value.userimage?(_(),y("div",{key:2,class:"avatar-overlay",onClick:l[0]||(l[0]=t=>o.value.userimage="")},[a(c,{class:"icon-close"})])):ee("",!0)])]),_:1})]),_:1}),a(e(p),{label:"用户名称：",path:"username"},{default:s(()=>[g("div",ve,f(o.value.username),1)]),_:1}),a(e(p),{label:"用户类型：",path:"usertype"},{default:s(()=>[a(w,{type:"info"},{default:s(()=>[b(f(o.value.usertype==0?"超级管理员":o.value.usertype==1?"销售":o.value.usertype==2?"项目负责人":o.value.usertype==3?"调试工程师":o.value.usertype==4?"综合管理":o.value.usertype==5?"研发工程师":o.value.usertype==6?"生产工程师":""),1)]),_:1})]),_:1}),a(e(p),{label:"联系方式：",path:"phnum"},{default:s(()=>[g("div",null,f(o.value.phnum),1)]),_:1}),a(e(p),{label:"微信昵称：",path:"nickname"},{default:s(()=>[g("div",null,[b(f(o.value.nickname)+" ",1),o.value.nickname?(_(),y("span",{key:0,class:"ml-20px cursor-pointer c-red",onClick:F},"解绑")):(_(),y("span",ye,"未绑定"))])]),_:1})]),_:1},8,["model"])]),_:1}),a(e(j),{name:"password",tab:"修改密码"},{default:s(()=>[a(e(C),{ref_key:"formRef",ref:S,model:n,rules:B,"label-placement":"left",style:{width:"400px",margin:"20px auto 0"},"label-width":100,"require-mark-placement":"left",onKeyup:U(x,["enter"])},{default:s(()=>[a(e(p),{label:e(r)("page.manage.user.username"),path:"username"},{default:s(()=>[a(e(h),{readonly:"",value:n.username,"onUpdate:value":l[1]||(l[1]=t=>n.username=t),placeholder:e(r)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(p),{label:e(r)("page.login.common.oldPassword"),path:"pwd"},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:n.pwd,"onUpdate:value":l[2]||(l[2]=t=>n.pwd=t),placeholder:e(r)("page.login.common.oldPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(p),{label:e(r)("page.login.common.password"),path:"newPwd"},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:n.newPwd,"onUpdate:value":l[3]||(l[3]=t=>n.newPwd=t),placeholder:e(r)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(p),{label:e(r)("page.login.common.confirmPassword"),path:"comfirmPassword",rule:e(G)(n.newPwd)},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:n.comfirmPassword,"onUpdate:value":l[4]||(l[4]=t=>n.comfirmPassword=t),placeholder:e(r)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rule"]),a(m,{justify:"center",size:16},{default:s(()=>[a(e($),{type:"primary",onClick:x},{default:s(()=>[b(f(e(r)("common.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),a(D,{show:P.value,"onUpdate:show":l[6]||(l[6]=t=>P.value=t),title:"解绑微信",preset:"card",class:"w-500px"},{footer:s(()=>[a(m,{justify:"end",size:16},{default:s(()=>[a(e($),{onClick:R},{default:s(()=>[b(f(e(r)("common.cancel")),1)]),_:1}),a(e($),{type:"primary",onClick:M},{default:s(()=>[b(f(e(r)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(O,null,{default:s(()=>[a(e(C),{ref_key:"formRef",ref:S,model:v.value,rules:B,"label-placement":"left","require-mark-placement":"left",onKeyup:U(M,["enter"])},{default:s(()=>[a(e(p),{label:e(r)("page.login.common.password"),path:"pwd"},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:v.value.pwd,"onUpdate:value":l[5]||(l[5]=t=>v.value.pwd=t),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}}),Pe=fe(be,[["__scopeId","data-v-b0d96528"]]);export{Pe as default};
