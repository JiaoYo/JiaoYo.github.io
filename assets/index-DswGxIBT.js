import{_ as ve}from"./round-add-B_10irHU.js";import{d as re,av as _e,X as he,Y as Te,A as we,at as ke,z as ie,s as h,aK as De,i as ue,aS as u,au as Se,c as S,o as v,a2 as de,w as l,f as n,M as be,L as xe,ay as Ce,G as j,aB as Ne,g as T,h as i,J as me,B as N,t as ee,$ as U,cC as je,aE as ae,aT as Pe,cU as Re,cV as ne,cW as ze,cX as Be,aJ as Me,F as Q,b as oe,aL as Z,cY as Ue,I as G,ax as Le,aR as Ve}from"./index-9Ko_9_TI.js";import{_ as He,d as Ie,f as $e,a as qe}from"./drawerLog-BBU0PvSn.js";import{u as Fe,a as Ge}from"./table-BtCxAkgO.js";import{_ as Ee}from"./round-search-BEVIxLnz.js";import{u as le}from"./usePageData-BWaYhHgw.js";import{_ as Ke}from"./Grid-C4COR-OK.js";import{_ as We}from"./FormItemGridItem-BlsYHznD.js";import{_ as Ye}from"./RadioButton-BH8aJiOr.js";import{_ as Ae}from"./DatePicker-DdutLwK7.js";import{N as Oe}from"./Popconfirm-Cg-J5jDB.js";import"./text-DaVxhp6G.js";const Je=re({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:_e(["reset","search","clear","setPname"],["update:model"]),setup(w,{emit:te}){const c=he(),L=Te(),d=te,{formRef:E}=we(),a=ke(w,"model");ie();const p=h([]),{pageData:y,getData:b,nextPage:x}=le(je),P=async t=>{const e=t.currentTarget,o=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&y.data.length<y.total&&(await x(),p.value=y.data,await ae(),setTimeout(()=>{e.scrollTop=o}))},{pageData:R,getData:K,nextPage:V}=le(Pe),W=async t=>{const e=t.currentTarget,o=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&R.data.length<R.total&&(await V(),await ae(),setTimeout(()=>{e.scrollTop=o}))},z=async t=>{a.value.creater=t,d("search")},Y=async t=>{var e;k.value=!0,t&&(a.value.pid=t),d("search"),d("setPname",((e=p.value.find(o=>o.id==t))==null?void 0:e.proname)||"")},A=De.debounce(async t=>{await b({fuzzy:t,page:1}),p.value=y.data},300),B=h(!1),k=h(!1),H=t=>{if(a.value.pid=null,B.value=!0,k.value=!1,!t){I();return}A(t)},O=async()=>{B.value&&!k.value&&(await b({page:1}),p.value=y.data,B.value=!1)},I=async()=>{await b({page:1}),p.value=y.data},$=async()=>{await b(),p.value=y.data,a.value.pid=c.query.prjId?Number(c.query.prjId):void 0,a.value.fuzzy=c.query.pname?c.query.pname:"",_.value=c.query.prjId&&c.query.pname?"all":"day",d("search"),setTimeout(()=>{L.replace({path:c.path,query:{}})},10)};K({usertypes:"2,3"}),ue(async()=>{if(!c.query.prjId&&!c.query.pname){const t=new Date;if(t.getHours()<18){const e=new Date;e.setDate(t.getDate()-1),e.setHours(0,0,0,0),m.value.dayTime=String(u(0,e.getTime())),a.value.statrtTime=String(u(0,e.getTime()))+" 00:00:00",a.value.endTime=String(u(0,e.getTime()+24*60*60*1e3))+" 00:00:00"}else{const e=new Date;e.setHours(0,0,0,0),m.value.dayTime=String(u(0,e.getTime())),a.value.statrtTime=String(u(0,e.getTime()))+" 00:00:00",a.value.endTime=String(u(0,e.getTime()+24*60*60*1e3))+" 00:00:00"}}await $()}),Se(()=>c,async t=>{t.prjId&&t.pname&&q("all")},{immediate:!0});const m=h({dayTime:null,weekTime:null,monthTime:null}),r=async t=>{a.value.statrtTime=String(u(0,t))+" 00:00:00",a.value.endTime=String(u(0,new Date(t).getTime()+24*60*60*1e3))+" 00:00:00",d("search")},s=async t=>{const{monday:e,sunday:o}=Re(t);a.value.statrtTime=e,a.value.endTime=u(0,new Date(o).getTime()+24*60*60*1e3),d("search")},g=async t=>{const{start:e,end:o}=ne(t);a.value.statrtTime=e,a.value.endTime=u(0,new Date(o).getTime()+24*60*60*1e3),d("search")};async function M(){d("search")}const _=h("day"),q=async t=>{if(t=="day"){const e=new Date;if(e.getHours()<18){const o=new Date;o.setDate(e.getDate()-1),o.setHours(0,0,0,0),m.value.dayTime=String(u(0,o.getTime())),a.value.statrtTime=String(u(0,o.getTime()))+" 00:00:00",a.value.endTime=String(u(0,o.getTime()+24*60*60*1e3))+" 00:00:00"}else{const o=new Date;o.setHours(0,0,0,0),m.value.dayTime=String(u(0,o.getTime())),a.value.statrtTime=String(u(0,o.getTime()))+" 00:00:00",a.value.endTime=String(u(0,o.getTime()+24*60*60*1e3))+" 00:00:00"}}else if(t=="week"){m.value.weekTime=ze();const{start:e,end:o}=Be(new Date().getTime());a.value.statrtTime=e,a.value.endTime=u(0,new Date(o).getTime()+24*60*60*1e3)}else if(t=="month"){let e=function(){const D=new Date,J=D.getFullYear(),X=(D.getMonth()+1).toString().padStart(2,"0");return`${J}-${X}`};m.value.monthTime=e();const{start:o,end:C}=ne(m.value.monthTime);a.value.statrtTime=o,a.value.endTime=u(0,new Date(C).getTime()+24*60*60*1e3)}else t=="all"&&(a.value.statrtTime=void 0,a.value.endTime=void 0);d("search")};return(t,e)=>{const o=Ce,C=We,D=Ye,J=Ne,F=Ae,X=Ee,ce=N,pe=me,fe=Ke,ge=be,ye=de;return v(),S(ye,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[n(ge,{ref_key:"formRef",ref:E,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:xe(M,["enter"])},{default:l(()=>[n(fe,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[n(C,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:l(()=>[n(o,{filterable:"",clearable:"",value:a.value.pid,"onUpdate:value":[e[0]||(e[0]=f=>a.value.pid=f),Y],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:p.value,onScroll:P,onClear:I,onSearch:H,onBlur:O},null,8,["value","options"])]),_:1}),n(C,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:l(()=>[n(J,{value:_.value,"onUpdate:value":[e[1]||(e[1]=f=>_.value=f),q],style:{"margin-right":"20px"}},{default:l(()=>[n(D,{value:"day"},{default:l(()=>e[6]||(e[6]=[T("天")])),_:1,__:[6]}),n(D,{value:"week"},{default:l(()=>e[7]||(e[7]=[T("周")])),_:1,__:[7]}),n(D,{value:"month"},{default:l(()=>e[8]||(e[8]=[T("月")])),_:1,__:[8]}),n(D,{value:"all"},{default:l(()=>e[9]||(e[9]=[T("全部")])),_:1,__:[9]})]),_:1},8,["value"]),_.value==="day"?(v(),S(F,{key:0,"formatted-value":m.value.dayTime,"onUpdate:formattedValue":[e[2]||(e[2]=f=>m.value.dayTime=f),r],type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])):j("",!0),_.value==="week"?(v(),S(F,{key:1,"formatted-value":m.value.weekTime,"onUpdate:formattedValue":[e[3]||(e[3]=f=>m.value.weekTime=f),s],type:"week",style:{width:"100%"}},null,8,["formatted-value"])):j("",!0),_.value==="month"?(v(),S(F,{key:2,"formatted-value":m.value.monthTime,"onUpdate:formattedValue":[e[4]||(e[4]=f=>m.value.monthTime=f),g],type:"month","value-format":"yyyy-MM",style:{width:"100%"}},null,8,["formatted-value"])):j("",!0)]),_:1}),n(C,{span:"24 s:12 m:5",label:"用户",path:"creater"},{default:l(()=>[n(o,{clearable:"",filterable:"",value:a.value.creater,"onUpdate:value":[e[5]||(e[5]=f=>a.value.creater=f),z],placeholder:"请选择","label-field":"username","value-field":"id",options:i(R).data,onScroll:W},null,8,["value","options"])]),_:1}),n(C,{span:"24  s:12 m:4",class:"pr-24px"},{default:l(()=>[n(pe,{class:"w-full"},{default:l(()=>[n(ce,{type:"primary",ghost:"",onClick:M},{icon:l(()=>[n(X,{class:"text-icon"})]),default:l(()=>[T(" "+ee(i(U)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Xe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Qe={key:0};function se(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!Ve(w)}const mt=re({name:"projectmanagement_daylog",__name:"index",props:{pid:{default:void 0},type:{}},emits:["thereIsData"],setup(w,{emit:te}){const c=Me(),L=ie(),d=w,{columns:E,data:a,getData:p,loading:y,mobilePagination:b,searchParams:x}=Fe({showTotal:!0,immediate:!1,apiFn:$e,apiParams:{page:1,pageSize:20,limit:20,statrtTime:void 0,endTime:void 0,creater:void 0,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:200,render:r=>{const s=JSON.parse(r.context);return n("div",null,[s.proname?r.username+"的"+s.proname+"项目日报":r.username+"的项目日报"])}},{key:"charctras",title:"字数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:U("common.operate"),align:"center",width:140,fixed:"right",render:r=>{let s;return n("div",{class:"flex-center gap-8px"},[n(N,{type:"primary",ghost:!0,size:"small",onClick:()=>O(r)},{default:()=>[T("查看详情")]}),L.userInfo.id==r.creater&&G(n(N,{type:"primary",ghost:!0,size:"small",onClick:()=>B(r.id)},se(s=U("common.edit"))?s:{default:()=>[s]}),[[Q("no-auth"),"project:DailyReport:update"]]),L.userInfo.id==r.creater&&n(Oe,{onPositiveClick:()=>A(r.id)},{default:()=>U("common.confirmDelete"),trigger:()=>{let g;return G(n(N,{type:"error",ghost:!0,size:"small"},se(g=U("common.delete"))?g:{default:()=>[g]}),[[Q("no-auth"),"project:DailyReport:delete"]])}})])}}]}),{drawerVisible:P,operateType:R,editingData:K,handleAdd:V,handleEdit:W,checkedRowKeys:z,onDeleted:Y}=Ge(a,p);async function A(r){const{data:s,error:g}=await qe(r);g||Y()}function B(r){W(r)}const k=h(!1),H=h({}),O=r=>{k.value=!0,H.value=r},I=()=>{p()},$=h(""),m=r=>{$.value=r};return ue(()=>{d.type!="externalLiaison"}),(r,s)=>{const g=me,M=ve,_=Le,q=de,t=Q("no-auth");return v(),oe("div",Xe,[d.pid?j("",!0):(v(),S(Je,{key:0,model:i(x),"onUpdate:model":s[0]||(s[0]=e=>Z(x)?x.value=e:null),onReset:I,onSearch:i(p),onSetPname:m},null,8,["model","onSearch"])),n(q,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Ue({header:l(()=>[n(g,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>[d.pid?j("",!0):(v(),oe("div",Qe,"项目日报"))]),_:1}),d.pid?G((v(),S(i(N),{key:0,onClick:i(V),size:"small",ghost:"",type:"primary"},{icon:l(()=>[n(M,{class:"text-icon"})]),default:l(()=>[s[4]||(s[4]=T(" "+ee("新增")))]),_:1,__:[4]},8,["onClick"])),[[t,"project:DailyReport:insert"]]):j("",!0)]),default:l(()=>[n(_,{"checked-row-keys":i(z),"onUpdate:checkedRowKeys":s[1]||(s[1]=e=>Z(z)?z.value=e:null),columns:i(E),data:i(a),size:"small","flex-height":!i(c).isMobile,loading:i(y),remote:"","row-key":e=>e.id,pagination:i(b),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),n(He,{visible:i(P),"onUpdate:visible":s[2]||(s[2]=e=>Z(P)?P.value=e:null),onSubmitted:i(p),"operate-type":i(R),pname:$.value,pid:d.pid||i(x).pid,"row-data":i(K)},null,8,["visible","onSubmitted","operate-type","pname","pid","row-data"]),n(Ie,{visible:k.value,"onUpdate:visible":s[3]||(s[3]=e=>k.value=e),"row-data":H.value},null,8,["visible","row-data"])]),_:2},[d.pid?void 0:{name:"header-extra",fn:l(()=>[n(g,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[G((v(),S(i(N),{onClick:i(V),size:"small",ghost:"",type:"primary"},{icon:l(()=>[n(M,{class:"text-icon"})]),default:l(()=>[s[5]||(s[5]=T(" "+ee("新增")))]),_:1,__:[5]},8,["onClick"])),[[t,"project:DailyReport:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{mt as default};
