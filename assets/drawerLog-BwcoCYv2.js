import{d as H,aE as V,m as G,ar as ne,r as X,n as oe,a as se,aG as Y,bY as J,eh as le,ei as re,aC as Q,c as T,o as b,w as t,f as l,C as W,s as Z,N as ee,h as e,aD as ie,v as h,y as ce,B,g as w,t as p,$ as A,a1 as de,cs as ue,aO as pe,O as me,H as K,ej as fe,q as R,bg as ve,x as O,e as i,aU as x,b as I,X as _e,A as be,cK as ge,U as we,V as ye,bi as xe,ek as he,el as Ce,M as De}from"./index-ByRkKuMU.js";import{u as ke}from"./usePageData-DJSm323_.js";import{_ as je,a as ze}from"./text-D4-PwBDz.js";import{N as Ne}from"./Popconfirm-BARyXAms.js";const Ee=H({name:"OperateDrawer",__name:"operate-drawer",props:V({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(C,{emit:F}){G();const n=F,D=ne("pname"),u=C,o=X(P());function P(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null}}const y={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施",trigger:"blur"}},{pageData:m,getData:k,nextPage:j}=ke(ue),z=async a=>{const r=a.currentTarget,v=r.scrollTop;r.scrollTop+r.offsetHeight>=r.scrollHeight&&m.data.length<m.total&&(await j(),await pe(),setTimeout(()=>{r.scrollTop=v}))},U=async a=>{a?o.pid=a:o.value.pid=null},L=async()=>{var a;if(await k({fuzzy:D==null?void 0:D.value,page:1}),m.data.length==0)return(a=window.$message)==null?void 0:a.warning("没有项目")},c=async a=>{await k({fuzzy:a,page:1})},s=()=>{k({page:1})};async function f(){Object.assign(o,P()),await L(),u.pid&&(m.data.forEach(a=>{a.id==u.pid&&(a.disabled=!0)}),o.pid=u.pid),u.operateType==="edit"&&u.rowData&&Object.assign(o,u.rowData)}const{formRef:_,validate:M,restoreValidation:q}=oe(),E=se(()=>({add:"新增项目总结",edit:"修改项目总结"})[u.operateType]),g=Y(C,"visible"),N=()=>{g.value=!1},$=J.debounce(async()=>{var a,r;if(await M(),u.operateType==="edit"){const{data:v,error:S}=await le([{...o}]);S||((a=window.$message)==null||a.success("修改成功"),n("submitted"),N())}else{const{data:v,error:S}=await re([{pid:o.pid,content1:o.content1,content2:o.content2,content3:o.content3,content4:o.content4,content5:o.content5}]);S||((r=window.$message)==null||r.success("添加成功"),n("submitted"),N())}},1e3,{leading:!0,trailing:!1});return Q(g,()=>{g.value&&(f(),setTimeout(()=>{const a=document.querySelector(".n-scrollbar-content");a==null||a.scrollTo(0,0)},300),q())}),(a,r)=>{const v=ee,S=W,te=ce,ae=de;return b(),T(ae,{show:g.value,"onUpdate:show":r[6]||(r[6]=d=>g.value=d),title:E.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:t(()=>[l(te,{justify:"end"},{default:t(()=>[l(e(B),{size:"small",class:"mt-16px",onClick:N},{default:t(()=>[w(p(e(A)("common.cancel")),1)]),_:1}),l(e(B),{type:"primary",size:"small",class:"mt-16px",onClick:e($)},{default:t(()=>[w(p(e(A)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[l(S,{ref_key:"formRef",ref:_,model:o,rules:y},{default:t(()=>[u.operateType==="add"?(b(),T(v,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:t(()=>[l(e(ie),{clearable:"",filterable:"",value:o.pid,"onUpdate:value":[r[0]||(r[0]=d=>o.pid=d),U],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:s,onSearch:c,options:e(m).data,onScroll:z},null,8,["value","options"])]),_:1})):Z("",!0),l(v,{label:"前期准备阶段描述",path:"content1"},{default:t(()=>[l(e(h),{clearable:"",type:"textarea",value:o.content1,"onUpdate:value":r[1]||(r[1]=d=>o.content1=d),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),l(v,{label:"遇到问题及对项目的影响",path:"content2"},{default:t(()=>[l(e(h),{clearable:"",type:"textarea",value:o.content2,"onUpdate:value":r[2]||(r[2]=d=>o.content2=d),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),l(v,{label:"经验教训与改进方案或措施",path:"content3"},{default:t(()=>[l(e(h),{clearable:"",type:"textarea",value:o.content3,"onUpdate:value":r[3]||(r[3]=d=>o.content3=d),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),l(v,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:t(()=>[l(e(h),{clearable:"",type:"textarea",value:o.content4,"onUpdate:value":r[4]||(r[4]=d=>o.content4=d),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),l(v,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:t(()=>[l(e(h),{clearable:"",type:"textarea",value:o.content5,"onUpdate:value":r[5]||(r[5]=d=>o.content5=d),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Se={class:"mt-4 border-t pt-3"},Te={class:"flex items-start gap-2 mb-3"},Pe={class:"ml-2 flex-1"},Ue={class:"flex items-center"},Me={class:"font-medium font-size-16px font-bold"},$e={class:"text-gray-600 mt-1"},Ie=H({name:"drawerLog",__name:"drawerLog",props:V({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(C){const F=G();me();let n=X({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""});const D=C,u={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},o=K({});async function P(){y.value=[],n={id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""},Object.assign(n,D.rowData),z()}const y=K([]),m=Y(C,"visible");Q(m,()=>{m.value?P():(y.value=[],n.id=void 0)});function k(c){c||j()}function j(){m.value=!1}const z=async()=>{const{data:c,error:s}=await he({page:1,limit:100,pid:n.id});c&&(y.value=c.list)},U=J.debounce(async()=>{var _;const c=o.value[n.id];if(!(c!=null&&c.trim()))return(_=window.$message)==null?void 0:_.warning("请输入评论内容");const{data:s,error:f}=await fe([{pid:n.id,content:c}]);s&&(o.value[n.id]="",n.num++,z())},1e3,{leading:!0,trailing:!1}),L=async c=>{var _;const{data:s,error:f}=await Ce(c.id);s&&(z(),n.num--,(_=window.$message)==null||_.success("删除成功"))};return(c,s)=>{const f=ee,_=W,M=je,q=ze,E=ve,g=xe,N=R("i"),$=R("no-auth");return b(),T(g,{show:m.value,"onUpdate:show":[s[1]||(s[1]=a=>m.value=a),k],"display-directive":"show",width:600,onMaskClick:j,onEsc:j},{default:t(()=>[l(E,{title:e(n).username+"的项目总结","native-scrollbar":!1,closable:""},{default:t(()=>[l(_,{ref:"formRef",model:e(n),"show-feedback":!1},{default:t(()=>[l(f,{label:"",path:"contractname"},{label:t(()=>s[2]||(s[2]=[i("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(n).proname}])},p(e(n).proname),3)]),_:1}),l(f,{label:"前期准备阶段描述",path:"content1"},{label:t(()=>s[3]||(s[3]=[i("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(n).content1}])},p(e(n).content1),3)]),_:1}),l(f,{label:"遇到问题及对项目的影响",path:"content2"},{label:t(()=>s[4]||(s[4]=[i("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(n).content2}])},p(e(n).content2),3)]),_:1}),l(f,{label:"经验教训与改进方案或措施",path:"content3"},{label:t(()=>s[5]||(s[5]=[i("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(n).content3}])},p(e(n).content3),3)]),_:1}),l(f,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:t(()=>s[6]||(s[6]=[i("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(n).content4}])},p(e(n).content4),3)]),_:1}),l(f,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:t(()=>s[7]||(s[7]=[i("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(n).content5}])},p(e(n).content5),3)]),_:1})]),_:1},8,["model"]),O((b(),I("div",null,[w(p(e(n).num)+"评论",1)])),[[N,e(n).num]]),l(_e,{name:"fade"},{default:t(()=>[i("div",Se,[O((b(),I("div",Te,[i("div",null,[l(M,{size:"small",src:u.avatar},null,8,["src"])]),l(e(h),{type:"textarea",id:`comment-input-${e(n).id}`,value:o.value[e(n).id],"onUpdate:value":s[0]||(s[0]=a=>o.value[e(n).id]=a),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:be(ge(e(U),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),l(e(B),{type:"primary",ghost:"",onClick:e(U)},{default:t(()=>s[8]||(s[8]=[w("发送")])),_:1,__:[8]},8,["onClick"])])),[[$,"project:Summary:Comment:insert"]]),(b(!0),I(we,null,ye(y.value,a=>(b(),I("div",{key:a.id,class:"flex mb-3"},[l(M,{size:"small",src:u.avatar},null,8,["src"]),i("div",Pe,[i("div",Ue,[i("span",Me,p(a.username),1),l(q,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:t(()=>[w(p(a.dbtime),1)]),_:2},1024),e(F).userInfo.id==a.creater?(b(),T(e(Ne),{key:0,onPositiveClick:r=>L(a)},{trigger:t(()=>[O((b(),T(e(B),{quaternary:"",type:"error",size:"small"},{default:t(()=>s[9]||(s[9]=[w(" 删除 ")])),_:1,__:[9]})),[[$,"project:Summary:Comment:delete"]])]),default:t(()=>[s[10]||(s[10]=w(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):Z("",!0)]),i("div",$e,p(a.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Oe=De(Ie,[["__scopeId","data-v-4f3f349b"]]);export{Ee as _,Oe as d};
