import{_ as Ee}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CA6VClBh.js";import{_ as Ve,a as je}from"./round-settings-94uIXKa4.js";import{_ as qe}from"./round-delete-f3Ztvx2k.js";import{_ as Ae}from"./round-add-DFJbefvJ.js";import{_ as Fe}from"./round-search-CNgYOhaH.js";import{d as fe,s as re,m as B,v as ke,r as Oe,x as Re,y as Ge,ab as Me,ag as Le,aX as We,a as Ke,$ as C,C as se,o as D,c as W,w as n,g as a,h as O,t as T,f as i,E as Te,D as Q,aE as L,F as ie,b as pe,ao as ye,e as Pe,aY as He,aZ as Xe,a_ as Ue,a$ as we,b0 as Ye,b1 as Ze,N as Ne,aP as Qe,aF as ea,ak as me,aV as aa,R as ce,aW as la,T as Ce,S as ta,B as q,aG as Se,z as na,b2 as oa,b3 as sa,b4 as _e,b5 as ia,aK as ze,aD as ra,ai as ca,b6 as ua,b7 as da,b8 as $e,af as ge,aH as be,aI as pa,aJ as ma,a6 as fa}from"./index-I2YBYtCn.js";import{u as ha,a as va}from"./table-BWcFmPkK.js";import{e as _a,f as ga,g as ba,h as ya,s as Pa,i as wa,j as ka}from"./gather-ByAn-JF6.js";import{_ as Je}from"./FormItemGridItem-CD_fwz4s.js";import{_ as Ma}from"./Cascader-BsMk2NUs.js";import{_ as Ie}from"./Grid-tc9wKdi-.js";import{N as xe}from"./Popconfirm-DUn5dNpp.js";import{_ as Na}from"./InputGroupLabel-BAy_4tZB.js";const Sa=Pe("span",null,"批量新增：格式为（采集通道1-10）",-1),Ba=fe({__name:"add_model",props:re({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:re(["submitted"],["update:visible"]),setup(U,{emit:ee}){const $=[{value:0,label:"采集通道"}],g=B(!1),_=ke(U,"visible"),k=ee,m=U,e=Oe(b());function b(){return{chlName:"采集通道1",chlType:0,chlAddr:1,chlProtocol:"{348E12D3-308A-40da-B1AA-489F326C5695}",chlColtFreq:500,chlWaitTime:300,chlDesc:void 0,protocolType:1,chlValid:1,chlEnableBkup:0,chlMainParam:{com_name:"",timeout:void 0,baud:void 0,check_bit:void 0,stop_bit:void 0,data_bit:void 0,role:void 0,ip_addr:void 0,port:void 0,reserve0:void 0,reserve1:void 0,reserve2:void 0,reserve3:void 0},chlBkupParam:{com_name:"",timeout:void 0,baud:void 0,check_bit:void 0,stop_bit:void 0,data_bit:void 0,role:void 0,ip_addr:void 0,port:void 0,reserve0:void 0,reserve1:void 0,reserve2:void 0,reserve3:void 0}}}const x=B("");function N(){Object.assign(e,b()),m.operateType==="edit"&&m.rowData?(Object.assign(e,m.rowData),x.value=m.rowData.chlProtocol,e.chlMainParam=JSON.parse(e.chlMainParam),e.chlValid=e.chlValid==2?2:1,e.chlBkupParam&&JSON.stringify(e.chlBkupParam)!=="{}"?e.chlBkupParam=JSON.parse(e.chlBkupParam):e.chlBkupParam=Object.assign({},e.chlBkupParam)):r("2",void 0)}const{formRef:I,validate:y,restoreValidation:E}=Re();Ge(),Me(_,async()=>{_.value&&(m.operateType==="add"&&Le(()=>{setTimeout(()=>{g.value=!0},200)}),await X(),N(),E())});const S=()=>{_.value=!1,g.value=!1},K=async()=>{var l,d,c,s,h,M,A,F,z,ae,le;await y();const u=()=>{e.protocolType==0?(e.chlMainParam=JSON.stringify({reserve0:e.chlMainParam.reserve0,reserve1:e.chlMainParam.reserve1,reserve2:e.chlMainParam.reserve2,reserve3:e.chlMainParam.reserve3,role:e.chlMainParam.role,ip_addr:e.chlMainParam.ip_addr,port:e.chlMainParam.port,timeout:e.chlMainParam.timeout}),e.chlEnableBkup===1?e.chlBkupParam=JSON.stringify({reserve0:e.chlBkupParam.reserve0,reserve1:e.chlBkupParam.reserve1,reserve2:e.chlBkupParam.reserve2,reserve3:e.chlBkupParam.reserve3,role:e.chlBkupParam.role,ip_addr:e.chlBkupParam.ip_addr,port:e.chlBkupParam.port,timeout:e.chlBkupParam.timeout}):e.chlBkupParam=JSON.stringify({})):(e.chlMainParam=JSON.stringify({reserve0:e.chlMainParam.reserve0,reserve1:e.chlMainParam.reserve1,timeout:e.chlMainParam.timeout,com_name:e.chlMainParam.com_name,baud:e.chlMainParam.baud,check_bit:e.chlMainParam.check_bit,stop_bit:e.chlMainParam.stop_bit,data_bit:e.chlMainParam.data_bit}),e.chlEnableBkup===1?e.chlBkupParam=JSON.stringify({reserve0:e.chlBkupParam.reserve0,reserve1:e.chlBkupParam.reserve1,timeout:e.chlBkupParam.timeout,com_name:e.chlBkupParam.com_name,baud:e.chlBkupParam.baud,check_bit:e.chlBkupParam.check_bit,stop_bit:e.chlBkupParam.stop_bit,data_bit:e.chlBkupParam.data_bit}):e.chlBkupParam=JSON.stringify({}))};if(m.operateType==="add"){let V=[],R=[],Y=[],J=e.chlName;if(((l=e.chlName)==null?void 0:l.indexOf("-"))!=-1){let t=Math.abs(J==null?void 0:J.substring(J.lastIndexOf("-")).replace(/[^0-9]/gi,"")),Z=J.split(/-(?![^-]*-)/),ne=J.substring(0,J.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],w=ne.replace(/[^0]/g,""),oe=ne,de=Z[0],G=de.substring(0,de.length-de.match(/(\d+)[^0-9]*$/)[1].length),he=t-ne+1;for(let Be=0;Be<he;Be++){let j=oe++,ve=JSON.parse(JSON.stringify(e));ve.chlName=parseInt(ne)==0?w.length>0?String(j).length>=w.length?G+j:G+w.substring(0,w.length-String(j).length)+j:G+j:w.length>0?j>=10?G+w.substring(0,w.length-String(j).length+1)+j:G+w.substring(0,w.length)+j:G+j,V.push(ve),R.push(ve.chlName)}}else V=[e],R=[e.chlName];if(V.length>1e3){(d=window.$message)==null||d.destroyAll(),(c=window.$message)==null||c.warning("批量添加最多仅支持1000条");return}u();const{data:ue,error:te}=await He(V);if(te)e.chlMainParam=JSON.parse(e.chlMainParam),e.chlBkupParam=JSON.parse(e.chlBkupParam);else{const t=await Xe({page:1,limit:1e3,chlType:0,_t:new Date().getTime()});if(t.data.list.length>0)if(t.data.list.forEach(Z=>{R.includes(Z.chlName)&&Y.push(Z.id)}),Y.length==0)(s=window.$message)==null||s.destroyAll(),(h=window.$message)==null||h.success("添加成功"),S(),k("submitted");else{const Z=await Ue({guid:V[0].chlProtocol});if(!Z.error){if(Z.data.length==0){(M=window.$message)==null||M.destroyAll(),(A=window.$message)==null||A.success("通道添加成功，未查询到该协议的规约信息"),S(),k("submitted");return}const ne=Y.map(async w=>{var G;const oe=Z.data.map(he=>({...he,chlId:w}));return(await we(oe)).error?((G=window.$message)==null||G.error("通道添加成功，规约信息添加失败"),Promise.reject(new Error("通道添加成功，规约信息添加失败"))):Promise.resolve()});Promise.all(ne).then(()=>{var w,oe;(w=window.$message)==null||w.destroyAll(),(oe=window.$message)==null||oe.success("添加成功"),S(),k("submitted")}).catch(w=>{console.error(w)})}}else(F=window.$message)==null||F.destroyAll(),(z=window.$message)==null||z.success("添加成功"),S(),k("submitted")}}else{u(),e.chlProtocol==x.value&&delete e.chlProtocol;const{data:V,error:R}=await Ye([e]);R?(e.chlMainParam=JSON.parse(e.chlMainParam),e.chlBkupParam=JSON.parse(e.chlBkupParam)):((ae=window.$message)==null||ae.destroyAll(),(le=window.$message)==null||le.success("修改成功"),S(),k("submitted"))}};let H=Oe([]);const X=async()=>{const{data:u}=await We({type:0}),l=JSON.parse(u);function d(c){return Object.keys(c).map(s=>{const h=c[s];return{label:s,value:s,children:h.map(M=>{const[A,F]=Object.entries(M)[0];return{label:A,value:A,children:F.map(z=>({label:z.name,value:z.gUID,id:z.id}))}})}})}H=d(l)},r=async(u,l)=>{console.log(u,l);const{data:d,error:c}=await Ze({id:l?l.id:2});if(!c){e.protocolType=d.type;let s=JSON.parse(d.defaultCfg);e.chlMainParam=Object.assign(e.chlMainParam,s),e.chlEnableBkup===1&&(e.chlBkupParam=Object.assign(e.chlBkupParam,s))}},p={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},o={type:"number",required:!0,trigger:["blur","change"],message:"不能为空"},v={required:!0,validator(u,l){let d="^((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$";return new RegExp(d).test(l)?!0:new Error("IP地址错误")},trigger:["input","blur"]},f={chlName:p,chlType:o,chlAddr:o,chlWaitTime:o,chlColtFreq:o,protocolType:o,chlValid:o,chlEnableBkup:o,chlProtocol:p,chlMainParam:{role:o,com_name:p,timeout:o,baud:o,check_bit:o,stop_bit:o,data_bit:o,ip_addr:[p,v],port:o},chlBkupParam:{role:o,com_name:p,timeout:o,baud:o,check_bit:o,stop_bit:o,data_bit:o,ip_addr:[p,v],port:o}},P=Ke(()=>({add:C("common.add"),edit:C("common.edit")})[m.operateType]);return(u,l)=>{const d=Ne,c=Qe,s=Je,h=ea,M=me,A=Ma,F=aa,z=ce,ae=la,le=Ie,V=Ce,R=ta,Y=q,J=ce,ue=Se,te=se("no-space");return D(),W(ue,{show:_.value,"onUpdate:show":l[25]||(l[25]=t=>_.value=t),title:P.value,preset:"card",class:"w-50%",onAfterLeave:S},{footer:n(()=>[a(J,{size:16,justify:"end"},{default:n(()=>[a(Y,{onClick:S},{default:n(()=>[O(T(i(C)("common.cancel")),1)]),_:1}),a(Y,{type:"primary",onClick:K},{default:n(()=>[O(T(i(C)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(R,{style:{"max-height":"80vh"}},{default:n(()=>[a(V,{ref_key:"formRef",ref:I,model:e,rules:f,"label-placement":"left","label-width":140,"require-mark-placement":"left",onKeyup:Te(K,["enter"])},{default:n(()=>[a(le,{responsive:"screen","item-responsive":""},{default:n(()=>[a(s,{span:"24 m:12",label:"通道名称",path:"chlName"},{default:n(()=>[a(c,{show:g.value,placement:"top-start"},{trigger:n(()=>[Q(a(d,{clearable:"",maxlength:"64",value:e.chlName,"onUpdate:value":l[0]||(l[0]=t=>e.chlName=t),placeholder:"请输入通道名称"},null,8,["value"]),[[te]])]),default:n(()=>[Sa]),_:1},8,["show"])]),_:1}),a(s,{span:"24 m:12",label:"通道描述",path:"chlDesc"},{default:n(()=>[a(d,{clearable:"",value:e.chlDesc,"onUpdate:value":l[1]||(l[1]=t=>e.chlDesc=t),maxlength:"255",placeholder:"请输入通道描述"},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"通道地址",path:"chlAddr"},{default:n(()=>[a(h,{clearable:"",value:e.chlAddr,"onUpdate:value":l[2]||(l[2]=t=>e.chlAddr=t),placeholder:"请输入通道地址",precision:0,style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"通道类型",path:"chlType"},{default:n(()=>[a(M,{filterable:"",clearable:"",placeholder:"请选择通道类型",value:e.chlType,"onUpdate:value":l[3]||(l[3]=t=>e.chlType=t),disabled:"",options:$},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"交互频率(ms)",path:"chlColtFreq"},{default:n(()=>[a(h,{clearable:"",value:e.chlColtFreq,"onUpdate:value":l[4]||(l[4]=t=>e.chlColtFreq=t),precision:0,placeholder:"请输入交互频率",style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"每帧间隔(ms)",path:"chlWaitTime"},{default:n(()=>[a(h,{clearable:"",value:e.chlWaitTime,"onUpdate:value":l[5]||(l[5]=t=>e.chlWaitTime=t),precision:0,placeholder:"请输入每帧间隔",style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"协议名称",path:"chlProtocol"},{default:n(()=>[a(A,{value:e.chlProtocol,"onUpdate:value":[l[6]||(l[6]=t=>e.chlProtocol=t),r],placeholder:"请选择协议名称","expand-trigger":"click",options:i(H),"check-strategy":"child","show-path":!1},null,8,["value","options"])]),_:1}),a(s,{span:"24 m:12",label:"协议类型",path:"protocolType"},{default:n(()=>[a(M,{filterable:"",placeholder:"请选择协议类型",value:e.protocolType,"onUpdate:value":l[7]||(l[7]=t=>e.protocolType=t),options:i(L)(i(_a))},null,8,["value","options"])]),_:1}),m.operateType=="edit"?(D(),W(s,{key:0,span:"24 m:24",label:"通道有效性",path:"chlValid"},{default:n(()=>[a(ae,{value:e.chlValid,"onUpdate:value":l[8]||(l[8]=t=>e.chlValid=t),name:"radiogroup"},{default:n(()=>[a(z,null,{default:n(()=>[a(F,{label:"是",value:1}),a(F,{label:"否",value:2})]),_:1})]),_:1},8,["value"])]),_:1})):ie("",!0),e.protocolType!==0?(D(),pe(ye,{key:1},[a(s,{span:"24 m:12",label:"串口名称",path:"chlMainParam.com_name"},{default:n(()=>[a(M,{filterable:"",placeholder:"请选择",value:e.chlMainParam.com_name,"onUpdate:value":l[9]||(l[9]=t=>e.chlMainParam.com_name=t),options:i(L)(i(ga))},null,8,["value","options"])]),_:1}),a(s,{span:"24 m:12",label:"波特率",path:"chlMainParam.baud"},{default:n(()=>[a(M,{filterable:"",placeholder:"请选择",value:e.chlMainParam.baud,"onUpdate:value":l[10]||(l[10]=t=>e.chlMainParam.baud=t),options:i(L)(i(ba))},null,8,["value","options"])]),_:1}),a(s,{span:"24 m:12",label:"数据位",path:"chlMainParam.data_bit"},{default:n(()=>[a(M,{filterable:"",placeholder:"请选择",value:e.chlMainParam.data_bit,"onUpdate:value":l[11]||(l[11]=t=>e.chlMainParam.data_bit=t),options:i(L)(i(ya))},null,8,["value","options"])]),_:1}),a(s,{span:"24 m:12",label:"停止位",path:"chlMainParam.stop_bit"},{default:n(()=>[a(M,{filterable:"",placeholder:"请选择",value:e.chlMainParam.stop_bit,"onUpdate:value":l[12]||(l[12]=t=>e.chlMainParam.stop_bit=t),options:i(L)(i(Pa))},null,8,["value","options"])]),_:1}),a(s,{span:"24 m:12",label:"校验位",path:"chlMainParam.check_bit"},{default:n(()=>[a(M,{filterable:"",placeholder:"请选择",value:e.chlMainParam.check_bit,"onUpdate:value":l[13]||(l[13]=t=>e.chlMainParam.check_bit=t),options:i(L)(i(wa))},null,8,["value","options"])]),_:1}),a(s,{span:"24 m:12",label:"保留0"},{default:n(()=>[a(d,{clearable:"",value:e.chlMainParam.reserve0,"onUpdate:value":l[14]||(l[14]=t=>e.chlMainParam.reserve0=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"超时",path:"chlMainParam.timeout"},{default:n(()=>[a(h,{clearable:"",value:e.chlMainParam.timeout,"onUpdate:value":l[15]||(l[15]=t=>e.chlMainParam.timeout=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"保留1"},{default:n(()=>[a(d,{clearable:"",value:e.chlMainParam.reserve1,"onUpdate:value":l[16]||(l[16]=t=>e.chlMainParam.reserve1=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1})],64)):ie("",!0),e.protocolType==0?(D(),W(s,{key:2,span:"24 m:12",label:"通讯方向",path:"chlMainParam.role"},{default:n(()=>[a(M,{filterable:"",placeholder:"请选择",value:e.chlMainParam.role,"onUpdate:value":l[17]||(l[17]=t=>e.chlMainParam.role=t),options:i(L)(i(ka))},null,8,["value","options"])]),_:1})):ie("",!0),e.protocolType==0?(D(),pe(ye,{key:3},[a(s,{span:"24 m:12",label:"保留0"},{default:n(()=>[a(d,{clearable:"",value:e.chlMainParam.reserve0,"onUpdate:value":l[18]||(l[18]=t=>e.chlMainParam.reserve0=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"IP/域名",path:"chlMainParam.ip_addr"},{default:n(()=>[a(d,{clearable:"",value:e.chlMainParam.ip_addr,"onUpdate:value":l[19]||(l[19]=t=>e.chlMainParam.ip_addr=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"保留1"},{default:n(()=>[a(d,{clearable:"",value:e.chlMainParam.reserve1,"onUpdate:value":l[20]||(l[20]=t=>e.chlMainParam.reserve1=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"端口号",path:"chlMainParam.port"},{default:n(()=>[a(h,{clearable:"",min:1,max:65535,value:e.chlMainParam.port,"onUpdate:value":l[21]||(l[21]=t=>e.chlMainParam.port=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"保留2"},{default:n(()=>[a(d,{clearable:"",value:e.chlMainParam.reserve2,"onUpdate:value":l[22]||(l[22]=t=>e.chlMainParam.reserve2=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"超时",path:"chlMainParam.timeout"},{default:n(()=>[a(h,{clearable:"",value:e.chlMainParam.timeout,"onUpdate:value":l[23]||(l[23]=t=>e.chlMainParam.timeout=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{span:"24 m:12",label:"保留3"},{default:n(()=>[a(d,{clearable:"",value:e.chlMainParam.reserve3,"onUpdate:value":l[24]||(l[24]=t=>e.chlMainParam.reserve3=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1})],64)):ie("",!0)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Oa={class:"font-size-16px"},$a=fe({__name:"regulations_model",props:re({channelId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:re(["submitted"],["update:visible"]),setup(U,{emit:ee}){const $=B({}),g=B([]),_=B([]),k=B(!1),m=B(!1),e=B(!1),b=ke(U,"visible"),x=ee,N=U;Me(()=>N.channelId,r=>{}),na(async()=>{await I(),await E()});const I=async()=>{try{m.value=!0;const{data:r,error:p}=await oa({id:N.channelId});p||($.value=r)}catch{m.value=!1}},y=async r=>{let p=[];try{const{data:o,error:v}=await Ue({guid:$.value.chlProtocol});if(!v){if(o.forEach(f=>{f.foptions&&(f.foptions=f.foptions?JSON.parse(f.foptions):f.foptions)}),k.value)if(r.length>0){let f=o.sort((u,l)=>u.fno>l.fno?1:-1),P=r.sort((u,l)=>u.fno>l.fno?1:-1);_.value=f.filter(u=>P.some(l=>l.fname===u.fname&&l.fno===u.fno)),o.forEach(u=>{r.forEach(l=>{u.fname==l.fname&&u.fno==l.fno&&(u.id=l.id,u.fdesc=l.fdesc,u.fdataflag=l.fdataflag,u.fpno=l.fpno,u.fvalue=l.fvalue)}),p.push({chlId:N.channelId,fname:u.fname,fpno:r[0].fpno,fno:u.fno,fdesc:u.fdesc,fdataflag:u.fdataflag,fvalue:u.fvalue,foptions:u.foptions})}),p=p.sort((u,l)=>u.fno>l.fno?1:-1),g.value=p}else g.value=o;else g.value=o;m.value=!1}}catch{m.value=!1}},E=async()=>{try{const{data:r,error:p}=await sa({chlId:N.channelId});p||(r.forEach(o=>{o.foptions&&(o.foptions=JSON.parse(o.foptions))}),r.length>0?k.value=!0:k.value=!1,await y(r),m.value=!1)}catch{m.value=!1}},S=[{key:"fno",title:"编号",align:"center",width:60},{key:"fdesc",title:"参数描述",align:"center",width:160},{key:"fvalue",title:"参数类型",align:"center",width:100,render(r,p){var o;return _e(me,{value:r.fdataflag,options:[{label:"字符串",value:0},{label:"10进制",value:10},{label:"16进制",value:16}],onUpdateValue:v=>{r.fdataflag=v},disabled:((o=r.foptions)==null?void 0:o.length)>0})}},{key:"foptions",title:"参数值",align:"center",width:160,render(r,p){return r.foptions?_e(me,{value:r.fvalue,onUpdateValue:o=>{r.fvalue=o},options:r.foptions,labelField:"desc",valueField:"value"}):_e(Ne,{value:r.fvalue,onUpdateValue:o=>{r.fvalue=o}})}}],K=async()=>{var p,o,v,f;let r=JSON.parse(JSON.stringify(g.value));if(k.value){_.value.forEach(d=>{d.chlId=N.channelId,d.foptions&&(d.foptions=JSON.stringify(d.foptions)),g.value.forEach(c=>{d.fname===c.fname&&d.fno===c.fno&&(d.fvalue=c.fvalue,d.fdataflag=c.fdataflag)})});let P=r.filter(d=>!_.value.some(c=>c.fname===d.fname&&c.fno===d.fno));const{data:u,error:l}=await ia(_.value);l||(P.length>0?await H(P):((p=window.$message)==null||p.destroyAll(),(o=window.$message)==null||o.success("配置成功"),b.value=!1,x("submitted")))}else{r.forEach(l=>{l.chlId=N.channelId,l.foptions&&(l.foptions=JSON.stringify(l.foptions))});const{data:P,error:u}=await we(r);u||((v=window.$message)==null||v.destroyAll(),(f=window.$message)==null||f.success("配置成功"),b.value=!1,x("submitted"))}},H=async r=>{var v,f;r.forEach(P=>{P.chlId=N.channelId,P.foptions&&(P.foptions=JSON.stringify(P.foptions))});const{data:p,error:o}=await we(r);o||((v=window.$message)==null||v.destroyAll(),(f=window.$message)==null||f.success("配置成功"),b.value=!1,x("submitted"))},X=r=>{};return(r,p)=>{const o=ze,v=q,f=ce,P=Se,u=se("no-auth");return D(),W(P,{show:b.value,"onUpdate:show":p[2]||(p[2]=l=>b.value=l),preset:"card",class:"w-40% h-700px"},{header:n(()=>[Pe("span",null,[O("规约特征配置"),Pe("span",Oa,"(通道："+T($.value.chlName)+" 协议："+T($.value.name)+")",1)])]),footer:n(()=>[a(f,{size:16,justify:"end"},{default:n(()=>[Q((D(),W(v,{disabled:!k.value,class:"w-140px mb-10px",onClick:p[0]||(p[0]=l=>y([]))},{default:n(()=>[O(T("还原默认设置"))]),_:1},8,["disabled"])),[[u,"proset:update"]]),a(v,{onClick:p[1]||(p[1]=l=>b.value=!1),class:"w-100px"},{default:n(()=>[O(T(r.$t("common.cancel")),1)]),_:1}),Q((D(),W(v,{type:"primary",disabled:e.value,class:"w-100px",onClick:K},{default:n(()=>[O(T(r.$t("common.confirm")),1)]),_:1},8,["disabled"])),[[u,"proset:update"]])]),_:1})]),default:n(()=>[a(o,{columns:S,data:g.value,size:"small",loading:m.value,remote:"","row-key":l=>l.id,class:"h-full","flex-height":"",onScroll:X},null,8,["data","loading","row-key"])]),_:1},8,["show"])}}}),xa=fe({__name:"merge_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:re(["submitted"],["update:visible"]),setup(U,{emit:ee}){const g=ra({0:"采集104tcp",1:"采集104udp"}),_=ke(U,"visible"),k=B(null),m=B({targetDevice:void 0,EquipmentMerged:void 0}),e=()=>{},x={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}},N=B(!1);return(I,y)=>{const E=me,S=Je,K=Ie,H=Ce,X=q,r=ce,p=Se;return D(),pe(ye,null,[a(p,{show:_.value,"onUpdate:show":y[3]||(y[3]=o=>_.value=o),title:"通道合并",preset:"card",class:"w-40%"},{footer:n(()=>[a(r,{size:16,justify:"center"},{default:n(()=>[a(X,{onClick:y[2]||(y[2]=o=>_.value=!1),class:"w-100px"},{default:n(()=>[O(T(I.$t("common.cancel")),1)]),_:1}),a(X,{type:"primary",class:"w-100px",onClick:e},{default:n(()=>[O(T(I.$t("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(H,{ref_key:"formRef",ref:k,"label-width":120,"label-placement":"left",model:m.value,rules:x},{default:n(()=>[a(K,{responsive:"screen","item-responsive":""},{default:n(()=>[a(S,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:n(()=>[a(E,{filterable:"",clearable:"",placeholder:"请选择通道",value:m.value.targetDevice,"onUpdate:value":y[0]||(y[0]=o=>m.value.targetDevice=o),options:i(L)(i(g))},null,8,["value","options"])]),_:1}),a(S,{span:"24 m:12",label:"待合并通道",path:"EquipmentMerged"},{default:n(()=>[a(E,{multiple:"",filterable:"",clearable:"",placeholder:"请选择通道",value:m.value.EquipmentMerged,"onUpdate:value":y[1]||(y[1]=o=>m.value.EquipmentMerged=o),options:i(L)(i(g))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),a(p,{show:N.value,"onUpdate:show":y[4]||(y[4]=o=>N.value=o),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),Da={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function De(U){return typeof U=="function"||Object.prototype.toString.call(U)==="[object Object]"&&!pa(U)}const Ga=fe({name:"configsetting_collectionservices_channelmanagement",__name:"index",setup(U){const ee=ca(),$=B(!1),g=B(),_=B(!1),{columns:k,columnChecks:m,data:e,getData:b,loading:x,mobilePagination:N,searchParams:I,resetSearchParams:y}=ha({apiFn:ua,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,chlType:0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"id",title:"通道ID",align:"center",width:60,fixed:"left"},{key:"chlName",title:"通道名称",align:"center",width:140},{key:"chlAddr",title:"通道地址",align:"center",width:140},{key:"chlType",title:"通道类型",align:"center",width:100,render:c=>a("span",null,["采集通道"])},{key:"name",title:"协议名称",align:"center",minWidth:200,render:c=>a("div",{class:"flex-center justify-center gap-8px"},[a(Ve,{class:"text-icon cursor-pointer",color:c.pro>0?"#ff7f50":"",onClick:()=>d(c.id)},null),a("span",null,[c.name])])},{key:"chlMainParam",title:"主通道参数",align:"center",width:300,render:c=>a("span",{class:"font-size-14px"},[c.protocolType===0?JSON.stringify({ip_addr:JSON.parse(c.chlMainParam).ip_addr,port:JSON.parse(c.chlMainParam).port}):JSON.stringify({COM_NAME:JSON.parse(c.chlMainParam).com_name})||{}])},{key:"chlColtFreq",title:"交互频率(ms)",align:"center",width:140},{key:"chlWaitTime",title:"每帧间隔(ms)",align:"center",width:140},{key:"chlValid",title:"有效性",align:"center",width:140,render:c=>a(da,{type:c.chlValid===2?"error":"success"},{default:()=>[c.chlValid==2?"否":"是"]})},{key:"chlDesc",title:"通道描述",align:"center",width:140},{key:"operate",title:C("common.operate"),align:"center",width:240,fixed:"right",render:c=>{let s;return a("div",{class:"flex-center gap-8px"},[a(q,{type:"primary",ghost:!0,size:"small",onClick:()=>v(c.id)},{default:()=>["子设备管理"]}),Q(a(q,{type:"primary",ghost:!0,size:"small",onClick:()=>u(c.id)},De(s=C("common.edit"))?s:{default:()=>[s]}),[[se("no-auth"),"channel:update"]]),Q(a(xe,{onPositiveClick:()=>P(c.id)},{default:()=>C("common.confirmDelete"),trigger:()=>{let h;return a(q,{type:"error",ghost:!0,size:"small"},De(h=C("common.delete"))?h:{default:()=>[h]})}}),[[se("no-auth"),"channel:delete"]])])}}]}),{drawerVisible:E,operateType:S,editingData:K,handleAdd:H,handleEdit:X,checkedRowKeys:r,onBatchDeleted:p,onDeleted:o}=va(e,b);Me(()=>I.fuzzy,c=>{c||b()});const v=c=>{ee.push({path:"/configsetting/collectionservices/subdevicemanagement",query:{channelId:c}})},f=()=>{b()},P=async c=>{const{data:s,error:h}=await $e({ids:c});h||o()},u=c=>{X(c)},l=async()=>{const{data:c,error:s}=await $e({ids:r.value.join(",")});s||o()},d=c=>{g.value=c,$.value=!0};return(c,s)=>{const h=Na,M=Ne,A=Fe,F=ma,z=ce,ae=Ae,le=qe,V=je,R=Ee,Y=ze,J=fa,ue=se("no-space"),te=se("no-auth");return D(),pe("div",Da,[a(J,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[a(z,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:n(()=>[a(F,null,{default:n(()=>[a(h,null,{default:n(()=>[O("通道名称")]),_:1}),Q(a(M,{clearable:"",value:i(I).fuzzy,"onUpdate:value":s[0]||(s[0]=t=>i(I).fuzzy=t),placeholder:"请输入通道名称",style:{width:"100%"},onKeyup:Te(f,["enter"])},null,8,["value"]),[[ue]]),a(i(q),{type:"primary",ghost:"",onClick:f},{icon:n(()=>[a(A,{class:ge(["text-icon",{"animate-spin":i(x)}])},null,8,["class"])]),default:n(()=>[O(" "+T(i(C)("common.search")),1)]),_:1})]),_:1})]),_:1})]),"header-extra":n(()=>[a(z,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[Q((D(),W(i(q),{onClick:i(H),size:"small",ghost:"",type:"primary"},{icon:n(()=>[a(ae,{class:ge(["text-icon",{"animate-spin":i(x)}])},null,8,["class"])]),default:n(()=>[O(" "+T(i(C)("common.add")),1)]),_:1},8,["onClick"])),[[te,"channel:insert"]]),Q((D(),W(i(xe),{onPositiveClick:l},{trigger:n(()=>[a(i(q),{size:"small",ghost:"",type:"error",disabled:i(r).length===0},{icon:n(()=>[a(le,{class:"text-icon"})]),default:n(()=>[O(" "+T(i(C)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:n(()=>[O(" "+T(i(C)("common.confirmDelete")),1)]),_:1})),[[te,"channel:delete"]]),a(i(q),{onClick:s[1]||(s[1]=t=>$.value=!0),size:"small",ghost:"",type:"primary",disabled:i(r).length!==1},{icon:n(()=>[a(V,{class:ge(["text-icon",{"animate-spin":i(x)}])},null,8,["class"])]),default:n(()=>[O(" 规约特征配置 ")]),_:1},8,["disabled"]),a(R,{columns:i(m),"onUpdate:columns":s[2]||(s[2]=t=>be(m)?m.value=t:null)},null,8,["columns"])]),_:1})]),default:n(()=>[a(Y,{"checked-row-keys":i(r),"onUpdate:checkedRowKeys":s[3]||(s[3]=t=>be(r)?r.value=t:null),columns:i(k),data:i(e),size:"small",loading:i(x),remote:"","row-key":t=>t.id,pagination:i(e).length?i(N):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),a(Ba,{visible:i(E),"onUpdate:visible":s[4]||(s[4]=t=>be(E)?E.value=t:null),onSubmitted:i(b),"operate-type":i(S),"row-data":i(K)},null,8,["visible","onSubmitted","operate-type","row-data"]),$.value?(D(),W($a,{key:0,visible:$.value,"onUpdate:visible":s[5]||(s[5]=t=>$.value=t),channelId:i(r).length==0?g.value:i(r)[0],onSubmitted:i(b)},null,8,["visible","channelId","onSubmitted"])):ie("",!0),a(xa,{visible:_.value,"onUpdate:visible":s[6]||(s[6]=t=>_.value=t)},null,8,["visible"])]),_:1})])}}});export{Ga as default};
