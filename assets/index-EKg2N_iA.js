import{_ as J}from"./refresh-DGnxzbIJ.js";import{d as q,m as X,a2 as Q,n as Z,q as ee,C as D,o as M,c as E,w as n,g as l,D as C,i as r,$ as g,V as O,h as _,t as F,E as te,I as ae,Y as le,B as x,M as W,N as ne,ac as Y,j as h,r as G,au as j,z as se,e as oe,aK as re,aF as ie,at as ce,Q as ue}from"./index-DLQv0xE2.js";import{l as de,m as me,n as pe,f as fe}from"./common-JS9auIBL.js";import{_ as _e,a as ge,b as he,l as ve}from"./lodash-DOLyDuOK.js";import{_ as ye}from"./round-refresh-Cl_pKSM5.js";import{C as be,a as xe}from"./common-g2YBWP6P.js";import{a as we,T as ke}from"./basicconf-B9GXguHU.js";import{_ as Ce}from"./Grid-AjTJLB13.js";import{N as $}from"./Popconfirm-G8CimJZQ.js";const ze=q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:X(["reset","search"],["update:model"]),setup(y,{emit:z}){const w=z,u=Q(),{formRef:A,restoreValidation:s}=Z(),c=ee(y,"model");function S(){c.value.fuzzy=void 0,w("search")}async function p(){await s(),w("reset")}async function d(){w("search")}const b=_e.debounce(d,1e3,{leading:!0,trailing:!1});return(K,f)=>{const R=ae,v=ge,N=le,I=ye,m=x,T=he,B=W,P=Ce,U=ne,e=Y,t=D("no-space");return M(),E(e,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[l(U,{ref_key:"formRef",ref:A,model:c.value,"label-placement":"left","label-width":r(u).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:te(r(b),["enter"])},{default:n(()=>[l(P,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[l(v,{span:"24 s:12 m:8 l:6",label:"告警名称",path:"fuzzy"},{default:n(()=>[C(l(R,{autofocus:"",value:c.value.fuzzy,"onUpdate:value":f[0]||(f[0]=a=>c.value.fuzzy=a),placeholder:"请输入告警名称",clearable:"",onClear:S},null,8,["value"]),[[t]])]),_:1}),l(v,{span:"24 s:12 m:8 l:6",label:"告警状态",path:"status"},{default:n(()=>[l(N,{filterable:"",clearable:"",placeholder:r(g)("page.manage.alarm.form.status"),value:c.value.status,"onUpdate:value":[f[1]||(f[1]=a=>c.value.status=a),d],options:r(O)(r(be))},null,8,["placeholder","value","options"])]),_:1}),l(v,{span:"24 s:12 m:8 l:6",label:"级别",path:"alevel"},{default:n(()=>[l(N,{filterable:"",clearable:"",placeholder:r(g)("page.manage.alarm.form.status"),value:c.value.alevel,"onUpdate:value":[f[2]||(f[2]=a=>c.value.alevel=a),d],options:r(O)(r(we))},null,8,["placeholder","value","options"])]),_:1}),l(v,{span:"24 s:12 m:8 l:6"},{default:n(()=>[l(B,{class:"w-full flex items-center"},{default:n(()=>[l(m,{onClick:p},{icon:n(()=>[l(I,{class:"text-icon"})]),default:n(()=>[_(" "+F(r(g)("common.reset")),1)]),_:1}),l(m,{type:"primary",ghost:"",onClick:r(b)},{icon:n(()=>[l(T,{class:"text-icon"})]),default:n(()=>[_(" "+F(r(g)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width","onKeyup"])]),_:1})}}}),Se={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function H(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!ie(y)}const Ne=q({name:"platformalarm_systemalarm",__name:"index",setup(y){const z=h(window.innerHeight-360),w=Q();h(!1),h();const u=G({pageSize:100,pageId:void 0,status:void 0,fuzzy:void 0}),A=[{type:"selection",align:"center",width:48,fixed:"left"},{title:"",key:"index",width:80,align:"center",render:e=>`${e.index}`},{key:"aname",title:"告警名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"uname",title:"用户",align:"center",width:100,render:()=>"系统"},{key:"status",title:g("page.manage.alarm.status"),align:"center",width:120,render:e=>{(e.status===void 0||e.status===null)&&(e.status=0);const t={0:"error",1:"success"},a=g(xe[e.status]);return l(j,{size:"small",type:t[e.status]},H(a)?a:{default:()=>[a]})}},{key:"dbtime",title:"发生时间",align:"center",width:180},{key:"alevel",title:"事件等级",align:"center",width:120,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},a=g(ke[e.alevel]);let i={color:t[e.alevel],textColor:"#ffffff",borderColor:t[e.alevel]};return l(j,{size:"small",color:i},H(a)?a:{default:()=>[a]})}},{key:"adec",title:"告警描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"operate",title:g("common.operate"),align:"center",width:130,fixed:"right",render:e=>l("div",{class:"flex-center gap-8px"},[e.status==0&&l($,{onPositiveClick:()=>v(e.id+"")},{default:()=>"确定要确认该告警数据吗？",trigger:()=>C(l(x,{type:"primary",ghost:!0,size:"small"},{default:()=>[_("确认")]}),[[D("no-auth"),"sys.system.alarm.update"]])}),l($,{onPositiveClick:()=>I(e.id+"")},{default:()=>"确定要删除该告警数据吗？",trigger:()=>C(l(x,{type:"error",ghost:!0,size:"small"},{default:()=>[_("删除")]}),[[D("no-auth"),"sys.system.alarm.delete"]])})])}],s=h([]),c=h(!1),S=h(0),p=h([]),d=async(e=!1)=>{if(!c.value)c.value=!0;else return;c.value=!0;const{data:t,error:a}=await fe(u);a||(S.value=t.length,e?s.value=[...s.value,...t]:s.value=t,s.value=s.value.sort((i,o)=>o.id-i.id).map((i,o)=>(i.index=o+1,i)),c.value=!1)},b=h(!0),K=async()=>{s.value=[],u.pageId=void 0,(t=>Object.keys(t).filter(o=>o!=="limit"&&o!=="_t").some(o=>t[o]!==void 0&&t[o]!==""&&t[o]!==null))(u)?b.value=!1:(b.value=!0,T()),await d(),f()},f=async()=>{var e,t,a;if(s.value.length<z.value/44&&s.value.length<m.total){if(u.pageId==((e=s.value[s.value.length-1])==null?void 0:e.id))return;u.pageId=((a=(t=s.value)==null?void 0:t[s.value.length-1])==null?void 0:a.id)??void 0,d(!0)}};se(async()=>{await d(),await T(),f()});const R=()=>{v(p.value.join(","))},v=async e=>{var i,o;const{data:t,error:a}=await de({ids:e});a||(u.pageId=void 0,d(),(i=window.$message)==null||i.destroyAll(),(o=window.$message)==null||o.success("确认成功"),p.value=[])},N=()=>{I(p.value.join(","))},I=async e=>{var i,o;const{data:t,error:a}=await me({ids:e});a||(u.pageId=void 0,d(),(i=window.$message)==null||i.destroyAll(),(o=window.$message)==null||o.success("删除成功"))},m=G({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:t,page:a,pageSize:i,pageCount:o,itemCount:V}){return`已加载${s.value.length}条`+(s.value.length?b.value?` 共计 ${s.value.length>0?V??0:0} 条`:S.value==u.pageSize?"  预计还有更多":"  没有更多了":"")}});async function T(){const{data:e,error:t}=await pe();t||(m.pageCount=20,m.total=Number(e),m.itemCount=Number(e))}function B(e){var a;Math.abs(e.target.scrollTop+e.target.offsetHeight-e.target.scrollHeight)<=20&&m.total>((a=s.value)==null?void 0:a.length)&&P()}const P=ve.debounce(()=>{var e;((e=s.value)==null?void 0:e.length)<m.total&&(u.pageId=s.value[s.value.length-1].id,d(!0))},300),U=()=>{u.pageId=void 0,d()};return(e,t)=>{const a=J,i=W,o=ce,V=Y,L=D("no-auth");return M(),oe("div",Se,[l(ze,{model:u,"onUpdate:model":t[0]||(t[0]=k=>u=k),onSearch:K},null,8,["model"]),l(V,{title:"系统告警",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[l(i,null,{default:n(()=>[l(r($),{onPositiveClick:R},{trigger:n(()=>[C((M(),E(r(x),{size:"small",ghost:"",type:"primary",disabled:p.value.length===0},{default:n(()=>[_(" 批量确认 ")]),_:1},8,["disabled"])),[[L,"sys.system.alarm.update"]])]),default:n(()=>[_(" 确定要确认选中的数据吗？ ")]),_:1}),l(r($),{onPositiveClick:N},{trigger:n(()=>[C((M(),E(r(x),{size:"small",ghost:"",type:"error",disabled:p.value.length===0},{default:n(()=>[_(" 批量删除 ")]),_:1},8,["disabled"])),[[L,"sys.system.alarm.delete"]])]),default:n(()=>[_(" 确定要删除选中的数据吗？ ")]),_:1}),l(r(x),{size:"small",onClick:U},{icon:n(()=>[l(a,{class:re(["text-icon",{"animate-spin":c.value}])},null,8,["class"])]),default:n(()=>[_(" "+F(r(g)("common.refresh")),1)]),_:1})]),_:1})]),default:n(()=>[l(o,{columns:A,"checked-row-keys":p.value,"onUpdate:checkedRowKeys":t[1]||(t[1]=k=>p.value=k),data:s.value,size:"small","virtual-scroll":"","flex-height":!r(w).isMobile,loading:c.value,remote:"","row-key":k=>k.id,"max-height":z.value,pagination:m,onScroll:B,class:"sm:h-full","scroll-x":""},null,8,["checked-row-keys","data","flex-height","loading","row-key","max-height","pagination"])]),_:1})])}}}),Ue=ue(Ne,[["__scopeId","data-v-76d0be9d"]]);export{Ue as default};
