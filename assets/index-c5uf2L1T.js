import{_ as Ce}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CvXQMREJ.js";import{_ as De}from"./round-delete-GVPm6O8Z.js";import{_ as Se}from"./round-add-DZ4EdxB6.js";import{d as J,aw as E,ay as te,s as ce,x as me,a as Re,$ as l,v as fe,at as _e,y as V,c as O,o as R,w as s,f as a,bh as Te,G as oe,z as ie,A as ge,h as t,D as j,C as ne,au as ve,c1 as $e,aD as ze,N as W,b as we,aT as Me,aX as Be,B as S,g as k,t as x,bj as Fe,c2 as Oe,c3 as je,c4 as Ie,aE as Ve,F as Ge,bi as qe,U as ye,bL as ue,e as Ae,aF as he,c5 as Ke,bW as Le,M as Ee,r as ee,aO as K,aA as Je,aP as We,az as Xe,c6 as He,c7 as Qe,c8 as Ye,aG as ae,aU as Ze}from"./index-Bb6REojI.js";import{u as ea,a as aa}from"./table-B_mCH9x-.js";import{u as se,d as sa}from"./business-Oc64XSm3.js";import{_ as ta}from"./round-search-DCKmIWzx.js";import{_ as oa}from"./round-refresh-hOvscd3x.js";import{_ as na}from"./Grid-QN5liU_n.js";import{_ as la}from"./FormItemGridItem-BcqcE99s.js";import{_ as ra}from"./Tree-C2GUlBEo.js";import{h as de}from"./permission-2-taMuw3.js";import{N as pe}from"./Popconfirm-CVOkHwPe.js";const ia=J({name:"OperateDrawer",__name:"operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(w,{emit:P}){const v=[{label:"是",value:0},{label:"否",value:1}],c=w,U=P,i=te(w,"visible"),{formRef:N,validate:M,restoreValidation:C}=ce(),{createConfirmPwdRule:B,defaultRequiredRule:p,patternRules:u}=me(),m=Re(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[c.operateType]),o=fe(y());function y(){return{id:void 0,username:"",oripwd:"",password:"",confirmPassword:"",usertype:void 0,superadmin:0,userimage:"",phnum:"",udesc:"",status:0}}const h={username:p,usertype:{type:"string",required:!0,trigger:"change",message:"请选择用户类型"},status:{type:"number",required:!0,trigger:"change",message:"请选择用户状态"},oripwd:{...p,...u.password},password:{...p,...u.password},phnum:{...p,...u.mobile}};async function F(){if(Object.assign(o,y()),c.operateType==="edit"&&c.rowData){const{data:D,error:r}=await Oe(c.rowData.id);r?Object.assign(o,c.rowData):(Object.assign(o,D),o.usertype=o.usertype+"")}}function T(){i.value=!1}async function I(){var D,r;if(await M(),c.operateType==="add"){const{data:b,error:_}=await je(o);_||((D=window.$message)==null||D.success(l("common.addSuccess")),T(),U("submitted"))}else{const{data:b,error:_}=await Ie(o);_||((r=window.$message)==null||r.success(l("common.updateSuccess")),T(),U("submitted"))}}return _e(i,()=>{i.value&&(F(),C())}),(D,r)=>{const b=ne,_=ge,$=ve,X=Ve,z=W,G=ze,f=oe,q=S,H=Te,Q=Fe,n=V("no-special");return R(),O(Q,{show:i.value,"onUpdate:show":r[8]||(r[8]=e=>i.value=e),"display-directive":"show",width:360},{default:s(()=>[a(H,{title:m.value,"native-scrollbar":!1,closable:""},{footer:s(()=>[a(z,{size:16},{default:s(()=>[a(q,{onClick:T},{default:s(()=>[k(x(t(l)("common.cancel")),1)]),_:1}),a(q,{type:"primary",onClick:I},{default:s(()=>[k(x(t(l)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(f,{ref_key:"formRef",ref:N,model:o,rules:h},{default:s(()=>[a(_,{label:t(l)("page.manage.user.username"),path:"username"},{default:s(()=>[j(a(b,{value:o.username,"onUpdate:value":r[0]||(r[0]=e=>o.username=e),placeholder:t(l)("page.manage.user.form.username"),readonly:c.operateType==="edit"},null,8,["value","placeholder","readonly"]),[[n]])]),_:1},8,["label"]),c.operateType==="add"?(R(),O(_,{key:0,label:t(l)("page.login.common.password"),path:"password"},{default:s(()=>[a(b,{value:o.password,"onUpdate:value":r[1]||(r[1]=e=>o.password=e),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:t(l)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])):ie("",!0),c.operateType==="add"?(R(),O(_,{key:1,label:t(l)("page.login.common.confirmPassword"),path:"confirmPassword",rule:t(B)(o.password)},{default:s(()=>[a(b,{value:o.confirmPassword,"onUpdate:value":r[2]||(r[2]=e=>o.confirmPassword=e),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:t(l)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rule"])):ie("",!0),a(_,{label:"用户类型",path:"usertype"},{default:s(()=>[a($,{value:o.usertype,"onUpdate:value":r[3]||(r[3]=e=>o.usertype=e),clearable:"",filterable:"",placeholder:"请选择用户类型",options:t($e)(o.usertype==0?t(se):t(se).slice(1)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),a(_,{label:"用户状态",path:"status"},{default:s(()=>[a($,{value:o.status,"onUpdate:value":r[4]||(r[4]=e=>o.status=e),clearable:"",filterable:"",placeholder:"请选择用户类型",options:[{label:"正常",value:0},{label:"异常",value:1}],style:{width:"100%"}},null,8,["value"])]),_:1}),a(_,{label:"是否为我司内部人员",path:"superadmin"},{default:s(()=>[a(G,{value:o.superadmin,"onUpdate:value":r[5]||(r[5]=e=>o.superadmin=e),name:"radiogroup",disabled:""},{default:s(()=>[a(z,null,{default:s(()=>[(R(),we(Me,null,Be(v,(e,g)=>a(X,{key:g,value:e.value},{default:s(()=>[k(x(e.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])]),_:1}),a(_,{label:"手机号码",path:"phnum"},{default:s(()=>[a(b,{clearable:"",value:o.phnum,"onUpdate:value":r[6]||(r[6]=e=>o.phnum=e),maxlength:11,placeholder:"请输入手机号码"},null,8,["value"])]),_:1}),a(_,{label:"描述",path:"udesc"},{default:s(()=>[a(b,{type:"textarea",clearable:"",value:o.udesc,"onUpdate:value":r[7]||(r[7]=e=>o.udesc=e),placeholder:"请输入描述",autosize:{minRows:3}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ua=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(w,{emit:P}){const v=P,{formRef:c,restoreValidation:U}=ce(),i=te(w,"model");function N(){i.value.username="",v("search")}async function M(){await U(),i.value.usertype=null,i.value.username="",v("reset")}async function C(){v("search")}const B=u=>{i.value.usertype=u,v("search")},p=()=>{i.value.usertype=null,v("search")};return(u,m)=>{const o=ne,y=la,h=ve,F=oa,T=S,I=ta,D=W,r=na,b=oe,_=ye;return R(),O(_,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[a(b,{ref_key:"formRef",ref:c,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ge(C,["enter"])},{default:s(()=>[a(r,{responsive:"screen","item-responsive":""},{default:s(()=>[a(y,{span:"24 s:12 m:6",label:t(l)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:s(()=>[a(o,{clearable:"",value:i.value.username,"onUpdate:value":m[0]||(m[0]=$=>i.value.username=$),valueModifiers:{trim:!0},placeholder:t(l)("page.manage.user.form.username"),onClear:N},null,8,["value","placeholder"])]),_:1},8,["label"]),a(y,{span:"24 s:12 m:6",label:"用户类型",path:"usertype",class:"pr-24px"},{default:s(()=>[a(h,{value:i.value.usertype,"onUpdate:value":[m[1]||(m[1]=$=>i.value.usertype=$),B],clearable:"",placeholder:"请选择用户类型",onClear:p,options:t(qe)(t(se))},null,8,["value","options"])]),_:1}),a(y,{span:"24 s:12 m:6",class:"pr-24px"},{default:s(()=>[a(D,{class:"w-full"},{default:s(()=>[a(T,{onClick:M},{icon:s(()=>[a(F,{class:"text-icon"})]),default:s(()=>[k(" "+x(t(l)("common.reset")),1)]),_:1}),a(T,{type:"primary",ghost:"",onClick:C},{icon:s(()=>[a(I,{class:"text-icon"})]),default:s(()=>[k(" "+x(t(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),da=J({name:"assignRoles",__name:"assign-roles",props:E({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(w){const P=w,v=te(w,"visible");function c(){v.value=!1}const U=ue([]),i=async()=>{const{error:p,data:u}=await Le();if(!p){const m=JSON.parse(JSON.stringify(u));U.value=m.list.map(o=>o)}},N=ue([]),M=async(p,u,m)=>{var o;N.value=[(o=m.node)==null?void 0:o.id]};async function C(){var p,u,m;if(P.rowData.id){const{data:o,error:y}=await Ke(P.rowData.id,N.value.join(","));y||((p=window.$message)==null||p.destroyAll(),(m=(u=window.$message)==null?void 0:u.success)==null||m.call(u,l("common.modifySuccess")),c())}}function B(){P.rowData.id&&(i(),N.value=[P.rowData.roleId])}return _e(v,p=>{p&&B()}),(p,u)=>{const m=ra,o=S,y=W,h=he;return R(),O(h,{show:v.value,"onUpdate:show":u[0]||(u[0]=F=>v.value=F),preset:"card",class:"w-480px"},{header:s(()=>u[1]||(u[1]=[Ae("div",{class:"flex"},"设置用户角色",-1)])),footer:s(()=>[a(y,{justify:"end"},{default:s(()=>[a(o,{size:"small",class:"mt-16px",onClick:c},{default:s(()=>[k(x(t(l)("common.cancel")),1)]),_:1}),a(o,{type:"primary",size:"small",class:"mt-16px",onClick:C},{default:s(()=>[k(x(t(l)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(m,{cascade:"","checked-keys":N.value,data:U.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"","label-field":"name","key-field":"id","children-field":"children","onUpdate:checkedKeys":M},null,8,["checked-keys","data"])]),_:1},8,["show"])}}}),pa={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function L(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!Ze(w)}const Pa=J({name:"manage_user",__name:"index",setup(w){const P=Ee(),{columns:v,columnChecks:c,data:U,getData:i,loading:N,mobilePagination:M,searchParams:C,resetSearchParams:B}=ea({apiFn:Ye,apiParams:{page:1,pageSize:50,limit:50,username:null,usertype:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"username",title:l("page.manage.user.username"),align:"center",width:160},{key:"usertype",title:"用户类型",align:"center",width:120,render:n=>{const e=l(sa[n.usertype]);return a(ae,{type:"primary"},L(e)?e:{default:()=>[e]})}},{key:"phnum",title:"手机号码",align:"center",width:160},{key:"udesc",title:"描述",align:"center",width:200},{key:"status",title:l("page.manage.user.status"),align:"center",width:180,render:n=>(n.status===null?n.status=0:(n.status===2||n.status===3)&&(n.status=1),a(ae,{type:n.status==0?"success":n.status==1?"error":n.status==2?"warning":"success"},{default:()=>[n.status==0?"正常":n.status==1?"异常":n.status==2?"锁定":"正常"]}))},{key:"superadmin",title:"是否为我司内部人员",align:"center",width:160,render:n=>{const e=n.superadmin===0?"是":n.superadmin===1?"否":"未知",g=n.superadmin===0?"success":n.superadmin===1?"error":"default";return a(ae,{type:g},L(e)?e:{default:()=>[e]})}},{key:"createdate",title:l("page.manage.user.createDate"),align:"center",width:180},{key:"operate",title:l("common.operate"),align:"center",width:de("sys:user:update")&&de("sys:user:delete")?320:0,render:n=>{let e;return a("div",{class:"flex-center gap-8px"},[j(a(S,{type:"primary",ghost:!0,size:"small",onClick:()=>r(n.id)},L(e=l("common.edit"))?e:{default:()=>[e]}),[[V("no-auth"),"sys:user:update"]]),j(a(S,{type:"primary",ghost:!0,size:"small",onClick:()=>H(n)},{default:()=>["修改密码"]}),[[V("no-auth"),"sys:user:update"]]),n.superadmin!=0&&a(pe,{onPositiveClick:()=>D(n.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let g;return j(a(S,{type:"error",ghost:!0,size:"small"},L(g=l("common.delete"))?g:{default:()=>[g]}),[[V("no-auth"),"sys:user:delete"]])}})])}}]}),{drawerVisible:p,operateType:u,editingData:m,handleAdd:o,handleEdit:y,checkedRowKeys:h,onBatchDeleted:F,onDeleted:T}=aa(U,i);async function I(){console.log(h.value),b(h.value,n=>{F()})}function D(n){b([n],e=>{T()})}function r(n){y(n)}async function b(n,e){const g=await He(n);console.log("data",g),e&&e(g)}const _=ee(!1),{defaultRequiredRule:$,patternRules:X}=me(),z=ee(!1),G=ee(),f=fe({username:"",password:"",confirmPassword:"",id:null}),q={password:[$,X.password],confirmPassword:[{required:!0,message:l("form.confirmPwd.required")},{asyncValidator:(n,e)=>e.trim()!==""&&e!==f.password?Promise.reject(n.message):Promise.resolve(),message:l("form.confirmPwd.invalid"),trigger:"input"}]},H=n=>{z.value=!0,f.id=n.id,f.username=n.username,f.password="",f.confirmPassword=""},Q=async()=>{var g,A;if(!f.id)return;await((g=G.value)==null?void 0:g.validate());const{data:n,error:e}=await Qe(f.username,f.id,f.password);e||((A=window.$message)==null||A.success("修改成功"),z.value=!1)};return(n,e)=>{const g=Se,A=De,be=Ce,le=W,ke=Je,Ne=ye,Y=ne,Z=ge,xe=oe,Pe=Xe,Ue=he,re=V("no-auth");return R(),we("div",pa,[a(ua,{model:t(C),"onUpdate:model":e[0]||(e[0]=d=>K(C)?C.value=d:null),onReset:t(B),onSearch:t(i)},null,8,["model","onReset","onSearch"]),a(Ne,{title:t(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[a(le,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[j((R(),O(t(S),{onClick:t(o),size:"small",ghost:"",type:"primary"},{icon:s(()=>[a(g,{class:"text-icon"})]),default:s(()=>[e[10]||(e[10]=k(" "+x("新增")))]),_:1,__:[10]},8,["onClick"])),[[re,"sys:user:insert"]]),a(t(pe),{onPositiveClick:I},{trigger:s(()=>[j((R(),O(t(S),{size:"small",ghost:"",type:"error",disabled:t(h).length==0},{icon:s(()=>[a(A,{class:We(["text-icon",{"animate-spin":t(N)}])},null,8,["class"])]),default:s(()=>[e[11]||(e[11]=k(" "+x("批量删除")))]),_:1,__:[11]},8,["disabled"])),[[re,"sys:user:delete"]])]),default:s(()=>[e[12]||(e[12]=k(" 确定要删除选中的吗？ "))]),_:1,__:[12]}),a(be,{columns:t(c),"onUpdate:columns":e[1]||(e[1]=d=>K(c)?c.value=d:null)},null,8,["columns"])]),_:1})]),default:s(()=>[a(ke,{"checked-row-keys":t(h),"onUpdate:checkedRowKeys":e[2]||(e[2]=d=>K(h)?h.value=d:null),columns:t(v),data:t(U),size:"small","flex-height":!t(P).isMobile,"scroll-x":962,loading:t(N),remote:"","row-key":d=>d.id,pagination:t(M),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(ia,{visible:t(p),"onUpdate:visible":e[3]||(e[3]=d=>K(p)?p.value=d:null),"operate-type":t(u),"row-data":t(m),onSubmitted:t(i)},null,8,["visible","operate-type","row-data","onSubmitted"]),a(da,{"row-data":t(m),visible:_.value,"onUpdate:visible":e[4]||(e[4]=d=>_.value=d)},null,8,["row-data","visible"])]),_:1},8,["title"]),a(Ue,{show:z.value,"onUpdate:show":e[9]||(e[9]=d=>z.value=d),title:t(l)("common.updatePassword"),preset:"card",class:"w-620px"},{footer:s(()=>[a(le,{justify:"end",size:16},{default:s(()=>[a(t(S),{onClick:e[8]||(e[8]=d=>z.value=!1)},{default:s(()=>[k(x(t(l)("common.cancel")),1)]),_:1}),a(t(S),{type:"primary",onClick:Q},{default:s(()=>[k(x(t(l)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(Pe,{class:"max-h-480px pr-20px"},{default:s(()=>[a(xe,{ref_key:"formRef",ref:G,model:f,rules:q,"label-placement":"left","label-width":100,"require-mark-placement":"left"},{default:s(()=>[a(Z,{label:t(l)("page.manage.user.username"),path:"username"},{default:s(()=>[a(Y,{readonly:"",value:f.username,"onUpdate:value":e[5]||(e[5]=d=>f.username=d),placeholder:t(l)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(Z,{label:t(l)("page.login.common.password"),path:"password"},{default:s(()=>[a(Y,{type:"password","show-password-on":"click",clearable:"",value:f.password,"onUpdate:value":e[6]||(e[6]=d=>f.password=d),placeholder:t(l)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(Z,{label:t(l)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:s(()=>[a(Y,{type:"password","show-password-on":"click",clearable:"",value:f.confirmPassword,"onUpdate:value":e[7]||(e[7]=d=>f.confirmPassword=d),placeholder:t(l)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])])}}});export{Pa as default};
