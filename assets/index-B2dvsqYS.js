import{d as J,q as B,v as le,s as q,o as E,c as K,w as n,g as a,i as y,V as ne,aw as ie,h as x,t as D,$ as v,N as oe,ax as se,Y as ue,B as G,E as W,D as re,aa as Y,j as S,y as ce,r as R,an as H,e as j,aq as de,ar as pe,S as fe,F as me,ay as _e,az as ve,f as Q,ae as X,av as Z,a0 as ge}from"./index-g00S9pbc.js";import{f as he,a as ye,b as be,c as xe}from"./audit-events-B8bOdQjS.js";import{l as ee}from"./lodash-D-2Nu2uI.js";import{T as U}from"./basicconf-RaNFraFh.js";import{_ as we}from"./round-search-O6eekLFL.js";import{_ as ke}from"./round-refresh-DzVxh58h.js";import{u as Se}from"./usePageData-Df5REDf3.js";import{f as Te}from"./system-manage-BRpEmC8T.js";import{_ as De}from"./FormItemGridItem-dHIUWVHc.js";import{_ as Ne}from"./DatePicker-B0L1BwDW.js";import{_ as Ce}from"./Grid-gpKm_X0x.js";import{f as Ae}from"./events-DAq7ARCU.js";import{_ as ze,a as Ie}from"./DescriptionsItem-4xsy-N1c.js";import{_ as te}from"./DataTable-hpj7uXOd.js";import{e as Pe}from"./exportExcel-D6OyA9oJ.js";import"./TimePicker-Cd25ys76.js";import"./defineProperty-D-v2VQ28.js";import"./Forward-CnD1DDOA.js";const Ve=J({name:"FormSearch",__name:"form-search",props:B({AuditTypeData:{},AuditPolicyData:{}},{model:{required:!0},modelModifiers:{}}),emits:B(["reset","search"],["update:model"]),setup(d,{emit:A}){const N=d,o=A,{formRef:z,restoreValidation:b}=le(),i=q(d,"model");Se(Te);async function w(k,t){k&&k.length>0?(i.value.startTime=k[0],i.value.endTime=k[1]):(i.value.startTime=null,i.value.endTime=null)}async function M(){await b(),i.value.timeRange=null,i.value.atype=null,i.value.ap=null,i.value.startTime=null,i.value.endTime=null,i.value.elevel=null,se(()=>{o("search")})}async function m(){o("search")}return(k,t)=>{const r=ue,c=De,g=Ne,I=ke,h=G,T=we,C=W,P=Ce,V=re,s=Y;return E(),K(s,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(V,{ref_key:"formRef",ref:z,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:oe(m,["enter"])},{default:n(()=>[a(P,{responsive:"screen","item-responsive":""},{default:n(()=>[a(c,{span:"24 s:12 m:8",label:"事件等级",path:"elevel",class:"pr-24px"},{default:n(()=>[a(r,{filterable:"",clearable:"",value:i.value.elevel,"onUpdate:value":[t[0]||(t[0]=e=>i.value.elevel=e),m],placeholder:"请选择事件等级",options:y(ne)(y(ie))},null,8,["value","options"])]),_:1}),a(c,{span:"24 s:12 m:8",label:"审计类型",path:"atype",class:"pr-24px"},{default:n(()=>[a(r,{value:i.value.atype,"onUpdate:value":[t[1]||(t[1]=e=>i.value.atype=e),m],placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:N.AuditTypeData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(c,{span:"24 s:12 m:8",label:"审计策略",path:"ap",class:"pr-24px"},{default:n(()=>[a(r,{value:i.value.ap,"onUpdate:value":[t[2]||(t[2]=e=>i.value.ap=e),m],placeholder:"请选择审计策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:N.AuditPolicyData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(c,{span:"24 s:12 m:8",label:"产生时间",path:"timeRange",class:"pr-24px mt-20px"},{default:n(()=>[a(g,{clearable:"",value:i.value.timeRange,"onUpdate:value":t[3]||(t[3]=e=>i.value.timeRange=e),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":w},null,8,["value"])]),_:1}),a(c,{span:"24 s:12 m:6",class:"pr-24px mt-20px",label:" "},{default:n(()=>[a(C,{class:"w-full"},{default:n(()=>[a(h,{onClick:M},{icon:n(()=>[a(I,{class:"text-icon"})]),default:n(()=>[x(" "+D(y(v)("common.reset")),1)]),_:1}),a(h,{type:"primary",ghost:"",onClick:m},{icon:n(()=>[a(T,{class:"text-icon"})]),default:n(()=>[x(" "+D(y(v)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ae=d=>(_e("data-v-18a99fe8"),d=d(),ve(),d),$e=ae(()=>Q("span",null,"事件信息",-1)),Oe=ae(()=>Q("span",null,"事件溯源",-1)),Ee={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"500px"}},Me={key:1,class:"max-h-500px min-h-320px"};function Le(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!X(d)}const Re=J({__name:"detailInfo",props:B({detailInfo:{},AuditTypeData:{},AuditPolicyData:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(d){const A=q(d,"detailVisible"),N=d,o=S();ce(()=>A.value,async t=>{t&&(o.value=N.detailInfo,w())});const z=[{title:"",key:"index",width:50,render:(t,r)=>`${r+1}`},{key:"ename",title:"安全事件名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"安全事件类型",align:"center",width:140},{key:"pname2",title:"安全事件类别",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:t=>{(t.elevel===void 0||t.elevel===null)&&(t.elevel=1);const r={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},c=v(U[t.elevel]);let g={color:r[t.elevel],textColor:"#ffffff",borderColor:r[t.elevel]};return a(H,{size:"small",color:g},Le(c)?c:{default:()=>[c]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:180},{key:"type",title:"发生源设备类型",align:"center",width:160}],b=S(!1);let i=R([]);const w=async t=>{var g;if(!b.value)b.value=!0;else return;const{data:r,error:c}=await Ae({pageId:t,auditid:(g=o.value)==null?void 0:g.auditid,limit:20});c||(b.value=!1,t?i=[...i,...r]:i=r)};function M(t){var r;t.target.scrollTop+t.target.offsetHeight==t.target.scrollHeight&&((r=o.value)==null?void 0:r.eco)>i.length&&m()}const m=ee.debounce(()=>{w(i[i.length-1].id)},300),k=R({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:t,endIndex:r,page:c,pageSize:g,pageCount:I,itemCount:h}){var T,C;return`已加载${i.length}条 共${(i.length>((T=o.value)==null?void 0:T.eco)?i.length:(C=o.value)==null?void 0:C.eco)||0}条`}});return(t,r)=>{const c=ze,g=Ie,I=W,h=de,T=te,C=pe,P=fe,V=me;return E(),K(V,{show:A.value,"onUpdate:show":r[0]||(r[0]=s=>A.value=s),title:"事件详情",preset:"card",class:"w-1200px"},{default:n(()=>[a(P,{class:"max-h-600px pr-20px"},{default:n(()=>[a(C,{type:"line",animated:""},{default:n(()=>[a(h,{name:"1"},{tab:n(()=>[$e]),default:n(()=>[a(I,{vertical:"",size:12},{default:n(()=>[a(g,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:n(()=>[a(c,{label:"审计事件名称"},{default:n(()=>{var s;return[x(D((s=o.value)==null?void 0:s.aename),1)]}),_:1}),a(c,{label:"审计类型"},{default:n(()=>{var s,e;return[x(D(((s=N.AuditTypeData.find(l=>{var u;return l.id===((u=o.value)==null?void 0:u.atype)}))==null?void 0:s.atypename)||((e=o.value)==null?void 0:e.atype)||""),1)]}),_:1}),a(c,{label:"审计策略"},{default:n(()=>{var s,e;return[x(D(((s=N.AuditPolicyData.find(l=>{var u;return l.id===((u=o.value)==null?void 0:u.ap)}))==null?void 0:s.pname)||((e=o.value)==null?void 0:e.ap)||""),1)]}),_:1}),a(c,{label:"事件等级"},{default:n(()=>{var s,e,l,u,f,_,p,$,L,O;return[a(y(H),{size:"small",color:{textColor:"#ffffff",borderColor:((s=o.value)==null?void 0:s.alevel)===0?"#8e9dff":((e=o.value)==null?void 0:e.alevel)===1?"#5da8ff":((l=o.value)==null?void 0:l.alevel)===2?"#fedc69":((u=o.value)==null?void 0:u.alevel)===3?"#ff9874":((f=o.value)==null?void 0:f.alevel)===4?"#ff0000":"#5da8ff",color:((_=o.value)==null?void 0:_.alevel)===0?"#8e9dff":((p=o.value)==null?void 0:p.alevel)===1?"#5da8ff":(($=o.value)==null?void 0:$.alevel)===2?"#fedc69":((L=o.value)==null?void 0:L.alevel)===3?"#ff9874":((O=o.value)==null?void 0:O.alevel)===4?"#ff0000":"#5da8ff"}},{default:n(()=>{var F;return[x(D(y(v)(y(U)[(F=o.value)==null?void 0:F.alevel])),1)]}),_:1},8,["color"])]}),_:1}),a(c,{label:"产生时间"},{default:n(()=>{var s;return[x(D((s=o.value)==null?void 0:s.dbtime),1)]}),_:1}),a(c,{label:"更新时间"},{default:n(()=>{var s;return[x(D((s=o.value)==null?void 0:s.uptime),1)]}),_:1}),a(c,{label:"事件总数"},{default:n(()=>{var s;return[x(D((s=o.value)==null?void 0:s.eco),1)]}),_:1})]),_:1})]),_:1})]),_:1}),a(h,{name:"2"},{tab:n(()=>[Oe]),default:n(()=>[y(i).length==0?(E(),j("div",Ee," 暂无安全事件信息 ")):(E(),j("div",Me,[a(T,{columns:z,remote:"",data:y(i),size:"small","scroll-x":762,"row-key":s=>s.id,"virtual-scroll":"",class:"sm:h-full","max-height":400,loading:b.value,pagination:k,onScroll:M},null,8,["data","row-key","loading","pagination"])]))]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ue=Z(Re,[["__scopeId","data-v-18a99fe8"]]),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Ge(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!X(d)}const He=J({name:"audit_event",__name:"index",setup(d){const A=S(window.innerHeight-395),N=ge(),o=S(!1),z=S(),b=S([]);(async()=>{const{data:e,error:l}=await he({page:1,limit:1e3});l||(b.value=JSON.parse(JSON.stringify(e)).list)})();const w=S([]);(async()=>{const{data:e,error:l}=await ye({page:1,limit:1e3});l||(w.value=JSON.parse(JSON.stringify(e)).list)})();const m=R({limit:20,pageId:void 0,elevel:void 0,atype:void 0,uid:void 0,suditPolicy:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),k=[{key:"aename",title:v("page.audit.event.eventName"),align:"center",minWidth:160,ellipsis:!0,resizable:!0},{key:"atype",title:v("page.audit.event.type"),align:"center",minWidth:160,render:e=>{var u;const l=(u=b.value.find(f=>f.id===e.atype))==null?void 0:u.atypename;return a("span",null,[l||e.atype])},resizable:!0},{key:"dbtime",title:v("page.audit.event.createTime"),align:"center",width:180,resizable:!0},{key:"uptime",title:v("page.audit.event.updateTime"),align:"center",width:180,resizable:!0},{key:"ap",title:v("page.audit.event.strategy"),align:"center",width:120,render:e=>{var u;const l=(u=w.value.find(f=>f.id===e.ap))==null?void 0:u.pname;return a("span",null,[l||e.ap])},resizable:!0},{key:"alevel",title:v("page.audit.event.eventRanK"),align:"center",width:120,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=0);const l={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},u=v(U[e.alevel]);let f={color:l[e.alevel],textColor:"#ffffff",borderColor:l[e.alevel]};return a(H,{size:"small",color:f},Ge(u)?u:{default:()=>[u]})},resizable:!0},{key:"eco",title:v("page.audit.event.eventCount"),align:"center",width:120,resizable:!0},{key:"operate",title:v("common.operate"),align:"center",width:130,fixed:"right",render:e=>a("div",{class:"flex-center gap-8px"},[a(G,{type:"primary",ghost:!0,size:"small",onClick:()=>V(e)},{default:()=>[x("详情")]})])}],t=S([]),r=S(!1),c=async(e=!1)=>{if(!r.value)r.value=!0;else return;r.value=!0;const{data:l,error:u}=await be(m);u||(e?t.value=[...t.value,...l]:t.value=l,r.value=!1)};c();const g=S(!0),I=()=>{t.value=[],m.pageId=void 0,(l=>Object.keys(l).filter(_=>_!=="limit"&&_!=="_t").some(_=>l[_]!==void 0&&l[_]!==""&&l[_]!==null))(m)?g.value=!1:(g.value=!0,T()),c()},h=R({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:l,page:u,pageSize:f,pageCount:_,itemCount:p}){return`已加载${t.value.length}条`+(t.value.length?g.value?` 共计 ${t.value.length>0?p??0:0} 条`:t.value.length>=m.limit?"  预计还有更多":"":"")}});async function T(){const{data:e,error:l}=await xe();l||(h.pageCount=20,h.total=Number(e),h.itemCount=Number(e))}T();function C(e){var u;Math.abs(e.target.scrollTop+e.target.offsetHeight-e.target.scrollHeight)<=16&&h.total>((u=t.value)==null?void 0:u.length)&&P()}const P=ee.debounce(()=>{var e;((e=t.value)==null?void 0:e.length)<h.total&&(m.pageId=t.value[t.value.length-1].id,c(!0))},300);async function V(e){z.value=e,o.value=!0}async function s(){if(!t.value.length)return;const e=JSON.parse(JSON.stringify(t.value)),l=[];e.forEach(f=>{const _={};k.forEach(p=>{var $;if(f.hasOwnProperty(p.key)){const L=p.key=="alevel"?v(U[f[p.key]]):p.key=="ap"?($=w.value.find(O=>O.id===O[p.key]))==null?void 0:$.pname:f[p.key];_[p.title]=L}}),l.push(_)}),Pe(l,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50}],"审计事件_"+new Date().getTime())}return(e,l)=>{const u=W,f=te,_=Y;return E(),j("div",Be,[a(Ve,{model:m,"onUpdate:model":l[0]||(l[0]=p=>m=p),onSearch:I,AuditTypeData:b.value,AuditPolicyData:w.value},null,8,["model","AuditTypeData","AuditPolicyData"]),a(_,{title:y(v)("page.audit.event.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(u,null,{default:n(()=>[a(y(G),{type:"primary",size:"small",ghost:"",onClick:s,title:"导出已加载"},{default:n(()=>[x("导出已加载")]),_:1})]),_:1})]),default:n(()=>[a(f,{columns:k,data:t.value,size:"small","virtual-scroll":"","flex-height":!y(N).isMobile,loading:r.value,remote:"","row-key":p=>p.id,"max-height":A.value,pagination:h,onScroll:C,class:"sm:h-full","scroll-x":""},null,8,["data","flex-height","loading","row-key","max-height","pagination"]),a(Ue,{"detail-visible":o.value,"onUpdate:detailVisible":l[1]||(l[1]=p=>o.value=p),"detail-info":z.value,AuditTypeData:b.value,AuditPolicyData:w.value},null,8,["detail-visible","detail-info","AuditTypeData","AuditPolicyData"])]),_:1},8,["title"])])}}}),ut=Z(He,[["__scopeId","data-v-2cc42375"]]);export{ut as default};
