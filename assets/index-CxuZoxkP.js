import{_ as ce,a as de}from"./close-small-rounded-DyOZ6WuX.js";import{d as O,v as X,r as F,J as $e,K as L,o as b,c as x,w as n,f as S,g as t,h as _,i as D,L as E,R as Te,a$ as pe,C as G,B as q,ao as Z,bb as me,E as P,D as J,S as K,T as _e,U as fe,V as Q,j as N,t as M,ad as A,e as z,an as ge,bc as Se,bd as Ue,aB as De,A as W,aY as Ve,N as B,be as ee,bf as te,az as ye,bg as ne,bh as ae,aq as Ie,ap as Ne,a2 as H,ai as se,at as Be,O as ve,bi as Ee,y as qe,bj as Pe,bk as Me,Q as Oe,aw as Ge,ax as je}from"./index-ByfxsQvj.js";import{h as Re,i as Fe,j as Le,k as Ae,l as ze,m as Je,n as We,o as He,p as Ke,q as Qe,r as Ye,s as Xe,t as Ze,u as et,v as tt,w as nt,x as at,y as st,z as lt,A as ot,B as it,C as rt,D as ut,E as ct,F as dt,G as pt,H as mt,I as _t}from"./basic-config-D49RGM7T.js";import{M as ft}from"./shield-question-outline-rounded-BGgSXgir.js";import{_ as be}from"./Table-B7QWYAFs.js";import{f as le}from"./reportForm-CQTYrTfT.js";import{f as oe}from"./scheduleTask-BTomRokq.js";import{_ as gt}from"./DatePicker-ChOIwL9T.js";import{_ as ie}from"./TimePicker-Bw31iYnN.js";import{u as re}from"./table-Ca-5bYro.js";import{_ as yt}from"./FormItemGridItem-Dtr_7n7z.js";import{_ as vt}from"./Grid-B9K_tFX2.js";import{_ as bt}from"./Popconfirm-Bx1fZnQD.js";import{_ as he}from"./Upload-BPNrVbAn.js";import{u as ht}from"./usePageData-lPm5H_26.js";import{a as wt}from"./events--VzTCbWs.js";import"./defineProperty-D9xlJP3p.js";import"./Progress-B01mUdYA.js";const we=I=>(_e("data-v-cbaf2399"),I=I(),fe(),I),kt={class:"flex justify-center"},Ct=we(()=>S("span",{class:"font-bold"},"提示：",-1)),xt=we(()=>S("span",{style:{"text-decoration":"underline"}},"被锁定的账号会在设定的时间周期后自动解锁",-1)),$t=O({name:"basicConfig",__name:"basicConfig",setup(I){const{formRef:c,validate:v,restoreValidation:s}=X(),o=F(h());function h(){return{enablelock:1,locktime:5,lockcount:3,unlockeanble:1,unlocktime:5,aceffective:1,pwdexpire:1,expiretime:1,cputhreshold:80,memthreshold:80,captcha:1,tokentime:30}}const $={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},T={locktime:$,lockcount:$,unlocktime:$,expiretime:$,cputhreshold:$,memthreshold:$,tokentime:$},y=async()=>{const{data:l,error:a}=await Re();a||(Object.assign(o,l),o.locktime=l.locktime/60,o.unlocktime=l.unlocktime/60)};$e(()=>{y()});const e=async()=>{var d;const l=o.locktime*60,a=o.unlocktime*60;await v();const{error:r}=await Fe({...o,locktime:l,unlocktime:a});r||(d=window.$message)==null||d.success("设置成功")};return(l,a)=>{const r=Te,d=pe,u=G,p=q,m=Z,i=me,f=P,g=J,k=K,C=L("no-auth");return b(),x(k,{style:{"max-height":"calc(100vh - 245px)"}},{default:n(()=>[S("div",kt,[t(g,{ref_key:"formRef",ref:c,"label-width":180,"label-placement":"left",model:o,rules:T},{default:n(()=>[t(u,{label:"是否开启自动解锁",path:"unlockeanble"},{label:n(()=>[_(" 是否开启自动解锁 "),t(r,{trigger:"hover",placement:"top","content-style":"padding: 5px;"},{trigger:n(()=>[t(D(ft),{class:"text-xl cursor-pointer c-#7a7b78"})]),default:n(()=>[Ct,xt]),_:1})]),default:n(()=>[t(d,{value:o.unlockeanble,"onUpdate:value":a[0]||(a[0]=w=>o.unlockeanble=w),disabled:"","checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),t(u,{label:"解锁时间",path:"unlocktime"},{default:n(()=>[t(i,{class:"flex items-center"},{default:n(()=>[t(p,{onClick:a[1]||(a[1]=w=>o.unlocktime--),disabled:o.unlocktime==o.locktime||o.unlockeanble==0},{default:n(()=>[_(" − ")]),_:1},8,["disabled"]),t(m,{"show-button":!1,value:o.unlocktime,"onUpdate:value":a[2]||(a[2]=w=>o.unlocktime=w),placeholder:"",min:o.locktime,disabled:o.unlockeanble==0},null,8,["value","min","disabled"]),t(p,{onClick:a[3]||(a[3]=w=>o.unlocktime++),class:"mr-5px",disabled:o.unlockeanble==0},{default:n(()=>[_(" + ")]),_:1},8,["disabled"]),_(" 小时 ")]),_:1})]),_:1}),t(u,{label:"是否开启验证码",path:"captcha"},{default:n(()=>[t(d,{value:o.captcha,"onUpdate:value":a[4]||(a[4]=w=>o.captcha=w),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),t(u,{label:"密码过期时间",path:"expiretime"},{default:n(()=>[t(i,{class:"flex items-center"},{default:n(()=>[t(p,{onClick:a[5]||(a[5]=w=>o.expiretime--),disabled:o.expiretime==1},{default:n(()=>[_(" − ")]),_:1},8,["disabled"]),t(m,{"show-button":!1,value:o.expiretime,"onUpdate:value":a[6]||(a[6]=w=>o.expiretime=w),placeholder:"",min:1},null,8,["value"]),t(p,{onClick:a[7]||(a[7]=w=>o.expiretime++),class:"mr-5px"},{default:n(()=>[_(" + ")]),_:1}),_(" 天 ")]),_:1})]),_:1}),t(u,{label:"CPU阈值",path:"cputhreshold"},{default:n(()=>[t(i,{class:"flex items-center"},{default:n(()=>[t(p,{onClick:a[8]||(a[8]=w=>o.cputhreshold--),disabled:o.cputhreshold==0},{default:n(()=>[_(" − ")]),_:1},8,["disabled"]),t(m,{"show-button":!1,value:o.cputhreshold,"onUpdate:value":a[9]||(a[9]=w=>o.cputhreshold=w),placeholder:"",min:0,precision:0,max:100},null,8,["value"]),t(p,{onClick:a[10]||(a[10]=w=>o.cputhreshold++),disabled:o.cputhreshold==100,class:"mr-5px"},{default:n(()=>[_(" + ")]),_:1},8,["disabled"]),_(" % ")]),_:1})]),_:1}),t(u,{label:"MEM阈值",path:"memthreshold"},{default:n(()=>[t(i,{class:"flex items-center"},{default:n(()=>[t(p,{onClick:a[11]||(a[11]=w=>o.memthreshold--),disabled:o.memthreshold==0},{default:n(()=>[_(" − ")]),_:1},8,["disabled"]),t(m,{"show-button":!1,value:o.memthreshold,"onUpdate:value":a[12]||(a[12]=w=>o.memthreshold=w),placeholder:"",min:0,precision:0,max:100},null,8,["value"]),t(p,{onClick:a[13]||(a[13]=w=>o.memthreshold++),disabled:o.memthreshold==100,class:"mr-5px"},{default:n(()=>[_(" + ")]),_:1},8,["disabled"]),_(" % ")]),_:1})]),_:1}),t(u,{label:"token过期时间",path:"tokentime"},{default:n(()=>[t(i,{class:"flex items-center"},{default:n(()=>[t(p,{onClick:a[14]||(a[14]=w=>o.tokentime--),disabled:o.tokentime==1},{default:n(()=>[_(" − ")]),_:1},8,["disabled"]),t(m,{"show-button":!1,value:o.tokentime,"onUpdate:value":a[15]||(a[15]=w=>o.tokentime=w),placeholder:"",min:1},null,8,["value"]),t(p,{onClick:a[16]||(a[16]=w=>o.tokentime++),class:"mr-5px"},{default:n(()=>[_(" + ")]),_:1}),_(" 小时 ")]),_:1})]),_:1}),t(u,{label:" "},{default:n(()=>[t(f,null,{default:n(()=>[E((b(),x(p,{type:"default",ghost:"",onClick:y},{default:n(()=>[_(" 刷新 ")]),_:1})),[[C,"system.conf.select"]]),E((b(),x(p,{type:"info",ghost:"",onClick:e},{default:n(()=>[_(" 保存 ")]),_:1})),[[C,"system.conf.update"]])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})}}}),Tt=Q($t,[["__scopeId","data-v-cbaf2399"]]),St=S("td",null,"产品名称",-1),Ut=S("td",null,"产品版本",-1),Dt=S("td",null,"build号",-1),Vt=S("td",null,"产品型号",-1),It=O({name:"basicInfo",__name:"basicInfo",setup(I){const c=N({id:1,pname:"",pversion:"",pbuild:"",pmodel:""});(async()=>{const{data:h,error:$}=await Le();$||(c.value=h)})(),N(0);const s=async()=>{var T,y;const{data:h,error:$}=await Ae();$||(h==="重启失败"?(T=window.$message)==null||T.error(h):(y=window.$message)==null||y.success(h))},o=async()=>{var T,y;const{data:h,error:$}=await ze();$||(h==="关机失败"?(T=window.$message)==null||T.error(h):(y=window.$message)==null||y.success(h))};return(h,$)=>{const T=be,y=q,e=P,l=A,a=L("no-auth");return b(),x(l,{class:"w-600px text-center m-auto mt-20px"},{default:n(()=>[t(T,{bordered:!0,"single-line":!1},{default:n(()=>[S("tbody",null,[S("tr",null,[St,S("td",null,M(c.value.pname||""),1)]),S("tr",null,[Ut,S("td",null,M(c.value.pversion),1)]),S("tr",null,[Dt,S("td",null,M(c.value.pbuild),1)]),S("tr",null,[Vt,S("td",null,M(c.value.pmodel),1)])])]),_:1}),t(e,{justify:"center",class:"mt-50px"},{default:n(()=>[E((b(),x(y,{type:"info",ghost:"",onClick:s},{default:n(()=>[_("重启")]),_:1})),[[a,"sysmanger.basicInfo.restart"]]),E((b(),x(y,{type:"info",ghost:"",onClick:o},{default:n(()=>[_("关机")]),_:1})),[[a,"sysmanger.basicInfo.shutdown"]])]),_:1})]),_:1})}}}),Nt=O({name:"emailService",__name:"emailSever",setup(I){const{formRef:c,validate:v}=X(),s=N({port:void 0,pwd:"",sendserver:"",essl:0,uname:""}),o={sendserver:[{required:!0,validator:(e,l,a)=>l?Se(l)?a():a(new Error("请输入正确的IP地址或域名")):new Error("请输入服务器地址"),trigger:["blur","input"]}],port:{type:"number",required:!0,trigger:["blur","input"],validator:(e,l,a)=>l==null||l==null?new Error("请输入端口号"):Ue(l)?!0:new Error("请输入在0-65535之间的数字")},uname:[{required:!0,message:"请输入账号",trigger:"blur"}],pwd:[{required:!0,message:"请输入密码",trigger:"blur"}],sendaddr:[{required:!0,message:"请输入发件邮箱",trigger:["blur","input"]},{validator:De,trigger:["blur","input"]}]},h=async()=>{const{data:e,error:l}=await Je();l||(s.value.sendserver=(e==null?void 0:e.sendserver)??s.value.sendserver,s.value.port=(e==null?void 0:e.port)??s.value.port,s.value.pwd=(e==null?void 0:e.pwd)??s.value.pwd,s.value.essl=(e==null?void 0:e.essl)??s.value.essl,s.value.uname=(e==null?void 0:e.uname)??s.value.uname,s.value.id=(e==null?void 0:e.id)??s.value.id)};h();const $=async()=>{var e,l,a,r;if(await v(),s.value.id){const{data:d,error:u}=await We(s.value);u||((e=window.$message)==null||e.destroyAll(),(l=window.$message)==null||l.success("保存成功"))}else{const{data:d,error:u}=await He(s.value);u||((a=window.$message)==null||a.destroyAll(),(r=window.$message)==null||r.success("保存成功"))}},T=async()=>{var a,r;const{data:e,error:l}=await Ke();l||((a=window.$message)==null||a.destroyAll(),(r=window.$message)==null||r.success("重置成功"),h())},y=async()=>{var a,r;await v();const{data:e,error:l}=await Qe(s.value);l||((a=window.$message)==null||a.destroyAll(),(r=window.$message)==null||r.success("测试成功"))};return(e,l)=>{const a=W,r=G,d=Z,u=pe,p=J,m=q,i=P,f=L("no-auth");return b(),z(ge,null,[t(p,{ref_key:"formRef",ref:c,"label-width":150,model:s.value,rules:o,"label-placement":"left",class:"w-400px",style:{margin:"50px auto"}},{default:n(()=>[t(r,{label:"发送邮件服务器",path:"sendserver"},{default:n(()=>[t(a,{value:s.value.sendserver,"onUpdate:value":l[0]||(l[0]=g=>s.value.sendserver=g),placeholder:"输入服务器或IP地址"},null,8,["value"])]),_:1}),t(r,{label:"端口",path:"port"},{default:n(()=>[t(d,{value:s.value.port,"onUpdate:value":l[1]||(l[1]=g=>s.value.port=g),placeholder:"输入端口",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{label:"用户名",path:"uname"},{default:n(()=>[t(a,{value:s.value.uname,"onUpdate:value":l[2]||(l[2]=g=>s.value.uname=g),placeholder:"用户名"},null,8,["value"])]),_:1}),t(r,{label:"密码",path:"pwd"},{default:n(()=>[t(a,{type:"password",value:s.value.pwd,"onUpdate:value":l[3]||(l[3]=g=>s.value.pwd=g),placeholder:"密码","show-password-on":"click"},null,8,["value"])]),_:1}),t(r,{label:"ssl",path:"essl"},{default:n(()=>[t(u,{value:s.value.essl,"onUpdate:value":l[4]||(l[4]=g=>s.value.essl=g),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"]),t(i,{justify:"center"},{default:n(()=>[E((b(),x(m,{type:"info",ghost:"",onClick:y},{default:n(()=>[_("测试")]),_:1})),[[f,"sysmanger.basicInfo.test.mailInfo"]]),E((b(),x(m,{type:"info",ghost:"",onClick:$},{default:n(()=>[_("保存")]),_:1})),[[f,"sysmanger.mailInfo.update"]]),E((b(),x(m,{type:"info",ghost:"",onClick:T},{default:n(()=>[_("重置")]),_:1})),[[f,"sysmanger.mailInfo.delete"]])]),_:1})],64)}}}),Bt=O({name:"TimingConfig",__name:"timingConfig",setup(I){const{formRef:c,validate:v}=X(),s=F({automatic:1,time:Ve(1,new Date),ip:"",taskId:"",showCron:!1,setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),o={time:{required:!0,message:"请选择时间",trigger:"blur"},ip:[{required:!0,message:"请输入IP",trigger:"blur"},{validator:ye,trigger:"blur"}],task:{required:!0,message:"请设置表达式",trigger:"blur"},setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}},h=async()=>{const{data:y,error:e}=await Ye();e||(s.time=y)};h(),(async()=>{const{data:y,error:e}=await Xe();if(e)return;const{id:l,params:a}=y;try{if(a){const{cron:r,ip:d}=JSON.parse(a),u=ne(r);s.setting.settingCycle=u==null?void 0:u.settingCycle,s.setting.settingTime=u==null?void 0:u.settingTime,s.setting.settingCycleValue=u==null?void 0:u.settingCycleValue,s.ip=d,s.taskId=l}}catch(r){console.error("Error parsing params:",r)}})();const T=async()=>{var y,e;if(await v(),s.automatic){const{data:l,error:a}=await Ze({dtime:s.time});a||(y=window.$message)==null||y.success(l)}else{const l=ae(s.setting.settingCycle==1?{dayOfWeek:s.setting.settingCycleValue,time:s.setting.settingTime}:null,s.setting.settingCycle==2?{dayOfMonth:s.setting.settingCycleValue,time:s.setting.settingTime}:null,s.setting.settingCycle==3?{time:s.setting.settingTime}:null);s.taskId?await oe({id:s.taskId,beanName:"NtpTask",cronExpression:l,remark:"",status:1,params:JSON.stringify({ip:s.ip,cron:l})}):await le({beanName:"NtpTask",cronExpression:l,remark:"",status:1,params:JSON.stringify({ip:s.ip,cron:l})});const{data:a,error:r}=await et({ip:s.ip});r||(e=window.$message)==null||e.success(a)}};return(y,e)=>{const l=Ie,a=P,r=Ne,d=G,u=gt,p=W,m=H,i=ie,f=q,g=J,k=L("no-auth");return b(),x(g,{ref_key:"formRef",ref:c,"label-width":180,"label-placement":"left",model:s,class:"m-auto w-600px mt-20px",rules:o},{default:n(()=>[t(d,{label:"校时",path:"enablelock"},{default:n(()=>[t(r,{value:s.automatic,"onUpdate:value":e[0]||(e[0]=C=>s.automatic=C),name:"radiogroup"},{default:n(()=>[t(a,null,{default:n(()=>[t(l,{value:1},{default:n(()=>[_("手动校时")]),_:1}),t(l,{value:0},{default:n(()=>[_("自动校时")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),s.automatic?(b(),x(d,{key:0,label:"设置中心服务器时间",path:"time"},{default:n(()=>[t(u,{"formatted-value":s.time,"onUpdate:formattedValue":e[1]||(e[1]=C=>s.time=C),format:"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:""},null,8,["formatted-value"])]),_:1})):B("",!0),s.automatic?B("",!0):(b(),z(ge,{key:1},[t(d,{label:"NTP服务器设置",path:"ip"},{default:n(()=>[t(p,{value:s.ip,"onUpdate:value":e[2]||(e[2]=C=>s.ip=C),placeholder:"输入NTP服务器设置",style:{width:"200px"}},null,8,["value"])]),_:1}),t(d,{label:"设置周期",path:"setting.settingCycle"},{default:n(()=>[t(a,{justify:"space-between"},{default:n(()=>[t(m,{value:s.setting.settingCycle,"onUpdate:value":[e[3]||(e[3]=C=>s.setting.settingCycle=C),e[4]||(e[4]=C=>s.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"200px"}},null,8,["value"]),t(d,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:n(()=>[t(a,null,{default:n(()=>[s.setting.settingCycle==1?(b(),x(m,{key:0,value:s.setting.settingCycleValue,"onUpdate:value":e[5]||(e[5]=C=>s.setting.settingCycleValue=C),options:D(ee)(),style:{width:"200px"}},null,8,["value","options"])):B("",!0),s.setting.settingCycle==2?(b(),x(m,{key:1,value:s.setting.settingCycleValue,"onUpdate:value":e[6]||(e[6]=C=>s.setting.settingCycleValue=C),options:D(te)(),style:{width:"200px"}},null,8,["value","options"])):B("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(d,{label:"设置时间",path:"setting.settingTime"},{default:n(()=>[t(i,{"formatted-value":s.setting.settingTime,"onUpdate:formattedValue":e[7]||(e[7]=C=>s.setting.settingTime=C)},null,8,["formatted-value"])]),_:1})],64)),t(d,null,{label:n(()=>[s.automatic?E((b(),x(f,{key:0,type:"info",ghost:"",onClick:h},{default:n(()=>[_(" 查看服务器时间 ")]),_:1})),[[k,"sysmanger.basicInfo.gettiming"]]):B("",!0)]),default:n(()=>[t(a,null,{default:n(()=>[E((b(),x(f,{type:"info",ghost:"",onClick:T},{default:n(()=>[_(" 保存 ")]),_:1})),[[k,"sysmanger.basicInfo.manu.timing"]])]),_:1})]),_:1})]),_:1},8,["model"])}}}),Et=O({name:"dataBase",__name:"dataBase",setup(I){const c=()=>[...Array(12).keys()].map(d=>({label:`${d+1}个月`,value:d+1})),v=F({space:80,retention:void 0,id:void 0}),{columns:s,columnChecks:o,data:h,getData:$,loading:T,mobilePagination:y,searchParams:e,resetSearchParams:l}=re({apiFn:tt,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center"}]});(async()=>{const{data:d,error:u}=await nt();u||(v.space=d.space,v.retention=d.retention,v.id=d.id)})();const r=async()=>{var p;const{data:d,error:u}=await at({space:v.space,retention:v.retention,id:v.id});u||(p=window.$message)==null||p.success("保存成功")};return(d,u)=>{const p=q,m=Z,i=me,f=G,g=H,k=P,C=A,w=se,R=K,j=L("no-auth");return b(),x(R,{class:"h-full flex-col",style:{maxHeight:"calc(100vh - 220px)"}},{default:n(()=>[t(C,{title:"数据库维护配置",bordered:!1,class:"mb-20px","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[t(k,{class:"ml-50px"},{default:n(()=>[t(f,{label:"已用空间超过","label-placement":"left"},{default:n(()=>[t(i,{class:"flex items-center"},{default:n(()=>[t(p,{onClick:u[0]||(u[0]=U=>v.space--),disabled:v.space==1},{default:n(()=>[_(" − ")]),_:1},8,["disabled"]),t(m,{"show-button":!1,value:v.space,"onUpdate:value":u[1]||(u[1]=U=>v.space=U),placeholder:"",min:1,max:100,style:{width:"100px","text-align":"center"}},null,8,["value"]),t(p,{onClick:u[2]||(u[2]=U=>v.space++),disabled:v.space==100,class:"mr-5px"},{default:n(()=>[_(" + ")]),_:1},8,["disabled"]),_(" % 时自动维护 ")]),_:1})]),_:1}),t(f,{label:"数据保留时间","label-placement":"left",class:"mx-20px"},{default:n(()=>[t(g,{value:v.retention,"onUpdate:value":u[3]||(u[3]=U=>v.retention=U),placeholder:"请选择",options:c(),style:{width:"150px"}},null,8,["value","options"])]),_:1}),t(f,{label:" ","label-placement":"left"},{default:n(()=>[E((b(),x(p,{type:"info",ghost:"",onClick:r},{default:n(()=>[_("保存")]),_:1})),[[j,"sysmanger.basicInfo.insert.dataBaseMaintenance"]])]),_:1})]),_:1})]),_:1}),t(C,{title:"数据库维护列表",bordered:!1,class:"flex-1","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[t(w,{columns:D(s),data:D(h),size:"small","scroll-x":462,"max-height":420,loading:D(T),remote:"","row-key":U=>U.id,pagination:D(y),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})]),_:1})}}}),qt=O({name:"dataBackup",__name:"dataBackup",setup(I){const{columns:c,columnChecks:v,data:s,getData:o,loading:h,mobilePagination:$,searchParams:T,resetSearchParams:y}=re({apiFn:st,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center"}]}),e=F({id:"",ip:"",username:"",pwd:"",path:"",cron:"",showCron:!1,setting:{settingCycle:1,settingCycleValue:1,settingTime:void 0}}),l=N(null),a={ip:[{required:!0,message:"请输入IP",trigger:["blur","input"]},{validator:ye,trigger:["blur","input"]}],cron:{required:!0,message:"请设置表达式",trigger:"blur"},username:{required:!0,message:"请输入账号",trigger:["blur","input"]},pwd:{required:!0,message:"请输入密码",trigger:"blur"},path:{required:!0,message:"请输入路径",trigger:"blur"},setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}};(async()=>{const{data:m,error:i}=await lt();if(i)return;const{id:f,params:g}=m;if(e.id=f,g)try{const{ip:k,username:C,pwd:w,path:R,cron:j}=JSON.parse(g),U=ne(j);Object.assign(e,{ip:k,username:C,pwd:w,path:R,cron:j,setting:U})}catch(k){console.error("Error parsing params:",k)}})();const d=async()=>{var i,f,g;await((i=l.value)==null?void 0:i.validate());const m=ae(e.setting.settingCycle==1?{dayOfWeek:e.setting.settingCycleValue,time:e.setting.settingTime}:null,e.setting.settingCycle==2?{dayOfMonth:e.setting.settingCycleValue,time:e.setting.settingTime}:null,e.setting.settingCycle==3?{time:e.setting.settingTime}:null);if(e.id){const{data:k,error:C}=await oe({beanName:"DataBackUpsTask",id:e.id,cronExpression:m,remark:"",status:1,params:JSON.stringify({ip:e.ip,username:e.username,pwd:e.pwd,path:e.path,cron:m})});C||(f=window.$message)==null||f.success("备份设置成功")}else{const{data:k,error:C}=await le({beanName:"DataBackUpsTask",cronExpression:m,remark:"",status:1,params:JSON.stringify({ip:e.ip,username:e.username,pwd:e.pwd,path:e.path,cron:m})});C||(g=window.$message)==null||g.success("备份设置成功")}},u=(m,i)=>i===null?!1:Number(i)==6?m!=0:!1,p=(m,i,f)=>f===null||i===null?!1:Number(f)==6?m!=0:!1;return(m,i)=>{const f=W,g=yt,k=H,C=G,w=P,R=ie,j=q,U=vt,ke=J,ue=A,Ce=se,xe=K;return b(),x(xe,{class:"h-100% flex-col",style:{maxHeight:"calc(100vh - 220px)"}},{default:n(()=>[t(ue,{title:"数据库备份",bordered:!1,class:"mb-20px","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[t(ke,{"label-placement":"left",model:e,ref_key:"formRef",ref:l,rules:a,"label-width":150,class:"px-100px"},{default:n(()=>[t(U,{cols:24,"x-gap":24},{default:n(()=>[t(g,{span:8,label:"IP地址",path:"ip"},{default:n(()=>[t(f,{value:e.ip,"onUpdate:value":i[0]||(i[0]=V=>e.ip=V),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(g,{span:8,label:"账号",path:"username"},{default:n(()=>[t(f,{value:e.username,"onUpdate:value":i[1]||(i[1]=V=>e.username=V),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(g,{span:8,label:"密码",path:"pwd"},{default:n(()=>[t(f,{type:"password","show-password-on":"mousedown",value:e.pwd,"onUpdate:value":i[2]||(i[2]=V=>e.pwd=V),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(g,{span:8,label:"路径",path:"path"},{default:n(()=>[t(f,{value:e.path,"onUpdate:value":i[3]||(i[3]=V=>e.path=V),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(g,{span:8,label:"设置周期",path:"setting.settingCycle"},{default:n(()=>[t(w,{justify:"space-between",class:"w-100%"},{default:n(()=>[t(k,{value:e.setting.settingCycle,"onUpdate:value":[i[4]||(i[4]=V=>e.setting.settingCycle=V),i[5]||(i[5]=V=>e.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2}],style:{width:"140px"}},null,8,["value"]),t(C,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:n(()=>[e.setting.settingCycle==1?(b(),x(k,{key:0,value:e.setting.settingCycleValue,"onUpdate:value":i[6]||(i[6]=V=>e.setting.settingCycleValue=V),options:D(ee)(),style:{width:"140px"}},null,8,["value","options"])):B("",!0),e.setting.settingCycle==2?(b(),x(k,{key:1,value:e.setting.settingCycleValue,"onUpdate:value":i[7]||(i[7]=V=>e.setting.settingCycleValue=V),options:D(te)(),style:{width:"140px"}},null,8,["value","options"])):B("",!0)]),_:1})]),_:1})]),_:1}),t(g,{span:8,label:"设置时间",path:"setting.settingTime"},{default:n(()=>[t(w,{justify:"space-between"},{default:n(()=>[t(R,{"formatted-value":e.setting.settingTime,"onUpdate:formattedValue":i[8]||(i[8]=V=>e.setting.settingTime=V),hours:[0,1,2,3,4,5,6],"is-minute-disabled":u,"is-second-disabled":p,actions:["confirm"]},null,8,["formatted-value"]),t(j,{type:"info",ghost:"",onClick:d},{default:n(()=>[_("保存")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(ue,{title:"数据备份列表",bordered:!1,class:"flex-1","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[t(Ce,{columns:D(c),data:D(s),size:"small","scroll-x":462,"max-height":360,loading:D(h),remote:"","row-key":V=>V.id,pagination:D($),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})]),_:1})}}}),Pt=Q(qt,[["__scopeId","data-v-d173703d"]]),Mt=O({name:"systemSnapshot",__name:"systemSnapshot",setup(I){const{columns:c,columnChecks:v,data:s,getData:o,loading:h,mobilePagination:$,searchParams:T,resetSearchParams:y}=re({apiFn:ot,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center",render:p=>t(Be,{type:p.resultmsg==1?"error":"success"},{default:()=>[p.resultmsg==1?"失败":"成功"]})},{title:"操作",key:"operate",align:"center",width:100,fixed:"right",render:p=>t(bt,{onPositiveClick:()=>u(p.id)},{default:()=>"确定恢复吗?恢复后将重启系统",trigger:()=>t(q,{type:"info",ghost:!0,size:"small"},{default:()=>[_("恢复")]})})}]}),e=F({id:"",setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),l=N(e),a={setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:["blur","change"]},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:["blur","change"]},settingTime:{required:!0,message:"请选择设置时间",trigger:["blur","change"]}}};(async()=>{const{data:p,error:m}=await it();if(m)return;console.log(p,"asdas");const i=ne(p.cronExpression);Object.assign(e,{id:p.id,setting:i})})();const d=async()=>{var m,i,f;await((m=l.value)==null?void 0:m.validate());const p=ae(e.setting.settingCycle==1?{dayOfWeek:e.setting.settingCycleValue,time:e.setting.settingTime}:null,e.setting.settingCycle==2?{dayOfMonth:e.setting.settingCycleValue,time:e.setting.settingTime}:null,e.setting.settingCycle==3?{time:e.setting.settingTime}:null);if(e.id){const{data:g,error:k}=await oe({id:e.id,beanName:"SnapshotTask",cronExpression:p,status:1,params:JSON.stringify({corn:p})});k||(i=window.$message)==null||i.success("设置成功")}else{const{data:g,error:k}=await le({beanName:"SnapshotTask",cronExpression:p,remark:"",status:1,params:JSON.stringify({corn:p})});k||(f=window.$message)==null||f.success("设置成功")}},u=async p=>{var f;const{data:m,error:i}=await rt({id:p});i||(f=window.$message)==null||f.success("恢复成功")};return(p,m)=>{const i=H,f=G,g=P,k=ie,C=J,w=A,R=se,j=K;return b(),x(j,{class:"h-full flex-col",style:{maxHeight:"calc(100vh - 220px)"}},{default:n(()=>[t(w,{title:"快照备份设置",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[t(g,{class:"ml-50px"},{default:n(()=>[t(C,{"label-placement":"left",inline:"",model:e,rules:a,ref_key:"formRef",ref:l,"label-width":150,class:"px-100px"},{default:n(()=>[t(f,{label:"设置周期",path:"setting.settingCycle"},{default:n(()=>[t(g,{justify:"space-between"},{default:n(()=>[t(i,{value:e.setting.settingCycle,"onUpdate:value":[m[0]||(m[0]=U=>e.setting.settingCycle=U),m[1]||(m[1]=U=>e.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"140px"}},null,8,["value"]),t(f,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:n(()=>[e.setting.settingCycle==1?(b(),x(i,{key:0,value:e.setting.settingCycleValue,"onUpdate:value":m[2]||(m[2]=U=>e.setting.settingCycleValue=U),options:D(ee)(),style:{width:"140px"}},null,8,["value","options"])):B("",!0),e.setting.settingCycle==2?(b(),x(i,{key:1,value:e.setting.settingCycleValue,"onUpdate:value":m[3]||(m[3]=U=>e.setting.settingCycleValue=U),options:D(te)(),style:{width:"140px"}},null,8,["value","options"])):B("",!0)]),_:1})]),_:1})]),_:1}),t(f,{label:"设置时间",path:"setting.settingTime"},{default:n(()=>[t(k,{"formatted-value":e.setting.settingTime,"onUpdate:formattedValue":m[4]||(m[4]=U=>e.setting.settingTime=U)},null,8,["formatted-value"])]),_:1}),t(f,{label:" ","label-placement":"left"},{default:n(()=>[t(D(q),{type:"info",ghost:"",onClick:d},{default:n(()=>[_("保存")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),t(w,{title:"快照备份列表",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"},class:"flex-1"},{default:n(()=>[t(R,{columns:D(c),data:D(s),size:"small","scroll-x":462,"max-height":420,loading:D(h),remote:"","row-key":U=>U.id,pagination:D($),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})]),_:1})}}}),Y=I=>(_e("data-v-e5c5ba65"),I=I(),fe(),I),Ot={class:"flex-col justify-between h-100%"},Gt={class:"flex"},jt=Y(()=>S("td",null,"序列号",-1)),Rt=Y(()=>S("td",null,"创建时间",-1)),Ft=Y(()=>S("td",null,"有效时间",-1)),Lt=Y(()=>S("td",null,"可配置采集器数量",-1)),At=O({__name:"LicenseConfig",setup(I){const c=N(""),v=N(null),s=({file:a})=>{v.value=a.file,c.value=a.name},o=a=>{a.stopPropagation(),c.value="",v.value=null},h=N({num:"",dbtime:"",collnum:"",efftime:0}),$=N(""),T=async()=>{var a;try{const{data:r}=await ut();$.value=r}catch(r){(a=window.$message)==null||a.error("获取机器码失败"),console.error("获取机器码失败",r)}};T();const y=()=>{const a=new Ee("#copyMachineCodeBtn",{text:()=>$.value});a.on("success",r=>{var d;console.log("复制成功:",r.text),(d=window.$message)==null||d.success("复制成功"),r.clearSelection(),a.destroy()}),a.on("error",r=>{var d;console.error("复制失败:",r),(d=window.$message)==null||d.error("复制失败，请重试"),a.destroy()})},e=async()=>{try{const{data:a}=await ct();h.value=a}catch(a){console.error("获取 License 失败",a)}};e();const l=async()=>{var a,r;if(!c.value.endsWith(".lic"))return(a=window.$message)==null?void 0:a.error("请上传.lic文件");try{const d=new FormData;d.append("fi",v.value);const{data:u,error:p}=await dt(d);if(p)return;(r=window.$message)==null||r.success(u),e(),c.value="",v.value=null}catch(d){console.error("上传失败",d)}};return(a,r)=>{const d=q,u=W,p=P,m=ce,i=de,f=he,g=G,k=be,C=P;return b(),x(C,{justify:"center",class:"pt-20px important-flex-col items-center"},{default:n(()=>[t(p,{class:"mb-20px"},{default:n(()=>[S("div",Ot,[t(d,{type:"info",ghost:"",onClick:T},{default:n(()=>[_("查看机器码")]),_:1}),t(d,{id:"copyMachineCodeBtn",type:"success",ghost:"",onClick:y},{default:n(()=>[_(" 复制 ")]),_:1})]),t(u,{value:$.value,"onUpdate:value":r[0]||(r[0]=w=>$.value=w),readonly:"",type:"textarea",style:{width:"340px"},placeholder:"机器码"},null,8,["value"])]),_:1}),S("div",Gt,[t(g,{label:"License管理","label-placement":"left"},{default:n(()=>[t(f,{action:"","custom-request":s,"show-file-list":!1,accept:".lic"},{default:n(()=>[c.value?(b(),z("div",{key:0,onClick:r[1]||(r[1]=ve(()=>{},["stop"]))},[_(M(c.value)+" ",1),t(m,{class:"font-size-30px cursor-pointer",onClick:o})])):(b(),x(d,{key:1},{icon:n(()=>[t(i,{class:"text-icon"})]),default:n(()=>[_(" 选择文件")]),_:1}))]),_:1})]),_:1}),t(g,{label:"","label-placement":"left",class:"ml-20px"},{default:n(()=>[t(d,{type:"info",ghost:"",disabled:!c.value,onClick:l},{default:n(()=>[_("上传")]),_:1},8,["disabled"])]),_:1})]),h.value.num?(b(),x(k,{key:0,bordered:!0,"single-line":!1,class:"w-800px text-center m-auto mt-20px"},{default:n(()=>[S("tbody",null,[S("tr",null,[jt,S("td",null,M(h.value.num||""),1)]),S("tr",null,[Rt,S("td",null,M(h.value.dbtime),1)]),S("tr",null,[Ft,S("td",null,M(h.value.efftime==0?"永久":`${h.value.efftime}年`),1)]),S("tr",null,[Lt,S("td",null,M(h.value.collnum),1)])])]),_:1})):B("",!0)]),_:1})}}}),zt=Q(At,[["__scopeId","data-v-e5c5ba65"]]),Jt=O({__name:"sysStatus",setup(I){const c=F({mailaddr:"",snmpaddr:void 0,stype:0,tmail:0,tsnmp:0});(async()=>{const{data:e,error:l}=await pt();l||(c.mailaddr=(e==null?void 0:e.mailaddr)??c.mailaddr,c.snmpaddr=(e==null?void 0:e.snmpaddr)??c.snmpaddr,c.stype=(e==null?void 0:e.stype)??c.stype,c.tmail=(e==null?void 0:e.tmail)??c.tmail,c.tsnmp=(e==null?void 0:e.tsnmp)??c.tsnmp)})();const s=async()=>{var a;const{data:e,error:l}=await mt(c);l||(a=window.$message)==null||a.success("保存成功")},{pageData:o,getData:h,nextPage:$}=ht(wt),T=async e=>{const l=e.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&o.data.length<o.total&&$()},y=N();return qe(()=>o.data,e=>{e&&(y.value=e.filter(l=>l.ftype===1))}),h(),(e,l)=>{const a=Me,r=Oe,d=W,u=G,p=H,m=q,i=P,f=A,g=L("no-auth");return b(),x(i,{justify:"center"},{default:n(()=>[t(f,{title:"通知方式",class:"w-600px"},{default:n(()=>[t(a),t(r,{checked:c.tmail,"onUpdate:checked":l[0]||(l[0]=k=>c.tmail=k),"checked-value":1,"unchecked-value":0},{default:n(()=>[_(" 邮件 ")]),_:1},8,["checked"]),c.tmail?(b(),x(u,{key:0,label:"邮件地址","label-placement":"left","label-width":"120",class:"mt-30px",rule:{required:!0,validator:()=>{if(!c.mailaddr)return new Error("请输入邮件地址");if(!D(Pe)(c.mailaddr))return new Error("请输入正确的邮件地址")},trigger:["blur","input"]}},{default:n(()=>[t(d,{value:c.mailaddr,"onUpdate:value":l[1]||(l[1]=k=>c.mailaddr=k)},null,8,["value"])]),_:1},8,["rule"])):B("",!0),t(a),t(r,{checked:c.tsnmp,"onUpdate:checked":l[2]||(l[2]=k=>c.tsnmp=k),"checked-value":1,"unchecked-value":0},{default:n(()=>[_(" snmp trap ")]),_:1},8,["checked"]),c.tsnmp?(b(),x(u,{key:1,label:"通知服务器","label-placement":"left","label-width":"120",class:"mt-30px"},{default:n(()=>[t(p,{value:c.snmpaddr,"onUpdate:value":l[3]||(l[3]=k=>c.snmpaddr=k),options:y.value,"label-field":"ipaddr","value-field":"ipaddr",onScroll:T},null,8,["value","options"])]),_:1})):B("",!0),t(a),t(i,{justify:"end"},{default:n(()=>[E((b(),x(m,{type:"info",ghost:"",onClick:s},{default:n(()=>[_("保存")]),_:1})),[[g,"sysmanger.basicInfo.alarmNotification"]])]),_:1})]),_:1})]),_:1})}}}),Wt={class:"h-full"},Ht=O({name:"basicconfig_system-config",__name:"index",setup(I){const c=N("基本信息"),v=N(""),s=N(null),o=({file:T})=>{s.value=T.file,v.value=T.name},h=T=>{T.stopPropagation(),v.value="",s.value=null};F({fs:""});const $=async()=>{var T;try{const y=new FormData;y.append("fi",s.value);const{data:e,error:l}=await _t({name:v.value},y);if(l)return;(T=window.$message)==null||T.success(e)}catch{}};return(T,y)=>{const e=Ge,l=ce,a=de,r=q,d=he,u=G,p=P,m=je,i=A,f=L("no-auth");return b(),z("div",Wt,[t(i,{style:{"margin-bottom":"16px"},class:"h-full","content-style":{height:"100%"}},{default:n(()=>[t(m,{type:"card",animated:"",class:"h-100%",value:c.value,"onUpdate:value":y[1]||(y[1]=g=>c.value=g)},{default:n(()=>[t(e,{name:"基本信息",tab:"基本信息"},{default:n(()=>[t(It)]),_:1}),t(e,{name:"安全设置",tab:"安全设置"},{default:n(()=>[t(Tt)]),_:1}),t(e,{name:"邮件服务",tab:"邮件服务"},{default:n(()=>[t(Nt)]),_:1}),t(e,{name:"校时配置",tab:"校时配置"},{default:n(()=>[t(Bt)]),_:1}),t(e,{name:"数据库维护",tab:"数据库维护",class:"h-100%"},{default:n(()=>[t(Et)]),_:1}),t(e,{name:"数据库备份",tab:"数据库备份",class:"h-100%"},{default:n(()=>[t(Pt)]),_:1}),t(e,{name:"系统快照",tab:"系统快照",class:"h-100%"},{default:n(()=>[t(Mt)]),_:1}),t(e,{name:"License管理",tab:"License管理"},{default:n(()=>[t(zt)]),_:1}),t(e,{name:"情报库",tab:"情报库"},{default:n(()=>[t(p,{justify:"center",class:"pt-20px important-flex-col items-center"},{default:n(()=>[t(u,{label:"上传情报库文件","label-placement":"left"},{default:n(()=>[t(d,{action:"","custom-request":o,"show-file-list":!1,accept:".zip"},{default:n(()=>[v.value?(b(),z("div",{key:0,onClick:y[0]||(y[0]=ve(()=>{},["stop"]))},[_(M(v.value)+" ",1),t(l,{class:"font-size-30px cursor-pointer",onClick:h})])):(b(),x(r,{key:1},{icon:n(()=>[t(a,{class:"text-icon"})]),default:n(()=>[_(" 选择文件")]),_:1}))]),_:1})]),_:1}),t(u,{label:"","label-placement":"left",class:"ml-20px"},{default:n(()=>[E((b(),x(r,{type:"info",ghost:"",disabled:!v.value,onClick:$},{default:n(()=>[_("提交")]),_:1},8,["disabled"])),[[f,"sysmanger.basicInfo.intelligence"]])]),_:1})]),_:1})]),_:1}),t(e,{name:"系统告警通知",tab:"系统告警通知"},{default:n(()=>[t(Jt)]),_:1})]),_:1},8,["value"])]),_:1})])}}}),_n=Q(Ht,[["__scopeId","data-v-2457ab5a"]]);export{_n as default};
