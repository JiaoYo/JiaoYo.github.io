import{_ as O}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BifTwrmi.js";import{o as i,e as y,f as z,d as Q,a5 as W,g as o,ax as X,j as p,D as Y,F as Z,w as t,t as S,G as $,c as v,J as ee,h as w,i as s,B as M,I as ae,aj as te,bm as ne,A as oe,M as se,P as le,Q as ie,af as ce,al as re,R as ue,T as de,U as pe}from"./index-CMYYrBkk.js";import{_ as _e,a as me}from"./close-small-rounded-Cv14-jtK.js";import{E as fe,F as ge,G as he,H as ve}from"./basic-config-MwvTUhyW.js";import{u as we}from"./table-BuckZeDa.js";import{_ as ye}from"./Upload-DRQmq4gc.js";import{_ as ke}from"./Progress-vsCufhmZ.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-S8f8P1LL.js";import"./setting-outlined-CSeh-oYh.js";import"./export-CDi1O_5Z.js";import"./refresh-Cy0vs_-o.js";import"./round-delete-wYUGKRY1.js";import"./round-plus-BDiwrNS9.js";import"./Popconfirm-DWdKhYPV.js";const be={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},xe=z("path",{fill:"currentColor",d:"M16 18v2H8v-2zM11 7.99V16h2V7.99h3L12 4L8 7.99z"},null,-1),Ce=[xe];function Se(_,N){return i(),y("svg",be,[...Ce])}const $e={name:"ic-twotone-upgrade",render:Se},Me=_=>(ue("data-v-319e030c"),_=_(),de(),_),ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ne={class:"version"},Re={key:0,style:{width:"300px"}},Ve=Me(()=>z("div",null,"升级记录",-1)),De=Q({name:"basicconfig_upgrade-management",__name:"index",setup(_){const N=W(),{columns:I,columnChecks:k,data:P,getData:B,loading:R,mobilePagination:T,searchParams:Fe,resetSearchParams:Ie}=we({apiFn:fe,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"dbtime",title:"升级时间",align:"center"},{key:"upgradecon",title:"升级内容",align:"center"},{key:"prever",title:"升级前版本",align:"center"},{key:"version",title:"升级后版本",align:"center"},{key:"status",title:"状态",align:"center",render:e=>(e.status===null&&(e.status=0),o(X,{type:{0:"error",1:"success"}[e.status]},{default:()=>[e.status==1?"成功":"失败"]}))}]}),b=p(""),V=async()=>{const{data:e,error:n}=await ge();n||(typeof e=="object"?b.value=e.data:b.value=e)},U=async()=>{var a;const{data:e,error:n}=await he({uid:u.value[0]});n||(a=window.$message)==null||a.success(e)},l=p(""),c=p(null),G=({file:e,data:n,headers:a,withCredentials:d,action:f,onFinish:g,onError:h,onProgress:x})=>{c.value=e.file,l.value=e.name},D=p(0),r=p(!1),H=e=>{r.value=!0,D.value=e},u=p([]),j=(e,n,a)=>{var d;a.action==="check"?u.value=[(d=a.row)==null?void 0:d.uid]:u.value=[]},E=async()=>{var e,n;if(!l.value.endsWith(".tar.gz"))return(e=window.$message)==null?void 0:e.error("请上传tar.gz文件");try{const a=new FormData,d=await ne(c.value),f=oe(d);a.append("fname",l.value),a.append("fi",c.value),a.append("signature",f);const{data:g,error:h}=await ve(a,H);if(h)return;(n=window.$message)==null||n.success(g),r.value=!1,l.value="",c.value=null,V()}catch{r.value=!1,l.value="",c.value=null}finally{r.value=!1,l.value="",c.value=null}},K=e=>{e.stopPropagation(),l.value="",c.value=null};return Y(()=>{V()}),(e,n)=>{const a=se,d=_e,f=me,g=ye,h=$e,x=le,L=ke,q=ie,F=ce,A=O,J=re,C=Z("no-auth");return i(),y("div",ze,[o(F,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[o(q,{ref:"formRef",inline:"","label-placement":"left","label-width":100,"show-feedback":!1},{default:t(()=>[o(a,null,{default:t(()=>[z("span",Ne,"当前版本号："+S(b.value),1)]),_:1}),$((i(),v(a,{label:"升级包选择",path:"fi"},{default:t(()=>[o(g,{action:"","custom-request":G,"show-file-list":!1,accept:".gz"},{default:t(()=>[l.value?(i(),y("div",{key:0,onClick:n[0]||(n[0]=ee(()=>{},["stop"]))},[w(S(l.value)+" ",1),o(d,{class:"font-size-30px cursor-pointer",onClick:K})])):(i(),v(s(M),{key:1},{icon:t(()=>[o(f,{class:"text-icon"})]),default:t(()=>[w(" 上传文件")]),_:1}))]),_:1})]),_:1})),[[C,"sys.upgrade.upload"]]),o(a,null,{default:t(()=>[o(x,{class:"w-full"},{default:t(()=>[$((i(),v(s(M),{onClick:E,loading:r.value,disabled:!l.value,type:"primary",ghost:""},{icon:t(()=>[o(h,{class:"text-icon"})]),default:t(()=>[w(" "+S(r.value?"正在升级中":"升级"),1)]),_:1},8,["loading","disabled"])),[[C,"sys.upgrade.upload"]]),$((i(),v(s(M),{onClick:U,type:"primary",ghost:"",disabled:u.value.length==0},{default:t(()=>[w(" 回退版本 ")]),_:1},8,["disabled"])),[[C,"sys.upgrade.fallback.version"]])]),_:1})]),_:1}),o(a,null,{default:t(()=>[r.value?(i(),y("div",Re,[o(L,{"indicator-placement":"inside",type:"line",percentage:D.value},null,8,["percentage"])])):ae("",!0)]),_:1})]),_:1},512)]),_:1}),o(F,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[o(x,{align:"center"},{default:t(()=>[Ve]),_:1})]),"header-extra":t(()=>[o(A,{columns:s(k),"onUpdate:columns":n[1]||(n[1]=m=>te(k)?k.value=m:null),"disabled-delete":u.value.length===0,loading:s(R),onRefresh:s(B)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:t(()=>[o(J,{"checked-row-keys":u.value,"onUpdate:checkedRowKeys":n[2]||(n[2]=m=>u.value=m),columns:s(I),data:s(P),size:"small","flex-height":!s(N).isMobile,"scroll-x":962,loading:s(R),remote:"","row-key":m=>m.uid,pagination:s(T),class:"sm:h-full",onUpdateCheckedRowKeys:j},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1})])}}}),Qe=pe(De,[["__scopeId","data-v-319e030c"]]);export{Qe as default};
