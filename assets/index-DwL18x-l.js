import{_ as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DblglBez.js";import{d as J,q as E,s as Y,v as Z,x as me,b as fe,r as _e,y as ge,K as j,o as Q,c as ee,w as n,g as e,h as B,t as V,i as o,$ as f,M as te,L as q,A as ae,C as he,a2 as oe,D as ne,B as I,E as le,ae as ye,af as ve,J as be,ad as se,a4 as we,av as Se,aq as xe,j as W,e as De,ag as H,ah as Ce,S as ke,F as Te,V as Ne}from"./index-7Q9xZuwa.js";import{u as Me,a as ze}from"./table-G6_8Abm0.js";import{q as re,r as ce,s as Re,t as Ue,u as Le,v as Pe}from"./Collection-Dqv_ioR6.js";import{u as O}from"./usePageData-PYHx9xl8.js";import{_ as Ae}from"./round-search-BQOA9W6m.js";import{_ as $e}from"./round-refresh-DJiiF7wv.js";import{_ as Be}from"./FormItemGridItem-DYTXkfwP.js";import{_ as Ve}from"./Grid-CRtcNhSF.js";import{h as X}from"./permission-BYoerBbx.js";import{_ as Fe}from"./Popconfirm-BEMrdOuM.js";import{_ as He}from"./DataTable-n3fP4Loy.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-D8fMBsYv.js";import"./setting-outlined-V9qGIWHT.js";import"./export-oh2-I3ZA.js";import"./refresh-av0Mcmzj.js";import"./round-delete-BZFRn3Yp.js";import"./round-plus-Cy8c1zzO.js";import"./Upload-CwzIyBrH.js";import"./Progress-DAZ1S5w7.js";import"./Forward-BzUEeUAa.js";const je=J({name:"OperateDrawer",__name:"operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(_,{emit:M}){const d=_,y=M,g=Y(_,"visible"),{formRef:r,validate:D,restoreValidation:z}=Z(),{createConfirmPwdRule:C,defaultRequiredRule:R,patternRules:S}=me(),x=fe(()=>({add:"新增日志源设备",edit:"编辑日志源设备"})[d.operateType]),i=_e(k());function k(){return{id:void 0,manu:null,category:null,type:"",sysparam:void 0,ldesc:""}}const U={type:R,category:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源类别"},manu:{type:"number",required:!0,trigger:["blur","change"],message:"请选择厂商"}},{pageData:p,getData:L,nextPage:P}=O(re),F=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&p.data.length<p.total&&P()},{pageData:u,getData:c,nextPage:A}=O(ce),v=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&u.data.length<u.total&&A()};function T(){L(),c(),Object.assign(i,k()),d.operateType==="edit"&&d.rowData&&Object.assign(i,d.rowData)}function b(){g.value=!1}async function l(){var a,t;if(await D(),d.operateType==="add"){const{data:w,error:m}=await Re([i]);m||((a=window.$message)==null||a.success(f("common.addSuccess")),b(),y("submitted"))}else{const{data:w,error:m}=await Ue([i]);m||((t=window.$message)==null||t.success(f("common.updateSuccess")),b(),y("submitted"))}}return ge(g,()=>{g.value&&(T(),z())}),(a,t)=>{const w=ae,m=he,N=oe,$=ne,s=I,K=le,ie=ye,ue=ve,de=j("no-space");return Q(),ee(ue,{show:g.value,"onUpdate:show":t[4]||(t[4]=h=>g.value=h),"display-directive":"show",width:360},{default:n(()=>[e(ie,{title:x.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(K,{size:16},{default:n(()=>[e(s,{onClick:b},{default:n(()=>[B(V(o(f)("common.cancel")),1)]),_:1}),e(s,{type:"primary",onClick:l},{default:n(()=>[B(V(o(f)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e($,{ref_key:"formRef",ref:r,model:i,rules:U,onKeyup:te(l,["entep"])},{default:n(()=>[e(m,{label:"日志源类型",path:"type"},{default:n(()=>[q(e(w,{clearable:"",value:i.type,"onUpdate:value":t[0]||(t[0]=h=>i.type=h),placeholder:"请输入日志源类型"},null,8,["value"]),[[de]])]),_:1}),e(m,{label:"日志源类别",path:"category"},{default:n(()=>[e(N,{clearable:"",filterable:"",value:i.category,"onUpdate:value":t[1]||(t[1]=h=>i.category=h),placeholder:"请选择日志源类别",options:o(p).data,"reset-menu-on-options-change":!1,onScroll:F,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"厂商",path:"manu"},{default:n(()=>[e(N,{clearable:"",filterable:"",value:i.manu,"onUpdate:value":t[2]||(t[2]=h=>i.manu=h),placeholder:"请选择厂商",options:o(u).data,"value-field":"id","label-field":"mname",onScroll:v,"reset-menu-on-options-change":!1,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"描述",path:"ldesc"},{default:n(()=>[e(w,{type:"textarea",value:i.ldesc,"onUpdate:value":t[3]||(t[3]=h=>i.ldesc=h),placeholder:"请输入备注",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),qe=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(_,{emit:M}){const d=M,{formRef:y,restoreValidation:g}=Z(),r=Y(_,"model");function D(u){r.value.category=u,d("search")}function z(u){r.value.manu=u,d("search")}function C(){r.value.fuzzy="",d("search")}async function R(){r.value.fuzzy=null,r.value.category=null,r.value.manu=null,d("search")}async function S(){d("search")}const{pageData:x,getData:i,nextPage:k}=O(re),U=async u=>{const c=u.currentTarget;c.scrollTop+c.offsetHeight>=c.scrollHeight&&x.data.length<x.total&&k()},{pageData:p,getData:L,nextPage:P}=O(ce),F=async u=>{const c=u.currentTarget;c.scrollTop+c.offsetHeight>=c.scrollHeight&&p.data.length<p.total&&P()};return be(()=>{i(),L()}),(u,c)=>{const A=ae,v=Be,T=oe,b=$e,l=I,a=Ae,t=le,w=Ve,m=ne,N=se,$=j("no-space");return Q(),ee(N,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(m,{ref_key:"formRef",ref:y,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(S,["enter"])},{default:n(()=>[e(w,{responsive:"screen","item-responsive":""},{default:n(()=>[e(v,{span:"24 s:12 m:6",label:"日志源类型",path:"fuzzy",class:"pr-24px"},{default:n(()=>[q(e(A,{clearable:"",value:r.value.fuzzy,"onUpdate:value":c[0]||(c[0]=s=>r.value.fuzzy=s),placeholder:"请输入日志源类型关键字",onClear:C},null,8,["value"]),[[$]])]),_:1}),e(v,{span:"24 s:12 m:6",label:"厂商",path:"manu",class:"pr-24px"},{default:n(()=>[e(T,{clearable:"",filterable:"",value:r.value.manu,"onUpdate:value":c[1]||(c[1]=s=>r.value.manu=s),placeholder:"请选择厂商",options:o(p).data,"value-field":"id","label-field":"mname",onScroll:F,onUpdateValue:z,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"日志源类别",path:"category",class:"pr-24px"},{default:n(()=>[e(T,{clearable:"",filterable:"",value:r.value.category,"onUpdate:value":c[2]||(c[2]=s=>r.value.category=s),placeholder:"请选择日志源类别",options:o(x).data,onScroll:U,onUpdateValue:D,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{span:"24  s:12 m:6",class:"pr-24px"},{default:n(()=>[e(t,{class:"w-full"},{default:n(()=>[e(l,{onClick:R},{icon:n(()=>[e(b,{class:"text-icon"})]),default:n(()=>[B(" "+V(o(f)("common.reset")),1)]),_:1}),e(l,{type:"primary",ghost:"",onClick:S},{icon:n(()=>[e(a,{class:"text-icon"})]),default:n(()=>[B(" "+V(o(f)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ie={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function G(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!Ce(_)}const Oe=J({name:"collectionmanagement_logsource",__name:"index",setup(_){const M=we(),{columns:d,columnChecks:y,data:g,getData:r,loading:D,mobilePagination:z,searchParams:C,resetSearchParams:R}=Me({apiFn:Le,apiParams:{page:1,pageSize:20,limit:20,fuzzy:void 0,category:void 0,manu:void 0,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48,disabled(l){return l.sysparam!==1}},{key:"mname",title:"厂商",align:"center",width:240},{key:"cname",title:"日志源类别",align:"center",width:240},{key:"type",title:"日志源类型",align:"center",width:240},{key:"ldesc",title:"描述",align:"center",width:500,render:l=>e("span",{class:"text-ellipsis",onClick:()=>{u.value=l.ldesc,c.value=!0},style:{display:"block",width:"100%"}},[l.ldesc])},{key:"sysparam",title:"系统内置",align:"center",width:120,render:l=>{const a={0:"success",1:"info"},t=f(Se[l.sysparam]);return e(xe,{size:"small",type:a[l.sysparam]},G(t)?t:{default:()=>[t]})}},{key:"operate",title:f("common.operate"),align:"center",width:130,render:l=>{let a;return l.sysparam==1&&e("div",{class:"flex-center gap-8px"},[q(e(I,{type:"primary",ghost:!0,size:"small",onClick:()=>T(l.id)},G(a=f("common.edit"))?a:{default:()=>[a]}),[[j("no-auth"),"sys.log.source.device.update"]]),e(Fe,{onPositiveClick:()=>v(l.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let t;return q(e(I,{type:"error",ghost:!0,size:"small"},G(t=f("common.delete"))?t:{default:()=>[t]}),[[j("no-auth"),"sys.log.source.device.delete"]])}})])}}]}),{drawerVisible:S,operateType:x,editingData:i,handleAdd:k,handleEdit:U,checkedRowKeys:p,onBatchDeleted:L,onDeleted:P,closeDrawer:F}=ze(g,r),u=W(""),c=W(!1);async function A(){console.log(p.value),b(p.value.join(","),l=>{L()})}function v(l){console.log(l),b(l,a=>{P()})}function T(l){U(l)}async function b(l,a){const t=await Pe(l);a&&a(t)}return(l,a)=>{const t=pe,w=He,m=ke,N=Te,$=se;return Q(),De("div",Ie,[e(qe,{model:o(C),"onUpdate:model":a[0]||(a[0]=s=>H(C)?C.value=s:null),onReset:o(R),onSearch:o(r)},null,8,["model","onReset","onSearch"]),e($,{title:"日志源设备",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":n(()=>[e(t,{columns:o(y),"onUpdate:columns":a[1]||(a[1]=s=>H(y)?y.value=s:null),"disabled-delete":o(p).length===0,"is-view-add-button":o(X)("sys.log.source.device.insert"),"is-view-delete-button":o(X)("sys.log.source.device.delete"),loading:o(D),onAdd:o(k),onDelete:A,onRefresh:o(r)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:n(()=>[e(w,{"checked-row-keys":o(p),"onUpdate:checkedRowKeys":a[2]||(a[2]=s=>H(p)?p.value=s:null),columns:o(d),data:o(g),size:"small","flex-height":!o(M).isMobile,"scroll-x":o(d).reduce((s,K)=>s+K.width,0),loading:o(D),remote:"","row-key":s=>s.id,pagination:o(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(je,{visible:o(S),"onUpdate:visible":a[3]||(a[3]=s=>H(S)?S.value=s:null),"operate-type":o(x),"row-data":o(i),onSubmitted:o(r)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(N,{show:c.value,"onUpdate:show":a[4]||(a[4]=s=>c.value=s),title:"描述",preset:"card",class:"w-600px"},{default:n(()=>[e(m,{style:{"max-height":"300px"}},{default:n(()=>[B(V(u.value),1)]),_:1})]),_:1},8,["show"])]),_:1})])}}}),pt=Ne(Oe,[["__scopeId","data-v-dd0c97f3"]]);export{pt as default};
