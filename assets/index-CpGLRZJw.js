import{_ as H,a as Q,b as de,c as pe,d as ce,e as ue,N as L,f as me}from"./round-search-CUHf7BKH.js";import{u as _e,a as fe,_ as ge,b as ve,c as ye}from"./table-BfdERIEp.js";import{d as X,S as A,U as be,m as he,l as we,n as ke,V as q,W as xe,a as Ne,$ as P,c as Ce,o as Z,w as a,f as e,C as ee,x as ae,e as J,z as te,B as f,g as d,t as y,h as t,Y as De,aa as $e,ab as Ue,r as ze,b as Te,a1 as k,P as Be,a2 as W,ac as Y,ad as Pe,a5 as Re,a6 as Se,a7 as Ge,ae as Ie,E as Fe}from"./index-DtW-iSHU.js";const Me=X({__name:"AddModal",props:A({operateType:{},rowData:{},Pagination:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:A(["submitted"],["update:visible"]),setup(R,{emit:S}){const p=be(R,"visible"),b=S,i=R,l=he(m());function m(){return{sn:"",dev:"",sysid:"",pkey:"",ver:""}}function h(){Object.assign(l,m()),i.operateType==="edit"&&i.rowData&&Object.assign(l,i.rowData)}const{formRef:G,validate:I,restoreValidation:F}=we();ke(),q(()=>i.rowData,()=>{h()}),q(p,()=>{p.value&&(h(),F())});const C=()=>{p.value=!1},c=async()=>{var o;await I();const w=JSON.parse(JSON.stringify(l));if(i.operateType==="add"){const{data:g,error:u}=await $e([w]);if(u)return}else{const{data:g,error:u}=await Ue([w]);if(u)return}(o=window.$message)==null||o.success(i.operateType==="add"?"添加成功":"修改成功"),C(),b("submitted")},M=xe.debounce(c,1e3,{leading:!0,trailing:!1}),D={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},j={sn:D,pkey:D},O=Ne(()=>({add:P("common.add"),edit:P("common.edit")})[i.operateType]);return(w,o)=>{const g=ae,u=Q,V=H,E=ee,$=f,U=te,s=De;return Z(),Ce(s,{show:p.value,"onUpdate:show":o[5]||(o[5]=n=>p.value=n),title:O.value,preset:"card",class:"w-30%"},{footer:a(()=>[e(U,{size:16,justify:"center"},{default:a(()=>[e($,{onClick:C,class:"w-100px"},{default:a(()=>[d(y(t(P)("common.cancel")),1)]),_:1}),e($,{type:"primary",class:"w-100px",onClick:t(M)},{default:a(()=>[d(y(t(P)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:a(()=>[e(E,{ref_key:"formRef",ref:G,model:l,rules:j,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:a(()=>[e(V,{responsive:"screen","item-responsive":""},{default:a(()=>[e(u,{span:"24 m:24",path:"sn"},{label:a(()=>o[6]||(o[6]=[J("span",null,"物联电表编号",-1),J("div",null,"/网关编号",-1)])),default:a(()=>[e(g,{clearable:"",value:l.sn,"onUpdate:value":o[0]||(o[0]=n=>l.sn=n),placeholder:"请输入物联电表编号/网关编号",maxlength:"64"},null,8,["value"])]),_:1}),e(u,{span:"24 m:24",label:"设备采集编码",path:"dev"},{default:a(()=>[e(g,{clearable:"",value:l.dev,"onUpdate:value":o[1]||(o[1]=n=>l.dev=n),placeholder:"请输入设备采集编码",precision:3,style:{width:"100%"}},null,8,["value"])]),_:1}),e(u,{span:"24 m:24",label:"sysId",path:"sysid"},{default:a(()=>[e(g,{clearable:"",value:l.sysid,"onUpdate:value":o[2]||(o[2]=n=>l.sysid=n),maxlength:"16",placeholder:"请输入sysId"},null,8,["value"])]),_:1}),e(u,{span:"24 m:24",label:"pKey",path:"pkey"},{default:a(()=>[e(g,{clearable:"",value:l.pkey,"onUpdate:value":o[3]||(o[3]=n=>l.pkey=n),maxlength:"16",placeholder:"请输入pKey"},null,8,["value"])]),_:1}),e(u,{span:"24 m:24",label:"版本",path:"ver"},{default:a(()=>[e(g,{clearable:"",value:l.ver,"onUpdate:value":o[4]||(o[4]=n=>l.ver=n),maxlength:"16",placeholder:"请输入版本"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Oe=X({name:"gateway",__name:"index",setup(R){const{columns:S,data:p,getData:b,loading:i,mobilePagination:l,searchParams:m}=_e({apiFn:Ie,apiParams:{page:1,pageSize:20,limit:20,sn:void 0,_t:new Date().getTime()},showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"sn",title:"物联电表编号、网关编号",align:"center"},{key:"dev",title:"设备采集编码",align:"center"},{key:"sysid",title:"sysId",align:"center"},{key:"pkey",title:"pKey",align:"center"},{key:"ver",title:"版本",align:"center"},{key:"operate",title:"操作",align:"center",render:s=>e("div",{class:"flex-center gap-8px"},[e(f,{type:"primary",ghost:!0,size:"small",onClick:()=>w(s.id)},{default:()=>[d("编辑")]}),e(L,{onPositiveClick:()=>o(s.id)},{default:()=>"确定删除吗？",trigger:()=>e(f,{type:"error",ghost:!0,size:"small"},{default:()=>[d("删除")]})})])}]}),{drawerVisible:h,operateType:G,editingData:I,handleAdd:F,handleEdit:C,checkedRowKeys:c,onBatchDeleted:M,onDeleted:D}=fe(p,b),j=()=>{m.sn=void 0,b()},O=ze(),w=s=>{C(s)},o=s=>{Y(s).then(()=>{p.value.length==1&&l.value.page&&l.value.page>1&&(l.value.page=l.value.page==1?1:l.value.page-1,m.page=l.value.page),D()})};async function g(){Y(c.value.join(",")).then(()=>{p.value.length==c.value.length&&l.value.page&&(l.value.page=l.value.page==1?1:l.value.page-1,m.page=l.value.page),M()})}const u=()=>{F()},V=()=>{m.sn=null,b()},E=s=>{const n=s.file.file;Pe(n).then(()=>{var r;(r=window.$message)==null||r.success("导入成功"),b()}).catch(()=>{var r;(r=window.$message)==null||r.error("导入失败，请检查文件内容是否正确")})},$=s=>{var v,z,T,B,N;let r=((v=s.file.file)==null?void 0:v.size)/1024/1024<500;if(!(((z=s.file.file)==null?void 0:z.type)==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||((T=s.file.file)==null?void 0:T.type)==="application/vnd.ms-excel"))return(B=window.$message)==null||B.warning("只能上传xlsx文件"),!1;if(!r)return(N=window.$message)==null||N.warning("不能超过500mb"),!1},U=s=>{const n=new URLSearchParams;c.value.forEach(r=>n.append("ids",r)),Re({url:`${Ge}/edgeConf/exports.do`,method:"post",params:{ids:s=="data"?c.value.join(","):void 0},responseType:"blob",headers:{token:Se()}}).then(async r=>{if(r.data){const x=window.URL.createObjectURL(new Blob([r.data])),v=document.createElement("a");v.href=x,v.setAttribute("download",(s=="template"?"网关模板":new Date().getTime())+".xls"),document.body.appendChild(v),v.click()}})};return(s,n)=>{const r=ae,x=Q,v=de,z=ge,T=H,B=ee,N=Be,ne=pe,le=ue,se=ce,K=ye,oe=me,ie=te,re=ve;return Z(),Te("div",je,[e(N,{bordered:!1,size:"small"},{default:a(()=>[e(B,{ref_key:"formRef",ref:O,model:t(m),"label-placement":"left","show-feedback":!1},{default:a(()=>[e(T,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:a(()=>[e(x,{span:"24 s:24 m:20 l:5",label:"网关编号",path:"sn"},{default:a(()=>[e(r,{value:t(m).sn,"onUpdate:value":n[0]||(n[0]=_=>t(m).sn=_),clearable:"",onClear:j,placeholder:"请输入"},null,8,["value"])]),_:1}),e(x,{span:"24 s:24 m:20 l:10"},{default:a(()=>[e(t(f),{type:"primary",ghost:"",onClick:n[1]||(n[1]=_=>t(b)()),class:"mx-10px"},{icon:a(()=>[e(v,{class:k(["text-icon",{"animate-spin":t(i)}])},null,8,["class"])]),default:a(()=>[d(" "+y(s.$t("common.search")),1)]),_:1}),e(t(f),{onClick:V},{icon:a(()=>[e(z,{class:k(["text-icon",{"animate-spin":t(i)}])},null,8,["class"])]),default:a(()=>[d(" "+y(s.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(N,{title:" ",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(ie,{justify:"end"},{default:a(()=>[e(t(f),{onClick:u,size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(ne,{class:k(["text-icon",{"animate-spin":t(i)}])},null,8,["class"])]),default:a(()=>[d(" "+y(s.$t("common.add")),1)]),_:1}),e(se,{onChange:E,onBeforeUpload:$,accept:".xls","file-list-style":{display:"none"},style:{width:"inherit!important"}},{default:a(()=>[e(t(f),{size:"small"},{icon:a(()=>[e(le,{class:k(["text-icon",{"animate-spin":t(i)}])},null,8,["class"])]),default:a(()=>[d(" "+y(s.$t("common.import")),1)]),_:1})]),_:1}),e(t(f),{onClick:n[2]||(n[2]=_=>U("template")),size:"small"},{icon:a(()=>[e(K,{class:k(["text-icon",{"animate-spin":t(i)}])},null,8,["class"])]),default:a(()=>[n[6]||(n[6]=d(" 下载模板 "))]),_:1,__:[6]}),e(t(f),{onClick:n[3]||(n[3]=_=>U("data")),size:"small",disabled:!t(c).length},{icon:a(()=>[e(K,{class:k(["text-icon",{"animate-spin":t(i)}])},null,8,["class"])]),default:a(()=>[d(" "+y(s.$t("common.export")),1)]),_:1},8,["disabled"]),e(t(L),{onPositiveClick:g},{trigger:a(()=>[e(t(f),{size:"small",ghost:"",type:"error",disabled:t(c).length===0},{icon:a(()=>[e(oe,{class:"text-icon"})]),default:a(()=>[d(" "+y(s.$t("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:a(()=>[d(" "+y(s.$t("common.confirmDelete")),1)]),_:1})]),_:1})]),default:a(()=>[e(re,{"checked-row-keys":t(c),"onUpdate:checkedRowKeys":n[4]||(n[4]=_=>W(c)?c.value=_:null),columns:t(S),data:t(p),size:"small",loading:t(i),remote:"","row-key":_=>_.id,pagination:t(p).length?t(l):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1}),e(Me,{visible:t(h),"onUpdate:visible":n[5]||(n[5]=_=>W(h)?h.value=_:null),onSubmitted:t(b),"operate-type":t(G),"row-data":t(I),Pagination:t(l)},null,8,["visible","onSubmitted","operate-type","row-data","Pagination"])])}}}),Le=Fe(Oe,[["__scopeId","data-v-1b9bc952"]]);export{Le as default};
