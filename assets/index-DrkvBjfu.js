import{_ as se}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DtGc5Ytf.js";import{_ as re}from"./round-delete-tdauvCgt.js";import{_ as ie}from"./round-add-CmnuyzV1.js";import{d as O,aG as I,C as ce,A as J,a as ue,aI as Z,aE as de,E as V,c as M,o as T,w as t,f as e,a8 as me,L as Q,F as pe,H as P,h as a,G as W,aF as X,I as q,B as k,g as N,t as S,$ as x,a9 as _e,bc as fe,bd as ge,be as he,s as ve,K as be,a7 as Y,b3 as K,aT as ye,b as we,aU as R,aJ as xe,aV as Ce,e as ke,bf as E,bg as Ne,aO as De,aZ as Te}from"./index-CYktWG4g.js";import{u as Se,a as ze}from"./table-5HkGqXjJ.js";import{_ as ee}from"./Grid-yccwcNrM.js";import{_ as te}from"./FormItemGridItem-CEINFz71.js";import{_ as Ue}from"./round-search-DE64LlxI.js";import{_ as $e}from"./round-refresh-BIWjpXWE.js";import{_ as je}from"./DatePicker-DtsJbsvC.js";import{N as L}from"./Popconfirm-CztqIDpP.js";const Fe=O({name:"OperateDrawer",__name:"operate-drawer",props:I({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:I(["submitted"],["update:visible"]),setup(f,{emit:z}){const g=z,m=f,u=ce(r());function r(){return{id:0,connum:"",edbtime:void 0,execute:void 0}}async function D(){Object.assign(u,r()),m.operateType==="edit"&&m.rowData&&Object.assign(u,m.rowData)}const{formRef:U,validate:v,restoreValidation:b}=J(),$={connum:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},execute:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},edbtime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"}},C=ue(()=>({add:"新增合同变更",edit:"修改合同变更"})[m.operateType]),o=Z(f,"visible");de(o,()=>{o.value&&(D(),setTimeout(()=>{const c=document.querySelector(".n-scrollbar-content");c==null||c.scrollTo(0,0)},300),b())});function i(){o.value=!1}async function p(){var c;await v(),(c=window.$dialog)==null||c.info({title:"提示",content:"提交后即时执行,不可回滚是否继续?",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await y()}})}async function y(){var c,d;if(await v(),m.operateType==="edit"){const{data:w,error:_}=await fe([u]);_||(i(),g("submitted"),(c=window.$message)==null||c.success("修改成功"))}else{const{data:w,error:_}=await ge([{...u}]);_||(i(),g("submitted"),(d=window.$message)==null||d.success("添加成功"))}}return(c,d)=>{const w=te,_=ee,j=Q,F=me,B=q,s=_e,n=V("no-space");return T(),M(s,{show:o.value,"onUpdate:show":d[2]||(d[2]=l=>o.value=l),title:C.value,preset:"card",class:"w-600px"},{footer:t(()=>[e(B,{justify:"end",size:16},{default:t(()=>[e(a(k),{onClick:i},{default:t(()=>[N(S(a(x)("common.cancel")),1)]),_:1}),e(a(k),{type:"primary",onClick:p},{default:t(()=>[N(S(a(x)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(F,{class:"pr-20px"},{default:t(()=>[e(j,{ref_key:"formRef",ref:U,model:u,rules:$,"label-placement":"left","label-width":120},{default:t(()=>[e(_,{responsive:"screen","item-responsive":""},{default:t(()=>[e(w,{span:"24 m:24",label:"合同编号",path:"connum"},{default:t(()=>[P(e(a(W),{value:u.connum,"onUpdate:value":d[0]||(d[0]=l=>u.connum=l),placeholder:"请输入"},null,8,["value"]),[[n]])]),_:1}),m.operateType=="edit"?(T(),M(w,{key:0,span:"24 m:24",label:"执行状态",path:"execute"},{default:t(()=>[e(a(X),{filterable:"",options:[{label:"未执行",value:0},{label:"执行成功",value:1},{label:"未执失败",value:2}],clearable:"",value:u.execute,"onUpdate:value":d[1]||(d[1]=l=>u.execute=l)},null,8,["value"])]),_:1})):pe("",!0)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Be=O({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:I(["reset","search"],["update:model"]),setup(f,{emit:z}){he();const g=z,{formRef:m,restoreValidation:u}=J(),r=Z(f,"model"),D={当日:()=>{const o=new Date().getTime();return[o,o]},本周:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*7,o]},上月:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*30,o]},近一年:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*365,o]},近三年:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*365*3,o]}};function U(){r.value.fuzzy="",g("search")}async function v(){await u(),g("reset")}const b=ve(null);async function $(o,i){i?(r.value.startTime=String(K(0,i[0])),r.value.endTime=String(K(0,i[1]))):(r.value.startTime=null,r.value.endTime=null),g("search")}async function C(){g("search")}return(o,i)=>{const p=W,y=te,c=X,d=je,w=$e,_=k,j=Ue,F=q,B=ee,s=Q,n=Y;return T(),M(n,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(s,{ref_key:"formRef",ref:m,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:be(C,["enter"])},{default:t(()=>[e(B,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(y,{span:"24 s:12 m:6",label:"名称",path:"fuzzy"},{default:t(()=>[e(p,{clearable:"",value:r.value.fuzzy,"onUpdate:value":i[0]||(i[0]=l=>r.value.fuzzy=l),placeholder:"请输入名称",onClear:U},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:4",label:"执行状态",path:"execute"},{default:t(()=>[e(c,{clearable:"",filterable:"",value:r.value.execute,"onUpdate:value":[i[1]||(i[1]=l=>r.value.execute=l),C],placeholder:"请选择执行状态",options:[{label:"未执行",value:0},{label:"执行成功",value:1},{label:"未执失败",value:2}]},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:t(()=>[e(d,{value:b.value,"onUpdate:value":i[2]||(i[2]=l=>b.value=l),type:"daterange",clearable:"",class:"w-100%",shortcuts:D,"onUpdate:formattedValue":$},null,8,["value"])]),_:1}),e(y,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(F,{class:"w-full"},{default:t(()=>[e(_,{onClick:v},{icon:t(()=>[e(w,{class:"text-icon"})]),default:t(()=>[N(" "+S(a(x)("common.reset")),1)]),_:1}),e(_,{type:"primary",ghost:"",onClick:C},{icon:t(()=>[e(j,{class:"text-icon"})]),default:t(()=>[N(" "+S(a(x)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Pe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function H(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!Te(f)}const He=O({name:"manage_contractamendment",__name:"index",setup(f){const z=ye(),{columns:g,columnChecks:m,data:u,getData:r,loading:D,mobilePagination:U,searchParams:v}=Se({showTotal:!0,apiFn:Ne,apiParams:{page:1,pageSize:20,limit:20,execute:void 0,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"connum",title:"合同编号",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"execute",title:"执行状态",align:"center",width:120,render:s=>e(De,{type:s.execute==0?"warning":s.execute==1?"success":"error",round:!0},{default:()=>[s.execute==0?"未执行":s.execute==1?"执行成功":"执行失败"]})},{key:"edbtime",title:"执行时间",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:x("common.operate"),align:"center",width:140,fixed:"right",render:s=>{let n;return e("div",{class:"flex-center gap-8px"},[P(e(k,{type:"primary",ghost:!0,size:"small",onClick:()=>_(s.id)},H(n=x("common.edit"))?n:{default:()=>[n]}),[[V("no-auth"),"project:Change:Contract:update"]]),e(L,{onPositiveClick:()=>w(s.id)},{default:()=>x("common.confirmDelete"),trigger:()=>{let l;return P(e(k,{type:"error",ghost:!0,size:"small"},H(l=x("common.delete"))?l:{default:()=>[l]}),[[V("no-auth"),"project:Change:Contract:delete"]])}})])}}]}),{drawerVisible:b,operateType:$,editingData:C,handleAdd:o,handleEdit:i,checkedRowKeys:p,onBatchDeleted:y,onDeleted:c}=ze(u,r);async function d(){console.log(p.value),j(p.value.join(","),s=>{y()})}async function w(s){const{data:n,error:l}=await E(s);l||c()}function _(s){i(s)}async function j(s,n){const{data:l,error:G}=await E(s);if(!G)n&&n(l);else return!1}const F=s=>{r()},B=()=>{r()};return(s,n)=>{const l=q,G=ie,ne=re,ae=se,oe=xe,le=Y,A=V("no-auth");return T(),we("div",Pe,[e(Be,{model:a(v),"onUpdate:model":n[0]||(n[0]=h=>R(v)?v.value=h:null),onReset:B,onSearch:a(r)},null,8,["model","onSearch"]),e(le,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(l,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>n[4]||(n[4]=[ke("div",null,"合同变更",-1)])),_:1,__:[4]})]),"header-extra":t(()=>[e(l,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[P((T(),M(a(k),{onClick:a(o),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(G,{class:"text-icon"})]),default:t(()=>[n[5]||(n[5]=N(" "+S("新增")))]),_:1,__:[5]},8,["onClick"])),[[A,"project:Change:Contract:insert"]]),e(a(L),{onPositiveClick:d},{trigger:t(()=>[P((T(),M(a(k),{size:"small",ghost:"",type:"error",disabled:a(p).length==0},{icon:t(()=>[e(ne,{class:Ce(["text-icon",{"animate-spin":a(D)}])},null,8,["class"])]),default:t(()=>[n[6]||(n[6]=N(" "+S("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[A,"project:Change:Contract:delete"]])]),default:t(()=>[n[7]||(n[7]=N(" 确定要删除选中的数据吗？ "))]),_:1,__:[7]}),e(ae,{columns:a(m),"onUpdate:columns":n[1]||(n[1]=h=>R(m)?m.value=h:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(oe,{"checked-row-keys":a(p),"onUpdate:checkedRowKeys":n[2]||(n[2]=h=>R(p)?p.value=h:null),columns:a(g),data:a(u),size:"small","flex-height":!a(z).isMobile,loading:a(D),remote:"","row-key":h=>h.id,pagination:a(U),class:"sm:h-full","onUpdate:filters":F},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Fe,{visible:a(b),"onUpdate:visible":n[3]||(n[3]=h=>R(b)?b.value=h:null),onSubmitted:a(r),"operate-type":a($),"row-data":a(C)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{He as default};
