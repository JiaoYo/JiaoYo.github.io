import{d as X,q as ae,j as S,a0 as te,v as fe,s as ne,r as q,L as ve,o as E,c as B,w as t,g as l,O as le,M as me,i as y,$ as A,V as _e,e as W,aj as ge,h as f,t as g,f as Z,N as he,ax as Ie,ao as U,ap as Y,A as ye,Y as Se,B as J,E as ee,D as be,aa as oe,y as we,an as Q,ae as se,aq as xe,ar as Ae,S as ke,F as Ce,ay as Ee,az as De,av as ie}from"./index-CTzTZfFu.js";import{l as re}from"./lodash-CAQcMn8b.js";import{_ as Te,a as $e}from"./arrow-open-up-D-qyxWqB.js";import{_ as ze}from"./round-search-CB6VChpV.js";import{_ as Ne}from"./round-refresh-BwksxvhV.js";import{a as Pe,T as K}from"./basicconf-BLS8xPBW.js";import{b as Le,a as Ve,f as Me}from"./common-_4NcpDmm.js";import{_ as Oe}from"./Cascader-DKVZwkLC.js";import{_ as Ue}from"./FormItemGridItem-DSd0iFgR.js";import{_ as Be}from"./DatePicker-D4_zgTuY.js";import{_ as Re}from"./Grid-CGDLxETU.js";import{q as je,f as Ge,r as He}from"./events-CsNPV6jD.js";import{e as Fe}from"./exportExcel-D6OyA9oJ.js";import{_ as qe}from"./originlogInfo.vue_vue_type_script_setup_true_lang-BxNCxnFA.js";import{_ as We,a as Je}from"./DescriptionsItem-CoeogZ05.js";import{_ as ue}from"./DataTable-Qi7xROJl.js";import"./TimePicker-CLDnEWqT.js";import"./defineProperty-eprFK7_z.js";import"./Forward-CDNatGEL.js";import"./CollapseItem-sLFAp7cu.js";const Ke=X({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ae(["search"],["update:model"]),setup(_,{emit:T}){const $=T,s=S(!1),V=te(),{formRef:I,restoreValidation:h}=fe(),e=ne(_,"model"),k=S();(async()=>{const{data:u,error:n}=await Le();n||(k.value=u.map(c=>({...c,id:"-"+c.id,type:c.cname})))})();const x=q({eventsTypeDataList:[],eventsCategoryData:[]});async function z(){const{data:u,error:n}=await Ve();n||(x.eventsTypeDataList=u)}z();async function b(){const{data:u,error:n}=await Me();n||(x.eventsCategoryData=u)}b();function O(){e.value.fuzzy=void 0,o()}async function p(u,n){u?(e.value.startTime=u[0],e.value.endTime=u[1]):(e.value.startTime=null,e.value.endTime=null),$("search")}async function v(){await h(),e.value.lsid=null,e.value.etype=null,e.value.elevel=null,e.value.fuzzy=null,e.value.startAndEndSendSourceIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.timeRange=null,e.value.ectgr=null,e.value.startSourceIp=null,e.value.endSourceIp=null,e.value.startAimIp=null,e.value.endAimIp=null,e.value.startSIp=null,e.value.endSIp=null,e.value.startTime=null,e.value.endTime=null,Ie(()=>{$("search")})}const d=()=>{e.value.startAndEndSendSourceIp=null,o()},w=()=>{e.value.startAndEndSourceIp=null,o()},i=()=>{e.value.startAndEndAimSourceIp=null,o()};async function o(){var u,n,c,r,a,C,N,P,D,L;if(e.value.startAndEndSendSourceIp&&e.value.startAndEndSendSourceIp.length>0?(e.value.startSIp=e.value.startAndEndSendSourceIp[0]||null,e.value.endSIp=e.value.startAndEndSendSourceIp[1]||null):(e.value.startSIp=null,e.value.endSIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=void 0,e.value.endSourceIp=void 0),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimIp=void 0,e.value.endAimIp=void 0),e.value.startSIp&&!U(e.value.startSIp)||e.value.startSourceIp&&!U(e.value.startSourceIp)||e.value.startAimIp&&!U(e.value.startAimIp))return(u=window.$message)==null||u.destroyAll(),(n=window.$message)==null||n.error("请输入正确的IP地址"),!1;if(e.value.endSIp&&!U(e.value.endSIp)||e.value.endSourceIp&&!U(e.value.endSourceIp)||e.value.endAimIp&&!U(e.value.endAimIp))return(c=window.$message)==null||c.destroyAll(),(r=window.$message)==null||r.error("请输入正确的IP地址"),!1;if(e.value.startSIp&&e.value.endSIp&&Y(e.value.startSIp,e.value.endSIp)>0)return(a=window.$message)==null||a.destroyAll(),(C=window.$message)==null||C.error("发生源起始IP不能大于发生源终止IP"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&Y(e.value.startSourceIp,e.value.endSourceIp)>0)return(N=window.$message)==null||N.destroyAll(),(P=window.$message)==null||P.error("源起始IP不能大于源终止IP"),!1;if(e.value.startAimIp&&e.value.endAimIp&&Y(e.value.startAimIp,e.value.endAimIp)>0)return(D=window.$message)==null||D.destroyAll(),(L=window.$message)==null||L.error("目的起始IP不能大于目的终止IP"),!1;$("search")}return(u,n)=>{const c=Oe,r=Ue,a=ye,C=Se,N=Be,P=Ne,D=J,L=ze,R=Te,j=$e,G=ee,H=Re,F=be,pe=oe,ce=ve("no-space");return E(),B(pe,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[l(F,{ref_key:"formRef",ref:I,model:e.value,"label-placement":"left","label-width":y(V).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:he(o,["enter"])},{default:t(()=>[l(H,{responsive:"screen","item-responsive":"","y-gap":12},{default:t(()=>[s.value?(E(),B(r,{key:0,span:"24 s:24 m:6",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:t(()=>[l(c,{value:e.value.lsid,"onUpdate:value":[n[0]||(n[0]=m=>e.value.lsid=m),o],placeholder:"请选择日志源设备",options:k.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1})):le("",!0),l(r,{span:"24 s:12 m:6",label:"事件名称",path:"fuzzy",class:"pr-24px"},{default:t(()=>[me(l(a,{value:e.value.fuzzy,"onUpdate:value":n[1]||(n[1]=m=>e.value.fuzzy=m),placeholder:"请输入事件名称",clearable:"",onClear:O},null,8,["value"]),[[ce]])]),_:1}),l(r,{span:"24 s:24 m:6",label:"事件类型",path:"etype",class:"pr-24px"},{default:t(()=>[l(C,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.etype,"onUpdate:value":[n[2]||(n[2]=m=>e.value.etype=m),o],"value-field":"id","label-field":"pname",options:x.eventsTypeDataList},null,8,["value","options"])]),_:1}),l(r,{span:"24 s:12 m:6",label:y(A)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:t(()=>[l(C,{filterable:"",clearable:"",placeholder:y(A)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[n[3]||(n[3]=m=>e.value.elevel=m),o],options:y(_e)(y(Pe))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),s.value?(E(),W(ge,{key:1},[l(r,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSendSourceIp",class:"pr-24px"},{default:t(()=>[l(a,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSendSourceIp,"onUpdate:value":n[4]||(n[4]=m=>e.value.startAndEndSendSourceIp=m),onClear:w},null,8,["value"])]),_:1}),l(r,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndSourceIp",class:"pr-24px"},{default:t(()=>[l(a,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":n[5]||(n[5]=m=>e.value.startAndEndSourceIp=m),onClear:d},null,8,["value"])]),_:1}),l(r,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px"},{default:t(()=>[l(a,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":n[6]||(n[6]=m=>e.value.startAndEndAimSourceIp=m),onClear:i},null,8,["value"])]),_:1}),l(r,{span:"24 s:12 m:8",label:"产生时间",path:"timeRange",class:"pr-24px"},{default:t(()=>[l(N,{clearable:"",value:e.value.timeRange,"onUpdate:value":n[7]||(n[7]=m=>e.value.timeRange=m),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":p},null,8,["value"])]),_:1}),l(r,{span:"24 s:12 m:8",label:"事件类别",path:"ectgr",class:"pr-24px"},{default:t(()=>[l(C,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.ectgr,"onUpdate:value":[n[8]||(n[8]=m=>e.value.ectgr=m),o],"value-field":"id","label-field":"pname",options:x.eventsCategoryData},null,8,["value","options"])]),_:1})],64)):le("",!0),l(r,{span:"24 s:12 m:6",class:"pr-24px"},{default:t(()=>[l(G,{class:"w-full",align:"center"},{default:t(()=>[l(D,{onClick:v},{icon:t(()=>[l(P,{class:"text-icon"})]),default:t(()=>[f(" "+g(y(A)("common.reset")),1)]),_:1}),l(D,{type:"primary",ghost:"",onClick:o},{icon:t(()=>[l(L,{class:"text-icon"})]),default:t(()=>[f(" "+g(y(A)("common.search")),1)]),_:1}),Z("div",{class:"cursor-pointer",title:"精准查询",onClick:n[9]||(n[9]=m=>s.value=!s.value)},[s.value?(E(),B(R,{key:0,class:"text-icon"})):(E(),B(j,{key:1,class:"text-icon"}))])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width"])]),_:1})}}}),de=_=>(Ee("data-v-db5cc676"),_=_(),De(),_),Ye=de(()=>Z("span",null,"基本信息",-1)),Qe=de(()=>Z("span",null,"原始日志信息",-1)),Xe={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"400px"}},Ze={key:1,class:"max-h-500px min-h-450px"};function el(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!se(_)}const ll=X({__name:"detailInfo",props:ae({detailInfo:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(_){const T=ne(_,"detailVisible"),$=_,s=S();we(()=>T.value,async p=>{p&&(s.value=$.detailInfo,e())});const V=[{title:"",key:"index",width:50,render:(p,v)=>`${v+1}`},{key:"pname2",title:"事件类别",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:p=>{(p.elevel===void 0||p.elevel===null)&&(p.elevel=1);const v={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},d=A(K[p.elevel]);let w={color:v[p.elevel],textColor:"#ffffff",borderColor:v[p.elevel]};return l(Q,{size:"small",color:w},el(d)?d:{default:()=>[d]})}},{key:"sourceip",title:"发生源IP",align:"center",width:120},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"operate",title:A("common.operate"),align:"center",width:80,fixed:"right",render:p=>l("div",{class:"flex-center gap-8px"},[l(J,{type:"info",ghost:!0,size:"small",onClick:()=>O(p)},{default:()=>[f("详情")]})])}],I=S(!1);let h=S([]);const e=async p=>{var w;if(!I.value)I.value=!0;else return;const{data:v,error:d}=await je({aggid:(w=s.value)==null?void 0:w.aggid,limit:10,pageId:p});d||(I.value=!1,p?h.value=[...h.value,...v]:h.value=v)};function k(p){var d;Math.abs(p.target.scrollTop+p.target.offsetHeight-p.target.scrollHeight)<=20&&((d=s.value)==null?void 0:d.aggre)>h.value.length&&M()}const M=re.debounce(()=>{e(h.value[h.value.length-1].id)},300),x=q({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:p,endIndex:v,page:d,pageSize:w,pageCount:i,itemCount:o}){var u;return`已加载${h.value.length}条 共计${(u=s.value)==null?void 0:u.aggre} 条`}}),z=S(!1),b=S(),O=async p=>{z.value=!0,b.value=p};return(p,v)=>{const d=We,w=Je,i=ee,o=xe,u=ue,n=Ae,c=ke,r=Ce;return E(),B(r,{show:T.value,"onUpdate:show":v[1]||(v[1]=a=>T.value=a),title:"事件详情",preset:"card",class:"w-1000px"},{default:t(()=>[l(c,{class:"max-h-600px pr-20px"},{default:t(()=>[l(n,{type:"line",animated:""},{default:t(()=>[l(o,{name:"1"},{tab:t(()=>[Ye]),default:t(()=>[l(i,{vertical:"",size:12},{default:t(()=>[l(w,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:t(()=>[l(d,{label:"事件名称"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.ename),1)]}),_:1}),l(d,{label:"事件类型"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.pname1),1)]}),_:1}),l(d,{label:"事件类别"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.pname2),1)]}),_:1}),l(d,{label:"事件等级"},{default:t(()=>{var a,C,N,P,D,L,R,j,G,H;return[l(y(Q),{size:"small",color:{textColor:"#ffffff",borderColor:((a=s.value)==null?void 0:a.elevel)===0?"#8e9dff":((C=s.value)==null?void 0:C.elevel)===1?"#5da8ff":((N=s.value)==null?void 0:N.elevel)===2?"#fedc69":((P=s.value)==null?void 0:P.elevel)===3?"#ff9874":((D=s.value)==null?void 0:D.elevel)===4?"#ff0000":"#5da8ff",color:((L=s.value)==null?void 0:L.elevel)===0?"#8e9dff":((R=s.value)==null?void 0:R.elevel)===1?"#5da8ff":((j=s.value)==null?void 0:j.elevel)===2?"#fedc69":((G=s.value)==null?void 0:G.elevel)===3?"#ff9874":((H=s.value)==null?void 0:H.elevel)===4?"#ff0000":"#5da8ff"}},{default:t(()=>{var F;return[f(g(y(A)(y(K)[(F=s.value)==null?void 0:F.elevel])),1)]}),_:1},8,["color"])]}),_:1}),l(d,{label:"日志源设备"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.type),1)]}),_:1}),l(d,{label:"聚合开始时间"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.aggrestarttime),1)]}),_:1}),l(d,{label:"聚合结束时间"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.aggreendtime),1)]}),_:1}),l(d,{label:"聚合数量"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.aggre),1)]}),_:1}),l(d,{label:"发生源IP"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.sip),1)]}),_:1}),l(d,{label:"源IP"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.sourceip),1)]}),_:1}),l(d,{label:"源端口"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.sourceport),1)]}),_:1}),l(d,{label:"目的IP"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.aimip),1)]}),_:1}),l(d,{label:"目的端口"},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.aimport),1)]}),_:1}),l(d,{label:"事件描述",span:3},{default:t(()=>{var a;return[f(g((a=s.value)==null?void 0:a.aimip),1)]}),_:1})]),_:1})]),_:1})]),_:1}),l(o,{name:"2"},{tab:t(()=>[Qe]),default:t(()=>[y(h).length==0?(E(),W("div",Xe," 暂无原始日志信息 ")):(E(),W("div",Ze,[l(u,{columns:V,data:y(h),size:"small","scroll-x":762,"row-key":a=>a.id,"virtual-scroll":"",class:"sm:h-full",pagination:x,onScroll:k,loading:I.value,"max-height":400,remote:""},null,8,["data","row-key","pagination","loading"])])),l(qe,{detailVisible:z.value,"onUpdate:detailVisible":v[0]||(v[0]=a=>z.value=a),detailInfo:b.value},null,8,["detailVisible","detailInfo"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),al=ie(ll,[["__scopeId","data-v-db5cc676"]]),tl={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function nl(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!se(_)}const ol=X({name:"eventalarm_eventalarm",__name:"index",setup(_){const T=te(),$=S(window.innerHeight-306),s=S(!1),V=S(),I=q({pageId:void 0,limit:100,lsid:void 0,etype:void 0,ectgr:void 0,elevel:void 0,startSIp:void 0,endSIp:void 0,startSourceIp:void 0,endSourceIp:void 0,startAimIp:void 0,endAimIp:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),h=[{title:"",key:"index",width:80,render:(i,o)=>`${o+1}`},{key:"ename",title:"事件名称",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:160},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",width:120,render:i=>{(i.elevel===void 0||i.elevel===null)&&(i.elevel=1);const o={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},u=A(K[i.elevel]);let n={color:o[i.elevel],textColor:"#ffffff",borderColor:o[i.elevel]};return l(Q,{size:"small",color:n},nl(u)?u:{default:()=>[u]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"sip",title:"发生源IP",align:"center",width:160},{key:"aggreendtime",title:"聚合结束时间",align:"center",width:160},{key:"operate",title:A("common.operate"),align:"center",width:100,fixed:"right",render:i=>l("div",{class:"flex-center gap-8px"},[l(J,{type:"primary",ghost:!0,size:"small",onClick:()=>d(i)},{default:()=>[f("查看")]})])}],e=S([]),k=S(!1),M=async(i=!1)=>{if(!k.value)k.value=!0;else return;const{data:o,error:u}=await Ge(I);u||(i?e.value=[...e.value,...o]:e.value=o,k.value=!1)};M();const x=S(!0),z=()=>{e.value=[],I.pageId=void 0,(o=>Object.keys(o).filter(c=>c!=="limit"&&c!=="_t").some(c=>o[c]!==void 0&&o[c]!==""&&o[c]!==null))(I)?x.value=!1:(x.value=!0,O()),M()},b=q({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:i,endIndex:o,page:u,pageSize:n,pageCount:c,itemCount:r}){return`已加载${e.value.length}条`+(e.value.length?x.value?` 共计 ${e.value.length>0?r??0:0} 条`:e.value.length>=I.limit?"  预计还有更多":"":"")}});async function O(){const{data:i,error:o}=await He();o||(b.pageCount=20,b.total=Number(i),b.itemCount=Number(i))}O();function p(i){Math.abs(i.target.scrollTop+i.target.offsetHeight-i.target.scrollHeight)<=20&&b.total>e.value.length&&v()}const v=re.debounce(()=>{var i;((i=e.value)==null?void 0:i.length)<b.total&&(I.pageId=e.value[e.value.length-1].id,M(!0))},300);async function d(i){V.value=i,s.value=!0}async function w(){if(!e.value.length)return;const i=JSON.parse(JSON.stringify(e.value)),o=[];i.forEach(n=>{const c={};h.forEach(r=>{if(n.hasOwnProperty(r.key)){const a=r.key=="elevel"?A(K[n[r.key]]):n[r.key];c[r.title]=a}}),o.push(c)}),Fe(o,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50},{wpx:100},{wpx:150}],"安全事件_"+new Date().getTime())}return(i,o)=>{const u=ee,n=ue,c=oe;return E(),W("div",tl,[l(Ke,{model:I,"onUpdate:model":o[0]||(o[0]=r=>I=r),onSearch:z},null,8,["model"]),l(c,{title:"安全事件",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[l(u,null,{default:t(()=>[l(y(J),{type:"primary",size:"small",ghost:"",onClick:w,title:"导出已加载"},{default:t(()=>[f("导出已加载")]),_:1})]),_:1})]),default:t(()=>[l(n,{columns:h,data:e.value,size:"small","flex-height":!y(T).isMobile,loading:k.value,remote:"","scroll-x":h.reduce((r,a)=>r+a.width,0),"row-key":r=>r.id,pagination:b,"virtual-scroll":"",onScroll:p,class:"sm:h-full","max-height":$.value},null,8,["data","flex-height","loading","scroll-x","row-key","pagination","max-height"])]),_:1}),l(al,{detailVisible:s.value,"onUpdate:detailVisible":o[1]||(o[1]=r=>s.value=r),detailInfo:V.value},null,8,["detailVisible","detailInfo"])])}}}),kl=ie(ol,[["__scopeId","data-v-091f58e5"]]);export{kl as default};
