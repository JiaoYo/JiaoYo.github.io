import{_ as ie}from"./round-add-DtZxKnHc.js";import{d as te,ay as ce,X as ue,Y as pe,A as de,C as me,aw as fe,z as ae,s as w,aL as _e,c as B,o as v,a2 as oe,w as s,f as a,M as he,L as ge,aM as ye,h as n,bq as ve,J as ne,B as b,g as L,t as J,$ as D,cE as be,aG as Y,b8 as we,aN as ke,ax as Q,i as Se,F as A,b as W,G as H,aO as K,c_ as xe,I,aD as je,ez as Te,eA as De,aV as Ne,a9 as Ce}from"./index-BhODWnwk.js";import{u as Pe,a as ze}from"./table-Djtp3DGd.js";import{_ as Ie,d as Be}from"./drawerLog-CsD2n-a-.js";import{_ as Le}from"./round-search-DuF6crdJ.js";import{u as Z}from"./usePageData-BRSC0p7p.js";import{g as Ue}from"./business-B0WQevjL.js";import{_ as qe}from"./Grid-CX2M5k7E.js";import{_ as Re}from"./FormItemGridItem-BHKuIZBQ.js";import{N as Fe}from"./Popconfirm-DaOtvNXy.js";import"./text-DYBwWc4C.js";const Me=te({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ce(["reset","search","clear"],["update:model"]),setup(h,{emit:U}){const d=ue(),q=pe(),m=U,{formRef:f}=de(),R=me("pname"),l=fe(h,"model"),F=ae(),r=w([]),{pageData:i,getData:y,nextPage:M}=Z(be),g=async e=>{const t=e.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&i.data.length<i.total&&(await M(),r.value=i.data,await Y(),setTimeout(()=>{t.scrollTop=c}))},{pageData:_,getData:E,nextPage:G}=Z(we),N=async e=>{const t=e.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&_.data.length<_.total&&(await G(),r.value=_.data,await Y(),setTimeout(()=>{t.scrollTop=c}))},O=async e=>{l.value.creater=e,m("search")},k=async e=>{var t,c;x.value=!0,e?(l.value.pid=e,m("search"),F.setProjectInfo({pname:(t=r.value.find(p=>p.id==e))==null?void 0:t.proname,pid:e}),R.value=(c=r.value.find(p=>p.id==e))==null?void 0:c.proname):m("search")},V=_e.debounce(async e=>{await y({fuzzy:e,page:1}),r.value=i.data},300),S=w(!1),x=w(!1),j=e=>{if(l.value.pid=null,S.value=!0,x.value=!1,!e){P();return}V(e)},C=async()=>{S.value&&!x.value&&(await y({page:1}),r.value=i.data,S.value=!1)},P=async()=>{await y({page:1}),r.value=i.data};(async()=>{await y({fuzzy:d.query.pname?d.query.pname:""}),r.value=i.data,l.value.pid=d.query.prjId?Number(d.query.prjId):void 0,l.value.fuzzy=d.query.pname?d.query.pname:"",m("search"),setTimeout(()=>{q.replace({path:d.path,query:{}})},10)})(),E({usertypes:"2,3"});async function o(){m("search")}return(e,t)=>{const c=ye,p=Re,$=Le,z=b,u=ne,se=qe,le=he,re=oe;return v(),B(re,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[a(le,{ref_key:"formRef",ref:f,model:l.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ge(o,["enter"])},{default:s(()=>[a(se,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[a(p,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:s(()=>[a(c,{filterable:"",clearable:"",value:l.value.pid,"onUpdate:value":[t[0]||(t[0]=T=>l.value.pid=T),k],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:r.value,onScroll:g,onClear:P,onSearch:j,onBlur:C},null,8,["value","options"])]),_:1}),a(p,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:s(()=>[a(c,{clearable:"",filterable:"",value:l.value.creater,"onUpdate:value":[t[1]||(t[1]=T=>l.value.creater=T),O],placeholder:"请选择","label-field":"username","value-field":"id",options:n(_).data,onScroll:N},null,8,["value","options"])]),_:1}),a(p,{span:"24 s:12 m:6",label:"项目类型",path:"dtype"},{default:s(()=>[a(c,{clearable:"",filterable:"",value:l.value.dtype,"onUpdate:value":[t[2]||(t[2]=T=>l.value.dtype=T),o],placeholder:"请选择调试类型",options:n(ve)(n(Ue))},null,8,["value","options"])]),_:1}),a(p,{span:"24  s:12 m:6",class:"pr-24px"},{default:s(()=>[a(u,{class:"w-full"},{default:s(()=>[a(z,{type:"primary",ghost:"",onClick:o},{icon:s(()=>[a($,{class:"text-icon"})]),default:s(()=>[L(" "+J(n(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ee={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ge={key:0};function ee(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Ne(h)}const Ze=te({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0}},emits:["thereIsData"],setup(h,{expose:U,emit:d}){const q=ke(),m=ae(),f=h,R=w("");Ce("pname",R);const l=d,{columns:F,data:r,getData:i,loading:y,mobilePagination:M,searchParams:g}=Pe({showTotal:!0,immediate:!1,apiFn:Te,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:"项目名称",align:"center",width:220,render:o=>a("div",null,[o.proname])},{key:"charctras",title:"字数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:D("common.operate"),align:"center",width:140,fixed:"right",render:o=>{let e;return a("div",{class:"flex-center gap-8px"},[a(b,{type:"primary",ghost:!0,size:"small",onClick:()=>P(o)},{default:()=>[L("查看详情")]}),m.userInfo.id==o.creater&&I(a(b,{type:"primary",ghost:!0,size:"small",onClick:()=>x(o.id)},ee(e=D("common.edit"))?e:{default:()=>[e]}),[[A("no-auth"),"project:Summary:update"]]),m.userInfo.id==o.creater&&a(Fe,{onPositiveClick:()=>S(o.id)},{default:()=>D("common.confirmDelete"),trigger:()=>{let t;return I(a(b,{type:"error",ghost:!0,size:"small"},ee(t=D("common.delete"))?t:{default:()=>[t]}),[[A("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:_,operateType:E,editingData:G,handleAdd:N,handleEdit:O,checkedRowKeys:k,onDeleted:V}=ze(r,i);async function S(o){const{data:e,error:t}=await De(o);t||V()}function x(o){O(o)}const j=w(!1),C=w({}),P=o=>{j.value=!0,C.value=o},X=()=>{i()};return Q(()=>f.pid,async o=>{o&&(g.pid=o)}),Q(()=>r.value,async o=>{o.length>0?l("thereIsData",1):l("thereIsData",0)}),Se(()=>{}),U({getData:i}),(o,e)=>{const t=ne,c=ie,p=je,$=oe,z=A("no-auth");return v(),W("div",Ee,[f.pid?H("",!0):(v(),B(Me,{key:0,model:n(g),"onUpdate:model":e[0]||(e[0]=u=>K(g)?g.value=u:null),onReset:X,onSearch:n(i),onClear:e[1]||(e[1]=u=>r.value=[])},null,8,["model","onSearch"])),a($,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},xe({header:s(()=>[a(t,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:s(()=>[f.pid?H("",!0):(v(),W("div",Ge,"项目总结"))]),_:1}),f.pid?I((v(),B(n(b),{key:0,onClick:n(N),size:"small",ghost:"",type:"primary"},{icon:s(()=>[a(c,{class:"text-icon"})]),default:s(()=>[e[5]||(e[5]=L(" "+J("新增")))]),_:1,__:[5]},8,["onClick"])),[[z,"project:Summary:insert"]]):H("",!0)]),default:s(()=>[a(p,{"checked-row-keys":n(k),"onUpdate:checkedRowKeys":e[2]||(e[2]=u=>K(k)?k.value=u:null),columns:n(F),data:n(r),size:"small","flex-height":!n(q).isMobile,loading:n(y),remote:"","row-key":u=>u.id,pagination:n(M),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Ie,{visible:n(_),"onUpdate:visible":e[3]||(e[3]=u=>K(_)?_.value=u:null),onSubmitted:n(i),"operate-type":n(E),pid:f.pid||n(g).pid,"row-data":n(G)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),a(Be,{visible:j.value,"onUpdate:visible":e[4]||(e[4]=u=>j.value=u),"row-data":C.value},null,8,["visible","row-data"])]),_:2},[f.pid?void 0:{name:"header-extra",fn:s(()=>[a(t,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[I((v(),B(n(b),{onClick:n(N),size:"small",ghost:"",type:"primary"},{icon:s(()=>[a(c,{class:"text-icon"})]),default:s(()=>[e[6]||(e[6]=L(" "+J("新增")))]),_:1,__:[6]},8,["onClick"])),[[z,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{Ze as default};
