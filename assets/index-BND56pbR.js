import{o as $,e as M,f as y,d as ae,j as f,aV as A,g as o,v as le,af as ne,w as r,c as I,h,t as g,i as x,B as C,aW as B,a0 as E,aK as W,aq as se,aX as U,aY as P,E as J,az as K,ac as oe,aZ as re,L as ce,a_ as ue,a$ as de,a2 as ie,N as pe,O as _e,P as ve}from"./index-ByQsQpYG.js";import{_ as fe}from"./Tree-1LWg9QBk.js";import{_ as me}from"./Slider-DDBD0iVt.js";import{_ as he}from"./DataTable-BmHddFa8.js";import{_ as ye}from"./Split-dXUwIDG1.js";import"./RadioGroup-DngHp1Rz.js";import"./Forward-L7FBmiBZ.js";const ke={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},ge=y("path",{fill:"currentColor",d:"M17 9.17a1 1 0 0 0-1.41 0L12 12.71L8.46 9.17a1 1 0 0 0-1.41 0a1 1 0 0 0 0 1.42l4.24 4.24a1 1 0 0 0 1.42 0L17 10.59a1 1 0 0 0 0-1.42"},null,-1),xe=[ge];function we(S,D){return $(),M("svg",ke,[...xe])}const be={name:"uil-angle-down",render:we},Ne=S=>(pe("data-v-4389a895"),S=S(),_e(),S),Ce={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},$e={class:"flex h-100%",style:{"flex-direction":"column"}},Se={class:"flex"},Oe=Ne(()=>y("span",null,"监测级别",-1)),Le={class:"flex items-center"},Te={class:"flex items-center"},Ie={class:"cursor-pointer"},ze=ae({name:"configsetting_realtimedata_channeldetection",__name:"index",setup(S){const D=f({0:"简单",1:"标准",2:"详细"}),b=f(!0),w=f([]),k=f(null),V=f([{title:"监视时间",key:"time",width:240,render(e){return A(2,e.time)}},{title:"监视类型",key:"data_type",width:120,render(e){return e.data_type==0?"发送>>":e.data_type==1?"接收<<":e.data_type==2?"信息  ":e.data_type==3?"警告  ":"错误  "}},{title:"内容长度",key:"data_len",width:120},{title:"监视内容",key:"data_buf",render(e){return o("div",{innerHTML:e.data_buf},null)}}]),t=f({acceptColor:"#d6f0f0",sendOutColor:"#ffe3bf",infoColor:"#f4f4f5",warningColor:"#fdf6ec",errorColor:"#fee7e7",acceptNums:0,sendOutNums:0,infoNums:0,errorNums:0,warningNums:0}),H=[{label:"信息",key:0},{label:"警告",key:1},{label:"错误",key:2}],q=e=>W(B,{value:e.key==0?t.value.infoNums:e.key==1?t.value.warningNums:t.value.errorNums},{default:()=>W("div",{class:"c-#676d71 w-50px h-32px flex items-center justify-center",style:{backgroundColor:e.key==0?t.value.infoColor:e.key==1?t.value.warningColor:t.value.errorColor,borderRadius:"4px"}},{default:()=>e.label})}),Q=e=>({style:{minHeight:"50px",background:e.data_type==0?t.value.sendOutColor:e.data_type==1?t.value.acceptColor:e.data_type==2?t.value.infoColor:e.data_type==3?t.value.warningColor:t.value.errorColor}}),G=({option:e})=>e.key==0?"":e.chl_status!==null?W("span",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:e.hasOwnProperty("chl_status")&&e.chl_status==1?"#00b42a":e.chl_status==2?"#ff0000":"#ccc"}}):"",N=f(),X=async()=>{var l,s,c,v;const{data:e,error:a}=await se();if((e==null?void 0:e.length)==0)return;const d=e.reduce((m,i)=>{const _=i.chlType===0?"采集通道":i.chlType===1?"转发通道":"系统通道";let n=m.find(u=>u.key===_);return n||(n={key:_,label:_,children:[],chl_status:null},m.push(n)),n.children.push({key:i.id,label:i.chlName,chlType:i.chlType,chl_status:null}),_=="系统通道"?[]:m},[]);N.value=d,N.value.length>0&&(p.value.chlId=(s=(l=N.value[0])==null?void 0:l.children[0])==null?void 0:s.key,T.value=[(v=(c=N.value[0])==null?void 0:c.children[0])==null?void 0:v.key],Y(),L())},p=f({chlId:"",type:1,level:1}),O=f(null),L=()=>{var c;(c=O.value)==null||c.close(),w.value=[],t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0};const e=new U;let a="";e.appendAsciiStr("$Link+Qi^123987WWg#"+p.value.chlId),a=e.end();const d=new Date().getTime(),l=p.value.level==0?"1":p.value.level==1?"257":"65793";p.value.type=1;const s=new P(J.replace("https","wss")+`/ChannelDetectionWebsocket/${p.value.chlId}/${p.value.type}/${l}/${a}/${d}?token=${K()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});O.value=s,s.connect(),s.onclose(()=>{}),s.onerror(()=>{}),s.onopen(()=>{}),s.onmessage(v=>{if(console.log(v,"通道监测websocket接受数据"),!j(v.data))return;const m=JSON.parse(v.data);if(w.value.push(...m.param),b.value&&k.value){const n=document.querySelector(".n-scrollbar-content"),u=n==null?void 0:n.scrollHeight;n&&oe(()=>{k.value.scrollTo({top:u,behavior:"smooth"})})}t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0};let i=`      监视时间                  监视类型      内容长度          监视内容
`,_="";w.value.forEach(n=>{switch(n.data_type){case 0:t.value.sendOutNums+=1;break;case 1:t.value.acceptNums+=1;break;case 2:t.value.infoNums+=1;break;case 3:t.value.warningNums+=1;break;case 4:t.value.errorNums+=1;break}_+=A(2,n.time)+"           "+(n.data_type==0?"发送>>":n.data_type==1?"接受<<":n.data_type==2?"信息  ":n.data_type==3?"警告  ":"错误  ")+"         "+n.data_len+"          "+n.data_buf+`
`}),k.value.content=i+_,w.value.length>=1e3&&(w.value=[])})},z=f(null),Y=()=>{var s;(s=z.value)==null||s.close();const e=new U;let a="";e.appendAsciiStr("$Link+Qi^123987WWg#getchlstatus"),a=e.end();const d=new Date().getTime(),l=new P(J.replace("https","wss")+`/ChannelStatusWebsocket/getchlstatus/${a}/${d}?token=${K()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});z.value=l,l.connect(),l.onclose(()=>{}),l.onerror(()=>{}),l.onopen(()=>{}),l.onmessage(c=>{let v=[];console.log(c,"通道状态websocket接受数据"),j(c.data)&&(v=JSON.parse(c.data).data,N.value.forEach(m=>{var i;(i=m.children)==null||i.forEach(_=>{v.forEach(n=>{n.chl_id==_.key&&(_.chl_status=n.chl_status)})})}))})};le(()=>{X()}),ne(()=>{var e,a;(e=O.value)==null||e.close(),(a=z.value)==null||a.close()});const T=f([]),Z=async(e,a,d)=>{var l,s,c;((l=d.node)==null?void 0:l.key)!=T.value[0]&&(T.value=[(s=d.node)==null?void 0:s.key],p.value.chlId=(c=d.node)==null?void 0:c.key,L())},F=e=>{L()},R=e=>{p.value.type=e,O.value.close(),e==1&&L()},ee=()=>{w.value=[],t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0},k.value.content=""},te=()=>{let e=k.value.content?k.value.content+"":k.value.content,a=new re(".Btn",{text:function(){return e}});a.on("success",d=>{var l;(l=window.$message)==null||l.success("复制成功"),a.destroy()}),a.on("error",d=>{var l;(l=window.$message)==null||l.error("复制失败"),a.destroy()})},j=e=>{try{return JSON.parse(e),!0}catch{return!1}};return(e,a)=>{const d=fe,l=ce,s=me,c=ue,v=be,m=de,i=ie,_=he,n=ye;return $(),M("div",Ce,[o(i,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:r(()=>[o(n,{direction:"horizontal",class:"sm:h-full","default-size":.15,max:.35,min:.1,"resize-trigger-size":6},{1:r(()=>[o(d,{"block-line":"","default-expand-all":"",data:N.value,"checked-keys":T.value,"expand-on-click":!1,"check-strategy":"child","onUpdate:checkedKeys":Z,"render-prefix":G,checkable:""},null,8,["data","checked-keys"])]),2:r(()=>[y("div",$e,[o(i,{bordered:!1,size:"small",class:"card-wrapper",style:{"min-height":"60px"}},{header:r(()=>[o(l,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:r(()=>[p.value.type==0?($(),I(x(C),{key:0,onClick:a[0]||(a[0]=u=>R(1))},{default:r(()=>[h(g("开启监视"))]),_:1})):($(),I(x(C),{key:1,onClick:a[1]||(a[1]=u=>R(0))},{default:r(()=>[h(g("停止监视"))]),_:1})),b.value?($(),I(x(C),{key:3,onClick:a[3]||(a[3]=u=>b.value=!b.value)},{default:r(()=>[h(g("停止滚屏"))]),_:1})):($(),I(x(C),{key:2,onClick:a[2]||(a[2]=u=>b.value=!b.value)},{default:r(()=>[h(g("开启滚屏"))]),_:1})),o(x(C),{onClick:ee},{default:r(()=>[h(g("清空列表"))]),_:1}),o(x(C),{onClick:te,class:"Btn"},{default:r(()=>[h(g("复制全部内容"))]),_:1})]),_:1})]),"header-extra":r(()=>[o(l,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:r(()=>[y("div",Se,[Oe,o(s,{value:p.value.level,"onUpdate:value":[a[4]||(a[4]=u=>p.value.level=u),F],step:1,marks:D.value,min:0,max:2,style:{margin:"0 10px",width:"170px !important"}},null,8,["value","marks"])]),y("div",Le,[h(" 发送报文颜色 "),o(c,{class:"w-24px h-24px ml-5px",swatches:["#ffe3bf","#d6f0f0"],value:t.value.sendOutColor,"onUpdate:value":a[5]||(a[5]=u=>t.value.sendOutColor=u)},null,8,["value"])]),y("div",Te,[h(" 接受报文颜色 "),o(c,{class:"w-24px h-24px ml-5px",swatches:["#ffe3bf","#d6f0f0"],value:t.value.acceptColor,"onUpdate:value":a[6]||(a[6]=u=>t.value.acceptColor=u)},null,8,["value"])]),o(x(B),{value:t.value.sendOutNums},{default:r(()=>[y("div",{style:E({background:t.value.sendOutColor}),class:"c-#676d71 w-50px h-32px flex items-center justify-center"},g("发送"),4)]),_:1},8,["value"]),o(x(B),{value:t.value.acceptNums},{default:r(()=>[y("div",{style:E({background:t.value.acceptColor}),class:"c-#676d71 w-50px h-32px flex items-center justify-center"},g("接收"),4)]),_:1},8,["value"]),o(m,{trigger:"click",options:H,"render-label":q},{default:r(()=>[y("span",Ie,[h("其他类型 "),o(v,{class:"font-size-20px"})])]),_:1})]),_:1})]),_:1}),o(_,{columns:V.value,ref_key:"tableRef",ref:k,data:w.value,size:"small",remote:"","row-key":u=>u.id,"flex-height":!0,"scroll-x":"",class:"sm:h-full flex-1 pl-16px","row-props":Q},null,8,["columns","data","row-key"])])]),_:1})]),_:1})])}}}),Ue=ve(ze,[["__scopeId","data-v-4389a895"]]);export{Ue as default};
