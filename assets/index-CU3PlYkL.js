import{_ as ut}from"./table-column-setting.vue_vue_type_script_setup_true_lang-B5exJvFm.js";import{_ as pt}from"./round-refresh-Bs77RvlJ.js";import{_ as mt}from"./export-DwQa_Uz4.js";import{_ as ft}from"./round-delete-Qhm9c8vJ.js";import{an as Ce,o as B,e as Ie,f as ot,d as Ue,n as pe,r as ke,p as Ke,q as Me,s as vt,a5 as Ve,b as it,$ as L,as as st,g as e,y as we,w as a,h as T,t as U,i as l,ah as X,z as te,ak as Te,aA as Oe,ao as Pe,au as Fe,ae as je,F as me,B as O,am as Be,ai as Ee,J as qe,I as xe,aj as Ge,aS as gt,j as De,ag as Ze,c as le,C as Ne,T as ht,ac as bt,v as _t,A as yt,a9 as ce,al as wt,ax as Tt,E as kt,ay as Ft,a0 as It}from"./index-CI2HX52s.js";import{_ as Lt}from"./round-add-CSo305d1.js";import{_ as Nt}from"./round-search-DiRf-ajt.js";import{u as Je,a as We}from"./table-CL5JRpix.js";import{p as ue,d as dt,a as Pt,b as et,c as tt}from"./gather-BOlnaEEn.js";import{_ as He}from"./FormItemGridItem-H5-g3JS3.js";import{_ as Qe}from"./Grid-BjU2Fuoz.js";import{_ as Xe}from"./DataTable-iODjs3SB.js";import{N as lt}from"./Popconfirm-D1QMSnFH.js";import{_ as Dt}from"./InputGroupLabel-Auyu3DEo.js";import"./RadioGroup-A-fOClpI.js";import"./Forward-CE5gwjyU.js";function Ct(I){return Ce({url:"/transTag/selectPage.do",method:"get",params:I})}function rt(I){return Ce({url:"/transTag/insert.do",method:"post",data:I})}function Se(I){return Ce({url:"/transTag/update.do",method:"post",data:I})}function at(I){return Ce({url:"/transTag/delete.do",method:"delete",params:I})}const Ut={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},jt=ot("path",{fill:"currentColor",d:"M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36M20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83l3.75 3.75z"},null,-1),xt=[jt];function At(I,Y){return B(),Ie("svg",Ut,[...xt])}const Rt={name:"ic-round-edit",render:At},$t=Ue({__name:"add_model",props:pe({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:pe(["submitted"],["update:visible"]),setup(I,{emit:Y}){const n=ke({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:{},dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),g=Ke(I,"visible"),E=Y,z=I,t=ke(G());function G(){return{chlId:void 0,devId:void 0,tagDevId:"",tagName:"",tagId:void 0,tagDesc:"",tagUnit:"",tagType:1,tagK:1,objAddr:"0",collectType:1,dataType:4,dataFormat:0}}async function y(){var h;const{data:r,error:i}=await gt({page:1,limit:1e4,type:1});i||(n.deveicelList=r.list.map(s=>({...s,label:s.devName,value:s.id+"_"+s.chlId})),z.operateType==="add"&&n.deveicelList.length>0&&!t.tagDevId&&(t.tagDevId=(h=n.deveicelList[0])==null?void 0:h.value,t.devId=Number(t.tagDevId.split("_")[0]),t.chlId=Number(t.tagDevId.split("_")[1]),t.collectType=void 0),N())}async function N(){const{data:r,error:i}=await Fe({chlId:t.chlId});i||(n.functionList=JSON.parse(r).data,t.collectType=n.functionList[0].FuncCode)}function S(){Object.assign(t,G()),y(),z.operateType==="edit"&&z.rowData&&(Object.assign(t,z.rowData),w(z.rowData))}const{formRef:Z,validate:_,restoreValidation:ae}=Me();vt(),Ve(g,()=>{g.value&&(S(),ae())});const j=()=>{g.value=!1};function w(r,i){console.log(r),r==0||r==1||r==2||r==3||r==4||r==7?n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:r==5||r==6||r==8||r==9||r==10||r==12||r==13?n.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],n.collectionPointForm.dataFormatList.find(h=>h.value===t.dataFormat)||(t.dataFormat=n.collectionPointForm.dataFormatList[0].value)}const K=async()=>{var r,i;if(await _(),console.log(t),z.operateType==="add"){const{data:h,error:s}=await rt([t]);s||(j(),(r=window.$message)==null||r.success("添加成功"),E("submitted"))}else{const{data:h,error:s}=await Se([t]);s||(j(),(i=window.$message)==null||i.success("编辑成功"),E("submitted"))}},x={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},P={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},C={devId:P,tagName:x,tagDesc:x,tagK:P,objAddr:x,collectType:P,dataType:P,dataFormat:P},J=it(()=>({add:L("common.add"),edit:L("common.edit")})[z.operateType]),{columns:ee,columnChecks:se,data:W,getData:M,loading:F,mobilePagination:fe,searchParams:f,resetSearchParams:Ae}=Je({apiFn:st,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",multiple:!1,align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140},{key:"devId",title:"所属设备",align:"center",width:140,render:r=>{var i;return e("span",null,[((i=n.collectionPointForm.deveicelList.find(h=>h.id===r.devId))==null?void 0:i.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),ve=()=>{M()},{drawerVisible:Re,operateType:v,editingData:p,handleAdd:k,handleEdit:$,checkedRowKeys:A,onBatchDeleted:$e,onDeleted:ze}=We(W,M);async function ne(){const{data:r,error:i}=await Pe();i||(console.log("data",r),r.length>0&&(n.collectionPointForm.channelList=r.filter(h=>h.chlType!==1).map(h=>({label:h.chlName,value:h.id,devicePojoList:h.devicePojoList||[]}))))}ne();const de=r=>{var h;f.chlid=r,f.devId=null;let i=(h=n.collectionPointForm.channelList.find(s=>s.value==r))==null?void 0:h.devicePojoList;n.collectionPointForm.deveicelList=i,oe(),M()};function ge(){var r,i;if(n.collectionPointForm.channelList.length>0)if(f.chlid)n.collectionPointForm.visible=!0;else{let h=n.collectionPointForm.channelList[0];f.chlid=h.value,n.collectionPointForm.deveicelList=h.devicePojoList,oe(),A.value=[t.tagId],n.collectionPointForm.checkedRows.tagName=t.tagName,n.collectionPointForm.checkedRows.id=t.tagId}else return(r=window.$message)==null||r.destroyAll(),(i=window.$message)==null||i.warning("暂无通道，请您先创建通道在进行查询"),!1}async function oe(){const{data:r,error:i}=await Fe({chlId:f.chlid});i||(n.collectionPointForm.functionList=JSON.parse(r).data,n.collectionPointForm.visible=!0,M())}function he(){n.collectionPointForm.visible=!1}function D(r,i,h){console.log(i),n.collectionPointForm.checkedRows=i[0]}function be(){var r,i;if(A.value.length===0)return(r=window.$message)==null||r.destroyAll(),(i=window.$message)==null||i.warning("请您先选择采集点"),!1;t.tagName=n.collectionPointForm.checkedRows.tagName,t.tagId=n.collectionPointForm.checkedRows.id,t.tagDesc||(t.tagDesc=n.collectionPointForm.checkedRows.tagDesc),n.collectionPointForm.visible=!1}return(r,i)=>{const h=je,s=He,Le=me,d=O,o=Be,m=Ee,c=me,q=Qe,R=qe,V=O,ie=xe,H=Ge,re=Xe,Q=we("no-space");return B(),Ie(Oe,null,[e(H,{show:g.value,"onUpdate:show":i[9]||(i[9]=u=>g.value=u),title:J.value,preset:"card",class:"w-50%"},{footer:a(()=>[e(ie,{size:16,justify:"center"},{default:a(()=>[e(V,{onClick:j,class:"w-100px"},{default:a(()=>[T(U(l(L)("common.cancel")),1)]),_:1}),e(V,{type:"primary",class:"w-100px",onClick:K},{default:a(()=>[T(U(l(L)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(R,{ref_key:"formRef",ref:Z,model:t,rules:C,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(q,{responsive:"screen","item-responsive":""},{default:a(()=>[e(s,{span:"24 m:12",label:"所属设备",path:"belongingChannel"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择所属设备",value:t.devId,"onUpdate:value":i[0]||(i[0]=u=>t.devId=u),"value-field":"id",options:n.deveicelList},null,8,["value","options"])]),_:1}),e(s,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:a(()=>[e(o,null,{default:a(()=>[e(Le,{value:t.tagName,"onUpdate:value":i[1]||(i[1]=u=>t.tagName=u),style:{width:"80%"},readonly:""},null,8,["value"]),e(d,{type:"primary",ghost:"",onClick:ge},{default:a(()=>[T("请选择")]),_:1})]),_:1})]),_:1}),e(s,{span:"24 m:12",label:"测点类型",path:"tagType"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择测点类型",value:t.tagType,"onUpdate:value":i[2]||(i[2]=u=>t.tagType=u),options:l(X)(l(ue))},null,8,["value","options"])]),_:1}),e(s,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:a(()=>[e(m,{clearable:"",value:t.tagK,"onUpdate:value":i[3]||(i[3]=u=>t.tagK=u),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(s,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择转发功能码",value:t.collectType,"onUpdate:value":i[4]||(i[4]=u=>t.collectType=u),options:n.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(s,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:a(()=>[e(c,{clearable:"",value:t.objAddr,"onUpdate:value":i[5]||(i[5]=u=>t.objAddr=u),placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(s,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择数据类型",value:t.dataType,"onUpdate:value":[i[6]||(i[6]=u=>t.dataType=u),w],options:l(X)(l(dt))},null,8,["value","options"])]),_:1}),e(s,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择数据格式",value:t.dataFormat,"onUpdate:value":i[7]||(i[7]=u=>t.dataFormat=u),options:n.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(s,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:a(()=>[e(c,{clearable:"",value:t.tagUnit,"onUpdate:value":i[8]||(i[8]=u=>t.tagUnit=u),placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(H,{show:n.collectionPointForm.visible,"onUpdate:show":i[16]||(i[16]=u=>n.collectionPointForm.visible=u),title:"选择采集点",preset:"card",class:"w-60%"},{footer:a(()=>[e(ie,{size:16,justify:"end"},{default:a(()=>[e(V,{onClick:he},{default:a(()=>[T(U(l(L)("common.cancel")),1)]),_:1}),e(V,{type:"primary",onClick:be},{default:a(()=>[T(U(l(L)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(R,{model:n.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(q,{responsive:"screen","item-responsive":""},{default:a(()=>[e(s,{span:"24 m:12",label:"所属通道"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择所属通道",value:l(f).chlid,"onUpdate:value":i[10]||(i[10]=u=>l(f).chlid=u),options:n.collectionPointForm.channelList,onUpdateValue:de},null,8,["value","options"])]),_:1}),e(s,{span:"24 m:12",label:"所属设备"},{default:a(()=>[e(h,{filterable:"",clearable:"",placeholder:"请选择所属设备",value:l(f).devId,"onUpdate:value":i[11]||(i[11]=u=>l(f).devId=u),"label-field":"devName","value-field":"id",options:n.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(s,{span:"24 m:12",label:"测点类型"},{default:a(()=>[e(h,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:l(f).tagType,"onUpdate:value":i[12]||(i[12]=u=>l(f).tagType=u),options:l(X)(l(ue))},null,8,["value","options"])]),_:1}),e(s,{span:"24 m:12",label:"测点功能码"},{default:a(()=>[e(h,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:l(f).collectType,"onUpdate:value":i[13]||(i[13]=u=>l(f).collectType=u),options:n.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(s,{span:"24 m:12",label:"测点名称"},{default:a(()=>[te(e(c,{clearable:"",value:l(f).fuzzy,"onUpdate:value":i[14]||(i[14]=u=>l(f).fuzzy=u),placeholder:"请输入测点名称"},null,8,["value"]),[[Q]])]),_:1}),e(s,{span:"24 m:12",label:" "},{default:a(()=>[e(V,{onClick:ve},{default:a(()=>[T(U(l(L)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(re,{"checked-row-keys":l(A),"onUpdate:checkedRowKeys":[i[15]||(i[15]=u=>Te(A)?A.value=u:null),D],columns:l(ee),data:l(W),size:"small","max-height":500,loading:l(F),remote:"","row-key":u=>u.id,pagination:l(fe)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1},8,["show"])],64)}}}),zt={class:"flex"},St=Ue({__name:"add_multipe_model",props:pe(["devId","chlid"],{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:pe(["submitted"],["update:visible"]),setup(I,{emit:Y}){const n=ke({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:[],dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),g=Ke(I,"visible"),E=I,z=Y,t=ke(G());function G(){return{chlId:void 0,devId:void 0,tagDevId:void 0,tagName:"",tagNames:"",tagId:"",tagDesc:"",tagDescs:"",tagUnit:"",tagType:0,tagK:1,objAddr:"0",collectType:void 0,dataType:4,dataFormat:0}}async function y(){var m,c;const{data:d,error:o}=await Pe({type:1});if(!o){const q=[];d.forEach(R=>{R.devicePojoList&&R.devicePojoList.length>0&&R.devicePojoList.forEach(V=>{q.push({label:`${R.chlName}__${V.devName}`,value:`${V.id}_${R.id}`})})}),n.deveicelList=q,n.deveicelList.length>0&&(t.tagDevId=E.devId&&E.chlid?E.devId+"_"+E.chlid:n.deveicelList[0].value,t.devId=Number((m=t.tagDevId)==null?void 0:m.split("_")[0]),t.chlId=Number((c=t.tagDevId)==null?void 0:c.split("_")[1]),t.collectType=void 0,N())}}async function N(){const{data:d,error:o}=await Fe({chlId:t.chlId});o||(n.functionList=JSON.parse(d).data,t.collectType=n.functionList[0].FuncCode)}function S(){Object.assign(t,G()),y(),n.collectionPointForm.checkedRows=[],D.value=[]}const{formRef:Z,validate:_,restoreValidation:ae}=Me();Ve(g,()=>{g.value&&(S(),ae())});const j=()=>{g.value=!1};function w(d,o){console.log(d),d==0||d==1||d==2||d==3||d==4||d==7?n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:d==5||d==6||d==8||d==9||d==10||d==12||d==13?n.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],n.collectionPointForm.dataFormatList.find(m=>m.value===t.dataFormat)||(t.dataFormat=n.collectionPointForm.dataFormatList[0].value)}const K=async()=>{var V,ie,H;await _();let d=t.tagNames.split(","),o=(V=t.tagDescs)==null?void 0:V.split(","),m=(ie=t.tagId)==null?void 0:ie.split(","),c=[];delete t.tagNames,delete t.tagDescs,delete t.tagId,d.forEach((re,Q)=>{var _e,ye;let u={...t,tagName:re,tagDesc:t.tagDesc?t.tagDesc:o[Q],tagId:Number(m[Q]),objAddr:t.objAddr?+t.objAddr+Q:Q+"",devId:Number((_e=t.tagDevId)==null?void 0:_e.split("_")[0]),chlId:Number((ye=t.tagDevId)==null?void 0:ye.split("_")[1])};c.push(u)});const{data:q,error:R}=await rt(c);R||(j(),(H=window.$message)==null||H.success("添加成功"),z("submitted"))},x={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},P={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},C={tagDevId:x,tagName:x,tagDesc:[{trigger:["input","blur"],validator:(d,o)=>!/\$/.test(o),message:"不能含有非法字符"},{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]}],tagK:P,objAddr:x,collectType:P,dataType:P,dataFormat:P},J=it(()=>({add:"批量新增",edit:L("common.edit")}).add),{columns:ee,columnChecks:se,data:W,getData:M,loading:F,mobilePagination:fe,searchParams:f,resetSearchParams:Ae}=Je({apiFn:st,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140,render:d=>{var o;return e("span",null,[((o=ue.find(m=>m.value===d.tagType))==null?void 0:o.label)||""])}},{key:"belongingEquipment",title:"所属设备",align:"center",width:140,render:d=>{var o;return e("span",null,[((o=n.collectionPointForm.deveicelList.find(m=>m.id===d.devId))==null?void 0:o.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),ve=()=>{M()},{drawerVisible:Re,operateType:v,editingData:p,handleAdd:k,handleEdit:$,checkedRowKeys:A,onBatchDeleted:$e,onDeleted:ze}=We(W,M);async function ne(){const{data:d,error:o}=await Pe();o||(console.log("data",d),d.length>0&&(n.collectionPointForm.channelList=d.filter(m=>m.chlType!==1).map(m=>({label:m.chlName,value:m.id,devicePojoList:m.devicePojoList||[]}))))}const de=d=>{var m;f.chlid=d,f.devId=null;let o=(m=n.collectionPointForm.channelList.find(c=>c.value==d))==null?void 0:m.devicePojoList;n.collectionPointForm.deveicelList=o,oe(),M()};ne();function ge(){var d,o;if(A.value=D.value.map(m=>m.id),n.collectionPointForm.channelList.length>0)if(f.chlid)n.collectionPointForm.visible=!0;else{let m=n.collectionPointForm.channelList[0];f.chlid=m.value,n.collectionPointForm.deveicelList=m.devicePojoList,oe()}else return(d=window.$message)==null||d.destroyAll(),(o=window.$message)==null||o.warning("暂无通道，请您先创建通道在进行查询"),!1}async function oe(){const{data:d,error:o}=await Fe({chlId:f.chlid});o||(n.collectionPointForm.functionList=JSON.parse(d).data,n.collectionPointForm.visible=!0,M())}function he(){n.collectionPointForm.visible=!1}const D=De([]),be=[{title(){return e("div",{class:"flex"},[e("span",{class:"flex-1"},[`已选${D.value.length}个`]),e("span",{class:"c-red cursor-pointer",onClick:h},[T("清空")])])},align:"center",render:d=>{var o;return e("span",null,[d.tagName,T("--"),(o=n.collectionPointForm.channelList.find(m=>m.value==d.chlId))==null?void 0:o.label])}}];function r(d,o,m){console.log(o),o=o.filter(c=>c!=null),f.devId&&(D.value=D.value.filter(c=>c.devId!=f.devId||c.page!=f.page)),f.chlid&&(D.value=D.value.filter(c=>c.chlId!=f.chlid||c.page!=f.page)),D.value.push(...o.filter(c=>c!=null)),D.value=[...new Set(D.value)],D.value.forEach(c=>{c.page=c.page?c.page:f.page})}function i(){var d,o,m,c,q;if(n.collectionPointForm.checkedRows=A.value,t.tagNames="",t.tagDescs="",t.tagId="",A.value.length===0)return(d=window.$message)==null||d.destroyAll(),(o=window.$message)==null||o.warning("请您先选择采集点"),!1;D.value.forEach(R=>{t.tagNames+=R.tagName+",",t.tagDescs+=R.tagDesc+",",t.tagId+=R.id+","}),t.tagName=D.value[0].tagName,t.tagNames=(m=t.tagNames)==null?void 0:m.substring(0,t.tagNames.length-1),t.tagDescs=(c=t.tagDescs)==null?void 0:c.substring(0,t.tagDescs.length-1),t.tagId=(q=t.tagId)==null?void 0:q.substring(0,t.tagId.length-1),n.collectionPointForm.visible=!1}const h=()=>{D.value=[],A.value=[]},s=()=>{A.value=[]},Le=()=>({style:{height:"40px"}});return(d,o)=>{const m=je,c=He,q=me,R=O,V=Be,ie=Ee,H=me,re=Qe,Q=qe,u=O,_e=xe,ye=Ge,Ye=Xe,ct=we("no-space");return B(),Ie(Oe,null,[e(ye,{show:g.value,"onUpdate:show":o[9]||(o[9]=b=>g.value=b),title:J.value,preset:"card",class:"w-50%"},{footer:a(()=>[e(_e,{size:16,justify:"center"},{default:a(()=>[e(u,{onClick:j,class:"w-100px"},{default:a(()=>[T(U(l(L)("common.cancel")),1)]),_:1}),e(u,{type:"primary",class:"w-100px",onClick:K},{default:a(()=>[T(U(l(L)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(Q,{ref_key:"formRef",ref:Z,model:t,rules:C,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(re,{responsive:"screen","item-responsive":""},{default:a(()=>[e(c,{span:"24 m:12",label:"所属设备",path:"tagDevId"},{default:a(()=>[e(m,{filterable:"",placeholder:"请选择所属设备",value:t.tagDevId,"onUpdate:value":o[0]||(o[0]=b=>t.tagDevId=b),options:n.deveicelList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:a(()=>[e(V,{style:{width:"100%"}},{default:a(()=>[e(q,{value:t.tagName,"onUpdate:value":o[1]||(o[1]=b=>t.tagName=b),readonly:""},null,8,["value"]),e(R,{type:"primary",ghost:"",onClick:ge},{default:a(()=>[T(U(n.collectionPointForm.checkedRows.length>1?`+${n.collectionPointForm.checkedRows.length}`:"请选择"),1)]),_:1})]),_:1})]),_:1}),e(c,{span:"24 m:12",label:"测点类型",path:"dataType"},{default:a(()=>[e(m,{filterable:"",placeholder:"请选择测点类型",value:t.tagType,"onUpdate:value":o[2]||(o[2]=b=>t.tagType=b),options:l(X)(l(ue))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:a(()=>[e(ie,{clearable:"",value:t.tagK,"onUpdate:value":o[3]||(o[3]=b=>t.tagK=b),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(c,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:a(()=>[e(m,{filterable:"",placeholder:"请选择转发功能码",value:t.collectType,"onUpdate:value":o[4]||(o[4]=b=>t.collectType=b),options:n.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:a(()=>[e(H,{clearable:"",value:t.objAddr,"onUpdate:value":o[5]||(o[5]=b=>t.objAddr=b),maxlength:"128",placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(c,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:a(()=>[e(m,{filterable:"",placeholder:"请选择数据类型",value:t.dataType,"onUpdate:value":[o[6]||(o[6]=b=>t.dataType=b),w],options:l(X)(l(dt))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:a(()=>[e(m,{filterable:"",placeholder:"请选择数据格式",value:t.dataFormat,"onUpdate:value":o[7]||(o[7]=b=>t.dataFormat=b),options:n.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:a(()=>[e(H,{clearable:"",value:t.tagUnit,"onUpdate:value":o[8]||(o[8]=b=>t.tagUnit=b),maxlength:"12",placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(ye,{show:n.collectionPointForm.visible,"onUpdate:show":o[16]||(o[16]=b=>n.collectionPointForm.visible=b),title:"选择采集点",preset:"card",class:"w-65%",onAfterLeave:s},{footer:a(()=>[e(_e,{size:16,justify:"end"},{default:a(()=>[e(u,{onClick:he},{default:a(()=>[T(U(l(L)("common.cancel")),1)]),_:1}),e(u,{type:"primary",onClick:i},{default:a(()=>[T(U(l(L)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(Q,{model:n.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(re,{responsive:"screen","item-responsive":""},{default:a(()=>[e(c,{span:"24 m:12",label:"所属通道"},{default:a(()=>[e(m,{filterable:"",placeholder:"请选择所属通道",value:l(f).chlid,"onUpdate:value":o[10]||(o[10]=b=>l(f).chlid=b),options:n.collectionPointForm.channelList,onUpdateValue:de},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"所属设备"},{default:a(()=>[e(m,{filterable:"",clearable:"",placeholder:"请选择所属设备","label-field":"devName","value-field":"id",value:l(f).devId,"onUpdate:value":o[11]||(o[11]=b=>l(f).devId=b),options:n.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点类型"},{default:a(()=>[e(m,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:l(f).tagType,"onUpdate:value":o[12]||(o[12]=b=>l(f).tagType=b),options:l(X)(l(ue))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点功能码"},{default:a(()=>[e(m,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:l(f).collectType,"onUpdate:value":o[13]||(o[13]=b=>l(f).collectType=b),options:n.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点名称"},{default:a(()=>[te(e(H,{clearable:"",value:l(f).fuzzy,"onUpdate:value":o[14]||(o[14]=b=>l(f).fuzzy=b),placeholder:"请输入测点名称"},null,8,["value"]),[[ct]])]),_:1}),e(c,{span:"24 m:12",label:" "},{default:a(()=>[e(u,{onClick:ve},{default:a(()=>[T(U(l(L)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),ot("div",zt,[e(Ye,{"checked-row-keys":l(A),"onUpdate:checkedRowKeys":[o[15]||(o[15]=b=>Te(A)?A.value=b:null),r],columns:l(ee),data:l(W),size:"small","max-height":500,loading:l(F),remote:"","row-key":b=>b.id,pagination:l(fe),class:"flex-1","row-props":Le},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Ye,{columns:be,data:D.value,size:"small","max-height":540,loading:l(F),remote:"","row-key":b=>b.id,class:"w-20% ml-10px","row-props":Le},null,8,["data","loading","row-key"])])]),_:1},8,["show"])],64)}}}),Kt=Ue({__name:"batchEdit_model",props:pe({checkedRowKeys:{type:Array,default:[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:pe(["submitted"],["update:visible"]),setup(I,{emit:Y}){const n=I,g=Ke(I,"visible");Ve(()=>g.value,j=>{y.value={editType:0,editMode:0,startV:"0",step:"1",tagK:0}});const E=Y,{formRef:z,validate:t,restoreValidation:G}=Me(),y=De({editType:0,editMode:0,startV:"0",step:"1",tagK:0}),N=async()=>{var j,w;if(await t(),y.value.editType==0){console.log(n.checkedRowKeys);let K=[];n.checkedRowKeys.forEach((C,J)=>{K.push({id:C,objAddr:+y.value.startV+J*+y.value.step+""})});const{data:x,error:P}=await Se(K);P||(g.value=!1,(j=window.$message)==null||j.success("批量修改成功"),E("submitted"))}else if(y.value.editType==1){let K=[];n.checkedRowKeys.forEach((C,J)=>{K.push({id:C,tagK:y.value.tagK})});const{data:x,error:P}=await Se(K);P||(g.value=!1,(w=window.$message)==null||w.success("批量修改成功"),E("submitted"))}},S={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},Z={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},_={editType:S,editMode:S,startV:Z,step:Z},ae=De(!1);return(j,w)=>{const K=je,x=He,P=me,C=Ee,J=Qe,ee=qe,se=O,W=xe,M=Ge;return B(),Ie(Oe,null,[e(M,{show:g.value,"onUpdate:show":w[6]||(w[6]=F=>g.value=F),title:"批量修改",preset:"card",class:"w-40%"},{footer:a(()=>[e(W,{size:16,justify:"center"},{default:a(()=>[e(se,{onClick:w[5]||(w[5]=F=>g.value=!1),class:"w-100px"},{default:a(()=>[T(U(j.$t("common.cancel")),1)]),_:1}),e(se,{type:"primary",class:"w-100px",onClick:N},{default:a(()=>[T(U(j.$t("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(ee,{ref_key:"formRef",ref:z,"label-width":120,"label-placement":"left",model:y.value,rules:_},{default:a(()=>[e(J,{responsive:"screen","item-responsive":""},{default:a(()=>[e(x,{span:"24 m:12",label:"修改类型",path:"editType"},{default:a(()=>[e(K,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editType,"onUpdate:value":w[0]||(w[0]=F=>y.value.editType=F),options:l(X)(l(Ze)({0:"寄存器地址",1:"系数K"}))},null,8,["value","options"])]),_:1}),y.value.editType==0?(B(),le(x,{key:0,span:"24 m:12",label:"修改步长",path:"editMode"},{default:a(()=>[e(K,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editMode,"onUpdate:value":w[1]||(w[1]=F=>y.value.editMode=F),options:l(X)(l(Ze)({0:"步长"}))},null,8,["value","options"])]),_:1})):Ne("",!0),y.value.editType==0?(B(),le(x,{key:1,span:"24 m:12",label:"起始值",path:"startV"},{default:a(()=>[e(P,{clearable:"",value:y.value.startV,"onUpdate:value":w[2]||(w[2]=F=>y.value.startV=F),placeholder:"请输入起始值"},null,8,["value"])]),_:1})):Ne("",!0),y.value.editType==0?(B(),le(x,{key:2,span:"24 m:12",label:"步长",path:"step"},{default:a(()=>[e(P,{clearable:"",value:y.value.step,"onUpdate:value":w[3]||(w[3]=F=>y.value.step=F),placeholder:"请输入步长"},null,8,["value"])]),_:1})):Ne("",!0),y.value.editType==1?(B(),le(x,{key:3,span:"24 m:12",label:"修改的值",path:"step"},{default:a(()=>[e(C,{clearable:"",value:y.value.tagK,"onUpdate:value":w[4]||(w[4]=F=>y.value.tagK=F),placeholder:"请输入修改的值"},null,8,["value"])]),_:1})):Ne("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(M,{show:ae.value,"onUpdate:show":w[7]||(w[7]=F=>ae.value=F),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),Mt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function nt(I){return typeof I=="function"||Object.prototype.toString.call(I)==="[object Object]"&&!wt(I)}const al=Ue({name:"configsetting_forwardingservice_forwardingpointmanagement",__name:"index",setup(I){const Y=ht(),n=bt(),g=ke({channelList:[],channelAndDevObj:{},deveicelList:[],transFunctionOptions:[],addMultipeModelVisible:!1});async function E(){var k;const{data:v,error:p}=await Pe({type:1});if(!p){if(v==0)return(k=window.$message)==null?void 0:k.warning("暂无转发通道，请先添加通道");g.channelList=v||[],g.channelList.forEach($=>{g.channelAndDevObj[$.id]=$.devicePojoList||[]}),_.chlid=_.chlid||g.channelList[0].id,g.deveicelList=g.channelAndDevObj[_.chlid]||[],_.devId=g.deveicelList[0].id,z(),N()}}async function z(){const{data:v,error:p}=await Fe({chlId:_.chlid});p||(g.transFunctionOptions=JSON.parse(v).data)}const{columns:t,columnChecks:G,data:y,getData:N,loading:S,mobilePagination:Z,searchParams:_,resetSearchParams:ae}=Je({apiFn:Ct,apiParams:{page:1,pageSize:200,limit:200,chlid:null,devId:null,tagType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"测点ID",align:"center",width:80},{key:"tagName",title:"测点名称",align:"center",minWidth:100},{key:"tagType",title:"测点类型",align:"center",width:140,render:v=>e("span",null,[Pt[v.tagType]||""])},{key:"devName",title:"所属设备",align:"center",width:140,render:v=>{var p,k;return e("span",null,[((k=(p=g.deveicelList)==null?void 0:p.find($=>$.id===v.devId))==null?void 0:k.devName)||""])}},{key:"collectname",title:"转发功能码",align:"center",width:140,render:v=>{var p;return e("span",null,[(p=v.collectname)==null?void 0:p.replace(/\(.*?\)/g,"")])}},{key:"dataType",title:"数据类型",align:"center",width:140,render:v=>e("span",null,[v.dataType?et[Number(v.dataType)]:et[0]])},{key:"dataFormat",title:"数据格式",align:"center",width:140,render:v=>e("span",null,[v.dataType?tt[Number(v.dataFormat)]:tt[0]])},{key:"tagK",title:"系数K",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140},{key:"operate",title:L("common.operate"),align:"center",width:140,fixed:"right",render:v=>{let p;return e("div",{class:"flex-center gap-8px"},[te(e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>W(v.id)},nt(p=L("common.edit"))?p:{default:()=>[p]}),[[we("no-auth"),"transTag:update"]]),te(e(lt,{onPositiveClick:()=>se(v.id)},{default:()=>L("common.confirmDelete"),trigger:()=>{let k;return e(O,{type:"error",ghost:!0,size:"small"},nt(k=L("common.delete"))?k:{default:()=>[k]})}}),[[we("no-auth"),"transTag:delete"]])])}}]});_t(()=>{const v=n.currentRoute.value.query.channelId;_.chlid=Number(v)*1||null,E();const p=n.currentRoute.value.query.deviceId;_.devId=Number(p)*1||null});const{drawerVisible:j,operateType:w,editingData:K,handleAdd:x,handleEdit:P,checkedRowKeys:C,onBatchDeleted:J,onDeleted:ee}=We(y,N),se=async v=>{const{data:p,error:k}=await at({ids:v});k||ee()},W=v=>{P(v)},M=v=>{v===""&&N()},F=De(!1),fe=()=>{F.value=!0};function f(v,p){var k;v&&(_.chlid=Number(v),_.devId=null,_.collectType=void 0,g.deveicelList=g.channelAndDevObj[v],_.devId=g.deveicelList[0].id,(!g.deveicelList||g.deveicelList.length==0)&&((k=window.$message)==null||k.warning("该通道下无设备! 请选择其他通道")),z(),N())}function Ae(){g.addMultipeModelVisible=!0}const ve=async()=>{const v=C.value.join(","),{data:p,error:k}=await at({ids:v});k||ee(),C.value=[]},Re=()=>{var v;if(!_.devId){(v=window.$message)==null||v.warning("请选择导出设备");return}Tt({url:`${kt}/transTag/exports.do`,method:"post",params:{devId:_.devId},responseType:"blob",headers:{token:Ft()}}).then(async p=>{if(p.data){const k=window.URL.createObjectURL(new Blob([p.data])),$=document.createElement("a");$.href=k,$.setAttribute("download",new Date().getTime()+".xls"),document.body.appendChild($),$.click()}})};return(v,p)=>{const k=Dt,$=je,A=me,$e=Nt,ze=Be,ne=xe,de=It,ge=Lt,oe=Rt,he=ft,D=mt,be=pt,r=ut,i=Xe,h=we("no-auth");return B(),Ie("div",Mt,[e(de,{bordered:!1,size:"small"},{default:a(()=>[e(ne,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:a(()=>[e(ze,null,{default:a(()=>[e(k,null,{default:a(()=>[T("所属通道")]),_:1}),e($,{filterable:"",placeholder:"请选择通道",value:l(_).chlid,"onUpdate:value":p[0]||(p[0]=s=>l(_).chlid=s),"label-field":"chlName","value-field":"id",options:g.channelList,onUpdateValue:f},null,8,["value","options"]),e(k,null,{default:a(()=>[T("所属设备")]),_:1}),e($,{filterable:"",clearable:"",placeholder:"请选择设备",value:l(_).devId,"onUpdate:value":[p[1]||(p[1]=s=>l(_).devId=s),l(N)],"label-field":"devName","value-field":"id",options:g.deveicelList},null,8,["value","options","onUpdate:value"]),e(k,null,{default:a(()=>[T("测点类型")]),_:1}),e($,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:l(_).tagType,"onUpdate:value":[p[2]||(p[2]=s=>l(_).tagType=s),l(N)],style:{width:"80%"},options:l(X)(l(ue))},null,8,["value","options","onUpdate:value"]),e(A,{clearable:"",value:l(_).fuzzy,"onUpdate:value":[p[3]||(p[3]=s=>l(_).fuzzy=s),M],placeholder:"请输入测点名称或描述",style:{width:"100%"},onKeyup:yt(l(N),["enter"])},null,8,["value","onKeyup"]),e(l(O),{type:"primary",ghost:"",onClick:l(N)},{icon:a(()=>[e($e,{class:ce(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),default:a(()=>[T(" "+U(l(L)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(de,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[e(ne,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"})]),"header-extra":a(()=>[e(ne,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[te((B(),le(l(O),{onClick:Ae,size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(ge,{class:ce(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),default:a(()=>[T(" "+U("批量新增"))]),_:1})),[[h,"transTag:insert"]]),te((B(),le(l(O),{onClick:fe,size:"small",ghost:"",type:"primary",disabled:!l(C).length},{icon:a(()=>[e(oe,{class:ce(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),default:a(()=>[T(" "+U("批量修改"))]),_:1},8,["disabled"])),[[h,"transTag:update"]]),te((B(),le(l(lt),{onPositiveClick:ve},{trigger:a(()=>[e(l(O),{size:"small",ghost:"",type:"error",disabled:l(C).length==0},{icon:a(()=>[e(he,{class:ce(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),default:a(()=>[T(" "+U(l(L)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:a(()=>[T(" 确认删除选中的项吗？ ")]),_:1})),[[h,"transTag:delete"]]),te((B(),le(l(O),{onClick:Re,size:"small"},{icon:a(()=>[e(D,{class:ce(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),default:a(()=>[T(" "+U(l(L)("common.export")),1)]),_:1})),[[h,"transTag:export"]]),e(l(O),{onClick:l(N),size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(be,{class:ce(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),_:1},8,["onClick"]),e(r,{columns:l(G),"onUpdate:columns":p[4]||(p[4]=s=>Te(G)?G.value=s:null)},null,8,["columns"])]),_:1})]),default:a(()=>[e(i,{"checked-row-keys":l(C),"onUpdate:checkedRowKeys":p[5]||(p[5]=s=>Te(C)?C.value=s:null),columns:l(t),data:l(y),size:"small",class:"sm:h-full","flex-height":!l(Y).isMobile,loading:l(S),remote:"","row-key":s=>s.id,pagination:l(Z)},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e($t,{visible:l(j),"onUpdate:visible":p[6]||(p[6]=s=>Te(j)?j.value=s:null),onSubmitted:l(N),"operate-type":l(w),"row-data":l(K)},null,8,["visible","onSubmitted","operate-type","row-data"]),e(St,{visible:g.addMultipeModelVisible,"onUpdate:visible":p[7]||(p[7]=s=>g.addMultipeModelVisible=s),devId:l(_).devId,chlid:l(_).chlid,onSubmitted:l(N)},null,8,["visible","devId","chlid","onSubmitted"]),e(Kt,{visible:F.value,"onUpdate:visible":p[8]||(p[8]=s=>F.value=s),onSubmitted:l(N),checkedRowKeys:l(C)},null,8,["visible","onSubmitted","checkedRowKeys"])]),_:1})])}}});export{al as default};
