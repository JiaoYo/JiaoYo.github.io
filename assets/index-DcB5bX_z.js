import{_ as Z}from"./table-column-setting.vue_vue_type_script_setup_true_lang-C08HzLjh.js";import{_ as ee}from"./refresh-BU9o1foM.js";import{d as U,n as q,p as ae,s as Q,D as I,o as O,c as L,w as i,g as n,E as V,h as T,t as F,i as r,$ as G,F as te,J as le,B as E,N as M,O as ne,ad as X,dM as oe,a4 as se,j as h,ae as re,f as D,aa as ie,a_ as j,S as Y,ar as ce,P as ue,Q as de,R as pe,a3 as ve,W as me,r as J,e as _e,ah as K,bo as fe,aG as ye,aj as he}from"./index-Cx7KIf91.js";import{a as ge,c as xe,d as be,e as H,g as we}from"./reportForm-DH79MhsK.js";import{u as ke}from"./table-CXqkni0e.js";import{_ as Ne}from"./round-search-BI_CoZ5E.js";import{_ as Ce}from"./round-refresh-H8vv-sLt.js";import{_ as Se}from"./lodash-DBno-G8B.js";import{_ as Te}from"./FormItemGridItem-2AG1jRS6.js";import{_ as Pe}from"./Grid-Cu_AT9np.js";import{T as Re}from"./task-D7EkQXCi.js";import{_ as $e,a as De,b as ze,c as Ae}from"./file-pdf-BggBQfn3.js";import{_ as W}from"./Popconfirm-DfxGPHws.js";import"./setting-outlined-DxlFErWs.js";import"./echarts.vue_vue_type_script_setup_true_lang-Bmix22_s.js";import"./index-BhRqCdHu.js";import"./installCanvasRenderer-CyOrKSjT.js";import"./install-CX03SWNg.js";const Ee=U({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["reset","search"],["update:model"]),setup(y,{emit:P}){const R=P,{formRef:l,restoreValidation:f}=ae(),p=Q(y,"model"),$=()=>{p.value.fuzzy="",g()};async function S(){await f(),R("reset")}async function g(){R("search")}const x=Se.debounce(g,1e3,{leading:!0,trailing:!1});return(b,_)=>{const w=le,d=Te,c=Ce,a=E,e=Ne,t=M,v=Pe,z=ne,A=X,k=I("no-space");return O(),L(A,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[n(z,{ref_key:"formRef",ref:l,model:p.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(r(x),["enter"])},{default:i(()=>[n(v,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:i(()=>[n(d,{span:"24 s:12 m:8 l:6",label:"实例名称",path:"alatype"},{default:i(()=>[V(n(w,{autofocus:"",value:p.value.fuzzy,"onUpdate:value":_[0]||(_[0]=s=>p.value.fuzzy=s),placeholder:"请输入实例名称关键字",clearable:"",onClear:$},null,8,["value"]),[[k]])]),_:1}),n(d,{span:"24 s:12 m:8 l:6"},{default:i(()=>[n(t,{class:"w-full"},{default:i(()=>[n(a,{onClick:S},{icon:i(()=>[n(c,{class:"text-icon"})]),default:i(()=>[T(" "+F(r(G)("common.reset")),1)]),_:1}),n(a,{type:"primary",ghost:"",onClick:r(x)},{icon:i(()=>[n(e,{class:"text-icon"})]),default:i(()=>[T(" "+F(r(G)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Be=y=>(ue("data-v-22bb72ac"),y=y(),de(),y),Ie=Be(()=>D("span",{class:"mr-20px"},"报表预览",-1)),Ve={title:"导出PDF"},Me={title:"导出Word"},Oe={title:"导出Excel"},Ge=U({name:"reportPreview",__name:"reportPreview",props:q({data:{},detaliParams:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(y){oe(d=>({"5baf32e0":r(R)}));const P=se(),R=P.themeScheme=="dark"?"#001428":"#fff",l=y,f=Q(y,"visible"),p=h([]),$=async d=>{const{data:c,error:a}=await ge({rtype:d});a||(c.forEach(e=>{e.rtext=JSON.parse(e.rtext)}),p.value=c[0].rtext)},S=["提示","低危","中危","高危","致命"],g=["lev0","lev1","lev2","lev3","lev4"],x=h(),b=h(""),_=async()=>{var d,c;l.detaliParams.rtype=1,await $(0),b.value=((c=(d=p.value)==null?void 0:d.find(a=>a.type=="title"))==null?void 0:c.value)+"报表"+j(1,new Date),p.value.forEach(a=>{if(a.type=="table"&&(a.dataName=="collection"&&(a.value.body=l.data.collection.map(e=>a.value.tableHeaderValue.map(t=>t=="ctime"?j(1,e[t]):e[t]))),a.dataName=="events"&&(a.value.body=l.data.events.map(e=>a.value.tableHeaderValue.map(t=>e[t]))),a.dataName=="level"&&(a.value.body=l.data.level.map(e=>a.value.tableHeaderValue.map(t=>e[t]))),a.dataName=="level1")){if(l.data.level.length==0)return a.value.body=[];a.value.body=g.map(e=>[e=="lev0"?"提示":e=="lev1"?"低危":e=="lev2"?"中危":e=="lev3"?"高危":"致命",l.data.level.reduce((t,v)=>t+(Number(v[e])||0),0)])}a.type=="chart"&&a.dataName=="events"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=l.data.events.map(e=>e.count),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=l.data.events.map(e=>e.cname):a.value.data.yAxis.data=l.data.events.map(e=>e.cname)),a.value.chartType=="pie"&&(a.value.data.series[0].data=l.data.events.map(e=>({value:e.count,name:e.cname}))),a.value.chartType=="line"&&(a.value.data.series[0].data=l.data.events.map(e=>e.count),a.value.data.xAxis.data=l.data.events.map(e=>e.cname))),a.dataName=="level"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=l.data.level.map(e=>e.count),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=l.data.level.map(e=>e.logname):a.value.data.yAxis.data=l.data.level.map(e=>e.logname)),a.value.chartType=="pie"&&(a.value.data.series[0].data=l.data.level.map(e=>({value:e.count,name:e.logname}))),a.value.chartType=="line"&&(a.value.data.series[0].data=l.data.level.map(e=>e.count),a.value.data.xAxis.data=l.data.level.map(e=>e.logname))),a.dataName=="level1"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(e=>l.data.level.reduce((t,v)=>t+(Number(v[e])||0),0)),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=S:a.value.data.yAxis.data=S),a.value.chartType=="pie"&&(a.value.data.series[0].data=[{value:l.data.level.reduce((e,t)=>e+t.lev0*1,0)==0?null:l.data.level.reduce((e,t)=>e+t.lev0*1,0),name:"提示"},{value:l.data.level.reduce((e,t)=>e+t.lev1*1,0)==0?null:l.data.level.reduce((e,t)=>e+t.lev1*1,0),name:"低危"},{value:l.data.level.reduce((e,t)=>e+t.lev2*1,0)==0?null:l.data.level.reduce((e,t)=>e+t.lev2*1,0),name:"中危"},{value:l.data.level.reduce((e,t)=>e+t.lev3*1,0)==0?null:l.data.level.reduce((e,t)=>e+t.lev3*1,0),name:"高危"},{value:l.data.level.reduce((e,t)=>e+t.lev4*1,0)==0?null:l.data.level.reduce((e,t)=>e+t.lev4*1,0),name:"致命"}]),a.value.chartType=="line"&&(a.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(e=>l.data.level.reduce((t,v)=>t+(Number(v[e])||0),0)),a.value.data.xAxis.data=S))}),x.value=p.value};re(f,()=>{f.value&&_()});const w=h();return(d,c)=>{const a=$e,e=De,t=ze,v=Ae,z=Y,A=ce;return O(),L(A,{show:f.value,"onUpdate:show":c[3]||(c[3]=k=>f.value=k),preset:"card",class:"w-1000px reportPreview",style:ie({"background-color":r(P).themeScheme=="dark"?"#001428":"#fff"})},{header:i(()=>[Ie,D("span",Ve,[n(a,{class:"text-32px c-#d63031 cursor-pointer",onClick:c[0]||(c[0]=k=>w.value.toPdf(b.value))})]),D("span",Me,[n(e,{class:"text-32px c-#1e90ff cursor-pointer",onClick:c[1]||(c[1]=k=>w.value.toWord(b.value))})]),D("span",Oe,[n(t,{class:"text-32px c-#15703d cursor-pointer",onClick:c[2]||(c[2]=k=>w.value.toExcel(b.value))})])]),default:i(()=>[n(z,{class:"max-h-600px"},{default:i(()=>[(O(),L(v,{key:x.value,ref_key:"filePreviewExportRef",ref:w,width:800,data:x.value},null,8,["data"]))]),_:1})]),_:1},8,["show","style"])}}}),Le=pe(Ge,[["__scopeId","data-v-22bb72ac"]]),Fe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ue=D("div",{style:{display:"flex","align-items":"center"}},[D("div",null,"报表实例")],-1),ia=U({name:"reportmanagement_reportlist",__name:"index",setup(y){const P=ve(),{columns:R,columnChecks:l,data:f,getData:p,loading:$,mobilePagination:S,searchParams:g,resetSearchParams:x}=ke({apiFn:xe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:s=>!0,renderExpand:s=>n("div",{class:"detailList"},[n(Y,{style:"max-height: 360px"},{default:()=>[d.value.length>0?d.value.map((o,u)=>n(M,{justify:"space-between",style:{marginBottom:"8px",padding:"0px 50px 8px 50px",borderBottom:u!==d.value.length-1?"1px dashed #ccc":"none"},key:o.sn},{default:()=>[n("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[o.sn]),n(M,null,{default:()=>[V(n(E,{type:"info",size:"small",ghost:!0,onClick:()=>z(o.sn,s.rtype)},{default:()=>[T("查看")]}),[[I("no-auth"),"sys.report.instance.select"]]),n(W,{onPositiveClick:()=>k(o.sn,s.rtype,s.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>V(n(E,{type:"error",size:"small",ghost:!0},{default:()=>[T("删除")]}),[[I("no-auth"),"sys.report.instance.delete"]])})]})]})):n("div",{style:{textAlign:"center",padding:"10px"}},[T("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:s=>{var o;return n("div",null,[(o=me(Re).find(u=>u.value===s.rtype))==null?void 0:o.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:G("common.operate"),align:"center",width:160,render:s=>n("div",{class:"flex-center gap-8px"},[n(W,{onPositiveClick:()=>A(s.tid,s.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>V(n(E,{type:"primary",ghost:!0,size:"small"},{default:()=>[T("清空")]}),[[I("no-auth"),"sys.report.instance.delete"]])})])}]}),b=h(null),_=h([]),w=async s=>{_.value=[s[s.length-1]],_.value[0]&&(d.value=[],await a());const o=f.value.findIndex(u=>u.tid===s[s.length-1]);setTimeout(()=>{var u;(u=b.value)==null||u.scrollTo({top:o*40,behavior:"smooth"})},500)},d=h([]),c=J({page:1,limit:10}),a=async()=>{const s=JSON.parse(JSON.stringify(f.value)).find(m=>m.tid===_.value[0]),{data:o,error:u}=await we({tid:_.value[0],page:c.page,limit:Number(s.num)||10});u||(d.value=o.list,ye(()=>{const m=document.querySelector(".detailList");if(m){const{height:N}=m.getBoundingClientRect();m.animate([{height:"0px"},{height:`${N}px`}],{duration:300,easing:"linear"})}}))},e=h(!1),t=h({}),v=J({name:"",rtype:0}),z=async(s,o)=>{const{data:u,error:m}=await be({name:s,type:o,tid:_.value[0]});v.name=s,v.rtype=o,m||(e.value=!0,t.value=JSON.parse(u))},A=async(s,o)=>{var N;const{data:u,error:m}=await H({tid:s,type:o});m||((N=window.$message)==null||N.success("清空成功"),d.value=[],p())},k=async(s,o,u)=>{var B;const{data:m,error:N}=await H({fname:s,type:o,tid:u});N||((B=window.$message)==null||B.success("删除成功"),p(),a())};return(s,o)=>{const u=ee,m=Z,N=he,B=X;return O(),_e("div",Fe,[n(Ee,{model:r(g),"onUpdate:model":o[0]||(o[0]=C=>K(g)?g.value=C:null),onReset:r(x),onSearch:r(p)},null,8,["model","onReset","onSearch"]),n(B,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:i(()=>[Ue]),"header-extra":i(()=>[n(r(M),null,{default:i(()=>[n(r(E),{size:"small",onClick:o[1]||(o[1]=C=>r(p)())},{icon:i(()=>[n(u,{class:fe(["text-icon",{"animate-spin":r($)}])},null,8,["class"])]),default:i(()=>[T(" "+F(r(G)("common.refresh")),1)]),_:1}),n(m,{columns:r(l),"onUpdate:columns":o[2]||(o[2]=C=>K(l)?l.value=C:null)},null,8,["columns"])]),_:1})]),default:i(()=>[n(N,{ref_key:"tableContainer",ref:b,columns:r(R),data:r(f),size:"small","flex-height":!r(P).isMobile,"scroll-x":962,loading:r($),remote:"","row-key":C=>C.tid,pagination:r(S),class:"sm:h-full","expanded-row-keys":_.value,"onUpdate:expandedRowKeys":w},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),n(Le,{visible:e.value,"onUpdate:visible":o[3]||(o[3]=C=>e.value=C),data:t.value,detaliParams:v},null,8,["visible","data","detaliParams"])]),_:1})])}}});export{ia as default};
