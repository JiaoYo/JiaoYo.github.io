import{_ as $e}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BHdjnJGE.js";import{d as ne,q as ae,s as _e,v as ye,x as Ae,j as ee,b as Pe,$ as s,r as Ve,y as Oe,L as Y,o as D,c as P,w as l,g as t,h as x,t as L,i as n,M as G,e as le,ah as ue,V as K,aS as Me,aj as pe,f as oe,aT as je,O as te,ax as Be,aU as Ee,aV as de,A as ge,C as Fe,E as ve,Y as he,ak as Ie,D as be,B as X,ab as Ge,ac as He,aW as qe,N as We,aa as we,a0 as Ke,an as me,aX as Ye,aY as Xe,ad as q,ae as Je}from"./index-hw7QOW1T.js";import{f as Qe,m as Ze,n as et,a as tt,o as at}from"./audit-events-CmfcTxzd.js";import{u as lt,a as nt}from"./table-BKuYvkWU.js";import{u as ce}from"./usePageData-VFJfU8Fa.js";import{a as ot}from"./events-DcOKOMrz.js";import{f as st,a as rt}from"./common-B2zRa1iI.js";import{_ as it}from"./TimePicker-E1Gl7M0T.js";import{b as ut,a as pt,_ as dt}from"./DataTable-qeqEjtEf.js";import{_ as mt}from"./Cascader-NPX5-Aui.js";import{_ as ct}from"./DatePicker-B-U85sJF.js";import{_ as ft}from"./round-search-Wdn6cQPo.js";import{_ as _t}from"./round-refresh-CTnCderg.js";import{_ as yt}from"./FormItemGridItem-BJtyHf3C.js";import{_ as gt}from"./Grid-Cw6tbggG.js";import{h as fe}from"./permission-BgxCDMSi.js";import{T as vt}from"./basicconf-DY4usiwt.js";import{_ as ht}from"./Popconfirm-BEEFAPPE.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Db4-USgA.js";import"./setting-outlined-6-9KjY3w.js";import"./round-delete-BKIC0WVe.js";import"./refresh-wIPyYUe8.js";import"./round-plus-DF4zpV2C.js";import"./Upload-BGvaNzBI.js";import"./Progress-76kDcVby.js";import"./defineProperty-D1x1w6PM.js";import"./Forward-iJK0D6Xc.js";const bt={class:"w-100%"},wt=oe("span",null,"至",-1),kt=oe("span",null,"至",-1),Dt=ne({name:"OperateDrawer",__name:"operate-drawer",props:ae({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ae(["submitted"],["update:visible"]),setup(N,{emit:M}){const p=N,S=M,b=_e(N,"visible"),{formRef:c,validate:V,restoreValidation:j}=ye(),{defaultRequiredRule:g}=Ae(),B=ee([]),w=Pe(()=>({add:s("page.audit.strategy.addTitle"),edit:s("page.audit.strategy.editTitle")})[p.operateType]),e=Ve(T());function T(){return{pname:"",aetype:0,psort:0,pcontent:null,efftime:0,starttime:null,endtime:null,aename:"",alevel:0,atype:null,pdesc:"",forsys:"",status:0,ptype:1,weekstart:void 0,weekend:void 0}}const E={pname:g,starttime:g,endtime:g,weekstart:{type:"number",required:!0,trigger:["change","blur"],message:"请选择星期"},weekend:{type:"number",required:!0,trigger:["change","blur"],message:"请选择星期"},time:g,efftime:g,atype:{type:"number",required:!0,trigger:"change",message:"请选择审计类型"}},O=()=>["星期一","星期二","星期三","星期四","星期五","星期六","星期天"].map((a,_)=>({label:a,value:_+1}));async function h(){await H(),await I(),await m(),Object.assign(e,T()),p.operateType==="edit"&&p.rowData&&(p.rowData.pcontent=p.rowData.pcontent?p.rowData.pcontent.split(",").map(Number):[],p.rowData.starttime=p.rowData.starttime?p.rowData.starttime:void 0,p.rowData.endtime=p.rowData.endtime?p.rowData.endtime:void 0,p.rowData.forsys=p.rowData.forsys?p.rowData.forsys.split(",").map(Number):[],Object.assign(e,p.rowData),f.value=[e.starttime,e.endtime])}function R(){b.value=!1}const U=ee([]);async function H(){const{data:r,error:a}=await st();a||(U.value=r,r.forEach(_=>{B.value.push(_.id)}),await F())}async function F(){const{data:r,error:a}=await rt();if(!a){let _=U.value.concat(r);U.value=Ee(_)}}const{pageData:z,getData:I,nextPage:C}=ce(Qe),i=async r=>{const a=r.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&z.data.length<z.total&&C()},{pageData:u,getData:m,nextPage:$}=ce(ot),J=async r=>{const a=r.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&u.data.length<u.total&&$()},f=ee(null);async function ke(r,a){e.starttime=de(1,a[0]),e.endtime=de(1,a[1])}async function De(r,a){console.log(e.pcontent)}async function xe(){var a,_,d,v;await V();let r=[];if(e.pcontent&&e.pcontent.length>0&&(r=e.pcontent.filter(y=>!B.value.includes(y))),p.operateType==="add"){const{data:y,error:k}=await Ze([{pname:e.pname,aetype:e.aetype,psort:e.psort,pcontent:r.length>0?r.join(","):"",efftime:e.efftime,starttime:e.starttime,endtime:e.endtime,aename:e.aename,alevel:e.alevel,atype:e.atype,pdesc:e.pdesc,forsys:e.forsys.length>0?(a=e.forsys)==null?void 0:a.join(","):"",status:e.status,ptype:e.ptype,weekstart:e.weekstart,weekend:e.weekend}]);k||((_=window.$message)==null||_.success(s("common.addSuccess")),R(),S("submitted"))}else{const{data:y,error:k}=await et([{id:p.rowData.id,pname:e.pname,aetype:e.aetype,psort:e.psort,pcontent:r.length>0?r.join(","):"",efftime:e.efftime,starttime:e.starttime,endtime:e.endtime,aename:e.aename,alevel:e.alevel,atype:e.atype,pdesc:e.pdesc,forsys:e.forsys.length>0?(d=e.forsys)==null?void 0:d.join(","):"",status:e.status,ptype:e.ptype,weekstart:e.weekstart,weekend:e.weekend}]);k||((v=window.$message)==null||v.success(s("common.updateSuccess")),R(),S("submitted"))}}Oe(b,()=>{b.value&&(h(),j())});const Ne=r=>{var v;function a(y){const[k,Q,A]=y.split(":").map(Number);return k*3600+Q*60+A}const _=a(e.starttime),d=a(r);if(_>d)return e.endtime=null,(v=window.$message)==null?void 0:v.warning("开始时间不能大于结束时间，请您重新选择")},Se=r=>{var a;e.efftime=r,e.starttime=null,e.endtime=null,e.weekstart=void 0,e.weekend=void 0,f.value=null,(a=c.value)==null||a.restoreValidation()},Te=r=>(e.weekstart&&e.weekstart>r.value&&(r.disabled=!0),r.label);return(r,a)=>{const _=ge,d=Fe,v=ut,y=ve,k=pt,Q=mt,A=he,se=it,Ue=ct,Ce=Ie,Le=be,re=X,Re=Ge,ze=He,ie=Y("no-space");return D(),P(ze,{show:b.value,"onUpdate:show":a[17]||(a[17]=o=>b.value=o),"display-directive":"show",width:560},{default:l(()=>[t(Re,{title:w.value,"native-scrollbar":!1,closable:""},{footer:l(()=>[t(y,{size:16},{default:l(()=>[t(re,{onClick:R},{default:l(()=>[x(L(n(s)("common.cancel")),1)]),_:1}),t(re,{type:"primary",onClick:xe},{default:l(()=>[x(L(n(s)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[t(Le,{ref_key:"formRef",ref:c,model:e,rules:E},{default:l(()=>[t(d,{label:n(s)("page.audit.strategy.name"),path:"pname"},{default:l(()=>[G(t(_,{clearable:"",value:e.pname,"onUpdate:value":a[0]||(a[0]=o=>e.pname=o),placeholder:n(s)("page.audit.strategy.form.name")},null,8,["value","placeholder"]),[[ie]])]),_:1},8,["label"]),t(d,{label:n(s)("page.audit.strategy.eventType"),path:"aetype"},{default:l(()=>[t(k,{value:e.aetype,"onUpdate:value":a[1]||(a[1]=o=>e.aetype=o)},{default:l(()=>[t(y,null,{default:l(()=>[(D(!0),le(pe,null,ue(n(K)(n(Me)),(o,Z)=>(D(),P(v,{value:o.value,key:Z},{default:l(()=>[x(L(o.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(d,{label:"事件",path:"pcontent"},{default:l(()=>[t(Q,{value:e.pcontent,"onUpdate:value":[a[2]||(a[2]=o=>e.pcontent=o),De],multiple:"",clearable:"",placeholder:"请选择事件","max-tag-count":1,options:U.value,"show-path":!1,filterable:"","value-field":"id","label-field":"pname"},null,8,["value","options"])]),_:1}),t(d,{label:n(s)("page.audit.strategy.efftime"),path:"efftime","show-feedback":!1},{default:l(()=>[oe("div",bt,[t(k,{value:e.efftime,"onUpdate:value":[a[3]||(a[3]=o=>e.efftime=o),Se]},{default:l(()=>[t(y,null,{default:l(()=>[(D(!0),le(pe,null,ue(n(K)(n(je)),(o,Z)=>(D(),P(v,{value:o.value,key:Z},{default:l(()=>[x(L(o.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"]),e.efftime===1?(D(),P(y,{key:0,align:"center",justify:"space-between",class:"mt--15px"},{default:l(()=>[t(d,{path:"weekstart"},{default:l(()=>[t(A,{filterable:"",value:e.weekstart,"onUpdate:value":a[4]||(a[4]=o=>e.weekstart=o),placeholder:"请选择星期",options:O(),style:{width:"230px"}},null,8,["value","options"])]),_:1}),wt,t(d,{path:"weekend"},{default:l(()=>[t(A,{filterable:"",value:e.weekend,"onUpdate:value":a[5]||(a[5]=o=>e.weekend=o),placeholder:"请选择星期",options:O(),"render-label":Te,style:{width:"230px"}},null,8,["value","options"])]),_:1})]),_:1})):te("",!0),e.efftime===0||e.efftime===1?(D(),P(y,{key:1,align:"center",justify:"space-between",class:"mt--15px"},{default:l(()=>[t(d,{path:"starttime"},{default:l(()=>[t(se,{"formatted-value":e.starttime,"onUpdate:formattedValue":a[6]||(a[6]=o=>e.starttime=o),type:"time",format:"HH:mm:ss",clearable:"",style:{width:"230px"}},null,8,["formatted-value"])]),_:1}),kt,t(d,{path:"endtime"},{default:l(()=>[t(se,{"formatted-value":e.endtime,"onUpdate:formattedValue":[a[7]||(a[7]=o=>e.endtime=o),Ne],type:"time",format:"HH:mm:ss",clearable:"",style:{width:"230px"}},null,8,["formatted-value"])]),_:1})]),_:1})):te("",!0),e.efftime===2?(D(),P(y,{key:2,align:"center",class:"mt--15px w-100%","item-style":{width:"100%"}},{default:l(()=>[t(d,{path:"time"},{default:l(()=>[t(Ue,{"formatted-value":f.value,"onUpdate:formattedValue":[a[8]||(a[8]=o=>f.value=o),ke],type:"datetimerange","date-format":"yyyy-MM-dd hh:mm:ss",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})]),_:1})):te("",!0)])]),_:1},8,["label"]),t(d,{label:n(s)("page.audit.strategy.eventname"),path:"aename"},{default:l(()=>[G(t(_,{value:e.aename,"onUpdate:value":a[9]||(a[9]=o=>e.aename=o),placeholder:n(s)("page.audit.strategy.form.eventname")},null,8,["value","placeholder"]),[[ie]])]),_:1},8,["label"]),t(d,{label:n(s)("page.audit.strategy.eventLevel"),path:"alevel"},{default:l(()=>[t(A,{filterable:"",value:e.alevel,"onUpdate:value":a[10]||(a[10]=o=>e.alevel=o),placeholder:"请选择审计事件级别",options:n(K)(n(Be)),style:{width:"100%"}},null,8,["value","options"])]),_:1},8,["label"]),t(d,{label:n(s)("page.audit.strategy.type"),path:"atype"},{default:l(()=>[t(A,{value:e.atype,"onUpdate:value":a[11]||(a[11]=o=>e.atype=o),placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:n(z).data,"reset-menu-on-options-change":!1,onScroll:i},null,8,["value","options"])]),_:1},8,["label"]),t(d,{label:"转发策略",path:"forsys"},{default:l(()=>[t(A,{value:e.forsys,"onUpdate:value":a[12]||(a[12]=o=>e.forsys=o),multiple:"",placeholder:"请选择转发策略",clearable:"",filterable:"","label-field":"ipaddr","value-field":"id",options:n(u).data,"reset-menu-on-options-change":!1,onScroll:J},null,8,["value","options"])]),_:1}),t(d,{label:n(s)("page.audit.strategy.describe"),path:"pdesc"},{default:l(()=>[t(_,{value:e.pdesc,"onUpdate:value":a[13]||(a[13]=o=>e.pdesc=o),placeholder:n(s)("page.audit.strategy.form.describe"),type:"textarea"},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:n(s)("page.audit.strategy.status"),path:"status"},{default:l(()=>[t(k,{value:e.status,"onUpdate:value":a[14]||(a[14]=o=>e.status=o)},{default:l(()=>[t(y,null,{default:l(()=>[t(v,{value:0},{default:l(()=>[x("开启")]),_:1}),t(v,{value:1},{default:l(()=>[x("禁用")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(d,{label:n(s)("page.audit.strategy.form.built"),path:"ptype"},{default:l(()=>[t(k,{value:e.ptype,"onUpdate:value":a[15]||(a[15]=o=>e.ptype=o)},{default:l(()=>[t(y,null,{default:l(()=>[t(v,{value:0},{default:l(()=>[x(L(n(s)("common.yesOrNo.yes")),1)]),_:1}),t(v,{value:1},{default:l(()=>[x(L(n(s)("common.yesOrNo.no")),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(d,{label:n(s)("page.audit.type.sort"),path:"psort"},{default:l(()=>[t(Ce,{min:0,value:e.psort,"onUpdate:value":a[16]||(a[16]=o=>e.psort=o),placeholder:n(s)("page.audit.strategy.form.sort"),style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),xt=ne({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ae(["reset","search"],["update:model"]),setup(N,{emit:M}){const p=M,{formRef:S,restoreValidation:b}=ye(),c=_e(N,"model");function V(){c.value.fuzzy="",p("search")}async function j(){await b(),p("reset")}async function g(){p("search")}return(B,w)=>{const e=ge,T=yt,E=he,O=_t,h=X,R=ft,U=ve,H=gt,F=be,z=we,I=Y("no-space");return D(),P(z,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[t(F,{ref_key:"formRef",ref:S,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:We(g,["enter"])},{default:l(()=>[t(H,{responsive:"screen","item-responsive":""},{default:l(()=>[t(T,{span:"24 s:12 m:6",label:n(s)("page.audit.strategy.name"),path:"fuzzy",class:"pr-24px"},{default:l(()=>[G(t(e,{clearable:"",value:c.value.fuzzy,"onUpdate:value":w[0]||(w[0]=C=>c.value.fuzzy=C),placeholder:n(s)("page.audit.strategy.form.name"),onClear:V},null,8,["value","placeholder"]),[[I]])]),_:1},8,["label"]),t(T,{span:"24 s:12 m:6",label:"使用状态",path:"status",class:"pr-24px"},{default:l(()=>[t(E,{filterable:"",clearable:"",value:c.value.status,"onUpdate:value":[w[1]||(w[1]=C=>c.value.status=C),g],placeholder:"请选择使用状态",options:n(K)(n(qe))},null,8,["value","options"])]),_:1}),t(T,{span:"24 m:12",class:"pr-24px"},{default:l(()=>[t(U,{class:"w-full"},{default:l(()=>[t(h,{onClick:j},{icon:l(()=>[t(O,{class:"text-icon"})]),default:l(()=>[x(" "+L(n(s)("common.reset")),1)]),_:1}),t(h,{type:"primary",ghost:"",onClick:g},{icon:l(()=>[t(R,{class:"text-icon"})]),default:l(()=>[x(" "+L(n(s)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Nt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!Je(N)}const Zt=ne({name:"audit_strategy",__name:"index",setup(N){const M=Ke(),{columns:p,columnChecks:S,data:b,getData:c,loading:V,mobilePagination:j,searchParams:g,resetSearchParams:B}=lt({apiFn:tt,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,status:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"pname",title:s("page.audit.strategy.name"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"alevel",title:s("page.audit.strategy.eventLevel"),align:"center",minWidth:180,render:i=>{(i.alevel===void 0||i.alevel===null)&&(i.alevel=0);const u={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},m=s(vt[i.alevel]);let $={color:u[i.alevel],textColor:"#ffffff",borderColor:u[i.alevel]};return t(me,{size:"small",color:$},W(m)?m:{default:()=>[m]})}},{key:"pdesc",title:s("page.audit.strategy.describe"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"ptype",title:s("page.audit.strategy.built"),align:"center",width:120,render:i=>{const u={0:"primary",1:"error"},m=s(Ye[i.ptype]);return t(me,{type:u[i.ptype]},W(m)?m:{default:()=>[m]})}},{key:"status",title:s("page.audit.strategy.status"),align:"center",width:120,render:i=>t(Xe,{disabled:!0,value:i.status,checkedValue:0,uncheckedValue:1},null)},{key:"operate",title:s("common.operate"),align:"center",width:130,render:i=>{let u;return i.ptype!=0?t("div",{class:"flex-center gap-8px"},[G(t(X,{type:"primary",ghost:!0,size:"small",onClick:()=>I(i.id)},W(u=s("common.edit"))?u:{default:()=>[u]}),[[Y("no-auth"),"sys.audit.policy.update"]]),t(ht,{onPositiveClick:()=>z(i.id)},{default:()=>s("common.confirmDelete"),trigger:()=>{let m;return G(t(X,{type:"error",ghost:!0,size:"small"},W(m=s("common.delete"))?m:{default:()=>[m]}),[[Y("no-auth"),"sys.audit.policy.delete"]])}})]):null}}]}),{drawerVisible:w,operateType:e,editingData:T,handleAdd:E,handleEdit:O,checkedRowKeys:h,onBatchDeleted:R,onDeleted:U,closeDrawer:H}=nt(b,c);async function F(){console.log(h.value),C(h.value,i=>{R()})}function z(i){console.log(i),C([i],u=>{U()})}function I(i){O(i)}async function C(i,u){const{data:m,error:$}=await at(i);if(!$)u&&u(m);else return!1}return(i,u)=>{const m=$e,$=dt,J=we;return D(),le("div",Nt,[t(xt,{model:n(g),"onUpdate:model":u[0]||(u[0]=f=>q(g)?g.value=f:null),onReset:n(B),onSearch:n(c)},null,8,["model","onReset","onSearch"]),t(J,{title:n(s)("page.audit.strategy.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[t(m,{columns:n(S),"onUpdate:columns":u[1]||(u[1]=f=>q(S)?S.value=f:null),"disabled-delete":n(h).length===0,loading:n(V),onAdd:n(E),onDelete:F,onRefresh:n(c),"is-view-add-button":n(fe)("sys.audit.policy.insert"),"is-view-delete-button":n(fe)("sys.audit.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:l(()=>[t($,{"checked-row-keys":n(h),"onUpdate:checkedRowKeys":u[2]||(u[2]=f=>q(h)?h.value=f:null),columns:n(p),data:n(b),size:"small","flex-height":!n(M).isMobile,"scroll-x":962,loading:n(V),remote:"","row-key":f=>f.id,pagination:n(j),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Dt,{visible:n(w),"onUpdate:visible":u[3]||(u[3]=f=>q(w)?w.value=f:null),"operate-type":n(e),"row-data":n(T),onSubmitted:n(c)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{Zt as default};
