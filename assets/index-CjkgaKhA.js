import{_ as ge}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BQNbmSUZ.js";import{d as I,at as F,av as Q,s as se,x as oe,a as ve,$ as n,v as ne,aw as le,y as W,c as X,o as V,w as o,f as e,bh as ye,G as Y,A as re,h as s,D as H,C as Z,az as ie,c0 as he,N as q,B as O,g as R,t as T,bj as be,c1 as ke,c2 as Ne,c3 as xe,F as Ue,bi as Se,U as ue,bL as ee,e as De,aE as ce,c4 as Ce,bW as Pe,M as Re,r as L,b as Te,aO as B,ay as Me,ax as $e,c5 as Oe,c6 as je,aF as ae,c7 as ze,aU as Be}from"./index-BhBp_qK9.js";import{u as Fe,a as Ie}from"./table-txCoW33S.js";import{u as de,d as Ve}from"./business-PlGaHObb.js";import{_ as qe}from"./round-search-B9RiPIED.js";import{_ as Ge}from"./round-refresh-CHq_sj9A.js";import{_ as Ke}from"./Grid-CO09elz5.js";import{_ as Ae}from"./FormItemGridItem-UGN3dIqT.js";import{_ as Ee}from"./Tree-XV2ZMfHr.js";import{h as te}from"./permission-DTpISKnL.js";import{N as Le}from"./Popconfirm-M-SYUm8J.js";const Je=I({name:"OperateDrawer",__name:"operate-drawer",props:F({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:F(["submitted"],["update:visible"]),setup(v,{emit:N}){const r=v,h=N,_=Q(v,"visible"),{formRef:d,validate:x,restoreValidation:M}=se(),{defaultRequiredRule:w,patternRules:S}=oe(),p=ve(()=>({add:n("page.manage.user.addUser"),edit:n("page.manage.user.editUser")})[r.operateType]),t=ne(u());function u(){return{id:void 0,username:"",oripwd:"",password:"",confirmPassword:"",usertype:void 0,superadmin:1,userimage:"",phnum:"",udesc:""}}const m={username:w,oripwd:{...w,...S.password},password:{...w,...S.password},phnum:{...w,...S.mobile}};async function g(){if(Object.assign(t,u()),r.operateType==="edit"&&r.rowData){const{data:b,error:c}=await ke(r.rowData.id);c?Object.assign(t,r.rowData):(Object.assign(t,b),t.usertype=t.usertype+"")}}function D(){_.value=!1}async function $(){var b,c;if(await x(),r.operateType==="add"){const{data:U,error:y}=await Ne(t.username,t.password,t.usertype,t.superadmin,t.phnum,t.udesc);y||((b=window.$message)==null||b.success(n("common.addSuccess")),D(),h("submitted"))}else{const{data:U,error:y}=await xe({id:t.id,usertype:t.usertype,phnum:t.phnum,udesc:t.udesc});y||((c=window.$message)==null||c.success(n("common.updateSuccess")),D(),h("submitted"))}}return le(_,()=>{_.value&&(g(),M())}),(b,c)=>{const U=Z,y=re,j=ie,P=Y,C=O,f=q,G=ye,K=be,l=W("no-special");return V(),X(K,{show:_.value,"onUpdate:show":c[4]||(c[4]=a=>_.value=a),"display-directive":"show",width:360},{default:o(()=>[e(G,{title:p.value,"native-scrollbar":!1,closable:""},{footer:o(()=>[e(f,{size:16},{default:o(()=>[e(C,{onClick:D},{default:o(()=>[R(T(s(n)("common.cancel")),1)]),_:1}),e(C,{type:"primary",onClick:$},{default:o(()=>[R(T(s(n)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(P,{ref_key:"formRef",ref:d,model:t,rules:m},{default:o(()=>[e(y,{label:s(n)("page.manage.user.username"),path:"username"},{default:o(()=>[H(e(U,{value:t.username,"onUpdate:value":c[0]||(c[0]=a=>t.username=a),placeholder:s(n)("page.manage.user.form.username"),readonly:r.operateType==="edit"},null,8,["value","placeholder","readonly"]),[[l]])]),_:1},8,["label"]),e(y,{label:"用户类型",path:"usertype"},{default:o(()=>[e(j,{value:t.usertype,"onUpdate:value":c[1]||(c[1]=a=>t.usertype=a),filterable:"",placeholder:"请选择用户类型",options:s(he)(s(de).slice(1)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(y,{label:"手机号码",path:"phnum"},{default:o(()=>[e(U,{clearable:"",value:t.phnum,"onUpdate:value":c[2]||(c[2]=a=>t.phnum=a),maxlength:11,placeholder:"请输入手机号码"},null,8,["value"])]),_:1}),e(y,{label:"描述",path:"udesc"},{default:o(()=>[e(U,{type:"textarea",clearable:"",value:t.udesc,"onUpdate:value":c[3]||(c[3]=a=>t.udesc=a),placeholder:"请输入描述",autosize:{minRows:3}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),We=I({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:F(["reset","search"],["update:model"]),setup(v,{emit:N}){const r=N,{formRef:h,restoreValidation:_}=se(),d=Q(v,"model");function x(){d.value.username="",r("search")}async function M(){await _(),d.value.usertype=null,d.value.username="",r("reset")}async function w(){r("search")}const S=t=>{d.value.usertype=t,r("search")},p=()=>{d.value.usertype=null,r("search")};return(t,u)=>{const m=Z,g=Ae,D=ie,$=Ge,b=O,c=qe,U=q,y=Ke,j=Y,P=ue;return V(),X(P,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[e(j,{ref_key:"formRef",ref:h,model:d.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ue(w,["enter"])},{default:o(()=>[e(y,{responsive:"screen","item-responsive":""},{default:o(()=>[e(g,{span:"24 s:12 m:6",label:s(n)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:o(()=>[e(m,{clearable:"",value:d.value.username,"onUpdate:value":u[0]||(u[0]=C=>d.value.username=C),valueModifiers:{trim:!0},placeholder:s(n)("page.manage.user.form.username"),onClear:x},null,8,["value","placeholder"])]),_:1},8,["label"]),e(g,{span:"24 s:12 m:6",label:"用户类型",path:"usertype",class:"pr-24px"},{default:o(()=>[e(D,{value:d.value.usertype,"onUpdate:value":[u[1]||(u[1]=C=>d.value.usertype=C),S],clearable:"",placeholder:"请选择用户类型",onClear:p,options:s(Se)(s(de))},null,8,["value","options"])]),_:1}),e(g,{span:"24 s:12 m:6",class:"pr-24px"},{default:o(()=>[e(U,{class:"w-full"},{default:o(()=>[e(b,{onClick:M},{icon:o(()=>[e($,{class:"text-icon"})]),default:o(()=>[R(" "+T(s(n)("common.reset")),1)]),_:1}),e(b,{type:"primary",ghost:"",onClick:w},{icon:o(()=>[e(c,{class:"text-icon"})]),default:o(()=>[R(" "+T(s(n)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),He=I({name:"assignRoles",__name:"assign-roles",props:F({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(v){const N=v,r=Q(v,"visible");function h(){r.value=!1}const _=ee([]),d=async()=>{const{error:p,data:t}=await Pe();if(!p){const u=JSON.parse(JSON.stringify(t));_.value=u.list.map(m=>m)}},x=ee([]),M=async(p,t,u)=>{var m;x.value=[(m=u.node)==null?void 0:m.id]};async function w(){var p,t,u;if(N.rowData.id){const{data:m,error:g}=await Ce(N.rowData.id,x.value.join(","));g||((p=window.$message)==null||p.destroyAll(),(u=(t=window.$message)==null?void 0:t.success)==null||u.call(t,n("common.modifySuccess")),h())}}function S(){N.rowData.id&&(d(),x.value=[N.rowData.roleId])}return le(r,p=>{p&&S()}),(p,t)=>{const u=Ee,m=O,g=q,D=ce;return V(),X(D,{show:r.value,"onUpdate:show":t[0]||(t[0]=$=>r.value=$),preset:"card",class:"w-480px"},{header:o(()=>t[1]||(t[1]=[De("div",{class:"flex"},"设置用户角色",-1)])),footer:o(()=>[e(g,{justify:"end"},{default:o(()=>[e(m,{size:"small",class:"mt-16px",onClick:h},{default:o(()=>[R(T(s(n)("common.cancel")),1)]),_:1}),e(m,{type:"primary",size:"small",class:"mt-16px",onClick:w},{default:o(()=>[R(T(s(n)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(u,{cascade:"","checked-keys":x.value,data:_.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"","label-field":"name","key-field":"id","children-field":"children","onUpdate:checkedKeys":M},null,8,["checked-keys","data"])]),_:1},8,["show"])}}}),Qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function J(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Be(v)}const ia=I({name:"manage_user",__name:"index",setup(v){const N=Re(),{columns:r,columnChecks:h,data:_,getData:d,loading:x,mobilePagination:M,searchParams:w,resetSearchParams:S}=Fe({apiFn:je,apiParams:{page:1,pageSize:50,limit:50,username:null,usertype:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"username",title:n("page.manage.user.username"),align:"center",width:160},{key:"usertype",title:"用户类型",align:"center",width:120,render:l=>{const a=n(Ve[l.usertype]);return e(ae,{type:"primary"},J(a)?a:{default:()=>[a]})}},{key:"phnum",title:"手机号码",align:"center",width:160},{key:"udesc",title:"描述",align:"center",width:200},{key:"status",title:n("page.manage.user.status"),align:"center",width:180,render:l=>(l.status===null?l.status=0:(l.status===2||l.status===3)&&(l.status=1),e(ae,{type:l.status==0?"success":l.status==1?"error":l.status==2?"warning":"success"},{default:()=>[l.status==0?"正常":l.status==1?"异常":l.status==2?"锁定":"正常"]}))},{key:"createdate",title:n("page.manage.user.createDate"),align:"center",width:180},{key:"operate",title:n("common.operate"),align:"center",width:te("sys:user:update")&&te("sys:user:delete")?320:0,render:l=>{let a;return e("div",{class:"flex-center gap-8px"},[l.superadmin!=0&&H(e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>b(l.id)},J(a=n("common.edit"))?a:{default:()=>[a]}),[[W("no-auth"),"sys:user:update"]]),l.superadmin!=0&&e(Le,{onPositiveClick:()=>$(l.id)},{default:()=>n("common.confirmDelete"),trigger:()=>{let k;return H(e(O,{type:"error",ghost:!0,size:"small"},J(k=n("common.delete"))?k:{default:()=>[k]}),[[W("no-auth"),"sys:user:delete"]])}})])}}]}),{drawerVisible:p,operateType:t,editingData:u,handleEdit:m,checkedRowKeys:g,onDeleted:D}=Ie(_,d);function $(l){c([l],a=>{D()})}function b(l){m(l)}async function c(l,a){const k=await ze(l);console.log("data",k),a&&a(k)}const U=L(!1),{defaultRequiredRule:y,patternRules:j}=oe(),P=L(!1),C=L(),f=ne({username:"",password:"",confirmPassword:"",id:null}),G={password:[y,j.password],confirmPassword:[{required:!0,message:n("form.confirmPwd.required")},{asyncValidator:(l,a)=>a.trim()!==""&&a!==f.password?Promise.reject(l.message):Promise.resolve(),message:n("form.confirmPwd.invalid"),trigger:"input"}]},K=async()=>{var k,z;if(!f.id)return;await((k=C.value)==null?void 0:k.validate());const{data:l,error:a}=await Oe(f.username,f.id,f.password);a||((z=window.$message)==null||z.success("修改成功"),P.value=!1)};return(l,a)=>{const k=ge,z=q,pe=Me,me=ue,A=Z,E=re,fe=Y,_e=$e,we=ce;return V(),Te("div",Qe,[e(We,{model:s(w),"onUpdate:model":a[0]||(a[0]=i=>B(w)?w.value=i:null),onReset:s(S),onSearch:s(d)},null,8,["model","onReset","onSearch"]),e(me,{title:s(n)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[e(z,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[e(k,{columns:s(h),"onUpdate:columns":a[1]||(a[1]=i=>B(h)?h.value=i:null)},null,8,["columns"])]),_:1})]),default:o(()=>[e(pe,{"checked-row-keys":s(g),"onUpdate:checkedRowKeys":a[2]||(a[2]=i=>B(g)?g.value=i:null),columns:s(r),data:s(_),size:"small","flex-height":!s(N).isMobile,"scroll-x":962,loading:s(x),remote:"","row-key":i=>i.id,pagination:s(M),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Je,{visible:s(p),"onUpdate:visible":a[3]||(a[3]=i=>B(p)?p.value=i:null),"operate-type":s(t),"row-data":s(u),onSubmitted:s(d)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(He,{"row-data":s(u),visible:U.value,"onUpdate:visible":a[4]||(a[4]=i=>U.value=i)},null,8,["row-data","visible"])]),_:1},8,["title"]),e(we,{show:P.value,"onUpdate:show":a[9]||(a[9]=i=>P.value=i),title:s(n)("common.updatePassword"),preset:"card",class:"w-620px"},{footer:o(()=>[e(z,{justify:"end",size:16},{default:o(()=>[e(s(O),{onClick:a[8]||(a[8]=i=>P.value=!1)},{default:o(()=>[R(T(s(n)("common.cancel")),1)]),_:1}),e(s(O),{type:"primary",onClick:K},{default:o(()=>[R(T(s(n)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(_e,{class:"max-h-480px pr-20px"},{default:o(()=>[e(fe,{ref_key:"formRef",ref:C,model:f,rules:G,"label-placement":"left","label-width":100,"require-mark-placement":"left"},{default:o(()=>[e(E,{label:s(n)("page.manage.user.username"),path:"username"},{default:o(()=>[e(A,{readonly:"",value:f.username,"onUpdate:value":a[5]||(a[5]=i=>f.username=i),placeholder:s(n)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(E,{label:s(n)("page.login.common.password"),path:"password"},{default:o(()=>[e(A,{type:"password","show-password-on":"click",clearable:"",value:f.password,"onUpdate:value":a[6]||(a[6]=i=>f.password=i),placeholder:s(n)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(E,{label:s(n)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:o(()=>[e(A,{type:"password","show-password-on":"click",clearable:"",value:f.confirmPassword,"onUpdate:value":a[7]||(a[7]=i=>f.confirmPassword=i),placeholder:s(n)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])])}}});export{ia as default};
