import{l as K}from"./lodash-I0T84UtN.js";import{d as q,q as M,j as m,v as W,s as X,o as F,c as Z,w as i,g as l,i as I,$ as x,U as Q,h as N,t as R,M as Y,an as D,ao as V,X as ee,A as ae,B as G,E as j,D as te,a9 as J,Z as le,r as B,am as ne,e as ie,ad as oe,aR as re,ax as se}from"./index-COCU-dRC.js";import{_ as ue}from"./round-search-Ozoxzuc1.js";import{_ as de}from"./round-refresh-BJ3UDO-a.js";import{u as pe}from"./usePageData-YwCZ_Txz.js";import{a as ce,T as H}from"./basicconf-CbXKAjHR.js";import{f as ve}from"./system-manage-DSOUsCGC.js";import{_ as me}from"./Cascader-B6O1WJNC.js";import{_ as fe}from"./FormItemGridItem-BgX6gCvp.js";import{_ as ge}from"./DatePicker-C8CF71gD.js";import{_ as _e}from"./Grid-DXM2gQBE.js";import{_ as Ie}from"./originlogInfo.vue_vue_type_script_setup_true_lang-Ixc916C2.js";import{e as he}from"./exportExcel-CZ2AjtLT.js";import{q as ye,y as Ae}from"./events-CLAzewCH.js";import{b as Se,f as we,a as xe}from"./common-JmfxvJNV.js";import{_ as Oe}from"./DataTable-W68blcrm.js";import"./TimePicker-hUC2kxSD.js";import"./defineProperty-rwZg3Jcs.js";import"./Forward-Cj8r8vQs.js";import"./CollapseItem-gT_SZwdz.js";import"./DescriptionsItem-CQVEeKaL.js";const be=q({name:"FormSearch",__name:"form-search",props:M(["eventsTypeDataList","LogSourceDeviceList"],{model:{required:!0},modelModifiers:{}}),emits:M(["search"],["update:model"]),setup(y,{emit:$}){const L=y,P=$,O=m(0);m([{label:"源IP(t.ip1)",value:"t.ip1"},{label:"目的IP(t.ip2)",value:"t.ip2"}]);const{formRef:U,restoreValidation:z}=W(),e=X(y,"model"),{pageData:A,getData:T,nextPage:C}=pe(ve),S=async v=>{const n=v.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&A.data.length<A.total&&C()};T();async function g(v,n){e.value.rtime=v}function k(){e.value.elevel=void 0,P("search")}async function u(){await z(),e.value.fuzzy=void 0,e.value.etypeid=void 0,e.value.logodid=void 0,e.value.user=void 0,e.value.target=void 0,e.value.elevel=void 0,e.value.rtime=void 0,e.value.timeRange=void 0,e.value.startAndEndOriginIp=void 0,e.value.startAndEndSourceIp=void 0,e.value.startAndEndAimSourceIp=void 0,e.value.expression=void 0,P("search")}async function h(){var v,n,c,d,w,b,_,E,a,t;if(O.value==0){if(e.value.startAndEndOriginIp&&e.value.startAndEndOriginIp.length>0?(e.value.startOriginIp=e.value.startAndEndOriginIp[0]||null,e.value.endOriginIp=e.value.startAndEndOriginIp[1]||null):(e.value.startOriginIp=void 0,e.value.endOriginIp=void 0),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimOriginIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimOriginIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimOriginIp=void 0,e.value.endAimOriginIp=void 0),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=void 0,e.value.endSourceIp=void 0),e.value.startSourceIp&&!D(e.value.startSourceIp)||e.value.startAimOriginIp&&!D(e.value.startAimOriginIp)||e.value.startOriginIp&&!D(e.value.startOriginIp))return(v=window.$message)==null||v.destroyAll(),(n=window.$message)==null||n.error("请输入正确的IP地址"),!1;if(e.value.endSourceIp&&!D(e.value.endSourceIp)||e.value.endAimOriginIp&&!D(e.value.endAimOriginIp)||e.value.endOriginIp&&!D(e.value.endOriginIp))return(c=window.$message)==null||c.destroyAll(),(d=window.$message)==null||d.error("请输入正确的IP地址"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&V(e.value.startSourceIp,e.value.endSourceIp)>0)return(w=window.$message)==null||w.destroyAll(),(b=window.$message)==null||b.error("起始IP不能大于终止IP"),!1;if(e.value.startAimOriginIp&&e.value.endAimOriginIp&&V(e.value.startAimOriginIp,e.value.endAimOriginIp)>0)return(_=window.$message)==null||_.destroyAll(),(E=window.$message)==null||E.error("起始IP不能大于终止IP"),!1;if(e.value.startOriginIp&&e.value.endOriginIp&&V(e.value.startOriginIp,e.value.endOriginIp)>0)return(a=window.$message)==null||a.destroyAll(),(t=window.$message)==null||t.error("起始IP不能大于终止IP"),!1}else e.value.etypeid=void 0,e.value.elevel=void 0,e.value.rtime=void 0,e.value.startAndEndOriginIp=void 0,e.value.startOriginIp=void 0,e.value.endOriginIp=void 0,e.value.startAndEndAimSourceIp=void 0,e.value.startAimOriginIp=void 0,e.value.endAimOriginIp=void 0,e.value.startAndEndSourceIp=void 0,e.value.startSourceIp=void 0,e.value.endSourceIp=void 0,e.value.logodid=void 0,e.value.user=void 0,e.value.target=void 0,e.value.fuzzy=void 0;P("search")}return(v,n)=>{const c=me,d=fe,w=ee,b=ge,_=ae,E=de,a=G,t=ue,o=j,f=_e,s=te,p=J;return F(),Z(p,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[l(s,{ref_key:"formRef",ref:U,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Y(h,["enter"])},{default:i(()=>[l(f,{responsive:"screen","item-responsive":""},{default:i(()=>[l(d,{span:"24 s:24 m:6",label:"事件类型",path:"etypeid",class:"pr-24px"},{default:i(()=>[l(c,{value:e.value.etypeid,"onUpdate:value":n[0]||(n[0]=r=>e.value.etypeid=r),clearable:"",placeholder:"请选择事件","max-tag-count":1,options:L.eventsTypeDataList,"show-path":!1,filterable:"","value-field":"id","label-field":"pname"},null,8,["value","options"])]),_:1}),l(d,{span:"24 s:24 m:6",label:I(x)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:i(()=>[l(w,{filterable:"",clearable:"",placeholder:I(x)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[n[1]||(n[1]=r=>e.value.elevel=r),h],"reset-menu-on-options-change":!1,options:I(Q)(I(ce))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),l(d,{span:"24 s:24 m:6",label:"接收时间",path:"timeRange",class:"pr-24px"},{default:i(()=>[l(b,{value:e.value.timeRange,"onUpdate:value":n[2]||(n[2]=r=>e.value.timeRange=r),type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",clearable:"",style:{width:"100%"},"onUpdate:formattedValue":g},null,8,["value"])]),_:1}),l(d,{span:"24 s:24 m:6",label:"用户",path:"user",class:"pr-24px"},{default:i(()=>[l(w,{value:e.value.user,"onUpdate:value":n[3]||(n[3]=r=>e.value.user=r),placeholder:"请选择用户",clearable:"",filterable:"","value-field":"id","label-field":"username",options:I(A).data,"reset-menu-on-options-change":!1,onScroll:S},null,8,["value","options"])]),_:1}),l(d,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndOriginIp",class:"pr-24px mt-10px"},{default:i(()=>[l(_,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndOriginIp,"onUpdate:value":n[4]||(n[4]=r=>e.value.startAndEndOriginIp=r)},null,8,["value"])]),_:1}),l(d,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px mt-10px"},{default:i(()=>[l(_,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":n[5]||(n[5]=r=>e.value.startAndEndAimSourceIp=r)},null,8,["value"])]),_:1}),l(d,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSourceIp",class:"pr-24px mt-10px"},{default:i(()=>[l(_,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":n[6]||(n[6]=r=>e.value.startAndEndSourceIp=r)},null,8,["value"])]),_:1}),l(d,{span:"24 s:24 m:6",label:"日志源设备",path:"logodid",class:"pr-24px mt-10px"},{default:i(()=>[l(c,{value:e.value.logodid,"onUpdate:value":[n[7]||(n[7]=r=>e.value.logodid=r),h],placeholder:"请选择日志源设备",options:L.LogSourceDeviceList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),l(d,{span:"24 s:24 m:6",label:"目标对象",path:"target",class:"pr-24px mt-10px"},{default:i(()=>[l(_,{placeholder:"请输入目标对象",value:e.value.target,"onUpdate:value":n[8]||(n[8]=r=>e.value.target=r),onClear:k},null,8,["value"])]),_:1}),l(d,{span:"24 m:8",class:"pr-24px mt-10px"},{default:i(()=>[l(o,{class:"w-full"},{default:i(()=>[l(a,{onClick:u},{icon:i(()=>[l(E,{class:"text-icon"})]),default:i(()=>[N(" "+R(I(x)("common.reset")),1)]),_:1}),l(a,{type:"primary",ghost:"",onClick:h},{icon:i(()=>[l(t,{class:"text-icon"})]),default:i(()=>[N(" "+R(I(x)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ee={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function De(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!oe(y)}const Le=q({name:"eventalarm_originlog",__name:"index",setup(y){const $=le(),L=m([]);(async()=>{const{data:a,error:t}=await Se();t||(L.value=a.map(o=>({...o,id:"+"+o.id,type:o.cname})))})();const O=m([]),U=m([]);async function z(){const{data:a,error:t}=await we();t||(O.value=a,await e())}async function e(){const{data:a,error:t}=await xe();if(!t){U.value=a;let o=O.value.concat(a);O.value=re(o)}}z();const A=m(!1),T=m(),C=m(),S=m(!1),g=B({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),k=[{title:"",key:"key",width:80,render:(a,t)=>`${t+1}`},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"elevel",title:"事件等级",align:"center",width:120,render:a=>{(a.elevel===void 0||a.elevel===null)&&(a.elevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},o=x(H[a.elevel]);let f={color:t[a.elevel],textColor:"#ffffff",borderColor:t[a.elevel]};return l(ne,{size:"small",color:f},De(o)?o:{default:()=>[o]})}},{key:"cname",title:"设备类别",align:"center",width:180},{key:"type",title:"设备类型",align:"center",width:180},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"sourceip",title:"发生源IP",align:"center",width:180},{key:"prifinallog",title:"日志原文",align:"center",width:240,ellipsis:{tooltip:!0}},{key:"operate",title:x("common.operate"),align:"center",width:100,fixed:"right",render:a=>l("div",{class:"flex-center gap-8px"},[l(G,{type:"info",ghost:!0,size:"small",onClick:()=>w(a)},{default:()=>[N("详情")]})])}],u=m([]),h=async(a=!1)=>{if(!S.value)S.value=!0;else return;S.value=!0;const{data:t,error:o}=await ye(g);o||(a?u.value=[...u.value,...t]:u.value=t,S.value=!1)};h();const v=m(!0),n=()=>{u.value=[],g.pageId=void 0,(t=>Object.keys(t).filter(s=>s!=="limit"&&s!=="_t").some(s=>t[s]!==void 0&&t[s]!==""&&t[s]!==null))(g)?v.value=!1:(v.value=!0,d()),h()},c=B({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:t,page:o,pageSize:f,pageCount:s,itemCount:p}){return`已加载${u.value.length}条`+(u.value.length?v.value?` 共计 ${u.value.length>0?p??0:0} 条`:u.value.length>=g.limit?"  预计还有更多":"":"")}});async function d(){const{data:a,error:t}=await Ae();t||(c.pageCount=20,c.total=Number(a),c.itemCount=Number(a))}d();const w=a=>{T.value=a.id,C.value=a,A.value=!0};function b(a){var t;a.target.scrollTop+a.target.offsetHeight==a.target.scrollHeight&&c.total>((t=u.value)==null?void 0:t.length)&&_()}const _=K.debounce(()=>{var a;((a=u.value)==null?void 0:a.length)<c.total&&(g.pageId=u.value[u.value.length-1].id,h(!0))},300);async function E(){const a=JSON.parse(JSON.stringify(u.value)),t=[];a.forEach(o=>{const f={};k.forEach(s=>{if(o.hasOwnProperty(s.key)){const p=s.key=="elevel"?x(H[o[s.key]]):o[s.key];f[s.title]=p}}),t.push(f)}),he(t,500,"origin-log"+new Date().getTime())}return(a,t)=>{const o=j,f=Oe,s=J;return F(),ie("div",Ee,[l(be,{model:g,"onUpdate:model":t[0]||(t[0]=p=>g=p),onSearch:n,eventsTypeDataList:O.value,LogSourceDeviceList:L.value},null,8,["model","eventsTypeDataList","LogSourceDeviceList"]),l(s,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":i(()=>[l(o,null,{default:i(()=>[l(I(G),{type:"primary",size:"small",ghost:"",onClick:E,title:"导出已加载"},{default:i(()=>[N("导出已加载")]),_:1})]),_:1})]),default:i(()=>[l(f,{columns:k,data:u.value,size:"small","flex-height":!I($).isMobile,loading:S.value,remote:"","row-key":p=>p.id,"virtual-scroll":"","scroll-x":k.reduce((p,r)=>p+r.width,0),pagination:c,class:"sm:h-full",onScroll:b,"max-height":"auto"},null,8,["data","flex-height","loading","row-key","scroll-x","pagination"])]),_:1}),l(Ie,{detailVisible:A.value,"onUpdate:detailVisible":t[1]||(t[1]=p=>A.value=p),detailId:T.value,detailInfo:C.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),Ze=se(Le,[["__scopeId","data-v-dca76aed"]]);export{Ze as default};
