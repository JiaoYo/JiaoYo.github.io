import{_ as ge}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CmtWf5LB.js";import{_ as _e}from"./round-delete-BB0BvKLF.js";import{_ as ve}from"./round-add-CPsLecQG.js";import{d as ee,as as Y,p as oe,s as ye,r as Z,q as se,a as he,at as ie,a1 as be,c as T,o as b,w as n,f as a,b7 as we,F as re,h as o,av as de,A as C,b as H,g as f,e as U,t as N,bp as ke,B as D,N as te,$,b8 as xe,ad as pe,c0 as Ce,cB as De,cC as ze,E as Ne,U as ue,L as Se,i as je,x as X,aB as J,ax as Ue,C as Q,bn as Pe,cD as ae,cE as Te,aE as $e}from"./index-CXGXpIU7.js";import{u as qe,a as Re}from"./table-DApe29Wb.js";import{u as ce}from"./usePageData-psNCr24a.js";import{_ as me}from"./Grid-CSuTco9f.js";import{_ as fe}from"./FormItemGridItem-D31qr53-.js";import{_ as Fe}from"./round-search-CuHcKJND.js";import{_ as Be}from"./round-refresh-B_AgJ8PR.js";import{N as le}from"./Popconfirm-D1cRFhe_.js";const Le={key:0},Ie={key:0},Me={key:0},Oe={key:0},Ee=ee({name:"OperateDrawer",__name:"operate-drawer",props:Y({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(S,{emit:I}){const w=I,q=oe(),v=S,t=ye(k());Z();function k(){return{pid:void 0,id:"",affectedbusiness:"",devname:"",apidocument:"",uid:void 0,period:"",notes:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const c=Z([]),{pageData:g,getData:y,nextPage:R}=ce(pe),M=async l=>{const e=l.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&g.data.length<g.total&&(R(),c.value=g.data)},O=async()=>{var l;await y({fuzzy:q.userInfo.pname}),c.value=g.data,t.pid=v.pid?v.pid:(l=c.value[0])==null?void 0:l.id},E=async()=>{await y(),c.value=g.data},V=async l=>{t.pid=l};async function j(){O(),Object.assign(t,k()),v.operateType==="edit"&&v.rowData&&Object.assign(t,v.rowData)}const{formRef:A,validate:G,restoreValidation:L}=se(),p={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},affectedbusiness:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},apidocument:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},period:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},uid:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},d=he(()=>({add:"新增需要开发",edit:"修改需要开发"})[v.operateType]),h=ie(S,"visible");async function z(l){if(l)try{const i=await(await fetch(l==null?void 0:l.split("?")[0],{mode:"cors"})).blob(),u=URL.createObjectURL(i),_=document.createElement("a");_.href=u,_.download=l==null?void 0:l.split("?")[1],_.style.display="none",document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(u)}catch(e){console.error("下载失败:",e)}}be(h,()=>{h.value&&(j(),setTimeout(()=>{const l=document.querySelector(".n-scrollbar-content");l==null||l.scrollTo(0,0)},300),L())});async function P({file:l},e){let i=new FormData;i.append("multipartFile",l.file);const{data:u,error:_}=await Ce(i);_||(t[e]=u)}function F(){h.value=!1}async function m(){var l,e;if(await G(),v.operateType==="edit"){const{data:i,error:u}=await De([t]);u||(F(),w("submitted"),(l=window.$message)==null||l.success("修改成功"))}else{const{data:i,error:u}=await ze([{...t}]);u||(F(),w("submitted"),(e=window.$message)==null||e.success("添加成功"))}}return(l,e)=>{const i=fe,u=ke,_=me,B=re,W=we,K=te,x=xe;return b(),T(x,{show:h.value,"onUpdate:show":e[19]||(e[19]=s=>h.value=s),title:d.value,preset:"card",class:"w-800px"},{footer:n(()=>[a(K,{justify:"end",size:16},{default:n(()=>[a(o(D),{onClick:F},{default:n(()=>[f(N(o($)("common.cancel")),1)]),_:1}),a(o(D),{type:"primary",onClick:m},{default:n(()=>[f(N(o($)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(W,{class:"pr-20px"},{default:n(()=>[a(B,{ref_key:"formRef",ref:A,model:t,rules:p,"label-placement":"left","label-width":120},{default:n(()=>[a(_,{responsive:"screen","item-responsive":""},{default:n(()=>[a(i,{span:"24 m:12",label:"项目列表",path:"pid"},{default:n(()=>[a(o(de),{clearable:"",filterable:"",value:t.pid,"onUpdate:value":[e[0]||(e[0]=s=>t.pid=s),V],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:E,options:c.value,onScroll:M},null,8,["value","options"])]),_:1}),a(i,{span:"24 m:12",label:"影响的业务",path:"affectedbusiness"},{default:n(()=>[a(o(C),{value:t.affectedbusiness,"onUpdate:value":e[1]||(e[1]=s=>t.affectedbusiness=s),placeholder:"请输入"},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"设备名称",path:"devname"},{default:n(()=>[a(o(C),{value:t.devname,"onUpdate:value":e[2]||(e[2]=s=>t.devname=s),placeholder:"请输入"},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"接口文档",path:"apidocument"},{default:n(()=>[a(o(C),{value:t.apidocument,"onUpdate:value":e[3]||(e[3]=s=>t.apidocument=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"研发对接人",path:"uid"},{default:n(()=>[a(o(C),{value:t.uid,"onUpdate:value":e[4]||(e[4]=s=>t.uid=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"研发周期",path:"period"},{default:n(()=>[a(o(C),{value:t.period,"onUpdate:value":e[5]||(e[5]=s=>t.period=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"备注",path:"notes"},{default:n(()=>[a(o(C),{value:t.notes,"onUpdate:value":e[6]||(e[6]=s=>t.notes=s),placeholder:"请输入"},null,8,["value"])]),_:1}),a(i,{span:"24 m:24",label:"附件1",path:"notes"},{default:n(()=>{var s;return[a(o(C),{value:t.re1,"onUpdate:value":e[7]||(e[7]=r=>t.re1=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl1?(b(),H("span",Le,[f(N((s=t.fl1)==null?void 0:s.split("?")[1])+" ",1),U("span",{class:"cursor-pointer c-#c92a2a",onClick:e[8]||(e[8]=r=>t.fl1="")},"删除"),U("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[9]||(e[9]=r=>z(t.fl1))},"下载")])):(b(),T(u,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>P(r,"fl1"),"show-file-list":!1},{default:n(()=>[a(o(D),{size:"small",ghost:"",type:"primary"},{default:n(()=>e[20]||(e[20]=[f("选择文件")])),_:1,__:[20]})]),_:1},8,["custom-request"]))]}),_:1}),a(i,{span:"24 m:24",label:"附件2",path:"notes"},{default:n(()=>{var s;return[a(o(C),{value:t.re2,"onUpdate:value":e[10]||(e[10]=r=>t.re2=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl2?(b(),H("span",Ie,[f(N((s=t.fl2)==null?void 0:s.split("?")[1])+" ",1),U("span",{class:"cursor-pointer c-#c92a2a",onClick:e[11]||(e[11]=r=>t.fl2="")},"删除"),U("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[12]||(e[12]=r=>z(t.fl2))},"下载")])):(b(),T(u,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>P(r,"fl2"),"show-file-list":!1},{default:n(()=>[a(o(D),{size:"small",ghost:"",type:"primary"},{default:n(()=>e[21]||(e[21]=[f("选择文件")])),_:1,__:[21]})]),_:1},8,["custom-request"]))]}),_:1}),a(i,{span:"24 m:24",label:"附件3",path:"notes"},{default:n(()=>{var s;return[a(o(C),{value:t.re3,"onUpdate:value":e[13]||(e[13]=r=>t.re3=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl3?(b(),H("span",Me,[f(N((s=t.fl3)==null?void 0:s.split("?")[1])+" ",1),U("span",{class:"cursor-pointer c-#c92a2a",onClick:e[14]||(e[14]=r=>t.fl3="")},"删除"),U("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[15]||(e[15]=r=>z(t.fl3))},"下载")])):(b(),T(u,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>P(r,"fl3"),"show-file-list":!1},{default:n(()=>[a(o(D),{size:"small",ghost:"",type:"primary"},{default:n(()=>e[22]||(e[22]=[f("选择文件")])),_:1,__:[22]})]),_:1},8,["custom-request"]))]}),_:1}),a(i,{span:"24 m:24",label:"附件4",path:"notes"},{default:n(()=>{var s;return[a(o(C),{value:t.re4,"onUpdate:value":e[16]||(e[16]=r=>t.re4=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl4?(b(),H("span",Oe,[f(N((s=t.fl4)==null?void 0:s.split("?")[1])+" ",1),U("span",{class:"cursor-pointer c-#c92a2a",onClick:e[17]||(e[17]=r=>t.fl4="")},"删除"),U("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[18]||(e[18]=r=>z(t.fl4))},"下载")])):(b(),T(u,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>P(r,"fl4"),"show-file-list":!1},{default:n(()=>[a(o(D),{size:"small",ghost:"",type:"primary"},{default:n(()=>e[23]||(e[23]=[f("选择文件")])),_:1,__:[23]})]),_:1},8,["custom-request"]))]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ve=ee({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Y(["reset","search","clear"],["update:model"]),setup(S,{emit:I}){const w=I,{formRef:q,restoreValidation:v}=se(),t=ie(S,"model"),k=oe(),c=Z([]),{pageData:g,getData:y,nextPage:R}=ce(pe),M=async p=>{const d=p.currentTarget;d.scrollTop+d.offsetHeight>=d.scrollHeight&&g.data.length<g.total&&(R(),c.value=g.data)},O=async p=>{var d;p?(t.value.pid=p,w("search"),k.setProjectInfo({pname:(d=c.value.find(h=>h.id==p))==null?void 0:d.proname,pid:p})):w("clear")},E=async p=>{await y({fuzzy:p,page:1}),c.value=g.data},V=async()=>{await y({page:1}),c.value=g.data};(async()=>{var p,d;await y({fuzzy:k.userInfo.pname}),c.value=g.data,t.value.pid=k.userInfo.pid?k.userInfo.pid:(p=c.value[0])==null?void 0:p.id,k.setProjectInfo({pid:t.value.pid,pname:(d=c.value.find(h=>h.id==t.value.pid))==null?void 0:d.proname}),w("search")})();async function A(){await v(),t.value.fuzzy="",w("reset")}const G=()=>{t.value.fuzzy="",w("search")};async function L(){var p,d;t.value.pid?w("search"):((p=window.$message)==null||p.destroyAll(),(d=window.$message)==null||d.warning("请选择项目"))}return(p,d)=>{const h=de,z=fe,P=C,F=Be,m=D,l=Fe,e=te,i=me,u=re,_=ue;return b(),T(_,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(u,{ref_key:"formRef",ref:q,model:t.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ne(L,["enter"])},{default:n(()=>[a(i,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:n(()=>[a(z,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:n(()=>[a(h,{filterable:"",clearable:"",value:t.value.pid,"onUpdate:value":[d[0]||(d[0]=B=>t.value.pid=B),O],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:c.value,onScroll:M,onClear:V,onSearch:E},null,8,["value","options"])]),_:1}),a(z,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:n(()=>[a(P,{value:t.value.fuzzy,"onUpdate:value":d[1]||(d[1]=B=>t.value.fuzzy=B),placeholder:"请输入",clearable:"",onClear:G},null,8,["value"])]),_:1}),a(z,{span:"24  s:12 m:6",class:"pr-24px"},{default:n(()=>[a(e,{class:"w-full"},{default:n(()=>[a(m,{onClick:A},{icon:n(()=>[a(F,{class:"text-icon"})]),default:n(()=>[f(" "+N(o($)("common.reset")),1)]),_:1}),a(m,{type:"primary",ghost:"",onClick:L},{icon:n(()=>[a(l,{class:"text-icon"})]),default:n(()=>[f(" "+N(o($)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ae={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ne(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!$e(S)}const at=ee({name:"projectmanagement_need",__name:"index",setup(S){const I=Se(),{columns:w,columnChecks:q,data:v,getData:t,loading:k,pagination:c,mobilePagination:g,searchParams:y}=qe({showTotal:!0,immediate:!1,apiFn:Te,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"affectedbusiness",title:"影响的业务",align:"center",width:120},{key:"devname",title:"设备名称",align:"center",width:120},{key:"apidocument",title:"接口文档",align:"center",width:120},{key:"uid",title:"研发对接人",align:"center",width:120},{key:"period",title:"研发周期",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"操作人",align:"center",width:120},{key:"dbtime",title:"操作时间",align:"center",width:120},{key:"operate",title:$("common.operate"),align:"center",width:140,fixed:"right",render:m=>{let l;return a("div",{class:"flex-center gap-8px"},[Q(a(D,{type:"primary",ghost:!0,size:"small",onClick:()=>d(m.id)},ne(l=$("common.edit"))?l:{default:()=>[l]}),[[X("no-auth"),"project:Development:update"]]),a(le,{onPositiveClick:()=>p(m.id)},{default:()=>$("common.confirmDelete"),trigger:()=>{let e;return Q(a(D,{type:"error",ghost:!0,size:"small"},ne(e=$("common.delete"))?e:{default:()=>[e]}),[[X("no-auth"),"project:Development:delete"]])}})])}}]}),{drawerVisible:R,operateType:M,editingData:O,handleAdd:E,handleEdit:V,checkedRowKeys:j,onBatchDeleted:A,onDeleted:G}=Re(v,t);je(async()=>{});async function L(){console.log(j.value),h(j.value.join(","),m=>{A()})}async function p(m){const{data:l,error:e}=await ae(m,y.pid);e||G()}function d(m){V(m)}async function h(m,l){const{data:e,error:i}=await ae(m,y.pid);if(!i)l&&l(e);else return!1}const z=m=>{t()},P=()=>{v.value=[],c.itemCount=0},F=()=>{t()};return(m,l)=>{const e=te,i=ve,u=_e,_=ge,B=Ue,W=ue,K=X("no-auth");return b(),H("div",Ae,[a(Ve,{model:o(y),"onUpdate:model":l[0]||(l[0]=x=>J(y)?y.value=x:null),onReset:F,onSearch:o(t),onClear:P},null,8,["model","onSearch"]),a(W,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[a(e,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:n(()=>l[4]||(l[4]=[U("div",null,"需要开发",-1)])),_:1,__:[4]})]),"header-extra":n(()=>[a(e,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[Q((b(),T(o(D),{onClick:o(E),size:"small",ghost:"",type:"primary"},{icon:n(()=>[a(i,{class:"text-icon"})]),default:n(()=>[l[5]||(l[5]=f(" "+N("新增")))]),_:1,__:[5]},8,["onClick"])),[[K,"project:Development:insert"]]),a(o(le),{onPositiveClick:L},{trigger:n(()=>[Q((b(),T(o(D),{size:"small",ghost:"",type:"error",disabled:o(j).length==0},{icon:n(()=>[a(u,{class:Pe(["text-icon",{"animate-spin":o(k)}])},null,8,["class"])]),default:n(()=>[l[6]||(l[6]=f(" "+N("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[K,"project:Development:delete"]])]),default:n(()=>[l[7]||(l[7]=f(" 确定要删除选中的吗？ "))]),_:1,__:[7]}),a(_,{columns:o(q),"onUpdate:columns":l[1]||(l[1]=x=>J(q)?q.value=x:null)},null,8,["columns"])]),_:1})]),default:n(()=>[a(B,{"checked-row-keys":o(j),"onUpdate:checkedRowKeys":l[2]||(l[2]=x=>J(j)?j.value=x:null),columns:o(w),data:o(v),size:"small","flex-height":!o(I).isMobile,loading:o(k),remote:"","row-key":x=>x.id,pagination:o(g),class:"sm:h-full","onUpdate:filters":z},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Ee,{visible:o(R),"onUpdate:visible":l[3]||(l[3]=x=>J(R)?R.value=x:null),onSubmitted:o(t),pid:o(y).pid,"operate-type":o(M),"row-data":o(O)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{at as default};
