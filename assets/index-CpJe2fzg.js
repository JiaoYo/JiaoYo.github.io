import{_ as ln}from"./correct-DcFHk5q1.js";import{_ as Gl,a as Wl,V as an,b as nn,c as sn,d as on,e as rn,f as dn,g as un}from"./index-8bI3mYwl.js";import{_ as ya}from"./round-plus-ozcWEIQ7.js";import{_ as cn}from"./round-search-BEVIxLnz.js";import{R as Ct,b as k,o as u,e as g,d as Tt,z as Mt,s as h,au as Vt,i as Kl,aK as Yl,F as pt,aP as Re,f as a,I as ze,c as T,w as s,g as v,h as p,B as _,a3 as pn,bN as fn,a$ as Pt,dj as gn,a2 as Ql,G as C,t as U,aM as It,a7 as kt,J as Ve,b3 as ha,H as ie,L as ba,da as wt,aE as yt,W as Sl,ax as tt,a4 as sl,M as _a,N as wl,aA as kl,az as nl,$ as Q,aN as mn,dk as vn,n as l,aG as $t,dl as yn,dm as hn,dn as bn,aJ as xa,cZ as Xl,av as Cl,A as _n,a as xn,at as ka,ay as Ne,aD as Zl,K as Ol,a5 as xt,aS as it,cy as Ca,cB as Rl,aT as La,cD as Jl,cG as Sa,bg as wa,cQ as $a,c$ as Da,D as st,aH as kn,dp as da,dq as Cn,dr as Ln,S as Sn,d4 as wn,ds as $n,dt as Dn,du as zn,dv as jn,dw as Un,X as Bn,Y as Fn,cL as In,cJ as Pn,cK as Tn,dx as At,d1 as Nn,d0 as En,c_ as ua,cH as An,cI as Vn,cE as ca,cF as pa,dd as Mn,de as qn,db as On,dc as Rn,dh as Jn,di as Hn,df as Gn,dg as Wn,dy as Kn,dz as fa,dA as Yn,dB as Qn,dC as Xn,bo as Zn,bq as es,dD as ts,aO as ls,dE as as,dF as ns,cC as ss,aR as is}from"./index-9Ko_9_TI.js";import{u as ft}from"./usePageData-BWaYhHgw.js";import{f as za,b as os,_ as ja,c as rs,a as ds,e as us,d as cs}from"./drawerLog-BBU0PvSn.js";import{N as Ge}from"./Popconfirm-Cg-J5jDB.js";import{_ as ga,a as ps}from"./text-DaVxhp6G.js";import{h as Ae}from"./permission-BBIMTKq7.js";import{u as fs}from"./table-BtCxAkgO.js";import{_ as Ll}from"./DatePicker-DdutLwK7.js";import{N as Hl}from"./Cascader-HOtqP2Oc.js";import{_ as gs}from"./round-delete-BXSVg0cc.js";import{a as ms,_ as vs,A as ys}from"./index-C47jeqCT.js";import{p as ma,f as va}from"./business-BXzaRcWh.js";import{_ as hs,a as bs}from"./DescriptionsItem-BE-EQXL2.js";import{_ as Ua,a as _s}from"./Grid-C4COR-OK.js";import{_ as xs,d as ks}from"./drawerLog-De7LKzHa.js";import{l as Cs}from"./lookdebuggingSheetModal-SD4RtMfK.js";import{f as Ls}from"./mojicb-BbpRrXvS.js";import{_ as Ss}from"./FormItemGridItem-BlsYHznD.js";import{N as ws}from"./Table-_gSZmIRl.js";const $s={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ds(_e,P){return u(),k("svg",$s,P[0]||(P[0]=[g("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H5.2L4 17.2V4h16zm-3-5h-2V9h2m-4 2h-2V9h2m-4 2H7V9h2"},null,-1)]))}const zs=Ct({name:"mdi-message-processing-outline",render:Ds}),js={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Us(_e,P){return u(),k("svg",js,P[0]||(P[0]=[g("path",{fill:"currentColor",d:"m12 10.8l-4.6 4.6L6 14l6-6l6 6l-1.4 1.4z"},null,-1)]))}const Bs=Ct({name:"material-symbols-keyboard-arrow-up",render:Us}),Fs={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Is(_e,P){return u(),k("svg",Fs,P[0]||(P[0]=[g("path",{fill:"currentColor",d:"M12 14.975q-.2 0-.375-.062T11.3 14.7l-4.6-4.6q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l3.9 3.9l3.9-3.9q.275-.275.7-.275t.7.275t.275.7t-.275.7l-4.6 4.6q-.15.15-.325.213t-.375.062"},null,-1)]))}const Ps=Ct({name:"material-symbols-keyboard-arrow-down-rounded",render:Is}),Ts={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ns(_e,P){return u(),k("svg",Ts,P[0]||(P[0]=[g("path",{fill:"currentColor",d:"M3 21v-4.25L16.2 3.575q.3-.275.663-.425t.762-.15t.775.15t.65.45L20.425 5q.3.275.438.65T21 6.4q0 .4-.137.763t-.438.662L7.25 21zM17.6 7.8L19 6.4L17.6 5l-1.4 1.4z"},null,-1)]))}const Es=Ct({name:"material-symbols-edit",render:Ns}),As={class:"flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto h-100%"},Vs={style:{display:"flex","flex-direction":"column","justify-content":"space-between",gap:"16px",height:"100%"}},Ms={key:1},qs={class:"flex items-center justify-between"},Os={class:"flex items-center"},Rs={class:"font-size-16px font-bold"},Js={class:"font-size-12px c-#868e96"},Hs={key:0},Gs={class:"font-size-12px c-#a19f9d my-5px"},Ws={key:1,class:"mt-1 flex items-center justify-between gap-3 text-sm text-gray-500"},Ks=["onClick"],Ys={key:0,class:"mt-4 border-t pt-3"},Qs={class:"flex items-start gap-2 mb-3"},Xs={class:"ml-2 flex-1"},Zs={class:"flex justify-between items-center"},ei={class:"font-medium mr-20px"},ti={class:"text-gray-600 mt-1"},li={style:{display:"flex","justify-content":"flex-end"}},ai=Tt({__name:"dayLog",props:{pid:{},pname:{}},setup(_e){const P=Mt(),ue=_e,oe=h([]);Vt(()=>ue.pid,M=>{M&&we()});const w=h({page:1,limit:10,total:0}),we=async()=>{const{data:M,error:S}=await za({pid:ue.pid,page:w.value.page,limit:w.value.limit});M&&(w.value.total=M.total,oe.value=M.list.map(re=>(re.showCommentSection=!1,re.showAll=!1,re)))},ne=M=>{w.value.page=M,we()},r=M=>{w.value.limit=M,we()};Kl(()=>{we()});const H=h("add"),ce=h({}),Ie=h(!1),Me=()=>{Ie.value=!0,H.value="add"},pe=M=>{Ie.value=!0,H.value="edit",ce.value=M},qe=async M=>{var ke;const{data:S,error:re}=await ds(M.id);S&&((ke=window.$message)==null||ke.success("删除成功"),oe.value.length===1&&w.value.page>1&&w.value.page--,we())},xe=M=>{oe.value.forEach(S=>{S.id!==M.id&&(S.showAll=!1)}),M.showAll=!M.showAll};async function je(M,S=8,re=30){var he;await yt();for(let $e=0;$e<S;$e++){const me=document.querySelector(`#${M} textarea`);if(me&&typeof me.focus=="function"){me.focus();const X=me.value;if(X&&me.setSelectionRange){const Z=X.length;me.setSelectionRange(Z,Z)}return!0}await new Promise(X=>setTimeout(X,re))}const ke=document.getElementById(M);return ke&&(ke.tabIndex=-1,(he=ke.focus)==null||he.call(ke)),!1}const We=async M=>{oe.value.forEach(S=>{S.id!==M.id&&(S.showCommentSection=!1)}),M.showCommentSection=!M.showCommentSection,M.showCommentSection&&await je(`comment-input-${M.id}`),Le(M)},Le=async M=>{const{data:S,error:re}=await rs({page:1,limit:100,pid:M.id});S&&(M.comments=S.list)},Ce=h({}),le=Yl.debounce(async M=>{var he;const S=Ce.value[M.id];if(!(S!=null&&S.trim()))return(he=window.$message)==null?void 0:he.warning("请输入评论内容");const{data:re,error:ke}=await os([{pid:M.id,context:S}]);re&&(Le(M),M.num++,Ce.value[M.id]="")},1e3,{leading:!0,trailing:!1}),Ue=async(M,S)=>{var he;const{data:re,error:ke}=await us(M.id);re&&(Le(S),S.num--,(he=window.$message)==null||he.success("删除成功"))};return(M,S)=>{const re=Es,ke=Ps,he=Bs,$e=zs,me=Ge,X=Ve,Z=gn,Ke=pt("no-auth");return u(),k(Re,null,[g("div",As,[ze((u(),T(p(_),{type:"primary",onClick:Me},{icon:s(()=>[a(re)]),default:s(()=>[S[3]||(S[3]=v(" 写日报"))]),_:1,__:[3]})),[[Ke,"project:DailyReport:insert"]]),g("div",Vs,[a(p(pn),{style:{height:"calc(100vh - 181px)"}},{default:s(()=>[oe.value.length?(u(),k("div",Ms,[(u(!0),k(Re,null,Pt(oe.value,N=>(u(),T(p(Ql),{key:N.id,class:"mb-4",title:"",size:"small"},{default:s(()=>[g("div",qs,[g("div",Os,[N.showAll?(u(),T(ke,{key:0,class:"font-size-20px mr-10px cursor-pointer",onClick:I=>xe(N)},null,8,["onClick"])):(u(),T(he,{key:1,class:"font-size-20px mr-10px cursor-pointer",onClick:I=>xe(N)},null,8,["onClick"])),g("span",Rs,U(N.username)+"的日报",1)]),g("span",Js,U(N.dbtime),1)]),N.showAll?(u(),k("div",Hs,[S[4]||(S[4]=g("div",{class:"font-size-14px font-bold"},"项目名称",-1)),g("div",{class:It(["preview-text",{textstyle:JSON.parse(N.context).proname}])},U(JSON.parse(N.context).proname),3),S[5]||(S[5]=g("div",{class:"font-size-14px font-bold"},"当前工作内容及成果描述",-1)),g("div",{class:It(["preview-text",{textstyle:JSON.parse(N.context).notes}])},U(JSON.parse(N.context).notes),3),S[6]||(S[6]=g("div",{class:"font-size-14px font-bold"},"遇到问题",-1)),g("div",{class:It(["preview-text",{textstyle:JSON.parse(N.context).problem}])},U(JSON.parse(N.context).problem),3),S[7]||(S[7]=g("div",{class:"font-size-14px font-bold"},"解决措施",-1)),g("div",{class:It(["preview-text",{textstyle:JSON.parse(N.context).solutions}])},U(JSON.parse(N.context).solutions),3),S[8]||(S[8]=g("div",{class:"font-size-14px font-bold"},"建议意见反馈",-1)),g("div",{class:It(["preview-text",{textstyle:JSON.parse(N.context).feedback}])},U(JSON.parse(N.context).feedback),3),S[9]||(S[9]=g("div",{class:"font-size-14px font-bold"},"（总结）自己对一天工作的感受和体感",-1)),g("div",{class:It(["preview-text",{textstyle:JSON.parse(N.context).summarize}])},U(JSON.parse(N.context).summarize),3)])):C("",!0),g("div",Gs,"字符数："+U(N.charctras),1),N.showAll?(u(),k("div",Ws,[g("span",{class:"cursor-pointer hover:text-blue-500",style:kt({color:N.showCommentSection?"#1890ff":""}),onClick:I=>We(N)},[a($e,{class:"font-size-18px"}),v(U(N.num==0?"":N.num),1)],12,Ks),p(P).userInfo.id==N.creater?(u(),T(X,{key:0},{default:s(()=>[a(p(_),{quaternary:"",type:"info",size:"small",onClick:I=>pe(N)},{default:s(()=>S[10]||(S[10]=[v(" 编辑 ")])),_:2,__:[10]},1032,["onClick"]),a(me,{onPositiveClick:I=>qe(N)},{trigger:s(()=>[a(p(_),{quaternary:"",type:"error",size:"small"},{default:s(()=>S[11]||(S[11]=[v(" 删除 ")])),_:1,__:[11]})]),default:s(()=>[S[12]||(S[12]=v(" 确定删除吗？ "))]),_:2,__:[12]},1032,["onPositiveClick"])]),_:2},1024)):C("",!0)])):C("",!0),a(ha,{name:"fade"},{default:s(()=>[N.showCommentSection?(u(),k("div",Ys,[g("div",Qs,[g("div",null,[a(p(ga),{size:"small",src:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"})]),a(p(ie),{type:"textarea",id:`comment-input-${N.id}`,value:Ce.value[N.id],"onUpdate:value":I=>Ce.value[N.id]=I,placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ba(wt(I=>p(le)(N),["exact","prevent"]),["enter"])},null,8,["id","value","onUpdate:value","onKeydown"]),a(p(_),{type:"primary",ghost:"",onClick:I=>p(le)(N)},{default:s(()=>S[13]||(S[13]=[v("发送")])),_:2,__:[13]},1032,["onClick"])]),(u(!0),k(Re,null,Pt(N.comments,I=>(u(),k("div",{key:I.id,class:"flex mb-3"},[a(p(ga),{size:"small",src:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"}),g("div",Xs,[g("div",Zs,[g("div",null,[g("span",ei,U(I.username),1),a(p(ps),{depth:"3",style:{"font-size":"12px"}},{default:s(()=>[v(U(I.dbtime),1)]),_:2},1024),p(P).userInfo.id==I.creater?(u(),T(me,{key:0,onPositiveClick:Je=>Ue(I,N)},{trigger:s(()=>[a(p(_),{quaternary:"",type:"error",size:"small"},{default:s(()=>S[14]||(S[14]=[v(" 删除 ")])),_:1,__:[14]})]),default:s(()=>[S[15]||(S[15]=v(" 确定删除吗？ "))]),_:2,__:[15]},1032,["onPositiveClick"])):C("",!0),g("div",ti,U(I.context),1)])])])]))),128))])):C("",!0)]),_:2},1024)]),_:2},1024))),128))])):(u(),T(p(fn),{key:0,description:"暂无日志"}))]),_:1}),g("div",li,[a(Z,{page:w.value.page,"onUpdate:page":[S[0]||(S[0]=N=>w.value.page=N),ne],"page-size":w.value.limit,"onUpdate:pageSize":[S[1]||(S[1]=N=>w.value.limit=N),r],"item-count":w.value.total,"show-size-picker":"","page-sizes":[10,20,50],prefix:()=>`共 ${w.value.total} 条记录`},null,8,["page","page-size","item-count","prefix"])])])]),a(ja,{visible:Ie.value,"onUpdate:visible":S[2]||(S[2]=N=>Ie.value=N),onSubmitted:we,"operate-type":H.value,pname:ue.pname,pid:ue.pid,"row-data":ce.value},null,8,["visible","operate-type","pname","pid","row-data"])],64)}}}),ni=Sl(ai,[["__scopeId","data-v-3f32dd5a"]]),si={class:"flex items-center justify-between"},ii={class:"flex items-center"},oi={style:{margin:"10px 0","font-weight":"bolder",width:"140px"}},ri={key:0,class:"font-size-12px c-#ffa502 ml-10px"},di={key:0},ui={style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},ci={key:0},pi={style:{display:"flex","justify-content":"space-between"}},fi={key:0,class:"preview-content"},gi=["src"],mi={key:4},vi=["src"],yi=Tt({__name:"fileList",props:{pid:{},data:{},fileType:{},typename:{}},emits:["getData"],setup(_e,{emit:P}){const ue=_e,oe=Mt(),w=P,we=[{title:"文件别名",key:"name",align:"center",width:200,ellipsis:{tooltip:!0}},{title:"文件名称",key:"filename",align:"center",width:200,ellipsis:{tooltip:!0}},{title:"上传人",key:"creator",align:"center",width:100},{title:"上传时间",key:"dbtime",align:"center",width:200},{title:"操作",key:"actions",align:"center",width:180,render(m,b){return l(Ve,{justify:"center"},[l(_,{type:"info",size:"small",ghost:!0,onClick:()=>{ke(m)}},{default:()=>"查看"}),l(_,{type:"info",size:"small",ghost:!0,onClick:()=>{xe(m)}},{default:()=>"下载"}),Ae("project:File:update")&&l(_,{type:"info",size:"small",ghost:!0,onClick:()=>{X(m)}},{default:()=>"编辑"}),Ae("project:File:delete")&&(oe.userInfo.usertype==0||oe.userInfo.usertype==2)&&l(Ge,{onPositiveClick:async()=>{var $;if(m.id){const{data:R,error:G}=await hn(m.url),{data:d,error:y}=await bn(m.id);y||(($=window.$message)==null||$.success("删除成功"),w("getData"))}}},{default:()=>Q("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>Q("common.delete")})})])}}];async function ne(m){var b;return m.file.file.size>100*1024*1024?((b=window.$message)==null||b.error("文件大小不能超过100M"),!1):!0}const r=h(!1),H=h(null),ce=h({fileName:"",file:null,id:void 0}),Ie={fileName:[{required:!0,message:"请输入文件别名",trigger:["blur","change"]}]},Me=h(0),pe=()=>{I.value=[],r.value=!0,Me.value=0,ce.value.id=void 0,ce.value.fileName="",ce.value.file=null},qe=async()=>{var m,b,$,R;try{if(await((m=H.value)==null?void 0:m.validate()),ce.value.id){const{data:G,error:d}=await vn([{id:ce.value.id,filename:ce.value.fileName}]);if(d)return(b=window.$message)==null?void 0:b.error("保存文件记录失败");($=window.$message)==null||$.destroyAll(),(R=window.$message)==null||R.success("编辑成功"),w("getData"),me.value=!1;return}}catch{me.value=!1}};async function xe(m){if(m!=null&&m.url)try{const $=await(await fetch(m.url,{mode:"cors"})).blob(),R=URL.createObjectURL($),G=document.createElement("a");G.href=R,G.download=m.filename,G.style.display="none",document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(R)}catch(b){console.error("下载失败:",b)}}const je=()=>{console.log("渲染完成")},We=m=>{console.log(m,"渲染失败")},Le=h(!1),Ce=h(""),le=h([]),Ue=h(""),M=h("预览文件"),S=h(!1),re=h(0),ke=m=>{var $,R;if(!(m!=null&&m.url))return;const b=($=m.filename.split(".").pop())==null?void 0:$.toLowerCase();if(Ce.value=m.url,M.value=m.filename,["xls","xlsx"].includes(b))Ue.value="xls";else if(["doc","docx"].includes(b))Ue.value="doc";else if(["pdf"].includes(b))Ue.value="pdf";else if(["png","jpg","jpeg","gif","bmp"].includes(b)){Ue.value="img",le.value=ue.data.map(d=>{var y;return["png","jpg","jpeg","gif","bmp"].includes((y=d.filename.split(".").pop())==null?void 0:y.toLowerCase())?d.url:""}).filter(d=>d!=="");const G=le.value.findIndex(d=>d===m.url);re.value=G,S.value=!0;return}else if(["mp4","webm"].includes(b))Ue.value="mp4";else{(R=window.$message)==null||R.warning("暂不支持该文件类型预览");return}Le.value=!0},he=h(45),$e=()=>{he.value==45?he.value=350:he.value=45},me=h(!1);function X(m){ce.value.id=m.id,ce.value.fileName=m.name,me.value=!0}const Z=()=>{me.value=!1};function Ke(m){return m.replace(/\.[^/.]+$/,"")}const N=[{title:"文件名称",key:"filename",align:"center",render(m){if(!m.name){const b=async({file:R,onFinish:G,onError:d})=>{var y,x;try{m.status=!0;const q=await $t(R.file,R.name,"",W=>{m.progress=W});q&&(m.url=q,m.name=R.name,m.status=!1)}catch(q){console.error(q),(x=(y=window.$message)==null?void 0:y.error)==null||x.call(y,"文件上传出错"),m.status=!1}};async function $(R){var G;return R.file.file.size>100*1024*1024?((G=window.$message)==null||G.error("文件大小不能超过100M"),!1):!0}return l("div",{style:"display: flex; justify-content: center; align-items: center;"},[l(nl,{action:"#",showFileList:!1,customRequest:b,onBeforeUpload:$},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:m.status},{default:()=>"上传文件"})}),m.progress?l(kl,{type:"line",percentage:m.progress,indicatorPlacement:"inside",processing:!0}):null])}return l("div",{},m.name)}},{title:"文件别名",key:"filename",align:"center",render(m){return l(ie,{value:m.filename??Ke(m.name)??"",onUpdateValue:b=>{m.filename=b}})}},{title:"操作",key:"actions",align:"center",width:100,render(m){return l(Ve,{justify:"center"},[l(_,{type:"error",size:"small",ghost:!0,onClick:()=>{I.value=I.value.filter(b=>b!==m)}},{default:()=>"删除"})])}}],I=h([]),Je=h(0),lt=h(!1),c=async()=>{var b,$,R,G,d,y;if(I.value.length==0)return(b=window.$message)==null?void 0:b.warning("请选择文件");let m=!0;for(let x=0;x<I.value.length;x++){const q=I.value[x];if(!q.name){($=window.$message)==null||$.warning(`第${x+1}个文件的文件名称不能为空`),m=!1;break}if(!q.filename){(R=window.$message)==null||R.warning(`第${x+1}个文件的文件别名不能为空`),m=!1;break}}if(m){lt.value=!0;const x=I.value.length;for(let ee=0;ee<x;ee++){Je.value=ee;const J=I.value[ee];J.indexText=`${ee+1}/${x}`,J.progress=0,J.status="uploading";try{J.url=await $t(J.file,J.name,"",K=>{J.progress=K}),J.progress=100,J.status="done"}catch{J.status="error"}}const q=I.value.map(ee=>({file:ee.url,filename:ee.filename,pid:ue.pid,sort:ue.fileType})),{data:W,error:V}=await yn(q);if(V)return(G=window.$message)==null?void 0:G.error("保存文件记录失败");w("getData"),(d=window.$message)==null||d.destroyAll(),(y=window.$message)==null||y.success("上传成功"),r.value=!1,lt.value=!1}},L=()=>{r.value=!1};function E(m){m.fileList.forEach(b=>{b.filename||(b.filename=Ke(b.name))}),I.value=m.fileList}return(m,b)=>{const $=ya,R=Gl,G=Wl,d=wl,y=_a,x=sl,q=mn,W=pt("no-auth");return u(),k(Re,null,[g("div",si,[g("div",ii,[g("h2",oi,U(ue.typename),1),ze((u(),T(p(_),{size:"small",ghost:"",type:"primary",onClick:pe},{icon:s(()=>[a($,{class:"text-icon"})]),default:s(()=>[v(" 新增"+U(ue.typename),1)]),_:1})),[[W,"project:File:insert"]]),ue.fileType==4?(u(),k("span",ri,"照片数不少于6张")):C("",!0)]),ue.data.length>0?(u(),k("div",di,"共"+U(ue.data.length)+"条",1)):C("",!0)]),ue.data.length>0?(u(),T(p(tt),{key:0,columns:we,data:ue.data,size:"small","scroll-x":702,"row-key":V=>V.id,"max-height":he.value},null,8,["data","row-key","max-height"])):C("",!0),g("div",ui,[he.value==45&&ue.data.length>1?(u(),k("span",{key:0,onClick:$e},[b[7]||(b[7]=v(" 更多 ")),a(R,{class:"font-size-20px"})])):C("",!0),he.value==350&&ue.data.length>1?(u(),k("span",{key:1,onClick:$e},[b[8]||(b[8]=v(" 收起 ")),a(G,{class:"font-size-20px"})])):C("",!0)]),a(x,{show:me.value,"onUpdate:show":b[1]||(b[1]=V=>me.value=V),title:(ce.value.id?"编辑":"新增")+ue.typename,preset:"card",class:"w-700px"},{default:s(()=>[a(y,{ref_key:"formRef",ref:H,model:ce.value,rules:Ie,"label-width":"auto",style:{width:"100%"}},{default:s(()=>[a(d,{label:"文件别名",path:"fileName"},{default:s(()=>[a(p(ie),{value:ce.value.fileName,"onUpdate:value":b[0]||(b[0]=V=>ce.value.fileName=V),placeholder:"请输入"},null,8,["value"])]),_:1}),Me.value?(u(),T(p(kl),{key:0,type:"line",percentage:Me.value,color:Me.value==100?"#18a058":"#2080f0","indicator-placement":"inside",processing:""},null,8,["percentage","color"])):C("",!0),a(d,null,{default:s(()=>[a(p(Ve),{justify:"center",style:{width:"100%"}},{default:s(()=>[a(p(_),{type:"primary",onClick:qe},{default:s(()=>b[9]||(b[9]=[v(U("确认"))])),_:1,__:[9]}),a(p(_),{onClick:Z},{default:s(()=>b[10]||(b[10]=[v("取消")])),_:1,__:[10]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),a(x,{show:r.value,"onUpdate:show":b[3]||(b[3]=V=>r.value=V),title:(ce.value.id?"编辑":"新增")+ue.typename,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:s(()=>[a(p(Ve),{justify:"end"},{default:s(()=>[a(p(_),{size:"small",class:"mt-16px",onClick:L},{default:s(()=>[v(U(p(Q)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",size:"small",class:"mt-16px",onClick:c},{default:s(()=>[v(U(p(Q)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(p(nl),{ref:"uploadRef",action:void 0,class:"mb-10px","file-list":I.value,"onUpdate:fileList":b[2]||(b[2]=V=>I.value=V),onBeforeUpload:ne,multiple:!0,onChange:E,"show-file-list":!1},{default:s(()=>[a(p(_),{size:"small",ghost:"",type:"primary"},{default:s(()=>b[11]||(b[11]=[v("选择文件")])),_:1,__:[11]})]),_:1},8,["file-list"]),a(p(tt),{columns:N,"paginate-single-page":!1,data:I.value,"max-height":350},null,8,["data"]),I.value[Je.value]&&lt.value?(u(),k("div",ci,[g("div",pi,[g("span",null,U(I.value[Je.value].filename||I.value[Je.value].name),1),g("span",null,U(I.value[Je.value].indexText),1)]),a(p(kl),{percentage:I.value[Je.value].progress,status:I.value[Je.value].status==="error"?"error":"success","show-indicator":""},null,8,["percentage","status"])])):C("",!0)]),_:1},8,["show","title"]),a(x,{show:Le.value,"onUpdate:show":b[4]||(b[4]=V=>Le.value=V),title:M.value,preset:"card",style:{width:"80%"}},{default:s(()=>[Ue.value==="img"?(u(),k("div",fi,[g("img",{src:Ce.value,alt:"预览图片",style:{"max-width":"100%",height:"80vh"}},null,8,gi)])):C("",!0),Ue.value.includes("xls")?(u(),T(p(an),{key:1,options:{xls:!0,minColLength:0,minRowLength:0,widthOffset:20,heightOffset:5},src:Ce.value,style:{height:"80vh"},onRendered:je,onError:We},null,8,["src"])):C("",!0),Ue.value.includes("doc")?(u(),T(p(nn),{key:2,src:Ce.value,style:{height:"80vh"},onRendered:je,onError:We},null,8,["src"])):C("",!0),Ue.value.includes("pdf")?(u(),T(p(sn),{key:3,src:Ce.value,style:{height:"80vh"},onRendered:je,onError:We},null,8,["src"])):C("",!0),Ue.value.includes("mp4")?(u(),k("div",mi,[g("video",{src:Ce.value,controls:"",style:{width:"100%",height:"80vh"}},null,8,vi)])):C("",!0)]),_:1},8,["show","title"]),a(q,{show:S.value,"onUpdate:show":b[5]||(b[5]=V=>S.value=V),"src-list":le.value,current:re.value,"onUpdate:current":b[6]||(b[6]=V=>re.value=V)},null,8,["show","src-list","current"])],64)}}}),Ft=Sl(yi,[["__scopeId","data-v-762f8a82"]]),hi={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},bi=Tt({__name:"contractList",props:{id:{}},setup(_e){const P=_e,ue=xa(),{columns:oe,data:w,getData:we,loading:ne,mobilePagination:r,searchParams:H}=fs({showTotal:!0,apiFn:Xl,apiParams:{page:1,pageSize:20,limit:20,id:void 0,_t:new Date().getTime()},immediate:!1,columns:()=>[{key:"contractname",title:"合同名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"contractnum",title:"合同编号",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"businesscon",title:"商务负责人",align:"center",width:100,ellipsis:{tooltip:!0}},{key:"businessinfo",title:"商务联系方式",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"precautions",title:"注意事项",align:"center",width:100},{key:"username",title:"创建者",align:"center",width:100,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0}]});return Kl(async()=>{H.id=P.id,P.id&&we()}),(ce,Ie)=>{const Me=Ve,pe=tt,qe=Ql;return u(),k("div",hi,[a(qe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:s(()=>[a(Me,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:s(()=>Ie[0]||(Ie[0]=[g("div",null,"关联合同列表",-1)])),_:1,__:[0]})]),default:s(()=>[a(pe,{columns:p(oe),data:p(w),size:"small","flex-height":!p(ue).isMobile,"scroll-x":p(oe).reduce((xe,je)=>xe+(je.width||100),0),loading:p(ne),remote:"","row-key":xe=>xe.id,pagination:p(r),class:"h-400px"},null,8,["columns","data","flex-height","scroll-x","loading","row-key","pagination"])]),_:1})])}}}),_i=Tt({name:"businessModal",__name:"businessModal",props:Cl({pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Cl(["submitted"],["update:visible"]),setup(_e,{emit:P}){const ue=P,oe=Mt(),w=_e;async function we(){ce(),We(),Ue(),$e(),Z.value=[],X.value=!0,me.value=!0,I.value=[]}_n();const ne=xn(()=>"新增待调试业务"),r=ka(_e,"visible");Vt(r,()=>{r.value&&we()});const{pageData:H,getData:ce,nextPage:Ie}=ft(Ca),Me=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&H.data.length<H.total&&Ie()},{pageData:pe,getData:qe,nextPage:xe}=ft(Rl),je=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&pe.data.length<pe.total&&(xe(),pe.data=pe.data.map(x=>({...x,value:x.docker+"&id="+x.id})))},We=async()=>{await qe({pid:w.pid}),pe.data=pe.data.map(d=>({...d,value:d.docker+"&id="+d.id}))},{pageData:Le,getData:Ce,nextPage:le}=ft(La),Ue=async()=>{await Ce({usertypes:"2,3"})},M=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&Le.data.length<Le.total&&le()},{pageData:S,getData:re,nextPage:ke}=ft(Jl),he=async d=>{const y=d.currentTarget,x=y.scrollTop;y.scrollTop+y.offsetHeight>=y.scrollHeight&&H.data.length<H.total&&(await ke(),await yt(),setTimeout(()=>{y.scrollTop=x}))},$e=async()=>{await re({pid:w.pid})},me=h(!0),X=h(!0),Z=h([]),Ke=[{title:"权重",key:"dtype",width:180,align:"center",render(d,y){return d.setStatus?l(Ne,{value:d.dtype,filterable:!0,placeholder:"请选择权重",options:H.data,labelField:"tname",valueField:"id",onUpdateValue(x){var q;Z.value[y].dtype=Number(x)||0,Z.value[y].debugname=((q=H.data.find(W=>W.id==x))==null?void 0:q.tname)||""},onScroll(x){Me(x)}}):l("div",{},d.tname)}},{title:"业务名称",key:"debugname",width:180,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.debugname,placeholder:"请输入业务名称",onUpdateValue(x){Z.value[y].debugname=x}}):l("div",{},d.debugname)}},{title:"状态",key:"status",width:120,align:"center",render(d,y){return d.setStatus&&d.id?l(Ne,{value:d.status,filterable:!0,placeholder:"请选择状态",options:oe.userInfo.usertype==0||oe.userInfo.usertype==2?[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}],onUpdateValue(x){Z.value[y].status=Number(x)||0}}):l(Zl,{type:d.status==0?"info":d.status==1||d.status==2?"warning":"success"},d.status==0?"待调试":d.status==1?"开始调试":d.status==2?"待审核":"审核完成")}},{key:"eqmname",title:"调试设备",align:"center",width:150,render(d,y){return l(Ne,{value:d.eqmid,placeholder:"请选择调试设备",options:S.data,onscroll:he,labelField:"devname",valueField:"id",clearable:!0,filterable:!0,onUpdateValue(x){Z.value[y].eqmid=x}})}},{key:"docker",width:140,align:"center",title:()=>l("div",{style:"display:flex;align-items:center;justify-content:center;gap:6px;"},[l("span",null,"对接方"),l(Ol,{size:"small",checked:me.value,label:"联动",style:"margin-left: 10px;font-size: 12px;",onUpdateChecked:d=>{me.value=d}})]),render(d,y){var x;return d.setStatus?l(Ne,{value:d.docker,placeholder:"请输入或选择对接方",options:pe.data,onscroll:je,labelField:"docker",valueField:"value",clearable:!0,filterable:!0,tag:!0,onClear(){d.dockcharge="",d.dockcontact=""},onUpdateValue(q){var W;if(me.value)Z.value.forEach((V,ee)=>{var Be;V.docker=q;const[J,K]=(Be=d.docker)==null?void 0:Be.split("&id="),Pe=pe.data.find(B=>B.docker===J&&B.id===Number(K));Pe?(V.dockcharge=Pe.pname,V.dockcontact=Pe.pcontact):(V.dockcharge="",V.dockcontact="")});else{Z.value[y].docker=q;const[V,ee]=(W=d.docker)==null?void 0:W.split("&id="),J=pe.data.find(K=>K.docker===V&&K.id===Number(ee));J?(d.dockcharge=J.pname,d.dockcontact=J.pcontact):(d.dockcharge="",d.dockcontact="")}}}):l("div",{},(x=d.docker)==null?void 0:x.split("&id=")[0])}},{title:"对接方负责人",key:"dockcharge",width:100,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.dockcharge,placeholder:"请输入对接方负责人",onUpdateValue(x){Z.value[y].dockcharge=x}}):l("div",{},d.dockcharge)}},{title:"联系方式",key:"dockcontact",width:120,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.dockcontact,placeholder:"请输入联系方式",onUpdateValue(x){Z.value[y].dockcontact=x}}):l("div",{},d.dockcontact)}},{key:"dbcreater",width:140,align:"center",title:()=>l("div",{style:"display:flex;align-items:center;justify-content:center;gap:6px;"},[l("span",null,"调试人"),l(Ol,{size:"small",checked:X.value,label:"联动",style:"margin-left: 10px;font-size: 12px;",onUpdateChecked:d=>{X.value=d}})]),render(d,y){return d.setStatus?l(Ne,{value:d.dbcreater,filterable:!0,placeholder:"请选择调试人",options:Le.data,labelField:"username",valueField:"id",onUpdateValue(x){X.value?Z.value.forEach((q,W)=>{q.dbcreater=x||0}):Z.value[y].dbcreater=x||0},onScroll(x){M(x)}}):l("div",{},d.dbusername)}},{title:"文件",key:"re1",width:100,align:"center",render(d,y){return d.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>m(d,y)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const x=[{alias:d.re1,file:d.fl1},{alias:d.re2,file:d.fl2},{alias:d.re3,file:d.fl3},{alias:d.re4,file:d.fl4}].filter(q=>q.alias||q.file);return x.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件")])]),l("tbody",x.map(q=>{var W;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},q.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((W=q.file)==null?void 0:W.split("?")[1])||"-")])}))])])}})}},{title:"备注",key:"notes",width:200,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.notes,placeholder:"请输入备注",onUpdateValue(x){Z.value[y].notes=x}}):l("div",{},d.notes)}},{title:"计划开始时间",key:"starttime",width:200,align:"center",render(d,y){return d.setStatus?l(Ll,{type:"date",clearable:!0,value:d.starttime,valueFormat:"yyyy-MM-dd",placeholder:"请选择",onUpdateValue(x){Z.value[y].starttime=x}}):l("div",it(0,d.starttime))}},{title:"计划结束时间",key:"endtime",width:200,align:"center",render:(d,y)=>d.setStatus?l(Ll,{type:"date",clearable:!0,valueFormat:"yyyy-MM-dd",value:d.endtime,placeholder:"请选择",onUpdateValue(x){Z.value[y].endtime=x}}):it(0,d.endtime)},{key:"operate",title:Q("common.operate"),align:"center",width:120,fixed:"right",render(d,y){return l("div",{class:"flex-center gap-8px"},[l(Ge,{onPositiveClick:()=>{Z.value.splice(y,1),I.value.splice(y,1)}},{default:()=>Q("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>Q("common.delete")})})])}}];function N(){r.value=!1}const I=h([]),Je=d=>{Z.value=[],d.forEach(y=>{var x;Z.value.push({debugname:(x=H.data.find(q=>q.id==y))==null?void 0:x.tname,docker:void 0,dockcharge:"",dockcontact:"",debugresult:0,status:0,notes:"",dbcreater:void 0,dtype:y,setStatus:!0,pid:w.pid,starttime:null,endtime:null})})},lt=h(!1);async function c(){var x,q,W,V,ee,J,K,Pe;const d=["dtype","debugname","docker","dbcreater"];if(Z.value.find(Be=>d.some(B=>!Be[B]||Be[B].toString().trim()===""))){(q=(x=window.$message)==null?void 0:x.error)==null||q.call(x,"请完整填写所有必填项（权重、业务名称、对接方、调试人）");return}lt.value=!0;try{const Be=[];for(const z of Z.value){if(!Array.isArray(z.fileList)||z.fileList.length===0)continue;const O=z.fileList.filter(ve=>ve.file&&typeof ve.file=="object"),ae=O.length;for(let ve=0;ve<ae;ve++){const Y=O[ve];Y.indexText=`${ve+1}/${ae}`,Y.progress=0,Y.status="uploading";try{Y.url=await $t(Y.file.file||Y.file,Y.file.name||Y.name,""),Y.progress=100,Y.status="done"}catch{Y.status="error",Be.push(Y)}}z.fileList.forEach((ve,Y)=>{const Fe=`re${Y+1}`,He=`fl${Y+1}`;ve.status==="done"?(z[Fe]=ve.name||"",z[He]=ve.url||""):(z[Fe]="",z[He]="")}),delete z.fileList}if(Be.length){(V=(W=window.$message)==null?void 0:W.warning)==null||V.call(W,`有 ${Be.length} 个文件上传失败，可重新提交重试`);return}const B=Z.value.map(z=>{var O;return{...z,starttime:it(0,z.starttime),endtime:it(0,z.endtime),docker:(O=z.docker)==null?void 0:O.split("&id=")[0]}}),{error:o}=await Sa(B);o||((J=(ee=window.$message)==null?void 0:ee.success)==null||J.call(ee,"添加成功"),N(),ue("submitted"))}catch(Be){console.error(Be),(Pe=(K=window.$message)==null?void 0:K.error)==null||Pe.call(K,"提交失败，请稍后重试")}finally{lt.value=!1}}const L=h(!1),E=h(),m=(d,y)=>{L.value=!0,E.value=y,d.fileList&&d.fileList.length>0?$.value=d.fileList:$.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]},b=[{title:"",key:"",align:"center",width:80,render(d,y){return`附件${y+1}`}},{title:"文件名称",key:"filename",align:"center",render(d){var q;const y=async({file:W,onFinish:V,onError:ee})=>{var J,K;try{d.name=W.name,d.file=W}catch(Pe){console.error(Pe),(K=(J=window.$message)==null?void 0:J.error)==null||K.call(J,"文件上传出错")}};async function x(W){var V;return W.file.file.size>100*1024*1024?((V=window.$message)==null||V.error("文件大小不能超过100M"),!1):!0}return l("div",{style:"display:flex;justify-content:center;align-items:center;"},[d.file||d.url?l("span",{},[l("span",{},((q=d.file)==null?void 0:q.name)||d.url.split("?")[1]||""),l("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{d.url="",d.file=null}},"删除")]):l(nl,{action:"#",showFileList:!1,customRequest:y,onBeforeUpload:x},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:d.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(d){return l(ie,{value:d.name,clearable:!0,onUpdateValue:y=>{d.name=y}})}}],$=h([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]),R=async()=>{var y,x;let d=!0;if($.value.forEach((q,W)=>{var J,K;const V=q.name||"",ee=((J=q.url)==null?void 0:J.split("?")[1])||((K=q.file)==null?void 0:K.name);(V&&!ee||!V&&ee)&&(d=!1)}),!d){(x=(y=window.$message)==null?void 0:y.error)==null||x.call(y,"文件名称和文件地址必须同时存在，不能只填一个");return}Z.value[E.value].fileList=$.value,d&&(L.value=!1,E.value=void 0)},G=()=>{L.value=!1};return(d,y)=>{const x=wl,q=tt,W=sl,V=pt("loading");return u(),k(Re,null,[a(W,{show:r.value,"onUpdate:show":y[1]||(y[1]=ee=>r.value=ee),title:ne.value,preset:"card",class:"w-80%","mask-closable":!1,draggable:!0},{footer:s(()=>[a(p(Ve),{justify:"end",size:16},{default:s(()=>[a(p(_),{onClick:N},{default:s(()=>[v(U(p(Q)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",onClick:c},{default:s(()=>[v(U(p(Q)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(x,{label:"权重","label-placement":"left"},{default:s(()=>[a(p(Ne),{filterable:"",multiple:"",value:I.value,"onUpdate:value":[y[0]||(y[0]=ee=>I.value=ee),Je],tag:"",style:{width:"300px"},placeholder:"请选择权重","label-field":"tname","value-field":"id",options:p(H).data,onScroll:Me},null,8,["value","options"])]),_:1}),ze(a(q,{style:{width:"100%"},columns:Ke,data:Z.value,size:"small","row-key":ee=>ee.id,striped:"","scroll-x":Ke.reduce((ee,J)=>ee+J.width,0),"max-height":350},null,8,["data","row-key","scroll-x"]),[[V,lt.value]])]),_:1},8,["show","title"]),a(W,{show:L.value,"onUpdate:show":y[2]||(y[2]=ee=>L.value=ee),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:s(()=>y[3]||(y[3]=[v(" 待调试业务文件列表 ")])),footer:s(()=>[a(p(Ve),{justify:"end"},{default:s(()=>[a(p(_),{size:"small",class:"mt-16px",onClick:G},{default:s(()=>[v(U(p(Q)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",size:"small",class:"mt-16px",onClick:R},{default:s(()=>[v(U(p(Q)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(q,{columns:b,"paginate-single-page":!1,data:$.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])],64)}}}),xi=Tt({name:"deviceModal",__name:"deviceModal",props:Cl({pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Cl(["submitted"],["update:visible"]),setup(_e,{emit:P}){const ue=P;Mt();const oe=_e;async function w(){r(),Ce.value=[],le.value=[]}const we=ka(_e,"visible");Vt(we,()=>{we.value&&w()});const ne=h([]),r=async()=>{var E,m;const{data:c,error:L}=await Xl({page:1,limit:100,id:oe.pid});if(c){if(ne.value=c==null?void 0:c.list.map(b=>({value:b.id,label:b.contractname,isLeaf:!1})),ne.value.length==0)return(E=window.$message)==null?void 0:E.error("该项目没有绑定合同！");qe((m=c==null?void 0:c.list[0])==null?void 0:m.id)}},H=h([]),ce=h(),{pageData:Ie,getData:Me,nextPage:pe}=ft($a),qe=async c=>{await Me({pids:c}),ce.value=[],H.value=Array.from(new Set([...H.value,...Ie.data])),ce.value=Ie.data.map(L=>({label:L.devname,value:L.id}))},xe=async c=>{var L;await qe(c.value),c.children=(L=ce.value)==null?void 0:L.map(E=>({label:E.label,value:E.value,isLeaf:!0})),await yt(),setTimeout(()=>{const E=document.querySelectorAll(".n-cascader-submenu-wrapper .n-scrollbar");console.log(E[1]),E[1]&&(E[1].removeEventListener("scroll",me),E[1].addEventListener("scroll",me))},2e3)};function je(c,L){const E=c.filter(b=>!L.includes(b)),m=L.filter(b=>!c.includes(b));return{toDelete:E,toAdd:m}}const We=h([]),Le=async c=>{const{toDelete:L,toAdd:E}=je(We.value,c);L.forEach(m=>{const b=le.value.findIndex($=>$.cid==m);b!=-1&&le.value.splice(b,1)}),E.forEach(async m=>{var b,$,R,G,d,y,x,q,W,V,ee,J,K,Pe,Be,B;le.value.push({devname:(($=(b=H.value)==null?void 0:b.find(o=>o.id==m))==null?void 0:$.devname)||"",devmodel:((G=(R=H.value)==null?void 0:R.find(o=>o.id==m))==null?void 0:G.devmodel)||"",devnum:((y=(d=H.value)==null?void 0:d.find(o=>o.id==m))==null?void 0:y.devcount)||0,devmanu:((q=(x=H.value)==null?void 0:x.find(o=>o.id==m))==null?void 0:q.devmanu)||"",etype:((V=(W=H.value)==null?void 0:W.find(o=>o.id==m))==null?void 0:V.etype)||0,status:0,devunit:((J=(ee=H.value)==null?void 0:ee.find(o=>o.id==m))==null?void 0:J.devunit)||"",notes:((Pe=(K=H.value)==null?void 0:K.find(o=>o.id==m))==null?void 0:Pe.notes)||"",setStatus:!0,cid:m,pid:oe.pid,devnumber:((B=(Be=H.value)==null?void 0:Be.find(o=>o.id==m))==null?void 0:B.devcount)||0})}),We.value=c},Ce=h([]),le=h([]),Ue=[{title:"绑定合同设备",key:"cid",width:300,align:"center",render(c,L){var E,m;return c.setStatus?l(Hl,{style:"width: 270px",value:c.cid,filterable:!0,placeholder:"请选择合同设备",options:ne.value,checkStrategy:"child",showPath:!1,remote:!0,onLoad:xe,onUpdateValue(b){var R;le.value[L].cid=Number(b)||0;const $=(R=H.value)==null?void 0:R.find(G=>G.id==b);c.devname=($==null?void 0:$.devname)||"",c.devnum=($==null?void 0:$.devcount)||"",c.notes=($==null?void 0:$.notes)||"",c.devnumber=($==null?void 0:$.devcount)||0,c.etype=($==null?void 0:$.devtype)||0,c.devmanu=($==null?void 0:$.devmanu)||"",c.devmodel=(($==null?void 0:$.devmodel.length)>64?$==null?void 0:$.devname:$==null?void 0:$.devmodel)||"",c.devunit=($==null?void 0:$.devunit)||""}}):l("div",{},c.devname2||((m=(E=ce.value)==null?void 0:E.find(b=>b.value==c.cid))==null?void 0:m.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(c,L){return c.setStatus?l(ie,{value:c.devname,placeholder:"请输入",onUpdateValue(E){le.value[L].devname=E}}):l("div",{},c.devname)}},{title:"型号",key:"devmodel",width:220,align:"center",render(c,L){return l("div",{},c.devmodel)}},{title:"设备单位",key:"devunit",width:120,align:"center",render(c,L){return l("div",{},c.devunit)}},{title:"数量",key:"devnum",width:100,align:"center",render(c,L){return c.setStatus?l(wa,{value:c.devnum,placeholder:"请输入",max:c.devnumber,onUpdateValue(E){le.value[L].devnum=E}}):l("div",{},c.devnum)}},{title:"是否为我司设备",key:"etype",width:260,align:"center",render(c,L){return l("div",{},c.etype==0?"是":"否")}},{title:"设备厂家",key:"devmanu",width:200,align:"center",render(c,L){return l("div",{},c.devmanu)}},{title:"清点状态",key:"status",width:120,align:"center",render(c,L){return c.setStatus&&c.id?l(Ne,{value:c.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(E){le.value.debuggedDevieceList[L].status=Number(E)||0}}):l("div",{},c.status===0?"未清点":c.status===1?"正常":c.status===2?"增补":c.status===3?"退货":"换货")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(c,L){return l("div",{},c.devmanu)}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(c,L){return c.setStatus?l(ie,{value:c.manucontact,placeholder:"请输入",onUpdateValue(E){le.value[L].manucontact=E}}):l("div",{},c.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(c,L){return c.setStatus?l(ie,{value:c.manuinfo,placeholder:"请输入",onUpdateValue(E){le.value[L].manuinfo=E}}):l("div",{},c.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(c,L){return c.setStatus&&c.id?l(Ne,{value:c.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(E){le.value[L].devstatus=Number(E)||0}}):l("div",{},c.devstatus===0?"设备无异常":c.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(c,L){return c.setStatus?l(ie,{value:c.connectionmode,placeholder:"请输入",onUpdateValue(E){le.value[L].connectionmode=E}}):l("div",{},c.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(c,L){return c.setStatus&&c.id?l(Ne,{value:c.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(E){le.value[L].install=Number(E)||0}}):l("div",{},c.install===0?"是":"否")}},{title:"备注",key:"notes",width:200,align:"center",render(c,L){return l("div",{},c.notes)}},{title:"文件",key:"re1",width:160,align:"center",render(c,L){return c.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ke(c,L)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const E=[{alias:c.re1,file:c.fl1},{alias:c.re2,file:c.fl2},{alias:c.re3,file:c.fl3},{alias:c.re4,file:c.fl4}].filter(m=>m.alias||m.file);return E.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件")])]),l("tbody",E.map(m=>{var b;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},m.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((b=m.file)==null?void 0:b.split("?")[1])||"-")])}))])])}})}},{title:"操作信息",key:"dbtime",width:180,align:"center",render(c,L){return l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},c.dbtime?it(1,c.dbtime):""),default:()=>l("div",{style:"padding: 10px;"},a("div",null,[a("div",null,[v("操作人："),c.username]),a("div",null,[v("操作时间："),c.dbtime]),a("div",null,[v("清点人："),c.dusername]),a("div",null,[v("清点时间："),c.ddbtime])]))})}},{key:"operate",title:Q("common.operate"),align:"center",width:180,fixed:"right",render(c,L){return l("div",{class:"flex-center gap-8px"},[l(Ge,{onPositiveClick:()=>{c.id||(le.value.splice(L,1),Ce.value.splice(L,1))}},{default:()=>Q("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>Q("common.delete")})})])}}];function M(){we.value=!1}const S=h(!1);async function re(){var E,m,b,$,R,G,d,y;const c=["cid","devname","devnum"];if(le.value.find(x=>c.some(q=>!x[q]||x[q].toString().trim()===""))){(m=(E=window.$message)==null?void 0:E.error)==null||m.call(E,"请完整填写所有必填项（合同设备、设备名称、数量）");return}if(!S.value){S.value=!0;try{const x=[];for(const W of le.value){if(!Array.isArray(W.fileList)||W.fileList.length===0)continue;const V=W.fileList.filter(J=>J.file&&typeof J.file=="object"),ee=V.length;for(let J=0;J<ee;J++){const K=V[J];K.indexText=`${J+1}/${ee}`,K.progress=0,K.status="uploading";try{K.url=await $t(K.file.file||K.file,K.file.name||K.name,""),K.progress=100,K.status="done"}catch{K.status="error",x.push(K)}}W.fileList.forEach((J,K)=>{const Pe=`re${K+1}`,Be=`fl${K+1}`;J.status==="done"?(W[Pe]=J.name||"",W[Be]=J.url||""):(W[Pe]="",W[Be]="")}),delete W.fileList}if(x.length){($=(b=window.$message)==null?void 0:b.warning)==null||$.call(b,`有 ${x.length} 个文件上传失败，请重新提交`);return}const{error:q}=await Da(le.value);q||((G=(R=window.$message)==null?void 0:R.success)==null||G.call(R,"添加成功"),M(),ue("submitted"))}catch(x){console.error(x),(y=(d=window.$message)==null?void 0:d.error)==null||y.call(d,"提交失败，请稍后再试")}finally{S.value=!1}}}const ke=async c=>{},he=h(!1),$e=h(!0),me=async c=>{console.log(c);const L=c.target;L.scrollHeight-L.scrollTop-L.clientHeight<10&&!he.value&&$e.value&&(he.value=!0,pe(),ce.value=Ie.data.map(m=>({label:m.devname,value:m.id})),he.value=!1)},X=h(!1),Z=h(),Ke=(c,L)=>{X.value=!0,Z.value=L,c.fileList&&c.fileList.length>0?I.value=c.fileList:I.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]},N=[{title:"",key:"",align:"center",width:80,render(c,L){return`附件${L+1}`}},{title:"文件名称",key:"filename",align:"center",render(c){var m;const L=async({file:b,onFinish:$,onError:R})=>{var G,d;try{c.name=b.name,c.file=b}catch(y){console.error(y),(d=(G=window.$message)==null?void 0:G.error)==null||d.call(G,"文件上传出错")}};async function E(b){var $;return b.file.file.size>100*1024*1024?(($=window.$message)==null||$.error("文件大小不能超过100M"),!1):!0}return l("div",{style:"display:flex;justify-content:center;align-items:center;"},[c.file||c.url?l("span",{},[l("span",{},((m=c.file)==null?void 0:m.name)||c.url.split("?")[1]||""),l("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{c.url="",c.file=null}},"删除")]):l(nl,{action:"#",showFileList:!1,customRequest:L,onBeforeUpload:E},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:c.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(c){return l(ie,{value:c.name,clearable:!0,onUpdateValue:L=>{c.name=L}})}}],I=h([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]),Je=async()=>{var L,E;let c=!0;if(I.value.forEach((m,b)=>{var G,d;const $=m.name||"",R=((G=m.url)==null?void 0:G.split("?")[1])||((d=m.file)==null?void 0:d.name);($&&!R||!$&&R)&&(c=!1)}),!c){(E=(L=window.$message)==null?void 0:L.error)==null||E.call(L,"文件名称和文件地址必须同时存在，不能只填一个");return}le.value[Z.value].fileList=I.value,c&&(X.value=!1,Z.value=void 0)},lt=()=>{X.value=!1};return(c,L)=>{const E=wl,m=tt,b=sl,$=pt("loading");return u(),k(Re,null,[a(b,{show:we.value,"onUpdate:show":L[1]||(L[1]=R=>we.value=R),title:"新增待调试设备",preset:"card",class:"w-80%","mask-closable":!1,draggable:!0},{footer:s(()=>[a(p(Ve),{justify:"end",size:16},{default:s(()=>[a(p(_),{onClick:M},{default:s(()=>[v(U(p(Q)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",onClick:re},{default:s(()=>[v(U(p(Q)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(E,{label:"合同设备","label-placement":"left"},{default:s(()=>[a(p(Hl),{value:Ce.value,"onUpdate:value":[L[0]||(L[0]=R=>Ce.value=R),Le],placeholder:"请选择合同设备",options:ne.value,"check-strategy":"child","show-path":!1,labelKey:"label",remote:"",multiple:"",style:{width:"300px"},"on-load":xe,"onUpdate:show":ke},null,8,["value","options"])]),_:1}),ze(a(m,{style:{width:"100%"},columns:Ue,data:le.value,size:"small","row-key":R=>R.id,striped:"","scroll-x":Ue.reduce((R,G)=>R+G.width,0),"max-height":350},null,8,["data","row-key","scroll-x"]),[[$,S.value]])]),_:1},8,["show"]),a(b,{show:X.value,"onUpdate:show":L[2]||(L[2]=R=>X.value=R),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:s(()=>L[3]||(L[3]=[v(" 待调试设备文件列表 ")])),footer:s(()=>[a(p(Ve),{justify:"end"},{default:s(()=>[a(p(_),{size:"small",class:"mt-16px",onClick:lt},{default:s(()=>[v(U(p(Q)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",size:"small",class:"mt-16px",onClick:Je},{default:s(()=>[v(U(p(Q)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(m,{columns:N,"paginate-single-page":!1,data:I.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])],64)}}}),ki={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ci(_e,P){return u(),k("svg",ki,P[0]||(P[0]=[g("path",{fill:"currentColor",d:"M11 13H5v-2h6V5h2v6h6v2h-6v6h-2z"},null,-1)]))}const Li=Ct({name:"material-symbols-add",render:Ci}),Si={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function wi(_e,P){return u(),k("svg",Si,P[0]||(P[0]=[g("path",{fill:"currentColor",d:"M10.825 22q-.675 0-1.162-.45t-.588-1.1L8.85 18.8q-.325-.125-.612-.3t-.563-.375l-1.55.65q-.625.275-1.25.05t-.975-.8l-1.175-2.05q-.35-.575-.2-1.225t.675-1.075l1.325-1Q4.5 12.5 4.5 12.337v-.675q0-.162.025-.337l-1.325-1Q2.675 9.9 2.525 9.25t.2-1.225L3.9 5.975q.35-.575.975-.8t1.25.05l1.55.65q.275-.2.575-.375t.6-.3l.225-1.65q.1-.65.588-1.1T10.825 2h2.35q.675 0 1.163.45t.587 1.1l.225 1.65q.325.125.613.3t.562.375l1.55-.65q.625-.275 1.25-.05t.975.8l1.175 2.05q.35.575.2 1.225t-.675 1.075l-1.325 1q.025.175.025.338v.674q0 .163-.05.338l1.325 1q.525.425.675 1.075t-.2 1.225l-1.2 2.05q-.35.575-.975.8t-1.25-.05l-1.5-.65q-.275.2-.575.375t-.6.3l-.225 1.65q-.1.65-.587 1.1t-1.163.45zm1.225-6.5q1.45 0 2.475-1.025T15.55 12t-1.025-2.475T12.05 8.5q-1.475 0-2.488 1.025T8.55 12t1.013 2.475T12.05 15.5"},null,-1)]))}const $i=Ct({name:"material-symbols-settings-rounded",render:wi}),Di={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function zi(_e,P){return u(),k("svg",Di,P[0]||(P[0]=[g("path",{fill:"currentColor",d:"m10.6 16.6l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const ji=Ct({name:"material-symbols-check-circle-outline",render:zi}),Ui={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Bi(_e,P){return u(),k("svg",Ui,P[0]||(P[0]=[g("path",{fill:"currentColor",d:"M8 16h2V8H8zm4 0l6-4l-6-4zm0 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const Fi=Ct({name:"material-symbols-not-started-outline",render:Bi}),Ii={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Pi(_e,P){return u(),k("svg",Ii,P[0]||(P[0]=[g("path",{fill:"currentColor",d:"M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.2 0 .375.038t.35.112L17.875 5H5v14h14v-6.65l2-2V19q0 .825-.587 1.413T19 21zm6.525-4l-5.65-5.65l1.4-1.4l4.25 4.25L20.7 5.025L22.125 6.4z"},null,-1)]))}const Ti=Ct({name:"material-symbols-select-check-box",render:Pi}),Ni={class:"w-500px whitespace-normal"},Ei={style:{display:"flex",alignItems:"center",justifyContent:"space-between",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Ai={key:1,style:{display:"none"}},Vi={key:1,style:{display:"none"}},Mi={key:1,style:{display:"none"}},qi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Oi={style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Ri={class:"flex items-center"},Ji={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Hi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Gi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Wi={style:{display:"flex","align-items":"center",width:"100%",gap:"8px"}},Ki={style:{"font-weight":"500",color:"#333","margin-bottom":"4px"}},Yi={style:{"font-size":"13px",color:"#666"}},Qi={class:"flex items-center",style:{position:"absolute",top:"50%",transform:"translateY(-50%)"}},Xi={style:{display:"flex","align-items":"center",width:"100%",gap:"8px"}},Zi={style:{"font-weight":"500",color:"#333"}},eo={style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},to={class:"flex-col w-100%"},lo={class:"w-100px"},ao=2,no=Tt({__name:"prjDetail",props:{prjDetailInfo:{},pid:{},userList:{}},emits:["searchDetail"],setup(_e,{expose:P,emit:ue}){const oe=Mt(),w=_e,we=ue,ne=h(!1),r=st({}),H=async(B,o)=>{var ae;const{data:z,error:O}=await da([{id:B.id,status:o}]);O||((ae=window.$message)==null||ae.success("操作成功"),we("searchDetail"))},ce=h([]),Ie=async()=>{const{data:B,error:o}=await wn();B&&(ce.value=B)},Me=B=>{xe(B),r.region=void 0,r.prosite="",r.proaddr="",$e.value=""},pe=B=>{var z;const o=(z=qe.value.find(O=>O.id===B))==null?void 0:z.name;lt(o)},qe=h([]),xe=async B=>{var O;if(!B)return(O=window.$message)==null?void 0:O.warning("请先选择省份");const{data:o,error:z}=await Cn({province:B});o&&(qe.value=o)};Vt(()=>w.prjDetailInfo,async B=>{Object.assign(r,B),console.log(r)},{immediate:!0,deep:!0});const je=h(!1),We=h();let Le=null,Ce=null,le=null,Ue=null,M=null,S=null;const re=st({longitude:0,latitude:0});let ke;const he=h(!1),$e=h(""),me=h([]);let X=0;async function Z(){try{if(window._AMapSecurityConfig={securityJsCode:oe.userInfo.sdksecret},!We.value)return;S=await ys.load({key:oe.userInfo.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),Le=new S.Map(We.value,{zoom:18,center:[I.value>0?m.value[I.value-1].longitude:r.longitude,I.value>0?m.value[I.value-1].latitude:r.latitude],viewMode:"3D",resizeEnable:!0}),Ce=new S.Geocoder,Ue=new S.PlaceSearch({city:"全国",pageSize:50}),M=new S.AutoComplete({city:"全国"}),c(S,{lng:I.value>0?m.value[I.value-1].longitude:r.longitude,lat:I.value>0?m.value[I.value-1].latitude:r.latitude}),Le.on("click",B=>{const{lng:o,lat:z}=B.lnglat;ke=2,re.latitude=z,re.longitude=o,c(S,{lng:o,lat:z})}),X=0,yt(()=>{window.dispatchEvent(new Event("resize"))})}catch(B){console.error("地图加载失败：",B),X<ao?(X++,console.warn(`地图加载失败，正在第 ${X} 次重试...`),setTimeout(()=>{Z()},1500)):console.error("地图加载失败，已达到最大重试次数，停止重试")}}const Ke=Yl.debounce(async B=>{if(!B.trim()){me.value=[];return}M.search(B,(o,z)=>{var O;console.log(z,"result"),o=="complete"&&z.info=="OK"&&((O=z==null?void 0:z.tips)!=null&&O.length)?me.value=z.tips.map(ae=>({label:`${ae.name}（${ae.district||ae.address||"无详细地址"}）`,value:`${ae.location.lng}_${ae.location.lat}`,raw:ae})):me.value=[]})},300);Vt($e,B=>{Ke(B)});function N(B,o){if(console.log(B,o,"option"),!B)return;const[z,O]=B.split("_").map(Number);!z||!O||(Le.setCenter([z,O]),ke=1,c(S,{lng:z,lat:O}),re.longitude=z,re.latitude=O)}const I=h(0);async function Je(B){B?I.value=B:I.value=0,await Ie(),je.value=!0,he.value=!1,ke=void 0,r.proaddr=w.prjDetailInfo.proaddr,r.prosite=w.prjDetailInfo.prosite,r.provice=w.prjDetailInfo.provice,r.region=w.prjDetailInfo.region,r.provice&&xe(r.provice),yt(async()=>{await Z(),setTimeout(()=>{he.value=!0;const o=document.querySelector(".n-auto-complete input");o==null||o.blur()},500)})}function lt(B){!B||!Ce||!Le||Ce.getLocation(B,(o,z)=>{var O;if(o==="complete"&&((O=z.geocodes)!=null&&O.length)){const{location:ae,formattedAddress:ve}=z.geocodes[0],Y=ae.lng,Fe=ae.lat;Le.setZoomAndCenter(14,[Y,Fe]),re.longitude=Y,re.latitude=Fe,c(S,{lng:Y,lat:Fe}),r.proaddr=ve,r.prosite=ve,$e.value=ve}})}function c(B,o){le&&Le.remove(le),le=new B.Marker({position:[o.lng,o.lat],map:Le}),Le.add(le),Ce.getAddress(o,async(z,O)=>{z==="complete"&&O.regeocode&&(console.log("result",O),console.log("formattedAddress",O.regeocode.formattedAddress),o.latitude=o.lat,o.longitude=o.lng,ke==1?(r.proaddr=O.regeocode.formattedAddress,r.provice=x(r.proaddr,ce.value),await xe(r.provice),r.region=q(r.proaddr,qe.value)):ke==2?($e.value=O.regeocode.formattedAddress,r.proaddr=O.regeocode.formattedAddress,r.provice=x(r.proaddr,ce.value),await xe(r.provice),r.region=q(r.proaddr,qe.value)):$e.value=I.value>0?m.value[I.value-1].addr||O.regeocode.formattedAddress:r.prosite||O.regeocode.formattedAddress)})}function L(){je.value=!1}const E=async()=>{var B,o,z,O;if(I.value==0){r.latitude=re.latitude,r.longitude=re.longitude,r.prosite=$e.value,je.value=!1;const{data:ae,error:ve}=await da([{prosite:r.prosite,latitude:r.latitude,longitude:r.longitude,proaddr:r.proaddr,provice:r.provice,region:r.region,id:r.id}]);ae&&((B=window.$message)==null||B.success("修改位置成功"),we("searchDetail"))}else{m.value[I.value-1].addr=$e.value,m.value[I.value-1].latitude=re.latitude,m.value[I.value-1].longitude=re.longitude;let ae=m.value[I.value-1];if(m.value[I.value-1].id){const{data:ve,error:Y}=await $n([ae]);ve&&((o=window.$message)==null||o.success("修改位置成功"),je.value=!1,I.value=0,G())}else{ae.pid=(z=w.prjDetailInfo)==null?void 0:z.id;const{data:ve,error:Y}=await Dn([ae]);ve&&((O=window.$message)==null||O.success("添加位置成功"),je.value=!1,I.value=0,G())}}},m=h([{latitude:30.303899,longitude:120.373885,addr:""}]),b=h([]),$=h(!1),R=()=>{$.value=!0,G()},G=async()=>{var z,O;if(!((z=w.prjDetailInfo)!=null&&z.id))return;const{data:B,error:o}=await Ln({pid:(O=w.prjDetailInfo)==null?void 0:O.id,page:1,limit:100});B&&(B.list.length>0?(m.value=B.list,b.value=JSON.parse(JSON.stringify(B.list))):m.value=[{longitude:120.373885,latitude:30.303899,addr:""}])},d=()=>{$.value=!1},y=async B=>{var o;if(B.id){const{data:z,error:O}=await zn(B.id);z&&((o=window.$message)==null||o.success("删除成功"),G())}else m.value.splice(m.value.indexOf(B),1)};function x(B,o){let z=null;for(const O of o)if(B.includes(O.name)){z=O.id;break}return z}function q(B,o){let z=null;for(const O of o)if(B.includes(O.name)){z=O.id;break}return z}const W=h([]),V=h([]),ee=h([]),J=async()=>{};Vt(()=>w.pid,async()=>{w.pid&&J()});const K=h(!1),Pe=()=>{K.value=!0},Be=async()=>{var ae,ve,Y;const B=V.value||[],o=ee.value||[],z=B.filter(Fe=>!o.includes(Fe)),O=o.filter(Fe=>!B.includes(Fe));if(z.length===0&&O.length===0){(ae=window.$message)==null||ae.info("未做任何修改"),K.value=!1;return}try{if(z.length>0){const{data:Fe,error:He}=await jn(z.map(Lt=>({pid:w.pid,participant:Lt})));if(He)return}if(O.length>0){const Fe=W.value.filter(ot=>O.includes(ot.participant)).map(ot=>ot.id).join(","),{data:He,error:Lt}=await Un(Fe);if(Lt)return}(ve=window.$message)==null||ve.success("设置成功"),K.value=!1,await J()}catch(Fe){console.error(Fe),(Y=window.$message)==null||Y.error("设置失败，请重试")}};return P({getProjectUserList:J}),(B,o)=>{const z=bs,O=Ti,ae=_,ve=Ge,Y=Fi,Fe=ji,He=kl,Lt=Zl,ot=$i,$l=hs,Dl=Gl,qt=Wl,il=Ne,Ot=wl,De=Ve,ol=ms,gt=ie,Rt=sl,zl=Li,jl=vs,Ul=Sn,Bl=gs,Ee=Ol,rl=_s,ht=Ua,Fl=kn,dl=pt("no-auth");return u(),k(Re,null,[a($l,{bordered:"","label-placement":"left","label-align":"center",columns:4,"label-style":{width:"130px"}},{default:s(()=>[a(z,null,{label:s(()=>o[23]||(o[23]=[v(" 项目名称 ")])),default:s(()=>{var D;return[g("div",Ni,U((D=w.prjDetailInfo)==null?void 0:D.proname),1)]}),_:1}),a(z,{"content-style":{position:"relative",width:"220px"}},{label:s(()=>o[24]||(o[24]=[v(" 项目状态 ")])),default:s(()=>{var D,Oe,f,Jt,Ze,Nt,bt,ul,cl,Dt,pl;return[g("div",Ei,[((D=w.prjDetailInfo)==null?void 0:D.status)!==void 0?(u(),k("div",{key:0,style:kt({display:"flex",alignItems:"center",justifyContent:"center",marginRight:"20px",color:((Oe=w.prjDetailInfo)==null?void 0:Oe.status)==-1?"#a43cf9":((f=w.prjDetailInfo)==null?void 0:f.status)===0?"#9ca3af":((Jt=w.prjDetailInfo)==null?void 0:Jt.status)===1?"#3498db":((Ze=w.prjDetailInfo)==null?void 0:Ze.status)===2?"#facc15":"#22c55e",borderRadius:"50%"})},[g("span",{style:kt({width:"10px",height:"10px",marginRight:"5px",backgroundColor:((Nt=w.prjDetailInfo)==null?void 0:Nt.status)==-1?"#a43cf9":((bt=w.prjDetailInfo)==null?void 0:bt.status)===0?"#9ca3af":((ul=w.prjDetailInfo)==null?void 0:ul.status)===1?"#3498db":((cl=w.prjDetailInfo)==null?void 0:cl.status)===2?"#facc15":"#22c55e",borderRadius:"50%"})},null,4),g("span",null,U(p(ma)[(Dt=w.prjDetailInfo)==null?void 0:Dt.status]?B.$t(p(ma)[(pl=w.prjDetailInfo)==null?void 0:pl.status]):""),1)],4)):C("",!0),a(ve,{onPositiveClick:o[0]||(o[0]=Ye=>H(w.prjDetailInfo,0))},{trigger:s(()=>{var Ye;return[(p(oe).userInfo.usertype==0||p(oe).userInfo.usertype==4||p(oe).userInfo.id==1021||p(oe).userInfo.id==1023)&&((Ye=w.prjDetailInfo)==null?void 0:Ye.status)==-1?(u(),T(ae,{key:0,size:"small",ghost:"",color:"#a43cf9"},{icon:s(()=>[a(O,{class:"text-icon"})]),default:s(()=>[o[25]||(o[25]=v(" 核准 "))]),_:1,__:[25]})):(u(),k("span",Ai))]}),default:s(()=>[o[26]||(o[26]=v(" 确定核准该项目吗？ "))]),_:1,__:[26]}),a(ve,{onPositiveClick:o[1]||(o[1]=Ye=>H(w.prjDetailInfo,1))},{trigger:s(()=>{var Ye;return[(p(oe).userInfo.usertype==0||p(oe).userInfo.usertype==2)&&((Ye=w.prjDetailInfo)==null?void 0:Ye.status)==0?ze((u(),T(ae,{key:0,size:"small",ghost:"",type:"success"},{icon:s(()=>[a(Y,{class:"text-icon"})]),default:s(()=>[o[27]||(o[27]=v(" 启动 "))]),_:1,__:[27]})),[[dl,"project:Info:update"]]):(u(),k("span",Vi))]}),default:s(()=>[o[28]||(o[28]=v(" 确定启动该项目吗？ "))]),_:1,__:[28]}),a(ve,{onPositiveClick:o[2]||(o[2]=Ye=>H(w.prjDetailInfo,3))},{trigger:s(()=>{var Ye;return[(p(oe).userInfo.usertype==0||p(oe).userInfo.usertype==2)&&((Ye=w.prjDetailInfo)==null?void 0:Ye.status)==2?ze((u(),T(ae,{key:0,size:"small",ghost:"",type:"warning"},{icon:s(()=>[a(Fe,{class:"text-icon"})]),default:s(()=>[o[29]||(o[29]=v(" "+U("审核")))]),_:1,__:[29]})),[[dl,"project:Info:update"]]):(u(),k("span",Mi))]}),default:s(()=>[o[30]||(o[30]=v(" 是否确认执行审核操作？ "))]),_:1,__:[30]})])]}),_:1}),a(z,{"content-style":{position:"relative",width:"200px"}},{label:s(()=>o[31]||(o[31]=[v(" 项目进度 ")])),default:s(()=>{var D;return[g("div",qi,[a(He,{type:"line",percentage:(D=w.prjDetailInfo)==null?void 0:D.progess,"indicator-placement":"inside","show-indicator":"",processing:"",style:{width:"140px"},color:"#1890ff"},null,8,["percentage"])])]}),_:1}),a(z,{"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[32]||(o[32]=[v(" 调试类型 ")])),default:s(()=>[g("div",Oi,[a(Lt,{size:"small",type:"info"},{default:s(()=>{var D,Oe;return[v(U(p(va)[(D=w.prjDetailInfo)==null?void 0:D.dtype]?B.$t(p(va)[(Oe=w.prjDetailInfo)==null?void 0:Oe.dtype]):""),1)]}),_:1})])]),_:1}),ne.value?(u(),T(z,{key:0},{label:s(()=>o[33]||(o[33]=[v(" 预计完成日期 ")])),default:s(()=>{var D;return[g("div",Ri,U((D=w.prjDetailInfo)==null?void 0:D.cpdbtime),1)]}),_:1})):C("",!0),ne.value?(u(),T(z,{key:1,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[34]||(o[34]=[v(" 进度状态 ")])),default:s(()=>[g("div",Ji,[a(Lt,{size:"small",type:w.prjDetailInfo.ptype==0?"success":"warning"},{default:s(()=>[v(U(w.prjDetailInfo.ptype==0?"正常":"已延期"),1)]),_:1},8,["type"])])]),_:1})):C("",!0),ne.value?(u(),T(z,{key:2,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[35]||(o[35]=[v(" 周期 ")])),default:s(()=>{var D,Oe;return[g("div",Hi,[g("span",null,U((D=w.prjDetailInfo)!=null&&D.period?((Oe=w.prjDetailInfo)==null?void 0:Oe.period)+"天":""),1)])]}),_:1})):C("",!0),ne.value?(u(),T(z,{key:3,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[36]||(o[36]=[v(" 调度名称 ")])),default:s(()=>{var D;return[g("div",Gi,[g("span",null,U((D=w.prjDetailInfo)==null?void 0:D.dispatch),1)])]}),_:1})):C("",!0),ne.value?(u(),T(z,{key:4,span:3},{label:s(()=>o[37]||(o[37]=[v(" 项目默认地址 ")])),default:s(()=>{var D,Oe;return[g("div",Wi,[g("div",null,[g("div",Ki,U(((D=w.prjDetailInfo)==null?void 0:D.prosite)||"—"),1),g("div",Yi,[o[38]||(o[38]=g("b",{style:{color:"#888"}},"详细地址：",-1)),v(U(((Oe=w.prjDetailInfo)==null?void 0:Oe.proaddr)||"暂无"),1)])]),a(ot,{class:"font-size-20px cursor-pointer",style:{color:"#1890ff","flex-shrink":"0","margin-top":"2px",transition:"transform 0.2s ease"},onClick:o[3]||(o[3]=f=>Je()),onMouseenter:o[4]||(o[4]=f=>f.target.style.transform="rotate(90deg)"),onMouseleave:o[5]||(o[5]=f=>f.target.style.transform="rotate(0deg)")}),g("div",{class:"cursor-pointer c-#1890ff ml-50px flex items-center",onClick:R},[o[39]||(o[39]=v(" 其他地址 ")),a(ot,{class:"font-size-20px",style:{color:"#1890ff","flex-shrink":"0",transition:"transform 0.2s ease"},onMouseenter:o[6]||(o[6]=f=>f.target.style.transform="rotate(90deg)"),onMouseleave:o[7]||(o[7]=f=>f.target.style.transform="rotate(0deg)")})])])]}),_:1})):C("",!0),ne.value?(u(),T(z,{key:5,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[40]||(o[40]=[v(" 开始时间 ")])),default:s(()=>{var D;return[g("div",Qi,[g("span",null,U((D=w.prjDetailInfo)==null?void 0:D.sdbtime),1)])]}),_:1})):C("",!0),ne.value?(u(),T(z,{key:6},{label:s(()=>o[41]||(o[41]=[v(" 计划调试时间 ")])),default:s(()=>{var D;return[v(" "+U((D=w.prjDetailInfo)==null?void 0:D.plantime),1)]}),_:1})):C("",!0),ne.value?(u(),T(z,{key:7},{label:s(()=>o[42]||(o[42]=[v(" 验收人 ")])),default:s(()=>{var D;return[v(" "+U((D=w.prjDetailInfo)==null?void 0:D.ckusername),1)]}),_:1})):C("",!0),ne.value?(u(),T(z,{key:8},{label:s(()=>o[43]||(o[43]=[v(" 验收时间 ")])),default:s(()=>{var D;return[v(" "+U((D=w.prjDetailInfo)==null?void 0:D.ckdbtime),1)]}),_:1})):C("",!0),ne.value?(u(),T(z,{key:9},{label:s(()=>o[44]||(o[44]=[v(" 商务联系人 ")])),default:s(()=>{var D;return[v(" "+U((D=w.prjDetailInfo)==null?void 0:D.businesscon),1)]}),_:1})):C("",!0),p(Ae)("project:Participant:select")?(u(),T(z,{key:10,span:4},{label:s(()=>o[45]||(o[45]=[v(" 项目参与人 ")])),default:s(()=>[g("div",Xi,[g("div",null,[g("div",Zi,U(W.value.map(D=>D.prtcname).filter(Boolean).join("、")),1)]),p(Ae)("project:Participant:insert")||p(Ae)("project:Participant:delete")?(u(),T(ot,{key:0,class:"font-size-22px cursor-pointer",style:kt([{"flex-shrink":"0","margin-top":"2px",transition:"transform 0.2s ease"},{color:W.value.length>0?"#1890ff":""}]),onClick:o[8]||(o[8]=D=>Pe()),onMouseenter:o[9]||(o[9]=D=>D.target.style.transform="rotate(90deg)"),onMouseleave:o[10]||(o[10]=D=>D.target.style.transform="rotate(0deg)")},null,8,["style"])):C("",!0)])]),_:1})):C("",!0)]),_:1}),g("div",{style:kt([{background:"#409eff",position:"absolute",width:"5px",top:"-20px",left:"38px"},{height:ne.value?"115%":"145%"}])},null,4),g("div",eo,[ne.value?(u(),k("span",{key:1,onClick:o[12]||(o[12]=D=>ne.value=!1)},[o[47]||(o[47]=v(" 收起 ")),a(qt,{class:"font-size-20px"})])):(u(),k("span",{key:0,onClick:o[11]||(o[11]=D=>ne.value=!0)},[o[46]||(o[46]=v(" 更多 ")),a(Dl,{class:"font-size-20px"})]))]),a(Rt,{show:je.value,"onUpdate:show":o[17]||(o[17]=D=>je.value=D),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:s(()=>[a(De,{justify:"end",size:16},{default:s(()=>[a(ae,{onClick:L},{default:s(()=>[v(U(B.$t("common.cancel")),1)]),_:1}),[0,2,4].includes(p(oe).userInfo.usertype)?(u(),T(ae,{key:0,type:"primary",onClick:E},{default:s(()=>[v(U(B.$t("common.confirm")),1)]),_:1})):C("",!0)]),_:1})]),default:s(()=>[a(De,null,{default:s(()=>[a(Ot,{label:"省份",path:"provice","label-placement":"left","label-width":"70"},{default:s(()=>[a(il,{filterable:"",value:r.provice,"onUpdate:value":[o[13]||(o[13]=D=>r.provice=D),Me],placeholder:"请选择省份","label-field":"name","value-field":"id",options:ce.value},null,8,["value","options"])]),_:1}),a(Ot,{label:"地区",path:"region","label-placement":"left","label-width":"70"},{default:s(()=>[a(il,{filterable:"",value:r.region,"onUpdate:value":[o[14]||(o[14]=D=>r.region=D),pe],placeholder:"请选择地区","label-field":"name","value-field":"id",options:qe.value},null,8,["value","options"])]),_:1})]),_:1}),he.value?(u(),T(Ot,{key:0,label:I.value==0?"项目地址":"项目地址"+I.value,"label-placement":"left"},{default:s(()=>[g("div",to,[a(ol,{value:$e.value,"onUpdate:value":[o[15]||(o[15]=D=>$e.value=D),p(Ke)],options:me.value,style:{"margin-bottom":"7px"},placeholder:"请输入地点关键字",clearable:"",onSelect:N},null,8,["value","options","onUpdate:value"]),I.value==0?(u(),T(gt,{key:0,type:"textarea",rows:2,clearable:"",value:r.proaddr,"onUpdate:value":o[16]||(o[16]=D=>r.proaddr=D),placeholder:"请输入详细地址"},null,8,["value"])):C("",!0)])]),_:1},8,["label"])):C("",!0),g("div",{ref_key:"domRef",ref:We,class:"h-full w-full",style:{width:"100%",height:"500px","margin-bottom":"10px"}},null,512)]),_:1},8,["show"]),a(Rt,{show:$.value,"onUpdate:show":o[19]||(o[19]=D=>$.value=D),title:"其他地址",preset:"card",class:"w-800px"},{footer:s(()=>[a(De,{justify:"end",size:16},{default:s(()=>[a(ae,{type:"primary",ghost:"",onClick:d},{default:s(()=>o[50]||(o[50]=[v("关闭")])),_:1,__:[50]})]),_:1})]),default:s(()=>[[0,2,4].includes(p(oe).userInfo.usertype)?(u(),T(ae,{key:0,type:"primary",size:"small",ghost:"",onClick:o[18]||(o[18]=D=>m.value.push({latitude:30.303899,longitude:120.373885,addr:""}))},{icon:s(()=>[a(zl,{class:"text-icon"})]),default:s(()=>[o[48]||(o[48]=v(" "+U("添加地址")))]),_:1,__:[48]})):C("",!0),(u(!0),k(Re,null,Pt(m.value,(D,Oe)=>(u(),k("div",{class:"flex items-center mt-10px",key:D.latitude},[g("span",lo,"项目地址"+U(Oe+1),1),a(Ul,{onClick:f=>Je(Oe+1)},{default:s(()=>[a(gt,{readonly:"",value:D.addr,"onUpdate:value":f=>D.addr=f,placeholder:"请选择项目地点"+(Oe+1)},null,8,["value","onUpdate:value","placeholder"]),a(ae,null,{icon:s(()=>[a(jl,{class:"text-icon"})]),_:1})]),_:2},1032,["onClick"]),a(ve,{onPositiveClick:f=>y(D)},{trigger:s(()=>[[0,2,4].includes(p(oe).userInfo.usertype)?(u(),T(ae,{key:0,size:"small",ghost:"",type:"error",class:"ml-10px"},{icon:s(()=>[a(Bl,{class:"text-icon"})]),default:s(()=>[o[49]||(o[49]=v(" "+U("删除")))]),_:1,__:[49]})):C("",!0)]),default:s(()=>[v(" 确定要删除项目地址"+U(Oe+1)+"吗？ ",1)]),_:2},1032,["onPositiveClick"])]))),128))]),_:1},8,["show"]),a(Rt,{show:K.value,"onUpdate:show":o[22]||(o[22]=D=>K.value=D),title:"项目参与人设置",preset:"card",class:"w-700px"},{footer:s(()=>[a(De,{justify:"end",size:16},{default:s(()=>[a(ae,{onClick:o[21]||(o[21]=D=>{K.value=!1})},{default:s(()=>[v(U(B.$t("common.cancel")),1)]),_:1}),[0,2].includes(p(oe).userInfo.usertype)?(u(),T(ae,{key:0,type:"primary",onClick:Be},{default:s(()=>[v(U(B.$t("common.confirm")),1)]),_:1})):C("",!0)]),_:1})]),default:s(()=>[a(Fl,{value:V.value,"onUpdate:value":o[20]||(o[20]=D=>V.value=D)},{default:s(()=>[a(ht,{"y-gap":8,cols:5},{default:s(()=>[(u(!0),k(Re,null,Pt(w.userList,D=>(u(),T(rl,{key:D.id},{default:s(()=>[a(Ee,{size:"large",value:D.id,label:D.username},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["show"])],64)}}}),so=Sl(no,[["__scopeId","data-v-ee33d53b"]]),io={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},oo={class:"timeline-wrapper"},ro={class:"timeline-layout"},uo={class:"timeline"},co=["id"],po={class:"timeline-icon"},fo=["onClick"],go={class:"flex justify-between"},mo=["onClick"],vo={style:{"font-weight":"500",color:"#1890ff","margin-right":"15px"}},yo={key:0},ho={class:"w-200px inline-block"},bo=["onClick"],_o={key:1},xo={class:"w-200px inline-block"},ko=["onClick"],Co={key:2},Lo={class:"w-200px inline-block"},So=["onClick"],wo={key:3},$o={class:"w-200px inline-block"},Do=["onClick"],zo={key:1},jo={class:"timeline-rows"},Uo={key:0,class:"timeline-content",style:{"padding-left":"80px",position:"relative"}},Bo={class:"timeline-icon"},Fo=["onClick"],Io=["onClick"],Po=["id"],To={style:{display:"flex","align-items":"center",gap:"10px"}},No={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Eo={style:{display:"flex","align-items":"center",gap:"10px"}},Ao={class:"pos-absolute left-140px flex gap-x-10px"},Vo={key:0},Mo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},qo={key:0,style:{height:"20px"}},Oo={style:{display:"flex","align-items":"center",gap:"10px"}},Ro={key:0},Jo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Ho={style:{display:"flex","align-items":"center",gap:"10px"}},Go={key:0},Wo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Ko={style:{display:"flex","align-items":"center",gap:"10px"}},Yo={key:0},Qo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Xo={key:0,style:{height:"20px"}},Zo={key:0,style:{height:"20px"}},er={key:0,class:"flex items-center justify-between"},tr={key:0},lr={class:"flex items-center justify-between"},ar={key:0},nr={class:"flex items-center justify-end"};function xl(_e){return typeof _e=="function"||Object.prototype.toString.call(_e)==="[object Object]"&&!is(_e)}const sr=Tt({name:"projectmanagement_orderdetail",__name:"index",setup(_e){const P=Mt(),ue=xa(),oe=h(""),w=Bn(),we=Fn(),ne=st({debuggedBusinessList:[],developBusinessList:[],needsList:[]}),r=st({pid:void 0});let H=st([{id:"phase1",title:"基本信息",show:!0,tables:[]},{id:"phase2",title:"实施信息",show:!0,tables:[]},{id:"phase3",title:"验收信息",show:!0,tables:[]},{id:"phase4",title:"项目总结",show:P.userInfo.usertype!=1,tables:[1]},{id:"phase5",title:"项目日报",show:P.userInfo.usertype!=1,tables:[1]}]);const ce=h(null),Ie=async e=>{var n;if(!e)return;f.value.projectDetail={};const{data:t}=await ts(e);Object.assign(f.value.projectDetail,t),(n=ce.value)==null||n[0].getProjectUserList()},Me=()=>{pe.pageSize==1?pe.pageSize=20:pe.pageSize=1,xe(r.pid)},pe=st({page:1,pageSize:1,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${pe.itemCount} 条`,onChange:e=>{pe.page=e,xe(r.pid)},onUpdatePageSize:e=>{pe.pageSize=e,pe.page=1,xe(r.pid)}}),qe=[{title:"对接方",key:"docker",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.docker,placeholder:"请输入",onUpdateValue(n){f.value.contactList[t].docker=n}}):l("div",{},e.docker)}},{title:"姓名",key:"pname",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.pname,placeholder:"请输入",onUpdateValue(n){f.value.contactList[t].pname=n}}):l("div",{},e.pname)}},{title:"联系方式",key:"pcontact",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.pcontact,placeholder:"请输入",onUpdateValue(n){f.value.contactList[t].pcontact=n}}):l("div",{},e.pcontact)}},{title:"备注",key:"proposition",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.proposition,placeholder:"请输入",onUpdateValue(n){f.value.contactList[t].proposition=n}}):l("div",{},e.proposition)}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?it(1,e.dbtime):""},{key:"operate",title:Q("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[Ae("project:Contact:insert")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Le(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>We(e,t)},{default:()=>"取消"}),Ae("project:Contact:delete")&&l(Ge,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:j}=await In(e.id);i&&(f.value.contactList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),xe(r.pid),Qe())}else f.value.contactList.splice(t,1)}},{default:()=>Q("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>Q("common.delete")})})]:Ae("project:Contact:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>je(e)},{default:()=>"编辑"})])}}],xe=async e=>{if(!e)return;const{data:t}=await Rl({page:pe.page,limit:pe.pageSize,pid:e});f.value.contactList=t==null?void 0:t.list,pe.itemCount=t==null?void 0:t.total,f.value.contactList.forEach(n=>{n.setStatus=!1}),ne.contactList=JSON.parse(JSON.stringify(f.value.contactList))},je=e=>{f.value.contactList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},We=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value.contactList=JSON.parse(JSON.stringify(ne.contactList)):f.value.contactList.splice(t,1)},Le=async e=>{var t,n,i,j,F;if(!e.docker){(t=window.$message)==null||t.warning("请输入对接方");return}if(!e.pname){(n=window.$message)==null||n.warning("请输入联系人姓名");return}if(!e.pcontact){(i=window.$message)==null||i.warning("请输入联系方式");return}if(e.id){const{data:fe,error:ge}=await Pn([e]);ge||((j=window.$message)==null||j.success("修改成功"),xe(r.pid),e.setStatus=!e.setStatus)}else{const{data:fe,error:ge}=await Tn([{...e,pid:r.pid}]);ge||((F=window.$message)==null||F.success("添加成功"),xe(r.pid),e.setStatus=!e.setStatus,Qe())}Pe()};function Ce(){var e;bl.value.includes("1")||bl.value.push("1"),((e=f.value.contactList[0])!=null&&e.pname||f.value.contactList.length==0)&&f.value.contactList.unshift({pname:"",pcontact:"",proposition:"",setStatus:!0})}const le=h([]),Ue=async()=>{var n;const{data:e,error:t}=await Xl({page:1,limit:100,id:r.pid});le.value=e==null?void 0:e.list.map(i=>({value:i.id,label:i.contractname,isLeaf:!1})),he((n=e==null?void 0:e.list[0])==null?void 0:n.id)},M=h([]),S=h(),{pageData:re,getData:ke}=ft($a),he=async e=>{await ke({pids:e}),S.value=[],M.value=Array.from(new Set([...M.value,...re.data])),S.value=re.data.map(t=>({label:t.devname,value:t.id}))},$e=async e=>{var t;await he(e.value),e.children=(t=S.value)==null?void 0:t.map(n=>({label:n.label,value:n.value,isLeaf:!0}))},me=()=>{X.pageSize==1?X.pageSize=20:X.pageSize=1,N(r.pid)},X=st({page:1,pageSize:1,itemCount:0,showSizePicker:!0,fuzzy:"",pageSizes:[10,20],prefix:()=>`共 ${X.itemCount} 条`,onChange:e=>{X.page=e,N(r.pid)},onUpdatePageSize:e=>{X.pageSize=e,X.page=1,N(r.pid)}}),Z=h(),Ke=[{title:"绑定合同设备",key:"cid",width:220,align:"center",render(e,t){var n,i;return e.setStatus?l(Hl,{style:"width: 200px",value:e.cid,filterable:!0,placeholder:"请选择合同设备",options:le.value,checkStrategy:"child",showPath:!1,remote:!0,renderSuffix:j=>j.option.hidden?null:j.node,renderLabel:j=>j.hidden?null:j.label,onLoad:$e,onUpdateValue(j){var fe;f.value.debuggedDevieceList[t].cid=Number(j)||0;const F=(fe=M.value)==null?void 0:fe.find(ge=>ge.id==j);e.devname=(F==null?void 0:F.devname)||"",e.devnum=(F==null?void 0:F.devcount)||"",e.notes=(F==null?void 0:F.notes)||"",Z.value=(F==null?void 0:F.devcount)||0,e.etype=(F==null?void 0:F.devtype)||0,e.devmanu=(F==null?void 0:F.devmanu)||"",e.devmodel=((F==null?void 0:F.devmodel.length)>64?F==null?void 0:F.devname:F==null?void 0:F.devmodel)||"",e.devunit=(F==null?void 0:F.devunit)||""}}):l("div",{},e.devname2||((i=(n=S.value)==null?void 0:n.find(j=>j.value==e.cid))==null?void 0:i.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.devname,placeholder:"请输入",onUpdateValue(n){f.value.debuggedDevieceList[t].devname=n}}):l("div",{},e.devname)}},{key:"devmodel",title:"设备信息",align:"center",width:180,render(e){return a("div",{style:"display:flex;align-items:flex-start;flex-direction:column; gap:3px; line-height:1.4;"},[a(At,{tooltip:!0,style:"max-width:160px;"},{default:()=>a("span",null,[a("span",null,[v("型号：")]),a("span",{style:"font-weight:500"},[e.devmodel||"-"])])}),a("div",null,[a("span",null,[v("单位：")]),a("span",null,[e.devunit||"-"])])])}},{title:"数量",key:"devnum",width:100,align:"center",render(e,t){return e.setStatus?l(wa,{value:e.devnum,placeholder:"请输入",max:Z.value,onUpdateValue(n){f.value.debuggedDevieceList[t].devnum=n}}):l("div",{},e.devnum)}},{title:"设备信息",key:"deviceInfo",width:160,align:"center",render(e){return a("div",{style:"display:flex;align-items:flex-start;flex-direction:column;gap:3px;line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("是否为我司设备：")]),a("span",{style:"font-weight:500"},[e.etype==0?"是":"否"])]),a("div",null,[a("span",{style:"color:#666"},[v("厂家：")]),a("span",null,[e.devmanu||"-"])])])}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.manucontact,placeholder:"请输入",onUpdateValue(n){f.value.debuggedDevieceList[t].manucontact=n}}):l("div",{},e.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.manuinfo,placeholder:"请输入",onUpdateValue(n){f.value.debuggedDevieceList[t].manuinfo=n}}):l("div",{},e.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Ne,{value:e.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(n){f.value.debuggedDevieceList[t].devstatus=Number(n)||0}}):l("div",{},e.devstatus===0?"设备无异常":e.devstatus===1?"异常":"未知")}},{title:"清点状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Ne,{value:e.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(n){f.value.debuggedDevieceList[t].status=Number(n)||0}}):l("div",{},e.status===0?"未清点":e.status===1?"正常":e.status===2?"增补":e.status===3?"退货":"换货")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.connectionmode,placeholder:"请输入",onUpdateValue(n){f.value.debuggedDevieceList[t].connectionmode=n}}):l("div",{},e.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Ne,{value:e.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(n){f.value.debuggedDevieceList[t].install=Number(n)||0}}):l("div",{},e.install===0?"是":"否")}},{title:"文件",key:"re1",width:100,align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>vl(e,"debuggedDevieceList",t)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,j)=>{var F;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((F=i.file)==null?void 0:F.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>yl({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"备注",key:"notes",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入",onUpdateValue(n){f.value.debuggedDevieceList[t].notes=n}}):l("div",{},e.notes)}},{key:"dusername",title:"清点信息",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:flex-start;  flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("清点人：")]),a("span",{style:"font-weight:500"},[e.dusername||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("时间：")]),a("span",null,[e.ddbtime||"-"])])])}},{key:"dbtime",title:"创建信息",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:flex-start;  flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("创建人：")]),a("span",{style:"font-weight:500"},[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("时间：")]),a("span",null,[e.dbtime||"-"])])])}},{key:"operate",title:Q("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>lt(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>Je(e,t)},{default:()=>"取消"}),Ae("project:Equipment:delete")&&l(Ge,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:j}=await Nn(e.id);i&&(f.value.debuggedDevieceList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),N(r.pid),Qe())}else f.value.debuggedDevieceList.splice(t,1)}},{default:()=>Q("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>Q("common.delete")})})]:Ae("project:Equipment:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>I(e)},{default:()=>"编辑"})])}}],N=async e=>{if(!e)return;const{data:t}=await Jl({page:X.page,limit:X.pageSize,fuzzy:X.fuzzy,pid:e});f.value.debuggedDevieceList=t.list,X.itemCount=t.total,f.value.debuggedDevieceList.forEach(n=>{n.setStatus=!1}),ne.debuggedDevieceList=JSON.parse(JSON.stringify(f.value.debuggedDevieceList))},I=async e=>{var i;console.log(re.data,e.cid,"ssssssssssssssss"),f.value.debuggedDevieceList.forEach(j=>{j.setStatus=!1});const{data:t,error:n}=await En(e.cid);n||(((i=le.value[le.value.length-1])==null?void 0:i.value)!=t.id&&le.value.push({value:t.id,label:t.devname,disabled:!0,isLeaf:!0,hidden:!0}),Z.value=t.devcount||0),e.setStatus=!e.setStatus},Je=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value.debuggedDevieceList=JSON.parse(JSON.stringify(ne.debuggedDevieceList)):f.value.debuggedDevieceList.splice(t,1)},lt=async e=>{var t,n,i,j,F,fe,ge;if(!e.cid){(t=window.$message)==null||t.warning("请选择合同设备");return}if(!e.devname){(n=window.$message)==null||n.warning("设备名称不能为空");return}if(!e.devmodel){(i=window.$message)==null||i.warning("设备型号不能为空");return}if(!e.devnum){(j=window.$message)==null||j.warning("设备数量不能为空");return}if(((F=e.fileList)==null?void 0:F.length)>0){const be=e.fileList.filter(se=>se.file),de=be.length;for(let se=0;se<de;se++){const ye=be[se];ye.indexText=`${se+1}/${de}`,ye.progress=0,ye.status="uploading";try{ye.url=await $t(ye.file.file,ye.file.name,""),ye.progress=100,ye.status="done"}catch{ye.status="error"}}e.fileList.forEach((se,ye)=>{e[`re${ye+1}`]=se.name||"",e[`fl${ye+1}`]=se.url||""}),delete e.fileList}if(e.id){const{data:be,error:de}=await ua([e]);de||((fe=window.$message)==null||fe.success("修改成功"),N(r.pid),e.setStatus=!e.setStatus)}else{const{data:be,error:de}=await Da([{...e,pid:r.pid}]);de||((ge=window.$message)==null||ge.success("添加成功"),N(r.pid),e.setStatus=!e.setStatus,Qe())}},c=async()=>{var i;const e=f.value.debuggedDevieceList.map(j=>j.status==0?{id:j.id,status:1}:null).filter(j=>j!==null),{data:t,error:n}=await ua(e);n||((i=window.$message)==null||i.success("清点成功"),N(r.pid))},L=h(!1);function E(){L.value=!0}const{pageData:m,getData:b,nextPage:$}=ft(La),R=async()=>{await b({usertypes:"2,3"})},G=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&m.data.length<m.total&&(await $(),await yt(),setTimeout(()=>{t.scrollTop=n}))};R();const{pageData:d,getData:y,nextPage:x}=ft(Ca),q=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&d.data.length<d.total&&(await x(),await yt(),setTimeout(()=>{t.scrollTop=n}))};(async()=>{await y(),d.data=d.data.map(e=>(e.name=`${e.weight}  `+e.tname,e))})();const{pageData:V,getData:ee,nextPage:J}=ft(Rl),K=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&V.data.length<V.total&&(await J(),V.data=V.data.map(i=>({...i,value:i.docker+"&id="+i.id})),await yt(),setTimeout(()=>{t.scrollTop=n}))},Pe=async()=>{await ee({pid:r.pid}),V.data=V.data.map(e=>({...e,value:e.docker+"&id="+e.id}))},{pageData:Be,getData:B,nextPage:o}=ft(Jl),z=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&d.data.length<d.total&&(await o(),await yt(),setTimeout(()=>{t.scrollTop=n}))},O=async()=>{await B({pid:r.pid})},ae=h(),ve=[{title:"权重",key:"dtype",width:180,align:"center",render(e,t){return e.setStatus?l(Ne,{value:e.dtype,filterable:!0,placeholder:"请选择权重",options:d.data,labelField:"tname",valueField:"id",onUpdateValue(n){var i;f.value.debuggedBusinessList[t].dtype=Number(n)||0,f.value.debuggedBusinessList[t].debugname=((i=d.data.find(j=>j.id==n))==null?void 0:i.tname)||""},onScroll(n){q(n)}}):l("div",{},e.tname)}},{title:"业务名称",key:"debugname",width:180,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.debugname,placeholder:"请输入业务名称",onUpdateValue(n){f.value.debuggedBusinessList[t].debugname=n}}):l("div",{},e.debugname)}},{title:"状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Ne,{value:e.status,filterable:!0,placeholder:"请选择状态",options:P.userInfo.usertype==0||P.userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}],onUpdateValue(n){f.value.debuggedBusinessList[t].status=Number(n)||0}}):l(Zl,{color:{color:e.status==-1?"rgba(251, 146, 60, 0.15)":e.status==0?"rgba(156, 163, 175,0.15)":e.status==1?"rgba(59, 130, 246,0.15)":e.status==2?"rgba(250, 204, 21,0.15)":"rgba(16, 185, 129,0.15)",textColor:e.status==-1?"#FB923C":e.status==0?"#9ca3af":e.status==1?"#3B82F6":e.status==2?"#FACC15":"#10B981",borderColor:e.status==-1?"#FB923C":e.status==0?"#9ca3af":e.status==1?"#3B82F6":e.status==2?"#FACC15":"#10B981"}},e.status==-1?"申请中":e.status==0?"待调试":e.status==1?"开始调试":e.status==2?"待审核":"审核完成")}},{key:"eqmname",title:"调试设备",align:"center",width:150,render(e,t){return e.setStatus?l(Ne,{value:e.eqmid,placeholder:"请选择调试设备",options:Be.data,onscroll:z,labelField:"devname",valueField:"id",clearable:!0,filterable:!0,onUpdateValue(n){f.value.debuggedBusinessList[t].eqmid=n}}):l("div",{},e.eqmname)}},{title:"对接方",key:"docker",width:120,align:"center",render(e,t){var n;return e.setStatus?l(Ne,{value:e.docker,placeholder:"请输入或选择对接方",options:V.data,onscroll:K,labelField:"docker",valueField:"value",clearable:!0,filterable:!0,tag:!0,onClear(){e.dockcharge="",e.dockcontact=""},onUpdateValue(i){var ge;f.value.debuggedBusinessList[t].docker=i;const[j,F]=(ge=e.docker)==null?void 0:ge.split("&id="),fe=V.data.find(be=>be.docker===j&&be.id===Number(F));fe?(e.dockcharge=fe.pname,e.dockcontact=fe.pcontact):(e.dockcharge="",e.dockcontact="")}}):l("div",{},(n=e.docker)==null?void 0:n.split("&id=")[0])}},{title:"对接方负责人",key:"dockcharge",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.dockcharge,placeholder:"请输入对接方负责人",onUpdateValue(n){f.value.debuggedBusinessList[t].dockcharge=n}}):l("div",{},e.dockcharge)}},{title:"联系方式",key:"dockcontact",width:140,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.dockcontact,placeholder:"请输入联系方式",onUpdateValue(n){f.value.debuggedBusinessList[t].dockcontact=n}}):l("div",{},e.dockcontact)}},{title:"调试人",key:"dbcreater",width:120,align:"center",render(e,t){return e.setStatus?l(Ne,{value:e.dbcreater,filterable:!0,placeholder:"请选择调试人",options:m.data,labelField:"username",valueField:"id",onUpdateValue(n){f.value.debuggedBusinessList[t].dbcreater=n||0},onScroll(n){G(n)}}):l("div",{},e.dbusername)}},{key:"duration",title:"调试信息",align:"center",width:200,render(e){return a("div",{style:"display:flex; align-items:flex-start; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("工时：")]),a("span",{style:"color:#1890ff; font-weight:500"},[e.duration||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("开始：")]),a("span",null,[e.dbdbtime||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("结束：")]),a("span",null,[e.dedbtime||"-"])])])}},{title:"文件",key:"re1",width:80,align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>vl(e,"debuggedBusinessList",t)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,j)=>{var F;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((F=i.file)==null?void 0:F.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>yl({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"备注",key:"notes",width:120,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入备注",onUpdateValue(n){f.value.debuggedBusinessList[t].notes=n}}):l("div",{},e.notes)}},{key:"username",title:"创建信息",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:flex-start; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("创建人：")]),a("span",null,[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("时间：")]),a("span",null,[e.dbtime||"-"])])])}},{key:"ckusername",title:"审核信息",align:"center",width:200,render(e){return a("div",{style:"display:flex; align-items:flex-start; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("审核人：")]),a("span",null,[e.ckusername||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("时间：")]),a("span",null,[e.ckdbtime||"-"])])])}},{title:"计划开始时间",key:"starttime",width:120,align:"center",render(e,t){return e.setStatus?l(Ll,{type:"date",clearable:!0,value:e.starttime,valueFormat:"yyyy-MM-dd",placeholder:"请选择",onUpdateValue(n){f.value.debuggedBusinessList[t].starttime=n}}):l("div",e.starttime?it(0,e.starttime):"")}},{title:"计划结束时间",key:"endtime",width:120,align:"center",render:(e,t)=>e.setStatus?l(Ll,{type:"date",clearable:!0,valueFormat:"yyyy-MM-dd",value:e.endtime,placeholder:"请选择",onUpdateValue(n){f.value.debuggedBusinessList[t].endtime=n}}):e.endtime?it(0,e.endtime):""},{key:"operate",title:Q("common.operate"),align:"center",width:280,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[!e.setStatus&&e.status==0&&e.dbcreater==P.userInfo.id&&l(Ge,{onPositiveClick:()=>{ot(e,1)}},{default:()=>"确定开始调试吗？",trigger:()=>l(_,{type:"success",ghost:!0,size:"small"},{default:()=>"开始"})}),!e.setStatus&&e.status==1&&e.dbcreater==P.userInfo.id&&l(Ge,{onPositiveClick:()=>{ot(e,2)}},{default:()=>l("div",[l("div","确定完成调试？"),l("div",{style:{color:"#d03050",fontWeight:"500",marginTop:"6px"}},"请确认资料已提交，否则将拒绝审核！")]),trigger:()=>l(_,{type:"success",ghost:!0,size:"small"},{default:()=>"完成"})}),!e.setStatus&&e.status==2&&(P.userInfo.usertype==0||P.userInfo.usertype==2)&&l(Ge,{onPositiveClick:()=>{ot(e,3)}},{default:()=>"是否确认执行审核操作？",trigger:()=>l(_,{type:"warning",ghost:!0,size:"small"},{default:()=>"审核"})}),e.setStatus?[Ae("project:Debug:insert")&&l(Ge,{onPositiveClick:()=>{Dl(e)}},{default:()=>"是否确认保存？",trigger:()=>l(_,{type:"info",ghost:!0,size:"small"},{default:()=>"保存"})}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>$l(e,t)},{default:()=>"取消"}),Ae("project:Debug:delete")&&l(Ge,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:j}=await An(e.id,r.pid);i&&(f.value.debuggedBusinessList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),He(r.pid),Qe())}else f.value.debuggedBusinessList.splice(t,1)}},{default:()=>Q("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>Q("common.delete")})})]:Ae("project:Debug:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Lt(e)},{default:()=>"编辑"})])}}],Y=st({page:1,pageSize:1,showSizePicker:!0,itemCount:0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${Y.itemCount} 条`,onChange:e=>{Y.page=e,He(r.pid)},onUpdatePageSize:e=>{Y.pageSize=e,Y.page=1,He(r.pid)}}),Fe=()=>{Y.pageSize==1?Y.pageSize=20:Y.pageSize=1,He(r.pid)},He=async e=>{if(!e)return;const{data:t}=await Vn({page:Y.page,limit:Y.pageSize,fuzzy:Y.fuzzy,creater:Y.creater,pid:e});f.value.debuggedBusinessList=t.list,Y.itemCount=t.total,f.value.debuggedBusinessList.forEach(n=>{n.setStatus=!1}),ne.debuggedBusinessList=JSON.parse(JSON.stringify(f.value.debuggedBusinessList))},Lt=e=>{e.starttime=ca(e.starttime),e.endtime=ca(e.endtime),ae.value=e.status,f.value.debuggedBusinessList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},ot=async(e,t)=>{var j;const{data:n,error:i}=await pa([{id:e.id,status:t,pid:e.pid}]);i||((j=window.$message)==null||j.success("操作成功"),He(r.pid),t==3&&window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:e.pid,type:"debug"}})))},$l=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value.debuggedBusinessList=JSON.parse(JSON.stringify(ne.debuggedBusinessList)):f.value.debuggedBusinessList.splice(t,1)},Dl=async e=>{var i,j,F,fe,ge,be,de,se,ye,Se,_l;if(!e.dtype){(i=window.$message)==null||i.warning("请选择权重");return}if(!e.debugname){(j=window.$message)==null||j.warning("请输入业务名称");return}if(!e.docker){(F=window.$message)==null||F.warning("请选择或输入对接方");return}if(!e.dockcharge){(fe=window.$message)==null||fe.warning("请输入对接方负责人");return}if(!e.dockcontact){(ge=window.$message)==null||ge.warning("请输入对接方联系方式");return}if(!e.dbcreater){(be=window.$message)==null||be.warning("请选择调试人");return}const t=it(0,e.starttime),n=it(0,e.endtime);if(((de=e.fileList)==null?void 0:de.length)>0){const at=e.fileList.filter(nt=>nt.file),Ut=at.length;for(let nt=0;nt<Ut;nt++){const et=at[nt];et.indexText=`${nt+1}/${Ut}`,et.progress=0,et.status="uploading";try{et.url=await $t(et.file.file,et.file.name,""),et.progress=100,et.status="done"}catch{et.status="error"}}e.fileList.forEach((nt,et)=>{e[`re${et+1}`]=nt.name||"",e[`fl${et+1}`]=nt.url||""}),delete e.fileList}if(e.id){const at=JSON.parse(JSON.stringify(e));ae.value==at.status&&delete at.status,at.docker=(se=at.docker)==null?void 0:se.split("&id=")[0];const{data:Ut,error:nt}=await pa([{...at,starttime:t,endtime:n}]);nt||((ye=window.$message)==null||ye.success("修改成功"),He(r.pid),e.setStatus=!e.setStatus)}else{e.docker=(Se=e.docker)==null?void 0:Se.split("&id=")[0];const{data:at,error:Ut}=await Sa([{...e,starttime:t,endtime:n,pid:r.pid}]);Ut||((_l=window.$message)==null||_l.success("添加成功"),He(r.pid),e.setStatus=!e.setStatus,Qe())}},qt=h(!1);function il(){qt.value=!0}const Ot=[{title:"影响的业务",key:"affectedbusiness",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.affectedbusiness,placeholder:"请输入影响的业务",onUpdateValue(n){f.value.developBusinessList[t].affectedbusiness=n}}):l("div",{},e.affectedbusiness)}},{title:"设备名称",key:"devname",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.devname,placeholder:"请输入设备名称",onUpdateValue(n){f.value.developBusinessList[t].devname=n}}):l("div",{},e.devname)}},{title:"接口文档",key:"apidocument",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.apidocument,placeholder:"请输入接口文档",onUpdateValue(n){f.value.developBusinessList[t].apidocument=n}}):l("div",{},e.apidocument)}},{title:"研发对接人",key:"uid",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.uid,placeholder:"请输入研发对接人",onUpdateValue(n){f.value.developBusinessList[t].uid=n}}):l("div",{},e.uid)}},{title:"研发周期",key:"period",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.period,placeholder:"请输入文件上传路径",onUpdateValue(n){f.value.developBusinessList[t].period=n}}):l("div",{},e.period)}},{title:"备注",key:"notes",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入备注",onUpdateValue(n){f.value.developBusinessList[t].notes=n}}):l("div",{},e.notes)}},{title:"文件",key:"re1",align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>vl(e,"developBusinessList",t)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,j)=>{var F;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((F=i.file)==null?void 0:F.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>yl({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?it(1,e.dbtime):""},{key:"operate",title:Q("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[Ae("project:Development:insert")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>jl(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>zl(e,t)},{default:()=>"取消"}),Ae("project:Development:delete")&&l(Ge,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:j}=await Mn(e.id,r.pid);i&&(f.value.developBusinessList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),gt(r.pid),Qe())}else f.value.developBusinessList.splice(t,1)}},{default:()=>Q("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>Q("common.delete")})})]:Ae("project:Development:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Rt(e)},{default:()=>"编辑"})])}}],De=st({page:1,pageSize:1,itemCount:0,showSizePicker:!0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${De.itemCount} 条`,onChange:e=>{De.page=e,gt(r.pid)},onUpdatePageSize:e=>{De.pageSize=e,De.page=1,gt(r.pid)}}),ol=()=>{De.pageSize==1?De.pageSize=20:De.pageSize=1,gt(r.pid)},gt=async e=>{if(!e)return;const{data:t}=await qn({page:De.page,limit:De.pageSize,fuzzy:De.fuzzy,creater:De.creater,pid:e});f.value.developBusinessList=t.list,De.itemCount=t.total,f.value.developBusinessList.forEach(n=>{n.setStatus=!1}),ne.developBusinessList=JSON.parse(JSON.stringify(f.value.developBusinessList))},Rt=e=>{f.value.developBusinessList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},zl=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value.developBusinessList=JSON.parse(JSON.stringify(ne.developBusinessList)):f.value.developBusinessList.splice(t,1)},jl=async e=>{var t,n,i,j,F,fe,ge,be;if(!e.affectedbusiness){(t=window.$message)==null||t.warning("请输入影响的业务");return}if(!e.devname){(n=window.$message)==null||n.warning("请输入设备名称");return}if(!e.apidocument){(i=window.$message)==null||i.warning("请输入接口文档");return}if(!e.uid){(j=window.$message)==null||j.warning("请输入研发对接人");return}if(!e.period){(F=window.$message)==null||F.warning("请输入研发周期");return}if(((fe=e.fileList)==null?void 0:fe.length)>0){const de=e.fileList.filter(ye=>ye.file),se=de.length;for(let ye=0;ye<se;ye++){const Se=de[ye];Se.indexText=`${ye+1}/${se}`,Se.progress=0,Se.status="uploading";try{Se.url=await $t(Se.file.file,Se.file.name,""),Se.progress=100,Se.status="done"}catch{Se.status="error"}}e.fileList.forEach((ye,Se)=>{e[`re${Se+1}`]=ye.name||"",e[`fl${Se+1}`]=ye.url||""}),delete e.fileList}if(e.id){const{data:de,error:se}=await On([e]);se||((ge=window.$message)==null||ge.success("修改成功"),gt(r.pid),e.setStatus=!e.setStatus)}else{const{data:de,error:se}=await Rn([{...e,pid:r.pid}]);se||((be=window.$message)==null||be.success("添加成功"),gt(r.pid),e.setStatus=!e.setStatus,Qe())}};function Ul(){var e;Et.value.includes("2")||Et.value.push("2"),((e=f.value.developBusinessList[0])!=null&&e.id||f.value.developBusinessList.length==0)&&f.value.developBusinessList.unshift({affectedbusiness:"",devname:"",apidocument:"",uid:"",period:void 0,notes:"",setStatus:!0})}const Bl=[{title:"需求内容",key:"reqcontent",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.reqcontent,placeholder:"请输入需求内容",onUpdateValue(n){f.value.needsList[t].reqcontent=n}}):l("div",{},e.reqcontent)}},{title:"客户联系人",key:"customer",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.customer,placeholder:"请输入客户联系人",onUpdateValue(n){f.value.needsList[t].customer=n}}):l("div",{},e.customer)}},{title:"联系方式",key:"cstcontact",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.cstcontact,placeholder:"请输入联系方式",onUpdateValue(n){f.value.needsList[t].cstcontact=n}}):l("div",{},e.cstcontact)}},{title:"结果",key:"cstresult",align:"center",render(e,t){return e.setStatus?l(Ne,{value:e.cstresult,filterable:!0,placeholder:"请选择结果",options:[{label:"成功",value:1},{label:"失败",value:0}],onUpdateValue(n){f.value.needsList[t].cstresult=Number(n)||0}}):l("div",{},e.cstresult==1?"成功":"失败")}},{title:"备注",key:"notes",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入备注",onUpdateValue(n){f.value.needsList[t].notes=n}}):l("div",{},e.notes)}},{title:"文件",key:"re1",align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>vl(e,"needsList",t)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,j)=>{var F;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((F=i.file)==null?void 0:F.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>yl({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?it(1,e.dbtime):""},{key:"operate",title:Q("common.operate"),align:"center",minWidth:120,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[Ae("project:Customer:insert")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>D(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>dl(e,t)},{default:()=>"取消"}),Ae("project:Customer:delete")&&l(Ge,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:j}=await Jn(e.id,r.pid);i&&(f.value.needsList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),ht(r.pid),Qe())}else f.value.needsList.splice(t,1)}},{default:()=>Q("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>Q("common.delete")})})]:Ae("project:Customer:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Fl(e)},{default:()=>"编辑"})])}}],Ee=st({page:1,pageSize:1,showSizePicker:!0,itemCount:0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${Ee.itemCount} 条`,onChange:e=>{Ee.page=e,ht(r.pid)},onUpdatePageSize:e=>{Ee.pageSize=e,Ee.page=1,ht(r.pid)}}),rl=()=>{Ee.pageSize==1?Ee.pageSize=20:Ee.pageSize=1,ht(r.pid)},ht=async e=>{if(!e)return;const{data:t}=await Hn({page:Ee.page,limit:Ee.pageSize,fuzzy:Ee.fuzzy,creater:Ee.creater,pid:e});f.value.needsList=t.list,Ee.itemCount=t.total,f.value.needsList.forEach(n=>{n.setStatus=!1}),ne.needsList=JSON.parse(JSON.stringify(f.value.needsList))},Fl=e=>{f.value.needsList.forEach(t=>{t.setStatus=!1}),e.cstresult=e.cstresult&&e.cstresult*1,e.setStatus=!e.setStatus},dl=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value.needsList=JSON.parse(JSON.stringify(ne.needsList)):f.value.needsList.splice(t,1)},D=async e=>{var t,n,i,j,F,fe;if(!e.reqcontent){(t=window.$message)==null||t.error("需求内容不能为空");return}if(!e.customer){(n=window.$message)==null||n.error("客户联系人不能为空");return}if(!e.cstcontact){(i=window.$message)==null||i.error("联系方式不能为空");return}if(((j=e.fileList)==null?void 0:j.length)>0){const ge=e.fileList.filter(de=>de.file),be=ge.length;for(let de=0;de<be;de++){const se=ge[de];se.indexText=`${de+1}/${be}`,se.progress=0,se.status="uploading";try{se.url=await $t(se.file.file,se.file.name,""),se.progress=100,se.status="done"}catch{se.status="error"}}e.fileList.forEach((de,se)=>{e[`re${se+1}`]=de.name||"",e[`fl${se+1}`]=de.url||""}),delete e.fileList}if(e.id){const{data:ge,error:be}=await Gn([e]);be||((F=window.$message)==null||F.success("修改成功"),ht(r.pid),e.setStatus=!e.setStatus)}else{const{data:ge,error:be}=await Wn([{...e,pid:r.pid}]);be||((fe=window.$message)==null||fe.success("添加成功"),ht(r.pid),e.setStatus=!e.setStatus,Qe())}};function Oe(){var e;Et.value.includes("3")||Et.value.push("3"),((e=f.value.needsList[0])!=null&&e.id||f.value.needsList.length==0)&&f.value.needsList.unshift({reqcontent:"",customer:"",cstcontact:"",cstresult:0,notes:"",setStatus:!0})}const f=h({projectDetail:{},contactList:[],prjCycleList:[],fileList:[],DebuggingEngineerList:[],debuggedDevieceList:[],debuggedBusinessList:[],developBusinessList:[],needsList:[]}),Jt=[{key:"kk",title:" ",align:"center",width:120,render:e=>a("div",null,[e.username+"的项目总结"])},{key:"charctras",title:"字符数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:Q("common.operate"),align:"center",width:140,fixed:"right",render:e=>{let t;return a("div",{class:"flex-center gap-8px"},[a(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ba(e)},{default:()=>[v("查看详情")]}),P.userInfo.id==e.creater&&ze(a(_,{type:"primary",ghost:!0,size:"small",onClick:()=>pl(e)},xl(t=Q("common.edit"))?t:{default:()=>[t]}),[[pt("no-auth"),"project:Summary:update"]]),P.userInfo.id==e.creater&&a(Ge,{onPositiveClick:()=>cl(e.id)},{default:()=>Q("common.confirmDelete"),trigger:()=>{let n;return ze(a(_,{type:"error",ghost:!0,size:"small"},xl(n=Q("common.delete"))?n:{default:()=>[n]}),[[pt("no-auth"),"project:Summary:delete"]])}})])}}],Ze=st({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${Ze.itemCount} 条`,onChange:e=>{Ze.page=e,bt(r.pid)},onUpdatePageSize:e=>{Ze.pageSize=e,Ze.page=1,bt(r.pid)}}),Nt=h([]),bt=async e=>{const{data:t,error:n}=await Kn({page:Ze.page,limit:Ze.pageSize,pid:e});n||(Nt.value=t.list,Ze.itemCount=t.total,Qe())},ul=()=>{rt.value=void 0,Dt.value=!0};async function cl(e){var i;const{data:t,error:n}=await fa(e);n||((i=window.$message)==null||i.success("删除成功"),bt(r.pid))}const Dt=h(!1);function pl(e){rt.value=e,Dt.value=!0}const Ye=h(!1),rt=h({}),Ba=e=>{Ye.value=!0,rt.value=e},ea=[{key:"notes",title:"今日工作内容",align:"center",width:300,render(e){return l(At,{tooltipPlacement:"center",lineClamp:3,style:{minWidth:"280px"}},{default:()=>e.notes||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.notes||"")})}},{key:"problem",title:"遇到问题",align:"center",width:120,render(e){return l(At,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.problem||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.problem||"")})}},{key:"solutions",title:"解决措施",align:"center",width:120,render(e){return l(At,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.solutions||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.solutions||"")})}},{key:"feedback",title:"建议意见反馈",align:"center",width:120,render(e){return l(At,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.feedback||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.feedback||"")})}},{key:"summarize",title:"总结",align:"center",width:120,render(e){return l(At,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.summarize||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.summarize||"")})}},{key:"username",title:"创建信息",align:"left",width:200,render(e){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("创建人：")]),a("span",null,[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("创建时间：")]),a("span",null,[e.dbtime||"-"])])])}},{key:"operate",title:Q("common.operate"),align:"center",width:100,fixed:"right",render:e=>{let t;return a("div",{class:"flex-center gap-8px"},[P.userInfo.id==e.creater&&ze(a(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Pa(e)},xl(t=Q("common.edit"))?t:{default:()=>[t]}),[[pt("no-auth"),"project:Summary:update"]]),P.userInfo.id==e.creater&&a(Ge,{onPositiveClick:()=>Ia(e.id)},{default:()=>Q("common.confirmDelete"),trigger:()=>{let n;return ze(a(_,{type:"error",ghost:!0,size:"small"},xl(n=Q("common.delete"))?n:{default:()=>[n]}),[[pt("no-auth"),"project:Summary:delete"]])}})])}}],dt=st({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${dt.itemCount} 条`,onChange:e=>{dt.page=e,fl(r.pid)},onUpdatePageSize:e=>{dt.pageSize=e,dt.page=1,fl(r.pid)}}),Il=h([]),fl=async e=>{const{data:t,error:n}=await za({page:dt.page,limit:dt.pageSize,pid:e});n||(Il.value=t.list.map(i=>{const j=JSON.parse(i.context);return i.notes=j.notes,i.problem=j.problem,i.solutions=j.solutions,i.feedback=j.feedback,i.summarize=j.summarize,i}),dt.itemCount=t.total,Qe())},Fa=()=>{rt.value=void 0,gl.value=!0};async function Ia(e){var i;const{data:t,error:n}=await fa(e);n||((i=window.$message)==null||i.success("删除成功"),bt(r.pid))}const gl=h(!1);function Pa(e){rt.value=e,gl.value=!0}const ta=h(!1);function la(){Gt()}const Pl=h(!1),Ta=async e=>{if(!e){f.value={projectDetail:{},contactList:[],debuggedBusinessList:[],fileList:[],debuggedDevieceList:[],DebuggingEngineerList:[],developBusinessList:[],needsList:[]};return}Pl.value=!0;try{const t=await Promise.allSettled([Ie(e),St(e),O(),xe(e),He(e),N(e),Na(),gt(e),ht(e),bt(e),fl(e)]);Qe(),t.forEach((n,i)=>{n.status==="fulfilled"?console.log(`任务 ${i} 成功:`,n):console.warn(`任务 ${i} 失败:`,n.reason)})}catch(t){console.error("意料之外的错误:",t)}finally{Pl.value=!1}},Ht=h(),aa=[{key:"cusname",title:"客户名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"token",title:"气象信息Token",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[a("span",null,[e.token||"-"]),a(ls,{trigger:"hover"},{trigger:()=>a(_,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>na(e.token)},{default:()=>[v("复制")]}),default:()=>"复制 token"})])}},{key:"passward",title:"气象信息Passward",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[a("span",null,[e.passward||"-"]),a(_,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>na(e.passward)},{default:()=>[v("复制")]})])}},{key:"longitude",title:"经度",align:"center",width:120},{key:"latitude",title:"维度",align:"center",width:120},{key:"pro",title:"墨迹合同项目名称",align:"center",width:140},{key:"expiare",title:"过期时间",align:"center",width:180},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(e){return a("div",{style:"display:flex; flex-direction:column; font-size:13px; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("创建人：")]),a("span",{style:"font-weight:500"},[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("时间：")]),a("span",{style:" font-weight:500"},[e.dbtime||"-"])])])}}],Na=async()=>{const{data:e,error:t}=await Ls({page:1,limit:99,pid:r.pid});Ht.value=e.list,Ht.value.length>0&&P.userInfo.usertype!=1&&(H[5]={id:"phase6",title:"气象信息",show:!0,tables:[{id:1,name:"气象信息",type:1}]})},na=async e=>{var t;e&&(await navigator.clipboard.writeText(e),(t=window.$message)==null||t.success("已复制"))},Qe=()=>{H[0].tables=[{id:1,name:"项目联系人",type:f.value.contactList.length>0?1:0},{id:2,name:"待调试设备",type:f.value.debuggedDevieceList.length>0?1:0},{id:3,name:"图纸",type:f.value.fileList.length>0?1:0}],H[1].tables=[{id:1,name:"待调试业务",type:f.value.debuggedBusinessList.length>0?1:0},{id:2,name:"需要开发",type:f.value.developBusinessList.length>0?1:0},{id:3,name:"需求变更",type:f.value.needsList.length>0?1:0},{id:4,name:"文件",type:Wt.value.length>0||Kt.value.length>0||Yt.value.length>0||Qt.value.length>0||Xt.value.length>0?1:0}],H[2].tables=[{id:1,name:"项目验收",type:Zt.value.length>0?1:0}],H[3].tables=[{id:1,name:"项目总结",type:Nt.value.length>0?1:0}],H[4].tables=[{id:1,name:"项目日报",type:Il.value.length>0?1:0}]};async function Gt(){P.userInfo.usertype==1&&(H[3]=null,H[4]=null,H=H.filter(e=>e!==null)),r.pid&&(await Ta(r.pid),Ue(),Pe(),Qe(),setTimeout(()=>{we.replace({path:w.path,query:{}})},100))}const Ea=()=>{const e=document.getElementById("__SCROLL_EL_ID__");e==null||e.scrollTo({top:0,behavior:"smooth"})},sa=e=>{H[e].show=!H[e].show},Tl=e=>{const t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth",block:"start"}),oe.value=e)},Nl=()=>{const e=[];H.forEach(i=>{i.tables.forEach((j,F)=>e.push(`${i.id}-${F}`))});const t=window.scrollY;let n="";for(const i of e){const j=document.getElementById(i);j&&j.offsetTop-100<=t&&(n=i)}oe.value=n},Wt=h([]),Kt=h([]),Yt=h([]),Qt=h([]),Xt=h([]),Zt=h([]),ia=h({});async function St(e){const{data:t,error:n}=await as({limit:100,page:1,pid:e});n||(f.value.fileList=[],Wt.value=[],Kt.value=[],Yt.value=[],Qt.value=[],Xt.value=[],Zt.value=[],ia.value=t,console.log("data",ia.value),t.list.forEach(i=>{i.sort==1&&f.value.fileList.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==2&&Wt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==3&&Kt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==4&&Yt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==5&&Qt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==6&&Xt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==7&&Zt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime})}),f.value.fileList.reverse(),Wt.value.reverse(),Kt.value.reverse(),Yt.value.reverse(),Qt.value.reverse(),Xt.value.reverse(),Zt.value.reverse(),Qe())}const Aa=e=>{const t=e.target,n=document.getElementById("__SCROLL_EL_ID__"),i=document.getElementById("scrollToTop");!n||!i||(t.scrollTop>(n.clientHeight||0)+500?i.classList.add("show"):i.classList.remove("show"))},ut=h([]),{pageData:zt,getData:ml,nextPage:Va}=ft(ss),Ma=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&zt.data.length<zt.total&&(await Va(),ut.value=zt.data,await yt(),setTimeout(()=>{t.scrollTop=n}))},qa=Yl.debounce(async e=>{await ml({fuzzy:e,page:1}),ut.value=zt.data},300),El=h(!1),Al=h(!1),Oa=e=>{if(r.pid=null,El.value=!0,Al.value=!1,!e){oa();return}qa(e)},Ra=async()=>{El.value&&!Al.value&&(await ml({page:1}),ut.value=zt.data,El.value=!1,await Gt())},oa=async()=>{await ml({page:1}),ut.value=zt.data,await Gt()},Ja=async e=>{var t;Al.value=!0,e&&(r.pid=e,P.setProjectInfo({pid:e,pname:(t=ut.value.find(n=>n.id==r.pid))==null?void 0:t.proname}),await Gt())},Ha=async()=>{var e;await ml({fuzzy:w.query.pname?w.query.pname:P.userInfo.pname||void 0}),ut.value=zt.data,r.pid=(w.query.prjId?Number(w.query.prjId):P.userInfo.pid?Number(P.userInfo.pid):Number((e=ut.value[0])==null?void 0:e.id))||void 0,P.setProjectInfo({pid:r.pid,pname:P.userInfo.pname})},el=h(!1),jt=h(""),Vl=h(),vl=(e,t,n)=>{_t.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}],el.value=!0,jt.value=t,Vl.value=n,e.re1&&(_t.value[0]={name:e.re1,url:e.fl1,file:void 0}),e.re2&&(_t.value[1]={name:e.re2,url:e.fl2,file:void 0}),e.re3&&(_t.value[2]={name:e.re3,url:e.fl3,file:void 0}),e.re4&&(_t.value[3]={name:e.re4,url:e.fl4,file:void 0}),console.log(_t.value)},Ga=[{title:"",key:"",align:"center",render(e,t){return`附件${t+1}`}},{title:"文件名称",key:"filename",align:"center",render(e){var i;const t=async({file:j,onFinish:F,onError:fe})=>{var ge,be;try{e.name=j.name,e.file=j}catch(de){console.error(de),(be=(ge=window.$message)==null?void 0:ge.error)==null||be.call(ge,"文件上传出错")}};async function n(j){var F;return j.file.file.size>100*1024*1024?((F=window.$message)==null||F.error("文件大小不能超过100M"),!1):!0}return l("div",{style:"display:flex;justify-content:center;align-items:center;"},[e.file||e.url?l("span",{},[l("span",{},((i=e.file)==null?void 0:i.name)||e.url.split("?")[1]||""),l("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{e.url="",e.file=null,e.name=""}},"删除")]):l(nl,{action:"#",showFileList:!1,customRequest:t,onBeforeUpload:n},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(e){return l(ie,{value:e.name,clearable:!0,onUpdateValue:t=>{e.name=t}})}}],_t=h([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",rl:"",file:void 0}]);async function yl(e){if(e!=null&&e.url)try{const n=await(await fetch(e.url.split("?")[0],{mode:"cors"})).blob(),i=URL.createObjectURL(n),j=document.createElement("a");j.href=i,j.download=e.url.split("?")[1],j.style.display="none",document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(i)}catch(t){console.error("下载失败:",t)}}const Wa=async()=>{var t,n;let e=!0;if(_t.value.forEach((i,j)=>{var ge,be;const F=i.name||"",fe=((ge=i.url)==null?void 0:ge.split("?")[1])||((be=i.file)==null?void 0:be.name);(F&&!fe||!F&&fe)&&(e=!1)}),!e){(n=(t=window.$message)==null?void 0:t.error)==null||n.call(t,"文件名称和文件地址必须同时存在，不能只填一个");return}f.value[jt.value][Vl.value].fileList=_t.value,e&&(el.value=!1,jt.value="",Vl.value=void 0)},Ka=()=>{el.value=!1},ra=h(!1),Ml=h([]),Ya=async()=>{var n;if(!r.pid)return(n=window.$message)==null?void 0:n.warning("请选择项目");const{data:e,error:t}=await ns({page:1,limit:100,pid:r.pid});Ml.value=(e==null?void 0:e.list)||[]},Qa=e=>{e&&navigator.clipboard.writeText(e).then(()=>{var t;(t=window.$message)==null||t.success("已复制到剪贴板")}).catch(()=>{var t;(t=window.$message)==null||t.error("复制失败，请手动复制")})};Kl(async()=>{await Ha(),Gt(),w.query.IsScroll&&setTimeout(()=>{Tl("phase2-0")},800),window.addEventListener("scroll",Nl);const e=document.getElementById("__SCROLL_EL_ID__");e&&e.addEventListener("scroll",Aa)}),Yn(()=>{window.removeEventListener("scroll",Nl);const e=document.getElementById("__SCROLL_EL_ID__");e&&e.removeEventListener("scroll",Nl)});async function hl(e){if(!e)return;const t=e.split("?")[0],n=e.split("?")[1];try{const j=await(await fetch(t,{mode:"cors"})).blob(),F=URL.createObjectURL(j),fe=document.createElement("a");fe.href=F,fe.download=n,fe.style.display="none",document.body.appendChild(fe),fe.click(),document.body.removeChild(fe),URL.revokeObjectURL(F)}catch(i){console.error("下载失败:",i)}}const bl=h(["1","2","3"]),Xa=e=>{bl.value=e},Et=h(["1","2","3","4"]),Za=e=>{Et.value=e},ql=h(!1),en=()=>{var e;r.pid?ql.value=!0:(e=window.$message)==null||e.warning("请选择项目")};return(e,t)=>{const n=on,i=Ss,j=cn,F=Ua,fe=_a,ge=Ql,be=rn,de=ya,se=Gl,ye=Wl,Se=un,_l=ln,at=dn,Ut=sl,nt=Zn,et=es,mt=pt("no-auth"),tn=pt("loading");return u(),k("div",io,[g("div",{id:"scrollToTop",onClick:Ea,title:"回到顶部"},[a(n,{class:"font-size-30px"})]),a(ge,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[a(fe,{ref:"formRef",model:r,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ba(la,["enter"])},{default:s(()=>[a(F,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[a(i,{span:"24 s:12 m:8",label:"所属项目",path:"pid"},{default:s(()=>[a(p(Ne),{filterable:"",clearable:"",value:r.pid,"onUpdate:value":[t[0]||(t[0]=Te=>r.pid=Te),Ja],placeholder:"请选择所属项目","label-field":"proname","value-field":"id",onClear:oa,onSearch:Oa,onBlur:Ra,options:p(Qn)(ut.value),onScroll:Ma},null,8,["value","options"])]),_:1}),a(i,{span:"24  s:12 m:8",class:"pr-24px"},{default:s(()=>[a(p(Ve),{class:"w-full"},{default:s(()=>[a(p(_),{type:"primary",ghost:"",onClick:la},{icon:s(()=>[a(j,{class:"text-icon"})]),default:s(()=>[v(" "+U(p(Q)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(ge,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper overflow-auto pb-40px content","content-style":{padding:"20px 10px 5px 0"}},{default:s(()=>[ze((u(),k("div",oo,[g("div",ro,[g("div",uo,[(u(!0),k(Re,null,Pt(p(H),(Te,Xe)=>(u(),k("div",{key:Te.id,class:"timeline-phase"},[g("div",{class:"timeline-row",id:"phase"+(Xe+1)},[g("div",po,[t[22]||(t[22]=g("div",{class:"vertical-line"},null,-1)),g("div",{class:"flashing-icon",onClick:te=>sa(Xe)},null,8,fo)]),g("div",go,[g("div",{class:"phase-title",onClick:te=>sa(Xe)},U(Te.title),9,mo),a(p(Ve),null,{default:s(()=>[Xe===0?(u(),T(p(_),{key:0,onClick:en,ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:s(()=>t[23]||(t[23]=[v("工程调试确认单")])),_:1,__:[23]})):C("",!0),Xe===0?(u(),T(p(xt),{key:1,trigger:"click",placement:"left-start",width:1e3},{trigger:s(()=>[ze((u(),T(p(_),{ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:s(()=>t[24]||(t[24]=[v("查询关联合同")])),_:1,__:[24]})),[[mt,"project:Contract:select"]])]),default:s(()=>[a(bi,{id:r.pid},null,8,["id"])]),_:1})):C("",!0),Xe===0?(u(),T(p(xt),{key:2,trigger:"click",placement:"left-start"},{trigger:s(()=>[ze((u(),T(p(_),{onClick:Ya,ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:s(()=>t[25]||(t[25]=[v("查询项目调度")])),_:1,__:[25]})),[[mt,"project:Dispatch:select"]])]),default:s(()=>[Ml.value.length>0?(u(),T(p(ws),{key:0,bordered:!1,"single-line":!1},{default:s(()=>[t[35]||(t[35]=g("thead",null,[g("tr",null,[g("th",null,"调度名称"),g("th",null,"调度联系方式"),g("th",null,"相关文件")])],-1)),g("tbody",null,[(u(!0),k(Re,null,Pt(Ml.value,te=>{var vt,tl,ll,al;return u(),k("tr",{key:te.id},[g("td",null,U(te.dname),1),g("td",null,[g("span",vo,U(te.dcon),1),a(p(_),{size:"tiny",type:"primary",ghost:"",onClick:Bt=>Qa(te.dcon)},{default:s(()=>t[26]||(t[26]=[v(" 复制 ")])),_:2,__:[26]},1032,["onClick"])]),g("td",null,[te.re1&&te.fl1?(u(),k("div",yo,[g("span",ho,"文件别名："+U(te.re1),1),t[27]||(t[27]=g("span",{class:"ml-10px"},"文件名称:",-1)),t[28]||(t[28]=v()),g("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Bt=>hl(te.fl1)},U((vt=te.fl1)==null?void 0:vt.split("?")[1]),9,bo)])):C("",!0),te.re2&&te.fl2?(u(),k("div",_o,[g("span",xo,"文件别名："+U(te.re2),1),t[29]||(t[29]=g("span",{class:"ml-10px"},"文件名称:",-1)),t[30]||(t[30]=v()),g("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Bt=>hl(te.fl1)},U((tl=te.fl2)==null?void 0:tl.split("?")[1]),9,ko)])):C("",!0),te.re3&&te.fl3?(u(),k("div",Co,[g("span",Lo,"文件别名："+U(te.re3),1),t[31]||(t[31]=g("span",{class:"ml-10px"},"文件名称:",-1)),t[32]||(t[32]=v()),g("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Bt=>hl(te.fl1)},U((ll=te.fl3)==null?void 0:ll.split("?")[1]),9,So)])):C("",!0),te.re4&&te.fl4?(u(),k("div",wo,[g("span",$o,"文件别名："+U(te.re4),1),t[33]||(t[33]=g("span",{class:"ml-10px"},"文件名称:",-1)),t[34]||(t[34]=v()),g("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Bt=>hl(te.fl1)},U((al=te.fl4)==null?void 0:al.split("?")[1]),9,Do)])):C("",!0)])])}),128))])]),_:2,__:[35]},1024)):(u(),k("div",zo,"暂无调度"))]),_:2},1024)):C("",!0)]),_:2},1024)])],8,co),a(ha,{name:"fade"},{default:s(()=>[ze(g("div",jo,[Xe===0?(u(),k("div",Uo,[a(so,{pid:r.pid,onSearchDetail:t[1]||(t[1]=te=>Ie(r.pid)),ref_for:!0,ref_key:"detailRef",ref:ce,userList:p(m).data,prjDetailInfo:f.value.projectDetail},null,8,["pid","userList","prjDetailInfo"])])):C("",!0),(u(!0),k(Re,null,Pt(Te.tables,(te,vt)=>{var tl,ll,al,Bt;return u(),k("div",{key:`${Te.id}-${vt}`,class:"timeline-row"},[g("div",Bo,[t[36]||(t[36]=g("div",{class:"vertical-line"},null,-1)),te.type==1?(u(),k("div",{key:0,class:It(["icon",{active:oe.value===`${Te.id}-${vt}`}]),style:{"font-size":"20px",border:"3px solid #409eff",color:"#409eff"},onClick:A=>Tl(`${Te.id}-${vt}`)},[a(be)],10,Fo)):(u(),k("div",{key:1,class:"icon",style:{"font-size":"20px",border:"3px solid #ccc",color:"#ccc"},onClick:A=>Tl(`${Te.id}-${vt}`)}," 一 ",8,Io))]),g("div",{class:"actProgress",style:kt({background:te.type==1?"#409eff":"#ccc"})},null,4),g("div",{class:"timeline-content",id:`${Te.id}-${vt}`},[Xe===0?(u(),k(Re,{key:0},[a(at,{"expanded-names":bl.value,"onUpdate:expandedNames":Xa,"trigger-areas":["arrow"]},{default:s(()=>[te.id==1?(u(),T(Se,{key:0,name:"1"},{header:s(()=>[a(p(Ve),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[g("div",To,[t[38]||(t[38]=g("span",null,"项目联系人",-1)),ze((u(),T(p(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:wt(Ce,["stop"])},{icon:s(()=>[a(de,{class:"text-icon"})]),default:s(()=>[t[37]||(t[37]=v(" 添加项目联系人 "))]),_:1,__:[37]})),[[mt,"project:Contact:insert"]])])]),_:1})]),default:s(()=>[f.value.contactList.length>0?(u(),T(p(tt),{key:0,columns:qe,data:f.value.contactList,size:"small","scroll-x":702,"row-key":A=>A.id,"paginate-single-page":!1,"max-height":350,pagination:pe.pageSize==1?!1:pe,remote:""},null,8,["data","row-key","pagination"])):C("",!0),pe.itemCount>1?(u(),k("div",No,[f.value.contactList.length==1?(u(),k("span",{key:0,onClick:Me},[t[39]||(t[39]=v("更多")),a(se,{class:"font-size-20px"})])):(u(),k("span",{key:1,onClick:Me},[t[40]||(t[40]=v("收起")),a(ye,{class:"font-size-20px"})]))])):C("",!0)]),_:1})):C("",!0),te.id==2?(u(),T(Se,{key:1,title:"待调试设备",name:"2"},{header:s(()=>[a(p(Ve),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>{var A;return[g("div",Eo,[t[44]||(t[44]=g("span",null,"待调试设备",-1)),g("div",Ao,[ze((u(),T(p(_),{size:"small",ghost:"",type:"primary",onClick:wt(E,["stop"])},{icon:s(()=>[a(de,{class:"text-icon"})]),default:s(()=>[t[41]||(t[41]=v(" 添加待调试设备 "))]),_:1,__:[41]})),[[mt,"project:Equipment:insert"]]),(A=f.value.debuggedDevieceList)!=null&&A.some(ct=>ct.status===0)?(u(),T(p(Ge),{key:0,onPositiveClick:c},{trigger:s(()=>[ze((u(),T(p(_),{size:"small",ghost:"",type:"primary"},{default:s(()=>[a(_l,{class:"text-icon"}),t[42]||(t[42]=v(" 一键清点设备 "))]),_:1,__:[42]})),[[mt,"project:Equipment:update"]])]),default:s(()=>[t[43]||(t[43]=v(" 确定要清点当前列表中未清点的设备吗？ "))]),_:1,__:[43]})):C("",!0)])]),X.itemCount>0?(u(),k("div",Vo,"共"+U(X.itemCount)+"条",1)):C("",!0)]}),_:2},1024)]),default:s(()=>[a(xi,{onSubmitted:t[2]||(t[2]=A=>N(r.pid)),visible:L.value,"onUpdate:visible":t[3]||(t[3]=A=>L.value=A),pid:r.pid},null,8,["visible","pid"]),f.value.debuggedDevieceList.length>0?(u(),T(p(tt),{key:0,style:kt({width:p(ue).siderCollapse?"calc(100vw - 219px)":"calc(100vw - 352px)"}),columns:Ke,data:f.value.debuggedDevieceList,size:"small","scroll-x":Ke.reduce((A,ct)=>A+ct.width,0),"row-key":A=>A.id,"max-height":350,pagination:X.pageSize==1?!1:X,remote:"","paginate-single-page":!1},null,8,["style","data","scroll-x","row-key","pagination"])):C("",!0),X.itemCount>1?(u(),k("div",Mo,[f.value.debuggedDevieceList.length==1?(u(),k("span",{key:0,onClick:me},[t[45]||(t[45]=v("更多")),a(se,{class:"font-size-20px"})])):(u(),k("span",{key:1,onClick:me},[t[46]||(t[46]=v("收起")),a(ye,{class:"font-size-20px"})]))])):C("",!0)]),_:2},1024)):C("",!0),te.id==3?(u(),T(Se,{key:2,title:"图纸",name:"3"},{default:s(()=>[a(Ft,{data:f.value.fileList,pid:r.pid,onGetData:t[4]||(t[4]=A=>St(r.pid)),typename:"图纸",fileType:1},null,8,["data","pid"])]),_:1})):C("",!0)]),_:2},1032,["expanded-names"]),te==4?(u(),k("div",qo)):C("",!0)],64)):C("",!0),Xe===1?(u(),k(Re,{key:1},[a(at,{"expanded-names":Et.value,"onUpdate:expandedNames":Za,"trigger-areas":["arrow"]},{default:s(()=>[te.id==1?(u(),T(Se,{key:0,title:"待调试业务",name:"1"},{header:s(()=>[a(p(Ve),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[g("div",Oo,[t[48]||(t[48]=g("span",null,[v("待调试业务 "),g("span",{class:"c-#f0a020 font-bold"},"※")],-1)),ze((u(),T(p(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:wt(il,["stop"])},{icon:s(()=>[a(de,{class:"text-icon"})]),default:s(()=>[t[47]||(t[47]=v(" 添加待调试业务 "))]),_:1,__:[47]})),[[mt,"project:Debug:insert"]])]),Y.itemCount>0?(u(),k("div",Ro,"共"+U(Y.itemCount)+"条",1)):C("",!0)]),_:1})]),default:s(()=>[a(_i,{onSubmitted:t[5]||(t[5]=A=>He(r.pid)),visible:qt.value,"onUpdate:visible":t[6]||(t[6]=A=>qt.value=A),pid:r.pid},null,8,["visible","pid"]),f.value.debuggedBusinessList.length>0?(u(),T(p(tt),{key:0,style:kt({width:p(ue).siderCollapse?"calc(100vw - 219px)":"calc(100vw - 352px)"}),columns:ve,data:f.value.debuggedBusinessList,size:"small","row-key":A=>A.id,striped:"","scroll-x":ve.reduce((A,ct)=>A+ct.width,0),"paginate-single-page":!1,pagination:Y.pageSize==1?!1:Y,remote:"","max-height":350},null,8,["style","data","row-key","scroll-x","pagination"])):C("",!0),Y.itemCount>1?(u(),k("div",Jo,[f.value.debuggedBusinessList.length==1?(u(),k("span",{key:0,onClick:Fe},[t[49]||(t[49]=v(" 更多 ")),a(se,{class:"font-size-20px"})])):(u(),k("span",{key:1,onClick:Fe},[t[50]||(t[50]=v(" 收起 ")),a(ye,{class:"font-size-20px"})]))])):C("",!0)]),_:1})):C("",!0),te.id===2&&p(P).userInfo.usertype!==1?(u(),T(Se,{key:1,title:"需要开发",name:"2"},{header:s(()=>[a(p(Ve),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[g("div",Ho,[t[52]||(t[52]=g("span",null,"需要开发",-1)),ze((u(),T(p(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:wt(Ul,["stop"])},{icon:s(()=>[a(de,{class:"text-icon"})]),default:s(()=>[t[51]||(t[51]=v(" 添加需要开发 "))]),_:1,__:[51]})),[[mt,"project:Development:insert"]])]),De.itemCount>0?(u(),k("div",Go,"共"+U(De.itemCount)+"条",1)):C("",!0)]),_:1})]),default:s(()=>[f.value.developBusinessList.length>0?(u(),T(p(tt),{key:0,columns:Ot,data:f.value.developBusinessList,size:"small","scroll-x":702,"row-key":A=>A.id,pagination:De.pageSize==1?!1:De,remote:"","paginate-single-page":!1,"max-height":350},null,8,["data","row-key","pagination"])):C("",!0),De.itemCount>1?(u(),k("div",Wo,[f.value.developBusinessList.length==1?(u(),k("span",{key:0,onClick:ol},[t[53]||(t[53]=v(" 更多 ")),a(se,{class:"font-size-20px"})])):(u(),k("span",{key:1,onClick:ol},[t[54]||(t[54]=v(" 收起 ")),a(ye,{class:"font-size-20px"})]))])):C("",!0)]),_:1})):C("",!0),te.id===3&&p(P).userInfo.usertype!==1?(u(),T(Se,{key:2,title:"客户需求变更",name:"3"},{header:s(()=>[a(p(Ve),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[g("div",Ko,[t[56]||(t[56]=g("span",null,"客户需求变更",-1)),ze((u(),T(p(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:wt(Oe,["stop"])},{icon:s(()=>[a(de,{class:"text-icon"})]),default:s(()=>[t[55]||(t[55]=v(" 添加客户需求变更 "))]),_:1,__:[55]})),[[mt,"project:Customer:insert"]])]),Ee.itemCount>0?(u(),k("div",Yo,"共"+U(Ee.itemCount)+"条",1)):C("",!0)]),_:1})]),default:s(()=>[f.value.needsList.length>0?(u(),T(p(tt),{key:0,columns:Bl,data:f.value.needsList,size:"small","scroll-x":702,"row-key":A=>A.id,pagination:Ee.pageSize==1?!1:Ee,remote:"","paginate-single-page":!1,"max-height":350},null,8,["data","row-key","pagination"])):C("",!0),Ee.itemCount>1?(u(),k("div",Qo,[f.value.needsList.length==1?(u(),k("span",{key:0,onClick:rl},[t[57]||(t[57]=v(" 更多 ")),a(se,{class:"font-size-20px"})])):(u(),k("span",{key:1,onClick:rl},[t[58]||(t[58]=v(" 收起 ")),a(ye,{class:"font-size-20px"})]))])):C("",!0)]),_:1})):C("",!0),te.id===4?(u(),T(Se,{key:3,title:"文件",name:"4"},{default:s(()=>[a(Ft,{data:Wt.value,pid:r.pid,onGetData:t[7]||(t[7]=A=>St(r.pid)),typename:"项目文件",fileType:2},null,8,["data","pid"]),p(P).userInfo.usertype!==1?(u(),T(Ft,{key:0,data:Kt.value,pid:r.pid,onGetData:t[8]||(t[8]=A=>St(r.pid)),typename:"工程文件压缩包",fileType:3},null,8,["data","pid"])):C("",!0),p(P).userInfo.usertype!==1?(u(),T(Ft,{key:1,data:Yt.value,pid:r.pid,onGetData:t[9]||(t[9]=A=>St(r.pid)),typename:"项目现场照片",fileType:4},null,8,["data","pid"])):C("",!0),p(P).userInfo.usertype!==1?(u(),T(Ft,{key:2,data:Qt.value,pid:r.pid,onGetData:t[10]||(t[10]=A=>St(r.pid)),typename:"网络通讯简图",fileType:5},null,8,["data","pid"])):C("",!0),p(P).userInfo.usertype!==1?(u(),T(Ft,{key:3,data:Xt.value,pid:r.pid,onGetData:t[11]||(t[11]=A=>St(r.pid)),typename:"组态画面工程备份",fileType:6},null,8,["data","pid"])):C("",!0)]),_:1})):C("",!0)]),_:2},1032,["expanded-names"]),vt===4?(u(),k("div",Xo)):C("",!0)],64)):C("",!0),Xe===2?(u(),k(Re,{key:2},[a(at,{"default-expanded-names":["1"],"trigger-areas":["arrow"]},{default:s(()=>[te.id===1?(u(),T(Se,{key:0,title:"验收文件",name:"1"},{default:s(()=>[a(Ft,{data:Zt.value,pid:r.pid,onGetData:t[12]||(t[12]=A=>St(r.pid)),typename:"验收确认单拍照",fileType:7},null,8,["data","pid"])]),_:1})):C("",!0)]),_:2},1024),vt===0?(u(),k("div",Zo)):C("",!0)],64)):C("",!0),Xe===3?(u(),k(Re,{key:3},[te.id===1?(u(),k("div",er,[ze((u(),T(p(_),{size:"small",ghost:"",type:"primary",class:"w-160px",onClick:wt(ul,["stop"])},{icon:s(()=>[a(de,{class:"text-icon"})]),default:s(()=>[t[59]||(t[59]=v(" 添加项目总结 "))]),_:1,__:[59]})),[[mt,"project:Customer:insert"]]),Ze.itemCount>0?(u(),k("div",tr,"共"+U(Ze.itemCount)+"条",1)):C("",!0)])):C("",!0),a(p(tt),{class:"h-250px","max-height":250,remote:"",pagination:Ze.pageSize==1?!1:Ze,"scroll-x":Jt.reduce((A,ct)=>A+(ct.width||100),0),columns:Jt,data:Nt.value,bordered:!1,"row-key":A=>A.id,"paginate-single-page":!1,"flex-height":!p(ue).isMobile},null,8,["pagination","scroll-x","data","row-key","flex-height"]),a(xs,{visible:Dt.value,"onUpdate:visible":t[13]||(t[13]=A=>Dt.value=A),onSubmitted:t[14]||(t[14]=A=>bt(r.pid)),"operate-type":(tl=rt.value)!=null&&tl.id?"edit":"add",pid:r.pid,showtype:"detail",pname:(ll=ut.value.find(A=>A.id==r.pid))==null?void 0:ll.proname,"row-data":rt.value},null,8,["visible","operate-type","pid","pname","row-data"]),a(ks,{visible:Ye.value,"onUpdate:visible":t[15]||(t[15]=A=>Ye.value=A),showtype:"detail","row-data":rt.value},null,8,["visible","row-data"])],64)):C("",!0),Xe===4?(u(),k(Re,{key:4},[g("div",lr,[ze((u(),T(p(_),{size:"small",ghost:"",type:"primary",class:"w-160px",onClick:wt(Fa,["stop"])},{icon:s(()=>[a(de,{class:"text-icon"})]),default:s(()=>[t[60]||(t[60]=v(" 添加项目日报 "))]),_:1,__:[60]})),[[mt,"project:Customer:insert"]]),dt.itemCount>0?(u(),k("div",ar,"共"+U(dt.itemCount)+"条",1)):C("",!0)]),a(p(tt),{class:"h-350px","max-height":350,remote:"",pagination:dt.pageSize==1?!1:dt,"scroll-x":ea.reduce((A,ct)=>A+(ct.width||100),0),columns:ea,data:Il.value,bordered:!1,"row-key":A=>A.id,"paginate-single-page":!1,"flex-height":!p(ue).isMobile},null,8,["pagination","scroll-x","data","row-key","flex-height"]),a(ja,{visible:gl.value,"onUpdate:visible":t[16]||(t[16]=A=>gl.value=A),onSubmitted:t[17]||(t[17]=A=>fl(r.pid)),"operate-type":(al=rt.value)!=null&&al.id?"edit":"add",pid:r.pid,pname:(Bt=ut.value.find(A=>A.id==r.pid))==null?void 0:Bt.proname,showtype:"detail","row-data":rt.value},null,8,["visible","operate-type","pid","pname","row-data"]),a(cs,{visible:ta.value,"onUpdate:visible":t[18]||(t[18]=A=>ta.value=A),showtype:"detail","row-data":rt.value},null,8,["visible","row-data"])],64)):C("",!0),Xe===5?(u(),k(Re,{key:5},[g("div",nr,[g("div",null,"共"+U(Ht.value.length)+"条",1)]),a(p(tt),{"max-height":150,style:kt({height:Ht.value.length==1?"100px":"160px"}),remote:"","scroll-x":aa.reduce((A,ct)=>A+(ct.width||100),0),columns:aa,data:Ht.value,bordered:!1,"row-key":A=>A.id,"paginate-single-page":!1,"flex-height":!p(ue).isMobile},null,8,["style","scroll-x","data","row-key","flex-height"])],64)):C("",!0)],8,Po)])}),128))],512),[[Xn,Te.show]])]),_:2},1024)]))),128))])])])),[[tn,Pl.value]])]),_:1}),a(Ut,{show:el.value,"onUpdate:show":t[19]||(t[19]=Te=>el.value=Te),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:s(()=>[v(U(jt.value=="debuggedDevieceList"?"待调试设备":jt.value=="debuggedBusinessList"?"待调试业务":jt.value=="needsList"?"客户需求变更":jt.value=="developBusinessList"?"需要开发":"")+" 文件列表 ",1)]),footer:s(()=>[a(p(Ve),{justify:"end"},{default:s(()=>[a(p(_),{size:"small",class:"mt-16px",onClick:Ka},{default:s(()=>[v(U(p(Q)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",size:"small",class:"mt-16px",onClick:Wa},{default:s(()=>[v(U(p(Q)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(p(tt),{columns:Ga,"paginate-single-page":!1,data:_t.value,"max-height":350},null,8,["data"])]),_:1},8,["show"]),a(et,{show:ra.value,"onUpdate:show":t[20]||(t[20]=Te=>ra.value=Te),"display-directive":"show",width:700},{default:s(()=>[a(nt,{title:"日报","native-scrollbar":!1,closable:""},{default:s(()=>{var Te;return[a(ni,{type:"detail",pid:r.pid,pname:((Te=ut.value.find(Xe=>Xe.id==r.pid))==null?void 0:Te.proname)||"",style:{height:"100%"}},null,8,["pid","pname"])]}),_:1})]),_:1},8,["show"]),a(Cs,{visible:ql.value,"onUpdate:visible":t[21]||(t[21]=Te=>ql.value=Te),pid:r.pid},null,8,["visible","pid"])])}}}),zr=Sl(sr,[["__scopeId","data-v-c878b6f0"]]);export{zr as default};
