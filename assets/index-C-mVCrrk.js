import{_ as G}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BXl-Ecyd.js";import{d as E,q as z,j as K,x as H,s as Q,v as J,b as X,r as Y,ag as Z,o as R,c as ee,w as l,g as t,h as $,t as j,i as a,$ as _,e as L,aq as te,I as oe,a1 as ae,M as ne,L as le,ar as ie,Q as se,B,P as re,ah as de,ai as pe,a5 as ue,G as O,F as V,aj as I,ak as ce,al as me,af as fe}from"./index-Ca20xxPq.js";import{D as _e,E as ye,a as ve,F as ge}from"./events-DvRvB3jb.js";import{u as we,a as be}from"./table-CfafhLXc.js";import{h as q}from"./permission-DgDYN5u2.js";import{_ as he}from"./Popconfirm-Cnq4LZo2.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-51KT36W8.js";import"./setting-outlined-rHoQ6tS_.js";import"./export-dYg14N2r.js";import"./refresh-D3xXALVo.js";import"./round-delete-SCUY1aZa.js";import"./round-plus-BjsjNTPL.js";import"./Upload-DocbNmic.js";import"./Progress-CiMKrS_c.js";const ke=E({name:"OperateDrawer",__name:"operate-drawer",props:z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:z(["submitted"],["update:visible"]),setup(y,{emit:S}){const c=y,v=K([{label:"syslog",value:0},{label:"SNMP Trap",value:1}]),g=S,p=H(y,"visible"),{formRef:x,validate:P,restoreValidation:M}=Q(),{defaultRequiredRule:W,formRules:w}=J(),T=X(()=>({add:"新增转发策略",edit:"编辑转发策略"})[c.operateType]),e=Y(N());function N(){return{ftype:1,community:"",etpnode:"",oidnode:"",ipaddr:"",fport:void 0,fdesc:""}}const C={ipaddr:w.ip,fport:{type:"number",required:!0,trigger:["blur","change"],message:"请输入端口号"}};function m(){Object.assign(e,N()),c.operateType==="edit"&&c.rowData&&Object.assign(e,c.rowData)}function b(){p.value=!1}async function F(){var h,o;if(await P(),c.operateType==="add"){const{data:k,error:r}=await _e([{ftype:e.ftype,community:e.community,etpnode:e.etpnode,oidnode:e.oidnode,ipaddr:e.ipaddr,fport:e.fport,fdesc:e.fdesc}]);r||((h=window.$message)==null||h.success(_("common.addSuccess")),b(),g("submitted"))}else{const{data:k,error:r}=await ye([{id:c.rowData.id,ftype:e.ftype,community:e.community,etpnode:e.etpnode,oidnode:e.oidnode,ipaddr:e.ipaddr,fport:e.fport,fdesc:e.fdesc}]);r||((o=window.$message)==null||o.success(_("common.updateSuccess")),b(),g("submitted"))}}return Z(p,()=>{p.value&&(m(),M())}),(h,o)=>{const k=ae,r=ne,f=le,i=ie,n=se,d=B,D=re,U=de,u=pe;return R(),ee(u,{show:p.value,"onUpdate:show":o[7]||(o[7]=s=>p.value=s),"display-directive":"show",width:360},{default:l(()=>[t(U,{title:T.value,"native-scrollbar":!1,closable:""},{footer:l(()=>[t(D,{size:16},{default:l(()=>[t(d,{onClick:b},{default:l(()=>[$(j(a(_)("common.cancel")),1)]),_:1}),t(d,{type:"primary",onClick:F},{default:l(()=>[$(j(a(_)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[t(n,{ref_key:"formRef",ref:x,model:e,rules:C},{default:l(()=>[t(r,{label:"转发方式",path:"ftype"},{default:l(()=>[t(k,{filterable:"",value:e.ftype,"onUpdate:value":o[0]||(o[0]=s=>e.ftype=s),placeholder:"请选择转发方式",options:v.value,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e.ftype==1?(R(),L(te,{key:0},[t(r,{label:"Community",path:"community"},{default:l(()=>[t(f,{value:e.community,"onUpdate:value":o[1]||(o[1]=s=>e.community=s),placeholder:"请输入community",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"企业节点号",path:"etpnode"},{default:l(()=>[t(f,{value:e.etpnode,"onUpdate:value":o[2]||(o[2]=s=>e.etpnode=s),placeholder:"请输入企业节点号",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"oid节点号",path:"oidnode"},{default:l(()=>[t(f,{value:e.oidnode,"onUpdate:value":o[3]||(o[3]=s=>e.oidnode=s),placeholder:"请输入oid节点号",clearable:""},null,8,["value"])]),_:1})],64)):oe("",!0),t(r,{label:"其它服务器IP",path:"ipaddr"},{default:l(()=>[t(f,{value:e.ipaddr,"onUpdate:value":o[4]||(o[4]=s=>e.ipaddr=s),placeholder:"请输入其它服务器IP",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"端口号",path:"fport"},{default:l(()=>[t(i,{min:0,max:65535,value:e.fport,"onUpdate:value":o[5]||(o[5]=s=>e.fport=s),placeholder:"请输入端口号",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{label:"描述",path:"fdesc"},{default:l(()=>[t(f,{type:"textarea",value:e.fdesc,"onUpdate:value":o[6]||(o[6]=s=>e.fdesc=s),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),De={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function A(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!ce(y)}const je=E({name:"manage_forwardserver",__name:"index",setup(y){const S=ue(),{columns:c,columnChecks:v,data:g,getData:p,loading:x,mobilePagination:P,searchParams:M,resetSearchParams:W}=we({apiFn:ve,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"ftype",title:"转发方式",align:"center",width:160,render:i=>i.ftype==0?"syslog":"SNMP Trap"},{key:"community",title:"Community",align:"center",width:160},{key:"etpnode",title:"企业节点号",align:"center",minWidth:180},{key:"oidnode",title:"oid节点号",align:"center",minWidth:220},{key:"ipaddr",title:"其它服务器IP",align:"center",width:200},{key:"fport",title:"端口号",align:"center",width:140},{key:"fdesc",title:"用户描述",align:"center",minWidth:180,ellipsis:{tooltip:!0}},{key:"operate",title:_("common.operate"),align:"center",render:i=>{let n;return t("div",{class:"flex-center gap-8px"},[O(t(B,{type:"primary",ghost:!0,size:"small",onClick:()=>r(i.id)},A(n=_("common.edit"))?n:{default:()=>[n]}),[[V("no-auth"),"sys.forward.policy.update"]]),t(he,{onPositiveClick:()=>k(i.id)},{default:()=>_("common.confirmDelete"),trigger:()=>{let d;return O(t(B,{type:"error",ghost:!0,size:"small"},A(d=_("common.delete"))?d:{default:()=>[d]}),[[V("no-auth"),"sys.forward.policy.delete"]])}})])}}]}),{drawerVisible:w,operateType:T,editingData:e,handleAdd:N,handleEdit:C,checkedRowKeys:m,onBatchDeleted:b,onDeleted:F,closeDrawer:h}=be(g,p);async function o(){console.log(m.value),f(m.value,i=>{b()})}function k(i){console.log(i),f([i],n=>{F()})}function r(i){C(i)}async function f(i,n){const{data:d,error:D}=await ge(i);if(!D)n&&n(d);else return!1}return(i,n)=>{const d=G,D=me,U=fe;return R(),L("div",De,[t(U,{title:"转发策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[t(d,{columns:a(v),"onUpdate:columns":n[0]||(n[0]=u=>I(v)?v.value=u:null),"disabled-delete":a(m).length===0,loading:a(x),onAdd:a(N),onDelete:o,onRefresh:a(p),"is-view-add-button":a(q)("sys.forward.policy.insert"),"is-view-delete-button":a(q)("sys.forward.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:l(()=>[t(D,{"checked-row-keys":a(m),"onUpdate:checkedRowKeys":n[1]||(n[1]=u=>I(m)?m.value=u:null),columns:a(c),data:a(g),size:"small","flex-height":!a(S).isMobile,"scroll-x":962,loading:a(x),remote:"","row-key":u=>u.id,pagination:a(P),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(ke,{visible:a(w),"onUpdate:visible":n[2]||(n[2]=u=>I(w)?w.value=u:null),"operate-type":a(T),"row-data":a(e),onSubmitted:a(p)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{je as default};
