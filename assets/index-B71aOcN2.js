import{o as S,e as G,f as k,d as ce,j as m,a$ as J,g as o,v as ue,ai as de,w as c,c as L,h as y,t as b,i as x,B as $,b0 as R,a3 as K,aQ as j,au as ie,x as M,F as V,b1 as A,b2 as W,b3 as Q,aD as q,af as pe,b4 as _e,O as ve,b5 as fe,b6 as me,a5 as he,as as ye,Q as ke,R as ge,S as we}from"./index-CM2axccV.js";import{h as F}from"./permission-vEy4h1qB.js";import{_ as be}from"./Tree-eLdBA3T_.js";import{_ as xe}from"./Slider-D5mQs8uW.js";import{_ as Ne}from"./Split-DUiw9VGs.js";const Ce={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},$e=k("path",{fill:"currentColor",d:"M17 9.17a1 1 0 0 0-1.41 0L12 12.71L8.46 9.17a1 1 0 0 0-1.41 0a1 1 0 0 0 0 1.42l4.24 4.24a1 1 0 0 0 1.42 0L17 10.59a1 1 0 0 0 0-1.42"},null,-1),Se=[$e];function Oe(O,E){return S(),G("svg",Ce,[...Se])}const Te={name:"uil-angle-down",render:Oe},Ie=O=>(ke("data-v-4a352b7d"),O=O(),ge(),O),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ze={class:"flex h-100%",style:{"flex-direction":"column"}},De={class:"flex"},Le=Ie(()=>k("span",null,"监测级别",-1)),Ue={class:"flex items-center"},Re={class:"flex items-center"},je={class:"cursor-pointer"},Ae=ce({name:"configsetting_realtimedata_channeldetection",__name:"index",setup(O){const E=m({0:"简单",1:"标准",2:"详细"}),N=m(!0),g=m([]),w=m(null),X=m([{title:"监视时间",key:"time",width:240,render(e){return J(2,e.time)}},{title:"监视类型",key:"data_type",width:120,render(e){return e.data_type==0?"发送>>":e.data_type==1?"接收<<":e.data_type==2?"信息  ":e.data_type==3?"警告  ":"错误  "}},{title:"内容长度",key:"data_len",width:120},{title:"监视内容",key:"data_buf",render(e){return o("div",{innerHTML:e.data_buf},null)}}]),t=m({acceptColor:"#d6f0f0",sendOutColor:"#ffe3bf",infoColor:"#f4f4f5",warningColor:"#fdf6ec",errorColor:"#fee7e7",acceptNums:0,sendOutNums:0,infoNums:0,errorNums:0,warningNums:0}),Y=[{label:"信息",key:0},{label:"警告",key:1},{label:"错误",key:2}],Z=e=>j(R,{value:e.key==0?t.value.infoNums:e.key==1?t.value.warningNums:t.value.errorNums},{default:()=>j("div",{class:"c-#676d71 w-50px h-32px flex items-center justify-center",style:{backgroundColor:e.key==0?t.value.infoColor:e.key==1?t.value.warningColor:t.value.errorColor,borderRadius:"4px"}},{default:()=>e.label})}),ee=e=>({style:{minHeight:"50px",background:e.data_type==0?t.value.sendOutColor:e.data_type==1?t.value.acceptColor:e.data_type==2?t.value.infoColor:e.data_type==3?t.value.warningColor:t.value.errorColor}}),te=({option:e})=>e.key==0?"":e.chl_status!==null?j("span",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:e.hasOwnProperty("chl_status")&&e.chl_status==1?"#00b42a":e.chl_status==2?"#ff0000":"#ccc"}}):"",C=m(),ae=async()=>{var l,_,n,h;const{data:e,error:a}=await ie();if((e==null?void 0:e.length)==0)return;const u=e.reduce((v,d)=>{const i=d.chlType===0?"采集通道":d.chlType===1?"转发通道":"系统通道";let f=v.find(s=>s.key===i);return f||(f={key:i,label:i,children:[],chl_status:null},v.push(f)),f.children.push({key:d.id,label:d.chlName,chlType:d.chlType,chl_status:null}),i=="系统通道"?[]:v},[]);C.value=u,C.value.length>0&&(p.value.chlId=(_=(l=C.value[0])==null?void 0:l.children[0])==null?void 0:_.key,z.value=[(h=(n=C.value[0])==null?void 0:n.children[0])==null?void 0:h.key],ne(),B())},p=m({chlId:"",type:1,level:1}),I=m(null),B=()=>{var h,v,d;if((h=I.value)==null||h.close(),!F("channel:detection:websocket")){(v=window.$message)==null||v.destroyAll(),(d=window.$message)==null||d.warning("暂无权限连接websocket");return}t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0};const e=new Date().getTime(),a=p.value.level==0?"1":p.value.level==1?"257":"65793";p.value.type=1;const u=M(),l=V(`${u}${e}${p.value.chlId}`),_=A(l),n=new W(Q+`/ChannelDetectionWebsocket/${p.value.chlId}/${p.value.type}/${a}/${_}/${e}/${u}?token=${q()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});I.value=n,n.connect(),n.onclose(()=>{}),n.onerror(()=>{}),n.onopen(()=>{}),n.onmessage(i=>{if(console.log(i,"通道监测websocket接受数据"),!H(i.data))return;const f=JSON.parse(i.data);if(g.value.push(...f.param),N.value&&w.value){const r=document.querySelector(".n-scrollbar-content"),D=r==null?void 0:r.scrollHeight;r&&pe(()=>{w.value.scrollTo({top:D,behavior:"smooth"})})}t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0};let s=`      监视时间                  监视类型      内容长度          监视内容
`,T="";g.value.forEach(r=>{switch(r.data_type){case 0:t.value.sendOutNums+=1;break;case 1:t.value.acceptNums+=1;break;case 2:t.value.infoNums+=1;break;case 3:t.value.warningNums+=1;break;case 4:t.value.errorNums+=1;break}T+=J(2,r.time)+"           "+(r.data_type==0?"发送>>":r.data_type==1?"接受<<":r.data_type==2?"信息  ":r.data_type==3?"警告  ":"错误  ")+"         "+r.data_len+"          "+r.data_buf+`
`}),w.value.content=s+T,g.value.length>=1e3&&(g.value=[])})},U=m(null),ne=()=>{var h,v,d;if((h=U.value)==null||h.close(),!F("channel:status:websocket")){(v=window.$message)==null||v.destroyAll(),(d=window.$message)==null||d.warning("暂无权限连接websocket");return}const e=new Date().getTime(),a=M(),u=V(`${a}${e}getchlstatus`),l=A(u),_=A("getchlstatus"),n=new W(Q+`/ChannelStatusWebsocket/${_}/${l}/${e}/${a}?token=${q()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});U.value=n,n.connect(),n.onclose(()=>{}),n.onerror(()=>{}),n.onopen(()=>{}),n.onmessage(i=>{let f=[];console.log(i,"通道状态websocket接受数据"),H(i.data)&&(f=JSON.parse(i.data).data,C.value.forEach(s=>{var T;(T=s.children)==null||T.forEach(r=>{f.forEach(D=>{D.chl_id==r.key&&(r.chl_status=D.chl_status)})})}))})};ue(()=>{ae()}),de(()=>{var e,a;(e=I.value)==null||e.close(),(a=U.value)==null||a.close()});const z=m([]),le=async(e,a,u)=>{var l,_,n;((l=u.node)==null?void 0:l.key)!=z.value[0]&&(z.value=[(_=u.node)==null?void 0:_.key],p.value.chlId=(n=u.node)==null?void 0:n.key,g.value=[],B())},se=e=>{g.value=[],B()},P=e=>{p.value.type=e,I.value.close(),e==1&&B()},oe=()=>{g.value=[],t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0},w.value.content=""},re=()=>{let e=w.value.content?w.value.content+"":w.value.content,a=new _e(".Btn",{text:function(){return e}});a.on("success",u=>{var l;(l=window.$message)==null||l.success("复制成功"),a.destroy()}),a.on("error",u=>{var l;(l=window.$message)==null||l.error("复制失败"),a.destroy()})},H=e=>{try{return JSON.parse(e),!0}catch{return!1}};return(e,a)=>{const u=be,l=ve,_=xe,n=fe,h=Te,v=me,d=he,i=ye,f=Ne;return S(),G("div",Be,[o(d,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:c(()=>[o(f,{direction:"horizontal",class:"sm:h-full","default-size":.15,max:.35,min:.1,"resize-trigger-size":6},{1:c(()=>[o(u,{"block-line":"","default-expand-all":"",data:C.value,"checked-keys":z.value,"expand-on-click":!1,"check-strategy":"child","onUpdate:checkedKeys":le,"render-prefix":te,checkable:""},null,8,["data","checked-keys"])]),2:c(()=>[k("div",ze,[o(d,{bordered:!1,size:"small",class:"card-wrapper",style:{"min-height":"60px"}},{header:c(()=>[o(l,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:c(()=>[p.value.type==0?(S(),L(x($),{key:0,onClick:a[0]||(a[0]=s=>P(1))},{default:c(()=>[y(b("开启监视"))]),_:1})):(S(),L(x($),{key:1,onClick:a[1]||(a[1]=s=>P(0))},{default:c(()=>[y(b("停止监视"))]),_:1})),N.value?(S(),L(x($),{key:3,onClick:a[3]||(a[3]=s=>N.value=!N.value)},{default:c(()=>[y(b("停止滚屏"))]),_:1})):(S(),L(x($),{key:2,onClick:a[2]||(a[2]=s=>N.value=!N.value)},{default:c(()=>[y(b("开启滚屏"))]),_:1})),o(x($),{onClick:oe},{default:c(()=>[y(b("清空列表"))]),_:1}),o(x($),{onClick:re,class:"Btn"},{default:c(()=>[y(b("复制全部内容"))]),_:1})]),_:1})]),"header-extra":c(()=>[o(l,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:c(()=>[k("div",De,[Le,o(_,{value:p.value.level,"onUpdate:value":[a[4]||(a[4]=s=>p.value.level=s),se],step:1,marks:E.value,min:0,max:2,style:{margin:"0 10px",width:"170px !important"}},null,8,["value","marks"])]),k("div",Ue,[y(" 发送报文颜色 "),o(n,{class:"w-24px h-24px ml-5px",swatches:["#ffe3bf","#d6f0f0"],value:t.value.sendOutColor,"onUpdate:value":a[5]||(a[5]=s=>t.value.sendOutColor=s)},null,8,["value"])]),k("div",Re,[y(" 接受报文颜色 "),o(n,{class:"w-24px h-24px ml-5px",swatches:["#ffe3bf","#d6f0f0"],value:t.value.acceptColor,"onUpdate:value":a[6]||(a[6]=s=>t.value.acceptColor=s)},null,8,["value"])]),o(x(R),{value:t.value.sendOutNums},{default:c(()=>[k("div",{style:K({background:t.value.sendOutColor}),class:"c-#676d71 w-50px h-32px flex items-center justify-center"},b("发送"),4)]),_:1},8,["value"]),o(x(R),{value:t.value.acceptNums},{default:c(()=>[k("div",{style:K({background:t.value.acceptColor}),class:"c-#676d71 w-50px h-32px flex items-center justify-center"},b("接收"),4)]),_:1},8,["value"]),o(v,{trigger:"click",options:Y,"render-label":Z},{default:c(()=>[k("span",je,[y("其他类型 "),o(h,{class:"font-size-20px"})])]),_:1})]),_:1})]),_:1}),o(i,{columns:X.value,ref_key:"tableRef",ref:w,data:g.value,size:"small",remote:"","row-key":s=>s.id,"flex-height":!0,"scroll-x":"",class:"sm:h-full flex-1 pl-16px","row-props":ee},null,8,["columns","data","row-key"])])]),_:1})]),_:1})])}}}),Me=we(Ae,[["__scopeId","data-v-4a352b7d"]]);export{Me as default};
