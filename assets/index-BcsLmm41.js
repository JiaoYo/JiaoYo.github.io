import{_ as Pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DInf_94l.js";import{d as Z,q as ue,v as be,s as se,K as ne,o as V,c as H,w as r,g as t,L as X,h as w,t as q,i as c,$ as C,M as Le,A as ie,B as x,E as G,D as ge,a9 as he,r as ce,j as ye,J as _e,f as re,aK as te,X as U,aj as oe,U as de,an as we,bf as xe,a$ as je,S as pe,ay as me,x as Ne,b as Re,y as $e,e as De,ag as Fe,ah as ze,ai as Ve,C as Me,aV as Ee,F as Be,Z as Oe,am as fe,ar as Ge,ac as ae,ad as Qe}from"./index-D4ngyqj9.js";import{u as He,a as Je}from"./table-B-O-KQBR.js";import{_ as Ke}from"./round-search-afmjBCkU.js";import{_ as qe}from"./round-refresh-DGUmO54G.js";import{_ as We}from"./FormItemGridItem-tGN8LyML.js";import{_ as Xe}from"./Grid-3ti0RnUO.js";import{u as J}from"./usePageData-C8tvUOsP.js";import{a as Se,T as Ze}from"./basicconf-WyoYeKK_.js";import{j as Ye,g as ea,a as aa,k as la,l as ta,h as oa,e as na}from"./events-BF-GCmFQ.js";import{p as ke,t as Ce}from"./Collection-k2nMxicP.js";import{f as Te,a as Ue}from"./common-mZ_0_M7V.js";import{_ as W}from"./Popconfirm-DsZjOQOD.js";import{_ as Ae}from"./Tree-BZVxx32V.js";import{a as sa,b as ia,_ as ua}from"./DataTable-Bkf-sC_U.js";import{h as ve}from"./permission-Ble3lU0D.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-QeSS3CPK.js";import"./setting-outlined-DuD7pXau.js";import"./round-delete-DNpSdI2L.js";import"./refresh-CahwNtd4.js";import"./Upload-B89re_JK.js";import"./Progress-Q6s-Jzjc.js";import"./Forward-Bpby_coU.js";const ra=Z({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ue(["reset","search"],["update:model"]),setup(j,{emit:m}){const e=m,{formRef:S,restoreValidation:h}=be(),y=se(j,"model");function D(){y.value.fuzzy=void 0,e("search")}async function P(){await h(),e("reset")}async function E(){e("search")}return(L,o)=>{const A=ie,I=We,N=qe,k=x,_=Ke,R=G,$=Xe,M=ge,T=he,F=ne("no-space");return V(),H(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[t(M,{ref_key:"formRef",ref:S,model:y.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Le(E,["enter"])},{default:r(()=>[t($,{responsive:"screen","item-responsive":""},{default:r(()=>[t(I,{span:"24 s:12 m:6",label:"策略名称",path:"fuzzy",class:"pr-24px"},{default:r(()=>[X(t(A,{clearable:"",value:y.value.fuzzy,"onUpdate:value":o[0]||(o[0]=n=>y.value.fuzzy=n),placeholder:"请输入策略名称",onClear:D},null,8,["value"]),[[F]])]),_:1}),t(I,{span:"24 m:4",class:"pr-24px"},{default:r(()=>[t(R,{class:"w-full"},{default:r(()=>[t(k,{onClick:P},{icon:r(()=>[t(N,{class:"text-icon"})]),default:r(()=>[w(" "+q(c(C)("common.reset")),1)]),_:1}),t(k,{type:"primary",ghost:"",onClick:E},{icon:r(()=>[t(_,{class:"text-icon"})]),default:r(()=>[w(" "+q(c(C)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),da=Z({name:"ConditionTree",__name:"conditionTree",props:{data:{default:[]},dataModifiers:{}},emits:["update:data"],setup(j){const m=se(j,"data"),e=ce({showValueDom:1,obj:{colume:void 0,option:void 0,value:void 0},options1:[{value:"addr0",label:"发生源IP 数字",type:"long"},{value:"addr1",label:"源IP 数字",type:"long"},{value:"addr2",label:"目的IP 数字 ",type:"long"},{value:"ip0",label:"发生源IP",type:"string"},{value:"ip1",label:"源IP",type:"string"},{value:"ip2",label:"目的IP",type:"string"},{value:"port1",label:"源端口",type:"int"},{value:"port2",label:"目的端口",type:"int"},{value:"mac1",label:"源MAC地址",type:"string"},{value:"mac2",label:"目的MAC",type:"string"},{value:"category",label:"发生源设备类别",type:"int"},{value:"device",label:"发生源设备类型",type:"int"},{value:"kind",label:"事件类别",type:"int"},{value:"type",label:"事件类型",type:"int"},{value:"level",label:"事件等级",type:"int"},{value:"proType",label:"日志来源协议",type:"string"},{value:"protocol",label:"协议",type:"string"},{value:"code",label:"关键字",type:"string"}],options2:[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],options3:[]});function S({option:n}){return t("div",{style:{display:"flex",alignItems:"center"}},[t("div",{class:"flex-center  mr-30px",style:{gap:"8px 20px"}},[n.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>L("||或",n)},{default:()=>[w("||或")]}),n.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>L("&&与",n)},{default:()=>[w("&&与")]}),n.children&&t(W,{onPositiveClick:()=>o(n),showIcon:!1,show:n.isShow,onNegativeClick:()=>n.isShow=!1,onUpdateShow:s=>{e.obj={colume:void 0,option:void 0,value:void 0},e.showValueDom=1}},{default:te(t(G,null,{default:()=>[t(U,{options:e.options1,value:e.obj.colume,"onUpdate:value":s=>P(s),placeholder:"请选择",style:{width:"180px"}},null),t(U,{options:e.options2,value:e.obj.option,"onUpdate:value":s=>e.obj.option=s,placeholder:"请选择",style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="category"||e.obj.colume=="device")&&t(U,{clearable:!0,options:e.options3,key:e.obj.colume,value:e.obj.value,placeholder:"请选择",labelField:e.obj.colume=="category"?"cname":e.obj.colume=="device"?"type":"",valueField:"id",onScroll:s=>F(s),"onUpdate:value":s=>e.obj.value=s,style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="kind"||e.obj.colume=="type"||e.obj.colume=="level")&&t(U,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,"onUpdate:value":s=>e.obj.value=s,style:{width:"180px"},placeholder:"请选择"},null),e.showValueDom==1&&t(ie,{clearable:!0,value:e.obj.value,"onUpdate:value":s=>e.obj.value=s},null),e.showValueDom==0&&t(oe,{clearable:!0,value:e.obj.value,"onUpdate:value":s=>e.obj.value=s},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>n.isShow=!0},{default:()=>[w("配置")]})}),t(x,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>A(n)},{default:()=>[w("删除")]})])])}const h=ye(1),y=()=>(h.value++,h.value),D=()=>{const n=s=>{let b=-1/0;const i=a=>{for(const l of a)l.id>b&&(b=l.id),l.children&&i(l.children)};return i(s),b};h.value=n(m.value)};_e(()=>{setTimeout(()=>{m.value.length>0&&D()},500)});const P=async n=>{const s=["addr0","addr1","addr2"],b=["ip0","ip1","ip2","mac1","mac2","port1","port2","proType","protocol","code"];s.includes(n)?e.showValueDom=0:b.includes(n)?e.showValueDom=1:e.showValueDom=2,n=="category"?(await N(),e.options3=I.data):n=="device"?(await R(),e.options3=_.data):n=="kind"?M():n=="type"?T():n=="level"&&(e.options3=de(Se)),["ip0","ip1","ip2","mac1","mac2","proType","protocol","code"].includes(n)?e.options2=[{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"},{label:"匹配",value:"MATCH"}]:e.options2=[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],e.obj.option=e.options2[0].value,e.obj.colume=n,e.obj.value=void 0},E=n=>{m.value.length>0||(m.value.push({label:n,id:1,isShow:!1,children:[]}),h.value=1)},L=(n,s)=>{s.children.push({label:n,id:y(),children:[],isShow:!1})},o=n=>{var l,u,d,p,f,B,Q;if(!e.obj.colume)return(l=window.$message)==null?void 0:l.warning("选择的信息项不能为空");if(e.obj.value==null)return(u=window.$message)==null?void 0:u.warning("条件值不能为空");const s=["ip0","ip1","ip2"],b=["mac1","mac2"],i=["port1","port2"];if(s.includes(e.obj.colume)&&!we(e.obj.value))return(d=window.$message)==null?void 0:d.warning("请输入正确的IP地址");if(b.includes(e.obj.colume)&&!xe(e.obj.value))return(p=window.$message)==null?void 0:p.warning("请输入正确的MAC地址");if(i.includes(e.obj.colume)&&!je(e.obj.value))return(f=window.$message)==null?void 0:f.warning("请输入正确的端口号");let a=e.obj.value;if(e.showValueDom==2)if(e.obj.colume=="category"||e.obj.colume=="device"){const g=e.options3.find(O=>O.id==e.obj.value);a=e.obj.colume=="category"?g==null?void 0:g.cname:g==null?void 0:g.type}else{const g=e.options3.find(O=>O.value==e.obj.value);a=g==null?void 0:g.label}n.children.push({colume:e.obj.colume,option:e.obj.option,value:e.obj.value,id:y(),label:`${(B=e.options1.find(g=>g.value==e.obj.colume))==null?void 0:B.label} ${(Q=e.options2.find(g=>g.value==e.obj.option))==null?void 0:Q.label} ${a} `,flag:!1}),e.obj={colume:void 0,option:void 0,value:void 0},e.showValueDom=1,n.isShow=!1},A=n=>{console.log(n,"row");function s(b,i){return b.reduce((a,l)=>(l.id===i||(l.children&&(l.children=s(l.children,i)),a.push(l)),a),[])}m.value=s(m.value,n.id)},{pageData:I,getData:N,nextPage:k}=J(ke),{pageData:_,getData:R,nextPage:$}=J(Ce),M=async()=>{const{data:n,error:s}=await Te();console.log(n),e.options3=n.map(b=>({label:b.pname,value:b.id}))},T=async()=>{const{data:n,error:s}=await Ue();console.log(n),e.options3=n.map(b=>({label:b.pname,value:b.id}))},F=async n=>{const s=n.currentTarget;s.scrollTop+s.offsetHeight>=s.scrollHeight&&(e.obj.colume=="category"&&k(),e.obj.colume=="device"&&$())};return(n,s)=>{const b=Ae,i=pe;return V(),H(i,{class:"h-220px",style:{border:"1px solid #dcdcdc","border-radius":"6px"}},{default:r(()=>[t(c(G),{justify:"end",class:"p-5px"},{default:r(()=>[re("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:s[0]||(s[0]=a=>E("||或"))},"||或"),re("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:s[1]||(s[1]=a=>E("&&与"))},"&&与")]),_:1}),(V(),H(b,{"block-line":"",data:m.value,"default-expand-all":"",selectable:!1,"render-suffix":S,key:h.value,"key-field":"id"},null,8,["data"]))]),_:1})}}}),ca=me(da,[["__scopeId","data-v-8027c5a8"]]),pa=Z({name:"RelationRuleTree",__name:"relationRuleTree",props:{data:{default:[]},dataModifiers:{}},emits:["update:data"],setup(j){const m=se(j,"data"),e=ce({showValueDom:1,obj:{colume:void 0,option:void 0,value:void 0,duration:60,times:2,columns:[],ishappen:1},options1:[{value:"addr0",label:"发生源IP 数字",type:"long"},{value:"addr1",label:"源IP 数字",type:"long"},{value:"addr2",label:"目的IP 数字 ",type:"long"},{value:"ip0",label:"发生源IP",type:"string"},{value:"ip1",label:"源IP",type:"string"},{value:"ip2",label:"目的IP",type:"string"},{value:"port1",label:"源端口",type:"int"},{value:"port2",label:"目的端口",type:"int"},{value:"mac1",label:"源MAC地址",type:"string"},{value:"mac2",label:"目的MAC",type:"string"},{value:"category",label:"发生源设备类别",type:"int"},{value:"device",label:"发生源设备类型",type:"int"},{value:"kind",label:"事件类别",type:"int"},{value:"type",label:"事件类型",type:"int"},{value:"level",label:"事件等级",type:"int"},{value:"proType",label:"日志来源协议",type:"string"},{value:"protocol",label:"协议",type:"string"},{value:"code",label:"关键字",type:"string"}],options2:[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],options3:[]});function S({option:a}){return t("div",{style:{display:"flex",alignItems:"center"}},[t("span",{style:{minWidth:"50px"}},[a.label]),t("div",{class:"flex-center mx-30px",style:{gap:"8px 20px"}},[a.children&&!a.logic&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>o("||或",a)},{default:()=>[w("||或")]}),a.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>o("&&与",a)},{default:()=>[w("&&与")]}),a.children&&!a.logic&&!a.times&&!a.duration&&t(W,{onPositiveClick:()=>A(a),showIcon:!1,show:a.isShow,onNegativeClick:()=>a.isShow=!1},{default:te(t(G,null,{default:()=>[t(U,{options:e.options1,value:e.obj.colume,"onUpdate:value":l=>E(l),placeholder:"请选择",style:{width:"180px"}},null),t(U,{options:e.options2,value:e.obj.option,"onUpdate:value":l=>e.obj.option=l,placeholder:"请选择",style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="category"||e.obj.colume=="device")&&t(U,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,labelField:e.obj.colume=="category"?"cname":e.obj.colume=="device"?"type":"",placeholder:"请选择",onScroll:l=>i(l),valueField:"id","onUpdate:value":l=>e.obj.value=l,style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="kind"||e.obj.colume=="type"||e.obj.colume=="level")&&t(U,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,"onUpdate:value":l=>e.obj.value=l,style:{width:"180px"},placeholder:"请选择"},null),e.showValueDom==1&&t(ie,{clearable:!0,value:e.obj.value,"onUpdate:value":l=>e.obj.value=l},null),e.showValueDom==0&&t(oe,{clearable:!0,value:e.obj.value,"onUpdate:value":l=>e.obj.value=l},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>a.isShow=!0},{default:()=>[w("配置")]})}),a.children&&a.times&&a.duration&&t(W,{onPositiveClick:()=>I(a),showIcon:!1},{default:te(t(G,null,{default:()=>[t(oe,{style:{width:"140px"},clearable:!0,value:e.obj.duration,"onUpdate:value":l=>e.obj.duration=l},null),t(oe,{style:{width:"140px"},clearable:!0,value:e.obj.times,"onUpdate:value":l=>e.obj.times=l},null),t(U,{clearable:!0,options:e.options1,value:e.obj.columns,multiple:!0,"onUpdate:value":l=>e.obj.columns=l,placeholder:"请选择",style:{width:"180px"}},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>{e.obj.columns=a.columns,e.obj.duration=a.duration,e.obj.times=a.times}},{default:()=>[w("配置")]})}),a.children&&a.logic&&t(W,{onPositiveClick:()=>h(a),showIcon:!1},{default:te(t(G,null,{default:()=>[t(U,{clearable:!0,options:[{label:"发生",value:1},{label:"不发生",value:0}],value:e.obj.ishappen,"onUpdate:value":l=>e.obj.ishappen=l,placeholder:"请选择",style:{width:"180px"}},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>e.obj.ishappen=a.ishappen},{default:()=>[w("配置")]})}),!a.logic&&t(x,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>N(a)},{default:()=>[w("删除")]})]),a.duration&&a.times&&t("span",null,["在"+a.duration+"秒内，发生"+a.times+"次   归并字段："+k(a.columns)])])}const h=a=>{const l=/状态(\d+)/g;let u;const d=[];for(;(u=l.exec(a.label))!==null;)d.push(u[1]);a.ishappen=e.obj.ishappen,a.label=`状态${d[0]}之后${e.obj.ishappen?"发生":"不发生"}状态${d[1]}`},y=ye(1),D=()=>y.value+=1,P=()=>{const a=l=>{let u=-1/0;const d=p=>{for(const f of p)f.id>u&&(u=f.id),f.children&&d(f.children)};return d(l),u};y.value=a(m.value)};_e(()=>{setTimeout(()=>{m.value.length>0&&P()},500)});const E=async a=>{const l=["addr0","addr1","addr2"],u=["ip0","ip1","ip2","mac1","mac2","port1","port2","proType","protocol","code"];l.includes(a)?e.showValueDom=0:u.includes(a)?e.showValueDom=1:e.showValueDom=2,a=="category"?(await $(),e.options3=R.data):a=="device"?(await F(),e.options3=T.data):a=="kind"?s():a=="type"?b():a=="level"&&(e.options3=[]),["ip0","ip1","ip2","mac1","mac2","proType","protocol","code"].includes(a)?e.options2=[{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"},{label:"匹配",value:"MATCH"}]:e.options2=[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],e.obj.option=e.options2[0].value,e.obj.colume=a,e.obj.value=void 0},L=()=>{if(m.value.length==0){m.value.push({label:"状态1",id:1,children:[],duration:60,times:2,columns:[]});return}const a=(m.value.length-1)/2+1;m.value.push({label:`状态${a}之后发生状态${a+1}`,id:D(),ishappen:1,logic:"and",children:[]});const l=m.value[m.value.length-1].id;m.value.push({label:`状态${a+1}`,id:D(),subId:l,children:[],duration:60,times:2,columns:[]})},o=(a,l)=>{l.children.push({label:a,id:D(),children:[],isShow:!1})},A=a=>{var f,B,Q,g,O,Y,K;if(!e.obj.colume)return(f=window.$message)==null?void 0:f.warning("选择的信息项不能为空");if(e.obj.value==null)return(B=window.$message)==null?void 0:B.warning("条件值不能为空");const l=["ip0","ip1","ip2"],u=["mac1","mac2"],d=["port1","port2"];if(l.includes(e.obj.colume)&&!we(e.obj.value))return(Q=window.$message)==null?void 0:Q.warning("请输入正确的IP地址");if(u.includes(e.obj.colume)&&!xe(e.obj.value))return(g=window.$message)==null?void 0:g.warning("请输入正确的MAC地址");if(d.includes(e.obj.colume)&&!je(e.obj.value))return(O=window.$message)==null?void 0:O.warning("请输入正确的端口号");let p=e.obj.value;if(e.showValueDom==2){const z=e.options3.find(ee=>ee.value==e.obj.value);p=z==null?void 0:z.label}a.children.push({colume:e.obj.colume,option:e.obj.option,value:e.obj.value,id:D(),label:`${(Y=e.options1.find(z=>z.value==e.obj.colume))==null?void 0:Y.label} ${(K=e.options2.find(z=>z.value==e.obj.option))==null?void 0:K.label} ${p} `,flag:!1}),_(),a.isShow=!1},I=a=>{a.duration=e.obj.duration,a.times=e.obj.times,a.columns=e.obj.columns},N=a=>{function l(u,d){return u.reduce((p,f)=>(d.includes(f.id)||(f.children&&(f.children=l(f.children,d)),p.push(f)),p),[])}a.subId?m.value=l(m.value,[a.id,a.subId]):m.value=l(m.value,[a.id])},k=a=>{let l="";return a.forEach((u,d)=>{var p;l+=`${(p=e.options1.find(f=>f.value==u))==null?void 0:p.label}${d==a.length-1?"":"、"}`}),l},_=()=>{e.obj={colume:void 0,option:void 0,value:void 0,duration:60,times:2,ishappen:1,columns:[]}},{pageData:R,getData:$,nextPage:M}=J(ke),{pageData:T,getData:F,nextPage:n}=J(Ce),s=async()=>{const{data:a,error:l}=await Te();console.log(a),e.options3=a.map(u=>({label:u.pname,value:u.id}))},b=async()=>{const{data:a,error:l}=await Ue();console.log(a),e.options3=a.map(u=>({label:u.pname,value:u.id}))},i=async a=>{const l=a.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&(e.obj.colume=="category"&&M(),e.obj.colume=="device"&&n())};return(a,l)=>{const u=Ae,d=pe;return V(),H(d,{class:"h-220px",style:{border:"1px solid #dcdcdc","border-radius":"6px"}},{default:r(()=>[t(c(G),{justify:"end",class:"p-5px"},{default:r(()=>[re("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:L},"㊉ 新增关联状态")]),_:1}),(V(),H(u,{"block-line":"",data:m.value,"default-expand-all":"",selectable:!1,"render-label":S,"key-field":"id",key:y.value},null,8,["data"]))]),_:1})}}}),ma=me(pa,[["__scopeId","data-v-0bdad4b6"]]),fa=Z({name:"OperateDrawer",__name:"operate-drawer",props:ue({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ue(["submitted"],["update:visible"]),setup(j,{emit:m}){const e=j,S=m,h=se(j,"visible"),{formRef:y,validate:D,restoreValidation:P}=be(),{defaultRequiredRule:E}=Ne(),L=Re(()=>({add:"新增关联策略",edit:"修改关联策略"})[e.operateType]),o=ce(A());function A(){return{aname:"",adesc:"",acond:[],arules:[],eid:null,elevel:null,fid:null,etext:"",syspara:1,dbtime:"",status:1}}const I={aname:E,eid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"}};async function N(){var a;if(await R(),await F(),Object.assign(o,A()),e.operateType==="edit"&&e.rowData){const{data:l,error:u}=await Ye(e.rowData.id);u||(Object.assign(o,l),o.fid=(a=o.fid)==null?void 0:a.split(","),o.acond=l.acond.replace(/&amp;/g,"&"),o.arules=l.arules.replace(/&amp;/g,"&"),o.acond=JSON.parse(o.acond),o.arules=JSON.parse(o.arules))}}function k(){h.value=!1}const{pageData:_,getData:R,nextPage:$}=J(ea),M=async a=>{const l=a.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&_.data.length<_.total&&$()},{pageData:T,getData:F,nextPage:n}=J(aa),s=async a=>{const l=a.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&T.data.length<T.total&&n()},b=a=>a.ipaddr+":"+a.fport+" ("+(a.ftype==0?"syslog":"SNMP Trap")+")";async function i(){var a,l,u,d;if(console.log(o.acond),console.log(o.arules),await D(),e.operateType==="add"){const{data:p,error:f}=await la([{acond:JSON.stringify(o.acond),adesc:o.adesc,aname:o.aname,arules:JSON.stringify(o.arules),dbtime:o.dbtime,eid:o.eid,elevel:o.elevel,fid:(a=o.fid)==null?void 0:a.join(","),etext:o.etext,syspara:o.syspara,status:o.status}]);f||((l=window.$message)==null||l.success(C("common.addSuccess")),k(),S("submitted"))}else{const{data:p,error:f}=await ta([{id:e.rowData.id,acond:JSON.stringify(o.acond),adesc:o.adesc,aname:o.aname,arules:JSON.stringify(o.arules),dbtime:o.dbtime,eid:o.eid,elevel:o.elevel,fid:(u=o.fid)==null?void 0:u.join(","),etext:o.etext,syspara:o.syspara,status:o.status}]);f||((d=window.$message)==null||d.success(C("common.updateSuccess")),k(),S("submitted"))}}return $e(h,()=>{h.value&&(N(),P())}),(a,l)=>{const u=ie,d=Me,p=U,f=ia,B=G,Q=sa,g=Ee,O=ge,Y=pe,K=x,z=Be,ee=ne("no-space");return V(),H(z,{show:h.value,"onUpdate:show":l[10]||(l[10]=v=>h.value=v),title:L.value,preset:"card",class:"w-800px"},{footer:r(()=>[t(B,{size:16,justify:"center"},{default:r(()=>[t(K,{onClick:k},{default:r(()=>[w(q(c(C)("common.cancel")),1)]),_:1}),t(K,{type:"primary",onClick:i},{default:r(()=>[w(q(c(C)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(Y,{class:"max-h-480px pr-20px"},{default:r(()=>[t(O,{ref_key:"formRef",ref:y,model:o,rules:I,"label-placement":"top","label-width":"120"},{default:r(()=>[t(d,{label:"策略名称",path:"aname"},{default:r(()=>[X(t(u,{value:o.aname,"onUpdate:value":l[0]||(l[0]=v=>o.aname=v),clearable:"",placeholder:"请输入策略名称"},null,8,["value"]),[[ee]])]),_:1}),t(d,{label:"策略描述",path:"adesc"},{default:r(()=>[X(t(u,{type:"textarea",value:o.adesc,"onUpdate:value":l[1]||(l[1]=v=>o.adesc=v),placeholder:"请输入策略描述",clearable:""},null,8,["value"]),[[ee]])]),_:1}),t(d,{label:"条件",path:"acond"},{default:r(()=>[t(ca,{data:o.acond,"onUpdate:data":l[2]||(l[2]=v=>o.acond=v)},null,8,["data"])]),_:1}),t(d,{label:"关联规则",path:"arules"},{default:r(()=>[t(ma,{data:o.arules,"onUpdate:data":l[3]||(l[3]=v=>o.arules=v)},null,8,["data"])]),_:1}),t(d,{label:"事件名称",path:"eid"},{default:r(()=>[t(p,{value:o.eid,"onUpdate:value":l[4]||(l[4]=v=>o.eid=v),placeholder:"请选择事件名称",clearable:"",filterable:"","value-field":"id","label-field":"ename",options:c(_).data,"reset-menu-on-options-change":!1,onScroll:M},null,8,["value","options"])]),_:1}),t(d,{label:"事件等级",path:"elevel"},{default:r(()=>[t(p,{filterable:"",value:o.elevel,"onUpdate:value":l[5]||(l[5]=v=>o.elevel=v),placeholder:"请选择事件等级",options:c(de)(c(Se)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),t(d,{label:"转发外系统",path:"fid"},{default:r(()=>[t(p,{multiple:"","max-tag-count":1,value:o.fid,"onUpdate:value":l[6]||(l[6]=v=>o.fid=v),placeholder:"请选择转发外系统",clearable:"",filterable:"","render-label":b,"value-field":"id","label-field":"ipaddr",options:c(T).data,"reset-menu-on-options-change":!1,onScroll:s},null,8,["value","options"])]),_:1}),t(d,{label:"事件文本",path:"etext"},{default:r(()=>[t(u,{type:"textarea",value:o.etext,"onUpdate:value":l[7]||(l[7]=v=>o.etext=v),placeholder:"请输入事件文本",clearable:""},null,8,["value"])]),_:1}),t(d,{label:"是否为系统参数",path:"syspara"},{default:r(()=>[t(Q,{value:o.syspara,"onUpdate:value":l[8]||(l[8]=v=>o.syspara=v),name:"radiogroup"},{default:r(()=>[t(B,null,{default:r(()=>[(V(!0),De(Ve,null,Fe(c(de)(c(ze)),(v,Ie)=>(V(),H(f,{key:Ie,value:v.value},{default:r(()=>[w(q(v.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),t(d,{label:"使用状态",path:"maxagg"},{default:r(()=>[t(g,{value:o.status,"onUpdate:value":l[9]||(l[9]=v=>o.status=v),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),va=me(fa,[["__scopeId","data-v-e1a4119c"]]),ba={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function le(j){return typeof j=="function"||Object.prototype.toString.call(j)==="[object Object]"&&!Qe(j)}const Va=Z({name:"eventalarm_associatedeventspolicy",__name:"index",setup(j){const m=Oe(),{columns:e,columnChecks:S,data:h,getData:y,loading:D,mobilePagination:P,searchParams:E,resetSearchParams:L}=He({apiFn:oa,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"aname",title:"策略名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"adesc",title:"策略描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",minWidth:120,render:i=>{(i.elevel===void 0||i.elevel===null)&&(i.elevel=1);const a={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},l=C(Ze[i.elevel]);let u={color:a[i.elevel],textColor:"#ffffff",borderColor:a[i.elevel]};return t(fe,{size:"small",color:u},le(l)?l:{default:()=>[l]})}},{key:"syspara",title:"系统参数",align:"center",width:240,render:i=>{i.sysparam==null&&(i.sysparam=0);const a={0:"success",1:"error"},l=C(Ge[i.sysparam]);return t(fe,{size:"small",type:a[i.sysparam]},le(l)?l:{default:()=>[l]})}},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"status",title:"使用状态",align:"center",width:160,render:i=>t(Ee,{disabled:!0,value:i.status,"checked-value":1,"unchecked-value":0},null)},{key:"operate",title:C("common.operate"),align:"center",width:160,fixed:"right",render:i=>{let a;return i.syspara!=0?t("div",{class:"flex-center gap-8px"},[X(t(x,{type:"primary",ghost:!0,size:"small",onClick:()=>F(i.id)},le(a=C("common.edit"))?a:{default:()=>[a]}),[[ne("no-auth"),"assocition.policy.update"]]),t(W,{onPositiveClick:()=>n(i.id)},{default:()=>C("common.confirmDelete"),trigger:()=>{let l;return X(t(x,{type:"error",ghost:!0,size:"small"},le(l=C("common.delete"))?l:{default:()=>[l]}),[[ne("no-auth"),"assocition.policy.delete"]])}})]):null}}]}),{drawerVisible:o,operateType:A,editingData:I,handleAdd:N,handleEdit:k,checkedRowKeys:_,onBatchDeleted:R,onDeleted:$,closeDrawer:M}=Je(h,y);async function T(){console.log(_.value),s(_.value,i=>{R()})}function F(i){k(i)}function n(i){console.log(i),s([i],a=>{$()})}async function s(i,a){const{data:l,error:u}=await na(i);if(!u)a&&a(l);else return!1}async function b(){}return(i,a)=>{const l=Pe,u=ua,d=he;return V(),De("div",ba,[t(ra,{model:c(E),"onUpdate:model":a[0]||(a[0]=p=>ae(E)?E.value=p:null),onReset:c(L),onSearch:c(y)},null,8,["model","onReset","onSearch"]),t(d,{title:"关联策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":r(()=>[t(l,{columns:c(S),"onUpdate:columns":a[1]||(a[1]=p=>ae(S)?S.value=p:null),"disabled-delete":c(_).length===0,loading:c(D),onAdd:c(N),onDelete:T,onRefresh:c(y),"is-view-export-button":!0,onExportHandler:b,"is-view-add-button":c(ve)("assocition.policy.insert"),"is-view-delete-button":c(ve)("assocition.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:r(()=>[t(u,{"checked-row-keys":c(_),"onUpdate:checkedRowKeys":a[2]||(a[2]=p=>ae(_)?_.value=p:null),columns:c(e),data:c(h),size:"small","flex-height":!c(m).isMobile,"scroll-x":962,loading:c(D),remote:"","row-key":p=>p.id,pagination:c(P),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(va,{visible:c(o),"onUpdate:visible":a[3]||(a[3]=p=>ae(o)?o.value=p:null),"operate-type":c(A),"row-data":c(I),onSubmitted:c(y)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Va as default};
