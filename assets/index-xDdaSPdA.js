import{d as O,z as J,s as N,i as L,D as W,A as H,E as Q,b as v,o as f,f as a,w as s,h as e,b1 as X,b2 as j,M as C,L as U,N as i,J as Y,e as w,c as Z,G as ee,aF as ae,ay as le,d7 as se,t as m,aM as oe,g,$ as r,H as y,B as $,a2 as ne,a3 as te,a4 as re,fw as ue,aG as de,fx as pe,fy as ie,Q as ce,fz as me,W as fe}from"./index-DdfiWQes.js";const we={class:"profile-wrapper"},_e={class:"avatar-wrapper group"},ve={key:1,class:"upload-wrapper"},ge={class:"font-size-16px"},ye={key:1,class:"c-#a19f9d"},be=O({name:"userinfo",__name:"index",setup(he){const b=J(),o=N({id:"",username:"",nickname:"",phnum:"",userimage:"",usertype:""}),I=async()=>{const{data:d,error:l}=await ue();l||Object.assign(o.value,d)};L(()=>{I()});async function A(d){var p,c;return d.file.file.size/1024/1024<100,["image/jpeg","image/png","image/jpg","image/x-icon"].includes(d.file.file.type)?!0:((p=window.$message)==null||p.destroyAll(),(c=window.$message)==null||c.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1)}async function q({file:d}){var u,p,c;const l=await de(d.file,d.name,"");if(l){Object.prototype.hasOwnProperty.call(l,"result")?(u=window.$message)==null||u.destroyAll():console.log("文件上传成功");const{data:k,error:x}=await pe({id:o.value.id,image:l});x||((p=window.$message)==null||p.destroyAll(),(c=window.$message)==null||c.success("头像修改成功"),b.setUserImage(l),I())}}const h=N(!1),_=N({pwd:""}),R=async()=>{var u;const{data:d,error:l}=await ie({pwd:ce(_.value.pwd)});l||(S(),(u=window.$message)==null||u.success("解绑成功"))},z=()=>{h.value=!0,_.value.pwd=""},S=()=>{h.value=!1},n=W(F());function F(){return{username:b.userInfo.username,pwd:"",newPwd:"",comfirmPassword:""}}const{formRef:B,validate:G}=H(),{createConfirmPwdRule:V,defaultRequiredRule:M,patternRules:D}=Q(),T={pwd:M,newPwd:{...M,...D.password}};async function P(){var u,p;await G();const{data:d,error:l}=await me(n.username,n.pwd,n.newPwd,b.userInfo.id);l||((u=window.$message)==null||u.destroyAll(),(p=window.$message)==null||p.success("密码修改成功, 即将返回登录页"),setTimeout(()=>{b.resetStore()},1e3))}return(d,l)=>{const u=ae,p=le,c=se,k=Y,x=oe,E=te,K=re;return f(),v("div",we,[a(e(ne),{class:"card"},{default:s(()=>[a(e(X),{type:"segment",animated:""},{default:s(()=>[a(e(j),{name:"profile",tab:"个人中心"},{default:s(()=>[a(e(C),{model:o.value,"label-placement":"left",style:{width:"400px",margin:"20px auto 0"},"label-width":100,"require-mark-placement":"left",onKeyup:U(P,["enter"])},{default:s(()=>[a(e(i),{label:"头像"},{default:s(()=>[a(k,{justify:"center"},{default:s(()=>[w("div",_e,[o.value.userimage?(f(),Z(u,{key:0,src:o.value.userimage,class:"avatar-img","preview-disabled":""},null,8,["src"])):(f(),v("div",ve,[a(p,{ref:"uploadRef",action:"#","list-type":"picture-card","before-upload":A,"custom-request":q},{default:s(()=>l[7]||(l[7]=[w("div",{class:"upload-inner"},[w("span",null,"点击上传")],-1)])),_:1,__:[7]},512)])),o.value.userimage?(f(),v("div",{key:2,class:"avatar-overlay",onClick:l[0]||(l[0]=t=>o.value.userimage="")},[a(c,{class:"icon-close"})])):ee("",!0)])]),_:1})]),_:1}),a(e(i),{label:"用户名称：",path:"username"},{default:s(()=>[w("div",ge,m(o.value.username),1)]),_:1}),a(e(i),{label:"用户类型：",path:"usertype"},{default:s(()=>[a(x,{type:"info"},{default:s(()=>[g(m(o.value.usertype==0?"超级管理员":o.value.usertype==1?"销售":o.value.usertype==2?"项目负责人":o.value.usertype==3?"调试工程师":o.value.usertype==4?"综合管理":o.value.usertype==5?"研发工程师":o.value.usertype==6?"生产工程师":""),1)]),_:1})]),_:1}),a(e(i),{label:"联系方式：",path:"phnum"},{default:s(()=>[w("div",null,m(o.value.phnum),1)]),_:1}),a(e(i),{label:"微信昵称：",path:"nickname"},{default:s(()=>[w("div",null,[g(m(o.value.nickname)+" ",1),o.value.nickname?(f(),v("span",{key:0,class:"ml-20px cursor-pointer c-red",onClick:z},"解绑")):(f(),v("span",ye,"未绑定"))])]),_:1})]),_:1},8,["model"])]),_:1}),a(e(j),{name:"password",tab:"修改密码"},{default:s(()=>[a(e(C),{ref_key:"formRef",ref:B,model:n,rules:T,"label-placement":"left",style:{width:"400px",margin:"20px auto 0"},"label-width":100,"require-mark-placement":"left",onKeyup:U(P,["enter"])},{default:s(()=>[a(e(i),{label:e(r)("page.manage.user.username"),path:"username"},{default:s(()=>[a(e(y),{readonly:"",value:n.username,"onUpdate:value":l[1]||(l[1]=t=>n.username=t),placeholder:e(r)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(i),{label:e(r)("page.login.common.oldPassword"),path:"pwd"},{default:s(()=>[a(e(y),{type:"password","show-password-on":"click",clearable:"",value:n.pwd,"onUpdate:value":l[2]||(l[2]=t=>n.pwd=t),placeholder:e(r)("page.login.common.oldPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(i),{label:e(r)("page.login.common.password"),path:"newPwd"},{default:s(()=>[a(e(y),{type:"password","show-password-on":"click",clearable:"",value:n.newPwd,"onUpdate:value":l[3]||(l[3]=t=>n.newPwd=t),placeholder:e(r)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(i),{label:e(r)("page.login.common.confirmPassword"),path:"comfirmPassword",rule:e(V)(n.newPwd)},{default:s(()=>[a(e(y),{type:"password","show-password-on":"click",clearable:"",value:n.comfirmPassword,"onUpdate:value":l[4]||(l[4]=t=>n.comfirmPassword=t),placeholder:e(r)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rule"]),a(k,{justify:"center",size:16},{default:s(()=>[a(e($),{type:"primary",onClick:P},{default:s(()=>[g(m(e(r)("common.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),a(K,{show:h.value,"onUpdate:show":l[6]||(l[6]=t=>h.value=t),title:"解绑微信",preset:"card",class:"w-500px"},{footer:s(()=>[a(k,{justify:"end",size:16},{default:s(()=>[a(e($),{onClick:S},{default:s(()=>[g(m(e(r)("common.cancel")),1)]),_:1}),a(e($),{type:"primary",onClick:R},{default:s(()=>[g(m(e(r)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(E,null,{default:s(()=>[a(e(C),{ref_key:"formRef",ref:B,model:_.value,rules:T,"label-placement":"left","require-mark-placement":"left",onKeyup:U(R,["enter"])},{default:s(()=>[a(e(i),{label:e(r)("page.login.common.password"),path:"pwd"},{default:s(()=>[a(e(y),{type:"password","show-password-on":"click",clearable:"",value:_.value.pwd,"onUpdate:value":l[5]||(l[5]=t=>_.value.pwd=t),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}}),Pe=fe(be,[["__scopeId","data-v-551b2258"]]);export{Pe as default};
