import{_ as he}from"./round-add-D16vdqFD.js";import{d as Z,aB as le,p as ee,aR as we,s as be,r as L,aD as ie,az as te,c0 as Te,x as Q,c as D,o as p,w as a,f as o,bk as ke,b as G,y as j,F as re,z as De,e as u,t as h,aT as W,W as xe,C as E,h as r,A as Se,E as de,cN as Ce,B as $,g as x,aX as Ne,a$ as ze,bm as Pe,a1 as je,q as Re,i as ue,b3 as m,Y as me,aA as Me,aI as $e,N as ce,$ as Y,cw as Le,aN as ae,b8 as Ue,cO as Be,cP as ne,cQ as Fe,cR as Ve,Q as He,aS as X,cS as Ie,aF as Ge,aY as Ee}from"./index-B6VmDCNW.js";import{f as Ae,a as Ke,b as Oe,_ as We,c as Ye,d as qe}from"./operate-drawer.vue_vue_type_style_index_0_lang-B1WREt0e.js";import{u as Qe,a as Je}from"./table-Dy_mM2iO.js";import{_ as Xe,a as Ze}from"./text-DWT8Z3w6.js";import{N as pe}from"./Popconfirm-BZx2_Fxn.js";import{_ as et}from"./round-search-DZaWhVa0.js";import{u as oe}from"./usePageData-Z4O6CELG.js";import{_ as tt}from"./Grid-x22nPuCx.js";import{_ as at}from"./FormItemGridItem-Capj4nMQ.js";import{N as nt}from"./RadioButton-CM4YCQ3D.js";import{N as ot}from"./DatePicker-CqzZbVrA.js";const st={key:0},lt={class:"mt-4 border-t pt-3"},it={class:"flex items-start gap-2 mb-3"},rt={class:"ml-2 flex-1"},dt={class:"flex items-center"},ut={class:"font-medium font-size-16px font-bold"},mt={class:"text-gray-600 mt-1"},ct=Z({name:"drawerLog",__name:"drawerLog",props:le({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(S){const q=ee();we();const t=be({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0}),R=S,l={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},_=L({});async function w(){v.value=[],Object.assign(t,R.rowData);const d=JSON.parse(R.rowData.context);t.proname=d.proname,t.notes=d.notes,t.problem=d.problem,t.solutions=d.solutions,t.feedback=d.feedback,t.summarize=d.summarize,N()}const v=L([]),C=ie(S,"visible");te(C,()=>{C.value?w():(v.value=[],t.id=void 0)}),te(()=>R.rowData,()=>{C.value&&w()});function A(d){d||b()}function b(){C.value=!1}const N=async()=>{const{data:d,error:i}=await Ke({page:1,limit:100,pid:t.id});d&&(v.value=d.list)},F=Te.debounce(async()=>{var T;const d=_.value[t.id];if(!(d!=null&&d.trim()))return(T=window.$message)==null?void 0:T.warning("请输入评论内容");const{data:i,error:g}=await Ae([{pid:t.id,context:d}]);i&&(_.value[t.id]="",t.num++,N())},1e3,{leading:!0,trailing:!1}),K=async d=>{var T;const{data:i,error:g}=await Oe(d.id);i&&(N(),t.num--,(T=window.$message)==null||T.success("删除成功"))};return(d,i)=>{const g=De,T=re,V=Xe,c=Ze,U=ke,H=Pe,I=Q("no-auth");return p(),D(H,{show:C.value,"onUpdate:show":[i[1]||(i[1]=f=>C.value=f),A],"display-directive":"show",width:600,onMaskClick:b,onEsc:b},{default:a(()=>[o(U,{title:t.username+"的项目日报","native-scrollbar":!1,closable:""},{default:a(()=>[o(T,{ref:"formRef",model:t,"show-feedback":!1},{default:a(()=>[t.proname?(p(),D(g,{key:0,label:"项目名称",path:"proname","label-placement":"left"},{label:a(()=>i[2]||(i[2]=[u("div",{class:"font-size-16px font-bold"},"项目名称：",-1)])),default:a(()=>[u("span",null,h(t.proname),1)]),_:1})):j("",!0),o(g,{label:"当前工作内容及成果描述",path:"notes"},{label:a(()=>i[3]||(i[3]=[u("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述：",-1)])),default:a(()=>[u("span",{class:W(["preview-text",{textstyle:t.notes}])},h(t.notes),3)]),_:1}),o(g,{label:"遇到问题",path:"problem"},{label:a(()=>i[4]||(i[4]=[u("div",{class:"font-size-16px font-bold"},"遇到问题：",-1)])),default:a(()=>[u("span",{class:W(["preview-text",{textstyle:t.problem}])},h(t.problem),3)]),_:1}),o(g,{label:"解决措施",path:"solutions"},{label:a(()=>i[5]||(i[5]=[u("div",{class:"font-size-16px font-bold"},"解决措施：",-1)])),default:a(()=>[u("span",{class:W(["preview-text",{textstyle:t.solutions}])},h(t.solutions),3)]),_:1}),o(g,{label:"建议意见反馈",path:"feedback"},{label:a(()=>i[6]||(i[6]=[u("div",{class:"font-size-16px font-bold"},"建议意见反馈：",-1)])),default:a(()=>[u("span",{class:W(["preview-text",{textstyle:t.feedback}])},h(t.feedback),3)]),_:1}),o(g,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:a(()=>i[7]||(i[7]=[u("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感：",-1)])),default:a(()=>[u("span",{class:W(["preview-text",{textstyle:t.summarize}])},h(t.summarize),3)]),_:1})]),_:1},8,["model"]),t.num?(p(),G("div",st,h(t.num)+"评论",1)):j("",!0),o(xe,{name:"fade"},{default:a(()=>[u("div",lt,[E((p(),G("div",it,[u("div",null,[o(V,{size:"small",src:l.avatar},null,8,["src"])]),o(r(Se),{type:"textarea",id:`comment-input-${t.id}`,value:_.value[t.id],"onUpdate:value":i[0]||(i[0]=f=>_.value[t.id]=f),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:de(Ce(r(F),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),o(r($),{type:"primary",ghost:"",onClick:r(F)},{default:a(()=>i[8]||(i[8]=[x("发送")])),_:1,__:[8]},8,["onClick"])])),[[I,"project:Comment:insert"]]),(p(!0),G(Ne,null,ze(v.value,f=>(p(),G("div",{key:f.id,class:"flex mb-3"},[o(V,{size:"small",src:l.avatar},null,8,["src"]),u("div",rt,[u("div",dt,[u("span",ut,h(f.username),1),o(c,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:a(()=>[x(h(f.dbtime),1)]),_:2},1024),r(q).userInfo.id==f.creater?(p(),D(r(pe),{key:0,onPositiveClick:z=>K(f)},{trigger:a(()=>[E((p(),D(r($),{quaternary:"",type:"error",size:"small"},{default:a(()=>i[9]||(i[9]=[x(" 删除 ")])),_:1,__:[9]})),[[I,"project:Comment:delete"]])]),default:a(()=>[i[10]||(i[10]=x(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):j("",!0)]),u("div",mt,h(f.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),pt=je(ct,[["__scopeId","data-v-8a7cfaaf"]]),ft=Z({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:le(["reset","search","clear","setPname"],["update:model"]),setup(S,{emit:q}){const t=q,{formRef:R}=Re(),l=ie(S,"model");ee();const _=L([]),{pageData:w,getData:v,nextPage:C}=oe(Le),A=async n=>{const e=n.currentTarget,s=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&w.data.length<w.total&&(await C(),_.value=w.data,await ae(),setTimeout(()=>{e.scrollTop=s}))},{pageData:b,getData:N,nextPage:F}=oe(Ue),K=async n=>{const e=n.currentTarget,s=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&b.data.length<b.total&&(await F(),await ae(),setTimeout(()=>{e.scrollTop=s}))},d=async n=>{l.value.creater=n,t("search")},i=async n=>{var e;n&&(l.value.pid=n),t("search"),t("setPname",((e=_.value.find(s=>s.id==n))==null?void 0:e.proname)||"")},g=async n=>{await v({fuzzy:n,page:1}),_.value=w.data},T=async()=>{await v({page:1}),_.value=w.data},V=async()=>{await v(),_.value=w.data,t("search")};N({usertypes:"2,3"}),ue(()=>{V();const n=new Date;if(n.getHours()<18){const e=new Date;e.setDate(n.getDate()-1),e.setHours(0,0,0,0),c.value.dayTime=String(m(0,e.getTime())),l.value.statrtTime=String(m(0,e.getTime()))+" 00:00:00",l.value.endTime=String(m(0,e.getTime()+24*60*60*1e3))+" 00:00:00"}else{const e=new Date;e.setHours(0,0,0,0),c.value.dayTime=String(m(0,e.getTime())),l.value.statrtTime=String(m(0,e.getTime()))+" 00:00:00",l.value.endTime=String(m(0,e.getTime()+24*60*60*1e3))+" 00:00:00"}});const c=L({dayTime:null,weekTime:null,monthTime:null}),U=async n=>{l.value.statrtTime=String(m(0,n))+" 00:00:00",l.value.endTime=String(m(0,new Date(n).getTime()+24*60*60*1e3))+" 00:00:00",t("search")},H=async n=>{const{monday:e,sunday:s}=Be(n);l.value.statrtTime=e,l.value.endTime=m(0,new Date(s).getTime()+24*60*60*1e3),t("search")},I=async n=>{const{start:e,end:s}=ne(n);l.value.statrtTime=e,l.value.endTime=m(0,new Date(s).getTime()+24*60*60*1e3),t("search")};async function f(){t("search")}const z=L("day"),J=async n=>{if(n=="day"){const e=new Date;if(e.getHours()<18){const s=new Date;s.setDate(e.getDate()-1),s.setHours(0,0,0,0),c.value.dayTime=String(m(0,s.getTime())),l.value.statrtTime=String(m(0,s.getTime()))+" 00:00:00",l.value.endTime=String(m(0,s.getTime()+24*60*60*1e3))+" 00:00:00"}else{const s=new Date;s.setHours(0,0,0,0),c.value.dayTime=String(m(0,s.getTime())),l.value.statrtTime=String(m(0,s.getTime()))+" 00:00:00",l.value.endTime=String(m(0,s.getTime()+24*60*60*1e3))+" 00:00:00"}}else if(n=="week"){c.value.weekTime=Fe();const{start:e,end:s}=Ve(new Date().getTime());l.value.statrtTime=e,l.value.endTime=m(0,new Date(s).getTime()+24*60*60*1e3)}else if(n=="month"){let e=function(){const M=new Date,O=M.getFullYear(),y=(M.getMonth()+1).toString().padStart(2,"0");return`${O}-${y}`};c.value.monthTime=e();const{start:s,end:P}=ne(c.value.monthTime);l.value.statrtTime=s,l.value.endTime=m(0,new Date(P).getTime()+24*60*60*1e3)}t("search")};return(n,e)=>{const s=Me,P=at,M=nt,O=$e,B=ot,y=et,fe=$,ge=ce,_e=tt,ve=re,ye=me;return p(),D(ye,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[o(ve,{ref_key:"formRef",ref:R,model:l.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:de(f,["enter"])},{default:a(()=>[o(_e,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[o(P,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:a(()=>[o(s,{filterable:"",clearable:"",value:l.value.pid,"onUpdate:value":[e[0]||(e[0]=k=>l.value.pid=k),i],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:_.value,onScroll:A,onClear:T,onSearch:g},null,8,["value","options"])]),_:1}),o(P,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:a(()=>[o(O,{value:z.value,"onUpdate:value":[e[1]||(e[1]=k=>z.value=k),J],style:{"margin-right":"20px"}},{default:a(()=>[o(M,{value:"day"},{default:a(()=>e[6]||(e[6]=[x("天")])),_:1,__:[6]}),o(M,{value:"week"},{default:a(()=>e[7]||(e[7]=[x("周")])),_:1,__:[7]}),o(M,{value:"month"},{default:a(()=>e[8]||(e[8]=[x("月")])),_:1,__:[8]})]),_:1},8,["value"]),z.value==="day"?(p(),D(B,{key:0,"formatted-value":c.value.dayTime,"onUpdate:formattedValue":[e[2]||(e[2]=k=>c.value.dayTime=k),U],type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])):j("",!0),z.value==="week"?(p(),D(B,{key:1,"formatted-value":c.value.weekTime,"onUpdate:formattedValue":[e[3]||(e[3]=k=>c.value.weekTime=k),H],type:"week",style:{width:"100%"}},null,8,["formatted-value"])):j("",!0),z.value==="month"?(p(),D(B,{key:2,"formatted-value":c.value.monthTime,"onUpdate:formattedValue":[e[4]||(e[4]=k=>c.value.monthTime=k),I],type:"month","value-format":"yyyy-MM",style:{width:"100%"}},null,8,["formatted-value"])):j("",!0)]),_:1}),o(P,{span:"24 s:12 m:5",label:"用户",path:"creater"},{default:a(()=>[o(s,{clearable:"",filterable:"",value:l.value.creater,"onUpdate:value":[e[5]||(e[5]=k=>l.value.creater=k),d],placeholder:"请选择","label-field":"username","value-field":"id",options:r(b).data,onScroll:K},null,8,["value","options"])]),_:1}),o(P,{span:"24  s:12 m:4",class:"pr-24px"},{default:a(()=>[o(ge,{class:"w-full"},{default:a(()=>[o(fe,{type:"primary",ghost:"",onClick:f},{icon:a(()=>[o(y,{class:"text-icon"})]),default:a(()=>[x(" "+h(r(Y)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),gt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},_t={key:0};function se(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Ee(S)}const zt=Z({name:"projectmanagement_daylog",__name:"index",props:{pid:{default:void 0},type:{}},emits:["thereIsData"],setup(S,{emit:q}){const t=He(),R=ee(),l=S,{columns:_,data:w,getData:v,loading:C,mobilePagination:A,searchParams:b}=Qe({showTotal:!0,immediate:!1,apiFn:Ye,apiParams:{page:1,pageSize:20,limit:20,statrtTime:void 0,endTime:void 0,creater:void 0,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:n=>o("div",null,[n.username+"的项目日报"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:Y("common.operate"),align:"center",width:140,fixed:"right",render:n=>{let e;return o("div",{class:"flex-center gap-8px"},[o($,{type:"primary",ghost:!0,size:"small",onClick:()=>I(n)},{default:()=>[x("查看详情")]}),R.userInfo.id==n.creater&&E(o($,{type:"primary",ghost:!0,size:"small",onClick:()=>c(n.id)},se(e=Y("common.edit"))?e:{default:()=>[e]}),[[Q("no-auth"),"project:DailyReport:update"]]),R.userInfo.id==n.creater&&o(pe,{onPositiveClick:()=>V(n.id)},{default:()=>Y("common.confirmDelete"),trigger:()=>{let s;return E(o($,{type:"error",ghost:!0,size:"small"},se(s=Y("common.delete"))?s:{default:()=>[s]}),[[Q("no-auth"),"project:DailyReport:delete"]])}})])}}]}),{drawerVisible:N,operateType:F,editingData:K,handleAdd:d,handleEdit:i,checkedRowKeys:g,onDeleted:T}=Je(w,v);async function V(n){const{data:e,error:s}=await qe(n);s||T()}function c(n){i(n)}const U=L(!1),H=L({}),I=n=>{U.value=!0,H.value=n},f=()=>{v()},z=L(""),J=n=>{z.value=n};return ue(()=>{l.type!="externalLiaison"}),(n,e)=>{const s=ce,P=he,M=Ge,O=me,B=Q("no-auth");return p(),G("div",gt,[l.pid?j("",!0):(p(),D(ft,{key:0,model:r(b),"onUpdate:model":e[0]||(e[0]=y=>X(b)?b.value=y:null),onReset:f,onSearch:r(v),onSetPname:J},null,8,["model","onSearch"])),o(O,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Ie({header:a(()=>[o(s,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>[l.pid?j("",!0):(p(),G("div",_t,"项目日报"))]),_:1}),l.pid?E((p(),D(r($),{key:0,onClick:r(d),size:"small",ghost:"",type:"primary"},{icon:a(()=>[o(P,{class:"text-icon"})]),default:a(()=>[e[4]||(e[4]=x(" "+h("新增")))]),_:1,__:[4]},8,["onClick"])),[[B,"project:DailyReport:insert"]]):j("",!0)]),default:a(()=>[o(M,{"checked-row-keys":r(g),"onUpdate:checkedRowKeys":e[1]||(e[1]=y=>X(g)?g.value=y:null),columns:r(_),data:r(w),size:"small","flex-height":!r(t).isMobile,loading:r(C),remote:"","row-key":y=>y.id,pagination:r(A),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),o(We,{visible:r(N),"onUpdate:visible":e[2]||(e[2]=y=>X(N)?N.value=y:null),onSubmitted:r(v),"operate-type":r(F),pname:z.value,pid:l.pid||r(b).pid,"row-data":r(K)},null,8,["visible","onSubmitted","operate-type","pname","pid","row-data"]),o(pt,{visible:U.value,"onUpdate:visible":e[3]||(e[3]=y=>U.value=y),"row-data":H.value},null,8,["visible","row-data"])]),_:2},[l.pid?void 0:{name:"header-extra",fn:a(()=>[o(s,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[E((p(),D(r($),{onClick:r(d),size:"small",ghost:"",type:"primary"},{icon:a(()=>[o(P,{class:"text-icon"})]),default:a(()=>[e[5]||(e[5]=x(" "+h("新增")))]),_:1,__:[5]},8,["onClick"])),[[B,"project:DailyReport:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{zt as default};
