import{_ as oe}from"./export-C1eIYiY_.js";import{e as D}from"./exportExcel-DNhOb6yd.js";import{d as ae,i as H,s as g,aR as E,f as t,g as o,b as ne,o as U,w as i,N as ue,c as V,G as A,aE as re,B as ie,t as se,b1 as ce,b2 as de,az as me,h as f,a2 as ve,cW as fe,cX as ye,cU as ke,fv as pe,a as ge,aF as he,b4 as _e,W as Fe}from"./index-DdfiWQes.js";import{u as Te}from"./usePageData-CaNzzdLX.js";import{_ as we}from"./RadioButton-BvJzaggS.js";import{_ as be}from"./DatePicker-BTmZbyaH.js";const Ce={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},xe=ae({name:"reportmanagement_userdatareport",__name:"index",setup(Ne){const{pageData:I,getData:L}=Te(_e);H(()=>{L({usertypes:"2,3"})});const s=g({dates:void 0,statrtTime:null,endTime:null}),n=g({dayTime:null,weekTime:null,monthTime:null}),r=g("day"),O=e=>{const l=new Date;if(l.setHours(0,0,0,0),e==="day"){const u=E(0,l.getTime());n.value.dayTime=u,s.value.dates=u}else if(e==="week"){n.value.weekTime=fe();const{start:u,end:c}=ye(new Date().getTime());s.value.startTime=u,s.value.endTime=E(0,new Date(c).getTime())}else if(e==="month"){const u=E(3,l.getTime());n.value.monthTime=u,s.value.dates=u}F()},J=e=>{s.value.dates=e,F()},$=async e=>{const{monday:l,sunday:u}=ke(e);s.value.startTime=l,s.value.endTime=E(0,new Date(u)),F()},z=e=>{s.value.dates=e,F()},j=g({}),X=g({}),F=async()=>{const e={dates:r.value!=="week"?s.value.dates:void 0,startTime:r.value=="week"?s.value.startTime:void 0,endTime:r.value=="week"?s.value.endTime:void 0},{data:l}=await pe(e);l&&(j.value=l,X.value=JSON.parse(JSON.stringify(l)))};H(()=>{const l=E(0,new Date().getTime()-24*60*60*1e3);s.value.dates=l,n.value.dayTime=l,F()});const S=g({daily:{columnKey:"totalscore",order:"descend"},weekly:{columnKey:"totalscore",order:"descend"},project:{columnKey:"totalscore",order:"descend"},clockin:{columnKey:"total",order:"descend"},process:{columnKey:"totalfilescore",order:"descend"}}),w=(e,l)=>{var d;if(!e||!e.order){S.value[l]=null;return}const u=e.columnKey??e.key??((d=e.column)==null?void 0:d.key)??e.field??null,c=e.order;S.value[l]=u?{columnKey:u,order:c}:null},b=(e,l,u)=>ge(()=>{const c=I.data??[],d=Array.isArray(j.value[e])?j.value[e]:[],_=c.map(y=>{const p=d.find(N=>N.creater===y.id),a=p?{...y,...p}:{...y,...l};return u?u(a):a}),k=S.value[e];if(!k||!k.columnKey)return _;const m=k.columnKey,v=k.order;return _.slice().sort((y,p)=>{const a=Number(y[m]),N=Number(p[m]);if(!isNaN(a)&&!isNaN(N))return v==="ascend"?a-N:N-a;const P=y[m]==null?"":String(y[m]),G=p[m]==null?"":String(p[m]);return v==="ascend"?P.localeCompare(G):G.localeCompare(P)})}),B={reportcount:0,avgcharctras:0,totalscore:0,avgscore:0,lowcount:0,mediumcount:0,highcount:0},K=b("daily",B),R=b("weekly",B),W=b("project",B),M=b("clockin",{clockinnormal:0,clockinabnormal:0,normalscore:0,abnormalscore:0,clockindepart:0,clockinarrive:0,departscore:0,arrivescore:0},e=>{const l=Number(e.clockinnormal||0),u=Number(e.clockinabnormal||0),c=Number(e.normalscore||0),d=Number(e.abnormalscore||0),_=Number(e.departscore||0),k=Number(e.arrivescore||0),m=Number(e.clockindepart||0),v=Number(e.clockinarrive||0);return{...e,total:c+d+_+k,totalCount:l+u+m+v}}),q=b("process",B),C=e=>[{key:"username",title:"调试人",width:120,render(l){return t("div",{class:"flex items-center "},[t(he,{width:"40",height:"40","preview-disabled":!0,src:l.userimage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png",class:"rounded-50% object-cover mr-10px"},null),t("span",null,[l.username])])}},...e.map(l=>({key:l.key,title:l.title,align:l.align??"center",sorter:!0,width:l.width??120,render:l.render||(u=>{const c=u[l.key];return t("div",null,[c??0])})}))],Y=C([{key:"reportcount",title:"日报总数"},{key:"avgcharctras",title:"平均字符数"},{key:"avgscore",title:"平均得分"},{key:"totalscore",title:"总得分",render:e=>t("div",{style:"color:#1890ff; font-weight:600"},[e.totalscore])},{key:"lowcount",title:"合格次数"},{key:"mediumcount",title:"良好次数"},{key:"highcount",title:"优秀次数"}]),Q=C([{key:"reportcount",title:"周报总数"},{key:"avgcharctras",title:"平均字符数"},{key:"avgscore",title:"平均得分"},{key:"totalscore",title:"总得分",render:e=>t("div",{style:"color:#1890ff; font-weight:600"},[e.totalscore])},{key:"lowcount",title:"合格次数"},{key:"mediumcount",title:"良好次数"},{key:"highcount",title:"优秀次数"}]),Z=C([{key:"reportcount",title:"项目总结总数"},{key:"avgcharctras",title:"平均字符数"},{key:"avgscore",title:"平均得分"},{key:"totalscore",title:"总得分",render:e=>t("div",{style:"color:#1890ff; font-weight:600"},[e.totalscore])},{key:"lowcount",title:"合格次数"},{key:"mediumcount",title:"良好次数"},{key:"highcount",title:"优秀次数"}]),ee=C([{key:"clockinnormal",title:"正常打卡次数"},{key:"clockinabnormal",title:"异常打卡次数"},{key:"clockindepart",title:"出发打卡次数"},{key:"clockinarrive",title:"到达打卡次数"},{key:"totalCount",title:"总打卡次数",render:e=>t("div",{style:"color:#1890ff; font-weight:600"},[e.totalCount])},{key:"normalscore",title:"正常分数"},{key:"abnormalscore",title:"异常分数"},{key:"departscore",title:"出发打卡分数"},{key:"arrivescore",title:"到达打卡分数"},{key:"total",title:"总分数",render:e=>t("div",{style:"color:#1890ff; font-weight:600"},[e.total])}]),te=C([{key:"equipmentscore",title:()=>t("div",null,[t("div",null,[o("设备清点")]),t("div",null,[o("（次数/得分）")]),o(" ")]),render:e=>t("div",{style:"color:#1890ff; font-weight:600"},[e.checkedcount??0,o(" / "),e.equipmentscore??0])},{key:"file1score",title:()=>t("div",null,[t("div",null,[o("项目图纸")]),t("div",null,[o("（数量/得分）")]),o(" ")]),render:e=>t("div",null,[e.file1count??0,o(" / "),e.file1score??0])},{key:"file2score",title:()=>t("div",null,[t("div",null,[o("项目文件")]),t("div",null,[o("（数量/得分）")]),o(" ")]),render:e=>t("div",null,[e.file2count??0,o(" / "),e.file2score??0])},{key:"file3score",title:()=>t("div",null,[t("div",null,[o("工程文件")]),t("div",null,[o("（数量/得分）")]),o(" ")]),render:e=>t("div",null,[e.file3count??0,o(" / "),e.file3score??0])},{key:"file4score",title:()=>t("div",null,[t("div",null,[o("现场照片")]),t("div",null,[o("（数量/得分）")]),o(" ")]),render:e=>t("div",null,[e.file4count??0,o(" / "),e.file4score??0])},{key:"file5score",title:()=>t("div",null,[t("div",null,[o("网络通讯图")]),t("div",null,[o("（数量/得分）")]),o(" ")]),render:e=>t("div",null,[e.file5count??0,o(" / "),e.file5score??0])},{key:"file6score",title:()=>t("div",null,[t("div",null,[o("组态画面备份")]),t("div",null,[o("（数量/得分）")]),o(" ")]),render:e=>t("div",null,[e.file6count??0,o(" / "),e.file6score??0])},{key:"file7score",title:()=>t("div",null,[t("div",null,[o("验收文件")]),t("div",null,[o("（数量/得分）")]),o(" ")]),render:e=>t("div",null,[e.file7count??0,o(" / "),e.file7score??0])},{key:"totalfilecount",title:"总文件数",render:e=>t("div",null,[e.totalfilecount??0])},{key:"totalfilescore",title:"总得分",render:e=>t("div",{style:"color:#1890ff; font-weight:600"},[e.totalfilescore??0])}]),x=g(window.innerHeight-325),h=g("daily"),le=()=>{h.value=="daily"?D(K.value,{username:"用户名",reportcount:"日报总数",avgcharctras:"平均字符数",avgscore:"平均得分",totalscore:"总得分",lowcount:"合格次数",mediumcount:"良好次数",highcount:"优秀次数"},"日报报表_"+(r.value=="week"?n.value.weekTime:r.value=="month"?n.value.monthTime:n.value.dayTime)):h.value=="weekly"?D(R.value,{username:"用户名",reportcount:"周报总数",avgcharctras:"平均字符数",avgscore:"平均得分",totalscore:"总得分",lowcount:"合格次数",mediumcount:"良好次数",highcount:"优秀次数"},"周报报表_"+(r.value=="week"?n.value.weekTime:r.value=="month"?n.value.monthTime:n.value.dayTime)):h.value=="project"?D(W.value,{username:"用户名",reportcount:"项目总结总数",avgcharctras:"平均字符数",avgscore:"平均得分",totalscore:"总得分",lowcount:"合格次数",mediumcount:"良好次数",highcount:"优秀次数"},"项目总结报表_"+(r.value=="week"?n.value.weekTime:r.value=="month"?n.value.monthTime:n.value.dayTime)):h.value=="clockin"?D(M.value,{username:"用户名",clockinnormal:"正常打卡次数",clockinabnormal:"异常打卡次数",totalCount:"总打卡次数",normalscore:"正常分数",abnormalscore:"异常分数",departscore:"出发打卡分数",arrivescore:"到达打卡分数",total:"总分数"},"打卡报表_"+(r.value=="week"?n.value.weekTime:r.value=="month"?n.value.monthTime:n.value.dayTime)):h.value=="process"&&D(q.value,{username:"用户名",checkedcount:"设备清点次数",equipmentscore:"设备得分",file1count:"项目图纸数量",file1score:"项目图纸得分",file2count:"项目文件数量",file2score:"项目文件得分",file3count:"工程文件数量",file3score:"工程文件得分",file4count:"现场照片数量",file4score:"现场照片得分",file5count:"网络通讯图数量",file5score:"网络通讯图得分",file6count:"组态画面备份数量",file6score:"组态画面备份得分",file7count:"验收文件数量",file7score:"验收文件得分",totalfilecount:"总文件数",totalfilescore:"总得分"},"项目流程报表_"+(r.value=="week"?n.value.weekTime:r.value=="month"?n.value.monthTime:n.value.dayTime))};return(e,l)=>{const u=we,c=re,d=be,_=ie,k=oe,m=ue,v=me,T=de,y=ce,p=ve;return U(),ne("div",Ce,[t(p,{bordered:"",style:{height:"100%"}},{default:i(()=>[t(m,{label:"查询日期","label-placement":"left","show-feedback":!1,class:"mb-15px"},{default:i(()=>[t(c,{value:r.value,"onUpdate:value":[l[0]||(l[0]=a=>r.value=a),O],style:{"margin-right":"20px"}},{default:i(()=>[t(u,{value:"day"},{default:i(()=>l[10]||(l[10]=[o("天")])),_:1,__:[10]}),t(u,{value:"week"},{default:i(()=>l[11]||(l[11]=[o("周")])),_:1,__:[11]}),t(u,{value:"month"},{default:i(()=>l[12]||(l[12]=[o("月")])),_:1,__:[12]})]),_:1},8,["value"]),r.value==="day"?(U(),V(d,{key:0,"formatted-value":n.value.dayTime,"onUpdate:formattedValue":[l[1]||(l[1]=a=>n.value.dayTime=a),J],type:"date","value-format":"yyyy-MM-dd",style:{width:"200px"}},null,8,["formatted-value"])):A("",!0),r.value==="week"?(U(),V(d,{key:1,"formatted-value":n.value.weekTime,"onUpdate:formattedValue":[l[2]||(l[2]=a=>n.value.weekTime=a),$],type:"week",style:{width:"200px"}},null,8,["formatted-value"])):A("",!0),r.value==="month"?(U(),V(d,{key:2,"formatted-value":n.value.monthTime,"onUpdate:formattedValue":[l[3]||(l[3]=a=>n.value.monthTime=a),z],type:"month","value-format":"yyyy-MM",style:{width:"200px"}},null,8,["formatted-value"])):A("",!0),t(_,{type:"primary",ghost:"",style:{"margin-left":"20px"},onClick:F},{default:i(()=>l[13]||(l[13]=[o("查询")])),_:1,__:[13]}),t(_,{style:{"margin-left":"20px"},onClick:le},{icon:i(()=>[t(k,{class:"text-icon"})]),default:i(()=>[l[14]||(l[14]=o(" "+se("导出")))]),_:1,__:[14]})]),_:1}),t(y,{type:"segment",animated:"",value:h.value,"onUpdate:value":l[9]||(l[9]=a=>h.value=a)},{default:i(()=>[t(T,{name:"daily",tab:"日报报表"},{default:i(()=>[t(v,{columns:f(Y),data:f(K),"max-height":x.value,"onUpdate:sorter":l[4]||(l[4]=a=>w(a,"daily"))},null,8,["columns","data","max-height"])]),_:1}),t(T,{name:"weekly",tab:"周报报表"},{default:i(()=>[t(v,{columns:f(Q),data:f(R),"max-height":x.value,"onUpdate:sorter":l[5]||(l[5]=a=>w(a,"weekly"))},null,8,["columns","data","max-height"])]),_:1}),t(T,{name:"project",tab:"项目总结报表"},{default:i(()=>[t(v,{columns:f(Z),data:f(W),"max-height":x.value,"onUpdate:sorter":l[6]||(l[6]=a=>w(a,"project"))},null,8,["columns","data","max-height"])]),_:1}),t(T,{name:"clockin",tab:"打卡报表"},{default:i(()=>[t(v,{columns:f(ee),data:f(M),"max-height":x.value,"onUpdate:sorter":l[7]||(l[7]=a=>w(a,"clockin"))},null,8,["columns","data","max-height"])]),_:1}),t(T,{name:"process",tab:"项目流程报表"},{default:i(()=>[t(v,{columns:f(te),data:f(q),"max-height":x.value,"onUpdate:sorter":l[8]||(l[8]=a=>w(a,"process"))},null,8,["columns","data","max-height"])]),_:1})]),_:1},8,["value"])]),_:1})])}}}),Ve=Fe(xe,[["__scopeId","data-v-df65355a"]]);export{Ve as default};
