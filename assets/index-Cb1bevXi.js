import{d as F,q as B,s as le,x as K,o as E,c as q,w as n,g as a,i as h,X as ne,aE as oe,h as w,t as D,$ as g,G as ie,aF as se,a0 as ue,B as H,O as W,P as re,ad as Q,j as x,ae as ce,r as G,av as U,e as J,ay as de,aj as X,az as pe,S as fe,ar as me,Q as _e,R as ve,f as Y,ai as Z,T as ee,a4 as ge}from"./index-C5IVBnuT.js";import{f as he,a as ye,b as be,c as xe}from"./audit-events-76oSSbPr.js";import{_ as we,l as te}from"./lodash-Bi0mdSrH.js";import{T as j}from"./basicconf-Co9dl9Q4.js";import{_ as ke}from"./round-search-BDs78GhZ.js";import{_ as Te}from"./round-refresh-DiPTY6w8.js";import{u as Se}from"./usePageData-B-2UX2DD.js";import{f as De}from"./system-manage-CDXEqwVV.js";import{_ as Ce}from"./FormItemGridItem-0rbPDrs6.js";import{_ as Ne}from"./DatePicker-BILi7KHr.js";import{_ as Ae}from"./Grid-BAhwGuO1.js";import{f as ze}from"./events-CBEXM-sY.js";import{_ as Ie,a as Pe}from"./DescriptionsItem-C57uVyCa.js";import{e as $e}from"./exportExcel-D6OyA9oJ.js";import"./TimePicker-Dx4geqmp.js";import"./defineProperty-BYqLBAK_.js";const Ve=F({name:"FormSearch",__name:"form-search",props:B({AuditTypeData:{},AuditPolicyData:{}},{model:{required:!0},modelModifiers:{}}),emits:B(["reset","search"],["update:model"]),setup(d,{emit:N}){const A=d,o=N,{formRef:P,restoreValidation:k}=le(),i=K(d,"model");Se(De);async function T(t,u){t&&t.length>0?(i.value.startTime=t[0],i.value.endTime=t[1]):(i.value.startTime=null,i.value.endTime=null),o("search")}async function L(){await k(),i.value.timeRange=null,i.value.atype=null,i.value.ap=null,i.value.startTime=null,i.value.endTime=null,i.value.elevel=null,se(()=>{o("search")})}async function y(){o("search")}const z=we.throttle(y,1e3,{trailing:!1});return(t,u)=>{const r=ue,_=Ce,C=Ne,I=Te,v=H,S=ke,$=W,V=Ae,s=re,b=Q;return E(),q(b,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(s,{ref_key:"formRef",ref:P,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ie(h(z),["enter"])},{default:n(()=>[a(V,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[a(_,{span:"24 s:12 m:8 l:6",label:"事件等级",path:"elevel"},{default:n(()=>[a(r,{filterable:"",clearable:"",value:i.value.elevel,"onUpdate:value":[u[0]||(u[0]=e=>i.value.elevel=e),y],placeholder:"请选择事件等级",options:h(ne)(h(oe))},null,8,["value","options"])]),_:1}),a(_,{span:"24 s:12 m:8 l:6",label:"审计策略",path:"ap"},{default:n(()=>[a(r,{value:i.value.ap,"onUpdate:value":[u[1]||(u[1]=e=>i.value.ap=e),y],placeholder:"请选择审计策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:A.AuditPolicyData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(_,{span:"24 s:12 m:12 l:12",label:"产生时间",path:"timeRange"},{default:n(()=>[a(C,{clearable:"",value:i.value.timeRange,"onUpdate:value":u[2]||(u[2]=e=>i.value.timeRange=e),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":T},null,8,["value"])]),_:1}),a(_,{span:"24 s:12 m:12 l:6",label:" "},{default:n(()=>[a($,{class:"w-full"},{default:n(()=>[a(v,{onClick:L},{icon:n(()=>[a(I,{class:"text-icon"})]),default:n(()=>[w(" "+D(h(g)("common.reset")),1)]),_:1}),a(v,{type:"primary",ghost:"",onClick:h(z)},{icon:n(()=>[a(S,{class:"text-icon"})]),default:n(()=>[w(" "+D(h(g)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),ae=d=>(_e("data-v-2bc113e5"),d=d(),ve(),d),Oe=ae(()=>Y("span",null,"事件信息",-1)),Me=ae(()=>Y("span",null,"事件溯源",-1)),Ee={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"500px"}},Le={key:1,class:"max-h-500px min-h-320px"};function Re(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!Z(d)}const Ge=F({__name:"detailInfo",props:B({detailInfo:{},AuditTypeData:{},AuditPolicyData:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(d){const N=K(d,"detailVisible"),A=d,o=x();ce(()=>N.value,async t=>{t&&(o.value=A.detailInfo,T())});const P=[{title:"",key:"index",width:50,render:(t,u)=>`${u+1}`},{key:"pname1",title:"安全事件名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"安全事件类型",align:"center",width:140},{key:"pname2",title:"安全事件类别",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:t=>{(t.elevel===void 0||t.elevel===null)&&(t.elevel=1);const u={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},r=g(j[t.elevel]);let _={color:u[t.elevel],textColor:"#ffffff",borderColor:u[t.elevel]};return a(U,{size:"small",color:_},Re(r)?r:{default:()=>[r]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:180},{key:"type",title:"发生源设备类型",align:"center",width:160}],k=x(!1);let i=G([]);const T=async t=>{var _;if(!k.value)k.value=!0;else return;const{data:u,error:r}=await ze({pageId:t,auditid:(_=o.value)==null?void 0:_.auditid,limit:20});r||(k.value=!1,t?i=[...i,...u]:i=u)};function L(t){var r;Math.abs(t.target.scrollTop+t.target.offsetHeight-t.target.scrollHeight)<=20&&((r=o.value)==null?void 0:r.eco)>i.length&&y()}const y=te.debounce(()=>{T(i[i.length-1].id)},300),z=G({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:t,endIndex:u,page:r,pageSize:_,pageCount:C,itemCount:I}){var v,S;return`已加载${i.length}条 共${(i.length>((v=o.value)==null?void 0:v.eco)?i.length:(S=o.value)==null?void 0:S.eco)||0}条`}});return(t,u)=>{const r=Ie,_=Pe,C=W,I=de,v=X,S=pe,$=fe,V=me;return E(),q(V,{show:N.value,"onUpdate:show":u[0]||(u[0]=s=>N.value=s),title:"事件详情",preset:"card",class:"w-1200px"},{default:n(()=>[a($,{class:"max-h-600px pr-20px"},{default:n(()=>[a(S,{type:"line",animated:""},{default:n(()=>[a(I,{name:"1"},{tab:n(()=>[Oe]),default:n(()=>[a(C,{vertical:"",size:12},{default:n(()=>[a(_,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:n(()=>[a(r,{label:"审计事件名称"},{default:n(()=>{var s;return[w(D((s=o.value)==null?void 0:s.aename),1)]}),_:1}),a(r,{label:"审计类型"},{default:n(()=>{var s,b;return[w(D(((s=A.AuditTypeData.find(e=>{var l;return e.id===((l=o.value)==null?void 0:l.atype)}))==null?void 0:s.atypename)||((b=o.value)==null?void 0:b.atype)||""),1)]}),_:1}),a(r,{label:"审计策略"},{default:n(()=>{var s,b;return[w(D(((s=A.AuditPolicyData.find(e=>{var l;return e.id===((l=o.value)==null?void 0:l.ap)}))==null?void 0:s.pname)||((b=o.value)==null?void 0:b.ap)||""),1)]}),_:1}),a(r,{label:"事件等级"},{default:n(()=>{var s,b,e,l,c,f,m,p,O,R;return[a(h(U),{size:"small",color:{textColor:"#ffffff",borderColor:((s=o.value)==null?void 0:s.alevel)===0?"#8e9dff":((b=o.value)==null?void 0:b.alevel)===1?"#5da8ff":((e=o.value)==null?void 0:e.alevel)===2?"#fedc69":((l=o.value)==null?void 0:l.alevel)===3?"#ff9874":((c=o.value)==null?void 0:c.alevel)===4?"#ff0000":"#5da8ff",color:((f=o.value)==null?void 0:f.alevel)===0?"#8e9dff":((m=o.value)==null?void 0:m.alevel)===1?"#5da8ff":((p=o.value)==null?void 0:p.alevel)===2?"#fedc69":((O=o.value)==null?void 0:O.alevel)===3?"#ff9874":((R=o.value)==null?void 0:R.alevel)===4?"#ff0000":"#5da8ff"}},{default:n(()=>{var M;return[w(D(h(g)(h(j)[(M=o.value)==null?void 0:M.alevel])),1)]}),_:1},8,["color"])]}),_:1}),a(r,{label:"产生时间"},{default:n(()=>{var s;return[w(D((s=o.value)==null?void 0:s.dbtime),1)]}),_:1}),a(r,{label:"更新时间"},{default:n(()=>{var s;return[w(D((s=o.value)==null?void 0:s.uptime),1)]}),_:1}),a(r,{label:"事件总数"},{default:n(()=>{var s;return[w(D((s=o.value)==null?void 0:s.eco),1)]}),_:1})]),_:1})]),_:1})]),_:1}),a(I,{name:"2"},{tab:n(()=>[Me]),default:n(()=>[h(i).length==0?(E(),J("div",Ee," 暂无安全事件信息 ")):(E(),J("div",Le,[a(v,{columns:P,remote:"",data:h(i),size:"small","scroll-x":762,"row-key":s=>s.id,"virtual-scroll":"",class:"sm:h-full","max-height":400,loading:k.value,pagination:z,onScroll:L},null,8,["data","row-key","loading","pagination"])]))]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),je=ee(Ge,[["__scopeId","data-v-2bc113e5"]]),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function He(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!Z(d)}const Ue=F({name:"audit_event",__name:"index",setup(d){const N=x(window.innerHeight-395),A=ge(),o=x(!1),P=x(),k=x([]);(async()=>{const{data:e,error:l}=await he({page:1,limit:1e3});l||(k.value=JSON.parse(JSON.stringify(e)).list)})();const T=x([]);(async()=>{const{data:e,error:l}=await ye({page:1,limit:1e3});l||(T.value=JSON.parse(JSON.stringify(e)).list)})();const y=G({limit:20,pageId:void 0,elevel:void 0,atype:void 0,uid:void 0,suditPolicy:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),z=[{title:"",key:"index",width:80,align:"center",render:e=>`${e.index}`},{key:"aename",title:g("page.audit.event.eventName"),align:"center",minWidth:160,ellipsis:!0,resizable:!0},{key:"dbtime",title:g("page.audit.event.createTime"),align:"center",width:220,resizable:!0},{key:"uptime",title:g("page.audit.event.updateTime"),align:"center",width:220,resizable:!0},{key:"ap",title:g("page.audit.event.strategy"),align:"center",width:220,render:e=>{var c;const l=(c=T.value.find(f=>f.id===e.ap))==null?void 0:c.pname;return a("span",null,[l||e.ap])},resizable:!0},{key:"alevel",title:g("page.audit.event.eventRanK"),align:"center",width:220,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=0);const l={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},c=g(j[e.alevel]);let f={color:l[e.alevel],textColor:"#ffffff",borderColor:l[e.alevel]};return a(U,{size:"small",color:f},He(c)?c:{default:()=>[c]})},resizable:!0},{key:"eco",title:g("page.audit.event.eventCount"),align:"center",width:220,resizable:!0},{key:"operate",title:g("common.operate"),align:"center",width:220,fixed:"right",render:e=>a("div",{class:"flex-center gap-8px"},[a(H,{type:"primary",ghost:!0,size:"small",onClick:()=>s(e)},{default:()=>[w("详情")]})])}],t=x([]),u=x(!1),r=x(0),_=async(e=!1)=>{if(!u.value)u.value=!0;else return;u.value=!0;const{data:l,error:c}=await be(y);c||(r.value=l.length,e?t.value=[...t.value,...l]:t.value=l,t.value=t.value.map((f,m)=>(f.index=m+1,f)),u.value=!1)};_();const C=x(!0),I=()=>{t.value=[],y.pageId=void 0,(l=>Object.keys(l).filter(m=>m!=="limit"&&m!=="_t").some(m=>l[m]!==void 0&&l[m]!==""&&l[m]!==null))(y)?C.value=!1:(C.value=!0,S()),_()},v=G({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:l,page:c,pageSize:f,pageCount:m,itemCount:p}){return`已加载${t.value.length}条`+(t.value.length?C.value?` 共计 ${t.value.length>0?p??0:0} 条`:r.value==y.limit?"  预计还有更多":"  没有更多了":"")}});async function S(){const{data:e,error:l}=await xe();l||(v.pageCount=20,v.total=Number(e),v.itemCount=Number(e))}S();function $(e){var c;Math.abs(e.target.scrollTop+e.target.offsetHeight-e.target.scrollHeight)<=20&&v.total>((c=t.value)==null?void 0:c.length)&&V()}const V=te.debounce(()=>{var e;((e=t.value)==null?void 0:e.length)<v.total&&(y.pageId=t.value[t.value.length-1].id,_(!0))},300);async function s(e){P.value=e,o.value=!0}async function b(){if(!t.value.length)return;const e=JSON.parse(JSON.stringify(t.value)),l=[];e.forEach(f=>{const m={};z.forEach(p=>{var O;if(f.hasOwnProperty(p.key)){const R=p.key=="alevel"?g(j[f[p.key]]):p.key=="ap"?(O=T.value.find(M=>M.id===M[p.key]))==null?void 0:O.pname:f[p.key];m[p.title]=R}}),l.push(m)}),$e(l,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50}],"审计事件_"+new Date().getTime())}return(e,l)=>{const c=W,f=X,m=Q;return E(),J("div",Be,[a(Ve,{model:y,"onUpdate:model":l[0]||(l[0]=p=>y=p),onSearch:I,AuditTypeData:k.value,AuditPolicyData:T.value},null,8,["model","AuditTypeData","AuditPolicyData"]),a(m,{title:h(g)("page.audit.event.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(c,null,{default:n(()=>[a(h(H),{type:"primary",size:"small",ghost:"",onClick:b,title:"导出已加载"},{default:n(()=>[w("导出已加载")]),_:1})]),_:1})]),default:n(()=>[a(f,{columns:z,data:t.value,size:"small","virtual-scroll":"","flex-height":!h(A).isMobile,loading:u.value,remote:"","row-key":p=>p.id,"max-height":N.value,pagination:v,onScroll:$,class:"sm:h-full","scroll-x":""},null,8,["data","flex-height","loading","row-key","max-height","pagination"]),a(je,{"detail-visible":o.value,"onUpdate:detailVisible":l[1]||(l[1]=p=>o.value=p),"detail-info":P.value,AuditTypeData:k.value,AuditPolicyData:T.value},null,8,["detail-visible","detail-info","AuditTypeData","AuditPolicyData"])]),_:1},8,["title"])])}}}),st=ee(Ue,[["__scopeId","data-v-552bd2e8"]]);export{st as default};
