import{_ as ue,a as ce}from"./close-small-rounded-BPRmn8Ab.js";import{d as G,v as Z,r as L,J as he,K as A,o as h,c as T,w as n,f as $,g as e,h as m,L as B,aW as de,C as j,B as q,aj as Q,aZ as pe,E as P,D as J,S as ke,ay as H,j as E,t as O,a9 as R,e as F,ai as me,a_ as we,a$ as Ce,at as xe,A as z,aT as $e,N,i as S,b0 as Y,b1 as ee,ar as _e,b2 as te,b3 as ne,X as W,am as Te,b4 as fe,b5 as Se,aw as Ue,ax as De,y as Ve,b6 as Ie,b7 as Ne,P as Ee,ap as Be,aq as qe}from"./index-Ddi2sB0k.js";import{h as Pe,i as Me,j as Oe,k as Ge,l as je,m as Fe,n as Le,o as Ae,p as Re,q as Je,r as ze,s as We,t as He,u as Ke,v as Xe,w as Ze,x as Qe,y as Ye,z as et,A as tt,B as nt,C as at,D as lt,E as st,F as ot,G as it,H as rt,I as ut}from"./basic-config-Cpgh9KSl.js";import{_ as ge}from"./Table-DLvDI8uT.js";import{f as ae}from"./reportForm-DrdsO6ah.js";import{f as le}from"./scheduleTask-wHNC-s8g.js";import{b as ct,a as dt,_ as se}from"./DataTable-C6XgD3bf.js";import{_ as pt}from"./DatePicker-CzXYbD-y.js";import{_ as oe}from"./TimePicker-D8NxiB72.js";import{u as ie}from"./table-BPjc3v9J.js";import{_ as mt}from"./FormItemGridItem-Doopd_q6.js";import{_ as _t}from"./Grid-BNlat6r7.js";import{_ as ft}from"./Popconfirm-DSMr_7Fc.js";import{_ as ve}from"./Upload-CeGwRy84.js";import{u as gt}from"./usePageData-CZxRXUFA.js";import{a as vt}from"./events-vrbyYCRz.js";import"./Forward-CbtUBMk5.js";import"./defineProperty-DyljxdIa.js";import"./Progress-BrPKcu_X.js";const yt={class:"flex justify-center"},bt=G({name:"basicConfig",__name:"basicConfig",setup(V){const{formRef:d,validate:y,restoreValidation:l}=Z(),i=L(k());function k(){return{enablelock:1,locktime:5,lockcount:3,unlockeanble:1,unlocktime:5,aceffective:1,pwdexpire:1,expiretime:1,cputhreshold:80,memthreshold:80,captcha:1,tokentime:30}}const w={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},C={locktime:w,lockcount:w,unlocktime:w,expiretime:w,cputhreshold:w,memthreshold:w,tokentime:w},g=async()=>{const{data:o,error:a}=await Pe();a||Object.assign(i,o)};he(()=>{g()});const t=async()=>{var a;await y();const{error:o}=await Me(i);o||(a=window.$message)==null||a.success("设置成功")};return(o,a)=>{const p=de,u=j,s=q,f=Q,_=pe,c=P,v=J,b=ke,x=A("no-auth");return h(),T(b,{style:{"max-height":"calc(100vh - 245px)"}},{default:n(()=>[$("div",yt,[e(v,{ref_key:"formRef",ref:d,"label-width":180,"label-placement":"left",model:i,rules:C},{default:n(()=>[e(u,{label:"是否开启账号锁定",path:"enablelock"},{default:n(()=>[e(p,{value:i.enablelock,"onUpdate:value":a[0]||(a[0]=r=>i.enablelock=r),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(u,{label:"锁定周期",path:"locktime"},{default:n(()=>[e(_,{class:"flex items-center"},{default:n(()=>[e(s,{onClick:a[1]||(a[1]=r=>i.locktime--),disabled:i.locktime==1},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),e(f,{"show-button":!1,value:i.locktime,"onUpdate:value":a[2]||(a[2]=r=>i.locktime=r),placeholder:"",min:1,max:5},null,8,["value"]),e(s,{onClick:a[3]||(a[3]=r=>i.locktime++),disabled:i.locktime==5,class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1},8,["disabled"]),m(" 分钟 ")]),_:1})]),_:1}),e(u,{label:"锁定次数",path:"lockcount"},{default:n(()=>[e(_,{class:"flex items-center"},{default:n(()=>[e(s,{onClick:a[4]||(a[4]=r=>i.lockcount--),disabled:i.lockcount==2},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),e(f,{"show-button":!1,value:i.lockcount,"onUpdate:value":a[5]||(a[5]=r=>i.lockcount=r),placeholder:"",min:2,max:5},null,8,["value"]),e(s,{onClick:a[6]||(a[6]=r=>i.lockcount++),disabled:i.lockcount==5,class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1},8,["disabled"]),m(" 次 ")]),_:1})]),_:1}),e(u,{label:"是否开启自动解锁",path:"unlockeanble"},{default:n(()=>[e(p,{value:i.unlockeanble,"onUpdate:value":a[7]||(a[7]=r=>i.unlockeanble=r),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(u,{label:"解锁时间",path:"unlocktime"},{default:n(()=>[e(_,{class:"flex items-center"},{default:n(()=>[e(s,{onClick:a[8]||(a[8]=r=>i.unlocktime--),disabled:i.unlocktime==i.locktime},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),e(f,{"show-button":!1,value:i.unlocktime,"onUpdate:value":a[9]||(a[9]=r=>i.unlocktime=r),placeholder:"",min:i.locktime},null,8,["value","min"]),e(s,{onClick:a[10]||(a[10]=r=>i.unlocktime++),class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1}),m(" 分钟 ")]),_:1})]),_:1}),e(u,{label:"是否开启账号有效期登录",path:"aceffective"},{default:n(()=>[e(p,{value:i.aceffective,"onUpdate:value":a[11]||(a[11]=r=>i.aceffective=r),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(u,{label:"是否开启密码过期",path:"pwdexpire"},{default:n(()=>[e(p,{value:i.pwdexpire,"onUpdate:value":a[12]||(a[12]=r=>i.pwdexpire=r),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(u,{label:"密码过期时间",path:"expiretime"},{default:n(()=>[e(_,{class:"flex items-center"},{default:n(()=>[e(s,{onClick:a[13]||(a[13]=r=>i.expiretime--),disabled:i.expiretime==1},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),e(f,{"show-button":!1,value:i.expiretime,"onUpdate:value":a[14]||(a[14]=r=>i.expiretime=r),placeholder:"",min:1},null,8,["value"]),e(s,{onClick:a[15]||(a[15]=r=>i.expiretime++),class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1}),m(" 天 ")]),_:1})]),_:1}),e(u,{label:"CPU阈值",path:"cputhreshold"},{default:n(()=>[e(_,{class:"flex items-center"},{default:n(()=>[e(s,{onClick:a[16]||(a[16]=r=>i.cputhreshold--),disabled:i.cputhreshold==0},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),e(f,{"show-button":!1,value:i.cputhreshold,"onUpdate:value":a[17]||(a[17]=r=>i.cputhreshold=r),placeholder:"",min:0,max:100},null,8,["value"]),e(s,{onClick:a[18]||(a[18]=r=>i.cputhreshold++),disabled:i.cputhreshold==100,class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1},8,["disabled"]),m(" % ")]),_:1})]),_:1}),e(u,{label:"MEM阈值",path:"memthreshold"},{default:n(()=>[e(_,{class:"flex items-center"},{default:n(()=>[e(s,{onClick:a[19]||(a[19]=r=>i.memthreshold--),disabled:i.memthreshold==0},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),e(f,{"show-button":!1,value:i.memthreshold,"onUpdate:value":a[20]||(a[20]=r=>i.memthreshold=r),placeholder:"",min:0,max:100},null,8,["value"]),e(s,{onClick:a[21]||(a[21]=r=>i.memthreshold++),disabled:i.memthreshold==100,class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1},8,["disabled"]),m(" % ")]),_:1})]),_:1}),e(u,{label:"是否开启验证码",path:"captcha"},{default:n(()=>[e(p,{value:i.captcha,"onUpdate:value":a[22]||(a[22]=r=>i.captcha=r),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(u,{label:"token过期时间",path:"tokentime"},{default:n(()=>[e(_,{class:"flex items-center"},{default:n(()=>[e(s,{onClick:a[23]||(a[23]=r=>i.tokentime--),disabled:i.tokentime==1},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),e(f,{"show-button":!1,value:i.tokentime,"onUpdate:value":a[24]||(a[24]=r=>i.tokentime=r),placeholder:"",min:1},null,8,["value"]),e(s,{onClick:a[25]||(a[25]=r=>i.tokentime++),class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1}),m(" 小时 ")]),_:1})]),_:1}),e(u,{label:" "},{default:n(()=>[e(c,null,{default:n(()=>[B((h(),T(s,{type:"default",ghost:"",onClick:g},{default:n(()=>[m(" 刷新 ")]),_:1})),[[x,"system.conf.select"]]),B((h(),T(s,{type:"info",ghost:"",onClick:t},{default:n(()=>[m(" 保存 ")]),_:1})),[[x,"system.conf.update"]])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})}}}),ht=H(bt,[["__scopeId","data-v-3c461f33"]]),kt=$("td",null,"产品名称",-1),wt=$("td",null,"产品版本",-1),Ct=$("td",null,"build号",-1),xt=$("td",null,"产品型号",-1),$t=G({name:"basicInfo",__name:"basicInfo",setup(V){const d=E({id:1,pname:"",pversion:"",pbuild:"",pmodel:""});(async()=>{const{data:k,error:w}=await Oe();w||(d.value=k)})(),E(0);const l=async()=>{var C,g;const{data:k,error:w}=await Ge();w||(k==="重启失败"?(C=window.$message)==null||C.error(k):(g=window.$message)==null||g.success(k))},i=async()=>{var C,g;const{data:k,error:w}=await je();w||(k==="关机失败"?(C=window.$message)==null||C.error(k):(g=window.$message)==null||g.success(k))};return(k,w)=>{const C=ge,g=q,t=P,o=R,a=A("no-auth");return h(),T(o,{class:"w-600px text-center m-auto mt-20px"},{default:n(()=>[e(C,{bordered:!0,"single-line":!1},{default:n(()=>[$("tbody",null,[$("tr",null,[kt,$("td",null,O(d.value.pname||""),1)]),$("tr",null,[wt,$("td",null,O(d.value.pversion),1)]),$("tr",null,[Ct,$("td",null,O(d.value.pbuild),1)]),$("tr",null,[xt,$("td",null,O(d.value.pmodel),1)])])]),_:1}),e(t,{justify:"center",class:"mt-50px"},{default:n(()=>[B((h(),T(g,{type:"info",ghost:"",onClick:l},{default:n(()=>[m("重启")]),_:1})),[[a,"sysmanger.basicInfo.restart"]]),B((h(),T(g,{type:"info",ghost:"",onClick:i},{default:n(()=>[m("关机")]),_:1})),[[a,"sysmanger.basicInfo.shutdown"]])]),_:1})]),_:1})}}}),Tt=G({name:"emailService",__name:"emailSever",setup(V){const{formRef:d,validate:y}=Z(),l=E({port:void 0,pwd:"",sendserver:"",essl:0,uname:""}),i={sendserver:[{required:!0,validator:(t,o,a)=>o?we(o)?a():a(new Error("请输入正确的IP地址或域名")):new Error("请输入服务器地址"),trigger:["blur","input"]}],port:{type:"number",required:!0,trigger:["blur","input"],validator:(t,o,a)=>o==null||o==null?new Error("请输入端口号"):Ce(o)?!0:new Error("请输入在0-65535之间的数字")},uname:[{required:!0,message:"请输入账号",trigger:"blur"}],pwd:[{required:!0,message:"请输入密码",trigger:"blur"}],sendaddr:[{required:!0,message:"请输入发件邮箱",trigger:["blur","input"]},{validator:xe,trigger:["blur","input"]}]},k=async()=>{const{data:t,error:o}=await Fe();o||(l.value.sendserver=(t==null?void 0:t.sendserver)??l.value.sendserver,l.value.port=(t==null?void 0:t.port)??l.value.port,l.value.pwd=(t==null?void 0:t.pwd)??l.value.pwd,l.value.essl=(t==null?void 0:t.essl)??l.value.essl,l.value.uname=(t==null?void 0:t.uname)??l.value.uname,l.value.id=(t==null?void 0:t.id)??l.value.id)};k();const w=async()=>{var t,o,a,p;if(await y(),l.value.id){const{data:u,error:s}=await Le(l.value);s||((t=window.$message)==null||t.destroyAll(),(o=window.$message)==null||o.success("保存成功"))}else{const{data:u,error:s}=await Ae(l.value);s||((a=window.$message)==null||a.destroyAll(),(p=window.$message)==null||p.success("保存成功"))}},C=async()=>{var a,p;const{data:t,error:o}=await Re();o||((a=window.$message)==null||a.destroyAll(),(p=window.$message)==null||p.success("重置成功"),k())},g=async()=>{var a,p;await y();const{data:t,error:o}=await Je(l.value);o||((a=window.$message)==null||a.destroyAll(),(p=window.$message)==null||p.success("测试成功"))};return(t,o)=>{const a=z,p=j,u=Q,s=de,f=J,_=q,c=P,v=A("no-auth");return h(),F(me,null,[e(f,{ref_key:"formRef",ref:d,"label-width":150,model:l.value,rules:i,"label-placement":"left",class:"w-400px",style:{margin:"50px auto"}},{default:n(()=>[e(p,{label:"发送邮件服务器",path:"sendserver"},{default:n(()=>[e(a,{value:l.value.sendserver,"onUpdate:value":o[0]||(o[0]=b=>l.value.sendserver=b),placeholder:"输入服务器或IP地址"},null,8,["value"])]),_:1}),e(p,{label:"端口",path:"port"},{default:n(()=>[e(u,{value:l.value.port,"onUpdate:value":o[1]||(o[1]=b=>l.value.port=b),placeholder:"输入端口",style:{width:"100%"}},null,8,["value"])]),_:1}),e(p,{label:"用户名",path:"uname"},{default:n(()=>[e(a,{value:l.value.uname,"onUpdate:value":o[2]||(o[2]=b=>l.value.uname=b),placeholder:"用户名"},null,8,["value"])]),_:1}),e(p,{label:"密码",path:"pwd"},{default:n(()=>[e(a,{type:"password",value:l.value.pwd,"onUpdate:value":o[3]||(o[3]=b=>l.value.pwd=b),placeholder:"密码","show-password-on":"click"},null,8,["value"])]),_:1}),e(p,{label:"ssl",path:"essl"},{default:n(()=>[e(s,{value:l.value.essl,"onUpdate:value":o[4]||(o[4]=b=>l.value.essl=b),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"]),e(c,{justify:"center"},{default:n(()=>[B((h(),T(_,{type:"info",ghost:"",onClick:g},{default:n(()=>[m("测试")]),_:1})),[[v,"sysmanger.basicInfo.test.mailInfo"]]),B((h(),T(_,{type:"info",ghost:"",onClick:w},{default:n(()=>[m("保存")]),_:1})),[[v,"sysmanger.mailInfo.update"]]),B((h(),T(_,{type:"info",ghost:"",onClick:C},{default:n(()=>[m("重置")]),_:1})),[[v,"sysmanger.mailInfo.delete"]])]),_:1})],64)}}}),St=G({name:"TimingConfig",__name:"timingConfig",setup(V){const{formRef:d,validate:y}=Z(),l=L({automatic:1,time:$e(1,new Date),ip:"",taskId:"",showCron:!1,setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),i={time:{required:!0,message:"请选择时间",trigger:"blur"},ip:[{required:!0,message:"请输入IP",trigger:"blur"},{validator:_e,trigger:"blur"}],task:{required:!0,message:"请设置表达式",trigger:"blur"},setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}},k=async()=>{const{data:g,error:t}=await ze();t||(l.time=g)};k(),(async()=>{const{data:g,error:t}=await We();if(t)return;const{id:o,params:a}=g;try{if(a){const{cron:p,ip:u}=JSON.parse(a),s=te(p);l.setting.settingCycle=s==null?void 0:s.settingCycle,l.setting.settingTime=s==null?void 0:s.settingTime,l.setting.settingCycleValue=s==null?void 0:s.settingCycleValue,l.ip=u,l.taskId=o}}catch(p){console.error("Error parsing params:",p)}})();const C=async()=>{var g,t;if(await y(),l.automatic){const{data:o,error:a}=await He({dtime:l.time});a||(g=window.$message)==null||g.success(o)}else{const o=ne(l.setting.settingCycle==1?{dayOfWeek:l.setting.settingCycleValue,time:l.setting.settingTime}:null,l.setting.settingCycle==2?{dayOfMonth:l.setting.settingCycleValue,time:l.setting.settingTime}:null,l.setting.settingCycle==3?{time:l.setting.settingTime}:null);l.taskId?await le({id:l.taskId,beanName:"NtpTask",cronExpression:o,remark:"",status:1,params:JSON.stringify({ip:l.ip,cron:o})}):await ae({beanName:"NtpTask",cronExpression:o,remark:"",status:1,params:JSON.stringify({ip:l.ip,cron:o})});const{data:a,error:p}=await Ke({ip:l.ip});p||(t=window.$message)==null||t.success(a)}};return(g,t)=>{const o=ct,a=P,p=dt,u=j,s=pt,f=z,_=W,c=oe,v=q,b=J,x=A("no-auth");return h(),T(b,{ref_key:"formRef",ref:d,"label-width":180,"label-placement":"left",model:l,class:"m-auto w-600px mt-20px",rules:i},{default:n(()=>[e(u,{label:"校时",path:"enablelock"},{default:n(()=>[e(p,{value:l.automatic,"onUpdate:value":t[0]||(t[0]=r=>l.automatic=r),name:"radiogroup"},{default:n(()=>[e(a,null,{default:n(()=>[e(o,{value:1},{default:n(()=>[m("手动校时")]),_:1}),e(o,{value:0},{default:n(()=>[m("自动校时")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),l.automatic?(h(),T(u,{key:0,label:"设置中心服务器时间",path:"time"},{default:n(()=>[e(s,{"formatted-value":l.time,"onUpdate:formattedValue":t[1]||(t[1]=r=>l.time=r),format:"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:""},null,8,["formatted-value"])]),_:1})):N("",!0),l.automatic?N("",!0):(h(),F(me,{key:1},[e(u,{label:"NTP服务器设置",path:"ip"},{default:n(()=>[e(f,{value:l.ip,"onUpdate:value":t[2]||(t[2]=r=>l.ip=r),placeholder:"输入NTP服务器设置"},null,8,["value"])]),_:1}),e(u,{label:"设置周期",path:"setting.settingCycle"},{default:n(()=>[e(a,{justify:"space-between"},{default:n(()=>[e(_,{value:l.setting.settingCycle,"onUpdate:value":[t[3]||(t[3]=r=>l.setting.settingCycle=r),t[4]||(t[4]=r=>l.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"200px"}},null,8,["value"]),e(u,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:n(()=>[e(a,null,{default:n(()=>[l.setting.settingCycle==1?(h(),T(_,{key:0,value:l.setting.settingCycleValue,"onUpdate:value":t[5]||(t[5]=r=>l.setting.settingCycleValue=r),options:S(Y)(),style:{width:"200px"}},null,8,["value","options"])):N("",!0),l.setting.settingCycle==2?(h(),T(_,{key:1,value:l.setting.settingCycleValue,"onUpdate:value":t[6]||(t[6]=r=>l.setting.settingCycleValue=r),options:S(ee)(),style:{width:"200px"}},null,8,["value","options"])):N("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{label:"设置时间",path:"setting.settingTime"},{default:n(()=>[e(c,{"formatted-value":l.setting.settingTime,"onUpdate:formattedValue":t[7]||(t[7]=r=>l.setting.settingTime=r)},null,8,["formatted-value"])]),_:1})],64)),e(u,null,{label:n(()=>[l.automatic?B((h(),T(v,{key:0,type:"info",ghost:"",onClick:k},{default:n(()=>[m(" 查看服务器时间 ")]),_:1})),[[x,"sysmanger.basicInfo.gettiming"]]):N("",!0)]),default:n(()=>[e(a,null,{default:n(()=>[B((h(),T(v,{type:"info",ghost:"",onClick:C},{default:n(()=>[m(" 保存 ")]),_:1})),[[x,"sysmanger.basicInfo.manu.timing"]])]),_:1})]),_:1})]),_:1},8,["model"])}}}),Ut={class:"h-full flex-col"},Dt=G({name:"dataBase",__name:"dataBase",setup(V){const d=()=>[...Array(12).keys()].map(u=>({label:`${u+1}个月`,value:u+1})),y=L({space:80,retention:void 0,id:void 0}),{columns:l,columnChecks:i,data:k,getData:w,loading:C,mobilePagination:g,searchParams:t,resetSearchParams:o}=ie({apiFn:Xe,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center"}]});(async()=>{const{data:u,error:s}=await Ze();s||(y.space=u.space,y.retention=u.retention,y.id=u.id)})();const p=async()=>{var f;const{data:u,error:s}=await Qe({space:y.space,retention:y.retention,id:y.id});s||(f=window.$message)==null||f.success("保存成功")};return(u,s)=>{const f=q,_=Q,c=pe,v=j,b=W,x=P,r=R,M=se,D=A("no-auth");return h(),F("div",Ut,[e(r,{title:"数据库维护配置",bordered:!1,class:"mb-20px","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[e(x,{class:"ml-50px"},{default:n(()=>[e(v,{label:"已用空间超过","label-placement":"left"},{default:n(()=>[e(c,{class:"flex items-center"},{default:n(()=>[e(f,{onClick:s[0]||(s[0]=I=>y.space--),disabled:y.space==1},{default:n(()=>[m(" − ")]),_:1},8,["disabled"]),e(_,{"show-button":!1,value:y.space,"onUpdate:value":s[1]||(s[1]=I=>y.space=I),placeholder:"",min:1,max:100,style:{width:"100px","text-align":"center"}},null,8,["value"]),e(f,{onClick:s[2]||(s[2]=I=>y.space++),disabled:y.space==100,class:"mr-5px"},{default:n(()=>[m(" + ")]),_:1},8,["disabled"]),m(" % 时自动维护 ")]),_:1})]),_:1}),e(v,{label:"数据保留时间","label-placement":"left",class:"mx-20px"},{default:n(()=>[e(b,{value:y.retention,"onUpdate:value":s[3]||(s[3]=I=>y.retention=I),placeholder:"请选择",options:d(),style:{width:"150px"}},null,8,["value","options"])]),_:1}),e(v,{label:" ","label-placement":"left"},{default:n(()=>[B((h(),T(f,{type:"info",ghost:"",onClick:p},{default:n(()=>[m("保存")]),_:1})),[[D,"sysmanger.basicInfo.insert.dataBaseMaintenance"]])]),_:1})]),_:1})]),_:1}),e(r,{title:"数据库维护列表",bordered:!1,class:"flex-1","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[e(M,{columns:S(l),data:S(k),size:"small","scroll-x":462,loading:S(C),remote:"","row-key":I=>I.id,pagination:S(g),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})])}}}),Vt={class:"h-full flex-col"},It=G({name:"dataBackup",__name:"dataBackup",setup(V){const{columns:d,columnChecks:y,data:l,getData:i,loading:k,mobilePagination:w,searchParams:C,resetSearchParams:g}=ie({apiFn:Ye,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center"}]}),t=L({id:"",ip:"",username:"",pwd:"",path:"",cron:"",showCron:!1,setting:{settingCycle:1,settingCycleValue:1,settingTime:void 0}}),o=E(null),a={ip:[{required:!0,message:"请输入IP",trigger:"blur"},{validator:_e,trigger:"blur"}],cron:{required:!0,message:"请设置表达式",trigger:"blur"},username:{required:!0,message:"请输入账号",trigger:"blur"},pwd:{required:!0,message:"请输入密码",trigger:"blur"},path:{required:!0,message:"请输入路径",trigger:"blur"},setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}};(async()=>{const{data:_,error:c}=await et();if(c)return;const{id:v,params:b}=_;if(t.id=v,b)try{const{ip:x,username:r,pwd:M,path:D,cron:I}=JSON.parse(b),X=te(I);Object.assign(t,{ip:x,username:r,pwd:M,path:D,cron:I,setting:X})}catch(x){console.error("Error parsing params:",x)}})();const u=async()=>{var c,v,b;await((c=o.value)==null?void 0:c.validate());const _=ne(t.setting.settingCycle==1?{dayOfWeek:t.setting.settingCycleValue,time:t.setting.settingTime}:null,t.setting.settingCycle==2?{dayOfMonth:t.setting.settingCycleValue,time:t.setting.settingTime}:null,t.setting.settingCycle==3?{time:t.setting.settingTime}:null);if(t.id){const{data:x,error:r}=await le({beanName:"DataBackUpsTask",id:t.id,cronExpression:_,remark:"",status:1,params:JSON.stringify({ip:t.ip,username:t.username,pwd:t.pwd,path:t.path,cron:_})});r||(v=window.$message)==null||v.success("备份设置成功")}else{const{data:x,error:r}=await ae({beanName:"DataBackUpsTask",cronExpression:_,remark:"",status:1,params:JSON.stringify({ip:t.ip,username:t.username,pwd:t.pwd,path:t.path,cron:_})});r||(b=window.$message)==null||b.success("备份设置成功")}},s=(_,c)=>c===null?!1:Number(c)==6?_!=0:!1,f=(_,c,v)=>v===null||c===null?!1:Number(v)==6?_!=0:!1;return(_,c)=>{const v=z,b=mt,x=W,r=j,M=P,D=oe,I=q,X=_t,ye=J,re=R,be=se;return h(),F("div",Vt,[e(re,{title:"数据库备份",bordered:!1,class:"mb-20px","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[e(ye,{"label-placement":"left",model:t,rules:a,"label-width":150,class:"px-100px"},{default:n(()=>[e(X,{cols:24,"x-gap":24},{default:n(()=>[e(b,{span:8,label:"IP地址",path:"ip"},{default:n(()=>[e(v,{value:t.ip,"onUpdate:value":c[0]||(c[0]=U=>t.ip=U),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),e(b,{span:8,label:"账号",path:"username"},{default:n(()=>[e(v,{value:t.username,"onUpdate:value":c[1]||(c[1]=U=>t.username=U),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),e(b,{span:8,label:"密码",path:"pwd"},{default:n(()=>[e(v,{type:"password","show-password-on":"mousedown",value:t.pwd,"onUpdate:value":c[2]||(c[2]=U=>t.pwd=U),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),e(b,{span:8,label:"路径",path:"path"},{default:n(()=>[e(v,{value:t.path,"onUpdate:value":c[3]||(c[3]=U=>t.path=U),placeholder:"",style:{width:"100%"}},null,8,["value"])]),_:1}),e(b,{span:8,label:"设置周期",path:"setting.settingCycle"},{default:n(()=>[e(M,{justify:"space-between",class:"w-100%"},{default:n(()=>[e(x,{value:t.setting.settingCycle,"onUpdate:value":[c[4]||(c[4]=U=>t.setting.settingCycle=U),c[5]||(c[5]=U=>t.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2}],style:{width:"140px"}},null,8,["value"]),e(r,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:n(()=>[t.setting.settingCycle==1?(h(),T(x,{key:0,value:t.setting.settingCycleValue,"onUpdate:value":c[6]||(c[6]=U=>t.setting.settingCycleValue=U),options:S(Y)(),style:{width:"140px"}},null,8,["value","options"])):N("",!0),t.setting.settingCycle==2?(h(),T(x,{key:1,value:t.setting.settingCycleValue,"onUpdate:value":c[7]||(c[7]=U=>t.setting.settingCycleValue=U),options:S(ee)(),style:{width:"140px"}},null,8,["value","options"])):N("",!0)]),_:1})]),_:1})]),_:1}),e(b,{span:8,label:"设置时间",path:"setting.settingTime"},{default:n(()=>[e(M,{justify:"space-between"},{default:n(()=>[e(D,{"formatted-value":t.setting.settingTime,"onUpdate:formattedValue":c[8]||(c[8]=U=>t.setting.settingTime=U),hours:[0,1,2,3,4,5,6],"is-minute-disabled":s,"is-second-disabled":f,actions:["confirm"]},null,8,["formatted-value"]),e(I,{type:"info",ghost:"",onClick:u},{default:n(()=>[m("保存")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(re,{title:"数据备份列表",bordered:!1,class:"flex-1","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[e(be,{columns:S(d),data:S(l),size:"small","scroll-x":462,loading:S(k),remote:"","row-key":U=>U.id,pagination:S(w),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})])}}}),Nt=H(It,[["__scopeId","data-v-c6c05c8b"]]),Et={class:"h-full flex-col"},Bt=G({name:"systemSnapshot",__name:"systemSnapshot",setup(V){const{columns:d,columnChecks:y,data:l,getData:i,loading:k,mobilePagination:w,searchParams:C,resetSearchParams:g}=ie({apiFn:tt,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center",render:s=>e(Te,{type:s.resultmsg==1?"error":"success"},{default:()=>[s.resultmsg==1?"失败":"成功"]})},{title:"操作",key:"operate",align:"center",width:100,fixed:"right",render:s=>e(ft,{onPositiveClick:()=>u(s.id)},{default:()=>"确定恢复吗?恢复后将重启系统",trigger:()=>e(q,{type:"info",ghost:!0,size:"small"},{default:()=>[m("恢复")]})})}]}),t=L({id:"",setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),o={setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}};(async()=>{const{data:s,error:f}=await nt();if(f)return;console.log(s,"asdas");const _=te(s.cronExpression);Object.assign(t,{id:s.id,setting:_})})();const p=async()=>{var f,_;const s=ne(t.setting.settingCycle==1?{dayOfWeek:t.setting.settingCycleValue,time:t.setting.settingTime}:null,t.setting.settingCycle==2?{dayOfMonth:t.setting.settingCycleValue,time:t.setting.settingTime}:null,t.setting.settingCycle==3?{time:t.setting.settingTime}:null);if(t.id){const{data:c,error:v}=await le({id:t.id,beanName:"SnapshotTask",cronExpression:s,status:1,params:JSON.stringify({corn:s})});v||(f=window.$message)==null||f.success("设置成功")}else{const{data:c,error:v}=await ae({beanName:"SnapshotTask",cronExpression:s,remark:"",status:1,params:JSON.stringify({corn:s})});v||(_=window.$message)==null||_.success("设置成功")}},u=async s=>{var c;const{data:f,error:_}=await at({id:s});_||(c=window.$message)==null||c.success("恢复成功")};return(s,f)=>{const _=W,c=j,v=P,b=oe,x=J,r=R,M=se;return h(),F("div",Et,[e(r,{title:"快照备份设置",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:n(()=>[e(v,{class:"ml-50px"},{default:n(()=>[e(x,{"label-placement":"left",inline:"",model:t,rules:o,"label-width":150,class:"px-100px"},{default:n(()=>[e(c,{label:"设置周期",path:"setting.settingCycle"},{default:n(()=>[e(v,{justify:"space-between"},{default:n(()=>[e(_,{value:t.setting.settingCycle,"onUpdate:value":[f[0]||(f[0]=D=>t.setting.settingCycle=D),f[1]||(f[1]=D=>t.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"140px"}},null,8,["value"]),e(c,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:n(()=>[t.setting.settingCycle==1?(h(),T(_,{key:0,value:t.setting.settingCycleValue,"onUpdate:value":f[2]||(f[2]=D=>t.setting.settingCycleValue=D),options:S(Y)(),style:{width:"140px"}},null,8,["value","options"])):N("",!0),t.setting.settingCycle==2?(h(),T(_,{key:1,value:t.setting.settingCycleValue,"onUpdate:value":f[3]||(f[3]=D=>t.setting.settingCycleValue=D),options:S(ee)(),style:{width:"140px"}},null,8,["value","options"])):N("",!0)]),_:1})]),_:1})]),_:1}),e(c,{label:"设置时间",path:"setting.settingTime"},{default:n(()=>[e(b,{"formatted-value":t.setting.settingTime,"onUpdate:formattedValue":f[4]||(f[4]=D=>t.setting.settingTime=D)},null,8,["formatted-value"])]),_:1}),e(c,{label:" ","label-placement":"left"},{default:n(()=>[e(S(q),{type:"info",ghost:"",onClick:p},{default:n(()=>[m("保存")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(r,{title:"快照备份列表",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"},class:"flex-1"},{default:n(()=>[e(M,{columns:S(d),data:S(l),size:"small","scroll-x":462,loading:S(k),remote:"","row-key":D=>D.id,pagination:S(w),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})])}}}),K=V=>(Ue("data-v-cf07ff98"),V=V(),De(),V),qt={class:"flex-col justify-between h-100%"},Pt={class:"flex"},Mt=K(()=>$("td",null,"序列号",-1)),Ot=K(()=>$("td",null,"创建时间",-1)),Gt=K(()=>$("td",null,"有效时间",-1)),jt=K(()=>$("td",null,"可配置采集器数量",-1)),Ft=G({__name:"LicenseConfig",setup(V){const d=E(""),y=E(null),l=({file:a})=>{y.value=a.file,d.value=a.name},i=a=>{a.stopPropagation(),d.value="",y.value=null},k=E({num:"",dbtime:"",collnum:"",efftime:0}),w=E(""),C=async()=>{try{const{data:a}=await lt();w.value=a}catch(a){console.error("获取机器码失败",a)}},g=()=>{const a=new Se("#copyMachineCodeBtn",{text:()=>w.value});a.on("success",p=>{var u;console.log("复制成功:",p.text),(u=window.$message)==null||u.success("复制成功"),p.clearSelection(),a.destroy()}),a.on("error",p=>{var u;console.error("复制失败:",p),(u=window.$message)==null||u.error("复制失败，请重试"),a.destroy()})},t=async()=>{try{const{data:a}=await st();k.value=a}catch(a){console.error("获取 License 失败",a)}};t();const o=async()=>{var a,p;if(!d.value.endsWith(".lic"))return(a=window.$message)==null?void 0:a.error("请上传.lic文件");try{const u=new FormData;u.append("fi",y.value);const{data:s,error:f}=await ot(u);if(f)return;(p=window.$message)==null||p.success(s),t(),d.value="",y.value=null}catch(u){console.error("上传失败",u)}};return(a,p)=>{const u=q,s=z,f=P,_=ue,c=ce,v=ve,b=j,x=ge,r=P;return h(),T(r,{justify:"center",class:"pt-20px important-flex-col items-center"},{default:n(()=>[e(f,{class:"mb-20px"},{default:n(()=>[$("div",qt,[e(u,{type:"info",ghost:"",onClick:C},{default:n(()=>[m("查看机器码")]),_:1}),e(u,{id:"copyMachineCodeBtn",type:"success",ghost:"",onClick:g},{default:n(()=>[m(" 复制 ")]),_:1})]),e(s,{value:w.value,"onUpdate:value":p[0]||(p[0]=M=>w.value=M),readonly:"",type:"textarea",style:{width:"340px"},placeholder:"机器码"},null,8,["value"])]),_:1}),$("div",Pt,[e(b,{label:"License管理","label-placement":"left"},{default:n(()=>[e(v,{action:"","custom-request":l,"show-file-list":!1,accept:".lic"},{default:n(()=>[d.value?(h(),F("div",{key:0,onClick:p[1]||(p[1]=fe(()=>{},["stop"]))},[m(O(d.value)+" ",1),e(_,{class:"font-size-30px cursor-pointer",onClick:i})])):(h(),T(u,{key:1},{icon:n(()=>[e(c,{class:"text-icon"})]),default:n(()=>[m(" 选择文件")]),_:1}))]),_:1})]),_:1}),e(b,{label:"","label-placement":"left",class:"ml-20px"},{default:n(()=>[e(u,{type:"info",ghost:"",disabled:!d.value,onClick:o},{default:n(()=>[m("上传")]),_:1},8,["disabled"])]),_:1})]),k.value.num?(h(),T(x,{key:0,bordered:!0,"single-line":!1,class:"w-800px text-center m-auto mt-20px"},{default:n(()=>[$("tbody",null,[$("tr",null,[Mt,$("td",null,O(k.value.num||""),1)]),$("tr",null,[Ot,$("td",null,O(k.value.dbtime),1)]),$("tr",null,[Gt,$("td",null,O(k.value.efftime==0?"永久":`${k.value.efftime}年`),1)]),$("tr",null,[jt,$("td",null,O(k.value.collnum),1)])])]),_:1})):N("",!0)]),_:1})}}}),Lt=H(Ft,[["__scopeId","data-v-cf07ff98"]]),At=G({__name:"sysStatus",setup(V){const d=L({mailaddr:"",snmpaddr:void 0,stype:0,tmail:0,tsnmp:0});(async()=>{const{data:t,error:o}=await it();o||(d.mailaddr=(t==null?void 0:t.mailaddr)??d.mailaddr,d.snmpaddr=(t==null?void 0:t.snmpaddr)??d.snmpaddr,d.stype=(t==null?void 0:t.stype)??d.stype,d.tmail=(t==null?void 0:t.tmail)??d.tmail,d.tsnmp=(t==null?void 0:t.tsnmp)??d.tsnmp)})();const l=async()=>{var a;const{data:t,error:o}=await rt(d);o||(a=window.$message)==null||a.success("保存成功")},{pageData:i,getData:k,nextPage:w}=gt(vt),C=async t=>{const o=t.currentTarget;o.scrollTop+o.offsetHeight>=o.scrollHeight&&i.data.length<i.total&&w()},g=E();return Ve(()=>i.data,t=>{t&&(g.value=t.filter(o=>o.ftype===1))}),k(),(t,o)=>{const a=Ne,p=Ee,u=z,s=j,f=W,_=q,c=P,v=R,b=A("no-auth");return h(),T(c,{justify:"center"},{default:n(()=>[e(v,{title:"通知方式",class:"w-600px"},{default:n(()=>[e(a),e(p,{checked:d.tmail,"onUpdate:checked":o[0]||(o[0]=x=>d.tmail=x),"checked-value":1,"unchecked-value":0},{default:n(()=>[m(" 邮件 ")]),_:1},8,["checked"]),d.tmail?(h(),T(s,{key:0,label:"邮件地址","label-placement":"left","label-width":"120",class:"mt-30px",rule:{required:!0,validator:()=>{if(!d.mailaddr)return new Error("请输入邮件地址");if(!S(Ie)(d.mailaddr))return new Error("请输入正确的邮件地址")},trigger:["blur","input"]}},{default:n(()=>[e(u,{value:d.mailaddr,"onUpdate:value":o[1]||(o[1]=x=>d.mailaddr=x)},null,8,["value"])]),_:1},8,["rule"])):N("",!0),e(a),e(p,{checked:d.tsnmp,"onUpdate:checked":o[2]||(o[2]=x=>d.tsnmp=x),"checked-value":1,"unchecked-value":0},{default:n(()=>[m(" snmp trap ")]),_:1},8,["checked"]),d.tsnmp?(h(),T(s,{key:1,label:"通知服务器","label-placement":"left","label-width":"120",class:"mt-30px"},{default:n(()=>[e(f,{value:d.snmpaddr,"onUpdate:value":o[3]||(o[3]=x=>d.snmpaddr=x),options:g.value,"label-field":"ipaddr","value-field":"ipaddr",onScroll:C},null,8,["value","options"])]),_:1})):N("",!0),e(a),e(c,{justify:"end"},{default:n(()=>[B((h(),T(_,{type:"info",ghost:"",onClick:l},{default:n(()=>[m("保存")]),_:1})),[[b,"sysmanger.basicInfo.alarmNotification"]])]),_:1})]),_:1})]),_:1})}}}),Rt={class:"h-full"},Jt=G({name:"basicconfig_system-config",__name:"index",setup(V){const d=E("基本信息"),y=E(""),l=E(null),i=({file:C})=>{l.value=C.file,y.value=C.name},k=C=>{C.stopPropagation(),y.value="",l.value=null};L({fs:""});const w=async()=>{var C;try{const g=new FormData;g.append("fi",l.value);const{data:t,error:o}=await ut({name:y.value},g);if(o)return;(C=window.$message)==null||C.success(t)}catch{}};return(C,g)=>{const t=Be,o=ue,a=ce,p=q,u=ve,s=j,f=P,_=qe,c=R,v=A("no-auth");return h(),F("div",Rt,[e(c,{style:{"margin-bottom":"16px"},class:"h-full","content-style":{height:"100%"}},{default:n(()=>[e(_,{type:"card",animated:"",class:"h-100%",value:d.value,"onUpdate:value":g[1]||(g[1]=b=>d.value=b)},{default:n(()=>[e(t,{name:"基本信息",tab:"基本信息"},{default:n(()=>[e($t)]),_:1}),e(t,{name:"基础配置",tab:"基础配置"},{default:n(()=>[e(ht)]),_:1}),e(t,{name:"邮件服务",tab:"邮件服务"},{default:n(()=>[e(Tt)]),_:1}),e(t,{name:"校时配置",tab:"校时配置"},{default:n(()=>[e(St)]),_:1}),e(t,{name:"数据库维护",tab:"数据库维护",class:"h-100%"},{default:n(()=>[e(Dt)]),_:1}),e(t,{name:"数据库备份",tab:"数据库备份",class:"h-100%"},{default:n(()=>[e(Nt)]),_:1}),e(t,{name:"系统快照",tab:"系统快照",class:"h-100%"},{default:n(()=>[e(Bt)]),_:1}),e(t,{name:"License管理",tab:"License管理"},{default:n(()=>[e(Lt)]),_:1}),e(t,{name:"情报库",tab:"情报库"},{default:n(()=>[e(f,{justify:"center",class:"pt-20px important-flex-col items-center"},{default:n(()=>[e(s,{label:"上传情报库文件","label-placement":"left"},{default:n(()=>[e(u,{action:"","custom-request":i,"show-file-list":!1,accept:".zip"},{default:n(()=>[y.value?(h(),F("div",{key:0,onClick:g[0]||(g[0]=fe(()=>{},["stop"]))},[m(O(y.value)+" ",1),e(o,{class:"font-size-30px cursor-pointer",onClick:k})])):(h(),T(p,{key:1},{icon:n(()=>[e(a,{class:"text-icon"})]),default:n(()=>[m(" 选择文件")]),_:1}))]),_:1})]),_:1}),e(s,{label:"","label-placement":"left",class:"ml-20px"},{default:n(()=>[B((h(),T(p,{type:"info",ghost:"",disabled:!y.value,onClick:w},{default:n(()=>[m("提交")]),_:1},8,["disabled"])),[[v,"sysmanger.basicInfo.intelligence"]])]),_:1})]),_:1})]),_:1}),e(t,{name:"系统告警通知",tab:"系统告警通知"},{default:n(()=>[e(At)]),_:1})]),_:1},8,["value"])]),_:1})])}}}),pn=H(Jt,[["__scopeId","data-v-4f1c343e"]]);export{pn as default};
