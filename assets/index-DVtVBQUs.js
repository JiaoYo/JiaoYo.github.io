import{_ as X}from"./table-header-operation.vue_vue_type_script_setup_true_lang-B5PmJxYc.js";import{d as j,q as V,x as G,s as E,v as Y,b as Z,$ as a,r as ee,ag as te,F as U,o as K,c as H,w as n,g as t,h as M,t as A,i as e,G as F,L,M as ae,ar as oe,Q as W,B as O,P as Q,ah as ne,ai as se,H as le,af as J,a5 as ie,aC as re,ax as pe,e as ce,aj as I,ak as de,al as ue}from"./index-Cgb71mqb.js";import{p as me,q as _e,f as fe,r as ye}from"./audit-events-dzY6Izdk.js";import{u as ge,a as he}from"./table-DUp9v1h7.js";import{_ as ve}from"./round-search-DeE_ikB1.js";import{_ as be}from"./round-refresh-Bw_0alcG.js";import{_ as we}from"./lodash-QtyeoWto.js";import{_ as ke}from"./FormItemGridItem-64x8y8yI.js";import{_ as De}from"./Grid-D7pzHEmG.js";import{h as q}from"./permission-DpWY0cFs.js";import{_ as xe}from"./Popconfirm-DsSfsIAu.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-B4YgRvgK.js";import"./setting-outlined-DsAz0L7e.js";import"./export-0y2r5k2W.js";import"./refresh-BZbDUj0j.js";import"./round-delete-B-LVfY3a.js";import"./round-plus-C4DYpm9e.js";import"./Upload-Bp48tY3s.js";import"./Progress-B3vt-8jU.js";const Ne=j({name:"OperateDrawer",__name:"operate-drawer",props:V({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(_,{emit:C}){const p=_,g=C,m=G(_,"visible"),{formRef:c,validate:x,restoreValidation:T}=E(),{defaultRequiredRule:v}=Y(),N=Z(()=>({add:a("page.audit.type.addTitle"),edit:a("page.audit.type.editTitle")})[p.operateType]),o=ee(b());function b(){return{atypename:"",typedesc:"",asort:0,syspara:1}}const R={atypename:v};function z(){Object.assign(o,b()),p.operateType==="edit"&&p.rowData&&Object.assign(o,p.rowData)}function w(){m.value=!1}async function d(){var h,i;if(await x(),p.operateType==="add"){const{data:k,error:u}=await me([{atypename:o.atypename,typedesc:o.typedesc,asort:o.asort,syspara:o.syspara}]);u||((h=window.$message)==null||h.success(a("common.addSuccess")),w(),g("submitted"))}else{const{data:k,error:u}=await _e([{id:p.rowData.id,atypename:o.atypename,typedesc:o.typedesc,asort:o.asort,syspara:o.syspara}]);u||((i=window.$message)==null||i.success(a("common.updateSuccess")),w(),g("submitted"))}}return te(m,()=>{m.value&&(z(),T())}),(h,i)=>{const k=L,u=ae,$=oe,B=W,D=O,l=Q,s=ne,r=se,S=U("no-space");return K(),H(r,{show:m.value,"onUpdate:show":i[3]||(i[3]=f=>m.value=f),"display-directive":"show",width:360},{default:n(()=>[t(s,{title:N.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[t(l,{size:16},{default:n(()=>[t(D,{onClick:w},{default:n(()=>[M(A(e(a)("common.cancel")),1)]),_:1}),t(D,{type:"primary",onClick:d},{default:n(()=>[M(A(e(a)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[t(B,{ref_key:"formRef",ref:c,model:o,rules:R},{default:n(()=>[t(u,{label:e(a)("page.audit.type.name"),path:"atypename"},{default:n(()=>[F(t(k,{clearable:"",value:o.atypename,"onUpdate:value":i[0]||(i[0]=f=>o.atypename=f),placeholder:e(a)("page.audit.type.form.name")},null,8,["value","placeholder"]),[[S]])]),_:1},8,["label"]),t(u,{label:e(a)("page.audit.type.describe"),path:"typedesc"},{default:n(()=>[F(t(k,{clearable:"",value:o.typedesc,"onUpdate:value":i[1]||(i[1]=f=>o.typedesc=f),placeholder:e(a)("page.audit.type.form.describe"),type:"textarea"},null,8,["value","placeholder"]),[[S]])]),_:1},8,["label"]),t(u,{label:e(a)("page.audit.type.sort"),path:"asort"},{default:n(()=>[t($,{min:0,value:o.asort,"onUpdate:value":i[2]||(i[2]=f=>o.asort=f),placeholder:e(a)("page.audit.type.form.sort"),style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ze=j({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:V(["reset","search"],["update:model"]),setup(_,{emit:C}){const p=C,{formRef:g,restoreValidation:m}=E(),c=G(_,"model");function x(){c.value.fuzzy="",p("search")}async function T(){await m(),p("reset")}async function v(){p("search")}const N=we.throttle(v,1e3,{trailing:!1});return(o,b)=>{const R=L,z=ke,w=be,d=O,h=ve,i=Q,k=De,u=W,$=J,B=U("no-space");return K(),H($,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(u,{ref_key:"formRef",ref:g,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:le(e(N),["enter"])},{default:n(()=>[t(k,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[t(z,{span:"24 s:12 m:8 l:6",label:e(a)("page.audit.type.name"),path:"fuzzy"},{default:n(()=>[F(t(R,{clearable:"",value:c.value.fuzzy,"onUpdate:value":b[0]||(b[0]=D=>c.value.fuzzy=D),placeholder:e(a)("page.audit.type.form.name"),onClear:x},null,8,["value","placeholder"]),[[B]])]),_:1},8,["label"]),t(z,{span:"24 s:12 m:8 l:6"},{default:n(()=>[t(i,{class:"w-full"},{default:n(()=>[t(d,{onClick:T},{icon:n(()=>[t(w,{class:"text-icon"})]),default:n(()=>[M(" "+A(e(a)("common.reset")),1)]),_:1}),t(d,{type:"primary",ghost:"",onClick:e(N)},{icon:n(()=>[t(h,{class:"text-icon"})]),default:n(()=>[M(" "+A(e(a)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Se={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function P(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!de(_)}const Le=j({name:"audit_type",__name:"index",setup(_){const C=ie(),{columns:p,columnChecks:g,data:m,getData:c,loading:x,mobilePagination:T,searchParams:v,resetSearchParams:N}=ge({apiFn:fe,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"atypename",title:a("page.audit.type.name"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"typedesc",title:a("page.audit.type.describe"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"asort",title:a("page.audit.type.sort"),align:"center",width:120},{key:"syspara",title:"系统内置",align:"center",width:100,render:l=>{const s={0:"primary",1:"info"},r=a(re[l.syspara]);return t(pe,{size:"small",type:s[l.syspara]},P(r)?r:{default:()=>[r]})}},{key:"operate",title:a("common.operate"),align:"center",width:130,render:l=>{let s;return l.syspara!=0?t("div",{class:"flex-center gap-8px"},[F(t(O,{type:"primary",ghost:!0,size:"small",onClick:()=>B(l.id)},P(s=a("common.edit"))?s:{default:()=>[s]}),[[U("no-auth"),"sys.audit.type.update"]]),t(xe,{onPositiveClick:()=>$(l.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let r;return F(t(O,{type:"error",ghost:!0,size:"small"},P(r=a("common.delete"))?r:{default:()=>[r]}),[[U("no-auth"),"sys.audit.type.delete"]])}})]):null}}]}),{drawerVisible:o,operateType:b,editingData:R,handleAdd:z,handleEdit:w,checkedRowKeys:d,onBatchDeleted:h,onDeleted:i,closeDrawer:k}=he(m,c);async function u(){console.log(d.value),D(d.value,l=>{h()})}function $(l){console.log(l),D([l],s=>{i()})}function B(l){w(l)}async function D(l,s){const{data:r,error:S}=await ye(l);if(!S)s&&s(r);else return!1}return(l,s)=>{const r=X,S=ue,f=J;return K(),ce("div",Se,[t(ze,{model:e(v),"onUpdate:model":s[0]||(s[0]=y=>I(v)?v.value=y:null),onReset:e(N),onSearch:e(c)},null,8,["model","onReset","onSearch"]),t(f,{title:e(a)("page.audit.type.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[t(r,{columns:e(g),"onUpdate:columns":s[1]||(s[1]=y=>I(g)?g.value=y:null),"disabled-delete":e(d).length===0,loading:e(x),onAdd:e(z),onDelete:u,onRefresh:e(c),"is-view-delete-button":e(q)("sys.audit.type.delete"),"is-view-add-button":e(q)("sys.audit.type.insert")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-delete-button","is-view-add-button"])]),default:n(()=>[t(S,{"checked-row-keys":e(d),"onUpdate:checkedRowKeys":s[2]||(s[2]=y=>I(d)?d.value=y:null),columns:e(p),data:e(m),size:"small","flex-height":!e(C).isMobile,"scroll-x":962,loading:e(x),remote:"","row-key":y=>y.id,pagination:e(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Ne,{visible:e(o),"onUpdate:visible":s[3]||(s[3]=y=>I(o)?o.value=y:null),"operate-type":e(b),"row-data":e(R),onSubmitted:e(c)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{Le as default};
