import{d as N,m as C,cI as P,a3 as D,q as E,j as y,aw as $,o as k,c as B,w as c,f as g,g as n,a9 as V,i as T,al as x,S as I,ak as R,O as M,P as U,Q as H,e as J,h as L,J as O,B as q,N as F,ac as G}from"./index-DLQv0xE2.js";import{n as Q,a as W}from"./reportForm-xxvjNrTv.js";import{_ as j,a as z,b as K,c as X}from"./file-pdf-BV9u2wCn.js";import{_ as Y}from"./DatePicker-ot9WJ_VW.js";import{a as Z,_ as ee}from"./Grid-AjTJLB13.js";import"./echarts.vue_vue_type_script_setup_true_lang-BQ7hFWvN.js";import"./installCanvasRenderer-C5I8hfFY.js";import"./install-Bh99ifQ7.js";import"./TimePicker-B5ZvLBUm.js";import"./defineProperty-BYTHWXAG.js";const ae=p=>(M("data-v-d674d4e5"),p=p(),U(),p),le=ae(()=>g("span",{class:"mr-20px"},"报表预览",-1)),te={title:"导出PDF"},ne={title:"导出Word"},oe={title:"导出Excel"},se=N({name:"reportPreview",__name:"reportPreview",props:C({data:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(p){P(v=>({"03cdc49e":T(h)}));const i=D(),_=p,r=E(p,"visible"),d=y(""),b=()=>{var v,o;d.value=((o=(v=_.data)==null?void 0:v.find(u=>u.type=="title"))==null?void 0:o.value)+"报表"+x(1,new Date)};$(r,()=>{r.value&&b()});const f=y(),h=i.themeScheme=="dark"?"#001428":"#fff";return(v,o)=>{const u=j,t=z,l=K,a=X,e=I,s=R;return k(),B(s,{show:r.value,"onUpdate:show":o[3]||(o[3]=m=>r.value=m),preset:"card",class:"w-1000px reportPreview",style:V({"background-color":T(i).themeScheme=="dark"?"#001428":"#fff"})},{header:c(()=>[le,g("span",te,[n(u,{class:"text-32px c-#d63031 cursor-pointer",onClick:o[0]||(o[0]=m=>f.value.toPdf(d.value))})]),g("span",ne,[n(t,{class:"text-32px c-#1e90ff cursor-pointer",onClick:o[1]||(o[1]=m=>f.value.toWord(d.value))})]),g("span",oe,[n(l,{class:"text-32px c-#15703d cursor-pointer",onClick:o[2]||(o[2]=m=>f.value.toExcel(d.value))})])]),default:c(()=>[n(e,{class:"max-h-600px"},{default:c(()=>[n(a,{ref_key:"filePreviewExportRef",ref:f,width:800,data:_.data},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),re=H(se,[["__scopeId","data-v-d674d4e5"]]),ye=N({name:"reportmanagement_reporttemplate",__name:"index",setup(p){const i=y([]),_=y(!1),r=y({startTime:x(0,new Date().getTime()-864e5*3),endTime:x(0,new Date().getTime()),time:[new Date().getTime()-864e5*3,new Date().getTime()]}),d=["提示","低危","中危","高危","致命"],b=["lev0","lev1","lev2","lev3","lev4"];async function f(u,t){r.value.startTime=t?x(0,t[0]):void 0,r.value.endTime=t?x(0,t[1]):void 0}const h=async u=>{const{data:t,error:l}=await W({rtype:u});l||(t.forEach(a=>{a.rtext=JSON.parse(a.rtext)}),i.value=t[0].rtext,console.log(i.value,"reportTemplate.value"))},v=y([]),o=async()=>{await h(0);const{data:u}=await Q({startTime:r.value.startTime,endTime:r.value.endTime});if(u){const t=JSON.parse(u);console.log(t,"报表接口返回数据"),i.value.forEach(l=>{if(l.type=="table"){if(l.dataName=="collection"&&(l.value.body=t.collection.map(a=>l.value.tableHeaderValue.map(e=>e=="ctime"?x(1,a[e]):a[e]))),l.dataName=="events"){const a=t.events.filter(e=>e.cname);l.value.body=a.map(e=>l.value.tableHeaderValue.map(s=>e[s]))}if(l.dataName=="level"){const a=t.level.filter(e=>e.logname);l.value.body=a.map(e=>l.value.tableHeaderValue.map(s=>e[s]))}if(l.dataName=="level1"){if(t.level.length==0)return l.value.body=[];l.value.body=b.map(a=>[a=="lev0"?"提示":a=="lev1"?"低危":a=="lev2"?"中危":a=="lev3"?"高危":"致命",t.level.reduce((e,s)=>e+(Number(s[a])||0),0)])}}if(l.type=="chart"&&l.dataName=="events"){const a=t.events.filter(e=>e.cname);l.value.chartType=="bar"&&(l.value.data.series[0].data=a.map(e=>e.count),l.value.data.xAxis.type=="category"?l.value.data.xAxis.data=a.map(e=>e.cname):l.value.data.yAxis.data=a.map(e=>e.cname)),l.value.chartType=="pie"&&(l.value.data.series[0].data=a.map(e=>({value:e.count,name:e.cname}))),l.value.chartType=="line"&&(l.value.data.series[0].data=a.map(e=>e.count),l.value.data.xAxis.data=a.map(e=>e.cname))}if(l.dataName=="level"){const a=t.level.filter(e=>e.logname);l.value.chartType=="bar"&&(l.value.data.series[0].data=a.map(e=>e.count),l.value.data.xAxis.type=="category"?l.value.data.xAxis.data=a.map(e=>e.logname):l.value.data.yAxis.data=a.map(e=>e.logname)),l.value.chartType=="pie"&&(l.value.data.series[0].data=a.map(e=>({value:e.count,name:e.logname}))),l.value.chartType=="line"&&(l.value.data.series[0].data=a.map(e=>e.count),l.value.data.xAxis.data=a.map(e=>e.logname))}l.dataName=="level1"&&(l.value.chartType=="bar"&&(l.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(a=>t.level.reduce((e,s)=>e+(Number(s[a])||0),0)),l.value.data.xAxis.type=="category"?l.value.data.xAxis.data=d:l.value.data.yAxis.data=d),l.value.chartType=="pie"&&(l.value.data.series[0].data=[{value:t.level.reduce((a,e)=>a+e.lev0*1,0)==0?null:t.level.reduce((a,e)=>a+e.lev0*1,0),name:"提示"},{value:t.level.reduce((a,e)=>a+e.lev1*1,0)==0?null:t.level.reduce((a,e)=>a+e.lev1*1,0),name:"低危"},{value:t.level.reduce((a,e)=>a+e.lev2*1,0)==0?null:t.level.reduce((a,e)=>a+e.lev2*1,0),name:"中危"},{value:t.level.reduce((a,e)=>a+e.lev3*1,0)==0?null:t.level.reduce((a,e)=>a+e.lev3*1,0),name:"高危"},{value:t.level.reduce((a,e)=>a+e.lev4*1,0)==0?null:t.level.reduce((a,e)=>a+e.lev4*1,0),name:"致命"}]),l.value.chartType=="line"&&(l.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(a=>t.level.reduce((e,s)=>e+(Number(s[a])||0),0)),l.value.data.xAxis.data=d))}),v.value=i.value,console.log(v.value,"reportList.value"),_.value=!0}};return(u,t)=>{const l=Y,a=O,e=q,s=F,m=G,S=Z,A=ee;return k(),J("div",null,[n(A,{"x-gap":"12",cols:2},{default:c(()=>[n(S,null,{default:c(()=>[n(m,{title:"报表信息"},{default:c(()=>[n(s,{ref:"formRef","label-width":80,"label-placement":"left",model:r.value},{default:c(()=>[n(a,{label:"查询日期",path:"selectTime"},{default:c(()=>[n(l,{value:r.value.time,"onUpdate:value":t[0]||(t[0]=w=>r.value.time=w),type:"daterange",class:"w-100%","onUpdate:formattedValue":f},null,8,["value"])]),_:1}),n(a,{label:" "},{default:c(()=>[n(e,{"attr-type":"button",onClick:o},{default:c(()=>[L(" 查询 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),n(re,{data:v.value,visible:_.value,"onUpdate:visible":t[1]||(t[1]=w=>_.value=w)},null,8,["data","visible"])])}}});export{ye as default};
