import{_ as le}from"./refresh-DqwdLnME.js";import{_ as ne,l as oe}from"./lodash-Bu17Xiio.js";import{d as W,n as se,a3 as j,j as v,p as ie,s as re,D as I,o as P,c as q,w as o,g as n,E as U,i,$ as d,W as B,h as T,t as M,F as ce,aG as ue,J as pe,Z as de,B as S,N as J,O as me,ad as Z,r as E,av as G,e as fe,bo as _e,ai as ge,aj as ve,R as he}from"./index-CPvLxVyj.js";import{f as ye,a as be,b as xe,c as ke}from"./alarm-CXcFTMjN.js";import{_ as Te}from"./round-search-Bazpes3Q.js";import{_ as Ce}from"./round-refresh-BShX9Agz.js";import{u as O}from"./usePageData-Dfw1Z67t.js";import{C as De,a as Se}from"./common-DfNrZhdR.js";import{f as we}from"./audit-events-DtCCBdD3.js";import{a as ze,T as Ae}from"./basicconf-BBSfuwy0.js";import{_ as Ne}from"./FormItemGridItem-CFfJHRMO.js";import{_ as Le}from"./DatePicker-D0kgC-0R.js";import{_ as Re}from"./Grid-B7joyhXS.js";import{_ as F}from"./Popconfirm-kowwMW-K.js";import"./TimePicker-6saq_Vw8.js";import"./defineProperty-dYeSDo8h.js";const $e=W({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:se(["reset","search"],["update:model"]),setup(h,{emit:w}){const y=w,m=j();v(!1);const{formRef:z,restoreValidation:r}=ie(),l=re(h,"model"),{pageData:b,getData:x,nextPage:C}=O(we),A=async t=>{const a=t.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&b.data.length<b.total&&C()};x();const{pageData:p,getData:D,nextPage:N}=O(ye),L=async t=>{const a=t.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&p.data.length<p.total&&N()};D();async function g(t,a){t?(l.value.startTime=t[0],l.value.endTime=t[1]):(l.value.startTime=null,l.value.endTime=null),y("search")}function R(){l.value.fuzzy=void 0,y("search")}async function $(){await r(),l.value.timeRange=null,l.value.atype=null,l.value.alevel=null,l.value.alatype=null,l.value.apolicy=null,l.value.startTime=null,l.value.endTime=null,ue(()=>{y("search")})}async function f(){y("search")}const e=ne.debounce(f,1e3,{leading:!0,trailing:!1});return(t,a)=>{const c=pe,s=Ne,_=de,H=Le,k=Ce,V=S,Q=Te,X=J,Y=Re,ee=me,ae=Z,te=I("no-space");return P(),q(ae,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[n(ee,{ref_key:"formRef",ref:z,model:l.value,"label-placement":"left","label-width":i(m).locale=="en-US"?120:80,"show-feedback":!1,onKeyup:ce(i(e),["enter"])},{default:o(()=>[n(Y,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:o(()=>[n(s,{span:"24 s:12 m:8 l:6",label:"审计名称",path:"fuzzy"},{default:o(()=>[U(n(c,{autofocus:"",value:l.value.fuzzy,"onUpdate:value":a[0]||(a[0]=u=>l.value.fuzzy=u),placeholder:"请输入审计名称",clearable:"",onClear:R},null,8,["value"]),[[te]])]),_:1}),n(s,{span:"24 s:12 m:8 l:6",label:i(d)("page.manage.alarm.level"),path:"alevel"},{default:o(()=>[n(_,{filterable:"",clearable:"",placeholder:i(d)("page.manage.alarm.form.level"),value:l.value.alevel,"onUpdate:value":[a[1]||(a[1]=u=>l.value.alevel=u),f],options:i(B)(i(ze))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),n(s,{span:"24 s:12 m:8 l:6",label:"告警状态",path:"alatype"},{default:o(()=>[n(_,{filterable:"",clearable:"",placeholder:i(d)("page.manage.alarm.form.status"),value:l.value.alatype,"onUpdate:value":[a[2]||(a[2]=u=>l.value.alatype=u),f],options:i(B)(i(De))},null,8,["placeholder","value","options"])]),_:1}),n(s,{span:"24 s:12 m:8 l:6",label:"审计类型",path:"atype"},{default:o(()=>[n(_,{value:l.value.atype,"onUpdate:value":[a[3]||(a[3]=u=>l.value.atype=u),f],placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:i(b).data,"reset-menu-on-options-change":!1,onScroll:A},null,8,["value","options"])]),_:1}),n(s,{span:"24 s:12 m:8 l:6",label:"告警策略",path:"apolicy"},{default:o(()=>[n(_,{value:l.value.apolicy,"onUpdate:value":[a[4]||(a[4]=u=>l.value.apolicy=u),f],placeholder:"请选择告警策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:i(p).data,"reset-menu-on-options-change":!1,onScroll:L},null,8,["value","options"])]),_:1}),n(s,{span:"24 s:12 m:12 l:8",label:"时间",path:"timeRange"},{default:o(()=>[n(H,{clearable:"",value:l.value.timeRange,"onUpdate:value":a[5]||(a[5]=u=>l.value.timeRange=u),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":g},null,8,["value"])]),_:1}),n(s,{span:"24 s:12 m:8 l:6"},{default:o(()=>[n(X,{class:"w-full flex items-center"},{default:o(()=>[n(V,{onClick:$},{icon:o(()=>[n(k,{class:"text-icon"})]),default:o(()=>[T(" "+M(i(d)("common.reset")),1)]),_:1}),n(V,{type:"primary",ghost:"",onClick:i(e)},{icon:o(()=>[n(Q,{class:"text-icon"})]),default:o(()=>[T(" "+M(i(d)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width","onKeyup"])]),_:1})}}}),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function K(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!ge(h)}const Ie=W({name:"platformalarm_alarm",__name:"index",setup(h){const w=j(),y=v(window.innerHeight-395),m=E({limit:20,alatype:void 0,aname:void 0,pageId:void 0,alevel:void 0,atype:void 0,apolicy:void 0,startTime:void 0,endTime:void 0,_t:new Date().getTime()}),z=[{type:"selection",align:"center",width:48,fixed:"left"},{title:"",key:"index",width:80,align:"center",render:e=>`${e.index}`},{key:"aname",title:"审计名称",align:"center",minWidth:120,ellipsis:!0},{key:"alevel",title:"事件级别",align:"center",width:100,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=0);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},a=d(Ae[e.alevel]);let c={color:t[e.alevel],textColor:"#ffffff",borderColor:t[e.alevel]};return n(G,{size:"small",color:c},K(a)?a:{default:()=>[a]})}},{key:"pname",title:"审计类型",align:"center",minWidth:120},{key:"pname1",title:"告警策略",align:"center",minWidth:120},{key:"etol",title:"事件总数",align:"center",width:120},{key:"grtime",title:"产生时间",align:"center",width:160},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"alatype",title:d("page.manage.alarm.status"),align:"center",minWidth:120,render:e=>{e.alatype!==1&&(e.alatype=0);const t={0:"error",1:"success"},a=d(Se[e==null?void 0:e.alatype]);return n(G,{size:"small",type:t[e==null?void 0:e.alatype]},K(a)?a:{default:()=>[a]})}},{key:"operate",title:d("common.operate"),align:"center",width:130,fixed:"right",render:e=>e.alatype===0&&n("div",{class:"flex-center gap-8px"},[n(F,{onPositiveClick:()=>f([e.id])},{default:()=>"确定要确认改数据吗？",trigger:()=>U(n(S,{type:"error",ghost:!0,size:"small"},{default:()=>[T("确认")]}),[[I("no-auth"),"audit.alarm.update"]])})])}],r=v([]),l=v(!1),b=v(0),x=async(e=!1)=>{if(!l.value)l.value=!0;else return;l.value=!0;const{data:t,error:a}=await xe(m);a||(b.value=t.length,e?r.value=[...r.value,...t]:r.value=t,r.value=r.value.sort((c,s)=>s.id-c.id).map((c,s)=>(c.index=s+1,c)),l.value=!1)};x();const C=v(!0),A=()=>{r.value=[],m.pageId=void 0,(t=>Object.keys(t).filter(s=>s!=="limit"&&s!=="_t").some(s=>t[s]!==void 0&&t[s]!==""&&t[s]!==null))(m)?C.value=!1:(C.value=!0,D()),x()},p=E({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:t,page:a,pageSize:c,pageCount:s,itemCount:_}){return`已加载${r.value.length}条`+(r.value.length?C.value?` 共计 ${r.value.length>0?_??0:0} 条`:b.value==m.limit?"  预计还有更多":"  没有更多了":"")}});async function D(){const{data:e,error:t}=await ke();t||(p.pageCount=20,p.total=Number(e),p.itemCount=Number(e))}D();function N(e){var t;e.target.scrollTop+e.target.offsetHeight==e.target.scrollHeight&&p.total>((t=r.value)==null?void 0:t.length)&&L()}const L=oe.debounce(()=>{var e;((e=r.value)==null?void 0:e.length)<p.total&&(m.pageId=r.value[r.value.length-1].id,x(!0))},300),g=v([]),R=e=>{g.value=e},$=()=>{f(g.value),g.value=[]},f=async e=>{var t,a;await be(e),r.value.forEach(c=>{e.includes(c.id)&&(c.alatype=1)}),(t=window.$message)==null||t.destroyAll(),(a=window.$message)==null||a.success("确认成功")};return(e,t)=>{const a=le,c=J,s=ve,_=Z,H=I("no-auth");return P(),fe("div",He,[n($e,{model:m,"onUpdate:model":t[0]||(t[0]=k=>m=k),onSearch:A},null,8,["model"]),n(_,{title:"审计告警",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[n(c,null,{default:o(()=>[n(i(F),{onPositiveClick:$},{trigger:o(()=>[U((P(),q(i(S),{size:"small",ghost:"",type:"primary",disabled:g.value.length==0},{default:o(()=>[T(" 批量确认 ")]),_:1},8,["disabled"])),[[H,"audit.alarm.update"]])]),default:o(()=>[T(" 确定要确认选中的数据吗？ ")]),_:1}),n(i(S),{size:"small",onClick:t[1]||(t[1]=k=>x())},{icon:o(()=>[n(a,{class:_e(["text-icon",{"animate-spin":l.value}])},null,8,["class"])]),default:o(()=>[T(" "+M(i(d)("common.refresh")),1)]),_:1})]),_:1})]),default:o(()=>[n(s,{columns:z,"checked-row-keys":g.value,data:r.value,onUpdateCheckedRowKeys:R,size:"small","flex-height":!i(w).isMobile,"scroll-x":702,loading:l.value,remote:"","row-key":k=>k.id,pagination:p,class:"sm:h-full",onScroll:N,"max-height":y.value,"virtual-scroll":""},null,8,["checked-row-keys","data","flex-height","loading","row-key","pagination","max-height"])]),_:1})])}}}),Xe=he(Ie,[["__scopeId","data-v-a2c8b8c2"]]);export{Xe as default};
