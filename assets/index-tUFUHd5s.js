import{j as N,b as I,k as le,m as de,d as T,n as H,p as X,u as ue,a as J,q as Q,r as B,s as Y,v as pe,x as W,y as fe,o as y,c as z,w,g as p,z as G,i as _,$ as k,A as D,f as b,C as V,h as $,t as S,D as me,E as ge,F as q,G as _e,H as he,I as Z,J as ee,K as we,B as oe,L as te,M as se,N as ve,O as ye,P as A,Q as ke,R as xe,S as Ce,T as Pe,U as be,V as Se,W as Ee,X as Re,Y as Ie,e as C,Z as Ue,a0 as Ne,a1 as j,a2 as ze}from"./index-ByQsQpYG.js";function Le(t){const i=N(0),v=I(()=>Math.ceil(i.value/60)),c=I(()=>i.value>0),{pause:o,resume:e}=le(()=>{i.value>0?i.value-=1:o()},{immediate:!1});function a(n=t){i.value=60*n,e()}function s(){i.value=0,o()}return de(()=>{o()}),{count:v,isCounting:c,start:a,stop:s}}/*! js-cookie v3.0.5 | MIT */function L(t){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var v in i)t[v]=i[v]}return t}var Me={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function O(t,r){function i(c,o,e){if(!(typeof document>"u")){e=L({},r,e),typeof e.expires=="number"&&(e.expires=new Date(Date.now()+e.expires*864e5)),e.expires&&(e.expires=e.expires.toUTCString()),c=encodeURIComponent(c).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var s in e)e[s]&&(a+="; "+s,e[s]!==!0&&(a+="="+e[s].split(";")[0]));return document.cookie=c+"="+t.write(o,c)+a}}function v(c){if(!(typeof document>"u"||arguments.length&&!c)){for(var o=document.cookie?document.cookie.split("; "):[],e={},a=0;a<o.length;a++){var s=o[a].split("="),n=s.slice(1).join("=");try{var l=decodeURIComponent(s[0]);if(e[l]=t.read(n,l),c===l)break}catch{}}return c?e[c]:e}}return Object.create({set:i,get:v,remove:function(c,o){i(c,"",L({},o,{expires:-1}))},withAttributes:function(c){return O(this.converter,L({},this.attributes,c))},withConverter:function(c){return O(L({},this.converter,c),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}var ne=O(Me,{path:"/"});const F=(t,r,i)=>{ne.set(t,r)},M=t=>ne.get(t),$e=t=>(ve("data-v-368576bb"),t=t(),ye(),t),je={class:"w-full flex-y-center gap-16px"},De=["src"],Fe={class:"flex-y-center justify-between updatePsd"},Be=$e(()=>b("div",{style:{display:"flex","justify-content":"right","align-items":"center"}},null,-1)),Ve=T({name:"PwdLogin",__name:"pwd-login",props:{status:{type:String,required:!0},statusModifiers:{}},emits:H(["getUsername"],["update:status"]),setup(t,{emit:r}){const i=X(t,"status"),v=ue();J();const{formRef:c,validate:o}=Q(),e=B({username:"",captcha:"",password:""}),a=B({uuid:"",captchaSrc:"",captchaEnable:0,checked:!1});async function s(){const{data:m,error:g}=await me();g||(a.captchaEnable=m.data,a.captchaEnable==1&&n())}async function n(){a.uuid=W(),a.captchaSrc=ge+"/captcha?uuid="+a.uuid}const l=I(()=>{const{formRules:m}=Y();return{username:m.username,captcha:m.captcha,password:m.password1}});async function d(){var g;await o(),a.checked?f(e.username,q(e.password),a.checked):x();const m=await v.login(e.username,e.password,e.captcha.trim(),a.uuid);console.log(m),((g=m==null?void 0:m.data)==null?void 0:g.login)===0&&setTimeout(()=>{const P=new CustomEvent("myCustomEvent");document.dispatchEvent(P)},500),m=="fail"&&a.captchaEnable==1&&(e.captcha="",n())}function f(m,g,P){F("power-prediction_user",m),F("power-prediction_pwd",g),F("power-prediction_check",String(P))}function h(){e.username=M("power-prediction_user")||"";const m=M("power-prediction_pwd")||"";e.password=_e(m).substring(16),i.value=="pwd-login1"&&(e.password=""),a.checked=M("power-prediction_check")?M("power-prediction_check")=="true":!1}function x(){f("","",!1)}const u=N(!1),E=async()=>{await he.get("/api/captchaEanble.do",{}).then(m=>{u.value=!1}).catch(m=>{var g,P,U;console.log((g=m.response)==null?void 0:g.data),((P=m.response)==null?void 0:P.data)=="Access Denied"&&(u.value=!0,(U=window.$message)==null||U.error("检测到无效IP，请联系系统管理员。"))})};return pe(()=>{a.uuid=W(),h(),E(),u.value||s()}),(m,g)=>{const P=Z,U=ee,ae=we,re=oe,ie=te,ce=se,K=fe("no-space");return y(),z(ce,{ref_key:"formRef",ref:c,model:e,rules:l.value,size:"large","show-label":!1},{default:w(()=>[p(U,{path:"userName"},{default:w(()=>[G(p(P,{autofocus:"",value:e.username,"onUpdate:value":g[0]||(g[0]=R=>e.username=R),placeholder:_(k)("page.login.common.userNamePlaceholder"),onKeyup:D(d,["enter"])},null,8,["value","placeholder"]),[[K]])]),_:1}),p(U,{path:"password"},{default:w(()=>[G(p(P,{value:e.password,"onUpdate:value":g[1]||(g[1]=R=>e.password=R),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:_(k)("page.login.common.passwordPlaceholder"),onKeyup:D(d,["enter"])},null,8,["value","placeholder"]),[[K]])]),_:1}),a.captchaEnable==1?(y(),z(U,{key:0,path:"captcha"},{default:w(()=>[b("div",je,[p(P,{value:e.captcha,"onUpdate:value":g[2]||(g[2]=R=>e.captcha=R),placeholder:"请输入验证码",onKeyup:D(d,["enter"])},null,8,["value"]),b("img",{src:a.captchaSrc,alt:"captcha",style:{height:"40px"},onClick:n},null,8,De)])]),_:1})):V("",!0),p(ie,{vertical:"",size:8},{default:w(()=>[b("div",Fe,[p(ae,{checked:a.checked,"onUpdate:checked":g[3]||(g[3]=R=>a.checked=R)},{default:w(()=>[$(S(_(k)("page.login.pwdLogin.rememberMe")),1)]),_:1},8,["checked"])]),p(re,{type:"primary",size:"large",ghost:"",round:"",block:"",loading:_(v).loginLoading,onClick:d},{default:w(()=>[$(S(_(k)("common.confirm")),1)]),_:1},8,["loading"]),Be]),_:1})]),_:1},8,["model","rules"])}}}),qe=A(Ve,[["__scopeId","data-v-368576bb"]]);function Oe(){const{loading:t,startLoading:r,endLoading:i}=ke(),{count:v,start:c,stop:o,isCounting:e}=Le(60),a=I(()=>{let l=k("page.login.codeLogin.getCode");const d=k("page.login.codeLogin.reGetCode",{time:v.value});return t.value&&(l=""),e.value&&(l=d),l});function s(l){var d,f,h,x;return l.trim()===""?((f=(d=window.$message)==null?void 0:d.error)==null||f.call(d,k("form.mobile.required")),!1):Ce.test(l)?!0:((x=(h=window.$message)==null?void 0:h.error)==null||x.call(h,k("form.mobile.invalid")),!1)}async function n(l,d){!s(l)||t.value||(r(),await new Promise(h=>{xe(l,d).then(x=>{var u,E;console.log("response",x),x.error||(setTimeout(h,500),(E=(u=window.$message)==null?void 0:u.success)==null||E.call(u,k("page.login.codeLogin.sendCodeSuccess")),c(),i())}).catch(x=>{var u,E;return console.log("error",x),(E=(u=window.$message)==null?void 0:u.error)==null||E.call(u,k("page.login.codeLogin.sendCodeFailed")),!1})}))}return{label:a,start:c,stop:o,isCounting:e,loading:t,getCaptcha:n}}const Te=T({name:"ResetPwd",__name:"reset-pwd",props:H({username:{type:String,required:!0}},{status:{type:String,required:!0},statusModifiers:{}}),emits:["update:status"],setup(t){const r=X(t,"status"),i=t;J();const{formRef:v,validate:c}=Q();Oe();const o=B({username:i.username||"",oripwd:"",code:"",password:"",confirmPassword:""}),e=I(()=>{const{formRules:s,createConfirmPwdRule:n,defaultRequiredRule:l}=Y();return{username:s.username,oripwd:s.password,password:[{...l},{asyncValidator:(d,f)=>f==""||f==null?Promise.resolve():Pe(f)?o.username&&f.includes(o.username)?Promise.reject("密码禁止与用户名相同或包含用户名"):o.password==o.oripwd?Promise.reject("新密码不能与旧密码相同"):Promise.resolve():Promise.reject("密码应符合：大、小写字母、数字、特殊字符的三种或以上的组合"),trigger:["blur","input"]}],code:s.code,confirmPassword:n(o.password)}});async function a(){var f,h;await c();const s=await q(o.oripwd),n=await q(o.password),{data:l,error:d}=await be(o.username,s,n);console.log("data",l),d?(h=window.$message)==null||h.error("修改失败"):((f=window.$message)==null||f.success("修改成功"),r.value="pwd-login1")}return(s,n)=>{const l=Z,d=ee,f=oe,h=te,x=se;return y(),z(x,{ref_key:"formRef",ref:v,model:o,rules:e.value,size:"large","show-label":!1},{default:w(()=>[p(d,{path:"username"},{default:w(()=>[p(l,{value:o.username,"onUpdate:value":n[0]||(n[0]=u=>o.username=u),placeholder:_(k)("page.login.common.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1}),p(d,{path:"oripwd"},{default:w(()=>[p(l,{value:o.oripwd,"onUpdate:value":n[1]||(n[1]=u=>o.oripwd=u),type:"password","show-password-on":"click",placeholder:"请输入原密码"},null,8,["value"])]),_:1}),p(d,{path:"password"},{default:w(()=>[p(l,{value:o.password,"onUpdate:value":n[2]||(n[2]=u=>o.password=u),type:"password","show-password-on":"click",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),p(d,{path:"confirmPassword"},{default:w(()=>[p(l,{value:o.confirmPassword,"onUpdate:value":n[3]||(n[3]=u=>o.confirmPassword=u),type:"password","show-password-on":"click",placeholder:_(k)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1}),p(h,{vertical:"",size:18,class:"w-full"},{default:w(()=>[p(f,{type:"primary",size:"large",ghost:"",round:"",block:"",onClick:a},{default:w(()=>[$(S(_(k)("common.confirm")),1)]),_:1}),p(f,{size:"large",ghost:"",round:"",block:"",onClick:n[4]||(n[4]=u=>r.value="pwd-login"),class:"c-#fff"},{default:w(()=>[$(S(_(k)("page.login.common.back")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),Ae=A(Te,[["__scopeId","data-v-3e5e8e75"]]),Ke={class:"w-400px lt-sm:w-300px"},We={class:"flex-y-center justify-center"},Ge={key:0,src:j,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},He={key:1,src:j,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},Xe={key:2,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},Je={key:3,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},Qe={class:"pt-24px"},Ye={class:"pt-16px"},Ze={class:"flex justify-center items-center",style:{position:"fixed",top:"20px",right:"20px","z-index":"999"}},eo={key:0,src:j,alt:"Linkqi",class:"w-100px pr-10px"},oo={key:1,src:j,alt:"Linkqi",class:"w-100px pr-10px"},to={key:2,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},so={key:3,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},no={key:0,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},ao={key:1,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},ro=T({name:"login",__name:"index",props:{module:{}},setup(t){Se();const r=Ee(),i=N("pwd-login");I(()=>r.darkMode?Re(r.themeColor,600):r.themeColor);const v=N(""),c=s=>{v.value=s},o=I(()=>{const s="#ffffff",n=r.darkMode?.5:.2;return Ie(s,r.themeColor,n)}),e=N();return(async()=>{fetch("/version.json").then(s=>s.json()).then(s=>{e.value=s}).catch(s=>{console.error("Error fetching version.json:",s)})})(),(s,n)=>{var d,f;const l=ze;return y(),C("div",{class:"relative size-full flex-center overflow-hidden login",style:Ne({backgroundColor:o.value})},[p(l,{bordered:!1,class:"relative z-4 w-auto rd-12px loginClass","content-style":{padding:"24px 36px"}},{default:w(()=>[b("div",Ke,[b("header",We,[_(r).darkMode?(y(),C("img",He)):(y(),C("img",Ge)),_(r).darkMode?(y(),C("h3",Xe,S(_(k)("system.title")),1)):(y(),C("h3",Je,S(_(k)("system.title")),1))]),b("main",Qe,[b("div",Ye,[p(Ue,{name:_(r).page.animateMode,mode:"out-in",appear:""},{default:w(()=>[i.value=="pwd-login"||i.value=="pwd-login1"?(y(),z(qe,{key:0,status:i.value,"onUpdate:status":n[0]||(n[0]=h=>i.value=h),onGetUsername:c},null,8,["status"])):(y(),z(Ae,{key:1,status:i.value,"onUpdate:status":n[1]||(n[1]=h=>i.value=h),username:v.value},null,8,["status","username"]))]),_:1},8,["name"])])])])]),_:1}),b("div",Ze,[_(r).darkMode?(y(),C("img",oo)):(y(),C("img",eo)),_(r).darkMode?(y(),C("span",to,S(((d=e.value)==null?void 0:d.ver)||"V1.1.6"),1)):(y(),C("span",so,S(((f=e.value)==null?void 0:f.ver)||"V1.1.6"),1))]),_(r).darkMode?V("",!0):(y(),C("div",no," Copyright (c) 2024 · 杭州领祺科技有限公司")),_(r).darkMode?(y(),C("div",ao," Copyright (c) 2024 · 杭州领祺科技有限公司")):V("",!0)],4)}}}),co=A(ro,[["__scopeId","data-v-8c835d7a"]]);export{co as default};
