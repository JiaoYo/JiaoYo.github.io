import{_ as de}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BUKSABy7.js";import{d as G,q as P,x as X,s as ee,v as ue,bF as te,b as A,$ as l,r as pe,ae as ne,E as K,o as z,c as V,w as r,g as t,h as B,t as U,i as e,G as oe,F as O,X as me,Y as _e,K as ae,L as fe,a0 as he,P as le,B as F,O as Y,af as ge,ag as ve,ad as se,dn as J,j as H,f as Q,ar as ye,aR as be,av as re,a4 as we,dp as ke,e as Re,ah as E,ai as xe,aj as De}from"./index-ClauSBeM.js";import{a as ie,b as Ne,c as Ce,d as Se,e as Te,g as Me}from"./system-manage-WW7faint.js";import{u as $e,a as Ie}from"./table-B4UxM38A.js";import{_ as Be}from"./round-search-Da1i9mIT.js";import{_ as Ue}from"./round-refresh-Cl1S1sFo.js";import{_ as ze,l as Oe}from"./lodash-gDW8amFC.js";import{_ as Fe}from"./FormItemGridItem-Bkp7d801.js";import{_ as Le}from"./Grid-CUJzRed2.js";import{_ as je,a as Ee}from"./arrow-open-up-D24JIWER.js";import{_ as Ke}from"./Tree-BcmprM2c.js";import{h as Z}from"./permission-i8fqamoe.js";import{_ as Ve}from"./Popconfirm-DV82iAbv.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DrMa0Anc.js";import"./setting-outlined-bIsSxdRG.js";import"./export-DieFT_MY.js";import"./refresh-D10u-1xZ.js";import"./round-delete-CoS8u3XE.js";import"./round-plus-MiUPkZaP.js";import"./Upload-Cl4-vvin.js";import"./Progress-BfqSg8RF.js";const Ae=G({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:P({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:P(["submitted"],["update:visible"]),setup(v,{emit:x}){const u=v,h=x,b=X(v,"visible"),{formRef:y,validate:C,restoreValidation:$}=ee(),{defaultRequiredRule:g}=ue();te();const D=A(()=>({add:l("page.manage.role.addRole"),edit:l("page.manage.role.editRole")})[u.operateType]),p=pe(N());function N(){return{name:"",remark:"",rtype:0,menuIdList:[]}}const I={name:g};A(()=>{var c;return((c=u.rowData)==null?void 0:c.id)||-1}),A(()=>u.operateType==="add"||u.operateType==="edit");async function S(){if(Object.assign(p,N()),u.operateType==="edit"&&u.rowData){const{data:c,error:i}=await ie(u.rowData.id+"");Object.assign(p,c)}}function T(){b.value=!1}async function n(){var f,a,d;await C();const{data:c,error:i}=await Ne(u.operateType==="edit"?(f=u.rowData)==null?void 0:f.id:null,p.name,p.menuIdList,p.remark,p.rtype);i||((a=window.$message)==null||a.destroyAll(),(d=window.$message)==null||d.success(u.operateType==="edit"?l("common.modifySuccess"):l("common.addSuccess")),T(),h("submitted"))}return ne(b,()=>{b.value&&(S(),$())}),(c,i)=>{const f=ae,a=fe,d=he,m=le,w=F,o=Y,M=ge,L=ve,j=K("no-space");return z(),V(L,{show:b.value,"onUpdate:show":i[3]||(i[3]=s=>b.value=s),"display-directive":"show",width:360},{default:r(()=>[t(M,{title:D.value,"native-scrollbar":!1,closable:""},{footer:r(()=>[t(o,{size:16},{default:r(()=>[t(w,{onClick:T},{default:r(()=>[B(U(e(l)("common.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:n},{default:r(()=>[B(U(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(m,{ref_key:"formRef",ref:y,model:p,rules:I,onKeyup:oe(n,["enter"])},{default:r(()=>[t(a,{label:e(l)("page.manage.role.name"),path:"name"},{default:r(()=>[O(t(f,{value:p.name,"onUpdate:value":i[0]||(i[0]=s=>p.name=s),placeholder:e(l)("page.manage.role.form.name"),clearable:""},null,8,["value","placeholder"]),[[j]])]),_:1},8,["label"]),t(a,{label:e(l)("page.manage.role.remark"),path:"remark"},{default:r(()=>[O(t(f,{clearable:"",value:p.remark,"onUpdate:value":i[1]||(i[1]=s=>p.remark=s),placeholder:e(l)("page.manage.role.form.remark")},null,8,["value","placeholder"]),[[j]])]),_:1},8,["label"]),t(a,{label:e(l)("page.manage.role.type"),path:"rtype"},{default:r(()=>[t(d,{filterable:"",value:p.rtype,"onUpdate:value":i[2]||(i[2]=s=>p.rtype=s),disabled:u.operateType==="edit",placeholder:e(l)("page.manage.role.form.type"),options:e(me)(e(_e)),style:{width:"100%"}},null,8,["value","disabled","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Pe=G({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:P(["reset","search"],["update:model"]),setup(v,{emit:x}){const u=x,h=X(v,"model"),{formRef:b,restoreValidation:y}=ee();function C(){h.value.name="",u("search")}async function $(){await y(),u("reset")}function g(){u("search")}const D=ze.throttle(g,1e3,{trailing:!1});return(p,N)=>{const I=ae,S=Fe,T=Ue,n=F,c=Be,i=Y,f=Le,a=le,d=se,m=K("no-space");return z(),V(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[t(a,{model:h.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:oe(g,["enter"])},{default:r(()=>[t(f,{responsive:"screen","item-responsive":"","y-gap":12},{default:r(()=>[t(S,{span:"24 s:12 m:8 l:6",label:e(l)("page.manage.role.name"),path:"name"},{default:r(()=>[O(t(I,{clearable:"",value:h.value.name,"onUpdate:value":N[0]||(N[0]=w=>h.value.name=w),placeholder:e(l)("page.manage.role.form.name"),onClear:C},null,8,["value","placeholder"]),[[m]])]),_:1},8,["label"]),t(S,{span:"24 s:12 m:8 l:6"},{default:r(()=>[t(i,{class:"w-full ml-20px"},{default:r(()=>[t(n,{onClick:$},{icon:r(()=>[t(T,{class:"text-icon"})]),default:r(()=>[B(" "+U(e(l)("common.reset")),1)]),_:1}),t(n,{type:"primary",ghost:"",onClick:e(D)},{icon:r(()=>[t(c,{class:"text-icon"})]),default:r(()=>[B(" "+U(e(l)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ge={class:"flex"},qe=G({name:"MenuAuthModal",__name:"menu-auth-modal",props:P({roleRow:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(v){const x=v,u=X(v,"visible");function h(){u.value=!1}const b=A(()=>l("common.edit")+l("page.manage.role.menuAuth")),y=J([]);function C(n,c=0){var m,w;const i=(m=n.find(o=>o.url=="/manage/role"))==null?void 0:m.id,f=(w=n.find(o=>o.url=="/manage/user"))==null?void 0:w.id;let a=[];function d(o){return o.sort((M,L)=>(M.sort||0)-(L.sort||0))}return n.forEach(o=>{if(o.suffix=()=>be(re,{text:!0,type:o.pid==0&&o.type==0?"warning":o.type==1?"info":"success",size:"small"},{default:()=>o.pid==0&&o.type==0?"目录":o.type==1?"按钮":"菜单"}),(o.pid==i||o.id==i||o.pid==f||o.id==f)&&(o.disabled=!0),o.pid==c){const M=C(n,o.id);M.length>0?o.children=M:o.children=[],a.push(o)}}),d(a)}const $=async()=>{const{error:n,data:c}=await Se({rtype:x.roleRow.rtype}),i=C(c);if(!n){let f=function(d){for(let m=d.length-1;m>=0;m--)d[m].children&&d[m].children.length>0?f(d[m].children):d[m].children=void 0;return d},a=Oe.cloneDeep(i);a=f(a),y.value=a.filter(d=>d.id<=1e4)}},g=H(!0),D=J([]);async function p(){const{data:n,error:c}=await ie(x.roleRow.id+""),i=[];function f(a,d){return!d.includes(a.id)||a.children&&!a.children.every(m=>f(m,d))?(i.push(a.id),!1):!0}y.value.forEach(a=>{f(a,n.menuIdList)}),D.value=n.menuIdList.filter(a=>!i.includes(a))}const N=H(),I=n=>{N.value=n};function S(){var n,c;Ce({id:x.roleRow.id,name:x.roleRow.name,menuIdList:D.value.concat(N.value).filter(i=>i!==null)}),(c=(n=window.$message)==null?void 0:n.success)==null||c.call(n,l("common.modifySuccess")),h()}function T(){$(),p()}return ne(u,n=>{n&&T()}),(n,c)=>{const i=je,f=Ee,a=Ke,d=F,m=Y,w=ye;return z(),V(w,{show:u.value,"onUpdate:show":c[2]||(c[2]=o=>u.value=o),preset:"card",class:"w-480px"},{header:r(()=>[Q("div",Ge,[B(U(b.value)+" ",1),Q("div",{class:"ml-10px cursor-pointer",title:"展开/收起",onClick:c[0]||(c[0]=o=>g.value=!g.value)},[g.value?(z(),V(f,{key:1,class:"text-icon"})):(z(),V(i,{key:0,class:"text-icon"}))])])]),footer:r(()=>[t(m,{justify:"end"},{default:r(()=>[t(d,{size:"small",class:"mt-16px",onClick:h},{default:r(()=>[B(U(e(l)("common.cancel")),1)]),_:1}),t(d,{type:"primary",size:"small",class:"mt-16px",onClick:S},{default:r(()=>[B(U(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(a,{cascade:"","checked-keys":D.value,"onUpdate:checkedKeys":c[1]||(c[1]=o=>D.value=o),data:y.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"",class:"h-60vh","label-field":"name","key-field":"id","children-field":"children","default-expand-all":g.value,onUpdateIndeterminateKeys:I},null,8,["checked-keys","data","default-expand-all"])]),_:1},8,["show"])}}}),We={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!xe(v)}const ft=G({name:"manage_role",__name:"index",setup(v){const x=we(),{columns:u,columnChecks:h,data:b,getData:y,loading:C,mobilePagination:$,searchParams:g,resetSearchParams:D}=$e({apiFn:Te,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,name:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:l("page.manage.role.name"),align:"center",minWidth:120,ellipsis:!0},{key:"remark",title:l("page.manage.role.remark"),minWidth:120,align:"center",ellipsis:!0},{key:"rtype",title:l("page.manage.role.type"),width:140,align:"center",render:s=>{s.rtype===void 0&&(s.rtype=0);const _={0:"primary",1:"primary",2:"primary"},k=l(ke[s.rtype]);return t(re,{type:_[s.rtype]},W(k)?k:{default:()=>[k]})}},{key:"operate",title:l("common.operate"),align:"center",render:s=>{let _;return t("div",{class:"flex-center gap-8px"},[O(t(F,{type:"primary",ghost:!0,size:"small",onClick:()=>L(s.id)},W(_=l("common.edit"))?_:{default:()=>[_]}),[[K("no-auth"),"sys:role:update"]]),O(t(F,{type:"primary",ghost:!0,size:"small",onClick:()=>w(s)},{default:()=>["分配权限"]}),[[K("no-auth"),"sys:role:update"]]),[1,2,3].includes(Number(s.id))?"":t(Ve,{onPositiveClick:()=>M(s.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let k;return O(t(F,{type:"error",ghost:!0,size:"small"},W(k=l("common.delete"))?k:{default:()=>[k]}),[[K("no-auth"),"sys:role:delete"]])}})])}}]}),{drawerVisible:p,operateType:N,editingData:I,handleAdd:S,handleEdit:T,checkedRowKeys:n,onBatchDeleted:c,onDeleted:i,closeDrawer:f}=Ie(b,y),{bool:a,setTrue:d}=te(),m=H({id:0,name:"",remark:"",rtype:0,menuIdList:[]});function w(s){d(),m.value=s}async function o(){console.log(n.value),j(n.value,s=>{c()})}function M(s){console.log(s),j([s],_=>{i()})}function L(s){T(s)}async function j(s,_){const{data:k,error:q}=await Me(s);if(!q)_&&_(k);else return!1}return(s,_)=>{const k=de,q=De,ce=se;return z(),Re("div",We,[t(Pe,{model:e(g),"onUpdate:model":_[0]||(_[0]=R=>E(g)?g.value=R:null),onReset:e(D),onSearch:e(y)},null,8,["model","onReset","onSearch"]),t(ce,{title:e(l)("page.manage.role.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":r(()=>[t(k,{columns:e(h),"onUpdate:columns":_[1]||(_[1]=R=>E(h)?h.value=R:null),"disabled-delete":e(n).length===0,"is-view-add-button":e(Z)("sys:role:save"),"is-view-delete-button":e(Z)("sys:role:delete"),loading:e(C),onAdd:e(S),onDelete:o,onRefresh:e(y)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:r(()=>[t(q,{"checked-row-keys":e(n),"onUpdate:checkedRowKeys":_[2]||(_[2]=R=>E(n)?n.value=R:null),columns:e(u),data:e(b),size:"small","flex-height":!e(x).isMobile,"scroll-x":702,loading:e(C),remote:"","row-key":R=>R.id,pagination:e($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Ae,{visible:e(p),"onUpdate:visible":_[3]||(_[3]=R=>E(p)?p.value=R:null),"operate-type":e(N),"row-data":e(I),onSubmitted:e(y)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(qe,{visible:e(a),"onUpdate:visible":_[4]||(_[4]=R=>E(a)?a.value=R:null),roleRow:m.value},null,8,["visible","roleRow"])]),_:1},8,["title"])])}}});export{ft as default};
