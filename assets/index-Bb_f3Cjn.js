import{_ as mt}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BL3fEdXs.js";import{_ as gt}from"./round-delete-BJUCXHh8.js";import{_ as vt}from"./round-add-9JBusyZ3.js";import{d as Le,ay as Re,z as Ee,D as bt,s as j,aL as We,A as Xe,a as yt,aw as Ye,ax as Qe,c as se,o as k,w as t,f as e,a3 as ht,b as A,G as P,M as Ze,h as i,aM as ne,H as ge,aA as _t,b0 as kt,e as D,t as f,aF as wt,J as He,B as z,g as c,$ as X,a4 as et,b8 as Ct,aG as ve,cD as Dt,cA as Tt,cE as tt,cF as Ft,cG as Oe,aK as xt,cH as at,cI as St,aC as jt,Y as lt,X as nt,L as Bt,a2 as st,aN as At,i as zt,F as W,aO as je,aD as Nt,I as M,aP as $t,aI as qt,aR as Ve,cJ as Ge,cK as Ut,n as Ie,aV as Pt}from"./index-DTejdFLI.js";import{u as It,a as Rt}from"./table-5sK02S3E.js";import{u as be}from"./usePageData-BjjY6agq.js";import{_ as ot}from"./Grid-U7VbogCl.js";import{_ as ut}from"./FormItemGridItem-OdWiLkIi.js";import{_ as Lt}from"./DatePicker-CotE2hZN.js";import{_ as Et}from"./round-search-CcVdI1HR.js";import{_ as Ht}from"./round-refresh-CFg-lT0v.js";import{h as Ke}from"./permission-BeExe-IG.js";import{_ as Mt,a as Ot}from"./DescriptionsItem-C24o3AGZ.js";import{N as me}from"./Popconfirm-BmNh5CYH.js";import{_ as Vt}from"./RadioButton-BZrUrTX5.js";const Gt={key:0,style:{"margin-left":"20px"}},Kt=["onClick"],Jt=["onClick"],Wt={key:0},Xt={style:{display:"flex","justify-content":"space-between"}},Yt=Le({name:"OperateDrawer",__name:"operate-drawer",props:Re({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Re(["submitted"],["update:visible"]),setup(L,{emit:ye}){const T=ye,w=Ee(),g=L,o=bt(O());function O(){return{pid:void 0,id:"",debugname:"",docker:void 0,dockcharge:"",dockcontact:"",status:0,notes:"",debugresult:0,dtype:void 0,starttime:null,endtime:null,dbcreater:void 0,startAndTimeRange:void 0,eqmid:void 0,re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const{pageData:E,getData:m,nextPage:N}=be(Ct),$=async()=>{await m({usertypes:"2,3"})},V=async s=>{const l=s.currentTarget,p=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&E.data.length<E.total&&(await N(),await ve(),setTimeout(()=>{l.scrollTop=p}))},{pageData:b,getData:Y,nextPage:he}=be(Dt),oe=async s=>{const l=s.currentTarget,p=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&b.data.length<b.total&&(await he(),b.data=b.data.map(B=>({...B,value:B.docker+"&id="+B.id})),await ve(),setTimeout(()=>{l.scrollTop=p}))},Q=async()=>{await Y({pid:o.pid}),b.data=b.data.map(s=>({...s,value:s.docker+"&id="+s.id}))},Z=async s=>{var l;if(o.docker=s,o.docker){const[p,B]=(l=o.docker)==null?void 0:l.split("&id="),F=b.data.find(le=>le.docker==p&&le.id==B);F?(o.dockcharge=F.pname,o.dockcontact=F.pcontact):(o.dockcharge="",o.dockcontact="")}},{pageData:x,getData:_e,nextPage:ue}=be(Tt),ke=async s=>{const l=s.currentTarget,p=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&x.data.length<x.total&&(await ue(),await ve(),setTimeout(()=>{l.scrollTop=p}))},we=async()=>{await _e()},q=j([]),{pageData:S,getData:G,nextPage:re}=be(tt),h=async s=>{const l=s.currentTarget,p=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&S.data.length<S.total&&(await re(),q.value=S.data,await ve(),setTimeout(()=>{l.scrollTop=p}))},y=async()=>{var s;await G({fuzzy:(s=g.rowData)==null?void 0:s.proname,page:1}),q.value=S.data},U=We.debounce(async s=>{await G({fuzzy:s,page:1}),q.value=S.data},300),I=j(!1),ee=j(!1),Ce=s=>{if(o.pid=null,I.value=!0,ee.value=!1,!s){r();return}U(s)},ie=async()=>{I.value&&!ee.value&&(await G({page:1}),q.value=S.data,I.value=!1)},r=async()=>{await G({page:1}),q.value=S.data},te=async s=>{o.pid=s,ee.value=!0,o.pid&&(K(),o.eqmid=null)},{pageData:De,getData:a,nextPage:n}=be(Ft),C=async s=>{const l=s.currentTarget,p=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&x.data.length<x.total&&(await n(),await ve(),setTimeout(()=>{l.scrollTop=p}))},K=async()=>{await a({pid:o.pid})},J=j(void 0);async function Be(){if(y(),we(),$(),Object.assign(o,O()),d.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}],g.operateType==="add"&&(o.pid=g.pid?g.pid:void 0),g.operateType==="edit"&&g.rowData){Object.assign(o,g.rowData),J.value=o.status,d.value=[];for(let s=1;s<=4;s++){const l=o[`re${s}`],p=o[`fl${s}`];d.value.push({name:l||"",url:p||"",status:p?"finished":"pending"})}g.rowData.starttime&&g.rowData.endtime?o.startAndTimeRange=[Oe(g.rowData.starttime),Oe(g.rowData.endtime)]:o.startAndTimeRange=null}Q(),o.pid&&K()}const{formRef:Ae,validate:ze,restoreValidation:Ne}=Xe(),$e={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},eqmid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dbcreater:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"},debugname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcharge:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"}},_=yt(()=>({add:"新增待调试业务",edit:"修改待调试业务"})[g.operateType]),ae=Ye(L,"visible");Qe(ae,()=>{ae.value&&(Be(),setTimeout(()=>{const s=document.querySelector(".n-scrollbar-content");s==null||s.scrollTo(0,0)},300),Ne())});const Te=j(!1),R=j(0),d=j([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]);async function qe({file:s},l){d.value[l].file=s,d.value[l].name=s.name}function Ue(){ae.value=!1}async function rt(s){if(s)try{const p=await(await fetch(s==null?void 0:s.split("?")[0],{mode:"cors"})).blob(),B=URL.createObjectURL(p),F=document.createElement("a");F.href=B,F.download=s==null?void 0:s.split("?")[1],F.style.display="none",document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(B)}catch(l){console.error("下载失败:",l)}}async function it(){var s;await ze(),(s=window.$dialog)==null||s.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await dt()}})}const Pe=j(!1);async function dt(){var s,l,p,B,F,le;try{Pe.value=!0;const Fe=d.value.filter(v=>v.file),xe=Fe.length;let Se=!0;if(d.value.forEach((v,u)=>{var fe,Me;const H=`re${u+1}`,de=`fl${u+1}`,ce=v.name||"",pe=((fe=v.url)==null?void 0:fe.split("?")[1])||((Me=v.file)==null?void 0:Me.name);(ce&&!pe||!ce&&pe)&&(Se=!1),v.status==="done"&&(o[H]=ce,o[de]=pe)}),!Se){(l=(s=window.$message)==null?void 0:s.error)==null||l.call(s,"文件名称和文件地址必须同时存在，不能只填一个");return}Te.value=!0;for(let v=0;v<xe;v++){R.value=v;const u=Fe[v];u.indexText=`${v+1}/${xe}`,u.progress=0,u.status="uploading";try{u.url=await xt(u.file.file,u.file.name,"",H=>{u.progress=H}),u.progress=100,u.status="done"}catch{u.status="error"}}if(d.value.forEach((v,u)=>{o[`re${u+1}`]=v.name||"",o[`fl${u+1}`]=v.url||""}),Te.value=!1,g.operateType==="edit"){const v=JSON.parse(JSON.stringify(o));J.value==v.status&&delete v.status,v.docker=(p=v.docker)==null?void 0:p.split("&id=")[0];const{data:u,error:H}=await at([v]);H||(Ue(),T("submitted"),(B=window.$message)==null||B.success("修改成功"))}else{const{data:v,error:u}=await St([{...o,docker:(F=o.docker)==null?void 0:F.split("&id=")[0]}]);u||(Ue(),T("submitted"),(le=window.$message)==null||le.success("添加成功"))}}catch{}finally{Pe.value=!1}}async function ct(s){return!0}const pt=s=>{var l;o.debugname=(l=x.data.find(p=>p.id==s))==null?void 0:l.tname,o.dtype=s};async function ft(s,l){o.startAndTimeRange=s,o.starttime=s==null?void 0:s[0],o.endtime=s==null?void 0:s[1]}return(s,l)=>{const p=ut,B=jt,F=ot,le=Ze,Fe=wt,xe=ht,Se=He,v=et;return k(),se(v,{show:ae.value,"onUpdate:show":l[11]||(l[11]=u=>ae.value=u),title:_.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:t(()=>[e(Se,{justify:"end",size:16},{default:t(()=>[e(i(z),{onClick:Ue},{default:t(()=>[c(f(i(X)("common.cancel")),1)]),_:1}),e(i(z),{type:"primary",onClick:it,loading:Pe.value},{default:t(()=>[c(f(i(X)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(xe,{class:"pr-20px"},{default:t(()=>[e(le,{ref_key:"formRef",ref:Ae,model:o,rules:$e,"label-placement":"left","label-width":120},{default:t(()=>[e(F,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 m:12",label:"项目列表",path:"pid"},{default:t(()=>[e(i(ne),{filterable:"",clearable:"",value:o.pid,"onUpdate:value":[l[0]||(l[0]=u=>o.pid=u),te],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:r,onSearch:Ce,onBlur:ie,options:q.value,onScroll:h},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"权重",path:"dtype"},{default:t(()=>[e(i(ne),{filterable:"",value:o.dtype,"onUpdate:value":[l[1]||(l[1]=u=>o.dtype=u),pt],tag:"",placeholder:"请选择权重","label-field":"tname","value-field":"id",options:i(x).data,onScroll:ke},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"业务名称",path:"debugname"},{default:t(()=>[e(i(ge),{value:o.debugname,"onUpdate:value":l[2]||(l[2]=u=>o.debugname=u),placeholder:"请输入"},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"调试人",path:"dbcreater"},{default:t(()=>[e(i(ne),{filterable:"",value:o.dbcreater,"onUpdate:value":l[3]||(l[3]=u=>o.dbcreater=u),placeholder:"请选择调试人","label-field":"username","value-field":"id",options:i(E).data,onScroll:V},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"待调试设备",path:"eqmid"},{default:t(()=>[e(i(ne),{filterable:"",clearable:"",value:o.eqmid,"onUpdate:value":l[4]||(l[4]=u=>o.eqmid=u),placeholder:"请选择待调试设备","label-field":"devname","value-field":"id",options:i(De).data,onScroll:C},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"对接方",path:"docker"},{default:t(()=>[e(i(ne),{filterable:"",value:o.docker,"onUpdate:value":[l[5]||(l[5]=u=>o.docker=u),Z],clearable:"",tag:"",placeholder:"请选择或输入对接方","label-field":"docker","value-field":"value",options:i(b).data,onScroll:oe},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"对接方负责人",path:"dockcharge"},{default:t(()=>[e(i(ge),{value:o.dockcharge,"onUpdate:value":l[6]||(l[6]=u=>o.dockcharge=u),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"联系方式",path:"dockcontact"},{default:t(()=>[e(i(ge),{value:o.dockcontact,"onUpdate:value":l[7]||(l[7]=u=>o.dockcontact=u),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),g.operateType=="edit"?(k(),se(p,{key:0,span:"24 m:12",label:"状态",path:"status"},{default:t(()=>[e(i(ne),{clearable:"",value:o.status,"onUpdate:value":l[8]||(l[8]=u=>o.status=u),placeholder:"请选择",options:i(w).userInfo.usertype==0||i(w).userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}]},null,8,["value","options"])]),_:1})):P("",!0),e(p,{span:"24 m:24",label:"起止时间",path:"startAndTimeRange"},{default:t(()=>[e(i(Lt),{clearable:"",value:o.startAndTimeRange,"onUpdate:value":l[9]||(l[9]=u=>o.startAndTimeRange=u),type:"daterange","value-format":"yyyy-MM-dd",style:{width:"100%"},"onUpdate:formattedValue":ft},null,8,["value"])]),_:1}),e(p,{span:"24 m:24",label:"备注",path:"notes"},{default:t(()=>[e(i(ge),{value:o.notes,"onUpdate:value":l[10]||(l[10]=u=>o.notes=u),placeholder:"请输入"},null,8,["value"])]),_:1}),(k(!0),A(_t,null,kt(d.value,(u,H)=>(k(),se(p,{span:"24 m:24",label:"",path:"notes","show-feedback":!1,key:H},{default:t(()=>[e(F,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 m:12",label:`附件${H+1}`,path:"notes"},{default:t(()=>[e(i(ge),{value:u.name,"onUpdate:value":de=>u.name=de,placeholder:"请输入",style:{width:"250px"}},null,8,["value","onUpdate:value"])]),_:2},1032,["label"]),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var de,ce,pe;return[(de=u.url)!=null&&de.split("?")[1]||(ce=u.file)!=null&&ce.name?(k(),A("span",Gt,[c(f(((pe=u.url)==null?void 0:pe.split("?")[1])||u.file.name)+" ",1),D("span",{class:"cursor-pointer c-#c92a2a",onClick:fe=>{u.url="",u.file=void 0,u.name=""}},"删除",8,Kt),u.url?(k(),A("span",{key:0,class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:fe=>rt(u.url)},"下载",8,Jt)):P("",!0)])):(k(),se(B,{key:1,style:{width:"auto","margin-left":"20px"},ref_for:!0,ref:"uploadRef",action:"#","custom-request":fe=>qe(fe,H),"show-file-list":!1,onBeforeUpload:ct},{default:t(()=>[e(i(z),{size:"small",ghost:"",type:"primary"},{default:t(()=>l[12]||(l[12]=[c(f("选择文件"))])),_:1,__:[12]})]),_:2},1032,["custom-request"]))]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["model"]),d.value[R.value]&&Te.value?(k(),A("div",Wt,[D("div",Xt,[D("span",null,f(d.value[R.value].filename||d.value[R.value].name),1),D("span",null,f(d.value[R.value].indexText),1)]),e(Fe,{percentage:d.value[R.value].progress,status:d.value[R.value].status==="error"?"error":"success","show-indicator":""},null,8,["percentage","status"])])):P("",!0)]),_:1})]),_:1},8,["show","title"])}}}),Qt=Le({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Re(["reset","search","search1","clear"],["update:model"]),setup(L,{emit:ye}){const T=lt(),w=nt(),g=ye,o=Ee(),{formRef:O,restoreValidation:E}=Xe(),m=Ye(L,"model"),N=j([]),{pageData:$,getData:V,nextPage:b}=be(tt),Y=async h=>{const y=h.currentTarget,U=y.scrollTop;y.scrollTop+y.offsetHeight>=y.scrollHeight&&$.data.length<$.total&&(await b(),N.value=$.data,await ve(),setTimeout(()=>{y.scrollTop=U}))},he=async h=>{var y;Z.value=!0,h?(m.value.pid=h,g("search1"),o.setProjectInfo({pname:(y=N.value.find(U=>U.id==h))==null?void 0:y.proname,pid:h})):g("clear")},oe=We.debounce(async h=>{await V({fuzzy:h,page:1}),N.value=$.data},300),Q=j(!1),Z=j(!1),x=h=>{if(m.value.pid=null,Q.value=!0,Z.value=!1,!h){ue();return}oe(h)},_e=async()=>{Q.value&&!Z.value&&(await V({page:1}),N.value=$.data,Q.value=!1)},ue=async()=>{await V({page:1}),N.value=$.data,g("search1")},ke=async h=>{m.value.status=h,g("search1")},we=async()=>{m.value.status=null},q=async()=>{await V({fuzzy:w.query.pname?w.query.pname:""}),N.value=$.data,m.value.pid=w.query.prjId?Number(w.query.prjId):void 0,m.value.fuzzy=w.query.debugname?w.query.debugname:"",o.setProjectInfo({pid:m.value.pid,pname:w.query.pname?w.query.pname:""}),g("search"),setTimeout(()=>{T.replace({path:w.path,query:{}})},10)};q();async function S(){await E(),m.value.fuzzy="",m.value.pid=null,m.value.status=null,g("reset")}const G=()=>{m.value.fuzzy="",g("search")};async function re(){g("search")}return Qe(()=>w.query,h=>{h.pname&&q()}),(h,y)=>{const U=ne,I=ut,ee=ge,Ce=Ht,ie=z,r=Et,te=He,De=ot,a=Ze,n=st;return k(),se(n,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(a,{ref_key:"formRef",ref:O,model:m.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Bt(re,["enter"])},{default:t(()=>[e(De,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(I,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:t(()=>[e(U,{filterable:"",clearable:"",value:m.value.pid,"onUpdate:value":[y[0]||(y[0]=C=>m.value.pid=C),he],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:ue,onSearch:x,onBlur:_e,options:N.value,onScroll:Y},null,8,["value","options"])]),_:1}),e(I,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:t(()=>[e(U,{clearable:"",filterable:"",value:m.value.status,"onUpdate:value":[y[1]||(y[1]=C=>m.value.status=C),ke],placeholder:"请选择状态",onClear:we,options:[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]},null,8,["value"])]),_:1}),e(I,{span:"24 s:12 m:6",label:"业务名称",path:"fuzzy"},{default:t(()=>[e(ee,{value:m.value.fuzzy,"onUpdate:value":y[2]||(y[2]=C=>m.value.fuzzy=C),placeholder:"请输入",clearable:"",onClear:G},null,8,["value"])]),_:1}),e(I,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(te,{class:"w-full"},{default:t(()=>[e(ie,{onClick:S},{icon:t(()=>[e(Ce,{class:"text-icon"})]),default:t(()=>[c(" "+f(i(X)("common.reset")),1)]),_:1}),e(ie,{type:"primary",ghost:"",onClick:re},{icon:t(()=>[e(r,{class:"text-icon"})]),default:t(()=>[c(" "+f(i(X)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Zt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ea={key:0},ta={key:1},aa={key:0},la={key:1},na={key:0},sa={key:1},oa={key:0},ua={key:1};function Je(L){return typeof L=="function"||Object.prototype.toString.call(L)==="[object Object]"&&!Pt(L)}const Ca=Le({name:"projectmanagement_business",__name:"index",setup(L){const ye=At(),T=Ee(),w=nt(),g=lt(),{columns:o,columnChecks:O,data:E,getData:m,loading:N,pagination:$,mobilePagination:V,searchParams:b}=It({showTotal:!0,immediate:!1,apiFn:Ut,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",status:null,dbcreater:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"debugname",title:"业务名称",align:"center",width:160},{key:"proname",title:"所属项目",align:"center",width:160,render(a){return e("span",{class:"cursor-pointer",onClick:()=>ke(a)},[a.proname])}},{key:"status",title:"状态",align:"center",width:100,render(a){return e(Ve,{color:{color:a.status==-1?"rgba(251, 146, 60, 0.15)":a.status==0?"rgba(156, 163, 175, 0.15)":a.status==1?"rgba(59, 130, 246, 0.15)":a.status==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:a.status==-1?"#FB923C":a.status==0?"#9CA3AF":a.status==1?"#3B82F6":a.status==2?"#FACC15":"#10B981",borderColor:a.status==-1?"#FB923C":a.status==0?"#9CA3AF":a.status==1?"#3B82F6":a.status==2?"#FACC15":"#10B981"}},{default:()=>[a.status==-1?"申请中":a.status==0?"待调试":a.status==1?"开始调试":a.status==2?"待审核":"审核完成"]})}},{key:"eqmname",title:"调试设备",align:"center",width:150},{key:"docker",title:"对接信息",align:"left",width:200,render:a=>e("div",{style:"line-height: 1.4;"},[e("div",null,[e("span",{style:"color:#666"},[c("对接方：")]),e("span",{style:"font-weight:500"},[a.docker||"-"])]),e("div",null,[e("span",{style:"color:#666"},[c("负责人：")]),e("span",{style:"font-weight:500"},[a.dockcharge||"-"])]),e("div",null,[e("span",{style:"color:#666"},[c("联系方式：")]),e("span",{style:"font-weight:500"},[a.dockcontact||"-"])])])},{key:"dbusername",title:"调试信息",align:"left",width:200,render(a){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[c("调试人：")]),e("span",{style:"font-weight:500"},[a.dbusername||"-"])]),e("div",null,[e("span",{style:"color:#666"},[c("工时：")]),e("span",{style:"color:#1890ff; font-weight:500"},[a.duration||"-"])]),e("div",null,[e("span",{style:"color:#666"},[c("开始：")]),e("span",null,[a.dbdbtime||"-"])]),e("div",null,[e("span",{style:"color:#666"},[c("结束：")]),e("span",null,[a.dedbtime||"-"])])])}},{key:"ckusername",title:"审核信息",align:"left",width:200,render(a){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[c("审核人：")]),e("span",{style:"font-weight:500"},[a.ckusername||"-"])]),e("div",null,[e("span",{style:"color:#666"},[c("时间：")]),e("span",{style:" font-weight:500"},[a.ckdbtime||"-"])])])}},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(a){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[c("创建人：")]),e("span",{style:"font-weight:500"},[a.username||"-"])]),e("div",null,[e("span",{style:"color:#666"},[c("时间：")]),e("span",{style:" font-weight:500"},[a.dbtime||"-"])])])}},{key:"operate",title:X("common.operate"),align:"center",width:Ke("project:Debug:update")||Ke("project:Debug:delete")?280:0,fixed:"right",render:a=>{let n;return e("div",{class:"flex-center gap-8px"},[a.status==-1&&(T.userInfo.usertype==0||T.userInfo.usertype==2)&&e(me,{onPositiveClick:()=>S(a,0)},{default:()=>"确定通过申请吗？",trigger:()=>M(e(z,{type:"warning",ghost:!0,size:"small"},{default:()=>["通过申请"]}),[[W("no-auth"),"project:Debug:update"]])}),a.status==0&&a.dbcreater==T.userInfo.id&&e(me,{onPositiveClick:()=>S(a,1)},{default:()=>"确定开始调试吗？",trigger:()=>M(e(z,{type:"success",ghost:!0,size:"small"},{default:()=>["开始"]}),[[W("no-auth"),"project:Debug:update"]])}),a.status==1&&a.dbcreater==T.userInfo.id&&e(me,{onPositiveClick:()=>S(a,2)},{default:()=>Ie("div",[Ie("div","确定完成调试？"),Ie("div",{style:{color:"#d03050",fontWeight:"500",marginTop:"6px"}},"请确认资料已提交，否则将拒绝审核！")]),trigger:()=>M(e(z,{type:"success",ghost:!0,size:"small"},{default:()=>["完成"]}),[[W("no-auth"),"project:Debug:update"]])}),a.status==2&&(T.userInfo.usertype==0||T.userInfo.usertype==2)&&e(me,{onPositiveClick:()=>S(a,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>M(e(z,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[W("no-auth"),"project:Debug:update"]])}),M(e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>De(a)},{default:()=>[c("详情")]}),[[W("no-auth"),"project:Debug:select"]]),M(e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>G(a.id)},Je(n=X("common.edit"))?n:{default:()=>[n]}),[[W("no-auth"),"project:Debug:update"]]),(T.userInfo.usertype==0||T.userInfo.usertype==2)&&e(me,{onPositiveClick:()=>q(a)},{default:()=>X("common.confirmDelete"),trigger:()=>{let C;return M(e(z,{type:"error",ghost:!0,size:"small"},Je(C=X("common.delete"))?C:{default:()=>[C]}),[[W("no-auth"),"project:Debug:delete"]])}})])}}]}),{drawerVisible:Y,operateType:he,editingData:oe,handleAdd:Q,handleEdit:Z,checkedRowKeys:x,onBatchDeleted:_e,onDeleted:ue}=Rt(E,m);zt(async()=>{});const ke=a=>{T.setProjectInfo({pid:a.pid,pname:a.proname}),g.push("/projectmanagement/orderdetail?prjId="+a.pid+`&pname=${a.proname}&IsScroll=1`)};async function we(){console.log(x.value),h(x.value.join(","),a=>{_e()})}async function q(a){const{data:n,error:C}=await Ge(a.id,a.pid);C||ue()}const S=async(a,n)=>{var J;const{data:C,error:K}=await at([{id:a.id,status:n,pid:a.pid}]);K||((J=window.$message)==null||J.success("操作成功"),m(),n==3?window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:a.pid,type:"debug"}})):(n==1||n==2)&&window.dispatchEvent(new CustomEvent("refreshTodo")))};function G(a){Z(a)}function re(){Q(),oe.value=null}async function h(a,n){const{data:C,error:K}=await Ge(a,b.pid);if(!K)n&&n(C);else return!1}const y=j(-1),U=a=>{a>0?(y.value=a,b.dbcreater=JSON.parse(JSON.stringify(a)),m()):(b.dbcreater=void 0,y.value=-1,m())},I=a=>{m()},ee=()=>{if(console.log(w.query.prjId,"route.query.prjId"),w.query.debug){b.status=Number(w.query.debug),b.dbcreater=T.userInfo.id,U(T.userInfo.id);return}w.query.types=="2"&&(b.status=2),w.query.types=="-1"&&(b.status=-1),m()},Ce=()=>{m()},ie=()=>{E.value=[],$.itemCount=0},r=j(null),te=j(!1),De=a=>{r.value=a,te.value=!0};return(a,n)=>{const C=Vt,K=qt,J=He,Be=vt,Ae=gt,ze=mt,Ne=Nt,$e=st,_=Ot,ae=Mt,Te=et,R=W("no-auth");return k(),A("div",Zt,[e(Qt,{model:i(b),"onUpdate:model":n[0]||(n[0]=d=>je(b)?b.value=d:null),onReset:Ce,onSearch:ee,onSearch1:i(m),onClear:ie},null,8,["model","onSearch1"]),e($e,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(J,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[n[6]||(n[6]=D("div",null,"待调试业务",-1)),e(K,{size:"small",value:y.value,"onUpdate:value":[n[1]||(n[1]=d=>y.value=d),U],name:"radiobuttongroup1"},{default:t(()=>[e(C,{value:-1,label:"默认"}),e(C,{value:i(T).userInfo.id,label:"我的调试"},null,8,["value"])]),_:1},8,["value"])]),_:1,__:[6]})]),"header-extra":t(()=>[e(J,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[M((k(),se(i(z),{onClick:re,size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(Be,{class:"text-icon"})]),default:t(()=>[n[7]||(n[7]=c(" "+f("新增")))]),_:1,__:[7]})),[[R,"project:Debug:insert"]]),e(i(me),{onPositiveClick:we},{trigger:t(()=>[M((k(),se(i(z),{size:"small",ghost:"",type:"error",disabled:i(x).length==0},{icon:t(()=>[e(Ae,{class:$t(["text-icon",{"animate-spin":i(N)}])},null,8,["class"])]),default:t(()=>[n[8]||(n[8]=c(" "+f("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[R,"project:Debug:delete"]])]),default:t(()=>[n[9]||(n[9]=c(" 确定要删除选中的吗？ "))]),_:1,__:[9]}),e(ze,{columns:i(O),"onUpdate:columns":n[2]||(n[2]=d=>je(O)?O.value=d:null),ctype:3},null,8,["columns"])]),_:1})]),default:t(()=>[e(Ne,{"checked-row-keys":i(x),"onUpdate:checkedRowKeys":n[3]||(n[3]=d=>je(x)?x.value=d:null),columns:i(o),data:i(E),size:"small","flex-height":!i(ye).isMobile,loading:i(N),remote:"","row-key":d=>d.id,"scroll-x":i(o).reduce((d,qe)=>d+(qe.width||100),0),pagination:i(V),class:"sm:h-full","onUpdate:filters":I},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","scroll-x","pagination"]),e(Yt,{visible:i(Y),"onUpdate:visible":n[4]||(n[4]=d=>je(Y)?Y.value=d:null),onSubmitted:i(m),"operate-type":i(he),pid:i(b).pid,"row-data":i(oe)},null,8,["visible","onSubmitted","operate-type","pid","row-data"])]),_:1}),e(Te,{show:te.value,"onUpdate:show":n[5]||(n[5]=d=>te.value=d),title:"查看详情",preset:"card",class:"w-1200px"},{default:t(()=>[e(ae,{bordered:"","label-placement":"left","label-align":"center",columns:2,"label-style":{width:"160px"}},{default:t(()=>[e(_,null,{label:t(()=>n[10]||(n[10]=[c(" 权重 ")])),default:t(()=>[D("span",null,f(r.value.tname),1)]),_:1}),e(_,null,{label:t(()=>n[11]||(n[11]=[c(" 业务名称 ")])),default:t(()=>[D("span",null,f(r.value.debugname),1)]),_:1}),e(_,null,{label:t(()=>n[12]||(n[12]=[c(" 计划起止时间 ")])),default:t(()=>[D("span",null,f(r.value.starttime)+"--"+f(r.value.endtime),1)]),_:1}),e(_,null,{label:t(()=>n[13]||(n[13]=[c(" 对接方 ")])),default:t(()=>[D("span",null,f(r.value.docker.split("&id=")[0]),1)]),_:1}),e(_,null,{label:t(()=>n[14]||(n[14]=[c(" 对接方负责人 ")])),default:t(()=>[D("span",null,f(r.value.dockcharge),1)]),_:1}),e(_,null,{label:t(()=>n[15]||(n[15]=[c(" 联系方式 ")])),default:t(()=>[D("span",null,f(r.value.dockcontact),1)]),_:1}),e(_,null,{label:t(()=>n[16]||(n[16]=[c(" 状态 ")])),default:t(()=>[e(i(Ve),{color:{color:r.value.status==-1?"rgba(251, 146, 60, 0.15)":r.value.status==0?"rgba(156, 163, 175, 0.15)":r.value.status==1?"rgba(59, 130, 246, 0.15)":r.value.status==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:r.value.status==-1?"#FB923C":r.value.status==0?"#9CA3AF":r.value.status==1?"#3B82F6":r.value.status==2?"#FACC15":"#10B981",borderColor:r.value.status==-1?"#FB923C":r.value.status==0?"#9CA3AF":r.value.status==1?"#3B82F6":r.value.status==2?"#FACC15":"#10B981"}},{default:t(()=>[c(f(r.value.status==-1?"申请中":r.value.status==0?"待调试":r.value.status==1?"开始调试":r.value.status==2?"待审核":"审核完成"),1)]),_:1},8,["color"])]),_:1}),e(_,null,{label:t(()=>n[17]||(n[17]=[c(" 备注 ")])),default:t(()=>[D("span",null,f(r.value.notes),1)]),_:1}),e(_,null,{label:t(()=>n[18]||(n[18]=[c(" 调试人 ")])),default:t(()=>[D("span",null,f(r.value.dbusername),1)]),_:1}),e(_,null,{label:t(()=>n[19]||(n[19]=[c(" 调试开始时间 ")])),default:t(()=>[D("span",null,f(r.value.dbdbtime),1)]),_:1}),e(_,null,{label:t(()=>n[20]||(n[20]=[c(" 调试结束时间 ")])),default:t(()=>[D("span",null,f(r.value.dedbtime),1)]),_:1}),e(_,null,{label:t(()=>n[21]||(n[21]=[c(" 调试工时 ")])),default:t(()=>[D("span",null,f(r.value.duration),1)]),_:1}),e(_,null,{label:t(()=>n[22]||(n[22]=[c(" 审核人 ")])),default:t(()=>[D("span",null,f(r.value.ckusername),1)]),_:1}),e(_,null,{label:t(()=>n[23]||(n[23]=[c(" 审核时间 ")])),default:t(()=>[D("span",null,f(r.value.ckdbtime),1)]),_:1}),e(_,null,{label:t(()=>n[24]||(n[24]=[c(" 附件1 ")])),default:t(()=>{var d;return[r.value.re1?(k(),A("span",ea,"文件别名"+f(r.value.re1),1)):P("",!0),r.value.fl1?(k(),A("span",ta,f((d=r.value.fl1)==null?void 0:d.split("?")[1]),1)):P("",!0)]}),_:1}),e(_,null,{label:t(()=>n[25]||(n[25]=[c(" 附件2 ")])),default:t(()=>{var d;return[r.value.re2?(k(),A("span",aa,"文件别名"+f(r.value.re2),1)):P("",!0),r.value.fl2?(k(),A("span",la,f((d=r.value.fl2)==null?void 0:d.split("?")[1]),1)):P("",!0)]}),_:1}),e(_,null,{label:t(()=>n[26]||(n[26]=[c(" 附件3 ")])),default:t(()=>{var d;return[r.value.re3?(k(),A("span",na,"文件别名"+f(r.value.re3),1)):P("",!0),r.value.fl3?(k(),A("span",sa,f((d=r.value.fl3)==null?void 0:d.split("?")[1]),1)):P("",!0)]}),_:1}),e(_,null,{label:t(()=>n[27]||(n[27]=[c(" 附件4 ")])),default:t(()=>{var d;return[r.value.re4?(k(),A("span",oa,"文件别名"+f(r.value.re4),1)):P("",!0),r.value.fl4?(k(),A("span",ua,f((d=r.value.fl4)==null?void 0:d.split("?")[1]),1)):P("",!0)]}),_:1})]),_:1})]),_:1},8,["show"])])}}});export{Ca as default};
