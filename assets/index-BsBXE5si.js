import{_ as ie}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DCcFtEoA.js";import{d as K,q as O,v as G,s as W,r as j,j as H,K as E,o as P,c as J,w as a,g as e,L as I,h as A,t as F,i as t,$ as f,M as re,a2 as Q,A as X,B as M,E as Y,D as Z,ad as ee,x as ce,b as de,y as ue,C as pe,ae as me,af as _e,a4 as fe,e as ve,ag as $,ah as he,ai as ge}from"./index-ByfxsQvj.js";import{u as ye,a as be}from"./table-Ca-5bYro.js";import{_ as we}from"./round-search-U_wZ0GRt.js";import{_ as De}from"./round-refresh-BRVSTvae.js";import{a as te,b as ae}from"./common-lZBul0dM.js";import{_ as ke}from"./lodash-21GmhknM.js";import{_ as ne}from"./Cascader-CoHr4l42.js";import{_ as Se}from"./FormItemGridItem-Dtr_7n7z.js";import{_ as xe}from"./Grid-B9K_tFX2.js";import{w as Ne,x as Te,y as Le,z as ze}from"./events--VzTCbWs.js";import{h as V}from"./permission-DpUBsxJs.js";import{_ as Ce}from"./Popconfirm-Bx1fZnQD.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-frQqLk93.js";import"./setting-outlined-C6sNL0co.js";import"./export-CaaNVRvS.js";import"./refresh-DDT70CE0.js";import"./round-delete-BsuQe4MI.js";import"./round-plus--T3dOesv.js";import"./Upload-BPNrVbAn.js";import"./Progress-B01mUdYA.js";const Re=K({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:O(["reset","search"],["update:model"]),setup(v,{emit:C}){const d=C,{formRef:g,restoreValidation:_}=G(),c=W(v,"model"),w=j({eventsTypeDataList:[]});async function R(){const{data:S,error:l}=await te();l||(w.eventsTypeDataList=S)}R();const y=H();(async()=>{const{data:S,error:l}=await ae();l||(y.value=S.map(h=>({...h,id:"-"+h.id,type:h.cname})))})();function n(){c.value.fuzzy="",d("search")}async function T(){await _(),d("reset")}async function D(){d("search")}const k=ke.throttle(D,1e3,{trailing:!1});return(S,l)=>{const h=ne,b=Se,L=Q,B=X,u=De,s=M,p=we,o=Y,i=xe,m=Z,x=ee,z=E("no-space");return P(),J(x,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(m,{ref_key:"formRef",ref:g,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:re(t(k),["enter"])},{default:a(()=>[e(i,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:a(()=>[e(b,{span:"24 s:12 m:8 l:6",label:"日志源设备",path:"lid"},{default:a(()=>[e(h,{value:c.value.lid,"onUpdate:value":[l[0]||(l[0]=r=>c.value.lid=r),D],placeholder:"请选择日志源设备",options:y.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),e(b,{span:"24 s:12 m:8 l:6",label:"事件类型",path:"eid"},{default:a(()=>[e(L,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:c.value.eid,"onUpdate:value":[l[1]||(l[1]=r=>c.value.eid=r),D],"value-field":"id","label-field":"pname",options:w.eventsTypeDataList},null,8,["value","options"])]),_:1}),e(b,{span:"24 s:12 m:8 l:6",label:"特征值",path:"fuzzy"},{default:a(()=>[I(e(B,{clearable:"",value:c.value.fuzzy,"onUpdate:value":l[2]||(l[2]=r=>c.value.fuzzy=r),placeholder:"请输入特征值",onClear:n},null,8,["value"]),[[z]])]),_:1}),e(b,{span:"24 s:12 m:8 l:6"},{default:a(()=>[e(o,{class:"w-full"},{default:a(()=>[e(s,{onClick:T},{icon:a(()=>[e(u,{class:"text-icon"})]),default:a(()=>[A(" "+F(t(f)("common.reset")),1)]),_:1}),e(s,{type:"primary",ghost:"",onClick:t(k)},{icon:a(()=>[e(p,{class:"text-icon"})]),default:a(()=>[A(" "+F(t(f)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Be=K({name:"OperateDrawer",__name:"operate-drawer",props:O({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:O(["submitted"],["update:visible"]),setup(v,{emit:C}){const d=v,g=C,_=W(v,"visible"),{formRef:c,validate:w,restoreValidation:R}=G(),{defaultRequiredRule:y}=ce(),U=de(()=>({add:"新增事件特征值",edit:"修改事件特征值"})[d.operateType]),n=j(T());function T(){return{ename:"",lid:void 0,eid:void 0}}const D={ename:y,lid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"},eid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"}},k=H();(async()=>{const{data:u,error:s}=await ae();s||(k.value=u.map(p=>({...p,id:"-"+p.id,type:p.cname})))})();const l=j({eventsTypeDataList:[]});async function h(){const{data:u,error:s}=await te();s||(l.eventsTypeDataList=u)}h();function b(){Object.assign(n,T()),d.operateType==="edit"&&d.rowData&&Object.assign(n,d.rowData)}function L(){_.value=!1}async function B(){var u,s;if(await w(),d.operateType==="add"){const{data:p,error:o}=await Ne([{ename:n.ename,lid:n.lid,eid:n.eid}]);o||((u=window.$message)==null||u.success(f("common.addSuccess")),L(),g("submitted"))}else{const{data:p,error:o}=await Te([{id:d.rowData.id,ename:n.ename,lid:n.lid,eid:n.eid}]);o||((s=window.$message)==null||s.success(f("common.updateSuccess")),L(),g("submitted"))}}return ue(_,()=>{_.value&&(b(),R())}),(u,s)=>{const p=X,o=pe,i=ne,m=Q,x=Z,z=M,r=Y,oe=me,le=_e,se=E("no-space");return P(),J(le,{show:_.value,"onUpdate:show":s[3]||(s[3]=N=>_.value=N),"display-directive":"show",width:400},{default:a(()=>[e(oe,{title:U.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(r,{size:16},{default:a(()=>[e(z,{onClick:L},{default:a(()=>[A(F(t(f)("common.cancel")),1)]),_:1}),e(z,{type:"primary",onClick:B},{default:a(()=>[A(F(t(f)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(x,{ref_key:"formRef",ref:c,model:n,rules:D},{default:a(()=>[e(o,{label:"特征值",path:"ename"},{default:a(()=>[I(e(p,{value:n.ename,"onUpdate:value":s[0]||(s[0]=N=>n.ename=N),placeholder:"请输入特征值",clearable:""},null,8,["value"]),[[se]])]),_:1}),e(o,{label:"日志源设备",path:"lid"},{default:a(()=>[e(i,{value:n.lid,"onUpdate:value":s[1]||(s[1]=N=>n.lid=N),placeholder:"请选择日志源设备",options:k.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),e(o,{label:"事件类型",path:"eid"},{default:a(()=>[e(m,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:n.eid,"onUpdate:value":s[2]||(s[2]=N=>n.eid=N),"value-field":"id","label-field":"pname",options:l.eventsTypeDataList},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ue={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function q(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!he(v)}const tt=K({name:"eventalarm_eventcharacteristicvalue",__name:"index",setup(v){const C=fe(),{columns:d,columnChecks:g,data:_,getData:c,loading:w,mobilePagination:R,searchParams:y,resetSearchParams:U}=ye({apiFn:Le,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,lid:null,eid:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"ename",title:"特征值",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname",title:"事件类型",align:"center",minWidth:180,ellipsis:{tooltip:!0}},{key:"dbtime",title:"入库时间",align:"center",width:180},{key:"operate",title:f("common.operate"),align:"center",width:160,fixed:"right",render:o=>{let i;return e("div",{class:"flex-center gap-8px"},[I(e(M,{type:"info",ghost:!0,size:"small",onClick:()=>u(o.id)},q(i=f("common.edit"))?i:{default:()=>[i]}),[[E("no-auth"),"event.eigen.value.update"]]),e(Ce,{onPositiveClick:()=>s(o.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let m;return I(e(M,{type:"error",ghost:!0,size:"small"},q(m=f("common.delete"))?m:{default:()=>[m]}),[[E("no-auth"),"event.eigen.value.delete"]])}})])}}]}),{drawerVisible:n,operateType:T,editingData:D,handleAdd:k,handleEdit:S,checkedRowKeys:l,onBatchDeleted:h,onDeleted:b,closeDrawer:L}=be(_,c);async function B(){console.log(l.value),p(l.value,o=>{h()})}function u(o){S(o)}function s(o){console.log(o),p([o],i=>{b()})}async function p(o,i){const{data:m,error:x}=await ze(o);if(!x)i&&i(m);else return!1}return(o,i)=>{const m=ie,x=ge,z=ee;return P(),ve("div",Ue,[e(Re,{model:t(y),"onUpdate:model":i[0]||(i[0]=r=>$(y)?y.value=r:null),onReset:t(U),onSearch:t(c)},null,8,["model","onReset","onSearch"]),e(z,{title:"事件特征值",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(m,{columns:t(g),"onUpdate:columns":i[1]||(i[1]=r=>$(g)?g.value=r:null),"disabled-delete":t(l).length===0,loading:t(w),onAdd:t(k),onDelete:B,onRefresh:t(c),"is-view-add-button":t(V)("event.eigen.value.insert"),"is-view-delete-button":t(V)("event.eigen.value.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:a(()=>[e(x,{"checked-row-keys":t(l),"onUpdate:checkedRowKeys":i[2]||(i[2]=r=>$(l)?l.value=r:null),columns:t(d),data:t(_),size:"small","flex-height":!t(C).isMobile,"scroll-x":962,loading:t(w),remote:"","row-key":r=>r.id,pagination:t(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Be,{visible:t(n),"onUpdate:visible":i[3]||(i[3]=r=>$(n)?n.value=r:null),"operate-type":t(T),"row-data":t(D),onSubmitted:t(c)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{tt as default};
