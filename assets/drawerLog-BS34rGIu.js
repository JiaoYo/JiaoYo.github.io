import{aW as g,d as ee,av as H,D as te,A as le,s as K,aJ as W,a as re,ax as ae,cv as ie,d4 as Q,at as E,c as w,o as _,w as o,f as n,M as oe,G as I,e as u,N as se,h as p,au as de,t as c,H as D,J as ue,B as J,g as j,$ as Y,a4 as pe,cy as ce,aE as me,z as fe,X as be,F as ve,bn as _e,b as R,aL as S,b2 as ye,I as Z,L as ge,d5 as he,aO as we,a_ as xe,bp as ke,W as ze}from"./index-CddQmI-c.js";import{u as De}from"./usePageData-BKzmIEAP.js";import{_ as je,a as Ce}from"./text-WwJT8_zw.js";import{N as Ne}from"./Popconfirm-CkfL-ZaH.js";function Ye(r){return g({url:"/projectDailyReport/getPage.do",method:"get",params:r})}function Pe(r){return g({url:"/projectDailyReport/insert.do",method:"post",data:r})}function Te(r){return g({url:"/projectDailyReport/getIdByUuid.do",method:"get",params:r})}function Le(r){return g({url:"/projectDailyReport/update.do",method:"put",data:r})}function Ze(r){return g({url:"/projectDailyReport/delete.do",method:"delete",params:{arrIds:r}})}function Se(r){return g({url:"/projectDaily/insert.do",method:"post",data:r})}function Ie(r){return g({url:"/projectComment/getPage.do",method:"get",params:r})}function Ue(r){return g({url:"/projectComment/insert.do",method:"post",data:r})}function Me(r){return g({url:"/projectComment/delete.do",method:"delete",params:{arrIds:r}})}const et=ee({name:"OperateDrawer",__name:"operate-drawer",props:H({operateType:{},rowData:{},pid:{},pname:{},showtype:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(r,{emit:A}){const t=A,{pageData:f,getData:x,nextPage:k}=De(ce),U=async a=>{const l=a.currentTarget,b=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&f.data.length<f.total&&(await k(),await me(),setTimeout(()=>{l.scrollTop=b}))},i=r,e=te(M());function M(){return{id:"",proname:"",notes:"",problem:"",solutions:"",feedback:"",summarize:"",pids:[],charctras:0}}const C={notes:{required:!0,message:"请输入",trigger:"blur"}};async function N(){if(await x({fuzzy:i.pname,page:1}),Object.assign(e,M()),i.operateType==="add"&&(console.log(i.pid),i.pid&&(f.data.forEach(a=>{a.id==i.pid&&(a.disabled=!0)}),e.pids.push(i.pid))),i.operateType==="edit"&&i.rowData){Object.assign(e,i.rowData);const a=JSON.parse(i.rowData.context);e.proname=a.proname,e.notes=a.notes,e.problem=a.problem,e.solutions=a.solutions,e.feedback=a.feedback,e.summarize=a.summarize}}const{formRef:$,validate:G,restoreValidation:d}=le(),s=()=>{i.showtype=="detail"&&(e.pids=i.pid),x({page:1})},v=K([]),y=W.debounce(async a=>{v.value=f.data.filter(l=>e.pids.includes(l.id)),await x({fuzzy:a,page:1}),f.data=f.data.concat(v.value)},300),B=a=>{if(!a){e.pids=null,s();return}y(a)},V=re(()=>({add:"新增项目日报",edit:"修改项目日报"})[i.operateType]),h=ae(r,"visible"),P=()=>{h.value=!1},F=W.debounce(async()=>{var a,l,b;if(await G(),e.charctras<30)return(a=window.$message)==null?void 0:a.warning("字数不能少于30字,请继续填写");if(i.operateType==="edit"){const z=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:O,error:T}=await Le([{context:z,id:e.id,charctras:e.charctras}]);T||((l=window.$message)==null||l.success("修改成功"),t("submitted"),P())}else{const z=ie(),O=f.data.filter(L=>e.pids.includes(L.id)).map(L=>L.proname);e.proname=O.join(",");const T=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:m,error:ne}=await Pe([{context:T,uuid:z,charctras:e.charctras||Q((e.notes??"")+(e.problem??"")+(e.solutions??"")+(e.feedback??"")+(e.summarize??""))}]);if(!ne){const{data:L,error:Ve}=await Te({uuid:z});if(e.pids.length>0){let X=e.pids.map(q=>({pid:q}));X.forEach(q=>{q.did=L});const{data:qe,error:He}=await Se(X)}(b=window.$message)==null||b.success("添加成功"),t("submitted"),P()}}},1e3,{leading:!0,trailing:!1});return E(h,()=>{h.value&&(N(),setTimeout(()=>{const a=document.querySelector(".n-scrollbar-content");a==null||a.scrollTo(0,0)},300),d())}),E(()=>[e.notes,e.problem,e.solutions,e.feedback,e.summarize],()=>{e.charctras=Q((e.notes??"")+(e.problem??"")+(e.solutions??"")+(e.feedback??"")+(e.summarize??""))},{immediate:!0}),(a,l)=>{const b=se,z=oe,O=ue,T=pe;return _(),w(T,{show:h.value,"onUpdate:show":l[6]||(l[6]=m=>h.value=m),title:V.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:o(()=>[n(O,{justify:"end"},{default:o(()=>[n(p(J),{size:"small",class:"mt-16px",onClick:P},{default:o(()=>[j(c(p(Y)("common.cancel")),1)]),_:1}),n(p(J),{type:"primary",size:"small",class:"mt-16px",onClick:p(F)},{default:o(()=>[j(c(p(Y)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:o(()=>[n(z,{ref_key:"formRef",ref:$,model:e,rules:C},{default:o(()=>[i.operateType==="add"&&i.showtype!=="detail"?(_(),w(b,{key:0,label:"关联项目",path:"pids","label-placement":"left"},{default:o(()=>[n(p(de),{clearable:"",filterable:"",value:e.pids,"onUpdate:value":l[0]||(l[0]=m=>e.pids=m),placeholder:"请选择项目","label-field":"proname",multiple:"","value-field":"id",onClear:s,onSearch:B,options:p(f).data,onScroll:U},null,8,["value","options"])]),_:1})):I("",!0),i.operateType==="edit"&&e.proname&&i.showtype!=="detail"?(_(),w(b,{key:1,label:"项目名称",path:"proname","label-placement":"left"},{default:o(()=>[u("span",null,c(e.proname),1)]),_:1})):I("",!0),n(b,{label:"当前工作内容及成果描述：",path:"notes"},{default:o(()=>[n(p(D),{clearable:"",type:"textarea",value:e.notes,"onUpdate:value":l[1]||(l[1]=m=>e.notes=m),placeholder:"请输入"},null,8,["value"])]),_:1}),n(b,{label:"遇到问题：",path:"problem"},{default:o(()=>[n(p(D),{clearable:"",type:"textarea",rows:2,value:e.problem,"onUpdate:value":l[2]||(l[2]=m=>e.problem=m),placeholder:"请输入"},null,8,["value"])]),_:1}),n(b,{label:"解决措施：",path:"solutions"},{default:o(()=>[n(p(D),{clearable:"",type:"textarea",rows:2,value:e.solutions,"onUpdate:value":l[3]||(l[3]=m=>e.solutions=m),placeholder:"请输入"},null,8,["value"])]),_:1}),n(b,{label:"建议意见反馈：",path:"feedback"},{default:o(()=>[n(p(D),{clearable:"",type:"textarea",rows:2,value:e.feedback,"onUpdate:value":l[4]||(l[4]=m=>e.feedback=m),placeholder:"请输入"},null,8,["value"])]),_:1}),n(b,{label:"（总结）自己对一天工作的感受和体感：",path:"summarize"},{default:o(()=>[n(p(D),{clearable:"",type:"textarea",rows:2,value:e.summarize,"onUpdate:value":l[5]||(l[5]=m=>e.summarize=m),placeholder:"请输入"},null,8,["value"])]),_:1}),u("div",null,"字数："+c(e.charctras),1)]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),$e={class:"font-size-12px c-#a19f9d my-5px"},Be={key:0},Fe={class:"mt-4 border-t pt-3"},Oe={class:"flex items-start gap-2 mb-3"},Re={class:"ml-2 flex-1"},Ee={class:"flex items-center"},Je={class:"font-medium font-size-16px font-bold"},Ae={class:"text-gray-600 mt-1"},Ge=ee({name:"drawerLog",__name:"drawerLog",props:H({rowData:{},showtype:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(r){const A=fe();be();const t=te({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0,charctras:0}),f=r,x={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},k=K({});async function U(){i.value=[],Object.assign(t,f.rowData);const d=JSON.parse(f.rowData.context);t.proname=d.proname,t.notes=d.notes,t.problem=d.problem,t.solutions=d.solutions,t.feedback=d.feedback,t.summarize=d.summarize,N()}const i=K([]),e=ae(r,"visible");E(e,()=>{e.value?U():(i.value=[],t.id=void 0)}),E(()=>f.rowData,()=>{e.value&&U()});function M(d){d||C()}function C(){e.value=!1}const N=async()=>{const{data:d,error:s}=await Ie({page:1,limit:100,pid:t.id});d&&(i.value=d.list)},$=W.debounce(async()=>{var y;const d=k.value[t.id];if(!(d!=null&&d.trim()))return(y=window.$message)==null?void 0:y.warning("请输入评论内容");const{data:s,error:v}=await Ue([{pid:t.id,context:d}]);s&&(k.value[t.id]="",t.num++,N())},1e3,{leading:!0,trailing:!1}),G=async d=>{var y;const{data:s,error:v}=await Me(d.id);s&&(N(),t.num--,(y=window.$message)==null||y.success("删除成功"))};return(d,s)=>{const v=se,y=oe,B=je,V=Ce,h=_e,P=ke,F=ve("no-auth");return _(),w(P,{show:e.value,"onUpdate:show":[s[1]||(s[1]=a=>e.value=a),M],"display-directive":"show",width:600,onMaskClick:C,onEsc:C},{default:o(()=>[n(h,{title:t.username+"的项目日报","native-scrollbar":!1,closable:""},{default:o(()=>[n(y,{ref:"formRef",model:t,"show-feedback":!1},{default:o(()=>[t.proname&&f.showtype!="detail"?(_(),w(v,{key:0,label:"项目名称",path:"proname","label-placement":"left"},{label:o(()=>s[2]||(s[2]=[u("div",{class:"font-size-16px font-bold"},"项目名称：",-1)])),default:o(()=>[u("span",null,c(t.proname),1)]),_:1})):I("",!0),n(v,{label:"当前工作内容及成果描述",path:"notes"},{label:o(()=>s[3]||(s[3]=[u("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述：",-1)])),default:o(()=>[u("span",{class:S(["preview-text",{textstyle:t.notes}])},c(t.notes),3)]),_:1}),n(v,{label:"遇到问题",path:"problem"},{label:o(()=>s[4]||(s[4]=[u("div",{class:"font-size-16px font-bold"},"遇到问题：",-1)])),default:o(()=>[u("span",{class:S(["preview-text",{textstyle:t.problem}])},c(t.problem),3)]),_:1}),n(v,{label:"解决措施",path:"solutions"},{label:o(()=>s[5]||(s[5]=[u("div",{class:"font-size-16px font-bold"},"解决措施：",-1)])),default:o(()=>[u("span",{class:S(["preview-text",{textstyle:t.solutions}])},c(t.solutions),3)]),_:1}),n(v,{label:"建议意见反馈",path:"feedback"},{label:o(()=>s[6]||(s[6]=[u("div",{class:"font-size-16px font-bold"},"建议意见反馈：",-1)])),default:o(()=>[u("span",{class:S(["preview-text",{textstyle:t.feedback}])},c(t.feedback),3)]),_:1}),n(v,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:o(()=>s[7]||(s[7]=[u("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感：",-1)])),default:o(()=>[u("span",{class:S(["preview-text",{textstyle:t.summarize}])},c(t.summarize),3)]),_:1}),u("div",$e,"字符数："+c(t.charctras),1)]),_:1},8,["model"]),t.num?(_(),R("div",Be,c(t.num)+"评论",1)):I("",!0),n(ye,{name:"fade"},{default:o(()=>[u("div",Fe,[Z((_(),R("div",Oe,[u("div",null,[n(B,{size:"small",src:x.avatar},null,8,["src"])]),n(p(D),{type:"textarea",id:`comment-input-${t.id}`,value:k.value[t.id],"onUpdate:value":s[0]||(s[0]=a=>k.value[t.id]=a),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ge(he(p($),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),n(p(J),{type:"primary",ghost:"",onClick:p($)},{default:o(()=>s[8]||(s[8]=[j("发送")])),_:1,__:[8]},8,["onClick"])])),[[F,"project:Comment:insert"]]),(_(!0),R(we,null,xe(i.value,a=>(_(),R("div",{key:a.id,class:"flex mb-3"},[n(B,{size:"small",src:x.avatar},null,8,["src"]),u("div",Re,[u("div",Ee,[u("span",Je,c(a.username),1),n(V,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:o(()=>[j(c(a.dbtime),1)]),_:2},1024),p(A).userInfo.id==a.creater?(_(),w(p(Ne),{key:0,onPositiveClick:l=>G(a)},{trigger:o(()=>[Z((_(),w(p(J),{quaternary:"",type:"error",size:"small"},{default:o(()=>s[9]||(s[9]=[j(" 删除 ")])),_:1,__:[9]})),[[F,"project:Comment:delete"]])]),default:o(()=>[s[10]||(s[10]=j(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):I("",!0)]),u("div",Ae,c(a.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),tt=ze(Ge,[["__scopeId","data-v-127defc8"]]);export{et as _,Ze as a,Ue as b,Ie as c,tt as d,Me as e,Ye as f};
