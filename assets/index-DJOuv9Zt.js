import{_ as Z}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BuY_K2-9.js";import{_ as ee}from"./refresh-D6IfSN-8.js";import{d as L,n as H,p as ae,s as W,D as I,o as F,c as q,w as i,g as t,E as V,h as P,t as G,i as r,$ as O,F as te,J as le,B,N as M,O as ne,ad as Q,dM as oe,a4 as se,j as y,ae as re,f as D,aa as ie,a_ as X,S as Y,ar as ce,P as de,Q as ue,R as pe,a3 as ve,W as me,r as U,e as _e,ah as j,bo as fe,aG as ye,aj as he}from"./index-DwoPSGmk.js";import{a as ge,c as xe,d as be,e as J,g as we}from"./reportForm-Birssc-U.js";import{u as ke}from"./table-CL0NfXYk.js";import{_ as Ne}from"./round-search-Day4GO4l.js";import{_ as Ce}from"./round-refresh-DgLCGYwn.js";import{_ as Se}from"./lodash-BQdS0h_O.js";import{_ as Te}from"./FormItemGridItem-DkKWfBvp.js";import{_ as Pe}from"./Grid-NKVy6VcP.js";import{T as Re}from"./task-6qcO2ygI.js";import{_ as $e,a as ze,b as De,c as Ae}from"./file-pdf-vAxopOSf.js";import{_ as K}from"./Popconfirm--bpvBYZg.js";import"./setting-outlined-Bzf38DQZ.js";import"./echarts.vue_vue_type_script_setup_true_lang-CuSGzgyE.js";import"./index-BhRqCdHu.js";import"./installCanvasRenderer-CyOrKSjT.js";import"./install-CX03SWNg.js";const Ee=L({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:H(["reset","search"],["update:model"]),setup(f,{emit:R}){const $=R,{formRef:n,restoreValidation:_}=ae(),u=W(f,"model"),z=()=>{u.value.fuzzy="",h()};async function k(){await _(),$("reset")}async function h(){$("search")}const N=Se.debounce(h,1e3,{leading:!0,trailing:!1});return(C,v)=>{const g=le,a=Te,e=Ce,l=B,d=Ne,x=M,S=Pe,A=ne,E=Q,b=I("no-space");return F(),q(E,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[t(A,{ref_key:"formRef",ref:n,model:u.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(r(N),["enter"])},{default:i(()=>[t(S,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:i(()=>[t(a,{span:"24 s:12 m:8 l:6",label:"实例名称",path:"alatype"},{default:i(()=>[V(t(g,{autofocus:"",value:u.value.fuzzy,"onUpdate:value":v[0]||(v[0]=s=>u.value.fuzzy=s),placeholder:"请输入实例名称关键字",clearable:"",onClear:z},null,8,["value"]),[[b]])]),_:1}),t(a,{span:"24 s:12 m:8 l:6"},{default:i(()=>[t(x,{class:"w-full"},{default:i(()=>[t(l,{onClick:k},{icon:i(()=>[t(e,{class:"text-icon"})]),default:i(()=>[P(" "+G(r(O)("common.reset")),1)]),_:1}),t(l,{type:"primary",ghost:"",onClick:r(N)},{icon:i(()=>[t(d,{class:"text-icon"})]),default:i(()=>[P(" "+G(r(O)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Be=f=>(de("data-v-39227d5f"),f=f(),ue(),f),Ie=Be(()=>D("span",{class:"mr-20px"},"报表预览",-1)),Ve={title:"导出PDF"},Me={title:"导出Word"},Oe={title:"导出Excel"},Ge=L({name:"reportPreview",__name:"reportPreview",props:H({data:{},detaliParams:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(f){oe(a=>({"756756e9":r($)}));const R=se(),$=R.themeScheme=="dark"?"#001428":"#fff",n=f,_=W(f,"visible"),u=y([]),z=async a=>{const{data:e,error:l}=await ge({rtype:a});l||(e.forEach(d=>{d.rtext=JSON.parse(d.rtext)}),u.value=e[0].rtext)},k=["提示","低危","中危","高危","致命"],h=["lev0","lev1","lev2","lev3","lev4"],N=y(),C=y(""),v=async()=>{n.detaliParams.rtype=1,await z(0),u.value.forEach(a=>{a.type=="table"&&(a.dataName=="collection"&&(a.value.body=n.data.collection.map(e=>a.value.tableHeaderValue.map(l=>l=="ctime"?X(1,e[l]):e[l]))),a.dataName=="events"&&(a.value.body=n.data.events.map(e=>a.value.tableHeaderValue.map(l=>e[l]))),a.dataName=="level"&&(a.value.body=n.data.level.map(e=>a.value.tableHeaderValue.map(l=>e[l]))),a.dataName=="level1"&&(a.value.body=h.map(e=>[e=="lev0"?"提示":e=="lev1"?"低危":e=="lev2"?"中危":e=="lev3"?"高危":"致命",n.data.level.reduce((l,d)=>l+(Number(d[e])||0),0)]))),a.type=="chart"&&a.dataName=="events"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=n.data.events.map(e=>e.count),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=n.data.events.map(e=>e.cname):a.value.data.yAxis.data=n.data.events.map(e=>e.cname)),a.value.chartType=="pie"&&(a.value.data.series[0].data=n.data.events.map(e=>({value:e.count,name:e.cname}))),a.value.chartType=="line"&&(a.value.data.series[0].data=n.data.events.map(e=>e.count),a.value.data.xAxis.data=n.data.events.map(e=>e.cname))),a.dataName=="level"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=n.data.level.map(e=>e.count),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=n.data.level.map(e=>e.logname):a.value.data.yAxis.data=n.data.level.map(e=>e.logname)),a.value.chartType=="pie"&&(a.value.data.series[0].data=n.data.level.map(e=>({value:e.count,name:e.logname}))),a.value.chartType=="line"&&(a.value.data.series[0].data=n.data.level.map(e=>e.count),a.value.data.xAxis.data=n.data.level.map(e=>e.logname))),a.dataName=="level1"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(e=>n.data.level.reduce((l,d)=>l+(Number(d[e])||0),0)),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=k:a.value.data.yAxis.data=k),a.value.chartType=="pie"&&(a.value.data.series[0].data=[{value:n.data.level.reduce((e,l)=>e+l.lev0*1,0),name:"提示"},{value:n.data.level.reduce((e,l)=>e+l.lev1*1,0),name:"低危"},{value:n.data.level.reduce((e,l)=>e+l.lev2*1,0),name:"中危"},{value:n.data.level.reduce((e,l)=>e+l.lev3*1,0),name:"高危"},{value:n.data.level.reduce((e,l)=>e+l.lev4*1,0),name:"致命"}]),a.value.chartType=="line"&&(a.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(e=>n.data.level.reduce((l,d)=>l+(Number(d[e])||0),0)),a.value.data.xAxis.data=k))}),N.value=u.value};re(_,()=>{_.value&&v()});const g=y();return(a,e)=>{const l=$e,d=ze,x=De,S=Ae,A=Y,E=ce;return F(),q(E,{show:_.value,"onUpdate:show":e[3]||(e[3]=b=>_.value=b),preset:"card",class:"w-1000px reportPreview",style:ie({"background-color":r(R).themeScheme=="dark"?"#001428":"#fff"})},{header:i(()=>[Ie,D("span",Ve,[t(l,{class:"text-32px c-#d63031 cursor-pointer",onClick:e[0]||(e[0]=b=>g.value.toPdf(C.value))})]),D("span",Me,[t(d,{class:"text-32px c-#1e90ff cursor-pointer",onClick:e[1]||(e[1]=b=>g.value.toWord(C.value))})]),D("span",Oe,[t(x,{class:"text-32px c-#15703d cursor-pointer",onClick:e[2]||(e[2]=b=>g.value.toExcel(C.value))})])]),default:i(()=>[t(A,{class:"max-h-600px"},{default:i(()=>[t(S,{ref_key:"filePreviewExportRef",ref:g,width:800,data:N.value},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),Le=pe(Ge,[["__scopeId","data-v-39227d5f"]]),Fe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ue=D("div",{style:{display:"flex","align-items":"center"}},[D("div",null,"报表实例")],-1),ia=L({name:"reportmanagement_reportlist",__name:"index",setup(f){const R=ve(),{columns:$,columnChecks:n,data:_,getData:u,loading:z,mobilePagination:k,searchParams:h,resetSearchParams:N}=ke({apiFn:xe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:s=>!0,renderExpand:s=>t("div",{class:"detailList"},[t(Y,{style:"max-height: 360px"},{default:()=>[a.value.length>0?a.value.map((o,c)=>t(M,{justify:"space-between",style:{marginBottom:"8px",padding:"0px 50px 8px 50px",borderBottom:c!==a.value.length-1?"1px dashed #ccc":"none"},key:o.sn},{default:()=>[t("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[o.sn]),t(M,null,{default:()=>[V(t(B,{type:"info",size:"small",ghost:!0,onClick:()=>A(o.sn,s.rtype)},{default:()=>[P("查看")]}),[[I("no-auth"),"sys.report.instance.select"]]),t(K,{onPositiveClick:()=>b(o.sn,s.rtype,s.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>V(t(B,{type:"error",size:"small",ghost:!0},{default:()=>[P("删除")]}),[[I("no-auth"),"sys.report.instance.delete"]])})]})]})):t("div",{style:{textAlign:"center",padding:"10px"}},[P("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:s=>{var o;return t("div",null,[(o=me(Re).find(c=>c.value===s.rtype))==null?void 0:o.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:O("common.operate"),align:"center",width:160,render:s=>t("div",{class:"flex-center gap-8px"},[t(K,{onPositiveClick:()=>E(s.tid,s.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>V(t(B,{type:"primary",ghost:!0,size:"small"},{default:()=>[P("清空")]}),[[I("no-auth"),"sys.report.instance.delete"]])})])}]}),C=y(null),v=y([]),g=async s=>{v.value=[s[s.length-1]],v.value[0]&&(a.value=[],await l());const o=_.value.findIndex(c=>c.tid===s[s.length-1]);setTimeout(()=>{var c;(c=C.value)==null||c.scrollTo({top:o*40,behavior:"smooth"})},500)},a=y([]),e=U({page:1,limit:10}),l=async()=>{const s=JSON.parse(JSON.stringify(_.value)).find(p=>p.tid===v.value[0]),{data:o,error:c}=await we({tid:v.value[0],page:e.page,limit:Number(s.num)||10});c||(a.value=o.list,ye(()=>{const p=document.querySelector(".detailList");if(p){const{height:m}=p.getBoundingClientRect();p.animate([{height:"0px"},{height:`${m}px`}],{duration:300,easing:"linear"})}}))},d=y(!1),x=y({}),S=U({name:"",rtype:0}),A=async(s,o)=>{var m;const{data:c,error:p}=await be({name:s,type:o,tid:v.value[0]});S.name=s,S.rtype=o,p||(d.value=!0,x.value=JSON.parse(c),x.value.baseInfo=(m=x.value.baseInfo)==null?void 0:m.map(T=>({...T,dbtime:X(1,T.dbtime)})))},E=async(s,o)=>{var m;const{data:c,error:p}=await J({tid:s,type:o});p||((m=window.$message)==null||m.success("清空成功"),a.value=[],u())},b=async(s,o,c)=>{var T;const{data:p,error:m}=await J({fname:s,type:o,tid:c});m||((T=window.$message)==null||T.success("删除成功"),u(),l())};return(s,o)=>{const c=ee,p=Z,m=he,T=Q;return F(),_e("div",Fe,[t(Ee,{model:r(h),"onUpdate:model":o[0]||(o[0]=w=>j(h)?h.value=w:null),onReset:r(N),onSearch:r(u)},null,8,["model","onReset","onSearch"]),t(T,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:i(()=>[Ue]),"header-extra":i(()=>[t(r(M),null,{default:i(()=>[t(r(B),{size:"small",onClick:o[1]||(o[1]=w=>r(u)())},{icon:i(()=>[t(c,{class:fe(["text-icon",{"animate-spin":r(z)}])},null,8,["class"])]),default:i(()=>[P(" "+G(r(O)("common.refresh")),1)]),_:1}),t(p,{columns:r(n),"onUpdate:columns":o[2]||(o[2]=w=>j(n)?n.value=w:null)},null,8,["columns"])]),_:1})]),default:i(()=>[t(m,{ref_key:"tableContainer",ref:C,columns:r($),data:r(_),size:"small","flex-height":!r(R).isMobile,"scroll-x":962,loading:r(z),remote:"","row-key":w=>w.tid,pagination:r(k),class:"sm:h-full","expanded-row-keys":v.value,"onUpdate:expandedRowKeys":g},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),t(Le,{visible:d.value,"onUpdate:visible":o[3]||(o[3]=w=>d.value=w),data:x.value,detaliParams:S},null,8,["visible","data","detaliParams"])]),_:1})])}}});export{ia as default};
