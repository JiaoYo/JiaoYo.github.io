import{Q as _e,p as fe,_ as we,a as ge}from"./pako.esm-CkyfHgEG.js";import{_ as ve}from"./export-DmW3M2T8.js";import{_ as he}from"./round-search-B18X-jkl.js";import{d as j,ac as E,a0 as ye,o as k,b as F,_ as H,ea as be,b0 as r,g as n,m as g,z as xe,ak as ke,w as o,f as u,B as q,h as S,t as N,$ as V,c as L,F as $,aq as De,e as Q,eb as Te,aG as Pe,Q as Ce,T as Se,a7 as Ne,c0 as $e,at as Ie,R as Be,c1 as Me,ap as Ue,p as ze,i as Ae}from"./index-CJqNC1pa.js";import{u as Re,a as qe}from"./table-CSFZJulD.js";import{e as Le}from"./exportExcel-Bv4G4H50.js";import{u as Fe,L as W}from"./echarts-Crj2ZnAJ.js";import{_ as Ge}from"./DatePicker-DEchz1PT.js";import{_ as Oe}from"./RadioButton-CL_hEu63.js";import{_ as Ee}from"./FormItemGridItem-CpVSj9p1.js";import{_ as Ve}from"./Grid-BhBi0e3N.js";const We=j({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(b){const p=b;E(()=>p.data,async e=>{v(i=>(i.xAxis.data=p.data.map(l=>l.dbtime),i.series[0].data=p.data.map(l=>l.power),i.series[1].data=p.data.map(l=>l.prePower),i))});const m=ye(),{domRef:I,updateOptions:B,updateOptionsAsync:v}=Fe(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:"#6a7985",textStyle:{color:"rgb(224, 224, 224)"},valueFormatter:function(e){return(e+""!="undefined"?e:"--")+"MW"}},legend:{data:["实际功率","预测功率"]},toolbox:{show:!0,feature:{saveAsImage:{show:!0,name:"功率图表"},magicType:{show:!0,type:["line","bar"]}}},grid:{left:"2%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} MW"}},series:[{color:"#e90445",name:"实际功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new W(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.9)",shadowBlur:20},data:[],connectNulls:!0},{color:"#009688",name:"预测功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new W(0,0,0,1,[{offset:0,color:"rgba(0, 150, 136,0.3)"},{offset:1,color:"rgba(0, 150, 136,0)"}],!1),shadowColor:"rgba(0, 150, 136,0.9)",shadowBlur:20},data:[],connectNulls:!0}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function h(){await new Promise(e=>{setTimeout(e,200)}),B(e=>(e.xAxis.data=p.data.map(i=>i.dbtime),e.series[0].data=p.data.map(i=>i.power),e.series[1].data=p.data.map(i=>i.prePower),e))}function M(){B((e,i)=>{const l=i();return e.legend.data=l.legend.data,e.series[0].name=l.series[0].name,e.series[1].name=l.series[1].name,e})}async function U(){h()}return E(()=>m.locale,()=>{M()}),U(),(e,i)=>(k(),F("div",{ref_key:"domRef",ref:I,class:"h-600px overflow-hidden"},null,512))}}),je=H(We,[["__scopeId","data-v-462d4bff"]]),He=b=>(ze("data-v-f1145239"),b=b(),Ae(),b),Qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ke={key:1},Je=He(()=>Q("span",null,"二维码",-1)),Ze=j({name:"realtimequery_powerquery",__name:"index",setup(b){const p=Date.now(),m=new Date(p).setHours(0,0,0,0);new Date(p).setHours(23,59,59,999);const{columns:I,columnChecks:B,data:v,getData:h,loading:M,mobilePagination:U,searchParams:e,resetSearchParams:i}=Re({apiFn:be,apiParams:{page:1,pageSize:20,limit:20,startTime:r(1,m)||null,endTime:r(1,Date.now()+144e5)||null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"dbtime",title:"时间",align:"center",width:100},{key:"power",title:"实际功率(MW)",align:"center",width:140},{key:"prePower",title:"预测功率(MW)",align:"center",width:140},{key:"ctime",title:"预测计算时间(s)",align:"center",width:140},{key:"operate",title:"误差(MW)",align:"center",width:100,render(t){const a=t.prePower-t.power>=0?t.prePower-t.power:t.power-t.prePower;return n("span",null,[a?parseFloat(a.toFixed(6)):""])}}]}),{checkedRowKeys:l}=qe(v,h),f=g(null),z=g(!1),K=t=>{if(t){if(f.value!==null)return;w(),f.value=window.setInterval(async()=>w(),1e3*60*3)}else f.value!==null&&(clearInterval(f.value),f.value=null),w()},J=async()=>{_.value=="0"?await w():await h()},D=g([]),T=g(""),w=async()=>{const{data:t,error:a}=await Te({startTime:e.startTime,endTime:e.endTime});a||(D.value=t.sort((d,s)=>new Date(d.dbtime).getTime()-new Date(s.dbtime).getTime()))},P=g([m,Date.now()+144e5]);async function Z(t,a){e.startTime=r(1,a[0]),e.endTime=r(1,a[1]),e.startTime==r(1,m)&&e.endTime==r(1,Date.now()+144e5)?x.value="0":e.startTime==r(1,m)&&e.endTime==r(1,Date.now()+864e5*10)?x.value="1":x.value="2",_.value=="1"?h():w()}const X=t=>{t=="1"?h():w()};xe(()=>{w()});const Y=()=>{var d;if(v.value.length==0)return(d=window.$message)==null?void 0:d.warning("暂无数据。请查询数据后重试。");const t={dbtime:"时间",power:"实际功率",prePower:"预测功率",ctime:"预测计算时间",error:"误差"},a=[];v.value.forEach(s=>{l.value.includes(s.id)&&a.push({dbtime:s.dbtime,power:s.power,prePower:s.prePower,error:s.prePower-s.power>=0?s.prePower-s.power:s.power-s.prePower||""})}),Le(a,t,"预测数据")},_=g("0"),A=g(!1),ee=()=>{var s,C;if(D.value.length==0)return(s=window.$message)==null?void 0:s.warning("暂无数据。请查询数据后重试。");const t={data:D.value.map(y=>({t:y.dbtime,pP:y.prePower,p:y.power})),type:0,dateTime:r(1,e.startTime)+" --- "+(z.value?r(1,new Date):r(1,e.endTime))},d=fe.gzip(JSON.stringify(t),{to:"string"}).reduce((y,R)=>y+String.fromCharCode(R),"");if(T.value=`https://dingiiot.com/powerPrediction/?${btoa(d)}`,T.value.length>2700)return(C=window.$message)==null?void 0:C.warning("二维码生成失败，请缩小查询范围后重试");console.log("地址",T.value),A.value=!0},ae=()=>{var a;const t=document.getElementById("qrcode");if(t){const d=document.createElement("a");d.href=t.toDataURL("image/png"),d.download="qrcode.png",d.click(),(a=window.$message)==null||a.success("下载成功")}else console.error("无法找到二维码 canvas 元素")},te={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()]},x=g("0"),ne=t=>{x.value=t,t=="0"?(P.value=[m,Date.now()+144e5],e.startTime=r(1,m),e.endTime=r(1,Date.now()+144e5)):(P.value=[m,Date.now()+864e5*10],e.startTime=r(1,m),e.endTime=r(1,Date.now()+864e5*10)),_.value=="1"?h():w()};return ke(()=>{f.value!==null&&(clearInterval(f.value),f.value=null)}),(t,a)=>{const d=Ge,s=Oe,C=Pe,y=he,R=we,oe=Ce,se=Ee,le=Ve,re=Se,G=Ne,O=$e,ie=Ie,ce=ve,ue=Be,de=Me,pe=ge,me=Ue;return k(),F("div",Qe,[n(G,{bordered:!1,size:"small"},{default:o(()=>[n(re,{ref:"formRef",model:u(e),"label-placement":"left","show-feedback":!1},{default:o(()=>[n(le,{"y-gap":16,responsive:"screen","item-responsive":""},{default:o(()=>[n(se,{span:"24 s:12 m:18",label:"起止时间",path:"startTime"},{default:o(()=>[n(d,{value:P.value,"onUpdate:value":a[0]||(a[0]=c=>P.value=c),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":Z,"default-time":["00:00:00","23:59:59"],shortcuts:te},null,8,["value"]),n(C,{value:x.value,"onUpdate:value":[a[1]||(a[1]=c=>x.value=c),ne],class:"ml-20px"},{default:o(()=>[n(s,{value:"0",label:"超短期"}),n(s,{value:"1",label:"短期"})]),_:1},8,["value"]),n(u(q),{type:"primary",ghost:"",onClick:J,class:"ml-20px"},{icon:o(()=>[n(y,{class:"text-icon"})]),default:o(()=>[S(" "+N(u(V)("common.search")),1)]),_:1}),_.value=="0"?(k(),L(u(q),{key:0,type:"primary",ghost:"",onClick:ee,class:"ml-20px"},{icon:o(()=>[n(R,{class:"text-icon"})]),default:o(()=>[S(" "+N("生成二维码"))]),_:1})):$("",!0),_.value=="0"?(k(),L(oe,{key:1,checked:z.value,"onUpdate:checked":[a[2]||(a[2]=c=>z.value=c),K],class:"ml-20px",title:"3分钟自动刷新"},{default:o(()=>[S(" 定时刷新 ")]),_:1},8,["checked"])):$("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(G,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:o(()=>[n(de,{type:"card",animated:"",value:_.value,"onUpdate:value":[a[4]||(a[4]=c=>_.value=c),X],class:"h-100%","tab-style":{height:"40px"},"pane-wrapper-style":{flex:1}},{suffix:o(()=>[_.value=="1"?(k(),L(ue,{key:0,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[n(u(q),{onClick:Y,size:"small",disabled:u(l).length==0},{icon:o(()=>[n(ce,{class:"text-icon"})]),default:o(()=>[S(" "+N(u(V)("common.export")),1)]),_:1},8,["disabled"])]),_:1})):$("",!0),_.value=="0"?(k(),F("span",Ke,"共"+N(D.value.length)+"条数据",1)):$("",!0)]),default:o(()=>[n(O,{name:"0",tab:"图表"},{default:o(()=>[n(je,{data:D.value},null,8,["data"])]),_:1}),n(O,{name:"1",tab:"表格",class:"h-100%"},{default:o(()=>[n(ie,{"checked-row-keys":u(l),"onUpdate:checkedRowKeys":a[3]||(a[3]=c=>De(l)?l.value=c:null),columns:u(I),data:u(v),size:"small",loading:u(M),remote:"","row-key":c=>c.id,pagination:u(v).length?u(U):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1}),n(me,{show:A.value,"onUpdate:show":a[5]||(a[5]=c=>A.value=c),title:"",preset:"card",class:"w-auto"},{header:o(()=>[Q("div",null,[Je,n(pe,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:ae})])]),default:o(()=>[n(_e,{id:"qrcode",style:{margin:"0 auto"},value:T.value,margin:3,size:500,level:"L"},null,8,["value"])]),_:1},8,["show"])])}}}),ca=H(Ze,[["__scopeId","data-v-f1145239"]]);export{ca as default};
