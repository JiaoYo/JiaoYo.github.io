import{d as Q,aE as R,m as W,ar as le,r as Z,bY as H,H as L,n as re,a as ie,aG as ee,en as ce,eo as de,aC as K,d0 as ue,c as T,o as g,w as a,f as s,C as te,s as G,e as i,N as ae,h as t,aD as pe,v as C,t as u,y as me,B as q,g as D,$ as Y,a1 as fe,cu as ve,aO as _e,O as be,ep as ge,q as ye,bg as we,b as I,aU as x,X as he,x as J,A as xe,cM as Ce,U as De,V as ke,bi as ze,eq as Ne,er as Se,M as je}from"./index-K-Oe9yen.js";import{u as Te}from"./usePageData-Cn0zOp5N.js";import{_ as Pe,a as Me}from"./text-D_xfMGfj.js";import{N as Ue}from"./Popconfirm-CR5sQlbC.js";const $e={class:"mt-10px"},Xe=Q({name:"OperateDrawer",__name:"operate-drawer",props:R({operateType:{},rowData:{},pid:{},pname:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:R(["submitted"],["update:visible"]),setup(k,{emit:F}){W();const n=F,y=le("pname"),c=k,e=Z(P());function P(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null,charctras:0}}const w={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施",trigger:"blur"}},{pageData:v,getData:h,nextPage:z}=Te(ve),N=async l=>{const r=l.currentTarget,_=r.scrollTop;r.scrollTop+r.offsetHeight>=r.scrollHeight&&v.data.length<v.total&&(await z(),await _e(),setTimeout(()=>{r.scrollTop=_}))},M=async l=>{m.value=!0,l?e.pid=l:e.value.pid=null},E=async()=>{var l;if(await h({fuzzy:c.pname?c.pname:y!=null&&y.value?y==null?void 0:y.value:"",page:1}),v.data.length==0)return(l=window.$message)==null?void 0:l.warning("没有项目")},d=H.debounce(async l=>{await h({fuzzy:l,page:1})},300),o=L(!1),m=L(!1),b=l=>{if(e.pid=null,o.value=!0,m.value=!1,!l){$();return}d(l)},U=async()=>{o.value&&!m.value&&(await h({page:1}),o.value=!1)},$=()=>{h({page:1})};async function O(){Object.assign(e,P()),await E(),c.pid&&(v.data.forEach(l=>{l.id==c.pid&&(l.disabled=!0)}),e.pid=c.pid),c.operateType==="edit"&&c.rowData&&Object.assign(e,c.rowData)}const{formRef:V,validate:B,restoreValidation:f}=re(),X=ie(()=>({add:"新增项目总结",edit:"修改项目总结"})[c.operateType]),S=ee(k,"visible"),A=()=>{S.value=!1},ne=H.debounce(async()=>{var l,r;if(await B(),c.operateType==="edit"){const{data:_,error:j}=await ce([{...e}]);j||((l=window.$message)==null||l.success("修改成功"),n("submitted"),A())}else{const{data:_,error:j}=await de([{pid:e.pid,content1:e.content1,content2:e.content2,content3:e.content3,content4:e.content4,content5:e.content5,charctras:e.charctras}]);j||((r=window.$message)==null||r.success("添加成功"),n("submitted"),A())}},1e3,{leading:!0,trailing:!1});return K(S,()=>{S.value&&(O(),setTimeout(()=>{const l=document.querySelector(".n-scrollbar-content");l==null||l.scrollTo(0,0)},300),f())}),K(()=>[e.content1,e.content2,e.content3,e.content4,e.content5],()=>{e.charctras=ue(e.content1+e.content2+e.content3+e.content4+e.content5)},{immediate:!0}),(l,r)=>{const _=ae,j=te,oe=me,se=fe;return g(),T(se,{show:S.value,"onUpdate:show":r[6]||(r[6]=p=>S.value=p),title:X.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:a(()=>[s(oe,{justify:"end"},{default:a(()=>[s(t(q),{size:"small",class:"mt-16px",onClick:A},{default:a(()=>[D(u(t(Y)("common.cancel")),1)]),_:1}),s(t(q),{type:"primary",size:"small",class:"mt-16px",onClick:t(ne)},{default:a(()=>[D(u(t(Y)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:a(()=>[s(j,{ref_key:"formRef",ref:V,model:e,rules:w},{default:a(()=>[c.operateType==="add"?(g(),T(_,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:a(()=>[s(t(pe),{clearable:"",filterable:"",value:e.pid,"onUpdate:value":[r[0]||(r[0]=p=>e.pid=p),M],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:$,onSearch:b,onBlur:U,options:t(v).data,onScroll:N},null,8,["value","options"])]),_:1})):G("",!0),s(_,{label:"前期准备阶段描述",path:"content1"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content1,"onUpdate:value":r[1]||(r[1]=p=>e.content1=p),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),s(_,{label:"遇到问题及对项目的影响",path:"content2"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content2,"onUpdate:value":r[2]||(r[2]=p=>e.content2=p),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),s(_,{label:"经验教训与改进方案或措施",path:"content3"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content3,"onUpdate:value":r[3]||(r[3]=p=>e.content3=p),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),s(_,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content4,"onUpdate:value":r[4]||(r[4]=p=>e.content4=p),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),s(_,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content5,"onUpdate:value":r[5]||(r[5]=p=>e.content5=p),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1}),i("div",$e,"字符数："+u(e.charctras),1)]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Be={class:"font-size-12px c-#a19f9d my-5px"},Ie={key:0},Le={class:"mt-4 border-t pt-3"},qe={class:"flex items-start gap-2 mb-3"},Fe={class:"ml-2 flex-1"},Ee={class:"flex items-center"},Oe={class:"font-medium font-size-16px font-bold"},Ve={class:"text-gray-600 mt-1"},Ae=Q({name:"drawerLog",__name:"drawerLog",props:R({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(k){const F=W();be();let n=Z({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",charctras:0,num:0});const y=k,c={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},e=L({});async function P(){w.value=[],Object.assign(n,y.rowData),N()}const w=L([]),v=ee(k,"visible");K(v,()=>{v.value?P():(w.value=[],n.id=void 0)});function h(d){d||z()}function z(){v.value=!1}const N=async()=>{const{data:d,error:o}=await Ne({page:1,limit:100,pid:n.id});d&&(w.value=d.list)},M=H.debounce(async()=>{var b;const d=e.value[n.id];if(!(d!=null&&d.trim()))return(b=window.$message)==null?void 0:b.warning("请输入评论内容");const{data:o,error:m}=await ge([{pid:n.id,content:d}]);o&&(e.value[n.id]="",n.num++,N())},1e3,{leading:!0,trailing:!1}),E=async d=>{var b;const{data:o,error:m}=await Se(d.id);o&&(N(),n.num--,(b=window.$message)==null||b.success("删除成功"))};return(d,o)=>{const m=ae,b=te,U=Pe,$=Me,O=we,V=ze,B=ye("no-auth");return g(),T(V,{show:v.value,"onUpdate:show":[o[1]||(o[1]=f=>v.value=f),h],"display-directive":"show",width:600,onMaskClick:z,onEsc:z},{default:a(()=>[s(O,{title:t(n).username+"的项目总结","native-scrollbar":!1,closable:""},{default:a(()=>[s(b,{ref:"formRef",model:t(n),"show-feedback":!1},{default:a(()=>[s(m,{label:"",path:"contractname"},{label:a(()=>o[2]||(o[2]=[i("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).proname}])},u(t(n).proname),3)]),_:1}),s(m,{label:"前期准备阶段描述",path:"content1"},{label:a(()=>o[3]||(o[3]=[i("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content1}])},u(t(n).content1),3)]),_:1}),s(m,{label:"遇到问题及对项目的影响",path:"content2"},{label:a(()=>o[4]||(o[4]=[i("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content2}])},u(t(n).content2),3)]),_:1}),s(m,{label:"经验教训与改进方案或措施",path:"content3"},{label:a(()=>o[5]||(o[5]=[i("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content3}])},u(t(n).content3),3)]),_:1}),s(m,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:a(()=>o[6]||(o[6]=[i("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content4}])},u(t(n).content4),3)]),_:1}),s(m,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:a(()=>o[7]||(o[7]=[i("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content5}])},u(t(n).content5),3)]),_:1}),i("div",Be,"字符数："+u(t(n).charctras),1)]),_:1},8,["model"]),t(n).num?(g(),I("div",Ie,u(t(n).num)+"评论",1)):G("",!0),s(he,{name:"fade"},{default:a(()=>[i("div",Le,[J((g(),I("div",qe,[i("div",null,[s(U,{size:"small",src:c.avatar},null,8,["src"])]),s(t(C),{type:"textarea",id:`comment-input-${t(n).id}`,value:e.value[t(n).id],"onUpdate:value":o[0]||(o[0]=f=>e.value[t(n).id]=f),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:xe(Ce(t(M),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),s(t(q),{type:"primary",ghost:"",onClick:t(M)},{default:a(()=>o[8]||(o[8]=[D("发送")])),_:1,__:[8]},8,["onClick"])])),[[B,"project:Summary:Comment:insert"]]),(g(!0),I(De,null,ke(w.value,f=>(g(),I("div",{key:f.id,class:"flex mb-3"},[s(U,{size:"small",src:c.avatar},null,8,["src"]),i("div",Fe,[i("div",Ee,[i("span",Oe,u(f.username),1),s($,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:a(()=>[D(u(f.dbtime),1)]),_:2},1024),t(F).userInfo.id==f.creater?(g(),T(t(Ue),{key:0,onPositiveClick:X=>E(f)},{trigger:a(()=>[J((g(),T(t(q),{quaternary:"",type:"error",size:"small"},{default:a(()=>o[9]||(o[9]=[D(" 删除 ")])),_:1,__:[9]})),[[B,"project:Summary:Comment:delete"]])]),default:a(()=>[o[10]||(o[10]=D(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):G("",!0)]),i("div",Ve,u(f.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ye=je(Ae,[["__scopeId","data-v-710f1fb9"]]);export{Xe as _,Ye as d};
