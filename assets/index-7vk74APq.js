import{_ as pe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BgWicq3L.js";import{_ as _e}from"./export-C-wWdPxu.js";import{_ as fe}from"./round-search-DsZQ_jUh.js";import{d as J,ab as G,a0 as ge,k as _,x as he,aj as ye,o as N,e as F,_ as K,aw as x,g as t,w as a,i as o,B as b,af as we,h as D,t as g,$ as I,f as V,aI as j,c as E,aX as ve,Q as ke,P as xe,aL as be,M as De,aH as Te,a6 as Ce}from"./index-Bz6coK7a.js";import{c as A,d as Se,e as Ne}from"./metar-TNo5Bxtg.js";import{u as Me,a as ze}from"./table-DtiAApi9.js";import{e as Le}from"./exportExcel-Bv4G4H50.js";import{u as Oe}from"./echarts-CB_0isEP.js";import{_ as Pe}from"./lodash-BVO1-FQC.js";import{_ as Re}from"./RadioButton-CdFg1PxI.js";import{_ as H}from"./DatePicker-DJ2UnJ7m.js";import{_ as Ue}from"./FormItemGridItem-DsjYtvph.js";import{_ as $e}from"./Grid-BbWl5bmg.js";const Be=J({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(P){const d=P;G(()=>d.data,async n=>{M(),z()});const h=ge(),m=_(null),{domRef:y,updateOptions:w,showLoading:M,hideLoading:p}=Oe(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0}}},legend:{data:["功率标准差","均方根误差","平均绝对误差","平均误差","最大预测误差"]},calculable:!0,grid:{left:"6%",right:"6%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!0,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value}"},position:"left"},series:[{name:"功率标准差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"均方根误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"平均绝对误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"平均误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"最大预测误差",type:"bar",emphasis:{focus:"series"},data:[]}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function z(){await new Promise(n=>{setTimeout(n,1e3)}),w(n=>(n.xAxis.data=d.data.map(i=>i.dbtime),n.series[0].data=d.data.map(i=>i.stdpower),n.series[1].data=d.data.map(i=>i.prmse),n.series[2].data=d.data.map(i=>i.pmae),n.series[3].data=d.data.map(i=>i.pme),n.series[4].data=d.data.map(i=>i.pmaxe),n))}function f(){w((n,i)=>{const v=i();return n.legend.data=v.legend.data,n.series[0].name=v.series[0].name,n.series[1].name=v.series[1].name,n})}async function T(){z()}return G(()=>h.locale,()=>{f()}),T(),he(()=>{m.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),ye(()=>{m.value!==null&&(clearInterval(m.value),m.value=null)}),(n,i)=>(N(),F("div",{ref_key:"domRef",ref:y,class:"h-100% overflow-hidden"},null,512))}}),Ge=K(Be,[["__scopeId","data-v-7655cf3a"]]),Ie={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ve={style:{width:"200px","margin-left":"20px"}},je=J({name:"realtimequery_datastatistics",__name:"index",setup(P){const{columns:d,columnChecks:h,data:m,getData:y,loading:w,mobilePagination:M,searchParams:p,resetSearchParams:z}=Me({apiFn:A,apiParams:{page:1,pageSize:20,limit:20,startTime:x(0,Date.now()-2592e5),endTime:x(0,Date.now()),_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",width:50},{key:"dbtime",title:"更新时间",align:"center",width:160,fixed:"left"},{key:"etime",title:"有效时长(小时)",align:"center",width:120},{key:"powermax",title:"功率最大值",align:"center",width:120},{key:"avgpower",title:"功率平均值",align:"center",width:120},{key:"stdpower",title:"功率标准差",align:"center",width:120},{key:"powertime",title:"功率最大发生时间",align:"center",width:160},{key:"uhours",title:"利用小时数",align:"center",width:120},{key:"avgload",title:"平均负荷率",align:"center",width:120},{key:"prmse",title:"均方根误差",align:"center",width:120},{key:"pmae",title:"平均绝对误差",align:"center",width:120},{key:"pme",title:"平均误差",align:"center",width:120},{key:"pclcf",title:"相关性系数",align:"center",width:120},{key:"pmaxe",title:"最大预测误差",align:"center",width:120},{key:"prate",title:"合格率",align:"center",width:120},{key:"avgenvt",title:"环境温度平均值",align:"center",width:120},{key:"avgenvh",title:"环境湿度平均值",align:"center",width:120},{key:"avgldt",title:"露点温度平均值",align:"center",width:120},{key:"avgqy",title:"气压平均值",align:"center",width:120},{key:"avgwindd",title:"风向平均值",align:"center",width:120},{key:"avgwinds",title:"风速平均值",align:"center",width:120},{key:"avgzfsd",title:"总辐射平均值",align:"center",width:120}]}),{checkedRowKeys:f}=ze(m,y),T=()=>{k.value=="0"?y():U()},n=Pe.debounce(T,1e3,{leading:!0,trailing:!1}),i=_([Date.now()-864e5*3,Date.now()]);async function v(s,e){p.startTime=x(0,e[0]),p.endTime=x(0,e[1]),T()}const q=()=>{const s={};d.value.forEach(l=>{l.key!="index"&&l.key!="operate"&&l.type!=="selection"&&(s[l.key]=typeof l.title=="string"?l.title:l.title().children[0])});const e=[];m.value.forEach(l=>{if(f.value.includes(l.id)){const c=JSON.parse(JSON.stringify(s));for(const u in c)l.hasOwnProperty(u)?c[u]=l[u]:c[u]="";e.push(c)}}),Le(e,s,"数据统计")},Q={近七天:[Date.now()-864e5*7,Date.now()],近一月:[Date.now()-864e5*30,Date.now()],近三月:[Date.now()-864e5*90,Date.now()]},C=_(!1),L=_(new Date().getTime()),O=_(0),X=()=>{$(),C.value=!0},Z=(s,e)=>{$()},W=()=>{C.value=!1},k=_("0"),Y=s=>{k.value=s,s=="0"?y():U()},ee=(s,e)=>{const l=new Date(s).getTime(),u=(new Date(e).getTime()-l)/(1e3*60*60*24);return Math.abs(u)},R=_([]),U=async()=>{const{data:s,error:e}=await A({startTime:p.startTime,endTime:p.endTime,page:1,limit:Math.floor(ee(p.startTime,p.endTime)+1)});R.value=JSON.parse(JSON.stringify(s)).list.sort((l,c)=>new Date(l.dbtime).getTime()-new Date(c.dbtime).getTime())},$=async()=>{const{data:s,error:e}=await Se({date:x(3,L.value)});e||(typeof s=="number"?O.value=s:O.value="")},S=_(),te=async()=>{const{data:s,error:e}=await Ne();S.value=s};return(s,e)=>{const l=H,c=Ue,u=Re,ae=ve,ne=fe,se=$e,oe=ke,ie=_e,le=pe,B=xe,re=be,ce=H,de=De,me=Te,ue=Ce;return N(),F("div",Ie,[t(ue,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t(oe,{ref:"formRef",model:o(p),"label-placement":"left","show-feedback":!1},{default:a(()=>[t(se,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:a(()=>[t(c,{span:"24 s:12 m:12 l:8",label:"起止时间",path:"startTime"},{default:a(()=>[t(l,{value:i.value,"onUpdate:value":e[0]||(e[0]=r=>i.value=r),type:"daterange","value-format":"yyyy-MM-dd","onUpdate:formattedValue":v,"default-time":["00:00:00","23:59:59"],shortcuts:Q},null,8,["value"])]),_:1}),t(c,{span:"24 s:12 m:12 l:5",label:"",path:"startTime"},{default:a(()=>[t(ae,{value:k.value,"onUpdate:value":[e[1]||(e[1]=r=>k.value=r),Y],class:"ml-20px"},{default:a(()=>[t(u,{value:"0",label:"表格"}),t(u,{value:"1",label:"图表"})]),_:1},8,["value"]),t(o(b),{type:"primary",ghost:"",onClick:o(n),class:"ml-20px"},{icon:a(()=>[t(ne,{class:we(["text-icon",{"animate-spin":o(w)}])},null,8,["class"])]),default:a(()=>[D(" "+g(o(I)("common.search")),1)]),_:1},8,["onClick"])]),_:1}),t(c,{span:"24 s:12  m:20 l:10",label:"",path:"startTime"},{default:a(()=>[t(o(b),{type:"primary",ghost:"",onClick:X,class:"ml-20px"},{default:a(()=>[D(g("月均方根误差"))]),_:1}),t(o(b),{type:"primary",ghost:"",onClick:te,class:"ml-20px"},{default:a(()=>[D(" 查询日照时数平均值 ")]),_:1}),V("span",Ve,g(S.value&&S.value>0?"日照时数平均值为："+S.value:""),1)]),_:1})]),_:1})]),_:1},8,["model"])]),"header-extra":a(()=>[t(B,{justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[t(o(b),{onClick:q,size:"small",disabled:o(f).length==0},{icon:a(()=>[t(ie,{class:"text-icon"})]),default:a(()=>[D(" "+g(o(I)("common.export")),1)]),_:1},8,["disabled"]),t(le,{columns:o(h),"onUpdate:columns":e[2]||(e[2]=r=>j(h)?h.value=r:null)},null,8,["columns"])]),_:1})]),default:a(()=>[k.value=="0"?(N(),E(re,{key:0,"checked-row-keys":o(f),"onUpdate:checkedRowKeys":e[3]||(e[3]=r=>j(f)?f.value=r:null),columns:o(d),data:o(m),size:"small",loading:o(w),remote:"","row-key":r=>r.id,pagination:o(m).length?o(M):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])):(N(),E(Ge,{key:1,data:R.value},null,8,["data"])),t(me,{show:C.value,"onUpdate:show":e[5]||(e[5]=r=>C.value=r),preset:"card",class:"w-320px"},{footer:a(()=>[t(B,{justify:"end"},{default:a(()=>[t(o(b),{size:"small",class:"mt-16px",onClick:W},{default:a(()=>[D(g("关闭"))]),_:1})]),_:1})]),default:a(()=>[t(de,{label:"日期","label-placement":"left"},{default:a(()=>[t(ce,{value:L.value,"onUpdate:value":[e[4]||(e[4]=r=>L.value=r),Z],type:"month",clearable:""},null,8,["value"])]),_:1}),V("h2",null,"月均方根误差："+g(O.value),1)]),_:1},8,["show"])]),_:1})])}}}),tt=K(je,[["__scopeId","data-v-2542c8b0"]]);export{tt as default};
