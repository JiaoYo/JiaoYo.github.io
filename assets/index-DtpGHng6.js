import{_ as ee}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CaE2L_JR.js";import{_ as te}from"./round-delete-BSiw0kCc.js";import{_ as ae}from"./round-add-BPgRFa0m.js";import{d as H,n as G,p as ne,r as oe,aV as $,q as le,a7 as K,j as se,aq as ie,b as re,$ as m,o as j,c as F,w as t,g as e,h,t as P,i as l,f as de,ev as me,ew as ue,I as pe,K as ce,L as I,M as _e,B as w,al as fe,ex as ge,z as C,y as q,ey as E,e as ve,ab as J,am as R,an as he,a2 as be}from"./index-ByQsQpYG.js";import{u as ye,a as we}from"./table-CQrIFVLV.js";import{_ as ke}from"./FormItemGridItem-DGZImIns.js";import{_ as xe}from"./Cascader-BvJpC79K.js";import{_ as Ne}from"./DatePicker-DP7ZHnBh.js";import{_ as De,a as Se}from"./RadioGroup-DngHp1Rz.js";import{_ as Ce}from"./Grid-B95GY2KH.js";import{N as Q}from"./Popconfirm-BA4IjE_D.js";import{_ as $e}from"./DataTable-BmHddFa8.js";import"./TimePicker-DZc2cvhP.js";import"./Forward-L7FBmiBZ.js";const je=de("span",null,"匹配前缀",-1),Pe=H({__name:"weather_model",props:G({operateType:{},rowData:{},Pagination:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:G(["submitted"],["update:visible"]),setup(g,{emit:T}){const _=ne(g,"visible"),k=T,u=g,a=oe(b());function b(){return{sname:"",model:"",manu:"",dbtime:$(0,new Date),isupload:0,devid:void 0,stortime:0,pre:0,prename:`气象站_QX${u.Pagination.itemCount+1}`}}function U(){Object.assign(a,b()),u.operateType==="edit"&&u.rowData&&(Object.assign(a,u.rowData),a.dbtime=$(0,a.dbtime))}const{formRef:W,validate:y,restoreValidation:z}=le();K(()=>u.rowData,()=>{U()}),K(_,()=>{_.value&&(M(),U(),z())});const x=se(),M=async()=>{const{data:d,error:o}=await ie({type:0});function p(n){return n.map(s=>{var r;return{label:s.chlName,value:s.chlName,children:(r=s.devicePojoList)!=null&&r.length?s.devicePojoList.map(v=>({label:v.devName,value:v.id})):[]}})}x.value=p(d)},N=()=>{_.value=!1},f=async()=>{var o;await y();const d=JSON.parse(JSON.stringify(a));if(d.dbtime=$(1,d.dbtime),d.isbind==0&&(d.devid=null),u.operateType==="add"){const{data:p,error:n}=await me([d]);if(n)return}else{const{data:p,error:n}=await ue([d]);if(n)return}(o=window.$message)==null||o.success(u.operateType==="add"?"添加成功":"修改成功"),N(),k("submitted")},A={sname:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},devid:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]}},O=re(()=>({add:m("common.add"),edit:m("common.edit")})[u.operateType]);return(d,o)=>{const p=pe,n=ke,s=xe,r=ce,v=Ne,D=De,B=I,V=Se,L=Ce,S=_e,c=w,Y=I,Z=fe;return j(),F(Z,{show:_.value,"onUpdate:show":o[8]||(o[8]=i=>_.value=i),title:O.value,preset:"card",class:"w-50%"},{footer:t(()=>[e(Y,{size:16,justify:"center"},{default:t(()=>[e(c,{onClick:N,class:"w-100px"},{default:t(()=>[h(P(l(m)("common.cancel")),1)]),_:1}),e(c,{type:"primary",class:"w-100px",onClick:f},{default:t(()=>[h(P(l(m)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(S,{ref_key:"formRef",ref:W,model:a,rules:A,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:t(()=>[e(L,{responsive:"screen","item-responsive":""},{default:t(()=>[e(n,{span:"24 m:12",label:"名称",path:"sname"},{default:t(()=>[e(p,{clearable:"",value:a.sname,"onUpdate:value":o[0]||(o[0]=i=>a.sname=i),placeholder:"请输入",maxlength:"64"},null,8,["value"])]),_:1}),e(n,{span:"24 m:12",label:"型号",path:"model"},{default:t(()=>[e(p,{clearable:"",value:a.model,"onUpdate:value":o[1]||(o[1]=i=>a.model=i),placeholder:"请输入",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1}),e(n,{span:"24 m:12",label:"绑定设备",path:"devid"},{default:t(()=>[e(s,{value:a.devid,"onUpdate:value":o[2]||(o[2]=i=>a.devid=i),placeholder:"请选择协议名称","expand-trigger":"click",options:x.value,"check-strategy":"child","show-path":!1},null,8,["value","options"])]),_:1}),e(n,{span:"24 m:12"},{label:t(()=>[e(r,{checked:a.pre,"onUpdate:checked":o[3]||(o[3]=i=>a.pre=i),"checked-value":0,"unchecked-value":1,class:"mr-5px"},null,8,["checked"]),je]),default:t(()=>[e(p,{clearable:"",value:a.prename,"onUpdate:value":o[4]||(o[4]=i=>a.prename=i),disabled:a.pre==1,placeholder:"请输入匹配前缀"},null,8,["value","disabled"])]),_:1}),e(n,{span:"24 m:12",label:"生产商",path:"manu"},{default:t(()=>[e(p,{clearable:"",value:a.manu,"onUpdate:value":o[5]||(o[5]=i=>a.manu=i),placeholder:"请输入",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1}),e(n,{span:"24 m:12",label:"安装时间",path:"dbtime"},{default:t(()=>[e(v,{"formatted-value":a.dbtime,"onUpdate:formattedValue":o[6]||(o[6]=i=>a.dbtime=i),"value-format":"yyyy-MM-dd",type:"date",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),e(n,{span:"24 m:12",label:"是否上报",path:"isupload"},{default:t(()=>[e(V,{value:a.isupload,"onUpdate:value":o[7]||(o[7]=i=>a.isupload=i),name:"radiogroup"},{default:t(()=>[e(B,null,{default:t(()=>[e(D,{label:l(m)("common.yesOrNo.yes"),value:0},null,8,["label"]),e(D,{label:l(m)("common.yesOrNo.no"),value:1},null,8,["label"])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Te={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function X(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!he(g)}const Ke=H({name:"stationmanagement_weatherstationsetup",__name:"index",setup(g){const{columns:T,columnChecks:_,data:k,getData:u,loading:a,mobilePagination:b,searchParams:U,resetSearchParams:W}=ye({apiFn:ge,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"sname",title:"名称",align:"center",width:140},{key:"model",title:"型号",align:"center",width:100},{key:"devName",title:"设备名称",align:"center",width:100},{key:"manu",title:"生产商",align:"center",width:140},{key:"dbtime",title:"安装时间",align:"center",width:140,render:n=>e("span",null,[$(0,n.dbtime)])},{key:"isupload",title:"是否上传",align:"center",width:100,render:n=>e("span",null,[n.isupload==0?"是":"否"])},{key:"operate",title:m("common.operate"),align:"center",width:200,fixed:"right",render:n=>{let s;return e("div",{class:"flex-center gap-8px"},[C(e(w,{type:"primary",ghost:!0,size:"small",onClick:()=>p(n.id)},X(s=m("common.edit"))?s:{default:()=>[s]}),[[q("no-auth"),"weatherStation:update"]]),C(e(Q,{onPositiveClick:()=>o(n.id)},{default:()=>m("common.confirmDelete"),trigger:()=>{let r;return e(w,{type:"error",ghost:!0,size:"small"},X(r=m("common.delete"))?r:{default:()=>[r]})}}),[[q("no-auth"),"weatherStation:delete"]])])}}]}),{drawerVisible:y,operateType:z,editingData:x,handleAdd:M,handleEdit:N,checkedRowKeys:f,onBatchDeleted:A,onDeleted:O}=we(k,u),d=async()=>{const n=f.value.join(","),{data:s,error:r}=await E({ids:n});r||(f.value=[])},o=async n=>{const{data:s,error:r}=await E({ids:n});r||O()},p=n=>{N(n)};return(n,s)=>{const r=I,v=ae,D=te,B=ee,V=$e,L=be,S=q("no-auth");return j(),ve("div",Te,[e(L,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(r,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[h(" 气象站设置 ")]),_:1})]),"header-extra":t(()=>[e(r,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[C((j(),F(l(w),{onClick:l(M),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(v,{class:J(["text-icon",{"animate-spin":l(a)}])},null,8,["class"])]),default:t(()=>[h(" "+P(l(m)("common.add")),1)]),_:1},8,["onClick"])),[[S,"weatherStation:insert"]]),C((j(),F(l(Q),{onPositiveClick:d},{trigger:t(()=>[e(l(w),{size:"small",ghost:"",type:"error",disabled:l(f).length==0},{icon:t(()=>[e(D,{class:J(["text-icon",{"animate-spin":l(a)}])},null,8,["class"])]),default:t(()=>[h(" "+P(l(m)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:t(()=>[h(" 确认删除选中的项吗？ ")]),_:1})),[[S,"weatherStation:delete"]]),e(B,{columns:l(_),"onUpdate:columns":s[0]||(s[0]=c=>R(_)?_.value=c:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(V,{"checked-row-keys":l(f),"onUpdate:checkedRowKeys":s[1]||(s[1]=c=>R(f)?f.value=c:null),columns:l(T),data:l(k),size:"small",loading:l(a),remote:"","row-key":c=>c.id,pagination:l(b),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Pe,{visible:l(y),"onUpdate:visible":s[2]||(s[2]=c=>R(y)?y.value=c:null),onSubmitted:l(u),"operate-type":l(z),"row-data":l(x),Pagination:l(b)},null,8,["visible","onSubmitted","operate-type","row-data","Pagination"])]),_:1})])}}});export{Ke as default};
