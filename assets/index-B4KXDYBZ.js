import{_ as se}from"./refresh-C8V4ZZfl.js";import{l as ie}from"./lodash-DCZj5awB.js";import{d as O,q as re,Z as W,j as S,v as ce,s as ue,K as I,o as b,c as w,w as s,g as t,L as M,i as c,$ as m,U as B,h as x,t as P,f as pe,e as q,ai as me,N as de,M as fe,av as _e,A as ge,X as ve,B as z,E as j,D as he,a9 as X,r as H,am as E,b8 as ye,ad as be,ay as xe}from"./index-CsSYpLym.js";import{f as ke,a as Te,b as Ce,c as Se}from"./alarm-BHYtppdH.js";import{_ as De,a as Ne}from"./arrow-open-up-BdC2WXAm.js";import{_ as we}from"./round-search-Dtp7E9Hm.js";import{_ as ze}from"./round-refresh-DOrEb6Qo.js";import{u as F}from"./usePageData-BoMczvDN.js";import{C as Ae,a as $e}from"./common-u7lS4M1i.js";import{f as Le}from"./audit-events-iEZS8xs4.js";import{a as Re,T as Ue}from"./basicconf-CaRhvIk2.js";import{_ as Ie}from"./FormItemGridItem-Bdm6h163.js";import{_ as Me}from"./DatePicker-DqKu08f5.js";import{_ as Pe}from"./Grid-C4cZ6WxQ.js";import{_ as G}from"./Popconfirm-DEvmG-Lq.js";import{_ as Ve}from"./DataTable-aZh4mZz2.js";import"./TimePicker-DZnukPB5.js";import"./defineProperty-CqYQ46Aw.js";import"./Forward-C9tKHKQU.js";const Be=O({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:re(["reset","search"],["update:model"]),setup(h,{emit:A}){const u=A,$=W(),i=S(!1),{formRef:_,restoreValidation:y}=ce(),l=ue(h,"model"),{pageData:k,getData:g,nextPage:D}=F(Le),L=async r=>{const a=r.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&k.data.length<k.total&&D()};g();const{pageData:T,getData:v,nextPage:R}=F(ke),U=async r=>{const a=r.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&T.data.length<T.total&&R()};v();async function N(r,a){r?(l.value.startTime=r[0],l.value.endTime=r[1]):(l.value.startTime=null,l.value.endTime=null),u("search")}function e(){l.value.fuzzy=void 0,u("search")}async function n(){await y(),l.value.timeRange=null,l.value.atype=null,l.value.alevel=null,l.value.alatype=null,l.value.apolicy=null,l.value.startTime=null,l.value.endTime=null,_e(()=>{u("search")})}async function o(){u("search")}return(r,a)=>{const C=ge,d=Ie,f=ve,Z=ze,V=z,J=we,Q=De,Y=Ne,ee=j,ae=Me,te=Pe,le=he,ne=X,oe=I("no-space");return b(),w(ne,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[t(le,{ref_key:"formRef",ref:_,model:l.value,"label-placement":"left","label-width":c($).locale=="en-US"?120:80,"show-feedback":!1,onKeyup:fe(o,["enter"])},{default:s(()=>[t(te,{responsive:"screen","item-responsive":""},{default:s(()=>[t(d,{span:"24 s:12 m:6",label:"审计名称",path:"fuzzy",class:"pr-24px"},{default:s(()=>[M(t(C,{autofocus:"",value:l.value.fuzzy,"onUpdate:value":a[0]||(a[0]=p=>l.value.fuzzy=p),placeholder:"请输入审计名称",clearable:"",onClear:e},null,8,["value"]),[[oe]])]),_:1}),t(d,{span:"24 s:12 m:6",label:c(m)("page.manage.alarm.level"),path:"alevel",class:"pr-24px"},{default:s(()=>[t(f,{filterable:"",clearable:"",placeholder:c(m)("page.manage.alarm.form.level"),value:l.value.alevel,"onUpdate:value":[a[1]||(a[1]=p=>l.value.alevel=p),o],options:c(B)(c(Re))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),t(d,{span:"24 s:12 m:6",label:"告警状态",path:"alatype",class:"pr-24px"},{default:s(()=>[t(f,{filterable:"",clearable:"",placeholder:c(m)("page.manage.alarm.form.status"),value:l.value.alatype,"onUpdate:value":[a[2]||(a[2]=p=>l.value.alatype=p),o],options:c(B)(c(Ae))},null,8,["placeholder","value","options"])]),_:1}),t(d,{span:"24 s:12 m:6",class:"pr-24px"},{default:s(()=>[t(ee,{class:"w-full flex items-center"},{default:s(()=>[t(V,{onClick:n},{icon:s(()=>[t(Z,{class:"text-icon"})]),default:s(()=>[x(" "+P(c(m)("common.reset")),1)]),_:1}),t(V,{type:"primary",ghost:"",onClick:o},{icon:s(()=>[t(J,{class:"text-icon"})]),default:s(()=>[x(" "+P(c(m)("common.search")),1)]),_:1}),pe("div",{class:"cursor-pointer",title:"精准查询",onClick:a[3]||(a[3]=p=>i.value=!i.value)},[i.value?(b(),w(Q,{key:0,class:"text-icon"})):(b(),w(Y,{key:1,class:"text-icon"}))])]),_:1})]),_:1}),i.value?(b(),q(me,{key:0},[t(d,{span:"24 s:12 m:6",label:"审计类型",path:"atype",class:"pr-24px mt-20px"},{default:s(()=>[t(f,{value:l.value.atype,"onUpdate:value":[a[4]||(a[4]=p=>l.value.atype=p),o],placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:c(k).data,"reset-menu-on-options-change":!1,onScroll:L},null,8,["value","options"])]),_:1}),t(d,{span:"24 s:12 m:6",label:"告警策略",path:"apolicy",class:"pr-24px mt-20px"},{default:s(()=>[t(f,{value:l.value.apolicy,"onUpdate:value":[a[5]||(a[5]=p=>l.value.apolicy=p),o],placeholder:"请选择告警策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:c(T).data,"reset-menu-on-options-change":!1,onScroll:U},null,8,["value","options"])]),_:1}),t(d,{span:"24 s:24 m:8",label:"时间",path:"timeRange",class:"pr-24px mt-20px"},{default:s(()=>[t(ae,{clearable:"",value:l.value.timeRange,"onUpdate:value":a[6]||(a[6]=p=>l.value.timeRange=p),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":N},null,8,["value"])]),_:1})],64)):de("",!0)]),_:1})]),_:1},8,["model","label-width"])]),_:1})}}}),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function K(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!be(h)}const Ee=O({name:"platformalarm_alarm",__name:"index",setup(h){const A=W(),u=H({limit:20,alatype:void 0,aname:void 0,pageId:void 0,alevel:void 0,atype:void 0,apolicy:void 0,startTime:void 0,endTime:void 0,_t:new Date().getTime()}),$=[{type:"selection",align:"center",width:48,fixed:"left"},{key:"aname",title:"审计名称",align:"center",minWidth:120,ellipsis:!0},{key:"alevel",title:"事件级别",align:"center",width:100,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=0);const n={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},o=m(Ue[e.alevel]);let r={color:n[e.alevel],textColor:"#ffffff",borderColor:n[e.alevel]};return t(E,{size:"small",color:r},K(o)?o:{default:()=>[o]})}},{key:"pname",title:"审计类型",align:"center",minWidth:120},{key:"pname1",title:"告警策略",align:"center",minWidth:120},{key:"etol",title:"事件总数",align:"center",width:120},{key:"grtime",title:"产生时间",align:"center",width:160},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"alatype",title:m("page.manage.alarm.status"),align:"center",minWidth:120,render:e=>{e.alatype!==1&&(e.alatype=0);const n={0:"error",1:"success"},o=m($e[e==null?void 0:e.alatype]);return t(E,{size:"small",type:n[e==null?void 0:e.alatype]},K(o)?o:{default:()=>[o]})}},{key:"operate",title:m("common.operate"),align:"center",width:130,fixed:"right",render:e=>e.alatype===0&&t("div",{class:"flex-center gap-8px"},[t(G,{onPositiveClick:()=>N([e.id])},{default:()=>"确定要确认改数据吗？",trigger:()=>M(t(z,{type:"error",ghost:!0,size:"small"},{default:()=>[x("确认")]}),[[I("no-auth"),"audit.alarm.update"]])})])}],i=S([]),_=S(!1),y=async(e=!1)=>{if(!_.value)_.value=!0;else return;_.value=!0;const{data:n,error:o}=await Ce(u);o||(e?i.value=[...i.value,...n]:i.value=n,_.value=!1)};y();const l=S(!0),k=()=>{i.value=[],u.pageId=void 0,(n=>Object.keys(n).filter(a=>a!=="limit"&&a!=="_t").some(a=>n[a]!==void 0&&n[a]!==""&&n[a]!==null))(u)?l.value=!1:(l.value=!0,D()),y()},g=H({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:n,page:o,pageSize:r,pageCount:a,itemCount:C}){return`已加载${i.value.length}条`+(i.value.length?l.value?` 共计 ${i.value.length>0?C??0:0} 条`:i.value.length>=u.limit?"  预计还有更多":"":"")}});async function D(){const{data:e,error:n}=await Se();n||(g.pageCount=20,g.total=Number(e),g.itemCount=Number(e))}D();function L(e){var n;e.target.scrollTop+e.target.offsetHeight==e.target.scrollHeight&&g.total>((n=i.value)==null?void 0:n.length)&&T()}const T=ie.debounce(()=>{var e;((e=i.value)==null?void 0:e.length)<g.total&&(u.pageId=i.value[i.value.length-1].id,y(!0))},300),v=S([]),R=e=>{v.value=e},U=()=>{N(v.value),v.value=[]},N=async e=>{var n,o;await Te(e),i.value.forEach(r=>{e.includes(r.id)&&(r.alatype=1)}),(n=window.$message)==null||n.destroyAll(),(o=window.$message)==null||o.success("确认成功")};return(e,n)=>{const o=se,r=j,a=Ve,C=X,d=I("no-auth");return b(),q("div",He,[t(Be,{model:u,"onUpdate:model":n[0]||(n[0]=f=>u=f),onSearch:k},null,8,["model"]),t(C,{title:"审计告警",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[t(r,null,{default:s(()=>[t(c(G),{onPositiveClick:U},{trigger:s(()=>[M((b(),w(c(z),{size:"small",ghost:"",type:"primary",disabled:v.value.length==0},{default:s(()=>[x(" 批量确认 ")]),_:1},8,["disabled"])),[[d,"audit.alarm.update"]])]),default:s(()=>[x(" 确定要确认选中的数据吗？ ")]),_:1}),t(c(z),{size:"small",onClick:n[1]||(n[1]=f=>y())},{icon:s(()=>[t(o,{class:ye(["text-icon",{"animate-spin":_.value}])},null,8,["class"])]),default:s(()=>[x(" "+P(c(m)("common.refresh")),1)]),_:1})]),_:1})]),default:s(()=>[t(a,{columns:$,"checked-row-keys":v.value,data:i.value,onUpdateCheckedRowKeys:R,size:"small","flex-height":!c(A).isMobile,"scroll-x":702,loading:_.value,remote:"","row-key":f=>f.id,pagination:g,class:"sm:h-full",onScroll:L},null,8,["checked-row-keys","data","flex-height","loading","row-key","pagination"])]),_:1})])}}}),ia=xe(Ee,[["__scopeId","data-v-6b7ff2b9"]]);export{ia as default};
