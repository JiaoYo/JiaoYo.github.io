import{d as Ce,q as be,dw as ge,a5 as Te,s as Le,j as x,y as he,o as Pe,c as we,w as s,f as k,g as n,aa as Ne,i as F,aY as j,S as Se,F as Ae,T as ke,U as $e,V as De,e as Ie,h as ye,aP as S,$ as Re,ar as Ee,at as Fe,a2 as Ue,C as Be,B as Me,D as Ve,ad as Ge}from"./index-ByfxsQvj.js";import{n as He,o as Ke,a as Oe}from"./reportForm-CQTYrTfT.js";import{f as Qe}from"./asset-BfC2BO85.js";import{u as We}from"./usePageData-lPm5H_26.js";import{_ as qe,a as ze,b as Je,c as Ye}from"./file-pdf-CqiTXX5q.js";import{_ as Xe}from"./DatePicker-ChOIwL9T.js";import{a as Ze,_ as ea}from"./Grid-B9K_tFX2.js";import"./echarts.vue_vue_type_script_setup_true_lang-CpycbPse.js";import"./index-BS8KoN7o.js";import"./installCanvasRenderer-iCPGNWhM.js";import"./TimePicker-Bw31iYnN.js";import"./defineProperty-D9xlJP3p.js";const aa=y=>(ke("data-v-d674d4e5"),y=y(),$e(),y),ta=aa(()=>k("span",{class:"mr-20px"},"报表预览",-1)),oa={title:"导出PDF"},na={title:"导出Word"},la={title:"导出Excel"},ua=Ce({name:"reportPreview",__name:"reportPreview",props:be({data:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(y){ge(p=>({"03cdc49e":F($)}));const v=Te(),L=y,m=Le(y,"visible"),r=x(""),C=()=>{var p,l;r.value=((l=(p=L.data)==null?void 0:p.find(P=>P.type=="title"))==null?void 0:l.value)+"报表"+j(1,new Date)};he(m,()=>{m.value&&C()});const b=x(),$=v.themeScheme=="dark"?"#001428":"#fff";return(p,l)=>{const P=qe,D=ze,I=Je,h=Ye,R=Se,E=Ae;return Pe(),we(E,{show:m.value,"onUpdate:show":l[3]||(l[3]=g=>m.value=g),preset:"card",class:"w-1000px reportPreview",style:Ne({"background-color":F(v).themeScheme=="dark"?"#001428":"#fff"})},{header:s(()=>[ta,k("span",oa,[n(P,{class:"text-32px c-#d63031 cursor-pointer",onClick:l[0]||(l[0]=g=>b.value.toPdf(r.value))})]),k("span",na,[n(D,{class:"text-32px c-#1e90ff cursor-pointer",onClick:l[1]||(l[1]=g=>b.value.toWord(r.value))})]),k("span",la,[n(I,{class:"text-32px c-#15703d cursor-pointer",onClick:l[2]||(l[2]=g=>b.value.toExcel(r.value))})])]),default:s(()=>[n(R,{class:"max-h-600px"},{default:s(()=>[n(h,{ref_key:"filePreviewExportRef",ref:b,width:800,data:L.data},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),sa=De(ua,[["__scopeId","data-v-d674d4e5"]]),ja=Ce({name:"reportmanagement_reporttemplate",__name:"index",setup(y){const v=x([]),L=async d=>{const{data:o,error:t}=await Oe({rtype:d});t||(o.forEach(e=>{e.rtext=JSON.parse(e.rtext)}),console.log(o,"dataxxxxxxxxxxxxxxx"),v.value=o[0].rtext)},m=x(!1),r=x({atypes:[],time:void 0,startTime:void 0,endTime:void 0}),C=x([]),b=async()=>{var t;C.value=[],await L(0);const{data:d,error:o}=await He({startTime:r.value.startTime,endTime:r.value.endTime,atypes:(t=r.value.atypes)==null?void 0:t.join(",")});o||(m.value=!0,v.value.forEach(e=>{e.type=="chart"&&e.dataName=="assetType"&&(e.value.data.series[0].data=Object.entries(d.assetType).map(([_,f],T)=>({value:f,name:_}))),e.type=="table"&&e.dataName=="baseInfo"&&(e.value.body=d.baseInfo.map(_=>e.value.tableHeaderValue.map(f=>_[f])))}),C.value=v.value)};async function $(d,o){r.value.startTime=j(0,o[0]),r.value.endTime=j(0,o[1])}const p=x({time:[new Date().getTime()-864e5*30,new Date().getTime()],startTime:j(0,new Date().getTime()-864e5*30),endTime:j(0,new Date().getTime())}),l=["一般","低级","中级","高级","严重"],P=["#99CC00","#1e90ff","#FF9900","#FF6666","#CC0033"],D=async()=>{C.value=[],await L(1);const{data:d,error:o}=await Ke({startTime:p.value.startTime,endTime:p.value.endTime});if(!o){m.value=!0;const t={e1:"7",e2:"0",e3:"0",e4:"0",e5:"0",time:null,secureCountPojo:{e1:"0",e2:"0",e3:"0",e4:"0",e5:"7",typeCountPojoList:[{etype:180,tcount:"7",tname:"系统状态"},{etype:180,tcount:"10",tname:"系统xx"}],dayCountPojoList:[{id:null,date:"2025-03-25 00:00:00",dateStr:null,dailycount:"7",lsid:null},{id:null,date:"2025-03-26 00:00:00",dateStr:null,dailycount:"10",lsid:null}]},auditCountPojo:{e1:"6",e2:"7",e3:"5",e4:"3",e5:"7",typeCountPojoList:[{etype:180,tcount:"8",tname:"系统状态1"}],dayCountPojoList:[{id:null,date:"2025-03-25 00:00:00",dateStr:null,dailycount:"7",lsid:null},{id:null,date:"2025-03-28 00:00:00",dateStr:null,dailycount:"6",lsid:null}]},alarmCountPojo:{e1:null,e2:null,e3:null,e4:null,e5:null,typeCountPojoList:[],dayCountPojoList:[]}};v.value.forEach(e=>{var _,f,T,w,N,A,c,U,B,M,V,G,H,K,O,Q,W,q,z,J,Y,X,Z,ee,ae,te,oe,ne,le,ue,se,re,de,ie,pe,ce,me,_e,fe;e.type=="chart"&&(e.dataName=="secureCountPojo"&&(e.value.data.series[0].data=l.map((a,i)=>{const u=`e${i+1}`;return{value:t.secureCountPojo[u]==0||t.secureCountPojo[u]==null?null:t.secureCountPojo[u],name:a,itemStyle:{color:P[i]}}})),e.dataName=="secureCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data?e.value.data.xAxis.data=(w=(T=t.alarmCountPojo)==null?void 0:T.typeCountPojoList)==null?void 0:w.map(a=>a.tname):e.value.data.yAxis.data=(f=(_=t.alarmCountPojo)==null?void 0:_.typeCountPojoList)==null?void 0:f.map(a=>a.tname),e.value.data.series[0].data=(A=(N=t.secureCountPojo)==null?void 0:N.typeCountPojoList)==null?void 0:A.map(a=>a.tcount)),e.dataName=="secureCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(U=(c=t.secureCountPojo)==null?void 0:c.dayCountPojoList)==null?void 0:U.map(a=>a.date.substring(0,10)),e.value.data.series[0].data=(M=(B=t.secureCountPojo)==null?void 0:B.dayCountPojoList)==null?void 0:M.map(a=>a.dailycount)),e.dataName=="auditCountPojo"&&(e.value.data.series[0].data=l.map((a,i)=>{const u=`e${i+1}`;return{value:t.auditCountPojo[u]==0||t.auditCountPojo[u]==null?null:t.auditCountPojo[u],name:a,itemStyle:{color:P[i]}}})),e.dataName=="auditCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data?e.value.data.xAxis.data=(K=(H=t.alarmCountPojo)==null?void 0:H.typeCountPojoList)==null?void 0:K.map(a=>a.tname):e.value.data.yAxis.data=(G=(V=t.alarmCountPojo)==null?void 0:V.typeCountPojoList)==null?void 0:G.map(a=>a.tname),e.value.data.series[0].data=(Q=(O=t.auditCountPojo)==null?void 0:O.typeCountPojoList)==null?void 0:Q.map(a=>a.tcount)),e.dataName=="auditCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(q=(W=t.auditCountPojo)==null?void 0:W.dayCountPojoList)==null?void 0:q.map(a=>a.date.substring(0,10)),e.value.data.series[0].data=(J=(z=t.auditCountPojo)==null?void 0:z.dayCountPojoList)==null?void 0:J.map(a=>a.dailycount)),e.dataName=="alarmCountPojo"&&(e.value.data.series[0].data=l.map((a,i)=>{const u=`e${i+1}`;return{value:t.alarmCountPojo[u]==0||t.alarmCountPojo[u]==null?null:t.alarmCountPojo[u],name:a,itemStyle:{color:P[i]}}})),e.dataName=="alarmCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data?e.value.data.xAxis.data=(ee=(Z=t.alarmCountPojo)==null?void 0:Z.typeCountPojoList)==null?void 0:ee.map(a=>a.tname):e.value.data.yAxis.data=(X=(Y=t.alarmCountPojo)==null?void 0:Y.typeCountPojoList)==null?void 0:X.map(a=>a.tname),e.value.data.series[0].data=(te=(ae=t.alarmCountPojo)==null?void 0:ae.typeCountPojoList)==null?void 0:te.map(a=>a.tcount)),e.dataName=="alarmCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(ne=(oe=t.alarmCountPojo)==null?void 0:oe.dayCountPojoList)==null?void 0:ne.map(a=>a.date.substring(0,10)),e.value.data.series[0].data=(ue=(le=t.alarmCountPojo)==null?void 0:le.dayCountPojoList)==null?void 0:ue.map(a=>a.dailycount))),e.type=="table"&&(e.dataName==""&&(e.value.body=[["安全事件",t.e1],["审计事件",t.e3],["告警事件",t.e4]]),e.dataName=="secureCountPojo"&&(e.value.body=l.map((a,i)=>{const u=t.secureCountPojo[`e${i+1}`];return[a,u]})),e.dataName=="secureCountPojo_typeCountPojoList"&&(e.value.body=(re=(se=t.secureCountPojo)==null?void 0:se.typeCountPojoList)==null?void 0:re.map(a=>[a.tname,a.tcount])),e.dataName=="secureCountPojo_dayCountPojoList"&&(e.value.body=(de=t.secureCountPojo.dayCountPojoList)==null?void 0:de.map(a=>[a.date.substring(0,10),a.dailycount])),e.dataName=="auditCountPojo"&&(e.value.body=l.map((a,i)=>{const u=t.auditCountPojo[`e${i+1}`];return[a,u]})),e.dataName=="auditCountPojo_typeCountPojoList"&&(e.value.body=(pe=(ie=t.auditCountPojo)==null?void 0:ie.typeCountPojoList)==null?void 0:pe.map(a=>[a.tname,a.tcount])),e.dataName=="auditCountPojo_dayCountPojoList"&&(e.value.body=(ce=t.auditCountPojo.dayCountPojoList)==null?void 0:ce.map(a=>[a.date.substring(0,10),a.dailycount])),e.dataName=="alarmCountPojo"&&(e.value.body=l.map((a,i)=>{const u=t.alarmCountPojo[`e${i+1}`];return[a,u]})),e.dataName=="alarmCountPojo_typeCountPojoList"&&(e.value.body=(_e=(me=t.alarmCountPojo)==null?void 0:me.typeCountPojoList)==null?void 0:_e.map(a=>[a.tname,a.tcount])),e.dataName=="alarmCountPojo_dayCountPojoList"&&(e.value.body=(fe=t.alarmCountPojo.dayCountPojoList)==null?void 0:fe.map(a=>[a.date.substring(0,10),a.dailycount])))}),C.value=v.value}};async function I(d,o){p.value.startTime=o?j(0,o[0]):void 0,p.value.endTime=o?j(0,o[1]):void 0}const{pageData:h,getData:R,nextPage:E}=We(Qe),g=async d=>{const o=d.currentTarget;o.scrollTop+o.offsetHeight>=o.scrollHeight&&h.data.length<h.total&&E()};R();const je=d=>{const o=d.pid;return S("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"}},[S("div",null,[d.aname]),S("span",{depth:3,tag:"div",style:{color:"#999"}},{default:()=>Re(Ee[o])})])},xe=({option:d,handleClose:o})=>S(Fe,{style:{padding:"0 6px 0 4px"},closable:!0,onClose:t=>{t.stopPropagation(),o()}},{default:()=>S("div",{style:{display:"flex",alignItems:"center"}},[d.aname])});return(d,o)=>{const t=Ue,e=Be,_=Xe,f=Me,T=Ve,w=Ge,N=Ze,A=ea;return Pe(),Ie("div",null,[n(A,{"x-gap":"12",cols:2},{default:s(()=>[n(N,null,{default:s(()=>[n(w,{title:"资产信息报表"},{default:s(()=>[n(T,{ref:"formRef",class:"h-200px","label-width":80,"label-placement":"left",model:r.value},{default:s(()=>[n(e,{label:"资产类型",path:"atypes"},{default:s(()=>[n(t,{value:r.value.atypes,"onUpdate:value":o[0]||(o[0]=c=>r.value.atypes=c),placeholder:"请选择资产类型",clearable:"",filterable:"","value-field":"id",multiple:"","label-field":"aname",options:F(h).data,"reset-menu-on-options-change":!1,class:"w-100%","render-label":je,"render-tag":xe,onScroll:g},null,8,["value","options"])]),_:1}),n(e,{label:"查询日期",path:"selectTime"},{default:s(()=>[n(_,{value:r.value.time,"onUpdate:value":o[1]||(o[1]=c=>r.value.time=c),type:"daterange",clearable:"",class:"w-100%","onUpdate:formattedValue":$},null,8,["value"])]),_:1}),n(e,{label:" "},{default:s(()=>[n(f,{"attr-type":"button",onClick:b},{default:s(()=>[ye(" 查询 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),n(N,null,{default:s(()=>[n(w,{title:"综合报表"},{default:s(()=>[n(T,{ref:"formRef",class:"h-200px","label-width":80,"label-placement":"left",model:p.value},{default:s(()=>[n(e,{label:"查询日期",path:"selectTime"},{default:s(()=>[n(_,{value:p.value.time,"onUpdate:value":o[2]||(o[2]=c=>p.value.time=c),type:"daterange",class:"w-100%","onUpdate:formattedValue":I},null,8,["value"])]),_:1}),n(e,{label:""}),n(e,{label:" "},{default:s(()=>[n(f,{"attr-type":"button",onClick:D},{default:s(()=>[ye(" 查询 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),n(sa,{data:C.value,visible:m.value,"onUpdate:visible":o[3]||(o[3]=c=>m.value=c)},null,8,["data","visible"])])}}});export{ja as default};
