import{_ as X}from"./table-header-operation.vue_vue_type_script_setup_true_lang-B9NigriO.js";import{d as K,n as j,s as E,p as G,q as Y,b as Z,$ as a,r as ee,ae as te,D as U,o as P,c as W,w as n,g as t,h as A,t as M,i as e,E as F,J as H,K as ae,ap as oe,O as J,B as O,N as L,af as ne,ag as se,F as le,ad as Q,a3 as ie,aA as re,av as pe,e as ce,ah as I,ai as de,aj as ue}from"./index-Cx7KIf91.js";import{p as me,q as _e,f as fe,r as ye}from"./audit-events-CmKun7TT.js";import{u as ge,a as he}from"./table-CXqkni0e.js";import{_ as ve}from"./round-search-BI_CoZ5E.js";import{_ as be}from"./round-refresh-H8vv-sLt.js";import{_ as we}from"./lodash-DBno-G8B.js";import{_ as De}from"./FormItemGridItem-2AG1jRS6.js";import{_ as ke}from"./Grid-Cu_AT9np.js";import{h as q}from"./permission-BF0KqemL.js";import{_ as Ne}from"./Popconfirm-DfxGPHws.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-C08HzLjh.js";import"./setting-outlined-DxlFErWs.js";import"./export-JteQWZNf.js";import"./refresh-BU9o1foM.js";import"./round-delete-DNE8zcZ3.js";import"./round-plus-DXvvHfJ_.js";import"./Upload-B5KFzgu2.js";import"./Progress-D5UamQxX.js";const xe=K({name:"OperateDrawer",__name:"operate-drawer",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(_,{emit:T}){const p=_,g=T,m=E(_,"visible"),{formRef:c,validate:N,restoreValidation:C}=G(),{defaultRequiredRule:v}=Y(),x=Z(()=>({add:a("page.audit.type.addTitle"),edit:a("page.audit.type.editTitle")})[p.operateType]),o=ee(b());function b(){return{atypename:"",typedesc:"",asort:0,syspara:1}}const R={atypename:v};function z(){Object.assign(o,b()),p.operateType==="edit"&&p.rowData&&Object.assign(o,p.rowData)}function w(){m.value=!1}async function d(){var h,i;if(await N(),p.operateType==="add"){const{data:D,error:u}=await me([{atypename:o.atypename,typedesc:o.typedesc,asort:o.asort,syspara:o.syspara}]);u||((h=window.$message)==null||h.success(a("common.addSuccess")),w(),g("submitted"))}else{const{data:D,error:u}=await _e([{id:p.rowData.id,atypename:o.atypename,typedesc:o.typedesc,asort:o.asort,syspara:o.syspara}]);u||((i=window.$message)==null||i.success(a("common.updateSuccess")),w(),g("submitted"))}}return te(m,()=>{m.value&&(z(),C())}),(h,i)=>{const D=H,u=ae,$=oe,B=J,k=O,l=L,s=ne,r=se,S=U("no-space");return P(),W(r,{show:m.value,"onUpdate:show":i[3]||(i[3]=f=>m.value=f),"display-directive":"show",width:360},{default:n(()=>[t(s,{title:x.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[t(l,{size:16},{default:n(()=>[t(k,{onClick:w},{default:n(()=>[A(M(e(a)("common.cancel")),1)]),_:1}),t(k,{type:"primary",onClick:d},{default:n(()=>[A(M(e(a)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[t(B,{ref_key:"formRef",ref:c,model:o,rules:R},{default:n(()=>[t(u,{label:e(a)("page.audit.type.name"),path:"atypename"},{default:n(()=>[F(t(D,{clearable:"",value:o.atypename,"onUpdate:value":i[0]||(i[0]=f=>o.atypename=f),placeholder:e(a)("page.audit.type.form.name")},null,8,["value","placeholder"]),[[S]])]),_:1},8,["label"]),t(u,{label:e(a)("page.audit.type.describe"),path:"typedesc"},{default:n(()=>[F(t(D,{clearable:"",value:o.typedesc,"onUpdate:value":i[1]||(i[1]=f=>o.typedesc=f),placeholder:e(a)("page.audit.type.form.describe"),type:"textarea"},null,8,["value","placeholder"]),[[S]])]),_:1},8,["label"]),t(u,{label:e(a)("page.audit.type.sort"),path:"asort"},{default:n(()=>[t($,{min:0,value:o.asort,"onUpdate:value":i[2]||(i[2]=f=>o.asort=f),placeholder:e(a)("page.audit.type.form.sort"),style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ze=K({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(_,{emit:T}){const p=T,{formRef:g,restoreValidation:m}=G(),c=E(_,"model");function N(){c.value.fuzzy="",p("search")}async function C(){await m(),p("reset")}async function v(){p("search")}const x=we.debounce(v,1e3,{leading:!0,trailing:!1});return(o,b)=>{const R=H,z=De,w=be,d=O,h=ve,i=L,D=ke,u=J,$=Q,B=U("no-space");return P(),W($,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(u,{ref_key:"formRef",ref:g,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:le(e(x),["enter"])},{default:n(()=>[t(D,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[t(z,{span:"24 s:12 m:8 l:6",label:e(a)("page.audit.type.name"),path:"fuzzy"},{default:n(()=>[F(t(R,{clearable:"",value:c.value.fuzzy,"onUpdate:value":b[0]||(b[0]=k=>c.value.fuzzy=k),placeholder:e(a)("page.audit.type.form.name"),onClear:N},null,8,["value","placeholder"]),[[B]])]),_:1},8,["label"]),t(z,{span:"24 s:12 m:8 l:6"},{default:n(()=>[t(i,{class:"w-full"},{default:n(()=>[t(d,{onClick:C},{icon:n(()=>[t(w,{class:"text-icon"})]),default:n(()=>[A(" "+M(e(a)("common.reset")),1)]),_:1}),t(d,{type:"primary",ghost:"",onClick:e(x)},{icon:n(()=>[t(h,{class:"text-icon"})]),default:n(()=>[A(" "+M(e(a)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Se={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function V(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!de(_)}const He=K({name:"audit_type",__name:"index",setup(_){const T=ie(),{columns:p,columnChecks:g,data:m,getData:c,loading:N,mobilePagination:C,searchParams:v,resetSearchParams:x}=ge({apiFn:fe,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"atypename",title:a("page.audit.type.name"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"typedesc",title:a("page.audit.type.describe"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"asort",title:a("page.audit.type.sort"),align:"center",width:120},{key:"syspara",title:"系统内置",align:"center",width:100,render:l=>{const s={0:"primary",1:"info"},r=a(re[l.syspara]);return t(pe,{size:"small",type:s[l.syspara]},V(r)?r:{default:()=>[r]})}},{key:"operate",title:a("common.operate"),align:"center",width:130,render:l=>{let s;return l.syspara!=0?t("div",{class:"flex-center gap-8px"},[F(t(O,{type:"primary",ghost:!0,size:"small",onClick:()=>B(l.id)},V(s=a("common.edit"))?s:{default:()=>[s]}),[[U("no-auth"),"sys.audit.type.update"]]),t(Ne,{onPositiveClick:()=>$(l.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let r;return F(t(O,{type:"error",ghost:!0,size:"small"},V(r=a("common.delete"))?r:{default:()=>[r]}),[[U("no-auth"),"sys.audit.type.delete"]])}})]):null}}]}),{drawerVisible:o,operateType:b,editingData:R,handleAdd:z,handleEdit:w,checkedRowKeys:d,onBatchDeleted:h,onDeleted:i,closeDrawer:D}=he(m,c);async function u(){console.log(d.value),k(d.value,l=>{h()})}function $(l){console.log(l),k([l],s=>{i()})}function B(l){w(l)}async function k(l,s){const{data:r,error:S}=await ye(l);if(!S)s&&s(r);else return!1}return(l,s)=>{const r=X,S=ue,f=Q;return P(),ce("div",Se,[t(ze,{model:e(v),"onUpdate:model":s[0]||(s[0]=y=>I(v)?v.value=y:null),onReset:e(x),onSearch:e(c)},null,8,["model","onReset","onSearch"]),t(f,{title:e(a)("page.audit.type.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[t(r,{columns:e(g),"onUpdate:columns":s[1]||(s[1]=y=>I(g)?g.value=y:null),"disabled-delete":e(d).length===0,loading:e(N),onAdd:e(z),onDelete:u,onRefresh:e(c),"is-view-delete-button":e(q)("sys.audit.type.delete"),"is-view-add-button":e(q)("sys.audit.type.insert")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-delete-button","is-view-add-button"])]),default:n(()=>[t(S,{"checked-row-keys":e(d),"onUpdate:checkedRowKeys":s[2]||(s[2]=y=>I(d)?d.value=y:null),columns:e(p),data:e(m),size:"small","flex-height":!e(T).isMobile,"scroll-x":962,loading:e(N),remote:"","row-key":y=>y.id,pagination:e(C),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(xe,{visible:e(o),"onUpdate:visible":s[3]||(s[3]=y=>I(o)?o.value=y:null),"operate-type":e(b),"row-data":e(R),onSubmitted:e(c)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{He as default};
