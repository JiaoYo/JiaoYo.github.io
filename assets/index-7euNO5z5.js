import{_ as st}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DT7Xw6BF.js";import{_ as ot}from"./round-delete-f0Ex9oqZ.js";import{_ as ut}from"./round-add-CR1MGL-O.js";import{d as Be,aE as qe,m as Ne,r as rt,H as I,bY as Re,n as Le,a as it,aG as Ee,aC as Oe,c as F,o as g,w as t,f as e,a0 as dt,C as He,s as T,h as u,aD as se,v as V,b as P,g as r,e as w,t as f,aI as pt,B as S,aJ as ct,y as Ae,$ as X,a1 as Me,b4 as ft,aO as pe,ct as mt,cr as gt,cu as Ve,cv as vt,cw as Pe,aQ as yt,cx as Ge,cy as bt,P as Je,O as Ke,A as _t,Z as We,aS as ht,i as kt,q as Z,aT as xe,aH as wt,x as M,aU as Ct,aK as Dt,aM as ie,cz as $e,cA as xt,aY as Tt}from"./index-K-Oe9yen.js";import{u as Ft,a as St}from"./table-BjKQTj5z.js";import{u as ce}from"./usePageData-Cn0zOp5N.js";import{_ as Ye}from"./Grid-Iszn1RIZ.js";import{_ as Qe}from"./FormItemGridItem-B3wj0zec.js";import{_ as zt}from"./DatePicker-dDsqA412.js";import{_ as jt}from"./round-search-C4uw-VPp.js";import{_ as Ut}from"./round-refresh-Cm__CFcQ.js";import{_ as qt,a as Bt}from"./DescriptionsItem-E3fYyNla.js";import{N as de}from"./Popconfirm-CR5sQlbC.js";import{_ as Nt}from"./RadioButton-CamoLGWz.js";const At={key:0,style:{"margin-left":"20px"}},Pt={key:0,style:{"margin-left":"20px"}},$t={key:0,style:{"margin-left":"20px"}},It={key:0,style:{"margin-left":"20px"}},Rt=Be({name:"OperateDrawer",__name:"operate-drawer",props:qe({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:qe(["submitted"],["update:visible"]),setup(O,{emit:fe}){const z=fe,D=Ne(),y=O,l=rt(G());function G(){return{pid:void 0,id:"",debugname:"",docker:void 0,dockcharge:"",dockcontact:"",status:0,notes:"",debugresult:0,dtype:void 0,starttime:null,endtime:null,dbcreater:void 0,startAndTimeRange:void 0,eqmid:void 0,re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const{pageData:H,getData:m,nextPage:B}=ce(ft),R=async()=>{await m({usertypes:"2,3"})},J=async o=>{const a=o.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&H.data.length<H.total&&(await B(),await pe(),setTimeout(()=>{a.scrollTop=d}))},{pageData:b,getData:ee,nextPage:me}=ce(mt),ge=async o=>{const a=o.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&b.data.length<b.total&&(await me(),b.data=b.data.map(x=>({...x,value:x.docker+"&id="+x.id})),await pe(),setTimeout(()=>{a.scrollTop=d}))},te=async()=>{await ee({pid:l.pid}),b.data=b.data.map(o=>({...o,value:o.docker+"&id="+o.id}))},ae=async o=>{var a;if(l.docker=o,l.docker){const[d,x]=(a=l.docker)==null?void 0:a.split("&id="),k=b.data.find(Q=>Q.docker==d&&Q.id==x);k?(l.dockcharge=k.pname,l.dockcontact=k.pcontact):(l.dockcharge="",l.dockcontact="")}},{pageData:j,getData:ve,nextPage:oe}=ce(gt),ye=async o=>{const a=o.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&j.data.length<j.total&&(await oe(),await pe(),setTimeout(()=>{a.scrollTop=d}))},be=async()=>{await ve()},L=I([]),{pageData:N,getData:K,nextPage:ue}=ce(Ve),v=async o=>{const a=o.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&N.data.length<N.total&&(await ue(),L.value=N.data,await pe(),setTimeout(()=>{a.scrollTop=d}))},_=async()=>{await K({fuzzy:D.userInfo.pname,page:1}),L.value=N.data},$=Re.debounce(async o=>{await K({fuzzy:o,page:1}),L.value=N.data},300),E=I(!1),le=I(!1),_e=o=>{if(l.pid=null,E.value=!0,le.value=!1,!o){W();return}$(o)},p=async()=>{E.value&&!le.value&&(await K({page:1}),L.value=N.data,E.value=!1)},W=async()=>{await K({page:1}),L.value=N.data},he=async o=>{l.pid=o,le.value=!0,Y()},{pageData:s,getData:n,nextPage:U}=ce(vt),A=async o=>{const a=o.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&j.data.length<j.total&&(await U(),await pe(),setTimeout(()=>{a.scrollTop=d}))},Y=async()=>{await n({pid:l.pid})},ke=I(void 0);async function Te(){_(),be(),R(),Object.assign(l,G()),y.operateType==="add"&&(l.pid=Number(y.pid)),y.operateType==="edit"&&y.rowData&&(Object.assign(l,y.rowData),ke.value=l.status,y.rowData.starttime&&y.rowData.endtime?l.startAndTimeRange=[Pe(y.rowData.starttime),Pe(y.rowData.endtime)]:l.startAndTimeRange=null),te(),l.pid&&Y()}const{formRef:Fe,validate:we,restoreValidation:Se}=Le(),C={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},eqmid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dbcreater:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"},debugname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcharge:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"}},ze=it(()=>({add:"新增待调试业务",edit:"修改待调试业务"})[y.operateType]),ne=Ee(O,"visible");Oe(ne,()=>{ne.value&&(Te(),setTimeout(()=>{const o=document.querySelector(".n-scrollbar-content");o==null||o.scrollTo(0,0)},300),Se())});const h=I(0),c=I("");async function re({file:o},a){h.value=0,c.value=a;const d=await yt(o.file,o.name,"",x=>{h.value=x});d&&(l[a]=d,h.value=0)}function je(){ne.value=!1}async function Ce(o){if(o)try{const d=await(await fetch(o==null?void 0:o.split("?")[0],{mode:"cors"})).blob(),x=URL.createObjectURL(d),k=document.createElement("a");k.href=x,k.download=o==null?void 0:o.split("?")[1],k.style.display="none",document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(x)}catch(a){console.error("下载失败:",a)}}async function Ze(){var o;await we(),(o=window.$dialog)==null||o.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await Xe()}})}async function Xe(){var o,a,d,x;if(await we(),y.operateType==="edit"){const k=JSON.parse(JSON.stringify(l));ke.value==k.status&&delete k.status,k.docker=(o=k.docker)==null?void 0:o.split("&id=")[0];const{data:Q,error:Ue}=await Ge([k]);Ue||(je(),z("submitted"),(a=window.$message)==null||a.success("修改成功"))}else{const{data:k,error:Q}=await bt([{...l,docker:(d=l.docker)==null?void 0:d.split("&id=")[0]}]);Q||(je(),z("submitted"),(x=window.$message)==null||x.success("添加成功"))}}async function De(o){var a;return o.file.file.size>100*1024*1024?((a=window.$message)==null||a.error("文件大小不能超过100M"),!1):!0}const et=o=>{var a;l.debugname=(a=j.data.find(d=>d.id==o))==null?void 0:a.tname,l.dtype=o};async function tt(o,a){l.startAndTimeRange=o,l.starttime=o==null?void 0:o[0],l.endtime=o==null?void 0:o[1]}return(o,a)=>{const d=Qe,x=pt,k=ct,Q=Ye,Ue=He,at=dt,lt=Ae,nt=Me;return g(),F(nt,{show:ne.value,"onUpdate:show":a[23]||(a[23]=i=>ne.value=i),title:ze.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:t(()=>[e(lt,{justify:"end",size:16},{default:t(()=>[e(u(S),{onClick:je},{default:t(()=>[r(f(u(X)("common.cancel")),1)]),_:1}),e(u(S),{type:"primary",onClick:Ze},{default:t(()=>[r(f(u(X)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(at,{class:"pr-20px"},{default:t(()=>[e(Ue,{ref_key:"formRef",ref:Fe,model:l,rules:C,"label-placement":"left","label-width":120},{default:t(()=>[e(Q,{responsive:"screen","item-responsive":""},{default:t(()=>[e(d,{span:"24 m:12",label:"项目列表",path:"pid"},{default:t(()=>[e(u(se),{filterable:"",clearable:"",value:l.pid,"onUpdate:value":[a[0]||(a[0]=i=>l.pid=i),he],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:W,onSearch:_e,onBlur:p,options:L.value,onScroll:v},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"权重",path:"dtype"},{default:t(()=>[e(u(se),{filterable:"",value:l.dtype,"onUpdate:value":[a[1]||(a[1]=i=>l.dtype=i),et],tag:"",placeholder:"请选择权重","label-field":"tname","value-field":"id",options:u(j).data,onScroll:ye},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"业务名称",path:"debugname"},{default:t(()=>[e(u(V),{value:l.debugname,"onUpdate:value":a[2]||(a[2]=i=>l.debugname=i),placeholder:"请输入"},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"调试人",path:"dbcreater"},{default:t(()=>[e(u(se),{filterable:"",value:l.dbcreater,"onUpdate:value":a[3]||(a[3]=i=>l.dbcreater=i),placeholder:"请选择调试人","label-field":"username","value-field":"id",options:u(H).data,onScroll:J},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"待调试设备",path:"eqmid"},{default:t(()=>[e(u(se),{filterable:"",clearable:"",value:l.eqmid,"onUpdate:value":a[4]||(a[4]=i=>l.eqmid=i),placeholder:"请选择待调试设备","label-field":"devname","value-field":"id",options:u(s).data,onScroll:A},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"对接方",path:"docker"},{default:t(()=>[e(u(se),{filterable:"",value:l.docker,"onUpdate:value":[a[5]||(a[5]=i=>l.docker=i),ae],clearable:"",tag:"",placeholder:"请选择或输入对接方","label-field":"docker","value-field":"value",options:u(b).data,onScroll:ge},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"对接方负责人",path:"dockcharge"},{default:t(()=>[e(u(V),{value:l.dockcharge,"onUpdate:value":a[6]||(a[6]=i=>l.dockcharge=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"联系方式",path:"dockcontact"},{default:t(()=>[e(u(V),{value:l.dockcontact,"onUpdate:value":a[7]||(a[7]=i=>l.dockcontact=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),y.operateType=="edit"?(g(),F(d,{key:0,span:"24 m:12",label:"状态",path:"status"},{default:t(()=>[e(u(se),{clearable:"",value:l.status,"onUpdate:value":a[8]||(a[8]=i=>l.status=i),placeholder:"请选择",options:u(D).userInfo.usertype==0||u(D).userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}]},null,8,["value","options"])]),_:1})):T("",!0),e(d,{span:"24 m:24",label:"起止时间",path:"startAndTimeRange"},{default:t(()=>[e(u(zt),{clearable:"",value:l.startAndTimeRange,"onUpdate:value":a[9]||(a[9]=i=>l.startAndTimeRange=i),type:"daterange","value-format":"yyyy-MM-dd",style:{width:"100%"},"onUpdate:formattedValue":tt},null,8,["value"])]),_:1}),e(d,{span:"24 m:24",label:"备注",path:"notes"},{default:t(()=>[e(u(V),{value:l.notes,"onUpdate:value":a[10]||(a[10]=i=>l.notes=i),placeholder:"请输入"},null,8,["value"])]),_:1}),e(d,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:t(()=>[e(Q,{responsive:"screen","item-responsive":""},{default:t(()=>[e(d,{span:"24 m:12",label:"附件1",path:"notes"},{default:t(()=>[e(u(V),{value:l.re1,"onUpdate:value":a[11]||(a[11]=i=>l.re1=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl1?(g(),P("span",At,[r(f((i=l.fl1)==null?void 0:i.split("?")[1])+" ",1),w("span",{class:"cursor-pointer c-#c92a2a",onClick:a[12]||(a[12]=q=>l.fl1="")},"删除"),w("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[13]||(a[13]=q=>Ce(l.fl1))},"下载")])):(g(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":q=>re(q,"fl1"),"show-file-list":!1,onBeforeUpload:De},{default:t(()=>[e(u(S),{loading:h.value>0&&!l.fl1&&c.value=="fl1",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(f(h.value>0&&!l.fl1&&c.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),h.value&&!l.fl1&&c.value=="fl1"?(g(),F(k,{key:2,type:"line",percentage:h.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1})]),_:1})]),_:1}),e(d,{span:"24 m:12",label:"附件2",path:"notes"},{default:t(()=>[e(u(V),{value:l.re2,"onUpdate:value":a[14]||(a[14]=i=>l.re2=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl2?(g(),P("span",Pt,[r(f((i=l.fl2)==null?void 0:i.split("?")[1])+" ",1),w("span",{class:"cursor-pointer c-#c92a2a",onClick:a[15]||(a[15]=q=>l.fl2="")},"删除"),w("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[16]||(a[16]=q=>Ce(l.fl2))},"下载")])):(g(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":q=>re(q,"fl2"),"show-file-list":!1,onBeforeUpload:De},{default:t(()=>[e(u(S),{loading:h.value>0&&!l.fl2&&c.value=="fl2",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(f(h.value>0&&!l.fl2&&c.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),h.value&&!l.fl2&&c.value=="fl2"?(g(),F(k,{key:2,type:"line",percentage:h.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1}),e(d,{span:"24 m:12",label:"附件3",path:"notes"},{default:t(()=>[e(u(V),{value:l.re3,"onUpdate:value":a[17]||(a[17]=i=>l.re3=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl3?(g(),P("span",$t,[r(f((i=l.fl3)==null?void 0:i.split("?")[1])+" ",1),w("span",{class:"cursor-pointer c-#c92a2a",onClick:a[18]||(a[18]=q=>l.fl3="")},"删除"),w("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[19]||(a[19]=q=>Ce(l.fl3))},"下载")])):(g(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":q=>re(q,"fl3"),"show-file-list":!1,onBeforeUpload:De},{default:t(()=>[e(u(S),{loading:h.value>0&&!l.fl3&&c.value=="fl3",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(f(h.value>0&&!l.fl3&&c.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),h.value&&!l.fl3&&c.value=="fl3"?(g(),F(k,{key:2,type:"line",percentage:h.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1}),e(d,{span:"24 m:12",label:"附件4",path:"notes"},{default:t(()=>[e(u(V),{value:l.re4,"onUpdate:value":a[20]||(a[20]=i=>l.re4=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl4?(g(),P("span",It,[r(f((i=l.fl4)==null?void 0:i.split("?")[1])+" ",1),w("span",{class:"cursor-pointer c-#c92a2a",onClick:a[21]||(a[21]=q=>l.fl4="")},"删除"),w("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[22]||(a[22]=q=>Ce(l.fl4))},"下载")])):(g(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":q=>re(q,"fl4"),"show-file-list":!1,onBeforeUpload:De},{default:t(()=>[e(u(S),{loading:h.value>0&&!l.fl4&&c.value=="fl4",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(f(h.value>0&&!l.fl4&&c.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),h.value&&!l.fl4&&c.value=="fl4"?(g(),F(k,{key:2,type:"line",percentage:h.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Lt=Be({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:qe(["reset","search","search1","clear"],["update:model"]),setup(O,{emit:fe}){const z=Je(),D=Ke(),y=fe,l=Ne(),{formRef:G,restoreValidation:H}=Le(),m=Ee(O,"model"),B=I([]),{pageData:R,getData:J,nextPage:b}=ce(Ve),ee=async v=>{const _=v.currentTarget,$=_.scrollTop;_.scrollTop+_.offsetHeight>=_.scrollHeight&&R.data.length<R.total&&(await b(),B.value=R.data,await pe(),setTimeout(()=>{_.scrollTop=$}))},me=async v=>{var _;ae.value=!0,v?(m.value.pid=v,y("search1"),l.setProjectInfo({pname:(_=B.value.find($=>$.id==v))==null?void 0:_.proname,pid:v})):y("clear")},ge=Re.debounce(async v=>{await J({fuzzy:v,page:1}),B.value=R.data},300),te=I(!1),ae=I(!1),j=v=>{if(m.value.pid=null,te.value=!0,ae.value=!1,!v){oe();return}ge(v)},ve=async()=>{te.value&&!ae.value&&(await J({page:1}),B.value=R.data,te.value=!1)},oe=async()=>{await J({page:1}),B.value=R.data,y("search1")},ye=async v=>{m.value.status=v,y("search1")},be=async()=>{m.value.status=null},L=async()=>{var v,_;await J({fuzzy:D.query.pname?D.query.pname:l.userInfo.pname}),B.value=R.data,m.value.pid=D.query.prjId?Number(D.query.prjId):l.userInfo.pid?l.userInfo.pid:(v=B.value[0])==null?void 0:v.id,m.value.fuzzy=D.query.debugname?D.query.debugname:"",l.setProjectInfo({pid:m.value.pid,pname:(_=B.value.find($=>$.id==m.value.pid))==null?void 0:_.proname}),y("search"),setTimeout(()=>{z.replace({path:D.path,query:{}})},10)};L();async function N(){await H(),m.value.fuzzy="",m.value.pid=null,m.value.status=null,y("reset")}const K=()=>{m.value.fuzzy="",y("search")};async function ue(){y("search")}return Oe(()=>D.query,v=>{v.pname&&L()}),(v,_)=>{const $=se,E=Qe,le=V,_e=Ut,p=S,W=jt,he=Ae,s=Ye,n=He,U=We;return g(),F(U,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(n,{ref_key:"formRef",ref:G,model:m.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:_t(ue,["enter"])},{default:t(()=>[e(s,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(E,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:t(()=>[e($,{filterable:"",clearable:"",value:m.value.pid,"onUpdate:value":[_[0]||(_[0]=A=>m.value.pid=A),me],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:oe,onSearch:j,onBlur:ve,options:B.value,onScroll:ee},null,8,["value","options"])]),_:1}),e(E,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:t(()=>[e($,{clearable:"",filterable:"",value:m.value.status,"onUpdate:value":[_[1]||(_[1]=A=>m.value.status=A),ye],placeholder:"请选择状态",onClear:be,options:[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]},null,8,["value"])]),_:1}),e(E,{span:"24 s:12 m:6",label:"业务名称",path:"fuzzy"},{default:t(()=>[e(le,{value:m.value.fuzzy,"onUpdate:value":_[2]||(_[2]=A=>m.value.fuzzy=A),placeholder:"请输入",clearable:"",onClear:K},null,8,["value"])]),_:1}),e(E,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(he,{class:"w-full"},{default:t(()=>[e(p,{onClick:N},{icon:t(()=>[e(_e,{class:"text-icon"})]),default:t(()=>[r(" "+f(u(X)("common.reset")),1)]),_:1}),e(p,{type:"primary",ghost:"",onClick:ue},{icon:t(()=>[e(W,{class:"text-icon"})]),default:t(()=>[r(" "+f(u(X)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Et={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ot={key:0},Ht={key:1},Mt={key:0},Vt={key:1},Gt={key:0},Jt={key:1},Kt={key:0},Wt={key:1};function Ie(O){return typeof O=="function"||Object.prototype.toString.call(O)==="[object Object]"&&!Tt(O)}const da=Be({name:"projectmanagement_business",__name:"index",setup(O){const fe=ht(),z=Ne(),D=Ke(),y=Je(),{columns:l,columnChecks:G,data:H,getData:m,loading:B,pagination:R,mobilePagination:J,searchParams:b}=Ft({showTotal:!0,immediate:!1,apiFn:xt,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",status:null,dbcreater:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"debugname",title:"业务名称",align:"center",width:160},{key:"proname",title:"所属项目",align:"center",width:160,render(s){return e("span",{class:"cursor-pointer",onClick:()=>ye(s)},[s.proname])}},{key:"status",title:"状态",align:"center",width:100,render(s){return e(ie,{color:{color:s.status==-1?"rgba(251, 146, 60, 0.15)":s.status==0?"rgba(156, 163, 175, 0.15)":s.status==1?"rgba(59, 130, 246, 0.15)":s.status==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:s.status==-1?"#FB923C":s.status==0?"#9CA3AF":s.status==1?"#3B82F6":s.status==2?"#FACC15":"#10B981",borderColor:s.status==-1?"#FB923C":s.status==0?"#9CA3AF":s.status==1?"#3B82F6":s.status==2?"#FACC15":"#10B981"}},{default:()=>[s.status==-1?"申请中":s.status==0?"待调试":s.status==1?"开始调试":s.status==2?"待审核":"审核完成"]})}},{key:"eqmname",title:"调试设备",align:"center",width:150},{key:"docker",title:"对接信息",align:"left",width:180,render:s=>e("div",{style:"line-height: 1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("对接方：")]),e("span",{style:"font-weight:500"},[s.docker||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("负责人：")]),e("span",{style:"font-weight:500"},[s.dockcharge||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("联系方式：")]),e("span",{style:"font-weight:500"},[s.dockcontact||"-"])])])},{key:"dbusername",title:"调试信息",align:"left",width:200,render(s){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("调试人：")]),e("span",{style:"font-weight:500"},[s.dbusername||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("工时：")]),e("span",{style:"color:#1890ff; font-weight:500"},[s.duration||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("开始：")]),e("span",null,[s.dbdbtime||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("结束：")]),e("span",null,[s.dedbtime||"-"])])])}},{key:"ckusername",title:"审核信息",align:"left",width:200,render(s){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("审核人：")]),e("span",{style:"font-weight:500"},[s.ckusername||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("时间：")]),e("span",{style:" font-weight:500"},[s.ckdbtime||"-"])])])}},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(s){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("创建人：")]),e("span",{style:"font-weight:500"},[s.username||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("时间：")]),e("span",{style:" font-weight:500"},[s.dbtime||"-"])])])}},{key:"operate",title:X("common.operate"),align:"center",width:280,fixed:"right",render:s=>{let n;return e("div",{class:"flex-center gap-8px"},[s.status==-1&&(z.userInfo.usertype==0||z.userInfo.usertype==2)&&e(de,{onPositiveClick:()=>N(s,0)},{default:()=>"确定通过申请吗？",trigger:()=>M(e(S,{type:"warning",ghost:!0,size:"small"},{default:()=>["通过申请"]}),[[Z("no-auth"),"project:Debug:update"]])}),s.status==0&&s.dbcreater==z.userInfo.id&&e(de,{onPositiveClick:()=>N(s,1)},{default:()=>"确定开始调试吗？",trigger:()=>M(e(S,{type:"success",ghost:!0,size:"small"},{default:()=>["开始"]}),[[Z("no-auth"),"project:Debug:update"]])}),s.status==1&&s.dbcreater==z.userInfo.id&&e(de,{onPositiveClick:()=>N(s,2)},{default:()=>"确定完成调试？",trigger:()=>M(e(S,{type:"success",ghost:!0,size:"small"},{default:()=>["完成"]}),[[Z("no-auth"),"project:Debug:update"]])}),s.status==2&&(z.userInfo.usertype==0||z.userInfo.usertype==2)&&e(de,{onPositiveClick:()=>N(s,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>M(e(S,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[Z("no-auth"),"project:Debug:update"]])}),M(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>he(s)},{default:()=>[r("详情")]}),[[Z("no-auth"),"project:Debug:select"]]),M(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>K(s.id)},Ie(n=X("common.edit"))?n:{default:()=>[n]}),[[Z("no-auth"),"project:Debug:update"]]),e(de,{onPositiveClick:()=>L(s.id)},{default:()=>X("common.confirmDelete"),trigger:()=>{let U;return M(e(S,{type:"error",ghost:!0,size:"small"},Ie(U=X("common.delete"))?U:{default:()=>[U]}),[[Z("no-auth"),"project:Debug:delete"]])}})])}}]}),{drawerVisible:ee,operateType:me,editingData:ge,handleAdd:te,handleEdit:ae,checkedRowKeys:j,onBatchDeleted:ve,onDeleted:oe}=St(H,m);kt(async()=>{});const ye=s=>{z.setProjectInfo({pid:s.pid,pname:s.proname}),y.push("/projectmanagement/orderdetail?prjId="+s.pid+`&pname=${s.proname}&IsScroll=1`)};async function be(){console.log(j.value),ue(j.value.join(","),s=>{ve()})}async function L(s){const{data:n,error:U}=await $e(s,b.pid);U||oe()}const N=async(s,n)=>{var Y;const{data:U,error:A}=await Ge([{id:s.id,status:n,pid:s.pid}]);A||((Y=window.$message)==null||Y.success("操作成功"),m(),n==3?window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:s.pid,type:"debug"}})):(n==1||n==2)&&window.dispatchEvent(new CustomEvent("refreshTodo")))};function K(s){ae(s)}async function ue(s,n){const{data:U,error:A}=await $e(s,b.pid);if(!A)n&&n(U);else return!1}const v=I(-1),_=s=>{s>0?(v.value=s,b.dbcreater=JSON.parse(JSON.stringify(s)),m()):(b.dbcreater=void 0,v.value=-1,m())},$=s=>{m()},E=()=>{if(console.log(D.query.prjId,"route.query.prjId"),D.query.debug){b.status=Number(D.query.debug),b.dbcreater=z.userInfo.id,_(z.userInfo.id);return}D.query.types=="2"&&(b.status=2),D.query.types=="-1"&&(b.status=-1),m()},le=()=>{m()},_e=()=>{H.value=[],R.itemCount=0},p=I(null),W=I(!1),he=s=>{p.value=s,W.value=!0};return(s,n)=>{const U=Nt,A=Dt,Y=Ae,ke=ut,Te=ot,Fe=st,we=wt,Se=We,C=Bt,ze=qt,ne=Me,h=Z("no-auth");return g(),P("div",Et,[e(Lt,{model:u(b),"onUpdate:model":n[0]||(n[0]=c=>xe(b)?b.value=c:null),onReset:le,onSearch:E,onSearch1:u(m),onClear:_e},null,8,["model","onSearch1"]),e(Se,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(Y,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[n[6]||(n[6]=w("div",null,"待调试业务",-1)),e(A,{size:"small",value:v.value,"onUpdate:value":[n[1]||(n[1]=c=>v.value=c),_],name:"radiobuttongroup1"},{default:t(()=>[e(U,{value:-1,label:"默认"}),e(U,{value:u(z).userInfo.id,label:"我的调试"},null,8,["value"])]),_:1},8,["value"])]),_:1,__:[6]})]),"header-extra":t(()=>[e(Y,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[M((g(),F(u(S),{onClick:u(te),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(ke,{class:"text-icon"})]),default:t(()=>[n[7]||(n[7]=r(" "+f("新增")))]),_:1,__:[7]},8,["onClick"])),[[h,"project:Debug:insert"]]),e(u(de),{onPositiveClick:be},{trigger:t(()=>[M((g(),F(u(S),{size:"small",ghost:"",type:"error",disabled:u(j).length==0},{icon:t(()=>[e(Te,{class:Ct(["text-icon",{"animate-spin":u(B)}])},null,8,["class"])]),default:t(()=>[n[8]||(n[8]=r(" "+f("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[h,"project:Debug:delete"]])]),default:t(()=>[n[9]||(n[9]=r(" 确定要删除选中的吗？ "))]),_:1,__:[9]}),e(Fe,{columns:u(G),"onUpdate:columns":n[2]||(n[2]=c=>xe(G)?G.value=c:null),ctype:3},null,8,["columns"])]),_:1})]),default:t(()=>[e(we,{"checked-row-keys":u(j),"onUpdate:checkedRowKeys":n[3]||(n[3]=c=>xe(j)?j.value=c:null),columns:u(l),data:u(H),size:"small","flex-height":!u(fe).isMobile,loading:u(B),remote:"","row-key":c=>c.id,"scroll-x":u(l).reduce((c,re)=>c+(re.width||100),0),pagination:u(J),class:"sm:h-full","onUpdate:filters":$},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","scroll-x","pagination"]),e(Rt,{visible:u(ee),"onUpdate:visible":n[4]||(n[4]=c=>xe(ee)?ee.value=c:null),onSubmitted:u(m),"operate-type":u(me),pid:u(b).pid,"row-data":u(ge)},null,8,["visible","onSubmitted","operate-type","pid","row-data"])]),_:1}),e(ne,{show:W.value,"onUpdate:show":n[5]||(n[5]=c=>W.value=c),title:"查看详情",preset:"card",class:"w-1200px"},{default:t(()=>[e(ze,{bordered:"","label-placement":"left","label-align":"center",columns:2,"label-style":{width:"160px"}},{default:t(()=>[e(C,null,{label:t(()=>n[10]||(n[10]=[r(" 权重 ")])),default:t(()=>[w("span",null,f(p.value.tname),1)]),_:1}),e(C,null,{label:t(()=>n[11]||(n[11]=[r(" 业务名称 ")])),default:t(()=>[w("span",null,f(p.value.debugname),1)]),_:1}),e(C,null,{label:t(()=>n[12]||(n[12]=[r(" 计划起止时间 ")])),default:t(()=>[w("span",null,f(p.value.starttime)+"--"+f(p.value.endtime),1)]),_:1}),e(C,null,{label:t(()=>n[13]||(n[13]=[r(" 对接方 ")])),default:t(()=>[w("span",null,f(p.value.docker.split("&id=")[0]),1)]),_:1}),e(C,null,{label:t(()=>n[14]||(n[14]=[r(" 对接方负责人 ")])),default:t(()=>[w("span",null,f(p.value.dockcharge),1)]),_:1}),e(C,null,{label:t(()=>n[15]||(n[15]=[r(" 联系方式 ")])),default:t(()=>[w("span",null,f(p.value.dockcontact),1)]),_:1}),e(C,null,{label:t(()=>n[16]||(n[16]=[r(" 状态 ")])),default:t(()=>[p.value.status==-1?(g(),F(u(ie),{key:0,type:"default"},{default:t(()=>n[17]||(n[17]=[r("申请中")])),_:1,__:[17]})):T("",!0),p.value.status==0?(g(),F(u(ie),{key:1,type:"default"},{default:t(()=>n[18]||(n[18]=[r("未调试")])),_:1,__:[18]})):T("",!0),p.value.status==1?(g(),F(u(ie),{key:2,type:"info"},{default:t(()=>n[19]||(n[19]=[r("开始调试")])),_:1,__:[19]})):T("",!0),p.value.status==2?(g(),F(u(ie),{key:3,type:"success"},{default:t(()=>n[20]||(n[20]=[r("待审核")])),_:1,__:[20]})):T("",!0),p.value.status==3?(g(),F(u(ie),{key:4,type:"success"},{default:t(()=>n[21]||(n[21]=[r("审核完成")])),_:1,__:[21]})):T("",!0)]),_:1}),e(C,null,{label:t(()=>n[22]||(n[22]=[r(" 备注 ")])),default:t(()=>[w("span",null,f(p.value.notes),1)]),_:1}),e(C,null,{label:t(()=>n[23]||(n[23]=[r(" 调试人 ")])),default:t(()=>[w("span",null,f(p.value.dbusername),1)]),_:1}),e(C,null,{label:t(()=>n[24]||(n[24]=[r(" 调试开始时间 ")])),default:t(()=>[w("span",null,f(p.value.dbdbtime),1)]),_:1}),e(C,null,{label:t(()=>n[25]||(n[25]=[r(" 调试结束时间 ")])),default:t(()=>[w("span",null,f(p.value.dedbtime),1)]),_:1}),e(C,null,{label:t(()=>n[26]||(n[26]=[r(" 调试工时 ")])),default:t(()=>[w("span",null,f(p.value.duration),1)]),_:1}),e(C,null,{label:t(()=>n[27]||(n[27]=[r(" 审核人 ")])),default:t(()=>[w("span",null,f(p.value.ckusername),1)]),_:1}),e(C,null,{label:t(()=>n[28]||(n[28]=[r(" 审核时间 ")])),default:t(()=>[w("span",null,f(p.value.ckdbtime),1)]),_:1}),e(C,null,{label:t(()=>n[29]||(n[29]=[r(" 附件1 ")])),default:t(()=>{var c;return[p.value.re1?(g(),P("span",Ot,"文件别名"+f(p.value.re1),1)):T("",!0),p.value.fl1?(g(),P("span",Ht,f((c=p.value.fl1)==null?void 0:c.split("?")[1]),1)):T("",!0)]}),_:1}),e(C,null,{label:t(()=>n[30]||(n[30]=[r(" 附件2 ")])),default:t(()=>{var c;return[p.value.re2?(g(),P("span",Mt,"文件别名"+f(p.value.re2),1)):T("",!0),p.value.fl2?(g(),P("span",Vt,f((c=p.value.fl2)==null?void 0:c.split("?")[1]),1)):T("",!0)]}),_:1}),e(C,null,{label:t(()=>n[31]||(n[31]=[r(" 附件3 ")])),default:t(()=>{var c;return[p.value.re3?(g(),P("span",Gt,"文件别名"+f(p.value.re3),1)):T("",!0),p.value.fl3?(g(),P("span",Jt,f((c=p.value.fl3)==null?void 0:c.split("?")[1]),1)):T("",!0)]}),_:1}),e(C,null,{label:t(()=>n[32]||(n[32]=[r(" 附件4 ")])),default:t(()=>{var c;return[p.value.re4?(g(),P("span",Kt,"文件别名"+f(p.value.re4),1)):T("",!0),p.value.fl4?(g(),P("span",Wt,f((c=p.value.fl4)==null?void 0:c.split("?")[1]),1)):T("",!0)]}),_:1})]),_:1})]),_:1},8,["show"])])}}});export{da as default};
