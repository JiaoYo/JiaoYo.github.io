import{_ as Ra}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Bv9tlAlp.js";import{_ as na}from"./round-delete-B_8F17d_.js";import{_ as Va}from"./round-add-DT_ryrzO.js";import{d as ht,av as pt,z as sa,D as Oe,s as b,A as ia,$ as A,n as r,H as B,aR as ft,B as y,cG as qa,cw as Ja,cE as Ga,cF as qt,bf as Jt,au as ae,a5 as Gt,f as a,g,cY as Ka,cy as Ha,cX as Xa,cU as Ya,cV as Kt,a as Wa,ax as zt,at as mt,aJ as oa,b as ct,o as P,aO as Ht,bp as Qa,w as i,bn as Za,M as ra,L as ua,c as O,G as oe,h as u,bo as Ze,e as T,S as el,d4 as Xt,a_ as tl,J as re,ay as gt,t as G,a4 as da,N as al,cW as ca,cL as pa,dw as ll,az as Yt,aA as vt,di as fa,f4 as Wt,f5 as nl,f6 as Qt,f7 as sl,cv as il,f8 as ol,f9 as rl,dm as Zt,df as ea,aE as St,dx as ul,d2 as dl,c$ as ma,dj as ga,dl as cl,cH as pl,cO as fl,dk as ml,dg as gl,dh as vl,aG as hl,de as yl,dn as bl,fa as _l,bk as kl,a2 as Ft,aD as Qe,W as va,aI as xl,Y as Cl,X as Sl,i as wl,b0 as Dl,F as ut,aK as dt,cT as zl,I as We,aL as Fl,aB as $l,fb as Pl,aN as Il,cx as Al,_ as Ll,aQ as Nl}from"./index-BHYK3A_G.js";import{u as Dt,a as Ul}from"./table-B6LlmD7Q.js";import{_ as jl}from"./round-plus-DZWXO6eq.js";import{_ as Tl,a as El,A as Bl}from"./index-BTQKwTLU.js";import{h as $t,i as Ol,g as ha,p as ta,f as Ml}from"./business-B_veVQll.js";import{u as aa}from"./usePageData-BU1qqIQs.js";import{h as wt}from"./permission-BBP7PMT_.js";import{N as Se}from"./Popconfirm-CZ_7v-Ns.js";import{N as Rl}from"./Cascader-xi9pWh20.js";import{_ as ya}from"./Grid-B2A8-T_X.js";import{_ as ba}from"./FormItemGridItem-C5bXUl4-.js";import{_ as _a}from"./DatePicker-Bf16rwUA.js";import{_ as Vl}from"./round-search-Cl9yVEe0.js";import{_ as ql}from"./round-refresh-DtTh3Oti.js";import{l as Jl}from"./lookdebuggingSheetModal-D9el-2jb.js";import{_ as Gl}from"./RadioButton-DSDnKGZR.js";import"./DescriptionsItem-DmzTyFLi.js";import"./Table-Ma1-Ugmt.js";const Kl={class:"w-100%"},Hl={class:"flex"},Xl={style:{display:"flex","flex-direction":"column",width:"100%"}},Yl={class:"flex items-center"},Wl={class:"w-100%"},Ql={class:"w-100px"},Zl={style:{display:"flex","flex-direction":"column"}},en={style:{display:"flex","flex-direction":"column"}},tn={style:{display:"flex","flex-direction":"column"}},an={class:"flex-col w-100%"},ln=2,nn=ht({name:"OperateDrawer",__name:"operate-drawer",props:pt({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:pt(["submitted"],["update:visible"]),setup(W,{emit:ue}){const _=sa(),le=ue,J=Oe({contactList:[],debuggedDevieceList:[]}),d=W,s=Oe(fe());function fe(){return{proname:"",dispatchIds:[],contractIds:[],proaddr:"",cpdbtime:null,plantime:null,prosite:"",longitude:120.373885,latitude:30.303899,period:null,dtype:null,dispatch:"",status:1,region:null,provice:null}}const N=b(0),me=b(void 0);async function ye(){$.value=[{longitude:120.373885,latitude:30.303899,addr:""}],Object.assign(s,fe()),Pa(),ja(),d.operateType==="edit"&&d.rowData&&(await Promise.all([Ea(),Me(),X(),S(),Je(),ot()]),Object.assign(s,d.rowData),N.value=s.period,me.value=s.status,Et(s.provice),st(s.provice),$a())}const{formRef:R,validate:de,restoreValidation:we}=ia(),De={proname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入项目名称"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择项目状态"},contractIds:{type:"array",required:!0,trigger:["blur","change"],message:"请选择合同"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择调试类型"},period:{type:"number",required:!0,trigger:["blur","change"],message:"请输入周期"},prosite:{type:"string",required:!0,trigger:["blur","change","focus"],message:"请选择项目地点"},cpdbtime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择时间"},plantime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择时间"},provice:{type:"number",required:!0,trigger:["blur","change"],message:"请选择省份"},region:{type:"number",required:!0,trigger:["blur","change"],message:"请选择城市"}},C=b([]),Q=Oe({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",pageSizes:[20],prefix:()=>`共 ${C.value.length} 条`,onChange:e=>{Q.page=e,S()},onUpdatePageSize:e=>{Q.pageSize=e,Q.page=1,S()}}),K=[{title:"对接方",key:"docker",align:"center",width:150,render(e,t){return e.setStatus?r(B,{value:e.docker,placeholder:"请输入",onUpdateValue(l){C.value[t].docker=l}}):r("div",{},e.docker)}},{title:"姓名",key:"pname",align:"center",width:100,render(e,t){return e.setStatus?r(B,{value:e.pname,placeholder:"请输入姓名",onUpdateValue(l){C.value[t].pname=l}}):r("div",{},e.pname)}},{title:"联系方式",key:"pcontact",align:"center",width:150,render(e,t){return e.setStatus?r(B,{value:e.pcontact,placeholder:"请输入联系方式",onUpdateValue(l){C.value[t].pcontact=l}}):r("div",{},e.pcontact)}},{title:"备注",key:"proposition",align:"center",width:150,render(e,t){return e.setStatus?r(B,{value:e.proposition,placeholder:"请输入备注",onUpdateValue(l){C.value[t].proposition=l}}):r("div",{},e.proposition)}},{title:"操作人",width:100,key:"username",align:"center"},{title:"操作时间",key:"dbtime",width:180,align:"center",render:e=>e.dbtime?ft(1,e.dbtime):""},{key:"operate",title:A("common.operate"),align:"center",width:160,fixed:"right",render(e,t){return r("div",{class:"flex-center gap-8px"},[e.setStatus?[r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>be(e)},{default:()=>"保存"}),r(y,{type:"default",ghost:!0,size:"small",onClick:()=>k(e,t)},{default:()=>"取消"}),r(Se,{onPositiveClick:()=>{d.operateType==="edit"&&e.id?qa(e.id).then(()=>{var l;C.value.splice(t,1),(l=window.$message)==null||l.success("删除成功")}):C.value.splice(t,1)}},{default:()=>A("common.confirmDelete"),trigger:()=>r(y,{type:"error",ghost:!0,size:"small"},{default:()=>A("common.delete")})})]:r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>h(e)},{default:()=>"编辑"})])}}],S=async()=>{var t;const{data:e}=await Ja({page:Q.page,limit:Q.pageSize,pid:(t=d.rowData)==null?void 0:t.id});C.value=e==null?void 0:e.list,C.value.forEach(l=>{l.setStatus=!1}),J.contactList=JSON.parse(JSON.stringify(C.value))},h=e=>{var t;if(C.value.some(l=>l.setStatus)){(t=window.$message)==null||t.warning("请先对正在编辑中的数据进行操作");return}e.setStatus=!e.setStatus},k=(e,t)=>{e.setStatus=!e.setStatus,e.id?C.value=JSON.parse(JSON.stringify(J.contactList)):C.value.splice(t,1)},be=async e=>{var t,l,o,p,f;if(!e.pname){(t=window.$message)==null||t.warning("请输入联系人姓名");return}if(!e.pcontact){(l=window.$message)==null||l.warning("请输入联系方式");return}if(d.operateType==="edit")if(e.id){const{data:x,error:w}=await Ga([e]);w||((o=window.$message)==null||o.success("修改成功"),S(),e.setStatus=!e.setStatus)}else{const{data:x,error:w}=await qt([{...e,pid:(p=d.rowData)==null?void 0:p.id}]);w||((f=window.$message)==null||f.success("添加成功"),S(),e.setStatus=!e.setStatus)}else e.setStatus=!e.setStatus};function E(){var e;((e=C.value[0])!=null&&e.pname||C.value.length==0)&&C.value.unshift({pname:"",pcontact:"",proposition:"",setStatus:!0})}const L=e=>{var t;s.contractIds=e,M.value=it.data.filter(l=>e.includes(l.id)).map(l=>({value:l.id,label:l.contractname,isLeaf:!1})),V((t=M.value[0])==null?void 0:t.id)},M=b([]),Me=async()=>{var l;const{data:e,error:t}=await ca({page:1,limit:100,id:d.rowData.id});M.value=e==null?void 0:e.list.map(o=>({value:o.id,label:o.contractname,isLeaf:!1})),V((l=e==null?void 0:e.list[0])==null?void 0:l.id)},ce=b([]),_e=b(),{pageData:ze,getData:Re}=aa(pa),V=async e=>{await Re({pids:e}),_e.value=[],ce.value=Array.from(new Set([...ce.value,...ze.data])),_e.value=ze.data.map(t=>({label:t.devname,value:t.id}))},Ve=async e=>{var t;await V(e.value),e.children=(t=_e.value)==null?void 0:t.map(l=>({label:l.label,value:l.value,isLeaf:!0}))},v=b([]),H=Oe({page:1,pageSize:20,itemCount:0,showSizePicker:!0,fuzzy:"",pageSizes:[10,20],prefix:()=>`共 ${H.itemCount} 条`,onChange:e=>{H.page=e,X()},onUpdatePageSize:e=>{H.pageSize=e,H.page=1,X()}}),Ue=b(),qe=[{title:"绑定合同设备",key:"cid",width:300,align:"center",render(e,t){var l,o;return e.setStatus?r(Rl,{style:"width: 270px",value:e.cid,filterable:!0,placeholder:"请选择合同设备",options:M.value,checkStrategy:"child",showPath:!1,remote:!0,renderSuffix:p=>p.option.hidden?null:p.node,renderLabel:p=>p.hidden?null:p.label,onLoad:Ve,onUpdateValue(p){var x;v.value[t].cid=Number(p)||0;const f=(x=ce.value)==null?void 0:x.find(w=>w.id==p);e.devname=(f==null?void 0:f.devname)||"",e.devnum=(f==null?void 0:f.devcount)||"",e.notes=(f==null?void 0:f.notes)||"",Ue.value=(f==null?void 0:f.devcount)||0,e.etype=(f==null?void 0:f.devtype)||0,e.devmanu=(f==null?void 0:f.devmanu)||"",e.devmodel=(f==null?void 0:f.devmodel)||"",e.devunit=(f==null?void 0:f.devunit)||""}}):r("div",{},e.devname2||((o=(l=_e.value)==null?void 0:l.find(p=>p.value==e.cid))==null?void 0:o.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(e,t){return e.setStatus?r(B,{value:e.devname,placeholder:"请输入",onUpdateValue(l){v.value[t].devname=l}}):r("div",{},e.devname)}},{title:"型号",key:"devmodel",width:220,align:"center",render(e,t){return r("div",{},e.devmodel)}},{title:"设备单位",key:"devunit",width:120,align:"center",render(e,t){return r("div",{},e.devunit)}},{title:"数量",key:"devnum",width:100,align:"center",render(e,t){return e.setStatus?r(Jt,{value:e.devnum,placeholder:"请输入",max:Ue.value,onUpdateValue(l){v.value[t].devnum=l}}):r("div",{},e.devnum)}},{title:"是否为我司设备",key:"etype",width:260,align:"center",render(e,t){return r("div",{},e.etype==0?"是":"否")}},{title:"设备厂家",key:"devmanu",width:200,align:"center",render(e,t){return r("div",{},e.devmanu)}},{title:"清点状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?r(ae,{value:e.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(l){v.value[t].status=Number(l)||0}}):r("div",{},e.status===0?"未清点":e.status===1?"正常":e.status===2?"增补":e.status===3?"退货":"换货")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(e,t){return r("div",{},e.devmanu)}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(e,t){return e.setStatus?r(B,{value:e.manucontact,placeholder:"请输入",onUpdateValue(l){v.value[t].manucontact=l}}):r("div",{},e.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(e,t){return e.setStatus?r(B,{value:e.manuinfo,placeholder:"请输入",onUpdateValue(l){v.value[t].manuinfo=l}}):r("div",{},e.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(e,t){return e.setStatus&&e.id?r(ae,{value:e.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(l){v.value[t].devstatus=Number(l)||0}}):r("div",{},e.devstatus===0?"设备无异常":e.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(e,t){return e.setStatus?r(B,{value:e.connectionmode,placeholder:"请输入",onUpdateValue(l){v.value[t].connectionmode=l}}):r("div",{},e.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(e,t){return e.setStatus&&e.id?r(ae,{value:e.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(l){v.value[t].install=Number(l)||0}}):r("div",{},e.install===0?"是":"否")}},{title:"备注",key:"notes",width:200,align:"center",render(e,t){return r("div",{},e.notes)}},{title:"文件",key:"re1",width:160,align:"center",render(e,t){return e.setStatus?r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>m(e,"debuggedDevieceList",t)},{default:()=>"上传文件"}):r(Gt,{trigger:"hover"},{trigger:()=>r("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const l=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(o=>o.alias||o.file);return l.length===0?r("div",{style:"padding: 10px; color: #999;"},"暂无文件"):r("div",{style:"padding: 10px;"},[r("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[r("thead",[r("tr",[r("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),r("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),r("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),r("tbody",l.map((o,p)=>{var f;return r("tr",[r("td",{style:"text-align:center; padding: 4px 8px;"},o.alias||"-"),r("td",{style:"text-align:center; padding: 4px 8px;"},((f=o.file)==null?void 0:f.split("?")[1])||"-"),r("td",{style:"text-align:center; padding: 4px 8px;"},r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>Pt({url:o.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作信息",key:"dbtime",width:180,align:"center",render(e,t){return r(Gt,{trigger:"hover"},{trigger:()=>r("div",{style:"color: #1890ff;cursor: pointer;"},e.dbtime?ft(1,e.dbtime):""),default:()=>r("div",{style:"padding: 10px;"},a("div",null,[a("div",null,[g("操作人："),e.username]),a("div",null,[g("操作时间："),e.dbtime]),a("div",null,[g("清点人："),e.dusername]),a("div",null,[g("清点时间："),e.ddbtime])]))})}},{key:"operate",title:A("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return r("div",{class:"flex-center gap-8px"},[e.setStatus?[r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>yt(e)},{default:()=>"保存"}),r(y,{type:"default",ghost:!0,size:"small",onClick:()=>Fe(e,t)},{default:()=>"取消"}),wt("project:Equipment:delete")&&r(Se,{onPositiveClick:async()=>{var l;if(e.id){const{data:o,error:p}=await Ka(e.id);o&&(v.value.splice(t,1),(l=window.$message)==null||l.success("删除成功"))}else v.value.splice(t,1)}},{default:()=>A("common.confirmDelete"),trigger:()=>r(y,{type:"error",ghost:!0,size:"small"},{default:()=>A("common.delete")})})]:wt("project:Equipment:update")&&r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>pe(e)},{default:()=>"编辑"})])}}],z=b([]),ke=b(!1),ne=b(""),n=b(),m=(e,t,l)=>{z.value=[],ke.value=!0,ne.value=t,n.value=l,e.re1&&z.value.push({id:"",name:e.re1,url:e.fl1,status:"uploading",setStatus:!1,progress:0}),e.re2&&z.value.push({id:"",name:e.re2,url:e.fl2,status:"uploading",setStatus:!1,progress:0}),e.re3&&z.value.push({id:"",name:e.re3,url:e.fl3,status:"uploading",setStatus:!1,progress:0}),e.re4&&z.value.push({id:"",name:e.re4,url:e.fl4,status:"uploading",setStatus:!1,progress:0})},ge=async()=>{var t,l;let e=!0;for(let o=0;o<z.value.length;o++){const p=z.value[o];if(!p.url){(t=window.$message)==null||t.warning(`第${o+1}个文件的文件名称不能为空`),e=!1;break}if(!p.name){(l=window.$message)==null||l.warning(`第${o+1}个文件的文件别名不能为空`),e=!1;break}v.value[n.value][`re${o+1}`]=p.name,v.value[n.value][`fl${o+1}`]=p.url}e&&(ke.value=!1,ne.value="",n.value=void 0)},X=async()=>{var t;const{data:e}=await Ha({page:H.page,limit:H.pageSize,fuzzy:H.fuzzy,pid:(t=d.rowData)==null?void 0:t.id});v.value=e.list,J.debuggedDevieceList=JSON.parse(JSON.stringify(v.value))},pe=async e=>{var o,p;if(console.log(ze.data,e.cid,"ssssssssssssssss"),v.value.some(f=>f.setStatus)){(o=window.$message)==null||o.warning("请先对正在编辑中的数据进行操作");return}const{data:t,error:l}=await Xa(e.cid);l||(((p=M.value[M.value.length-1])==null?void 0:p.value)!=t.id&&M.value.push({value:t.id,label:t.devname,disabled:!0,isLeaf:!0,hidden:!0}),Ue.value=t.devcount||0),e.setStatus=!e.setStatus},Fe=(e,t)=>{e.setStatus=!e.setStatus,e.id?v.value=JSON.parse(JSON.stringify(J.debuggedDevieceList)):v.value.splice(t,1)},yt=async e=>{var t,l,o,p,f,x;if(!e.cid){(t=window.$message)==null||t.warning("请选择合同设备");return}if(!e.devname){(l=window.$message)==null||l.warning("设备名称不能为空");return}if(!e.devmodel){(o=window.$message)==null||o.warning("设备型号不能为空");return}if(!e.devnum){(p=window.$message)==null||p.warning("设备数量不能为空");return}if(e.id){const{data:w,error:I}=await Ya([e]);I||((f=window.$message)==null||f.success("修改成功"),X(),e.setStatus=!e.setStatus)}else if(d.rowData.id){const{data:w,error:I}=await Kt([{...e,pid:d.rowData.id}]);I||((x=window.$message)==null||x.success("添加成功"),X(),e.setStatus=!e.setStatus)}else e.setStatus=!e.setStatus};function bt(){var e;((e=v.value[0])!=null&&e.devname||v.value.length==0)&&v.value.unshift({status:void 0,devmanu:"",etype:0,devname:"",devmodel:"",devnum:0,notes:"",setStatus:!0})}const _t=()=>{ke.value=!1},kt=b({}),Z=b([]);async function Je(){var t;Z.value=[];const{data:e}=await ll({page:1,limit:100,pid:(t=d.rowData)==null?void 0:t.id});e.list.forEach(l=>{l.sort==1&&Z.value.push({id:l.id,name:l.filename,url:l.file,status:"finished",creator:l.username,dbtime:l.dbtime})}),Z.value.reverse(),kt.value=JSON.parse(JSON.stringify(e))}const F=[{title:"文件别名",key:"name",align:"center",width:200,render(e){return e.setStatus?r(B,{value:e.name,onUpdateValue:t=>{e.name=t}}):r("div",{},e.name)}},{title:"文件名称",key:"filename",align:"center",width:200,render(e){return e.setStatus&&!e.url?r("div",{style:"display: flex; justify-content: center; align-items: center;"},[r(Yt,{action:"#",showFileList:!1,customRequest:async({file:l,onFinish:o,onError:p})=>{var f,x;try{e.status=!0;const{data:w,error:I}=await _l(l.file,ie=>{e.progress=ie});w&&(e.url=w,e.status=!1)}catch(w){console.error(w),(x=(f=window.$message)==null?void 0:f.error)==null||x.call(f,"文件上传出错"),e.status=!1}}},{default:()=>r(y,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})}),e.progress?r(vt,{type:"line",percentage:e.progress,indicatorPlacement:"inside",processing:!0}):null]):e.setStatus&&e.url&&!e.id?a("span",null,[e.url.split("?")[1],g(" "),a("span",{onClick:()=>{e.url="",e.progress=0},style:"color: red;cursor: pointer;font-size: 12px;"},[g("删除")])]):r("div",{},e.url.split("?")[1])}},{title:"上传人",key:"creator",align:"center",width:100,render(e){return r("div",{},e.creator)}},{title:"上传时间",key:"dbtime",align:"center",width:200,render(e){return r("div",{},e.dbtime?e.dbtime:"")}},{title:"操作",key:"actions",align:"center",width:180,render(e){return r(re,{justify:"center"},[!e.setStatus&&e.id&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{Pt(e)}},{default:()=>"下载"}),e.setStatus&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{Ca(e)}},{default:()=>"保存"}),e.setStatus&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{e.setStatus=!e.setStatus}},{default:()=>"取消"}),!e.setStatus&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{e.setStatus=!e.setStatus}},{default:()=>"编辑"}),wt("project:File:delete")&&(_.userInfo.usertype==0||_.userInfo.usertype==2)&&r(Se,{onPositiveClick:async()=>{var t;if(e.id){const{data:l,error:o}=await gl(e.url),{data:p,error:f}=await vl(e.id);f||(t=window.$message)==null||t.success("删除成功")}else Z.value=Z.value.filter(l=>l!==e)}},{default:()=>A("common.confirmDelete"),trigger:()=>r(y,{type:"error",ghost:!0,size:"small"},{default:()=>A("common.delete")})})])}}],$e=[{title:"文件名称",key:"filename",align:"center",render(e){if(!e.url){const t=async({file:o,onFinish:p,onError:f})=>{var x,w;try{e.status=!0;const I=await hl(o.file,o.name,"",ie=>{e.progress=ie});I&&(e.url=I,e.name=o.name,e.status=!1)}catch(I){console.error(I),(w=(x=window.$message)==null?void 0:x.error)==null||w.call(x,"文件上传出错"),e.status=!1}};async function l(o){var p;return o.file.file.size>100*1024*1024?((p=window.$message)==null||p.error("文件大小不能超过100M"),!1):!0}return r("div",{style:"display: flex; justify-content: center; align-items: center;"},[r(Yt,{action:"#",showFileList:!1,customRequest:t,onBeforeUpload:l},{default:()=>r(y,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})}),e.progress?r(vt,{type:"line",percentage:e.progress,indicatorPlacement:"inside",processing:!0}):null])}return e.url&&!e.id?a("span",null,[e.url.split("?")[1],g(" "),a("span",{onClick:()=>{e.url="",e.progress=0,e.status=!1},style:"color: red;cursor: pointer;font-size: 12px;"},[g("删除")])]):r("div",{},e.url.split("?")[1])}},{title:"文件别名",key:"name",align:"center",render(e){return r(B,{value:e.name,onUpdateValue:t=>{e.name=t}})}},{title:"操作",key:"actions",align:"center",width:100,render(e){return r(re,{justify:"center"},[r(y,{type:"error",size:"small",ghost:!0,onClick:()=>{z.value=z.value.filter(t=>t!==e)}},{default:()=>"删除"})])}}];async function Pt(e){if(e!=null&&e.url)try{const l=await(await fetch(e.url.split("?")[0],{mode:"cors"})).blob(),o=URL.createObjectURL(l),p=document.createElement("a");p.href=o,p.download=e.url.split("?")[1],p.style.display="none",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(o)}catch(t){console.error("下载失败:",t)}}const ka=()=>{var e,t;if(z.value.length>=4)return(t=(e=window.$message)==null?void 0:e.warning)==null?void 0:t.call(e,"最多上传4个文件");z.value.push({id:"",name:"",url:"",status:!1,setStatus:!0,progress:0})},xa=()=>{Z.value.push({id:"",name:"",url:"",status:!1,setStatus:!0})},Ca=async e=>{var t,l,o,p,f,x,w,I,ie,Ae,Le,Ne;if(!e.name){(l=(t=window.$message)==null?void 0:t.warning)==null||l.call(t,"请输入文件别名");return}if(!e.url){(p=(o=window.$message)==null?void 0:o.warning)==null||p.call(o,"请上传文件");return}if((f=d.rowData)!=null&&f.id){const{data:Y,error:he}=await ea([{pid:(x=d.rowData)==null?void 0:x.id,filename:e.name,file:e.url,sort:1}]);if(he)return(w=window.$message)==null?void 0:w.error("保存文件记录失败");(I=window.$message)==null||I.destroyAll(),e.setStatus=!e.setStatus,Je(),(ie=window.$message)==null||ie.success("保存成功")}else if(e.id){const{data:Y,error:he}=await yl([{id:e.id,filename:e.name}]);if(he)return(Ae=window.$message)==null?void 0:Ae.error("保存文件记录失败");(Le=window.$message)==null||Le.destroyAll(),e.setStatus=!e.setStatus,(Ne=window.$message)==null||Ne.success("编辑成功")}else e.setStatus=!e.setStatus},Sa=Wa(()=>({add:"新增项目",edit:"修改项目"})[d.operateType]),je=zt(W,"visible");mt(je,()=>{je.value&&(ye(),setTimeout(()=>{const e=document.querySelector(".n-scrollbar-content");e==null||e.scrollTo(0,0)},300),we())});function wa(e){e||Pe()}function Pe(){je.value=!1}async function It(){var e;await de(),(e=window.$dialog)==null||e.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await Da()}})}async function Da(){var e,t,l,o,p,f,x,w,I,ie,Ae,Le,Ne;if(d.operateType==="edit"){const Y=JSON.parse(JSON.stringify(s));N.value==Y.period&&delete Y.period,me.value==Y.status&&delete Y.status;const{data:he,error:Xe}=await fa([Y]);if(!Xe){let c=function(U,q){const te=U.filter(Ce=>!q.includes(Ce)),Ee=q.filter(Ce=>!U.includes(Ce));return{toDelete:te,toAdd:Ee}};if((e=s.dispatchIds)!=null&&e.length&&((t=s.dispatchIds)==null?void 0:t.length)>0){const{toDelete:U,toAdd:q}=c(jt.value,s.dispatchIds);if(q.length>0){const te=q.map(rt=>({pid:s.id,did:rt})),{data:Ee,error:Ce}=await Wt(te)}if(U.length>0){const{data:te,error:Ee}=await nl(U.join(","))}}if((l=s.contractIds)!=null&&l.length&&((o=s.contractIds)==null?void 0:o.length)>0){const{toDelete:U,toAdd:q}=c(Rt.value,s.contractIds);if(q.length>0){const te=q.map(rt=>({pid:s.id,did:rt})),{data:Ee,error:Ce}=await Qt(te)}if(U.length>0){const{data:te,error:Ee}=await sl(U.join(","))}}Pe(),le("submitted"),(p=window.$message)==null||p.success("修改成功")}}else{const Y=il(),{data:he,error:Xe}=await ol([{...s,uuid:Y}]);if(!Xe){const{data:c,error:U}=await rl(Y);if(c){let q=function(j,Be,Vt){return j.map(Ye=>({...Ye,pid:Be}))};if(s.dispatchIds&&s.dispatchIds.length>0){const j=[];(f=s.dispatchIds)==null||f.forEach(Ye=>{j.push({pid:c,did:Ye})});const{data:Be,error:Vt}=await Wt(j)}if(s.contractIds&&s.contractIds.length>0){const j=[];(x=s.contractIds)==null||x.forEach(async Ye=>{j.push({proid:c,conid:Ye})});const{data:Be,error:Vt}=await Qt(j)}const te=[];if(C.value.length>0){const j=q(C.value,c);te.push(qt(j))}if(v.value.length>0){const j=q(v.value,c);te.push(Kt(j))}if($.value.length>0&&te.push(Zt($.value)),(await Promise.allSettled(te)).forEach((j,Be)=>{j.status==="fulfilled"?console.log(`第 ${Be+1} 个请求成功`,j.value):console.error(`第 ${Be+1} 个请求失败`,j.reason)}),!Z.value.length){(w=window.$message)==null||w.destroyAll(),(I=window.$message)==null||I.success("操作成功"),Pe(),le("submitted");return}const Ce=[];Z.value.forEach(j=>{Ce.push({pid:c,filename:j.name,file:j.url,sort:1})});const{data:rt,error:Ma}=await ea(Ce);Ma&&((ie=window.$message)==null||ie.error("保存文件记录失败")),(Ae=window.$message)==null||Ae.destroyAll(),(Le=window.$message)==null||Le.success("操作成功"),Pe(),le("submitted")}}Pe(),le("submitted"),(Ne=window.$message)==null||Ne.success("添加成功")}}const Ie=b(!1),xt=b();let xe=null,Ge=null,et=null,za=null,At=null,ve=null;const ee=Oe({longitude:0,latitude:0});let Ke;const tt=b(!1),se=b(""),at=b([]);let lt=0;async function Lt(){try{if(window._AMapSecurityConfig={securityJsCode:_.userInfo.sdksecret},!xt.value)return;ve=await Bl.load({key:_.userInfo.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),xe=new ve.Map(xt.value,{zoom:18,center:[D.value>0?$.value[D.value-1].longitude:s.longitude,D.value>0?$.value[D.value-1].latitude:s.latitude],viewMode:"3D",resizeEnable:!0}),Ge=new ve.Geocoder,za=new ve.PlaceSearch({city:"全国",pageSize:50}),At=new ve.AutoComplete({city:"全国"}),nt(ve,{lng:D.value>0?$.value[D.value-1].longitude:s.longitude,lat:D.value>0?$.value[D.value-1].latitude:s.latitude}),xe.on("click",e=>{const{lng:t,lat:l}=e.lnglat;Ke=2,ee.latitude=l,ee.longitude=t,nt(ve,{lng:t,lat:l})}),lt=0,St(()=>{window.dispatchEvent(new Event("resize"))})}catch(e){console.error("地图加载失败：",e),lt<ln?(lt++,console.warn(`地图加载失败，正在第 ${lt} 次重试...`),setTimeout(()=>{Lt()},1500)):console.error("地图加载失败，已达到最大重试次数，停止重试")}}const Nt=oa.debounce(async e=>{if(!tt.value||!e.trim()){at.value=[];return}At.search(e,(t,l)=>{var o;console.log(l,"result"),t=="complete"&&l.info=="OK"&&((o=l==null?void 0:l.tips)!=null&&o.length)?at.value=l.tips.map(p=>({label:`${p.name}（${p.district||p.address||"无详细地址"}）`,value:`${p.location.lng}_${p.location.lat}`,raw:p})):at.value=[]})},300);mt(se,e=>{Nt(e)});function Fa(e,t){if(console.log(e,t,"option"),!e)return;const[l,o]=e.split("_").map(Number);!l||!o||(xe.setCenter([l,o]),Ke=1,nt(ve,{lng:l,lat:o}),ee.longitude=l,ee.latitude=o)}const D=b(0);function Ut(e){e?D.value=e:D.value=0,Ie.value=!0,tt.value=!1,Ke=void 0,St(async()=>{await Lt(),setTimeout(()=>{tt.value=!0;const t=document.querySelector(".n-auto-complete input");t==null||t.blur(),console.log(s),s.region&&!s.prosite&&!s.prosite&&Ct(s.region)},500)})}function nt(e,t){et&&xe.remove(et),et=new e.Marker({position:[t.lng,t.lat],map:xe}),xe.add(et),Ge.getAddress(t,async(l,o)=>{l==="complete"&&o.regeocode&&(console.log("result",o),console.log("formattedAddress",o.regeocode.formattedAddress),t.latitude=t.lat,t.longitude=t.lng,Ke==1?s.proaddr=o.regeocode.formattedAddress:Ke==2?(se.value=o.regeocode.formattedAddress,s.proaddr=o.regeocode.formattedAddress,s.provice=Ot(s.proaddr,He.value),await st(s.provice),s.region=Mt(s.proaddr,Te.value)):(se.value=D.value>0?$.value[D.value-1].addr||o.regeocode.formattedAddress:s.prosite||o.regeocode.formattedAddress,setTimeout(async()=>{s.provice=Ot(se.value,He.value),await st(s.provice),s.region=Mt(se.value,Te.value)},300)))})}const jt=b([]),$a=async()=>{const{data:e,error:t}=await ul({page:1,limit:100,pid:d.rowData.id});s.dispatchIds=e==null?void 0:e.list.map(l=>l.did),jt.value=JSON.parse(JSON.stringify(s.dispatchIds))},Tt=b([]),Et=async e=>{if(!e)return;const{data:t,error:l}=await dl({page:1,limit:100,province:e});Tt.value=t.list},He=b([]),Pa=async()=>{const{data:e,error:t}=await ma();e&&(He.value=e)},Bt=e=>{st(e),s.region=null,s.prosite="",s.proaddr="",se.value="",Et(e)},Ct=e=>{var l;const t=(l=Te.value.find(o=>o.id===e))==null?void 0:l.name;s.region&&s.prosite&&s.proaddr&&!Ge?(s.prosite="",s.proaddr=""):Ia(t)},Te=b([]),st=async e=>{var o;if(!e)return(o=window.$message)==null?void 0:o.warning("请先选择省份");const{data:t,error:l}=await ga({province:e});t&&(Te.value=t)};function Ia(e){!e||!Ge||!xe||Ge.getLocation(e,(t,l)=>{var o;if(t==="complete"&&((o=l.geocodes)!=null&&o.length)){const{location:p,formattedAddress:f}=l.geocodes[0],x=p.lng,w=p.lat;xe.setZoomAndCenter(14,[x,w]),ee.longitude=x,ee.latitude=w,s.latitude=ee.latitude,s.longitude=ee.longitude,nt(ve,{lng:x,lat:w}),s.proaddr=f,s.prosite=f,se.value=f}})}function Ot(e,t){let l=null;for(const o of t)if(e.includes(o.name)){l=o.id;break}return l}function Mt(e,t){let l=null;for(const o of t)if(e.includes(o.name)){l=o.id;break}return l}const Aa=async()=>{var e,t,l;if(D.value==0)s.latitude=ee.latitude,s.longitude=ee.longitude,s.prosite=se.value;else if($.value[D.value-1].addr=se.value,$.value[D.value-1].latitude=ee.latitude,$.value[D.value-1].longitude=ee.longitude,d.operateType=="edit"){let o=$.value[D.value-1];if($.value[D.value-1].id){const{data:p,error:f}=await cl([o]);p&&((e=window.$message)==null||e.success("修改位置成功"),Ie.value=!1,D.value=0,ot())}else{o.pid=(t=d.rowData)==null?void 0:t.id;const{data:p,error:f}=await Zt([o]);p&&((l=window.$message)==null||l.success("添加位置成功"),Ie.value=!1,D.value=0,ot())}}Ie.value=!1,D.value=0};function La(){Ie.value=!1}const{pageData:it,getData:Na,nextPage:Ua}=aa(pl),ja=async()=>{await Na({limit:100})},Ta=async e=>{const t=e.currentTarget,l=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&it.data.length<it.total&&(await Ua(),await St(),setTimeout(()=>{t.scrollTop=l}))},Rt=b([]),Ea=async()=>{var l;const{data:e,error:t}=await fl({page:1,limit:100,proid:(l=d.rowData)==null?void 0:l.id});s.contractIds=e==null?void 0:e.list.map(o=>o.conid),Rt.value=JSON.parse(JSON.stringify(s.contractIds))},$=b([{longitude:120.373885,latitude:30.303899,addr:""}]),Ba=b([]),ot=async()=>{var l;const{data:e,error:t}=await ml({pid:(l=d.rowData)==null?void 0:l.id,page:1,limit:99});$.value=e.list.length==0?[{longitude:120.373885,latitude:30.303899,addr:""}]:e.list,Ba.value=JSON.parse(JSON.stringify($.value))},Oa=async e=>{var t;if(e.id){const{data:l,error:o}=await bl(e.id);l&&((t=window.$message)==null||t.success("删除成功"),ot())}else $.value.splice($.value.indexOf(e),1)};return(e,t)=>{const l=ba,o=_a,p=Tl,f=el,x=jl,w=na,I=gt,ie=ya,Ae=ra,Le=Za,Ne=Qa,Y=da,he=al,Xe=El;return P(),ct(Ht,null,[a(Ne,{show:je.value,"onUpdate:show":[t[16]||(t[16]=c=>je.value=c),wa],"display-directive":"show",width:1100,onMaskClick:t[17]||(t[17]=c=>je.value=!0),onEsc:Pe},{default:i(()=>[a(Le,{title:Sa.value,"native-scrollbar":!1,closable:""},{footer:i(()=>[a(u(re),{size:16,justify:"end"},{default:i(()=>[a(u(y),{onClick:Pe},{default:i(()=>[g(G(u(A)("common.cancel")),1)]),_:1}),a(u(y),{type:"primary",onClick:It},{default:i(()=>t[32]||(t[32]=[g(G("保存"))])),_:1,__:[32]})]),_:1})]),default:i(()=>[a(Ae,{ref_key:"formRef",ref:R,model:s,rules:De,onKeyup:ua(It,["enter"])},{default:i(()=>[a(ie,{responsive:"screen","item-responsive":"","x-gap":"15"},{default:i(()=>[a(l,{span:"24 s:12 m:12",label:"项目名称",path:"proname"},{default:i(()=>[a(u(B),{clearable:"",value:s.proname,"onUpdate:value":t[0]||(t[0]=c=>s.proname=c),placeholder:"请输入项目名称"},null,8,["value"])]),_:1}),d.operateType==="add"?(P(),O(l,{key:0,span:"24 s:12 m:12",label:"绑定合同",path:"contractIds"},{default:i(()=>[a(u(ae),{filterable:"",multiple:"",value:s.contractIds,"onUpdate:value":[t[1]||(t[1]=c=>s.contractIds=c),L],placeholder:"请选择合同","label-field":"contractname","value-field":"id",options:u(it).data,onScroll:Ta},null,8,["value","options"])]),_:1})):oe("",!0),d.operateType==="edit"?(P(),O(l,{key:1,span:"24 s:12 m:12",label:"项目状态",path:"status"},{default:i(()=>[a(u(ae),{filterable:"",value:s.status,"onUpdate:value":t[2]||(t[2]=c=>s.status=c),placeholder:"请选择项目状态",options:u(Ze)(u(_).userInfo.usertype==0||u(_).userInfo.usertype==2?u($t):u(Ol))},null,8,["value","options"])]),_:1})):oe("",!0),a(l,{span:"24 s:12 m:12",label:"周期（天）",path:"period"},{default:i(()=>[a(u(Jt),{clearable:"",value:s.period,"onUpdate:value":t[3]||(t[3]=c=>s.period=c),style:{width:"100%"},placeholder:"请输入周期"},null,8,["value"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"计划调试时间",path:"plantime"},{default:i(()=>[a(o,{size:"small","formatted-value":s.plantime,"onUpdate:formattedValue":t[4]||(t[4]=c=>s.plantime=c),type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"调试类型",path:"dtype"},{default:i(()=>[a(u(ae),{filterable:"",value:s.dtype,"onUpdate:value":t[5]||(t[5]=c=>s.dtype=c),placeholder:"请选择调试类型",options:u(Ze)(u(ha))},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"省份",path:"provice"},{default:i(()=>[a(u(ae),{filterable:"",value:s.provice,"onUpdate:value":[t[6]||(t[6]=c=>s.provice=c),Bt],placeholder:"请选择省份","label-field":"name","value-field":"id",options:He.value},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"地区",path:"region"},{default:i(()=>[a(u(ae),{filterable:"",value:s.region,"onUpdate:value":[t[7]||(t[7]=c=>s.region=c),Ct],placeholder:"请选择地区","label-field":"name","value-field":"id",options:Te.value},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"项目默认地点",path:"prosite"},{default:i(()=>[T("div",Kl,[T("div",Hl,[a(f,{onClick:t[9]||(t[9]=c=>Ut())},{default:i(()=>[a(u(B),{value:s.prosite,"onUpdate:value":t[8]||(t[8]=c=>s.prosite=c),placeholder:"请选择项目地点"},null,8,["value"]),a(u(y),null,{icon:i(()=>[a(p,{class:"text-icon"})]),_:1})]),_:1})])])]),_:1}),a(l,{span:"24 s:12 m:12",label:"项目详细地址",path:"proaddr"},{default:i(()=>[a(u(B),{type:"textarea",rows:1,clearable:"",value:s.proaddr,"onUpdate:value":t[10]||(t[10]=c=>s.proaddr=c),placeholder:"请输入项目详细地址"},null,8,["value"])]),_:1}),$.value.length?(P(),O(l,{key:2,span:"24 s:12 m:24",label:"",path:""},{default:i(()=>[T("div",Xl,[T("div",Yl,[T("span",{class:"mr-10px",onClick:t[11]||(t[11]=Xt(()=>{},["stop"]))},"其他地址"),a(u(y),{size:"small",ghost:"",type:"primary",onMousedown:t[12]||(t[12]=Xt(()=>{},["stop"])),onClick:t[13]||(t[13]=c=>$.value.push({latitude:30.303899,longitude:120.373885,addr:""}))},{icon:i(()=>[a(x,{class:"text-icon"})]),default:i(()=>[t[24]||(t[24]=g(" 添加 "))]),_:1,__:[24]})]),T("div",Wl,[(P(!0),ct(Ht,null,tl($.value,(c,U)=>(P(),ct("div",{class:"flex px-50px items-center mt-10px w-100%",key:c.latitude},[T("span",Ql,"项目地址"+G(U+1),1),a(f,{onClick:q=>Ut(U+1)},{default:i(()=>[a(u(B),{readonly:"",value:c.addr,"onUpdate:value":q=>c.addr=q,placeholder:"请选择项目地址"+(U+1)},null,8,["value","onUpdate:value","placeholder"]),a(u(y),null,{icon:i(()=>[a(p,{class:"text-icon"})]),_:1})]),_:2},1032,["onClick"]),$.value.length>1?(P(),O(u(Se),{key:0,onPositiveClick:q=>Oa(c)},{trigger:i(()=>[a(u(y),{size:"small",ghost:"",type:"error",class:"ml-10px"},{icon:i(()=>[a(w,{class:"text-icon"})]),default:i(()=>[t[25]||(t[25]=g(" "+G("删除")))]),_:1,__:[25]})]),default:i(()=>[g(" 确定要删除项目地址"+G(U+1)+"吗？ ",1)]),_:2},1032,["onPositiveClick"])):oe("",!0)]))),128))])])]),_:1})):oe("",!0),a(l,{span:"24 s:12 m:12",label:"调度名称",path:"dispatch"},{default:i(()=>[a(u(B),{clearable:"",value:s.dispatch,"onUpdate:value":t[14]||(t[14]=c=>s.dispatch=c),placeholder:"请输入调度名称"},null,8,["value"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"选择调度",path:"dispatchIds"},{default:i(()=>[a(u(ae),{filterable:"",multiple:"",value:s.dispatchIds,"onUpdate:value":t[15]||(t[15]=c=>s.dispatchIds=c),placeholder:"请选择调度","label-field":"dname","value-field":"id",options:Tt.value},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:24",path:"contactList"},{default:i(()=>[T("div",Zl,[a(u(re),{align:"center",style:{"margin-bottom":"10px"}},{default:i(()=>[t[27]||(t[27]=T("span",null,"项目联系人",-1)),a(u(y),{size:"small",ghost:"",type:"primary",onClick:E},{icon:i(()=>[a(x,{class:"text-icon"})]),default:i(()=>[t[26]||(t[26]=g(" 添加项目联系人 "))]),_:1,__:[26]})]),_:1,__:[27]}),C.value.length>0?(P(),O(I,{key:0,columns:K,"paginate-single-page":!1,data:C.value,pagination:Q,"max-height":350,"scroll-x":K.reduce((c,U)=>c+U.width,0)},null,8,["data","pagination","scroll-x"])):oe("",!0)])]),_:1}),a(l,{span:"24 s:12 m:24",path:"debuggedDevieceList"},{default:i(()=>[T("div",en,[a(u(re),{align:"center",style:{"margin-bottom":"10px"}},{default:i(()=>[t[29]||(t[29]=T("span",null,"待调试设备",-1)),a(u(y),{size:"small",ghost:"",type:"primary",onClick:bt},{icon:i(()=>[a(x,{class:"text-icon"})]),default:i(()=>[t[28]||(t[28]=g(" 添加待调试设备 "))]),_:1,__:[28]})]),_:1,__:[29]}),v.value.length>0?(P(),O(I,{key:0,style:{width:"1050px"},columns:qe,data:v.value,size:"small","scroll-x":qe.reduce((c,U)=>c+U.width,0),"row-key":c=>c.id,"max-height":350,pagination:H.pageSize==1?!1:H,remote:"","paginate-single-page":!1},null,8,["data","scroll-x","row-key","pagination"])):oe("",!0)])]),_:1}),a(l,{span:"24 s:12 m:24"},{default:i(()=>[T("div",tn,[a(u(re),{align:"center",style:{"margin-bottom":"10px"}},{default:i(()=>[t[31]||(t[31]=T("span",null,"图纸",-1)),a(u(y),{size:"small",ghost:"",type:"primary",onClick:xa},{icon:i(()=>[a(x,{class:"text-icon"})]),default:i(()=>[t[30]||(t[30]=g(" 添加图纸 "))]),_:1,__:[30]})]),_:1,__:[31]}),Z.value.length>0?(P(),O(I,{key:0,columns:F,data:Z.value,size:"small","scroll-x":702,"row-key":c=>c.id,"max-height":350},null,8,["data","row-key"])):oe("",!0)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"]),a(Y,{show:ke.value,"onUpdate:show":t[18]||(t[18]=c=>ke.value=c),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:i(()=>[g(G(ne.value=="debuggedDevieceList"?"待调试设备":ne.value=="debuggedBusinessList"?"待调试业务":ne.value=="needsList"?"客户需求变更":ne.value=="developBusinessList"?"需要开发":"")+" 文件列表 ",1)]),footer:i(()=>[a(u(re),{justify:"end"},{default:i(()=>[a(u(y),{size:"small",class:"mt-16px",onClick:_t},{default:i(()=>[g(G(u(A)("common.cancel")),1)]),_:1}),a(u(y),{type:"primary",size:"small",class:"mt-16px",onClick:ge},{default:i(()=>[g(G(u(A)("common.confirm")),1)]),_:1})]),_:1})]),default:i(()=>[a(u(y),{size:"small",ghost:"",type:"primary",onClick:ka},{icon:i(()=>[a(x,{class:"text-icon"})]),default:i(()=>[t[33]||(t[33]=g(" 添加 "))]),_:1,__:[33]}),a(I,{columns:$e,"paginate-single-page":!1,data:z.value,"max-height":350},null,8,["data"])]),_:1},8,["show"]),a(Y,{show:Ie.value,"onUpdate:show":t[23]||(t[23]=c=>Ie.value=c),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:i(()=>[a(u(re),{justify:"end",size:16},{default:i(()=>[a(u(y),{onClick:La},{default:i(()=>[g(G(u(A)("common.cancel")),1)]),_:1}),a(u(y),{type:"primary",onClick:Aa},{default:i(()=>[g(G(u(A)("common.confirm")),1)]),_:1})]),_:1})]),default:i(()=>[a(u(re),null,{default:i(()=>[a(he,{label:"省份",path:"provice","label-placement":"left","label-width":"70"},{default:i(()=>[a(u(ae),{filterable:"",value:s.provice,"onUpdate:value":[t[19]||(t[19]=c=>s.provice=c),Bt],placeholder:"请选择省份","label-field":"name","value-field":"id",options:He.value},null,8,["value","options"])]),_:1}),a(he,{label:"地区",path:"region","label-placement":"left","label-width":"70"},{default:i(()=>[a(u(ae),{filterable:"",value:s.region,"onUpdate:value":[t[20]||(t[20]=c=>s.region=c),Ct],placeholder:"请选择地区","label-field":"name","value-field":"id",options:Te.value},null,8,["value","options"])]),_:1})]),_:1}),tt.value?(P(),O(he,{key:0,label:D.value==0?"项目地址":"项目地址"+D.value,"label-placement":"left"},{default:i(()=>[T("div",an,[a(Xe,{value:se.value,"onUpdate:value":[t[21]||(t[21]=c=>se.value=c),u(Nt)],options:at.value,style:{"margin-bottom":"7px"},placeholder:"请输入地点关键字",clearable:"",onSelect:Fa},null,8,["value","options","onUpdate:value"]),D.value==0?(P(),O(u(B),{key:0,type:"textarea",rows:2,clearable:"",value:s.proaddr,"onUpdate:value":t[22]||(t[22]=c=>s.proaddr=c),placeholder:"请输入详细地址"},null,8,["value"])):oe("",!0)])]),_:1},8,["label"])):oe("",!0),T("div",{ref_key:"domRef",ref:xt,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])],64)}}}),sn=ht({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:pt(["reset","search"],["update:model"]),setup(W,{emit:ue}){kl();const _=ue,{formRef:le,restoreValidation:J}=ia(),d=zt(W,"model"),s={当日:()=>{const h=new Date().getTime();return[h,h]},本周:()=>{const h=new Date().getTime();return[h-24*60*60*1e3*7,h]},上月:()=>{const h=new Date().getTime();return[h-24*60*60*1e3*30,h]},近一年:()=>{const h=new Date().getTime();return[h-24*60*60*1e3*365,h]},近三年:()=>{const h=new Date().getTime();return[h-24*60*60*1e3*365*3,h]}};function fe(){d.value.fuzzy="",_("search")}const N=b([]);(async()=>{const{data:h,error:k}=await ma();h&&(N.value=h)})();const ye=h=>{we(h),d.value.regions=null,d.value.region=null,_("search")},R=h=>{var k;d.value.region=h,d.value.regions=(k=d.value.region)==null?void 0:k.join(","),_("search")},de=b([]),we=async h=>{var E;if(!h)return(E=window.$message)==null?void 0:E.warning("请先选择省份");const{data:k,error:be}=await ga({province:h});k&&(de.value=k)};async function De(h,k){if(!h){d.value.startTime=void 0,d.value.endTime=void 0,_("search");return}d.value.startTime=String(ft(1,k[0])),d.value.endTime=String(ft(1,k[1])),_("search")}async function C(){d.value.startTime=void 0,d.value.endTime=void 0,d.value.startAndTimeRange=null,d.value.fuzzy="",d.value.status=null,d.value.ptype=null,d.value.dtype=null,d.value.region=null,d.value.regions=null,d.value.provice=null,await J(),_("reset")}const Q=oa.debounce(h=>{_("search")},1e3,{leading:!0,trailing:!1}),K=h=>{d.value.fuzzy=h,Q(h)};async function S(){_("search")}return(h,k)=>{const be=B,E=ba,L=ae,M=_a,Me=ql,ce=y,_e=Vl,ze=re,Re=ya,V=ra,Ve=Ft;return P(),O(Ve,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[a(V,{ref_key:"formRef",ref:le,model:d.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ua(S,["enter"])},{default:i(()=>[a(Re,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:i(()=>[a(E,{span:"24 s:12 m:6",label:"项目/客户",path:"fuzzy"},{default:i(()=>[a(be,{clearable:"",value:d.value.fuzzy,"onUpdate:value":k[0]||(k[0]=v=>d.value.fuzzy=v),placeholder:"请输入项目名称或客户名称",onClear:fe,onInput:K},null,8,["value"])]),_:1}),a(E,{span:"24 s:12 m:6",label:"项目状态",path:"status"},{default:i(()=>[a(L,{clearable:"",filterable:"",value:d.value.status,"onUpdate:value":[k[1]||(k[1]=v=>d.value.status=v),S],placeholder:"请选择项目状态",options:u(Ze)(u($t)).sort((v,H)=>v.value-H.value)},null,8,["value","options"])]),_:1}),a(E,{span:"24 s:12 m:6",label:"进度状态",path:"ptype"},{default:i(()=>[a(L,{clearable:"",filterable:"",value:d.value.ptype,"onUpdate:value":[k[2]||(k[2]=v=>d.value.ptype=v),S],placeholder:"请选择进度状态",options:[{label:"正常",value:0},{label:"已延期",value:1}]},null,8,["value"])]),_:1}),a(E,{span:"24 s:12 m:6",label:"调试类型",path:"dtype"},{default:i(()=>[a(L,{clearable:"",filterable:"",value:d.value.dtype,"onUpdate:value":[k[3]||(k[3]=v=>d.value.dtype=v),S],placeholder:"请选择调试类型",options:u(Ze)(u(ha))},null,8,["value","options"])]),_:1}),a(E,{span:"24 s:12 m:6",label:"省份",path:"provice"},{default:i(()=>[a(L,{filterable:"",value:d.value.provice,"onUpdate:value":[k[4]||(k[4]=v=>d.value.provice=v),ye],placeholder:"请选择省份","label-field":"name","value-field":"id",clearable:"",options:N.value},null,8,["value","options"])]),_:1}),a(E,{span:"24 s:12 m:6",label:"地区",path:"region"},{default:i(()=>[a(L,{filterable:"",value:d.value.region,"onUpdate:value":[k[5]||(k[5]=v=>d.value.region=v),R],placeholder:"请选择地区","label-field":"name","value-field":"id",clearable:"",multiple:"",options:de.value},null,8,["value","options"])]),_:1}),a(E,{span:"24 s:12 m:8",label:"起止时间"},{default:i(()=>[a(M,{value:d.value.startAndTimeRange,"onUpdate:value":k[6]||(k[6]=v=>d.value.startAndTimeRange=v),type:"datetimerange",clearable:"",shortcuts:s,"onUpdate:formattedValue":De},null,8,["value"])]),_:1}),a(E,{span:"24  s:12 m:4",class:"pr-24px"},{default:i(()=>[a(ze,{class:"w-full"},{default:i(()=>[a(ce,{onClick:C},{icon:i(()=>[a(Me,{class:"text-icon"})]),default:i(()=>[g(" "+G(u(A)("common.reset")),1)]),_:1}),a(ce,{type:"primary",ghost:"",onClick:S},{icon:i(()=>[a(_e,{class:"text-icon"})]),default:i(()=>[g(" "+G(u(A)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),on={class:"min-h-500px flex gap-16px"},rn={class:"flex items-center justify-end gap-16px"},un=ht({__name:"relatedContractLook",props:pt({id:{}},{visable:{type:Boolean},visableModifiers:{}}),emits:["update:visable"],setup(W){const ue=W,_=zt(W,"visable"),{columns:le,data:J,getData:d,loading:s,mobilePagination:fe,searchParams:N}=Dt({apiFn:ca,immediate:!1,apiParams:{page:1,pageSize:20,limit:20,id:ue.id,_t:new Date().getTime()},columns:()=>[{key:"contractname",title:"合同",width:200,render:S=>a("div",{class:C.pids==S.id?"bg-#f1f1f1 cursor-pointer p-5px":"cursor-pointer p-5px",onClick:()=>Q(S.id)},[a("div",{class:"flex"},[a("div",{class:"w-60px inline-block"},[g("名称：")]),S.contractname]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[g("编号：")]),g(" "),S.contractnum]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[g("联系人：")]),S.businesscon]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[g("联系方式：")]),S.businessinfo]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[g("注意事项：")]),S.precautions]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[g("备注：")]),S.notes])])}]}),{columns:me,data:ye,getData:R,loading:de,pagination:we,mobilePagination:De,searchParams:C}=Dt({apiFn:pa,immediate:!1,apiParams:{page:1,pageSize:20,limit:20,pids:ue.id,_t:new Date().getTime()},columns:()=>[{key:"devname",title:"设备名称",align:"center",width:200,ellipsis:{tooltip:!0}},{key:"devcount",title:"数量",align:"center",width:120},{key:"devmodel",title:"规格型号",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"devunit",title:"单位",align:"center",width:120},{key:"devtype",title:"是否为我司设备",align:"center",width:120,render:S=>S.devtype==0?a(Qe,{type:"success"},{default:()=>[g("是")]}):a(Qe,{type:"info"},{default:()=>[g("否")]})},{key:"devmanu",title:"设备厂家",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:180}]}),Q=S=>{C.pids=S,R()},K=()=>{_.value=!1};return mt(()=>_.value,async S=>{var h;S&&(N.id=ue.id,ye.value=[],we.itemCount=0,await d(),C.pids=(h=J.value[0])==null?void 0:h.id,C.pids&&R())}),(S,h)=>{const k=gt,be=Ft,E=da;return P(),O(E,{show:_.value,"onUpdate:show":h[0]||(h[0]=L=>_.value=L),preset:"card",class:"w-1400px",title:"项目关联的合同"},{footer:i(()=>[T("div",rn,[a(u(y),{type:"primary",size:"small",onClick:K},{default:i(()=>h[1]||(h[1]=[g(" 关闭 ")])),_:1,__:[1]})])]),default:i(()=>[T("div",on,[a(k,{class:"left",columns:u(le),data:u(J),"paginate-single-page":!1,size:"small",remote:"",loading:u(s),pagination:u(fe),"row-key":L=>L.id,"max-height":600},null,8,["columns","data","loading","pagination","row-key"]),a(be,{bordered:!1,size:"small",title:"设备",class:"w-1100px"},{default:i(()=>[a(k,{style:{width:"100%"},columns:u(me),data:u(ye),size:"small","max-height":600,loading:u(de),remote:"","scroll-x":u(me).reduce((L,M)=>L+(M.width||100),0),"paginate-single-page":!1,pagination:u(De),"row-key":L=>L.id},null,8,["columns","data","loading","scroll-x","pagination","row-key"])]),_:1})])]),_:1},8,["show"])}}}),dn=va(un,[["__scopeId","data-v-a53f455a"]]),cn={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function la(W){return typeof W=="function"||Object.prototype.toString.call(W)==="[object Object]"&&!Nl(W)}const pn=ht({name:"projectmanagement_projectlist",__name:"index",setup(W){const ue=xl(),_=sa(),le=Cl(),J=Sl(),{columns:d,columnChecks:s,data:fe,getData:N,loading:me,mobilePagination:ye,searchParams:R}=Dt({showTotal:!0,apiFn:Al,apiParams:{page:1,pageSize:20,limit:20,status:null,startAndTimeRange:null,startTime:null,endTime:null,creater:void 0,fuzzy:void 0,sort:void 0,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"proname",title:"项目名称",align:"center",width:240,render:n=>a("div",{class:"cursor-pointer",onClick:()=>v(n)},[n.proname+(n.dispatch?`(${n.dispatch})`:"")])},{key:"progess",title:"项目进度",align:"center",width:140,sorter:!0,render:n=>a(vt,{type:"line",showIndicator:!0,percentage:n.progess,"indicator-placement":"inside",processing:!0,color:"#1890ff"},null)},{key:"status",title:"项目状态",align:"center",width:120,defaultFilterOptionValue:null,filterOptions:Ze($t),filter:!0,filterMultiple:!1,render:n=>{if(n.status===null)return null;const m=A(ta[n.status]);return a("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:n.status==-1?"#a27ff9":n.status===0?"#9ca3af":n.status===1?"#3b82f6":n.status===2?"#facc15":"#22c55e",borderRadius:"50%"}},[a("span",{style:{width:"10px",height:"10px",marginRight:"5px",backgroundColor:n.status==-1?"#a27ff9":n.status===0?"#9ca3af":n.status===1?"#3b82f6":n.status===2?"#facc15":"#22c55e",borderRadius:"50%"}},null),a("span",null,[m])])}},{key:"cpdbtime",title:"预计完成日期",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"plantime",title:"计划调试时间",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"period",title:"周期",align:"center",width:100,render:n=>a("div",null,[n.period,g("天")])},{key:"ptype",title:"状态",align:"center",width:80,render:n=>a(Qe,{type:n.ptype===0?"success":"error"},{default:()=>[n.ptype===0?"正常":"已延期"]})},{key:"dtype",title:"调试类型",align:"center",width:100,render:n=>{if(n.dtype===null)return null;const m=A(Ml[n.dtype]);return a(Qe,{type:n.dtype==0?"warning":n.dtype==1?"success":"info"},la(m)?m:{default:()=>[m]})}},{key:"debugs",title:"统计数量信息",align:"center",width:160,render(n){const m=(ge,X,pe)=>{const Fe=pe>0;return r("div",{style:`
                    cursor: ${Fe?"pointer":"default"};
                    color: ${Fe?"#1890ff":"#999"};
                    font-size:13px;
                  `,onClick:()=>Fe&&H(X,n)},`${ge}：${pe}`)};return r("div",{style:"display:flex; flex-direction:column; gap:1px;"},[m("调试任务","business",n.debugs),m("项目总结","projectsummary",n.summarys),m("日报数量","daylog",n.dailys)])}},{key:"businesscon",title:"商务联系人",align:"center",width:200,render(n){return a("div",null,[n.businesscon||"-"])}},{key:"operate",title:A("common.operate"),align:"center",width:320,fixed:"right",render:n=>{let m;return a("div",{class:"flex justify-end gap-8px"},[a("div",{onClick:()=>_e(n),class:"cursor-pointer c-#1890ff mr-10px",title:"工程调试确认单"},[a(Ll,{"local-icon":"icon_resLibrary",class:"font-size-24px"},null)]),n.status==-1&&(_.userInfo.usertype==0||_.userInfo.usertype==4||_.userInfo.id==1021||_.userInfo.id==1023)&&a(Se,{onPositiveClick:()=>k(n,0)},{default:()=>"确定核准该项目吗？",trigger:()=>a(y,{color:"#a43cf9",ghost:!0,size:"small"},{default:()=>["核准"]})}),n.status==0&&(_.userInfo.usertype==0||_.userInfo.usertype==2)&&a(Se,{onPositiveClick:()=>k(n,1)},{default:()=>"确定启动该项目吗？",trigger:()=>We(a(y,{type:"success",ghost:!0,size:"small"},{default:()=>["启动"]}),[[ut("no-auth"),"project:Info:update"]])}),n.status==2&&(_.userInfo.usertype==0||_.userInfo.usertype==2)&&a(Se,{onPositiveClick:()=>k(n,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>We(a(y,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[ut("no-auth"),"project:Info:update"]])}),a(y,{type:"primary",ghost:!0,size:"small",onClick:()=>v(n)},{default:()=>["详情"]}),a(y,{type:"primary",ghost:!0,size:"small",onClick:()=>Me(n)},{default:()=>["关联合同"]}),We(a(y,{type:"primary",ghost:!0,size:"small",onClick:()=>be(n.id)},la(m=A("common.edit"))?m:{default:()=>[m]}),[[ut("no-auth"),"project:Info:update"]])])}}]}),{drawerVisible:de,operateType:we,editingData:De,handleAdd:C,handleEdit:Q,checkedRowKeys:K,onBatchDeleted:S}=Ul(fe,N);async function h(){console.log(K.value),E(K.value.join(","),n=>{S()})}const k=async(n,m)=>{var pe;const{data:ge,error:X}=await fa([{id:n.id,status:m}]);X||((pe=window.$message)==null||pe.success("操作成功"),N(),m==3&&window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:n.pid,type:"prj"}})))};function be(n){Q(n)}async function E(n,m){const{data:ge,error:X}=await Pl(n);if(!X)m&&m(ge);else return!1}const L=b(!1),M=b(0),Me=n=>{L.value=!0,M.value=n.id},ce=b(!1),_e=n=>{ce.value=!0,M.value=n.id},ze=n=>{R.status=n.status,N()},Re=n=>{console.log(n),n.columnKey=="progess"&&(R.sort=n.order=="ascend"?0:n.order=="descend"?1:void 0,N())},V=b(1),Ve=n=>{V.value=n,n==0?N():ne()},v=n=>{le.push("/projectmanagement/orderdetail?prjId="+n.id+"&pname="+n.proname),_.setProjectInfo({pid:n.id,pname:n.proname})},H=(n,m)=>{le.push(`/projectmanagement/${n}?prjId=`+m.id+"&pname="+m.proname),_.setProjectInfo({pid:m.id,pname:m.proname})},Ue=()=>{N()};wl(()=>{_.userInfo.usertype==1&&(V.value=0),J.query.pname?(V.value=0,R.fuzzy=J.query.pname,R.status=2,Ue(),N()):ne()}),mt(()=>J.query.pname,n=>{n&&!J.query.prjId&&(R.fuzzy=n,V.value=0,N())});const qe=[{key:"proname",width:320,title(){return a("div",{class:"font-size-16px font-bold"},[g("近期项目")])},ellipsis:{tooltip:!0},render:n=>{if(n.status===null)return null;const m=A(ta[n.status]);return a("div",null,[a(Il,{placement:"top",trigger:"hover"},{trigger:()=>a("div",{class:"cursor-pointer text-ellipsis overflow-hidden whitespace-nowrap font-bold",onClick:()=>v(n),style:"max-width: 300px;"},[n.proname||"-"]),default:()=>n.proname||"-"}),a("div",{style:"display:flex; gap:3px; line-height:1.4;"},[a("div",{class:" flex"},[a("span",{style:"color:#666"},[g("进度：")]),a(vt,{type:"line",style:"width: 100px;",showIndicator:!0,percentage:n.progess,"indicator-placement":"inside",processing:!0,color:n.progess==100?"#22C55E":"#1890ff"},null)]),a("div",{class:" flex ml-8px"},[a("span",{style:"color:#666 flex"},[g("状态：")]),a("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:n.status===0?"#9ca3af":n.status===1?"#3B82F6":n.status===2?"#f1c40f":"#2ecc71",borderRadius:"50%"}},[a("span",{style:{width:"10px",height:"10px",marginRight:"5px",backgroundColor:n.status===0?"#9ca3af":n.status===1?"#3B82F6":n.status===2?"#f1c40f":"#2ecc71",borderRadius:"50%"}},null),a("span",null,[m])])])])])}},{key:"businesscon",title:"商务联系人",align:"center",width:100},{title:"最后打卡人",key:"clockinusername",align:"center",width:100},{title:"最后打卡时间",key:"lastclockintime",align:"center",width:180},{key:"clockincounts",title:"打卡信息",align:"left",width:200,render(n){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[g("打卡人数：")]),a("span",{style:"font-weight:500"},[n.clockincounts!=null?n.clockincounts+"人":"-"])]),a("div",null,[a("span",{style:"color:#666"},[g("打卡人：")]),a("span",{style:" font-weight:500"},[n.clockinusers||"-"])])])}},{key:"debugname",title:"调试任务信息",align:"left",width:260,render(n){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[g("任务名称：")]),a("span",{style:"font-weight:500"},[n.debugname||"-"])]),a("div",null,[a("span",{style:"color:#666"},[g("状态：")]),a(Qe,{size:"small",color:{color:n.debugstatus==-1?"rgba(251, 146, 60, 0.15)":n.debugstatus==0?"rgba(156, 163, 175, 0.15)":n.debugstatus==1?"rgba(59, 130, 246, 0.15)":n.debugstatus==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:n.debugstatus==-1?"#FB923C":n.debugstatus==0?"#9CA3AF":n.debugstatus==1?"#3B82F6":n.debugstatus==2?"#FACC15":"#10B981",borderColor:n.debugstatus==-1?"#FB923C":n.debugstatus==0?"#9CA3AF":n.debugstatus==1?"#3B82F6":n.debugstatus==2?"#FACC15":"#10B981"}},{default:()=>[n.debugstatus==-1?"申请中":n.debugstatus==0?"待调试":n.debugstatus==1?"开始调试":n.debugstatus==2?"待审核":"审核完成"]})])])}},{key:"username",title:"调试信息",align:"left",width:230,render(n){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[g("时间：")]),a("span",{style:" font-weight:500"},[n.dbdbtime||"-"])]),a("div",null,[a("span",{style:"color:#666"},[g("调试人：")]),a("span",{style:"font-weight:500"},[n.username||"-"])])])}},{title:"任务审核时间",key:"ckdbtime",width:180}],z=Oe({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${z.itemCount} 条`,onChange:n=>{z.page=n,ne()},onUpdatePageSize:n=>{z.pageSize=n,z.page=1,ne()}}),ke=b([]),ne=async()=>{const{data:n,error:m}=await Dl({page:z.page,limit:z.pageSize});m||(ke.value=n.list,z.itemCount=n.total)};return(n,m)=>{const ge=Gl,X=$l,pe=re,Fe=Va,yt=na,bt=Ra,_t=gt,kt=gt,Z=Ft,Je=ut("no-auth");return P(),ct("div",cn,[V.value==0?(P(),O(sn,{key:0,model:u(R),"onUpdate:model":m[0]||(m[0]=F=>dt(R)?R.value=F:null),onReset:Ue,onSearch:u(N)},null,8,["model","onSearch"])):oe("",!0),a(Z,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},zl({header:i(()=>[a(pe,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:i(()=>[m[7]||(m[7]=T("div",null,"项目列表",-1)),u(_).userInfo.usertype!==1?(P(),O(X,{key:0,size:"small",value:V.value,"onUpdate:value":[m[1]||(m[1]=F=>V.value=F),Ve],name:"radiobuttongroup1"},{default:i(()=>[a(ge,{value:0,label:"默认"}),a(ge,{value:1,label:"近期项目"})]),_:1},8,["value"])):oe("",!0)]),_:1,__:[7]})]),default:i(()=>[V.value==0?(P(),O(_t,{key:0,"checked-row-keys":u(K),"onUpdate:checkedRowKeys":m[3]||(m[3]=F=>dt(K)?K.value=F:null),columns:u(d),data:u(fe),size:"small","flex-height":!u(ue).isMobile,"scroll-x":u(d).reduce((F,$e)=>F+(($e==null?void 0:$e.width)||100),0),loading:u(me),remote:"","row-key":F=>F.id,"onUpdate:sorter":Re,pagination:u(ye),class:"sm:h-full","onUpdate:filters":ze},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"])):(P(),O(kt,{key:1,ref:"tableContainer",class:"sm:h-full",remote:"",pagination:z.pageSize==1?!1:z,"scroll-x":qe.reduce((F,$e)=>F+($e.width||100),0),columns:qe,data:ke.value,bordered:!1,"flex-height":!u(ue).isMobile},null,8,["pagination","scroll-x","data","flex-height"])),a(nn,{visible:u(de),"onUpdate:visible":m[4]||(m[4]=F=>dt(de)?de.value=F:null),onSubmitted:u(N),"operate-type":u(we),"row-data":u(De)},null,8,["visible","onSubmitted","operate-type","row-data"]),a(dn,{visable:L.value,"onUpdate:visable":m[5]||(m[5]=F=>L.value=F),id:M.value},null,8,["visable","id"])]),_:2},[V.value==0?{name:"header-extra",fn:i(()=>[a(pe,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:i(()=>[We((P(),O(u(y),{onClick:u(C),size:"small",ghost:"",type:"primary"},{icon:i(()=>[a(Fe,{class:"text-icon"})]),default:i(()=>[m[8]||(m[8]=g(" "+G("新增项目")))]),_:1,__:[8]},8,["onClick"])),[[Je,"project:Info:insert"]]),a(u(Se),{onPositiveClick:h},{trigger:i(()=>[We((P(),O(u(y),{size:"small",ghost:"",type:"error",disabled:u(K).length==0},{icon:i(()=>[a(yt,{class:Fl(["text-icon",{"animate-spin":u(me)}])},null,8,["class"])]),default:i(()=>[m[9]||(m[9]=g(" "+G("批量删除")))]),_:1,__:[9]},8,["disabled"])),[[Je,"project:Info:delete"]])]),default:i(()=>[m[10]||(m[10]=g(" 确定要删除选中的合同吗？ "))]),_:1,__:[10]}),a(bt,{columns:u(s),"onUpdate:columns":m[2]||(m[2]=F=>dt(s)?s.value=F:null),ctype:2},null,8,["columns"])]),_:1})]),key:"0"}:void 0]),1024),a(Jl,{visible:ce.value,"onUpdate:visible":m[6]||(m[6]=F=>ce.value=F),pid:M.value},null,8,["visible","pid"])])}}}),Un=va(pn,[["__scopeId","data-v-70d0321e"]]);export{Un as default};
