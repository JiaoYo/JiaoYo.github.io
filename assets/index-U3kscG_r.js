import{_ as We,a as Le,b as Ne,c as Pe}from"./edit-7pWvn04w.js";import{_ as Te}from"./round-search-B9RiPIED.js";import{aq as S,d as Ae,q as qe,r as k,bZ as oe,i as De,y as Re,b as g,o as r,f as o,e as u,w as a,G as Be,F as ae,h as s,az as Ee,N as Ge,B as h,g as p,t as m,U as V,z as b,ax as Fe,c as w,bG as Je,aT as se,aX as le,D as A,aS as Me,V as Ve,T as Ie,C as W,cJ as Oe,c$ as Ke,A as He,aA as Xe,aB as Ze,aE as Qe,aH as ie,aJ as Ye,b4 as et,aM as tt}from"./index-BhBp_qK9.js";import{u as nt}from"./usePageData-DDI8WLoO.js";import{_ as ot}from"./Grid-CO09elz5.js";import{_ as at}from"./FormItemGridItem-UGN3dIqT.js";import{_ as I,a as st}from"./text-C6iqvgHl.js";import{N as lt}from"./Popconfirm-M-SYUm8J.js";function it(v){return S({url:"/projectWeek/getPage.do",method:"get",params:v})}function rt(v){return S({url:"/projectWeek/insert.do",method:"post",data:v})}function ut(v){return S({url:"/projectWeek/update.do",method:"put",data:v})}function dt(v){return S({url:"/projectWeek/delete.do",method:"delete",params:{arrIds:v}})}function ct(v){return S({url:"/projectWeekComment/getPage.do",method:"get",params:v})}function pt(v){return S({url:"/projectWeekComment/insert.do",method:"post",data:v})}function mt(v){return S({url:"/projectWeekComment/delete.do",method:"delete",params:{arrIds:v}})}const ft={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto p-20px"},_t={style:{display:"flex",height:"100%"}},vt={key:1},yt={class:"flex items-center"},gt={class:"flex items-center"},wt={class:"flex-col ml-10px"},ht={class:"font-size-18px font-bold"},xt={class:"c-#868e96 font-size-14px"},kt={key:0},bt={class:"mt-3 mb-3 text-gray-700 preview-text"},Ct={class:"mt-3 mb-3 text-gray-700 preview-text"},$t={class:"mt-3 mb-3 text-gray-700 preview-text"},zt={class:"mt-3 mb-3 text-gray-700 preview-text"},St={class:"mt-3 mb-3 text-gray-700 preview-text"},Ut={key:1,class:"mt-3 mb-3 text-gray-700 preview-text"},jt={key:2,class:"mt-3 mb-3 text-gray-700 preview-text"},Wt={key:1,class:"mt-1 flex items-center gap-3 text-sm text-gray-500"},Lt=["onClick"],Nt={key:0,class:"mt-4 border-t pt-3"},Pt={class:"flex items-start gap-2 mb-3"},Tt={class:"ml-2 flex-1"},At={class:"flex items-center"},qt={class:"font-medium font-size-16px font-bold"},Dt={class:"text-gray-600 mt-1"},Rt={key:0,style:{display:"flex","justify-content":"flex-end","margin-top":"10px"}},Bt={key:0,class:""},Et={key:1,class:"flex items-center w-300px"},Gt=Ae({name:"projectmanagement_memberlog",__name:"index",setup(v){const O=qe(),L=k({creater:void 0}),{pageData:N,getData:re,nextPage:ue}=nt(et),de=async n=>{const e=n.currentTarget,l=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&N.data.length<N.total&&(await ue(),await ie(),setTimeout(()=>{e.scrollTop=l}))},ce=async n=>{L.value.creater=n,$()},pe=async()=>{re({usertypes:"2,3"}),N.data=N.data.map(n=>(n.avatar="https://cdn-icons-png.flaticon.com/128/3135/3135715.png",n))},R={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},me={content1:{required:!0,message:"请输入",trigger:"blur"}},B=k("add"),P=k(!1),E=k(-1),C=k([]),y=k({page:1,limit:10,total:0}),G=k(null),d=k({id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}),F=k([]),fe=n=>{y.value.page=n,$()},_e=n=>{y.value.limit=n,$()},$=async()=>{const{data:n,error:e}=await it({page:y.value.page,limit:y.value.limit,creater:L.value.creater});n&&(C.value=n.list.map((l,i)=>(E.value!=i?l.showAll=!1:l.showAll=!0,l.showCommentSection=!1,l)),y.value.total=n.total)},U=k(0);async function J({file:n},e){const l=await Ye(n.file,n.name,"",i=>{e=="file2"&&(U.value=i)});l&&(console.log("文件上传成功"),e=="file1"?d.value.file1=l:d.value.file2=l,U.value=0)}async function K(n,e){var l,i,c;return e=="file1"&&!["image/jpeg","image/png","image/jpg","image/x-icon"].includes(n.file.file.type)?((l=window.$message)==null||l.destroyAll(),(i=window.$message)==null||i.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1):n.file.file.size>100*1024*1024?((c=window.$message)==null||c.error("文件大小不能超过100M"),!1):!0}const ve=(n,e)=>{P.value=!0,B.value="edit",d.value=JSON.parse(JSON.stringify(n)),E.value=e},ye=async n=>{var i;const{data:e,error:l}=await dt(n.id);e&&((i=window.$message)==null||i.success("删除成功"),C.value.length===1&&y.value.page>1&&y.value.page--,$())},ge=()=>{P.value=!0,B.value="add",d.value={id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""},E.value=-1},we=oe.debounce(async()=>{var n,e,l;if(await((n=G.value)==null?void 0:n.validate()),d.value.id){const{data:i,error:c}=await ut([d.value]);i&&((e=window.$message)==null||e.success("编辑成功"))}else{await J({file:F.value[0]},"file1");const{data:i,error:c}=await rt([d.value]);i&&((l=window.$message)==null||l.success("新增成功"))}await $(),H()},1e3,{leading:!0,trailing:!1}),H=()=>{P.value=!1,d.value={id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}},X=n=>{C.value.forEach(e=>{e.id!==n.id&&(e.showAll=!1)}),n.showAll=!n.showAll};De(async()=>{await pe(),$()});async function M(n){const{data:e,error:l}=await ct({page:1,limit:100,pid:n});if(e){const i=C.value.find(c=>c.id===n);i&&(i.comments=e.list)}}const he=async n=>{M(n.id),C.value.forEach(e=>{e.id!==n.id&&(e.showCommentSection=!1)}),n.showCommentSection=!n.showCommentSection,n.showCommentSection&&await ke(`comment-input-${n.id}`)},xe=async(n,e)=>{var c;const{data:l,error:i}=await mt(n.id);l&&(M(n.pid),e.num--,(c=window.$message)==null||c.success("删除成功"))},q=k({}),Z=oe.debounce(async n=>{var c,x;const e=q.value[n.id];if(!(e!=null&&e.trim()))return(c=window.$message)==null?void 0:c.warning("请输入评论内容");const{data:l,error:i}=await pt([{pid:n.id,content:e}]);l&&((x=window.$message)==null||x.success("评论成功"),q.value[n.id]="",n.num++,M(n.id))},1e3,{leading:!0,trailing:!1});async function ke(n,e=8,l=30){var c;await ie();for(let x=0;x<e;x++){const f=document.querySelector(`#${n} textarea`);if(f&&typeof f.focus=="function"){f.focus();const j=f.value;if(j&&f.setSelectionRange){const D=j.length;f.setSelectionRange(D,D)}return!0}await new Promise(j=>setTimeout(j,l))}const i=document.getElementById(n);return i&&(i.tabIndex=-1,(c=i.focus)==null||c.call(i)),!1}async function Q(n){if(!n)return;const e=n.split("?")[0],l=n.split("?")[1];try{const c=await(await fetch(e,{mode:"cors"})).blob(),x=URL.createObjectURL(c),f=document.createElement("a");f.href=x,f.download=l,f.style.display="none",document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(x)}catch(i){console.error("下载失败:",i)}}return(n,e)=>{const l=at,i=Te,c=Ge,x=ot,f=Be,j=Pe,D=We,be=Le,Ce=Me,$e=Ne,Y=lt,ze=Ke,z=He,ee=Xe,Se=Ze,Ue=Qe,T=Re("no-auth");return r(),g("div",ft,[o(s(V),{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[o(f,{ref_key:"formRef",ref:G,model:L.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ae($,["enter"])},{default:a(()=>[o(x,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[o(l,{span:"24 s:12 m:6",label:"调试人员",path:"pid"},{default:a(()=>[o(s(Ee),{clearable:"",filterable:"",value:L.value.creater,"onUpdate:value":[e[0]||(e[0]=t=>L.value.creater=t),ce],placeholder:"请选择","label-field":"username","value-field":"id",options:s(N).data,onScroll:de},null,8,["value","options"])]),_:1}),o(l,{span:"24  s:12 m:6",class:"pr-24px"},{default:a(()=>[o(c,{class:"w-full"},{default:a(()=>[o(s(h),{type:"primary",ghost:"",onClick:$},{icon:a(()=>[o(i,{class:"text-icon"})]),default:a(()=>[p(" "+m(n.$t("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),u("div",_t,[o(s(V),null,{header:a(()=>e[13]||(e[13]=[p("技术支持周报")])),"header-extra":a(()=>[A((r(),w(s(h),{type:"primary",ghost:"",onClick:ge},{icon:a(()=>[o(j)]),default:a(()=>[e[14]||(e[14]=p(" 写周报 "))]),_:1,__:[14]})),[[T,"project:Week:insert"]])]),default:a(()=>[o(s(Fe),{style:{height:"calc(100vh - 350px)"}},{default:a(()=>[C.value.length?(r(),g("div",vt,[(r(!0),g(se,null,le(C.value,(t,je)=>(r(),w(s(V),{key:t.id,class:"mb-4",title:"",size:"small"},{default:a(()=>{var te,ne;return[u("div",yt,[u("div",gt,[t.showAll?(r(),w(D,{key:0,class:"font-size-20px mr-10px cursor-pointer",onClick:_=>X(t)},null,8,["onClick"])):(r(),w(be,{key:1,class:"font-size-20px mr-10px cursor-pointer",onClick:_=>X(t)},null,8,["onClick"])),o(s(I),{src:R.avatar},null,8,["src"]),u("div",wt,[u("span",ht,m(t.username)+"的技术支持周报",1),u("span",xt,m(t.dbtime),1)])])]),t.showAll?(r(),g("div",kt,[e[17]||(e[17]=u("h3",{class:"font-size-16px font-bold mt-2"},"本周完成：",-1)),u("div",bt,m(t.content1),1),e[18]||(e[18]=u("h3",{class:"font-size-16px font-bold mt-2"},"本周对你帮助最大的人，具体描述一下对你的帮助：",-1)),u("div",Ct,m(t.content2),1),e[19]||(e[19]=u("h3",{class:"font-size-16px font-bold mt-2"},"未完成项目",-1)),u("div",$t,m(t.content3),1),e[20]||(e[20]=u("h3",{class:"font-size-16px font-bold mt-2"},"下周计划：",-1)),u("div",zt,m(t.content4),1),e[21]||(e[21]=u("h3",{class:"font-size-16px font-bold mt-2"},"需协调与帮助：",-1)),u("div",St,m(t.content5),1),e[22]||(e[22]=u("h3",{class:"font-size-16px font-bold mt-2"},"图片：",-1)),t.file1?(r(),w(Ce,{key:0,width:"80",height:"80",src:t.file1,class:"rounded-md object-cover"},null,8,["src"])):b("",!0),t.file1?(r(),g("div",Ut,[p(m((te=t.file1)==null?void 0:te.split("?")[1])+" ",1),o(s(h),{text:"",type:"primary",size:"small",onClick:_=>Q(t.file1)},{default:a(()=>e[15]||(e[15]=[p("下载")])),_:2,__:[15]},1032,["onClick"])])):b("",!0),e[23]||(e[23]=u("h3",{class:"font-size-16px font-bold mt-2"},"附件：",-1)),t.file2?(r(),g("div",jt,[p(m((ne=t.file2)==null?void 0:ne.split("?")[1])+" ",1),o(s(h),{text:"",type:"primary",size:"small",onClick:_=>Q(t.file2)},{default:a(()=>e[16]||(e[16]=[p("下载")])),_:2,__:[16]},1032,["onClick"])])):b("",!0)])):b("",!0),t.showAll?(r(),g("div",Wt,[u("span",{class:"cursor-pointer hover:text-blue-500",style:Ve({color:t.showCommentSection?"#1890ff":""}),onClick:_=>he(t)},[o($e,{class:"font-size-18px"}),p(" "+m(t.num==0?"":t.num),1)],12,Lt),s(O).userInfo.id==t.creater?(r(),w(c,{key:0},{default:a(()=>[A((r(),w(s(h),{quaternary:"",type:"info",size:"small",onClick:_=>ve(t,je)},{default:a(()=>e[24]||(e[24]=[p(" 编辑 ")])),_:2,__:[24]},1032,["onClick"])),[[T,"project:Week:update"]]),o(Y,{onPositiveClick:_=>ye(t)},{trigger:a(()=>[A((r(),w(s(h),{quaternary:"",type:"error",size:"small"},{default:a(()=>e[25]||(e[25]=[p(" 删除 ")])),_:1,__:[25]})),[[T,"project:Week:delete"]])]),default:a(()=>[e[26]||(e[26]=p(" 确定删除吗？ "))]),_:2,__:[26]},1032,["onPositiveClick"])]),_:2},1024)):b("",!0)])):b("",!0),A((r(),w(Ie,{name:"fade"},{default:a(()=>[t.showCommentSection?(r(),g("div",Nt,[u("div",Pt,[u("div",null,[o(s(I),{size:"small",src:R.avatar},null,8,["src"])]),o(s(W),{type:"textarea",id:`comment-input-${t.id}`,value:q.value[t.id],"onUpdate:value":_=>q.value[t.id]=_,placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ae(Oe(_=>s(Z)(t),["exact","prevent"]),["enter"])},null,8,["id","value","onUpdate:value","onKeydown"]),o(s(h),{type:"primary",ghost:"",onClick:_=>s(Z)(t)},{default:a(()=>e[27]||(e[27]=[p("发送")])),_:2,__:[27]},1032,["onClick"])]),(r(!0),g(se,null,le(t.comments,_=>(r(),g("div",{key:_.id,class:"flex mb-3"},[o(s(I),{size:"small",src:R.avatar},null,8,["src"]),u("div",Tt,[u("div",At,[u("span",qt,m(_.username),1),o(s(st),{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:a(()=>[p(m(_.dbtime),1)]),_:2},1024),s(O).userInfo.id==_.creater?(r(),w(Y,{key:0,onPositiveClick:Ft=>xe(_,t)},{trigger:a(()=>[A((r(),w(s(h),{quaternary:"",type:"error",size:"small"},{default:a(()=>e[28]||(e[28]=[p(" 删除 ")])),_:1,__:[28]})),[[T,"project:Week:Comment:delete"]])]),default:a(()=>[e[29]||(e[29]=p(" 确定删除吗？ "))]),_:2,__:[29]},1032,["onPositiveClick"])):b("",!0)]),u("div",Dt,m(_.content),1)])]))),128))])):b("",!0)]),_:2},1024)),[[T,"project:Week:Comment:insert"]])]}),_:2},1024))),128))])):(r(),w(s(Je),{key:0,description:"暂无信息"}))]),_:1}),C.value.length>0?(r(),g("div",Rt,[o(ze,{page:y.value.page,"onUpdate:page":[e[1]||(e[1]=t=>y.value.page=t),fe],"page-size":y.value.limit,"onUpdate:pageSize":[e[2]||(e[2]=t=>y.value.limit=t),_e],"item-count":y.value.total,"show-size-picker":"","page-sizes":[10,20,50],prefix:()=>`共 ${y.value.total} 条`},null,8,["page","page-size","item-count","prefix"])])):b("",!0)]),_:1})]),o(Ue,{show:P.value,"onUpdate:show":e[12]||(e[12]=t=>P.value=t),title:B.value==="add"?"新增":"编辑",preset:"card",class:"w-570px"},{footer:a(()=>[o(c,{justify:"end"},{default:a(()=>[o(s(h),{size:"small",class:"mt-16px",onClick:H},{default:a(()=>[p(m(n.$t("common.cancel")),1)]),_:1}),o(s(h),{type:"primary",size:"small",class:"mt-16px",onClick:s(we)},{default:a(()=>[p(m(n.$t("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:a(()=>[o(f,{ref_key:"formRef",ref:G,model:d.value,rules:me},{default:a(()=>[o(z,{label:"本周完成",path:"content1"},{default:a(()=>[o(s(W),{value:d.value.content1,"onUpdate:value":e[3]||(e[3]=t=>d.value.content1=t),type:"textarea",placeholder:"请输入内容",rows:3},null,8,["value"])]),_:1}),o(z,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{default:a(()=>[o(s(W),{value:d.value.content2,"onUpdate:value":e[4]||(e[4]=t=>d.value.content2=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o(z,{label:"未完成项目",path:"content3"},{default:a(()=>[o(s(W),{value:d.value.content3,"onUpdate:value":e[5]||(e[5]=t=>d.value.content3=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o(z,{label:"下周计划",path:"content4"},{default:a(()=>[o(s(W),{value:d.value.content4,"onUpdate:value":e[6]||(e[6]=t=>d.value.content4=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o(z,{label:"需协调与帮助:",path:"content5"},{default:a(()=>[o(s(W),{value:d.value.content5,"onUpdate:value":e[7]||(e[7]=t=>d.value.content5=t),type:"textarea",placeholder:"请输入内容",rows:1},null,8,["value"])]),_:1}),o(z,{label:"图片:",path:"file1"},{default:a(()=>[o(ee,{ref:"uploadRef",action:"#","list-type":"image-card","default-upload":!1,max:1,"file-list":F.value,"onUpdate:fileList":e[8]||(e[8]=t=>F.value=t),"custom-request":t=>J(t,"file1"),onBeforeUpload:e[9]||(e[9]=t=>K(t,"file1"))},null,8,["file-list","custom-request"])]),_:1}),o(z,{label:"附件:",path:"file2"},{default:a(()=>[d.value.file2?(r(),g("div",Bt,[u("span",null,m(d.value.file2.split("?")[1]),1),o(s(h),{text:"",type:"error",onClick:e[10]||(e[10]=t=>d.value.file2="")},{default:a(()=>e[30]||(e[30]=[p("删除")])),_:1,__:[30]})])):(r(),g("div",Et,[o(ee,{ref:"uploadRef",action:"#","show-file-list":!1,"custom-request":t=>J(t,"file2"),onBeforeUpload:e[11]||(e[11]=t=>K(t,"file2"))},{default:a(()=>[o(s(h),{loading:U.value>0&&!d.value.file2},{default:a(()=>[p(m(U.value>0&&!d.value.file2?"上传中":"上传文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"]),U.value&&!d.value.file2?(r(),w(Se,{key:0,type:"line",percentage:U.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):b("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}}),Zt=tt(Gt,[["__scopeId","data-v-952d4daa"]]);export{Zt as default};
