import{_ as re}from"./round-plus-DPUpje-i.js";import{_ as ce}from"./round-delete-BiJxK7yA.js";import{d as ue,a1 as de,j as D,r as V,g as t,A as w,Y as B,h as m,ao as b,K as pe,L as F,o as f,e as I,f as y,aj as O,ah as G,w as a,i as d,B as v,t as M,N as _e,M as L,c as N,aY as me,ax as ke,C as fe,D as he,E as ve,ab as ge,ac as be,aZ as ye,S as we,a7 as Se,as as xe,_ as Ie,aa as Ne,ay as Ce,az as $e,av as De}from"./index-CXJ7AQei.js";import{l as Me}from"./lodash-3yLO-712.js";import{d as Ue,e as ze,g as Pe}from"./basic-config-DSwWD5-y.js";import{_ as Ee}from"./FormItemGridItem-BdFekX4I.js";import{_ as Be}from"./DataTable-ByDnShuV.js";import{_ as Le}from"./Grid-cHbn5tWF.js";import"./Forward-lIzUVZHl.js";const je=C=>(Ce("data-v-ef2ae674"),C=C(),$e(),C),Ke={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"},Ae={key:0,class:"lan-network"},Re={class:"lanList"},Te=["onClick"],qe={class:"but"},Ve=je(()=>y("span",{style:{width:"3px",height:"15px",background:"#1980ff",display:"inline-block","margin-right":"5px","border-radius":"20px"}},null,-1)),Fe={class:"w-100%"},Oe={class:"w-100%"},Ge=ue({name:"basicconfig_network-manage",__name:"index",setup(C){const J=de(),U=()=>{let e=[];for(let n=1;n<=32;n++)e.push({label:n+"",value:n,name:me(n)});return e},p=D([{id:1,nname:"eno1",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",checked1:[],checked2:[],list1:[],list2:[]},{id:2,nname:"eno2",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",checked1:[],checked2:[],list1:[],list2:[]},{id:3,nname:"eno3",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",checked1:[],checked2:[],list1:[],list2:[]},{id:4,nname:"eno4",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",checked1:[],checked2:[],list1:[],list2:[]},{id:5,nname:"eno5",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",checked1:[],checked2:[],list1:[],list2:[]},{id:6,nname:"eno6",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",checked1:[],checked2:[],list1:[],list2:[]},{id:7,nname:"eno7",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",checked1:[],checked2:[],list1:[],list2:[]},{id:8,nname:"eno8",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",checked1:[],checked2:[],list1:[],list2:[]}]),Y=V([{type:"selection",align:"center",width:48},{key:"ip",title:"IP地址",align:"center",width:240,render:e=>t(w,{value:e.ip,clearable:!0,"onUpdate:value":n=>e.ip=n,status:e.inputStatus?"error":"success",onInput:n=>R(e,n)},null)},{key:"netMask",title:"掩码",align:"center",width:240,render:e=>t(B,{renderLabel:z,value:e.netMask,clearable:!0,"onUpdate:value":n=>e.netMask=n,options:U()},null)}]),W=V([{type:"selection",align:"center",width:48},{key:"ip",title:"目标",width:240,align:"center",render:e=>t(w,{value:e.ip,clearable:!0,"onUpdate:value":n=>e.ip=n,status:e.inputStatus?"error":"success",onInput:n=>R(e,n)},null)},{key:"netMask",title:"掩码",align:"center",width:240,render:e=>t(B,{renderLabel:z,value:e.netMask,clearable:!0,"onUpdate:value":n=>e.netMask=n,options:U()},null)},{key:"nextip",title:"下一跳",align:"center",width:240,render:e=>t(w,{value:e.nextip,"onUpdate:value":n=>e.nextip=n,clearable:!0,status:e.inputStatus1?"error":"success",onInput:n=>ae(e,n)},null)}]),Z=e=>{e.checked1.length!=0&&(e.list1=e.list1.filter(n=>!e.checked1.includes(n.id)),e.checked1=[])},H=e=>{e.checked2.length!=0&&(e.list2=e.list2.filter(n=>!e.checked2.includes(n.id)),e.checked2=[])},g=D(0),j=async()=>{const{data:e,error:n}=await Ue();if(e){const l=JSON.parse(JSON.stringify(e));g.value=l.id||l.nname.charAt(l.nname.length-1)||l.nname.replace("eno",""),p.value[g.value-1]={...l,nip:l.list1[0].ip,nmaskbits:l.list1[0].netMask,list1:l.list1?l.list1.map((o,k)=>(o.id=k+1,o)):[],list2:l.list2?l.list2.map((o,k)=>{o.id=k+1;const _=o.ip.split("/");return o.ip=_[0],o.netMask=Number(_[1]),o}):[],id:g.value},ke(()=>{var k;const o=document.getElementById((k=p.value.find(_=>_.id==g.value))==null?void 0:k.nname);o&&o.scrollIntoView({behavior:"smooth",block:"center"})})}},Q={nip:[{required:!0,message:"请输入ip地址",trigger:["input","change","blur","password-input"]},{validator:xe,trigger:["input","change","blur","password-input"]}],nmaskbits:{required:!0,validator:(e,n)=>new Promise((l,o)=>{n==0?o(new Error("请选择掩码")):l()}),trigger:["input","change","blur"]}},X=async e=>{var $,h,S,x;const n=i=>{for(const r of i){if(!b(r.ip))return console.error(`IP 校验失败: ${r.ip}`),!1;if(r.netMask==null||r.netMask==0)return console.error(`netMask 校验失败: ${r.netMask} (ID: ${r.id})`),!1}return!0},l=i=>{for(const r of i){if(!b(r.ip))return console.error(`IP 校验失败: ${r.ip}`),!1;if(!b(r.nextip))return console.error(`IP 校验失败: ${r.ip}`),!1;if(r.netMask==null||r.netMask==0)return console.error(`netMask 校验失败: ${r.netMask} (ID: ${r.id})`),!1}return!0};if(!n(p.value[e].list1))return($=window.$message)==null?void 0:$.warning("网关IP或掩码不符合规范，请检查后重试");if(!l(p.value[e].list2))return(h=window.$message)==null?void 0:h.warning("网关路由或掩码不符合规范，请检查后重试");const _={...p.value[e],list1:p.value[e].list1.map(i=>(i.inputStatus=void 0,i)),list2:Me.cloneDeep(p.value[e].list2).map(i=>(i.ip=i.ip+"/"+i.netMask,i.netMask=null,i.id=void 0,i.inputStatus=void 0,i.inputStatus1=void 0,i))},{data:T,error:P}=await Pe(_);P||((S=window.$message)==null||S.destroyAll(),(x=window.$message)==null||x.success("配置成功"),j())},ee=D(null),ne=async(e,n)=>{const l=document.getElementById(e.nname);l&&l.scrollIntoView({behavior:"smooth",block:"start"}),ee.value=n},u=D({visible:!1,dns1:"",dns2:""}),te={dns1:{required:!0,trigger:["blur","input","change"],validator:(e,n)=>n?b(n)?!0:new Error("请输入正确的DNS"):new Error("请输入DNS")},dns2:{required:!1,trigger:["blur","input","change"],validator:(e,n)=>n?b(n)?!0:new Error("请输入正确的DNS"):new Error("请输入DNS")}},se=()=>{u.value.visible=!0,u.value.dns1=p.value[g.value-1].predns,u.value.dns2=p.value[g.value-1].bakdns},K=async()=>{var l,o;const{data:e,error:n}=await ze({dns1:u.value.dns1,dns2:u.value.dns2});n||((l=window.$message)==null||l.destroyAll(),(o=window.$message)==null||o.success("配置成功"),A())},A=()=>{u.value.visible=!1,u.value.dns1="",u.value.dns2=""},z=e=>t("div",{style:{display:"flex",alignItems:"center"}},[t("span",null,[e.label]),t("span",{style:{fontSize:"12px",marginLeft:"20px"}},[m("("),e.name,m(")")])]),R=(e,n)=>{e.inputStatus=!b(n)},ae=(e,n)=>{e.inputStatus1=!b(n)};return pe(()=>{j()}),(e,n)=>{const l=Ie,o=fe,k=he,_=ve,T=ge,P=be,$=ye,h=Ee,S=ce,x=re,i=Be,r=Le,le=Ne,oe=we,q=F("no-space"),ie=F("no-auth");return f(),I("div",Ke,[p.value.length>0?(f(),I("div",Ae,[y("div",Re,[(f(!0),I(O,null,G(p.value,(s,E)=>(f(),I("div",{class:"lanItem",key:s.id,onClick:c=>ne(s,E)},[Number(s.nname.charAt(s.nname.length-1)||s.nname.replace("eno",""))==g.value?(f(),N(l,{key:0,"local-icon":"lan-active",style:{"font-size":"30px"},class:"animation"})):(f(),N(l,{key:1,"local-icon":"lan-default",style:{"font-size":"30px"}})),y("span",null,M(s.nname),1)],8,Te))),128))]),y("div",qe,[t(d(v),{type:"info",ghost:"",onClick:se},{default:a(()=>[m("DNS配置")]),_:1})]),t(P,{show:u.value.visible,"onUpdate:show":n[2]||(n[2]=s=>u.value.visible=s),"display-directive":"show",width:300},{default:a(()=>[t(T,{title:"设置DNS","native-scrollbar":!1,closable:""},{footer:a(()=>[t(_,{size:16},{default:a(()=>[t(d(v),{onClick:A},{default:a(()=>[m(M(e.$t("common.cancel")),1)]),_:1}),t(d(v),{type:"primary",onClick:K},{default:a(()=>[m(M(e.$t("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(k,{ref:"formRef",model:u.value,rules:te,onKeyup:_e(K,["enter"])},{default:a(()=>[t(o,{label:"DNS(首选)",path:"dns1"},{default:a(()=>[L(t(d(w),{clearable:"",value:u.value.dns1,"onUpdate:value":n[0]||(n[0]=s=>u.value.dns1=s),placeholder:"请输入IP"},null,8,["value"]),[[q]])]),_:1}),t(o,{label:"DNS(备用)",path:"dns2"},{default:a(()=>[L(t(d(w),{clearable:"",value:u.value.dns2,"onUpdate:value":n[1]||(n[1]=s=>u.value.dns2=s),placeholder:"请输入IP"},null,8,["value"]),[[q]])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])):(f(),N($,{key:1,size:"huge",description:"未检测到有效的系统返回码"})),t(oe,null,{default:a(()=>[(f(!0),I(O,null,G(p.value,(s,E)=>(f(),N(le,{bordered:!1,size:"small",class:"card-wrapper",key:s.nname,id:s.nname},{header:a(()=>[y("div",{style:Se({color:d(J).themeScheme==="dark"?"#fff":"#000",fontWeight:"bolder",padding:"5px",fontSize:"18px",marginBottom:"10px",display:"flex",alignItems:"center"})},[Ve,m(" "+M(s.nname)+"网络配置 ",1)],4)]),default:a(()=>[t(k,{ref_for:!0,ref:"formRef",model:s,rules:Q,"label-placement":"left","label-width":120,"require-mark-placement":"left"},{default:a(()=>[t(r,{responsive:"screen","item-responsive":""},{default:a(()=>[t(h,{span:"24 s:12 m:10",label:"IP地址",path:"nip"},{default:a(()=>[t(d(w),{clearable:"",placeholder:"请输入IP地址",value:s.nip,"onUpdate:value":c=>s.nip=c},null,8,["value","onUpdate:value"])]),_:2},1024),t(h,{span:"24 s:12 m:10",label:"掩码",path:"nmaskbits"},{default:a(()=>[t(d(B),{"render-label":z,clearable:"",options:U(),placeholder:"请选择掩码位数",value:s.nmaskbits,"onUpdate:value":c=>s.nmaskbits=c},null,8,["options","value","onUpdate:value"])]),_:2},1024),t(h,{span:"24 s:12 m:10",label:"添加网关IP"},{default:a(()=>[y("div",Fe,[t(_,{justify:"end",align:"center",class:"w-100% mb-10px"},{default:a(()=>[t(d(v),{size:"small",ghost:"",type:"error",onClick:c=>Z(s)},{icon:a(()=>[t(S,{class:"text-icon"})]),default:a(()=>[m(" 删除")]),_:2},1032,["onClick"]),t(d(v),{size:"small",ghost:"",type:"primary",onClick:c=>s.list1.push({id:s.list1.length+1,ip:"",netMask:null,nextip:null})},{icon:a(()=>[t(x,{class:"text-icon"})]),default:a(()=>[m(" 添加")]),_:2},1032,["onClick"])]),_:2},1024),t(i,{columns:Y,data:s.list1,size:"small",remote:"","row-key":c=>c.id,class:"sm:h-full","checked-row-keys":s.checked1,"onUpdate:checkedRowKeys":c=>s.checked1=c},null,8,["columns","data","row-key","checked-row-keys","onUpdate:checkedRowKeys"])])]),_:2},1024),t(h,{span:"24 s:12 m:14",label:"添加网关路由"},{default:a(()=>[y("div",Oe,[t(_,{justify:"end",align:"center",class:"w-100% mb-10px"},{default:a(()=>[t(d(v),{size:"small",ghost:"",type:"error",onClick:c=>H(s)},{icon:a(()=>[t(S,{class:"text-icon"})]),default:a(()=>[m(" 删除")]),_:2},1032,["onClick"]),t(d(v),{size:"small",ghost:"",type:"primary",onClick:c=>s.list2.push({id:s.list2.length+1,ip:"",nextip:"",netMask:null})},{icon:a(()=>[t(x,{class:"text-icon"})]),default:a(()=>[m(" 添加")]),_:2},1032,["onClick"])]),_:2},1024),t(i,{columns:W,data:s.list2,size:"small",remote:"","row-key":c=>c.id,class:"sm:h-full","checked-row-keys":s.checked2,"onUpdate:checkedRowKeys":c=>s.checked2=c},null,8,["columns","data","row-key","checked-row-keys","onUpdate:checkedRowKeys"])])]),_:2},1024),t(h,{span:"24 s:24 m:24"},{default:a(()=>[t(_,{justify:"center",class:"w-100%"},{default:a(()=>[L((f(),N(d(v),{type:"info",ghost:"",onClick:c=>X(E)},{default:a(()=>[m("应用配置 ")]),_:2},1032,["onClick"])),[[ie,"sys.network.update"]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["model"])]),_:2},1032,["id"]))),128))]),_:1})])}}}),tn=De(Ge,[["__scopeId","data-v-ef2ae674"]]);export{tn as default};
