import{_ as ge}from"./table-column-setting.vue_vue_type_script_setup_true_lang-UoWbwzfQ.js";import{_ as xe}from"./refresh-DVSHILZA.js";import{d as U,n as ye,p as be,s as Ce,D as O,o as J,c as Pe,w as u,g as o,E as K,h as E,t as V,i as r,$ as G,F as we,J as Ne,B as F,N as M,O as ke,ad as he,dM as Le,a4 as Se,j as L,ae as $e,f as A,aa as Re,a_ as T,S as je,ar as ze,P as De,Q as Te,R as Ee,a3 as Ie,W as Be,r as me,e as Ae,ah as _e,bo as Fe,aG as Oe,aj as Ke}from"./index-C2yjy6ET.js";import{a as Me,c as Ge,d as Ve,e as fe,g as Ue}from"./reportForm-DnZ1vdZf.js";import{u as Je}from"./table-C3dDT37M.js";import{_ as We}from"./round-search-DKnEAg06.js";import{_ as qe}from"./round-refresh-B_9x0-9r.js";import{_ as He}from"./lodash-BDJtdoKT.js";import{_ as Qe}from"./FormItemGridItem-D08VIasa.js";import{_ as Xe}from"./Grid-Bh27Z1XD.js";import{T as Ye}from"./task-Xe1cp5ck.js";import{_ as Ze,a as ea,b as aa,c as ta}from"./file-pdf-Dd_JlinW.js";import{_ as ve}from"./Popconfirm-CG_tLyUK.js";import"./setting-outlined-Dq1C1xTv.js";import"./echarts.vue_vue_type_script_setup_true_lang-Bpfch1Hf.js";import"./index-BhRqCdHu.js";import"./installCanvasRenderer-CyOrKSjT.js";import"./install-CX03SWNg.js";const oa=U({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:ye(["reset","search"],["update:model"]),setup(N,{emit:I}){const B=I,{formRef:m,restoreValidation:j}=be(),c=Ce(N,"model"),D=()=>{c.value.fuzzy="",x()};async function g(){await j(),B("reset")}async function x(){B("search")}const S=He.debounce(x,1e3,{leading:!0,trailing:!1});return(k,y)=>{const $=Ne,a=Qe,e=qe,d=F,_=We,C=M,b=Xe,R=ke,z=he,P=O("no-space");return J(),Pe(z,{bordered:!1,size:"small",class:"card-wrapper"},{default:u(()=>[o(R,{ref_key:"formRef",ref:m,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:we(r(S),["enter"])},{default:u(()=>[o(b,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:u(()=>[o(a,{span:"24 s:12 m:8 l:6",label:"实例名称",path:"alatype"},{default:u(()=>[K(o($,{autofocus:"",value:c.value.fuzzy,"onUpdate:value":y[0]||(y[0]=s=>c.value.fuzzy=s),placeholder:"请输入实例名称关键字",clearable:"",onClear:D},null,8,["value"]),[[P]])]),_:1}),o(a,{span:"24 s:12 m:8 l:6"},{default:u(()=>[o(C,{class:"w-full"},{default:u(()=>[o(d,{onClick:g},{icon:u(()=>[o(e,{class:"text-icon"})]),default:u(()=>[E(" "+V(r(G)("common.reset")),1)]),_:1}),o(d,{type:"primary",ghost:"",onClick:r(S)},{icon:u(()=>[o(_,{class:"text-icon"})]),default:u(()=>[E(" "+V(r(G)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),na=N=>(De("data-v-acdae960"),N=N(),Te(),N),sa=na(()=>A("span",{class:"mr-20px"},"报表预览",-1)),la={title:"导出PDF"},ra={title:"导出Word"},ua={title:"导出Excel"},ia=U({name:"reportPreview",__name:"reportPreview",props:ye({data:{},detaliParams:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(N){Le(a=>({e70f7700:r(B)}));const I=Se(),B=I.themeScheme=="dark"?"#001428":"#fff",m=N,j=Ce(N,"visible"),c=L([]),D=async a=>{const{data:e,error:d}=await Me({rtype:a});d||(e.forEach(_=>{_.rtext=JSON.parse(_.rtext)}),c.value=e[0].rtext)},g=["一般","低级","中级","高级","严重"],x=["#99CC00","#1e90ff","#FF9900","#FF6666","#CC0033"],S=L(),k=L(""),y=async()=>{if(m.detaliParams.rtype=1,m.detaliParams.rtype==0)await D(0),c.value.forEach(a=>{a.type=="chart"&&a.dataName=="assetType"&&(a.value.data.series[0].data=Object.entries(m.data.assetType).map(([e,d],_)=>({value:d,name:e}))),a.type=="table"&&a.dataName=="baseInfo"&&(a.value.body=m.data.baseInfo.map(e=>a.value.tableHeaderValue.map(d=>e[d])))}),S.value=c.value,k.value=m.detaliParams.name+"_资产信息表";else if(m.detaliParams.rtype==1){await D(1),k.value=m.detaliParams.name+"_审计信息表";const a=m.data;c.value.forEach(e=>{var d,_,C,b,R,z,P,s,n,l,p,f,w,h,W,q,H,Q,X,Y,Z,ee,ae,te,oe,ne,se,le,re,ue,ie,de,ce;e.type=="chart"&&(e.dataName=="secureCountPojo"&&(e.value.data.series[0].data=g.map((t,v)=>{const i=`e${v+1}`;return{value:a.secureCountPojo[i]==0||a.secureCountPojo[i]==null?null:a.secureCountPojo[i],name:t,itemStyle:{color:x[v]}}})),e.dataName=="secureCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data=(_=(d=a.secureCountPojo)==null?void 0:d.typeCountPojoList)==null?void 0:_.map(t=>t.tname),e.value.data.series[0].data=(b=(C=a.secureCountPojo)==null?void 0:C.typeCountPojoList)==null?void 0:b.map(t=>t.tcount)),e.dataName=="secureCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(z=(R=a.secureCountPojo)==null?void 0:R.dayCountPojoList)==null?void 0:z.map(t=>T(0,t.date)),e.value.data.series[0].data=(s=(P=a.secureCountPojo)==null?void 0:P.dayCountPojoList)==null?void 0:s.map(t=>t.dailycount)),e.dataName=="auditCountPojo"&&(e.value.data.series[0].data=g.map((t,v)=>{const i=`e${v+1}`;return{value:a.auditCountPojo[i]==0||a.auditCountPojo[i]==null?null:a.auditCountPojo[i],name:t,itemStyle:{color:x[v]}}})),e.dataName=="auditCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data=(l=(n=a.auditCountPojo)==null?void 0:n.typeCountPojoList)==null?void 0:l.map(t=>t.tname),e.value.data.series[0].data=(f=(p=a.auditCountPojo)==null?void 0:p.typeCountPojoList)==null?void 0:f.map(t=>t.tcount)),e.dataName=="auditCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(h=(w=a.auditCountPojo)==null?void 0:w.dayCountPojoList)==null?void 0:h.map(t=>T(0,t.date)),e.value.data.series[0].data=(q=(W=a.auditCountPojo)==null?void 0:W.dayCountPojoList)==null?void 0:q.map(t=>t.dailycount)),e.dataName=="alarmCountPojo"&&(e.value.data.series[0].data=g.map((t,v)=>{const i=`e${v+1}`;return{value:a.alarmCountPojo[i]==0||a.alarmCountPojo[i]==null?null:a.alarmCountPojo[i],name:t,itemStyle:{color:x[v]}}})),e.dataName=="alarmCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data=(Q=(H=a.alarmCountPojo)==null?void 0:H.typeCountPojoList)==null?void 0:Q.map(t=>t.tname),e.value.data.series[0].data=(Y=(X=a.alarmCountPojo)==null?void 0:X.typeCountPojoList)==null?void 0:Y.map(t=>t.tcount)),e.dataName=="alarmCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(ee=(Z=a.alarmCountPojo)==null?void 0:Z.dayCountPojoList)==null?void 0:ee.map(t=>T(0,t.date)),e.value.data.series[0].data=(te=(ae=a.alarmCountPojo)==null?void 0:ae.dayCountPojoList)==null?void 0:te.map(t=>t.dailycount))),e.type=="table"&&(e.dataName==""&&(e.value.body=[["安全事件",a.e1],["审计事件",a.e3],["告警事件",a.e4]]),e.dataName=="secureCountPojo"&&(e.value.body=g.map((t,v)=>{const i=a.secureCountPojo[`e${v+1}`];return[t,i]})),e.dataName=="secureCountPojo_typeCountPojoList"&&(e.value.body=(ne=(oe=a.secureCountPojo)==null?void 0:oe.typeCountPojoList)==null?void 0:ne.map(t=>[t.tname,t.tcount])),e.dataName=="secureCountPojo_dayCountPojoList"&&(e.value.body=(se=a.secureCountPojo.dayCountPojoList)==null?void 0:se.map(t=>[T(0,t.date),t.dailycount])),e.dataName=="auditCountPojo"&&(e.value.body=g.map((t,v)=>{const i=a.auditCountPojo[`e${v+1}`];return[t,i]})),e.dataName=="auditCountPojo_typeCountPojoList"&&(e.value.body=(re=(le=a.auditCountPojo)==null?void 0:le.typeCountPojoList)==null?void 0:re.map(t=>[t.tname,t.tcount])),e.dataName=="auditCountPojo_dayCountPojoList"&&(e.value.body=(ue=a.auditCountPojo.dayCountPojoList)==null?void 0:ue.map(t=>[T(0,t.date),t.dailycount])),e.dataName=="alarmCountPojo"&&(e.value.body=g.map((t,v)=>{const i=a.alarmCountPojo[`e${v+1}`];return[t,i]})),e.dataName=="alarmCountPojo_typeCountPojoList"&&(e.value.body=(de=(ie=a.alarmCountPojo)==null?void 0:ie.typeCountPojoList)==null?void 0:de.map(t=>[t.tname,t.tcount])),e.dataName=="alarmCountPojo_dayCountPojoList"&&(e.value.body=(ce=a.alarmCountPojo.dayCountPojoList)==null?void 0:ce.map(t=>[T(0,t.date),t.dailycount])))}),S.value=c.value}};$e(j,()=>{j.value&&y()});const $=L();return(a,e)=>{const d=Ze,_=ea,C=aa,b=ta,R=je,z=ze;return J(),Pe(z,{show:j.value,"onUpdate:show":e[3]||(e[3]=P=>j.value=P),preset:"card",class:"w-1000px reportPreview",style:Re({"background-color":r(I).themeScheme=="dark"?"#001428":"#fff"})},{header:u(()=>[sa,A("span",la,[o(d,{class:"text-32px c-#d63031 cursor-pointer",onClick:e[0]||(e[0]=P=>$.value.toPdf(k.value))})]),A("span",ra,[o(_,{class:"text-32px c-#1e90ff cursor-pointer",onClick:e[1]||(e[1]=P=>$.value.toWord(k.value))})]),A("span",ua,[o(C,{class:"text-32px c-#15703d cursor-pointer",onClick:e[2]||(e[2]=P=>$.value.toExcel(k.value))})])]),default:u(()=>[o(R,{class:"max-h-600px"},{default:u(()=>[o(b,{ref_key:"filePreviewExportRef",ref:$,width:800,data:S.value},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),da=Ee(ia,[["__scopeId","data-v-acdae960"]]),ca={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},pa=A("div",{style:{display:"flex","align-items":"center"}},[A("div",null,"报表实例")],-1),Ra=U({name:"reportmanagement_reportlist",__name:"index",setup(N){const I=Ie(),{columns:B,columnChecks:m,data:j,getData:c,loading:D,mobilePagination:g,searchParams:x,resetSearchParams:S}=Je({apiFn:Ge,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:s=>!0,renderExpand:s=>o("div",{class:"detailList"},[o(je,{style:"max-height: 360px"},{default:()=>[a.value.length>0?a.value.map((n,l)=>o(M,{justify:"space-between",style:{marginBottom:"8px",padding:"0px 50px 8px 50px",borderBottom:l!==a.value.length-1?"1px dashed #ccc":"none"},key:n.sn},{default:()=>[o("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[n.sn]),o(M,null,{default:()=>[K(o(F,{type:"info",size:"small",ghost:!0,onClick:()=>R(n.sn,s.rtype)},{default:()=>[E("查看")]}),[[O("no-auth"),"sys.report.instance.select"]]),o(ve,{onPositiveClick:()=>P(n.sn,s.rtype,s.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>K(o(F,{type:"error",size:"small",ghost:!0},{default:()=>[E("删除")]}),[[O("no-auth"),"sys.report.instance.delete"]])})]})]})):o("div",{style:{textAlign:"center",padding:"10px"}},[E("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:s=>{var n;return o("div",null,[(n=Be(Ye).find(l=>l.value===s.rtype))==null?void 0:n.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:G("common.operate"),align:"center",width:160,render:s=>o("div",{class:"flex-center gap-8px"},[o(ve,{onPositiveClick:()=>z(s.tid,s.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>K(o(F,{type:"primary",ghost:!0,size:"small"},{default:()=>[E("清空")]}),[[O("no-auth"),"sys.report.instance.delete"]])})])}]}),k=L(null),y=L([]),$=async s=>{y.value=[s[s.length-1]],y.value[0]&&(a.value=[],await d());const n=j.value.findIndex(l=>l.tid===s[s.length-1]);setTimeout(()=>{var l;(l=k.value)==null||l.scrollTo({top:n*40,behavior:"smooth"})},500)},a=L([]),e=me({page:1,limit:10}),d=async()=>{const s=JSON.parse(JSON.stringify(j.value)).find(p=>p.tid===y.value[0]),{data:n,error:l}=await Ue({tid:y.value[0],page:e.page,limit:Number(s.num)||10});l||(a.value=n.list,Oe(()=>{const p=document.querySelector(".detailList");if(p){const{height:f}=p.getBoundingClientRect();p.animate([{height:"0px"},{height:`${f}px`}],{duration:300,easing:"linear"})}}))},_=L(!1),C=L({}),b=me({name:"",rtype:0}),R=async(s,n)=>{var f;const{data:l,error:p}=await Ve({name:s,type:n,tid:y.value[0]});b.name=s,b.rtype=n,p||(_.value=!0,C.value=JSON.parse(l),C.value.baseInfo=(f=C.value.baseInfo)==null?void 0:f.map(w=>({...w,dbtime:T(1,w.dbtime)})))},z=async(s,n)=>{var f;const{data:l,error:p}=await fe({tid:s,type:n});p||((f=window.$message)==null||f.success("清空成功"),a.value=[],c())},P=async(s,n,l)=>{var w;const{data:p,error:f}=await fe({fname:s,type:n,tid:l});f||((w=window.$message)==null||w.success("删除成功"),c(),d())};return(s,n)=>{const l=xe,p=ge,f=Ke,w=he;return J(),Ae("div",ca,[o(oa,{model:r(x),"onUpdate:model":n[0]||(n[0]=h=>_e(x)?x.value=h:null),onReset:r(S),onSearch:r(c)},null,8,["model","onReset","onSearch"]),o(w,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:u(()=>[pa]),"header-extra":u(()=>[o(r(M),null,{default:u(()=>[o(r(F),{size:"small",onClick:n[1]||(n[1]=h=>r(c)())},{icon:u(()=>[o(l,{class:Fe(["text-icon",{"animate-spin":r(D)}])},null,8,["class"])]),default:u(()=>[E(" "+V(r(G)("common.refresh")),1)]),_:1}),o(p,{columns:r(m),"onUpdate:columns":n[2]||(n[2]=h=>_e(m)?m.value=h:null)},null,8,["columns"])]),_:1})]),default:u(()=>[o(f,{ref_key:"tableContainer",ref:k,columns:r(B),data:r(j),size:"small","flex-height":!r(I).isMobile,"scroll-x":962,loading:r(D),remote:"","row-key":h=>h.tid,pagination:r(g),class:"sm:h-full","expanded-row-keys":y.value,"onUpdate:expandedRowKeys":$},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),o(da,{visible:_.value,"onUpdate:visible":n[3]||(n[3]=h=>_.value=h),data:C.value,detaliParams:b},null,8,["visible","data","detaliParams"])]),_:1})])}}});export{Ra as default};
