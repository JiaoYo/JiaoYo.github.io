import{_ as Te}from"./table-column-setting.vue_vue_type_script_setup_true_lang-t7808Gkb.js";import{_ as ke}from"./round-refresh-zqgBcUR_.js";import{o as F,e as ve,f as _e,d as te,p as Y,k as E,q as re,r as oe,s as xe,v as Ce,ab as se,ag as De,b as Se,$ as A,z as W,c as J,w as t,g as e,h as M,t as B,i as a,A as X,D as fe,C as $e,ba as Ue,bb as Ae,ak as le,L as de,aQ as Me,aW as ge,P as H,aX as he,Q as ue,B as L,aH as ce,aN as pe,aF as ie,be as qe,S as ze,aE as Le,ai as Oe,bc as Pe,b8 as Ve,x as Be,bd as Re,af as Z,aI as ae,aJ as je,aK as Ee,aL as Fe,a6 as Ge}from"./index-0mGYPo1s.js";import{_ as Ke}from"./round-add-N9wthsb3.js";import{_ as Je}from"./round-search-DN7dk8Rf.js";import{u as He,a as Qe}from"./table-DizN2DSq.js";import{_ as me}from"./FormItemGridItem-BtQjP6fQ.js";import{_ as ee,a as We}from"./Grid-C_AGY_UE.js";import{p as Xe}from"./gather--efwPfgo.js";import{_ as Ye}from"./Tree-CgzpHME5.js";import{y as Ze}from"./common-DVONoJnx.js";import{N as et}from"./Popconfirm-B3lTYIV4.js";import{_ as tt}from"./InputGroupLabel-Cx_-LR0L.js";const lt={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},at=_e("path",{fill:"currentColor",d:"M11 13v3q0 .425.288.713T12 17t.713-.288T13 16v-3h3q.425 0 .713-.288T17 12t-.288-.712T16 11h-3V8q0-.425-.288-.712T12 7t-.712.288T11 8v3H8q-.425 0-.712.288T7 12t.288.713T8 13zm1 9q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1),nt=[at];function ot(k,R){return F(),ve("svg",lt,[...nt])}const st={name:"material-symbols-add-circle-outline-rounded",render:ot},it=_e("span",null,"批量新增：格式为（转发设备1-10）",-1),rt=te({__name:"add_model",props:Y({operateType:{},rowData:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(k,{emit:R}){const f=E(!1),x=re(k,"visible"),D=R,m=k,l=oe(S());function S(){return{devName:"转发设备1",chlId:void 0,devCommAddr:"1",devPubAddr:"1",devValid:1,devDesc:"",reserve0:"",reserve1:""}}const n=oe({channelList:[]});async function N(){const{data:g,error:s}=await pe({type:1});s||(n.channelList=g)}async function O(){await N(),m.operateType==="edit"&&m.rowData?Object.assign(l,m.rowData):(Object.assign(l,S()),l.chlId=m.chlId||n.channelList[0].id)}const{formRef:T,validate:v,restoreValidation:d}=xe();Ce(),se(()=>m.rowData,()=>{O()}),se(x,()=>{x.value&&(m.operateType==="add"&&De(()=>{setTimeout(()=>{f.value=!0},200)}),O(),d())});const b=()=>{x.value=!1,f.value=!1},C=async()=>{var g,s,P;if(await v(),m.operateType==="add"){let c=[],p=l.devName;if(((g=l.devName)==null?void 0:g.indexOf("-"))!=-1){let i=Math.abs(p==null?void 0:p.substring(p.lastIndexOf("-")).replace(/[^0-9]/gi,"")),r=p.split(/-(?![^-]*-)/),o=p.substring(0,p.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],h=o.replace(/[^0]/g,""),V=o,G=r[0],z=G.substring(0,G.length-G.match(/(\d+)[^0-9]*$/)[1].length),K=i-o+1;for(let u=0;u<K;u++){let U=V++,Q=JSON.parse(JSON.stringify(l));Q.devName=parseInt(o)==0?h.length>0?String(U).length>=h.length?z+U:z+h.substring(0,h.length-String(U).length)+U:z+U:h.length>0?U>=10?z+h.substring(0,h.length-String(U).length+1)+U:z+h.substring(0,h.length)+U:z+U,Q.devCommAddr=Number(l.devCommAddr)+u,c.push(Q)}}else c=[l];if(c.length>1e3){(s=window.$message)==null||s.destroyAll(),(P=window.$message)==null||P.warning("批量添加最多仅支持1000条");return}const{data:j,error:q}=await Ue(c);q?console.log("error",q):(console.log("success",j),b(),D("submitted"))}else{const{data:c,error:p}=await Ae([l]);p?console.log("error",p):(console.log("success",c),b(),D("submitted"))}},_={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},y={devName:_,chlId:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},devCommAddr:_,devPubAddr:_},w=Se(()=>({add:A("common.add"),edit:A("common.edit")})[m.operateType]);return(g,s)=>{const P=le,c=me,p=de,j=Me,q=ge,i=H,r=he,o=ee,h=ue,V=L,G=H,z=ce,K=W("no-space");return F(),J(z,{show:x.value,"onUpdate:show":s[8]||(s[8]=u=>x.value=u),title:w.value,preset:"card",class:"w-30%",onAfterLeave:b},{footer:t(()=>[e(G,{size:16,justify:"center"},{default:t(()=>[e(V,{onClick:b,class:"w-100px"},{default:t(()=>[M(B(a(A)("common.cancel")),1)]),_:1}),e(V,{type:"primary",class:"w-100px",onClick:C},{default:t(()=>[M(B(a(A)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(h,{ref_key:"formRef",ref:T,model:l,rules:y,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:$e(C,["enter"])},{default:t(()=>[e(o,{responsive:"screen","item-responsive":""},{default:t(()=>[e(c,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(P,{filterable:"",placeholder:"请选择所属通道",value:l.chlId,"onUpdate:value":s[0]||(s[0]=u=>l.chlId=u),"label-field":"chlName","value-field":"id",options:n.channelList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:24",label:"设备名称",path:"devName"},{default:t(()=>[e(j,{show:f.value,placement:"right-start"},{trigger:t(()=>[X(e(p,{clearable:"",value:l.devName,"onUpdate:value":s[1]||(s[1]=u=>l.devName=u),maxlength:"64",placeholder:"请输入设备名称"},null,8,["value"]),[[K]])]),default:t(()=>[it]),_:1},8,["show"])]),_:1}),e(c,{span:"24 m:24",label:"通讯地址",path:"devCommAddr"},{default:t(()=>[e(p,{clearable:"",value:l.devCommAddr,"onUpdate:value":s[2]||(s[2]=u=>l.devCommAddr=u),maxlength:"50",placeholder:"请输入通讯地址"},null,8,["value"])]),_:1}),e(c,{span:"24 m:24",label:"公共地址",path:"devPubAddr"},{default:t(()=>[e(p,{clearable:"",value:l.devPubAddr,"onUpdate:value":s[3]||(s[3]=u=>l.devPubAddr=u),placeholder:"请输入公共地址"},null,8,["value"])]),_:1}),e(c,{span:"24 m:24",label:"保留0",path:"reserve0"},{default:t(()=>[e(p,{clearable:"",value:l.reserve0,"onUpdate:value":s[4]||(s[4]=u=>l.reserve0=u),placeholder:"(可空)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(c,{span:"24 m:24",label:"保留1",path:"reserve1"},{default:t(()=>[e(p,{clearable:"",value:l.reserve1,"onUpdate:value":s[5]||(s[5]=u=>l.reserve1=u),placeholder:"(可空)",style:{width:"100%"}},null,8,["value"])]),_:1}),m.operateType=="edit"?(F(),J(c,{key:0,span:"24 m:24",label:"设备有效性",path:"devValid"},{default:t(()=>[e(r,{value:l.devValid,"onUpdate:value":s[6]||(s[6]=u=>l.devValid=u),name:"radiogroup"},{default:t(()=>[e(i,null,{default:t(()=>[e(q,{label:"是",value:1}),e(q,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):fe("",!0),e(c,{span:"24 m:24",label:"设备描述",path:"devDesc"},{default:t(()=>[e(p,{clearable:"",value:l.devDesc,"onUpdate:value":s[7]||(s[7]=u=>l.devDesc=u),maxlength:"64",placeholder:"请输入设备描述",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),dt=te({__name:"batch_addModel",props:Y({chlList:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(k,{emit:R}){const f=re(k,"visible"),x=k,D=R,m=E([]),l=async()=>{const{data:v,error:d}=await pe({type:0});d||(m.value=v.map(b=>{var C;return{label:b.chlName,key:b.id+"10000",children:(C=b.devicePojoList)==null?void 0:C.map(_=>({label:_.devName,key:_.id}))}}))};se(()=>f.value,async v=>{v&&(l(),n.value={devIds:[],chlId:void 0,pre:void 0,valid:1,tagType:void 0,enbleType:!0},n.value.chlId=x.chlId)});const S=E(null),n=E({devIds:[],chlId:void 0,pre:"",valid:1,tagType:void 0,enbleType:!0}),N=async()=>{var _,$;const v=[];m.value.forEach(y=>{v.push(y.key)}),v.forEach(y=>{var w,g,s;(w=n.value.devIds)!=null&&w.includes(y)&&((s=n.value.devIds)==null||s.splice((g=n.value.devIds)==null?void 0:g.indexOf(y),1))}),n.value.enbleType&&(n.value.tagType="-1"),console.log(n.value);const d={pre:n.value.pre||"",chlId:n.value.chlId,devIds:(_=n.value.devIds)==null?void 0:_.join(","),valid:n.value.valid,tagType:n.value.tagType,enbleType:n.value.enbleType?1:0},{data:b,error:C}=await qe(d);C||(($=window.$message)==null||$.success("新增成功"),f.value=!1,D("submitted"))},O={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},T={chlId:O,tagType:O};return(v,d)=>{const b=Ye,C=ze,_=We,$=le,y=me,w=de,g=ge,s=H,P=he,c=ee,p=ue,j=ee,q=L,i=H,r=ce;return F(),J(r,{show:f.value,"onUpdate:show":d[7]||(d[7]=o=>f.value=o),title:"批量新增",preset:"card",class:"w-40%"},{footer:t(()=>[e(i,{size:16,justify:"center"},{default:t(()=>[e(q,{onClick:d[6]||(d[6]=o=>f.value=!1),class:"w-100px"},{default:t(()=>[M(B(v.$t("common.cancel")),1)]),_:1}),e(q,{type:"primary",class:"w-100px",onClick:N},{default:t(()=>[M(B(v.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(j,{"x-gap":"12"},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(C,{style:{"max-height":"220px"}},{default:t(()=>[e(b,{"block-line":"",data:m.value,"checked-keys":n.value.devIds,"onUpdate:checkedKeys":d[0]||(d[0]=o=>n.value.devIds=o),"expand-on-click":"","default-expand-all":!0,checkable:"",cascade:""},null,8,["data","checked-keys"])]),_:1})]),_:1}),e(_,{span:16},{default:t(()=>[e(p,{ref_key:"formRef",ref:S,"label-width":140,"label-placement":"left",model:n.value,rules:T},{default:t(()=>[e(c,{responsive:"screen","item-responsive":""},{default:t(()=>[e(y,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e($,{filterable:"",placeholder:"请选择所属通道",value:n.value.chlId,"onUpdate:value":d[1]||(d[1]=o=>n.value.chlId=o),"label-field":"chlName","value-field":"id",options:x.chlList},null,8,["value","options"])]),_:1}),e(y,{span:"24 m:24",label:"转发设备前缀",path:"pre"},{default:t(()=>[e(w,{value:n.value.pre,"onUpdate:value":d[2]||(d[2]=o=>n.value.pre=o),style:{width:"100%"},placeholder:"请输入转发设备前缀(可空)"},null,8,["value"])]),_:1}),e(y,{span:"24 m:24",label:"是否匹配测点类型",path:"enbleType"},{default:t(()=>[e(P,{value:n.value.enbleType,"onUpdate:value":d[3]||(d[3]=o=>n.value.enbleType=o),name:"radiogroup"},{default:t(()=>[e(s,null,{default:t(()=>[e(g,{label:"是",value:!0}),e(g,{label:"否",value:!1})]),_:1})]),_:1},8,["value"])]),_:1}),n.value.enbleType==!1?(F(),J(y,{key:0,span:"24 m:24",label:"测点类型",path:"tagType"},{default:t(()=>[e($,{filterable:"",placeholder:"请选择测点类型",value:n.value.tagType,"onUpdate:value":d[4]||(d[4]=o=>n.value.tagType=o),options:a(ie)(a(Xe))},null,8,["value","options"])]),_:1})):fe("",!0),e(y,{span:"24 m:24",label:"设备有效性",path:"valid"},{default:t(()=>[e(P,{value:n.value.valid,"onUpdate:value":d[5]||(d[5]=o=>n.value.valid=o),name:"radiogroup"},{default:t(()=>[e(s,null,{default:t(()=>[e(g,{label:"是",value:1}),e(g,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1},8,["show"])}}}),ut=te({__name:"move_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:Y(["submitted"],["update:visible"]),setup(k,{emit:R}){const x=Le({0:"采集104tcp",1:"采集104udp"}),D=re(k,"visible"),m=E(null),l=E({targetDevice:void 0,EquipmentMerged:void 0}),S=()=>{},N={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}};return(O,T)=>{const v=le,d=me,b=ee,C=ue,_=L,$=H,y=ce;return F(),J(y,{show:D.value,"onUpdate:show":T[3]||(T[3]=w=>D.value=w),title:"设备移动至通道",preset:"card",class:"w-40%"},{footer:t(()=>[e($,{size:16,justify:"center"},{default:t(()=>[e(_,{onClick:T[2]||(T[2]=w=>D.value=!1),class:"w-100px"},{default:t(()=>[M(B(O.$t("common.cancel")),1)]),_:1}),e(_,{type:"primary",class:"w-100px",onClick:S},{default:t(()=>[M(B(O.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(C,{ref_key:"formRef",ref:m,"label-width":120,"label-placement":"left",model:l.value,rules:N},{default:t(()=>[e(b,{responsive:"screen","item-responsive":""},{default:t(()=>[e(d,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:t(()=>[e(v,{filterable:"",clearable:"",placeholder:"请选择通道",value:l.value.targetDevice,"onUpdate:value":T[0]||(T[0]=w=>l.value.targetDevice=w),options:a(ie)(a(x))},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"待移动设备",path:"EquipmentMerged"},{default:t(()=>[e(v,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:l.value.EquipmentMerged,"onUpdate:value":T[1]||(T[1]=w=>l.value.EquipmentMerged=w),options:a(ie)(a(x))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),ct={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ne(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!je(k)}const kt=te({name:"configsetting_forwardingservice_forwardingdevicemanagement",__name:"index",setup(k){const R=Oe(),f=oe({channelList:[],chlIdAndNameMap:{}}),{columns:x,columnChecks:D,data:m,getData:l,loading:S,mobilePagination:n,searchParams:N,resetSearchParams:O}=He({apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,type:1,chlId:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"设备ID",align:"center",width:60},{key:"devName",title:"设备名称",align:"center",width:100},{key:"chlId",title:"所属通道",align:"center",width:140,render:i=>e("span",null,[f.chlIdAndNameMap[i.chlId]])},{key:"devDesc",title:"设备描述",align:"center",width:140,render:i=>e("span",null,[i.devDesc?i.devDesc:"无"])},{key:"devCommAddr",title:"设备通信地址",align:"center",width:140},{key:"devPubAddr",title:"设备公共地址",align:"center",width:140},{key:"devValid",title:"有效性",align:"center",width:140,render:i=>{let r;return e(Ve,{type:i.devValid==0?"error":"success"},ne(r=A(Ze[i.devValid]))?r:{default:()=>[r]})}},{key:"operate",title:A("common.operate"),align:"center",width:240,fixed:"right",render:i=>{let r;return e("div",{class:"flex-center gap-8px"},[e(L,{type:"primary",ghost:!0,size:"small",onClick:()=>q(i)},{default:()=>["转发测点管理"]}),X(e(L,{type:"primary",ghost:!0,size:"small",onClick:()=>s(i.id)},ne(r=A("common.edit"))?r:{default:()=>[r]}),[[W("no-auth"),"device:update"]]),X(e(et,{onPositiveClick:()=>g(i.id)},{default:()=>A("common.confirmDelete"),trigger:()=>{let o;return e(L,{type:"error",ghost:!0,size:"small"},ne(o=A("common.delete"))?o:{default:()=>[o]})}}),[[W("no-auth"),"device:delete"]])])}}]});async function T(){var o;const{data:i,error:r}=await pe({type:1});if(!r){if(i.length==0)return(o=window.$message)==null?void 0:o.warning("暂无转发通道，请先添加通道");f.channelList=i,i.forEach(V=>{f.chlIdAndNameMap[V.id]=V.chlName});const h=R.currentRoute.value.query.channelId;h&&(N.chlId=Number(h)),l()}}Be(()=>{T()});const{drawerVisible:v,operateType:d,editingData:b,handleAdd:C,handleEdit:_,checkedRowKeys:$,onBatchDeleted:y,onDeleted:w}=Qe(m,l),g=async i=>{const{data:r,error:o}=await Re({ids:i});o||w()},s=i=>{_(i)},P=i=>{N.chlId=i,l()},c=E(!1),p=()=>{c.value=!0},j=E(!1),q=i=>{R.push({path:"/configsetting/forwardingservice/forwardingpointmanagement",query:{channelId:i.chlId,deviceId:i.id}})};return(i,r)=>{const o=tt,h=le,V=de,G=Je,z=Ee,K=H,u=Ke,U=st,Q=ke,be=Te,ye=Fe,we=Ge,Ie=W("no-space"),Ne=W("no-auth");return F(),ve("div",ct,[e(we,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(K,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(z,null,{default:t(()=>[e(o,null,{default:t(()=>[M("所属通道")]),_:1}),e(h,{filterable:"",clearable:"",placeholder:"请选择通道",value:a(N).chlId,"onUpdate:value":r[0]||(r[0]=I=>a(N).chlId=I),"label-field":"chlName","value-field":"id",options:f.channelList,onUpdateValue:P},null,8,["value","options"]),e(o,null,{default:t(()=>[M("设备名称")]),_:1}),X(e(V,{clearable:"",value:a(N).fuzzy,"onUpdate:value":r[1]||(r[1]=I=>a(N).fuzzy=I),placeholder:"请输入设备名称",style:{width:"100%"}},null,8,["value"]),[[Ie]]),e(a(L),{type:"primary",ghost:"",onClick:a(l)},{icon:t(()=>[e(G,{class:Z(["text-icon",{"animate-spin":a(S)}])},null,8,["class"])]),default:t(()=>[M(" "+B(a(A)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":t(()=>[e(K,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[X((F(),J(a(L),{onClick:a(C),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(u,{class:Z(["text-icon",{"animate-spin":a(S)}])},null,8,["class"])]),default:t(()=>[M(" "+B(a(A)("common.add")),1)]),_:1},8,["onClick"])),[[Ne,"device:insert"]]),e(a(L),{onClick:p,size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(U,{class:Z(["text-icon",{"animate-spin":a(S)}])},null,8,["class"])]),default:t(()=>[M(" "+B("批量新增"))]),_:1}),e(a(L),{onClick:a(l),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(Q,{class:Z(["text-icon",{"animate-spin":a(S)}])},null,8,["class"])]),_:1},8,["onClick"]),e(be,{columns:a(D),"onUpdate:columns":r[2]||(r[2]=I=>ae(D)?D.value=I:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ye,{"checked-row-keys":a($),"onUpdate:checkedRowKeys":r[3]||(r[3]=I=>ae($)?$.value=I:null),columns:a(x),data:a(m),size:"small",loading:a(S),remote:"","row-key":I=>I.id,pagination:a(n),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(rt,{visible:a(v),"onUpdate:visible":r[4]||(r[4]=I=>ae(v)?v.value=I:null),onSubmitted:a(l),"operate-type":a(d),"row-data":a(b),chlId:a(N).chlId},null,8,["visible","onSubmitted","operate-type","row-data","chlId"]),e(dt,{visible:c.value,"onUpdate:visible":r[5]||(r[5]=I=>c.value=I),chlList:f.channelList,chlId:a(N).chlId,onSubmitted:a(l)},null,8,["visible","chlList","chlId","onSubmitted"]),e(ut,{visible:j.value,"onUpdate:visible":r[6]||(r[6]=I=>j.value=I)},null,8,["visible"])]),_:1})])}}});export{kt as default};
