import{d as N,n as C,dM as P,a4 as D,s as E,j as y,ae as $,o as k,c as B,w as u,f as g,g as n,aa as R,i as w,a_ as x,S as V,ar as M,P as I,Q as U,R as H,e as L,h as O,K as F,B as G,O as J,ad as Q}from"./index-DwoPSGmk.js";import{n as W,a as j}from"./reportForm-Birssc-U.js";import{_ as q,a as z,b as K,c as X}from"./file-pdf-vAxopOSf.js";import{_ as Y}from"./DatePicker-CTufHmAW.js";import{a as Z,_ as ee}from"./Grid-NKVy6VcP.js";import"./echarts.vue_vue_type_script_setup_true_lang-CuSGzgyE.js";import"./index-BhRqCdHu.js";import"./installCanvasRenderer-CyOrKSjT.js";import"./install-CX03SWNg.js";import"./TimePicker-Dvws3tHk.js";import"./defineProperty-pR-XJgzJ.js";const ae=d=>(I("data-v-d674d4e5"),d=d(),U(),d),te=ae(()=>g("span",{class:"mr-20px"},"报表预览",-1)),le={title:"导出PDF"},ne={title:"导出Word"},oe={title:"导出Excel"},se=N({name:"reportPreview",__name:"reportPreview",props:C({data:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(d){P(c=>({"03cdc49e":w(h)}));const i=D(),_=d,s=E(d,"visible"),v=y(""),b=()=>{var c,o;v.value=((o=(c=_.data)==null?void 0:c.find(r=>r.type=="title"))==null?void 0:o.value)+"报表"+x(1,new Date)};$(s,()=>{s.value&&b()});const f=y(),h=i.themeScheme=="dark"?"#001428":"#fff";return(c,o)=>{const r=q,t=z,a=K,e=X,l=V,p=M;return k(),B(p,{show:s.value,"onUpdate:show":o[3]||(o[3]=m=>s.value=m),preset:"card",class:"w-1000px reportPreview",style:R({"background-color":w(i).themeScheme=="dark"?"#001428":"#fff"})},{header:u(()=>[te,g("span",le,[n(r,{class:"text-32px c-#d63031 cursor-pointer",onClick:o[0]||(o[0]=m=>f.value.toPdf(v.value))})]),g("span",ne,[n(t,{class:"text-32px c-#1e90ff cursor-pointer",onClick:o[1]||(o[1]=m=>f.value.toWord(v.value))})]),g("span",oe,[n(a,{class:"text-32px c-#15703d cursor-pointer",onClick:o[2]||(o[2]=m=>f.value.toExcel(v.value))})])]),default:u(()=>[n(l,{class:"max-h-600px"},{default:u(()=>[n(e,{ref_key:"filePreviewExportRef",ref:f,width:800,data:_.data},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),re=H(se,[["__scopeId","data-v-d674d4e5"]]),ge=N({name:"reportmanagement_reporttemplate",__name:"index",setup(d){const i=y([]),_=y(!1),s=y({startTime:x(0,new Date().getTime()-864e5*3),endTime:x(0,new Date().getTime()),time:[new Date().getTime()-864e5*3,new Date().getTime()]}),v=["提示","低危","中危","高危","致命"],b=["lev0","lev1","lev2","lev3","lev4"];async function f(r,t){s.value.startTime=t?x(0,t[0]):void 0,s.value.endTime=t?x(0,t[1]):void 0}const h=async r=>{const{data:t,error:a}=await j({rtype:r});a||(t.forEach(e=>{e.rtext=JSON.parse(e.rtext)}),i.value=t[0].rtext,console.log(i.value,"reportTemplate.value"))},c=y([]),o=async()=>{await h(0);const{data:r}=await W({startTime:s.value.startTime,endTime:s.value.endTime});if(r){const t=JSON.parse(r);console.log(t,"报表接口返回数据"),i.value.forEach(a=>{a.type=="table"&&(a.dataName=="collection"&&(a.value.body=t.collection.map(e=>a.value.tableHeaderValue.map(l=>l=="ctime"?x(1,e[l]):e[l]))),a.dataName=="events"&&(a.value.body=t.events.map(e=>a.value.tableHeaderValue.map(l=>e[l]))),a.dataName=="level"&&(a.value.body=t.level.map(e=>a.value.tableHeaderValue.map(l=>e[l]))),a.dataName=="level1"&&(a.value.body=b.map(e=>[e=="lev0"?"提示":e=="lev1"?"低危":e=="lev2"?"中危":e=="lev3"?"高危":"致命",t.level.reduce((l,p)=>l+(Number(p[e])||0),0)]))),a.type=="chart"&&a.dataName=="events"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=t.events.map(e=>e.count),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=t.events.map(e=>e.cname):a.value.data.yAxis.data=t.events.map(e=>e.cname)),a.value.chartType=="pie"&&(a.value.data.series[0].data=t.events.map(e=>({value:e.count,name:e.cname}))),a.value.chartType=="line"&&(a.value.data.series[0].data=t.events.map(e=>e.count),a.value.data.xAxis.data=t.events.map(e=>e.cname))),a.dataName=="level"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=t.level.map(e=>e.count),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=t.level.map(e=>e.logname):a.value.data.yAxis.data=t.level.map(e=>e.logname)),a.value.chartType=="pie"&&(a.value.data.series[0].data=t.level.map(e=>({value:e.count,name:e.logname}))),a.value.chartType=="line"&&(a.value.data.series[0].data=t.level.map(e=>e.count),a.value.data.xAxis.data=t.level.map(e=>e.logname))),a.dataName=="level1"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(e=>t.level.reduce((l,p)=>l+(Number(p[e])||0),0)),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=v:a.value.data.yAxis.data=v),a.value.chartType=="pie"&&(a.value.data.series[0].data=[{value:t.level.reduce((e,l)=>e+l.lev0*1,0),name:"提示"},{value:t.level.reduce((e,l)=>e+l.lev1*1,0),name:"低危"},{value:t.level.reduce((e,l)=>e+l.lev2*1,0),name:"中危"},{value:t.level.reduce((e,l)=>e+l.lev3*1,0),name:"高危"},{value:t.level.reduce((e,l)=>e+l.lev4*1,0),name:"致命"}]),a.value.chartType=="line"&&(a.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(e=>t.level.reduce((l,p)=>l+(Number(p[e])||0),0)),a.value.data.xAxis.data=v))}),c.value=i.value,console.log(c.value,"reportList.value"),_.value=!0}};return(r,t)=>{const a=Y,e=F,l=G,p=J,m=Q,S=Z,A=ee;return k(),L("div",null,[n(A,{"x-gap":"12",cols:2},{default:u(()=>[n(S,null,{default:u(()=>[n(m,{title:"报表信息"},{default:u(()=>[n(p,{ref:"formRef",class:"h-200px","label-width":80,"label-placement":"left",model:s.value},{default:u(()=>[n(e,{label:"查询日期",path:"selectTime"},{default:u(()=>[n(a,{value:s.value.time,"onUpdate:value":t[0]||(t[0]=T=>s.value.time=T),type:"daterange",class:"w-100%","onUpdate:formattedValue":f},null,8,["value"])]),_:1}),n(e,{label:""}),n(e,{label:" "},{default:u(()=>[n(l,{"attr-type":"button",onClick:o},{default:u(()=>[O(" 查询 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),n(re,{data:c.value,visible:_.value,"onUpdate:visible":t[1]||(t[1]=T=>_.value=T)},null,8,["data","visible"])])}}});export{ge as default};
