import{_ as ke}from"./round-delete-BcVZiUgs.js";import{_ as Ne}from"./round-add-m1RhtTAe.js";import{d as J,av as V,D as oe,A as ne,a as xe,at as se,au as ze,aQ as Ce,c as $,o as j,w as t,f as e,a3 as le,M as Q,h as o,H as A,J as H,B as g,g as v,t as w,$ as m,a4 as re,L as De,a2 as ie,aI as Se,E as Re,s as L,F as E,b as je,aJ as K,az as Pe,I as B,aK as Te,e as I,G as Fe,N as $e,aS as Me,Q as Ue,aT as Le,aP as Be}from"./index-CSRAu6Mr.js";import{o as Ie,p as Ve,q as ee,j as Ae}from"./aftersale-WbdV2uIG.js";import{u as Oe,a as qe}from"./table-C4ThAVf4.js";import{_ as ce}from"./Grid-FmK2KN02.js";import{_ as de}from"./FormItemGridItem-C5FHRong.js";import{_ as Ge}from"./round-search-Bq40G238.js";import{_ as Ee}from"./round-refresh-BdnAPG6i.js";import{N as te}from"./Popconfirm-BAXNfjls.js";const Ke=J({name:"OperateDrawer",__name:"operate-drawer",props:V({operateType:{},rowData:{},provinceList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(f,{emit:P}){const y=P,p=f,r=oe(i());function i(){return{id:"",rs:"",rsdesc:""}}async function D(){Object.assign(r,i()),p.operateType==="edit"&&p.rowData&&Object.assign(r,p.rowData)}const{formRef:_,validate:N,restoreValidation:M}=ne(),b={rs:{type:"string",required:!0,trigger:["blur","change"],message:"请输入售后原因"}},x=xe(()=>({add:"新增售后原因",edit:"修改售后原因"})[p.operateType]),u=se(f,"visible");ze(u,()=>{u.value&&(D(),setTimeout(()=>{const c=document.querySelector(".n-scrollbar-content");c==null||c.scrollTo(0,0)},300),M())});function z(){u.value=!1}const S=Ce.debounce(async()=>{var c,s;if(await N(),p.operateType==="edit"){const{data:k,error:h}=await Ie([r]);h||(z(),y("submitted"),(c=window.$message)==null||c.success("修改成功"))}else{const{data:k,error:h}=await Ve([{...r}]);h||(z(),y("submitted"),(s=window.$message)==null||s.success("添加成功"))}},1e3,{leading:!0,trailing:!0});return(c,s)=>{const k=de,h=ce,T=Q,F=le,O=H,q=re;return j(),$(q,{show:u.value,"onUpdate:show":s[2]||(s[2]=C=>u.value=C),title:x.value,preset:"card",class:"w-600px","mask-closable":!1,draggable:!0},{footer:t(()=>[e(O,{justify:"end",size:16},{default:t(()=>[e(o(g),{onClick:z},{default:t(()=>[v(w(o(m)("common.cancel")),1)]),_:1}),e(o(g),{type:"primary",onClick:o(S)},{default:t(()=>[v(w(o(m)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(F,{class:"pr-20px"},{default:t(()=>[e(T,{ref_key:"formRef",ref:_,model:r,rules:b,"label-placement":"left","label-width":120},{default:t(()=>[e(h,{responsive:"screen","item-responsive":""},{default:t(()=>[e(k,{span:"24 m:24",label:"售后原因",path:"rs"},{default:t(()=>[e(o(A),{value:r.rs,"onUpdate:value":s[0]||(s[0]=C=>r.rs=C),placeholder:"请输入"},null,8,["value"])]),_:1}),e(k,{span:"24 m:24",label:"描述",path:"rsdesc"},{default:t(()=>[e(o(A),{value:r.rsdesc,"onUpdate:value":s[1]||(s[1]=C=>r.rsdesc=C),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Je=J({name:"FormSearch",__name:"form-search",props:V({provinceList:{}},{model:{required:!0},modelModifiers:{}}),emits:V(["reset","search"],["update:model"]),setup(f,{emit:P}){const y=P,{formRef:p,restoreValidation:r}=ne(),i=se(f,"model");function D(){i.value.fuzzy="",i.value.page=1,y("search")}async function _(){i.value.fuzzy="",await r(),y("reset")}async function N(){y("search"),i.value.page=1}return(M,b)=>{const x=A,u=de,z=Ee,S=g,c=Ge,s=H,k=ce,h=Q,T=ie;return j(),$(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(h,{ref_key:"formRef",ref:p,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:De(N,["enter"])},{default:t(()=>[e(k,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(u,{span:"24 s:12 m:4",label:"",path:"fuzzy"},{default:t(()=>[e(x,{clearable:"",value:i.value.fuzzy,"onUpdate:value":b[0]||(b[0]=F=>i.value.fuzzy=F),placeholder:"请输入关键字",onClear:D},null,8,["value"])]),_:1}),e(u,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(s,{class:"w-full"},{default:t(()=>[e(S,{onClick:_},{icon:t(()=>[e(z,{class:"text-icon"})]),default:t(()=>[v(" "+w(o(m)("common.reset")),1)]),_:1}),e(S,{type:"primary",ghost:"",onClick:N},{icon:t(()=>[e(c,{class:"text-icon"})]),default:t(()=>[v(" "+w(o(m)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},He={style:{"font-weight":"500",color:"#1890ff","margin-right":"15px","font-size":"20px"}};function ae(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!Be(f)}const lt=J({name:"aftersales_aftersalesreason",__name:"index",setup(f){const P=Se(),{patternRules:y}=Re(),p=L([]);(async()=>{const{data:n}=await Me();n&&(p.value=n)})();const{columns:i,data:D,getData:_,loading:N,mobilePagination:M,searchParams:b}=Oe({showTotal:!0,apiFn:Ae,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"rs",title:"售后原因",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"rsdesc",title:"描述",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:m("common.operate"),align:"center",width:140,fixed:"right",render:n=>{let a;return e("div",{class:"flex-center gap-8px"},[B(e(g,{type:"primary",ghost:!0,size:"small",onClick:()=>O(n.id)},ae(a=m("common.edit"))?a:{default:()=>[a]}),[[E("no-auth"),"project:Dispatch:update"]]),e(te,{onPositiveClick:()=>F(n.id)},{default:()=>m("common.confirmDelete"),trigger:()=>{let l;return B(e(g,{type:"error",ghost:!0,size:"small"},ae(l=m("common.delete"))?l:{default:()=>[l]}),[[E("no-auth"),"project:Dispatch:delete"]])}})])}}]}),{drawerVisible:x,operateType:u,editingData:z,handleAdd:S,handleEdit:c,checkedRowKeys:s,onBatchDeleted:k,onDeleted:h}=qe(D,_);async function T(){console.log(s.value),q(s.value.join(","),n=>{k()})}async function F(n){const{data:a,error:l}=await ee(n);l||h()}function O(n){c(n)}async function q(n,a){const{data:l,error:G}=await ee(n);if(!G)a&&a(l);else return!1}const C=n=>{_()},pe=()=>{_()},W=L(!1),R=oe({id:"",name:"",pwd:""}),X=L(null),ue={pwd:[{required:!0,message:"请输入密码",trigger:"blur"},y.password]},U=L(""),me=async()=>{var l;await((l=X.value)==null?void 0:l.validate());const n=Ue(R.pwd),a=await Le({id:R.id,pwd:n});a.error||(U.value=a.data)},fe=n=>{n&&navigator.clipboard.writeText(n).then(()=>{var a;(a=window.$message)==null||a.success("已复制到剪贴板")}).catch(()=>{var a;(a=window.$message)==null||a.error("复制失败，请手动复制")})};return(n,a)=>{const l=H,G=Ne,_e=ke,he=Pe,ge=ie,ve=A,Y=$e,we=Q,ye=le,be=re,Z=E("no-auth");return j(),je("div",Qe,[e(Je,{model:o(b),"onUpdate:model":a[0]||(a[0]=d=>K(b)?b.value=d:null),onReset:pe,onSearch:o(_),provinceList:p.value},null,8,["model","onSearch","provinceList"]),e(ge,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(l,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>a[6]||(a[6]=[I("div",null,"售后原因",-1)])),_:1,__:[6]})]),"header-extra":t(()=>[e(l,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[B((j(),$(o(g),{onClick:o(S),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(G,{class:"text-icon"})]),default:t(()=>[a[7]||(a[7]=v(" "+w("新增")))]),_:1,__:[7]},8,["onClick"])),[[Z,"project:Dispatch:insert"]]),e(o(te),{onPositiveClick:T},{trigger:t(()=>[B((j(),$(o(g),{size:"small",ghost:"",type:"error",disabled:o(s).length==0},{icon:t(()=>[e(_e,{class:Te(["text-icon",{"animate-spin":o(N)}])},null,8,["class"])]),default:t(()=>[a[8]||(a[8]=v(" "+w("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[Z,"project:Dispatch:delete"]])]),default:t(()=>[a[9]||(a[9]=v(" 确定要删除选中的调度吗？ "))]),_:1,__:[9]})]),_:1})]),default:t(()=>[e(he,{"checked-row-keys":o(s),"onUpdate:checkedRowKeys":a[1]||(a[1]=d=>K(s)?s.value=d:null),columns:o(i),data:o(D),size:"small","flex-height":!o(P).isMobile,loading:o(N),remote:"","row-key":d=>d.id,pagination:o(M),class:"sm:h-full","onUpdate:filters":C},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ke,{visible:o(x),"onUpdate:visible":a[2]||(a[2]=d=>K(x)?x.value=d:null),onSubmitted:o(_),"operate-type":o(u),provinceList:p.value,"row-data":o(z)},null,8,["visible","onSubmitted","operate-type","provinceList","row-data"])]),_:1}),e(be,{show:W.value,"onUpdate:show":a[5]||(a[5]=d=>W.value=d),title:"查看主站联系方式",preset:"card",class:"w-420px"},{footer:t(()=>[e(l,{justify:"end",size:16},{default:t(()=>[e(o(g),{type:"primary",onClick:me},{default:t(()=>[v(w(o(m)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(ye,{class:"max-h-480px pr-20px"},{default:t(()=>[e(we,{ref_key:"checkformRef",ref:X,model:R,"label-placement":"left",rules:ue,"label-width":80,"require-mark-placement":"left"},{default:t(()=>[e(Y,{label:o(m)("page.login.common.password"),path:"pwd"},{default:t(()=>[e(ve,{type:"password","show-password-on":"click",clearable:"",value:R.pwd,"onUpdate:value":a[3]||(a[3]=d=>R.pwd=d),placeholder:"请输入当前登录账号密码"},null,8,["value"])]),_:1},8,["label"]),U.value?(j(),$(Y,{key:0,label:" "},{default:t(()=>[I("div",null,[I("span",null,w(`${R.name}的主站联系方式为：`),1),I("span",He,w(U.value),1),e(o(g),{size:"tiny",type:"primary",ghost:"",onClick:a[4]||(a[4]=d=>fe(U.value))},{default:t(()=>a[10]||(a[10]=[v(" 复制 ")])),_:1,__:[10]})])]),_:1})):Fe("",!0)]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}});export{lt as default};
