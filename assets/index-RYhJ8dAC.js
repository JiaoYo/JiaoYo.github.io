import{_ as Ce}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DtGc5Ytf.js";import{_ as De}from"./round-delete-tdauvCgt.js";import{_ as Se}from"./round-add-CmnuyzV1.js";import{d as J,aG as L,aI as se,A as ce,D as me,a as Re,$ as l,C as fe,aE as _e,E as V,c as M,o as R,w as t,f as e,bh as Fe,L as oe,F as ie,N as ge,h as s,H as O,G as ne,aF as ve,c1 as $e,aM as Te,I as H,b as we,a2 as ze,a3 as Be,B as S,g as w,t as x,bj as Ie,c2 as Me,c3 as Oe,c4 as je,aN as Ve,K as Ae,bi as qe,a7 as ye,bL as ue,e as Ge,a9 as he,c5 as Ee,bW as Ke,aT as Le,s as ee,aU as E,aJ as Je,aV as He,a8 as We,c6 as Ze,c7 as Qe,c8 as Xe,aO as ae,aZ as Ye}from"./index-CYktWG4g.js";import{u as ea,a as aa}from"./table-5HkGqXjJ.js";import{u as te,d as ta}from"./business-Dita21DL.js";import{_ as sa}from"./round-search-DE64LlxI.js";import{_ as oa}from"./round-refresh-BIWjpXWE.js";import{_ as na}from"./Grid-yccwcNrM.js";import{_ as la}from"./FormItemGridItem-CEINFz71.js";import{_ as ra}from"./Tree-CnH-bhFH.js";import{h as de}from"./permission-B_M-ULh7.js";import{N as pe}from"./Popconfirm-CztqIDpP.js";const ia=J({name:"OperateDrawer",__name:"operate-drawer",props:L({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:L(["submitted"],["update:visible"]),setup(y,{emit:P}){const v=[{label:"是",value:0},{label:"否",value:1}],c=y,U=P,i=se(y,"visible"),{formRef:N,validate:z,restoreValidation:C}=ce(),{createConfirmPwdRule:B,defaultRequiredRule:p,patternRules:u}=me(),m=Re(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[c.operateType]),n=fe(h());function h(){return{id:void 0,username:"",oripwd:"",password:"",confirmPassword:"",usertype:void 0,superadmin:0,userimage:"",phnum:"",udesc:"",status:0}}const b={username:p,usertype:{type:"string",required:!0,trigger:"change",message:"请选择用户类型"},status:{type:"number",required:!0,trigger:"change",message:"请选择用户状态"},oripwd:{...p,...u.password},password:{...p,...u.password},phnum:{...p,...u.mobile}};async function I(){if(Object.assign(n,h()),c.operateType==="edit"&&c.rowData){const{data:D,error:r}=await Me(c.rowData.id);r?Object.assign(n,c.rowData):(Object.assign(n,D),n.usertype=n.usertype+"")}}function F(){i.value=!1}async function j(){var D,r;if(await z(),c.operateType==="add"){const{data:k,error:_}=await Oe(n);_||((D=window.$message)==null||D.success(l("common.addSuccess")),F(),U("submitted"))}else{const{data:k,error:_}=await je(n);_||((r=window.$message)==null||r.success(l("common.updateSuccess")),F(),U("submitted"))}}return _e(i,()=>{i.value&&(I(),C())}),(D,r)=>{const k=ne,_=ge,$=ve,W=Ve,T=H,A=Te,f=oe,q=S,Z=Fe,Q=Ie,o=V("no-special");return R(),M(Q,{show:i.value,"onUpdate:show":r[8]||(r[8]=a=>i.value=a),"display-directive":"show",width:360},{default:t(()=>[e(Z,{title:m.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(T,{size:16},{default:t(()=>[e(q,{onClick:F},{default:t(()=>[w(x(s(l)("common.cancel")),1)]),_:1}),e(q,{type:"primary",onClick:j},{default:t(()=>[w(x(s(l)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(f,{ref_key:"formRef",ref:N,model:n,rules:b},{default:t(()=>[e(_,{label:s(l)("page.manage.user.username"),path:"username"},{default:t(()=>[O(e(k,{value:n.username,"onUpdate:value":r[0]||(r[0]=a=>n.username=a),placeholder:s(l)("page.manage.user.form.username"),readonly:c.operateType==="edit"},null,8,["value","placeholder","readonly"]),[[o]])]),_:1},8,["label"]),c.operateType==="add"?(R(),M(_,{key:0,label:s(l)("page.login.common.password"),path:"password"},{default:t(()=>[e(k,{value:n.password,"onUpdate:value":r[1]||(r[1]=a=>n.password=a),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:s(l)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])):ie("",!0),c.operateType==="add"?(R(),M(_,{key:1,label:s(l)("page.login.common.confirmPassword"),path:"confirmPassword",rule:s(B)(n.password)},{default:t(()=>[e(k,{value:n.confirmPassword,"onUpdate:value":r[2]||(r[2]=a=>n.confirmPassword=a),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:s(l)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rule"])):ie("",!0),e(_,{label:"用户类型",path:"usertype"},{default:t(()=>[e($,{value:n.usertype,"onUpdate:value":r[3]||(r[3]=a=>n.usertype=a),clearable:"",filterable:"",placeholder:"请选择用户类型",options:s($e)(n.usertype==0?s(te):s(te).slice(1)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(_,{label:"用户状态",path:"status"},{default:t(()=>[e($,{value:n.status,"onUpdate:value":r[4]||(r[4]=a=>n.status=a),clearable:"",filterable:"",placeholder:"请选择用户类型",options:[{label:"正常",value:0},{label:"异常",value:1}],style:{width:"100%"}},null,8,["value"])]),_:1}),e(_,{label:"是否为我司内部人员",path:"superadmin"},{default:t(()=>[e(A,{value:n.superadmin,"onUpdate:value":r[5]||(r[5]=a=>n.superadmin=a),name:"radiogroup",disabled:""},{default:t(()=>[e(T,null,{default:t(()=>[(R(),we(ze,null,Be(v,(a,g)=>e(W,{key:g,value:a.value},{default:t(()=>[w(x(a.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])]),_:1}),e(_,{label:"手机号码",path:"phnum"},{default:t(()=>[e(k,{clearable:"",value:n.phnum,"onUpdate:value":r[6]||(r[6]=a=>n.phnum=a),maxlength:11,placeholder:"请输入手机号码"},null,8,["value"])]),_:1}),e(_,{label:"描述",path:"udesc"},{default:t(()=>[e(k,{type:"textarea",clearable:"",value:n.udesc,"onUpdate:value":r[7]||(r[7]=a=>n.udesc=a),placeholder:"请输入描述",autosize:{minRows:3}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ua=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:L(["reset","search"],["update:model"]),setup(y,{emit:P}){const v=P,{formRef:c,restoreValidation:U}=ce(),i=se(y,"model");function N(){i.value.username="",v("search")}async function z(){await U(),i.value.usertype=null,i.value.username="",v("reset")}async function C(){v("search")}const B=u=>{i.value.usertype=u,v("search")},p=()=>{i.value.usertype=null,v("search")};return(u,m)=>{const n=ne,h=la,b=ve,I=oa,F=S,j=sa,D=H,r=na,k=oe,_=ye;return R(),M(_,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(k,{ref_key:"formRef",ref:c,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ae(C,["enter"])},{default:t(()=>[e(r,{responsive:"screen","item-responsive":""},{default:t(()=>[e(h,{span:"24 s:12 m:6",label:s(l)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:t(()=>[e(n,{clearable:"",value:i.value.username,"onUpdate:value":m[0]||(m[0]=$=>i.value.username=$),valueModifiers:{trim:!0},placeholder:s(l)("page.manage.user.form.username"),onClear:N},null,8,["value","placeholder"])]),_:1},8,["label"]),e(h,{span:"24 s:12 m:6",label:"用户类型",path:"usertype",class:"pr-24px"},{default:t(()=>[e(b,{value:i.value.usertype,"onUpdate:value":[m[1]||(m[1]=$=>i.value.usertype=$),B],clearable:"",placeholder:"请选择用户类型",onClear:p,options:s(qe)(s(te))},null,8,["value","options"])]),_:1}),e(h,{span:"24 s:12 m:6",class:"pr-24px"},{default:t(()=>[e(D,{class:"w-full"},{default:t(()=>[e(F,{onClick:z},{icon:t(()=>[e(I,{class:"text-icon"})]),default:t(()=>[w(" "+x(s(l)("common.reset")),1)]),_:1}),e(F,{type:"primary",ghost:"",onClick:C},{icon:t(()=>[e(j,{class:"text-icon"})]),default:t(()=>[w(" "+x(s(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),da=J({name:"assignRoles",__name:"assign-roles",props:L({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(y){const P=y,v=se(y,"visible");function c(){v.value=!1}const U=ue([]),i=async()=>{const{error:p,data:u}=await Ke();if(!p){const m=JSON.parse(JSON.stringify(u));U.value=m.list.map(n=>n)}},N=ue([]),z=async(p,u,m)=>{var n;N.value=[(n=m.node)==null?void 0:n.id]};async function C(){var p,u,m;if(P.rowData.id){const{data:n,error:h}=await Ee(P.rowData.id,N.value.join(","));h||((p=window.$message)==null||p.destroyAll(),(m=(u=window.$message)==null?void 0:u.success)==null||m.call(u,l("common.modifySuccess")),c())}}function B(){P.rowData.id&&(i(),N.value=[P.rowData.roleId])}return _e(v,p=>{p&&B()}),(p,u)=>{const m=ra,n=S,h=H,b=he;return R(),M(b,{show:v.value,"onUpdate:show":u[0]||(u[0]=I=>v.value=I),preset:"card",class:"w-480px"},{header:t(()=>u[1]||(u[1]=[Ge("div",{class:"flex"},"设置用户角色",-1)])),footer:t(()=>[e(h,{justify:"end"},{default:t(()=>[e(n,{size:"small",class:"mt-16px",onClick:c},{default:t(()=>[w(x(s(l)("common.cancel")),1)]),_:1}),e(n,{type:"primary",size:"small",class:"mt-16px",onClick:C},{default:t(()=>[w(x(s(l)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(m,{cascade:"","checked-keys":N.value,data:U.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"","label-field":"name","key-field":"id","children-field":"children","onUpdate:checkedKeys":z},null,8,["checked-keys","data"])]),_:1},8,["show"])}}}),pa={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function K(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Ye(y)}const Pa=J({name:"manage_user",__name:"index",setup(y){const P=Le(),{columns:v,columnChecks:c,data:U,getData:i,loading:N,mobilePagination:z,searchParams:C,resetSearchParams:B}=ea({apiFn:Xe,apiParams:{page:1,pageSize:50,limit:50,username:null,usertype:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"username",title:l("page.manage.user.username"),align:"center",width:160},{key:"usertype",title:"用户类型",align:"center",width:120,render:o=>{const a=l(ta[o.usertype]);return e(ae,{type:"primary"},K(a)?a:{default:()=>[a]})}},{key:"phnum",title:"手机号码",align:"center",width:160},{key:"nickname",title:"绑定微信信息",width:270,render(o){return e("div",{style:"text-align: left; line-height: 1.4;"},[e("div",{style:"font-size: 14px; color: #666;"},[w("微信昵称："),e("span",{style:"color: #333; font-weight: 500;"},[o.nickname||"-"])]),e("div",{style:"margin-top: 4px; font-size: 14px; color: #666;"},[w("绑定时间："),e("span",{style:"color: #333; font-weight: 500;"},[o.dbtime||"-"])])])}},{key:"udesc",title:"描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"status",title:l("page.manage.user.status"),align:"center",width:120,render:o=>(o.status===null?o.status=0:(o.status===2||o.status===3)&&(o.status=1),e(ae,{type:o.status==0?"success":o.status==1?"error":o.status==2?"warning":"success"},{default:()=>[o.status==0?"正常":o.status==1?"异常":o.status==2?"锁定":"正常"]}))},{key:"superadmin",title:"是否为我司内部人员",align:"center",width:160,render:o=>{const a=o.superadmin===0?"是":o.superadmin===1?"否":"未知",g=o.superadmin===0?"success":o.superadmin===1?"error":"default";return e(ae,{type:g},K(a)?a:{default:()=>[a]})}},{key:"createdate",title:l("page.manage.user.createDate"),align:"center",width:180},{key:"operate",title:l("common.operate"),align:"center",width:de("sys:user:update")&&de("sys:user:delete")?320:0,render:o=>{let a;return e("div",{class:"flex-center gap-8px"},[O(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>r(o.id)},K(a=l("common.edit"))?a:{default:()=>[a]}),[[V("no-auth"),"sys:user:update"]]),O(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>Z(o)},{default:()=>["修改密码"]}),[[V("no-auth"),"sys:user:update"]]),o.superadmin!=0&&e(pe,{onPositiveClick:()=>D(o.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let g;return O(e(S,{type:"error",ghost:!0,size:"small"},K(g=l("common.delete"))?g:{default:()=>[g]}),[[V("no-auth"),"sys:user:delete"]])}})])}}]}),{drawerVisible:p,operateType:u,editingData:m,handleAdd:n,handleEdit:h,checkedRowKeys:b,onBatchDeleted:I,onDeleted:F}=aa(U,i);async function j(){console.log(b.value),k(b.value,o=>{I()})}function D(o){k([o],a=>{F()})}function r(o){h(o)}async function k(o,a){const g=await Ze(o);console.log("data",g),a&&a(g)}const _=ee(!1),{defaultRequiredRule:$,patternRules:W}=me(),T=ee(!1),A=ee(),f=fe({username:"",password:"",confirmPassword:"",id:null}),q={password:[$,W.password],confirmPassword:[{required:!0,message:l("form.confirmPwd.required")},{asyncValidator:(o,a)=>a.trim()!==""&&a!==f.password?Promise.reject(o.message):Promise.resolve(),message:l("form.confirmPwd.invalid"),trigger:"input"}]},Z=o=>{T.value=!0,f.id=o.id,f.username=o.username,f.password="",f.confirmPassword=""},Q=async()=>{var g,G;if(!f.id)return;await((g=A.value)==null?void 0:g.validate());const{data:o,error:a}=await Qe(f.username,f.id,f.password);a||((G=window.$message)==null||G.success("修改成功"),T.value=!1)};return(o,a)=>{const g=Se,G=De,be=Ce,le=H,ke=Je,Ne=ye,X=ne,Y=ge,xe=oe,Pe=We,Ue=he,re=V("no-auth");return R(),we("div",pa,[e(ua,{model:s(C),"onUpdate:model":a[0]||(a[0]=d=>E(C)?C.value=d:null),onReset:s(B),onSearch:s(i)},null,8,["model","onReset","onSearch"]),e(Ne,{title:s(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(le,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[O((R(),M(s(S),{onClick:s(n),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(g,{class:"text-icon"})]),default:t(()=>[a[10]||(a[10]=w(" "+x("新增")))]),_:1,__:[10]},8,["onClick"])),[[re,"sys:user:insert"]]),e(s(pe),{onPositiveClick:j},{trigger:t(()=>[O((R(),M(s(S),{size:"small",ghost:"",type:"error",disabled:s(b).length==0},{icon:t(()=>[e(G,{class:He(["text-icon",{"animate-spin":s(N)}])},null,8,["class"])]),default:t(()=>[a[11]||(a[11]=w(" "+x("批量删除")))]),_:1,__:[11]},8,["disabled"])),[[re,"sys:user:delete"]])]),default:t(()=>[a[12]||(a[12]=w(" 确定要删除选中的吗？ "))]),_:1,__:[12]}),e(be,{columns:s(c),"onUpdate:columns":a[1]||(a[1]=d=>E(c)?c.value=d:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ke,{"checked-row-keys":s(b),"onUpdate:checkedRowKeys":a[2]||(a[2]=d=>E(b)?b.value=d:null),columns:s(v),data:s(U),size:"small","flex-height":!s(P).isMobile,"scroll-x":962,loading:s(N),remote:"","row-key":d=>d.id,pagination:s(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(ia,{visible:s(p),"onUpdate:visible":a[3]||(a[3]=d=>E(p)?p.value=d:null),"operate-type":s(u),"row-data":s(m),onSubmitted:s(i)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(da,{"row-data":s(m),visible:_.value,"onUpdate:visible":a[4]||(a[4]=d=>_.value=d)},null,8,["row-data","visible"])]),_:1},8,["title"]),e(Ue,{show:T.value,"onUpdate:show":a[9]||(a[9]=d=>T.value=d),title:s(l)("common.updatePassword"),preset:"card",class:"w-620px"},{footer:t(()=>[e(le,{justify:"end",size:16},{default:t(()=>[e(s(S),{onClick:a[8]||(a[8]=d=>T.value=!1)},{default:t(()=>[w(x(s(l)("common.cancel")),1)]),_:1}),e(s(S),{type:"primary",onClick:Q},{default:t(()=>[w(x(s(l)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(Pe,{class:"max-h-480px pr-20px"},{default:t(()=>[e(xe,{ref_key:"formRef",ref:A,model:f,rules:q,"label-placement":"left","label-width":100,"require-mark-placement":"left"},{default:t(()=>[e(Y,{label:s(l)("page.manage.user.username"),path:"username"},{default:t(()=>[e(X,{readonly:"",value:f.username,"onUpdate:value":a[5]||(a[5]=d=>f.username=d),placeholder:s(l)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(Y,{label:s(l)("page.login.common.password"),path:"password"},{default:t(()=>[e(X,{type:"password","show-password-on":"click",clearable:"",value:f.password,"onUpdate:value":a[6]||(a[6]=d=>f.password=d),placeholder:s(l)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(Y,{label:s(l)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:t(()=>[e(X,{type:"password","show-password-on":"click",clearable:"",value:f.confirmPassword,"onUpdate:value":a[7]||(a[7]=d=>f.confirmPassword=d),placeholder:s(l)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])])}}});export{Pa as default};
