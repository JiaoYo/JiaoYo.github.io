import{_ as ue,a as ie,A as de}from"./index-DnoBiLbM.js";import{d as pe,s as ce,q as me,v as D,i as fe,bZ as z,b_ as _e,r as k,at as ve,b as ge,o as _,f as o,w as n,c as b,z as y,h as w,A as G,b$ as ke,b8 as K,g as i,B as R,b9 as be,C as ye,N as V,G as we,e as Ce,t as q,aF as Ae,c0 as xe,aI as F,av as Se}from"./index-Bb6REojI.js";const Me={class:"flex justify-center"},Ne=pe({name:"manage_systemconfig",__name:"index",setup(he){const{formRef:T,validate:j}=ce(),C=me(),t=D(O());function O(){return{id:0,captcha:0,merror:0,errortime:0,sdkkey:"",sdkh5:"",sdksecret:"",prosite:"",longitude:120.373885,latitude:30.303899,diserror:0}}const p={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},L={captcha:p,prosite:{type:"string",required:!0,message:"不能为空",trigger:["blur","change"]},longitude:p,latitude:p,merror:p,errortime:p,diserror:p},B=async()=>{const{data:a,error:e}=await xe();e||(Object.assign(t,a),t.errortime=a.errortime/1e3/60)};fe(()=>{B()});const Y=z.debounce(async()=>{var r;await j();const a=t.errortime*1e3*60,{error:e}=await _e({...t,errortime:a});e||(r=window.$message)==null||r.success("设置成功")},1e3,{leading:!0,trailing:!1}),v=k(!1),N=k();let c=null,E=null,A=null,P=null,d=null;const m=D({longitude:0,latitude:0});let g;const x=k(!1),f=k(""),S=k([]);async function H(){window._AMapSecurityConfig={securityJsCode:t.sdksecret},N.value&&(d=await de.load({key:t.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),c=new d.Map(N.value,{zoom:18,center:[t.longitude,t.latitude],viewMode:"3D",resizeEnable:!0}),E=new d.Geocoder,new d.PlaceSearch({city:"全国",pageSize:50}),P=new d.AutoComplete({city:"全国"}),h(d,{lng:t.longitude,lat:t.latitude}),c.on("click",a=>{const{lng:e,lat:r}=a.lnglat;g=2,m.latitude=r,m.longitude=e,h(d,{lng:e,lat:r})}),F(()=>window.dispatchEvent(new Event("resize"))))}const J=z.debounce(async a=>{if(!x.value||!a.trim()){S.value=[];return}P.search(a,(e,r)=>{var s;console.log(r,"result"),e=="complete"&&r.info=="OK"&&((s=r==null?void 0:r.tips)!=null&&s.length)?S.value=r.tips.map(u=>({label:`${u.name}（${u.district||u.address||"无详细地址"}）`,value:`${u.location.lng}_${u.location.lat}`,raw:u})):S.value=[]})},300);ve(f,a=>{J(a)});function Z(a,e){if(console.log(a,e,"option"),!a)return;const[r,s]=a.split("_").map(Number);!r||!s||(c.setCenter([r,s]),g=1,h(d,{lng:r,lat:s}),m.longitude=r,m.latitude=s)}function Q(){v.value=!0,x.value=!1,g=void 0,F(async()=>{await H(),setTimeout(()=>{x.value=!0;const a=document.querySelector(".n-auto-complete input");a==null||a.blur()},500)})}function h(a,e){A&&c.remove(A),A=new a.Marker({position:[e.lng,e.lat],map:c}),c.add(A),E.getAddress(e,(r,s)=>{r==="complete"&&s.regeocode&&(console.log("result",s),console.log("formattedAddress",s.regeocode.formattedAddress),e.latitude=e.lat,e.longitude=e.lng,g==1||(g==2?f.value=s.regeocode.formattedAddress:f.value=t.prosite))})}function W(){v.value=!1}const X=async()=>{t.latitude=m.latitude,t.longitude=m.longitude,t.prosite=f.value,v.value=!1};return(a,e)=>{const r=ke,s=G,u=R,$=be,U=K,M=ye,ee=ue,I=R,te=K,oe=G,ne=V,le=we,ae=ie,re=V,se=Ae;return _(),ge("div",Me,[o(le,{ref_key:"formRef",ref:T,"label-width":240,"label-placement":"left",model:t,rules:L},{default:n(()=>[w(C).userInfo.usertype==0?(_(),b(s,{key:0,label:"是否开启验证码",path:"captcha"},{default:n(()=>[o(r,{value:t.captcha,"onUpdate:value":e[0]||(e[0]=l=>t.captcha=l),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})):y("",!0),o(s,{label:"打卡误差范围（米）",path:"merror"},{default:n(()=>[o(U,{class:"flex items-center"},{default:n(()=>[o(u,{onClick:e[1]||(e[1]=l=>t.merror--),disabled:t.merror==0},{default:n(()=>e[16]||(e[16]=[i(" − ")])),_:1,__:[16]},8,["disabled"]),o($,{"show-button":!1,value:t.merror,"onUpdate:value":e[2]||(e[2]=l=>t.merror=l),placeholder:"",min:0,precision:0},null,8,["value"]),o(u,{onClick:e[3]||(e[3]=l=>t.merror++),class:"mr-5px"},{default:n(()=>e[17]||(e[17]=[i(" + ")])),_:1,__:[17]}),e[18]||(e[18]=i(" 米 "))]),_:1,__:[18]})]),_:1}),o(s,{label:"打卡时间误差最大值（分钟）",path:"errortime"},{default:n(()=>[o(U,{class:"flex items-center"},{default:n(()=>[o(u,{onClick:e[4]||(e[4]=l=>t.errortime--),disabled:t.errortime==0},{default:n(()=>e[19]||(e[19]=[i(" − ")])),_:1,__:[19]},8,["disabled"]),o($,{"show-button":!1,value:t.errortime,"onUpdate:value":e[5]||(e[5]=l=>t.errortime=l),placeholder:"",min:0,precision:0},null,8,["value"]),o(u,{onClick:e[6]||(e[6]=l=>t.errortime++),class:"mr-5px"},{default:n(()=>e[20]||(e[20]=[i(" + ")])),_:1,__:[20]}),e[21]||(e[21]=i(" 分钟 "))]),_:1,__:[21]})]),_:1}),o(s,{label:"静默打卡范围（当超过此数值将认为异常默认100）",path:"diserror"},{default:n(()=>[o(U,{class:"flex items-center"},{default:n(()=>[o(u,{onClick:e[7]||(e[7]=l=>t.diserror--),disabled:t.diserror==0},{default:n(()=>e[22]||(e[22]=[i(" − ")])),_:1,__:[22]},8,["disabled"]),o($,{"show-button":!1,value:t.diserror,"onUpdate:value":e[8]||(e[8]=l=>t.diserror=l),placeholder:"",min:0,max:5e3,precision:0},null,8,["value"]),o(u,{onClick:e[9]||(e[9]=l=>t.diserror++),class:"mr-5px"},{default:n(()=>e[23]||(e[23]=[i(" + ")])),_:1,__:[23]}),e[24]||(e[24]=i(" 米 "))]),_:1,__:[24]})]),_:1}),w(C).userInfo.id=="1024"?(_(),b(s,{key:1,label:"AMAP_SDK_KEY",path:"sdkkey"},{default:n(()=>[o(M,{style:{width:"300px"},value:t.sdkkey,"onUpdate:value":e[10]||(e[10]=l=>t.sdkkey=l),placeholder:""},null,8,["value"])]),_:1})):y("",!0),w(C).userInfo.id=="1024"?(_(),b(s,{key:2,label:"AMAP_SDK_KEY_H5",path:"sdkh5"},{default:n(()=>[o(M,{style:{width:"300px"},value:t.sdkh5,"onUpdate:value":e[11]||(e[11]=l=>t.sdkh5=l),placeholder:""},null,8,["value"])]),_:1})):y("",!0),w(C).userInfo.id=="1024"?(_(),b(s,{key:3,label:"AMAP_SDK_SECRET",path:"sdksecret"},{default:n(()=>[o(M,{style:{width:"300px"},value:t.sdksecret,"onUpdate:value":e[12]||(e[12]=l=>t.sdksecret=l),placeholder:""},null,8,["value"])]),_:1})):y("",!0),o(oe,{label:"项目地点",path:"prosite"},{default:n(()=>[o(te,{onClick:Q},{default:n(()=>[o(M,{value:t.prosite,"onUpdate:value":e[13]||(e[13]=l=>t.prosite=l),style:{width:"400px"},placeholder:"请输入项目地点"},null,8,["value"]),o(I,null,{icon:n(()=>[o(ee,{class:"text-icon"})]),_:1})]),_:1})]),_:1}),o(s,{label:" "},{default:n(()=>[o(ne,null,{default:n(()=>[o(u,{type:"default",ghost:"",onClick:B},{default:n(()=>e[25]||(e[25]=[i(" 刷新 ")])),_:1,__:[25]}),o(u,{type:"info",ghost:"",onClick:w(Y)},{default:n(()=>e[26]||(e[26]=[i(" 保存 ")])),_:1,__:[26]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model"]),o(se,{show:v.value,"onUpdate:show":e[15]||(e[15]=l=>v.value=l),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:n(()=>[o(re,{justify:"end",size:16},{default:n(()=>[o(I,{onClick:W},{default:n(()=>[i(q(a.$t("common.cancel")),1)]),_:1}),o(I,{type:"primary",onClick:X},{default:n(()=>[i(q(a.$t("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[x.value?(_(),b(ae,{key:0,value:f.value,"onUpdate:value":e[14]||(e[14]=l=>f.value=l),options:S.value,placeholder:"请输入地点关键字",clearable:"",onSelect:Z},null,8,["value","options"])):y("",!0),Ce("div",{ref_key:"domRef",ref:N,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])])}}}),Ie=Se(Ne,[["__scopeId","data-v-f094abf4"]]);export{Ie as default};
