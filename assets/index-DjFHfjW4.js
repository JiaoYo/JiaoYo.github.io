import{d as V,_ as j}from"./debounce-DsmMOBlS.js";import{_ as z}from"./round-search-Bd9cRGGW.js";import{d as E,r as U,aY as D,j as _,a7 as q,y as G,o as N,e as J,g as s,w as u,h as x,i as v,B as $,ab as C,t as T,$ as I,z as A,c as F,C as H,bF as L,eh as R,eq as Y,ao as Q,L as W,ap as X,a2 as Z,aN as k,ak as K,P as ee}from"./index-KeVZZYr1.js";import{_ as ae}from"./DatePicker-DnP09eXI.js";const ne={class:"min-h-500px flex-col-stretch gap-16px lt-sm:overflow-auto"},te=E({name:"stationmanagement_predictionsettings",__name:"index",setup(oe){const d=U({dateTime:D(0,Date.now()),type:1}),f=(a,n,t="manuPower",o="isedit")=>{const e=a[n];if(!(e!=null&&e.dbtime))return null;const m=V(l=>{e[t]=l},300);return e[o]?k(K,{value:e[t],onUpdateValue:m,max:(e==null?void 0:e.maxValue)||void 0,min:e==null?void 0:e.minValue,placeholder:`${e!=null&&e.minValue?`min${e==null?void 0:e.minValue}`:""}${e!=null&&e.minValue&&(e!=null&&e.maxValue)?"~":""}${e!=null&&e.maxValue?`max${e==null?void 0:e.maxValue}`:""}`||"请输入",onBlur:()=>{e[o]=!1}}):k("span",{style:{cursor:"pointer",width:"100%",display:"inline-block",height:"40px",lineHeight:"40px"},onClick:()=>{e[o]=!0,setTimeout(()=>{const l=document.querySelectorAll("input");l.length&&l[l.length-1].focus()},0)}},e[t]||k("span",{style:{color:"rgba(194, 194, 194,.7)",fontSize:"12px"}},"未设置"))},M=[{title:"时间",key:"dbtime",render:a=>{var n;return s("span",null,[(n=a[0])==null?void 0:n.dbtime])}},{title:"预测值",key:"manuPower",render:a=>f(a,0),className:"inputInt"},{title:"时间",key:"dbtime",render:a=>{var n;return s("span",null,[(n=a[1])==null?void 0:n.dbtime])}},{title:"预测值",key:"manuPower",render:a=>f(a,1),className:"inputInt"},{title:"时间",key:"dbtime",render:a=>{var n;return s("span",null,[(n=a[2])==null?void 0:n.dbtime])}},{title:"预测值",key:"manuPower",render:a=>f(a,2),className:"inputInt"},{title:"时间",key:"dbtime",render:a=>{var n;return s("span",null,[(n=a[3])==null?void 0:n.dbtime])}},{title:"预测值",key:"manuPower",render:a=>f(a,3),className:"inputInt"}],i=_(),w=_([]),p=_(!1),h=async()=>{p.value=!0,i.value=[];const{data:a,error:n}=await L({date:d.dateTime});if(!n){w.value=JSON.parse(JSON.stringify(a)),w.value.forEach(t=>{t.manuPower=t.manuPower?t.manuPower:null}),a.forEach(t=>{t.manuPower=t.manuPower?t.manuPower:null,t.isedit=!1});for(let t=0;t<a.length;t+=4)i.value.push(a.slice(t,t+4));p.value=!1}};h(),_(0);const O=a=>{d.dateTime=D(0,a),h()},S=async()=>{var l,g,y;let a=(l=i.value)==null?void 0:l.flat();const n=new Map;w.value.forEach(r=>{r.manuPower!==void 0&&n.set(r.id,r.manuPower)}),a=a.filter(r=>{const c=n.get(r.id);return c!==void 0&&c!==r.manuPower});const{data:t,error:o}=await R(a);if(o)return;(g=window.$message)==null||g.success("设置成功"),h();const e={content:"",matime:d.dateTime,otype:0,optime:null};if(a.forEach(r=>{e.content+=r.manuPower?`${r.dbtime} 预测值${r.manuPower} 
`:""}),(await Y([e])).error)return(y=window.$message)==null?void 0:y.error("上报失败")},b=_(!1),B=V(a=>{let n=a==null?void 0:a.flat();const t=new Map;w.value.forEach(o=>{t.set(o.id,o.manuPower)}),n=n.filter(o=>t.get(o.id)!==o.manuPower),b.value=n.length>0},300);return q(()=>i.value,a=>{B(a)},{deep:!0}),(a,n)=>{const t=ae,o=z,e=Q,m=W,l=j,g=X,y=Z,r=G("no-auth");return N(),J("div",ne,[s(y,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:u(()=>[s(m,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:u(()=>[x(" 人工干预设置 "),s(e,null,{default:u(()=>[s(t,{"formatted-value":d.dateTime,"onUpdate:formattedValue":n[0]||(n[0]=c=>d.dateTime=c),"value-format":"yyyy-MM-dd",type:"date","onUpdate:value":O,style:{width:"200px"}},null,8,["formatted-value"]),s(v($),{type:"primary",ghost:"",onClick:h},{icon:u(()=>[s(o,{class:C(["text-icon",{"animate-spin":p.value}])},null,8,["class"])]),default:u(()=>[x(" "+T(v(I)("common.search")),1)]),_:1})]),_:1})]),_:1})]),"header-extra":u(()=>[s(m,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:u(()=>{var c,P;return[(c=i.value)!=null&&c.length&&((P=i.value)==null?void 0:P.length)>0?A((N(),F(v($),{key:0,onClick:S,type:"primary",ghost:"",disabled:!b.value},{icon:u(()=>[s(l,{class:C(["text-icon",{"animate-spin":p.value}])},null,8,["class"])]),default:u(()=>[x(" "+T(v(I)("common.save")),1)]),_:1},8,["disabled"])),[[r,"power.update"]]):H("",!0)]}),_:1})]),default:u(()=>[s(g,{columns:M,data:i.value,bordered:!1,"flex-height":!0,class:"sm:h-full","row-key":c=>c.id,loading:p.value},null,8,["data","row-key","loading"])]),_:1})])}}}),ce=ee(te,[["__scopeId","data-v-8d5db6e2"]]);export{ce as default};
