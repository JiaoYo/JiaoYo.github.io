import{_ as Q}from"./table-column-setting.vue_vue_type_script_setup_true_lang-D8fMBsYv.js";import{_ as X}from"./refresh-av0Mcmzj.js";import{d as U,q,v as Y,s as J,K as B,o as F,c as W,w as o,g as e,L as E,h as b,t as V,i as s,$ as T,M as ee,A as te,B as z,E as I,D as ae,ad as Z,dB as oe,a5 as ne,j as k,y as se,f as C,aa as le,S as H,F as re,T as ie,U as ce,V as pe,a4 as de,Z as ue,r as O,aV as me,e as _e,ag as G,br as fe,aA as ve}from"./index-7Q9xZuwa.js";import{a as ge,b as he,c as K,d as ye}from"./reportForm-CrOLjfvW.js";import{u as xe}from"./table-G6_8Abm0.js";import{_ as we}from"./round-search-BQOA9W6m.js";import{_ as be}from"./round-refresh-DJiiF7wv.js";import{_ as ke}from"./FormItemGridItem-DYTXkfwP.js";import{_ as Se}from"./Grid-CRtcNhSF.js";import{T as Pe}from"./task-l058OQsC.js";import{f as Ce,a as $e,_ as Ne,b as Re,c as ze,d as De}from"./templateDataFilter-B3gVaP5x.js";import{_ as j}from"./Popconfirm-BEMrdOuM.js";import{_ as Be}from"./DataTable-n3fP4Loy.js";import"./setting-outlined-V9qGIWHT.js";import"./index-BS8KoN7o.js";import"./installCanvasRenderer-iCPGNWhM.js";import"./Forward-BzUEeUAa.js";const Ee=U({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["reset","search"],["update:model"]),setup(_,{emit:S}){const P=S,{formRef:l,restoreValidation:f}=Y(),r=J(_,"model"),u=()=>{r.value.fuzzy="",i()};async function $(){await f(),P("reset")}async function i(){P("search")}return(D,n)=>{const N=te,v=ke,R=be,y=z,x=we,g=I,m=Se,A=ae,L=Z,M=B("no-space");return F(),W(L,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[e(A,{ref_key:"formRef",ref:l,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ee(i,["enter"])},{default:o(()=>[e(m,{responsive:"screen","item-responsive":""},{default:o(()=>[e(v,{span:"24 s:12 m:6",label:"实例名称",path:"alatype",class:"pr-24px"},{default:o(()=>[E(e(N,{autofocus:"",value:r.value.fuzzy,"onUpdate:value":n[0]||(n[0]=a=>r.value.fuzzy=a),placeholder:"请输入实例名称关键字",clearable:"",onClear:u},null,8,["value"]),[[M]])]),_:1}),e(v,{span:"24 m:6",class:"pr-24px"},{default:o(()=>[e(g,{class:"w-full"},{default:o(()=>[e(y,{onClick:$},{icon:o(()=>[e(R,{class:"text-icon"})]),default:o(()=>[b(" "+V(s(T)("common.reset")),1)]),_:1}),e(y,{type:"primary",ghost:"",onClick:i},{icon:o(()=>[e(x,{class:"text-icon"})]),default:o(()=>[b(" "+V(s(T)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ie=_=>(ie("data-v-012ddadc"),_=_(),ce(),_),Te=Ie(()=>C("span",{class:"mr-20px"},"报表预览",-1)),Ae={title:"导出PDF"},Le={title:"导出Word"},Me={title:"导出Excel"},Ve=U({name:"reportPreview",__name:"reportPreview",props:q({data:{},detaliParams:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(_){oe(D=>({a798f7c4:s(P)}));const S=ne(),P=S.themeScheme=="dark"?"#001428":"#fff",l=_,f=J(_,"visible"),r=k(),u=k(""),$=()=>{l.detaliParams.rtype==0?(r.value=Ce(l.data,void 0),u.value=l.detaliParams.name+"_资产信息表"):l.detaliParams.rtype==1&&(r.value=$e(l.data,l.data.time),u.value=l.detaliParams.name+"_审计信息表")};se(f,()=>{f.value&&$()});const i=k();return(D,n)=>{const N=Ne,v=Re,R=ze,y=De,x=H,g=re;return F(),W(g,{show:f.value,"onUpdate:show":n[3]||(n[3]=m=>f.value=m),preset:"card",class:"w-1000px reportPreview",style:le({"background-color":s(S).themeScheme=="dark"?"#001428":"#fff"})},{header:o(()=>[Te,C("span",Ae,[e(N,{class:"text-32px c-#d63031 cursor-pointer",onClick:n[0]||(n[0]=m=>i.value.toPdf(u.value))})]),C("span",Le,[e(v,{class:"text-32px c-#1e90ff cursor-pointer",onClick:n[1]||(n[1]=m=>i.value.toWord(u.value))})]),C("span",Me,[e(R,{class:"text-32px c-#15703d cursor-pointer",onClick:n[2]||(n[2]=m=>i.value.toExcel(u.value))})])]),default:o(()=>[e(x,{class:"max-h-600px"},{default:o(()=>[e(y,{ref_key:"filePreviewExportRef",ref:i,width:800,data:r.value},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),Ue=pe(Ve,[["__scopeId","data-v-012ddadc"]]),Fe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Oe=C("div",{style:{display:"flex","align-items":"center"}},[C("div",null,"报表实例")],-1),lt=U({name:"reportmanagement_reportlist",__name:"index",setup(_){const S=de(),{columns:P,columnChecks:l,data:f,getData:r,loading:u,mobilePagination:$,searchParams:i,resetSearchParams:D}=xe({apiFn:ge,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:a=>!0,renderExpand:a=>e("div",{class:"detailList"},[e(H,{style:"max-height: 360px"},{default:()=>[v.value.length>0?v.value.map((t,c)=>e(I,{justify:"space-between",style:{marginBottom:"8px",padding:"0px 50px 8px 50px",borderBottom:c!==v.value.length-1?"1px dashed #ccc":"none"},key:t.sn},{default:()=>[e("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[t.sn]),e(I,null,{default:()=>[E(e(z,{type:"info",size:"small",ghost:!0,onClick:()=>A(t.sn,a.rtype)},{default:()=>[b("查看")]}),[[B("no-auth"),"sys.report.instance.select"]]),e(j,{onPositiveClick:()=>M(t.sn,a.rtype,a.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>E(e(z,{type:"error",size:"small",ghost:!0},{default:()=>[b("删除")]}),[[B("no-auth"),"sys.report.instance.delete"]])})]})]})):e("div",{style:{textAlign:"center",padding:"10px"}},[b("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:a=>{var t;return e("div",null,[(t=ue(Pe).find(c=>c.value===a.rtype))==null?void 0:t.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:T("common.operate"),align:"center",width:160,render:a=>e("div",{class:"flex-center gap-8px"},[e(j,{onPositiveClick:()=>L(a.tid,a.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>E(e(z,{type:"primary",ghost:!0,size:"small"},{default:()=>[b("清空")]}),[[B("no-auth"),"sys.report.instance.delete"]])})])}]}),n=k([]),N=a=>{n.value=[a[a.length-1]],n.value[0]&&y()},v=k([]),R=O({page:1,limit:10}),y=async()=>{const a=JSON.parse(JSON.stringify(f.value)).find(p=>p.tid===n.value[0]),{data:t,error:c}=await ye({tid:n.value[0],page:R.page,limit:Number(a.num)||10});c||(v.value=t.list,ve(()=>{const p=document.querySelector(".detailList");if(p){const{height:d}=p.getBoundingClientRect();p.animate([{height:"0px"},{height:`${d}px`}],{duration:300,easing:"linear"})}}))},x=k(!1),g=k({}),m=O({name:"",rtype:0}),A=async(a,t)=>{var d;const{data:c,error:p}=await he({name:a,type:t,tid:n.value[0]});m.name=a,m.rtype=t,p||(x.value=!0,g.value=JSON.parse(c),g.value.baseInfo=(d=g.value.baseInfo)==null?void 0:d.map(w=>({...w,dbtime:me(1,w.dbtime)})))},L=async(a,t)=>{var d;const{data:c,error:p}=await K({tid:a,type:t});p||((d=window.$message)==null||d.success("清空成功"),r())},M=async(a,t,c)=>{var w;const{data:p,error:d}=await K({fname:a,type:t,tid:c});d||((w=window.$message)==null||w.success("删除成功"),r(),y())};return(a,t)=>{const c=X,p=Q,d=Be,w=Z;return F(),_e("div",Fe,[e(Ee,{model:s(i),"onUpdate:model":t[0]||(t[0]=h=>G(i)?i.value=h:null),onReset:s(D),onSearch:s(r)},null,8,["model","onReset","onSearch"]),e(w,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[Oe]),"header-extra":o(()=>[e(s(I),null,{default:o(()=>[e(s(z),{size:"small",onClick:t[1]||(t[1]=h=>s(r)())},{icon:o(()=>[e(c,{class:fe(["text-icon",{"animate-spin":s(u)}])},null,8,["class"])]),default:o(()=>[b(" "+V(s(T)("common.refresh")),1)]),_:1}),e(p,{columns:s(l),"onUpdate:columns":t[2]||(t[2]=h=>G(l)?l.value=h:null)},null,8,["columns"])]),_:1})]),default:o(()=>[e(d,{columns:s(P),data:s(f),size:"small","flex-height":!s(S).isMobile,"scroll-x":962,loading:s(u),remote:"","row-key":h=>h.tid,pagination:s($),class:"sm:h-full","expanded-row-keys":n.value,"onUpdate:expandedRowKeys":N},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),e(Ue,{visible:x.value,"onUpdate:visible":t[3]||(t[3]=h=>x.value=h),data:g.value,detaliParams:m},null,8,["visible","data","detaliParams"])]),_:1})])}}});export{lt as default};
