import{_ as J}from"./refresh-DaAMQoyy.js";import{d as H,q as Q,a4 as q,s as Y,x as Z,E as D,o as A,c as U,w as n,g as a,F as C,i as o,$ as g,X as K,h as _,t as E,G as ee,K as te,a0 as ae,B as w,O as W,P as le,ad as X,j as h,r as L,av as V,D as ne,e as se,bl as oe,ai as re,aj as ie,T as ce}from"./index-EW2EHvBZ.js";import{l as ue,m as de,n as me,o as pe}from"./common-DLtYHZpw.js";import{_ as fe,l as _e}from"./lodash-Tk07mST8.js";import{_ as ge}from"./round-search-BClnDkrh.js";import{_ as he}from"./round-refresh-CSNTDgt0.js";import{C as ve,a as ye}from"./common-CnGVffzU.js";import{a as be,T as xe}from"./basicconf-BxhMT5aQ.js";import{_ as we}from"./FormItemGridItem-ChlUwwC5.js";import{_ as ke}from"./Grid-BSYdqYIk.js";import{_ as $}from"./Popconfirm-TDUTgjWd.js";const Ce=H({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["reset","search"],["update:model"]),setup(y,{emit:z}){const k=z,u=q(),{formRef:M,restoreValidation:s}=Y(),i=Z(y,"model");function S(){i.value.fuzzy=void 0,k("search")}async function p(){await s(),k("reset")}async function d(){k("search")}const b=fe.throttle(d,1e3,{trailing:!1});return(F,f)=>{const R=te,v=we,N=ae,T=he,m=w,I=ge,B=W,O=ke,e=le,t=X,l=D("no-space");return A(),U(t,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(e,{ref_key:"formRef",ref:M,model:i.value,"label-placement":"left","label-width":o(u).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:ee(o(b),["enter"])},{default:n(()=>[a(O,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[a(v,{span:"24 s:12 m:8 l:6",label:"告警名称",path:"fuzzy"},{default:n(()=>[C(a(R,{autofocus:"",value:i.value.fuzzy,"onUpdate:value":f[0]||(f[0]=r=>i.value.fuzzy=r),placeholder:"请输入告警名称",clearable:"",onClear:S},null,8,["value"]),[[l]])]),_:1}),a(v,{span:"24 s:12 m:8 l:6",label:"告警状态",path:"status"},{default:n(()=>[a(N,{filterable:"",clearable:"",placeholder:o(g)("page.manage.alarm.form.status"),value:i.value.status,"onUpdate:value":[f[1]||(f[1]=r=>i.value.status=r),d],options:o(K)(o(ve))},null,8,["placeholder","value","options"])]),_:1}),a(v,{span:"24 s:12 m:8 l:6",label:"级别",path:"alevel"},{default:n(()=>[a(N,{filterable:"",clearable:"",placeholder:o(g)("page.manage.alarm.form.status"),value:i.value.alevel,"onUpdate:value":[f[2]||(f[2]=r=>i.value.alevel=r),d],options:o(K)(o(be))},null,8,["placeholder","value","options"])]),_:1}),a(v,{span:"24 s:12 m:8 l:6"},{default:n(()=>[a(B,{class:"w-full flex items-center"},{default:n(()=>[a(m,{onClick:p},{icon:n(()=>[a(T,{class:"text-icon"})]),default:n(()=>[_(" "+E(o(g)("common.reset")),1)]),_:1}),a(m,{type:"primary",ghost:"",onClick:o(b)},{icon:n(()=>[a(I,{class:"text-icon"})]),default:n(()=>[_(" "+E(o(g)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width","onKeyup"])]),_:1})}}}),ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function j(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!re(y)}const Se=H({name:"platformalarm_systemalarm",__name:"index",setup(y){const z=h(window.innerHeight-360),k=q();h(!1),h();const u=L({pageSize:100,pageId:void 0,status:void 0,fuzzy:void 0}),M=[{type:"selection",align:"center",width:48,fixed:"left"},{key:"aname",title:"告警名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"uname",title:"用户",align:"center",width:100,render:()=>"系统"},{key:"status",title:g("page.manage.alarm.status"),align:"center",width:120,render:e=>{(e.status===void 0||e.status===null)&&(e.status=0);const t={0:"error",1:"success"},l=g(ye[e.status]);return a(V,{size:"small",type:t[e.status]},j(l)?l:{default:()=>[l]})}},{key:"dbtime",title:"发生时间",align:"center",width:180},{key:"alevel",title:"事件等级",align:"center",width:120,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},l=g(xe[e.alevel]);let r={color:t[e.alevel],textColor:"#ffffff",borderColor:t[e.alevel]};return a(V,{size:"small",color:r},j(l)?l:{default:()=>[l]})}},{key:"adec",title:"告警描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"operate",title:g("common.operate"),align:"center",width:130,fixed:"right",render:e=>a("div",{class:"flex-center gap-8px"},[e.status==0&&a($,{onPositiveClick:()=>v(e.id+"")},{default:()=>"确定要确认该告警数据吗？",trigger:()=>C(a(w,{type:"primary",ghost:!0,size:"small"},{default:()=>[_("确认")]}),[[D("no-auth"),"sys.system.alarm.update"]])}),a($,{onPositiveClick:()=>T(e.id+"")},{default:()=>"确定要删除该告警数据吗？",trigger:()=>C(a(w,{type:"error",ghost:!0,size:"small"},{default:()=>[_("删除")]}),[[D("no-auth"),"sys.system.alarm.delete"]])})])}],s=h([]),i=h(!1),S=h(0),p=h([]),d=async(e=!1)=>{if(!i.value)i.value=!0;else return;i.value=!0;const{data:t,error:l}=await pe(u);l||(S.value=t.length,e?s.value=[...s.value,...t]:s.value=t,i.value=!1)},b=h(!0),F=async()=>{s.value=[],u.pageId=void 0,(t=>Object.keys(t).filter(c=>c!=="limit"&&c!=="_t").some(c=>t[c]!==void 0&&t[c]!==""&&t[c]!==null))(u)?b.value=!1:(b.value=!0,I()),await d(),f()},f=async()=>{var e,t,l;if(s.value.length<z.value/44&&s.value.length<m.total){if(u.pageId==((e=s.value[s.value.length-1])==null?void 0:e.id))return;u.pageId=((l=(t=s.value)==null?void 0:t[s.value.length-1])==null?void 0:l.id)??void 0,d(!0)}};ne(async()=>{await d(),await I(),f()});const R=()=>{v(p.value.join(","))},v=async e=>{var r,c;const{data:t,error:l}=await ue({ids:e});l||(d(),(r=window.$message)==null||r.destroyAll(),(c=window.$message)==null||c.success("确认成功"),p.value=[])},N=()=>{T(p.value.join(","))},T=async e=>{var r,c;const{data:t,error:l}=await de({ids:e});l||(d(),(r=window.$message)==null||r.destroyAll(),(c=window.$message)==null||c.success("删除成功"))},m=L({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:t,page:l,pageSize:r,pageCount:c,itemCount:P}){return`已加载${s.value.length}条`+(s.value.length?b.value?` 共计 ${s.value.length>0?P??0:0} 条`:S.value==u.pageSize?"  预计还有更多":"  没有更多了":"")}});async function I(){const{data:e,error:t}=await me();t||(m.pageCount=20,m.total=Number(e),m.itemCount=Number(e))}function B(e){var l;Math.abs(e.target.scrollTop+e.target.offsetHeight-e.target.scrollHeight)<=20&&m.total>((l=s.value)==null?void 0:l.length)&&O()}const O=_e.debounce(()=>{var e;((e=s.value)==null?void 0:e.length)<m.total&&(u.pageId=s.value[s.value.length-1].id,d(!0))},300);return(e,t)=>{const l=J,r=W,c=ie,P=X,G=D("no-auth");return A(),se("div",ze,[a(Ce,{model:u,"onUpdate:model":t[0]||(t[0]=x=>u=x),onSearch:F},null,8,["model"]),a(P,{title:"系统告警",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(r,null,{default:n(()=>[a(o($),{onPositiveClick:R},{trigger:n(()=>[C((A(),U(o(w),{size:"small",ghost:"",type:"primary",disabled:p.value.length===0},{default:n(()=>[_(" 批量确认 ")]),_:1},8,["disabled"])),[[G,"sys.system.alarm.update"]])]),default:n(()=>[_(" 确定要确认选中的数据吗？ ")]),_:1}),a(o($),{onPositiveClick:N},{trigger:n(()=>[C((A(),U(o(w),{size:"small",ghost:"",type:"error",disabled:p.value.length===0},{default:n(()=>[_(" 批量删除 ")]),_:1},8,["disabled"])),[[G,"sys.system.alarm.delete"]])]),default:n(()=>[_(" 确定要删除选中的数据吗？ ")]),_:1}),a(o(w),{size:"small",onClick:t[1]||(t[1]=x=>d())},{icon:n(()=>[a(l,{class:oe(["text-icon",{"animate-spin":i.value}])},null,8,["class"])]),default:n(()=>[_(" "+E(o(g)("common.refresh")),1)]),_:1})]),_:1})]),default:n(()=>[a(c,{columns:M,"checked-row-keys":p.value,"onUpdate:checkedRowKeys":t[2]||(t[2]=x=>p.value=x),data:s.value,size:"small","virtual-scroll":"","flex-height":!o(k).isMobile,loading:i.value,remote:"","row-key":x=>x.id,"max-height":z.value,pagination:m,onScroll:B,class:"sm:h-full","scroll-x":""},null,8,["checked-row-keys","data","flex-height","loading","row-key","max-height","pagination"])]),_:1})])}}}),Ue=ce(Se,[["__scopeId","data-v-3e89fc26"]]);export{Ue as default};
