import{_ as Ie}from"./table-header-operation.vue_vue_type_script_setup_true_lang-D0LZoCjV.js";import{d as Z,n as se,p as me,s as oe,D as ae,o as Q,c as J,w as c,g as t,E as W,h as w,t as te,i as d,$ as k,F as Ue,J as ne,B as x,N as G,O as fe,ad as ve,r as ue,j as be,A as ge,f as ie,aS as ee,Z as L,ap as le,W as he,aw as ye,by as _e,bd as we,S as re,R as de,q as Pe,b as Le,ae as Ne,aG as $e,K as Re,b1 as xe,ar as Fe,a3 as Ve,av as ce,aA as ze,e as Me,ah as X,ai as Be,aj as Oe}from"./index-DWmUnTBE.js";import{u as Ge,a as Qe}from"./table-D2sJDqtP.js";import{_ as He}from"./round-search-u8SOTxtR.js";import{_ as Je}from"./round-refresh-Dein9Tgk.js";import{_ as Ke}from"./lodash--WT9fVpN.js";import{_ as qe}from"./FormItemGridItem-Drh-13oN.js";import{_ as We}from"./Grid-OpRdRyXq.js";import{u as K}from"./usePageData-BNftptNV.js";import{a as je,T as Ze}from"./basicconf-CYRCuuBA.js";import{j as Xe,g as Ye,a as el,k as ll,l as De,h as al,e as tl}from"./events-wMiDXEVi.js";import{r as Ee,v as Se}from"./Collection-3xqUeI_u.js";import{f as ke,a as Ce}from"./common-Dh6kJfrg.js";import{_ as q}from"./Popconfirm-BrFifs5K.js";import{_ as Te}from"./Tree-BK37-nxJ.js";import{h as pe}from"./permission-BgUMaFhp.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-BZmQ76_E.js";import"./setting-outlined-BiSZdPKX.js";import"./export-Db3FEV_O.js";import"./refresh-DUW_4GE6.js";import"./round-delete-DLx_hhv9.js";import"./round-plus-DjUVGGJv.js";import"./Upload-Cg_xJbVa.js";import"./Progress-Dhai-g9T.js";const ol=Z({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:se(["reset","search"],["update:model"]),setup(j,{emit:p}){const e=p,{formRef:D,restoreValidation:h}=me(),g=oe(j,"model");function E(){g.value.fuzzy=void 0,e("search")}async function R(){await h(),e("reset")}async function S(){e("search")}const C=Ke.debounce(S,1e3,{leading:!0,trailing:!1});return(o,T)=>{const F=ne,N=qe,A=Je,y=x,V=He,z=G,B=We,I=fe,M=ve,s=ae("no-space");return Q(),J(M,{bordered:!1,size:"small",class:"card-wrapper"},{default:c(()=>[t(I,{ref_key:"formRef",ref:D,model:g.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ue(d(C),["enter"])},{default:c(()=>[t(B,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:c(()=>[t(N,{span:"24 s:12 m:8 l:6",label:"策略名称",path:"fuzzy"},{default:c(()=>[W(t(F,{clearable:"",value:g.value.fuzzy,"onUpdate:value":T[0]||(T[0]=i=>g.value.fuzzy=i),placeholder:"请输入策略名称",onClear:E},null,8,["value"]),[[s]])]),_:1}),t(N,{span:"24 s:12 m:8 l:6"},{default:c(()=>[t(z,{class:"w-full"},{default:c(()=>[t(y,{onClick:R},{icon:c(()=>[t(A,{class:"text-icon"})]),default:c(()=>[w(" "+te(d(k)("common.reset")),1)]),_:1}),t(y,{type:"primary",ghost:"",onClick:d(C)},{icon:c(()=>[t(V,{class:"text-icon"})]),default:c(()=>[w(" "+te(d(k)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),nl=Z({name:"ConditionTree",__name:"conditionTree",props:{data:{default:[]},dataModifiers:{}},emits:["update:data"],setup(j){const p=oe(j,"data"),e=ue({showValueDom:1,obj:{colume:void 0,option:void 0,value:void 0},options1:[{value:"addr0",label:"发生源IP 数字",type:"long"},{value:"addr1",label:"源IP 数字",type:"long"},{value:"addr2",label:"目的IP 数字 ",type:"long"},{value:"ip0",label:"发生源IP",type:"string"},{value:"ip1",label:"源IP",type:"string"},{value:"ip2",label:"目的IP",type:"string"},{value:"port1",label:"源端口",type:"int"},{value:"port2",label:"目的端口",type:"int"},{value:"mac1",label:"源MAC地址",type:"string"},{value:"mac2",label:"目的MAC",type:"string"},{value:"category",label:"发生源设备类别",type:"int"},{value:"device",label:"发生源设备类型",type:"int"},{value:"kind",label:"事件类别",type:"int"},{value:"type",label:"事件类型",type:"int"},{value:"level",label:"事件等级",type:"int"},{value:"proType",label:"日志来源协议",type:"string"},{value:"protocol",label:"协议",type:"string"},{value:"code",label:"关键字",type:"string"}],options2:[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],options3:[]});function D({option:s}){return t("div",{style:{display:"flex",alignItems:"center"}},[t("div",{class:"flex-center  mr-30px",style:{gap:"8px 20px"}},[s.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>C("||或",s)},{default:()=>[w("||或")]}),s.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>C("&&与",s)},{default:()=>[w("&&与")]}),s.children&&t(q,{onPositiveClick:()=>o(s),showIcon:!1,show:s.isShow,onNegativeClick:()=>s.isShow=!1,onUpdateShow:i=>{e.obj={colume:void 0,option:void 0,value:void 0},e.showValueDom=1}},{default:ee(t(G,null,{default:()=>[t(L,{options:e.options1,value:e.obj.colume,"onUpdate:value":i=>R(i),placeholder:"请选择",style:{width:"180px"}},null),t(L,{options:e.options2,value:e.obj.option,"onUpdate:value":i=>e.obj.option=i,placeholder:"请选择",style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="category"||e.obj.colume=="device")&&t(L,{clearable:!0,options:e.options3,key:e.obj.colume,value:e.obj.value,placeholder:"请选择",labelField:e.obj.colume=="category"?"cname":e.obj.colume=="device"?"type":"",valueField:"id",onScroll:i=>M(i),"onUpdate:value":i=>e.obj.value=i,style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="kind"||e.obj.colume=="type"||e.obj.colume=="level")&&t(L,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,"onUpdate:value":i=>e.obj.value=i,style:{width:"180px"},placeholder:"请选择"},null),e.showValueDom==1&&t(ne,{clearable:!0,value:e.obj.value,"onUpdate:value":i=>e.obj.value=i},null),e.showValueDom==0&&t(le,{clearable:!0,value:e.obj.value,"onUpdate:value":i=>e.obj.value=i},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>s.isShow=!0},{default:()=>[w("配置")]})}),t(x,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>T(s)},{default:()=>[w("删除")]})])])}const h=be(1),g=()=>(h.value++,h.value),E=()=>{const s=i=>{let b=-1/0;const _=l=>{for(const a of l)a.id>b&&(b=a.id),a.children&&_(a.children)};return _(i),b};h.value=s(p.value)};ge(()=>{setTimeout(()=>{p.value.length>0&&E()},500)});const R=async s=>{const i=["addr0","addr1","addr2"],b=["ip0","ip1","ip2","mac1","mac2","port1","port2","proType","protocol","code"];i.includes(s)?e.showValueDom=0:b.includes(s)?e.showValueDom=1:e.showValueDom=2,s=="category"?(await N(),e.options3=F.data):s=="device"?(await V(),e.options3=y.data):s=="kind"?B():s=="type"?I():s=="level"&&(e.options3=he(je)),["ip0","ip1","ip2","mac1","mac2","proType","protocol","code"].includes(s)?e.options2=[{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"},{label:"匹配",value:"MATCH"}]:e.options2=[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],e.obj.option=e.options2[0].value,e.obj.colume=s,e.obj.value=void 0},S=s=>{p.value.length>0||(p.value.push({label:s,id:1,isShow:!1,children:[]}),h.value=1)},C=(s,i)=>{i.children.push({label:s,id:g(),children:[],isShow:!1})},o=s=>{var a,n,u,v,r,$,U;if(!e.obj.colume)return(a=window.$message)==null?void 0:a.warning("选择的信息项不能为空");if(e.obj.value==null)return(n=window.$message)==null?void 0:n.warning("条件值不能为空");const i=["ip0","ip1","ip2"],b=["mac1","mac2"],_=["port1","port2"];if(i.includes(e.obj.colume)&&!ye(e.obj.value))return(u=window.$message)==null?void 0:u.warning("请输入正确的IP地址");if(b.includes(e.obj.colume)&&!_e(e.obj.value))return(v=window.$message)==null?void 0:v.warning("请输入正确的MAC地址");if(_.includes(e.obj.colume)&&!we(e.obj.value))return(r=window.$message)==null?void 0:r.warning("请输入正确的端口号");let l=e.obj.value;if(e.showValueDom==2)if(e.obj.colume=="category"||e.obj.colume=="device"){const m=e.options3.find(P=>P.id==e.obj.value);l=e.obj.colume=="category"?m==null?void 0:m.cname:m==null?void 0:m.type}else{const m=e.options3.find(P=>P.value==e.obj.value);l=m==null?void 0:m.label}s.children.push({colume:e.obj.colume,option:e.obj.option,value:e.obj.value,id:g(),label:`${($=e.options1.find(m=>m.value==e.obj.colume))==null?void 0:$.label} ${(U=e.options2.find(m=>m.value==e.obj.option))==null?void 0:U.label} ${l} `,flag:!1}),e.obj={colume:void 0,option:void 0,value:void 0},e.showValueDom=1,s.isShow=!1},T=s=>{console.log(s,"row");function i(b,_){return b.reduce((l,a)=>(a.id===_||(a.children&&(a.children=i(a.children,_)),l.push(a)),l),[])}p.value=i(p.value,s.id)},{pageData:F,getData:N,nextPage:A}=K(Ee),{pageData:y,getData:V,nextPage:z}=K(Se),B=async()=>{const{data:s,error:i}=await ke();console.log(s),e.options3=s.map(b=>({label:b.pname,value:b.id}))},I=async()=>{const{data:s,error:i}=await Ce();console.log(s),e.options3=s.map(b=>({label:b.pname,value:b.id}))},M=async s=>{const i=s.currentTarget;i.scrollTop+i.offsetHeight>=i.scrollHeight&&(e.obj.colume=="category"&&A(),e.obj.colume=="device"&&z())};return(s,i)=>{const b=Te,_=re;return Q(),J(_,{class:"h-220px",style:{border:"1px solid #dcdcdc","border-radius":"6px"}},{default:c(()=>[t(d(G),{justify:"end",class:"p-5px"},{default:c(()=>[ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:i[0]||(i[0]=l=>S("||或"))},"||或"),ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:i[1]||(i[1]=l=>S("&&与"))},"&&与")]),_:1}),(Q(),J(b,{"block-line":"",data:p.value,"default-expand-all":"",selectable:!1,"render-suffix":D,key:h.value,"key-field":"id"},null,8,["data"]))]),_:1})}}}),sl=de(nl,[["__scopeId","data-v-8027c5a8"]]),il=Z({name:"RelationRuleTree",__name:"relationRuleTree",props:{data:{default:[]},dataModifiers:{}},emits:["update:data"],setup(j){const p=oe(j,"data"),e=ue({showValueDom:1,obj:{colume:void 0,option:void 0,value:void 0,duration:60,times:2,columns:[],ishappen:1},options1:[{value:"addr0",label:"发生源IP 数字",type:"long"},{value:"addr1",label:"源IP 数字",type:"long"},{value:"addr2",label:"目的IP 数字 ",type:"long"},{value:"ip0",label:"发生源IP",type:"string"},{value:"ip1",label:"源IP",type:"string"},{value:"ip2",label:"目的IP",type:"string"},{value:"port1",label:"源端口",type:"int"},{value:"port2",label:"目的端口",type:"int"},{value:"mac1",label:"源MAC地址",type:"string"},{value:"mac2",label:"目的MAC",type:"string"},{value:"category",label:"发生源设备类别",type:"int"},{value:"device",label:"发生源设备类型",type:"int"},{value:"kind",label:"事件类别",type:"int"},{value:"type",label:"事件类型",type:"int"},{value:"level",label:"事件等级",type:"int"},{value:"proType",label:"日志来源协议",type:"string"},{value:"protocol",label:"协议",type:"string"},{value:"code",label:"关键字",type:"string"}],options2:[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],options3:[]});function D({option:l}){return t("div",{style:{display:"flex",alignItems:"center"}},[t("span",{style:{minWidth:"50px"}},[l.label]),t("div",{class:"flex-center mx-30px",style:{gap:"8px 20px"}},[l.children&&!l.logic&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>o("||或",l)},{default:()=>[w("||或")]}),l.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>o("&&与",l)},{default:()=>[w("&&与")]}),l.children&&!l.logic&&!l.times&&!l.duration&&t(q,{onPositiveClick:()=>T(l),showIcon:!1,show:l.isShow,onNegativeClick:()=>l.isShow=!1},{default:ee(t(G,null,{default:()=>[t(L,{options:e.options1,value:e.obj.colume,"onUpdate:value":a=>S(a),placeholder:"请选择",style:{width:"180px"}},null),t(L,{options:e.options2,value:e.obj.option,"onUpdate:value":a=>e.obj.option=a,placeholder:"请选择",style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="category"||e.obj.colume=="device")&&t(L,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,labelField:e.obj.colume=="category"?"cname":e.obj.colume=="device"?"type":"",placeholder:"请选择",onScroll:a=>_(a),valueField:"id","onUpdate:value":a=>e.obj.value=a,style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="kind"||e.obj.colume=="type"||e.obj.colume=="level")&&t(L,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,"onUpdate:value":a=>e.obj.value=a,style:{width:"180px"},placeholder:"请选择"},null),e.showValueDom==1&&t(ne,{clearable:!0,value:e.obj.value,"onUpdate:value":a=>e.obj.value=a},null),e.showValueDom==0&&t(le,{clearable:!0,value:e.obj.value,"onUpdate:value":a=>e.obj.value=a},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>l.isShow=!0},{default:()=>[w("配置")]})}),l.children&&l.times&&l.duration&&t(q,{onPositiveClick:()=>F(l),showIcon:!1},{default:ee(t(G,null,{default:()=>[t(le,{style:{width:"140px"},clearable:!0,value:e.obj.duration,"onUpdate:value":a=>e.obj.duration=a},null),t(le,{style:{width:"140px"},clearable:!0,value:e.obj.times,"onUpdate:value":a=>e.obj.times=a},null),t(L,{clearable:!0,options:e.options1,value:e.obj.columns,multiple:!0,"onUpdate:value":a=>e.obj.columns=a,placeholder:"请选择",style:{width:"180px"}},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>{e.obj.columns=l.columns,e.obj.duration=l.duration,e.obj.times=l.times}},{default:()=>[w("配置")]})}),l.children&&l.logic&&t(q,{onPositiveClick:()=>h(l),showIcon:!1},{default:ee(t(G,null,{default:()=>[t(L,{clearable:!0,options:[{label:"发生",value:1},{label:"不发生",value:0}],value:e.obj.ishappen,"onUpdate:value":a=>e.obj.ishappen=a,placeholder:"请选择",style:{width:"180px"}},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>e.obj.ishappen=l.ishappen},{default:()=>[w("配置")]})}),!l.logic&&t(x,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>N(l)},{default:()=>[w("删除")]})]),l.duration&&l.times&&t("span",null,["在"+l.duration+"秒内，发生"+l.times+"次   归并字段："+A(l.columns)])])}const h=l=>{const a=/状态(\d+)/g;let n;const u=[];for(;(n=a.exec(l.label))!==null;)u.push(n[1]);l.ishappen=e.obj.ishappen,l.label=`状态${u[0]}之后${e.obj.ishappen?"发生":"不发生"}状态${u[1]}`},g=be(1),E=()=>g.value+=1,R=()=>{const l=a=>{let n=-1/0;const u=v=>{for(const r of v)r.id>n&&(n=r.id),r.children&&u(r.children)};return u(a),n};g.value=l(p.value)};ge(()=>{setTimeout(()=>{p.value.length>0&&R()},500)});const S=async l=>{const a=["addr0","addr1","addr2"],n=["ip0","ip1","ip2","mac1","mac2","port1","port2","proType","protocol","code"];a.includes(l)?e.showValueDom=0:n.includes(l)?e.showValueDom=1:e.showValueDom=2,l=="category"?(await z(),e.options3=V.data):l=="device"?(await M(),e.options3=I.data):l=="kind"?i():l=="type"?b():l=="level"&&(e.options3=[]),["ip0","ip1","ip2","mac1","mac2","proType","protocol","code"].includes(l)?e.options2=[{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"},{label:"匹配",value:"MATCH"}]:e.options2=[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],e.obj.option=e.options2[0].value,e.obj.colume=l,e.obj.value=void 0},C=()=>{if(p.value.length==0){p.value.push({label:"状态1",id:1,children:[],duration:60,times:2,columns:[]});return}const l=(p.value.length-1)/2+1;p.value.push({label:`状态${l}之后发生状态${l+1}`,id:E(),ishappen:1,logic:"and",children:[]});const a=p.value[p.value.length-1].id;p.value.push({label:`状态${l+1}`,id:E(),subId:a,children:[],duration:60,times:2,columns:[]})},o=(l,a)=>{a.children.push({label:l,id:E(),children:[],isShow:!1})},T=l=>{var r,$,U,m,P,H,O;if(!e.obj.colume)return(r=window.$message)==null?void 0:r.warning("选择的信息项不能为空");if(e.obj.value==null)return($=window.$message)==null?void 0:$.warning("条件值不能为空");const a=["ip0","ip1","ip2"],n=["mac1","mac2"],u=["port1","port2"];if(a.includes(e.obj.colume)&&!ye(e.obj.value))return(U=window.$message)==null?void 0:U.warning("请输入正确的IP地址");if(n.includes(e.obj.colume)&&!_e(e.obj.value))return(m=window.$message)==null?void 0:m.warning("请输入正确的MAC地址");if(u.includes(e.obj.colume)&&!we(e.obj.value))return(P=window.$message)==null?void 0:P.warning("请输入正确的端口号");let v=e.obj.value;if(e.showValueDom==2){const f=e.options3.find(Ae=>Ae.value==e.obj.value);v=f==null?void 0:f.label}l.children.push({colume:e.obj.colume,option:e.obj.option,value:e.obj.value,id:E(),label:`${(H=e.options1.find(f=>f.value==e.obj.colume))==null?void 0:H.label} ${(O=e.options2.find(f=>f.value==e.obj.option))==null?void 0:O.label} ${v} `,flag:!1}),y(),l.isShow=!1},F=l=>{l.duration=e.obj.duration,l.times=e.obj.times,l.columns=e.obj.columns},N=l=>{function a(n,u){return n.reduce((v,r)=>(u.includes(r.id)||(r.children&&(r.children=a(r.children,u)),v.push(r)),v),[])}l.subId?p.value=a(p.value,[l.id,l.subId]):p.value=a(p.value,[l.id])},A=l=>{let a="";return l.forEach((n,u)=>{var v;a+=`${(v=e.options1.find(r=>r.value==n))==null?void 0:v.label}${u==l.length-1?"":"、"}`}),a},y=()=>{e.obj={colume:void 0,option:void 0,value:void 0,duration:60,times:2,ishappen:1,columns:[]}},{pageData:V,getData:z,nextPage:B}=K(Ee),{pageData:I,getData:M,nextPage:s}=K(Se),i=async()=>{const{data:l,error:a}=await ke();console.log(l),e.options3=l.map(n=>({label:n.pname,value:n.id}))},b=async()=>{const{data:l,error:a}=await Ce();console.log(l),e.options3=l.map(n=>({label:n.pname,value:n.id}))},_=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&(e.obj.colume=="category"&&B(),e.obj.colume=="device"&&s())};return(l,a)=>{const n=Te,u=re;return Q(),J(u,{class:"h-220px",style:{border:"1px solid #dcdcdc","border-radius":"6px"}},{default:c(()=>[t(d(G),{justify:"end",class:"p-5px"},{default:c(()=>[ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:C},"㊉ 新增关联状态")]),_:1}),(Q(),J(n,{"block-line":"",data:p.value,"default-expand-all":"",selectable:!1,"render-label":D,"key-field":"id",key:g.value},null,8,["data"]))]),_:1})}}}),ul=de(il,[["__scopeId","data-v-0bdad4b6"]]),rl=Z({name:"OperateDrawer",__name:"operate-drawer",props:se({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:se(["submitted"],["update:visible"]),setup(j,{emit:p}){const e=j,D=p,h=oe(j,"visible"),{formRef:g,validate:E,restoreValidation:R}=me(),{defaultRequiredRule:S}=Pe(),C=Le(()=>({add:"新增关联策略",edit:"修改关联策略"})[e.operateType]),o=ue(T());function T(){return{aname:"",adesc:"",acond:[],arules:[],eid:null,elevel:null,fid:null,etext:"",syspara:1,dbtime:"",status:1}}const F={aname:S,eid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"}};async function N(){var l;if(await V(),await M(),Object.assign(o,T()),e.operateType==="edit"&&e.rowData){const{data:a,error:n}=await Xe(e.rowData.id);n||(Object.assign(o,a),o.fid=(l=o.fid)==null?void 0:l.split(","),o.acond=a.acond.replace(/&amp;/g,"&"),o.arules=a.arules.replace(/&amp;/g,"&"),o.acond=JSON.parse(o.acond),o.arules=JSON.parse(o.arules))}}function A(){h.value=!1}const{pageData:y,getData:V,nextPage:z}=K(Ye),B=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&y.data.length<y.total&&z()},{pageData:I,getData:M,nextPage:s}=K(el),i=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&I.data.length<I.total&&s()},b=l=>l.ipaddr+":"+l.fport+" ("+(l.ftype==0?"syslog":"SNMP Trap")+")";function _(){var l;console.log(o.acond),console.log(o.arules),(l=g.value)==null||l.validate(async a=>{var n,u,v,r,$;if(a){const U=a[0][0].field,m=(n=g.value)==null?void 0:n.$el.querySelectorAll(".n-form-item");if(!m)return;const P=Array.from(m).find(H=>{var O;return((O=H.__vueParentComponent)==null?void 0:O.props.path)===U});P&&$e(()=>{P.scrollIntoView({behavior:"smooth",block:"center"})})}else if(e.operateType==="add"){const{data:U,error:m}=await ll([{acond:JSON.stringify(o.acond),adesc:o.adesc,aname:o.aname,arules:JSON.stringify(o.arules),dbtime:o.dbtime,eid:o.eid,elevel:o.elevel,fid:(u=o.fid)==null?void 0:u.join(","),etext:o.etext,syspara:o.syspara,status:o.status}]);m||((v=window.$message)==null||v.success(k("common.addSuccess")),A(),D("submitted"))}else{const{data:U,error:m}=await De([{id:e.rowData.id,acond:JSON.stringify(o.acond),adesc:o.adesc,aname:o.aname,arules:JSON.stringify(o.arules),dbtime:o.dbtime,eid:o.eid,elevel:o.elevel,fid:(r=o.fid)==null?void 0:r.join(","),etext:o.etext,syspara:o.syspara,status:o.status}]);m||(($=window.$message)==null||$.success(k("common.updateSuccess")),A(),D("submitted"))}})}return Ne(h,()=>{h.value&&(N(),R())}),(l,a)=>{const n=ne,u=Re,v=L,r=xe,$=fe,U=re,m=x,P=G,H=Fe,O=ae("no-space");return Q(),J(H,{show:h.value,"onUpdate:show":a[9]||(a[9]=f=>h.value=f),title:C.value,preset:"card",class:"w-800px"},{footer:c(()=>[t(P,{size:16,justify:"center"},{default:c(()=>[t(m,{onClick:A},{default:c(()=>[w(te(d(k)("common.cancel")),1)]),_:1}),t(m,{type:"primary",onClick:_},{default:c(()=>[w(te(d(k)("common.confirm")),1)]),_:1})]),_:1})]),default:c(()=>[t(U,{class:"max-h-480px pr-20px"},{default:c(()=>[t($,{ref_key:"formRef",ref:g,model:o,rules:F,"label-placement":"top","label-width":"120"},{default:c(()=>[t(u,{label:"策略名称",path:"aname"},{default:c(()=>[W(t(n,{value:o.aname,"onUpdate:value":a[0]||(a[0]=f=>o.aname=f),clearable:"",placeholder:"请输入策略名称"},null,8,["value"]),[[O]])]),_:1}),t(u,{label:"策略描述",path:"adesc"},{default:c(()=>[W(t(n,{type:"textarea",value:o.adesc,"onUpdate:value":a[1]||(a[1]=f=>o.adesc=f),placeholder:"请输入策略描述",clearable:""},null,8,["value"]),[[O]])]),_:1}),t(u,{label:"条件",path:"acond"},{default:c(()=>[t(sl,{data:o.acond,"onUpdate:data":a[2]||(a[2]=f=>o.acond=f)},null,8,["data"])]),_:1}),t(u,{label:"关联规则",path:"arules"},{default:c(()=>[t(ul,{data:o.arules,"onUpdate:data":a[3]||(a[3]=f=>o.arules=f)},null,8,["data"])]),_:1}),t(u,{label:"事件名称",path:"eid"},{default:c(()=>[t(v,{value:o.eid,"onUpdate:value":a[4]||(a[4]=f=>o.eid=f),placeholder:"请选择事件名称",clearable:"",filterable:"","value-field":"id","label-field":"ename",options:d(y).data,"reset-menu-on-options-change":!1,onScroll:B},null,8,["value","options"])]),_:1}),t(u,{label:"事件等级",path:"elevel"},{default:c(()=>[t(v,{filterable:"",value:o.elevel,"onUpdate:value":a[5]||(a[5]=f=>o.elevel=f),placeholder:"请选择事件等级",options:d(he)(d(je)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),t(u,{label:"转发外系统",path:"fid"},{default:c(()=>[t(v,{multiple:"","max-tag-count":1,value:o.fid,"onUpdate:value":a[6]||(a[6]=f=>o.fid=f),placeholder:"请选择转发外系统",clearable:"",filterable:"","render-label":b,"value-field":"id","label-field":"ipaddr",options:d(I).data,"reset-menu-on-options-change":!1,onScroll:i},null,8,["value","options"])]),_:1}),t(u,{label:"事件文本",path:"etext"},{default:c(()=>[t(n,{type:"textarea",value:o.etext,"onUpdate:value":a[7]||(a[7]=f=>o.etext=f),placeholder:"请输入事件文本",clearable:""},null,8,["value"])]),_:1}),t(u,{label:"使用状态",path:"maxagg"},{default:c(()=>[t(r,{value:o.status,"onUpdate:value":a[8]||(a[8]=f=>o.status=f),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),dl=de(rl,[["__scopeId","data-v-55bc42e7"]]),cl={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Y(j){return typeof j=="function"||Object.prototype.toString.call(j)==="[object Object]"&&!Be(j)}const $l=Z({name:"eventalarm_associatedeventspolicy",__name:"index",setup(j){const p=Ve(),{columns:e,columnChecks:D,data:h,getData:g,loading:E,mobilePagination:R,searchParams:S,resetSearchParams:C}=Ge({apiFn:al,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"aname",title:"策略名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"adesc",title:"策略描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",minWidth:120,render:l=>{(l.elevel===void 0||l.elevel===null)&&(l.elevel=1);const a={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},n=k(Ze[l.elevel]);let u={color:a[l.elevel],textColor:"#ffffff",borderColor:a[l.elevel]};return t(ce,{size:"small",color:u},Y(n)?n:{default:()=>[n]})}},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"status",title:"使用状态",align:"center",width:160,render:l=>t(xe,{value:l.status,"onUpdate:value":[a=>l.status=a,()=>_(l)],checkedValue:1,uncheckedValue:0},null)},{key:"syspara",title:"系统内置",align:"center",width:240,render:l=>{l.sysparam==null&&(l.sysparam=0);const a={0:"success",1:"info"},n=k(ze[l.sysparam]);return t(ce,{size:"small",type:a[l.sysparam]},Y(n)?n:{default:()=>[n]})}},{key:"operate",title:k("common.operate"),align:"center",width:160,fixed:"right",render:l=>{let a;return l.syspara!=0?t("div",{class:"flex-center gap-8px"},[W(t(x,{type:"primary",ghost:!0,size:"small",onClick:()=>M(l.id)},Y(a=k("common.edit"))?a:{default:()=>[a]}),[[ae("no-auth"),"assocition.policy.update"]]),t(q,{onPositiveClick:()=>s(l.id)},{default:()=>k("common.confirmDelete"),trigger:()=>{let n;return W(t(x,{type:"error",ghost:!0,size:"small"},Y(n=k("common.delete"))?n:{default:()=>[n]}),[[ae("no-auth"),"assocition.policy.delete"]])}})]):null}}]}),{drawerVisible:o,operateType:T,editingData:F,handleAdd:N,handleEdit:A,checkedRowKeys:y,onBatchDeleted:V,onDeleted:z,closeDrawer:B}=Qe(h,g);async function I(){console.log(y.value),i(y.value,l=>{V()})}function M(l){A(l)}function s(l){console.log(l),i([l],a=>{z()})}async function i(l,a){const{data:n,error:u}=await tl(l);if(!u)a&&a(n);else return!1}async function b(){}async function _(l){var n,u;const a={id:l.id,status:l.status};try{const{data:v,error:r}=await De([a]);if(!r)(n=window.$message)==null||n.success(l.status===1?"使用成功":"停用成功"),g();else throw new Error("更新失败")}catch{l.status=l.status===1?0:1,(u=window.$message)==null||u.error("操作失败，请重试")}}return(l,a)=>{const n=Ie,u=Oe,v=ve;return Q(),Me("div",cl,[t(ol,{model:d(S),"onUpdate:model":a[0]||(a[0]=r=>X(S)?S.value=r:null),onReset:d(C),onSearch:d(g)},null,8,["model","onReset","onSearch"]),t(v,{title:"关联策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":c(()=>[t(n,{columns:d(D),"onUpdate:columns":a[1]||(a[1]=r=>X(D)?D.value=r:null),"disabled-delete":d(y).length===0,loading:d(E),onAdd:d(N),onDelete:I,onRefresh:d(g),"is-view-export-button":!0,onExportHandler:b,"is-view-add-button":d(pe)("assocition.policy.insert"),"is-view-delete-button":d(pe)("assocition.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:c(()=>[t(u,{"checked-row-keys":d(y),"onUpdate:checkedRowKeys":a[2]||(a[2]=r=>X(y)?y.value=r:null),columns:d(e),data:d(h),size:"small","flex-height":!d(p).isMobile,"scroll-x":962,loading:d(E),remote:"","row-key":r=>r.id,pagination:d(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(dl,{visible:d(o),"onUpdate:visible":a[3]||(a[3]=r=>X(o)?o.value=r:null),"operate-type":d(T),"row-data":d(F),onSubmitted:d(g)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{$l as default};
