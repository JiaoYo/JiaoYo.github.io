import{_ as Oe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CMdAjh88.js";import{_ as Ae}from"./round-delete-wQkUyB87.js";import{_ as Ee}from"./round-add--_pSpbF_.js";import{d as we,at as ke,q as Ce,v as Ve,r as ae,s as Ne,a as He,au as Te,a2 as je,c as U,o as g,w as a,f as t,b8 as Ge,G as ze,z as j,h as s,aw as te,C as A,b as z,g as u,e as h,t as p,bp as Je,B as x,N as De,$ as K,b9 as Ue,b_ as Ke,b$ as We,bZ as Ze,c0 as qe,c1 as Qe,c2 as Pe,c3 as Xe,a9 as Re,c4 as Ie,F as Ye,U as $e,M as et,i as tt,y as X,aB as ge,ad as at,D as J,bn as lt,ac as nt,aE as ce,c5 as xe,c6 as st,aF as ot}from"./index-DMk9ecAg.js";import{u as rt,a as it}from"./table-C6eerTnn.js";import{u as me}from"./usePageData-KTtgYQ98.js";import{_ as Le}from"./Grid-BIOqdWqR.js";import{_ as Be}from"./FormItemGridItem-CblRT5zG.js";import{N as ut}from"./DatePicker-BTriC2aG.js";import{_ as dt}from"./round-search-D0NIJO1w.js";import{_ as pt}from"./round-refresh-BaPFSueZ.js";import{_ as ct,a as ft}from"./DescriptionsItem-DYNfWZxl.js";import{N as fe}from"./Popconfirm-ZXnEhqzl.js";import{N as mt}from"./RadioButton-VGdYLQdE.js";const gt={key:0},vt={key:0},bt={key:0},yt={key:0},_t=we({name:"OperateDrawer",__name:"operate-drawer",props:ke({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ke(["submitted"],["update:visible"]),setup(L,{emit:le}){const N=le,w=Ce(),b=L,n=Ve(E());function E(){return{pid:void 0,id:"",debugname:"",docker:void 0,dockcharge:"",dockcontact:"",status:0,notes:"",debugresult:0,dtype:void 0,starttime:null,endtime:null,dbcreater:void 0,startAndTimeRange:void 0,re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const{pageData:B,getData:c}=me(Ke),T=async()=>{await c({usertypes:"2,3"})},q=async r=>{const e=r.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&B.data.length<B.total&&Z()},{pageData:P,getData:C,nextPage:W}=me(We),ne=async r=>{const e=r.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&P.data.length<P.total&&W()},se=async()=>{await C({pid:n.pid})},oe=async r=>{if(n.docker=r,n.docker){const e=P.data.find(m=>m.docker===n.docker);e?(n.dockcharge=e.pname,n.dockcontact=e.pcontact):(n.dockcharge="",n.dockcontact="")}},{pageData:V,getData:R,nextPage:Z}=me(Ze),re=async r=>{const e=r.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&V.data.length<V.total&&Z()},ie=async()=>{await R()},F=ae([]),{pageData:v,getData:y,nextPage:I}=me(qe),H=async r=>{const e=r.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&v.data.length<v.total&&(I(),F.value=v.data)},G=async()=>{await y({fuzzy:w.userInfo.pname,page:1}),F.value=v.data},Y=async()=>{await y({page:1}),F.value=v.data},ee=async r=>{n.pid=r},ue=ae(void 0);async function de(){G(),ie(),T(),Object.assign(n,E()),b.operateType==="add"&&(n.pid=Number(b.pid)),b.operateType==="edit"&&b.rowData&&(Object.assign(n,b.rowData),ue.value=n.status,b.rowData.starttime&&b.rowData.endtime?n.startAndTimeRange=[b.rowData.starttime,b.rowData.endtime]:n.startAndTimeRange=null),se()}const{formRef:pe,validate:i,restoreValidation:Q}=Ne(),M={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dbcreater:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"},debugname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcharge:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"}},o=He(()=>({add:"新增待调试业务",edit:"修改待调试业务"})[b.operateType]),l=Te(L,"visible");je(l,()=>{l.value&&(de(),setTimeout(()=>{const r=document.querySelector(".n-scrollbar-content");r==null||r.scrollTo(0,0)},300),Q())});async function k({file:r},e){let m=new FormData;m.append("multipartFile",r.file);const{data:S,error:D}=await Qe(m);D||(n[e]=S)}function O(){l.value=!1}async function $(r){if(r)try{const m=await(await fetch(r==null?void 0:r.split("?")[0],{mode:"cors"})).blob(),S=URL.createObjectURL(m),D=document.createElement("a");D.href=S,D.download=r==null?void 0:r.split("?")[1],D.style.display="none",document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(S)}catch(e){console.error("下载失败:",e)}}async function ve(){var r;await i(),(r=window.$dialog)==null||r.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await be()}})}async function be(){var r,e;if(await i(),b.operateType==="edit"){const m=JSON.parse(JSON.stringify(n)),{data:S,error:D}=await Pe([m]);D||(O(),N("submitted"),(r=window.$message)==null||r.success("修改成功"))}else{const{data:m,error:S}=await Xe([{...n}]);S||(O(),N("submitted"),(e=window.$message)==null||e.success("添加成功"))}}const ye=r=>{var e;n.debugname=(e=V.data.find(m=>m.id==r))==null?void 0:e.tname,n.dtype=r};async function _e(r,e){n.startAndTimeRange=r,n.starttime=r==null?void 0:r[0],n.endtime=r==null?void 0:r[1]}return(r,e)=>{const m=Be,S=Je,D=Le,f=ze,he=Ge,Fe=De,Me=Ue;return g(),U(Me,{show:l.value,"onUpdate:show":e[22]||(e[22]=d=>l.value=d),title:o.value,preset:"card",class:"w-800px"},{footer:a(()=>[t(Fe,{justify:"end",size:16},{default:a(()=>[t(s(x),{onClick:O},{default:a(()=>[u(p(s(K)("common.cancel")),1)]),_:1}),t(s(x),{type:"primary",onClick:ve},{default:a(()=>[u(p(s(K)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(he,{class:"pr-20px"},{default:a(()=>[t(f,{ref_key:"formRef",ref:pe,model:n,rules:M,"label-placement":"left","label-width":120},{default:a(()=>[t(D,{responsive:"screen","item-responsive":""},{default:a(()=>[t(m,{span:"24 m:12",label:"项目列表",path:"pid"},{default:a(()=>[t(s(te),{filterable:"",clearable:"",value:n.pid,"onUpdate:value":[e[0]||(e[0]=d=>n.pid=d),ee],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:Y,options:F.value,onScroll:H},null,8,["value","options"])]),_:1}),t(m,{span:"24 m:12",label:"权重",path:"dtype"},{default:a(()=>[t(s(te),{filterable:"",value:n.dtype,"onUpdate:value":[e[1]||(e[1]=d=>n.dtype=d),ye],tag:"",placeholder:"请选择权重","label-field":"tname","value-field":"id",options:s(V).data,onScroll:re},null,8,["value","options"])]),_:1}),t(m,{span:"24 m:12",label:"业务名称",path:"debugname"},{default:a(()=>[t(s(A),{value:n.debugname,"onUpdate:value":e[2]||(e[2]=d=>n.debugname=d),placeholder:"请输入"},null,8,["value"])]),_:1}),t(m,{span:"24 m:12",label:"调试人",path:"dbcreater"},{default:a(()=>[t(s(te),{filterable:"",value:n.dbcreater,"onUpdate:value":e[3]||(e[3]=d=>n.dbcreater=d),placeholder:"请选择调试人","label-field":"username","value-field":"id",options:s(B).data,onScroll:q},null,8,["value","options"])]),_:1}),t(m,{span:"24 m:24",label:"起止时间",path:"startAndTimeRange"},{default:a(()=>[t(s(ut),{clearable:"",value:n.startAndTimeRange,"onUpdate:value":e[4]||(e[4]=d=>n.startAndTimeRange=d),type:"daterange","value-format":"yyyy-MM-dd",style:{width:"100%"},"onUpdate:formattedValue":_e},null,8,["value"])]),_:1}),t(m,{span:"24 m:12",label:"对接方",path:"docker"},{default:a(()=>[t(s(te),{filterable:"",value:n.docker,"onUpdate:value":[e[5]||(e[5]=d=>n.docker=d),oe],clearable:"",tag:"",placeholder:"请选择或输入对接方","label-field":"docker","value-field":"docker",options:s(P).data,onScroll:ne},null,8,["value","options"])]),_:1}),t(m,{span:"24 m:12",label:"对接方负责人",path:"dockcharge"},{default:a(()=>[t(s(A),{value:n.dockcharge,"onUpdate:value":e[6]||(e[6]=d=>n.dockcharge=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(m,{span:"24 m:12",label:"联系方式",path:"dockcontact"},{default:a(()=>[t(s(A),{value:n.dockcontact,"onUpdate:value":e[7]||(e[7]=d=>n.dockcontact=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),b.operateType=="edit"?(g(),U(m,{key:0,span:"24 m:12",label:"状态",path:"status"},{default:a(()=>[t(s(te),{clearable:"",value:n.status,"onUpdate:value":e[8]||(e[8]=d=>n.status=d),placeholder:"请选择",options:s(w).userInfo.usertype==0||s(w).userInfo.usertype==2?[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"完成调试",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"完成调试",value:2}]},null,8,["value","options"])]),_:1})):j("",!0),t(m,{span:"24 m:12",label:"备注",path:"notes"},{default:a(()=>[t(s(A),{value:n.notes,"onUpdate:value":e[9]||(e[9]=d=>n.notes=d),placeholder:"请输入"},null,8,["value"])]),_:1}),t(m,{span:"24 m:24",label:"附件1",path:"notes"},{default:a(()=>{var d;return[t(s(A),{value:n.re1,"onUpdate:value":e[10]||(e[10]=_=>n.re1=_),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),n.fl1?(g(),z("span",gt,[u(p((d=n.fl1)==null?void 0:d.split("?")[1])+" ",1),h("span",{class:"cursor-pointer c-#c92a2a",onClick:e[11]||(e[11]=_=>n.fl1="")},"删除"),h("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[12]||(e[12]=_=>$(n.fl1))},"下载")])):(g(),U(S,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":_=>k(_,"fl1"),"show-file-list":!1},{default:a(()=>[t(s(x),{size:"small",ghost:"",type:"primary"},{default:a(()=>e[23]||(e[23]=[u("选择文件")])),_:1,__:[23]})]),_:1},8,["custom-request"]))]}),_:1}),t(m,{span:"24 m:24",label:"附件2",path:"notes"},{default:a(()=>{var d;return[t(s(A),{value:n.re2,"onUpdate:value":e[13]||(e[13]=_=>n.re2=_),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),n.fl2?(g(),z("span",vt,[u(p((d=n.fl2)==null?void 0:d.split("?")[1])+" ",1),h("span",{class:"cursor-pointer c-#c92a2a",onClick:e[14]||(e[14]=_=>n.fl2="")},"删除"),h("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[15]||(e[15]=_=>$(n.fl2))},"下载")])):(g(),U(S,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":_=>k(_,"fl2"),"show-file-list":!1},{default:a(()=>[t(s(x),{size:"small",ghost:"",type:"primary"},{default:a(()=>e[24]||(e[24]=[u("选择文件")])),_:1,__:[24]})]),_:1},8,["custom-request"]))]}),_:1}),t(m,{span:"24 m:24",label:"附件3",path:"notes"},{default:a(()=>{var d;return[t(s(A),{value:n.re3,"onUpdate:value":e[16]||(e[16]=_=>n.re3=_),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),n.fl3?(g(),z("span",bt,[u(p((d=n.fl3)==null?void 0:d.split("?")[1])+" ",1),h("span",{class:"cursor-pointer c-#c92a2a",onClick:e[17]||(e[17]=_=>n.fl3="")},"删除"),h("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[18]||(e[18]=_=>$(n.fl3))},"下载")])):(g(),U(S,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":_=>k(_,"fl3"),"show-file-list":!1},{default:a(()=>[t(s(x),{size:"small",ghost:"",type:"primary"},{default:a(()=>e[25]||(e[25]=[u("选择文件")])),_:1,__:[25]})]),_:1},8,["custom-request"]))]}),_:1}),t(m,{span:"24 m:24",label:"附件4",path:"notes"},{default:a(()=>{var d;return[t(s(A),{value:n.re4,"onUpdate:value":e[19]||(e[19]=_=>n.re4=_),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),n.fl4?(g(),z("span",yt,[u(p((d=n.fl4)==null?void 0:d.split("?")[1])+" ",1),h("span",{class:"cursor-pointer c-#c92a2a",onClick:e[20]||(e[20]=_=>n.fl4="")},"删除"),h("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[21]||(e[21]=_=>$(n.fl4))},"下载")])):(g(),U(S,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":_=>k(_,"fl4"),"show-file-list":!1},{default:a(()=>[t(s(x),{size:"small",ghost:"",type:"primary"},{default:a(()=>e[26]||(e[26]=[u("选择文件")])),_:1,__:[26]})]),_:1},8,["custom-request"]))]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),ht=we({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ke(["reset","search","search1","clear"],["update:model"]),setup(L,{emit:le}){const N=Re(),w=Ie(),b=le,n=Ce(),{formRef:E,restoreValidation:B}=Ne(),c=Te(L,"model"),T=ae([]),{pageData:q,getData:P,nextPage:C}=me(qe),W=async v=>{const y=v.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&q.data.length<q.total&&(C(),T.value=q.data)},ne=async v=>{var y;v?(c.value.pid=v,b("search1"),n.setProjectInfo({pname:(y=T.value.find(I=>I.id==v))==null?void 0:y.proname,pid:v})):b("clear")},se=async v=>{await P({fuzzy:v,page:1}),T.value=q.data},oe=async()=>{await P({page:1}),T.value=q.data,b("search1")},V=async v=>{c.value.status=v,b("search1")},R=async()=>{c.value.status=null},Z=async()=>{var v,y;await P({fuzzy:w.query.pname?w.query.pname:n.userInfo.pname}),T.value=q.data,c.value.pid=w.query.prjId?Number(w.query.prjId):n.userInfo.pid?n.userInfo.pid:(v=T.value[0])==null?void 0:v.id,n.setProjectInfo({pid:c.value.pid,pname:(y=T.value.find(I=>I.id==c.value.pid))==null?void 0:y.proname}),b("search"),setTimeout(()=>{N.replace({path:w.path,query:{}})},1e3)};Z();async function re(){await B(),c.value.fuzzy="",c.value.pid=null,c.value.status=null,b("reset")}const ie=()=>{c.value.fuzzy="",b("search")};async function F(){b("search")}return je(()=>w.query,v=>{v.pname&&Z()}),(v,y)=>{const I=te,H=Be,G=A,Y=pt,ee=x,ue=dt,de=De,pe=Le,i=ze,Q=$e;return g(),U(Q,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[t(i,{ref_key:"formRef",ref:E,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ye(F,["enter"])},{default:a(()=>[t(pe,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[t(H,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:a(()=>[t(I,{filterable:"",clearable:"",value:c.value.pid,"onUpdate:value":[y[0]||(y[0]=M=>c.value.pid=M),ne],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:oe,onSearch:se,options:T.value,onScroll:W},null,8,["value","options"])]),_:1}),t(H,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:a(()=>[t(I,{clearable:"",filterable:"",value:c.value.status,"onUpdate:value":[y[1]||(y[1]=M=>c.value.status=M),V],placeholder:"请选择状态",onClear:R,options:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"完成调试(待审核)",value:2},{label:"审核完成",value:3}]},null,8,["value"])]),_:1}),t(H,{span:"24 s:12 m:6",label:"业务名称",path:"fuzzy"},{default:a(()=>[t(G,{value:c.value.fuzzy,"onUpdate:value":y[2]||(y[2]=M=>c.value.fuzzy=M),placeholder:"请输入",clearable:"",onClear:ie},null,8,["value"])]),_:1}),t(H,{span:"24  s:12 m:6",class:"pr-24px"},{default:a(()=>[t(de,{class:"w-full"},{default:a(()=>[t(ee,{onClick:re},{icon:a(()=>[t(Y,{class:"text-icon"})]),default:a(()=>[u(" "+p(s(K)("common.reset")),1)]),_:1}),t(ee,{type:"primary",ghost:"",onClick:F},{icon:a(()=>[t(ue,{class:"text-icon"})]),default:a(()=>[u(" "+p(s(K)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),kt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},wt={key:0},Ct={key:1},Dt={key:0},xt={key:1},St={key:0},Nt={key:1},Tt={key:0},jt={key:1};function Se(L){return typeof L=="function"||Object.prototype.toString.call(L)==="[object Object]"&&!ot(L)}const Vt=we({name:"projectmanagement_business",__name:"index",setup(L){const le=et(),N=Ce(),w=Ie(),b=Re(),{columns:n,columnChecks:E,data:B,getData:c,loading:T,pagination:q,mobilePagination:P,searchParams:C}=rt({showTotal:!0,immediate:!1,apiFn:st,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",status:null,dbcreater:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"debugname",title:"业务名称",align:"center",width:180},{key:"proname",title:"所属项目",align:"center",width:180,render(o){return t("span",{class:"cursor-pointer",onClick:()=>ie(o)},[o.proname])}},{key:"docker",title:"对接方",align:"center",width:120,render:o=>{var l;return t("span",null,[(l=o.docker)==null?void 0:l.split("&id=")[0]])}},{key:"dockcharge",title:"对接方负责人",align:"center",width:120},{key:"dockcontact",title:"联系方式",align:"center",width:120},{key:"status",title:"状态",align:"center",width:120,render(o){return t(ce,{type:o.status==0?"info":o.status==1||o.status==2?"warning":"success"},{default:()=>[o.status==0?"待调试":o.status==1?"开始调试":o.status==2?"完成调试":"审核完成"]})}},{key:"dbusername",title:"调试人",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"ckusername",title:"审核人",align:"center",width:120},{key:"ckdbtime",title:"审核时间",align:"center",width:180},{key:"dbusername",title:"调试人",align:"center",width:120},{key:"dbdbtime",title:"调试时间",align:"center",width:180},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:180},{key:"operate",title:K("common.operate"),align:"center",width:280,fixed:"right",render:o=>{let l;return t("div",{class:"flex-center gap-8px"},[o.status==0&&o.dbcreater==N.userInfo.id&&t(fe,{onPositiveClick:()=>y(o,1)},{default:()=>"确定开始调试吗？",trigger:()=>J(t(x,{type:"success",ghost:!0,size:"small"},{default:()=>["开始"]}),[[X("no-auth"),"project:Debug:update"]])}),o.status==1&&o.dbcreater==N.userInfo.id&&t(fe,{onPositiveClick:()=>y(o,2)},{default:()=>"确定完成调试？",trigger:()=>J(t(x,{type:"success",ghost:!0,size:"small"},{default:()=>["完成"]}),[[X("no-auth"),"project:Debug:update"]])}),o.status==2&&(N.userInfo.usertype==0||N.userInfo.usertype==2)&&t(fe,{onPositiveClick:()=>y(o,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>J(t(x,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[X("no-auth"),"project:Debug:update"]])}),J(t(x,{type:"primary",ghost:!0,size:"small",onClick:()=>M(o)},{default:()=>[u("详情")]}),[[X("no-auth"),"project:Debug:select"]]),J(t(x,{type:"primary",ghost:!0,size:"small",onClick:()=>I(o.id)},Se(l=K("common.edit"))?l:{default:()=>[l]}),[[X("no-auth"),"project:Debug:update"]]),t(fe,{onPositiveClick:()=>v(o.id)},{default:()=>K("common.confirmDelete"),trigger:()=>{let k;return J(t(x,{type:"error",ghost:!0,size:"small"},Se(k=K("common.delete"))?k:{default:()=>[k]}),[[X("no-auth"),"project:Debug:delete"]])}})])}}]}),{drawerVisible:W,operateType:ne,editingData:se,handleAdd:oe,handleEdit:V,checkedRowKeys:R,onBatchDeleted:Z,onDeleted:re}=it(B,c);tt(async()=>{});const ie=o=>{N.setProjectInfo({pid:o.pid,pname:o.proname}),b.push("/projectmanagement/orderdetail?prjId="+o.pid+`&pname=${o.proname}&IsScroll=1`)};async function F(){console.log(R.value),H(R.value.join(","),o=>{Z()})}async function v(o){const{data:l,error:k}=await xe(o,C.pid);k||re()}const y=async(o,l)=>{var $;const{data:k,error:O}=await Pe([{id:o.id,status:l,pid:o.pid}]);O||(($=window.$message)==null||$.success("操作成功"),c(),l==3?window.dispatchEvent(new CustomEvent("clearReview")):window.dispatchEvent(new CustomEvent("refreshTodo")))};function I(o){V(o)}async function H(o,l){const{data:k,error:O}=await xe(o,C.pid);if(!O)l&&l(k);else return!1}const G=ae(-1),Y=o=>{o>0?(G.value=o,C.dbcreater=JSON.parse(JSON.stringify(o)),c()):(C.dbcreater=void 0,G.value=-1,c())},ee=o=>{c()},ue=()=>{if(console.log(w.query.prjId,"route.query.prjId"),w.query.debug){C.status=Number(w.query.debug),C.dbcreater=N.userInfo.id,Y(N.userInfo.id);return}w.query.review&&(C.status=2),c()},de=()=>{c()},pe=()=>{B.value=[],q.itemCount=0},i=ae(null),Q=ae(!1),M=o=>{i.value=o,Q.value=!0};return(o,l)=>{const k=mt,O=nt,$=De,ve=Ee,be=Ae,ye=Oe,_e=at,r=$e,e=ft,m=ct,S=Ue,D=X("no-auth");return g(),z("div",kt,[t(ht,{model:s(C),"onUpdate:model":l[0]||(l[0]=f=>ge(C)?C.value=f:null),onReset:de,onSearch:ue,onSearch1:s(c),onClear:pe},null,8,["model","onSearch1"]),t(r,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t($,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>[l[6]||(l[6]=h("div",null,"待调试业务",-1)),t(O,{size:"small",value:G.value,"onUpdate:value":[l[1]||(l[1]=f=>G.value=f),Y],name:"radiobuttongroup1"},{default:a(()=>[t(k,{value:-1,label:"默认"}),t(k,{value:s(N).userInfo.id,label:"我的调试"},null,8,["value"])]),_:1},8,["value"])]),_:1,__:[6]})]),"header-extra":a(()=>[t($,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[J((g(),U(s(x),{onClick:s(oe),size:"small",ghost:"",type:"primary"},{icon:a(()=>[t(ve,{class:"text-icon"})]),default:a(()=>[l[7]||(l[7]=u(" "+p("新增")))]),_:1,__:[7]},8,["onClick"])),[[D,"project:Debug:insert"]]),t(s(fe),{onPositiveClick:F},{trigger:a(()=>[J((g(),U(s(x),{size:"small",ghost:"",type:"error",disabled:s(R).length==0},{icon:a(()=>[t(be,{class:lt(["text-icon",{"animate-spin":s(T)}])},null,8,["class"])]),default:a(()=>[l[8]||(l[8]=u(" "+p("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[D,"project:Debug:delete"]])]),default:a(()=>[l[9]||(l[9]=u(" 确定要删除选中的吗？ "))]),_:1,__:[9]}),t(ye,{columns:s(E),"onUpdate:columns":l[2]||(l[2]=f=>ge(E)?E.value=f:null)},null,8,["columns"])]),_:1})]),default:a(()=>[t(_e,{"checked-row-keys":s(R),"onUpdate:checkedRowKeys":l[3]||(l[3]=f=>ge(R)?R.value=f:null),columns:s(n),data:s(B),size:"small","flex-height":!s(le).isMobile,loading:s(T),remote:"","row-key":f=>f.id,"scroll-x":s(n).reduce((f,he)=>f+(he.width||100),0),pagination:s(P),class:"sm:h-full","onUpdate:filters":ee},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","scroll-x","pagination"]),t(_t,{visible:s(W),"onUpdate:visible":l[4]||(l[4]=f=>ge(W)?W.value=f:null),onSubmitted:s(c),"operate-type":s(ne),pid:s(C).pid,"row-data":s(se)},null,8,["visible","onSubmitted","operate-type","pid","row-data"])]),_:1}),t(S,{show:Q.value,"onUpdate:show":l[5]||(l[5]=f=>Q.value=f),title:"查看详情",preset:"card",class:"w-1200px"},{default:a(()=>[t(m,{bordered:"","label-placement":"left","label-align":"center",columns:2,"label-style":{width:"160px"}},{default:a(()=>[t(e,null,{label:a(()=>l[10]||(l[10]=[u(" 权重 ")])),default:a(()=>[h("span",null,p(i.value.tname),1)]),_:1}),t(e,null,{label:a(()=>l[11]||(l[11]=[u(" 业务名称 ")])),default:a(()=>[h("span",null,p(i.value.debugname),1)]),_:1}),t(e,null,{label:a(()=>l[12]||(l[12]=[u(" 计划起止时间 ")])),default:a(()=>[h("span",null,p(i.value.starttime)+"--"+p(i.value.endtime),1)]),_:1}),t(e,null,{label:a(()=>l[13]||(l[13]=[u(" 对接方 ")])),default:a(()=>[h("span",null,p(i.value.docker),1)]),_:1}),t(e,null,{label:a(()=>l[14]||(l[14]=[u(" 对接方负责人 ")])),default:a(()=>[h("span",null,p(i.value.dockcharge),1)]),_:1}),t(e,null,{label:a(()=>l[15]||(l[15]=[u(" 联系方式 ")])),default:a(()=>[h("span",null,p(i.value.dockcontact),1)]),_:1}),t(e,null,{label:a(()=>l[16]||(l[16]=[u(" 状态 ")])),default:a(()=>[i.value.status==0?(g(),U(s(ce),{key:0,type:"default"},{default:a(()=>l[17]||(l[17]=[u("未调试")])),_:1,__:[17]})):j("",!0),i.value.status==1?(g(),U(s(ce),{key:1,type:"info"},{default:a(()=>l[18]||(l[18]=[u("开始调试")])),_:1,__:[18]})):j("",!0),i.value.status==2?(g(),U(s(ce),{key:2,type:"success"},{default:a(()=>l[19]||(l[19]=[u("完成调试")])),_:1,__:[19]})):j("",!0),i.value.status==3?(g(),U(s(ce),{key:3,type:"success"},{default:a(()=>l[20]||(l[20]=[u("审核完成")])),_:1,__:[20]})):j("",!0)]),_:1}),t(e,null,{label:a(()=>l[21]||(l[21]=[u(" 备注 ")])),default:a(()=>[h("span",null,p(i.value.notes),1)]),_:1}),t(e,null,{label:a(()=>l[22]||(l[22]=[u(" 调试人 ")])),default:a(()=>[h("span",null,p(i.value.dbusername),1)]),_:1}),t(e,null,{label:a(()=>l[23]||(l[23]=[u(" 调试时间 ")])),default:a(()=>[h("span",null,p(i.value.dbdbtime),1)]),_:1}),t(e,null,{label:a(()=>l[24]||(l[24]=[u(" 审核人 ")])),default:a(()=>[h("span",null,p(i.value.ckusername),1)]),_:1}),t(e,null,{label:a(()=>l[25]||(l[25]=[u(" 审核时间 ")])),default:a(()=>[h("span",null,p(i.value.ckdbtime),1)]),_:1}),t(e,null,{label:a(()=>l[26]||(l[26]=[u(" 附件1 ")])),default:a(()=>{var f;return[i.value.re1?(g(),z("span",wt,"文件别名"+p(i.value.re1),1)):j("",!0),i.value.fl1?(g(),z("span",Ct,p((f=i.value.fl1)==null?void 0:f.split("?")[1]),1)):j("",!0)]}),_:1}),t(e,null,{label:a(()=>l[27]||(l[27]=[u(" 附件2 ")])),default:a(()=>{var f;return[i.value.re2?(g(),z("span",Dt,"文件别名"+p(i.value.re2),1)):j("",!0),i.value.fl2?(g(),z("span",xt,p((f=i.value.fl2)==null?void 0:f.split("?")[1]),1)):j("",!0)]}),_:1}),t(e,null,{label:a(()=>l[28]||(l[28]=[u(" 附件3 ")])),default:a(()=>{var f;return[i.value.re3?(g(),z("span",St,"文件别名"+p(i.value.re3),1)):j("",!0),i.value.fl3?(g(),z("span",Nt,p((f=i.value.fl3)==null?void 0:f.split("?")[1]),1)):j("",!0)]}),_:1}),t(e,null,{label:a(()=>l[29]||(l[29]=[u(" 附件4 ")])),default:a(()=>{var f;return[i.value.re4?(g(),z("span",Tt,"文件别名"+p(i.value.re4),1)):j("",!0),i.value.fl4?(g(),z("span",jt,p((f=i.value.fl4)==null?void 0:f.split("?")[1]),1)):j("",!0)]}),_:1})]),_:1})]),_:1},8,["show"])])}}});export{Vt as default};
