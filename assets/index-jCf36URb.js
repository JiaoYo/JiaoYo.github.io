import{_ as _e}from"./table-column-setting.vue_vue_type_script_setup_true_lang-RLvYZSGJ.js";import{_ as he}from"./round-delete-DDXstZni.js";import{_ as we}from"./round-add-CDuxp0E4.js";import{d as te,av as Z,D as be,aR as xe,aJ as J,s as K,A as re,a as ke,ax as ie,at as je,c as U,o as D,w as o,f as t,a3 as Se,M as ue,h as s,au as pe,H as j,bf as ne,g as m,J as ae,B as b,t as E,$ as N,a4 as Ce,cy as de,aE as ce,X as Te,Y as ze,C as Ne,z as me,L as De,a2 as fe,aS as Pe,aI as Ue,E as Fe,F as X,b as Be,aK as G,ay as Ie,I as W,aL as Me,e as $e,aN as Y,aD as Oe,aQ as Re}from"./index-CddQmI-c.js";import{e as qe,a as Le,d as le,f as Ve}from"./mojicb-DtLSqf98.js";import{u as Ae,a as Ee}from"./table-DDoF-sKE.js";import{u as ee}from"./usePageData-BKzmIEAP.js";import{_ as ge}from"./Grid-CG_YWdVR.js";import{_ as ye}from"./FormItemGridItem-CBPP8HMS.js";import{_ as He}from"./DatePicker-D516kcb4.js";import{_ as Ge}from"./round-search-DnVu2ZZt.js";import{N as oe}from"./Popconfirm-CkfL-ZaH.js";const We=te({name:"OperateDrawer",__name:"operate-drawer",props:Z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Z(["submitted"],["update:visible"]),setup(x,{emit:F}){const f=F,v=x,n=be(S());function S(){return{id:"",pid:null,cusname:"",token:"",passward:"",longitude:void 0,latitude:void 0,pro:void 0,jsonfmt:"",csvfmt:"",expiare:xe(0,new Date().getTime()+864e5*365),notes:""}}const{pageData:_,getData:i,nextPage:B}=ee(de),p=async a=>{const e=a.currentTarget,l=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&_.data.length<_.total&&(await B(),await ce(),setTimeout(()=>{e.scrollTop=l}))},d=a=>{n.pid=a},h=()=>{i({page:1})},I=J.debounce(async a=>{await i({fuzzy:a,page:1})},300),M=a=>{if(!a){n.pid=null,h();return}I(a)},C=K(!1);async function $(){Object.assign(n,S()),C.value=!1,i({page:1}),v.operateType==="edit"&&v.rowData&&(v.rowData.expiare=="已到期"&&(C.value=!0),Object.assign(n,v.rowData))}const{formRef:g,validate:T,restoreValidation:O}=re(),y={type:"string",required:!0,trigger:["blur","change"],message:"请输入"},P={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},cusname:y,token:y,passward:y,longitude:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},latitude:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},pro:y,expiare:y,notes:y,jsonfmt:y,csvfmt:y},H=ke(()=>({add:"新增气象信息",edit:"修改气象信息"})[v.operateType]),k=ie(x,"visible");je(k,()=>{k.value&&($(),setTimeout(()=>{const a=document.querySelector(".n-scrollbar-content");a==null||a.scrollTo(0,0)},300),O())});function z(){k.value=!1}const R=J.debounce(async()=>{var a,e;if(await T(),v.operateType==="edit"){const{data:l,error:u}=await qe([n]);u||(z(),f("submitted"),(a=window.$message)==null||a.success("修改成功"))}else{const{data:l,error:u}=await Le([{...n}]);u||(z(),f("submitted"),(e=window.$message)==null||e.success("添加成功"))}},1e3,{leading:!0,trailing:!0});return(a,e)=>{const l=ye,u=ge,w=ue,q=Se,L=ae,V=Ce;return D(),U(V,{show:k.value,"onUpdate:show":e[11]||(e[11]=r=>k.value=r),title:H.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:o(()=>[t(L,{justify:"end",size:16},{default:o(()=>[t(s(b),{onClick:z},{default:o(()=>[m(E(s(N)("common.cancel")),1)]),_:1}),t(s(b),{type:"primary",onClick:s(R)},{default:o(()=>[m(E(s(N)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:o(()=>[t(q,{class:"pr-20px"},{default:o(()=>[t(w,{ref_key:"formRef",ref:g,model:n,rules:P,"label-placement":"top","label-width":140},{default:o(()=>[t(u,{responsive:"screen","item-responsive":"","x-gap":"20"},{default:o(()=>[t(l,{span:"24 m:12",label:"关联项目",path:"pid"},{default:o(()=>[t(s(pe),{clearable:"",filterable:"",value:n.pid,"onUpdate:value":[e[0]||(e[0]=r=>n.pid=r),d],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:h,onSearch:M,options:s(_).data,onScroll:p},null,8,["value","options"])]),_:1}),t(l,{span:"24 m:12",label:"客户名称",path:"cusname"},{default:o(()=>[t(s(j),{value:n.cusname,"onUpdate:value":e[1]||(e[1]=r=>n.cusname=r),placeholder:"请输入"},null,8,["value"])]),_:1}),t(l,{span:"24 m:24",label:"气象信息Token",path:"token"},{default:o(()=>[t(s(j),{value:n.token,"onUpdate:value":e[2]||(e[2]=r=>n.token=r),placeholder:"请输入"},null,8,["value"])]),_:1}),t(l,{span:"24 m:24",label:"气象信息Passward",path:"passward"},{default:o(()=>[t(s(j),{value:n.passward,"onUpdate:value":e[3]||(e[3]=r=>n.passward=r),placeholder:"请输入"},null,8,["value"])]),_:1}),t(l,{span:"24 m:12",label:"经度",path:"longitude"},{default:o(()=>[t(s(ne),{value:n.longitude,"onUpdate:value":e[4]||(e[4]=r=>n.longitude=r),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(l,{span:"24 m:12",label:"维度",path:"latitude"},{default:o(()=>[t(s(ne),{value:n.latitude,"onUpdate:value":e[5]||(e[5]=r=>n.latitude=r),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(l,{span:"24 m:12",label:"合同项目名称",path:"pro"},{default:o(()=>[t(s(j),{value:n.pro,"onUpdate:value":e[6]||(e[6]=r=>n.pro=r),placeholder:"请输入"},null,8,["value"])]),_:1}),C.value?(D(),U(l,{key:1,span:"24 m:12",label:"过期时间",path:"expiare"},{default:o(()=>e[12]||(e[12]=[m(" 已到期 ")])),_:1,__:[12]})):(D(),U(l,{key:0,span:"24 m:12",label:"过期时间",path:"expiare"},{default:o(()=>[t(s(He),{size:"small","formatted-value":n.expiare,"onUpdate:formattedValue":e[7]||(e[7]=r=>n.expiare=r),type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})),t(l,{span:"24 m:12",label:"JSON格式",path:"jsonfmt"},{default:o(()=>[t(s(j),{type:"textarea",rows:2,value:n.jsonfmt,"onUpdate:value":e[8]||(e[8]=r=>n.jsonfmt=r),placeholder:"请输入"},null,8,["value"])]),_:1}),t(l,{span:"24 m:12",label:"CSV格式",path:"csvfmt"},{default:o(()=>[t(s(j),{type:"textarea",rows:2,value:n.csvfmt,"onUpdate:value":e[9]||(e[9]=r=>n.csvfmt=r),placeholder:"请输入"},null,8,["value"])]),_:1}),t(l,{span:"24 m:24",label:"备注",path:""},{default:o(()=>[t(s(j),{type:"textarea",value:n.notes,"onUpdate:value":e[10]||(e[10]=r=>n.notes=r),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ke=te({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Z(["reset","search","clear"],["update:model"]),setup(x,{emit:F}){const f=Te(),v=ze(),n=F,{formRef:S}=re(),_=Ne("pname"),i=ie(x,"model"),B=me(),p=K([]),{pageData:d,getData:h,nextPage:I}=ee(de),M=async e=>{const l=e.currentTarget,u=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&d.data.length<d.total&&(await I(),p.value=d.data,await ce(),setTimeout(()=>{l.scrollTop=u}))};ee(Pe);const C=async e=>{var l,u;T.value=!0,e?(i.value.pid=e,n("search"),B.setProjectInfo({pname:(l=p.value.find(w=>w.id==e))==null?void 0:l.proname,pid:e}),_.value=(u=p.value.find(w=>w.id==e))==null?void 0:u.proname):n("search")},$=J.debounce(async e=>{await h({fuzzy:e,page:1}),p.value=d.data},300),g=K(!1),T=K(!1),O=e=>{if(i.value.pid=null,g.value=!0,T.value=!1,!e){P();return}$(e)},y=async()=>{g.value&&!T.value&&(await h({page:1}),p.value=d.data,g.value=!1)},P=async()=>{await h({page:1}),p.value=d.data};(async()=>{await h(),p.value=d.data,i.value.pid=f.query.prjId?Number(f.query.prjId):void 0,i.value.fuzzy=f.query.pname?f.query.pname:"",n("search"),setTimeout(()=>{v.replace({path:f.path,query:{}})},10)})();function k(){i.value.fuzzy=void 0,n("search")}const z=J.debounce(e=>{n("search")},1e3,{leading:!0,trailing:!1}),R=e=>{if(!e)return n("search");i.value.fuzzy=e||void 0,z(e)};async function a(){n("search")}return(e,l)=>{const u=j,w=ye,q=pe,L=Ge,V=b,r=ae,c=ge,A=ue,ve=fe;return D(),U(ve,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[t(A,{ref_key:"formRef",ref:S,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:De(a,["enter"])},{default:o(()=>[t(c,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[t(w,{span:"24 s:12 m:7",label:"合同项目名称",path:"fuzzy","label-width":"180px"},{default:o(()=>[t(u,{clearable:"",value:i.value.fuzzy,"onUpdate:value":l[0]||(l[0]=Q=>i.value.fuzzy=Q),placeholder:"请输入合同项目名称",onClear:k,onInput:R},null,8,["value"])]),_:1}),t(w,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:o(()=>[t(q,{filterable:"",clearable:"",value:i.value.pid,"onUpdate:value":[l[1]||(l[1]=Q=>i.value.pid=Q),C],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:p.value,onScroll:M,onClear:P,onSearch:O,onBlur:y},null,8,["value","options"])]),_:1}),t(w,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[t(r,{class:"w-full"},{default:o(()=>[t(V,{type:"primary",ghost:"",onClick:a},{icon:o(()=>[t(L,{class:"text-icon"})]),default:o(()=>[m(" "+E(s(N)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function se(x){return typeof x=="function"||Object.prototype.toString.call(x)==="[object Object]"&&!Re(x)}const it=te({name:"projectmanagement_mojicb",__name:"index",setup(x){const F=Ue();Fe();const f=me(),{columns:v,columnChecks:n,data:S,getData:_,loading:i,mobilePagination:B,searchParams:p}=Ae({showTotal:!0,apiFn:Ve,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"cusname",title:"客户名称",align:"center",width:140},{key:"pro",title:"墨迹合同项目名称",align:"center",width:140},{key:"token",title:"气象信息Token",align:"center",width:200,render(a){return t("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[t("span",null,[a.token||"-"]),t(Y,{trigger:"hover"},{trigger:()=>t(b,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>d(a.token)},{default:()=>[m("复制")]}),default:()=>"复制 token"})])}},{key:"passward",title:"气象信息Passward",align:"center",width:200,render(a){return t("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[t("span",null,[a.passward||"-"]),t(b,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>d(a.passward)},{default:()=>[m("复制")]})])}},{key:"longitude",title:"经度",align:"center",width:120},{key:"latitude",title:"维度",align:"center",width:120},{key:"expiare",title:"过期时间",align:"center",width:120},{key:"status",title:"是否过期",align:"center",width:80,render:a=>a.status===null?null:t(Oe,{type:a.status==0?"success":"error"},{default:()=>[a.status==0?"正常":"过期"]})},{key:"jsonfmt",title:"JSON格式",align:"center",width:200,render(a){return t("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[t(Y,{trigger:"hover"},{trigger:()=>t("span",{style:{maxWidth:"120px",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-all",lineHeight:"18px",cursor:"pointer"}},[a.jsonfmt||"-"]),default:()=>t("span",null,[a.jsonfmt||"-"])}),t(b,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>d(a.jsonfmt)},{default:()=>[m("复制")]})])}},{key:"csvfmt",title:"CVS格式",align:"center",width:200,render(a){return t("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[t(Y,{trigger:"hover"},{trigger:()=>t("span",{style:{maxWidth:"120px",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-all",lineHeight:"18px",cursor:"pointer"}},[a.csvfmt||"-"]),default:()=>t("span",null,[a.csvfmt||"-"])}),t(b,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>d(a.csvfmt)},{default:()=>[m("复制")]})])}},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(a){return t("div",{style:"display:flex; flex-direction:column; font-size:13px; gap:3px; line-height:1.4;"},[t("div",null,[t("span",{style:"color:#666"},[m("创建人：")]),t("span",{style:"font-weight:500"},[a.username||"-"])]),t("div",null,[t("span",{style:"color:#666"},[m("时间：")]),t("span",{style:" font-weight:500"},[a.dbtime||"-"])])])}},{key:"operate",title:N("common.operate"),align:"center",width:f.userInfo.usertype==0?140:0,fixed:"right",render:a=>{let e;return t("div",{class:"flex-center gap-8px"},[f.userInfo.usertype==0&&W(t(b,{type:"primary",ghost:!0,size:"small",onClick:()=>H(a.id)},se(e=N("common.edit"))?e:{default:()=>[e]}),[[X("no-auth"),"project:moji:update"]]),f.userInfo.usertype==0&&t(oe,{onPositiveClick:()=>P(a.id)},{default:()=>N("common.confirmDelete"),trigger:()=>{let l;return W(t(b,{type:"error",ghost:!0,size:"small"},se(l=N("common.delete"))?l:{default:()=>[l]}),[[X("no-auth"),"project:moji:delete"]])}})])}}]}),d=async a=>{var e;a&&(await navigator.clipboard.writeText(a),(e=window.$message)==null||e.success("已复制"))},{drawerVisible:h,operateType:I,editingData:M,handleAdd:C,handleEdit:$,checkedRowKeys:g,onBatchDeleted:T,onDeleted:O}=Ee(S,_);async function y(){console.log(g.value),k(g.value.join(","),a=>{T()})}async function P(a){const{data:e,error:l}=await le(a);l||O()}function H(a){$(a)}async function k(a,e){const{data:l,error:u}=await le(a);if(!u)e&&e(l);else return!1}const z=a=>{_()},R=()=>{_()};return(a,e)=>{const l=ae,u=we,w=he,q=_e,L=Ie,V=fe,r=X("no-auth");return D(),Be("div",Je,[t(Ke,{model:s(p),"onUpdate:model":e[0]||(e[0]=c=>G(p)?p.value=c:null),onReset:R,onSearch:s(_)},null,8,["model","onSearch"]),t(V,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[t(l,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>e[4]||(e[4]=[$e("div",null,"气象信息列表",-1)])),_:1,__:[4]})]),"header-extra":o(()=>[t(l,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[W((D(),U(s(b),{onClick:s(C),size:"small",ghost:"",type:"primary"},{icon:o(()=>[t(u,{class:"text-icon"})]),default:o(()=>[e[5]||(e[5]=m(" "+E("新增")))]),_:1,__:[5]},8,["onClick"])),[[r,"project:moji:insert"]]),t(s(oe),{onPositiveClick:y},{trigger:o(()=>[W((D(),U(s(b),{size:"small",ghost:"",type:"error",disabled:s(g).length==0},{icon:o(()=>[t(w,{class:Me(["text-icon",{"animate-spin":s(i)}])},null,8,["class"])]),default:o(()=>[e[6]||(e[6]=m(" "+E("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[r,"project:moji:delete"]])]),default:o(()=>[e[7]||(e[7]=m(" 确定要删除选中的数据吗？ "))]),_:1,__:[7]}),t(q,{columns:s(n),"onUpdate:columns":e[1]||(e[1]=c=>G(n)?n.value=c:null),ctype:8},null,8,["columns"])]),_:1})]),default:o(()=>[t(L,{"checked-row-keys":s(g),"onUpdate:checkedRowKeys":e[2]||(e[2]=c=>G(g)?g.value=c:null),columns:s(v),data:s(S),size:"small","flex-height":!s(F).isMobile,loading:s(i),remote:"","row-key":c=>c.id,pagination:s(B),class:"sm:h-full","onUpdate:filters":z,"scroll-x":s(v).reduce((c,A)=>c+((A==null?void 0:A.width)||100),0)},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination","scroll-x"]),t(We,{visible:s(h),"onUpdate:visible":e[3]||(e[3]=c=>G(h)?h.value=c:null),onSubmitted:s(_),"operate-type":s(I),"row-data":s(M)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{it as default};
