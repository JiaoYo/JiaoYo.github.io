import{Q as ue,p as pe,_ as me,a as _e}from"./pako.esm-DBllMd1w.js";import{_ as fe}from"./export-C9VfK9dx.js";import{_ as we}from"./round-search-CaD3GWzJ.js";import{d as j,a6 as G,U as ge,o as b,e as z,O as H,e3 as he,aV as f,g as n,j as w,v as ye,ae as ve,w as s,i as l,B as L,h as N,t as I,$ as V,c as O,C as $,al as be,f as K,e4 as xe,J as ke,L as De,a1 as Pe,bT as Te,K as Ce,bU as Se,ak as Ne,M as Ie,N as $e}from"./index-CRLj9qKM.js";import{u as Me,a as Ue}from"./table-Bp5hA5Mp.js";import{e as Ae}from"./exportExcel-Bv4G4H50.js";import{u as Be,L as W}from"./echarts-Dca9Zo9G.js";import{_ as Le}from"./DatePicker-DVsMGMBi.js";import{_ as Oe}from"./FormItemGridItem-ZE1JjXv-.js";import{_ as ze}from"./Grid-kdSGXjI6.js";import{_ as qe}from"./DataTable-D0QpzO-_.js";import"./TimePicker-BsNSrnka.js";import"./Forward-D6vEiWY3.js";import"./RadioGroup-DliQv5HP.js";const Re=j({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(g){const c=g;G(()=>c.data,async r=>{q(a=>(a.xAxis.data=c.data.map(d=>d.dbtime),a.series[0].data=c.data.map(d=>d.power),a.series[1].data=c.data.map(d=>d.prePower),a))});const D=ge(),{domRef:P,updateOptions:T,updateOptionsAsync:q}=Be(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:"#6a7985",textStyle:{color:"rgb(224, 224, 224)"},valueFormatter:function(r){return(r+""!="undefined"?r:"--")+"MW"}},legend:{data:["实际功率","预测功率"]},toolbox:{show:!0,feature:{saveAsImage:{show:!0,name:"功率图表"},magicType:{show:!0,type:["line","bar"]}}},grid:{left:"2%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} MW"}},series:[{color:"#e90445",name:"实际功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new W(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.9)",shadowBlur:20},data:[],connectNulls:!0},{color:"#009688",name:"预测功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new W(0,0,0,1,[{offset:0,color:"rgba(0, 150, 136,0.3)"},{offset:1,color:"rgba(0, 150, 136,0)"}],!1),shadowColor:"rgba(0, 150, 136,0.9)",shadowBlur:20},data:[],connectNulls:!0}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function h(){await new Promise(r=>{setTimeout(r,200)}),T(r=>(r.xAxis.data=c.data.map(a=>a.dbtime),r.series[0].data=c.data.map(a=>a.power),r.series[1].data=c.data.map(a=>a.prePower),r))}function y(){T((r,a)=>{const d=a();return r.legend.data=d.legend.data,r.series[0].name=d.series[0].name,r.series[1].name=d.series[1].name,r})}async function M(){h()}return G(()=>D.locale,()=>{y()}),M(),(r,a)=>(b(),z("div",{ref_key:"domRef",ref:P,class:"h-600px overflow-hidden"},null,512))}}),Ee=H(Re,[["__scopeId","data-v-462d4bff"]]),Fe=g=>(Ie("data-v-c53fa46c"),g=g(),$e(),g),Ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ve={key:1},We=Fe(()=>K("span",null,"二维码",-1)),je=j({name:"realtimequery_powerquery",__name:"index",setup(g){const c=Date.now(),D=new Date(c).setHours(0,0,0,0),P=new Date(c).setHours(23,59,59,999),{columns:T,columnChecks:q,data:h,getData:y,loading:M,mobilePagination:r,searchParams:a,resetSearchParams:d}=Me({apiFn:he,apiParams:{page:1,pageSize:20,limit:20,startTime:f(1,D)||null,endTime:f(1,P)||null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"dbtime",title:"时间",align:"center",width:100},{key:"power",title:"实际功率(MW)",align:"center",width:140},{key:"prePower",title:"预测功率(MW)",align:"center",width:140},{key:"operate",title:"误差(MW)",align:"center",width:100,render(t){const e=t.prePower-t.power>=0?t.prePower-t.power:t.power-t.prePower;return n("span",null,[e?parseFloat(e.toFixed(6)):""])}}]}),{checkedRowKeys:x}=Ue(h,y),u=w(null),U=w(!1),J=t=>{if(t){if(u.value!==null)return;m(),u.value=window.setInterval(async()=>m(),1e3*60*3)}else u.value!==null&&(clearInterval(u.value),u.value=null),m()},Q=async()=>{p.value=="0"?await m():await y()},k=w([]),C=w(""),m=async()=>{const{data:t,error:e}=await xe({startTime:a.startTime,endTime:a.endTime});e||(k.value=t.sort((o,v)=>new Date(o.dbtime).getTime()-new Date(v.dbtime).getTime()))},R=w([D,P]);async function Z(t,e){a.startTime=f(1,e[0]),a.endTime=f(1,e[1]),p.value=="1"?y():m()}const X=t=>{t=="1"?y():m()};ye(()=>{m()});const Y=()=>{const t={dbtime:"时间",power:"实际功率",prePower:"预测功率",error:"误差"},e=[];h.value.forEach(o=>{x.value.includes(o.id)&&e.push({dbtime:o.dbtime,power:o.power,prePower:o.prePower,error:o.prePower-o.power>=0?o.prePower-o.power:o.power-o.prePower||""})}),Ae(e,t,"预测数据")},p=w("0"),A=w(!1),ee=()=>{var v,S;if(k.value.length==0)return(v=window.$message)==null?void 0:v.warning("暂无数据。请查询数据后重试。");const t={data:k.value.map(_=>({t:_.dbtime,pP:_.prePower,p:_.power})),type:0,dateTime:f(1,a.startTime)+" --- "+(U.value?f(1,new Date):f(1,a.endTime))},o=pe.gzip(JSON.stringify(t),{to:"string"}).reduce((_,B)=>_+String.fromCharCode(B),"");if(C.value=`https://dingiiot.com/powerPrediction/?${btoa(o)}`,C.value.length>2700)return(S=window.$message)==null?void 0:S.warning("二维码生成失败，请缩小查询范围后重试");console.log("地址",C.value),A.value=!0},ae=()=>{var e;const t=document.getElementById("qrcode");if(t){const o=document.createElement("a");o.href=t.toDataURL("image/png"),o.download="qrcode.png",o.click(),(e=window.$message)==null||e.success("下载成功")}else console.error("无法找到二维码 canvas 元素")},te={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()]};return ve(()=>{u.value!==null&&(clearInterval(u.value),u.value=null)}),(t,e)=>{const o=Le,v=we,S=me,_=ke,B=Oe,oe=ze,ne=De,E=Pe,F=Te,se=qe,re=fe,le=Ce,ie=Se,ce=_e,de=Ne;return b(),z("div",Ge,[n(E,{bordered:!1,size:"small"},{default:s(()=>[n(ne,{ref:"formRef",model:l(a),"label-placement":"left","show-feedback":!1},{default:s(()=>[n(oe,{"y-gap":16,responsive:"screen","item-responsive":""},{default:s(()=>[n(B,{span:"24 s:12 m:18",label:"起止时间",path:"startTime"},{default:s(()=>[n(o,{value:R.value,"onUpdate:value":e[0]||(e[0]=i=>R.value=i),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":Z,"default-time":["00:00:00","23:59:59"],shortcuts:te},null,8,["value"]),n(l(L),{type:"primary",ghost:"",onClick:Q,class:"ml-20px"},{icon:s(()=>[n(v,{class:"text-icon"})]),default:s(()=>[N(" "+I(l(V)("common.search")),1)]),_:1}),p.value=="0"?(b(),O(l(L),{key:0,type:"primary",ghost:"",onClick:ee,class:"ml-20px"},{icon:s(()=>[n(S,{class:"text-icon"})]),default:s(()=>[N(" "+I("生成二维码"))]),_:1})):$("",!0),p.value=="0"?(b(),O(_,{key:1,checked:U.value,"onUpdate:checked":[e[1]||(e[1]=i=>U.value=i),J],class:"ml-20px",title:"3分钟自动刷新"},{default:s(()=>[N(" 定时刷新 ")]),_:1},8,["checked"])):$("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(E,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:s(()=>[n(ie,{type:"card",animated:"",value:p.value,"onUpdate:value":[e[3]||(e[3]=i=>p.value=i),X],class:"h-100%","tab-style":{height:"40px"},"pane-wrapper-style":{flex:1}},{suffix:s(()=>[p.value=="1"?(b(),O(le,{key:0,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[n(l(L),{onClick:Y,size:"small",disabled:l(x).length==0},{icon:s(()=>[n(re,{class:"text-icon"})]),default:s(()=>[N(" "+I(l(V)("common.export")),1)]),_:1},8,["disabled"])]),_:1})):$("",!0),p.value=="0"?(b(),z("span",Ve,"共"+I(k.value.length)+"条数据",1)):$("",!0)]),default:s(()=>[n(F,{name:"0",tab:"图表"},{default:s(()=>[n(Ee,{data:k.value},null,8,["data"])]),_:1}),n(F,{name:"1",tab:"表格",class:"h-100%"},{default:s(()=>[n(se,{"checked-row-keys":l(x),"onUpdate:checkedRowKeys":e[2]||(e[2]=i=>be(x)?x.value=i:null),columns:l(T),data:l(h),size:"small",loading:l(M),remote:"","row-key":i=>i.id,pagination:l(h).length?l(r):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1}),n(de,{show:A.value,"onUpdate:show":e[4]||(e[4]=i=>A.value=i),title:"",preset:"card",class:"w-auto"},{header:s(()=>[K("div",null,[We,n(ce,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:ae})])]),default:s(()=>[n(ue,{id:"qrcode",style:{margin:"0 auto"},value:C.value,margin:3,size:500,level:"L"},null,8,["value"])]),_:1},8,["show"])])}}}),la=H(je,[["__scopeId","data-v-c53fa46c"]]);export{la as default};
