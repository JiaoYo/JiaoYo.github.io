import{_ as pe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BP0NONcX.js";import{_ as ue}from"./round-refresh-CEMGKb4U.js";import{_ as me}from"./round-delete-C0sdMwec.js";import{_ as de}from"./round-add-CbiPWPpG.js";import{_ as _e}from"./round-search-BkIFSzTE.js";import{d as X,n as J,p as fe,ah as ye,r as Y,q as ge,s as he,a6 as W,b as ve,o as T,c as F,w as n,g as e,h as _,t as D,i as t,ai as be,G as Z,af as ee,aj as we,K as ke,B as d,J as te,ak as Ce,ad as xe,$ as v,z as x,y as S,v as De,e as ze,A as Ne,aa as P,al as q,am as Se,an as Te,a1 as $e}from"./index-QmClEG7y.js";import{b as Ue,a as je,c as Be,d as Oe}from"./scriptoperation-z4NeUVg0.js";import{u as Ie,a as Re}from"./table-x0Q0wLac.js";import{_ as Le}from"./FormItemGridItem-Bi831RuM.js";import{_ as Me}from"./Grid-D9ukfblt.js";import{N as H}from"./Popconfirm-DT1axVu5.js";import{_ as Pe}from"./InputGroupLabel-DyILJrqm.js";import{_ as qe}from"./DataTable-BOogGWCD.js";import"./RadioGroup-BI3HroPe.js";import"./Forward-Bl4P6wDi.js";const Fe=X({__name:"add_model",props:J({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(f,{emit:$}){const y=fe(f,"visible"),b=ye({1:"Lua周期执行"}),w=$,i=f,a=Y(z());function z(){return{sname:"",stype:void 0,sdesc:"",executionCycle:3e3}}function m(){Object.assign(a,z()),i.operateType==="edit"&&i.rowData&&Object.assign(a,i.rowData)}const{formRef:V,validate:k,restoreValidation:U}=ge();he(),W(()=>i.rowData,()=>{m()}),W(y,()=>{y.value&&(m(),U())});const C=()=>{y.value=!1},j=async()=>{if(await k(),i.operateType==="add"){const{data:u,error:l}=await Ue([a]);l||(C(),w("submitted"))}else{const{data:u,error:l}=await je([a]);l||(C(),w("submitted"))}},B={sname:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},executionCycle:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]}},O=ve(()=>({add:"新增",edit:"修改"})[i.operateType]);return(u,l)=>{const N=Z,h=Le,I=ee,R=we,L=Me,s=ke,o=d,r=te,M=Ce;return T(),F(M,{show:y.value,"onUpdate:show":l[4]||(l[4]=c=>y.value=c),title:O.value,preset:"card",class:"w-50%"},{footer:n(()=>[e(r,{size:16,justify:"center"},{default:n(()=>[e(o,{onClick:C,class:"w-100px"},{default:n(()=>[_(D(u.$t("common.cancel")),1)]),_:1}),e(o,{type:"primary",class:"w-100px",onClick:j},{default:n(()=>[_(D(u.$t("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(s,{ref_key:"formRef",ref:V,model:a,rules:B,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:n(()=>[e(L,{responsive:"screen","item-responsive":""},{default:n(()=>[e(h,{span:"24 m:12",label:"脚本名称",path:"sname"},{default:n(()=>[e(N,{clearable:"",value:a.sname,"onUpdate:value":l[0]||(l[0]=c=>a.sname=c),placeholder:"请输入脚本名称",style:{width:"100%"}},null,8,["value"])]),_:1}),e(h,{span:"24 m:12",label:"脚本备注",path:"sdesc"},{default:n(()=>[e(N,{clearable:"",value:a.sdesc,"onUpdate:value":l[1]||(l[1]=c=>a.sdesc=c),placeholder:"请输入脚本备注",style:{width:"100%"}},null,8,["value"])]),_:1}),e(h,{span:"24 m:12",label:"脚本类型",path:"stype"},{default:n(()=>[e(I,{filterable:"",clearable:"",placeholder:"请选择参数项模板",value:a.stype,"onUpdate:value":l[2]||(l[2]=c=>a.stype=c),options:t(be)(t(b))},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"执行周期(ms)",path:"executionCycle"},{default:n(()=>[e(R,{clearable:"",value:a.executionCycle,"onUpdate:value":l[3]||(l[3]=c=>a.executionCycle=c),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Q(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!Se(f)}const at=X({name:"configsetting_luascriptoperation",__name:"index",setup(f){const $=xe(),y=Y({scriptTypeListOptions:[{label:"Lua周期执行",value:0}]}),{columns:K,columnChecks:b,data:w,getData:i,loading:a,mobilePagination:z,searchParams:m,resetSearchParams:V}=Ie({apiFn:Be,apiParams:{page:1,pageSize:20,limit:20,fuzzy:void 0,stype:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"sname",title:"脚本名称",align:"center",minWidth:180},{key:"sdesc",title:"脚本描述",align:"center",width:180},{key:"stype",title:"脚本类型",align:"center",width:180,render:s=>e("span",null,[s.stype==0?"条件触发执行":"Lua周期执行"])},{key:"executeCircle",title:"执行周期(ms)",align:"center",width:180},{key:"operate",title:v("common.operate"),align:"center",width:24,fixed:"right",render:s=>{let o;return e("div",{class:"flex-center gap-8px"},[x(e(d,{type:"primary",ghost:!0,size:"small",onClick:()=>R(s.id)},{default:()=>["编辑脚本函数"]}),[[S("no-auth"),"script:update"]]),x(e(d,{type:"primary",ghost:!0,size:"small",onClick:()=>I(s.id)},Q(o=v("common.edit"))?o:{default:()=>[o]}),[[S("no-auth"),"script:update"]]),x(e(H,{onPositiveClick:()=>N(s.id)},{default:()=>v("common.confirmDelete"),trigger:()=>{let r;return e(d,{type:"error",ghost:!0,size:"small"},Q(r=v("common.delete"))?r:{default:()=>[r]})}}),[[S("no-auth"),"script:delete"]])])}}]});De(()=>{});const{drawerVisible:k,operateType:U,editingData:C,handleAdd:j,handleEdit:G,checkedRowKeys:g,onBatchDeleted:B,onDeleted:O}=Re(w,i),u=()=>{i()};async function l(){console.log(g.value),h(g.value,s=>{B()})}const N=s=>{console.log(s),h([s],o=>{O()})};async function h(s,o){const r=await Oe({ids:s.join(",")});console.log("data",r),o&&o(r)}const I=s=>{G(s)},R=s=>{let o=$.resolve({path:"/scriptcode",query:{id:s}});window.open(o.href,"_blank")};function L(){m.fuzzy=void 0,u()}return(s,o)=>{const r=Pe,M=ee,c=Z,ne=_e,oe=Te,A=te,ae=de,se=me,le=ue,ie=pe,re=qe,ce=$e,E=S("no-auth");return T(),ze("div",Ke,[e(ce,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[e(A,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:n(()=>[e(oe,null,{default:n(()=>[e(r,null,{default:n(()=>[_("脚本类型")]),_:1}),e(M,{filterable:"",clearable:"",placeholder:"请选择",value:t(m).stype,"onUpdate:value":[o[0]||(o[0]=p=>t(m).stype=p),u],options:y.scriptTypeListOptions},null,8,["value","options"]),e(r,null,{default:n(()=>[_("脚本名称")]),_:1}),e(c,{clearable:"",value:t(m).fuzzy,"onUpdate:value":o[1]||(o[1]=p=>t(m).fuzzy=p),placeholder:"请输入脚本名称",onKeyup:Ne(u,["enter"]),onClear:L},null,8,["value"]),e(t(d),{type:"primary",ghost:"",onClick:t(i)},{icon:n(()=>[e(ne,{class:P(["text-icon",{"animate-spin":t(a)}])},null,8,["class"])]),default:n(()=>[_(" 搜索 ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":n(()=>[e(A,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[x((T(),F(t(d),{onClick:t(j),size:"small",ghost:"",type:"primary"},{icon:n(()=>[e(ae,{class:P(["text-icon",{"animate-spin":t(a)}])},null,8,["class"])]),default:n(()=>[_(" "+D("新增"))]),_:1},8,["onClick"])),[[E,"script:insert"]]),x((T(),F(t(H),{onPositiveClick:l},{trigger:n(()=>[e(t(d),{size:"small",ghost:"",type:"error",disabled:t(g).length==0},{icon:n(()=>[e(se,{class:"text-icon"})]),default:n(()=>[_(" "+D(t(v)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:n(()=>[_(" "+D(t(v)("common.confirmDelete")),1)]),_:1})),[[E,"script:delete"]]),e(t(d),{onClick:t(i),size:"small",ghost:"",type:"primary"},{icon:n(()=>[e(le,{class:P(["text-icon",{"animate-spin":t(a)}])},null,8,["class"])]),_:1},8,["onClick"]),e(ie,{columns:t(b),"onUpdate:columns":o[2]||(o[2]=p=>q(b)?b.value=p:null)},null,8,["columns"])]),_:1})]),default:n(()=>[e(re,{"checked-row-keys":t(g),"onUpdate:checkedRowKeys":o[3]||(o[3]=p=>q(g)?g.value=p:null),columns:t(K),data:t(w),size:"small",loading:t(a),remote:"","row-key":p=>p.id,pagination:t(z)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Fe,{visible:t(k),"onUpdate:visible":o[4]||(o[4]=p=>q(k)?k.value=p:null),onSubmitted:t(i),"operate-type":t(U),"row-data":t(C)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{at as default};
