import{Q as me,p as _e,_ as fe,a as we}from"./pako.esm-B6WlPTAo.js";import{_ as ge}from"./export-CaKIU9TN.js";import{_ as he}from"./round-search-xJGr_dvE.js";import{d as V,a5 as G,T as ve,j as p,v as W,ad as K,o as b,e as R,M as J,d$ as ye,aT as w,g as o,w as s,i,B as z,h as C,t as S,$ as H,c as O,C as I,ak as be,f as Q,e0 as xe,H as ke,J as De,a0 as Te,bR as Pe,I as Ce,bS as Se,aj as Ie,K as Ne,L as $e}from"./index-F0x4z3rt.js";import{u as Le,a as Me}from"./table-DRNLrwJT.js";import{e as Ae}from"./exportExcel-Bv4G4H50.js";import{u as Be,L as j}from"./echarts-D4d6ITWc.js";import{_ as Ue}from"./DatePicker-CcupM2ZM.js";import{_ as ze}from"./FormItemGridItem-DvyzlfdR.js";import{_ as Oe}from"./Grid-B9eaEnpq.js";import{_ as Re}from"./DataTable-B8y0NXpM.js";import"./TimePicker-Df-uEABL.js";import"./Forward-DSwERy6a.js";import"./RadioGroup-CuVFnOLQ.js";const qe=V({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(g){const u=g;G(()=>u.data,async a=>{h(l=>(l.xAxis.data=u.data.map(r=>r.dbtime),l.series[0].data=u.data.map(r=>r.power),l.series[1].data=u.data.map(r=>r.prePower),l))});const D=ve(),m=p(null),{domRef:N,updateOptions:$,updateOptionsAsync:h}=Be(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:"#6a7985",textStyle:{color:"rgb(224, 224, 224)"},valueFormatter:function(a){return(a+""!="undefined"?a:"--")+"MW"}},legend:{data:["实际功率","预测功率"]},toolbox:{show:!0,feature:{saveAsImage:{show:!0,name:"功率图表"},magicType:{show:!0,type:["line","bar"]}}},grid:{left:"2%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} MW"}},series:[{color:"#e90445",name:"实际功率",type:"bar",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new j(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.9)",shadowBlur:20},data:[],connectNulls:!0},{color:"#009688",name:"预测功率",type:"bar",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new j(0,0,0,1,[{offset:0,color:"rgba(0, 150, 136,0.3)"},{offset:1,color:"rgba(0, 150, 136,0)"}],!1),shadowColor:"rgba(0, 150, 136,0.9)",shadowBlur:20},data:[],connectNulls:!0}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function x(){await new Promise(a=>{setTimeout(a,1e3)}),$(a=>(a.xAxis.data=u.data.map(l=>l.dbtime),a.series[0].data=u.data.map(l=>l.power),a.series[1].data=u.data.map(l=>l.prePower),a))}function L(){$((a,l)=>{const r=l();return a.legend.data=r.legend.data,a.series[0].name=r.series[0].name,a.series[1].name=r.series[1].name,a})}async function M(){x()}return G(()=>D.locale,()=>{L()}),M(),W(()=>{m.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),K(()=>{m.value!==null&&(clearInterval(m.value),m.value=null)}),(a,l)=>(b(),R("div",{ref_key:"domRef",ref:N,class:"h-600px overflow-hidden"},null,512))}}),Ee=J(qe,[["__scopeId","data-v-57ba2432"]]),Fe=g=>(Ne("data-v-520abc5f"),g=g(),$e(),g),Ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},He={key:1},je=Fe(()=>Q("span",null,"二维码",-1)),Ve=V({name:"realtimequery_powerquery",__name:"index",setup(g){const u=Date.now(),D=new Date(u).setHours(0,0,0,0),m=new Date(u).setHours(23,59,59,999),{columns:N,columnChecks:$,data:h,getData:x,loading:L,mobilePagination:M,searchParams:a,resetSearchParams:l}=Le({apiFn:ye,apiParams:{page:1,pageSize:20,limit:20,startTime:w(1,D)||null,endTime:w(1,m)||null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"dbtime",title:"时间",align:"center",width:100},{key:"power",title:"实际功率(MW)",align:"center",width:140},{key:"prePower",title:"预测功率(MW)",align:"center",width:140},{key:"operate",title:"误差(MW)",align:"center",width:100,render(t){const e=t.prePower-t.power>=0?t.prePower-t.power:t.power-t.prePower;return o("span",null,[e?parseFloat(e.toFixed(6)):""])}}]}),{checkedRowKeys:r}=Me(h,x),d=p(null),A=p(!1),Z=t=>{if(t){if(d.value!==null)return;v(),d.value=window.setInterval(async()=>v(),1e3*60*3)}else d.value!==null&&(clearInterval(d.value),d.value=null),v()},X=async()=>{_.value=="0"?await v():await x()},k=p([]),T=p(""),v=async()=>{const{data:t,error:e}=await xe({startTime:a.startTime,endTime:a.endTime});e||(k.value=t.sort((n,y)=>new Date(n.dbtime).getTime()-new Date(y.dbtime).getTime()))},q=p([D,m]);async function Y(t,e){a.startTime=w(1,e[0]),a.endTime=w(1,e[1])}const ee=t=>{t=="1"?x():v()};W(()=>{v()});const ae=()=>{const t={dbtime:"时间",power:"实际功率",prePower:"预测功率",error:"误差"},e=[];h.value.forEach(n=>{r.value.includes(n.id)&&e.push({dbtime:n.dbtime,power:n.power,prePower:n.prePower,error:n.prePower-n.power>=0?n.prePower-n.power:n.power-n.prePower||""})}),Ae(e,t,"预测数据")},_=p("0"),B=p(!1),te=()=>{var y,P;if(k.value.length==0)return(y=window.$message)==null?void 0:y.warning("暂无数据。请查询数据后重试。");const t={data:k.value.map(f=>({t:f.dbtime,pP:f.prePower,p:f.power})),type:0,dateTime:w(1,a.startTime)+" --- "+(A.value?w(1,new Date):w(1,a.endTime))},n=_e.gzip(JSON.stringify(t),{to:"string"}).reduce((f,U)=>f+String.fromCharCode(U),"");if(T.value=`https://dingiiot.com/powerPrediction/?${btoa(n)}`,T.value.length>2700)return(P=window.$message)==null?void 0:P.warning("二维码生成失败，请缩小查询范围后重试");console.log("地址",T.value),B.value=!0},ne=()=>{var e;const t=document.getElementById("qrcode");if(t){const n=document.createElement("a");n.href=t.toDataURL("image/png"),n.download="qrcode.png",n.click(),(e=window.$message)==null||e.success("下载成功")}else console.error("无法找到二维码 canvas 元素")},oe={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()]};return K(()=>{d.value!==null&&(clearInterval(d.value),d.value=null)}),(t,e)=>{const n=Ue,y=he,P=fe,f=ke,U=ze,se=Oe,re=De,E=Te,F=Pe,le=Re,ie=ge,ce=Ce,ue=Se,de=we,pe=Ie;return b(),R("div",Ge,[o(E,{bordered:!1,size:"small"},{default:s(()=>[o(re,{ref:"formRef",model:i(a),"label-placement":"left","show-feedback":!1},{default:s(()=>[o(se,{"y-gap":16,responsive:"screen","item-responsive":""},{default:s(()=>[o(U,{span:"24 s:12 m:18",label:"起止时间",path:"startTime"},{default:s(()=>[o(n,{value:q.value,"onUpdate:value":e[0]||(e[0]=c=>q.value=c),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":Y,shortcuts:oe},null,8,["value"]),o(i(z),{type:"primary",ghost:"",onClick:X,class:"ml-20px"},{icon:s(()=>[o(y,{class:"text-icon"})]),default:s(()=>[C(" "+S(i(H)("common.search")),1)]),_:1}),_.value=="0"?(b(),O(i(z),{key:0,type:"primary",ghost:"",onClick:te,class:"ml-20px"},{icon:s(()=>[o(P,{class:"text-icon"})]),default:s(()=>[C(" "+S("生成二维码"))]),_:1})):I("",!0),_.value=="0"?(b(),O(f,{key:1,checked:A.value,"onUpdate:checked":[e[1]||(e[1]=c=>A.value=c),Z],class:"ml-20px",title:"3分钟自动刷新"},{default:s(()=>[C(" 定时刷新 ")]),_:1},8,["checked"])):I("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(E,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:s(()=>[o(ue,{type:"card",animated:"",value:_.value,"onUpdate:value":[e[3]||(e[3]=c=>_.value=c),ee],class:"h-100%","tab-style":{height:"40px"},"pane-wrapper-style":{flex:1}},{suffix:s(()=>[_.value=="1"?(b(),O(ce,{key:0,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[o(i(z),{onClick:ae,size:"small",disabled:i(r).length==0},{icon:s(()=>[o(ie,{class:"text-icon"})]),default:s(()=>[C(" "+S(i(H)("common.export")),1)]),_:1},8,["disabled"])]),_:1})):I("",!0),_.value=="0"?(b(),R("span",He,"共"+S(k.value.length)+"条数据",1)):I("",!0)]),default:s(()=>[o(F,{name:"0",tab:"图表"},{default:s(()=>[o(Ee,{data:k.value},null,8,["data"])]),_:1}),o(F,{name:"1",tab:"表格",class:"h-100%"},{default:s(()=>[o(le,{"checked-row-keys":i(r),"onUpdate:checkedRowKeys":e[2]||(e[2]=c=>be(r)?r.value=c:null),columns:i(N),data:i(h),size:"small",loading:i(L),remote:"","row-key":c=>c.id,pagination:i(h).length?i(M):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1}),o(pe,{show:B.value,"onUpdate:show":e[4]||(e[4]=c=>B.value=c),title:"",preset:"card",class:"w-auto"},{header:s(()=>[Q("div",null,[je,o(de,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:ne})])]),default:s(()=>[o(me,{id:"qrcode",style:{margin:"0 auto"},value:T.value,margin:3,size:500,level:"L"},null,8,["value"])]),_:1},8,["show"])])}}}),la=J(Ve,[["__scopeId","data-v-520abc5f"]]);export{la as default};
