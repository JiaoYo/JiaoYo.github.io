import{_ as he}from"./round-search-SxIJJabH.js";import{d as ne,Q as me,H as C,a as J,aC as re,i as ie,dP as pe,b as N,o as $,e as l,s as V,f as v,B as ve,w as E,g as x,U as ue,V as de,t as O,cK as we,aU as ke,a3 as _e,aP as fe,M as se,aE as xe,aG as Fe,c as U,aM as ae,aK as oe,a0 as ge,a1 as Me,eA as Te,aS as De,b2 as ce,eB as $e,eC as Ce,aX as Ee,h as B,aH as Ae,y as Se,N as Oe,aD as je,$ as Be,Z as Ne,eD as Pe,aO as ze,b4 as Ie,aY as Re}from"./index-ByRkKuMU.js";import{u as Ue}from"./usePageData-DJSm323_.js";import{N as te}from"./RadioButton-BD4h6eqN.js";import{_ as le}from"./DatePicker-BLn_ayNU.js";const Ve={class:"map-wrapper",style:{height:"100%",position:"relative"}},Le={class:"map-legend"},We={class:"legend-header"},Ye={class:"legend-actions"},Xe={class:"legend-list"},qe=["onClick","onContextmenu"],He={key:0,class:"visibility-icon"},Ke={key:1,class:"solo-icon"},Ze={class:"legend-name"},Ge={class:"visibility-toggle"},Je={key:0,class:"solo-notice"},Qe=ne({__name:"historyMap",props:{trackData:{}},setup(P){const I=me(),u=C(null);let k=null;const j=P,D=C([]),m=["#FF6B9D","#6BCF7F","#4A90E2","#FFD166","#7B68EE","#00D4AA","#FF8C42","#BA68C8","#4ECDC4","#FFA726","#42B883","#FF5252","#536DFE","#00E5FF","#69F0AE","#FF4081","#18FFFF","#B388FF","#76FF03","#FF9100","#EA80FC","#84FFFF","#CCFF90","#FF9E80","#80D8FF","#FFFF8D","#A7FFEB","#FF80AB","#8C9EFF","#B9F6CA"],b=C({}),M=C(""),d=J(()=>{const n={};return Object.keys(D.value).forEach((t,e)=>{n[t]=m[e%m.length],b.value[t]===void 0&&(b.value[t]=!0)}),n});function z(n){if(M.value){L(n);return}b.value[n]=!b.value[n],y()}function L(n){M.value===n?R():(M.value=n,Object.keys(b.value).forEach(s=>{b.value[s]=s===n}),y())}function R(){M.value="",Object.keys(b.value).forEach(n=>{b.value[n]=!0}),y()}function W(){Object.keys(b.value).forEach(n=>{b.value[n]=!b.value[n]}),M.value="",y()}function X(){Object.keys(b.value).forEach(n=>{b.value[n]=!0}),M.value="",y()}function q(){Object.keys(b.value).forEach(n=>{b.value[n]=!1}),M.value="",y()}const T=J(()=>{const n=[];return Object.values(D.value).forEach(s=>{n.push(...s)}),n.sort((s,t)=>new Date(s.dbtime).getTime()-new Date(t.dbtime).getTime())}),K=J(()=>{if(T.value.length===0)return[120.370086,30.305716];const n=T.value.map(a=>a.longitude),s=T.value.map(a=>a.latitude),t=(Math.min(...n)+Math.max(...n))/2,e=(Math.min(...s)+Math.max(...s))/2;return console.log(t,e),[t,e]});async function Z(){const n="/map-sdk.json",{data:s}=await fe.get(`${n}?_t=${Date.now()}`);return s}function Q(n){return new Promise((s,t)=>{if(window.AMap)return s(window.AMap);const e=document.createElement("script");e.src=`https://webapi.amap.com/maps?v=2.0&key=${n}&plugin=AMap.PolylineEditor`,e.defer=!0,e.onload=()=>window.AMap?s(window.AMap):t(new Error("AMapåŠ è½½å¤±è´¥")),e.onerror=()=>t(new Error("AMapè„šæœ¬åŠ è½½é”™è¯¯")),document.head.appendChild(e)})}const g=C({});function f(n,s){const t=s.lng-n.lng,e=s.lat-n.lat;return(Math.atan2(-e,t)*180/Math.PI-90+360)%360-175}function _(n,s,t,e){const a=document.createElement("div");return a.style.cssText=`
    width: 12px;
    height: 18px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 18px solid ${e};
    transform: translate(-50%, -50%) rotate(${t}deg);
    transform-origin: center center;
  `,new n.Marker({position:[s.lng,s.lat],content:a,offset:new n.Pixel(0,0)})}function w(n,s,t,e,a){const c=document.createElement("div");return c.className="custom-marker",c.style.transform="translate(calc(-50% + 4px),-120%)",c.innerHTML=`
    <div class="avatar-wrapper" style="border-color: ${e};box-shadow: 0 0 5px ${e}, 0 0 6px ${e};">
      <img src="${a||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"}" class="marker-avatar" />
    </div>
    <div class="marker-name" style="color: ${e};">${t}</div>
  `,new n.Marker({position:[s.lng,s.lat],content:c})}function o(){u.value&&u.value.clearMap(),g.value={}}function y(){!window.AMap||!u.value||Object.keys(g.value).forEach(n=>{const s=b.value[n];(g.value[n]||[]).forEach(e=>{s?e.show():e.hide()})})}function A(n){if(!u.value)return;o();const s={};Object.entries(D.value).forEach(([e,a])=>{s[e]=a.map(c=>({lng:c.longitude,lat:c.latitude,address:c.address,dbtime:c.dbtime,proname:c.proname||"æœªæŒ‡å®šé¡¹ç›®",duration:c.duration||0,userimage:c.userimage,longitude:c.longitude,latitude:c.latitude}))}),Object.keys(s).forEach(e=>{const a=s[e],c=d.value[e];if(a.length===0)return;const h=[];if(a.length>1){const i=new n.Polyline({path:a.map(F=>[F.lng,F.lat]),strokeColor:c,strokeWeight:4,strokeOpacity:.7,strokeStyle:"solid",lineJoin:"round",lineCap:"round",isOutline:!0,outlineColor:"#FFFFFF",borderWeight:2});i.setMap(u.value),h.push(i)}a.forEach((i,F)=>{new n.Marker({position:[i.longitude,i.latitude],content:'<div class="marker-dot"></div>',anchor:"center",offset:new n.Pixel(0,0)}).setMap(u.value);const p=w(n,i,e,c,a[0].userimage);p.setMap(u.value),h.push(p),p.on("click",()=>{const S=`
          <div style="min-width:220px; background:#fff; padding:12px 14px; font-size:13px; color:#333; line-height:1.6">
            <div style="font-weight:bold; color:${c}; font-size:15px; margin-bottom:6px; border-bottom:1px solid #f0f0f0; padding-bottom:4px">
              ${e}
            </div>
            <div><b style="color:#555">åœ°ç‚¹ï¼š</b>${i.address}</div>
            <div><b style="color:#555">æ—¶é—´ï¼š</b>${i.dbtime}</div>
            <div><b style="color:#555">é¡¹ç›®ï¼š</b>${i.proname}</div>
            <div><b style="color:#555">ç»çº¬åº¦ï¼š</b><span style="font-size:12px;color:#666">${i.longitude}, ${i.latitude}</span></div>

          </div>
          <div style="margin-top:8px; text-align:right; font-size:12px; color:#999">ç¬¬ ${F+1} ä¸ªæ‰“å¡ç‚¹</div>
        `;k.setContent(S),k.setOffset(new n.Pixel(4,-60)),k.open(u.value,p.getPosition())}),p.on("dblclick",()=>{k.open(u.value,p.getPosition()),u.value.setCenter(p.getPosition()),u.value.setZoom(14)})});for(let i=1;i<a.length;i++){const F=a[i-1],r=a[i];if(ee(F,r))continue;const p={lng:(F.lng+r.lng)/2,lat:(F.lat+r.lat)/2},S=f(F,r),G=_(n,p,S,c);G.isArrow=!0,G.setMap(u.value),h.push(G)}Object.keys(s).length==1&&u.value.setFitView(h,!1,[60,60,60,60]),g.value[e]=h});const t=()=>{const a=u.value.getZoom()>=7,c=Y(g.value,b.value);Object.values(c).forEach(h=>{h==null||h.forEach(i=>{i.isArrow&&(a?i.show():i.hide())})})};u.value.on("zoomend",t),t(),Object.keys(g.value).forEach(e=>{(g.value[e]||[]).forEach(c=>{c.isArrow||(b.value[e]?c.show():c.hide())})})}function Y(n,s){const t={};for(const e in n)s[e]&&(t[e]=n[e]);return t}function ee(n,s,t=1e-7){return Math.abs(n.lng-s.lng)<t&&Math.abs(n.lat-s.lat)<t}async function H(){try{const n=await Z(),s=await Q(n.AMAP_SDK_KEY);u.value=new s.Map("amap-container",{viewMode:"2D",center:K.value,zoom:5,features:["bg","point"]}),I.themeScheme==="dark"&&u.value.setMapStyle("amap://styles/dark"),s.plugin(["AMap.Scale","AMap.ToolBar"],()=>{u.value.addControl(new s.Scale),u.value.addControl(new s.ToolBar)}),u.value.on("zoomend",()=>{const e=u.value.getZoom()>=12,a=Y(g.value,b.value);Object.values(a).forEach(c=>{c.forEach(h=>{h.isArrow&&(e?h.show():h.hide())})})}),k=new s.InfoWindow({anchor:"bottom-center",closeWhenClickMap:!0}),A(s)}catch(n){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",n)}}return re(()=>j.trackData??[],n=>{console.log(n,"så¤„ç†æ•°æ®æˆ–æ¸²æŸ“å†…å®¹"),D.value=n,window.AMap&&u.value&&A(window.AMap)},{immediate:!0,deep:!0}),ie(()=>{H()}),pe(()=>{u.value&&u.value.destroy()}),(n,s)=>{const t=ve;return $(),N("div",Ve,[s[4]||(s[4]=l("div",{id:"amap-container",style:{width:"100%",height:"100%","border-radius":"8px"}},null,-1)),l("div",Le,[l("div",We,[s[3]||(s[3]=l("div",{class:"legend-title"},"äººå‘˜è½¨è¿¹",-1)),l("div",Ye,[v(t,{type:"primary",onClick:X},{default:E(()=>s[0]||(s[0]=[x("å…¨æ˜¾")])),_:1,__:[0]}),v(t,{type:"primary",onClick:q},{default:E(()=>s[1]||(s[1]=[x("å…¨éš")])),_:1,__:[1]}),v(t,{type:"primary",onClick:W},{default:E(()=>s[2]||(s[2]=[x("åé€‰")])),_:1,__:[2]})])]),l("div",Xe,[($(!0),N(ue,null,de(d.value,(e,a)=>($(),N("div",{key:a,class:ke(["legend-item",{"legend-item-hidden":!b.value[a],"legend-item-solo":M.value===a}]),onClick:c=>z(a),onContextmenu:we(c=>L(a),["prevent"])},[l("div",{class:"legend-color",style:_e({backgroundColor:e})},[b.value[a]?V("",!0):($(),N("span",He,"ğŸ‘ï¸â€ğŸ—¨ï¸")),M.value===a?($(),N("span",Ke,"â­")):V("",!0)],4),l("span",Ze,O(a),1),l("span",Ge,O(b.value[a]?"éšè—":"æ˜¾ç¤º"),1)],42,qe))),128))]),M.value?($(),N("div",Je,[x(" ä»…æ˜¾ç¤º: "+O(M.value)+" ",1),l("button",{class:"cancel-solo-btn",onClick:R},"å–æ¶ˆ")])):V("",!0)])])}}}),et=se(Qe,[["__scopeId","data-v-21c4c99e"]]),tt={class:"map-wrapper",style:{height:"100%",position:"relative"}},at=ne({__name:"map",props:{trackData:{},username:{},projectName:{}},setup(P){const I=me(),u=C(null);let k=null;const j=P,m=C([{id:25,pid:10,longitude:120.367925,latitude:30.300161,address:"æµ™æ±Ÿçœæ­å·å¸‚é’±å¡˜åŒºç™½æ¨è¡—é“ç•™å­¦ç”Ÿåˆ›ä¸š",dbtime:"2025-10-28 22:38:57",username:"auditor",daytime:"2025-10-28"},{id:25,pid:10,ctype:2,longitude:120.373554,latitude:30.288942,address:"ä¸‰èŠ±-é“è·¯åœè½¦ä½",dbtime:"2025-10-28 22:38:57",username:"auditor",daytime:"2025-10-28"},{id:26,pid:10,longitude:120.358237,latitude:30.278233,duration:0,ctype:2,address:"æµ™æ±Ÿçœæ­å·å¸‚é’±å¡˜åŒºèœé¸Ÿç½‘ç»œ",dbtime:"2025-10-30 22:39:12",username:"auditor",daytime:"2025-10-30"},{id:26,pid:10,longitude:120.362971,latitude:30.285184,duration:0,ctype:2,address:"æµ™æ±Ÿçœæ­å·å¸‚é’±å¡˜åŒºèœé¸Ÿç½‘ç»œ",dbtime:"2025-10-30 22:39:12",username:"auditor",daytime:"2025-10-30"},{id:26,pid:10,longitude:120.361513,latitude:30.309509,duration:0,address:"æµ™æ±Ÿçœæ­å·å¸‚é’±å¡˜åŒºèœé¸Ÿç½‘ç»œasdasda",dbtime:"2025-10-30 22:39:12",username:"auditor",daytime:"2025-10-30"}]),b=["#FFA726","#6BCF7F"],M=J(()=>{if(m.value.length===0)return[120.370086,30.305716];const g=m.value.map(o=>o.longitude),f=m.value.map(o=>o.latitude),_=(Math.min(...g)+Math.max(...g))/2,w=(Math.min(...f)+Math.max(...f))/2;return console.log(_,w),[_,w]});async function d(){const g="/map-sdk.json",{data:f}=await fe.get(`${g}?_t=${Date.now()}`);return f}function z(g){return new Promise((f,_)=>{if(window.AMap)return f(window.AMap);const w=document.createElement("script");w.src=`https://webapi.amap.com/maps?v=2.0&key=${g}&plugin=AMap.PolylineEditor`,w.defer=!0,w.onload=()=>window.AMap?f(window.AMap):_(new Error("AMapåŠ è½½å¤±è´¥")),w.onerror=()=>_(new Error("AMapè„šæœ¬åŠ è½½é”™è¯¯")),document.head.appendChild(w)})}const L=C({});function R(g,f,_,w,o){const y=document.createElement("div");return y.className="custom-marker",y.style.transform="translate(calc(-50% + 4px), -110%)",y.innerHTML=`
    <div class="avatar-wrapper" style="border-color: ${w}; box-shadow: 0 0 10px ${w}, 0 0 20px ${w};">
      <img src="${o||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"}" class="marker-avatar" />
    </div>
    <div class="marker-name" style="color: ${w};">${_}</div>
  `,new g.Marker({position:[f.lng,f.lat],content:y})}function W(g,f,_,w,o){const y=document.createElement("div");return y.className="custom-marker",y.style.transform="translateX(-50%)",y.innerHTML=`
    <div class="marker-dot"></div>
  `,new g.Marker({position:[f.lng,f.lat],content:y})}function X(){u.value&&u.value.clearMap(),L.value={}}function q(g){X();const f=m.value.map(o=>({lng:o.longitude,lat:o.latitude,address:o.address,dbtime:o.dbtime,proname:o.proname||"æœªæŒ‡å®šé¡¹ç›®",duration:o.duration||0,userimage:o.userimage,longitude:o.longitude,latitude:o.latitude,ctype:o.ctype||1})),_=b[0],w=[];if(f.length>1){const o=new g.Polyline({path:f.map(y=>[y.lng,y.lat]),strokeColor:_,strokeWeight:3,strokeOpacity:.7,strokeStyle:"solid",lineJoin:"round",lineCap:"round",isOutline:!0,outlineColor:"#FFFFFF",borderWeight:2});o.setMap(u.value),w.push(o)}f.forEach(o=>{let y;o.ctype!=2?(y=R(g,o,j.username,_,f[0].userimage),new g.Marker({position:[o.longitude,o.latitude],content:'<div class="marker-dot"></div>',anchor:"center",offset:new g.Pixel(0,0)}).setMap(u.value)):y=W(g,o,j.username,_,f[0].userimage),y.setMap(u.value),w.push(y),y.on("click",()=>{const A=`
        <div style="min-width:220px; background:#fff; padding:12px 14px; font-size:13px;">
          <div style="font-weight:bold; color:${_}; font-size:15px; margin-bottom:6px;">
            ${j.username}
          </div>
          <div><b>åœ°ç‚¹ï¼š</b>${o.address}</div>
          <div><b>æ—¶é—´ï¼š</b>${o.dbtime}</div>
          <div><b>é¡¹ç›®ï¼š</b>${j.projectName||"æœªæŒ‡å®šé¡¹ç›®"}</div>
          <div><b>ç±»å‹ï¼š</b>${o.ctype==0?"ä¸Šç­æ‰“å¡":o.ctype==1?"ä¸‹ç­æ‰“å¡":"ç³»ç»Ÿä¸ŠæŠ¥"}</div>
          <div><b>ç»çº¬åº¦ï¼š</b>${o.longitude}, ${o.latitude}</div>
          ${o.duration?`<div><b>å·¥æ—¶ï¼š</b>${o.duration} å°æ—¶</div>`:""}
        </div>
      `;k.setContent(A),k.setOffset(new g.Pixel(4,-60)),k.open(u.value,y.getPosition())})});for(let o=1;o<f.length;o++){const y=f[o-1],A=f[o];if(Z(y,A))continue;const Y={lng:(y.lng+A.lng)/2,lat:(y.lat+A.lat)/2},ee=T(y,A),H=K(g,Y,ee,"#1890ff");H.setMap(u.value),w.push(H)}u.value.setFitView(w,!1,[60,60,60,60]),L.value.single=w}function T(g,f){const _=f.lng-g.lng,w=f.lat-g.lat;return(Math.atan2(-w,_)*180/Math.PI-90+360)%360-175}function K(g,f,_,w){const o=document.createElement("div");o.style.cssText=`
    position: relative;
    width: 60px;
    height: 24px;
    display: flex;
    align-items: center;
    transform: translate(-50%, -50%) rotate(${_-90}deg);
    transform-origin: center center;
  `;for(let A=0;A<3;A++){const Y=document.createElement("div");Y.style.cssText=`
      position: absolute;
      width: 0;
      height: 0;
      border-top: 8px solid transparent;
      border-bottom: 8px solid transparent;
      border-left: 12px solid ${w};
      opacity: ${.3+A*.2};
      left: ${A*8}px;
      transition: all 0.3s ease;
      animation: arrowFlow 1.5s infinite;
      animation-delay: ${A*.2}s;
    `,o.appendChild(Y)}const y=document.createElement("style");return y.textContent=`
    @keyframes arrowFlow {
      0% {
        opacity: 0.3;
        transform: translateX(0px) scale(1);
      }
      50% {
        opacity: 1;
        transform: translateX(4px) scale(1.1);
      }
      100% {
        opacity: 0.3;
        transform: translateX(0px) scale(1);
      }
    }
    
    @keyframes arrowMove {
      0% {
        transform: translateX(-10px);
        opacity: 0;
      }
      50% {
        transform: translateX(0px);
        opacity: 1;
      }
      100% {
        transform: translateX(10px);
        opacity: 0;
      }
    }
  `,document.head.appendChild(y),new g.Marker({position:[f.lng,f.lat],content:o,offset:new g.Pixel(0,0)})}function Z(g,f,_=1e-7){return Math.abs(g.lng-f.lng)<_&&Math.abs(g.lat-f.lat)<_}async function Q(){try{const g=await d(),f=await z(g.AMAP_SDK_KEY);u.value=new f.Map("amap-container",{viewMode:"2D",zoom:15,center:M.value,features:["bg","point"]}),I.themeScheme==="dark"&&u.value.setMapStyle("amap://styles/dark"),f.plugin(["AMap.Scale","AMap.ToolBar"],()=>{u.value.addControl(new f.Scale),u.value.addControl(new f.ToolBar)}),k=new f.InfoWindow({anchor:"bottom-center",closeWhenClickMap:!0}),q(f)}catch(g){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",g)}}return ie(()=>{m.value=j.trackData??[],Q()}),pe(()=>{u.value&&u.value.destroy()}),(g,f)=>($(),N("div",tt,f[0]||(f[0]=[l("div",{id:"amap-container",style:{width:"100%",height:"100%","border-radius":"8px"}},null,-1)])))}}),nt=se(at,[["__scopeId","data-v-f0455cb9"]]),st={class:"p-1 border-b border-gray-100 last:border-b-0 font-size-16px"},lt={class:"flex mb-3 items-center"},ot={class:"flex-col justify-center items-center mr-20px"},rt=["src"],it={class:"font-bold mt-10px text-[#000] calendarName"},ut={class:"flex mb-1"},dt={class:"c-#4169e1 font-bold"},ct={class:"flex mb-1"},mt={class:"mr-20px"},pt={class:"c-#4169e1 font-bold"},vt={class:"c-#4169e1 font-bold"},ft={class:"flex mb-1"},gt={class:"c-#4169e1 font-bold"},yt={class:"flex mb-1"},bt={class:"c-#4169e1 font-bold"},ht={class:"mx-20px flex items-center"},wt={class:"flex items-center"},kt={class:"flex mb-1"},_t={key:0},xt={class:"fontC"},Ft={class:"fontC"},Mt={class:"fontC"},Tt={class:"fontC"},Dt=ne({__name:"calendarModal",props:xe({lookdetail:{},creater:{}},{dialogVisible:{type:Boolean,default:!1},dialogVisibleModifiers:{}}),emits:["update:dialogVisible"],setup(P){const I=Fe(P,"dialogVisible"),u=P,k=C({pid:0,address:"",startTime:void 0,endTime:void 0,duration:0,status:0,dailyReport:0,username:"",daytime:"",projectName:"",userImage:"",ctype:0}),j=C([]),D=async()=>{const{data:M,error:d}=await Te({startTime:u.lookdetail.startTime||u.lookdetail.daytime+" 00:00:00",endTime:u.lookdetail.endTime||u.lookdetail.daytime+" 23:59:59",pid:u.lookdetail.pid,creater:u.creater});M&&(j.value=M)};re(()=>I.value,async M=>{M&&(Object.assign(k.value,u.lookdetail),b.value="table",j.value=[],D())});const m=()=>{I.value=!1,setTimeout(()=>{k.value={pid:0,address:"",startTime:void 0,endTime:void 0,duration:0,status:0,dailyReport:0,username:"",daytime:"",projectName:"",userImage:"",ctype:0}},200)},b=C("table");return(M,d)=>{const z=ae,L=ae,R=te,W=oe,X=ge,q=Me;return $(),U(q,{show:I.value,"onUpdate:show":d[1]||(d[1]=T=>I.value=T),class:"w-1000px",preset:"card",onClose:m,"modal-animation-name":"el-fade"},{header:E(()=>d[2]||(d[2]=[x(" è¯¦æƒ… ")])),default:E(()=>[l("div",st,[l("div",lt,[l("div",ot,[l("img",{class:"w-60px h-60px rounded-full shadow-sm",src:k.value.userImage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"},null,8,rt),l("div",it,O(k.value.username),1)]),l("div",null,[l("div",ut,[d[3]||(d[3]=l("span",{class:"mr-2"}," ğŸ—ï¸ é¡¹ç›®åç§°ï¼š ",-1)),l("span",dt,O(k.value.projectName||"æš‚æ— é¡¹ç›®"),1)]),l("div",ct,[l("div",mt,[d[4]||(d[4]=l("span",null,"ğŸ“… ä¸Šç­æ‰“å¡æ—¶é—´ï¼š",-1)),l("span",pt,O(k.value.startTime||"æ— "),1)]),l("div",null,[d[5]||(d[5]=l("span",null,"ğŸ“… ä¸‹ç­æ‰“å¡æ—¶é—´ï¼š",-1)),l("span",vt,O(k.value.endTime||"æ— "),1)])]),l("div",ft,[d[6]||(d[6]=l("span",{style:{"white-space":"nowrap"}},"ğŸ“ åœ°å€ï¼š",-1)),l("span",gt,O(k.value.address),1)]),l("div",yt,[l("div",null,[d[7]||(d[7]=l("span",null,"â³ å·¥æ—¶ï¼š",-1)),l("span",bt,O(k.value.duration||0)+"å°æ—¶",1)]),l("div",ht,[d[10]||(d[10]=l("span",null,"ğŸ”” æ‰“å¡çŠ¶æ€ï¼š",-1)),l("span",null,[k.value.status==1?($(),U(z,{key:0,type:"error",size:"small"},{default:E(()=>d[8]||(d[8]=[l("span",{class:"mr-1"},null,-1),x("å¼‚å¸¸ ")])),_:1,__:[8]})):V("",!0),k.value.status==0?($(),U(z,{key:1,type:"success",size:"small"},{default:E(()=>d[9]||(d[9]=[l("span",{class:"mr-1"},null,-1),x("æ­£å¸¸ ")])),_:1,__:[9]})):V("",!0)])]),l("div",wt,[d[11]||(d[11]=l("span",null,"ğŸ“ æ—¥æŠ¥ï¼š",-1)),l("span",null,[v(L,{size:"small",type:k.value.dailyReport==1?"success":"error"},{default:E(()=>[x(O(k.value.dailyReport==1?"å·²æäº¤":"æœªæäº¤"),1)]),_:1},8,["type"])])])])])]),l("div",kt,[d[12]||(d[12]=l("div",{class:"mr-15px"},"å†å²è½¨è¿¹",-1)),v(W,{size:"small",value:b.value,"onUpdate:value":d[0]||(d[0]=T=>b.value=T),name:"radiobuttongroup1"},{default:E(()=>[v(R,{value:"table",label:"è¡¨æ ¼"}),v(R,{value:"map",label:"åœ°å›¾"})]),_:1},8,["value"])]),b.value=="table"?($(),N("div",_t,[v(X,{style:{height:"600px"},trigger:"hover"},{default:E(()=>[($(!0),N(ue,null,de(j.value,T=>($(),N("div",{class:"tableItem",key:T.id},[l("div",null,[d[13]||(d[13]=x("æ‰“å¡ç±»å‹ï¼š")),l("span",xt,O(T.ctype==0?"ä¸Šç­æ‰“å¡":T.ctype==1?"ä¸‹ç­æ‰“å¡":"ç³»ç»Ÿä¸ŠæŠ¥"),1)]),l("div",null,[d[14]||(d[14]=x("æ‰“å¡çŠ¶æ€ï¼š")),v(z,{type:T.status==1?"error":"success"},{default:E(()=>[l("div",null,O(T.status==0?"æ­£å¸¸":"å¼‚å¸¸"),1)]),_:2},1032,["type"])]),l("div",null,[d[15]||(d[15]=x("åœ°å€ï¼š ")),l("span",Ft,O(T.address),1)]),l("div",null,[d[16]||(d[16]=x("æ‰“å¡æ—¶é—´ï¼š")),l("span",Mt,O(T.dbtime),1)]),l("div",null,[d[17]||(d[17]=x("æ‰“å¡è¯¯å·®å€¼ï¼š")),l("span",Tt,O(T.distanse?T.distanse.toFixed(2)+"ç±³":"æ— "),1)])]))),128))]),_:1})])):V("",!0),b.value=="map"?($(),U(nt,{key:1,trackData:j.value,projectName:k.value.projectName,username:u.lookdetail.username,class:"map"},null,8,["trackData","projectName","username"])):V("",!0)])]),_:1},8,["show"])}}}),$t=se(Dt,[["__scopeId","data-v-6daae54a"]]),Ct={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Et(P){return typeof P=="function"||Object.prototype.toString.call(P)==="[object Object]"&&!Re(P)}const At=ne({name:"reportmanagement_calendar",__name:"index",setup(P){const I=De();function u(t){return t.getFullYear()}function k(t){const e=new Date(t.getFullYear(),0,1),a=(t.getTime()-e.getTime())/864e5,c=e.getDay()||7;return Math.ceil((a+c)/7)}function j(){const t=new Date,e=u(t),a=k(t).toString().padStart(2,"0");return`${e}-${a}å‘¨`}const D=C("week"),m=C({dayTime:String(ce(0,null)),monthTime:String(ce(3,null)),weekTime:j(),startTime:null,endTime:null,dates:null,creater:null}),b=C([{label:"æ—¥",value:"day"},{label:"å‘¨",value:"week"},{label:"æœˆ",value:"month"}]),M=C("table"),d=C({}),z=C({}),L=J(()=>Object.keys(d.value||{}).map(t=>{var e,a;return{key:t,name:t,userimage:(a=(e=d.value[t])==null?void 0:e[0])==null?void 0:a.userimage}})),R=J(()=>{const t=[{title:"ç”¨æˆ·å",key:"name",width:120,align:"center",fixed:"left",render(a){return v("div",{class:"text-blue-600 flex-col items-center font-medium"},[v(Ee,{width:"60",height:"60","preview-disabled":!0,src:a.userimage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png",class:"rounded-md object-cover"},null),v("span",null,[a.name])])}}];let e=[];switch(D.value){case"week":m.value.startTime&&m.value.endTime&&(e=Ce(m.value.startTime,m.value.endTime).map(c=>W(c)));break;case"month":m.value.monthTime&&(e=$e(m.value.monthTime).map(c=>W(c)));break;case"day":default:m.value.dayTime&&(e=[W(m.value.dayTime)]);break}return[...t,...e]}),W=t=>({title:X(t),key:t,width:340,align:"center",render:e=>q(e.name,t)}),X=t=>{const e=new Date(t),a=e.getMonth()+1,c=e.getDate(),h=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()];return`${a}/${c} å‘¨${h}`},q=(t,e)=>{let a;const h=(d.value[t]||[]).filter(r=>r.daytime===e);if(h.length===0)return v("div",{class:"text-gray-400 text-sm"},[x("æ— è®°å½•")]);console.log(h,"dayRecords");const i=h.every(r=>r.dailyReport==1),F=h.every(r=>r.status==0);return v("div",{class:"text-left space-y-1"},[v("div",{class:"flex justify-between px-8px"},[v("div",null,[x("æ‰“å¡çŠ¶æ€ï¼š"),v(ae,{size:"small",type:F?"success":"error"},{default:()=>[F?"æ­£å¸¸":"å¼‚å¸¸"]})]),v(ae,{size:"small",type:i?"success":"error"},{default:()=>[i?"æ—¥æŠ¥å·²æäº¤":"æ—¥æŠ¥æœªæäº¤"]})]),v(ge,{style:"max-height: 250px;",trigger:"none"},Et(a=h.map((r,p)=>v("div",{key:p,class:"tableItem p-1 border-b border-gray-100 last:border-b-0",onClick:()=>Q(r,t)},[v("div",null,[x("è°ƒè¯•äººï¼š"),v("span",null,[r==null?void 0:r.username])]),v("div",null,[x("é¡¹ç›®åç§°ï¼š "),v("span",null,[(r==null?void 0:r.projectName)||"æš‚æ— é¡¹ç›®"]),x(" ")]),v("div",null,[x("ä¸Šç­æ‰“å¡æ—¶é—´ï¼š"),v("span",null,[r.startTime?r.startTime:"æ— "])]),v("div",null,[x("ä¸‹ç­æ‰“å¡æ—¶é—´ï¼š"),v("span",null,[r.endTime||"æ— "])]),v("div",null,[x("å·¥æ—¶ï¼š"),v("span",null,[(r==null?void 0:r.duration)||0,x("å°æ—¶")])]),v("div",null,[x("åœ°å€ï¼š"),v("span",null,[r==null?void 0:r.address])]),v("div",null,[x("ä¸Šç­æ‰“å¡è¯¯å·®å€¼ï¼š"),v("span",null,[r.nowdistanse?r.nowdistanse.toFixed(2)+"ç±³":"æ— "])]),v("div",null,[x("ä¸‹ç­æ‰“å¡è¯¯å·®å€¼ï¼š"),v("span",null,[r.nextdistanse?r.nextdistanse.toFixed(2)+"ç±³":"æ— "])])])))?a:{default:()=>[a]})])},T=C(!1),K=C(),Z=C(),Q=async(t,e)=>{Z.value=t,K.value=y.data.find(a=>a.username==e).id,T.value=!0},g=t=>{const e=t.match(/^(\d{4})-(\d{1,2})å‘¨$/);if(!e)return null;const a=Number(e[1]),c=Number(e[2]),h=new Date(a,0,1+(c-1)*7),i=h.getDay(),F=new Date(h);i<=4?F.setDate(h.getDate()-h.getDay()+1):F.setDate(h.getDate()+8-h.getDay());const r=new Date(F);r.setDate(F.getDate()+6);const p=S=>{const G=S.getFullYear(),ye=String(S.getMonth()+1).padStart(2,"0"),be=String(S.getDate()).padStart(2,"0");return`${G}-${ye}-${be}`};return{start:p(F),end:p(r)}},f=t=>{d.value={},D.value=t,w()},_=t=>{w(t),o()},w=t=>{switch(D.value){case"week":if(t){const e=g(t);e&&(m.value.startTime=e.start,m.value.endTime=e.end)}break;case"month":m.value.dates=t||m.value.monthTime;break;case"day":default:m.value.dates=t||m.value.dayTime;break}},o=async()=>{var t;try{const e={};m.value.creater&&(e.creater=m.value.creater),D.value==="week"?(e.startTime=m.value.startTime+" 00:00:00",e.endTime=m.value.endTime+" 23:59:59"):D.value==="month"?e.dates=m.value.monthTime:e.dates=m.value.dayTime;const{data:a,error:c}=await Pe(e);if(!c){if(JSON.stringify(a)=="{}")return d.value={},z.value={},(t=window.$message)==null?void 0:t.warning("æ— æ•°æ®");d.value=s(a),z.value=a}}catch(e){console.error("æœç´¢è€ƒå‹¤æŠ¥è¡¨å¤±è´¥:",e)}},{pageData:y,getData:A,nextPage:Y}=Ue(Ie),ee=async t=>{const e=t.currentTarget,a=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&y.data.length<y.total&&(await Y(),await ze(),setTimeout(()=>{e.scrollTop=a}))},H=C(1),n=async t=>{m.value.creater=t,t||setTimeout(()=>{H.value++},500),o()};re([D,()=>m.value.dates],()=>{if(D.value=="week"&&m.value.weekTime){const t=g(m.value.weekTime);t&&(m.value.startTime=t.start,m.value.endTime=t.end),o()}else(D.value=="month"&&m.value.monthTime||D.value=="day"&&m.value.dayTime)&&o()},{immediate:!0}),ie(()=>{m.value.weekTime=j(),A({usertypes:"2,3"}),o()});const s=t=>{const e={};for(const a in t){const c=new Map;t[a].forEach(r=>{const p=`${r.pid}_${r.ctype}_${r.dbtime}_${r.daytime}_${r.address}`;c.has(p)||c.set(p,r)});const i=Array.from(c.values()).sort((r,p)=>r.daytime===p.daytime?r.dbtime.localeCompare(p.dbtime):r.daytime.localeCompare(p.daytime)),F=[];for(let r=0;r<i.length;r++){const p=i[r],S=i[r+1];p.ctype===0&&S&&S.ctype===1&&p.daytime===S.daytime?(F.push({address:p.address,startTime:p.dbtime,endTime:S.dbtime,status:S.status==1||p.status==1?1:S.status,duration:S.duration||0,dailyReport:S.dailyReport,username:p.username,daytime:p.daytime,projectName:p.proname,userImage:p.userimage,ctype:S.ctype,pid:p.pid,nowdistanse:p.distanse,nextdistanse:S.distanse}),r++):F.push({address:p.address,startTime:p.ctype===0?p.dbtime:"",endTime:p.ctype===1?p.dbtime:"",duration:p.duration||0,status:p.status,dailyReport:p.dailyReport,username:p.username,daytime:p.daytime,projectName:p.proname,userImage:p.userimage,ctype:p.ctype,pid:p.pid,nowdistanse:p.distanse})}e[a]=F}return e};return(t,e)=>{const a=je,c=Oe,h=he;return $(),N("div",Ct,[v(B(Ne),{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper h-full"},{header:E(()=>[v(B(Se),{align:"center"},{default:E(()=>[e[7]||(e[7]=l("div",{class:"font-semibold"},"è€ƒå‹¤æŠ¥è¡¨",-1)),v(c,{label:"ç”¨æˆ·",path:"creater","label-placement":"left","show-feedback":!1},{default:E(()=>[v(a,{clearable:"",filterable:"",value:m.value.creater,"onUpdate:value":[e[0]||(e[0]=i=>m.value.creater=i),n],placeholder:"è¯·é€‰æ‹©","label-field":"username",size:"small","value-field":"id",options:B(y).data,onScroll:ee},null,8,["value","options"])]),_:1}),v(B(oe),{value:D.value,"onUpdate:value":[e[1]||(e[1]=i=>D.value=i),f],size:"small"},{default:E(()=>[($(!0),N(ue,null,de(b.value,i=>($(),U(B(te),{key:i.value,value:i.value,label:i.label},null,8,["value","label"]))),128))]),_:1},8,["value"]),D.value==="day"?($(),U(B(le),{key:0,size:"small","formatted-value":m.value.dayTime,"onUpdate:formattedValue":[e[2]||(e[2]=i=>m.value.dayTime=i),_],type:"date","value-format":"yyyy-MM-dd",style:{width:"140px"}},null,8,["formatted-value"])):V("",!0),D.value==="week"?($(),U(B(le),{key:1,size:"small","formatted-value":m.value.weekTime,"onUpdate:formattedValue":[e[3]||(e[3]=i=>m.value.weekTime=i),_],type:"week",style:{width:"140px"}},null,8,["formatted-value"])):V("",!0),D.value==="month"?($(),U(B(le),{key:2,size:"small","formatted-value":m.value.monthTime,"onUpdate:formattedValue":[e[4]||(e[4]=i=>m.value.monthTime=i),_],type:"month","value-format":"yyyy-MM",style:{width:"140px"}},null,8,["formatted-value"])):V("",!0),v(B(ve),{type:"primary",onClick:o,size:"small",class:"w-full sm:w-auto"},{icon:E(()=>[v(h,{class:"text-icon"})]),default:E(()=>[x(" "+O(B(Be)("common.search")),1)]),_:1}),v(B(oe),{size:"small",value:M.value,"onUpdate:value":e[5]||(e[5]=i=>M.value=i),name:"radiobuttongroup1"},{default:E(()=>[v(B(te),{value:"table",label:"è¡¨æ ¼"}),v(B(te),{value:"map",label:"åœ°å›¾"})]),_:1},8,["value"])]),_:1,__:[7]})]),default:E(()=>[v($t,{"dialog-visible":T.value,"onUpdate:dialogVisible":e[6]||(e[6]=i=>T.value=i),lookdetail:Z.value,creater:K.value},null,8,["dialog-visible","lookdetail","creater"]),M.value=="table"?($(),U(B(Ae),{key:0,"bottom-bordered":"",bordered:"",columns:R.value,data:L.value,size:"small","flex-height":!B(I).isMobile,"scroll-x":R.value.reduce((i,F)=>i+F.width,0),remote:"","row-key":i=>i.key,class:"h-full",striped:""},null,8,["columns","data","flex-height","scroll-x","row-key"])):($(),U(et,{trackData:z.value,key:H.value},null,8,["trackData"]))]),_:1})])}}}),Pt=se(At,[["__scopeId","data-v-029ca3c7"]]);export{Pt as default};
