import{_ as Xe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-EHNO_Faz.js";import{_ as et}from"./round-delete-De_Adgrb.js";import{_ as tt}from"./round-add-Ceubgvwo.js";import{d as ze,aE as je,m as Ne,r as at,H as K,n as Pe,a as lt,aG as Ie,aC as $e,c as F,o as m,w as t,f as e,a0 as nt,C as Re,s as T,h as o,aD as te,v as H,b as A,g as r,e as w,t as c,aI as st,B as S,aJ as ot,y as Ue,$ as W,a1 as Le,b4 as ut,aO as pe,cr as rt,cp as it,cs as Ee,ct as dt,cu as qe,aQ as pt,cv as Oe,cw as ct,P as He,O as Me,bY as ft,A as mt,Z as Ve,aS as gt,i as vt,q as J,aT as xe,aH as yt,x as O,aU as bt,aK as _t,aM as ie,cx as Be,cy as ht,aY as kt}from"./index-ByRkKuMU.js";import{u as wt,a as Ct}from"./table-VoODD8Rc.js";import{u as ce}from"./usePageData-DJSm323_.js";import{_ as Ge}from"./Grid-CFg9gfMA.js";import{_ as Je}from"./FormItemGridItem-BCpPvk0p.js";import{_ as Dt}from"./DatePicker-BLn_ayNU.js";import{_ as xt}from"./round-search-SxIJJabH.js";import{_ as Tt}from"./round-refresh-_Q7iiaNa.js";import{_ as Ft,a as St}from"./DescriptionsItem-Bm7yzakQ.js";import{N as de}from"./Popconfirm-BARyXAms.js";import{N as jt}from"./RadioButton-BD4h6eqN.js";const zt={key:0,style:{"margin-left":"20px"}},Nt={key:0,style:{"margin-left":"20px"}},Ut={key:0,style:{"margin-left":"20px"}},qt={key:0,style:{"margin-left":"20px"}},Bt=ze({name:"OperateDrawer",__name:"operate-drawer",props:je({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:je(["submitted"],["update:visible"]),setup(R,{emit:fe}){const j=fe,D=Ne(),y=R,l=at(M());function M(){return{pid:void 0,id:"",debugname:"",docker:void 0,dockcharge:"",dockcontact:"",status:0,notes:"",debugresult:0,dtype:void 0,starttime:null,endtime:null,dbcreater:void 0,startAndTimeRange:void 0,eqmid:void 0,re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const{pageData:L,getData:f,nextPage:q}=ce(ut),$=async()=>{await f({usertypes:"2,3"})},Y=async u=>{const a=u.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&L.data.length<L.total&&(await q(),await pe(),setTimeout(()=>{a.scrollTop=d}))},{pageData:b,getData:Q,nextPage:me}=ce(rt),ge=async u=>{const a=u.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&b.data.length<b.total&&(await me(),b.data=b.data.map(x=>({...x,value:x.docker+"&id="+x.id})),await pe(),setTimeout(()=>{a.scrollTop=d}))},ve=async()=>{await Q({pid:l.pid}),b.data=b.data.map(u=>({...u,value:u.docker+"&id="+u.id}))},ae=async u=>{var a;if(l.docker=u,l.docker){const[d,x]=(a=l.docker)==null?void 0:a.split("&id="),k=b.data.find(G=>G.docker==d&&G.id==x);k?(l.dockcharge=k.pname,l.dockcontact=k.pcontact):(l.dockcharge="",l.dockcontact="")}},{pageData:z,getData:ye,nextPage:le}=ce(it),be=async u=>{const a=u.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&z.data.length<z.total&&(await le(),await pe(),setTimeout(()=>{a.scrollTop=d}))},_e=async()=>{await ye()},E=K([]),{pageData:g,getData:_,nextPage:P}=ce(Ee),I=async u=>{const a=u.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&g.data.length<g.total&&(await P(),E.value=g.data,await pe(),setTimeout(()=>{a.scrollTop=d}))},ne=async()=>{await _({fuzzy:D.userInfo.pname,page:1}),E.value=g.data},he=async()=>{await _({page:1}),E.value=g.data},se=async u=>{l.pid=u,oe()},{pageData:ke,getData:we,nextPage:p}=ce(dt),Z=async u=>{const a=u.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&z.data.length<z.total&&(await p(),await pe(),setTimeout(()=>{a.scrollTop=d}))},oe=async()=>{await we({pid:l.pid})},n=K(void 0);async function s(){ne(),_e(),$(),Object.assign(l,M()),y.operateType==="add"&&(l.pid=Number(y.pid)),y.operateType==="edit"&&y.rowData&&(Object.assign(l,y.rowData),n.value=l.status,y.rowData.starttime&&y.rowData.endtime?l.startAndTimeRange=[qe(y.rowData.starttime),qe(y.rowData.endtime)]:l.startAndTimeRange=null),ve(),l.pid&&oe()}const{formRef:B,validate:V,restoreValidation:X}=Pe(),Te={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},eqmid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dbcreater:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"},debugname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcharge:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"}},Fe=lt(()=>({add:"新增待调试业务",edit:"修改待调试业务"})[y.operateType]),ee=Ie(R,"visible");$e(ee,()=>{ee.value&&(s(),setTimeout(()=>{const u=document.querySelector(".n-scrollbar-content");u==null||u.scrollTo(0,0)},300),X())});const C=K(0),N=K("");async function h({file:u},a){C.value=0,N.value=a;const d=await pt(u.file,u.name,"",x=>{C.value=x});d&&(l[a]=d,C.value=0)}function Ce(){ee.value=!1}async function ue(u){if(u)try{const d=await(await fetch(u==null?void 0:u.split("?")[0],{mode:"cors"})).blob(),x=URL.createObjectURL(d),k=document.createElement("a");k.href=x,k.download=u==null?void 0:u.split("?")[1],k.style.display="none",document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(x)}catch(a){console.error("下载失败:",a)}}async function De(){var u;await V(),(u=window.$dialog)==null||u.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await v()}})}async function v(){var u,a,d,x;if(await V(),y.operateType==="edit"){const k=JSON.parse(JSON.stringify(l));n.value==k.status&&delete k.status,k.docker=(u=k.docker)==null?void 0:u.split("&id=")[0];const{data:G,error:Se}=await Oe([k]);Se||(Ce(),j("submitted"),(a=window.$message)==null||a.success("修改成功"))}else{const{data:k,error:G}=await ct([{...l,docker:(d=l.docker)==null?void 0:d.split("&id=")[0]}]);G||(Ce(),j("submitted"),(x=window.$message)==null||x.success("添加成功"))}}async function re(u){var a;return u.file.file.size>100*1024*1024?((a=window.$message)==null||a.error("文件大小不能超过100M"),!1):!0}const Ke=u=>{var a;l.debugname=(a=z.data.find(d=>d.id==u))==null?void 0:a.tname,l.dtype=u};async function We(u,a){l.startAndTimeRange=u,l.starttime=u==null?void 0:u[0],l.endtime=u==null?void 0:u[1]}return(u,a)=>{const d=Je,x=st,k=ot,G=Ge,Se=Re,Ye=nt,Qe=Ue,Ze=Le;return m(),F(Ze,{show:ee.value,"onUpdate:show":a[23]||(a[23]=i=>ee.value=i),title:Fe.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:t(()=>[e(Qe,{justify:"end",size:16},{default:t(()=>[e(o(S),{onClick:Ce},{default:t(()=>[r(c(o(W)("common.cancel")),1)]),_:1}),e(o(S),{type:"primary",onClick:De},{default:t(()=>[r(c(o(W)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(Ye,{class:"pr-20px"},{default:t(()=>[e(Se,{ref_key:"formRef",ref:B,model:l,rules:Te,"label-placement":"left","label-width":120},{default:t(()=>[e(G,{responsive:"screen","item-responsive":""},{default:t(()=>[e(d,{span:"24 m:12",label:"项目列表",path:"pid"},{default:t(()=>[e(o(te),{filterable:"",clearable:"",value:l.pid,"onUpdate:value":[a[0]||(a[0]=i=>l.pid=i),se],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:he,options:E.value,onScroll:I},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"权重",path:"dtype"},{default:t(()=>[e(o(te),{filterable:"",value:l.dtype,"onUpdate:value":[a[1]||(a[1]=i=>l.dtype=i),Ke],tag:"",placeholder:"请选择权重","label-field":"tname","value-field":"id",options:o(z).data,onScroll:be},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"业务名称",path:"debugname"},{default:t(()=>[e(o(H),{value:l.debugname,"onUpdate:value":a[2]||(a[2]=i=>l.debugname=i),placeholder:"请输入"},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"调试人",path:"dbcreater"},{default:t(()=>[e(o(te),{filterable:"",value:l.dbcreater,"onUpdate:value":a[3]||(a[3]=i=>l.dbcreater=i),placeholder:"请选择调试人","label-field":"username","value-field":"id",options:o(L).data,onScroll:Y},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"待调试设备",path:"eqmid"},{default:t(()=>[e(o(te),{filterable:"",clearable:"",value:l.eqmid,"onUpdate:value":a[4]||(a[4]=i=>l.eqmid=i),placeholder:"请选择待调试设备","label-field":"devname","value-field":"id",options:o(ke).data,onScroll:Z},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"对接方",path:"docker"},{default:t(()=>[e(o(te),{filterable:"",value:l.docker,"onUpdate:value":[a[5]||(a[5]=i=>l.docker=i),ae],clearable:"",tag:"",placeholder:"请选择或输入对接方","label-field":"docker","value-field":"value",options:o(b).data,onScroll:ge},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"对接方负责人",path:"dockcharge"},{default:t(()=>[e(o(H),{value:l.dockcharge,"onUpdate:value":a[6]||(a[6]=i=>l.dockcharge=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"联系方式",path:"dockcontact"},{default:t(()=>[e(o(H),{value:l.dockcontact,"onUpdate:value":a[7]||(a[7]=i=>l.dockcontact=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),y.operateType=="edit"?(m(),F(d,{key:0,span:"24 m:12",label:"状态",path:"status"},{default:t(()=>[e(o(te),{clearable:"",value:l.status,"onUpdate:value":a[8]||(a[8]=i=>l.status=i),placeholder:"请选择",options:o(D).userInfo.usertype==0||o(D).userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}]},null,8,["value","options"])]),_:1})):T("",!0),e(d,{span:"24 m:24",label:"起止时间",path:"startAndTimeRange"},{default:t(()=>[e(o(Dt),{clearable:"",value:l.startAndTimeRange,"onUpdate:value":a[9]||(a[9]=i=>l.startAndTimeRange=i),type:"daterange","value-format":"yyyy-MM-dd",style:{width:"100%"},"onUpdate:formattedValue":We},null,8,["value"])]),_:1}),e(d,{span:"24 m:24",label:"备注",path:"notes"},{default:t(()=>[e(o(H),{value:l.notes,"onUpdate:value":a[10]||(a[10]=i=>l.notes=i),placeholder:"请输入"},null,8,["value"])]),_:1}),e(d,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:t(()=>[e(G,{responsive:"screen","item-responsive":""},{default:t(()=>[e(d,{span:"24 m:12",label:"附件1",path:"notes"},{default:t(()=>[e(o(H),{value:l.re1,"onUpdate:value":a[11]||(a[11]=i=>l.re1=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl1?(m(),A("span",zt,[r(c((i=l.fl1)==null?void 0:i.split("?")[1])+" ",1),w("span",{class:"cursor-pointer c-#c92a2a",onClick:a[12]||(a[12]=U=>l.fl1="")},"删除"),w("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[13]||(a[13]=U=>ue(l.fl1))},"下载")])):(m(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":U=>h(U,"fl1"),"show-file-list":!1,onBeforeUpload:re},{default:t(()=>[e(o(S),{loading:C.value>0&&!l.fl1&&N.value=="fl1",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(c(C.value>0&&!l.fl1&&N.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),C.value&&!l.fl1&&N.value=="fl1"?(m(),F(k,{key:2,type:"line",percentage:C.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1})]),_:1})]),_:1}),e(d,{span:"24 m:12",label:"附件2",path:"notes"},{default:t(()=>[e(o(H),{value:l.re2,"onUpdate:value":a[14]||(a[14]=i=>l.re2=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl2?(m(),A("span",Nt,[r(c((i=l.fl2)==null?void 0:i.split("?")[1])+" ",1),w("span",{class:"cursor-pointer c-#c92a2a",onClick:a[15]||(a[15]=U=>l.fl2="")},"删除"),w("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[16]||(a[16]=U=>ue(l.fl2))},"下载")])):(m(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":U=>h(U,"fl2"),"show-file-list":!1,onBeforeUpload:re},{default:t(()=>[e(o(S),{loading:C.value>0&&!l.fl2&&N.value=="fl2",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(c(C.value>0&&!l.fl2&&N.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),C.value&&!l.fl2&&N.value=="fl2"?(m(),F(k,{key:2,type:"line",percentage:C.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1}),e(d,{span:"24 m:12",label:"附件3",path:"notes"},{default:t(()=>[e(o(H),{value:l.re3,"onUpdate:value":a[17]||(a[17]=i=>l.re3=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl3?(m(),A("span",Ut,[r(c((i=l.fl3)==null?void 0:i.split("?")[1])+" ",1),w("span",{class:"cursor-pointer c-#c92a2a",onClick:a[18]||(a[18]=U=>l.fl3="")},"删除"),w("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[19]||(a[19]=U=>ue(l.fl3))},"下载")])):(m(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":U=>h(U,"fl3"),"show-file-list":!1,onBeforeUpload:re},{default:t(()=>[e(o(S),{loading:C.value>0&&!l.fl3&&N.value=="fl3",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(c(C.value>0&&!l.fl3&&N.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),C.value&&!l.fl3&&N.value=="fl3"?(m(),F(k,{key:2,type:"line",percentage:C.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1}),e(d,{span:"24 m:12",label:"附件4",path:"notes"},{default:t(()=>[e(o(H),{value:l.re4,"onUpdate:value":a[20]||(a[20]=i=>l.re4=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl4?(m(),A("span",qt,[r(c((i=l.fl4)==null?void 0:i.split("?")[1])+" ",1),w("span",{class:"cursor-pointer c-#c92a2a",onClick:a[21]||(a[21]=U=>l.fl4="")},"删除"),w("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[22]||(a[22]=U=>ue(l.fl4))},"下载")])):(m(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":U=>h(U,"fl4"),"show-file-list":!1,onBeforeUpload:re},{default:t(()=>[e(o(S),{loading:C.value>0&&!l.fl4&&N.value=="fl4",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(c(C.value>0&&!l.fl4&&N.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),C.value&&!l.fl4&&N.value=="fl4"?(m(),F(k,{key:2,type:"line",percentage:C.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),At=ze({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:je(["reset","search","search1","clear"],["update:model"]),setup(R,{emit:fe}){const j=He(),D=Me(),y=fe,l=Ne(),{formRef:M,restoreValidation:L}=Pe(),f=Ie(R,"model"),q=K([]),{pageData:$,getData:Y,nextPage:b}=ce(Ee),Q=async g=>{const _=g.currentTarget,P=_.scrollTop;_.scrollTop+_.offsetHeight>=_.scrollHeight&&$.data.length<$.total&&(await b(),q.value=$.data,await pe(),setTimeout(()=>{_.scrollTop=P}))},me=async g=>{var _;g?(f.value.pid=g,y("search1"),l.setProjectInfo({pname:(_=q.value.find(P=>P.id==g))==null?void 0:_.proname,pid:g})):y("clear")},ge=ft.debounce(async g=>{await Y({fuzzy:g,page:1}),q.value=$.data},300),ve=g=>{if(!g){f.value.pid=null,ae();return}ge(g)},ae=async()=>{await Y({page:1}),q.value=$.data,y("search1")},z=async g=>{f.value.status=g,y("search1")},ye=async()=>{f.value.status=null},le=async()=>{var g,_;await Y({fuzzy:D.query.pname?D.query.pname:l.userInfo.pname}),q.value=$.data,f.value.pid=D.query.prjId?Number(D.query.prjId):l.userInfo.pid?l.userInfo.pid:(g=q.value[0])==null?void 0:g.id,f.value.fuzzy=D.query.debugname?D.query.debugname:"",l.setProjectInfo({pid:f.value.pid,pname:(_=q.value.find(P=>P.id==f.value.pid))==null?void 0:_.proname}),y("search"),setTimeout(()=>{j.replace({path:D.path,query:{}})},1e3)};le();async function be(){await L(),f.value.fuzzy="",f.value.pid=null,f.value.status=null,y("reset")}const _e=()=>{f.value.fuzzy="",y("search")};async function E(){y("search")}return $e(()=>D.query,g=>{g.pname&&le()}),(g,_)=>{const P=te,I=Je,ne=H,he=Tt,se=S,ke=xt,we=Ue,p=Ge,Z=Re,oe=Ve;return m(),F(oe,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(Z,{ref_key:"formRef",ref:M,model:f.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:mt(E,["enter"])},{default:t(()=>[e(p,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(I,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:t(()=>[e(P,{filterable:"",clearable:"",value:f.value.pid,"onUpdate:value":[_[0]||(_[0]=n=>f.value.pid=n),me],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:ae,onSearch:ve,options:q.value,onScroll:Q},null,8,["value","options"])]),_:1}),e(I,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:t(()=>[e(P,{clearable:"",filterable:"",value:f.value.status,"onUpdate:value":[_[1]||(_[1]=n=>f.value.status=n),z],placeholder:"请选择状态",onClear:ye,options:[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]},null,8,["value"])]),_:1}),e(I,{span:"24 s:12 m:6",label:"业务名称",path:"fuzzy"},{default:t(()=>[e(ne,{value:f.value.fuzzy,"onUpdate:value":_[2]||(_[2]=n=>f.value.fuzzy=n),placeholder:"请输入",clearable:"",onClear:_e},null,8,["value"])]),_:1}),e(I,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(we,{class:"w-full"},{default:t(()=>[e(se,{onClick:be},{icon:t(()=>[e(he,{class:"text-icon"})]),default:t(()=>[r(" "+c(o(W)("common.reset")),1)]),_:1}),e(se,{type:"primary",ghost:"",onClick:E},{icon:t(()=>[e(ke,{class:"text-icon"})]),default:t(()=>[r(" "+c(o(W)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Pt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},It={key:0},$t={key:1},Rt={key:0},Lt={key:1},Et={key:0},Ot={key:1},Ht={key:0},Mt={key:1};function Ae(R){return typeof R=="function"||Object.prototype.toString.call(R)==="[object Object]"&&!kt(R)}const sa=ze({name:"projectmanagement_business",__name:"index",setup(R){const fe=gt(),j=Ne(),D=Me(),y=He(),{columns:l,columnChecks:M,data:L,getData:f,loading:q,pagination:$,mobilePagination:Y,searchParams:b}=wt({showTotal:!0,immediate:!1,apiFn:ht,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",status:null,dbcreater:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"debugname",title:"业务名称",align:"center",width:160},{key:"proname",title:"所属项目",align:"center",width:160,render(n){return e("span",{class:"cursor-pointer",onClick:()=>be(n)},[n.proname])}},{key:"status",title:"状态",align:"center",width:100,render(n){return e(ie,{color:{color:n.status==-1?"rgba(251, 146, 60, 0.15)":n.status==0?"rgba(156, 163, 175, 0.15)":n.status==1?"rgba(59, 130, 246, 0.15)":n.status==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:n.status==-1?"#FB923C":n.status==0?"#9CA3AF":n.status==1?"#3B82F6":n.status==2?"#FACC15":"#10B981",borderColor:n.status==-1?"#FB923C":n.status==0?"#9CA3AF":n.status==1?"#3B82F6":n.status==2?"#FACC15":"#10B981"}},{default:()=>[n.status==-1?"申请中":n.status==0?"待调试":n.status==1?"开始调试":n.status==2?"待审核":"审核完成"]})}},{key:"eqmname",title:"调试设备",align:"center",width:150},{key:"docker",title:"对接信息",align:"left",width:180,render:n=>e("div",{style:"line-height: 1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("对接方：")]),e("span",{style:"font-weight:500"},[n.docker||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("负责人：")]),e("span",{style:"font-weight:500"},[n.dockcharge||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("联系方式：")]),e("span",{style:"font-weight:500"},[n.dockcontact||"-"])])])},{key:"dbusername",title:"调试信息",align:"left",width:200,render(n){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("调试人：")]),e("span",{style:"font-weight:500"},[n.dbusername||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("工时：")]),e("span",{style:"color:#1890ff; font-weight:500"},[n.duration||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("开始：")]),e("span",null,[n.dbdbtime||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("结束：")]),e("span",null,[n.dedbtime||"-"])])])}},{key:"ckusername",title:"审核信息",align:"left",width:200,render(n){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("审核人：")]),e("span",{style:"font-weight:500"},[n.ckusername||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("时间：")]),e("span",{style:" font-weight:500"},[n.ckdbtime||"-"])])])}},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(n){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("创建人：")]),e("span",{style:"font-weight:500"},[n.username||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("时间：")]),e("span",{style:" font-weight:500"},[n.dbtime||"-"])])])}},{key:"operate",title:W("common.operate"),align:"center",width:280,fixed:"right",render:n=>{let s;return e("div",{class:"flex-center gap-8px"},[n.status==-1&&(j.userInfo.usertype==0||j.userInfo.usertype==2)&&e(de,{onPositiveClick:()=>g(n,0)},{default:()=>"确定通过申请吗？",trigger:()=>O(e(S,{type:"warning",ghost:!0,size:"small"},{default:()=>["通过申请"]}),[[J("no-auth"),"project:Debug:update"]])}),n.status==0&&n.dbcreater==j.userInfo.id&&e(de,{onPositiveClick:()=>g(n,1)},{default:()=>"确定开始调试吗？",trigger:()=>O(e(S,{type:"success",ghost:!0,size:"small"},{default:()=>["开始"]}),[[J("no-auth"),"project:Debug:update"]])}),n.status==1&&n.dbcreater==j.userInfo.id&&e(de,{onPositiveClick:()=>g(n,2)},{default:()=>"确定完成调试？",trigger:()=>O(e(S,{type:"success",ghost:!0,size:"small"},{default:()=>["完成"]}),[[J("no-auth"),"project:Debug:update"]])}),n.status==2&&(j.userInfo.usertype==0||j.userInfo.usertype==2)&&e(de,{onPositiveClick:()=>g(n,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>O(e(S,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[J("no-auth"),"project:Debug:update"]])}),O(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>oe(n)},{default:()=>[r("详情")]}),[[J("no-auth"),"project:Debug:select"]]),O(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>_(n.id)},Ae(s=W("common.edit"))?s:{default:()=>[s]}),[[J("no-auth"),"project:Debug:update"]]),e(de,{onPositiveClick:()=>E(n.id)},{default:()=>W("common.confirmDelete"),trigger:()=>{let B;return O(e(S,{type:"error",ghost:!0,size:"small"},Ae(B=W("common.delete"))?B:{default:()=>[B]}),[[J("no-auth"),"project:Debug:delete"]])}})])}}]}),{drawerVisible:Q,operateType:me,editingData:ge,handleAdd:ve,handleEdit:ae,checkedRowKeys:z,onBatchDeleted:ye,onDeleted:le}=Ct(L,f);vt(async()=>{});const be=n=>{j.setProjectInfo({pid:n.pid,pname:n.proname}),y.push("/projectmanagement/orderdetail?prjId="+n.pid+`&pname=${n.proname}&IsScroll=1`)};async function _e(){console.log(z.value),P(z.value.join(","),n=>{ye()})}async function E(n){const{data:s,error:B}=await Be(n,b.pid);B||le()}const g=async(n,s)=>{var X;const{data:B,error:V}=await Oe([{id:n.id,status:s,pid:n.pid}]);V||((X=window.$message)==null||X.success("操作成功"),f(),s==3?window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:n.pid,type:"debug"}})):(s==1||s==2)&&window.dispatchEvent(new CustomEvent("refreshTodo")))};function _(n){ae(n)}async function P(n,s){const{data:B,error:V}=await Be(n,b.pid);if(!V)s&&s(B);else return!1}const I=K(-1),ne=n=>{n>0?(I.value=n,b.dbcreater=JSON.parse(JSON.stringify(n)),f()):(b.dbcreater=void 0,I.value=-1,f())},he=n=>{f()},se=()=>{if(console.log(D.query.prjId,"route.query.prjId"),D.query.debug){b.status=Number(D.query.debug),b.dbcreater=j.userInfo.id,ne(j.userInfo.id);return}D.query.types=="2"&&(b.status=2),D.query.types=="-1"&&(b.status=-1),f()},ke=()=>{f()},we=()=>{L.value=[],$.itemCount=0},p=K(null),Z=K(!1),oe=n=>{p.value=n,Z.value=!0};return(n,s)=>{const B=jt,V=_t,X=Ue,Te=tt,Fe=et,ee=Xe,C=yt,N=Ve,h=St,Ce=Ft,ue=Le,De=J("no-auth");return m(),A("div",Pt,[e(At,{model:o(b),"onUpdate:model":s[0]||(s[0]=v=>xe(b)?b.value=v:null),onReset:ke,onSearch:se,onSearch1:o(f),onClear:we},null,8,["model","onSearch1"]),e(N,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(X,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[s[6]||(s[6]=w("div",null,"待调试业务",-1)),e(V,{size:"small",value:I.value,"onUpdate:value":[s[1]||(s[1]=v=>I.value=v),ne],name:"radiobuttongroup1"},{default:t(()=>[e(B,{value:-1,label:"默认"}),e(B,{value:o(j).userInfo.id,label:"我的调试"},null,8,["value"])]),_:1},8,["value"])]),_:1,__:[6]})]),"header-extra":t(()=>[e(X,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[O((m(),F(o(S),{onClick:o(ve),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(Te,{class:"text-icon"})]),default:t(()=>[s[7]||(s[7]=r(" "+c("新增")))]),_:1,__:[7]},8,["onClick"])),[[De,"project:Debug:insert"]]),e(o(de),{onPositiveClick:_e},{trigger:t(()=>[O((m(),F(o(S),{size:"small",ghost:"",type:"error",disabled:o(z).length==0},{icon:t(()=>[e(Fe,{class:bt(["text-icon",{"animate-spin":o(q)}])},null,8,["class"])]),default:t(()=>[s[8]||(s[8]=r(" "+c("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[De,"project:Debug:delete"]])]),default:t(()=>[s[9]||(s[9]=r(" 确定要删除选中的吗？ "))]),_:1,__:[9]}),e(ee,{columns:o(M),"onUpdate:columns":s[2]||(s[2]=v=>xe(M)?M.value=v:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(C,{"checked-row-keys":o(z),"onUpdate:checkedRowKeys":s[3]||(s[3]=v=>xe(z)?z.value=v:null),columns:o(l),data:o(L),size:"small","flex-height":!o(fe).isMobile,loading:o(q),remote:"","row-key":v=>v.id,"scroll-x":o(l).reduce((v,re)=>v+(re.width||100),0),pagination:o(Y),class:"sm:h-full","onUpdate:filters":he},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","scroll-x","pagination"]),e(Bt,{visible:o(Q),"onUpdate:visible":s[4]||(s[4]=v=>xe(Q)?Q.value=v:null),onSubmitted:o(f),"operate-type":o(me),pid:o(b).pid,"row-data":o(ge)},null,8,["visible","onSubmitted","operate-type","pid","row-data"])]),_:1}),e(ue,{show:Z.value,"onUpdate:show":s[5]||(s[5]=v=>Z.value=v),title:"查看详情",preset:"card",class:"w-1200px"},{default:t(()=>[e(Ce,{bordered:"","label-placement":"left","label-align":"center",columns:2,"label-style":{width:"160px"}},{default:t(()=>[e(h,null,{label:t(()=>s[10]||(s[10]=[r(" 权重 ")])),default:t(()=>[w("span",null,c(p.value.tname),1)]),_:1}),e(h,null,{label:t(()=>s[11]||(s[11]=[r(" 业务名称 ")])),default:t(()=>[w("span",null,c(p.value.debugname),1)]),_:1}),e(h,null,{label:t(()=>s[12]||(s[12]=[r(" 计划起止时间 ")])),default:t(()=>[w("span",null,c(p.value.starttime)+"--"+c(p.value.endtime),1)]),_:1}),e(h,null,{label:t(()=>s[13]||(s[13]=[r(" 对接方 ")])),default:t(()=>[w("span",null,c(p.value.docker.split("&id=")[0]),1)]),_:1}),e(h,null,{label:t(()=>s[14]||(s[14]=[r(" 对接方负责人 ")])),default:t(()=>[w("span",null,c(p.value.dockcharge),1)]),_:1}),e(h,null,{label:t(()=>s[15]||(s[15]=[r(" 联系方式 ")])),default:t(()=>[w("span",null,c(p.value.dockcontact),1)]),_:1}),e(h,null,{label:t(()=>s[16]||(s[16]=[r(" 状态 ")])),default:t(()=>[p.value.status==-1?(m(),F(o(ie),{key:0,type:"default"},{default:t(()=>s[17]||(s[17]=[r("申请中")])),_:1,__:[17]})):T("",!0),p.value.status==0?(m(),F(o(ie),{key:1,type:"default"},{default:t(()=>s[18]||(s[18]=[r("未调试")])),_:1,__:[18]})):T("",!0),p.value.status==1?(m(),F(o(ie),{key:2,type:"info"},{default:t(()=>s[19]||(s[19]=[r("开始调试")])),_:1,__:[19]})):T("",!0),p.value.status==2?(m(),F(o(ie),{key:3,type:"success"},{default:t(()=>s[20]||(s[20]=[r("待审核")])),_:1,__:[20]})):T("",!0),p.value.status==3?(m(),F(o(ie),{key:4,type:"success"},{default:t(()=>s[21]||(s[21]=[r("审核完成")])),_:1,__:[21]})):T("",!0)]),_:1}),e(h,null,{label:t(()=>s[22]||(s[22]=[r(" 备注 ")])),default:t(()=>[w("span",null,c(p.value.notes),1)]),_:1}),e(h,null,{label:t(()=>s[23]||(s[23]=[r(" 调试人 ")])),default:t(()=>[w("span",null,c(p.value.dbusername),1)]),_:1}),e(h,null,{label:t(()=>s[24]||(s[24]=[r(" 调试开始时间 ")])),default:t(()=>[w("span",null,c(p.value.dbdbtime),1)]),_:1}),e(h,null,{label:t(()=>s[25]||(s[25]=[r(" 调试结束时间 ")])),default:t(()=>[w("span",null,c(p.value.dedbtime),1)]),_:1}),e(h,null,{label:t(()=>s[26]||(s[26]=[r(" 调试工时 ")])),default:t(()=>[w("span",null,c(p.value.duration),1)]),_:1}),e(h,null,{label:t(()=>s[27]||(s[27]=[r(" 审核人 ")])),default:t(()=>[w("span",null,c(p.value.ckusername),1)]),_:1}),e(h,null,{label:t(()=>s[28]||(s[28]=[r(" 审核时间 ")])),default:t(()=>[w("span",null,c(p.value.ckdbtime),1)]),_:1}),e(h,null,{label:t(()=>s[29]||(s[29]=[r(" 附件1 ")])),default:t(()=>{var v;return[p.value.re1?(m(),A("span",It,"文件别名"+c(p.value.re1),1)):T("",!0),p.value.fl1?(m(),A("span",$t,c((v=p.value.fl1)==null?void 0:v.split("?")[1]),1)):T("",!0)]}),_:1}),e(h,null,{label:t(()=>s[30]||(s[30]=[r(" 附件2 ")])),default:t(()=>{var v;return[p.value.re2?(m(),A("span",Rt,"文件别名"+c(p.value.re2),1)):T("",!0),p.value.fl2?(m(),A("span",Lt,c((v=p.value.fl2)==null?void 0:v.split("?")[1]),1)):T("",!0)]}),_:1}),e(h,null,{label:t(()=>s[31]||(s[31]=[r(" 附件3 ")])),default:t(()=>{var v;return[p.value.re3?(m(),A("span",Et,"文件别名"+c(p.value.re3),1)):T("",!0),p.value.fl3?(m(),A("span",Ot,c((v=p.value.fl3)==null?void 0:v.split("?")[1]),1)):T("",!0)]}),_:1}),e(h,null,{label:t(()=>s[32]||(s[32]=[r(" 附件4 ")])),default:t(()=>{var v;return[p.value.re4?(m(),A("span",Ht,"文件别名"+c(p.value.re4),1)):T("",!0),p.value.fl4?(m(),A("span",Mt,c((v=p.value.fl4)==null?void 0:v.split("?")[1]),1)):T("",!0)]}),_:1})]),_:1})]),_:1},8,["show"])])}}});export{sa as default};
