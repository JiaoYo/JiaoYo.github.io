import{_ as mt}from"./table-column-setting.vue_vue_type_script_setup_true_lang-C75vlf8o.js";import{_ as ft}from"./round-refresh-bXXSogu5.js";import{_ as vt}from"./export-BKzCBSnz.js";import{_ as gt}from"./round-delete-DAbWeYWY.js";import{at as Ce,o as O,e as Le,f as it,d as Ue,n as me,r as ke,p as Me,q as Ve,s as ht,aa as Oe,b as st,$ as I,ay as dt,g as e,y as we,w as a,h as T,t as x,i as t,am as Y,z as ee,ap as Te,aH as Be,au as Pe,aA as Fe,aj as xe,L as fe,B as V,ar as qe,an as Ee,P as Ge,O as je,ao as Je,as as He,a_ as bt,j as De,al as et,c as te,C as Ne,Y as _t,ah as yt,v as wt,A as Tt,ae as ue,aq as kt,G as Ft,E as Lt,aD as It,a5 as Nt}from"./index-B3vq2eC0.js";import{_ as Pt}from"./round-add-BNH3s-Vf.js";import{_ as Dt}from"./round-search-CXNsLPZO.js";import{u as We,a as Ye}from"./table-DnySjCFW.js";import{p as pe,d as rt,a as Ct,b as tt,c as lt}from"./gather-NUz7IuWO.js";import{_ as Qe}from"./FormItemGridItem-Cm1sDqT2.js";import{_ as Xe}from"./Grid-CPtFKccg.js";import{N as at}from"./Popconfirm-MHcWaK6m.js";import{_ as Ut}from"./InputGroupLabel-BW7h9ali.js";function xt(L){return Ce({url:"/transTag/selectPage.do",method:"get",params:L})}function ct(L){return Ce({url:"/transTag/insert.do",method:"post",data:L})}function Ke(L){return Ce({url:"/transTag/update.do",method:"post",data:L})}function nt(L){return Ce({url:"/transTag/delete.do",method:"get",params:L})}const jt={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},At=it("path",{fill:"currentColor",d:"M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36M20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83l3.75 3.75z"},null,-1),Rt=[At];function $t(L,Q){return O(),Le("svg",jt,[...Rt])}const zt={name:"ic-round-edit",render:$t},St=Ue({__name:"add_model",props:me({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:me(["submitted"],["update:visible"]),setup(L,{emit:Q}){const n=ke({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:{},dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),h=Me(L,"visible"),B=Q,z=L,l=ke(E());function E(){return{chlId:void 0,devId:void 0,tagDevId:"",tagName:"",tagId:void 0,tagDesc:"",tagUnit:"",tagType:1,tagK:1,objAddr:"0",collectType:1,dataType:4,dataFormat:0}}async function y(){var b;const{data:r,error:i}=await bt({page:1,limit:1e4,type:1});i||(n.deveicelList=r.list.map(d=>({...d,label:d.devName,value:d.id+"_"+d.chlId})),z.operateType==="add"&&n.deveicelList.length>0&&!l.tagDevId&&(l.tagDevId=(b=n.deveicelList[0])==null?void 0:b.value,l.devId=Number(l.tagDevId.split("_")[0]),l.chlId=Number(l.tagDevId.split("_")[1]),l.collectType=void 0),N())}async function N(){const{data:r,error:i}=await Fe({chlId:l.chlId});i||(n.functionList=JSON.parse(r).data,l.collectType=n.functionList[0].FuncCode)}function S(){Object.assign(l,E()),y(),z.operateType==="edit"&&z.rowData&&(Object.assign(l,z.rowData),w(z.rowData))}const{formRef:X,validate:_,restoreValidation:le}=Ve();ht(),Oe(h,()=>{h.value&&(S(),le())});const j=()=>{h.value=!1};function w(r,i){console.log(r),r==0||r==1||r==2||r==3||r==4||r==7?n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:r==5||r==6||r==8||r==9||r==10||r==12||r==13?n.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],n.collectionPointForm.dataFormatList.find(b=>b.value===l.dataFormat)||(l.dataFormat=n.collectionPointForm.dataFormatList[0].value)}const K=async()=>{var r,i;if(await _(),console.log(l),z.operateType==="add"){const{data:b,error:d}=await ct([l]);d||(j(),(r=window.$message)==null||r.success("添加成功"),B("submitted"))}else{const{data:b,error:d}=await Ke([l]);d||(j(),(i=window.$message)==null||i.success("编辑成功"),B("submitted"))}},A={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},P={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},U={devId:P,tagName:A,tagDesc:A,tagK:P,objAddr:A,collectType:P,dataType:P,dataFormat:P},J=st(()=>({add:I("common.add"),edit:I("common.edit")})[z.operateType]),{columns:H,columnChecks:se,data:W,getData:M,loading:F,mobilePagination:ve,searchParams:f,resetSearchParams:Ae}=We({apiFn:dt,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",multiple:!1,align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140},{key:"devId",title:"所属设备",align:"center",width:140,render:r=>{var i;return e("span",null,[((i=n.collectionPointForm.deveicelList.find(b=>b.id===r.devId))==null?void 0:i.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),de=()=>{M()},{drawerVisible:Re,operateType:v,editingData:m,handleAdd:k,handleEdit:$,checkedRowKeys:R,onBatchDeleted:$e,onDeleted:ze}=Ye(W,M);async function ae(){const{data:r,error:i}=await Pe();i||(console.log("data",r),r.length>0&&(n.collectionPointForm.channelList=r.filter(b=>b.chlType!==1).map(b=>({label:b.chlName,value:b.id,devicePojoList:b.devicePojoList||[]}))))}ae();const re=r=>{var b;f.chlid=r,f.devId=null;let i=(b=n.collectionPointForm.channelList.find(d=>d.value==r))==null?void 0:b.devicePojoList;n.collectionPointForm.deveicelList=i,ne(),M()};function ge(){var r,i;if(n.collectionPointForm.channelList.length>0)if(f.chlid)n.collectionPointForm.visible=!0;else{let b=n.collectionPointForm.channelList[0];f.chlid=b.value,n.collectionPointForm.deveicelList=b.devicePojoList,ne(),R.value=[l.tagId],n.collectionPointForm.checkedRows.tagName=l.tagName,n.collectionPointForm.checkedRows.id=l.tagId}else return(r=window.$message)==null||r.destroyAll(),(i=window.$message)==null||i.warning("暂无通道，请您先创建通道在进行查询"),!1}async function ne(){const{data:r,error:i}=await Fe({chlId:f.chlid});i||(n.collectionPointForm.functionList=JSON.parse(r).data,n.collectionPointForm.visible=!0,M())}function he(){n.collectionPointForm.visible=!1}function D(r,i,b){console.log(i),n.collectionPointForm.checkedRows=i[0]}function be(){var r,i;if(R.value.length===0)return(r=window.$message)==null||r.destroyAll(),(i=window.$message)==null||i.warning("请您先选择采集点"),!1;l.tagName=n.collectionPointForm.checkedRows.tagName,l.tagId=n.collectionPointForm.checkedRows.id,l.tagDesc||(l.tagDesc=n.collectionPointForm.checkedRows.tagDesc),n.collectionPointForm.visible=!1}return(r,i)=>{const b=xe,d=Qe,Ie=fe,Se=V,s=qe,o=Ee,c=fe,u=Xe,q=Ge,C=V,G=je,oe=Je,Z=He,ce=we("no-space");return O(),Le(Be,null,[e(oe,{show:h.value,"onUpdate:show":i[9]||(i[9]=p=>h.value=p),title:J.value,preset:"card",class:"w-50%"},{footer:a(()=>[e(G,{size:16,justify:"center"},{default:a(()=>[e(C,{onClick:j,class:"w-100px"},{default:a(()=>[T(x(t(I)("common.cancel")),1)]),_:1}),e(C,{type:"primary",class:"w-100px",onClick:K},{default:a(()=>[T(x(t(I)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(q,{ref_key:"formRef",ref:X,model:l,rules:U,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(u,{responsive:"screen","item-responsive":""},{default:a(()=>[e(d,{span:"24 m:12",label:"所属设备",path:"belongingChannel"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择所属设备",value:l.devId,"onUpdate:value":i[0]||(i[0]=p=>l.devId=p),"value-field":"id",options:n.deveicelList},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:a(()=>[e(s,null,{default:a(()=>[e(Ie,{value:l.tagName,"onUpdate:value":i[1]||(i[1]=p=>l.tagName=p),style:{width:"80%"},readonly:""},null,8,["value"]),e(Se,{type:"primary",ghost:"",onClick:ge},{default:a(()=>[T("请选择")]),_:1})]),_:1})]),_:1}),e(d,{span:"24 m:12",label:"测点类型",path:"tagType"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择测点类型",value:l.tagType,"onUpdate:value":i[2]||(i[2]=p=>l.tagType=p),options:t(Y)(t(pe))},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:a(()=>[e(o,{clearable:"",value:l.tagK,"onUpdate:value":i[3]||(i[3]=p=>l.tagK=p),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择转发功能码",value:l.collectType,"onUpdate:value":i[4]||(i[4]=p=>l.collectType=p),options:n.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:a(()=>[e(c,{clearable:"",value:l.objAddr,"onUpdate:value":i[5]||(i[5]=p=>l.objAddr=p),placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择数据类型",value:l.dataType,"onUpdate:value":[i[6]||(i[6]=p=>l.dataType=p),w],options:t(Y)(t(rt))},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择数据格式",value:l.dataFormat,"onUpdate:value":i[7]||(i[7]=p=>l.dataFormat=p),options:n.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:a(()=>[e(c,{clearable:"",value:l.tagUnit,"onUpdate:value":i[8]||(i[8]=p=>l.tagUnit=p),placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(oe,{show:n.collectionPointForm.visible,"onUpdate:show":i[16]||(i[16]=p=>n.collectionPointForm.visible=p),title:"选择采集点",preset:"card",class:"w-60%"},{footer:a(()=>[e(G,{size:16,justify:"end"},{default:a(()=>[e(C,{onClick:he},{default:a(()=>[T(x(t(I)("common.cancel")),1)]),_:1}),e(C,{type:"primary",onClick:be},{default:a(()=>[T(x(t(I)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(q,{model:n.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(u,{responsive:"screen","item-responsive":""},{default:a(()=>[e(d,{span:"24 m:12",label:"所属通道"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择所属通道",value:t(f).chlid,"onUpdate:value":i[10]||(i[10]=p=>t(f).chlid=p),options:n.collectionPointForm.channelList,onUpdateValue:re},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"所属设备"},{default:a(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择所属设备",value:t(f).devId,"onUpdate:value":i[11]||(i[11]=p=>t(f).devId=p),"label-field":"devName","value-field":"id",options:n.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"测点类型"},{default:a(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(f).tagType,"onUpdate:value":i[12]||(i[12]=p=>t(f).tagType=p),options:t(Y)(t(pe))},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"测点功能码"},{default:a(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:t(f).collectType,"onUpdate:value":i[13]||(i[13]=p=>t(f).collectType=p),options:n.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"测点名称"},{default:a(()=>[ee(e(c,{clearable:"",value:t(f).fuzzy,"onUpdate:value":i[14]||(i[14]=p=>t(f).fuzzy=p),placeholder:"请输入测点名称"},null,8,["value"]),[[ce]])]),_:1}),e(d,{span:"24 m:12",label:" "},{default:a(()=>[e(C,{onClick:de},{default:a(()=>[T(x(t(I)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(Z,{"checked-row-keys":t(R),"onUpdate:checkedRowKeys":[i[15]||(i[15]=p=>Te(R)?R.value=p:null),D],columns:t(H),data:t(W),size:"small","max-height":500,loading:t(F),remote:"","row-key":p=>p.id,pagination:t(ve)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1},8,["show"])],64)}}}),Kt={class:"flex"},Mt=Ue({__name:"add_multipe_model",props:me(["devId","chlid"],{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:me(["submitted"],["update:visible"]),setup(L,{emit:Q}){const n=ke({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:[],dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),h=Me(L,"visible"),B=L,z=Q,l=ke(E());function E(){return{chlId:void 0,devId:void 0,tagDevId:void 0,tagName:"",tagNames:"",tagId:"",tagDesc:"",tagDescs:"",tagUnit:"",tagType:0,tagK:1,objAddr:"0",collectType:void 0,dataType:4,dataFormat:0}}async function y(){var c,u;const{data:s,error:o}=await Pe({type:1});if(!o){const q=[];s.forEach(C=>{C.devicePojoList&&C.devicePojoList.length>0&&C.devicePojoList.forEach(G=>{q.push({label:`${C.chlName}__${G.devName}`,value:`${G.id}_${C.id}`})})}),n.deveicelList=q,n.deveicelList.length>0&&(l.tagDevId=B.devId&&B.chlid?B.devId+"_"+B.chlid:n.deveicelList[0].value,l.devId=Number((c=l.tagDevId)==null?void 0:c.split("_")[0]),l.chlId=Number((u=l.tagDevId)==null?void 0:u.split("_")[1]),l.collectType=void 0,N())}}async function N(){const{data:s,error:o}=await Fe({chlId:l.chlId});o||(n.functionList=JSON.parse(s).data,l.collectType=n.functionList[0].FuncCode)}function S(){Object.assign(l,E()),y(),n.collectionPointForm.checkedRows=[],D.value=[]}const{formRef:X,validate:_,restoreValidation:le}=Ve();Oe(h,()=>{h.value&&(S(),le())});const j=()=>{h.value=!1};function w(s,o){console.log(s),s==0||s==1||s==2||s==3||s==4||s==7?n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:s==5||s==6||s==8||s==9||s==10||s==12||s==13?n.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],n.collectionPointForm.dataFormatList.find(c=>c.value===l.dataFormat)||(l.dataFormat=n.collectionPointForm.dataFormatList[0].value)}const K=async()=>{var G,oe,Z;await _();let s=l.tagNames.split(","),o=(G=l.tagDescs)==null?void 0:G.split(","),c=(oe=l.tagId)==null?void 0:oe.split(","),u=[];delete l.tagNames,delete l.tagDescs,delete l.tagId,s.forEach((ce,p)=>{var _e,ye;let ie={...l,tagName:ce,tagDesc:l.tagDesc?l.tagDesc:o[p],tagId:Number(c[p]),objAddr:l.objAddr?+l.objAddr+p:p+"",devId:Number((_e=l.tagDevId)==null?void 0:_e.split("_")[0]),chlId:Number((ye=l.tagDevId)==null?void 0:ye.split("_")[1])};u.push(ie)});const{data:q,error:C}=await ct(u);C||(j(),(Z=window.$message)==null||Z.success("添加成功"),z("submitted"))},A={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},P={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},U={tagDevId:A,tagName:A,tagDesc:[{trigger:["input","blur"],validator:(s,o)=>!/\$/.test(o),message:"不能含有非法字符"},{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]}],tagK:P,objAddr:A,collectType:P,dataType:P,dataFormat:P},J=st(()=>({add:"批量新增",edit:I("common.edit")}).add),{columns:H,columnChecks:se,data:W,getData:M,loading:F,mobilePagination:ve,searchParams:f,resetSearchParams:Ae}=We({apiFn:dt,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140,render:s=>{var o;return e("span",null,[((o=pe.find(c=>c.value===s.tagType))==null?void 0:o.label)||""])}},{key:"belongingEquipment",title:"所属设备",align:"center",width:140,render:s=>{var o;return e("span",null,[((o=n.collectionPointForm.deveicelList.find(c=>c.id===s.devId))==null?void 0:o.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),de=()=>{M()},{drawerVisible:Re,operateType:v,editingData:m,handleAdd:k,handleEdit:$,checkedRowKeys:R,onBatchDeleted:$e,onDeleted:ze}=Ye(W,M);async function ae(){const{data:s,error:o}=await Pe();o||(console.log("data",s),s.length>0&&(n.collectionPointForm.channelList=s.filter(c=>c.chlType!==1).map(c=>({label:c.chlName,value:c.id,devicePojoList:c.devicePojoList||[]}))))}const re=s=>{var c;f.chlid=s,f.devId=null;let o=(c=n.collectionPointForm.channelList.find(u=>u.value==s))==null?void 0:c.devicePojoList;n.collectionPointForm.deveicelList=o,ne(),M()};ae();function ge(){var s,o;if(R.value=D.value.map(c=>c.id),n.collectionPointForm.channelList.length>0)if(f.chlid)n.collectionPointForm.visible=!0;else{let c=n.collectionPointForm.channelList[0];f.chlid=c.value,n.collectionPointForm.deveicelList=c.devicePojoList,ne()}else return(s=window.$message)==null||s.destroyAll(),(o=window.$message)==null||o.warning("暂无通道，请您先创建通道在进行查询"),!1}async function ne(){const{data:s,error:o}=await Fe({chlId:f.chlid});o||(n.collectionPointForm.functionList=JSON.parse(s).data,n.collectionPointForm.visible=!0,M())}function he(){n.collectionPointForm.visible=!1}const D=De([]),be=[{title(){return e("div",{class:"flex"},[e("span",{class:"flex-1"},[`已选${D.value.length}个`]),e("span",{class:"c-red cursor-pointer",onClick:b},[T("清空")])])},align:"center",render:s=>{var o;return e("span",null,[s.tagName,T("--"),(o=n.collectionPointForm.channelList.find(c=>c.value==s.chlId))==null?void 0:o.label])}}];function r(s,o,c){console.log(o),o=o.filter(u=>u!=null),f.devId&&(D.value=D.value.filter(u=>u.devId!=f.devId||u.page!=f.page)),f.chlid&&(D.value=D.value.filter(u=>u.chlId!=f.chlid||u.page!=f.page)),D.value.push(...o.filter(u=>u!=null)),D.value=[...new Set(D.value)],D.value.forEach(u=>{u.page=u.page?u.page:f.page})}function i(){var s,o,c,u,q;if(n.collectionPointForm.checkedRows=R.value,l.tagNames="",l.tagDescs="",l.tagId="",R.value.length===0)return(s=window.$message)==null||s.destroyAll(),(o=window.$message)==null||o.warning("请您先选择采集点"),!1;D.value.forEach(C=>{l.tagNames+=C.tagName+",",l.tagDescs+=C.tagDesc+",",l.tagId+=C.id+","}),l.tagName=D.value[0].tagName,l.tagNames=(c=l.tagNames)==null?void 0:c.substring(0,l.tagNames.length-1),l.tagDescs=(u=l.tagDescs)==null?void 0:u.substring(0,l.tagDescs.length-1),l.tagId=(q=l.tagId)==null?void 0:q.substring(0,l.tagId.length-1),n.collectionPointForm.visible=!1}const b=()=>{D.value=[],R.value=[]},d=()=>{R.value=[]},Ie=()=>({style:{height:"40px"}}),Se=s=>{f.devId=s,de()};return(s,o)=>{const c=xe,u=Qe,q=fe,C=V,G=qe,oe=Ee,Z=fe,ce=Xe,p=Ge,ie=V,_e=je,ye=Je,Ze=He,ut=we("no-space");return O(),Le(Be,null,[e(ye,{show:h.value,"onUpdate:show":o[9]||(o[9]=g=>h.value=g),title:J.value,preset:"card",class:"w-50%"},{footer:a(()=>[e(_e,{size:16,justify:"center"},{default:a(()=>[e(ie,{onClick:j,class:"w-100px"},{default:a(()=>[T(x(t(I)("common.cancel")),1)]),_:1}),e(ie,{type:"primary",class:"w-100px",onClick:K},{default:a(()=>[T(x(t(I)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(p,{ref_key:"formRef",ref:X,model:l,rules:U,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(ce,{responsive:"screen","item-responsive":""},{default:a(()=>[e(u,{span:"24 m:12",label:"所属设备",path:"tagDevId"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择所属设备",value:l.tagDevId,"onUpdate:value":o[0]||(o[0]=g=>l.tagDevId=g),options:n.deveicelList},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:a(()=>[e(G,{style:{width:"100%"}},{default:a(()=>[e(q,{value:l.tagName,"onUpdate:value":o[1]||(o[1]=g=>l.tagName=g),readonly:""},null,8,["value"]),e(C,{type:"primary",ghost:"",onClick:ge},{default:a(()=>[T(x(n.collectionPointForm.checkedRows.length>1?`+${n.collectionPointForm.checkedRows.length}`:"请选择"),1)]),_:1})]),_:1})]),_:1}),e(u,{span:"24 m:12",label:"测点类型",path:"dataType"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择测点类型",value:l.tagType,"onUpdate:value":o[2]||(o[2]=g=>l.tagType=g),options:t(Y)(t(pe))},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:a(()=>[e(oe,{clearable:"",value:l.tagK,"onUpdate:value":o[3]||(o[3]=g=>l.tagK=g),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(u,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择转发功能码",value:l.collectType,"onUpdate:value":o[4]||(o[4]=g=>l.collectType=g),options:n.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:a(()=>[e(Z,{clearable:"",value:l.objAddr,"onUpdate:value":o[5]||(o[5]=g=>l.objAddr=g),maxlength:"128",placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(u,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择数据类型",value:l.dataType,"onUpdate:value":[o[6]||(o[6]=g=>l.dataType=g),w],options:t(Y)(t(rt))},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择数据格式",value:l.dataFormat,"onUpdate:value":o[7]||(o[7]=g=>l.dataFormat=g),options:n.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:a(()=>[e(Z,{clearable:"",value:l.tagUnit,"onUpdate:value":o[8]||(o[8]=g=>l.tagUnit=g),maxlength:"12",placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(ye,{show:n.collectionPointForm.visible,"onUpdate:show":o[16]||(o[16]=g=>n.collectionPointForm.visible=g),title:"选择采集点",preset:"card",class:"w-65%",onAfterLeave:d},{footer:a(()=>[e(_e,{size:16,justify:"end"},{default:a(()=>[e(ie,{onClick:he},{default:a(()=>[T(x(t(I)("common.cancel")),1)]),_:1}),e(ie,{type:"primary",onClick:i},{default:a(()=>[T(x(t(I)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(p,{model:n.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(ce,{responsive:"screen","item-responsive":""},{default:a(()=>[e(u,{span:"24 m:12",label:"所属通道"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择所属通道",value:t(f).chlid,"onUpdate:value":o[10]||(o[10]=g=>t(f).chlid=g),options:n.collectionPointForm.channelList,onUpdateValue:re},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"所属设备"},{default:a(()=>[e(c,{filterable:"",clearable:"",placeholder:"请选择所属设备","label-field":"devName","value-field":"id",value:t(f).devId,"onUpdate:value":[o[11]||(o[11]=g=>t(f).devId=g),Se],options:n.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点类型"},{default:a(()=>[e(c,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(f).tagType,"onUpdate:value":o[12]||(o[12]=g=>t(f).tagType=g),options:t(Y)(t(pe))},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点功能码"},{default:a(()=>[e(c,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:t(f).collectType,"onUpdate:value":o[13]||(o[13]=g=>t(f).collectType=g),options:n.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点名称"},{default:a(()=>[ee(e(Z,{clearable:"",value:t(f).fuzzy,"onUpdate:value":o[14]||(o[14]=g=>t(f).fuzzy=g),placeholder:"请输入测点名称"},null,8,["value"]),[[ut]])]),_:1}),e(u,{span:"24 m:12",label:" "},{default:a(()=>[e(ie,{onClick:de},{default:a(()=>[T(x(t(I)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),it("div",Kt,[e(Ze,{"checked-row-keys":t(R),"onUpdate:checkedRowKeys":[o[15]||(o[15]=g=>Te(R)?R.value=g:null),r],columns:t(H),data:t(W),size:"small","max-height":400,loading:t(F),remote:"","row-key":g=>g.id,pagination:t(ve),class:"flex-1 w-80%","row-props":Ie,"scroll-x":t(H).reduce((g,pt)=>g+pt.width,0)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination","scroll-x"]),e(Ze,{columns:be,data:D.value,size:"small","max-height":440,loading:t(F),remote:"","row-key":g=>g.id,class:"w-20% ml-10px","row-props":Ie},null,8,["data","loading","row-key"])])]),_:1},8,["show"])],64)}}}),Vt=Ue({__name:"batchEdit_model",props:me({checkedRowKeys:{type:Array,default:[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:me(["submitted"],["update:visible"]),setup(L,{emit:Q}){const n=L,h=Me(L,"visible");Oe(()=>h.value,j=>{y.value={editType:0,editMode:0,startV:"0",step:"1",tagK:0}});const B=Q,{formRef:z,validate:l,restoreValidation:E}=Ve(),y=De({editType:0,editMode:0,startV:"0",step:"1",tagK:0}),N=async()=>{var j,w;if(await l(),y.value.editType==0){console.log(n.checkedRowKeys);let K=[];n.checkedRowKeys.forEach((U,J)=>{K.push({id:U,objAddr:+y.value.startV+J*+y.value.step+""})});const{data:A,error:P}=await Ke(K);P||(h.value=!1,(j=window.$message)==null||j.success("批量修改成功"),B("submitted"))}else if(y.value.editType==1){let K=[];n.checkedRowKeys.forEach((U,J)=>{K.push({id:U,tagK:y.value.tagK})});const{data:A,error:P}=await Ke(K);P||(h.value=!1,(w=window.$message)==null||w.success("批量修改成功"),B("submitted"))}},S={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},X={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},_={editType:S,editMode:S,startV:X,step:X},le=De(!1);return(j,w)=>{const K=xe,A=Qe,P=fe,U=Ee,J=Xe,H=Ge,se=V,W=je,M=Je;return O(),Le(Be,null,[e(M,{show:h.value,"onUpdate:show":w[6]||(w[6]=F=>h.value=F),title:"批量修改",preset:"card",class:"w-40%"},{footer:a(()=>[e(W,{size:16,justify:"center"},{default:a(()=>[e(se,{onClick:w[5]||(w[5]=F=>h.value=!1),class:"w-100px"},{default:a(()=>[T(x(j.$t("common.cancel")),1)]),_:1}),e(se,{type:"primary",class:"w-100px",onClick:N},{default:a(()=>[T(x(j.$t("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(H,{ref_key:"formRef",ref:z,"label-width":120,"label-placement":"left",model:y.value,rules:_},{default:a(()=>[e(J,{responsive:"screen","item-responsive":""},{default:a(()=>[e(A,{span:"24 m:12",label:"修改类型",path:"editType"},{default:a(()=>[e(K,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editType,"onUpdate:value":w[0]||(w[0]=F=>y.value.editType=F),options:t(Y)(t(et)({0:"寄存器地址",1:"系数K"}))},null,8,["value","options"])]),_:1}),y.value.editType==0?(O(),te(A,{key:0,span:"24 m:12",label:"修改步长",path:"editMode"},{default:a(()=>[e(K,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editMode,"onUpdate:value":w[1]||(w[1]=F=>y.value.editMode=F),options:t(Y)(t(et)({0:"步长"}))},null,8,["value","options"])]),_:1})):Ne("",!0),y.value.editType==0?(O(),te(A,{key:1,span:"24 m:12",label:"起始值",path:"startV"},{default:a(()=>[e(P,{clearable:"",value:y.value.startV,"onUpdate:value":w[2]||(w[2]=F=>y.value.startV=F),placeholder:"请输入起始值"},null,8,["value"])]),_:1})):Ne("",!0),y.value.editType==0?(O(),te(A,{key:2,span:"24 m:12",label:"步长",path:"step"},{default:a(()=>[e(P,{clearable:"",value:y.value.step,"onUpdate:value":w[3]||(w[3]=F=>y.value.step=F),placeholder:"请输入步长"},null,8,["value"])]),_:1})):Ne("",!0),y.value.editType==1?(O(),te(A,{key:3,span:"24 m:12",label:"修改的值",path:"step"},{default:a(()=>[e(U,{clearable:"",value:y.value.tagK,"onUpdate:value":w[4]||(w[4]=F=>y.value.tagK=F),placeholder:"请输入修改的值"},null,8,["value"])]),_:1})):Ne("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(M,{show:le.value,"onUpdate:show":w[7]||(w[7]=F=>le.value=F),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),Ot={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ot(L){return typeof L=="function"||Object.prototype.toString.call(L)==="[object Object]"&&!kt(L)}const ll=Ue({name:"configsetting_forwardingservice_forwardingpointmanagement",__name:"index",setup(L){const Q=_t(),n=yt(),h=ke({channelList:[],channelAndDevObj:{},deveicelList:[],transFunctionOptions:[],addMultipeModelVisible:!1});async function B(){var k;const{data:v,error:m}=await Pe({type:1});if(!m){if(v==0)return(k=window.$message)==null?void 0:k.warning("暂无转发通道，请先添加通道");h.channelList=v||[],h.channelList.forEach($=>{h.channelAndDevObj[$.id]=$.devicePojoList||[]}),_.chlid=_.chlid||h.channelList[0].id,h.deveicelList=h.channelAndDevObj[_.chlid]||[],_.devId=h.deveicelList[0].id,z(),N()}}async function z(){const{data:v,error:m}=await Fe({chlId:_.chlid});m||(h.transFunctionOptions=JSON.parse(v).data)}const{columns:l,columnChecks:E,data:y,getData:N,loading:S,mobilePagination:X,searchParams:_,resetSearchParams:le}=We({apiFn:xt,apiParams:{page:1,pageSize:200,limit:200,chlid:null,devId:null,tagType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"测点ID",align:"center",width:80},{key:"tagName",title:"测点名称",align:"center",minWidth:100},{key:"tagType",title:"测点类型",align:"center",width:140,render:v=>e("span",null,[Ct[v.tagType]||""])},{key:"devName",title:"所属设备",align:"center",width:140,render:v=>{var m,k;return e("span",null,[((k=(m=h.deveicelList)==null?void 0:m.find($=>$.id===v.devId))==null?void 0:k.devName)||""])}},{key:"collectname",title:"转发功能码",align:"center",width:140,render:v=>{var m;return e("span",null,[(m=v.collectname)==null?void 0:m.replace(/\(.*?\)/g,"")])}},{key:"dataType",title:"数据类型",align:"center",width:140,render:v=>e("span",null,[v.dataType?tt[Number(v.dataType)]:tt[0]])},{key:"dataFormat",title:"数据格式",align:"center",width:140,render:v=>e("span",null,[v.dataType?lt[Number(v.dataFormat)]:lt[0]])},{key:"tagK",title:"系数K",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140},{key:"operate",title:I("common.operate"),align:"center",width:140,fixed:"right",render:v=>{let m;return e("div",{class:"flex-center gap-8px"},[ee(e(V,{type:"primary",ghost:!0,size:"small",onClick:()=>W(v.id)},ot(m=I("common.edit"))?m:{default:()=>[m]}),[[we("no-auth"),"transTag:update"]]),ee(e(at,{onPositiveClick:()=>se(v.id)},{default:()=>I("common.confirmDelete"),trigger:()=>{let k;return e(V,{type:"error",ghost:!0,size:"small"},ot(k=I("common.delete"))?k:{default:()=>[k]})}}),[[we("no-auth"),"transTag:delete"]])])}}]});wt(()=>{const v=n.currentRoute.value.query.channelId;_.chlid=Number(v)*1||null,B();const m=n.currentRoute.value.query.deviceId;_.devId=Number(m)*1||null});const{drawerVisible:j,operateType:w,editingData:K,handleAdd:A,handleEdit:P,checkedRowKeys:U,onBatchDeleted:J,onDeleted:H}=Ye(y,N),se=async v=>{const{data:m,error:k}=await nt({ids:v});k||H()},W=v=>{P(v)},M=v=>{v===""&&N()},F=De(!1),ve=()=>{F.value=!0};function f(v,m){var k;v&&(_.chlid=Number(v),_.devId=null,_.collectType=void 0,h.deveicelList=h.channelAndDevObj[v],_.devId=h.deveicelList[0].id,(!h.deveicelList||h.deveicelList.length==0)&&((k=window.$message)==null||k.warning("该通道下无设备! 请选择其他通道")),z(),N())}function Ae(){h.addMultipeModelVisible=!0}const de=async()=>{const v=U.value.join(","),{data:m,error:k}=await nt({ids:v});k||H(),U.value=[]},Re=()=>{var v;if(!_.devId){(v=window.$message)==null||v.warning("请选择导出设备");return}Ft({url:`${Lt}/transTag/exports.do`,method:"post",params:{devId:_.devId},responseType:"blob",headers:{token:It()}}).then(async m=>{if(m.data){const k=window.URL.createObjectURL(new Blob([m.data])),$=document.createElement("a");$.href=k,$.setAttribute("download",new Date().getTime()+".xls"),document.body.appendChild($),$.click()}})};return(v,m)=>{const k=Ut,$=xe,R=fe,$e=Dt,ze=qe,ae=je,re=Nt,ge=Pt,ne=zt,he=gt,D=vt,be=ft,r=mt,i=He,b=we("no-auth");return O(),Le("div",Ot,[e(re,{bordered:!1,size:"small"},{default:a(()=>[e(ae,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:a(()=>[e(ze,null,{default:a(()=>[e(k,null,{default:a(()=>[T("所属通道")]),_:1}),e($,{filterable:"",placeholder:"请选择通道",value:t(_).chlid,"onUpdate:value":m[0]||(m[0]=d=>t(_).chlid=d),"label-field":"chlName","value-field":"id",options:h.channelList,onUpdateValue:f},null,8,["value","options"]),e(k,null,{default:a(()=>[T("所属设备")]),_:1}),e($,{filterable:"",clearable:"",placeholder:"请选择设备",value:t(_).devId,"onUpdate:value":[m[1]||(m[1]=d=>t(_).devId=d),t(N)],"label-field":"devName","value-field":"id",options:h.deveicelList},null,8,["value","options","onUpdate:value"]),e(k,null,{default:a(()=>[T("测点类型")]),_:1}),e($,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(_).tagType,"onUpdate:value":[m[2]||(m[2]=d=>t(_).tagType=d),t(N)],style:{width:"80%"},options:t(Y)(t(pe))},null,8,["value","options","onUpdate:value"]),e(R,{clearable:"",value:t(_).fuzzy,"onUpdate:value":[m[3]||(m[3]=d=>t(_).fuzzy=d),M],placeholder:"请输入测点名称或描述",style:{width:"100%"},onKeyup:Tt(t(N),["enter"])},null,8,["value","onKeyup"]),e(t(V),{type:"primary",ghost:"",onClick:t(N)},{icon:a(()=>[e($e,{class:ue(["text-icon",{"animate-spin":t(S)}])},null,8,["class"])]),default:a(()=>[T(" "+x(t(I)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(re,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[e(ae,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"})]),"header-extra":a(()=>[e(ae,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[ee((O(),te(t(V),{onClick:Ae,size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(ge,{class:ue(["text-icon",{"animate-spin":t(S)}])},null,8,["class"])]),default:a(()=>[T(" "+x("批量新增"))]),_:1})),[[b,"transTag:insert"]]),ee((O(),te(t(V),{onClick:ve,size:"small",ghost:"",type:"primary",disabled:!t(U).length},{icon:a(()=>[e(ne,{class:ue(["text-icon",{"animate-spin":t(S)}])},null,8,["class"])]),default:a(()=>[T(" "+x("批量修改"))]),_:1},8,["disabled"])),[[b,"transTag:update"]]),ee((O(),te(t(at),{onPositiveClick:de},{trigger:a(()=>[e(t(V),{size:"small",ghost:"",type:"error",disabled:t(U).length==0},{icon:a(()=>[e(he,{class:ue(["text-icon",{"animate-spin":t(S)}])},null,8,["class"])]),default:a(()=>[T(" "+x(t(I)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:a(()=>[T(" 确认删除选中的项吗？ ")]),_:1})),[[b,"transTag:delete"]]),ee((O(),te(t(V),{onClick:Re,size:"small"},{icon:a(()=>[e(D,{class:ue(["text-icon",{"animate-spin":t(S)}])},null,8,["class"])]),default:a(()=>[T(" "+x(t(I)("common.export")),1)]),_:1})),[[b,"transTag:export"]]),e(t(V),{onClick:t(N),size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(be,{class:ue(["text-icon",{"animate-spin":t(S)}])},null,8,["class"])]),_:1},8,["onClick"]),e(r,{columns:t(E),"onUpdate:columns":m[4]||(m[4]=d=>Te(E)?E.value=d:null)},null,8,["columns"])]),_:1})]),default:a(()=>[e(i,{"checked-row-keys":t(U),"onUpdate:checkedRowKeys":m[5]||(m[5]=d=>Te(U)?U.value=d:null),columns:t(l),data:t(y),size:"small",class:"sm:h-full","flex-height":!t(Q).isMobile,loading:t(S),remote:"","row-key":d=>d.id,pagination:t(X)},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(St,{visible:t(j),"onUpdate:visible":m[6]||(m[6]=d=>Te(j)?j.value=d:null),onSubmitted:t(N),"operate-type":t(w),"row-data":t(K)},null,8,["visible","onSubmitted","operate-type","row-data"]),e(Mt,{visible:h.addMultipeModelVisible,"onUpdate:visible":m[7]||(m[7]=d=>h.addMultipeModelVisible=d),devId:t(_).devId,chlid:t(_).chlid,onSubmitted:t(N)},null,8,["visible","devId","chlid","onSubmitted"]),e(Vt,{visible:F.value,"onUpdate:visible":m[8]||(m[8]=d=>F.value=d),onSubmitted:t(N),checkedRowKeys:t(U)},null,8,["visible","onSubmitted","checkedRowKeys"])]),_:1})])}}});export{ll as default};
