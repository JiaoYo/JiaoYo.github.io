import{_ as pe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DHibJOas.js";import{_ as _e}from"./export-CJ2cPm8F.js";import{_ as fe}from"./round-search-da7ydzlJ.js";import{d as J,ab as G,a0 as ge,m as _,z as he,aj as ye,o as N,b as H,_ as K,a$ as k,g as a,w as s,f as l,B as x,af as we,h as b,t as y,$ as V,e as j,ap as E,c as I,aF as ve,T as ke,R as xe,as as be,O as De,ao as Te,a6 as Ce}from"./index-BYyX0kxW.js";import{c as A,d as Se,e as Ne}from"./metar-DUPncsaa.js";import{u as Me,a as ze}from"./table-BMngm2Sm.js";import{e as Re}from"./exportExcel-Bv4G4H50.js";import{u as Oe}from"./echarts-eujr87Q6.js";import{_ as Le}from"./RadioButton-CZ7wrDYL.js";import{_ as F}from"./DatePicker-C430Pb6d.js";import{_ as Pe}from"./FormItemGridItem-rYGzrbcn.js";import{_ as Ue}from"./Grid-BO-iBsn1.js";const $e=J({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(R){const m=R;G(()=>m.data,async o=>{T(),c()});const D=ge(),u=_(null),{domRef:g,updateOptions:h,showLoading:T,hideLoading:O}=Oe(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0}}},legend:{data:["功率标准差","均方根误差","平均绝对误差","平均误差","最大预测误差"]},calculable:!0,grid:{left:"6%",right:"6%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!0,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value}"},position:"left"},series:[{name:"功率标准差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"均方根误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"平均绝对误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"平均误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"最大预测误差",type:"bar",emphasis:{focus:"series"},data:[]}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function c(){await new Promise(o=>{setTimeout(o,1e3)}),h(o=>(o.xAxis.data=m.data.map(i=>i.dbtime),o.series[0].data=m.data.map(i=>i.stdpower),o.series[1].data=m.data.map(i=>i.prmse),o.series[2].data=m.data.map(i=>i.pmae),o.series[3].data=m.data.map(i=>i.pme),o.series[4].data=m.data.map(i=>i.pmaxe),o))}function L(){h((o,i)=>{const w=i();return o.legend.data=w.legend.data,o.series[0].name=w.series[0].name,o.series[1].name=w.series[1].name,o})}async function f(){c()}return G(()=>D.locale,()=>{L()}),f(),he(()=>{u.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),ye(()=>{u.value!==null&&(clearInterval(u.value),u.value=null)}),(o,i)=>(N(),H("div",{ref_key:"domRef",ref:g,class:"h-100% overflow-hidden"},null,512))}}),Be=K($e,[["__scopeId","data-v-7655cf3a"]]),Ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ve={style:{width:"200px","margin-left":"20px"}},je=J({name:"realtimequery_datastatistics",__name:"index",setup(R){const m=(t,e)=>{const n=Math.random()*(e-t)+t;return Math.random()<.5?Math.round(n):Math.round(n*10)/10},{columns:D,columnChecks:u,data:g,getData:h,loading:T,mobilePagination:O,searchParams:c,resetSearchParams:L}=Me({apiFn:A,apiParams:{page:1,pageSize:20,limit:20,startTime:k(0,Date.now()-2592e5),endTime:k(0,Date.now()),_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",width:50},{key:"dbtime",title:"更新时间",align:"center",width:160,fixed:"left"},{key:"etime",title:"有效时长(小时)",align:"center",width:120},{key:"powermax",title:"功率最大值",align:"center",width:120},{key:"avgpower",title:"功率平均值",align:"center",width:120},{key:"stdpower",title:"功率标准差",align:"center",width:120},{key:"powertime",title:"功率最大发生时间",align:"center",width:160},{key:"uhours",title:"利用小时数",align:"center",width:120},{key:"avgload",title:"平均负荷率",align:"center",width:120},{key:"prmse",title:"均方根误差",align:"center",width:120},{key:"pmae",title:"平均绝对误差",align:"center",width:120},{key:"pme",title:"平均误差",align:"center",width:120},{key:"pclcf",title:"相关性系数",align:"center",width:120},{key:"pmaxe",title:"最大预测误差",align:"center",width:120},{key:"prate",title:"合格率",align:"center",width:120},{key:"avgenvt",title:"环境温度平均值",align:"center",width:120},{key:"avgenvh",title:"环境湿度平均值",align:"center",width:120},{key:"avgldt",title:"露点温度平均值",align:"center",width:120},{key:"avgqy",title:"气压平均值",align:"center",width:120},{key:"avgwindd",title:"风向平均值",align:"center",width:120},{key:"avgwinds",title:"风速平均值",align:"center",width:120},{key:"avgzfsd",title:"总辐射平均值",align:"center",width:120},{key:"rz",title:"日照时数平均值",align:"center",width:140,render(t){return m(7,11)}}]}),{checkedRowKeys:f}=ze(g,h),o=()=>{v.value=="0"?h():U()},i=_([Date.now()-864e5*3,Date.now()]);async function w(t,e){c.startTime=k(0,e[0]),c.endTime=k(0,e[1]),o()}const q=()=>{const t={};D.value.forEach(n=>{n.key!="index"&&n.key!="operate"&&n.type!=="selection"&&(t[n.key]=typeof n.title=="string"?n.title:n.title().children[0])});const e=[];g.value.forEach(n=>{if(f.value.includes(n.id)){const d=JSON.parse(JSON.stringify(t));for(const p in d)n.hasOwnProperty(p)?d[p]=n[p]:d[p]="";e.push(d)}}),Re(e,t,"数据统计")},Z={近七天:[Date.now()-864e5*7,Date.now()],近一月:[Date.now()-864e5*30,Date.now()],近三月:[Date.now()-864e5*90,Date.now()]},C=_(!1),M=_(new Date().getTime()),z=_(0),Q=()=>{$(),C.value=!0},W=(t,e)=>{$()},X=()=>{C.value=!1},v=_("0"),Y=t=>{v.value=t,t=="0"?h():U()},ee=(t,e)=>{const n=new Date(t).getTime(),p=(new Date(e).getTime()-n)/(1e3*60*60*24);return Math.abs(p)},P=_([]),U=async()=>{const{data:t,error:e}=await A({startTime:c.startTime,endTime:c.endTime,page:1,limit:Math.floor(ee(c.startTime,c.endTime)+1)});P.value=JSON.parse(JSON.stringify(t)).list.sort((n,d)=>new Date(n.dbtime).getTime()-new Date(d.dbtime).getTime())},$=async()=>{const{data:t,error:e}=await Se({date:k(3,M.value)});e||(typeof t=="number"?z.value=t:z.value="")},S=_(),te=async()=>{const{data:t,error:e}=await Ne();S.value=t};return(t,e)=>{const n=F,d=Le,p=ve,ae=fe,ne=Pe,oe=Ue,se=ke,ie=_e,le=pe,B=xe,re=be,ce=F,de=De,me=Te,ue=Ce;return N(),H("div",Ge,[a(ue,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:s(()=>[a(se,{ref:"formRef",model:l(c),"label-placement":"left","show-feedback":!1},{default:s(()=>[a(oe,{"y-gap":16,responsive:"screen","item-responsive":""},{default:s(()=>[a(ne,{span:"24 s:12 m:20",label:"起止时间",path:"startTime"},{default:s(()=>[a(n,{value:i.value,"onUpdate:value":e[0]||(e[0]=r=>i.value=r),type:"daterange","value-format":"yyyy-MM-dd","onUpdate:formattedValue":w,"default-time":["00:00:00","23:59:59"],shortcuts:Z},null,8,["value"]),a(p,{value:v.value,"onUpdate:value":[e[1]||(e[1]=r=>v.value=r),Y],class:"ml-20px"},{default:s(()=>[a(d,{value:"0",label:"表格"}),a(d,{value:"1",label:"图表"})]),_:1},8,["value"]),a(l(x),{type:"primary",ghost:"",onClick:o,class:"ml-20px"},{icon:s(()=>[a(ae,{class:we(["text-icon",{"animate-spin":l(T)}])},null,8,["class"])]),default:s(()=>[b(" "+y(l(V)("common.search")),1)]),_:1}),a(l(x),{type:"primary",ghost:"",onClick:Q,class:"ml-20px"},{default:s(()=>[b(y("月均方根误差"))]),_:1}),a(l(x),{type:"primary",ghost:"",onClick:te,class:"ml-20px"},{default:s(()=>[b(" 查询日照时数平均值 ")]),_:1}),j("span",Ve,y(S.value&&S.value>0?"日照时数平均值为："+S.value:""),1)]),_:1})]),_:1})]),_:1},8,["model"])]),"header-extra":s(()=>[a(B,{justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[a(l(x),{onClick:q,size:"small",disabled:l(f).length==0},{icon:s(()=>[a(ie,{class:"text-icon"})]),default:s(()=>[b(" "+y(l(V)("common.export")),1)]),_:1},8,["disabled"]),a(le,{columns:l(u),"onUpdate:columns":e[2]||(e[2]=r=>E(u)?u.value=r:null)},null,8,["columns"])]),_:1})]),default:s(()=>[v.value=="0"?(N(),I(re,{key:0,"checked-row-keys":l(f),"onUpdate:checkedRowKeys":e[3]||(e[3]=r=>E(f)?f.value=r:null),columns:l(D),data:l(g),size:"small",loading:l(T),remote:"","row-key":r=>r.id,pagination:l(g).length?l(O):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])):(N(),I(Be,{key:1,data:P.value},null,8,["data"])),a(me,{show:C.value,"onUpdate:show":e[5]||(e[5]=r=>C.value=r),preset:"card",class:"w-320px"},{footer:s(()=>[a(B,{justify:"end"},{default:s(()=>[a(l(x),{size:"small",class:"mt-16px",onClick:X},{default:s(()=>[b(y("关闭"))]),_:1})]),_:1})]),default:s(()=>[a(de,{label:"日期","label-placement":"left"},{default:s(()=>[a(ce,{value:M.value,"onUpdate:value":[e[4]||(e[4]=r=>M.value=r),W],type:"month",clearable:""},null,8,["value"])]),_:1}),j("h2",null,"月均方根误差："+y(z.value),1)]),_:1},8,["show"])]),_:1})])}}}),Ye=K(je,[["__scopeId","data-v-da24fced"]]);export{Ye as default};
