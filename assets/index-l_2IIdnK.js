import{_ as we}from"./table-column-setting.vue_vue_type_script_setup_true_lang-wg2gG8-g.js";import{_ as ke}from"./round-delete-D4L8cFSG.js";import{_ as xe}from"./round-add-DLCeQidU.js";import{d as te,at as ee,q as se,v as Ce,r as J,s as ie,a as De,av as re,aw as ze,bV as Ne,c_ as Se,c$ as Te,c as N,o as f,w as l,f as t,ax as je,G as ue,h as n,az as pe,C as j,b as Q,z as W,g as h,e as R,t as x,aA as Ue,B as U,aB as $e,N as ae,$ as B,aE as Pe,co as de,aH as ce,F as qe,U as me,M as Re,i as Be,y as Z,aN as X,ay as Fe,D as Y,aO as Ie,d0 as le,d1 as Le,aT as Me}from"./index-DGUcENSr.js";import{u as Oe,a as Ve}from"./table-HKMVZpN7.js";import{u as fe}from"./usePageData-sV11lU9N.js";import{u as Ae}from"./upload-DdoSrBwX.js";import{_ as ve}from"./Grid-CdB95U0v.js";import{_ as ge}from"./FormItemGridItem-Dp5OUVYm.js";import{_ as Ee}from"./round-search-vjsXa7os.js";import{_ as Ge}from"./round-refresh-MpvJTZK9.js";import{N as ne}from"./Popconfirm-Dvjf2XfF.js";import"./v4-FuVw324d.js";const He={key:0,style:{"margin-left":"20px"}},Ke={key:0,style:{"margin-left":"20px"}},Je={key:0,style:{"margin-left":"20px"}},Qe={key:0,style:{"margin-left":"20px"}},We=te({name:"OperateDrawer",__name:"operate-drawer",props:ee({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ee(["submitted"],["update:visible"]),setup(P,{emit:O}){const S=O,F=se(),C=P,e=Ce(T());J();function T(){return{pid:void 0,id:"",affectedbusiness:"",devname:"",apidocument:"",uid:void 0,period:"",notes:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const v=J([]),{pageData:b,getData:D,nextPage:I}=fe(de),V=async r=>{const a=r.currentTarget,s=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&b.data.length<b.total&&(await I(),v.value=b.data,await ce(),setTimeout(()=>{a.scrollTop=s}))},A=async()=>{var r;await D({fuzzy:F.userInfo.pname,page:1}),v.value=b.data,e.pid=C.pid?C.pid:(r=v.value[0])==null?void 0:r.id},E=async()=>{await D({page:1}),v.value=b.data},G=async r=>{e.pid=r};async function q(){A(),Object.assign(e,T()),C.operateType==="edit"&&C.rowData&&Object.assign(e,C.rowData)}const{formRef:H,validate:K,restoreValidation:M}=ie(),d={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},affectedbusiness:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},apidocument:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},period:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},uid:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},u=De(()=>({add:"新增需要开发",edit:"修改需要开发"})[C.operateType]),g=re(P,"visible");async function $(r){if(r)try{const s=await(await fetch(r==null?void 0:r.split("?")[0],{mode:"cors"})).blob(),_=URL.createObjectURL(s),k=document.createElement("a");k.href=_,k.download=r==null?void 0:r.split("?")[1],k.style.display="none",document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(_)}catch(a){console.error("下载失败:",a)}}ze(g,()=>{g.value&&(q(),setTimeout(()=>{const r=document.querySelector(".n-scrollbar-content");r==null||r.scrollTo(0,0)},300),M())});const p=J(0),m=J("");async function c({file:r},a){p.value=0,m.value=a;const s=await Ae(r.file,r.name,"",_=>{p.value=_});s&&(e[a]=s,p.value=0)}function i(){g.value=!1}const w=Ne.debounce(async()=>{await L()},1e3,{leading:!0,trailing:!1});async function L(){var r,a;if(await K(),C.operateType==="edit"){const{data:s,error:_}=await Se([e]);_||(i(),S("submitted"),(r=window.$message)==null||r.success("修改成功"))}else{const{data:s,error:_}=await Te([{...e}]);_||(i(),S("submitted"),(a=window.$message)==null||a.success("添加成功"))}}return(r,a)=>{const s=ge,_=Ue,k=$e,z=ve,_e=ue,ye=je,he=ae,be=Pe;return f(),N(be,{show:g.value,"onUpdate:show":a[19]||(a[19]=o=>g.value=o),title:u.value,preset:"card",class:"w-800px"},{footer:l(()=>[t(he,{justify:"end",size:16},{default:l(()=>[t(n(U),{onClick:i},{default:l(()=>[h(x(n(B)("common.cancel")),1)]),_:1}),t(n(U),{type:"primary",onClick:n(w)},{default:l(()=>[h(x(n(B)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:l(()=>[t(ye,{class:"pr-20px"},{default:l(()=>[t(_e,{ref_key:"formRef",ref:H,model:e,rules:d,"label-placement":"left","label-width":120},{default:l(()=>[t(z,{responsive:"screen","item-responsive":""},{default:l(()=>[t(s,{span:"24 m:12",label:"项目列表",path:"pid"},{default:l(()=>[t(n(pe),{clearable:"",filterable:"",value:e.pid,"onUpdate:value":[a[0]||(a[0]=o=>e.pid=o),G],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:E,options:v.value,onScroll:V},null,8,["value","options"])]),_:1}),t(s,{span:"24 m:12",label:"影响的业务",path:"affectedbusiness"},{default:l(()=>[t(n(j),{value:e.affectedbusiness,"onUpdate:value":a[1]||(a[1]=o=>e.affectedbusiness=o),placeholder:"请输入"},null,8,["value"])]),_:1}),t(s,{span:"24 m:12",label:"设备名称",path:"devname"},{default:l(()=>[t(n(j),{value:e.devname,"onUpdate:value":a[2]||(a[2]=o=>e.devname=o),placeholder:"请输入"},null,8,["value"])]),_:1}),t(s,{span:"24 m:12",label:"接口文档",path:"apidocument"},{default:l(()=>[t(n(j),{value:e.apidocument,"onUpdate:value":a[3]||(a[3]=o=>e.apidocument=o),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(s,{span:"24 m:12",label:"研发对接人",path:"uid"},{default:l(()=>[t(n(j),{value:e.uid,"onUpdate:value":a[4]||(a[4]=o=>e.uid=o),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(s,{span:"24 m:12",label:"研发周期",path:"period"},{default:l(()=>[t(n(j),{value:e.period,"onUpdate:value":a[5]||(a[5]=o=>e.period=o),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(s,{span:"24 m:12",label:"备注",path:"notes"},{default:l(()=>[t(n(j),{value:e.notes,"onUpdate:value":a[6]||(a[6]=o=>e.notes=o),placeholder:"请输入"},null,8,["value"])]),_:1}),t(s,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:l(()=>[t(z,{responsive:"screen","item-responsive":""},{default:l(()=>[t(s,{span:"24 m:12",label:"附件1",path:"notes"},{default:l(()=>[t(n(j),{value:e.re1,"onUpdate:value":a[7]||(a[7]=o=>e.re1=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(s,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[e.fl1?(f(),Q("span",He,[h(x((o=e.fl1)==null?void 0:o.split("?")[1])+" ",1),R("span",{class:"cursor-pointer c-#c92a2a",onClick:a[8]||(a[8]=y=>e.fl1="")},"删除"),R("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[9]||(a[9]=y=>$(e.fl1))},"下载")])):(f(),N(_,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":y=>c(y,"fl1"),"show-file-list":!1},{default:l(()=>[t(n(U),{loading:p.value>0&&!e.fl1&&m.value=="fl1",size:"small",ghost:"",type:"primary"},{default:l(()=>[h(x(p.value>0&&!e.fl1&&m.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!e.fl1&&m.value=="fl1"?(f(),N(k,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):W("",!0)]}),_:1})]),_:1})]),_:1}),t(s,{span:"24 m:12",label:"附件2",path:"notes"},{default:l(()=>[t(n(j),{value:e.re2,"onUpdate:value":a[10]||(a[10]=o=>e.re2=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(s,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[e.fl2?(f(),Q("span",Ke,[h(x((o=e.fl2)==null?void 0:o.split("?")[1])+" ",1),R("span",{class:"cursor-pointer c-#c92a2a",onClick:a[11]||(a[11]=y=>e.fl2="")},"删除"),R("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[12]||(a[12]=y=>$(e.fl2))},"下载")])):(f(),N(_,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":y=>c(y,"fl2"),"show-file-list":!1},{default:l(()=>[t(n(U),{loading:p.value>0&&!e.fl2&&m.value=="fl2",size:"small",ghost:"",type:"primary"},{default:l(()=>[h(x(p.value>0&&!e.fl2&&m.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!e.fl2&&m.value=="fl2"?(f(),N(k,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):W("",!0)]}),_:1}),t(s,{span:"24 m:12",label:"附件3",path:"notes"},{default:l(()=>[t(n(j),{value:e.re3,"onUpdate:value":a[13]||(a[13]=o=>e.re3=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(s,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[e.fl3?(f(),Q("span",Je,[h(x((o=e.fl3)==null?void 0:o.split("?")[1])+" ",1),R("span",{class:"cursor-pointer c-#c92a2a",onClick:a[14]||(a[14]=y=>e.fl3="")},"删除"),R("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[15]||(a[15]=y=>$(e.fl3))},"下载")])):(f(),N(_,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":y=>c(y,"fl3"),"show-file-list":!1},{default:l(()=>[t(n(U),{loading:p.value>0&&!e.fl3&&m.value=="fl3",size:"small",ghost:"",type:"primary"},{default:l(()=>[h(x(p.value>0&&!e.fl3&&m.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!e.fl3&&m.value=="fl3"?(f(),N(k,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):W("",!0)]}),_:1}),t(s,{span:"24 m:12",label:"附件4",path:"notes"},{default:l(()=>[t(n(j),{value:e.re4,"onUpdate:value":a[16]||(a[16]=o=>e.re4=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(s,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[e.fl4?(f(),Q("span",Qe,[h(x((o=e.fl2)==null?void 0:o.split("?")[1])+" ",1),R("span",{class:"cursor-pointer c-#c92a2a",onClick:a[17]||(a[17]=y=>e.fl4="")},"删除"),R("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[18]||(a[18]=y=>$(e.fl4))},"下载")])):(f(),N(_,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":y=>c(y,"fl4"),"show-file-list":!1},{default:l(()=>[t(n(U),{loading:p.value>0&&!e.fl4&&m.value=="fl4",size:"small",ghost:"",type:"primary"},{default:l(()=>[h(x(p.value>0&&!e.fl4&&m.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!e.fl4&&m.value=="fl4"?(f(),N(k,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):W("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Xe=te({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ee(["reset","search","clear"],["update:model"]),setup(P,{emit:O}){const S=O,{formRef:F,restoreValidation:C}=ie(),e=re(P,"model"),T=se(),v=J([]),{pageData:b,getData:D,nextPage:I}=fe(de),V=async d=>{const u=d.currentTarget,g=u.scrollTop;u.scrollTop+u.offsetHeight>=u.scrollHeight&&b.data.length<b.total&&(await I(),v.value=b.data,await ce(),setTimeout(()=>{u.scrollTop=g}))},A=async d=>{var u;d?(e.value.pid=d,S("search"),T.setProjectInfo({pname:(u=v.value.find(g=>g.id==d))==null?void 0:u.proname,pid:d})):S("clear")},E=async d=>{await D({fuzzy:d,page:1}),v.value=b.data},G=async()=>{await D({page:1}),v.value=b.data};(async()=>{var d,u;await D({fuzzy:T.userInfo.pname}),v.value=b.data,e.value.pid=T.userInfo.pid?T.userInfo.pid:(d=v.value[0])==null?void 0:d.id,T.setProjectInfo({pid:e.value.pid,pname:(u=v.value.find(g=>g.id==e.value.pid))==null?void 0:u.proname}),S("search")})();async function H(){await C(),e.value.fuzzy="",S("reset")}const K=()=>{e.value.fuzzy="",S("search")};async function M(){var d,u;e.value.pid?S("search"):((d=window.$message)==null||d.destroyAll(),(u=window.$message)==null||u.warning("请选择项目"))}return(d,u)=>{const g=pe,$=ge,p=j,m=Ge,c=U,i=Ee,w=ae,L=ve,r=ue,a=me;return f(),N(a,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[t(r,{ref_key:"formRef",ref:F,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:qe(M,["enter"])},{default:l(()=>[t(L,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[t($,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:l(()=>[t(g,{filterable:"",clearable:"",value:e.value.pid,"onUpdate:value":[u[0]||(u[0]=s=>e.value.pid=s),A],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:v.value,onScroll:V,onClear:G,onSearch:E},null,8,["value","options"])]),_:1}),t($,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:l(()=>[t(p,{value:e.value.fuzzy,"onUpdate:value":u[1]||(u[1]=s=>e.value.fuzzy=s),placeholder:"请输入",clearable:"",onClear:K},null,8,["value"])]),_:1}),t($,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[t(w,{class:"w-full"},{default:l(()=>[t(c,{onClick:H},{icon:l(()=>[t(m,{class:"text-icon"})]),default:l(()=>[h(" "+x(n(B)("common.reset")),1)]),_:1}),t(c,{type:"primary",ghost:"",onClick:M},{icon:l(()=>[t(i,{class:"text-icon"})]),default:l(()=>[h(" "+x(n(B)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ye={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function oe(P){return typeof P=="function"||Object.prototype.toString.call(P)==="[object Object]"&&!Me(P)}const ct=te({name:"projectmanagement_need",__name:"index",setup(P){const O=Re(),{columns:S,columnChecks:F,data:C,getData:e,loading:T,pagination:v,mobilePagination:b,searchParams:D}=Oe({showTotal:!0,immediate:!1,apiFn:Le,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"affectedbusiness",title:"影响的业务",align:"center",width:120},{key:"devname",title:"设备名称",align:"center",width:120},{key:"apidocument",title:"接口文档",align:"center",width:120},{key:"uid",title:"研发对接人",align:"center",width:120},{key:"period",title:"研发周期",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"操作人",align:"center",width:120},{key:"dbtime",title:"操作时间",align:"center",width:120},{key:"operate",title:B("common.operate"),align:"center",width:140,fixed:"right",render:c=>{let i;return t("div",{class:"flex-center gap-8px"},[Y(t(U,{type:"primary",ghost:!0,size:"small",onClick:()=>u(c.id)},oe(i=B("common.edit"))?i:{default:()=>[i]}),[[Z("no-auth"),"project:Development:update"]]),t(ne,{onPositiveClick:()=>d(c.id)},{default:()=>B("common.confirmDelete"),trigger:()=>{let w;return Y(t(U,{type:"error",ghost:!0,size:"small"},oe(w=B("common.delete"))?w:{default:()=>[w]}),[[Z("no-auth"),"project:Development:delete"]])}})])}}]}),{drawerVisible:I,operateType:V,editingData:A,handleAdd:E,handleEdit:G,checkedRowKeys:q,onBatchDeleted:H,onDeleted:K}=Ve(C,e);Be(async()=>{});async function M(){console.log(q.value),g(q.value.join(","),c=>{H()})}async function d(c){const{data:i,error:w}=await le(c,D.pid);w||K()}function u(c){G(c)}async function g(c,i){const{data:w,error:L}=await le(c,D.pid);if(!L)i&&i(w);else return!1}const $=c=>{e()},p=()=>{C.value=[],v.itemCount=0},m=()=>{e()};return(c,i)=>{const w=ae,L=xe,r=ke,a=we,s=Fe,_=me,k=Z("no-auth");return f(),Q("div",Ye,[t(Xe,{model:n(D),"onUpdate:model":i[0]||(i[0]=z=>X(D)?D.value=z:null),onReset:m,onSearch:n(e),onClear:p},null,8,["model","onSearch"]),t(_,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[t(w,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>i[4]||(i[4]=[R("div",null,"需要开发",-1)])),_:1,__:[4]})]),"header-extra":l(()=>[t(w,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[Y((f(),N(n(U),{onClick:n(E),size:"small",ghost:"",type:"primary"},{icon:l(()=>[t(L,{class:"text-icon"})]),default:l(()=>[i[5]||(i[5]=h(" "+x("新增")))]),_:1,__:[5]},8,["onClick"])),[[k,"project:Development:insert"]]),t(n(ne),{onPositiveClick:M},{trigger:l(()=>[Y((f(),N(n(U),{size:"small",ghost:"",type:"error",disabled:n(q).length==0},{icon:l(()=>[t(r,{class:Ie(["text-icon",{"animate-spin":n(T)}])},null,8,["class"])]),default:l(()=>[i[6]||(i[6]=h(" "+x("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[k,"project:Development:delete"]])]),default:l(()=>[i[7]||(i[7]=h(" 确定要删除选中的吗？ "))]),_:1,__:[7]}),t(a,{columns:n(F),"onUpdate:columns":i[1]||(i[1]=z=>X(F)?F.value=z:null)},null,8,["columns"])]),_:1})]),default:l(()=>[t(s,{"checked-row-keys":n(q),"onUpdate:checkedRowKeys":i[2]||(i[2]=z=>X(q)?q.value=z:null),columns:n(S),data:n(C),size:"small","flex-height":!n(O).isMobile,loading:n(T),remote:"","row-key":z=>z.id,pagination:n(b),class:"sm:h-full","onUpdate:filters":$},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(We,{visible:n(I),"onUpdate:visible":i[3]||(i[3]=z=>X(I)?I.value=z:null),onSubmitted:n(e),pid:n(D).pid,"operate-type":n(V),"row-data":n(A)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{ct as default};
