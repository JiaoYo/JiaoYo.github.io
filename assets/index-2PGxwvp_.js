import{_ as de}from"./table-column-setting.vue_vue_type_script_setup_true_lang-B88JK01T.js";import{_ as pe}from"./refresh-4XfYp-vl.js";import{_ as me}from"./round-delete-B9QkyDvI.js";import{_ as _e}from"./round-plus-Cdh74-sn.js";import{d as q,n as W,p as X,q as Y,b as fe,r as he,a7 as ve,y as j,o as V,c as K,w as t,g as e,h as d,t as x,i as n,$ as c,A as Z,z as N,d3 as ee,d4 as ge,d5 as ye,J as te,K as be,aB as we,L as A,aC as ke,M as ae,B as S,bQ as Ce,bR as xe,a2 as ne,V as Ne,d6 as De,aQ as ze,j as Q,d7 as Se,d8 as $e,e as Ie,am as G,f as oe,ab as Ue,an as Be,b$ as Pe,ap as Re}from"./index-CQx2Ff8S.js";import{u as Te,a as Me}from"./table-DuoXvLRN.js";import{f as je,a as Ve}from"./basic_config-SyHo6lJb.js";import{_ as Fe}from"./round-search-LdwHnU1M.js";import{_ as Ge}from"./round-refresh-BmORLM_E.js";import{_ as Ke}from"./FormItemGridItem-CAzxroJb.js";import{_ as Le}from"./Grid-Nz05qrRN.js";import{N as J}from"./Popconfirm-Cyyoenj2.js";const Oe=q({name:"OperateDrawer",__name:"operate-drawer",props:W({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:W(["submitted"],["update:visible"]),setup(v,{emit:P}){const p=v,y=P,f=X(v,"visible"),{formRef:s,validate:$,restoreValidation:R}=Y(),D=fe(()=>({add:"新增白名单",edit:"编辑白名单"})[p.operateType]),r=he(u());function u(){return{ip:"",status:0,sysparam:0,dscb:""}}const T={ip:{required:!0,validator:ee,trigger:["input","change","blur","password-input"]}};function g(){Object.assign(r,u()),p.operateType==="edit"&&p.rowData&&Object.assign(r,p.rowData)}function h(){f.value=!1}async function b(){var w,l;if(await $(),p.operateType==="add"){const{data:k,error:i}=await ge([r]);i||((w=window.$message)==null||w.success(c("common.addSuccess")),h(),y("submitted"))}else{const{data:k,error:i}=await ye([r]);i||((l=window.$message)==null||l.success(c("common.updateSuccess")),h(),y("submitted"))}}return ve(f,()=>{f.value&&(g(),R())}),(w,l)=>{const k=te,i=be,I=we,U=A,F=ke,B=ae,C=S,L=Ce,O=xe,M=j("no-space");return V(),K(O,{show:f.value,"onUpdate:show":l[3]||(l[3]=a=>f.value=a),"display-directive":"show",width:360},{default:t(()=>[e(L,{title:D.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(U,{size:16},{default:t(()=>[e(C,{onClick:h},{default:t(()=>[d(x(n(c)("common.cancel")),1)]),_:1}),e(C,{type:"primary",onClick:b,ghost:""},{default:t(()=>[d(x(n(c)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(B,{ref_key:"formRef",ref:s,model:r,rules:T,onKeyup:Z(b,["enter"])},{default:t(()=>[e(i,{label:"IP",path:"ip"},{default:t(()=>[N(e(k,{clearable:"",value:r.ip,"onUpdate:value":l[0]||(l[0]=a=>r.ip=a),placeholder:"请输入IP"},null,8,["value"]),[[M]])]),_:1}),e(i,{label:"状态"},{default:t(()=>[e(F,{value:r.status,"onUpdate:value":l[1]||(l[1]=a=>r.status=a),name:"radiogroup"},{default:t(()=>[e(U,null,{default:t(()=>[e(I,{value:0},{default:t(()=>[d("启用")]),_:1}),e(I,{value:1},{default:t(()=>[d("禁用")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),e(i,{label:"描述",path:"dscb"},{default:t(()=>[N(e(k,{clearable:"",value:r.dscb,"onUpdate:value":l[2]||(l[2]=a=>r.dscb=a),placeholder:"请输入描述"},null,8,["value"]),[[M]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),We=q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:W(["reset","search"],["update:model"]),setup(v,{emit:P}){const p=P,{formRef:y,restoreValidation:f}=Y(),s=X(v,"model"),$={ip:[{validator:ee,trigger:["blur","change","input"]}]};function R(){s.value.fuzzy=void 0,s.value.ip=s.value.ip==""?void 0:s.value.ip,p("search")}function D(){s.value.ip=void 0,p("search")}async function r(){await f(),p("reset")}async function u(){p("search")}return(T,g)=>{const h=te,b=Ke,w=Ge,l=S,k=Fe,i=A,I=Le,U=ae,F=ne,B=j("no-space");return V(),K(F,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(U,{ref_key:"formRef",ref:y,model:s.value,"label-placement":"left",rules:$,"label-width":80,"show-require-mark":!1,onKeyup:Z(u,["enter"])},{default:t(()=>[e(I,{responsive:"screen","item-responsive":""},{default:t(()=>[e(b,{span:"24 s:12 m:6",label:"名称",path:"fuzzy",class:"pr-24px"},{default:t(()=>[N(e(h,{clearable:"",value:s.value.fuzzy,"onUpdate:value":g[0]||(g[0]=C=>s.value.fuzzy=C),placeholder:"请输入关键字",onClear:R},null,8,["value"]),[[B]])]),_:1}),e(b,{span:"24 s:12 m:6",label:"IP",path:"ip",class:"pr-24px"},{default:t(()=>[N(e(h,{clearable:"",value:s.value.ip,"onUpdate:value":g[1]||(g[1]=C=>s.value.ip=C),placeholder:"请输入IP",onClear:D},null,8,["value"]),[[B]])]),_:1}),e(b,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(i,{class:"w-full"},{default:t(()=>[e(l,{onClick:r},{icon:t(()=>[e(w,{class:"text-icon"})]),default:t(()=>[d(" "+x(n(c)("common.reset")),1)]),_:1}),e(l,{type:"primary",ghost:"",onClick:u},{icon:t(()=>[e(k,{class:"text-icon"})]),default:t(()=>[d(" "+x(n(c)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),qe={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"},Ae=oe("div",null,"白名单",-1),Ee={class:"font-size-14px flex align-center gap-8px"};function H(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Be(v)}const lt=q({name:"manage_whitelist",__name:"index",setup(v){const P=Ne(),{columns:p,columnChecks:y,data:f,getData:s,loading:$,mobilePagination:R,searchParams:D,resetSearchParams:r}=Te({apiFn:De,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,ip:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,disabled:a=>a.sysparam==0},{key:"ip",title:"IP地址",align:"center",width:240},{key:"dscb",title:"描述",align:"center",width:240},{key:"status",title:"状态",width:100,align:"center",render:a=>(a.status===null&&(a.status=0),e(ze,{type:{0:"success",1:"error"}[a.status]},{default:()=>[a.status==0?"启用":"禁用"]}))},{key:"operate",title:c("common.operate"),align:"center",width:130,render:a=>{let o;return e("div",{class:"flex-center gap-8px"},[N(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>O(a.id),disabled:a.sysparam==0||u.value==0},H(o=c("common.edit"))?o:{default:()=>[o]}),[[j("no-auth"),"sys.white.list.update"]]),e(J,{onPositiveClick:()=>L(a.id)},{default:()=>c("common.confirmDelete"),trigger:()=>{let m;return N(e(S,{type:"error",ghost:!0,size:"small",disabled:a.sysparam==0||u.value==0},H(m=c("common.delete"))?m:{default:()=>[m]}),[[j("no-auth"),"sys.white.list.delete"]])}})])}}]}),u=Q(),T=Q(),g=async()=>{const{data:a,error:o}=await je();if(!o)u.value=a.whiteenable,T.value=a.id;else return!1};g();const{drawerVisible:h,operateType:b,editingData:w,handleAdd:l,handleEdit:k,checkedRowKeys:i,onBatchDeleted:I,onDeleted:U,closeDrawer:F}=Me(f,s),B=async a=>{var z;const{data:o,error:m}=await Ve({whiteenable:a?1:0,id:T.value});if(!m)(z=window.$message)==null||z.success("操作成功"),g();else return!1};async function C(){console.log(i.value),M(i.value.join(","),a=>{I()})}function L(a){console.log(a),M(a,o=>{U()})}function O(a){k(a),Se({id:a}).then(({data:o,error:m})=>{m||console.log(o)})}async function M(a,o){const{data:m,error:z}=await $e(a);if(!z)o&&o(m);else return!1}return(a,o)=>{const m=Pe,z=A,se=_e,le=me,ie=pe,re=de,ce=Re,ue=ne,E=j("no-auth");return V(),Ie("div",qe,[e(We,{model:n(D),"onUpdate:model":o[0]||(o[0]=_=>G(D)?D.value=_:null),onReset:n(r),onSearch:n(s)},null,8,["model","onReset","onSearch"]),e(ue,{bordered:!1,size:"small",class:"sm:flex-1-hidden"},{header:t(()=>[e(z,{align:"center"},{default:t(()=>[Ae,oe("div",Ee,[d(" 是否启用白名单"),e(m,{value:u.value,"onUpdate:value":[o[1]||(o[1]=_=>u.value=_),B],"checked-value":1,"unchecked-value":0},{checked:t(()=>[d(" 是 ")]),unchecked:t(()=>[d(" 否 ")]),_:1},8,["value"])])]),_:1})]),"header-extra":t(()=>[e(z,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[N((V(),K(n(S),{size:"small",ghost:"",type:"primary",onClick:n(l),disabled:u.value==0},{icon:t(()=>[e(se,{class:"text-icon"})]),default:t(()=>[d(" "+x(n(c)("common.add")),1)]),_:1},8,["onClick","disabled"])),[[E,"sys.white.list.insert"]]),N((V(),K(n(J),{onPositiveClick:C},{trigger:t(()=>[e(n(S),{size:"small",ghost:"",type:"error",disabled:n(i).length===0||u.value==0},{icon:t(()=>[e(le,{class:"text-icon"})]),default:t(()=>[d(" "+x(n(c)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:t(()=>[d(" "+x(n(c)("common.confirmDelete")),1)]),_:1})),[[E,"sys.white.list.delete"]]),e(n(S),{size:"small",onClick:n(s)},{icon:t(()=>[e(ie,{class:Ue(["text-icon",{"animate-spin":n($)}])},null,8,["class"])]),default:t(()=>[d(" "+x(n(c)("common.refresh")),1)]),_:1},8,["onClick"]),e(re,{columns:n(y),"onUpdate:columns":o[2]||(o[2]=_=>G(y)?y.value=_:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ce,{"checked-row-keys":n(i),"onUpdate:checkedRowKeys":o[3]||(o[3]=_=>G(i)?i.value=_:null),columns:n(p),data:n(f),size:"small","flex-height":!n(P).isMobile,"scroll-x":962,loading:n($),remote:"","row-key":_=>_.id,pagination:n(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Oe,{visible:n(h),"onUpdate:visible":o[4]||(o[4]=_=>G(h)?h.value=_:null),"operate-type":n(b),"row-data":n(w),onSubmitted:n(s)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{lt as default};
