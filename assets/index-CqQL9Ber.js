import{_ as X}from"./table-column-setting.vue_vue_type_script_setup_true_lang-C9U6osR4.js";import{_ as Y}from"./refresh-C3aYfWsn.js";import{d as F,q,v as Z,s as J,L as B,o as O,c as W,w as o,g as e,M as E,h as w,t as V,i as s,$ as T,N as ee,A as te,B as z,E as I,D as ae,aa as H,dB as oe,a1 as ne,j as b,y as se,f as P,a7 as le,S as Q,F as re,az as ie,aA as ce,aw as pe,a0 as de,V as ue,r as U,aV as me,e as _e,ad as G,bs as fe,ay as ve}from"./index-BAVDbSG0.js";import{a as ge,b as he,c as j,d as ye}from"./reportForm-BxN-DHwA.js";import{u as xe}from"./table-KJ4OXJa6.js";import{_ as we}from"./round-search-Bcb0t4Jv.js";import{_ as be}from"./round-refresh-yP8uig6G.js";import{_ as ke}from"./FormItemGridItem-xXViKYEE.js";import{_ as Se}from"./Grid-BDOf_ubP.js";import{T as Pe}from"./task-qDBTAl0-.js";import{f as Ce,a as $e,_ as Ne,b as ze,c as Re,d as De}from"./templateDataFilter-DslEpKED.js";import{_ as K}from"./Popconfirm-CUDFKPM8.js";import{_ as Be}from"./DataTable-BDYCfsCN.js";import"./setting-outlined-D3n2FZ9Z.js";import"./index-BS8KoN7o.js";import"./installCanvasRenderer-iCPGNWhM.js";import"./Forward-edmZhOxW.js";const Ee=F({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["reset","search"],["update:model"]),setup(_,{emit:k}){const S=k,{formRef:l,restoreValidation:f}=Z(),r=J(_,"model"),u=()=>{r.value.fuzzy="",i()};async function C(){await f(),S("reset")}async function i(){S("search")}return(R,n)=>{const $=te,v=ke,N=be,y=z,x=we,g=I,m=Se,A=ae,L=H,M=B("no-space");return O(),W(L,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[e(A,{ref_key:"formRef",ref:l,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ee(i,["enter"])},{default:o(()=>[e(m,{responsive:"screen","item-responsive":""},{default:o(()=>[e(v,{span:"24 s:12 m:6",label:"实例名称",path:"alatype",class:"pr-24px"},{default:o(()=>[E(e($,{autofocus:"",value:r.value.fuzzy,"onUpdate:value":n[0]||(n[0]=a=>r.value.fuzzy=a),placeholder:"请输入实例名称关键字",clearable:"",onClear:u},null,8,["value"]),[[M]])]),_:1}),e(v,{span:"24 m:6",class:"pr-24px"},{default:o(()=>[e(g,{class:"w-full"},{default:o(()=>[e(y,{onClick:C},{icon:o(()=>[e(N,{class:"text-icon"})]),default:o(()=>[w(" "+V(s(T)("common.reset")),1)]),_:1}),e(y,{type:"primary",ghost:"",onClick:i},{icon:o(()=>[e(x,{class:"text-icon"})]),default:o(()=>[w(" "+V(s(T)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ie=_=>(ie("data-v-012ddadc"),_=_(),ce(),_),Te=Ie(()=>P("span",{class:"mr-20px"},"报表预览",-1)),Ae={title:"导出PDF"},Le={title:"导出Word"},Me={title:"导出Excel"},Ve=F({name:"reportPreview",__name:"reportPreview",props:q({data:{},detaliParams:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(_){oe(R=>({a798f7c4:s(S)}));const k=ne(),S=k.themeScheme=="dark"?"#001428":"#fff",l=_,f=J(_,"visible"),r=b(),u=b(""),C=()=>{l.detaliParams.rtype==0?(r.value=Ce(l.data,void 0),u.value=l.detaliParams.name+"_资产信息表"):l.detaliParams.rtype==1&&(r.value=$e(l.data,l.data.time),u.value=l.detaliParams.name+"_审计信息表")};se(f,()=>{f.value&&C()});const i=b();return(R,n)=>{const $=Ne,v=ze,N=Re,y=De,x=Q,g=re;return O(),W(g,{show:f.value,"onUpdate:show":n[3]||(n[3]=m=>f.value=m),preset:"card",class:"w-1000px reportPreview",style:le({"background-color":s(k).themeScheme=="dark"?"#001428":"#fff"})},{header:o(()=>[Te,P("span",Ae,[e($,{class:"text-32px c-#d63031 cursor-pointer",onClick:n[0]||(n[0]=m=>i.value.toPdf(u.value))})]),P("span",Le,[e(v,{class:"text-32px c-#1e90ff cursor-pointer",onClick:n[1]||(n[1]=m=>i.value.toWord(u.value))})]),P("span",Me,[e(N,{class:"text-32px c-#15703d cursor-pointer",onClick:n[2]||(n[2]=m=>i.value.toExcel(u.value))})])]),default:o(()=>[e(x,{class:"max-h-600px"},{default:o(()=>[e(y,{ref_key:"filePreviewExportRef",ref:i,width:800,data:r.value},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),Fe=pe(Ve,[["__scopeId","data-v-012ddadc"]]),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ue=P("div",{style:{display:"flex","align-items":"center"}},[P("div",null,"报表实例")],-1),lt=F({name:"reportmanagement_reportlist",__name:"index",setup(_){const k=de(),{columns:S,columnChecks:l,data:f,getData:r,loading:u,mobilePagination:C,searchParams:i,resetSearchParams:R}=xe({apiFn:ge,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:a=>!0,renderExpand:a=>e("div",{class:"detailList"},[e(Q,{style:"max-height: 360px"},{default:()=>[v.value.length>0?v.value.map((t,c)=>e(I,{justify:"space-between",style:{marginBottom:"8px",padding:"0px 50px 8px 50px",borderBottom:c!==v.value.length-1?"1px dashed #ccc":"none"},key:t.sn},{default:()=>[e("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[t.sn]),e(I,null,{default:()=>[E(e(z,{type:"info",size:"small",ghost:!0,onClick:()=>A(t.sn,a.rtype)},{default:()=>[w("查看")]}),[[B("no-auth"),"sys.report.instance.select"]]),e(K,{onPositiveClick:()=>M(t.sn,a.rtype,a.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>E(e(z,{type:"error",size:"small",ghost:!0},{default:()=>[w("删除")]}),[[B("no-auth"),"sys.report.instance.delete"]])})]})]})):e("div",{style:{textAlign:"center",padding:"10px"}},[w("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:a=>{var t;return e("div",null,[(t=ue(Pe).find(c=>c.value===a.rtype))==null?void 0:t.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:T("common.operate"),align:"center",width:160,render:a=>e("div",{class:"flex-center gap-8px"},[e(K,{onPositiveClick:()=>L(a.tid,a.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>E(e(z,{type:"primary",ghost:!0,size:"small"},{default:()=>[w("清空")]}),[[B("no-auth"),"sys.report.instance.delete"]])})])}]}),n=b([]),$=a=>{n.value=[a[a.length-1]],n.value[0]&&y()},v=b([]),N=U({page:1,limit:10}),y=async()=>{const a=JSON.parse(JSON.stringify(f.value)).find(p=>p.tid===n.value[0]),{data:t,error:c}=await ye({tid:n.value[0],page:N.page,limit:Number(a.num)||10});c||(v.value=t.list,ve(()=>{const p=document.querySelector(".detailList");if(p){const{height:d}=p.getBoundingClientRect();p.animate([{height:"0px"},{height:`${d}px`}],{duration:300,easing:"linear"})}}))},x=b(!1),g=b({}),m=U({name:"",rtype:0}),A=async(a,t)=>{const{data:c,error:p}=await he({name:a,type:t,tid:n.value[0]});m.name=a,m.rtype=t,p||(x.value=!0,g.value=JSON.parse(c),g.value.baseInfo=g.value.baseInfo.map(d=>({...d,dbtime:me(1,d.dbtime)})))},L=async(a,t)=>{var d;const{data:c,error:p}=await j({tid:a,type:t});p||((d=window.$message)==null||d.success("清空成功"),r())},M=async(a,t,c)=>{var D;const{data:p,error:d}=await j({fname:a,type:t,tid:c});d||((D=window.$message)==null||D.success("删除成功"),r(),y())};return(a,t)=>{const c=Y,p=X,d=Be,D=H;return O(),_e("div",Oe,[e(Ee,{model:s(i),"onUpdate:model":t[0]||(t[0]=h=>G(i)?i.value=h:null),onReset:s(R),onSearch:s(r)},null,8,["model","onReset","onSearch"]),e(D,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[Ue]),"header-extra":o(()=>[e(s(I),null,{default:o(()=>[e(s(z),{size:"small",onClick:t[1]||(t[1]=h=>s(r)())},{icon:o(()=>[e(c,{class:fe(["text-icon",{"animate-spin":s(u)}])},null,8,["class"])]),default:o(()=>[w(" "+V(s(T)("common.refresh")),1)]),_:1}),e(p,{columns:s(l),"onUpdate:columns":t[2]||(t[2]=h=>G(l)?l.value=h:null)},null,8,["columns"])]),_:1})]),default:o(()=>[e(d,{columns:s(S),data:s(f),size:"small","flex-height":!s(k).isMobile,"scroll-x":962,loading:s(u),remote:"","row-key":h=>h.tid,pagination:s(C),class:"sm:h-full","expanded-row-keys":n.value,"onUpdate:expandedRowKeys":$},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),e(Fe,{visible:x.value,"onUpdate:visible":t[3]||(t[3]=h=>x.value=h),data:g.value,detaliParams:m},null,8,["visible","data","detaliParams"])]),_:1})])}}});export{lt as default};
