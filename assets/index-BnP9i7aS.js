import{d as K,q as j,v as X,s as Z,o as Y,c as ee,w as t,g as a,h as n,t as p,i as _,$ as U,N as le,ax as te,ao as J,ap as ae,Y as ne,A as oe,B as $,E as q,D as se,aa as Q,a0 as ie,j as I,r as P,bI as F,e as de,S as re,F as ue,ay as pe,az as ce,f as me,av as fe}from"./index-Cw03N3Zb.js";import{l as _e}from"./lodash-DLFwvCzM.js";import{_ as ge}from"./round-search-CjX6C_4m.js";import{_ as ve}from"./round-refresh-1h-Gpja5.js";import{_ as he}from"./Cascader-DGlMpFhY.js";import{_ as ye}from"./FormItemGridItem-SvsLsq5T.js";import{_ as xe}from"./DatePicker-Cc0Ehv65.js";import{_ as be}from"./Grid--xFJOl9N.js";import{w as Ie,x as Le}from"./events-DsZa0Xdn.js";import{b as Se}from"./common-V6hv81G8.js";import{e as Ce}from"./exportExcel-D6OyA9oJ.js";import{_ as Ee}from"./DataTable-Cl633dKI.js";import{_ as we,a as De}from"./DescriptionsItem-dlNRSzNw.js";import"./TimePicker-yNmPXDUd.js";import"./defineProperty-CoF7QmJA.js";import"./Forward-CjRKdAIx.js";const Ne={0:"KERN",1:"USER",2:"MAIL",3:"DAEMON",4:"AUTH",5:"SYSYLOG",6:"LPR",7:"NEWS",8:"UUCP",9:"CRON",10:"AUTHPRIV",11:"FTP",12:"RESERVED_12",13:"RESERVED_13",14:"RESERVED_14",15:"RESERVED_15",16:"LOCAL0",17:"LOCAL1",18:"LOCAL2",19:"LOCAL3",20:"LOCAL4",21:"LOCAL5",22:"LOCAL6",23:"LOCAL7"},ke={0:"EMERGENCY",1:"ALERT",2:"CRITICAL",3:"ERROR",4:"WARNING",5:"NOTICE",6:"INFO",7:"DEBUG"},W={logModel:Ne,logLevel:ke},Re=K({name:"FormSearch",__name:"form-search",props:j(["LogSourceDeviceList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:j(["search"],["update:model"]),setup(g,{emit:C}){const N=o=>Object.entries(o).map(([d,h])=>({label:h,value:d})),k={logLevel:N(W.logLevel),logModel:N(W.logModel)},L=g,G=C,{formRef:S,restoreValidation:v}=X(),e=Z(g,"model");async function u(o,d){o&&o.length>0?(e.value.startTime=o[0],e.value.endTime=o[1]):(e.value.startTime=void 0,e.value.endTime=void 0)}async function E(){await v(),e.value.lsid=null,e.value.leid=null,e.value.lmid=null,e.value.timeRange=null,e.value.startAndEndIp=null,te(()=>{G("search")})}async function f(){var o,d,h,m;if(e.value.startAndEndIp&&e.value.startAndEndIp.length>0?(e.value.startIp=e.value.startAndEndIp[0]||null,e.value.endIp=e.value.startAndEndIp[1]||null):(e.value.startIp=void 0,e.value.endIp=void 0),e.value.startIp&&!J(e.value.startIp)||e.value.endIp&&!J(e.value.endIp))return(o=window.$message)==null||o.destroyAll(),(d=window.$message)==null||d.error("请输入正确的IP地址"),!1;if(e.value.startIp&&e.value.endIp&&ae(e.value.startIp,e.value.endIp)>0)return(h=window.$message)==null||h.destroyAll(),(m=window.$message)==null||m.error("起始IP不能大于终止IP"),!1;G("search")}return(o,d)=>{const h=he,m=ye,b=ne,V=xe,z=oe,B=ve,R=$,y=ge,A=q,H=be,l=se,i=Q;return Y(),ee(i,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[a(l,{ref_key:"formRef",ref:S,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:le(f,["enter"])},{default:t(()=>[a(H,{responsive:"screen","item-responsive":""},{default:t(()=>[a(m,{span:"24 s:24 m:8",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:t(()=>[a(h,{value:e.value.lsid,"onUpdate:value":[d[0]||(d[0]=r=>e.value.lsid=r),f],placeholder:"请选择日志源设备",options:L.LogSourceDeviceList,disabled:L.logsoudev,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options","disabled"])]),_:1}),a(m,{span:"24 s:24 m:8",label:"级别",path:"leid",class:"pr-24px"},{default:t(()=>[a(b,{filterable:"",clearable:"",placeholder:"请选择级别",value:e.value.leid,"onUpdate:value":[d[1]||(d[1]=r=>e.value.leid=r),f],options:k.logLevel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(m,{span:"24 s:24 m:8",label:"日志模块",path:"lmid",class:"pr-24px"},{default:t(()=>[a(b,{filterable:"",clearable:"",placeholder:"请选择日志模块",value:e.value.lmid,"onUpdate:value":[d[2]||(d[2]=r=>e.value.lmid=r),f],options:k.logModel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(m,{span:"24 s:24 m:8",label:"时间",path:"time",class:"pr-24px mt-10px"},{default:t(()=>[a(V,{value:e.value.timeRange,"onUpdate:value":d[3]||(d[3]=r=>e.value.timeRange=r),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":u},null,8,["value"])]),_:1}),a(m,{span:"24 s:24 m:8",label:"IP",path:"startAndEndIp",class:"pr-24px mt-10px"},{default:t(()=>[a(z,{pair:"",separator:"-",placeholder:["发生源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndIp,"onUpdate:value":d[4]||(d[4]=r=>e.value.startAndEndIp=r)},null,8,["value"])]),_:1}),a(m,{span:"24 m:8",class:"pr-24px mt-10px",label:" "},{default:t(()=>[a(A,{class:"w-full"},{default:t(()=>[a(R,{onClick:E},{icon:t(()=>[a(B,{class:"text-icon"})]),default:t(()=>[n(" "+p(_(U)("common.reset")),1)]),_:1}),a(R,{type:"primary",ghost:"",onClick:f},{icon:t(()=>[a(y,{class:"text-icon"})]),default:t(()=>[n(" "+p(_(U)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ae=g=>(pe("data-v-67571477"),g=g(),ce(),g),Te={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Oe=Ae(()=>me("hr",{style:{"border-color":"#ccc","margin-bottom":"20px"}},null,-1)),Me=K({name:"eventalarm_generallog",__name:"index",props:{logsoudev:{}},setup(g){const C=g,N=ie(),k=I(window.innerHeight-395),L=I([]);(async()=>{const{data:l,error:i}=await Se();i||(L.value=l.map(r=>({...r,id:"-"+r.id,type:r.cname})))})();const S=I(!1),v=W,e=P({lsid:void 0,lsdn:"",rdbtime:"",lmid:void 0,leid:void 0,ltext:"",aname:"",procid:"",msgid:"",dbtime:"",hname:"",lcon:"",ip:"",lsip:"",priority:"",type:"",version:"",logtype:void 0}),u=P({pageId:void 0,pageSize:100,lsid:void 0,leid:void 0,lmid:void 0,startTime:void 0,endTime:void 0,startIp:void 0,endIp:void 0,_t:new Date().getTime()}),E=P([{title:"",key:"key",width:80,align:"center",render:(l,i)=>`${i+1}`},{key:"type",title:"设备类型",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"hname",title:"主机名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"rdbtime",title:"接收时间",align:"center",width:160,render:l=>F(l.rdbtime)},{key:"lmid",title:"模块",align:"center",width:160,ellipsis:{tooltip:!0},render:l=>((!l.lmid===void 0||l.lmid===null)&&(l.lmid=0),v.logModel[l.lmid])},{key:"leid",title:"级别",align:"center",width:120,ellipsis:{tooltip:!0},render:l=>((l.leid===void 0||l.leid===null)&&(l.leid=0),v.logLevel[l.leid])},{key:"ipaddr",title:"发生源IP",align:"center",width:180},{key:"ltext",title:"日志原文",align:"center",width:320,ellipsis:{tooltip:!0},render:l=>a("span",null,[l.logtype?l.ltext:l.ltext+l.lcon])},{key:"operate",title:U("common.operate"),align:"center",width:120,fixed:"right",render:l=>a("div",{class:"flex-center gap-8px"},[a($,{type:"info",ghost:!0,size:"small",onClick:()=>h(l)},{default:()=>[n("详情")]})])}]),f=I(!1),o=I([]),d=async(l=!1)=>{if(!f.value)f.value=!0;else return;C.logsoudev&&(b.value=!1,u.lsid=C.logsoudev);const{data:i,error:r}=await Ie(u);r||(l?o.value=[...o.value,...i]:o.value=i,f.value=!1)};function h(l){e.lsid=l.lsid,e.lsdn=l.lsdn,e.rdbtime=l.rdbtime,e.lmid=l.lmid,e.leid=l.leid,e.ltext=l.ltext,e.aname=l.aname,e.procid=l.procid,e.msgid=l.msgid,e.dbtime=l.dbtime,e.hname=l.hname,e.lcon=l.lcon,e.ip=l.ip,e.lsip=l.lsip,e.priority=l.priority,e.type=l.type,e.version=l.version,e.logtype=l.logtype,S.value=!0}const m=I(null),b=I(!0),V=()=>{o.value=[],u.lsid||u.leid||u.lmid||u.startIp||u.endIp||u.startTime||u.endTime?b.value=!1:(b.value=!0,A()),u.pageId=void 0,d()};d();function z(l){l.target.scrollTop+l.target.offsetHeight==l.target.scrollHeight&&y.total>o.value.length&&B()}const B=_e.debounce(()=>{if(o.value.length<y.total){if(u.pageId==o.value[o.value.length-1].id)return;u.pageId=o.value[o.value.length-1].id,d(!0)}},300);function R(l){return l.index}const y=P({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:l,endIndex:i,page:r,pageSize:c,pageCount:w,itemCount:s}){return`已加载${o.value.length}条`+(o.value.length?b.value?` 共计 ${o.value.length>0?s??0:0} 条`:o.value.length>=u.pageSize?"  预计还有更多":"":"")}});async function A(){const{data:l,error:i}=await Le({_t:new Date().getTime()});i||(y.pageCount=20,y.total=Number(l),y.itemCount=Number(l))}A();async function H(){if(!o.value.length)return;const l=JSON.parse(JSON.stringify(o.value)),i=[];l.forEach(c=>{const w={};E.forEach(s=>{var T,O,M;if(c.hasOwnProperty(s.key)){const x=s.key==="lmid"?((T=v.logModel)==null?void 0:T[c[s.key]])??null:s.key==="leid"?((O=v.logLevel)==null?void 0:O[c[s.key]])??null:s.key==="lsid"?(M=L.value.map(D=>D.data).flat(2).find(D=>D.id==c[s.key]))==null?void 0:M.type:s.key=="ltext"?c.logtype?c.logtype:c.ltext+c.lcon:c[s.key];w[s.title]=x}}),i.push(w)}),Ce(i,500,[{wpx:180},{wpx:120},{wpx:160},{wpx:80},{wpx:80},{wpx:100},{wpx:400}],"通用日志_"+new Date().getTime())}return(l,i)=>{const r=q,c=Ee,w=Q,s=we,T=De,O=re,M=ue;return Y(),de("div",Te,[a(Re,{model:u,"onUpdate:model":i[0]||(i[0]=x=>u=x),onSearch:V,LogSourceDeviceList:L.value,logsoudev:C.logsoudev},null,8,["model","LogSourceDeviceList","logsoudev"]),a(w,{title:"通用日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[a(r,null,{default:t(()=>[a(_($),{type:"primary",size:"small",ghost:"",onClick:H,title:"导出已加载"},{default:t(()=>[n("导出已加载")]),_:1})]),_:1})]),default:t(()=>[a(c,{ref_key:"tableContainerRef",ref:m,columns:E,data:o.value,size:"small","flex-height":!_(N).isMobile,"scroll-x":E.reduce((x,D)=>x+D.width,0),loading:f.value,remote:"","row-key":R,showTotal:"","max-height":k.value,"virtual-scroll":"",pagination:y,class:"sm:h-full",onScroll:z},null,8,["columns","data","flex-height","scroll-x","loading","max-height","pagination"])]),_:1}),a(M,{show:S.value,"onUpdate:show":i[2]||(i[2]=x=>S.value=x),title:"日志详情",preset:"card",class:"w-800px"},{footer:t(()=>[a(r,{justify:"end",size:16},{default:t(()=>[a(_($),{type:"primary",onClick:i[1]||(i[1]=x=>{S.value=!1})},{default:t(()=>[n(p(_(U)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[Oe,a(O,{class:"h-480px pr-20px"},{default:t(()=>[a(T,{"label-placement":"left","label-style":{width:"120px"},bordered:"",column:1},{default:t(()=>[a(s,null,{label:t(()=>[n(" 设备类型 ")]),default:t(()=>[n(" "+p(e.type),1)]),_:1}),a(s,null,{label:t(()=>[n(" 接收时间 ")]),default:t(()=>[n(" "+p(_(F)(e.rdbtime)),1)]),_:1}),a(s,null,{label:t(()=>[n(" 模块 ")]),default:t(()=>[n(" "+p(_(v).logModel[e.lmid]),1)]),_:1}),a(s,null,{label:t(()=>[n(" 级别 ")]),default:t(()=>[n(" "+p(_(v).logLevel[e.leid]),1)]),_:1}),a(s,null,{label:t(()=>[n(" 应用名称 ")]),default:t(()=>[n(" "+p(e.aname),1)]),_:1}),a(s,null,{label:t(()=>[n(" PROCID ")]),default:t(()=>[n(" "+p(e.procid),1)]),_:1}),a(s,null,{label:t(()=>[n(" MSGID ")]),default:t(()=>[n(" "+p(e.msgid||"--"),1)]),_:1}),a(s,null,{label:t(()=>[n(" 日志时间 ")]),default:t(()=>[n(" "+p(_(F)(e.dbtime)),1)]),_:1}),a(s,null,{label:t(()=>[n(" 主机名称 ")]),default:t(()=>[n(" "+p(e.hname),1)]),_:1}),a(s,null,{label:t(()=>[n(" 结构数据 ")]),default:t(()=>[n(" -- ")]),_:1}),a(s,null,{label:t(()=>[n(" 日志内容 ")]),default:t(()=>[n(" "+p(e.lcon),1)]),_:1}),a(s,{span:2},{label:t(()=>[n(" 日志原文 ")]),default:t(()=>[n(" "+p(e.logtype?e.ltext:e.ltext+e.lcon),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),Xe=fe(Me,[["__scopeId","data-v-67571477"]]);export{Xe as default};
