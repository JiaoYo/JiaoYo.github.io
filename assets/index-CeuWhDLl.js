import{_ as de}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DCcFtEoA.js";import{d as G,q as P,s as Z,v as ee,x as ue,bF as te,b as j,$ as l,r as pe,y as oe,K,o as z,c as V,w as r,g as t,h as B,t as U,i as e,M as ne,L as F,Z as me,a0 as _e,A as ae,C as fe,a2 as he,D as le,B as L,E as J,ae as ge,af as ve,ad as se,dp as Q,j as H,f as X,F as ye,aP as be,at as re,a4 as we,dq as ke,e as xe,ag as E,ah as Re,ai as De}from"./index-ByfxsQvj.js";import{a as ie,b as Ne,c as Ce,d as Se,e as Te,g as Me}from"./system-manage-HvI462c1.js";import{u as $e,a as Ie}from"./table-Ca-5bYro.js";import{_ as Be}from"./round-search-U_wZ0GRt.js";import{_ as Ue}from"./round-refresh-BRVSTvae.js";import{_ as ze,l as Fe}from"./lodash-21GmhknM.js";import{_ as Le}from"./FormItemGridItem-Dtr_7n7z.js";import{_ as Oe}from"./Grid-B9K_tFX2.js";import{_ as Ae,a as Ee}from"./arrow-open-up-BQr4szyH.js";import{_ as Ke}from"./Tree-zqOmNxeq.js";import{h as Y}from"./permission-DpUBsxJs.js";import{_ as Ve}from"./Popconfirm-Bx1fZnQD.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-frQqLk93.js";import"./setting-outlined-C6sNL0co.js";import"./export-CaaNVRvS.js";import"./refresh-DDT70CE0.js";import"./round-delete-BsuQe4MI.js";import"./round-plus--T3dOesv.js";import"./Upload-BPNrVbAn.js";import"./Progress-B01mUdYA.js";const je=G({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:P({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:P(["submitted"],["update:visible"]),setup(v,{emit:R}){const u=v,h=R,b=Z(v,"visible"),{formRef:y,validate:C,restoreValidation:$}=ee(),{defaultRequiredRule:g}=ue();te();const D=j(()=>({add:l("page.manage.role.addRole"),edit:l("page.manage.role.editRole")})[u.operateType]),p=pe(N());function N(){return{name:"",remark:"",rtype:0,menuIdList:[]}}const I={name:g};j(()=>{var c;return((c=u.rowData)==null?void 0:c.id)||-1}),j(()=>u.operateType==="add"||u.operateType==="edit");async function S(){if(Object.assign(p,N()),u.operateType==="edit"&&u.rowData){const{data:c,error:i}=await ie(u.rowData.id+"");Object.assign(p,c)}}function T(){b.value=!1}async function o(){var f,a,d;await C();const{data:c,error:i}=await Ne(u.operateType==="edit"?(f=u.rowData)==null?void 0:f.id:null,p.name,p.menuIdList,p.remark,p.rtype);i||((a=window.$message)==null||a.destroyAll(),(d=window.$message)==null||d.success(u.operateType==="edit"?l("common.modifySuccess"):l("common.addSuccess")),T(),h("submitted"))}return oe(b,()=>{b.value&&(S(),$())}),(c,i)=>{const f=ae,a=fe,d=he,m=le,w=L,n=J,M=ge,O=ve,A=K("no-space");return z(),V(O,{show:b.value,"onUpdate:show":i[3]||(i[3]=s=>b.value=s),"display-directive":"show",width:360},{default:r(()=>[t(M,{title:D.value,"native-scrollbar":!1,closable:""},{footer:r(()=>[t(n,{size:16},{default:r(()=>[t(w,{onClick:T},{default:r(()=>[B(U(e(l)("common.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:o},{default:r(()=>[B(U(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(m,{ref_key:"formRef",ref:y,model:p,rules:I,onKeyup:ne(o,["enter"])},{default:r(()=>[t(a,{label:e(l)("page.manage.role.name"),path:"name"},{default:r(()=>[F(t(f,{value:p.name,"onUpdate:value":i[0]||(i[0]=s=>p.name=s),placeholder:e(l)("page.manage.role.form.name"),clearable:""},null,8,["value","placeholder"]),[[A]])]),_:1},8,["label"]),t(a,{label:e(l)("page.manage.role.remark"),path:"remark"},{default:r(()=>[F(t(f,{clearable:"",value:p.remark,"onUpdate:value":i[1]||(i[1]=s=>p.remark=s),placeholder:e(l)("page.manage.role.form.remark")},null,8,["value","placeholder"]),[[A]])]),_:1},8,["label"]),t(a,{label:e(l)("page.manage.role.type"),path:"rtype"},{default:r(()=>[t(d,{filterable:"",value:p.rtype,"onUpdate:value":i[2]||(i[2]=s=>p.rtype=s),disabled:u.operateType==="edit",placeholder:e(l)("page.manage.role.form.type"),options:e(me)(e(_e)),style:{width:"100%"}},null,8,["value","disabled","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Pe=G({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:P(["reset","search"],["update:model"]),setup(v,{emit:R}){const u=R,h=Z(v,"model"),{formRef:b,restoreValidation:y}=ee();function C(){h.value.name="",u("search")}async function $(){await y(),u("reset")}function g(){u("search")}const D=ze.throttle(g,1e3,{trailing:!1});return(p,N)=>{const I=ae,S=Le,T=Ue,o=L,c=Be,i=J,f=Oe,a=le,d=se,m=K("no-space");return z(),V(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[t(a,{model:h.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(g,["enter"])},{default:r(()=>[t(f,{responsive:"screen","item-responsive":"","y-gap":12},{default:r(()=>[t(S,{span:"24 s:12 m:8 l:6",label:e(l)("page.manage.role.name"),path:"name"},{default:r(()=>[F(t(I,{clearable:"",value:h.value.name,"onUpdate:value":N[0]||(N[0]=w=>h.value.name=w),placeholder:e(l)("page.manage.role.form.name"),onClear:C},null,8,["value","placeholder"]),[[m]])]),_:1},8,["label"]),t(S,{span:"24 s:12 m:8 l:6"},{default:r(()=>[t(i,{class:"w-full ml-20px"},{default:r(()=>[t(o,{onClick:$},{icon:r(()=>[t(T,{class:"text-icon"})]),default:r(()=>[B(" "+U(e(l)("common.reset")),1)]),_:1}),t(o,{type:"primary",ghost:"",onClick:e(D)},{icon:r(()=>[t(c,{class:"text-icon"})]),default:r(()=>[B(" "+U(e(l)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ge={class:"flex"},qe=G({name:"MenuAuthModal",__name:"menu-auth-modal",props:P({roleRow:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(v){const R=v,u=Z(v,"visible");function h(){u.value=!1}const b=j(()=>l("common.edit")+l("page.manage.role.menuAuth")),y=Q([]);function C(o,c=0){var m,w;const i=(m=o.find(n=>n.url=="/manage/role"))==null?void 0:m.id,f=(w=o.find(n=>n.url=="/manage/user"))==null?void 0:w.id;let a=[];function d(n){return n.sort((M,O)=>(M.sort||0)-(O.sort||0))}return o.forEach(n=>{if(n.suffix=()=>be(re,{text:!0,type:n.pid==0&&n.type==0?"warning":n.type==1?"info":"success",size:"small"},{default:()=>n.pid==0&&n.type==0?"目录":n.type==1?"按钮":"菜单"}),(n.pid==i||n.id==i||n.pid==f||n.id==f)&&(n.disabled=!0),n.pid==c){const M=C(o,n.id);M.length>0?n.children=M:n.children=[],a.push(n)}}),d(a)}const $=async()=>{const{error:o,data:c}=await Se({rtype:R.roleRow.rtype}),i=C(c);if(!o){let f=function(d){for(let m=d.length-1;m>=0;m--)d[m].children&&d[m].children.length>0?f(d[m].children):d[m].children=void 0;return d},a=Fe.cloneDeep(i);a=f(a),y.value=a.filter(d=>d.id<=1e4)}},g=H(!0),D=Q([]);async function p(){const{data:o,error:c}=await ie(R.roleRow.id+""),i=[];function f(a,d){return!d.includes(a.id)||a.children&&!a.children.every(m=>f(m,d))?(i.push(a.id),!1):!0}y.value.forEach(a=>{f(a,o.menuIdList)}),D.value=o.menuIdList.filter(a=>!i.includes(a))}const N=H(),I=o=>{N.value=o};function S(){var o,c;Ce({id:R.roleRow.id,name:R.roleRow.name,menuIdList:D.value.concat(N.value).filter(i=>i!==null)}),(c=(o=window.$message)==null?void 0:o.success)==null||c.call(o,l("common.modifySuccess")),h()}function T(){$(),p()}return oe(u,o=>{o&&T()}),(o,c)=>{const i=Ae,f=Ee,a=Ke,d=L,m=J,w=ye;return z(),V(w,{show:u.value,"onUpdate:show":c[2]||(c[2]=n=>u.value=n),preset:"card",class:"w-480px"},{header:r(()=>[X("div",Ge,[B(U(b.value)+" ",1),X("div",{class:"ml-10px cursor-pointer",title:"展开/收起",onClick:c[0]||(c[0]=n=>g.value=!g.value)},[g.value?(z(),V(f,{key:1,class:"text-icon"})):(z(),V(i,{key:0,class:"text-icon"}))])])]),footer:r(()=>[t(m,{justify:"end"},{default:r(()=>[t(d,{size:"small",class:"mt-16px",onClick:h},{default:r(()=>[B(U(e(l)("common.cancel")),1)]),_:1}),t(d,{type:"primary",size:"small",class:"mt-16px",onClick:S},{default:r(()=>[B(U(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(a,{cascade:"","checked-keys":D.value,"onUpdate:checkedKeys":c[1]||(c[1]=n=>D.value=n),data:y.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"",class:"h-60vh","label-field":"name","key-field":"id","children-field":"children","default-expand-all":g.value,onUpdateIndeterminateKeys:I},null,8,["checked-keys","data","default-expand-all"])]),_:1},8,["show"])}}}),We={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Re(v)}const ft=G({name:"manage_role",__name:"index",setup(v){const R=we(),{columns:u,columnChecks:h,data:b,getData:y,loading:C,mobilePagination:$,searchParams:g,resetSearchParams:D}=$e({apiFn:Te,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,name:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:l("page.manage.role.name"),align:"center",minWidth:120,ellipsis:!0},{key:"remark",title:l("page.manage.role.remark"),minWidth:120,align:"center",ellipsis:!0},{key:"rtype",title:l("page.manage.role.type"),width:140,align:"center",render:s=>{s.rtype===void 0&&(s.rtype=0);const _={0:"primary",1:"primary",2:"primary"},k=l(ke[s.rtype]);return t(re,{type:_[s.rtype]},W(k)?k:{default:()=>[k]})}},{key:"operate",title:l("common.operate"),align:"center",render:s=>{let _;return t("div",{class:"flex-center gap-8px"},[F(t(L,{type:"primary",ghost:!0,size:"small",onClick:()=>O(s.id)},W(_=l("common.edit"))?_:{default:()=>[_]}),[[K("no-auth"),"sys:role:update"]]),F(t(L,{type:"primary",ghost:!0,size:"small",onClick:()=>w(s)},{default:()=>["分配权限"]}),[[K("no-auth"),"sys:role:update"]]),[1,2,3].includes(Number(s.id))?"":t(Ve,{onPositiveClick:()=>M(s.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let k;return F(t(L,{type:"error",ghost:!0,size:"small"},W(k=l("common.delete"))?k:{default:()=>[k]}),[[K("no-auth"),"sys:role:delete"]])}})])}}]}),{drawerVisible:p,operateType:N,editingData:I,handleAdd:S,handleEdit:T,checkedRowKeys:o,onBatchDeleted:c,onDeleted:i,closeDrawer:f}=Ie(b,y),{bool:a,setTrue:d}=te(),m=H({id:0,name:"",remark:"",rtype:0,menuIdList:[]});function w(s){d(),m.value=s}async function n(){console.log(o.value),A(o.value,s=>{c()})}function M(s){console.log(s),A([s],_=>{i()})}function O(s){T(s)}async function A(s,_){const{data:k,error:q}=await Me(s);if(!q)_&&_(k);else return!1}return(s,_)=>{const k=de,q=De,ce=se;return z(),xe("div",We,[t(Pe,{model:e(g),"onUpdate:model":_[0]||(_[0]=x=>E(g)?g.value=x:null),onReset:e(D),onSearch:e(y)},null,8,["model","onReset","onSearch"]),t(ce,{title:e(l)("page.manage.role.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":r(()=>[t(k,{columns:e(h),"onUpdate:columns":_[1]||(_[1]=x=>E(h)?h.value=x:null),"disabled-delete":e(o).length===0,"is-view-add-button":e(Y)("sys:role:save"),"is-view-delete-button":e(Y)("sys:role:delete"),loading:e(C),onAdd:e(S),onDelete:n,onRefresh:e(y)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:r(()=>[t(q,{"checked-row-keys":e(o),"onUpdate:checkedRowKeys":_[2]||(_[2]=x=>E(o)?o.value=x:null),columns:e(u),data:e(b),size:"small","flex-height":!e(R).isMobile,"scroll-x":702,loading:e(C),remote:"","row-key":x=>x.id,pagination:e($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(je,{visible:e(p),"onUpdate:visible":_[3]||(_[3]=x=>E(p)?p.value=x:null),"operate-type":e(N),"row-data":e(I),onSubmitted:e(y)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(qe,{visible:e(a),"onUpdate:visible":_[4]||(_[4]=x=>E(a)?a.value=x:null),roleRow:m.value},null,8,["visible","roleRow"])]),_:1},8,["title"])])}}});export{ft as default};
