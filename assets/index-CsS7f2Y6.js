import{_ as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-sZrXAUWR.js";import{d as J,q as E,s as W,v as Y,x as me,b as fe,r as _e,y as ge,K as j,o as X,c as ee,w as n,g as e,h as B,t as F,i as o,$ as f,M as te,L as O,A as ae,C as he,X as oe,D as ne,B as q,E as le,aa as ye,ab as ve,J as be,a9 as se,Z as we,ar as Se,am as xe,j as Z,e as De,ac as V,ad as Ce,S as ke,F as Te,ay as Ne}from"./index-BthjjP8Z.js";import{u as Me,a as ze}from"./table-DgUtF0JO.js";import{p as re,q as ce,r as Re,s as Ue,t as Le,u as Pe}from"./Collection-BZegAhPl.js";import{u as I}from"./usePageData-DsxRw8IA.js";import{_ as Ae}from"./round-search-D0y4Bi99.js";import{_ as $e}from"./round-refresh-7YBMJmxM.js";import{_ as Be}from"./FormItemGridItem-Cf_xNcQf.js";import{_ as Fe}from"./Grid-CrjQrgB8.js";import{h as Q}from"./permission-DgnWzPLf.js";import{_ as He}from"./Popconfirm-DUBjdYuJ.js";import{_ as Ve}from"./DataTable-DVNKf1bg.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-P1qKwD6q.js";import"./setting-outlined-CB-n0fXZ.js";import"./round-delete-imzaxX0A.js";import"./refresh-516o5uee.js";import"./Upload-CXW3Rb5a.js";import"./Progress-CegqNBwu.js";import"./Forward-B9_DMOnd.js";const je=J({name:"OperateDrawer",__name:"operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(g,{emit:M}){const d=g,y=M,_=W(g,"visible"),{formRef:c,validate:D,restoreValidation:z}=Y(),{createConfirmPwdRule:C,defaultRequiredRule:R,patternRules:S}=me(),x=fe(()=>({add:"新增日志源设备",edit:"编辑日志源设备"})[d.operateType]),i=_e(k());function k(){return{id:void 0,manu:null,category:null,type:"",sysparam:void 0,ldesc:""}}const U={type:R,category:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源类别"},manu:{type:"number",required:!0,trigger:["blur","change"],message:"请选择厂商"}},{pageData:p,getData:L,nextPage:P}=I(re),H=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&p.data.length<p.total&&P()},{pageData:u,getData:r,nextPage:A}=I(ce),v=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&u.data.length<u.total&&A()};function T(){L(),r(),Object.assign(i,k()),d.operateType==="edit"&&d.rowData&&Object.assign(i,d.rowData)}function b(){_.value=!1}async function l(){var a,t;if(await D(),d.operateType==="add"){const{data:w,error:m}=await Re([i]);m||((a=window.$message)==null||a.success(f("common.addSuccess")),b(),y("submitted"))}else{const{data:w,error:m}=await Ue([i]);m||((t=window.$message)==null||t.success(f("common.updateSuccess")),b(),y("submitted"))}}return ge(_,()=>{_.value&&(T(),z())}),(a,t)=>{const w=ae,m=he,N=oe,$=ne,s=q,K=le,ie=ye,ue=ve,de=j("no-space");return X(),ee(ue,{show:_.value,"onUpdate:show":t[4]||(t[4]=h=>_.value=h),"display-directive":"show",width:360},{default:n(()=>[e(ie,{title:x.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(K,{size:16},{default:n(()=>[e(s,{onClick:b},{default:n(()=>[B(F(o(f)("common.cancel")),1)]),_:1}),e(s,{type:"primary",onClick:l},{default:n(()=>[B(F(o(f)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e($,{ref_key:"formRef",ref:c,model:i,rules:U,onKeyup:te(l,["entep"])},{default:n(()=>[e(m,{label:"日志源类型",path:"type"},{default:n(()=>[O(e(w,{clearable:"",value:i.type,"onUpdate:value":t[0]||(t[0]=h=>i.type=h),placeholder:"请输入日志源类型"},null,8,["value"]),[[de]])]),_:1}),e(m,{label:"日志源类别",path:"category"},{default:n(()=>[e(N,{clearable:"",filterable:"",value:i.category,"onUpdate:value":t[1]||(t[1]=h=>i.category=h),placeholder:"请选择日志源类别",options:o(p).data,"reset-menu-on-options-change":!1,onScroll:H,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"厂商",path:"manu"},{default:n(()=>[e(N,{clearable:"",filterable:"",value:i.manu,"onUpdate:value":t[2]||(t[2]=h=>i.manu=h),placeholder:"请选择厂商",options:o(u).data,"value-field":"id","label-field":"mname",onScroll:v,"reset-menu-on-options-change":!1,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"描述",path:"ldesc"},{default:n(()=>[e(w,{type:"textarea",value:i.ldesc,"onUpdate:value":t[3]||(t[3]=h=>i.ldesc=h),placeholder:"请输入备注",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Oe=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(g,{emit:M}){const d=M,{formRef:y,restoreValidation:_}=Y(),c=W(g,"model");function D(u){c.value.category=u,d("search")}function z(u){c.value.manu=u,d("search")}function C(){c.value.fuzzy="",d("search")}async function R(){await _(),d("reset")}async function S(){d("search")}const{pageData:x,getData:i,nextPage:k}=I(re),U=async u=>{const r=u.currentTarget;r.scrollTop+r.offsetHeight>=r.scrollHeight&&x.data.length<x.total&&k()},{pageData:p,getData:L,nextPage:P}=I(ce),H=async u=>{const r=u.currentTarget;r.scrollTop+r.offsetHeight>=r.scrollHeight&&p.data.length<p.total&&P()};return be(()=>{i(),L()}),(u,r)=>{const A=ae,v=Be,T=oe,b=$e,l=q,a=Ae,t=le,w=Fe,m=ne,N=se,$=j("no-space");return X(),ee(N,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(m,{ref_key:"formRef",ref:y,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(S,["enter"])},{default:n(()=>[e(w,{responsive:"screen","item-responsive":""},{default:n(()=>[e(v,{span:"24 s:12 m:6",label:"日志源类型",path:"fuzzy",class:"pr-24px"},{default:n(()=>[O(e(A,{clearable:"",value:c.value.fuzzy,"onUpdate:value":r[0]||(r[0]=s=>c.value.fuzzy=s),placeholder:"请输入日志源类型关键字",onClear:C},null,8,["value"]),[[$]])]),_:1}),e(v,{span:"24 s:12 m:6",label:"厂商",path:"manu",class:"pr-24px"},{default:n(()=>[e(T,{clearable:"",filterable:"",value:c.value.manu,"onUpdate:value":r[1]||(r[1]=s=>c.value.manu=s),placeholder:"请选择厂商",options:o(p).data,"value-field":"id","label-field":"mname",onScroll:H,onUpdateValue:z,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"日志源类别",path:"category",class:"pr-24px"},{default:n(()=>[e(T,{clearable:"",filterable:"",value:c.value.category,"onUpdate:value":r[2]||(r[2]=s=>c.value.category=s),placeholder:"请选择日志源类别",options:o(x).data,onScroll:U,onUpdateValue:D,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{span:"24  s:12 m:6",class:"pr-24px"},{default:n(()=>[e(t,{class:"w-full"},{default:n(()=>[e(l,{onClick:R},{icon:n(()=>[e(b,{class:"text-icon"})]),default:n(()=>[B(" "+F(o(f)("common.reset")),1)]),_:1}),e(l,{type:"primary",ghost:"",onClick:S},{icon:n(()=>[e(a,{class:"text-icon"})]),default:n(()=>[B(" "+F(o(f)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),qe={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function G(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!Ce(g)}const Ie=J({name:"collectionmanagement_logsource",__name:"index",setup(g){const M=we(),{columns:d,columnChecks:y,data:_,getData:c,loading:D,mobilePagination:z,searchParams:C,resetSearchParams:R}=Me({apiFn:Le,apiParams:{page:1,pageSize:20,limit:20,fuzzy:void 0,category:void 0,manu:void 0,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48,disabled(l){return l.sysparam!==1}},{key:"mname",title:"厂商",align:"center",width:240},{key:"cname",title:"日志源类别",align:"center",width:240},{key:"type",title:"日志源类型",align:"center",width:240},{key:"ldesc",title:"描述",align:"center",width:500,render:l=>e("span",{class:"text-ellipsis",onClick:()=>{u.value=l.ldesc,r.value=!0},style:{display:"block",width:"100%"}},[l.ldesc])},{key:"sysparam",title:"是否为系统参数",align:"center",width:120,render:l=>{const a={0:"success",1:"error"},t=f(Se[l.sysparam]);return e(xe,{size:"small",type:a[l.sysparam]},G(t)?t:{default:()=>[t]})}},{key:"operate",title:f("common.operate"),align:"center",width:130,render:l=>{let a;return l.sysparam==1&&e("div",{class:"flex-center gap-8px"},[O(e(q,{type:"primary",ghost:!0,size:"small",onClick:()=>T(l.id)},G(a=f("common.edit"))?a:{default:()=>[a]}),[[j("no-auth"),"sys.log.source.device.update"]]),e(He,{onPositiveClick:()=>v(l.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let t;return O(e(q,{type:"error",ghost:!0,size:"small"},G(t=f("common.delete"))?t:{default:()=>[t]}),[[j("no-auth"),"sys.log.source.device.delete"]])}})])}}]}),{drawerVisible:S,operateType:x,editingData:i,handleAdd:k,handleEdit:U,checkedRowKeys:p,onBatchDeleted:L,onDeleted:P,closeDrawer:H}=ze(_,c),u=Z(""),r=Z(!1);async function A(){console.log(p.value),b(p.value.join(","),l=>{L()})}function v(l){console.log(l),b(l,a=>{P()})}function T(l){U(l)}async function b(l,a){const t=await Pe(l);a&&a(t)}return(l,a)=>{const t=pe,w=Ve,m=ke,N=Te,$=se;return X(),De("div",qe,[e(Oe,{model:o(C),"onUpdate:model":a[0]||(a[0]=s=>V(C)?C.value=s:null),onReset:o(R),onSearch:o(c)},null,8,["model","onReset","onSearch"]),e($,{title:"日志源设备",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":n(()=>[e(t,{columns:o(y),"onUpdate:columns":a[1]||(a[1]=s=>V(y)?y.value=s:null),"disabled-delete":o(p).length===0,"is-view-add-button":o(Q)("sys.log.source.device.insert"),"is-view-delete-button":o(Q)("sys.log.source.device.delete"),loading:o(D),onAdd:o(k),onDelete:A,onRefresh:o(c)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:n(()=>[e(w,{"checked-row-keys":o(p),"onUpdate:checkedRowKeys":a[2]||(a[2]=s=>V(p)?p.value=s:null),columns:o(d),data:o(_),size:"small","flex-height":!o(M).isMobile,"scroll-x":o(d).reduce((s,K)=>s+K.width,0),loading:o(D),remote:"","row-key":s=>s.id,pagination:o(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(je,{visible:o(S),"onUpdate:visible":a[3]||(a[3]=s=>V(S)?S.value=s:null),"operate-type":o(x),"row-data":o(i),onSubmitted:o(c)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(N,{show:r.value,"onUpdate:show":a[4]||(a[4]=s=>r.value=s),title:"描述",preset:"card",class:"w-600px"},{default:n(()=>[e(m,{style:{"max-height":"300px"}},{default:n(()=>[B(F(u.value),1)]),_:1})]),_:1},8,["show"])]),_:1})])}}}),ut=Ne(Ie,[["__scopeId","data-v-cea6e08f"]]);export{ut as default};
