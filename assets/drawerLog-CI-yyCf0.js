import{d as Y,av as K,z as Z,C as le,D as ee,aJ as G,s as F,A as re,a as ie,ax as te,es as ce,et as de,at as J,d3 as ue,c as k,o as g,w as a,f as s,M as ae,G as U,e as i,N as ne,h as t,au as pe,H as C,t as u,J as me,B as q,g as z,$ as X,a4 as fe,cx as ve,aE as _e,X as ge,eu as be,F as we,bn as ye,b as I,aL as x,b2 as he,I as Q,L as xe,d4 as Ce,aO as ke,a_ as ze,bp as De,ev as Ne,ew as Se,W as je}from"./index-BTeMkgsf.js";import{u as Te}from"./usePageData-BtaN_wXr.js";import{_ as Pe,a as $e}from"./text-B_2dbn0D.js";import{N as Le}from"./Popconfirm-BVBTnPX5.js";const Me={class:"mt-10px"},Je=Y({name:"OperateDrawer",__name:"operate-drawer",props:K({operateType:{},rowData:{},pid:{},pname:{},showtype:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(D,{emit:E}){Z();const n=E,b=le("pname"),c=D,e=ee(P());function P(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null,charctras:0}}const y={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施",trigger:"blur"}},{pageData:v,getData:h,nextPage:N}=Te(ve),S=async l=>{const r=l.currentTarget,_=r.scrollTop;r.scrollTop+r.offsetHeight>=r.scrollHeight&&v.data.length<v.total&&(await N(),await _e(),setTimeout(()=>{r.scrollTop=_}))},$=async l=>{m.value=!0,l?e.pid=l:e.value.pid=null},O=async()=>{var l;if(await h({fuzzy:c.pname?c.pname:b!=null&&b.value?b==null?void 0:b.value:"",page:1}),v.data.length==0)return(l=window.$message)==null?void 0:l.warning("没有项目")},d=G.debounce(async l=>{await h({fuzzy:l,page:1})},300),o=F(!1),m=F(!1),w=l=>{if(e.pid=null,o.value=!0,m.value=!1,!l){M();return}d(l)},L=async()=>{o.value&&!m.value&&(await h({page:1}),o.value=!1)},M=()=>{h({page:1})};async function V(){Object.assign(e,P()),await O(),c.pid&&(v.data.forEach(l=>{l.id==c.pid&&(l.disabled=!0)}),e.pid=c.pid),c.operateType==="edit"&&c.rowData&&Object.assign(e,c.rowData)}const{formRef:A,validate:B,restoreValidation:f}=re(),W=ie(()=>({add:"新增项目总结",edit:"修改项目总结"})[c.operateType]),j=te(D,"visible"),R=()=>{j.value=!1},oe=G.debounce(async()=>{var l,r,_;if(await B(),e.charctras<30)return(l=window.$message)==null?void 0:l.warning("字数不能少于30字,请继续填写");if(c.operateType==="edit"){const{data:H,error:T}=await ce([{...e}]);T||((r=window.$message)==null||r.success("修改成功"),n("submitted"),R())}else{const{data:H,error:T}=await de([{pid:e.pid,content1:e.content1,content2:e.content2,content3:e.content3,content4:e.content4,content5:e.content5,charctras:e.charctras}]);T||((_=window.$message)==null||_.success("添加成功"),n("submitted"),R())}},1e3,{leading:!0,trailing:!1});return J(j,()=>{j.value&&(V(),setTimeout(()=>{const l=document.querySelector(".n-scrollbar-content");l==null||l.scrollTo(0,0)},300),f())}),J(()=>[e.content1,e.content2,e.content3,e.content4,e.content5],()=>{e.charctras=ue(e.content1+e.content2+e.content3+e.content4+e.content5)},{immediate:!0}),(l,r)=>{const _=ne,H=ae,T=me,se=fe;return g(),k(se,{show:j.value,"onUpdate:show":r[6]||(r[6]=p=>j.value=p),title:W.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:a(()=>[s(T,{justify:"end"},{default:a(()=>[s(t(q),{size:"small",class:"mt-16px",onClick:R},{default:a(()=>[z(u(t(X)("common.cancel")),1)]),_:1}),s(t(q),{type:"primary",size:"small",class:"mt-16px",onClick:t(oe)},{default:a(()=>[z(u(t(X)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:a(()=>[s(H,{ref_key:"formRef",ref:A,model:e,rules:y},{default:a(()=>[c.operateType==="add"&&c.showtype!=="detail"?(g(),k(_,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:a(()=>[s(t(pe),{clearable:"",filterable:"",value:e.pid,"onUpdate:value":[r[0]||(r[0]=p=>e.pid=p),$],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:M,onSearch:w,onBlur:L,options:t(v).data,onScroll:S},null,8,["value","options"])]),_:1})):U("",!0),s(_,{label:"前期准备阶段描述",path:"content1"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content1,"onUpdate:value":r[1]||(r[1]=p=>e.content1=p),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),s(_,{label:"遇到问题及对项目的影响",path:"content2"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content2,"onUpdate:value":r[2]||(r[2]=p=>e.content2=p),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),s(_,{label:"经验教训与改进方案或措施",path:"content3"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content3,"onUpdate:value":r[3]||(r[3]=p=>e.content3=p),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),s(_,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content4,"onUpdate:value":r[4]||(r[4]=p=>e.content4=p),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),s(_,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content5,"onUpdate:value":r[5]||(r[5]=p=>e.content5=p),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1}),i("div",Me,"字数："+u(e.charctras),1)]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Be={class:"font-size-12px c-#a19f9d my-5px"},Ie={key:0},Ue={class:"mt-4 border-t pt-3"},Fe={class:"flex items-start gap-2 mb-3"},qe={class:"ml-2 flex-1"},Ee={class:"flex items-center"},Oe={class:"font-medium font-size-16px font-bold"},Ve={class:"text-gray-600 mt-1"},Ae=Y({name:"drawerLog",__name:"drawerLog",props:K({rowData:{},showtype:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(D){const E=Z();ge();let n=ee({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",charctras:0,num:0});const b=D,c={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},e=F({});async function P(){y.value=[],Object.assign(n,b.rowData),S()}const y=F([]),v=te(D,"visible");J(v,()=>{v.value?P():(y.value=[],n.id=void 0)});function h(d){d||N()}function N(){v.value=!1}const S=async()=>{const{data:d,error:o}=await Ne({page:1,limit:100,pid:n.id});d&&(y.value=d.list)},$=G.debounce(async()=>{var w;const d=e.value[n.id];if(!(d!=null&&d.trim()))return(w=window.$message)==null?void 0:w.warning("请输入评论内容");const{data:o,error:m}=await be([{pid:n.id,content:d}]);o&&(e.value[n.id]="",n.num++,S())},1e3,{leading:!0,trailing:!1}),O=async d=>{var w;const{data:o,error:m}=await Se(d.id);o&&(S(),n.num--,(w=window.$message)==null||w.success("删除成功"))};return(d,o)=>{const m=ne,w=ae,L=Pe,M=$e,V=ye,A=De,B=we("no-auth");return g(),k(A,{show:v.value,"onUpdate:show":[o[1]||(o[1]=f=>v.value=f),h],"display-directive":"show",width:600,onMaskClick:N,onEsc:N},{default:a(()=>[s(V,{title:t(n).username+"的项目总结","native-scrollbar":!1,closable:""},{default:a(()=>[s(w,{ref:"formRef",model:t(n),"show-feedback":!1},{default:a(()=>[b.showtype!=="detail"?(g(),k(m,{key:0,label:"",path:"contractname"},{label:a(()=>o[2]||(o[2]=[i("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).proname}])},u(t(n).proname),3)]),_:1})):U("",!0),s(m,{label:"前期准备阶段描述",path:"content1"},{label:a(()=>o[3]||(o[3]=[i("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content1}])},u(t(n).content1),3)]),_:1}),s(m,{label:"遇到问题及对项目的影响",path:"content2"},{label:a(()=>o[4]||(o[4]=[i("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content2}])},u(t(n).content2),3)]),_:1}),s(m,{label:"经验教训与改进方案或措施",path:"content3"},{label:a(()=>o[5]||(o[5]=[i("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content3}])},u(t(n).content3),3)]),_:1}),s(m,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:a(()=>o[6]||(o[6]=[i("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content4}])},u(t(n).content4),3)]),_:1}),s(m,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:a(()=>o[7]||(o[7]=[i("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content5}])},u(t(n).content5),3)]),_:1}),i("div",Be,"字符数："+u(t(n).charctras),1)]),_:1},8,["model"]),t(n).num?(g(),I("div",Ie,u(t(n).num)+"评论",1)):U("",!0),s(he,{name:"fade"},{default:a(()=>[i("div",Ue,[Q((g(),I("div",Fe,[i("div",null,[s(L,{size:"small",src:c.avatar},null,8,["src"])]),s(t(C),{type:"textarea",id:`comment-input-${t(n).id}`,value:e.value[t(n).id],"onUpdate:value":o[0]||(o[0]=f=>e.value[t(n).id]=f),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:xe(Ce(t($),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),s(t(q),{type:"primary",ghost:"",onClick:t($)},{default:a(()=>o[8]||(o[8]=[z("发送")])),_:1,__:[8]},8,["onClick"])])),[[B,"project:Summary:Comment:insert"]]),(g(!0),I(ke,null,ze(y.value,f=>(g(),I("div",{key:f.id,class:"flex mb-3"},[s(L,{size:"small",src:c.avatar},null,8,["src"]),i("div",qe,[i("div",Ee,[i("span",Oe,u(f.username),1),s(M,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:a(()=>[z(u(f.dbtime),1)]),_:2},1024),t(E).userInfo.id==f.creater?(g(),k(t(Le),{key:0,onPositiveClick:W=>O(f)},{trigger:a(()=>[Q((g(),k(t(q),{quaternary:"",type:"error",size:"small"},{default:a(()=>o[9]||(o[9]=[z(" 删除 ")])),_:1,__:[9]})),[[B,"project:Summary:Comment:delete"]])]),default:a(()=>[o[10]||(o[10]=z(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):U("",!0)]),i("div",Ve,u(f.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),We=je(Ae,[["__scopeId","data-v-9dd3e715"]]);export{Je as _,We as d};
