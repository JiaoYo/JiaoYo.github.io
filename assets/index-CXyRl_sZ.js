import{_ as Z}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BWhNm3E6.js";import{_ as ee}from"./refresh-CG_KqS2_.js";import{d as U,n as q,p as ae,s as Q,D as I,o as G,c as M,w as i,g as l,E as V,h as T,t as F,i as r,$ as L,F as te,J as le,B as E,N as O,O as ne,ad as X,dN as oe,a4 as se,j as h,ae as re,f as D,aa as ie,a_ as j,S as Y,ar as ce,P as ue,Q as de,R as pe,a3 as ve,W as me,r as J,e as _e,ah as K,bo as fe,aG as ye,aj as he}from"./index-2V5ZBOS-.js";import{a as ge,c as xe,d as be,e as H,g as we}from"./reportForm-CeXo3Y87.js";import{u as ke}from"./table-Dz-srhf9.js";import{_ as Ne}from"./round-search-sIMlfHk6.js";import{_ as Ce}from"./round-refresh-GxHZWFju.js";import{_ as Se}from"./lodash-DzFIhHfW.js";import{_ as Te}from"./FormItemGridItem-DT_SRKLr.js";import{_ as Pe}from"./Grid-CmpEViDW.js";import{T as Re}from"./task-DGcY0zdM.js";import{_ as $e,a as De,b as ze,c as Ae}from"./file-pdf-CE5BgnUH.js";import{_ as W}from"./Popconfirm-B7CCkSRP.js";import"./setting-outlined-YDG1F-ef.js";import"./echarts.vue_vue_type_script_setup_true_lang-BZezSMPK.js";import"./index-BhRqCdHu.js";import"./installCanvasRenderer-CyOrKSjT.js";import"./install-CX03SWNg.js";const Ee=U({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["reset","search"],["update:model"]),setup(y,{emit:P}){const R=P,{formRef:o,restoreValidation:f}=ae(),v=Q(y,"model"),$=()=>{v.value.fuzzy="",g()};async function S(){await f(),R("reset")}async function g(){R("search")}const x=Se.debounce(g,1e3,{leading:!0,trailing:!1});return(b,_)=>{const w=le,p=Te,c=Ce,t=E,a=Ne,e=O,u=Pe,z=ne,A=X,k=I("no-space");return G(),M(A,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[l(z,{ref_key:"formRef",ref:o,model:v.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(r(x),["enter"])},{default:i(()=>[l(u,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:i(()=>[l(p,{span:"24 s:12 m:8 l:6",label:"实例名称",path:"alatype"},{default:i(()=>[V(l(w,{autofocus:"",value:v.value.fuzzy,"onUpdate:value":_[0]||(_[0]=s=>v.value.fuzzy=s),placeholder:"请输入实例名称关键字",clearable:"",onClear:$},null,8,["value"]),[[k]])]),_:1}),l(p,{span:"24 s:12 m:8 l:6"},{default:i(()=>[l(e,{class:"w-full"},{default:i(()=>[l(t,{onClick:S},{icon:i(()=>[l(c,{class:"text-icon"})]),default:i(()=>[T(" "+F(r(L)("common.reset")),1)]),_:1}),l(t,{type:"primary",ghost:"",onClick:r(x)},{icon:i(()=>[l(a,{class:"text-icon"})]),default:i(()=>[T(" "+F(r(L)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Be=y=>(ue("data-v-8b41cd07"),y=y(),de(),y),Ie=Be(()=>D("span",{class:"mr-20px"},"报表预览",-1)),Ve={title:"导出PDF"},Oe={title:"导出Word"},Ge={title:"导出Excel"},Le=U({name:"reportPreview",__name:"reportPreview",props:q({data:{},detaliParams:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(y){oe(p=>({"9c0be284":r(R)}));const P=se(),R=P.themeScheme=="dark"?"#001428":"#fff",o=y,f=Q(y,"visible"),v=h([]),$=async p=>{const{data:c,error:t}=await ge({rtype:p});t||(c.forEach(a=>{a.rtext=JSON.parse(a.rtext)}),v.value=c[0].rtext)},S=["提示","低危","中危","高危","致命"],g=["lev0","lev1","lev2","lev3","lev4"],x=h(),b=h(""),_=async()=>{var p,c;o.detaliParams.rtype=1,await $(0),b.value=((c=(p=v.value)==null?void 0:p.find(t=>t.type=="title"))==null?void 0:c.value)+"报表"+j(1,new Date),v.value.forEach(t=>{if(t.type=="table"){if(t.dataName=="collection"&&(t.value.body=o.data.collection.map(a=>t.value.tableHeaderValue.map(e=>e=="ctime"?j(1,a[e]):a[e]))),t.dataName=="events"){const a=o.data.events.filter(e=>e.cname);t.value.body=a.map(e=>t.value.tableHeaderValue.map(u=>e[u]))}if(t.dataName=="level"){const a=o.data.level.filter(e=>e.logname);t.value.body=a.map(e=>t.value.tableHeaderValue.map(u=>e[u]))}if(t.dataName=="level1"){if(o.data.level.length==0)return t.value.body=[];t.value.body=g.map(a=>[a=="lev0"?"提示":a=="lev1"?"低危":a=="lev2"?"中危":a=="lev3"?"高危":"致命",o.data.level.reduce((e,u)=>e+(Number(u[a])||0),0)])}}if(t.type=="chart"&&t.dataName=="events"){const a=o.data.events.filter(e=>e.cname);t.value.chartType=="bar"&&(t.value.data.series[0].data=a.map(e=>e.count),t.value.data.xAxis.type=="category"?t.value.data.xAxis.data=a.map(e=>e.cname):t.value.data.yAxis.data=a.map(e=>e.cname)),t.value.chartType=="pie"&&(t.value.data.series[0].data=a.map(e=>({value:e.count,name:e.cname}))),t.value.chartType=="line"&&(t.value.data.series[0].data=a.map(e=>e.count),t.value.data.xAxis.data=a.map(e=>e.cname))}if(t.dataName=="level"){const a=o.data.level.filter(e=>e.logname);t.value.chartType=="bar"&&(t.value.data.series[0].data=a.map(e=>e.count),t.value.data.xAxis.type=="category"?t.value.data.xAxis.data=a.map(e=>e.logname):t.value.data.yAxis.data=a.map(e=>e.logname)),t.value.chartType=="pie"&&(t.value.data.series[0].data=a.map(e=>({value:e.count,name:e.logname}))),t.value.chartType=="line"&&(t.value.data.series[0].data=a.map(e=>e.count),t.value.data.xAxis.data=a.map(e=>e.logname))}t.dataName=="level1"&&(t.value.chartType=="bar"&&(t.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(a=>o.data.level.reduce((e,u)=>e+(Number(u[a])||0),0)),t.value.data.xAxis.type=="category"?t.value.data.xAxis.data=S:t.value.data.yAxis.data=S),t.value.chartType=="pie"&&(t.value.data.series[0].data=[{value:o.data.level.reduce((a,e)=>a+e.lev0*1,0)==0?null:o.data.level.reduce((a,e)=>a+e.lev0*1,0),name:"提示"},{value:o.data.level.reduce((a,e)=>a+e.lev1*1,0)==0?null:o.data.level.reduce((a,e)=>a+e.lev1*1,0),name:"低危"},{value:o.data.level.reduce((a,e)=>a+e.lev2*1,0)==0?null:o.data.level.reduce((a,e)=>a+e.lev2*1,0),name:"中危"},{value:o.data.level.reduce((a,e)=>a+e.lev3*1,0)==0?null:o.data.level.reduce((a,e)=>a+e.lev3*1,0),name:"高危"},{value:o.data.level.reduce((a,e)=>a+e.lev4*1,0)==0?null:o.data.level.reduce((a,e)=>a+e.lev4*1,0),name:"致命"}]),t.value.chartType=="line"&&(t.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(a=>o.data.level.reduce((e,u)=>e+(Number(u[a])||0),0)),t.value.data.xAxis.data=S))}),x.value=v.value};re(f,()=>{f.value&&_()});const w=h();return(p,c)=>{const t=$e,a=De,e=ze,u=Ae,z=Y,A=ce;return G(),M(A,{show:f.value,"onUpdate:show":c[3]||(c[3]=k=>f.value=k),preset:"card",class:"w-1000px reportPreview",style:ie({"background-color":r(P).themeScheme=="dark"?"#001428":"#fff"})},{header:i(()=>[Ie,D("span",Ve,[l(t,{class:"text-32px c-#d63031 cursor-pointer",onClick:c[0]||(c[0]=k=>w.value.toPdf(b.value))})]),D("span",Oe,[l(a,{class:"text-32px c-#1e90ff cursor-pointer",onClick:c[1]||(c[1]=k=>w.value.toWord(b.value))})]),D("span",Ge,[l(e,{class:"text-32px c-#15703d cursor-pointer",onClick:c[2]||(c[2]=k=>w.value.toExcel(b.value))})])]),default:i(()=>[l(z,{class:"max-h-600px"},{default:i(()=>[(G(),M(u,{key:x.value,ref_key:"filePreviewExportRef",ref:w,width:800,data:x.value},null,8,["data"]))]),_:1})]),_:1},8,["show","style"])}}}),Me=pe(Le,[["__scopeId","data-v-8b41cd07"]]),Fe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ue=D("div",{style:{display:"flex","align-items":"center"}},[D("div",null,"报表实例")],-1),ia=U({name:"reportmanagement_reportlist",__name:"index",setup(y){const P=ve(),{columns:R,columnChecks:o,data:f,getData:v,loading:$,mobilePagination:S,searchParams:g,resetSearchParams:x}=ke({apiFn:xe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:s=>!0,renderExpand:s=>l("div",{class:"detailList"},[l(Y,{style:"max-height: 360px"},{default:()=>[p.value.length>0?p.value.map((n,d)=>l(O,{justify:"space-between",style:{marginBottom:"8px",padding:"0px 50px 8px 50px",borderBottom:d!==p.value.length-1?"1px dashed #ccc":"none"},key:n.sn},{default:()=>[l("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[n.sn]),l(O,null,{default:()=>[V(l(E,{type:"info",size:"small",ghost:!0,onClick:()=>z(n.sn,s.rtype)},{default:()=>[T("查看")]}),[[I("no-auth"),"sys.report.instance.select"]]),l(W,{onPositiveClick:()=>k(n.sn,s.rtype,s.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>V(l(E,{type:"error",size:"small",ghost:!0},{default:()=>[T("删除")]}),[[I("no-auth"),"sys.report.instance.delete"]])})]})]})):l("div",{style:{textAlign:"center",padding:"10px"}},[T("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:s=>{var n;return l("div",null,[(n=me(Re).find(d=>d.value===s.rtype))==null?void 0:n.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:L("common.operate"),align:"center",width:160,render:s=>l("div",{class:"flex-center gap-8px"},[l(W,{onPositiveClick:()=>A(s.tid,s.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>V(l(E,{type:"primary",ghost:!0,size:"small"},{default:()=>[T("清空")]}),[[I("no-auth"),"sys.report.instance.delete"]])})])}]}),b=h(null),_=h([]),w=async s=>{_.value=[s[s.length-1]],_.value[0]&&(p.value=[],await t());const n=f.value.findIndex(d=>d.tid===s[s.length-1]);setTimeout(()=>{var d;(d=b.value)==null||d.scrollTo({top:n*40,behavior:"smooth"})},500)},p=h([]),c=J({page:1,limit:10}),t=async()=>{const s=JSON.parse(JSON.stringify(f.value)).find(m=>m.tid===_.value[0]),{data:n,error:d}=await we({tid:_.value[0],page:c.page,limit:Number(s.num)||10});d||(p.value=n.list,ye(()=>{const m=document.querySelector(".detailList");if(m){const{height:N}=m.getBoundingClientRect();m.animate([{height:"0px"},{height:`${N}px`}],{duration:300,easing:"linear"})}}))},a=h(!1),e=h({}),u=J({name:"",rtype:0}),z=async(s,n)=>{const{data:d,error:m}=await be({name:s,type:n,tid:_.value[0]});u.name=s,u.rtype=n,m||(a.value=!0,e.value=JSON.parse(d))},A=async(s,n)=>{var N;const{data:d,error:m}=await H({tid:s,type:n});m||((N=window.$message)==null||N.success("清空成功"),p.value=[],v())},k=async(s,n,d)=>{var B;const{data:m,error:N}=await H({fname:s,type:n,tid:d});N||((B=window.$message)==null||B.success("删除成功"),v(),t())};return(s,n)=>{const d=ee,m=Z,N=he,B=X;return G(),_e("div",Fe,[l(Ee,{model:r(g),"onUpdate:model":n[0]||(n[0]=C=>K(g)?g.value=C:null),onReset:r(x),onSearch:r(v)},null,8,["model","onReset","onSearch"]),l(B,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:i(()=>[Ue]),"header-extra":i(()=>[l(r(O),null,{default:i(()=>[l(r(E),{size:"small",onClick:n[1]||(n[1]=C=>r(v)())},{icon:i(()=>[l(d,{class:fe(["text-icon",{"animate-spin":r($)}])},null,8,["class"])]),default:i(()=>[T(" "+F(r(L)("common.refresh")),1)]),_:1}),l(m,{columns:r(o),"onUpdate:columns":n[2]||(n[2]=C=>K(o)?o.value=C:null)},null,8,["columns"])]),_:1})]),default:i(()=>[l(N,{ref_key:"tableContainer",ref:b,columns:r(R),data:r(f),size:"small","flex-height":!r(P).isMobile,"scroll-x":962,loading:r($),remote:"","row-key":C=>C.tid,pagination:r(S),class:"sm:h-full","expanded-row-keys":_.value,"onUpdate:expandedRowKeys":w},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),l(Me,{visible:a.value,"onUpdate:visible":n[3]||(n[3]=C=>a.value=C),data:e.value,detaliParams:u},null,8,["visible","data","detaliParams"])]),_:1})])}}});export{ia as default};
