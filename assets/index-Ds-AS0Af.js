import{_ as ue}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CvfnQZYV.js";import{_ as de}from"./round-delete-BZWJW45s.js";import{_ as me}from"./round-add-GrHQV5ws.js";import{d as J,aq as K,p as ee,s as fe,r as te,q as ae,a as _e,ar as oe,a1 as ge,c as E,o as V,w as t,f as e,b5 as he,F as ne,h as l,at as le,A,N as Q,B as k,g as N,t as P,$ as C,b6 as ve,E as ye,U as se,L as be,i as we,x as H,b as Ce,az as O,av as ze,C as G,bl as Se,e as xe,aC as je}from"./index-3FI-9vFh.js";import{f as re,g as ke,h as Ne,i as X,j as De}from"./project-BpdyYAbX.js";import{u as Pe,a as Te}from"./table-Dxi-UXTP.js";import{u as ie}from"./usePageData-BOF278ji.js";import{_ as ce}from"./Grid-BYxpeW0k.js";import{_ as pe}from"./FormItemGridItem-CvZHCSgb.js";import{_ as Ue}from"./round-search-Ckx7Z4LK.js";import{_ as Ie}from"./round-refresh-8pNylQuL.js";import{N as Y}from"./Popconfirm-D6sEyWfL.js";const Be=J({name:"OperateDrawer",__name:"operate-drawer",props:K({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(v,{emit:T}){const f=T,z=ee(),d=v,a=fe(h());function h(){return{pid:void 0,id:"",pname:"",pcontact:"",proposition:""}}const i=te([]),{pageData:u,getData:_,nextPage:S}=ie(re),U=async p=>{const n=p.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&u.data.length<u.total&&(S(),i.value=u.data)},I=async()=>{await _({fuzzy:z.userInfo.pname}),i.value=u.data},B=async()=>{await _(),i.value=u.data},F=async p=>{a.pid=p};async function y(){I(),Object.assign(a,h()),d.operateType==="add"&&(a.pid=d.pid),d.operateType==="edit"&&d.rowData&&Object.assign(a,d.rowData)}const{formRef:M,validate:$,restoreValidation:D}=ae(),c={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},pname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},proposition:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},pcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},s=_e(()=>({add:"新增联系人",edit:"修改联系人"})[d.operateType]),m=oe(v,"visible");ge(m,()=>{m.value&&(y(),setTimeout(()=>{const p=document.querySelector(".n-scrollbar-content");p==null||p.scrollTo(0,0)},300),D())});function b(){m.value=!1}async function q(){var p,n;if(await $(),d.operateType==="edit"){const{data:o,error:r}=await ke([a]);r||(b(),f("submitted"),(p=window.$message)==null||p.success("修改成功"))}else{const{data:o,error:r}=await Ne([{...a}]);r||(b(),f("submitted"),(n=window.$message)==null||n.success("添加成功"))}}return(p,n)=>{const o=pe,r=ce,x=ne,L=he,R=Q,j=ve;return V(),E(j,{show:m.value,"onUpdate:show":n[4]||(n[4]=g=>m.value=g),title:s.value,preset:"card",class:"w-500px"},{footer:t(()=>[e(R,{justify:"end",size:16},{default:t(()=>[e(l(k),{onClick:b},{default:t(()=>[N(P(l(C)("common.cancel")),1)]),_:1}),e(l(k),{type:"primary",onClick:q},{default:t(()=>[N(P(l(C)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(L,{class:"pr-20px"},{default:t(()=>[e(x,{ref_key:"formRef",ref:M,model:a,rules:c,"label-placement":"left","label-width":120},{default:t(()=>[e(r,{responsive:"screen","item-responsive":""},{default:t(()=>[e(o,{span:"24 m:24",label:"项目列表",path:"pid"},{default:t(()=>[e(l(le),{clearable:"",filterable:"",value:a.pid,"onUpdate:value":[n[0]||(n[0]=g=>a.pid=g),F],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:B,options:i.value,onScroll:U},null,8,["value","options"])]),_:1}),e(o,{span:"24 m:24",label:"姓名",path:"pname"},{default:t(()=>[e(l(A),{value:a.pname,"onUpdate:value":n[1]||(n[1]=g=>a.pname=g),placeholder:"请输入"},null,8,["value"])]),_:1}),e(o,{span:"24 m:24",label:"联系方式",path:"pcontact"},{default:t(()=>[e(l(A),{value:a.pcontact,"onUpdate:value":n[2]||(n[2]=g=>a.pcontact=g),placeholder:"请输入"},null,8,["value"])]),_:1}),e(o,{span:"24 m:24",label:"备注",path:"proposition"},{default:t(()=>[e(l(A),{value:a.proposition,"onUpdate:value":n[3]||(n[3]=g=>a.proposition=g),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Fe=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search","clear"],["update:model"]),setup(v,{emit:T}){const f=T,{formRef:z,restoreValidation:d}=ae(),a=oe(v,"model"),h=ee(),i=te([]),{pageData:u,getData:_,nextPage:S}=ie(re),U=async c=>{const s=c.currentTarget;s.scrollTop+s.offsetHeight>=s.scrollHeight&&u.data.length<u.total&&(S(),i.value=u.data)},I=async c=>{var s;c?(a.value.pid=c,f("search"),h.setProjectInfo({pname:(s=i.value.find(m=>m.id==c))==null?void 0:s.proname,pid:c})):f("clear")},B=async c=>{await _({fuzzy:c,page:1}),i.value=u.data},F=async()=>{await _(),i.value=u.data};(async()=>{var c,s;await _({fuzzy:h.userInfo.pname}),i.value=u.data,a.value.pid=h.userInfo.pid?h.userInfo.pid:(c=i.value[0])==null?void 0:c.id,h.setProjectInfo({pid:a.value.pid,pname:(s=i.value.find(m=>m.id==a.value.pid))==null?void 0:s.proname}),f("search")})();async function M(){await d(),a.value.fuzzy="",f("reset")}const $=()=>{a.value.fuzzy="",f("search")};async function D(){f("search")}return(c,s)=>{const m=le,b=pe,q=A,p=Ie,n=k,o=Ue,r=Q,x=ce,L=ne,R=se;return V(),E(R,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(L,{ref_key:"formRef",ref:z,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ye(D,["enter"])},{default:t(()=>[e(x,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(b,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:t(()=>[e(m,{filterable:"",clearable:"",value:a.value.pid,"onUpdate:value":[s[0]||(s[0]=j=>a.value.pid=j),I],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:i.value,onScroll:U,onClear:F,onSearch:B},null,8,["value","options"])]),_:1}),e(b,{span:"24 s:12 m:6",label:"姓名",path:"fuzzy"},{default:t(()=>[e(q,{value:a.value.fuzzy,"onUpdate:value":s[1]||(s[1]=j=>a.value.fuzzy=j),placeholder:"请输入",clearable:"",onClear:$},null,8,["value"])]),_:1}),e(b,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(r,{class:"w-full"},{default:t(()=>[e(n,{onClick:M},{icon:t(()=>[e(p,{class:"text-icon"})]),default:t(()=>[N(" "+P(l(C)("common.reset")),1)]),_:1}),e(n,{type:"primary",ghost:"",onClick:D},{icon:t(()=>[e(o,{class:"text-icon"})]),default:t(()=>[N(" "+P(l(C)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Me={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Z(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!je(v)}const Qe=J({name:"projectmanagement_contact",__name:"index",setup(v){const T=be(),{columns:f,columnChecks:z,data:d,getData:a,pagination:h,loading:i,mobilePagination:u,searchParams:_}=Pe({showTotal:!0,immediate:!1,apiFn:De,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"pname",title:"姓名",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pcontact",title:"联系方式",align:"center",width:120},{key:"proposition",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:C("common.operate"),align:"center",width:140,fixed:"right",render:n=>{let o;return e("div",{class:"flex-center gap-8px"},[G(e(k,{type:"primary",ghost:!0,size:"small",onClick:()=>s(n.id)},Z(o=C("common.edit"))?o:{default:()=>[o]}),[[H("no-auth"),"project:Contact:update"]]),e(Y,{onPositiveClick:()=>c(n.id)},{default:()=>C("common.confirmDelete"),trigger:()=>{let r;return G(e(k,{type:"error",ghost:!0,size:"small"},Z(r=C("common.delete"))?r:{default:()=>[r]}),[[H("no-auth"),"project:Contact:delete"]])}})])}}]}),{drawerVisible:S,operateType:U,editingData:I,handleAdd:B,handleEdit:F,checkedRowKeys:y,onBatchDeleted:M,onDeleted:$}=Te(d,a);we(async()=>{});async function D(){console.log(y.value),m(y.value.join(","),n=>{M()})}async function c(n){const{data:o,error:r}=await X(n);r||$()}function s(n){F(n)}async function m(n,o){const{data:r,error:x}=await X(n);if(!x)o&&o(r);else return!1}const b=n=>{a()},q=()=>{d.value=[],h.itemCount=0},p=()=>{a()};return(n,o)=>{const r=Q,x=me,L=de,R=ue,j=ze,g=se,W=H("no-auth");return V(),Ce("div",Me,[e(Fe,{model:l(_),"onUpdate:model":o[0]||(o[0]=w=>O(_)?_.value=w:null),onReset:p,onSearch:l(a),onClear:q},null,8,["model","onSearch"]),e(g,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(r,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>o[4]||(o[4]=[xe("div",null,"项目联系人",-1)])),_:1,__:[4]})]),"header-extra":t(()=>[e(r,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[G((V(),E(l(k),{onClick:l(B),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(x,{class:"text-icon"})]),default:t(()=>[o[5]||(o[5]=N(" "+P("新增")))]),_:1,__:[5]},8,["onClick"])),[[W,"project:Contact:insert"]]),e(l(Y),{onPositiveClick:D},{trigger:t(()=>[G((V(),E(l(k),{size:"small",ghost:"",type:"error",disabled:l(y).length==0},{icon:t(()=>[e(L,{class:Se(["text-icon",{"animate-spin":l(i)}])},null,8,["class"])]),default:t(()=>[o[6]||(o[6]=N(" "+P("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[W,"project:Contact:delete"]])]),default:t(()=>[o[7]||(o[7]=N(" 确定要删除选中的联系人吗？ "))]),_:1,__:[7]}),e(R,{columns:l(z),"onUpdate:columns":o[1]||(o[1]=w=>O(z)?z.value=w:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(j,{"checked-row-keys":l(y),"onUpdate:checkedRowKeys":o[2]||(o[2]=w=>O(y)?y.value=w:null),columns:l(f),data:l(d),size:"small","flex-height":!l(T).isMobile,loading:l(i),remote:"","row-key":w=>w.id,pagination:l(u),class:"sm:h-full","onUpdate:filters":b},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Be,{visible:l(S),"onUpdate:visible":o[3]||(o[3]=w=>O(S)?S.value=w:null),onSubmitted:l(a),pid:l(_).pid,"operate-type":l(U),"row-data":l(I)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{Qe as default};
