import{_ as Ye}from"./table-header-operation.vue_vue_type_script_setup_true_lang-dBtr50ma.js";import{aH as R,aI as he,aK as ae,aJ as pe,bA as ye,bB as et,d as ce,aM as Pe,b4 as tt,aN as Ue,a5 as at,aS as $,bC as lt,bD as it,b7 as nt,bE as st,C as ot,b8 as rt,b as le,bF as G,aR as dt,aW as ke,bG as ze,aT as _e,bH as ct,bI as De,bJ as ut,bK as pt,n as Ce,p as je,s as Oe,j as F,o as L,c as ie,w as c,g as l,i as s,W as ve,a$ as mt,h as q,t as ee,$ as A,F as Me,Z as be,B as H,N as Le,O as Be,ad as Fe,r as xe,q as ft,ae as Re,G as Y,f as we,e as ne,J as $e,ao as me,am as gt,aa as Te,bL as bt,bM as fe,aG as vt,b1 as Ge,K as ht,ap as yt,aj as Ve,af as _t,ag as xt,aZ as wt,R as $t,a3 as It,bN as Ct,bO as St,av as kt,E as Ne,D as Ae,ah as ge,ai as zt}from"./index-DOohPrRP.js";import{u as Dt,a as Rt}from"./table-BfjKpFkX.js";import{_ as Tt}from"./round-search-BxVWD0EK.js";import{_ as Nt}from"./round-refresh-BCHybn7o.js";import{c as Ke,e as At}from"./collection-BFpRf8nm.js";import{_ as Et}from"./lodash-ffFD2ya4.js";import{_ as Pt}from"./FormItemGridItem-BscgKSfD.js";import{_ as Ut}from"./Grid-CohnLNvv.js";import{a as jt,T as Ot}from"./basicconf-BFu6Z9BF.js";import{n as Mt,o as We,p as Lt,q as Bt,r as Ft}from"./events-DviBXQ6h.js";import{c as Gt,f as Vt,a as Kt}from"./common-CnjJiC9u.js";import{_ as Wt}from"./Cascader-Uo99k53p.js";import{h as Ee}from"./permission-CTKXR_21.js";import{_ as Ht}from"./Popconfirm-BCeMv-nO.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-R0GNNKKK.js";import"./setting-outlined-01_hOQ_i.js";import"./export-OgJnGaLp.js";import"./refresh-DfuWa4Y1.js";import"./round-delete-BQ3cU12H.js";import"./round-plus-CK9DqpBO.js";import"./Upload-j7MJs8TM.js";import"./Progress-C-EMU4G1.js";const qt=R("steps",`
 width: 100%;
 display: flex;
`,[R("step",`
 position: relative;
 display: flex;
 flex: 1;
 `,[he("disabled","cursor: not-allowed"),he("clickable",`
 cursor: pointer;
 `),ae("&:last-child",[R("step-splitor","display: none;")])]),R("step-splitor",`
 background-color: var(--n-splitor-color);
 margin-top: calc(var(--n-step-header-font-size) / 2);
 height: 1px;
 flex: 1;
 align-self: flex-start;
 margin-left: 12px;
 margin-right: 12px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `),R("step-content","flex: 1;",[R("step-content-header",`
 color: var(--n-header-text-color);
 margin-top: calc(var(--n-indicator-size) / 2 - var(--n-step-header-font-size) / 2);
 line-height: var(--n-step-header-font-size);
 font-size: var(--n-step-header-font-size);
 position: relative;
 display: flex;
 font-weight: var(--n-step-header-font-weight);
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `,[pe("title",`
 white-space: nowrap;
 flex: 0;
 `)]),pe("description",`
 color: var(--n-description-text-color);
 margin-top: 12px;
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `)]),R("step-indicator",`
 background-color: var(--n-indicator-color);
 box-shadow: 0 0 0 1px var(--n-indicator-border-color);
 height: var(--n-indicator-size);
 width: var(--n-indicator-size);
 border-radius: 50%;
 display: flex;
 align-items: center;
 justify-content: center;
 transition:
 background-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 `,[R("step-indicator-slot",`
 position: relative;
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 font-size: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 `,[pe("index",`
 display: inline-block;
 text-align: center;
 position: absolute;
 left: 0;
 top: 0;
 white-space: nowrap;
 font-size: var(--n-indicator-index-font-size);
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ye()]),R("icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ye()]),R("base-icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ye()])])]),he("vertical","flex-direction: column;",[et("show-description",[ae(">",[R("step","padding-bottom: 8px;")])]),ae(">",[R("step","margin-bottom: 16px;",[ae("&:last-child","margin-bottom: 0;"),ae(">",[R("step-indicator",[ae(">",[R("step-splitor",`
 position: absolute;
 bottom: -8px;
 width: 1px;
 margin: 0 !important;
 left: calc(var(--n-indicator-size) / 2);
 height: calc(100% - var(--n-indicator-size));
 `)])]),R("step-content",[pe("description","margin-top: 8px;")])])])])])]);function Zt(i,w){return typeof i!="object"||i===null||Array.isArray(i)?null:(i.props||(i.props={}),i.props.internalIndex=w+1,i)}function Jt(i){return i.map((w,g)=>Zt(w,g))}const Qt=Object.assign(Object.assign({},Ue.props),{current:Number,status:{type:String,default:"process"},size:{type:String,default:"medium"},vertical:Boolean,"onUpdate:current":[Function,Array],onUpdateCurrent:[Function,Array]}),He=nt("n-steps"),Xt=ce({name:"Steps",props:Qt,setup(i,{slots:w}){const{mergedClsPrefixRef:g,mergedRtlRef:_}=Pe(i),u=tt("Steps",_,g),b=Ue("Steps","-steps",qt,st,i,g);return at(He,{props:i,mergedThemeRef:b,mergedClsPrefixRef:g,stepsSlots:w}),{mergedClsPrefix:g,rtlEnabled:u}},render(){const{mergedClsPrefix:i}=this;return $("div",{class:[`${i}-steps`,this.rtlEnabled&&`${i}-steps--rtl`,this.vertical&&`${i}-steps--vertical`]},Jt(lt(it(this))))}}),Yt={status:String,title:String,description:String,disabled:Boolean,internalIndex:{type:Number,default:0}},ea=ce({name:"Step",props:Yt,setup(i){const w=ot(He,null);w||rt("step","`n-step` must be placed inside `n-steps`.");const{inlineThemeDisabled:g}=Pe(),{props:_,mergedThemeRef:u,mergedClsPrefixRef:b,stepsSlots:C}=w,S=le(()=>_.vertical),j=le(()=>{const{status:f}=i;if(f)return f;{const{internalIndex:h}=i,{current:T}=_;if(T===void 0)return"process";if(h<T)return"finish";if(h===T)return _.status||"process";if(h>T)return"wait"}return"process"}),V=le(()=>{const{value:f}=j,{size:h}=_,{common:{cubicBezierEaseInOut:T},self:{stepHeaderFontWeight:O,[G("stepHeaderFontSize",h)]:B,[G("indicatorIndexFontSize",h)]:E,[G("indicatorSize",h)]:J,[G("indicatorIconSize",h)]:Q,[G("indicatorTextColor",f)]:K,[G("indicatorBorderColor",f)]:W,[G("headerTextColor",f)]:se,[G("splitorColor",f)]:oe,[G("indicatorColor",f)]:te,[G("descriptionTextColor",f)]:X}}=u.value;return{"--n-bezier":T,"--n-description-text-color":X,"--n-header-text-color":se,"--n-indicator-border-color":W,"--n-indicator-color":te,"--n-indicator-icon-size":Q,"--n-indicator-index-font-size":E,"--n-indicator-size":J,"--n-indicator-text-color":K,"--n-splitor-color":oe,"--n-step-header-font-size":B,"--n-step-header-font-weight":O}}),k=g?dt("step",le(()=>{const{value:f}=j,{size:h}=_;return`${f[0]}${h[0]}`}),V,_):void 0,t=le(()=>{if(i.disabled)return;const{onUpdateCurrent:f,"onUpdate:current":h}=_;return f||h?()=>{f&&ke(f,i.internalIndex),h&&ke(h,i.internalIndex)}:void 0});return{stepsSlots:C,mergedClsPrefix:b,vertical:S,mergedStatus:j,handleStepClick:t,cssVars:g?void 0:V,themeClass:k==null?void 0:k.themeClass,onRender:k==null?void 0:k.onRender}},render(){const{mergedClsPrefix:i,onRender:w,handleStepClick:g,disabled:_}=this,u=ze(this.$slots.default,b=>{const C=b||this.description;return C?$("div",{class:`${i}-step-content__description`},C):null});return w==null||w(),$("div",{class:[`${i}-step`,_&&`${i}-step--disabled`,!_&&g&&`${i}-step--clickable`,this.themeClass,u&&`${i}-step--show-description`,`${i}-step--${this.mergedStatus}-status`],style:this.cssVars,onClick:g},$("div",{class:`${i}-step-indicator`},$("div",{class:`${i}-step-indicator-slot`},$(ct,null,{default:()=>ze(this.$slots.icon,b=>{const{mergedStatus:C,stepsSlots:S}=this;return C==="finish"||C==="error"?C==="finish"?$(De,{clsPrefix:i,key:"finish"},{default:()=>_e(S["finish-icon"],()=>[$(ut,null)])}):C==="error"?$(De,{clsPrefix:i,key:"error"},{default:()=>_e(S["error-icon"],()=>[$(pt,null)])}):null:b||$("div",{key:this.internalIndex,class:`${i}-step-indicator-slot__index`},this.internalIndex)})})),this.vertical?$("div",{class:`${i}-step-splitor`}):null),$("div",{class:`${i}-step-content`},$("div",{class:`${i}-step-content-header`},$("div",{class:`${i}-step-content-header__title`},_e(this.$slots.title,()=>[this.title])),this.vertical?null:$("div",{class:`${i}-step-splitor`})),u))}}),ta=ce({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Ce(["reset","search"],["update:model"]),setup(i,{emit:w}){const g=w,{formRef:_,restoreValidation:u}=je(),b=Oe(i,"model");F();const C=async k=>{j()};async function S(){await u(),g("reset")}async function j(){g("search")}const V=Et.debounce(j,1e3,{leading:!0,trailing:!1});return(k,t)=>{const f=be,h=Pt,T=Nt,O=H,B=Tt,E=Le,J=Ut,Q=Be,K=Fe;return L(),ie(K,{bordered:!1,size:"small",class:"card-wrapper"},{default:c(()=>[l(Q,{ref_key:"formRef",ref:_,model:b.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Me(s(V),["enter"])},{default:c(()=>[l(J,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:c(()=>[l(h,{span:"24 s:12 m:6",label:"接入方式",path:"itype"},{default:c(()=>[l(f,{value:b.value.itype,"onUpdate:value":[t[0]||(t[0]=W=>b.value.itype=W),C],placeholder:"请选择接入方式",filterable:"",options:s(ve)(s(Ke))},null,8,["value","options"])]),_:1}),l(h,{span:"24 s:12 m:8 l:6",label:"状态",path:"ieanble"},{default:c(()=>[l(f,{filterable:"",value:b.value.ieanble,"onUpdate:value":[t[1]||(t[1]=W=>b.value.ieanble=W),j],clearable:"",placeholder:"请选择状态",options:s(ve)(s(mt)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),l(h,{span:"24 s:12 m:8 l:6"},{default:c(()=>[l(E,{class:"w-full"},{default:c(()=>[l(O,{onClick:S},{icon:c(()=>[l(T,{class:"text-icon"})]),default:c(()=>[q(" "+ee(s(A)("common.reset")),1)]),_:1}),l(O,{type:"primary",ghost:"",onClick:s(V)},{icon:c(()=>[l(B,{class:"text-icon"})]),default:c(()=>[q(" "+ee(s(A)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),aa={class:"ml-30px h-100%"},la={style:{width:"100%",border:"1px solid #ccc",padding:"8px","white-space":"pre-wrap","user-select":"none"}},ia="(?<dbtime>[A-Za-z]{3}\\s{1,2}\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{4}[-/]\\d{2}[-/]\\d{2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{1,2}-[A-Za-z]{3}-\\d{4}\\s\\d{2}:\\d{2}:\\d{2}|\\d{2}:\\d{2}:\\d{2}\\s\\d{4}(?:[-/]\\d{2}){2})",na="(?<etime>[A-Za-z]{3}\\s{1,2}\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{4}[-/]\\d{2}[-/]\\d{2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{1,2}-[A-Za-z]{3}-\\d{4}\\s\\d{2}:\\d{2}:\\d{2}|\\d{2}:\\d{2}:\\d{2}\\s\\d{4}(?:[-/]\\d{2}){2})",sa=ce({name:"OperateDrawer",__name:"operate-drawer",props:Ce({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Ce(["submitted","setItype"],["update:visible"]),setup(i,{emit:w}){const g=i,_=w,u=xe({current:1}),b=Oe(i,"visible"),{formRef:C,validate:S,restoreValidation:j}=je(),{defaultRequiredRule:V}=ft(),k=le(()=>({add:"新增自定义解析",edit:"修改自定义解析"})[g.operateType]),t=xe(f());function f(){return{id:void 0,itype:null,cvalue:"",orilog:"",multi:"",expre:"",ieanble:0,alevel:void 0,isort:0,itext:"",result:"",logcateid:null,logtypeid:null,ectgrid:void 0,etypeid:void 0}}const h={orilog:V,itype:{required:!0,type:"number",trigger:["blur","change"],message:"接入方式"},logtypeid:{required:!0,type:"number",trigger:["blur","change"],message:"请选择日志源设备"},etypeid:{required:!0,type:"number",trigger:["blur","change"],message:"请选择事件"}},T=`Time${bt()}`,O=F([{id:1,value:"(?<priority>.+)",label:"优先级",disabled:!1},{id:2,value:T,label:"日志时间",disabled:!1},{id:100,value:"(?<gsubject>.+)",label:"事件主体",disabled:!1},{id:101,value:"(?<gobject>.+)",label:"事件客体",disabled:!1},{id:102,value:"(?<gdescribe>.+)",label:"事件描述",disabled:!1},{id:103,value:"(?<gresult>.+)",label:"事件结果",disabled:!1},{id:3,value:"(?<hname>.+)",label:"主机名",disabled:!1},{id:4,value:"(?<aname>.+)",label:"应用名称",disabled:!1},{id:5,value:"(?<procid>.+)",label:"PROCID",disabled:!1},{id:6,value:"(?<msgid>.+)",label:"MSGID",disabled:!1},{id:7,value:"(?<adata>{[sS]*?})",label:"结构数据",disabled:!1},{id:8,value:"(?<lcon>.+)",label:"日志内容",disabled:!1}]),B=F([{id:1,value:"(?<eige>.+)",label:"特征值ID",disabled:!1},{id:2,value:"(?<userv>.+)",label:"用户ID",disabled:!1},{id:100,value:"(?<osubject>.+)",label:"事件主体",disabled:!1},{id:101,value:"(?<oobject>.+)",label:"事件客体",disabled:!1},{id:102,value:"(?<odescribe>.+)",label:"事件描述",disabled:!1},{id:103,value:"(?<oresult>.+)",label:"事件结果",disabled:!1},{id:3,value:"(?<target>.+)",label:"目标对象",disabled:!1},{id:4,value:T,label:"日志时间",disabled:!1},{id:5,value:"(?<oaction>.+)",label:"动作",disabled:!1},{id:6,value:"(?<eresult>.+)",label:"事件结果",disabled:!1},{id:7,value:"(?<edesc>.+)",label:"事件描述",disabled:!1},{id:8,value:"(?<originip>.+)",label:"源IP",disabled:!1},{id:9,value:"(?<originaddr>.+)",label:"源地址",disabled:!1},{id:10,value:"(?<originport>.+)",label:"源端口",disabled:!1},{id:11,value:"(?<originasset>.+)",label:"源资产",disabled:!1},{id:12,value:"(?<originmac>.+)",label:"源MAC",disabled:!1},{id:13,value:"(?<originmask>.+)",label:"源掩码",disabled:!1},{id:14,value:"(?<aimip>.+)",label:"目的IP",disabled:!1},{id:15,value:"(?<aimaddr>.+)",label:"目的地址",disabled:!1},{id:16,value:"(?<aimport>.+)",label:"目的端口",disabled:!1},{id:17,value:"(?<aimasset>.+)",label:"目的资产",disabled:!1},{id:18,value:"(?<aimmac>.+)",label:"目的MAC地址",disabled:!1},{id:19,value:"(?<aimmask>.+)",label:"目的掩码",disabled:!1},{id:20,value:"(?<sourceip>.+)",label:"发生源IP",disabled:!1},{id:21,value:"(?<sourcecountry>.+)",label:"源国家",disabled:!1},{id:22,value:"(?<sourcecountrylong>.+)",label:"源国家经度",disabled:!1},{id:23,value:"(?<sourcecountrylati>.+)",label:"源国家纬度",disabled:!1},{id:24,value:"(?<sourceregin>.+)",label:"源区域",disabled:!1},{id:25,value:"(?<sourcereginlong>.+)",label:"源区域经度",disabled:!1},{id:26,value:"(?<sourcereginlati>.+)",label:"源区域维度",disabled:!1},{id:27,value:"(?<aimcountry>.+)",label:"目的国家",disabled:!1},{id:28,value:"(?<aimcountrylong>.+)",label:"目的国家经度",disabled:!1},{id:29,value:"(?<aimcountrylati>.+)",label:"目的国家纬度",disabled:!1},{id:30,value:"(?<aimregin>.+)",label:"目的区域",disabled:!1},{id:31,value:"(?<aimreginlong>.+)",label:"目的区域经度",disabled:!1},{id:32,value:"(?<aimreginlati>.+)",label:"目的区域维度",disabled:!1},{id:33,value:"(?<protocol>.+)",label:"协议",disabled:!1}]),E=F(),J=async()=>{const{data:e,error:a}=await Gt();a||(E.value=e.map(d=>({...d,id:"-"+d.id,type:d.cname})))},Q=(e,a)=>{console.log(a),t.logcateid=a==null?void 0:a.category,t.logtypeid=a==null?void 0:a.id},K=F();async function W(){const{data:e,error:a}=await Vt();a||(K.value=e,await se())}async function se(){const{data:e,error:a}=await Kt();if(!a){let d=K.value.concat(e);K.value=wt(d)}}const oe=(e,a)=>{t.ectgrid=a==null?void 0:a.pid,t.etypeid=a==null?void 0:a.id};async function te(){u.current=1,J(),W(),M.list=[],P.value=new Set([]),Object.assign(t,f()),g.operateType==="edit"&&g.rowData&&Object.assign(t,g.rowData)}function X(){b.value=!1}const P=F(new Set),o=F(null),r=F([]);function I(e){var de,ue;let a=!0;const d=t.orilog,v=window.getSelection();if(!v.rangeCount)return;const p=v.getRangeAt(0),n=p.startContainer,x=p.endContainer;if(v.removeAllRanges(),!o.value.contains(n)||!o.value.contains(x))return;const Z=Array.from(o.value.childNodes),m=Z.indexOf(n.parentNode)-1,D=Z.indexOf(x.parentNode);if(console.log("startIndex",m),console.log("endIndex",D),D-m==0)return!1;for(let U=m;U<D;U++)P.value.has(U)&&(console.log("尝试选择已禁用的字符，操作被阻止"),a=!1);if(a){if(m>=0&&D>=0&&m<=D)for(let U=m;U<D;U++)r.value.push(U);for(let U=m;U<D;U++)P.value.add(U);m>0&&P.value.add(m-1),D<d.length&&P.value.add(D),M.list.push({startIndex:m,endIndex:D,name:d.substring(m,D),multipegroup:null,value:null})}else return(de=window.$message)==null||de.destroyAll(),(ue=window.$message)==null||ue.warning("相邻划词不允许选中。"),!1;console.log("当前选中的文本:",d.substring(m,D)),console.log("已禁用的字符索引:",Array.from(P.value))}async function N(){var e,a;if(console.log(t),g.operateType==="add"){const{data:d,error:v}=await Mt([{itype:t.itype,itext:fe(String.raw`${t.expre}`),ieanble:t.ieanble,alevel:t.alevel,isort:t.isort,logcateid:t.logcateid,logtypeid:t.logtypeid,ectgrid:t.ectgrid,etypeid:t.etypeid}]);v||((e=window.$message)==null||e.success(A("common.addSuccess")),X(),_("submitted"),_("setItype",t.itype))}else{const{data:d,error:v}=await We([{id:t.id,itype:t.itype,itext:fe(String.raw`${t.expre}`),ieanble:t.ieanble,alevel:t.alevel,isort:t.isort,logcateid:t.logcateid,logtypeid:t.logtypeid,ectgrid:t.ectgrid,etypeid:t.etypeid}]);v||((a=window.$message)==null||a.success(A("common.updateSuccess")),X(),_("submitted"))}}const re=async()=>{console.log(String.raw`${t.expre}`);const{data:e,error:a}=await Lt({pattern:fe(String.raw`${t.expre}`),originalLog:fe(t.orilog),type:t.itype==0||t.itype==1?0:1});e&&(t.result=(t.itype==0||t.itype==1?[e.lsid&&`设备ID: ${e.lsid}`,e.rdbtime&&`接收时间: ${e.rdbtime}`,e.gsubject&&`事件主体: ${e.gsubject}`,e.gobject&&`事件客体: ${e.gobject}`,e.gdescribe&&`事件描述: ${e.gdescribe}`,e.gresult&&`事件结果: ${e.gresult}`,e.lmid&&`模块ID: ${e.lmid}`,e.leid&&`级别ID: ${e.leid}`,e.ipaddr&&`发生源IP: ${e.ipaddr}`,e.aname&&`应用名称: ${e.aname}`,e.procid&&`PROCID: ${e.procid}`,e.msgid&&`MSGID: ${e.msgid}`,e.dbtime&&`日志时间: ${e.dbtime}`,e.hname&&`主机名称: ${e.hname}`,e.adata&&`结构数据: ${e.adata}`,e.lcon&&`日志内容: ${e.lcon}`,e.ltext&&`日志原文: ${e.ltext}`]:[e.eige&&`特征值ID: ${e.eige}`,e.userv&&`用户ID: ${e.userv}`,e.osubject&&`事件主体: ${e.osubject}`,e.oobject&&`事件客体: ${e.oobject}`,e.odescribe&&`事件描述: ${e.oresult}`,e.oresult&&`事件结果: ${e.oresult}`,e.target&&`目标对象: ${e.target}`,e.etime&&`日志时间: ${e.etime}`,e.oaction&&`动作: ${e.oaction}`,e.eresult&&`事件结果: ${e.eresult}`,e.edesc&&`事件描述: ${e.edesc}`,e.originip&&`源IP: ${e.originip}`,e.originaddr&&`源地址: ${e.originaddr}`,e.originport&&`源端口: ${e.originport}`,e.originasset&&`源资产: ${e.originasset}`,e.originmac&&`源MAC: ${e.originmac}`,e.originmask&&`源掩码: ${e.originmask}`,e.aimip&&`目的IP: ${e.aimip}`,e.aimaddr&&`目的地址: ${e.aimaddr}`,e.aimport&&`目的端口: ${e.aimport}`,e.aimasset&&`目的资产: ${e.aimasset}`,e.aimmac&&`目的MAC地址: ${e.aimmac}`,e.aimmask&&`目的掩码: ${e.aimmask}`,e.sourceip&&`发生源IP: ${e.sourceip}`,e.sourcecountry&&`源国家: ${e.sourcecountry}`,e.sourcecountrylong&&`源国家经度: ${e.sourcecountrylong}`,e.sourcecountrylati&&`源国家纬度: ${e.sourcecountrylati}`,e.sourceregin&&`源区域: ${e.sourceregin}`,e.sourcereginlong&&`源区域经度: ${e.sourcereginlong}`,e.sourcereginlati&&`源区域维度: ${e.sourcereginlati}`,e.aimcountry&&`目的国家: ${e.aimcountry}`,e.aimcountrylong&&`目的国家经度: ${e.aimcountrylong}`,e.aimcountrylati&&`目的国家纬度: ${e.aimcountrylati}`,e.aimregin&&`目的区域: ${e.aimregin}`,e.aimreginlong&&`目的区域经度: ${e.aimreginlong}`,e.aimreginlati&&`目的区域维度: ${e.aimreginlati}`,e.protocol&&`协议: ${e.protocol}`]).filter(Boolean).join(`
`),u.current&&u.current++),console.log(e)};Re(b,()=>{b.value&&(r.value=[],te(),j())});const z=F([{title:"字段值",key:"name",width:160,align:"center",ellipsis:{tooltip:!0}},{title:"对应规则",key:"multipegroup",align:"center",width:160,render(e,a){return $(be,{size:"small",clearable:!0,valueField:"id",filterable:!0,options:t.itype==0||t.itype==1?O.value:B.value,value:e.multipegroup,"onUpdate:value":d=>{e.multipegroup=d,e.value=null;const v=M.list.map(p=>p.multipegroup);t.itype==0||t.itype==1?O.value.forEach(p=>{v.includes(p.id)?p.disabled=!0:p.disabled=!1}):B.value.forEach(p=>{v.includes(p.id)?p.disabled=!0:p.disabled=!1}),console.log(e.multipegroup)}})}},{key:"operate",title:A("common.operate"),align:"center",width:80,fixed:"right",render(e,a){return $(H,{size:"small",type:"error",ghost:!0,onClick:()=>Ze(e,a)},{default:()=>A("common.delete")})}}]);function qe(e,a){return e.filter(d=>!a.includes(d))}function Ze(e,a){console.log(e,a),B.value.forEach(n=>{n.id==e.multipegroup&&(n.disabled=!1)}),O.value.forEach(n=>{n.id==e.multipegroup&&(n.disabled=!1)});let d=[e.startIndex-1,e.endIndex];M.list.splice(a,1);for(let n=e.startIndex;n<e.endIndex;n++)d.push(n);const v=Math.max(...d),p=Math.min(...d);P.value.has(v+1)&&(d=d.filter(n=>n!==v)),P.value.has(p-1)&&(d=d.filter(n=>n!==p)),P.value=new Set(qe(Array.from(P.value),d)),r.value=[],M.list.forEach(n=>{for(let x=n.startIndex;x<n.endIndex;x++)r.value.push(x)})}const M=xe({list:[]});function Je(e,a){const d=[...a].sort((p,n)=>n.startIndex-p.startIndex);let v=e;for(const{startIndex:p,endIndex:n,replacement:x}of d){if(p<0||n>=e.length||p>n)throw new Error("Invalid index range");const Z=v.slice(0,p),m=v.slice(n+1);v=Z+x+m}return v}Re(()=>t.orilog,()=>{M.list=[],r.value=[],P.value=new Set([]),B.value.forEach(e=>{e.disabled=!1}),O.value.forEach(e=>{e.disabled=!1})});function Qe(e){return e.replace(/(\(\?<[^>]+>[^)]+\))|[-\/\\^$*+?.()|[\]{}]/g,(a,d)=>d||`\\${a}`)}async function Xe(){var e,a,d,v;if(u.current==1)await S(),u.current++,vt(()=>{var p;(p=g.rowData)!=null&&p.id&&(r.value=[],M.list.forEach(n=>{for(let x=n.startIndex;x<n.endIndex;x++)r.value.push(x)}))});else{let p=!0;if(M.list.length>0){for(let n=0;n<M.list.length;n++)if(!M.list[n].multipegroup){p=!1;break}if(p){t.cvalue="",t.multi="";let n={},x=[];t.itype==0||t.itype==1?O.value.forEach(m=>{n[m.id]=m.value}):B.value.forEach(m=>{n[m.id]=m.value}),M.list.forEach((m,D)=>{t.cvalue+=m.name+"，",t.multi+=m.multipegroup+",",x.push({startIndex:m.startIndex,endIndex:m.endIndex-1,replacement:n[m.multipegroup]})}),console.log("finallyTransArr",x),t.cvalue=t.cvalue.substring(0,t.cvalue.length-1),t.multi=t.multi.substring(0,t.multi.length-1);const Z=Je(t.orilog,x);t.expre=Qe(Z).replace(T,t.itype==0||t.itype==1?ia:na),console.log(t.expre),u.current&&u.current++}else return(e=window.$message)==null||e.destroyAll(),(a=window.$message)==null||a.warning("请补充完整内容。"),!1}else return(d=window.$message)==null||d.destroyAll(),(v=window.$message)==null||v.warning("请添加日志划词。"),!1}}return(e,a)=>{const d=ea,v=Xt,p=Ge,n=ht,x=Wt,Z=yt,m=Ve,D=Be,de=Le,ue=_t,U=xt;return L(),ie(U,{show:b.value,"onUpdate:show":a[10]||(a[10]=y=>b.value=y),"display-directive":"show",width:1e3,"content-style":{height:"100%"}},{default:c(()=>[l(ue,{title:k.value,"native-scrollbar":!0,closable:"","body-content-style":{height:"100%"}},{footer:c(()=>[l(de,{size:16},{default:c(()=>[l(s(H),{onClick:X},{default:c(()=>[q(ee(s(A)("common.cancel")),1)]),_:1}),u.current===2||u.current===3?(L(),ie(s(H),{key:0,onClick:a[9]||(a[9]=y=>u.current--)},{default:c(()=>[q("上一步")]),_:1})):Y("",!0),u.current===1||u.current===2?(L(),ie(s(H),{key:1,type:"primary",onClick:Xe},{default:c(()=>[q(ee(u.current===1?"下一步":"生成解析"),1)]),_:1})):Y("",!0),u.current===3?(L(),ie(s(H),{key:2,type:"primary",onClick:re},{default:c(()=>[q(ee("验证解析"))]),_:1})):Y("",!0),u.current===4?(L(),ie(s(H),{key:3,type:"primary",onClick:N},{default:c(()=>[q(ee(s(A)("common.confirm")),1)]),_:1})):Y("",!0)]),_:1})]),default:c(()=>[l(de,{class:"h-100%",style:{gap:"0 !important"},"item-class":"NSpaceItem"},{default:c(()=>[l(v,{vertical:"",current:u.current,class:"h-400px"},{default:c(()=>[l(d,{title:"基本信息"}),l(d,{title:"日志划词"}),l(d,{title:"生成解析"})]),_:1},8,["current"]),we("div",aa,[l(D,{ref_key:"formRef",ref:C,model:t,rules:h,onKeyup:Me(N,["enter"]),style:{height:"100%",display:"flex","flex-direction":"column"}},{default:c(()=>[u.current===1?(L(),ne(me,{key:0},[l(n,{label:"使用状态",path:"ieanble"},{default:c(()=>[l(p,{value:t.ieanble,"onUpdate:value":a[0]||(a[0]=y=>t.ieanble=y),"checked-value":0,"unchecked-value":1},null,8,["value"])]),_:1}),l(n,{label:"接入方式",path:"itype"},{default:c(()=>[l(s(be),{value:t.itype,"onUpdate:value":a[1]||(a[1]=y=>t.itype=y),placeholder:"请选择接入方式",filterable:"",clearable:"",options:s(ve)(s(Ke))},null,8,["value","options"])]),_:1}),l(n,{label:"日志源设备",path:"logtypeid"},{default:c(()=>[l(x,{value:t.logtypeid,"onUpdate:value":[a[2]||(a[2]=y=>t.logtypeid=y),Q],placeholder:"请选择日志源设备",options:E.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"","show-path":!1},null,8,["value","options"])]),_:1}),l(n,{label:"事件",path:"etypeid"},{default:c(()=>[l(x,{value:t.etypeid,"onUpdate:value":[a[3]||(a[3]=y=>t.etypeid=y),oe],clearable:"",placeholder:"请选择事件",options:K.value,"show-path":!1,"check-strategy":"child","value-field":"id","label-field":"pname"},null,8,["value","options"])]),_:1}),l(n,{label:"告警级别",path:"alevel"},{default:c(()=>[l(s(be),{filterable:"",clearable:"",placeholder:s(A)("page.manage.alarm.form.level"),value:t.alevel,"onUpdate:value":a[4]||(a[4]=y=>t.alevel=y),options:s(ve)(s(jt))},null,8,["placeholder","value","options"])]),_:1}),l(n,{label:"排序",path:"isort"},{default:c(()=>[l(Z,{value:t.isort,"onUpdate:value":a[5]||(a[5]=y=>t.isort=y),placeholder:"请输入排序",style:{width:"100%"}},null,8,["value"])]),_:1}),l(n,{label:"日志原文",path:"orilog"},{default:c(()=>[l(s($e),{type:"textarea",value:t.orilog,"onUpdate:value":a[6]||(a[6]=y=>t.orilog=y),placeholder:"请输入日志原文",clearable:"",autosize:{minRows:5,maxRows:20},style:{width:"100%",height:"100%"}},null,8,["value"])]),_:1})],64)):Y("",!0),u.current===2?(L(),ne(me,{key:1},[l(n,{label:"日志原文",path:"orilog"},{default:c(()=>[we("div",la,[we("div",{class:"w-100%",ref_key:"editableDiv",ref:o,style:{"user-select":"text"},onMouseup:I},[(L(!0),ne(me,null,gt(t.orilog,(y,Se)=>(L(),ne("span",{key:Se,style:Te({color:r.value.includes(Se)?"#f00":"#000"})},ee(y),5))),128))],544)])]),_:1}),l(n,{label:"划词信息",style:{flex:"1"}},{default:c(()=>[l(m,{columns:z.value,data:M.list,style:Te([{width:"100%"},{height:"100%"}]),"scroll-x":702,"flex-height":""},null,8,["columns","data"])]),_:1})],64)):Y("",!0),u.current===3||u.current===4?(L(),ne(me,{key:2},[l(n,{label:"表达式",path:"expre"},{default:c(()=>[l(s($e),{type:"textarea",value:t.expre,"onUpdate:value":a[7]||(a[7]=y=>t.expre=y),placeholder:"请输入表达式",style:{width:"100%"},readonly:"",autosize:{minRows:5,maxRows:7}},null,8,["value"])]),_:1}),l(n,{label:"解析结果",path:"result"},{default:c(()=>[l(s($e),{type:"textarea",value:t.result,"onUpdate:value":a[8]||(a[8]=y=>t.result=y),placeholder:"解析结果",style:{width:"100%",height:"100%"},readonly:"",autosize:{minRows:6,maxRows:20}},null,8,["value"])]),_:1})],64)):Y("",!0)]),_:1},8,["model"])])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),oa=$t(sa,[["__scopeId","data-v-d4defd35"]]),ra={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Ie(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!zt(i)}const Na=ce({name:"eventalarm_customparsing",__name:"index",setup(i){const w=It();F(),F();const g={dbtime:"日志时间",priority:"优先级",hname:"主机名",aname:"应用名",procid:"进程ID",msgid:"消息ID",adata:"结构数据",lcon:"日志内容",eige:"特征值ID",userv:"用户ID",target:"目标对象",etime:"日志时间",oaction:"动作",eresult:"事件结果",edesc:"事件描述",originip:"源IP",originaddr:"源地址",originport:"源端口",originasset:"源资产",originmac:"源MAC",originmask:"源掩码",aimip:"目的IP",aimaddr:"目的地址",aimport:"目的端口",aimasset:"目的资产",aimmac:"目的MAC地址",aimmask:"目的掩码",sourceip:"发生源IP",sourcecountry:"源国家",sourcecountrylong:"源国家经度",sourcecountrylati:"源国家纬度",sourceregin:"源区域",sourcereginlong:"源区域经度",sourcereginlati:"源区域维度",aimcountry:"目的国家",aimcountrylong:"目的国家经度",aimcountrylati:"目的国家纬度",aimregin:"目的区域",aimreginlong:"目的区域经度",aimreginlati:"目的区域维度",protocol:"协议"},_=(o,r)=>o.replace(/\?<(\w+)>/g,(I,N)=>`?<${r[N]||N}>`),{columns:u,columnChecks:b,data:C,getData:S,loading:j,mobilePagination:V,searchParams:k,resetSearchParams:t}=Dt({apiFn:Bt,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,itype:0,ieanble:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"itype",title:"接入方式",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:o=>{const r=At;return l("span",null,[q(" "),r[o.itype]])}},{key:"itext",title:"匹配规则",align:"center",render:o=>l("span",null,[q(" "),_(Ct(St(o.itext)),g)])},{key:"isort",title:"排序",align:"center",width:120,render:o=>((o.isort===void 0||o.isort===null)&&(o.isort=0),l("span",null,[o.isort]))},{key:"alevel",title:"告警级别",align:"center",width:120,render:o=>{(o.alevel===void 0||o.alevel===null)&&(o.alevel=0);const r={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},I=A(Ot[o.alevel]);let N={color:r[o.alevel],textColor:"#ffffff",borderColor:r[o.alevel]};return l(kt,{size:"small",color:N},Ie(I)?I:{default:()=>[I]})},resizable:!0},{key:"ieanble",title:"是否启用",align:"center",width:160,render:o=>l(Ge,{value:o.ieanble,"onUpdate:value":[r=>o.ieanble=r,()=>P(o)],checkedValue:0,uncheckedValue:1},null)},{key:"operate",title:A("common.operate"),align:"center",width:160,fixed:"right",render:o=>{let r;return l("div",{class:"flex-center gap-8px"},[Ne(l(H,{type:"info",ghost:!0,size:"small",onClick:()=>se(o.id)},Ie(r=A("common.edit"))?r:{default:()=>[r]}),[[Ae("no-auth"),"custorm.parsing.update"]]),l(Ht,{onPositiveClick:()=>oe(o.id)},{default:()=>A("common.confirmDelete"),trigger:()=>{let I;return Ne(l(H,{type:"error",ghost:!0,size:"small"},Ie(I=A("common.delete"))?I:{default:()=>[I]}),[[Ae("no-auth"),"custorm.parsing.delete"]])}})])}}]}),{drawerVisible:f,operateType:h,editingData:T,handleAdd:O,handleEdit:B,checkedRowKeys:E,onBatchDeleted:J,onDeleted:Q,closeDrawer:K}=Rt(C,S);async function W(){console.log(E.value),te(E.value,o=>{J()})}function se(o){B(o)}function oe(o){console.log(o),te([o],r=>{Q()})}async function te(o,r){const{data:I,error:N}=await Ft(o);if(!N)r&&r(I);else return!1}async function X(){}async function P(o){var I,N;const r={id:o.id,ieanble:o.ieanble};try{const{data:re,error:z}=await We([r]);if(!z)(I=window.$message)==null||I.success(o.ieanble===0?"启用成功":"停用成功"),S();else throw new Error("更新失败")}catch{o.ieanble=o.ieanble===1?0:1,(N=window.$message)==null||N.error("操作失败，请重试")}}return(o,r)=>{const I=Ye,N=Ve,re=Fe;return L(),ne("div",ra,[l(ta,{model:s(k),"onUpdate:model":r[0]||(r[0]=z=>ge(k)?k.value=z:null),onReset:s(t),onSearch:s(S)},null,8,["model","onReset","onSearch"]),l(re,{title:"自定义解析",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":c(()=>[l(I,{columns:s(b),"onUpdate:columns":r[1]||(r[1]=z=>ge(b)?b.value=z:null),"disabled-delete":s(E).length===0,loading:s(j),onAdd:s(O),onDelete:W,onRefresh:s(S),"is-view-export-button":!0,onExportHandler:X,"is-view-add-button":s(Ee)("custorm.parsing.insert"),"is-view-delete-button":s(Ee)("custorm.parsing.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:c(()=>[l(N,{"checked-row-keys":s(E),"onUpdate:checkedRowKeys":r[2]||(r[2]=z=>ge(E)?E.value=z:null),columns:s(u),data:s(C),size:"small","flex-height":!s(w).isMobile,"scroll-x":962,loading:s(j),remote:"","row-key":z=>z.id,pagination:s(V),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),l(oa,{visible:s(f),"onUpdate:visible":r[3]||(r[3]=z=>ge(f)?f.value=z:null),"operate-type":s(h),onSetItype:r[4]||(r[4]=z=>{s(k).itype=z,s(S)()}),"row-data":s(T),onSubmitted:s(S)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Na as default};
