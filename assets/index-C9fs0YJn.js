import{_ as we}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DSLF4GvF.js";import{d as Z,q as Y,x as le,s as re,F as V,o as R,c as L,w as a,g as e,G as F,i as n,Y as j,am as ie,h as f,t as $,$ as u,H as pe,L as ue,a1 as ce,B as K,P as de,Q as me,af as _e,v as De,ag as ae,b as xe,r as fe,an as Ne,e as J,ao as ne,ap as X,aq as se,f as E,ar as ke,as as Se,S as Te,at as Ae,au as Ce,a5 as Re,av as G,aw as qe,ax as ze,aj as W,ak as Oe,al as Ue}from"./index-BP7F9FxI.js";import{u as $e,a as Be}from"./table-BZRWUD8G.js";import{f as ge,a as Ie,b as Me,c as Pe,d as je}from"./asset-BE2JUzS3.js";import{_ as Fe}from"./round-search-DyyzfEdI.js";import{_ as Ge}from"./round-refresh-81nSFoBL.js";import{_ as Le}from"./lodash-BXGszeVa.js";import{_ as be}from"./FormItemGridItem-C7_XHVbB.js";import{_ as ye}from"./Grid-Bo5eh9Zu.js";import{u as Ve}from"./usePageData-EyGt1fNJ.js";import{h as oe}from"./permission-DYmPksV5.js";import{_ as Ke}from"./Popconfirm-Dg6vV92x.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-HgT7VkxX.js";import"./setting-outlined-D9DSfit9.js";import"./export-D1GS-u1R.js";import"./refresh-DvrXeenc.js";import"./round-delete-Ch_nGZvJ.js";import"./round-plus-BypMaIJk.js";import"./Upload-K8gDmy3J.js";import"./Progress-DwZ6AxQJ.js";const Ee=Z({name:"AssetallocationSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Y(["reset","search"],["update:model"]),setup(g,{emit:B}){const p=B,m=le(g,"model"),{formRef:v,restoreValidation:I}=re();async function w(){await I(),p("reset")}function N(){p("search")}const b=Le.debounce(N,1e3,{leading:!0,trailing:!1});return(M,t)=>{const D=ue,k=be,S=ce,T=Ge,q=K,x=Fe,z=de,A=ye,P=me,O=_e,y=V("no-space");return R(),L(O,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(P,{model:m.value,"label-placement":"left","label-width":80,"show-feedback":!1,onKeyup:pe(n(b),["enter"])},{default:a(()=>[e(A,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:a(()=>[e(k,{span:"24 s:12 m:8 l:6",label:"属性名称",path:"fuzzy"},{default:a(()=>[F(e(D,{clearable:"",value:m.value.fuzzy,"onUpdate:value":t[0]||(t[0]=o=>m.value.fuzzy=o),placeholder:"请输入属性名称",onClear:w},null,8,["value"]),[[y]])]),_:1}),e(k,{span:"24 s:12 m:8 l:6",label:"控件类型",path:"atype"},{default:a(()=>[e(S,{filterable:"",clearable:"",value:m.value.atype,"onUpdate:value":[t[1]||(t[1]=o=>m.value.atype=o),N],placeholder:"请选择控件类型",options:n(j)(n(ie))},null,8,["value","options"])]),_:1}),e(k,{span:"24 s:12 m:8 l:6"},{default:a(()=>[e(z,{class:"w-full"},{default:a(()=>[e(q,{onClick:w},{icon:a(()=>[e(T,{class:"text-icon"})]),default:a(()=>[f(" "+$(n(u)("common.reset")),1)]),_:1}),e(q,{type:"primary",ghost:"",onClick:n(b)},{icon:a(()=>[e(x,{class:"text-icon"})]),default:a(()=>[f(" "+$(n(u)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),He=E("span",null,[f("资产类型 "),E("br"),f("一级分类")],-1),We=E("span",null,[f("资产类型 "),E("br"),f("二级分类")],-1),Qe=Z({name:"OperateDrawer",__name:"operate-drawer",props:Y({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(g,{emit:B}){const p=g,m=B,v=le(g,"visible"),{formRef:I,validate:w,restoreValidation:N}=re(),{defaultRequiredRule:b}=De();ae(()=>p.rowData,()=>{});const M=xe(()=>({add:"新建资产属性",edit:"编辑资产属性"})[p.operateType]),t=fe(D());function D(){return{aname:"",req:0,atype:void 0,asseta:void 0,assetb:void 0,textleg:32,mtpche:1,adesc:""}}const k={aname:b,atype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择控件类型"},asseta:{type:"number",required:!0,trigger:["blur","change"],message:"请选择资产一级分类"},assetb:{type:"number",required:!0,trigger:["blur","change"],message:"请选择资产二级分类"}};async function S(){Object.assign(t,D()),p.operateType==="edit"&&p.rowData&&(await z({page:1,pid:p.rowData.asseta}),Object.assign(t,p.rowData))}function T(){v.value=!1}async function q(){x.data=[],t.assetb=null,await z({page:1,pid:t.asseta})}const{pageData:x,getData:z,nextPage:A}=Ve(ge),P=async y=>{const o=y.currentTarget;o.scrollTop+o.offsetHeight>=o.scrollHeight&&x.data.length<x.total&&A({pid:1})};async function O(){var y,o,C;if(await w(),p.operateType==="add"){const{data:d,error:_}=await Ie([{aname:t.aname,atype:t.atype,asseta:t.asseta,assetb:t.assetb,textleg:t.textleg,req:t.req,mtpche:t.mtpche,adesc:t.adesc}]);_||((y=window.$message)==null||y.success(u("common.addSuccess")),T(),m("submitted"))}else{const{data:d,error:_}=await Me([{id:(o=p.rowData)==null?void 0:o.id,aname:t.aname,atype:t.atype,asseta:t.asseta,assetb:t.assetb,textleg:t.textleg,req:t.req,mtpche:t.mtpche,adesc:t.adesc}]);_||((C=window.$message)==null||C.success(u("common.updateSuccess")),T(),m("submitted"))}}return ae(v,()=>{v.value&&(S(),N())}),(y,o)=>{const C=ue,d=be,_=ce,s=ke,l=Ce,i=de,c=Se,U=ye,h=me,he=Te,ee=K,ve=Ae,te=V("no-space");return R(),L(ve,{show:v.value,"onUpdate:show":o[8]||(o[8]=r=>v.value=r),title:M.value,preset:"card",class:"w-800px"},{footer:a(()=>[e(i,{justify:"end",size:16},{default:a(()=>[e(ee,{onClick:T},{default:a(()=>[f($(n(u)("common.cancel")),1)]),_:1}),e(ee,{type:"primary",onClick:O},{default:a(()=>[f($(n(u)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(he,{class:"h-480px pr-20px"},{default:a(()=>[e(h,{ref_key:"formRef",ref:I,model:t,rules:k,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:pe(O,["enter"])},{default:a(()=>[e(U,{responsive:"screen","item-responsive":""},{default:a(()=>[e(d,{span:"24",label:"属性名称",path:"aname"},{default:a(()=>[F(e(C,{clearable:"",value:t.aname,"onUpdate:value":o[0]||(o[0]=r=>t.aname=r),placeholder:"请输入属性名称"},null,8,["value"]),[[te]])]),_:1}),e(d,{span:"24",label:"控件类型",path:"atype"},{default:a(()=>[e(_,{filterable:"",value:t.atype,"onUpdate:value":o[1]||(o[1]=r=>t.atype=r),options:n(j)(n(ie)),placeholder:"请选择控件类型"},null,8,["value","options"])]),_:1}),e(d,{span:"24",label:"资产类型",path:"asseta"},{label:a(()=>[He]),default:a(()=>[e(_,{filterable:"",value:t.asseta,"onUpdate:value":[o[2]||(o[2]=r=>t.asseta=r),q],options:n(j)(n(Ne)),placeholder:"请选择资产类型(一级分类)"},null,8,["value","options"])]),_:1}),e(d,{span:"24",label:"资产类型",path:"assetb"},{label:a(()=>[We]),default:a(()=>[e(_,{value:t.assetb,"onUpdate:value":o[3]||(o[3]=r=>t.assetb=r),placeholder:"请选择资产类型(二级分类)",clearable:"",filterable:"","value-field":"id","label-field":"aname",options:n(x).data,"reset-menu-on-options-change":!1,onScroll:P},null,8,["value","options"])]),_:1}),e(d,{span:"24",label:"文本长度",path:"textleg"},{default:a(()=>[e(s,{value:t.textleg,"onUpdate:value":o[4]||(o[4]=r=>t.textleg=r),placeholder:"请输入文本长度",style:{width:"100%"}},null,8,["value"])]),_:1}),e(d,{span:"24",label:"是否必填",path:"req"},{default:a(()=>[e(c,{value:t.req,"onUpdate:value":o[5]||(o[5]=r=>t.req=r),name:"radiogroup"},{default:a(()=>[e(i,null,{default:a(()=>[(R(!0),J(se,null,ne(n(j)(n(X)),(r,H)=>(R(),L(l,{key:H,value:r.value},{default:a(()=>[f($(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),e(d,{span:"24",label:"是否多选",path:"mtpche"},{default:a(()=>[e(c,{value:t.mtpche,"onUpdate:value":o[6]||(o[6]=r=>t.mtpche=r),name:"radiogroup"},{default:a(()=>[e(i,null,{default:a(()=>[(R(!0),J(se,null,ne(n(j)(n(X)),(r,H)=>(R(),L(l,{key:H,value:r.value},{default:a(()=>[f($(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),e(d,{span:"24",label:"属性描述",path:"adesc"},{default:a(()=>[F(e(C,{type:"textarea",value:t.adesc,"onUpdate:value":o[7]||(o[7]=r=>t.adesc=r),placeholder:n(u)("page.manage.alarm.form.desc")},null,8,["value","placeholder"]),[[te]])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ye={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Q(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!Oe(g)}const bt=Z({name:"assetmanagement_assetallocation",__name:"index",setup(g){const B=Re(),p=fe({treeData:[]});for(const s in G)Object.prototype.hasOwnProperty.call(G,s)&&p.treeData.push({aname:u(G[s]),id:+("-"+s),originId:Number(s),disabled:!0,children:[]});function m(s,l){const i=new Map(s.map(c=>[c.originId,c]));return s.forEach(c=>{c.children=[]}),l.forEach(c=>{const U=i.get(c.pid);U&&U.children.push(c)}),s}async function v(){const{data:s,error:l}=await ge({page:1,limit:2e3});if(!l){let i=s.list;p.treeData=m(p.treeData,i)}}v();const{columns:I,columnChecks:w,data:N,getData:b,loading:M,pagination:t,searchParams:D,resetSearchParams:k}=$e({apiFn:Pe,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,atype:null,aid:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",fixed:"left",width:48},{key:"aname",title:"属性名称",align:"center",minWidth:140,ellipsis:{tooltip:!0}},{key:"atype",title:"控件类型",align:"center",render:s=>u(qe[s.atype])},{key:"asseta",title:"资产一级分类",align:"center",minWidth:140,ellipsis:{tooltip:!0},render:s=>u(G[s.atype])},{key:"atname",title:"资产二级分类",align:"center",minWidth:140,ellipsis:{tooltip:!0}},{key:"req",title:"是否必填",align:"center",width:120,render:s=>{s.status==null&&(s.status=0);const l={0:"success",1:"error"},i=u(X[s.status].label);return e(ze,{size:"small",type:l[s.status]},Q(i)?i:{default:()=>[i]})}},{key:"adesc",title:"描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"operate",title:u("common.operate"),align:"center",width:130,render:s=>{let l;return e("div",{class:"flex-center gap-8px"},[F(e(K,{type:"primary",ghost:!0,size:"small",onClick:()=>d(s.id)},Q(l=u("common.edit"))?l:{default:()=>[l]}),[[V("no-auth"),"sys.asset.attribute.update"]]),e(Ke,{onPositiveClick:()=>C(s.id)},{default:()=>u("common.confirmDelete"),trigger:()=>{let i;return F(e(K,{type:"error",ghost:!0,size:"small"},Q(i=u("common.delete"))?i:{default:()=>[i]}),[[V("no-auth"),"sys.asset.attribute.delete"]])}})])}}]}),{drawerVisible:S,operateType:T,editingData:q,handleAdd:x,handleEdit:z,checkedRowKeys:A,onBatchDeleted:P,onDeleted:O,closeDrawer:y}=Be(N,b);async function o(){console.log(A.value),_(A.value,s=>{P()})}function C(s){console.log(s),_([s],l=>{O()})}function d(s){z(s)}async function _(s,l){const{data:i,error:c}=await je(s);if(!c)l&&l(i);else return!1}return(s,l)=>{const i=we,c=Ue,U=_e;return R(),J("div",Ye,[e(Ee,{model:n(D),"onUpdate:model":l[0]||(l[0]=h=>W(D)?D.value=h:null),onReset:n(k),onSearch:n(b)},null,8,["model","onReset","onSearch"]),e(U,{title:"资产属性",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(i,{columns:n(w),"onUpdate:columns":l[1]||(l[1]=h=>W(w)?w.value=h:null),"disabled-delete":n(A).length===0,"is-view-add-button":n(oe)("sys.asset.attribute.insert"),"is-view-delete-button":n(oe)("sys.asset.attribute.delete"),loading:n(M),onAdd:n(x),onDelete:o,onRefresh:n(b)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:a(()=>[e(c,{columns:n(I),data:n(N),size:"small","flex-height":!n(B).isMobile,"scroll-x":702,loading:n(M),remote:"","row-key":h=>h.id,pagination:n(t),class:"sm:h-full"},null,8,["columns","data","flex-height","loading","row-key","pagination"]),e(Qe,{visible:n(S),"onUpdate:visible":l[2]||(l[2]=h=>W(S)?S.value=h:null),"operate-type":n(T),"row-data":n(q),onSubmitted:n(b)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{bt as default};
