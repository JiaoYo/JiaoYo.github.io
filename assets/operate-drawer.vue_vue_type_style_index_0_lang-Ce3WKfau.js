import{cz as p,d as A,at as z,v as F,s as J,a as E,au as H,a2 as K,c as v,o as _,w as s,f as l,G as Q,z as C,A as W,h as d,aw as X,e as Y,t as w,C as b,N as Z,B as N,g as T,$ as S,b9 as ee,c0 as te}from"./index-DMk9ecAg.js";import{u as ae}from"./usePageData-KTtgYQ98.js";import{v as oe}from"./v4-FuVw324d.js";function fe(a){return p({url:"/projectDailyReport/getPage.do",method:"get",params:a})}function re(a){return p({url:"/projectDailyReport/insert.do",method:"post",data:a})}function le(a){return p({url:"/projectDailyReport/getIdByUuid.do",method:"get",params:a})}function ne(a){return p({url:"/projectDailyReport/update.do",method:"put",data:a})}function be(a){return p({url:"/projectDailyReport/delete.do",method:"delete",params:{arrIds:a}})}function se(a){return p({url:"/projectDaily/insert.do",method:"post",data:a})}function ge(a){return p({url:"/projectComment/getPage.do",method:"get",params:a})}function ye(a){return p({url:"/projectComment/insert.do",method:"post",data:a})}function he(a){return p({url:"/projectComment/delete.do",method:"delete",params:{arrIds:a}})}const ve=A({name:"OperateDrawer",__name:"operate-drawer",props:z({operateType:{},rowData:{},pid:{},pname:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:z(["submitted"],["update:visible"]),setup(a,{emit:L}){const j=L,{pageData:u,getData:D,nextPage:U}=ae(te),B=async o=>{const t=o.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&u.data.length<u.total&&U()},n=a,e=F(k());function k(){return{id:"",proname:"",notes:"",problem:"",solutions:"",feedback:"",summarize:"",pids:[]}}const R={notes:{required:!0,message:"请输入",trigger:"blur"}};async function M(){if(await D({fuzzy:n.pname,page:1}),Object.assign(e,k()),n.operateType==="add"&&(console.log(n.pid),n.pid&&(u.data.forEach(o=>{o.id==n.pid&&(o.disabled=!0)}),e.pids.push(n.pid))),n.operateType==="edit"&&n.rowData){Object.assign(e,n.rowData);const o=JSON.parse(n.rowData.context);e.proname=o.proname,e.notes=o.notes,e.problem=o.problem,e.solutions=o.solutions,e.feedback=o.feedback,e.summarize=o.summarize}}const{formRef:O,validate:G,restoreValidation:V}=J(),$=()=>{D({page:1})},I=E(()=>({add:"新增项目日报",edit:"修改项目日报"})[n.operateType]),c=H(a,"visible"),y=()=>{c.value=!1},q=async()=>{var o,t;if(await G(),n.operateType==="edit"){const i=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:g,error:m}=await ne([{context:i,id:e.id}]);m||((o=window.$message)==null||o.success("修改成功"),j("submitted"),y())}else{const i=oe(),g=u.data.filter(f=>e.pids.includes(f.id)).map(f=>f.proname);e.proname=g.join(",");const m=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:P,error:r}=await re([{context:m,uuid:i}]);if(!r){const{data:f,error:ie}=await le({uuid:i});if(e.pids.length>0){let x=e.pids.map(h=>({pid:h}));x.forEach(h=>{h.did=f});const{data:de,error:pe}=await se(x)}(t=window.$message)==null||t.success("添加成功"),j("submitted"),y()}}};return K(c,()=>{c.value&&(M(),setTimeout(()=>{const o=document.querySelector(".n-scrollbar-content");o==null||o.scrollTo(0,0)},300),V())}),(o,t)=>{const i=W,g=Q,m=Z,P=ee;return _(),v(P,{show:c.value,"onUpdate:show":t[6]||(t[6]=r=>c.value=r),title:I.value,preset:"card",class:"w-570px"},{footer:s(()=>[l(m,{justify:"end"},{default:s(()=>[l(d(N),{size:"small",class:"mt-16px",onClick:y},{default:s(()=>[T(w(d(S)("common.cancel")),1)]),_:1}),l(d(N),{type:"primary",size:"small",class:"mt-16px",onClick:q},{default:s(()=>[T(w(d(S)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(g,{ref_key:"formRef",ref:O,model:e,rules:R},{default:s(()=>[n.operateType==="add"?(_(),v(i,{key:0,label:"关联项目",path:"pids","label-placement":"left"},{default:s(()=>[l(d(X),{clearable:"",filterable:"",value:e.pids,"onUpdate:value":t[0]||(t[0]=r=>e.pids=r),placeholder:"请选择项目","label-field":"proname",multiple:"","value-field":"id",onClear:$,options:d(u).data,onScroll:B},null,8,["value","options"])]),_:1})):C("",!0),n.operateType==="edit"&&e.proname?(_(),v(i,{key:1,label:"项目名称",path:"proname","label-placement":"left"},{default:s(()=>[Y("span",null,w(e.proname),1)]),_:1})):C("",!0),l(i,{label:"当前工作内容及成果描述：",path:"notes"},{default:s(()=>[l(d(b),{clearable:"",type:"textarea",value:e.notes,"onUpdate:value":t[1]||(t[1]=r=>e.notes=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(i,{label:"遇到问题：",path:"problem"},{default:s(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.problem,"onUpdate:value":t[2]||(t[2]=r=>e.problem=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(i,{label:"解决措施：",path:"solutions"},{default:s(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.solutions,"onUpdate:value":t[3]||(t[3]=r=>e.solutions=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(i,{label:"建议意见反馈：",path:"feedback"},{default:s(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.feedback,"onUpdate:value":t[4]||(t[4]=r=>e.feedback=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(i,{label:"（总结）自己对一天工作的感受和体感：",path:"summarize"},{default:s(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.summarize,"onUpdate:value":t[5]||(t[5]=r=>e.summarize=r),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}});export{ve as _,ge as a,he as b,fe as c,be as d,ye as f};
