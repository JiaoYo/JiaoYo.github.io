import{_ as ie}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CDCEHG5B.js";import{d as A,n as K,s as J,p as X,q as re,b as se,r as pe,ax as ce,D as F,o as q,c as Z,w as i,g as t,h as L,t as M,i as l,$ as v,F as Q,E,W as Y,aH as z,aX as H,J as ee,K as ue,Z as te,O as le,B as V,N as G,aD as de,aE as me,ad as oe,a3 as fe,av as _e,j as ve,A as ye,e as ge,aC as B,aG as he,au as be}from"./index-FKKSWlZs.js";import{u as we,a as Ne}from"./table-CSyR0TzJ.js";import{f as ke,a as Pe,b as De,c as Ie,d as Ce}from"./Collection-XH-szaJG.js";import{T as ae,a as Se}from"./collection-CsKz3kSl.js";import{_ as xe,a as Te,b as Re}from"./lodash-YkbCJgJ0.js";import{_ as ze}from"./round-refresh-BFeEk6QU.js";import{_ as Ue}from"./Grid-DmN9YdMU.js";import{h as W}from"./permission-CIZuorC2.js";import{N as $e}from"./Popconfirm-DxRR0mKc.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-BETkHMFo.js";import"./export-DQRIj4KV.js";import"./refresh-49c21s-F.js";import"./round-plus-B53Iz6E2.js";import"./Upload-Dw_AZ3VX.js";import"./Progress-BOvJ-dqS.js";const je=A({name:"OperateDrawer",__name:"operate-drawer",props:K({operateType:{},rowData:{},tTypeList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(h,{emit:U}){const d=h,N=U,y=J(h,"visible"),{formRef:p,validate:S,restoreValidation:$}=X(),{createConfirmPwdRule:x,defaultRequiredRule:j,patternRules:P}=re(),T=se(()=>({add:"新增策略",edit:"编辑策略"})[d.operateType]),e=pe(R());function R(){return{id:void 0,pname:"",llevel:[],etype:[],oriip:"",aimip:"",cdesc:""}}const f={pname:j,oriip:{type:"string",required:!1,validator:(b,o)=>!z(o[0])||!z(o[1])?new Error("请输入正确的IP"):!0,trigger:["input"]},aimip:{type:"string",required:!1,validator:(b,o)=>!z(o[0])||!z(o[1])?new Error("请输入正确的IP"):!0,trigger:["input"]}};function g(){Object.assign(e,R()),d.operateType==="edit"&&d.rowData&&(Object.assign(e,d.rowData),e.oriip&&(e.oriip=e.oriip.split("-")),e.aimip&&(e.aimip=e.aimip.split("-")),e.etype&&(e.etype=e.etype.split(",").map(Number)),e.llevel&&(e.llevel=e.llevel.split(",").map(Number)))}function D(){y.value=!1}async function I(){var o,_,m,w,k;const b=(c,a)=>!z(a[0])||!z(a[1])?new Error("请输入正确的IP"):!0;if(f.oriip.validator=(c,a)=>!0,f.aimip.validator=(c,a)=>!0,await S().finally(()=>{f.oriip.validator=b,f.aimip.validator=b}),(e.llevel.length===0||!e.llevel)&&(e.etype.length===0||!e.etype)&&(!e.oriip[0]||!e.oriip[1])&&(!e.aimip[0]||!e.aimip[1]))return(o=window.$message)==null?void 0:o.error("日志级别、事件类型、源IP、目的IP至少填写一个");if(e.oriip&&H(e.oriip[0],e.oriip[1])!=-1)return(_=window.$message)==null?void 0:_.error("源起始IP不能大于源结束IP");if(e.aimip&&H(e.aimip[0],e.aimip[1])!=-1)return(m=window.$message)==null?void 0:m.error("目的起始IP不能大于目的结束IP");if(e.oriip&&(e.oriip=e.oriip.join("-")),e.aimip&&(e.aimip=e.aimip.join("-")),e.llevel&&(e.llevel=e.llevel.join(",")),e.etype&&(e.etype=e.etype.join(",")),d.operateType==="add"){const{data:c,error:a}=await ke([e]);a||((w=window.$message)==null||w.success(v("common.addSuccess")),D(),N("submitted"))}else{const{data:c,error:a}=await Pe([e]);a||((k=window.$message)==null||k.success(v("common.updateSuccess")),D(),N("submitted"))}}return ce(y,()=>{y.value&&(g(),$())}),(b,o)=>{const _=ee,m=ue,w=te,k=le,c=V,a=G,n=de,u=me,C=F("no-space");return q(),Z(u,{show:y.value,"onUpdate:show":o[6]||(o[6]=r=>y.value=r),"display-directive":"show",width:360},{default:i(()=>[t(n,{title:T.value,"native-scrollbar":!1,closable:""},{footer:i(()=>[t(a,{size:16},{default:i(()=>[t(c,{onClick:D},{default:i(()=>[L(M(l(v)("common.cancel")),1)]),_:1}),t(c,{type:"primary",onClick:I},{default:i(()=>[L(M(l(v)("common.confirm")),1)]),_:1})]),_:1})]),default:i(()=>[t(k,{ref_key:"formRef",ref:p,model:e,rules:f,onKeyup:Q(I,["enter"])},{default:i(()=>[t(m,{label:"策略名称",path:"pname"},{default:i(()=>[E(t(_,{value:e.pname,"onUpdate:value":o[0]||(o[0]=r=>e.pname=r),placeholder:"请输入策略名称",clearable:""},null,8,["value"]),[[C]])]),_:1}),t(m,{label:"日志级别",path:"llevel"},{default:i(()=>[t(w,{value:e.llevel,"onUpdate:value":o[1]||(o[1]=r=>e.llevel=r),multiple:"",placeholder:"请选择日志级别",options:l(Y)(l(ae))},null,8,["value","options"])]),_:1}),t(m,{label:"事件类型",path:"etype"},{default:i(()=>[t(w,{value:e.etype,"onUpdate:value":o[2]||(o[2]=r=>e.etype=r),multiple:"",placeholder:"请选择日志级别","value-field":"id","label-field":"pname",options:d.tTypeList},null,8,["value","options"])]),_:1}),t(m,{label:"源IP",path:"oriip"},{default:i(()=>[t(_,{pair:"",separator:"-",value:e.oriip,"onUpdate:value":o[3]||(o[3]=r=>e.oriip=r),placeholder:["源起始IP","源终止IP"],clearable:""},null,8,["value"])]),_:1}),t(m,{label:"目的IP",path:"aimip"},{default:i(()=>[t(_,{pair:"",separator:"-",value:e.aimip,"onUpdate:value":o[4]||(o[4]=r=>e.aimip=r),placeholder:["目的起始IP","目的终止IP"],clearable:""},null,8,["value"])]),_:1}),t(m,{label:"描述",path:"cdesc"},{default:i(()=>[t(_,{type:"textarea",value:e.cdesc,"onUpdate:value":o[5]||(o[5]=r=>e.cdesc=r),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Be=A({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search"],["update:model"]),setup(h,{emit:U}){const d=U,{formRef:N,restoreValidation:y}=X(),p=J(h,"model");function S(){p.value.fuzzy="",d("search")}async function $(){await y(),d("reset")}async function x(){d("search")}function j(T){p.value.llevel=T,d("search")}const P=xe.debounce(x,1e3,{leading:!0,trailing:!1});return(T,e)=>{const R=ee,f=Te,g=te,D=ze,I=V,b=Re,o=G,_=Ue,m=le,w=oe,k=F("no-space");return q(),Z(w,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[t(m,{ref_key:"formRef",ref:N,model:p.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Q(l(P),["enter"])},{default:i(()=>[t(_,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:i(()=>[t(f,{span:"24 s:12 m:8 l:6",label:"策略名称",path:"fuzzy"},{default:i(()=>[E(t(R,{clearable:"",value:p.value.fuzzy,"onUpdate:value":e[0]||(e[0]=c=>p.value.fuzzy=c),placeholder:"请输入策略名称",onClear:S},null,8,["value"]),[[k]])]),_:1}),t(f,{span:"24 s:12 m:8 l:6",label:"日志级别",path:"llevel"},{default:i(()=>[t(g,{clearable:"",filterable:"",value:p.value.llevel,"onUpdate:value":e[1]||(e[1]=c=>p.value.llevel=c),placeholder:"请选择日志级别",options:l(Y)(l(ae)),onUpdateValue:j,style:{width:"100%"}},null,8,["value","options"])]),_:1}),t(f,{span:"24 s:12 m:8 l:6"},{default:i(()=>[t(o,{class:"w-full"},{default:i(()=>[t(I,{onClick:$},{icon:i(()=>[t(D,{class:"text-icon"})]),default:i(()=>[L(" "+M(l(v)("common.reset")),1)]),_:1}),t(I,{type:"primary",ghost:"",onClick:l(P)},{icon:i(()=>[t(b,{class:"text-icon"})]),default:i(()=>[L(" "+M(l(v)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function O(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!he(h)}const et=A({name:"collectionmanagement_collectionpolicy",__name:"index",setup(h){const U=fe(),{columns:d,columnChecks:N,data:y,getData:p,loading:S,mobilePagination:$,searchParams:x,resetSearchParams:j}=we({apiFn:De,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,llevel:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"pname",title:"策略名称",align:"center",width:140},{key:"llevel",title:"日志级别",align:"center",width:300,render:a=>{let n;const u=a.llevel.split(",").map(Number),C={0:"default",1:"success",2:"info",3:"warning",4:"error"};return t(G,{justify:"center"},O(n=u.map(r=>{const s=v(Se[r]);return t(_e,{type:C[r]},O(s)?s:{default:()=>[s]})}))?n:{default:()=>[n]})}},{key:"etype",title:"事件类型",align:"center",render:a=>{const n=a.etype.split(",").map(Number);return t("span",null,[n.map((u,C)=>{var s;const r=(s=o.value.find(ne=>ne.id===u))==null?void 0:s.pname;return r?`${r}${C!==n.length-1?"，":""}`:""})])},ellipsis:{tooltip:!0,tooltipPlacement:"top"}},{key:"oriip",title:"源IP",align:"center"},{key:"aimip",title:"目的IP",align:"center"},{key:"cdesc",title:"描述",align:"center",minWidth:200},{key:"operate",title:v("common.operate"),align:"center",width:130,render:a=>{let n;return t("div",{class:"flex-center gap-8px"},[E(t(V,{type:"primary",ghost:!0,size:"small",onClick:()=>k(a.id)},O(n=v("common.edit"))?n:{default:()=>[n]}),[[F("no-auth"),"sys.collection.policy.update"]]),t($e,{onPositiveClick:()=>w(a.id)},{default:()=>v("common.confirmDelete"),trigger:()=>{let u;return E(t(V,{type:"error",ghost:!0,size:"small"},O(u=v("common.delete"))?u:{default:()=>[u]}),[[F("no-auth"),"sys.collection.policy.delete"]])}})])}}]}),{drawerVisible:P,operateType:T,editingData:e,handleAdd:R,handleEdit:f,checkedRowKeys:g,onBatchDeleted:D,onDeleted:I,closeDrawer:b}=Ne(y,p),o=ve([]),_=async()=>{const{data:a,error:n}=await Ce();o.value=a};async function m(){console.log(g.value),c(g.value.join(","),a=>{D()})}function w(a){console.log(a),c(a,n=>{I()})}function k(a){f(a)}async function c(a,n){const u=await Ie(a);console.log("data",u),n&&n(u)}return ye(()=>{_()}),(a,n)=>{const u=ie,C=be,r=oe;return q(),ge("div",Oe,[t(Be,{model:l(x),"onUpdate:model":n[0]||(n[0]=s=>B(x)?x.value=s:null),onReset:l(j),onSearch:l(p)},null,8,["model","onReset","onSearch"]),t(r,{title:"采集过滤策略",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":i(()=>[t(u,{columns:l(N),"onUpdate:columns":n[1]||(n[1]=s=>B(N)?N.value=s:null),"disabled-delete":l(g).length===0,"is-view-add-button":l(W)("sys.collection.policy.insert"),"is-view-delete-button":l(W)("sys.collection.policy.delete"),loading:l(S),onAdd:l(R),onDelete:m,onRefresh:l(p)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:i(()=>[t(C,{"checked-row-keys":l(g),"onUpdate:checkedRowKeys":n[2]||(n[2]=s=>B(g)?g.value=s:null),columns:l(d),data:l(y),size:"small","flex-height":!l(U).isMobile,"scroll-x":962,loading:l(S),remote:"","row-key":s=>s.id,pagination:l($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(je,{visible:l(P),"onUpdate:visible":n[3]||(n[3]=s=>B(P)?P.value=s:null),"operate-type":l(T),"row-data":l(e),tTypeList:o.value,onSubmitted:l(p)},null,8,["visible","operate-type","row-data","tTypeList","onSubmitted"])]),_:1})])}}});export{et as default};
