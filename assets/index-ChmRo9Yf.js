import{_ as me}from"./round-add-D16vdqFD.js";import{aw as E,d as Y,aB as J,p as Q,s as ae,q as le,a as fe,aD as Z,c0 as se,az as H,r as A,c as L,o as v,w as n,f as t,aE as _e,F as ee,z as ie,h as e,A as G,aG as ve,b as $,e as g,t as y,B as S,g as b,y as I,aH as ge,N as te,$ as M,aK as ye,aP as be,aR as we,x as V,bk as he,C as q,aT as K,aW as xe,W as ke,E as re,cN as Ce,aX as Se,a$ as Ne,bm as De,a1 as je,Y as de,aA as ze,b8 as Te,aN as Ue,Q as $e,i as Le,aS as X,cS as Pe,aF as Re,aY as We}from"./index-B6VmDCNW.js";import{u as Ie,a as Be}from"./table-Dy_mM2iO.js";import{_ as Fe,a as Me}from"./text-DWT8Z3w6.js";import{N as ce}from"./Popconfirm-BZx2_Fxn.js";import{_ as qe}from"./round-search-DZaWhVa0.js";import{u as Ee}from"./usePageData-Z4O6CELG.js";import{_ as Oe}from"./Grid-x22nPuCx.js";import{_ as Ge}from"./FormItemGridItem-Capj4nMQ.js";function Ae(d){return E({url:"/projectWeek/getPage.do",method:"get",params:d})}function Ke(d){return E({url:"/projectWeek/insert.do",method:"post",data:d})}function Ve(d){return E({url:"/projectWeek/update.do",method:"put",data:d})}function He(d){return E({url:"/projectWeek/delete.do",method:"delete",params:{arrIds:d}})}function Je(d){return E({url:"/projectWeekComment/getPage.do",method:"get",params:d})}function Ye(d){return E({url:"/projectWeekComment/insert.do",method:"post",data:d})}function Qe(d){return E({url:"/projectWeekComment/delete.do",method:"delete",params:{arrIds:d}})}const Xe={key:0,class:""},Ze={key:1,class:"flex items-center w-300px"},et=Y({name:"OperateDrawer",__name:"operate-drawer",props:J({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(d,{emit:B}){Q();const l=B,N=d,a=ae(k());function k(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}}const R={content1:{required:!0,message:"请输入",trigger:"blur"}};async function D(){Object.assign(a,k()),N.operateType==="edit"&&N.rowData&&Object.assign(a,N.rowData)}const{formRef:w,validate:F,restoreValidation:T}=le(),h=fe(()=>({add:"新增项目周报",edit:"修改项目周报"})[N.operateType]),f=Z(d,"visible"),z=()=>{f.value=!1},P=se.debounce(async()=>{var m,s;if(await F(),N.operateType==="edit"){const{data:r,error:x}=await Ve([{...a}]);x||((m=window.$message)==null||m.success("修改成功"),l("submitted"),z())}else{const{data:r,error:x}=await Ke([{pid:a.pid,content1:a.content1,content2:a.content2,content3:a.content3,content4:a.content4,content5:a.content5,file1:a.file1,file2:a.file2}]);x||((s=window.$message)==null||s.success("添加成功"),l("submitted"),z())}},1e3,{leading:!0,trailing:!1});H(f,()=>{f.value&&(D(),setTimeout(()=>{const m=document.querySelector(".n-scrollbar-content");m==null||m.scrollTo(0,0)},300),T())});const p=A([]),o=A(0);async function _({file:m},s){const r=await be(m.file,m.name,"",x=>{s=="file2"&&(o.value=x)});r&&(s=="file1"?a.value.file1=r:a.value.file2=r,o.value=0)}async function C(m,s){var r,x,W;return s=="file1"&&!["image/jpeg","image/png","image/jpg","image/x-icon"].includes(m.file.file.type)?((r=window.$message)==null||r.destroyAll(),(x=window.$message)==null||x.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1):m.file.file.size>100*1024*1024?((W=window.$message)==null||W.error("文件大小不能超过100M"),!1):!0}return(m,s)=>{const r=ie,x=ve,W=ge,O=ee,c=_e,i=te,j=ye;return v(),L(j,{show:f.value,"onUpdate:show":s[9]||(s[9]=u=>f.value=u),title:h.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:n(()=>[t(i,{justify:"end"},{default:n(()=>[t(e(S),{size:"small",class:"mt-16px",onClick:z},{default:n(()=>[b(y(e(M)("common.cancel")),1)]),_:1}),t(e(S),{type:"primary",size:"small",class:"mt-16px",onClick:e(P)},{default:n(()=>[b(y(e(M)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:n(()=>[t(c,{style:{height:"70vh","padding-right":"10px"}},{default:n(()=>[t(O,{ref_key:"formRef",ref:w,model:a,rules:R},{default:n(()=>[t(r,{label:"本周完成",path:"content1"},{default:n(()=>[t(e(G),{clearable:"",type:"textarea",rows:3,value:a.content1,"onUpdate:value":s[0]||(s[0]=u=>a.content1=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{default:n(()=>[t(e(G),{clearable:"",type:"textarea",rows:2,value:a.content2,"onUpdate:value":s[1]||(s[1]=u=>a.content2=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"未完成项目",path:"content3"},{default:n(()=>[t(e(G),{clearable:"",type:"textarea",rows:2,value:a.content3,"onUpdate:value":s[2]||(s[2]=u=>a.content3=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"下周计划",path:"content4"},{default:n(()=>[t(e(G),{clearable:"",type:"textarea",rows:2,value:a.content4,"onUpdate:value":s[3]||(s[3]=u=>a.content4=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"需协调与帮助",path:"content5"},{default:n(()=>[t(e(G),{clearable:"",type:"textarea",rows:2,value:a.content5,"onUpdate:value":s[4]||(s[4]=u=>a.content5=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"图片:",path:"file1"},{default:n(()=>[t(x,{ref:"uploadRef",action:"#","list-type":"image-card","default-upload":!1,max:1,"file-list":p.value,"onUpdate:fileList":s[5]||(s[5]=u=>p.value=u),"custom-request":u=>_(u,"file1"),onBeforeUpload:s[6]||(s[6]=u=>C(u,"file1"))},null,8,["file-list","custom-request"])]),_:1}),t(r,{label:"附件:",path:"file2"},{default:n(()=>[a.file2?(v(),$("div",Xe,[g("span",null,y(a.file2.split("?")[1]),1),t(e(S),{text:"",type:"error",onClick:s[7]||(s[7]=u=>a.file2="")},{default:n(()=>s[10]||(s[10]=[b("删除")])),_:1,__:[10]})])):(v(),$("div",Ze,[t(x,{ref:"uploadRef",action:"#","show-file-list":!1,"custom-request":u=>_(u,"file2"),onBeforeUpload:s[8]||(s[8]=u=>C(u,"file2"))},{default:n(()=>[t(e(S),{loading:o.value>0&&!a.file2},{default:n(()=>[b(y(o.value>0&&!a.file2?"上传中":"上传文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"]),o.value&&!a.file2?(v(),L(W,{key:0,type:"line",percentage:o.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):I("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),tt={key:1,class:"mt-3 mb-3 text-gray-700 preview-text"},nt={key:0,class:"mt-3 mb-3 text-gray-700 preview-text"},ot={class:"mt-4 border-t pt-3"},at={class:"flex items-start gap-2 mb-3"},lt={class:"ml-2 flex-1"},st={class:"flex items-center"},it={class:"font-medium font-size-16px font-bold"},rt={class:"text-gray-600 mt-1"},dt=Y({name:"drawerLog",__name:"drawerLog",props:J({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(d){const B=Q();we();let l=ae({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""});const N=d,a={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},k=A({});async function R(){l={id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""},D.value=[],Object.assign(l,N.rowData),h()}const D=A([]),w=Z(d,"visible");H(w,()=>{w.value?R():(D.value=[],l.id=void 0)}),H(()=>N.rowData,()=>{w.value&&R()});function F(p){p||T()}function T(){w.value=!1}const h=async()=>{const{data:p,error:o}=await Je({page:1,limit:100,pid:l.id});p&&(D.value=p.list)},f=se.debounce(async()=>{var C;const p=k.value[l.id];if(!(p!=null&&p.trim()))return(C=window.$message)==null?void 0:C.warning("请输入评论内容");const{data:o,error:_}=await Ye([{pid:l.id,content:p}]);o&&(k.value[l.id]="",l.num++,h())},1e3,{leading:!0,trailing:!1}),z=async p=>{const{data:o,error:_}=await Qe(p.id);o&&(h(),l.num--,console.log("删除成功"))};async function P(p){if(!p)return;const o=p.split("?")[0],_=p.split("?")[1];try{const m=await(await fetch(o,{mode:"cors"})).blob(),s=URL.createObjectURL(m),r=document.createElement("a");r.href=s,r.download=_,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}catch(C){console.error("下载失败:",C)}}return(p,o)=>{const _=ie,C=xe,m=ee,s=Fe,r=Me,x=he,W=De,O=V("i"),c=V("no-auth");return v(),L(W,{show:w.value,"onUpdate:show":[o[3]||(o[3]=i=>w.value=i),F],"display-directive":"show",width:600,onMaskClick:T,onEsc:T},{default:n(()=>[t(x,{title:e(l).username+"的项目周报","native-scrollbar":!1,closable:""},{default:n(()=>[t(m,{ref:"formRef",model:e(l),"show-feedback":!1},{default:n(()=>[t(_,{label:"本周完成",path:"content1"},{label:n(()=>o[4]||(o[4]=[g("div",{class:"font-size-16px font-bold"},"本周完成",-1)])),default:n(()=>[g("span",{class:K(["preview-text",{textstyle:e(l).content1}])},y(e(l).content1),3)]),_:1}),t(_,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{label:n(()=>o[5]||(o[5]=[g("div",{class:"font-size-16px font-bold"},"本周对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:n(()=>[g("span",{class:K(["preview-text",{textstyle:e(l).content2}])},y(e(l).content2),3)]),_:1}),t(_,{label:"未完成项目",path:"content3"},{label:n(()=>o[6]||(o[6]=[g("div",{class:"font-size-16px font-bold"},"未完成项目",-1)])),default:n(()=>[g("span",{class:K(["preview-text",{textstyle:e(l).content3}])},y(e(l).content3),3)]),_:1}),t(_,{label:"下周计划",path:"content4"},{label:n(()=>o[7]||(o[7]=[g("div",{class:"font-size-16px font-bold"},"下周计划",-1)])),default:n(()=>[g("span",{class:K(["preview-text",{textstyle:e(l).content4}])},y(e(l).content4),3)]),_:1}),t(_,{label:"需协调与帮助",path:"content5"},{label:n(()=>o[8]||(o[8]=[g("div",{class:"font-size-16px font-bold"},"需协调与帮助",-1)])),default:n(()=>[g("span",{class:K(["preview-text",{textstyle:e(l).content5}])},y(e(l).content5),3)]),_:1}),t(_,{label:"图片",path:"content5"},{label:n(()=>o[9]||(o[9]=[g("div",{class:"font-size-16px font-bold"},"图片",-1)])),default:n(()=>{var i;return[e(l).file1?(v(),L(C,{key:0,width:"80",height:"80",src:e(l).file1,class:"rounded-md object-cover"},null,8,["src"])):I("",!0),e(l).file1?(v(),$("div",tt,[b(y((i=e(l).file1)==null?void 0:i.split("?")[1])+" ",1),t(e(S),{text:"",type:"primary",size:"small",onClick:o[0]||(o[0]=j=>P(e(l).file1))},{default:n(()=>o[10]||(o[10]=[b("下载")])),_:1,__:[10]})])):I("",!0)]}),_:1}),t(_,{label:"附件",path:"content5"},{label:n(()=>o[11]||(o[11]=[g("div",{class:"font-size-16px font-bold"},"附件",-1)])),default:n(()=>{var i;return[e(l).file2?(v(),$("div",nt,[b(y((i=e(l).file2)==null?void 0:i.split("?")[1])+" ",1),t(e(S),{text:"",type:"primary",size:"small",onClick:o[1]||(o[1]=j=>P(e(l).file2))},{default:n(()=>o[12]||(o[12]=[b("下载")])),_:1,__:[12]})])):I("",!0)]}),_:1})]),_:1},8,["model"]),q((v(),$("div",null,[b(y(e(l).num)+"评论",1)])),[[O,e(l).num]]),t(ke,{name:"fade"},{default:n(()=>[g("div",ot,[q((v(),$("div",at,[g("div",null,[t(s,{size:"small",src:a.avatar},null,8,["src"])]),t(e(G),{type:"textarea",id:`comment-input-${e(l).id}`,value:k.value[e(l).id],"onUpdate:value":o[2]||(o[2]=i=>k.value[e(l).id]=i),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:re(Ce(e(f),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),t(e(S),{type:"primary",ghost:"",onClick:e(f)},{default:n(()=>o[13]||(o[13]=[b("发送")])),_:1,__:[13]},8,["onClick"])])),[[c,"project:Summary:Comment:insert"]]),(v(!0),$(Se,null,Ne(D.value,i=>(v(),$("div",{key:i.id,class:"flex mb-3"},[t(s,{size:"small",src:a.avatar},null,8,["src"]),g("div",lt,[g("div",st,[g("span",it,y(i.username),1),t(r,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:n(()=>[b(y(i.dbtime),1)]),_:2},1024),e(B).userInfo.id==i.creater?(v(),L(e(ce),{key:0,onPositiveClick:j=>z(i)},{trigger:n(()=>[q((v(),L(e(S),{quaternary:"",type:"error",size:"small"},{default:n(()=>o[14]||(o[14]=[b(" 删除 ")])),_:1,__:[14]})),[[c,"project:Summary:Comment:delete"]])]),default:n(()=>[o[15]||(o[15]=b(" 确定删除吗？ "))]),_:2,__:[15]},1032,["onPositiveClick"])):I("",!0)]),g("div",rt,y(i.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),ct=je(dt,[["__scopeId","data-v-40f54485"]]),ut=Y({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search","clear"],["update:model"]),setup(d,{emit:B}){const l=B,{formRef:N}=le(),a=Z(d,"model");Q();const{pageData:k,getData:R,nextPage:D}=Ee(Te),w=async h=>{const f=h.currentTarget,z=f.scrollTop;f.scrollTop+f.offsetHeight>=f.scrollHeight&&k.data.length<k.total&&(await D(),await Ue(),setTimeout(()=>{f.scrollTop=z}))},F=async h=>{a.value.creater=h,l("search")};R({usertypes:"2,3"});async function T(){l("search")}return(h,f)=>{const z=ze,P=Ge,p=qe,o=S,_=te,C=Oe,m=ee,s=de;return v(),L(s,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(m,{ref_key:"formRef",ref:N,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:re(T,["enter"])},{default:n(()=>[t(C,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:n(()=>[t(P,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:n(()=>[t(z,{clearable:"",filterable:"",value:a.value.creater,"onUpdate:value":[f[0]||(f[0]=r=>a.value.creater=r),F],placeholder:"请选择","label-field":"username","value-field":"id",options:e(k).data,onScroll:w},null,8,["value","options"])]),_:1}),t(P,{span:"24  s:12 m:6",class:"pr-24px"},{default:n(()=>[t(_,{class:"w-full"},{default:n(()=>[t(o,{type:"primary",ghost:"",onClick:T},{icon:n(()=>[t(p,{class:"text-icon"})]),default:n(()=>[b(" "+y(e(M)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),pt={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},mt={key:0};function oe(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!We(d)}const kt=Y({name:"projectmanagement_memberlog",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(d,{emit:B}){const l=$e(),N=Q(),a=d,k=B,{columns:R,data:D,getData:w,loading:F,mobilePagination:T,searchParams:h}=Ie({showTotal:!0,immediate:!0,apiFn:Ae,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:c=>t("div",null,[c.username+"的项目周报"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:M("common.operate"),align:"center",width:140,fixed:"right",render:c=>{let i;return t("div",{class:"flex-center gap-8px"},[t(S,{type:"primary",ghost:!0,size:"small",onClick:()=>W(c)},{default:()=>[b("查看详情")]}),N.userInfo.id==c.creater&&q(t(S,{type:"primary",ghost:!0,size:"small",onClick:()=>s(c.id)},oe(i=M("common.edit"))?i:{default:()=>[i]}),[[V("no-auth"),"project:Summary:update"]]),N.userInfo.id==c.creater&&t(ce,{onPositiveClick:()=>m(c.id)},{default:()=>M("common.confirmDelete"),trigger:()=>{let j;return q(t(S,{type:"error",ghost:!0,size:"small"},oe(j=M("common.delete"))?j:{default:()=>[j]}),[[V("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:f,operateType:z,editingData:P,handleAdd:p,handleEdit:o,checkedRowKeys:_,onDeleted:C}=Be(D,w);async function m(c){const{data:i,error:j}=await He(c);j||C()}function s(c){o(c)}const r=A(!1),x=A({}),W=c=>{r.value=!0,x.value=c},O=()=>{w()};return H(()=>a.pid,async c=>{c&&(h.pid=c,await w())}),H(()=>D.value,async c=>{c.length>0?k("thereIsData",1):k("thereIsData",0)}),Le(()=>{a.type!="externalLiaison"}),(c,i)=>{const j=te,u=me,ue=Re,pe=de,ne=V("no-auth");return v(),$("div",pt,[a.pid?I("",!0):(v(),L(ut,{key:0,model:e(h),"onUpdate:model":i[0]||(i[0]=U=>X(h)?h.value=U:null),onReset:O,onSearch:e(w),onClear:i[1]||(i[1]=U=>D.value=[])},null,8,["model","onSearch"])),t(pe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Pe({header:n(()=>[t(j,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:n(()=>[a.pid?I("",!0):(v(),$("div",mt,"项目周报"))]),_:1}),a.pid?q((v(),L(e(S),{key:0,onClick:e(p),size:"small",ghost:"",type:"primary"},{icon:n(()=>[t(u,{class:"text-icon"})]),default:n(()=>[i[5]||(i[5]=b(" "+y("新增")))]),_:1,__:[5]},8,["onClick"])),[[ne,"project:Summary:insert"]]):I("",!0)]),default:n(()=>[t(ue,{"checked-row-keys":e(_),"onUpdate:checkedRowKeys":i[2]||(i[2]=U=>X(_)?_.value=U:null),columns:e(R),data:e(D),size:"small","flex-height":!e(l).isMobile,loading:e(F),remote:"","row-key":U=>U.id,pagination:e(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(et,{visible:e(f),"onUpdate:visible":i[3]||(i[3]=U=>X(f)?f.value=U:null),onSubmitted:e(w),"operate-type":e(z),pid:a.pid||e(h).pid,"row-data":e(P)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),t(ct,{visible:r.value,"onUpdate:visible":i[4]||(i[4]=U=>r.value=U),"row-data":x.value},null,8,["visible","row-data"])]),_:2},[a.pid?void 0:{name:"header-extra",fn:n(()=>[t(j,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[q((v(),L(e(S),{onClick:e(p),size:"small",ghost:"",type:"primary"},{icon:n(()=>[t(u,{class:"text-icon"})]),default:n(()=>[i[6]||(i[6]=b(" "+y("新增")))]),_:1,__:[6]},8,["onClick"])),[[ne,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{kt as default};
