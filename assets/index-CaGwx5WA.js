import{d as j,m as k,a as U,bD as de,bE as ue,ac as F,o as N,b as q,t as f,ah as pe,bF as fe,c as J,w as s,g as o,e as M,af as me,a5 as ge,f as ae,bG as _e,aI as he,a7 as se,ag as ve,k as be,_ as Q,v as ye,a0 as Y,bH as R,bI as S,aj as we,z as xe,ak as Se,r as De,A as Ce,J as ke,b2 as te,b3 as $e,b4 as Te,aE as Ie,h,bJ as Me,b0 as V,bK as Ne,S as We,al as Oe,R as Ae,p as Be,i as Ge}from"./index-vQQ96wkD.js";import{_ as oe,a as ne}from"./Grid-cSwkIjrY.js";import{u as le,L as G}from"./echarts-iWeL2tCs.js";import{h as Pe}from"./permission-uY4Xca4Z.js";import{G as ze,h as Ee,a as Le,b as Ve}from"./metar-Bq98iLWV.js";import{_ as Re,a as Fe}from"./DescriptionsItem-iLWL0Zs7.js";const je="/assets/station-GwqcmkHc.jpeg",He=j({name:"CountTo",__name:"count-to",props:{startValue:{default:0},endValue:{default:2021},duration:{default:1500},autoplay:{type:Boolean,default:!0},decimals:{default:0},prefix:{default:""},suffix:{default:""},separator:{default:","},decimal:{default:"."},useEasing:{type:Boolean,default:!0},transition:{default:"linear"}},setup(w){const a=w,r=k(a.startValue),c=U(()=>a.useEasing?de[a.transition]:void 0),D=ue(r,{disabled:!1,duration:a.duration,transition:c.value}),u=U(()=>m(D.value));function m(p){const{decimals:v,decimal:t,separator:e,suffix:l,prefix:x}=a;let $=p.toFixed(v);$=String($);const W=$.split(".");let O=W[0];const T=W.length>1?t+W[1]:"",E=/(\d+)(\d{3})/;if(e)for(;E.test(O);)O=O.replace(E,`$1${e}$2`);return x+O+T+l}async function C(){await pe(),r.value=a.endValue}return F([()=>a.startValue,()=>a.endValue],()=>{a.autoplay&&C()},{immediate:!0}),(p,v)=>(N(),q("span",null,f(u.value),1))}}),Je={class:"ml-20px"},Ue={class:"text-14px"},qe=j({name:"CardData",__name:"card-data",props:{MeteorologicalData:{type:Object}},setup(w){const a=w,r=U(()=>{var m,C,p,v,t,e;return[{key:"envT",title:"温度",value:((m=a.MeteorologicalData)==null?void 0:m.envT)||0,unit:"℃",color:{start:"#fdd819",end:"#e80505"},icon:"carbon:temperature-celsius"},{key:"envH",title:"湿度",value:((C=a.MeteorologicalData)==null?void 0:C.envH)||0,unit:"%",color:{start:"#97abff",end:"#123597"},icon:"lets-icons:humidity"},{key:"qy",title:"气压",value:((p=a.MeteorologicalData)==null?void 0:p.qy)||0,unit:"hPa",color:{start:"#70f570",end:"#49c628"},icon:"mdi:car-brake-low-pressure"},{key:"windS",title:"风速",value:((v=a.MeteorologicalData)==null?void 0:v.windS)||0,unit:"m/s",color:{start:"#ffe985",end:"#fa742b"},icon:"hugeicons:slow-winds"},{key:"windD",title:"风向",value:((t=a.MeteorologicalData)==null?void 0:t.windD)||0,unit:"°",color:{start:"#bbd2c5",end:"#536976"},icon:"mdi:windsock"},{key:"zfsdCount",title:"总辐射",value:((e=a.MeteorologicalData)==null?void 0:e.zfsd)||0,unit:"W/㎡",color:{start:"#ce9ffc",end:"#7367f0"},icon:"material-symbols:clear-day-rounded"}]}),[c,D]=fe();function u(m){return`linear-gradient(to bottom right, ${m.start}, ${m.end})`}return(m,C)=>{const p=be,v=He,t=ne,e=oe,l=se;return N(),J(l,{bordered:!1,size:"small",class:"card-wrapper h-100%","content-style":{padding:"20px 12px",display:"flex",flexDirection:"column",justifyContent:"center"}},{default:s(()=>[o(ae(c),null,{default:s(({$slots:x,gradientColor:$})=>[M("div",{class:"rd-8px pl-15px pb-4px pt-8px text-white",style:ge({backgroundImage:$})},[(N(),J(me(x.default)))],4)]),_:1}),o(e,{cols:"s:1 m:1 l:2",responsive:"screen","x-gap":10,"y-gap":12},{default:s(()=>[(N(!0),q(he,null,_e(r.value,(x,$)=>(N(),J(t,{key:x.key,class:ve("animated-fade-up-"+$)},{default:s(()=>[o(ae(D),{"gradient-color":u(x.color),class:"flex-1 flex items-center h-100%",style:{"max-height":"75px !important"}},{default:s(()=>[o(p,{icon:x.icon,class:"text-32px"},null,8,["icon"]),M("div",Je,[M("h3",Ue,f(x.title),1),o(v,{suffix:x.unit,decimals:1,"start-value":1,"end-value":x.value,class:"text-16px text-white dark:text-dark"},null,8,["suffix","end-value"])])]),_:2},1032,["gradient-color"])]),_:2},1032,["class"]))),128))]),_:1})]),_:1})}}}),Qe=Q(qe,[["__scopeId","data-v-5da89340"]]),Ke=j({name:"LineChart",__name:"line-chart",props:{data:{required:!0},dataModifiers:{}},emits:["update:data"],setup(w){const a=["rgb(233, 4, 69)","rgb(0, 150, 136)","rgb(244, 5, 29)","rgb(255, 99, 71)"],r=ye(w,"data"),c=Y(),{domRef:D,updateOptions:u,updateOptionsAsync:m}=le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function(t){const e=t[0];return`
        ${e.axisValue||""}<br/>
        <span class="round" style="background-color: ${a[0]}"></span> 实际功率: ${R(e.data.value," MW")}<br/>
        <span  class="round" style="background-color: ${a[1]}"></span> 预测功率: ${R(e.data.power," MW")}<br/>
        <span  class="round" style="background-color: ${a[2]}"></span> 实际辐射:  ${R(e.data.zfsd," W/m^2")}<br/>
        <span  class="round" style="background-color: ${a[3]}"></span> 预测辐射:  ${R(e.data.ssrd," W/m^2")}<br/>
        `},backgroundColor:"#6a7985",textStyle:{color:"#fff"}},legend:{data:["实际功率","预测功率","实际辐射","预测辐射"]},grid:{left:"2%",right:"5%",bottom:"0%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:[{name:"功率MW",type:"value",axisLabel:{formatter:"{value} MW"}},{name:"辐射W/m²",type:"value",axisLabel:{formatter:"{value} W/m²"}}],series:[{color:a[0],name:"实际功率",type:"line",emphasis:{focus:"series"},yAxisIndex:0,lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new G(0,0,0,1,[{offset:0,color:S(a[0],.3)},{offset:1,color:S(a[0],0)}],!1),shadowColor:S(a[0],.9),shadowBlur:20},data:[],connectNulls:!0},{color:a[1],name:"预测功率",type:"line",yAxisIndex:0,emphasis:{focus:"series"},lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new G(0,0,0,1,[{offset:0,color:S(a[1],.3)},{offset:1,color:S(a[1],0)}],!1),shadowColor:S(a[1],.9),shadowBlur:20},data:[],connectNulls:!0},{color:a[2],name:"实际辐射",type:"line",showSymbol:!1,yAxisIndex:1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new G(0,0,0,1,[{offset:0,color:S(a[2],.3)},{offset:1,color:S(a[2],0)}],!1),shadowColor:S(a[2],.7),shadowBlur:20},data:[],connectNulls:!0},{color:a[3],name:"预测辐射",type:"line",yAxisIndex:1,showSymbol:!1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new G(0,0,0,1,[{offset:0,color:S(a[3],.3)},{offset:1,color:S(a[3],0)}],!1),shadowColor:S(a[3],.7),shadowBlur:20},data:[],connectNulls:!0}]}));async function C(){await new Promise(t=>{setTimeout(t,1e3)}),u(t=>(r.value&&(t.xAxis.data=r.value.map(e=>e.dbtime),t.series[0].data=r.value.map(e=>({value:e.prePower,power:e.power,zfsd:e.zfsd,ssrd:e.ssrd})),t.series[1].data=r.value.map(e=>e.power),t.series[2].data=r.value.map(e=>e.zfsd),t.series[3].data=r.value.map(e=>e.ssrd)),t))}F(()=>r.value,t=>{m(e=>(r.value&&(e.xAxis.data=r.value.map(l=>l.dbtime),e.series[0].data=r.value.map(l=>({value:l.prePower,power:l.power,zfsd:l.zfsd,ssrd:l.ssrd})),e.series[1].data=r.value.map(l=>l.power),e.series[2].data=r.value.map(l=>l.zfsd),e.series[3].data=r.value.map(l=>l.ssrd)),e))});function p(){u((t,e)=>{const l=e();return t.legend.data=l.legend.data,t.series[0].name=l.series[0].name,t.series[1].name=l.series[1].name,t})}async function v(){C()}return F(()=>c.locale,()=>{p()}),v(),(t,e)=>(N(),q("div",{ref_key:"domRef",ref:D,class:"h-100% overflow-hidden"},null,512))}}),Xe=Q(Ke,[["__scopeId","data-v-b3333333"]]),Ye=j({name:"LineChart",__name:"weather-chart",props:{data:{type:Array,default:[]}},setup(w){const a=w,r=Y(),{domRef:c,updateOptions:D,showLoading:u,updateOptionsAsync:m}=le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(t){return R(t,"°C")},backgroundColor:"#6a7985",textStyle:{color:"#fff"}},legend:{data:["环境温度","预测温度","组件温度"]},grid:{left:"2%",right:"2%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{name:"温度(°C)",type:"value",axisLabel:{formatter:"{value} °C"}},series:[{color:"#27ae60",name:"环境温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new G(0,0,0,1,[{offset:0,color:"rgba(39, 174, 96,0.4)"},{offset:1,color:"rgba(39, 174, 96,0)"}],!1),shadowColor:"rgba(39, 174, 96,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#c0392b",name:"预测温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new G(0,0,0,1,[{offset:0,color:"rgba(192, 57, 43,0.3)"},{offset:1,color:"rgba(192, 57, 43,0)"}],!1),shadowColor:"rgba(192, 57, 43,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#ffa000",name:"组件温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new G(0,0,0,1,[{offset:0,color:"rgba(255, 160, 0,0.3)"},{offset:1,color:"rgba(255, 160, 0,0)"}],!1),shadowColor:"rgba(255, 160, 0,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0}]}));async function C(){await new Promise(t=>{setTimeout(t,1e3)}),D(t=>(a.data&&(t.xAxis.data=a.data.map(e=>e.dbtime),t.series[0].data=a.data.map(e=>e.envT),t.series[1].data=a.data.map(e=>e.tt2),t.series[2].data=a.data.map(e=>e.moduleT)),t))}function p(){D((t,e)=>{const l=e();return t.legend.data=l.legend.data,t.series[0].name=l.series[0].name,t.series[1].name=l.series[1].name,t.series[2].name=l.series[2].name,t})}async function v(){C()}return F(()=>r.locale,()=>{p()}),F(()=>a.data,()=>{m(t=>(a.data&&(t.xAxis.data=a.data.map(e=>e.dbtime),t.series[0].data=a.data.map(e=>e.envT),t.series[1].data=a.data.map(e=>e.tt2),t.series[2].data=a.data.map(e=>e.moduleT)),t))}),v(),(t,e)=>(N(),q("div",{ref_key:"domRef",ref:c,style:{height:"260px",overflow:"hidden"}},null,512))}}),Ze=Q(Ye,[["__scopeId","data-v-2e037727"]]),re=w=>(Be("data-v-27ee82a4"),w=w(),Ge(),w),ea=re(()=>M("img",{src:je,alt:"",style:{height:"140px",width:"100%","margin-bottom":"20px"}},null,-1)),aa={class:"flex items-center"},ta=re(()=>M("div",{class:"w-80px font-size-14px text-right"},"气象站：",-1)),sa=j({name:"home",__name:"index",setup(w){we();const a=Y(),r=U(()=>a.isMobile?0:16),c=k({stationP:0}),D=async()=>{const{data:d,error:g}=await Me();g||(c.value=d)},u=k(),m=k(),C=async()=>{var n;const{data:d,error:g}=await ze();g||(m.value=d,m.value.length!=0&&(p.value=(n=d[0])==null?void 0:n.id,t()))},p=k(),v=k(),t=async()=>{const{data:d,error:g}=await Ee({devId:p.value});g||(v.value=d)},e=d=>{p.value=d,t(),K()},l=Date.now(),x=new Date(l).setHours(0,0,0,0),$=new Date(l).setHours(23,59,59,999),W=k(),O=async()=>{const{data:d,error:g}=await Le({startTime:V(1,x),endTime:V(1,$),page:1,limit:100});g||(W.value=JSON.parse(JSON.stringify(d)).list)},T=k(),E=async()=>{const{data:d,error:g}=await Ne({date:V(0,Date.now())});g||(T.value=d,T.value.forEach(n=>(W.value.forEach(_=>{n.dbtime==_.dbtime&&(n.ssrd=_.ssrd)}),n)),A.value.forEach(n=>{const _=T.value.find(B=>B.dbtime===n.dbtime);_?Object.assign(_,n):T.value.push(n)}),T.value=T.value.sort((n,_)=>new Date(n.dbtime).getTime()-new Date(_.dbtime).getTime()))},A=k(),K=async()=>{if(!p.value)return;const{data:d,error:g}=await Ve({id:p.value,startTime:V(0,Date.now())+" 00:00:00",endTime:V(1,Date.now())});console.log("气象实际数据",d),A.value=d,W.value.forEach(n=>{const _=A.value.find(B=>B.dbtime===n.dbtime);_?Object.assign(_,n):A.value.push(n)}),A.value=A.value.sort((n,_)=>new Date(n.dbtime).getTime()-new Date(_.dbtime).getTime())},X=k(null);xe(async()=>{ie(),await C(),await D(),await O(),await K(),await E(),X.value=setInterval(async()=>{await D(),await O(),await K(),await E()},1e3*60*1)}),Se(()=>{X.value&&clearInterval(X.value)});const P=De({col:"",trs:""}),Z=k(null),ie=()=>{var I,z,H;if((I=Z.value)==null||I.close(),!Pe("channel:status:websocket")){(z=window.$message)==null||z.destroyAll(),(H=window.$message)==null||H.warning("暂无权限连接websocket");return}const d=new Date().getTime(),g=Ce(),n=ke(`${g}${d}getchlstatus`),_=te(n),B=te("getchlstatus"),y=new $e(Te+`/ChannelStatusWebsocket/${B}/${_}/${d}/${g}?token=${Ie()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});Z.value=y,y.connect(),y.onclose(()=>{}),y.onerror(()=>{}),y.onopen(()=>{}),y.onmessage(L=>{if(console.log(L,"通道状态websocket接受数据"),!ce(L.data))return;const i=JSON.parse(L.data).dataStatus;i&&(P.col=i.col+""=="0"||i.col+""=="1"?i.col+"":"",P.trs=i.trs+""=="0"||i.trs+""=="1"?i.trs+"":"")})},ce=d=>{try{return JSON.parse(d),!0}catch{return!1}};return(d,g)=>{const n=Re,_=Fe,B=We,y=se,I=ne,z=oe,H=Oe,L=Ae;return N(),J(L,{vertical:"",size:16,class:"h-100% home","item-style":{height:"100%"}},{default:s(()=>[o(z,{"y-gap":r.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:s(()=>[o(I,{span:"24 s:24 m:24"},{default:s(()=>[o(y,{title:"",bordered:!1,class:"card-wrapper h-100% bg-transparent","content-style":{padding:"0px"}},{default:s(()=>[o(z,{"x-gap":r.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:s(()=>[o(I,{span:"24 s:24 m:6"},{default:s(()=>[o(y,{title:"电场实时数据",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"12px"},"content-style":{padding:"12px",paddingTop:"0px",display:"flex",flexDirection:"column"}},{"header-extra":s(()=>[h(" 电站运行状态："+f(c.value.stationP&&c.value.stationP>0&&c.value.stationControlled==0?"并网运行":c.value.stationP&&c.value.stationP>0&&c.value.stationControlled==1?"降额运行":c.value.stationP==0?"待机":""),1)]),default:s(()=>[ea,o(B,{style:{"max-height":"240px"},trigger:"none"},{default:s(()=>[o(_,{bordered:"",column:1,"label-placement":"left",size:"small",class:"flex-1","content-style":{minWidth:"100px"}},{default:s(()=>[o(n,null,{label:s(()=>[h(" 最后更新时间 ")]),default:s(()=>[h(" "+f(c.value.dbtime),1)]),_:1}),o(n,null,{label:s(()=>{var i,b;return[h(" 总有功功率"+f((i=u.value)!=null&&i.StationP?` (${(b=u.value)==null?void 0:b.StationP})`:"(MW)"),1)]}),default:s(()=>[h(" "+f(c.value.stationP),1)]),_:1}),o(n,null,{label:s(()=>{var i,b;return[h(" 总无功功率"+f((i=u.value)!=null&&i.StationQ?` (${(b=u.value)==null?void 0:b.StationQ})`:"(MVar)"),1)]}),default:s(()=>[h(" "+f(c.value.stationQ),1)]),_:1}),o(n,null,{label:s(()=>{var i,b,ee;return[h(" 总功率因数"+f(((i=u.value)==null?void 0:i.StationCOS)=="-"?"":(b=u.value)!=null&&b.StationCOS?`
                        (${(ee=u.value)==null?void 0:ee.StationCOS})`:""),1)]}),default:s(()=>[h(" "+f(c.value.stationCOS),1)]),_:1}),o(n,null,{label:s(()=>{var i,b;return[h(" 日发电量"+f((i=u.value)!=null&&i.StationDayE?` (${(b=u.value)==null?void 0:b.StationDayE})`:"(MWh)"),1)]}),default:s(()=>[h(" "+f(c.value.stationDayE),1)]),_:1}),o(n,null,{label:s(()=>{var i,b;return[h(" 总发电量"+f((i=u.value)!=null&&i.StationTotalE?` (${(b=u.value)==null?void 0:b.StationTotalE})`:"(MWh)"),1)]}),default:s(()=>[h(" "+f(c.value.stationTotalE),1)]),_:1}),o(n,null,{label:s(()=>[h(" 是否限电 ")]),default:s(()=>[M("span",null,f(c.value.stationControlled==1?"是":"否"),1)]),_:1}),o(n,null,{label:s(()=>[h(" 数据接入状态 ")]),default:s(()=>[M("span",null,f(P.col=="0"?"🟢":P.col=="1"?"🔴":"未知"),1)]),_:1}),o(n,null,{label:s(()=>[h(" 数据上报状态 ")]),default:s(()=>[M("span",null,f(P.trs=="0"?"🟢":P.col=="1"?"🔴":"未知"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(I,{span:"24 s:24 m:18"},{default:s(()=>[o(y,{title:"今日预测功率",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"10px",paddingTop:"0px"}},{default:s(()=>[o(Xe,{data:T.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1}),o(I,{span:"24 s:24 m:24"},{default:s(()=>[o(y,{title:"",bordered:!0,class:"card-wrapper h-100%","content-style":{padding:"0px"}},{default:s(()=>[o(z,{"x-gap":r.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:s(()=>[o(I,{span:"24 s:24 m:6"},{default:s(()=>[o(y,{title:"气象数据",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"12px",paddingBottom:"0px"},"content-style":{padding:"0px"}},{"header-extra":s(()=>[M("div",aa,[ta,o(H,{filterable:"",placeholder:"请选择气象站",value:p.value,"onUpdate:value":g[0]||(g[0]=i=>p.value=i),options:m.value,"label-field":"sname","value-field":"id",style:{width:"140px"},onUpdateValue:e},null,8,["value","options"])])]),default:s(()=>[o(Qe,{MeteorologicalData:v.value},null,8,["MeteorologicalData"])]),_:1})]),_:1}),o(I,{span:"24 s:24 m:18"},{default:s(()=>[o(y,{title:"今日实时气象",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"0px",paddingTop:"0px"}},{default:s(()=>[o(Ze,{data:A.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1})]),_:1},8,["y-gap"])]),_:1})}}}),da=Q(sa,[["__scopeId","data-v-27ee82a4"]]);export{da as default};
