import{_ as he}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Bv9tlAlp.js";import{_ as ve}from"./round-delete-B_8F17d_.js";import{_ as ye}from"./round-add-DT_ryrzO.js";import{d as ee,av as X,z as te,D as we,s as F,aJ as Z,A as re,a as be,ax as ie,at as Ce,cE as ke,cF as xe,c as Y,o as H,w as a,f as t,a3 as je,M as ce,h as n,au as ue,H as O,J as ae,B as N,g as P,t as I,$ as j,a4 as Se,cx as pe,aE as de,L as ze,a2 as me,aI as Te,Y as De,i as Ne,F as W,b as Pe,aK as J,ay as Be,I as Q,aL as Ue,e as Fe,cG as oe,cw as Ie,aQ as $e}from"./index-BHYK3A_G.js";import{u as Me,a as Le}from"./table-B6LlmD7Q.js";import{u as fe}from"./usePageData-BU1qqIQs.js";import{_ as _e}from"./Grid-B2A8-T_X.js";import{_ as ge}from"./FormItemGridItem-C5bXUl4-.js";import{_ as Re}from"./round-search-Cl9yVEe0.js";import{_ as Ve}from"./round-refresh-DtTh3Oti.js";import{h as ne}from"./permission-BBP7PMT_.js";import{N as le}from"./Popconfirm-CZ_7v-Ns.js";const qe=ee({name:"OperateDrawer",__name:"operate-drawer",props:X({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(y,{emit:$}){const f=$;te();const v=y,s=we(u());function u(){return{pid:void 0,id:"",pname:"",pcontact:"",proposition:"",docker:""}}const g=F([]),{pageData:r,getData:m,nextPage:w}=fe(pe),M=async e=>{const o=e.currentTarget,d=o.scrollTop;o.scrollTop+o.offsetHeight>=o.scrollHeight&&r.data.length<r.total&&(await w(),g.value=r.data,await de(),setTimeout(()=>{o.scrollTop=d}))},x=async()=>{await m({page:1,fuzzy:v.rowData.proname||void 0}),g.value=r.data},S=Z.debounce(async e=>{await m({fuzzy:e,page:1}),g.value=r.data},300),z=F(!1),b=F(!1),T=e=>{if(s.pid=null,z.value=!0,b.value=!1,!e){h();return}S(e)},L=async()=>{z.value&&!b.value&&(await m({page:1}),g.value=r.data,z.value=!1)},h=async()=>{await m({page:1}),g.value=r.data},B=async e=>{s.pid=e,b.value=!0};async function K(){x(),Object.assign(s,u()),v.operateType==="edit"&&v.rowData&&Object.assign(s,v.rowData)}const{formRef:R,validate:V,restoreValidation:U}=re(),p={pid:{type:"number",required:!1,trigger:["blur","change"],message:"请选择"},pname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},pcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},c=be(()=>({add:"新增联系人",edit:"修改联系人"})[v.operateType]),_=ie(y,"visible");Ce(_,()=>{_.value&&(K(),setTimeout(()=>{const e=document.querySelector(".n-scrollbar-content");e==null||e.scrollTo(0,0)},300),U())});function C(){_.value=!1}const q=Z.debounce(async()=>{await l()},1e3,{leading:!0,trailing:!1});async function l(){var e,o;if(await V(),v.operateType==="edit"){const{data:d,error:k}=await ke([s]);k||(C(),f("submitted"),(e=window.$message)==null||e.success("修改成功"))}else{const{data:d,error:k}=await xe([{...s}]);k||(C(),f("submitted"),(o=window.$message)==null||o.success("添加成功"))}}return(e,o)=>{const d=ge,k=_e,E=ce,G=je,D=ae,A=Se;return H(),Y(A,{show:_.value,"onUpdate:show":o[5]||(o[5]=i=>_.value=i),title:c.value,preset:"card",class:"w-500px","mask-closable":!1,draggable:!0},{footer:a(()=>[t(D,{justify:"end",size:16},{default:a(()=>[t(n(N),{onClick:C},{default:a(()=>[P(I(n(j)("common.cancel")),1)]),_:1}),t(n(N),{type:"primary",onClick:n(q)},{default:a(()=>[P(I(n(j)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:a(()=>[t(G,{class:"pr-20px"},{default:a(()=>[t(E,{ref_key:"formRef",ref:R,model:s,rules:p,"label-placement":"left","label-width":120},{default:a(()=>[t(k,{responsive:"screen","item-responsive":""},{default:a(()=>[t(d,{span:"24 m:24",label:"项目",path:"pid"},{default:a(()=>[t(n(ue),{clearable:"",filterable:"",value:s.pid,"onUpdate:value":[o[0]||(o[0]=i=>s.pid=i),B],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:h,onSearch:T,options:g.value,onScroll:M,onBlur:L},null,8,["value","options"])]),_:1}),t(d,{span:"24 m:24",label:"对接方",path:"docker"},{default:a(()=>[t(n(O),{value:s.docker,"onUpdate:value":o[1]||(o[1]=i=>s.docker=i),placeholder:"请输入"},null,8,["value"])]),_:1}),t(d,{span:"24 m:24",label:"姓名",path:"pname"},{default:a(()=>[t(n(O),{value:s.pname,"onUpdate:value":o[2]||(o[2]=i=>s.pname=i),placeholder:"请输入"},null,8,["value"])]),_:1}),t(d,{span:"24 m:24",label:"联系方式",path:"pcontact"},{default:a(()=>[t(n(O),{value:s.pcontact,"onUpdate:value":o[3]||(o[3]=i=>s.pcontact=i),placeholder:"请输入"},null,8,["value"])]),_:1}),t(d,{span:"24 m:24",label:"备注",path:"proposition"},{default:a(()=>[t(n(O),{value:s.proposition,"onUpdate:value":o[4]||(o[4]=i=>s.proposition=i),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ee=ee({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:X(["reset","search","clear"],["update:model"]),setup(y,{emit:$}){const f=$,{formRef:v,restoreValidation:s}=re(),u=ie(y,"model"),g=te(),r=F([]),{pageData:m,getData:w,nextPage:M}=fe(pe),x=async p=>{const c=p.currentTarget,_=c.scrollTop;c.scrollTop+c.offsetHeight>=c.scrollHeight&&m.data.length<m.total&&(await M(),r.value=m.data,await de(),setTimeout(()=>{c.scrollTop=_}))},S=async p=>{var c;T.value=!0,p?(u.value.pid=p,f("search"),g.setProjectInfo({pname:(c=r.value.find(_=>_.id==p))==null?void 0:c.proname,pid:p})):f("clear")},z=Z.debounce(async p=>{await w({fuzzy:p,page:1}),r.value=m.data},300),b=F(!1),T=F(!1),L=p=>{if(u.value.pid=null,b.value=!0,T.value=!1,!p){B();return}z(p)},h=async()=>{b.value&&!T.value&&(await w({page:1}),r.value=m.data,f("search"),b.value=!1)},B=async()=>{await w({page:1}),r.value=m.data,f("search")};(async()=>{await w({page:1}),r.value=m.data,f("search")})();async function R(){await s(),u.value.fuzzy="",f("reset")}const V=()=>{u.value.fuzzy="",f("search")};async function U(){f("search")}return(p,c)=>{const _=ue,C=ge,q=O,l=Ve,e=N,o=Re,d=ae,k=_e,E=ce,G=me;return H(),Y(G,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[t(E,{ref_key:"formRef",ref:v,model:u.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ze(U,["enter"])},{default:a(()=>[t(k,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[t(C,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:a(()=>[t(_,{filterable:"",clearable:"",value:u.value.pid,"onUpdate:value":[c[0]||(c[0]=D=>u.value.pid=D),S],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:r.value,onScroll:x,onClear:B,onSearch:L,onBlur:h},null,8,["value","options"])]),_:1}),t(C,{span:"24 s:12 m:6",label:"姓名",path:"fuzzy"},{default:a(()=>[t(q,{value:u.value.fuzzy,"onUpdate:value":c[1]||(c[1]=D=>u.value.fuzzy=D),placeholder:"请输入",clearable:"",onClear:V},null,8,["value"])]),_:1}),t(C,{span:"24  s:12 m:6",class:"pr-24px"},{default:a(()=>[t(d,{class:"w-full"},{default:a(()=>[t(e,{onClick:R},{icon:a(()=>[t(l,{class:"text-icon"})]),default:a(()=>[P(" "+I(n(j)("common.reset")),1)]),_:1}),t(e,{type:"primary",ghost:"",onClick:U},{icon:a(()=>[t(o,{class:"text-icon"})]),default:a(()=>[P(" "+I(n(j)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function se(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!$e(y)}const at=ee({name:"projectmanagement_contact",__name:"index",setup(y){const $=Te(),f=te(),v=De(),{columns:s,columnChecks:u,data:g,getData:r,pagination:m,loading:w,mobilePagination:M,searchParams:x}=Me({showTotal:!0,immediate:!1,apiFn:Ie,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"proname",title:"项目名称",align:"center",width:240,render:l=>t("div",{class:"cursor-pointer",onClick:()=>q(l)},[l.proname])},{key:"docker",title:"对接方",align:"center",width:120},{key:"pname",title:"姓名",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pcontact",title:"联系方式",align:"center",width:120},{key:"proposition",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:j("common.operate"),align:"center",width:ne("project:Contact:update")||ne("project:Contact:delete")?140:0,fixed:"right",render:l=>{let e;return t("div",{class:"flex-center gap-8px"},[Q(t(N,{type:"primary",ghost:!0,size:"small",onClick:()=>U(l.id)},se(e=j("common.edit"))?e:{default:()=>[e]}),[[W("no-auth"),"project:Contact:update"]]),t(le,{onPositiveClick:()=>V(l.id)},{default:()=>j("common.confirmDelete"),trigger:()=>{let o;return Q(t(N,{type:"error",ghost:!0,size:"small"},se(o=j("common.delete"))?o:{default:()=>[o]}),[[W("no-auth"),"project:Contact:delete"]])}})])}}]}),{drawerVisible:S,operateType:z,editingData:b,handleAdd:T,handleEdit:L,checkedRowKeys:h,onBatchDeleted:B,onDeleted:K}=Le(g,r);Ne(async()=>{});async function R(){console.log(h.value),p(h.value.join(","),l=>{B()})}async function V(l){const{data:e,error:o}=await oe(l);o||K()}function U(l){L(l)}async function p(l,e){const{data:o,error:d}=await oe(l);if(!d)e&&e(o);else return!1}const c=l=>{r()},_=()=>{g.value=[],m.itemCount=0},C=()=>{r()},q=l=>{v.push("/projectmanagement/orderdetail?prjId="+l.pid+"&pname="+l.proname),f.setProjectInfo({pid:l.id,pname:l.proname})};return(l,e)=>{const o=ae,d=ye,k=ve,E=he,G=Be,D=me,A=W("no-auth");return H(),Pe("div",Ge,[t(Ee,{model:n(x),"onUpdate:model":e[0]||(e[0]=i=>J(x)?x.value=i:null),onReset:C,onSearch:n(r),onClear:_},null,8,["model","onSearch"]),t(D,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t(o,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>e[4]||(e[4]=[Fe("div",null,"项目联系人",-1)])),_:1,__:[4]})]),"header-extra":a(()=>[t(o,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[Q((H(),Y(n(N),{onClick:n(T),size:"small",ghost:"",type:"primary"},{icon:a(()=>[t(d,{class:"text-icon"})]),default:a(()=>[e[5]||(e[5]=P(" "+I("新增")))]),_:1,__:[5]},8,["onClick"])),[[A,"project:Contact:insert"]]),t(n(le),{onPositiveClick:R},{trigger:a(()=>[Q((H(),Y(n(N),{size:"small",ghost:"",type:"error",disabled:n(h).length==0},{icon:a(()=>[t(k,{class:Ue(["text-icon",{"animate-spin":n(w)}])},null,8,["class"])]),default:a(()=>[e[6]||(e[6]=P(" "+I("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[A,"project:Contact:delete"]])]),default:a(()=>[e[7]||(e[7]=P(" 确定要删除选中的联系人吗？ "))]),_:1,__:[7]}),t(E,{columns:n(u),"onUpdate:columns":e[1]||(e[1]=i=>J(u)?u.value=i:null)},null,8,["columns"])]),_:1})]),default:a(()=>[t(G,{"checked-row-keys":n(h),"onUpdate:checkedRowKeys":e[2]||(e[2]=i=>J(h)?h.value=i:null),columns:n(s),data:n(g),size:"small","flex-height":!n($).isMobile,loading:n(w),remote:"","row-key":i=>i.id,pagination:n(M),class:"sm:h-full","onUpdate:filters":c},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(qe,{visible:n(S),"onUpdate:visible":e[3]||(e[3]=i=>J(S)?S.value=i:null),onSubmitted:n(r),pid:n(x).pid,"operate-type":n(z),"row-data":n(b)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{at as default};
