import{_ as X}from"./table-header-operation.vue_vue_type_script_setup_true_lang-uYYUtpnK.js";import{d as K,n as j,p as q,s as E,D as F,o as P,c as G,w as a,g as e,E as I,h as M,t as O,i as t,$ as d,F as Y,J as H,B as U,N as J,O as L,ad as W,q as Z,b as ee,r as te,ae as oe,K as ae,af as ne,ag as se,a3 as le,e as ie,ah as $,aA as re,av as ce,aj as me,ai as de}from"./index-DcNLSryS.js";import{u as ue,a as pe}from"./table-Bjosh10B.js";import{_ as _e}from"./round-search-BaF4jb8f.js";import{_ as fe}from"./round-refresh-xL-7OB5-.js";import{_ as he}from"./lodash-DzxjyM_U.js";import{_ as ve}from"./FormItemGridItem-BIjRibpc.js";import{_ as ge}from"./Grid-BRL7EAPr.js";import{r as ye,s as be,g as we,t as De}from"./events-BTAQ2OU2.js";import{h as A}from"./permission-C7edkPh0.js";import{_ as ke}from"./Popconfirm-Gz1bdXnB.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-BzeU6240.js";import"./setting-outlined-e5_d7SZ_.js";import"./export-_OdKzp-M.js";import"./refresh-B8VT0tb7.js";import"./round-delete-K5jUF-_n.js";import"./round-plus-ZONQTaD-.js";import"./Upload-S0GAAfBt.js";import"./Progress-BAlrfBaK.js";const xe=K({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(p,{emit:C}){const i=C,{formRef:h,restoreValidation:u}=q(),r=E(p,"model");function D(){r.value.fuzzy=void 0,i("search")}async function R(){await u(),i("reset")}async function g(){i("search")}const k=he.debounce(g,1e3,{leading:!0,trailing:!1});return(s,y)=>{const B=H,x=ve,b=fe,c=U,v=_e,m=J,N=ge,_=L,T=W,z=F("no-space");return P(),G(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(_,{ref_key:"formRef",ref:h,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Y(t(k),["enter"])},{default:a(()=>[e(N,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:a(()=>[e(x,{span:"24 s:12 m:8 l:6",label:"事件名称",path:"fuzzy"},{default:a(()=>[I(e(B,{clearable:"",value:r.value.fuzzy,"onUpdate:value":y[0]||(y[0]=S=>r.value.fuzzy=S),placeholder:"请输入事件名称",onClear:D},null,8,["value"]),[[z]])]),_:1}),e(x,{span:"24 s:12 m:8 l:6"},{default:a(()=>[e(m,{class:"w-full"},{default:a(()=>[e(c,{onClick:R},{icon:a(()=>[e(b,{class:"text-icon"})]),default:a(()=>[M(" "+O(t(d)("common.reset")),1)]),_:1}),e(c,{type:"primary",ghost:"",onClick:t(k)},{icon:a(()=>[e(v,{class:"text-icon"})]),default:a(()=>[M(" "+O(t(d)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Ne=K({name:"OperateDrawer",__name:"operate-drawer",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(p,{emit:C}){const i=p,h=C,u=E(p,"visible"),{formRef:r,validate:D,restoreValidation:R}=q(),{defaultRequiredRule:g}=Z(),k=ee(()=>({add:"新增事件",edit:"修改事件"})[i.operateType]),s=te(y());function y(){return{ename:"",sysparam:1,id:void 0}}const B={ename:g};function x(){Object.assign(s,y()),i.operateType==="edit"&&i.rowData&&Object.assign(s,i.rowData)}function b(){u.value=!1}async function c(){var v,m;if(await D(),i.operateType==="add"){const{data:N,error:_}=await ye([{ename:s.ename,sysparam:s.sysparam}]);_||((v=window.$message)==null||v.success(d("common.addSuccess")),b(),h("submitted"))}else{const{data:N,error:_}=await be([{id:i.rowData.id,ename:s.ename,sysparam:s.sysparam}]);_||((m=window.$message)==null||m.success(d("common.updateSuccess")),b(),h("submitted"))}}return oe(u,()=>{u.value&&(x(),R())}),(v,m)=>{const N=H,_=ae,T=L,z=U,S=J,n=ne,o=se,l=F("no-space");return P(),G(o,{show:u.value,"onUpdate:show":m[1]||(m[1]=w=>u.value=w),"display-directive":"show",width:400},{default:a(()=>[e(n,{title:k.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(S,{size:16},{default:a(()=>[e(z,{onClick:b},{default:a(()=>[M(O(t(d)("common.cancel")),1)]),_:1}),e(z,{type:"primary",onClick:c},{default:a(()=>[M(O(t(d)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(T,{ref_key:"formRef",ref:r,model:s,rules:B},{default:a(()=>[e(_,{label:"事件名称",path:"ename"},{default:a(()=>[I(e(N,{value:s.ename,"onUpdate:value":m[0]||(m[0]=w=>s.ename=w),placeholder:"请输入事件名称",clearable:""},null,8,["value"]),[[l]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function V(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!de(p)}const He=K({name:"eventalarm_event",__name:"index",setup(p){const C=le(),{columns:i,columnChecks:h,data:u,getData:r,loading:D,mobilePagination:R,searchParams:g,resetSearchParams:k}=ue({apiFn:we,immediate:!0,apiParams:{page:1,limit:20,fuzzy:void 0},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"ename",title:"事件名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"sysparam",title:"系统内置",align:"center",width:120,render:n=>{const o={0:"success",1:"info"},l=d(re[n.sysparam]);return e(ce,{size:"small",type:o[n.sysparam]},V(l)?l:{default:()=>[l]})}},{key:"operate",title:d("common.operate"),align:"center",width:160,fixed:"right",render:n=>{let o;return e("div",{class:"flex-center gap-8px"},[I(e(U,{type:"info",disabled:n.sysparam==0,ghost:!0,size:"small",onClick:()=>T(n.id)},V(o=d("common.edit"))?o:{default:()=>[o]}),[[F("no-auth"),"event.update"]]),e(ke,{onPositiveClick:()=>z(n.id)},{default:()=>d("common.confirmDelete"),trigger:()=>{let l;return I(e(U,{type:"error",ghost:!0,size:"small",disabled:n.sysparam==0},V(l=d("common.delete"))?l:{default:()=>[l]}),[[F("no-auth"),"event.delete"]])}})])}}]}),{drawerVisible:s,operateType:y,editingData:B,handleAdd:x,handleEdit:b,checkedRowKeys:c,onBatchDeleted:v,onDeleted:m,closeDrawer:N}=pe(u,r);async function _(){console.log(c.value),S(c.value,n=>{v()})}function T(n){b(n)}function z(n){console.log(n),S([n],o=>{m()})}async function S(n,o){const{data:l,error:w}=await De(n);if(!w)o&&o(l);else return!1}return(n,o)=>{const l=X,w=me,Q=W;return P(),ie("div",ze,[e(xe,{model:t(g),"onUpdate:model":o[0]||(o[0]=f=>$(g)?g.value=f:null),onReset:t(k),onSearch:t(r)},null,8,["model","onReset","onSearch"]),e(Q,{title:"事件",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(l,{columns:t(h),"onUpdate:columns":o[1]||(o[1]=f=>$(h)?h.value=f:null),"disabled-delete":t(c).length===0,loading:t(D),onAdd:t(x),onDelete:_,onRefresh:t(r),"is-view-add-button":t(A)("event.insert"),"is-view-delete-button":t(A)("event.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:a(()=>[e(w,{"checked-row-keys":t(c),"onUpdate:checkedRowKeys":o[2]||(o[2]=f=>$(c)?c.value=f:null),columns:t(i),data:t(u),size:"small","flex-height":!t(C).isMobile,"scroll-x":962,loading:t(D),remote:"","row-key":f=>f.id,pagination:t(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ne,{visible:t(s),"onUpdate:visible":o[3]||(o[3]=f=>$(s)?s.value=f:null),"operate-type":t(y),"row-data":t(B),onSubmitted:t(r)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{He as default};
