import{_ as ee,l as te}from"./lodash-qu1GOcgR.js";import{d as J,n as H,j as v,p as le,s as ae,o as U,c as W,w as i,g as o,i as x,h as E,t as F,$ as j,F as ne,aK as oe,Z as ie,J as se,B as $,N as Z,O as re,ad as Q,a3 as ue,r as R,az as K,A as de,D as ce,e as pe,E as fe,am as me,an as ve,R as ge}from"./index-CC5dz6Fg.js";import{_ as _e}from"./round-search-DrOCNvJL.js";import{_ as he}from"./round-refresh-8umJ1-xH.js";import{a as ye,S as P,t as q}from"./alarm-BmP8EHqP.js";import{_ as be}from"./DatePicker-BDfTgjRq.js";import{_ as we}from"./FormItemGridItem-C_YzeEzO.js";import{_ as xe}from"./Grid-NJJ1aoYn.js";import{_ as Te}from"./originlogInfo.vue_vue_type_script_setup_true_lang-DS0THq-U.js";import{e as ke}from"./exportExcel-D6OyA9oJ.js";import{f as Ie}from"./system-log-CAXcF4eX.js";import{x as Ce,v as De}from"./events-ZZWO7TAZ.js";import{n as Se}from"./Collection-DQHUB-ZG.js";import{f as Le,a as Ne}from"./common-DjE7DTWV.js";import{T as Oe}from"./basicconf-BTt3UawX.js";import"./TimePicker-DW-6d4kH.js";import"./defineProperty-CgJYA2ML.js";import"./collection-CFfMhHNu.js";import"./DescriptionsItem-BIhKpDh3.js";import"./CollapseItem-Dic9t4jQ.js";const Ee=J({name:"FormSearch",__name:"form-search",props:H(["eventsTypeBaseInfo","collectorList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:H(["search"],["update:model"]),setup(h,{emit:B}){const w=h,f=B;v(0);const{formRef:S,restoreValidation:G}=le(),l=ae(h,"model");async function z(){await G(),l.value.etypeid=null,l.value.elevel=null,l.value.ectgrid=null,l.value.etypeid=null,l.value.rtime=null,l.value.suject="",l.value.object="",l.value.lcon="",l.value.timeRange=null,oe(()=>{f("search")})}const A=d=>{l.value.elevel=d,p()};async function C(d,n){d&&d.length>0?(l.value.startTime=d[0],l.value.endTime=d[1]):(l.value.startTime=void 0,l.value.endTime=void 0),p()}async function p(){f("search")}const D=ee.debounce(p,1e3,{leading:!0,trailing:!1});return(d,n)=>{const y=ie,a=we,T=se,k=be,I=he,L=$,N=_e,g=Z,O=xe,V=re,M=Q;return U(),W(M,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[o(V,{ref_key:"formRef",ref:S,model:l.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(x(D),["enter"])},{default:i(()=>[o(O,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:i(()=>[o(a,{span:"24 s:24 m:8 l:6",label:"采集器",path:"logodid"},{default:i(()=>[o(y,{filterable:"",clearable:"",placeholder:"请选择采集器",value:l.value.logodid,"onUpdate:value":[n[0]||(n[0]=r=>l.value.logodid=r),p],options:w.collectorList,disabled:w.logsoudev,"value-field":"id","label-field":"type","reset-menu-on-options-change":!1},null,8,["value","options","disabled"])]),_:1}),o(a,{span:"24 s:24 m:8 l:6",label:"安全级别",path:"leid"},{default:i(()=>[o(y,{filterable:"",clearable:"",placeholder:"请选择安全级别",value:l.value.elevel,"onUpdate:value":[n[1]||(n[1]=r=>l.value.elevel=r),A],options:x(ye),"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),o(a,{span:"24 s:12 m:8 l:6",label:"事件类别",path:"ectgrid"},{default:i(()=>[o(y,{filterable:"",clearable:"",placeholder:"请选择事件类别",value:l.value.ectgrid,"onUpdate:value":[n[2]||(n[2]=r=>l.value.ectgrid=r),p],"value-field":"id","label-field":"pname",options:w.eventsTypeBaseInfo.eventsCategoryDataList},null,8,["value","options"])]),_:1}),o(a,{span:"24 s:12 m:8 l:6",label:"事件类型",path:"etypeid"},{default:i(()=>[o(y,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:l.value.etypeid,"onUpdate:value":[n[3]||(n[3]=r=>l.value.etypeid=r),p],"value-field":"id","label-field":"pname",options:w.eventsTypeBaseInfo.eventsTypeDataList},null,8,["value","options"])]),_:1}),o(a,{span:"24 s:24 m:8 l:6",label:"事件主体",path:"suject"},{default:i(()=>[o(T,{placeholder:"请输入事件主体",value:l.value.suject,"onUpdate:value":n[4]||(n[4]=r=>l.value.suject=r),clearable:"",onClear:p},null,8,["value"])]),_:1}),o(a,{span:"24 s:24 m:8 l:6",label:"事件客体",path:"object"},{default:i(()=>[o(T,{placeholder:"请输入事件客体",value:l.value.object,"onUpdate:value":n[5]||(n[5]=r=>l.value.object=r),clearable:"",onClear:p},null,8,["value"])]),_:1}),o(a,{span:"24 s:24 m:8 l:6",label:"事件内容",path:"lcon"},{default:i(()=>[o(T,{placeholder:"请输入事件内容",value:l.value.lcon,"onUpdate:value":n[6]||(n[6]=r=>l.value.lcon=r),clearable:"",onClear:p},null,8,["value"])]),_:1}),o(a,{span:"24 s:24 m:12 l:8",label:"时间",path:"time"},{default:i(()=>[o(k,{value:l.value.timeRange,"onUpdate:value":n[7]||(n[7]=r=>l.value.timeRange=r),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":C},null,8,["value"])]),_:1}),o(a,{span:"24 s:24 m:8 l:6",label:""},{default:i(()=>[o(g,{class:"w-full"},{default:i(()=>[o(L,{onClick:z},{icon:i(()=>[o(I,{class:"text-icon"})]),default:i(()=>[E(" "+F(x(j)("common.reset")),1)]),_:1}),o(L,{type:"primary",ghost:"",onClick:x(D)},{icon:i(()=>[o(N,{class:"text-icon"})]),default:i(()=>[E(" "+F(x(j)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),je={class:"min-h-500px flex-col-stretch overflow-hidden lt-sm:overflow-auto"};function Be(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!me(h)}const ze=J({name:"eventalarm_originlog",__name:"index",props:{logsoudev:{},aip:{}},setup(h){const B=ue(),w=v(window.innerHeight-395),f=h,S=v([]);(async()=>{const{data:e,error:t}=await Se({page:1,limit:1e3,_t:new Date().getTime()});if(t)console.error("获取采集器列表失败:",t);else{const s=e;S.value=s.list.map(c=>({...c,id:c.id,type:c.cname}))}})();const l=R({eventsTypeDataList:[],eventsCategoryDataList:[]});async function z(){const{data:e,error:t}=await Le();t||(l.eventsCategoryDataList=e)}async function A(){const{data:e,error:t}=await Ne();t||(l.eventsTypeDataList=e)}z(),A();const C=v(!1),p=v(),D=v(),d=v(!1),n=R({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),y=[{title:"序号",key:"index",width:80,align:"center",render:e=>`${e.index}`},{key:"type",title:"采集器名称",align:"center",width:180},{key:"osubject",title:"事件主体",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"oobject",title:"事件客体",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"odescribe",title:"事件描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"oresult",title:"事件结果",align:"center",width:180,ellipsis:{tooltip:!0},render:e=>{var t,s;return e.oresult?o(K,{size:"small",type:(t=e.oresult)!=null&&t.includes("成功")?"success":(s=e.oresult)!=null&&s.includes("失败")?"error":"warning"},{default:()=>[e.oresult]}):""}},{key:"level",title:"安全级别",align:"center",width:120,render:e=>{const t=P[e.level];let s={color:q[e.level],textColor:"#ffffff",borderColor:q[e.level]};return t?o(K,{size:"small",color:s},Be(t)?t:{default:()=>[t]}):""}},{key:"pname2",title:"事件类别",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"etime",title:"日志时间",align:"center",width:160},{key:"operate",title:j("common.operate"),align:"center",width:100,fixed:"right",render:e=>o("div",{class:"flex-center gap-8px"},[o($,{type:"info",ghost:!0,size:"small",onClick:()=>V(e)},{default:()=>[E("详情")]})])}],a=v([]),T=v(0),k=async(e=!1)=>{if(!d.value)d.value=!0;else return;d.value=!0,f.logsoudev&&f.aip&&(I.value=!1,n.logodid=f.logsoudev,n.startAndEndSourceIp=[f.aip,f.aip],n.startSourceIp=f.aip,n.endSourceIp=f.aip);const{data:t,error:s}=await De(n);s||(T.value=t.length,e?a.value=[...a.value,...t]:a.value=t,a.value=a.value.sort((c,u)=>u.id-c.id).map((c,u)=>(c.index=u+1,c)),d.value=!1)},I=v(!0),L=async()=>{a.value=[],n.pageId=void 0,(t=>Object.keys(t).filter(u=>u!=="limit"&&u!=="_t").some(u=>t[u]!==void 0&&t[u]!==""&&t[u]!==null))(n)?I.value=!1:(I.value=!0,O()),n.pageId=void 0,await k(),N()},N=async()=>{var e,t,s;if(a.value.length<w.value/44&&a.value.length<g.total){if(n.pageId==((e=a.value[a.value.length-1])==null?void 0:e.id))return;n.pageId=((s=(t=a.value)==null?void 0:t[a.value.length-1])==null?void 0:s.id)??void 0,k(!0)}};de(async()=>{await k(),await O(),N()});const g=R({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:t,page:s,pageSize:c,pageCount:u,itemCount:b}){return`已加载${a.value.length}条`+(a.value.length?I.value?` 共计 ${a.value.length>0?b??0:0} 条`:T.value==n.limit?"  预计还有更多":"  没有更多了":"")}});async function O(){const{data:e,error:t}=await Ce();t||(g.pageCount=20,g.total=Number(e),g.itemCount=Number(e))}const V=e=>{p.value=e.id,D.value=e,C.value=!0};function M(e){Math.abs(e.target.scrollTop+e.target.offsetHeight-e.target.scrollHeight)<=20&&g.total>a.value.length&&r()}const r=te.debounce(()=>{var e;if(((e=a.value)==null?void 0:e.length)<g.total){if(n.pageId==a.value[a.value.length-1].id)return;n.pageId=a.value[a.value.length-1].id,k(!0)}},300);async function X(){const e=new Date().getTime();if(!a.value.length)return;const t=JSON.parse(JSON.stringify(a.value));console.log(t);const s=[];t.forEach(b=>{const m={};y.forEach(_=>{if(b.hasOwnProperty(_.key)){const Y=_.key=="elevel"?j(Oe[b[_.key]]):_.key=="level"?P[b[_.key]]??null:b[_.key];m[_.title]=Y}}),s.push(m)}),ke(s,500,[{wpx:50},{wpx:120},{wpx:80},{wpx:100},{wpx:140},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:140}],"原始日志_"+new Date().getTime());const u=new Date().getTime();await Ie({operation:"导出原始日志",userAgent:navigator.userAgent,status:1,requestTime:u-e<1?1:u-e})}return(e,t)=>{const s=Z,c=ve,u=Q,b=ce("no-auth");return U(),pe("div",je,[o(Ee,{model:n,"onUpdate:model":t[0]||(t[0]=m=>n=m),onSearch:L,eventsTypeBaseInfo:l,collectorList:S.value,class:"mb-16px",logsoudev:f.logsoudev},null,8,["model","eventsTypeBaseInfo","collectorList","logsoudev"]),o(u,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":i(()=>[o(s,null,{default:i(()=>[fe((U(),W(x($),{type:"primary",size:"small",ghost:"",onClick:X,title:"导出已加载"},{default:i(()=>[E("导出已加载")]),_:1})),[[b,"sys:log:operation.insert"]])]),_:1})]),default:i(()=>[o(c,{columns:y,data:a.value,size:"small","flex-height":!x(B).isMobile,loading:d.value,remote:"","row-key":m=>m.id,"virtual-scroll":"","scroll-x":y.reduce((m,_)=>m+_.width,0),pagination:g,class:"sm:h-full",onScroll:M,"max-height":w.value},null,8,["data","flex-height","loading","row-key","scroll-x","pagination","max-height"])]),_:1}),o(Te,{detailVisible:C.value,"onUpdate:detailVisible":t[1]||(t[1]=m=>C.value=m),detailId:p.value,detailInfo:D.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),lt=ge(ze,[["__scopeId","data-v-26402f57"]]);export{lt as default};
