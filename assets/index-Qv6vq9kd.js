import{_ as pe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DTyciG8n.js";import{_ as ue}from"./round-refresh-Ce8bIByR.js";import{_ as de}from"./round-delete-D92O9eM9.js";import{_ as me}from"./round-add-BJVAZVna.js";import{_ as _e}from"./round-search-Cgm8cfgb.js";import{d as X,p as J,q as fe,aK as ge,r as Y,s as ye,v as he,ab as Q,b as ve,o as T,c as F,w as t,g as e,h as f,t as N,i as n,aE as be,L as Z,ak as ee,b1 as we,Q as xe,B as _,P as te,aJ as ke,ai as Ce,x as De,z as S,e as Ne,C as ze,af as M,A as D,$ as v,aN as q,aS as Se,aT as Te,a6 as Ue,aO as $e}from"./index-00pZtPBt.js";import{b as Oe,a as Be,c as je,d as Ie}from"./scriptoperation-WfHFx9SE.js";import{u as Re,a as Le}from"./table-BUcbG8zn.js";import{_ as Pe}from"./FormItemGridItem-CHgxRxLI.js";import{_ as Me}from"./Grid-DZYnaI-Y.js";import{N as W}from"./Popconfirm-B352hAvh.js";import{_ as qe}from"./InputGroupLabel-C7hqUUah.js";const Fe=X({__name:"add_model",props:J({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(g,{emit:U}){const y=fe(g,"visible"),b=ge({0:"Lua周期执行"}),w=U,u=g,a=Y(z());function z(){return{sname:"",stype:void 0,sdesc:"",executeCircle:3e3,sexp:""}}function d(){Object.assign(a,z()),u.operateType==="edit"&&u.rowData&&Object.assign(a,u.rowData)}const{formRef:V,validate:x,restoreValidation:$}=ye();he(),Q(()=>u.rowData,()=>{d()}),Q(y,()=>{y.value&&(d(),$())});const k=()=>{y.value=!1},O=async()=>{if(await x(),u.operateType==="add"){const{data:r,error:s}=await Oe([a]);s||(k(),w("submitted"))}else{const{data:r,error:s}=await Be([a]);s||(k(),w("submitted"))}},B={sname:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},executionCycle:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]}},j=ve(()=>({add:"新增",edit:"修改"})[u.operateType]);return(r,s)=>{const C=Z,m=Pe,I=ee,R=we,L=Me,l=xe,o=_,c=te,P=ke;return T(),F(P,{show:y.value,"onUpdate:show":s[5]||(s[5]=i=>y.value=i),title:j.value,preset:"card",class:"w-50%"},{footer:t(()=>[e(c,{size:16,justify:"center"},{default:t(()=>[e(o,{onClick:k,class:"w-100px"},{default:t(()=>[f(N(r.$t("common.cancel")),1)]),_:1}),e(o,{type:"primary",class:"w-100px",onClick:O},{default:t(()=>[f(N(r.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(l,{ref_key:"formRef",ref:V,model:a,rules:B,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:t(()=>[e(L,{responsive:"screen","item-responsive":""},{default:t(()=>[e(m,{span:"24 m:12",label:"脚本名称",path:"sname"},{default:t(()=>[e(C,{clearable:"",value:a.sname,"onUpdate:value":s[0]||(s[0]=i=>a.sname=i),placeholder:"请输入脚本名称",style:{width:"100%"}},null,8,["value"])]),_:1}),e(m,{span:"24 m:12",label:"脚本类型",path:"stype"},{default:t(()=>[e(I,{filterable:"",clearable:"",placeholder:"请选择参数项模板",value:a.stype,"onUpdate:value":s[1]||(s[1]=i=>a.stype=i),options:n(be)(n(b))},null,8,["value","options"])]),_:1}),e(m,{span:"24 m:12",label:"执行周期(ms)",path:"executeCircle"},{default:t(()=>[e(R,{clearable:"",value:a.executeCircle,"onUpdate:value":s[2]||(s[2]=i=>a.executeCircle=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),e(m,{span:"24 m:12",label:"触发条件",path:"sexp"},{default:t(()=>[e(C,{clearable:"",value:a.sexp,"onUpdate:value":s[3]||(s[3]=i=>a.sexp=i),placeholder:"请输入触发条件",style:{width:"100%"}},null,8,["value"])]),_:1}),e(m,{span:"24 m:12",label:"脚本描述",path:"sdesc"},{default:t(()=>[e(C,{clearable:"",value:a.sdesc,"onUpdate:value":s[4]||(s[4]=i=>a.sdesc=i),placeholder:"请输入脚本描述",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function H(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!$e(g)}const tt=X({name:"configsetting_dataoperation_luascriptoperation",__name:"index",setup(g){const U=Ce(),y=Y({scriptTypeListOptions:[{label:"Lua周期执行",value:0}]}),{columns:K,columnChecks:b,data:w,getData:u,loading:a,mobilePagination:z,searchParams:d,resetSearchParams:V}=Re({apiFn:je,apiParams:{page:1,pageSize:20,limit:20,fuzzy:void 0,stype:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"sname",title:"脚本名称",align:"center",minWidth:180},{key:"sexp",title:"触发条件",align:"center",width:180},{key:"stype",title:"脚本类型",align:"center",width:180,render:l=>e("span",null,[l.stype==0?"Lua周期执行":""])},{key:"executeCircle",title:"执行周期(ms)",align:"center",width:180},{key:"sdesc",title:"脚本描述",align:"center",width:180},{key:"operate",title:v("common.operate"),align:"center",width:24,fixed:"right",render:l=>{let o;return e("div",{class:"flex-center gap-8px"},[D(e(_,{type:"primary",ghost:!0,size:"small",onClick:()=>R(l.id)},{default:()=>["编辑脚本函数"]}),[[S("no-auth"),"script:update"]]),D(e(_,{type:"primary",ghost:!0,size:"small",onClick:()=>I(l.id)},H(o=v("common.edit"))?o:{default:()=>[o]}),[[S("no-auth"),"script:update"]]),D(e(W,{onPositiveClick:()=>C(l.id)},{default:()=>v("common.confirmDelete"),trigger:()=>{let c;return e(_,{type:"error",ghost:!0,size:"small"},H(c=v("common.delete"))?c:{default:()=>[c]})}}),[[S("no-auth"),"script:delete"]])])}}]});De(()=>{});const{drawerVisible:x,operateType:$,editingData:k,handleAdd:O,handleEdit:E,checkedRowKeys:h,onBatchDeleted:B,onDeleted:j}=Le(w,u),r=()=>{u()};async function s(){console.log(h.value),m(h.value,l=>{B()})}const C=l=>{console.log(l),m([l],o=>{j()})};async function m(l,o){const c=await Ie({ids:l.join(",")});console.log("data",c),o&&o(c)}const I=l=>{E(l)},R=l=>{let o=U.resolve({path:"/scriptcode",query:{id:l}});window.open(o.href,"_blank")};function L(){d.fuzzy=void 0,r()}return(l,o)=>{const c=qe,P=ee,i=Z,ne=_e,oe=Se,G=te,ae=me,se=de,le=ue,ie=pe,re=Te,ce=Ue,A=S("no-auth");return T(),Ne("div",Ke,[e(ce,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(G,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(oe,null,{default:t(()=>[e(c,null,{default:t(()=>[f("脚本类型")]),_:1}),e(P,{filterable:"",clearable:"",placeholder:"请选择",value:n(d).stype,"onUpdate:value":[o[0]||(o[0]=p=>n(d).stype=p),r],options:y.scriptTypeListOptions},null,8,["value","options"]),e(c,null,{default:t(()=>[f("脚本名称")]),_:1}),e(i,{clearable:"",value:n(d).fuzzy,"onUpdate:value":o[1]||(o[1]=p=>n(d).fuzzy=p),placeholder:"请输入脚本名称",onKeyup:ze(r,["enter"]),onClear:L},null,8,["value"]),e(n(_),{type:"primary",ghost:"",onClick:r},{icon:t(()=>[e(ne,{class:M(["text-icon",{"animate-spin":n(a)}])},null,8,["class"])]),default:t(()=>[f(" 搜索 ")]),_:1})]),_:1})]),_:1})]),"header-extra":t(()=>[e(G,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[D((T(),F(n(_),{onClick:n(O),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(ae,{class:M(["text-icon",{"animate-spin":n(a)}])},null,8,["class"])]),default:t(()=>[f(" "+N("新增"))]),_:1},8,["onClick"])),[[A,"script:insert"]]),D((T(),F(n(W),{onPositiveClick:s},{trigger:t(()=>[e(n(_),{size:"small",ghost:"",type:"error",disabled:n(h).length==0},{icon:t(()=>[e(se,{class:"text-icon"})]),default:t(()=>[f(" "+N(n(v)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:t(()=>[f(" "+N(n(v)("common.confirmDelete")),1)]),_:1})),[[A,"script:delete"]]),e(n(_),{onClick:r,size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(le,{class:M(["text-icon",{"animate-spin":n(a)}])},null,8,["class"])]),_:1}),e(ie,{columns:n(b),"onUpdate:columns":o[2]||(o[2]=p=>q(b)?b.value=p:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(re,{"checked-row-keys":n(h),"onUpdate:checkedRowKeys":o[3]||(o[3]=p=>q(h)?h.value=p:null),columns:n(K),data:n(w),size:"small",loading:n(a),remote:"","row-key":p=>p.id,pagination:n(z)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Fe,{visible:n(x),"onUpdate:visible":o[4]||(o[4]=p=>q(x)?x.value=p:null),onSubmitted:n(u),"operate-type":n($),"row-data":n(k)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{tt as default};
