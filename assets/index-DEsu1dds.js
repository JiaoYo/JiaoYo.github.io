import{d as Q,q as ae,j as b,a0 as le,v as de,s as te,r as F,L as pe,o as E,c as M,w as n,g as l,O as ee,M as ce,i as S,$ as A,V as fe,e as q,aj as ve,h as m,t as h,f as X,N as me,ax as _e,ao as V,ap as K,A as ge,Y as he,B as W,E as Z,D as Ie,aa as ne,y as ye,an as Y,ae as oe,aq as Se,ar as be,S as we,F as xe,ay as Ae,az as ke,av as se}from"./index-CsnqqYix.js";import{l as ie}from"./lodash-ebEGiah5.js";import{_ as Ee,a as Ce}from"./arrow-open-up-DZwwj0Fs.js";import{_ as De}from"./round-search-Bu5YIN53.js";import{_ as Te}from"./round-refresh-CVNXUoG9.js";import{a as $e,T as J}from"./basicconf-DjOR-3Sx.js";import{b as ze,a as Ne,f as Pe}from"./common-Rdcn6rWV.js";import{_ as Le}from"./Cascader-B2HCjiJ2.js";import{_ as Ve}from"./FormItemGridItem-BZ0daFl2.js";import{_ as Me}from"./DatePicker-BwPn1mfn.js";import{_ as Oe}from"./Grid-CIi8gyXK.js";import{q as Ue,f as Be,r as Re}from"./events-Det_CZpz.js";import{e as je}from"./exportExcel-D6OyA9oJ.js";import{_ as Ge}from"./originlogInfo.vue_vue_type_script_setup_true_lang-B_mauN8w.js";import{_ as He,a as Fe}from"./DescriptionsItem-B1gOle2Z.js";import{_ as re}from"./DataTable-Ccx-rOeY.js";import"./TimePicker-Uv3oaiPd.js";import"./defineProperty-CbgZ-yqQ.js";import"./Forward-CBubG-vu.js";import"./CollapseItem-CcL7gCEx.js";const qe=Q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ae(["search"],["update:model"]),setup(g,{emit:D}){const T=D,o=b(!1),N=le(),{formRef:y,restoreValidation:I}=de(),e=te(g,"model"),k=b();(async()=>{const{data:d,error:a}=await ze();a||(k.value=d.map(s=>({...s,id:"-"+s.id,type:s.cname})))})();const w=F({eventsTypeDataList:[],eventsCategoryData:[]});async function $(){const{data:d,error:a}=await Ne();a||(w.eventsTypeDataList=d)}$();async function x(){const{data:d,error:a}=await Pe();a||(w.eventsCategoryData=d)}x();function L(){e.value.fuzzy=void 0,i()}async function u(d,a){d?(e.value.startTime=d[0],e.value.endTime=d[1]):(e.value.startTime=null,e.value.endTime=null),T("search")}async function _(){await I(),e.value.lsid=null,e.value.etype=null,e.value.elevel=null,e.value.fuzzy=null,e.value.startAndEndSendSourceIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.timeRange=null,e.value.ectgr=null,e.value.startSourceIp=null,e.value.endSourceIp=null,e.value.startAimIp=null,e.value.endAimIp=null,e.value.startSIp=null,e.value.endSIp=null,e.value.startTime=null,e.value.endTime=null,_e(()=>{T("search")})}async function i(){var d,a,s,r,v,c,p,t,C,z;if(e.value.startAndEndSendSourceIp&&e.value.startAndEndSendSourceIp.length>0?(e.value.startSIp=e.value.startAndEndSendSourceIp[0]||null,e.value.endSIp=e.value.startAndEndSendSourceIp[1]||null):(e.value.startSIp=null,e.value.endSIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=void 0,e.value.endSourceIp=void 0),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimIp=void 0,e.value.endAimIp=void 0),e.value.startSIp&&!V(e.value.startSIp)||e.value.startSourceIp&&!V(e.value.startSourceIp)||e.value.startAimIp&&!V(e.value.startAimIp))return(d=window.$message)==null||d.destroyAll(),(a=window.$message)==null||a.error("请输入正确的IP地址"),!1;if(e.value.endSIp&&!V(e.value.endSIp)||e.value.endSourceIp&&!V(e.value.endSourceIp)||e.value.endAimIp&&!V(e.value.endAimIp))return(s=window.$message)==null||s.destroyAll(),(r=window.$message)==null||r.error("请输入正确的IP地址"),!1;if(e.value.startSIp&&e.value.endSIp&&K(e.value.startSIp,e.value.endSIp)>0)return(v=window.$message)==null||v.destroyAll(),(c=window.$message)==null||c.error("发生源起始IP不能大于发生源终止IP"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&K(e.value.startSourceIp,e.value.endSourceIp)>0)return(p=window.$message)==null||p.destroyAll(),(t=window.$message)==null||t.error("源起始IP不能大于源终止IP"),!1;if(e.value.startAimIp&&e.value.endAimIp&&K(e.value.startAimIp,e.value.endAimIp)>0)return(C=window.$message)==null||C.destroyAll(),(z=window.$message)==null||z.error("目的起始IP不能大于目的终止IP"),!1;T("search")}return(d,a)=>{const s=Le,r=Ve,v=ge,c=he,p=Me,t=Te,C=W,z=De,O=Ee,U=Ce,B=Z,R=Oe,j=Ie,G=ne,H=pe("no-space");return E(),M(G,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[l(j,{ref_key:"formRef",ref:y,model:e.value,"label-placement":"left","label-width":S(N).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:me(i,["enter"])},{default:n(()=>[l(R,{responsive:"screen","item-responsive":"","y-gap":12},{default:n(()=>[o.value?(E(),M(r,{key:0,span:"24 s:24 m:6",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:n(()=>[l(s,{value:e.value.lsid,"onUpdate:value":[a[0]||(a[0]=f=>e.value.lsid=f),i],placeholder:"请选择日志源设备",options:k.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1})):ee("",!0),l(r,{span:"24 s:12 m:6",label:"事件名称",path:"fuzzy",class:"pr-24px"},{default:n(()=>[ce(l(v,{value:e.value.fuzzy,"onUpdate:value":a[1]||(a[1]=f=>e.value.fuzzy=f),placeholder:"请输入事件名称",clearable:"",onClear:L},null,8,["value"]),[[H]])]),_:1}),l(r,{span:"24 s:24 m:6",label:"事件类型",path:"etype",class:"pr-24px"},{default:n(()=>[l(c,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.etype,"onUpdate:value":[a[2]||(a[2]=f=>e.value.etype=f),i],"value-field":"id","label-field":"pname",options:w.eventsTypeDataList},null,8,["value","options"])]),_:1}),l(r,{span:"24 s:12 m:6",label:S(A)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:n(()=>[l(c,{filterable:"",clearable:"",placeholder:S(A)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[a[3]||(a[3]=f=>e.value.elevel=f),i],options:S(fe)(S($e))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),o.value?(E(),q(ve,{key:1},[l(r,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSendSourceIp",class:"pr-24px"},{default:n(()=>[l(v,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSendSourceIp,"onUpdate:value":a[4]||(a[4]=f=>e.value.startAndEndSendSourceIp=f)},null,8,["value"])]),_:1}),l(r,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndSourceIp",class:"pr-24px"},{default:n(()=>[l(v,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":a[5]||(a[5]=f=>e.value.startAndEndSourceIp=f)},null,8,["value"])]),_:1}),l(r,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px"},{default:n(()=>[l(v,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":a[6]||(a[6]=f=>e.value.startAndEndAimSourceIp=f)},null,8,["value"])]),_:1}),l(r,{span:"24 s:12 m:8",label:"产生时间",path:"timeRange",class:"pr-24px"},{default:n(()=>[l(p,{clearable:"",value:e.value.timeRange,"onUpdate:value":a[7]||(a[7]=f=>e.value.timeRange=f),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":u},null,8,["value"])]),_:1}),l(r,{span:"24 s:12 m:8",label:"事件类别",path:"ectgr",class:"pr-24px"},{default:n(()=>[l(c,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.ectgr,"onUpdate:value":[a[8]||(a[8]=f=>e.value.ectgr=f),i],"value-field":"id","label-field":"pname",options:w.eventsCategoryData},null,8,["value","options"])]),_:1})],64)):ee("",!0),l(r,{span:"24 s:12 m:6",class:"pr-24px"},{default:n(()=>[l(B,{class:"w-full",align:"center"},{default:n(()=>[l(C,{onClick:_},{icon:n(()=>[l(t,{class:"text-icon"})]),default:n(()=>[m(" "+h(S(A)("common.reset")),1)]),_:1}),l(C,{type:"primary",ghost:"",onClick:i},{icon:n(()=>[l(z,{class:"text-icon"})]),default:n(()=>[m(" "+h(S(A)("common.search")),1)]),_:1}),X("div",{class:"cursor-pointer",title:"精准查询",onClick:a[9]||(a[9]=f=>o.value=!o.value)},[o.value?(E(),M(O,{key:0,class:"text-icon"})):(E(),M(U,{key:1,class:"text-icon"}))])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width"])]),_:1})}}}),ue=g=>(Ae("data-v-21aa9bc9"),g=g(),ke(),g),We=ue(()=>X("span",null,"基本信息",-1)),Je=ue(()=>X("span",null,"原始日志信息",-1)),Ke={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"400px"}},Ye={key:1,class:"max-h-500px min-h-450px"};function Qe(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!oe(g)}const Xe=Q({__name:"detailInfo",props:ae({detailInfo:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(g){const D=te(g,"detailVisible"),T=g,o=b();ye(()=>D.value,async u=>{u&&(o.value=T.detailInfo,e())});const N=[{title:"",key:"index",width:50,render:(u,_)=>`${_+1}`},{key:"pname2",title:"事件类别",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:u=>{(u.elevel===void 0||u.elevel===null)&&(u.elevel=1);const _={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},i=A(J[u.elevel]);let d={color:_[u.elevel],textColor:"#ffffff",borderColor:_[u.elevel]};return l(Y,{size:"small",color:d},Qe(i)?i:{default:()=>[i]})}},{key:"sourceip",title:"发生源IP",align:"center",width:120},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"operate",title:A("common.operate"),align:"center",width:80,fixed:"right",render:u=>l("div",{class:"flex-center gap-8px"},[l(W,{type:"info",ghost:!0,size:"small",onClick:()=>L(u)},{default:()=>[m("详情")]})])}],y=b(!1);let I=b([]);const e=async u=>{var d;if(!y.value)y.value=!0;else return;const{data:_,error:i}=await Ue({aggid:(d=o.value)==null?void 0:d.aggid,limit:10,pageId:u});i||(y.value=!1,u?I.value=[...I.value,..._]:I.value=_)};function k(u){Math.abs(u.target.scrollTop+u.target.offsetHeight-u.target.scrollHeight)<=16&&w.total>I.value.length&&P()}const P=ie.debounce(()=>{e(I.value[I.value.length-1].id)},300),w=F({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:u,endIndex:_,page:i,pageSize:d,pageCount:a,itemCount:s}){var r;return`已加载${I.value.length}条 共计${(r=o.value)==null?void 0:r.aggre} 条`}}),$=b(!1),x=b(),L=async u=>{$.value=!0,x.value=u};return(u,_)=>{const i=He,d=Fe,a=Z,s=Se,r=re,v=be,c=we,p=xe;return E(),M(p,{show:D.value,"onUpdate:show":_[1]||(_[1]=t=>D.value=t),title:"事件详情",preset:"card",class:"w-1000px"},{default:n(()=>[l(c,{class:"max-h-600px pr-20px"},{default:n(()=>[l(v,{type:"line",animated:""},{default:n(()=>[l(s,{name:"1"},{tab:n(()=>[We]),default:n(()=>[l(a,{vertical:"",size:12},{default:n(()=>[l(d,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:n(()=>[l(i,{label:"事件名称"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.ename),1)]}),_:1}),l(i,{label:"事件类型"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.pname1),1)]}),_:1}),l(i,{label:"事件类别"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.pname2),1)]}),_:1}),l(i,{label:"事件等级"},{default:n(()=>{var t,C,z,O,U,B,R,j,G,H;return[l(S(Y),{size:"small",color:{textColor:"#ffffff",borderColor:((t=o.value)==null?void 0:t.elevel)===0?"#8e9dff":((C=o.value)==null?void 0:C.elevel)===1?"#5da8ff":((z=o.value)==null?void 0:z.elevel)===2?"#fedc69":((O=o.value)==null?void 0:O.elevel)===3?"#ff9874":((U=o.value)==null?void 0:U.elevel)===4?"#ff0000":"#5da8ff",color:((B=o.value)==null?void 0:B.elevel)===0?"#8e9dff":((R=o.value)==null?void 0:R.elevel)===1?"#5da8ff":((j=o.value)==null?void 0:j.elevel)===2?"#fedc69":((G=o.value)==null?void 0:G.elevel)===3?"#ff9874":((H=o.value)==null?void 0:H.elevel)===4?"#ff0000":"#5da8ff"}},{default:n(()=>{var f;return[m(h(S(A)(S(J)[(f=o.value)==null?void 0:f.elevel])),1)]}),_:1},8,["color"])]}),_:1}),l(i,{label:"日志源设备"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.type),1)]}),_:1}),l(i,{label:"聚合开始时间"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.aggrestarttime),1)]}),_:1}),l(i,{label:"聚合结束时间"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.aggreendtime),1)]}),_:1}),l(i,{label:"聚合数量"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.aggre),1)]}),_:1}),l(i,{label:"发生源IP"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.sip),1)]}),_:1}),l(i,{label:"源IP"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.sourceip),1)]}),_:1}),l(i,{label:"源端口"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.sourceport),1)]}),_:1}),l(i,{label:"目的IP"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.aimip),1)]}),_:1}),l(i,{label:"目的端口"},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.aimport),1)]}),_:1}),l(i,{label:"事件描述",span:3},{default:n(()=>{var t;return[m(h((t=o.value)==null?void 0:t.aimip),1)]}),_:1})]),_:1})]),_:1})]),_:1}),l(s,{name:"2"},{tab:n(()=>[Je]),default:n(()=>[S(I).length==0?(E(),q("div",Ke," 暂无原始日志信息 ")):(E(),q("div",Ye,[l(r,{columns:N,data:S(I),size:"small","scroll-x":762,"row-key":t=>t.id,"virtual-scroll":"",class:"sm:h-full",pagination:w,onScroll:k,loading:y.value,"max-height":400,remote:""},null,8,["data","row-key","pagination","loading"])])),l(Ge,{detailVisible:$.value,"onUpdate:detailVisible":_[0]||(_[0]=t=>$.value=t),detailInfo:x.value},null,8,["detailVisible","detailInfo"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ze=se(Xe,[["__scopeId","data-v-21aa9bc9"]]),ea={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function aa(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!oe(g)}const la=Q({name:"eventalarm_eventalarm",__name:"index",setup(g){const D=le(),T=b(window.innerHeight-306),o=b(!1),N=b(),y=F({pageId:void 0,limit:100,lsid:void 0,etype:void 0,ectgr:void 0,elevel:void 0,startSIp:void 0,endSIp:void 0,startSourceIp:void 0,endSourceIp:void 0,startAimIp:void 0,endAimIp:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),I=[{title:"",key:"index",width:80,render:(a,s)=>`${s+1}`},{key:"ename",title:"事件名称",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:160},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",width:120,render:a=>{(a.elevel===void 0||a.elevel===null)&&(a.elevel=1);const s={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},r=A(J[a.elevel]);let v={color:s[a.elevel],textColor:"#ffffff",borderColor:s[a.elevel]};return l(Y,{size:"small",color:v},aa(r)?r:{default:()=>[r]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"sip",title:"发生源IP",align:"center",width:160},{key:"aggreendtime",title:"聚合结束时间",align:"center",width:160},{key:"operate",title:A("common.operate"),align:"center",width:100,fixed:"right",render:a=>l("div",{class:"flex-center gap-8px"},[l(W,{type:"primary",ghost:!0,size:"small",onClick:()=>i(a)},{default:()=>[m("查看")]})])}],e=b([]),k=b(!1),P=async(a=!1)=>{if(!k.value)k.value=!0;else return;const{data:s,error:r}=await Be(y);r||(a?e.value=[...e.value,...s]:e.value=s,k.value=!1)};P();const w=b(!0),$=()=>{e.value=[],y.pageId=void 0,(s=>Object.keys(s).filter(c=>c!=="limit"&&c!=="_t").some(c=>s[c]!==void 0&&s[c]!==""&&s[c]!==null))(y)?w.value=!1:(w.value=!0,L()),P()},x=F({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:s,page:r,pageSize:v,pageCount:c,itemCount:p}){return`已加载${e.value.length}条`+(e.value.length?w.value?` 共计 ${e.value.length>0?p??0:0} 条`:e.value.length>=y.limit?"  预计还有更多":"":"")}});async function L(){const{data:a,error:s}=await Re();s||(x.pageCount=20,x.total=Number(a),x.itemCount=Number(a))}L();function u(a){Math.abs(a.target.scrollTop+a.target.offsetHeight-a.target.scrollHeight)<=16&&x.total>e.value.length&&_()}const _=ie.debounce(()=>{var a;((a=e.value)==null?void 0:a.length)<x.total&&(y.pageId=e.value[e.value.length-1].id,P(!0))},300);async function i(a){N.value=a,o.value=!0}async function d(){if(!e.value.length)return;const a=JSON.parse(JSON.stringify(e.value)),s=[];a.forEach(v=>{const c={};I.forEach(p=>{if(v.hasOwnProperty(p.key)){const t=p.key=="elevel"?A(J[v[p.key]]):v[p.key];c[p.title]=t}}),s.push(c)}),je(s,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50},{wpx:100},{wpx:150}],"安全事件_"+new Date().getTime())}return(a,s)=>{const r=Z,v=re,c=ne;return E(),q("div",ea,[l(qe,{model:y,"onUpdate:model":s[0]||(s[0]=p=>y=p),onSearch:$},null,8,["model"]),l(c,{title:"安全事件",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[l(r,null,{default:n(()=>[l(S(W),{type:"primary",size:"small",ghost:"",onClick:d,title:"导出已加载"},{default:n(()=>[m("导出已加载")]),_:1})]),_:1})]),default:n(()=>[l(v,{columns:I,data:e.value,size:"small","flex-height":!S(D).isMobile,loading:k.value,remote:"","scroll-x":I.reduce((p,t)=>p+t.width,0),"row-key":p=>p.id,pagination:x,"virtual-scroll":"",onScroll:u,class:"sm:h-full","max-height":T.value},null,8,["data","flex-height","loading","scroll-x","row-key","pagination","max-height"])]),_:1}),l(Ze,{detailVisible:o.value,"onUpdate:detailVisible":s[1]||(s[1]=p=>o.value=p),detailInfo:N.value},null,8,["detailVisible","detailInfo"])])}}}),wa=se(la,[["__scopeId","data-v-ed8a6e68"]]);export{wa as default};
