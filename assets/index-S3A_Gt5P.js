import{_ as ue}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DtGc5Ytf.js";import{_ as de}from"./round-delete-tdauvCgt.js";import{_ as ce}from"./round-add-CmnuyzV1.js";import{d as A,aG as L,C as pe,s as Y,A as ee,a as me,aI as te,aE as _e,c as V,o as G,w as t,f as e,a8 as fe,L as ae,h as o,aF as ne,G as U,b9 as ve,aM as ge,aN as ye,g as v,I as J,B as S,t as $,$ as N,a9 as he,cE as oe,cF as be,cG as we,K as Ce,a7 as le,aP as ke,aT as Ne,i as xe,E as K,b as De,aU as I,aJ as Te,H as O,aV as Se,e as ze,cH as Z,cI as Ue,aO as Q,aZ as $e}from"./index-CYktWG4g.js";import{u as je,a as Fe}from"./table-5HkGqXjJ.js";import{u as se}from"./usePageData-B3dmJo7x.js";import{_ as re}from"./Grid-yccwcNrM.js";import{_ as ie}from"./FormItemGridItem-CEINFz71.js";import{_ as Pe}from"./round-search-DE64LlxI.js";import{_ as Be}from"./round-refresh-BIWjpXWE.js";import{N as W}from"./Popconfirm-CztqIDpP.js";const Me=A({name:"OperateDrawer",__name:"operate-drawer",props:L({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:L(["submitted"],["update:visible"]),setup(h,{emit:j}){const b=j,_=h,s=pe(i());function i(){return{pid:void 0,id:"",devname:"",devcount:0,devtype:0,devmanu:"",notes:"",devmodel:"",devunit:""}}const k=async()=>{},w=Y(),{pageData:C,nextPage:x}=se(oe),F=async u=>{const n=u.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&C.data.length<C.total&&(x(),w.value=C.data.map(l=>({label:l.contractname,value:l.id})))},P=async u=>{s.pid=u};async function B(){k(),Object.assign(s,i()),_.operateType==="edit"&&_.rowData&&Object.assign(s,_.rowData)}const{formRef:M,validate:g,restoreValidation:z}=ee(),p={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devmanu:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devcount:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},devtype:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},devmodel:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devunit:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},d=me(()=>({add:"新增合同设备",edit:"修改合同设备"})[_.operateType]),f=te(h,"visible");_e(f,()=>{f.value&&(B(),setTimeout(()=>{const u=document.querySelector(".n-scrollbar-content");u==null||u.scrollTo(0,0)},300),z())});function m(){f.value=!1}async function R(){var u,n;if(await g(),_.operateType==="edit"){const{data:l,error:a}=await be([s]);a||(m(),b("submitted"),(u=window.$message)==null||u.success("修改成功"))}else{const{data:l,error:a}=await we([{...s}]);a||(m(),b("submitted"),(n=window.$message)==null||n.success("添加成功"))}}return(u,n)=>{const l=ie,a=ye,c=ge,D=re,q=ae,T=fe,E=J,H=he;return G(),V(H,{show:f.value,"onUpdate:show":n[8]||(n[8]=r=>f.value=r),title:d.value,preset:"card",class:"w-580px"},{footer:t(()=>[e(E,{justify:"end",size:16},{default:t(()=>[e(o(S),{onClick:m},{default:t(()=>[v($(o(N)("common.cancel")),1)]),_:1}),e(o(S),{type:"primary",onClick:R},{default:t(()=>[v($(o(N)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(T,{class:"pr-20px"},{default:t(()=>[e(q,{ref_key:"formRef",ref:M,model:s,rules:p,"label-placement":"left","label-width":140},{default:t(()=>[e(D,{responsive:"screen","item-responsive":""},{default:t(()=>[e(l,{span:"24 m:24",label:"合同名称",path:"pid"},{default:t(()=>[e(o(ne),{clearable:"",value:s.pid,"onUpdate:value":[n[0]||(n[0]=r=>s.pid=r),P],placeholder:"请选择合同名称",onScroll:F,options:w.value},null,8,["value","options"])]),_:1}),e(l,{span:"24 m:24",label:"设备名称",path:"devname"},{default:t(()=>[e(o(U),{value:s.devname,"onUpdate:value":n[1]||(n[1]=r=>s.devname=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"设备数量",path:"devcount"},{default:t(()=>[e(o(ve),{value:s.devcount,"onUpdate:value":n[2]||(n[2]=r=>s.devcount=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"设备型号",path:"devmodel"},{default:t(()=>[e(o(U),{value:s.devmodel,"onUpdate:value":n[3]||(n[3]=r=>s.devmodel=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"设备单位",path:"devunit"},{default:t(()=>[e(o(U),{value:s.devunit,"onUpdate:value":n[4]||(n[4]=r=>s.devunit=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"是否为我司设备",path:"devtype"},{default:t(()=>[e(c,{value:s.devtype,"onUpdate:value":n[5]||(n[5]=r=>s.devtype=r),name:"radiogroup"},{default:t(()=>[e(a,{value:0},{default:t(()=>n[9]||(n[9]=[v("是")])),_:1,__:[9]}),e(a,{value:1},{default:t(()=>n[10]||(n[10]=[v("否")])),_:1,__:[10]})]),_:1},8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"设备厂家",path:"devmanu"},{default:t(()=>[e(o(U),{value:s.devmanu,"onUpdate:value":n[6]||(n[6]=r=>s.devmanu=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"备注",path:"notes"},{default:t(()=>[e(o(U),{value:s.notes,"onUpdate:value":n[7]||(n[7]=r=>s.notes=r),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Re=A({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:L(["reset","search","clear"],["update:model"]),setup(h,{emit:j}){const b=j,{formRef:_,restoreValidation:s}=ee(),i=te(h,"model"),k=Y(),{pageData:w,getData:C,nextPage:x}=se(oe),F=async()=>{await C({limit:100}),i.value.pids=void 0,k.value=w.data.map(p=>({label:p.contractname,value:p.id}))},P=async p=>{const d=p.currentTarget,f=d.scrollTop;d.scrollTop+d.offsetHeight>=d.scrollHeight&&w.data.length<w.total&&(await x(),k.value=w.data.map(m=>({label:m.contractname,value:m.id})),await ke(),setTimeout(()=>{d.scrollTop=f}))},B=async p=>{i.value.pid=p,p&&b("search")};F();async function M(){await s(),i.value.fuzzy="",b("reset")}const g=()=>{i.value.fuzzy="",b("search")};async function z(){b("search")}return(p,d)=>{const f=U,m=ie,R=ne,u=Be,n=S,l=Pe,a=J,c=re,D=ae,q=le;return G(),V(q,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(D,{ref_key:"formRef",ref:_,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ce(z,["enter"])},{default:t(()=>[e(c,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(m,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:t(()=>[e(f,{value:i.value.fuzzy,"onUpdate:value":d[0]||(d[0]=T=>i.value.fuzzy=T),placeholder:"请输入",clearable:"",onClear:g},null,8,["value"])]),_:1}),e(m,{span:"24 s:12 m:6",label:"合同名称",path:"pids"},{default:t(()=>[e(R,{filterable:"",multiple:"",value:i.value.pids,"onUpdate:value":[d[1]||(d[1]=T=>i.value.pids=T),B],placeholder:"请选择合同名称",onScroll:P,options:k.value},null,8,["value","options"])]),_:1}),e(m,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(a,{class:"w-full"},{default:t(()=>[e(n,{onClick:M},{icon:t(()=>[e(u,{class:"text-icon"})]),default:t(()=>[v(" "+$(o(N)("common.reset")),1)]),_:1}),e(n,{type:"primary",ghost:"",onClick:z},{icon:t(()=>[e(l,{class:"text-icon"})]),default:t(()=>[v(" "+$(o(N)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function X(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!$e(h)}const Qe=A({name:"projectmanagement_contractdevice",__name:"index",setup(h){const j=Ne(),{columns:b,columnChecks:_,data:s,getData:i,loading:k,mobilePagination:w,searchParams:C}=je({showTotal:!0,apiFn:Ue,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",pids:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"devname",title:"设备名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"devcount",title:"数量",align:"center",width:120},{key:"devmodel",title:"型号",align:"center",width:120},{key:"devunit",title:"单位",align:"center",width:120},{key:"devtype",title:"是否为我司厂家",align:"center",width:120,render:l=>l.devtype==1?e(Q,{type:"success"},{default:()=>[v("是")]}):e(Q,{type:"info"},{default:()=>[v("否")]})},{key:"devmanu",title:"设备厂家",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:N("common.operate"),align:"center",width:140,fixed:"right",render:l=>{let a;return e("div",{class:"flex-center gap-8px"},[O(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>m(l.id)},X(a=N("common.edit"))?a:{default:()=>[a]}),[[K("no-auth"),"project:device:update"]]),e(W,{onPositiveClick:()=>f(l.id)},{default:()=>N("common.confirmDelete"),trigger:()=>{let c;return O(e(S,{type:"error",ghost:!0,size:"small"},X(c=N("common.delete"))?c:{default:()=>[c]}),[[K("no-auth"),"project:device:delete"]])}})])}}]}),{drawerVisible:x,operateType:F,editingData:P,handleAdd:B,handleEdit:M,checkedRowKeys:g,onBatchDeleted:z,onDeleted:p}=Fe(s,i);xe(async()=>{});async function d(){console.log(g.value),R(g.value.join(","),l=>{z()})}async function f(l){const{data:a,error:c}=await Z(l);c||p()}function m(l){M(l)}async function R(l,a){const{data:c,error:D}=await Z(l);if(!D)a&&a(c);else return!1}const u=l=>{i()},n=()=>{i()};return(l,a)=>{const c=J,D=ce,q=de,T=ue,E=Te,H=le,r=K("no-auth");return G(),De("div",qe,[e(Re,{model:o(C),"onUpdate:model":a[0]||(a[0]=y=>I(C)?C.value=y:null),onReset:n,onSearch:o(i),onClear:a[1]||(a[1]=y=>s.value=[])},null,8,["model","onSearch"]),e(H,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(c,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>a[5]||(a[5]=[ze("div",null,"合同设备",-1)])),_:1,__:[5]})]),"header-extra":t(()=>[e(c,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[O((G(),V(o(S),{onClick:o(B),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(D,{class:"text-icon"})]),default:t(()=>[a[6]||(a[6]=v(" "+$("新增")))]),_:1,__:[6]},8,["onClick"])),[[r,"project:device:insert"]]),e(o(W),{onPositiveClick:d},{trigger:t(()=>[O((G(),V(o(S),{size:"small",ghost:"",type:"error",disabled:o(g).length==0},{icon:t(()=>[e(q,{class:Se(["text-icon",{"animate-spin":o(k)}])},null,8,["class"])]),default:t(()=>[a[7]||(a[7]=v(" "+$("批量删除")))]),_:1,__:[7]},8,["disabled"])),[[r,"project:device:delete"]])]),default:t(()=>[a[8]||(a[8]=v(" 确定要删除选中的联系人吗？ "))]),_:1,__:[8]}),e(T,{columns:o(_),"onUpdate:columns":a[2]||(a[2]=y=>I(_)?_.value=y:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(E,{"checked-row-keys":o(g),"onUpdate:checkedRowKeys":a[3]||(a[3]=y=>I(g)?g.value=y:null),columns:o(b),data:o(s),size:"small","flex-height":!o(j).isMobile,loading:o(k),remote:"","row-key":y=>y.id,pagination:o(w),class:"sm:h-full","onUpdate:filters":u},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Me,{visible:o(x),"onUpdate:visible":a[4]||(a[4]=y=>I(x)?x.value=y:null),onSubmitted:o(i),"operate-type":o(F),"row-data":o(P)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{Qe as default};
