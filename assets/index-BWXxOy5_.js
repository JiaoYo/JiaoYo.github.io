import{j as E,b as R,k as ie,m as ce,d as q,n as W,p as G,u as le,a as H,q as X,r as D,s as J,v as de,x as A,y as ue,o as v,c as U,w as h,g as f,z as K,i as g,$ as y,A as j,f as C,C as F,h as z,t as P,D as pe,E as fe,F as B,G as me,H as Q,I as Y,J as ge,B as Z,K as ee,L as oe,M as _e,N as he,O,P as we,Q as ve,R as ye,S as ke,T as xe,U as Ce,V as Pe,W as be,X as Se,e as x,Y as Re,Z as Ee,a0 as L,a1 as Ue}from"./index-C2u6vOA1.js";function Ne(s){const c=E(0),w=R(()=>Math.ceil(c.value/60)),l=R(()=>c.value>0),{pause:t,resume:e}=ie(()=>{c.value>0?c.value-=1:t()},{immediate:!1});function r(a=s){c.value=60*a,e()}function n(){c.value=0,t()}return ce(()=>{t()}),{count:w,isCounting:l,start:r,stop:n}}/*! js-cookie v3.0.5 | MIT */function N(s){for(var i=1;i<arguments.length;i++){var c=arguments[i];for(var w in c)s[w]=c[w]}return s}var Ie={read:function(s){return s[0]==='"'&&(s=s.slice(1,-1)),s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(s){return encodeURIComponent(s).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function V(s,i){function c(l,t,e){if(!(typeof document>"u")){e=N({},i,e),typeof e.expires=="number"&&(e.expires=new Date(Date.now()+e.expires*864e5)),e.expires&&(e.expires=e.expires.toUTCString()),l=encodeURIComponent(l).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var r="";for(var n in e)e[n]&&(r+="; "+n,e[n]!==!0&&(r+="="+e[n].split(";")[0]));return document.cookie=l+"="+s.write(t,l)+r}}function w(l){if(!(typeof document>"u"||arguments.length&&!l)){for(var t=document.cookie?document.cookie.split("; "):[],e={},r=0;r<t.length;r++){var n=t[r].split("="),a=n.slice(1).join("=");try{var d=decodeURIComponent(n[0]);if(e[d]=s.read(a,d),l===d)break}catch{}}return l?e[l]:e}}return Object.create({set:c,get:w,remove:function(l,t){c(l,"",N({},t,{expires:-1}))},withAttributes:function(l){return V(this.converter,N({},this.attributes,l))},withConverter:function(l){return V(N({},this.converter,l),this.attributes)}},{attributes:{value:Object.freeze(i)},converter:{value:Object.freeze(s)}})}var te=V(Ie,{path:"/"});const $=(s,i,c)=>{te.set(s,i)},I=s=>te.get(s),ze=s=>(_e("data-v-dbf92d41"),s=s(),he(),s),Le={class:"w-full flex-y-center gap-16px"},Me=["src"],je={class:"flex-y-center justify-between updatePsd"},$e=ze(()=>C("div",{style:{display:"flex","justify-content":"right","align-items":"center"}},null,-1)),De=q({name:"PwdLogin",__name:"pwd-login",props:{status:{type:String,required:!0},statusModifiers:{}},emits:W(["getUsername"],["update:status"]),setup(s,{emit:i}){const c=G(s,"status"),w=le();H();const{formRef:l,validate:t}=X(),e=D({username:"",captcha:"",password:""}),r=D({uuid:"",captchaSrc:"",captchaEnable:0,checked:!1});async function n(){const{data:o,error:p}=await pe();p||(r.captchaEnable=o.data,r.captchaEnable==1&&a())}async function a(){r.uuid=A(),r.captchaSrc=fe+"/captcha?uuid="+r.uuid}const d=R(()=>{const{formRules:o}=J();return{username:o.username,captcha:o.captcha,password:o.password1}});async function u(){var p;await t(),r.checked?m(e.username,B(e.password),r.checked):k();const o=await w.login(e.username,e.password,e.captcha.trim(),r.uuid);console.log(o),((p=o==null?void 0:o.data)==null?void 0:p.login)===0&&setTimeout(()=>{const b=new CustomEvent("myCustomEvent");document.dispatchEvent(b)},500),o=="fail"&&r.captchaEnable==1&&(e.captcha="",a())}function m(o,p,b){$("power-prediction_user",o),$("power-prediction_pwd",p),$("power-prediction_check",String(b))}function _(){e.username=I("power-prediction_user")||"";const o=I("power-prediction_pwd")||"";e.password=me(o).substring(16),c.value=="pwd-login1"&&(e.password=""),r.checked=I("power-prediction_check")?I("power-prediction_check")=="true":!1}function k(){m("","",!1)}return E(!1),de(()=>{r.uuid=A(),_(),n()}),(o,p)=>{const b=Q,M=Y,se=ge,ne=Z,ae=ee,re=oe,T=ue("no-space");return v(),U(re,{ref_key:"formRef",ref:l,model:e,rules:d.value,size:"large","show-label":!1},{default:h(()=>[f(M,{path:"userName"},{default:h(()=>[K(f(b,{autofocus:"",value:e.username,"onUpdate:value":p[0]||(p[0]=S=>e.username=S),placeholder:g(y)("page.login.common.userNamePlaceholder"),onKeyup:j(u,["enter"])},null,8,["value","placeholder"]),[[T]])]),_:1}),f(M,{path:"password"},{default:h(()=>[K(f(b,{value:e.password,"onUpdate:value":p[1]||(p[1]=S=>e.password=S),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:g(y)("page.login.common.passwordPlaceholder"),onKeyup:j(u,["enter"])},null,8,["value","placeholder"]),[[T]])]),_:1}),r.captchaEnable==1?(v(),U(M,{key:0,path:"captcha"},{default:h(()=>[C("div",Le,[f(b,{value:e.captcha,"onUpdate:value":p[2]||(p[2]=S=>e.captcha=S),placeholder:"请输入验证码",onKeyup:j(u,["enter"])},null,8,["value"]),C("img",{src:r.captchaSrc,alt:"captcha",style:{height:"40px"},onClick:a},null,8,Me)])]),_:1})):F("",!0),f(ae,{vertical:"",size:8},{default:h(()=>[C("div",je,[f(se,{checked:r.checked,"onUpdate:checked":p[3]||(p[3]=S=>r.checked=S)},{default:h(()=>[z(P(g(y)("page.login.pwdLogin.rememberMe")),1)]),_:1},8,["checked"])]),f(ne,{type:"primary",size:"large",ghost:"",round:"",block:"",loading:g(w).loginLoading,onClick:u},{default:h(()=>[z(P(g(y)("common.confirm")),1)]),_:1},8,["loading"]),$e]),_:1})]),_:1},8,["model","rules"])}}}),Fe=O(De,[["__scopeId","data-v-dbf92d41"]]);function Be(){const{loading:s,startLoading:i,endLoading:c}=we(),{count:w,start:l,stop:t,isCounting:e}=Ne(60),r=R(()=>{let d=y("page.login.codeLogin.getCode");const u=y("page.login.codeLogin.reGetCode",{time:w.value});return s.value&&(d=""),e.value&&(d=u),d});function n(d){var u,m,_,k;return d.trim()===""?((m=(u=window.$message)==null?void 0:u.error)==null||m.call(u,y("form.mobile.required")),!1):ye.test(d)?!0:((k=(_=window.$message)==null?void 0:_.error)==null||k.call(_,y("form.mobile.invalid")),!1)}async function a(d,u){!n(d)||s.value||(i(),await new Promise(_=>{ve(d,u).then(k=>{var o,p;console.log("response",k),k.error||(setTimeout(_,500),(p=(o=window.$message)==null?void 0:o.success)==null||p.call(o,y("page.login.codeLogin.sendCodeSuccess")),l(),c())}).catch(k=>{var o,p;return console.log("error",k),(p=(o=window.$message)==null?void 0:o.error)==null||p.call(o,y("page.login.codeLogin.sendCodeFailed")),!1})}))}return{label:r,start:l,stop:t,isCounting:e,loading:s,getCaptcha:a}}const Ve=q({name:"ResetPwd",__name:"reset-pwd",props:W({username:{type:String,required:!0}},{status:{type:String,required:!0},statusModifiers:{}}),emits:["update:status"],setup(s){const i=G(s,"status"),c=s;H();const{formRef:w,validate:l}=X();Be();const t=D({username:c.username||"",oripwd:"",code:"",password:"",confirmPassword:""}),e=R(()=>{const{formRules:n,createConfirmPwdRule:a,defaultRequiredRule:d}=J();return{username:n.username,oripwd:n.password,password:[{...d},{asyncValidator:(u,m)=>m==""||m==null?Promise.resolve():ke(m)?t.username&&m.includes(t.username)?Promise.reject("密码禁止与用户名相同或包含用户名"):t.password==t.oripwd?Promise.reject("新密码不能与旧密码相同"):Promise.resolve():Promise.reject("密码应符合：大、小写字母、数字、特殊字符的三种或以上的组合"),trigger:["blur","input"]}],code:n.code,confirmPassword:a(t.password)}});async function r(){var m,_;await l();const n=await B(t.oripwd),a=await B(t.password),{data:d,error:u}=await xe(t.username,n,a);console.log("data",d),u?(_=window.$message)==null||_.error("修改失败"):((m=window.$message)==null||m.success("修改成功"),i.value="pwd-login1")}return(n,a)=>{const d=Q,u=Y,m=Z,_=ee,k=oe;return v(),U(k,{ref_key:"formRef",ref:w,model:t,rules:e.value,size:"large","show-label":!1},{default:h(()=>[f(u,{path:"username"},{default:h(()=>[f(d,{value:t.username,"onUpdate:value":a[0]||(a[0]=o=>t.username=o),placeholder:g(y)("page.login.common.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1}),f(u,{path:"oripwd"},{default:h(()=>[f(d,{value:t.oripwd,"onUpdate:value":a[1]||(a[1]=o=>t.oripwd=o),type:"password","show-password-on":"click",placeholder:"请输入原密码"},null,8,["value"])]),_:1}),f(u,{path:"password"},{default:h(()=>[f(d,{value:t.password,"onUpdate:value":a[2]||(a[2]=o=>t.password=o),type:"password","show-password-on":"click",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),f(u,{path:"confirmPassword"},{default:h(()=>[f(d,{value:t.confirmPassword,"onUpdate:value":a[3]||(a[3]=o=>t.confirmPassword=o),type:"password","show-password-on":"click",placeholder:g(y)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1}),f(_,{vertical:"",size:18,class:"w-full"},{default:h(()=>[f(m,{type:"primary",size:"large",ghost:"",round:"",block:"",onClick:r},{default:h(()=>[z(P(g(y)("common.confirm")),1)]),_:1}),f(m,{size:"large",ghost:"",round:"",block:"",onClick:a[4]||(a[4]=o=>i.value="pwd-login"),class:"c-#fff"},{default:h(()=>[z(P(g(y)("page.login.common.back")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),qe=O(Ve,[["__scopeId","data-v-3e5e8e75"]]),Oe={class:"w-400px lt-sm:w-300px"},Te={class:"flex-y-center justify-center"},Ae={key:0,src:L,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},Ke={key:1,src:L,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},We={key:2,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},Ge={key:3,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},He={class:"pt-24px"},Xe={class:"pt-16px"},Je={class:"flex justify-center items-center",style:{position:"fixed",top:"20px",right:"20px","z-index":"999"}},Qe={key:0,src:L,alt:"Linkqi",class:"w-100px pr-10px"},Ye={key:1,src:L,alt:"Linkqi",class:"w-100px pr-10px"},Ze={key:2,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},eo={key:3,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},oo={key:0,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},to={key:1,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},so=q({name:"login",__name:"index",props:{module:{}},setup(s){Ce();const i=Pe(),c=E("pwd-login");R(()=>i.darkMode?be(i.themeColor,600):i.themeColor);const w=E(""),l=n=>{w.value=n},t=R(()=>{const n="#ffffff",a=i.darkMode?.5:.2;return Se(n,i.themeColor,a)}),e=E();return(async()=>{fetch("/version.json").then(n=>n.json()).then(n=>{e.value=n}).catch(n=>{console.error("Error fetching version.json:",n)})})(),(n,a)=>{var u,m;const d=Ue;return v(),x("div",{class:"relative size-full flex-center overflow-hidden login",style:Ee({backgroundColor:t.value})},[f(d,{bordered:!1,class:"relative z-4 w-auto rd-12px loginClass","content-style":{padding:"24px 36px"}},{default:h(()=>[C("div",Oe,[C("header",Te,[g(i).darkMode?(v(),x("img",Ke)):(v(),x("img",Ae)),g(i).darkMode?(v(),x("h3",We,P(g(y)("system.title")),1)):(v(),x("h3",Ge,P(g(y)("system.title")),1))]),C("main",He,[C("div",Xe,[f(Re,{name:g(i).page.animateMode,mode:"out-in",appear:""},{default:h(()=>[c.value=="pwd-login"||c.value=="pwd-login1"?(v(),U(Fe,{key:0,status:c.value,"onUpdate:status":a[0]||(a[0]=_=>c.value=_),onGetUsername:l},null,8,["status"])):(v(),U(qe,{key:1,status:c.value,"onUpdate:status":a[1]||(a[1]=_=>c.value=_),username:w.value},null,8,["status","username"]))]),_:1},8,["name"])])])])]),_:1}),C("div",Je,[g(i).darkMode?(v(),x("img",Ye)):(v(),x("img",Qe)),g(i).darkMode?(v(),x("span",Ze,P(((u=e.value)==null?void 0:u.ver)||"V1.1.6"),1)):(v(),x("span",eo,P(((m=e.value)==null?void 0:m.ver)||"V1.1.6"),1))]),g(i).darkMode?F("",!0):(v(),x("div",oo," Copyright (c) 2024 · 杭州领祺科技有限公司")),g(i).darkMode?(v(),x("div",to," Copyright (c) 2024 · 杭州领祺科技有限公司")):F("",!0)],4)}}}),ao=O(so,[["__scopeId","data-v-8c835d7a"]]);export{ao as default};
