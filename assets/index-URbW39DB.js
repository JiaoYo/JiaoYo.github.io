import{_ as de}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CMdAjh88.js";import{_ as ue}from"./round-delete-wQkUyB87.js";import{_ as me}from"./round-add--_pSpbF_.js";import{d as J,at as E,q as ee,v as fe,r as te,s as ae,a as _e,au as oe,a2 as ge,c as H,o as G,w as a,f as e,b8 as he,G as ne,h as l,aw as le,C as V,N as Q,B as j,g as D,t as P,$ as C,b9 as ve,c0 as se,c7 as ye,c8 as we,F as be,U as re,M as Ce,i as ke,y as K,b as Se,aB as O,ad as ze,D as A,bn as xe,e as je,c9 as X,b$ as De,aF as Ne}from"./index-DMk9ecAg.js";import{u as Pe,a as Te}from"./table-C6eerTnn.js";import{u as ie}from"./usePageData-KTtgYQ98.js";import{_ as ce}from"./Grid-BIOqdWqR.js";import{_ as pe}from"./FormItemGridItem-CblRT5zG.js";import{_ as Ue}from"./round-search-D0NIJO1w.js";import{_ as $e}from"./round-refresh-BaPFSueZ.js";import{N as Y}from"./Popconfirm-ZXnEhqzl.js";const Be=J({name:"OperateDrawer",__name:"operate-drawer",props:E({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(v,{emit:T}){const _=T,k=ee(),u=v,t=fe(h());function h(){return{pid:void 0,id:"",pname:"",pcontact:"",proposition:"",docker:""}}const c=te([]),{pageData:d,getData:g,nextPage:S}=ie(se),U=async p=>{const o=p.currentTarget;o.scrollTop+o.offsetHeight>=o.scrollHeight&&d.data.length<d.total&&(S(),c.value=d.data)},$=async()=>{await g({fuzzy:k.userInfo.pname,page:1}),c.value=d.data},B=async()=>{await g({page:1}),c.value=d.data},F=async p=>{t.pid=p};async function y(){$(),Object.assign(t,h()),u.operateType==="add"&&(t.pid=u.pid),u.operateType==="edit"&&u.rowData&&Object.assign(t,u.rowData)}const{formRef:I,validate:M,restoreValidation:N}=ae(),r={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},pname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},pcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},s=_e(()=>({add:"新增联系人",edit:"修改联系人"})[u.operateType]),m=oe(v,"visible");ge(m,()=>{m.value&&(y(),setTimeout(()=>{const p=document.querySelector(".n-scrollbar-content");p==null||p.scrollTo(0,0)},300),N())});function w(){m.value=!1}async function R(){var p,o;if(await M(),u.operateType==="edit"){const{data:n,error:i}=await ye([t]);i||(w(),_("submitted"),(p=window.$message)==null||p.success("修改成功"))}else{const{data:n,error:i}=await we([{...t}]);i||(w(),_("submitted"),(o=window.$message)==null||o.success("添加成功"))}}return(p,o)=>{const n=pe,i=ce,z=ne,q=he,L=Q,x=ve;return G(),H(x,{show:m.value,"onUpdate:show":o[5]||(o[5]=f=>m.value=f),title:s.value,preset:"card",class:"w-500px"},{footer:a(()=>[e(L,{justify:"end",size:16},{default:a(()=>[e(l(j),{onClick:w},{default:a(()=>[D(P(l(C)("common.cancel")),1)]),_:1}),e(l(j),{type:"primary",onClick:R},{default:a(()=>[D(P(l(C)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(q,{class:"pr-20px"},{default:a(()=>[e(z,{ref_key:"formRef",ref:I,model:t,rules:r,"label-placement":"left","label-width":120},{default:a(()=>[e(i,{responsive:"screen","item-responsive":""},{default:a(()=>[e(n,{span:"24 m:24",label:"项目列表",path:"pid"},{default:a(()=>[e(l(le),{clearable:"",filterable:"",value:t.pid,"onUpdate:value":[o[0]||(o[0]=f=>t.pid=f),F],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:B,options:c.value,onScroll:U},null,8,["value","options"])]),_:1}),e(n,{span:"24 m:24",label:"对接方",path:"docker"},{default:a(()=>[e(l(V),{value:t.docker,"onUpdate:value":o[1]||(o[1]=f=>t.docker=f),placeholder:"请输入"},null,8,["value"])]),_:1}),e(n,{span:"24 m:24",label:"姓名",path:"pname"},{default:a(()=>[e(l(V),{value:t.pname,"onUpdate:value":o[2]||(o[2]=f=>t.pname=f),placeholder:"请输入"},null,8,["value"])]),_:1}),e(n,{span:"24 m:24",label:"联系方式",path:"pcontact"},{default:a(()=>[e(l(V),{value:t.pcontact,"onUpdate:value":o[3]||(o[3]=f=>t.pcontact=f),placeholder:"请输入"},null,8,["value"])]),_:1}),e(n,{span:"24 m:24",label:"备注",path:"proposition"},{default:a(()=>[e(l(V),{value:t.proposition,"onUpdate:value":o[4]||(o[4]=f=>t.proposition=f),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Fe=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search","clear"],["update:model"]),setup(v,{emit:T}){const _=T,{formRef:k,restoreValidation:u}=ae(),t=oe(v,"model"),h=ee(),c=te([]),{pageData:d,getData:g,nextPage:S}=ie(se),U=async r=>{const s=r.currentTarget;s.scrollTop+s.offsetHeight>=s.scrollHeight&&d.data.length<d.total&&(S(),c.value=d.data)},$=async r=>{var s;r?(t.value.pid=r,_("search"),h.setProjectInfo({pname:(s=c.value.find(m=>m.id==r))==null?void 0:s.proname,pid:r})):_("clear")},B=async r=>{await g({fuzzy:r,page:1}),c.value=d.data},F=async()=>{await g({page:1}),c.value=d.data};(async()=>{var r,s;await g({fuzzy:h.userInfo.pname}),c.value=d.data,t.value.pid=h.userInfo.pid?h.userInfo.pid:(r=c.value[0])==null?void 0:r.id,h.setProjectInfo({pid:t.value.pid,pname:(s=c.value.find(m=>m.id==t.value.pid))==null?void 0:s.proname}),_("search")})();async function I(){await u(),t.value.fuzzy="",_("reset")}const M=()=>{t.value.fuzzy="",_("search")};async function N(){var r,s;t.value.pid?_("search"):((r=window.$message)==null||r.destroyAll(),(s=window.$message)==null||s.warning("请选择项目"))}return(r,s)=>{const m=le,w=pe,R=V,p=$e,o=j,n=Ue,i=Q,z=ce,q=ne,L=re;return G(),H(L,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(q,{ref_key:"formRef",ref:k,model:t.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:be(N,["enter"])},{default:a(()=>[e(z,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[e(w,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:a(()=>[e(m,{filterable:"",clearable:"",value:t.value.pid,"onUpdate:value":[s[0]||(s[0]=x=>t.value.pid=x),$],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:c.value,onScroll:U,onClear:F,onSearch:B},null,8,["value","options"])]),_:1}),e(w,{span:"24 s:12 m:6",label:"姓名",path:"fuzzy"},{default:a(()=>[e(R,{value:t.value.fuzzy,"onUpdate:value":s[1]||(s[1]=x=>t.value.fuzzy=x),placeholder:"请输入",clearable:"",onClear:M},null,8,["value"])]),_:1}),e(w,{span:"24  s:12 m:6",class:"pr-24px"},{default:a(()=>[e(i,{class:"w-full"},{default:a(()=>[e(o,{onClick:I},{icon:a(()=>[e(p,{class:"text-icon"})]),default:a(()=>[D(" "+P(l(C)("common.reset")),1)]),_:1}),e(o,{type:"primary",ghost:"",onClick:N},{icon:a(()=>[e(n,{class:"text-icon"})]),default:a(()=>[D(" "+P(l(C)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ie={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Z(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Ne(v)}const Je=J({name:"projectmanagement_contact",__name:"index",setup(v){const T=Ce(),{columns:_,columnChecks:k,data:u,getData:t,pagination:h,loading:c,mobilePagination:d,searchParams:g}=Pe({showTotal:!0,immediate:!1,apiFn:De,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"docker",title:"对接方",align:"center",width:120},{key:"pname",title:"姓名",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pcontact",title:"联系方式",align:"center",width:120},{key:"proposition",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:C("common.operate"),align:"center",width:140,fixed:"right",render:o=>{let n;return e("div",{class:"flex-center gap-8px"},[A(e(j,{type:"primary",ghost:!0,size:"small",onClick:()=>s(o.id)},Z(n=C("common.edit"))?n:{default:()=>[n]}),[[K("no-auth"),"project:Contact:update"]]),e(Y,{onPositiveClick:()=>r(o.id)},{default:()=>C("common.confirmDelete"),trigger:()=>{let i;return A(e(j,{type:"error",ghost:!0,size:"small"},Z(i=C("common.delete"))?i:{default:()=>[i]}),[[K("no-auth"),"project:Contact:delete"]])}})])}}]}),{drawerVisible:S,operateType:U,editingData:$,handleAdd:B,handleEdit:F,checkedRowKeys:y,onBatchDeleted:I,onDeleted:M}=Te(u,t);ke(async()=>{});async function N(){console.log(y.value),m(y.value.join(","),o=>{I()})}async function r(o){const{data:n,error:i}=await X(o);i||M()}function s(o){F(o)}async function m(o,n){const{data:i,error:z}=await X(o);if(!z)n&&n(i);else return!1}const w=o=>{t()},R=()=>{u.value=[],h.itemCount=0},p=()=>{t()};return(o,n)=>{const i=Q,z=me,q=ue,L=de,x=ze,f=re,W=K("no-auth");return G(),Se("div",Ie,[e(Fe,{model:l(g),"onUpdate:model":n[0]||(n[0]=b=>O(g)?g.value=b:null),onReset:p,onSearch:l(t),onClear:R},null,8,["model","onSearch"]),e(f,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[e(i,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>n[4]||(n[4]=[je("div",null,"项目联系人",-1)])),_:1,__:[4]})]),"header-extra":a(()=>[e(i,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[A((G(),H(l(j),{onClick:l(B),size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(z,{class:"text-icon"})]),default:a(()=>[n[5]||(n[5]=D(" "+P("新增")))]),_:1,__:[5]},8,["onClick"])),[[W,"project:Contact:insert"]]),e(l(Y),{onPositiveClick:N},{trigger:a(()=>[A((G(),H(l(j),{size:"small",ghost:"",type:"error",disabled:l(y).length==0},{icon:a(()=>[e(q,{class:xe(["text-icon",{"animate-spin":l(c)}])},null,8,["class"])]),default:a(()=>[n[6]||(n[6]=D(" "+P("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[W,"project:Contact:delete"]])]),default:a(()=>[n[7]||(n[7]=D(" 确定要删除选中的联系人吗？ "))]),_:1,__:[7]}),e(L,{columns:l(k),"onUpdate:columns":n[1]||(n[1]=b=>O(k)?k.value=b:null)},null,8,["columns"])]),_:1})]),default:a(()=>[e(x,{"checked-row-keys":l(y),"onUpdate:checkedRowKeys":n[2]||(n[2]=b=>O(y)?y.value=b:null),columns:l(_),data:l(u),size:"small","flex-height":!l(T).isMobile,loading:l(c),remote:"","row-key":b=>b.id,pagination:l(d),class:"sm:h-full","onUpdate:filters":w},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Be,{visible:l(S),"onUpdate:visible":n[3]||(n[3]=b=>O(S)?S.value=b:null),onSubmitted:l(t),pid:l(g).pid,"operate-type":l(U),"row-data":l($)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{Je as default};
