import{d as ee,i as P,H as p,b2 as w,a as K,f as a,b as te,o as D,w as r,N as ae,c as W,s as H,aK as ne,g as C,B as oe,T as le,W as re,aH as se,h as k,Z as ue,cP as ie,cQ as ce,cN as me,fc as de,aX as ye,b4 as pe}from"./index-K-Oe9yen.js";import{u as ke}from"./usePageData-Cn0zOp5N.js";import{_ as fe}from"./RadioButton-CamoLGWz.js";import{_ as ve}from"./DatePicker-dDsqA412.js";const ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ne=ee({name:"reportmanagement_userdatareport",__name:"index",setup(he){const{pageData:L,getData:O}=ke(pe);P(()=>{O({usertypes:"2,3"})});const l=p({dates:void 0,statrtTime:null,endTime:null}),i=p({dayTime:null,weekTime:null,monthTime:null}),c=p("day"),A=t=>{const e=new Date;if(e.setHours(0,0,0,0),t==="day"){const o=w(0,e.getTime());i.value.dayTime=o,l.value.dates=o}else if(t==="week"){i.value.weekTime=ie();const{start:o,end:s}=ce(new Date().getTime());l.value.startTime=o,l.value.endTime=w(0,new Date(s).getTime())}else if(t==="month"){const o=w(3,e.getTime());i.value.monthTime=o,l.value.dates=o}f()},F=t=>{l.value.dates=t,f()},G=async t=>{const{monday:e,sunday:o}=me(t);l.value.startTime=e,l.value.endTime=w(0,new Date(o)),f()},I=t=>{l.value.dates=t,f()},j=p({}),J=p({}),f=async()=>{const t={dates:c.value!=="week"?l.value.dates:void 0,startTime:c.value=="week"?l.value.startTime:void 0,endTime:c.value=="week"?l.value.endTime:void 0},{data:e}=await de(t);e&&(j.value=e,J.value=JSON.parse(JSON.stringify(e)))};P(()=>{const e=w(0,new Date().getTime());l.value.dates=e,i.value.dayTime=e,f()});const B=p({daily:null,weekly:null,project:null,clockin:null}),_=(t,e)=>{var u;if(!t||!t.order){B.value[e]=null;return}const o=t.columnKey??t.key??((u=t.column)==null?void 0:u.key)??t.field??null,s=t.order;B.value[e]=o?{columnKey:o,order:s}:null},b=(t,e)=>K(()=>{const o=L.data??[],s=Array.isArray(j.value[t])?j.value[t]:[],u=o.map(y=>{const v=s.find(n=>n.creater===y.id);return v?{...y,...v}:{...y,...e}}),m=B.value[t];if(!m||!m.columnKey)return u;const x=m.columnKey,d=m.order;return u.slice().sort((y,v)=>{const n=y[x],h=v[x],M=typeof n=="number"?n:Number(n),S=typeof h=="number"?h:Number(h);if(!Number.isNaN(M)&&!Number.isNaN(S))return d==="ascend"?M-S:S-M;const V=n==null?"":String(n),R=h==null?"":String(h);return V===R?0:d==="ascend"?V>R?1:-1:V<R?1:-1})}),U={reportcount:0,avgcharctras:0,totalscore:0,avgscore:0,lowcount:0,mediumcount:0,highcount:0},q=b("daily",U),E=b("weekly",U),Q=b("project",U),X=K(()=>b("clockin",{clockinnormal:0,clockinabnormal:0,normalscore:0,abnormalscore:0}).value.map(e=>{const o=Number(e.clockinnormal||0),s=Number(e.clockinabnormal||0),u=Number(e.normalscore||0),m=Number(e.abnormalscore||0);return{...e,total:u+m,totalCount:o+s}})),T=t=>[{key:"username",title:"调试人",width:120,align:"center",render(e){return a("div",{class:"flex items-center justify-center"},[a(ye,{width:"40",height:"40","preview-disabled":!0,src:e.userimage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png",class:"rounded-md object-cover"},null),a("span",null,[e.username])])}},...t.map(e=>({key:e.key,title:e.title,align:e.align??"center",sorter:!0,width:e.width??120,render:e.render||(o=>{const s=o[e.key];return a("div",null,[s??0])})}))],Y=T([{key:"reportcount",title:"日报总数"},{key:"avgcharctras",title:"平均字符数"},{key:"avgscore",title:"平均得分"},{key:"totalscore",title:"总得分",render:t=>a("div",{style:"color:#1890ff; font-weight:600"},[t.totalscore])},{key:"lowcount",title:"合格次数"},{key:"mediumcount",title:"良好次数"},{key:"highcount",title:"优秀次数"}]),Z=T([{key:"reportcount",title:"周报总数"},{key:"avgcharctras",title:"平均字符数"},{key:"avgscore",title:"平均得分"},{key:"totalscore",title:"总得分",render:t=>a("div",{style:"color:#1890ff; font-weight:600"},[t.totalscore])},{key:"lowcount",title:"合格次数"},{key:"mediumcount",title:"良好次数"},{key:"highcount",title:"优秀次数"}]),$=T([{key:"reportcount",title:"项目总结总数"},{key:"avgcharctras",title:"平均字符数"},{key:"avgscore",title:"平均得分"},{key:"totalscore",title:"总得分",render:t=>a("div",{style:"color:#1890ff; font-weight:600"},[t.totalscore])},{key:"lowcount",title:"合格次数"},{key:"mediumcount",title:"良好次数"},{key:"highcount",title:"优秀次数"}]),z=T([{key:"clockinnormal",title:"正常打卡次数"},{key:"clockinabnormal",title:"异常打卡次数"},{key:"totalCount",title:"总打卡次数",render:t=>a("div",{style:"color:#1890ff; font-weight:600"},[t.totalCount])},{key:"normalscore",title:"正常分数"},{key:"abnormalscore",title:"异常分数"},{key:"total",title:"总分数",render:t=>a("div",{style:"color:#1890ff; font-weight:600"},[t.total])}]),N=p(window.innerHeight-325);return(t,e)=>{const o=fe,s=ne,u=ve,m=oe,x=ae,d=se,g=re,y=le,v=ue;return D(),te("div",ge,[a(v,{bordered:"",style:{height:"100%"}},{default:r(()=>[a(x,{label:"查询日期","label-placement":"left","show-feedback":!1,class:"mb-15px"},{default:r(()=>[a(s,{value:c.value,"onUpdate:value":[e[0]||(e[0]=n=>c.value=n),A],style:{"margin-right":"20px"}},{default:r(()=>[a(o,{value:"day"},{default:r(()=>e[8]||(e[8]=[C("天")])),_:1,__:[8]}),a(o,{value:"week"},{default:r(()=>e[9]||(e[9]=[C("周")])),_:1,__:[9]}),a(o,{value:"month"},{default:r(()=>e[10]||(e[10]=[C("月")])),_:1,__:[10]})]),_:1},8,["value"]),c.value==="day"?(D(),W(u,{key:0,"formatted-value":i.value.dayTime,"onUpdate:formattedValue":[e[1]||(e[1]=n=>i.value.dayTime=n),F],type:"date","value-format":"yyyy-MM-dd",style:{width:"200px"}},null,8,["formatted-value"])):H("",!0),c.value==="week"?(D(),W(u,{key:1,"formatted-value":i.value.weekTime,"onUpdate:formattedValue":[e[2]||(e[2]=n=>i.value.weekTime=n),G],type:"week",style:{width:"200px"}},null,8,["formatted-value"])):H("",!0),c.value==="month"?(D(),W(u,{key:2,"formatted-value":i.value.monthTime,"onUpdate:formattedValue":[e[3]||(e[3]=n=>i.value.monthTime=n),I],type:"month","value-format":"yyyy-MM",style:{width:"200px"}},null,8,["formatted-value"])):H("",!0),a(m,{type:"primary",ghost:"",style:{"margin-left":"20px"},onClick:f},{default:r(()=>e[11]||(e[11]=[C("查询")])),_:1,__:[11]})]),_:1}),a(y,{type:"segment",animated:""},{default:r(()=>[a(g,{name:"daily",tab:"日报数据报表"},{default:r(()=>[a(d,{columns:k(Y),data:k(q),"max-height":N.value,"onUpdate:sorter":e[4]||(e[4]=n=>_(n,"daily"))},null,8,["columns","data","max-height"])]),_:1}),a(g,{name:"weekly",tab:"周报数据报表"},{default:r(()=>[a(d,{columns:k(Z),data:k(E),"max-height":N.value,"onUpdate:sorter":e[5]||(e[5]=n=>_(n,"weekly"))},null,8,["columns","data","max-height"])]),_:1}),a(g,{name:"project",tab:"项目总结数据报表"},{default:r(()=>[a(d,{columns:k($),data:k(Q),"max-height":N.value,"onUpdate:sorter":e[6]||(e[6]=n=>_(n,"project"))},null,8,["columns","data","max-height"])]),_:1}),a(g,{name:"clockin",tab:"打卡数据报表"},{default:r(()=>[a(d,{columns:k(z),data:X.value,"max-height":N.value,"onUpdate:sorter":e[7]||(e[7]=n=>_(n,"clockin"))},null,8,["columns","data","max-height"])]),_:1})]),_:1})]),_:1})])}}});export{Ne as default};
