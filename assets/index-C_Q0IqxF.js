import{_ as be}from"./round-search-ZJkui7sH.js";import{d as ne,Y as me,s as j,a as ee,az as ie,i as de,dS as pe,b as B,o as S,e as d,F as L,f as m,B as ve,w as z,g as E,a2 as ue,a3 as ce,t as O,cM as we,aR as ke,ac as _e,aL as fe,V as le,aB as xe,aD as Fe,c as U,aJ as te,aH as re,a8 as ge,a9 as Me,eG as Te,aO as $e,aW as ae,eH as Ce,eI as De,aU as Ee,h as A,aE as Se,I as je,N as ze,aA as Oe,$ as Pe,a7 as Ae,eJ as Be,aK as Ie,aX as Ne,aV as Re}from"./index-CF5MLTcW.js";import{u as Ve}from"./usePageData-Ci1OCWwf.js";import{_ as se}from"./RadioButton-BbzJU67N.js";import{_ as oe}from"./DatePicker-BSkuVwse.js";const Ue={class:"map-wrapper",style:{height:"100%",position:"relative"}},Le={class:"map-legend"},We={class:"legend-header"},Ye={class:"legend-actions"},qe={class:"legend-list"},He=["onClick","onContextmenu"],Je={key:0,class:"visibility-icon"},Ke={key:1,class:"solo-icon"},Xe={class:"legend-name"},Ze={class:"visibility-toggle"},Ge={key:0,class:"solo-notice"},Qe=ne({__name:"historyMap",props:{trackData:{}},setup(I){const R=me(),r=j(null);let _=null;const P=I,F=j([]),c=["#FF6B9D","#6BCF7F","#4A90E2","#FFD166","#7B68EE","#00D4AA","#FF8C42","#BA68C8","#4ECDC4","#FFA726","#42B883","#FF5252","#536DFE","#00E5FF","#69F0AE","#FF4081","#18FFFF","#B388FF","#76FF03","#FF9100","#EA80FC","#84FFFF","#CCFF90","#FF9E80","#80D8FF","#FFFF8D","#A7FFEB","#FF80AB","#8C9EFF","#B9F6CA"],b=j({}),$=j(""),v=ee(()=>{const l={};return Object.keys(F.value).forEach((t,e)=>{l[t]=c[e%c.length],b.value[t]===void 0&&(b.value[t]=!0)}),l});function N(l){if($.value){W(l);return}b.value[l]=!b.value[l],h()}function W(l){$.value===l?V():($.value=l,Object.keys(b.value).forEach(i=>{b.value[i]=i===l}),h())}function V(){$.value="",Object.keys(b.value).forEach(l=>{b.value[l]=!0}),h()}function Y(){Object.keys(b.value).forEach(l=>{b.value[l]=!b.value[l]}),$.value="",h()}function X(){Object.keys(b.value).forEach(l=>{b.value[l]=!0}),$.value="",h()}function Z(){Object.keys(b.value).forEach(l=>{b.value[l]=!1}),$.value="",h()}const D=ee(()=>{const l=[];return Object.values(F.value).forEach(i=>{l.push(...i)}),l.sort((i,t)=>new Date(i.dbtime).getTime()-new Date(t.dbtime).getTime())}),Q=ee(()=>{if(D.value.length===0)return[120.370086,30.305716];const l=D.value.map(s=>s.longitude),i=D.value.map(s=>s.latitude),t=(Math.min(...l)+Math.max(...l))/2,e=(Math.min(...i)+Math.max(...i))/2;return console.log(t,e),[t,e]});async function f(){const l="/map-sdk.json",{data:i}=await fe.get(`${l}?_t=${Date.now()}`);return i}function g(l){return new Promise((i,t)=>{if(window.AMap)return i(window.AMap);const e=document.createElement("script");e.src=`https://webapi.amap.com/maps?v=2.0&key=${l}&plugin=AMap.PolylineEditor`,e.defer=!0,e.onload=()=>window.AMap?i(window.AMap):t(new Error("AMapåŠ è½½å¤±è´¥")),e.onerror=()=>t(new Error("AMapè„šæœ¬åŠ è½½é”™è¯¯")),document.head.appendChild(e)})}const w=j({});function C(l,i){const t=i.lng-l.lng,e=i.lat-l.lat;return(Math.atan2(-e,t)*180/Math.PI-90+360)%360-175}function x(l,i,t,e){const s=document.createElement("div");return s.style.cssText=`
    width: 12px;
    height: 18px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 18px solid ${e};
    transform: translate(-50%, -50%) rotate(${t}deg);
    transform-origin: center center;
  `,new l.Marker({position:[i.lng,i.lat],content:s,offset:new l.Pixel(0,0)})}function u(l,i,t,e,s){const p=document.createElement("div");return p.className="custom-marker",p.style.transform="translate(calc(-50% + 4px),-120%)",p.innerHTML=`
    <div class="avatar-wrapper" style="border-color: ${e};box-shadow: 0 0 5px ${e}, 0 0 6px ${e};">
      <img src="${s||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"}" class="marker-avatar" />
    </div>
    <div class="marker-name" style="color: ${e};">${t}</div>
  `,new l.Marker({position:[i.lng,i.lat],content:p})}function y(){r.value&&r.value.clearMap(),w.value={}}function h(){!window.AMap||!r.value||Object.keys(w.value).forEach(l=>{const i=b.value[l];(w.value[l]||[]).forEach(e=>{i?e.show():e.hide()})})}function q(l){if(!r.value)return;y();const i={};Object.entries(F.value).forEach(([e,s])=>{i[e]=s.map(p=>({lng:p.longitude,lat:p.latitude,address:p.address,dbtime:p.dbtime,proname:p.proname||"æœªæŒ‡å®šé¡¹ç›®",duration:p.duration||0,userimage:p.userimage,longitude:p.longitude,latitude:p.latitude}))}),Object.keys(i).forEach(e=>{const s=i[e],p=v.value[e];if(s.length===0)return;const M=[];if(s.length>1){const o=new l.Polyline({path:s.map(T=>[T.lng,T.lat]),strokeColor:p,strokeWeight:4,strokeOpacity:.7,strokeStyle:"solid",lineJoin:"round",lineCap:"round",isOutline:!0,outlineColor:"#FFFFFF",borderWeight:2});o.setMap(r.value),M.push(o)}s.forEach((o,T)=>{new l.Marker({position:[o.longitude,o.latitude],content:'<div class="marker-dot"></div>',anchor:"center",offset:new l.Pixel(0,0)}).setMap(r.value);const n=u(l,o,e,p,s[0].userimage);n.setMap(r.value),M.push(n),n.on("click",()=>{const a=`
          <div style="min-width:220px; background:#fff; padding:12px 14px; font-size:13px; color:#333; line-height:1.6">
            <div style="font-weight:bold; color:${p}; font-size:15px; margin-bottom:6px; border-bottom:1px solid #f0f0f0; padding-bottom:4px">
              ${e}
            </div>
            <div><b style="color:#555">åœ°ç‚¹ï¼š</b>${o.address}</div>
            <div><b style="color:#555">æ—¶é—´ï¼š</b>${o.dbtime}</div>
            <div><b style="color:#555">é¡¹ç›®ï¼š</b>${o.proname}</div>
            <div><b style="color:#555">ç»çº¬åº¦ï¼š</b><span style="font-size:12px;color:#666">${o.longitude}, ${o.latitude}</span></div>

          </div>
          <div style="margin-top:8px; text-align:right; font-size:12px; color:#999">ç¬¬ ${T+1} ä¸ªæ‰“å¡ç‚¹</div>
        `;_.setContent(a),_.setOffset(new l.Pixel(4,-60)),_.open(r.value,n.getPosition())}),n.on("dblclick",()=>{_.open(r.value,n.getPosition()),r.value.setCenter(n.getPosition()),r.value.setZoom(14)})});for(let o=1;o<s.length;o++){const T=s[o-1],k=s[o];if(K(T,k))continue;const n={lng:(T.lng+k.lng)/2,lat:(T.lat+k.lat)/2},a=C(T,k),H=x(l,n,a,p);H.isArrow=!0,H.setMap(r.value),M.push(H)}Object.keys(i).length==1&&r.value.setFitView(M,!1,[60,60,60,60]),w.value[e]=M});const t=()=>{const s=r.value.getZoom()>=7,p=J(w.value,b.value);Object.values(p).forEach(M=>{M==null||M.forEach(o=>{o.isArrow&&(s?o.show():o.hide())})})};r.value.on("zoomend",t),t(),Object.keys(w.value).forEach(e=>{(w.value[e]||[]).forEach(p=>{p.isArrow||(b.value[e]?p.show():p.hide())})})}function J(l,i){const t={};for(const e in l)i[e]&&(t[e]=l[e]);return t}function K(l,i,t=1e-7){return Math.abs(l.lng-i.lng)<t&&Math.abs(l.lat-i.lat)<t}async function G(){try{const l=await f(),i=await g(l.AMAP_SDK_KEY);r.value=new i.Map("amap-container",{viewMode:"2D",center:Q.value,zoom:5,features:["bg","point"]}),R.themeScheme==="dark"&&r.value.setMapStyle("amap://styles/dark"),i.plugin(["AMap.Scale","AMap.ToolBar"],()=>{r.value.addControl(new i.Scale),r.value.addControl(new i.ToolBar)}),r.value.on("zoomend",()=>{const e=r.value.getZoom()>=12,s=J(w.value,b.value);Object.values(s).forEach(p=>{p.forEach(M=>{M.isArrow&&(e?M.show():M.hide())})})}),_=new i.InfoWindow({anchor:"bottom-center",closeWhenClickMap:!0}),q(i)}catch(l){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",l)}}return ie(()=>P.trackData??[],l=>{console.log(l,"så¤„ç†æ•°æ®æˆ–æ¸²æŸ“å†…å®¹"),F.value=l,window.AMap&&r.value&&q(window.AMap)},{immediate:!0,deep:!0}),de(()=>{G()}),pe(()=>{r.value&&r.value.destroy()}),(l,i)=>{const t=ve;return S(),B("div",Ue,[i[4]||(i[4]=d("div",{id:"amap-container",style:{width:"100%",height:"100%","border-radius":"8px"}},null,-1)),d("div",Le,[d("div",We,[i[3]||(i[3]=d("div",{class:"legend-title"},"äººå‘˜è½¨è¿¹",-1)),d("div",Ye,[m(t,{type:"primary",onClick:X},{default:z(()=>i[0]||(i[0]=[E("å…¨æ˜¾")])),_:1,__:[0]}),m(t,{type:"primary",onClick:Z},{default:z(()=>i[1]||(i[1]=[E("å…¨éš")])),_:1,__:[1]}),m(t,{type:"primary",onClick:Y},{default:z(()=>i[2]||(i[2]=[E("åé€‰")])),_:1,__:[2]})])]),d("div",qe,[(S(!0),B(ue,null,ce(v.value,(e,s)=>(S(),B("div",{key:s,class:ke(["legend-item",{"legend-item-hidden":!b.value[s],"legend-item-solo":$.value===s}]),onClick:p=>N(s),onContextmenu:we(p=>W(s),["prevent"])},[d("div",{class:"legend-color",style:_e({backgroundColor:e})},[b.value[s]?L("",!0):(S(),B("span",Je,"ğŸ‘ï¸â€ğŸ—¨ï¸")),$.value===s?(S(),B("span",Ke,"â­")):L("",!0)],4),d("span",Xe,O(s),1),d("span",Ze,O(b.value[s]?"éšè—":"æ˜¾ç¤º"),1)],42,He))),128))]),$.value?(S(),B("div",Ge,[E(" ä»…æ˜¾ç¤º: "+O($.value)+" ",1),d("button",{class:"cancel-solo-btn",onClick:V},"å–æ¶ˆ")])):L("",!0)])])}}}),et=le(Qe,[["__scopeId","data-v-21c4c99e"]]),tt={class:"map-wrapper",style:{height:"100%",position:"relative"}},at=ne({__name:"map",props:{trackData:{},username:{},projectName:{}},setup(I){const R=me(),r=j(null);let _=null;const P=I,F=[{id:25,pid:10,longitude:120.367925,latitude:30.300161,address:"æµ™æ±Ÿçœæ­å·å¸‚é’±å¡˜åŒºç™½æ¨è¡—é“ç•™å­¦ç”Ÿåˆ›ä¸š",dbtime:"2025-10-28 22:38:57",username:"auditor",daytime:"2025-10-28"},{id:25,pid:10,ctype:2,longitude:120.373554,latitude:30.288942,address:"ä¸‰èŠ±-é“è·¯åœè½¦ä½",dbtime:"2025-10-28 22:38:57",username:"auditor",daytime:"2025-10-28"}],c=j(P.trackData??F),b=["#FFA726","#6BCF7F"],$=ee(()=>{if(c.value.length===0)return[120.370086,30.305716];const f=c.value.map(w=>w.longitude),g=c.value.map(w=>w.latitude);return[(Math.min(...f)+Math.max(...f))/2,(Math.min(...g)+Math.max(...g))/2]});async function v(){const f="/map-sdk.json",{data:g}=await fe.get(`${f}?_t=${Date.now()}`);return g}function N(f){return new Promise((g,w)=>{if(window.AMap)return g(window.AMap);const C=document.createElement("script");C.src=`https://webapi.amap.com/maps?v=2.0&key=${f}&plugin=AMap.PolylineEditor`,C.defer=!0,C.onload=()=>window.AMap?g(window.AMap):w(new Error("AMapåŠ è½½å¤±è´¥")),C.onerror=()=>w(new Error("AMapè„šæœ¬åŠ è½½é”™è¯¯")),document.head.appendChild(C)})}const W=j({});function V(f,g,w,C,x){const u=document.createElement("div");return u.className="custom-marker",u.style.transform="translate(calc(-50% + 4px), -110%)",u.innerHTML=`
    <div class="avatar-wrapper" style="border-color: ${C}; box-shadow: 0 0 10px ${C}, 0 0 20px ${C};">
      <img src="${x||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"}" class="marker-avatar" />
    </div>
    <div class="marker-name" style="color: ${C};">${w}</div>
  `,new f.Marker({position:[g.lng,g.lat],content:u})}function Y(f,g){const w=document.createElement("div");return w.className="custom-marker",w.style.transform="translateX(-50%)",w.innerHTML='<div class="marker-dot"></div>',new f.Marker({position:[g.lng,g.lat],content:w})}function X(){r.value&&r.value.clearMap(),W.value={}}function Z(f){X();const g=c.value.map(u=>({lng:u.longitude,lat:u.latitude,address:u.address,dbtime:u.dbtime,proname:u.proname||"æœªæŒ‡å®šé¡¹ç›®",duration:u.duration||0,distanse:u.distanse.toFixed(2)||0,userimage:u.userimage,status:u.status,ctype:u.ctype||1})),w=b[0],C=[];if(g.length>1){const u=new f.Polyline({path:g.map(y=>[y.lng,y.lat]),strokeColor:w,strokeWeight:3,strokeOpacity:.7,strokeStyle:"solid",lineJoin:"round",lineCap:"round",isOutline:!0,outlineColor:"#FFFFFF",borderWeight:2});u.setMap(r.value),C.push(u)}g.forEach(u=>{let y;u.ctype!=2?(y=V(f,u,P.username,w,g[0].userimage),new f.Marker({position:[u.lng,u.lat],content:'<div class="marker-dot"></div>',anchor:"center"}).setMap(r.value)):y=Y(f,u),y.setMap(r.value),C.push(y),y.on("click",()=>{const h=`
        <div style="min-width:220px; background:#fff; padding:12px 14px; font-size:13px;">
          <div style="font-weight:bold; color:${w}; font-size:15px; margin-bottom:6px;">
            ${P.username}
          </div>
          <div><b>åœ°ç‚¹ï¼š</b>${u.address}</div>
          <div><b>æ—¶é—´ï¼š</b>${u.dbtime}</div>
          <div><b>é¡¹ç›®ï¼š</b>${P.projectName||"æœªæŒ‡å®šé¡¹ç›®"}</div>
          <div><b>ç±»å‹ï¼š</b>${u.ctype==0?"ä¸Šç­æ‰“å¡":u.ctype==1?"ä¸‹ç­æ‰“å¡":"ç³»ç»Ÿä¸ŠæŠ¥"}</div>
          <div><b>ç»çº¬åº¦ï¼š</b>${u.lng}, ${u.lat}</div>
          <div><b>æ‰“å¡è¯¯å·®ï¼š</b>${u.distanse||0}ç±³</div>
          ${u.duration?`<div><b>å·¥æ—¶ï¼š</b>${u.duration} å°æ—¶</div>`:""}
        </div>
      `;_.setContent(h),_.setOffset(new f.Pixel(4,-60)),_.open(r.value,y.getPosition())})});for(let u=1;u<g.length;u++){const y=g[u-1],h=g[u];if(Math.abs(y.lng-h.lng)<1e-7&&Math.abs(y.lat-h.lat)<1e-7)continue;const q={lng:(y.lng+h.lng)/2,lat:(y.lat+h.lat)/2},J=Math.atan2(-(h.lat-y.lat),h.lng-y.lng)*180/Math.PI-90,K=D(f,q,J,"#1890ff");K.setMap(r.value),C.push(K)}r.value.setFitView(C,!1,[60,60,60,60]),W.value.single=C;const x=c.value[0]?{address:c.value[0].caddress,lng:c.value[0].clongitude,lat:c.value[0].clatitude}:null;if(x&&x.lng&&x.lat){const u=new f.Marker({position:[x.lng,x.lat],offset:new f.Pixel(-13,-30),icon:new f.Icon({size:new f.Size(26,30),imageSize:new f.Size(26,30),image:"https://cdn-icons-png.flaticon.com/512/684/684908.png"})}),y=new f.InfoWindow({content:`<div style="font-size:14px;">ğŸ“é¡¹ç›®ä½ç½®ï¼š${x.address}</div>`,offset:new f.Pixel(0,-30)});u.on("click",()=>y.open(r.value,u.getPosition())),r.value.add(u)}if(x&&x.lng&&x.lat){const u=new f.Marker({position:[x.lng,x.lat],offset:new f.Pixel(-13,-30),icon:new f.Icon({size:new f.Size(26,30),imageSize:new f.Size(26,30),image:"https://cdn-icons-png.flaticon.com/512/684/684908.png"})}),y=new f.InfoWindow({content:`<div style="font-size:14px;">ğŸ“é¡¹ç›®ä½ç½®ï¼š${x.address}</div>`,offset:new f.Pixel(0,-30)});u.on("click",()=>y.open(r.value,u.getPosition())),r.value.add(u),g.forEach(h=>{if(h.ctype===0||h.ctype===1){const q=new f.Polyline({path:[[h.lng,h.lat],[x.lng,x.lat]],strokeColor:h.status==1?"#FF4500":"#00BCD4",strokeOpacity:1,strokeWeight:3,strokeStyle:"dashed",showDir:!0});q.setMap(r.value),C.push(q);const J=(h.lng+x.lng)/2,K=(h.lat+x.lat)/2,G=new f.Marker({position:[J,K],content:`<div style="white-space: pre;padding:2px 4px; background:#fff; border:1px solid ${h.status==1?"#FF4500":"#00BCD4"}; border-radius:3px; font-size:12px;">${h.distanse} m</div>`,offset:new f.Pixel(0,-10)});G.setMap(r.value),C.push(G)}})}}function D(f,g,w,C){const x=document.createElement("div");x.style.cssText=`
    position: relative; width:60px; height:24px; display:flex; align-items:center;
    transform: translate(-50%, -50%) rotate(${w-90}deg); transform-origin:center center;
  `;for(let y=0;y<3;y++){const h=document.createElement("div");h.style.cssText=`
      position:absolute;width:0;height:0;
      border-top:8px solid transparent; border-bottom:8px solid transparent;
      border-left:12px solid ${C};
      opacity:${.3+y*.2};
      left:${y*8}px;
      animation: arrowFlow 1.5s infinite; animation-delay:${y*.2}s;
    `,x.appendChild(h)}const u=document.createElement("style");return u.textContent=`
    @keyframes arrowFlow {
      0%{opacity:0.3; transform:translateX(0px) scale(1);}
      50%{opacity:1; transform:translateX(4px) scale(1.1);}
      100%{opacity:0.3; transform:translateX(0px) scale(1);}
    }
  `,document.head.appendChild(u),new f.Marker({position:[g.lng,g.lat],content:x,offset:new f.Pixel(0,0)})}async function Q(){try{const f=await v(),g=await N(f.AMAP_SDK_KEY);r.value=new g.Map("amap-container",{viewMode:"2D",zoom:15,center:$.value,features:["bg","point"]}),R.themeScheme==="dark"&&r.value.setMapStyle("amap://styles/dark"),g.plugin(["AMap.Scale","AMap.ToolBar"],()=>{r.value.addControl(new g.Scale),r.value.addControl(new g.ToolBar)}),_=new g.InfoWindow({anchor:"bottom-center",closeWhenClickMap:!0}),Z(g)}catch(f){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",f)}}return de(()=>{c.value=P.trackData??F,Q()}),pe(()=>{r.value&&r.value.destroy()}),(f,g)=>(S(),B("div",tt,g[0]||(g[0]=[d("div",{id:"amap-container",style:{width:"100%",height:"100%","border-radius":"8px"}},null,-1)])))}}),st=le(at,[["__scopeId","data-v-95873504"]]),nt={class:"p-1 border-b border-gray-100 last:border-b-0 font-size-16px"},lt={class:"flex mb-3 items-center"},ot={class:"flex-col justify-center items-center mr-20px"},rt=["src"],it={class:"font-bold mt-10px text-[#000] calendarName"},dt={class:"flex mb-1"},ut={class:"c-#4169e1 font-bold"},ct={class:"flex mb-1"},mt={class:"c-#4169e1 font-bold"},pt={class:"flex mb-1"},vt={class:"mr-20px"},ft={class:"c-#4169e1 font-bold"},gt={class:"c-#4169e1 font-bold"},yt={class:"flex mb-1"},ht={class:"c-#4169e1 font-bold"},bt={class:"mx-20px flex items-center"},wt={class:"flex items-center"},kt={class:"flex mb-1"},_t={key:0},xt={class:"fontC"},Ft={class:"fontC"},Mt={class:"fontC"},Tt={class:"fontC"},$t=ne({__name:"calendarModal",props:xe({lookdetail:{},creater:{}},{dialogVisible:{type:Boolean,default:!1},dialogVisibleModifiers:{}}),emits:["update:dialogVisible"],setup(I){const R=Fe(I,"dialogVisible"),r=I,_=j({pid:0,address:"",startTime:void 0,endTime:void 0,duration:0,status:0,dailyReport:0,username:"",daytime:"",projectName:"",userImage:"",ctype:0}),P=j([]),F=async()=>{const{data:$,error:v}=await Te({startTime:r.lookdetail.startTime||r.lookdetail.daytime+" 00:00:00",endTime:r.lookdetail.endTime||r.lookdetail.daytime+" 23:59:59",pid:r.lookdetail.pid,creater:r.creater});$&&(P.value=$,_.value.address=$[0].caddress)};ie(()=>R.value,async $=>{$&&(Object.assign(_.value,r.lookdetail),b.value="table",P.value=[],F())});const c=()=>{R.value=!1,setTimeout(()=>{_.value={pid:0,address:"",startTime:void 0,endTime:void 0,duration:0,status:0,dailyReport:0,username:"",daytime:"",projectName:"",userImage:"",ctype:0}},200)},b=j("table");return($,v)=>{const N=te,W=te,V=se,Y=re,X=ge,Z=Me;return S(),U(Z,{show:R.value,"onUpdate:show":v[1]||(v[1]=D=>R.value=D),class:"w-1000px",preset:"card",onClose:c,"modal-animation-name":"el-fade"},{header:z(()=>v[2]||(v[2]=[E(" è¯¦æƒ… ")])),default:z(()=>[d("div",nt,[d("div",lt,[d("div",ot,[d("img",{class:"w-60px h-60px rounded-full shadow-sm",src:_.value.userImage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"},null,8,rt),d("div",it,O(_.value.username),1)]),d("div",null,[d("div",dt,[v[3]||(v[3]=d("span",{class:"mr-2"}," ğŸ—ï¸ é¡¹ç›®åç§°ï¼š ",-1)),d("span",ut,O(_.value.projectName||"æš‚æ— é¡¹ç›®"),1)]),d("div",ct,[v[4]||(v[4]=d("span",{style:{"white-space":"nowrap"}},"ğŸ“ é¡¹ç›®åœ°å€ï¼š",-1)),d("span",mt,O(_.value.address),1)]),d("div",pt,[d("div",vt,[v[5]||(v[5]=d("span",null,"ğŸ“… ä¸Šç­æ‰“å¡æ—¶é—´ï¼š",-1)),d("span",ft,O(_.value.startTime||"æ— "),1)]),d("div",null,[v[6]||(v[6]=d("span",null,"ğŸ“… ä¸‹ç­æ‰“å¡æ—¶é—´ï¼š",-1)),d("span",gt,O(_.value.endTime||"æ— "),1)])]),d("div",yt,[d("div",null,[v[7]||(v[7]=d("span",null,"â³ å·¥æ—¶ï¼š",-1)),d("span",ht,O(_.value.duration||0)+"å°æ—¶",1)]),d("div",bt,[v[10]||(v[10]=d("span",null,"ğŸ”” æ‰“å¡çŠ¶æ€ï¼š",-1)),d("span",null,[_.value.status==1?(S(),U(N,{key:0,type:"error",size:"small"},{default:z(()=>v[8]||(v[8]=[d("span",{class:"mr-1"},null,-1),E("å¼‚å¸¸ ")])),_:1,__:[8]})):L("",!0),_.value.status==0?(S(),U(N,{key:1,type:"success",size:"small"},{default:z(()=>v[9]||(v[9]=[d("span",{class:"mr-1"},null,-1),E("æ­£å¸¸ ")])),_:1,__:[9]})):L("",!0)])]),d("div",wt,[v[11]||(v[11]=d("span",null,"ğŸ“ æ—¥æŠ¥ï¼š",-1)),d("span",null,[m(W,{size:"small",type:_.value.dailyReport==1?"success":"error"},{default:z(()=>[E(O(_.value.dailyReport==1?"å·²æäº¤":"æœªæäº¤"),1)]),_:1},8,["type"])])])])])]),d("div",kt,[v[12]||(v[12]=d("div",{class:"mr-15px"},"å†å²è½¨è¿¹",-1)),m(Y,{size:"small",value:b.value,"onUpdate:value":v[0]||(v[0]=D=>b.value=D),name:"radiobuttongroup1"},{default:z(()=>[m(V,{value:"table",label:"è¡¨æ ¼"}),m(V,{value:"map",label:"åœ°å›¾"})]),_:1},8,["value"])]),b.value=="table"?(S(),B("div",_t,[m(X,{style:{height:"600px"},trigger:"hover"},{default:z(()=>[(S(!0),B(ue,null,ce(P.value,D=>(S(),B("div",{class:"tableItem",key:D.id},[d("div",null,[v[13]||(v[13]=E("æ‰“å¡ç±»å‹ï¼š")),d("span",xt,O(D.ctype==0?"ä¸Šç­æ‰“å¡":D.ctype==1?"ä¸‹ç­æ‰“å¡":"ç³»ç»Ÿä¸ŠæŠ¥"),1)]),d("div",null,[v[14]||(v[14]=E("æ‰“å¡çŠ¶æ€ï¼š")),m(N,{type:D.status==1?"error":"success"},{default:z(()=>[d("div",null,O(D.status==0?"æ­£å¸¸":"å¼‚å¸¸"),1)]),_:2},1032,["type"])]),d("div",null,[v[15]||(v[15]=E("åœ°å€ï¼š ")),d("span",Ft,O(D.address),1)]),d("div",null,[v[16]||(v[16]=E("æ‰“å¡æ—¶é—´ï¼š")),d("span",Mt,O(D.dbtime),1)]),d("div",null,[v[17]||(v[17]=E("æ‰“å¡è¯¯å·®å€¼ï¼š")),d("span",Tt,O(D.distanse?D.distanse.toFixed(2)+"ç±³":"æ— "),1)])]))),128))]),_:1})])):L("",!0),b.value=="map"?(S(),U(st,{key:1,trackData:P.value,projectName:_.value.projectName,username:r.lookdetail.username,class:"map"},null,8,["trackData","projectName","username"])):L("",!0)])]),_:1},8,["show"])}}}),Ct=le($t,[["__scopeId","data-v-b3ff7001"]]),Dt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Et(I){return typeof I=="function"||Object.prototype.toString.call(I)==="[object Object]"&&!Re(I)}const St=ne({name:"reportmanagement_calendar",__name:"index",setup(I){const R=$e();function r(t){return t.getFullYear()}function _(t){const e=new Date(t.getFullYear(),0,1),s=(t.getTime()-e.getTime())/864e5,p=e.getDay()||7;return Math.ceil((s+p)/7)}function P(){const t=new Date,e=r(t),s=_(t).toString().padStart(2,"0");return`${e}-${s}å‘¨`}const F=j("week"),c=j({dayTime:String(ae(0,null)),monthTime:String(ae(3,null)),weekTime:P(),startTime:null,endTime:null,dates:null,creater:null}),b=j([{label:"æ—¥",value:"day"},{label:"å‘¨",value:"week"},{label:"æœˆ",value:"month"}]),$=j("table"),v=j({}),N=j({}),W=ee(()=>Object.keys(v.value||{}).map(t=>{var e,s;return{key:t,name:t,userimage:(s=(e=v.value[t])==null?void 0:e[0])==null?void 0:s.userimage}})),V=ee(()=>{const t=[{title:"ç”¨æˆ·å",key:"name",width:120,align:"center",fixed:"left",render(s){return m("div",{class:"text-blue-600 flex-col items-center font-medium"},[m(Ee,{width:"60",height:"60","preview-disabled":!0,src:s.userimage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png",class:"rounded-md object-cover"},null),m("span",null,[s.name])])}}];let e=[];switch(F.value){case"week":c.value.startTime&&c.value.endTime&&(e=De(c.value.startTime,c.value.endTime).map(p=>Y(p)));break;case"month":c.value.monthTime&&(e=Ce(c.value.monthTime).map(p=>Y(p)));break;case"day":default:c.value.dayTime&&(e=[Y(c.value.dayTime)]);break}return[...t,...e]}),Y=t=>({title:X(t),key:t,width:340,align:"center",render:e=>Z(e.name,t)}),X=t=>{const e=ae(0,new Date),s=new Date(t),p=s.getMonth()+1,M=s.getDate(),o=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][s.getDay()];return m("div",{class:"py-8px",style:"background-color:"+(t==e&&F.value!="day"?"rgba(24, 144, 255,.15)":"")},[`${p}/${M} å‘¨${o}`])},Z=(t,e)=>{let s;const p=ae(0,new Date),o=(v.value[t]||[]).filter(a=>a.daytime===e);if(console.log(o,"dayRecords"),o.length===0)return m("div",{class:"text-gray-400 text-sm"},[E("æ— è®°å½•")]);const T=o.every(a=>a.dailyReport==1),k=o.every(a=>a.status==0),n=o.some(a=>a.status==2||a.status==3);return m("div",{class:"text-left space-y-1 bg py-8px",style:"background-color:"+(e==p&&F.value!="day"?"rgba(24, 144, 255,.15)":"")},[m("div",{class:"flex justify-between px-8px"},[m("div",null,[E("æ‰“å¡çŠ¶æ€ï¼š"),(k==0||k==1)&&m(te,{size:"small",type:k?"success":"error"},{default:()=>[k?"æ­£å¸¸":"å¼‚å¸¸"]}),n&&m(te,{size:"small",type:"info",class:"ml-3px"},{default:()=>[E("è¡Œç¨‹")]})]),m(te,{size:"small",type:T?"success":"error"},{default:()=>[T?"æ—¥æŠ¥å·²æäº¤":"æ—¥æŠ¥æœªæäº¤"]})]),m(ge,{style:"max-height: 250px;",trigger:"none"},Et(s=o.map((a,H)=>m("div",{key:H,class:"tableItem p-1 border-b border-gray-100 last:border-b-0",onClick:()=>g(a,t)},[m("div",{class:"flex justify-between items-center"},[m("div",null,[E("è°ƒè¯•äººï¼š"),m("span",null,[a==null?void 0:a.username])]),m("div",null,[E("å·¥æ—¶ï¼š"),m("span",null,[(a==null?void 0:a.duration)||0,E("å°æ—¶")])])]),m("div",null,[E("é¡¹ç›®åç§°ï¼š "),m("span",null,[(a==null?void 0:a.projectName)||"æš‚æ— é¡¹ç›®"]),E(" ")]),m("div",null,[a.status==2||a.status==3?"å‡ºå‘åœ°å€ï¼š":"ä¸Šç­æ‰“å¡åœ°å€ï¼š",E(" "),m("span",null,[a.nowaddress?a.nowaddress:"æ— "])]),m("div",null,[a.status==2||a.status==3?"å‡ºå‘æ—¶é—´ï¼š":"ä¸Šç­æ‰“å¡æ—¶é—´ï¼š",m("span",null,[a.startTime?a.startTime:"æ— "])]),m("div",null,[a.status==2||a.status==3?"å‡ºå‘æ‰“å¡è¯¯å·®å€¼ï¼š":"ä¸Šç­æ‰“å¡è¯¯å·®å€¼ï¼š",m("span",null,[a.nowdistanse?a.nowdistanse.toFixed(2)+"ç±³":"æ— "])]),m("div",null,[a.status==2||a.status==3?"åˆ°è¾¾åœ°å€ï¼š":"ä¸‹ç­æ‰“å¡åœ°å€ï¼š",m("span",null,[a.nextaddress?a.nextaddress:"æ— "])]),m("div",null,[a.status==2||a.status==3?"åˆ°è¾¾æ—¶é—´ï¼š":"ä¸‹ç­æ‰“å¡æ—¶é—´ï¼š",m("span",null,[a.endTime||"æ— "])]),m("div",null,[a.status==2||a.status==3?"åˆ°è¾¾æ‰“å¡è¯¯å·®å€¼ï¼š":"ä¸‹ç­æ‰“å¡è¯¯å·®å€¼ï¼š",m("span",null,[a.nextdistanse?a.nextdistanse.toFixed(2)+"ç±³":"æ— "])])])))?s:{default:()=>[s]})])},D=j(!1),Q=j(),f=j(),g=async(t,e)=>{f.value=t,Q.value=h.data.find(s=>s.username==e).id,D.value=!0},w=t=>{const e=t.match(/^(\d{4})-(\d{1,2})å‘¨$/);if(!e)return null;const s=Number(e[1]),p=Number(e[2]),M=new Date(s,0,1+(p-1)*7),o=M.getDay(),T=new Date(M);o<=4?T.setDate(M.getDate()-M.getDay()+1):T.setDate(M.getDate()+8-M.getDay());const k=new Date(T);k.setDate(T.getDate()+6);const n=a=>{const H=a.getFullYear(),ye=String(a.getMonth()+1).padStart(2,"0"),he=String(a.getDate()).padStart(2,"0");return`${H}-${ye}-${he}`};return{start:n(T),end:n(k)}},C=t=>{v.value={},F.value=t,u()},x=t=>{u(t),y()},u=t=>{switch(F.value){case"week":if(t){const e=w(t);e&&(c.value.startTime=e.start,c.value.endTime=e.end)}break;case"month":c.value.dates=t||c.value.monthTime;break;case"day":default:c.value.dates=t||c.value.dayTime;break}},y=async()=>{var t;try{const e={};c.value.creater&&(e.creater=c.value.creater),F.value==="week"?(e.startTime=c.value.startTime+" 00:00:00",e.endTime=c.value.endTime+" 23:59:59"):F.value==="month"?e.dates=c.value.monthTime:e.dates=c.value.dayTime;const{data:s,error:p}=await Be(e);if(!p){if(JSON.stringify(s)=="{}")return v.value={},N.value={},(t=window.$message)==null?void 0:t.warning("æ— æ•°æ®");v.value=i(s),N.value=s}}catch(e){console.error("æœç´¢è€ƒå‹¤æŠ¥è¡¨å¤±è´¥:",e)}},{pageData:h,getData:q,nextPage:J}=Ve(Ne),K=async t=>{const e=t.currentTarget,s=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&h.data.length<h.total&&(await J(),await Ie(),setTimeout(()=>{e.scrollTop=s}))},G=j(1),l=async t=>{c.value.creater=t,t||setTimeout(()=>{G.value++},500),y()};ie([F,()=>c.value.dates],()=>{if(F.value=="week"&&c.value.weekTime){const t=w(c.value.weekTime);t&&(c.value.startTime=t.start,c.value.endTime=t.end),y()}else(F.value=="month"&&c.value.monthTime||F.value=="day"&&c.value.dayTime)&&y()},{immediate:!0}),de(()=>{c.value.weekTime=P(),q({usertypes:"2,3"}),y()});const i=t=>{const e={};for(const s in t){const p=new Map;t[s].forEach(k=>{const n=`${k.pid}_${k.ctype}_${k.dbtime}_${k.daytime}_${k.address}`;p.has(n)||p.set(n,k)});const o=Array.from(p.values()).sort((k,n)=>k.daytime===n.daytime?k.dbtime.localeCompare(n.dbtime):k.daytime.localeCompare(n.daytime)),T=[];for(let k=0;k<o.length;k++){const n=o[k],a=o[k+1];if((n.status===0||n.status===1)&&a&&n.ctype===0&&a.ctype===1&&n.daytime===a.daytime){T.push({nowaddress:n.address,nextaddress:a.address,startTime:n.dbtime,endTime:a.dbtime,status:a.status===1||n.status===1?1:a.status,duration:a.duration||0,dailyReport:a.dailyReport,username:n.username,daytime:n.daytime,projectName:n.proname,userImage:n.userimage,ctype:a.ctype,pid:n.pid,nowdistanse:n.distanse,nextdistanse:a.distanse}),k++;continue}if((n.status===2||n.status===3)&&a&&(n.status===2&&a.status===3||n.status===3&&a.status===2)&&n.daytime===a.daytime){T.push({nowaddress:n.address,nextaddress:a.address,startTime:n.dbtime,endTime:a.dbtime,status:n.status,nextStatus:a.status,duration:a.duration||0,dailyReport:a.dailyReport,username:n.username,daytime:n.daytime,projectName:n.proname,userImage:n.userimage,pid:n.pid,ctype:a.ctype,nowdistanse:n.distanse,nextdistanse:a.distanse}),k++;continue}T.push({nowaddress:n.address,startTime:n.ctype===0?n.dbtime:"",endTime:n.ctype===1?n.dbtime:"",duration:n.duration||0,status:n.status,dailyReport:n.dailyReport,username:n.username,daytime:n.daytime,projectName:n.proname,userImage:n.userimage,ctype:n.ctype,pid:n.pid,nowdistanse:n.distanse})}e[s]=T}return e};return(t,e)=>{const s=Oe,p=ze,M=be;return S(),B("div",Dt,[m(A(Ae),{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper h-full"},{header:z(()=>[m(A(je),{align:"center"},{default:z(()=>[e[7]||(e[7]=d("div",{class:"font-semibold"},"è€ƒå‹¤æŠ¥è¡¨",-1)),m(p,{label:"ç”¨æˆ·",path:"creater","label-placement":"left","show-feedback":!1},{default:z(()=>[m(s,{clearable:"",filterable:"",value:c.value.creater,"onUpdate:value":[e[0]||(e[0]=o=>c.value.creater=o),l],placeholder:"è¯·é€‰æ‹©","label-field":"username",size:"small","value-field":"id",options:A(h).data,onScroll:K},null,8,["value","options"])]),_:1}),m(A(re),{value:F.value,"onUpdate:value":[e[1]||(e[1]=o=>F.value=o),C],size:"small"},{default:z(()=>[(S(!0),B(ue,null,ce(b.value,o=>(S(),U(A(se),{key:o.value,value:o.value,label:o.label},null,8,["value","label"]))),128))]),_:1},8,["value"]),F.value==="day"?(S(),U(A(oe),{key:0,size:"small","formatted-value":c.value.dayTime,"onUpdate:formattedValue":[e[2]||(e[2]=o=>c.value.dayTime=o),x],type:"date","value-format":"yyyy-MM-dd",style:{width:"140px"}},null,8,["formatted-value"])):L("",!0),F.value==="week"?(S(),U(A(oe),{key:1,size:"small","formatted-value":c.value.weekTime,"onUpdate:formattedValue":[e[3]||(e[3]=o=>c.value.weekTime=o),x],type:"week",style:{width:"140px"}},null,8,["formatted-value"])):L("",!0),F.value==="month"?(S(),U(A(oe),{key:2,size:"small","formatted-value":c.value.monthTime,"onUpdate:formattedValue":[e[4]||(e[4]=o=>c.value.monthTime=o),x],type:"month","value-format":"yyyy-MM",style:{width:"140px"}},null,8,["formatted-value"])):L("",!0),m(A(ve),{type:"primary",onClick:y,size:"small",class:"w-full sm:w-auto"},{icon:z(()=>[m(M,{class:"text-icon"})]),default:z(()=>[E(" "+O(A(Pe)("common.search")),1)]),_:1}),m(A(re),{size:"small",value:$.value,"onUpdate:value":e[5]||(e[5]=o=>$.value=o),name:"radiobuttongroup1"},{default:z(()=>[m(A(se),{value:"table",label:"è¡¨æ ¼"}),m(A(se),{value:"map",label:"åœ°å›¾"})]),_:1},8,["value"])]),_:1,__:[7]})]),default:z(()=>[m(Ct,{"dialog-visible":D.value,"onUpdate:dialogVisible":e[6]||(e[6]=o=>D.value=o),lookdetail:f.value,creater:Q.value},null,8,["dialog-visible","lookdetail","creater"]),$.value=="table"?(S(),U(A(Se),{key:0,"bottom-bordered":"",bordered:"",columns:V.value,data:W.value,size:"small","flex-height":!A(R).isMobile,"scroll-x":V.value.reduce((o,T)=>o+T.width,0),remote:"","row-key":o=>o.key,class:"h-full",striped:""},null,8,["columns","data","flex-height","scroll-x","row-key"])):(S(),U(et,{trackData:N.value,key:G.value},null,8,["trackData"]))]),_:1})])}}}),Bt=le(St,[["__scopeId","data-v-7ca8847d"]]);export{Bt as default};
