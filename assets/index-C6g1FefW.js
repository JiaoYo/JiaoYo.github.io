import{_ as Zt}from"./round-refresh-BsyOm5rL.js";import{_ as el}from"./round-add-DYiCOkQk.js";import{_ as tl}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CZS90eyC.js";import{_ as ll}from"./round-delete-BUe9s3DM.js";import{_ as sl}from"./round-search-ZJkui7sH.js";import{d as wt,aB as pt,C as K,s as U,A as al,a as tt,aD as nl,az as il,c as P,o as R,w as s,f as l,L as _t,K as rl,a8 as ol,F as j,h as r,G as Ae,aF as bt,g as y,B as b,b as Lt,aG as ul,aH as kt,I as Ft,aI as xt,t as N,$ as z,a9 as Ct,aK as Fe,aM as Be,z as dl,aP as Pe,i as cl,aA as pl,a7 as fl,aE as ml,aQ as Ye,e as yl,N as gl,aS as vl,aW as ft,aX as hl,n as m,aU as mt,aJ as wl,aa as _l,H as O,aT as bl,E as G,aV as Ll}from"./index-CF5MLTcW.js";import{h as kl,i as qe,g as Ze,l as Fl,m as xl,n as Cl,o as Sl,s as Ul,t as $l,N as zl,v as Rl,c as C,q as Tl}from"./maskstr-CaJsvFfT.js";import{u as yt,a as gt}from"./table-CjO67JuQ.js";import{_ as St}from"./Grid-C1MGDjD6.js";import{_ as Ut}from"./FormItemGridItem-zqSggTEs.js";import{h as de}from"./permission-Dr5cSI_l.js";import{u as et}from"./usePageData-Ci1OCWwf.js";import{_ as Il}from"./DatePicker-BSkuVwse.js";import{N as vt}from"./Popconfirm-DN_sr8cS.js";const Dl=["src"],Nl=wt({name:"UpdateSn",__name:"update-sn",props:pt({rowId:{},rowMtype:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:pt(["submitted"],["update:visible"]),setup(X,{emit:ce}){const pe=ce,S=X,a=K(M()),fe=U(100),Y=U(0);function M(){return{id:0,sn:"",fault:"",details:0,accessory:"",returnnum:"",re1:"",re2:"",re3:"",re4:"",re5:"",re6:"",re7:"",rsn:"",rdetails:0,raccessory:"",videoSrc:"",fileList:[],uploadVideoFileList:[],analyzeFileList:[],notes:""}}async function V(){a.videoSrc="",a.fileList=[],a.uploadVideoFileList=[],a.analyzeFileList=[],Object.assign(a,M()),await W()}const{formRef:se,validate:Oe,restoreValidation:Ge}=al(),T={sn:{validator:(n,i)=>{if(!i||i.trim().length===0)return new Error("请输入设备编号");const f=xe(i);for(const h of f){if(!h||h.trim().length===0)return new Error("存在空的设备编号，请检查输入");if(h==="null"||h==="undefined")return new Error("存在无效的设备编号，请检查输入");if(h.length<9)return new Error("设备编号长度至少 9 位")}return!0},trigger:["input","blur"]},fault:{type:"string",required:!0,trigger:["blur","change"],message:"请输入故障现象"},accessory:{type:"string",required:!1,trigger:["blur","change"],message:"请输入客户寄件配件详情"},raccessory:{type:"string",required:!1,trigger:["blur","change"],message:"请输入寄件配件详情"}},Z=tt(()=>{const n={sn:T.sn,fault:T.fault};return S.rowMtype===0?(a.details===1?n.accessory={...T.accessory,required:!0}:n.accessory={...T.accessory,required:!1},a.rdetails===1?n.raccessory={...T.raccessory,required:!0}:n.raccessory={...T.raccessory,required:!1}):S.rowMtype===1?a.details===1?n.accessory={...T.accessory,required:!0}:n.accessory={...T.accessory,required:!1}:S.rowMtype===2?(a.details===1?n.accessory={...T.accessory,required:!0}:n.accessory={...T.accessory,required:!1},a.rdetails===1?n.raccessory={...T.raccessory,required:!0}:n.raccessory={...T.raccessory,required:!1}):S.rowMtype===3&&(a.rdetails===1?n.raccessory={...T.raccessory,required:!0}:n.raccessory={...T.raccessory,required:!1}),n});async function W(){const{data:n,error:i}=await kl({id:S.rowId,_t:new Date().getTime()});i||(Object.assign(a,n),a.rdetails=Number(a.rdetails),n.re1&&a.fileList.push({id:"0",name:"0",url:n.re1,status:"finished"}),n.re2&&a.fileList.push({id:"1",name:"1",url:n.re2,status:"finished"}),n.re3&&a.fileList.push({id:"2",name:"2",url:n.re2,status:"finished"}),n.re4&&(a.videoSrc=n.re4,a.uploadVideoFileList.push({id:"0",name:"0",url:n.re4,status:"finished"})),n.re5&&a.analyzeFileList.push({id:"0",name:"0",url:n.re5,status:"finished"}),n.re6&&a.analyzeFileList.push({id:"1",name:"1",url:n.re6,status:"finished"}),n.re7&&a.analyzeFileList.push({id:"2",name:"2",url:n.re7,status:"finished"}))}const me=tt(()=>{if(!a.sn)return[];let n=a.sn.trim();return n===""?[]:(n=n.replace(/，|、/g,","),n[n.length-1]===","&&(n=n.substring(0,n.length-1)),n.split(",").map(i=>i.trim().replace(/\u3000/g,"").trim()).filter(i=>i!==""))}),ee=nl(X,"visible");il(ee,()=>{ee.value&&(V(),Ge())});function je(n){let i=n.replace(/，/g,",").replace(/、/g,",").replace(/　/g," ");const f=xe(i),h=i[i.length-1];if(f.length>=fe.value&&h===","){Fe(()=>{a.sn=n.substring(0,n.length-1)});return}if(f.length>fe.value){const I=f.slice(0,fe.value).join(", ");Fe(()=>{a.sn=I});return}i!==n&&Fe(()=>{a.sn=i})}function xe(n){return n?(n=n.trim(),n===""?[]:n.split(",").map(i=>i.trim().replace(/\u3000/g,"").trim()).filter(i=>i!=="")):[]}function Ee(n){var I,k,x,g;const i=["image/jpeg","image/png","image/jpg","image/x-icon"];console.log("data.file.file",n.file.file);const f=i.includes(n.file.file.type),h=n.file.file.size/1024/1024<100;return f||((I=window.$message)==null||I.destroyAll(),(k=window.$message)==null||k.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片")),h||((x=window.$message)==null||x.destroyAll(),(g=window.$message)==null||g.error("上传图片大小不能超过 100MB")),f&&h}async function Me(n){var k,x;const{file:i,onFinish:f,onError:h}=n;new FormData().append("multipartFile",i.file);try{const g=await Be(i.file,i.name,"aftermarket/image");g&&(i.url=g,f({...i,url:g}),(k=window.$message)==null||k.destroyAll(),(x=window.$message)==null||x.success("上传成功"))}catch(g){h(g)}}function Ce(n){var I,k,x,g;const f=["video/mp4","video/avi","video/mov","video/mpeg"].includes(n.file.file.type),h=n.file.file.size/1024/1024<100;return f||((I=window.$message)==null||I.destroyAll(),(k=window.$message)==null||k.error("格式错误，请上传视频！")),h||((x=window.$message)==null||x.destroyAll(),(g=window.$message)==null||g.error("上传视频大小不能超过 100MB！")),f&&h}async function Se(n){Y.value=0;const{file:i,onFinish:f,onError:h}=n;new FormData().append("multipartFile",i.file);try{const k=await Be(i.file,i.name,"aftermarket/image/",x=>{Y.value=x});k&&(f({...i,url:k}),a.videoSrc=k,Y.value=0)}catch(k){h(k)}}async function Ve(n){var k,x;const{file:i,onFinish:f,onError:h}=n;new FormData().append("multipartFile",i.file);try{const g=await Be(i.file,i.name,"aftermarket/image");g&&(i.url=g,f({...i,url:g}),(k=window.$message)==null||k.destroyAll(),(x=window.$message)==null||x.success("上传成功"))}catch(g){h(g)}}function Ue(){ee.value=!1}function J(n){return new Promise((i,f)=>{Ve({file:n,onFinish:()=>i(!0),onError:h=>f(h)})})}function ae(n){return new Promise((i,f)=>{Se({file:n,onFinish:()=>i(!0),onError:h=>f(h)})})}async function $e(){var k,x;await Oe();let n=[];await Promise.all([...a.fileList.map(g=>(g.url&&!g.url.startsWith("https://pictures.linkqi.cn")||!g.url)&&J(g)),...a.uploadVideoFileList.map(g=>(g.url&&!g.url.startsWith("https://pictures.linkqi.cn")||!g.url)&&ae(g))]);let i=me.value;for(var f=0;f<i.length;f++)S.rowMtype===0?n.push({id:S.rowId,sn:i[f],details:a.details,accessory:a.accessory,fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null}):S.rowMtype===1?n.push({id:S.rowId,sn:i[f],details:a.details,accessory:a.accessory,fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null}):S.rowMtype===2?n.push({id:S.rowId,sn:i[f],details:a.details,accessory:a.accessory,fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null}):S.rowMtype===3&&n.push({id:S.rowId,sn:i[f],fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null});const{data:h,error:I}=await qe(n);I||((k=window.$message)==null||k.destroyAll(),(x=window.$message)==null||x.success("修改成功"),Ue(),pe("submitted"))}return(n,i)=>{const f=Ut,h=bt,I=ul,k=xt,x=Ft,g=kt,ye=St,ne=ol,ze=_t,ge=Ct;return R(),P(ge,{show:ee.value,"onUpdate:show":i[6]||(i[6]=D=>ee.value=D),title:"修改",preset:"card",class:"w-60%"},{footer:s(()=>[l(x,{justify:"end",size:16,class:"pr-20px"},{default:s(()=>[l(r(b),{onClick:Ue},{default:s(()=>[y(N(r(z)("common.cancel")),1)]),_:1}),l(r(b),{type:"primary",onClick:$e},{default:s(()=>[y(N(r(z)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(ze,{ref_key:"formRef",ref:se,model:a,rules:Z.value,"label-placement":"left","label-width":140,onKeyup:rl($e,["enter"])},{default:s(()=>[l(ne,{style:{"max-height":"600px"},class:"pr-20px"},{default:s(()=>[l(ye,{responsive:"screen","item-responsive":""},{default:s(()=>[l(f,{span:"24 m:24 s:24",label:"设备编号",path:"sn"},{default:s(()=>[l(r(Ae),{clearable:"",value:a.sn,"onUpdate:value":i[0]||(i[0]=D=>a.sn=D),placeholder:"请输入设备编号",disabled:"",onInput:je},null,8,["value"])]),_:1}),l(f,{span:"24 m:24 s:24",label:"故障现象",path:"fault"},{default:s(()=>[l(r(Ae),{type:"textarea",value:a.fault,"onUpdate:value":i[1]||(i[1]=D=>a.fault=D),placeholder:"请输入故障现象",clearable:""},null,8,["value"])]),_:1}),l(f,{span:"24 m:24 s:24",label:"现场照片"},{default:s(()=>[l(h,{multiple:"",max:3,"file-list":a.fileList,"onUpdate:fileList":i[2]||(i[2]=D=>a.fileList=D),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ee,"custom-request":Me},{default:s(()=>i[7]||(i[7]=[y(" 点击上传 ")])),_:1,__:[7]},8,["file-list"])]),_:1}),l(f,{span:"24 m:24 s:24",label:"现场视频"},{default:s(()=>[l(h,{"show-file-list":!a.videoSrc,"file-list":a.uploadVideoFileList,"onUpdate:fileList":i[3]||(i[3]=D=>a.uploadVideoFileList=D),"default-upload":!1,onBeforeUpload:Ce,"custom-request":Se},{default:s(()=>[l(r(b),{type:"primary"},{default:s(()=>i[8]||(i[8]=[y(" 上传视频 ")])),_:1,__:[8]})]),_:1},8,["show-file-list","file-list"])]),_:1}),l(f,{span:"24 m:24 s:24",label:"","label-width":"0"},{default:s(()=>[Y.value&&!a.videoSrc?(R(),P(I,{key:0,type:"line",percentage:Y.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):j("",!0),a.videoSrc?(R(),Lt("video",{key:1,src:a.videoSrc,autoplay:"",style:{width:"100%"}},null,8,Dl)):j("",!0)]),_:1}),S.rowMtype!==3?(R(),P(f,{key:0,span:"24 m:24 s:24",label:"客户寄件类型"},{default:s(()=>[l(g,{value:a.details,"onUpdate:value":i[4]||(i[4]=D=>a.details=D),name:"radiogroup"},{default:s(()=>[l(x,null,{default:s(()=>[l(k,{value:0},{default:s(()=>i[9]||(i[9]=[y("仅裸机")])),_:1,__:[9]}),l(k,{value:1},{default:s(()=>i[10]||(i[10]=[y("含配件")])),_:1,__:[10]})]),_:1})]),_:1},8,["value"])]),_:1})):j("",!0),a.details==1&&S.rowMtype!==3?(R(),P(f,{key:1,span:"24 m:24 s:24",label:"客户寄件配件详情",path:"accessory"},{default:s(()=>[l(r(Ae),{value:a.accessory,"onUpdate:value":i[5]||(i[5]=D=>a.accessory=D),placeholder:"请输入客户寄件配件详情",clearable:""},null,8,["value"])]),_:1})):j("",!0)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show"])}}}),Pl={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ht(X){return typeof X=="function"||Object.prototype.toString.call(X)==="[object Object]"&&!Ll(X)}const Xl=wt({name:"aftersales_aftersalesdevice",__name:"index",setup(X){const ce=dl(),pe=U(!1),S=U(0),a=U([]),fe=K([{label:"已受理",value:0},{label:"分析中",value:1},{label:"维修中",value:2},{label:"维修完成",value:3},{label:"待客户收件",value:4},{label:"处理完毕",value:5}]),Y={当日:()=>{const e=new Date().getTime();return[e,e]},本周:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*7,e]},上月:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*30,e]},近一年:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*365,e]},近三年:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*365*3,e]}},M=U([]),{pageData:V,getData:se,nextPage:Oe}=et(Sl),Ge=async e=>{const t=e.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&V.data.length<V.total&&(await Oe(),M.value=V.data,await Fe(),setTimeout(()=>{t.scrollTop=c}))},T=async()=>{await se({page:1,limit:100,_t:new Date().getTime()}),M.value=V.data};et(hl);const Z=U([]),{pageData:W,getData:me,nextPage:ee}=et(Ul),je=async()=>{await me(),Z.value=W.data.map(e=>({label:e,value:e}))},xe=async e=>{const t=e.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&W.data.length<W.total&&(await ee(),await Fe(),Z.value=W.data.map(w=>({label:w,value:w})),setTimeout(()=>{t.scrollTop=c}))},Ee=Pe.debounce(async e=>{await me({fuzzy:e,page:1}),Z.value=W.data.map(t=>({label:t,value:t}))},300),Me=e=>{if(L.gws=null,J.value=!0,ae.value=!1,!e){Ce();return}Ee(e)},Ce=()=>{L.gws=null,$()},Se=Pe.debounce(e=>{var t;L.gws1=e||void 0,L.gws=(t=L.gws1)==null?void 0:t.join(","),$()},300),Ve=async()=>{J.value&&!ae.value&&(await me({page:1}),Z.value=W.data.map(e=>({label:e,value:e})),J.value=!1)},Ue=Pe.debounce(async e=>{await se({fuzzy:e,page:1}),M.value=V.data},300),J=U(!1),ae=U(!1),$e=e=>{if(L.cid=null,J.value=!0,ae.value=!1,!e){i();return}Ue(e)},n=async()=>{J.value&&!ae.value&&(await se({page:1}),M.value=V.data,J.value=!1)},i=async()=>{await se({page:1}),M.value=V.data};async function f(e,t){if(!e){L.startTime=void 0,L.endTime=void 0,$();return}L.startTime=String(ft(1,t[0])),L.endTime=String(ft(1,t[1])),$()}const h=async e=>{L.cid=e,$()},I=()=>{L.sn=null,$()},k=Pe.debounce(e=>{L.sn=e||void 0,$()},300),x=()=>{L.status=null,$()},g=e=>{L.status=e,$()};cl(async()=>{await T(),await $(),await je()});const ye=U(!1),ne=K({id:0,mtype:0}),{columns:ze,columnChecks:ge,data:D,getData:$,loading:$t,mobilePagination:zt,searchParams:L}=yt({showTotal:!0,immediate:!1,apiFn:$l,apiParams:{page:1,pageSize:20,limit:20,cid:null,gws:void 0,gws1:[],sn:null,status:null,uid:null,dbtime:null,startAndTimeRange:null,startTime:null,endTime:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"comp",title:"客户公司名称",align:"center",width:220,ellipsis:{tooltip:!0}},{key:"sn",title:"客户设备信息",width:240,titleAlign:"center",ellipsis:{tooltip:!0},render:e=>l("div",{class:"flex flex-col items-start justify-start gap-1"},[l("div",{class:"w-full truncate",title:`设备编号：${e.sn}`},[y("设备编号："),e.sn?e.rsn?e.rsn==e.sn||e.rsn.includes("无")?e.sn:l("span",null,[e.sn,y(" ("),l("span",{style:"color: red; font-weight: bold;"},[y("更换")]),y(")")]):e.sn:"--"]),l("div",{class:"w-full truncate",title:`设备型号：${e.model||"--"}`},[y("设备型号："),e.model||"--"])])},{key:"fault",title:"故障现象",align:"center",width:220,ellipsis:{tooltip:!0}},{key:"re1",title:"现场照片",align:"center",width:300,render:e=>l("div",{class:"flex items-center justify-center gap-4px"},[e.re1||e.re2||e.re3?l("div",{style:{cursor:"pointer"},onClick:()=>at([e.re1,e.re2,e.re3].filter(t=>t),0)},[l(mt,{width:70,src:e.re1||e.re2||e.re3,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)]):null])},{key:"re4",title:"现场视频",align:"center",width:300,render:e=>l("div",{class:"flex items-center justify-center gap-4px"},[e.re4?l("video",{src:e.re4,style:{height:"70px",width:"100%",cursor:"pointer",objectFit:"cover"},onClick:()=>Dt(e.re4)},null):null])},{key:"status",align:"center",width:120,title:()=>m("div",{class:"flex flex-col items-center justify-center"},[m("span","当前状态"),m("span",{style:"font-size: 11px; color: #FF0000; margin-top: 2px;"},"悬浮查看详情")]),render:e=>{const t=()=>{const{status:c}=e;return e.mtype===0?[m(C,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),m(C,{type:c>=1?"success":"default",time:e.redbtime},{default:()=>["分析中",e.receipt&&m("span",{style:{marginLeft:"5px"}},["(寄出单号: ",m("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.receipt)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.receipt),")"])]}),m(C,{type:c>=2?"success":"default"},{default:()=>"维修中"}),m(C,{type:c>=3?"success":"default"},{default:()=>"维修完成"}),m(C,{type:c>=4?"success":"default"},{default:()=>"待客户收件"}),m(C,{type:c>=5?"success":"default",time:e.rdbtime},{default:()=>["处理完毕",e.returnnum&&m("span",{style:{marginLeft:"5px"}},["(寄出单号: ",m("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.returnnum)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.returnnum),")"])]})]:e.mtype===1?[m(C,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),m(C,{type:c>=1?"success":"default",time:e.return_time||e.complete_time},{default:()=>"处理完毕"})]:e.mtype===2?[m(C,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),m(C,{type:c>=1?"success":"default"},{default:()=>"待客户收件"}),m(C,{type:c>=2?"success":"default"},{default:()=>"待我司收件"}),m(C,{type:c>=3?"success":"default",time:e.return_time||e.complete_time},{default:()=>"处理完毕"})]:e.mtype===3?[m(C,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),m(C,{type:c>=1?"success":"default"},{default:()=>"待客户收件"}),m(C,{type:c>=2?"success":"default",time:e.return_time||e.complete_time},{default:()=>"处理完毕"})]:[m(C,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),m(C,{type:c>=1?"success":"default",time:e.redbtime},{default:()=>["分析中",e.receipt&&m("span",{style:{marginLeft:"5px"}},["(寄出单号: ",m("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.receipt)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.receipt),")"])]}),m(C,{type:c>=2?"success":"default"},{default:()=>"维修中"}),m(C,{type:c>=3?"success":"default"},{default:()=>"维修完成"}),m(C,{type:c>=4?"success":"default"},{default:()=>"待客户收件"}),m(C,{type:c>=5?"success":"default",time:e.rdbtime},{default:()=>["处理完毕",e.returnnum&&m("span",{style:{marginLeft:"5px"}},["(寄出单号: ",m("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.returnnum)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.returnnum),")"])]})]};return m(_l,{placement:"top",style:{maxWidth:"450px"}},{trigger:()=>m(wl,{type:"primary",style:{cursor:"pointer"}},{default:()=>ot(e.mtype,e.status)}),default:()=>m("div",{class:"custom-timeline",style:{padding:"12px"}},[m("p",{style:{marginBottom:"12px",fontWeight:"bold"}},[m("strong",null,"当前状态："),ot(e.mtype,e.status)]),m(zl,null,{default:()=>t()})])})}},{key:"returnnum",title:"物流信息",align:"center",width:220,titleAlign:"center",ellipsis:{tooltip:!0},render:e=>l("div",{class:"flex flex-col items-start justify-start gap-1"},[e.returnnum&&e.mtype!==1&&l("div",{class:"flex items-center gap-4px"},[Rl(e.returnnum)?l("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.returnnum)}`,target:"_blank",style:"color: #4169E1;"},[e.returnnum||"--"]):l("span",null,[e.returnnum||"--"]),l(bl,{trigger:"hover",placement:"right"},{trigger:()=>O(l(b,{text:!0,type:"primary",onClick:()=>nt(e.id,e,"returnnum")},{default:()=>[l("span",{class:"akar-icons--edit"},null)]}),[[G("no-auth"),"aftermarket:update:permission.do"]]),default:()=>z("common.update")})]),e.returnnum&&l("div",null,[`时间：${e.rdbtime?e.rdbtime:""}`]),e.returnnum&&l("div",null,[`寄件类型：${e.rdetails==0?"仅裸机":e.raccessory?"含配件("+e.raccessory+")":"未知"}`]),!e.returnnum&&O(l(b,{text:!0,type:"primary",onClick:()=>nt(e.id,null,"returnnum")},{default:()=>["填写"]}),[[G("no-auth"),"aftermarket:update:permission.do"]])])},{key:"re8",title:"分析照片",align:"center",width:300,render:e=>l("div",{class:"flex items-center justify-center gap-4px"},[e.re5||e.re6||e.re7?l("div",{style:{cursor:"pointer"},onClick:()=>at([e.re5||e.re6||e.re7].filter(t=>t),0)},[l(mt,{width:70,src:e.re5||e.re6||e.re7,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)]):null,l("div",null,[!e.re5&&!e.re6&&!e.re7&&O(l(b,{size:"small",type:"primary",onClick:()=>it(e,"analyze")},{default:()=>[y("点击上传")]}),[[G("no-auth"),"aftermarket:update:permission.do"]]),(e.re5||e.re6||e.re7)&&O(l(b,{size:"small",type:"primary",onClick:()=>it(e,"analyze"),style:{marginLeft:"5px"}},{default:()=>[y("编辑图片")]}),[[G("no-auth"),"aftermarket:update:permission.do"]])])])},{key:"rsn",title:"设备信息",width:200,titleAlign:"center",ellipsis:{tooltip:!0},render:e=>l("div",{class:"flex flex-col items-start justify-start gap-1"},[l("div",{class:"w-full truncate",title:`设备编号：${e.rsn||"--"}`},[y("设备编号："),e.rsn||"--"]),l("div",{class:"w-full truncate",title:`设备型号：${e.rmodel||"--"}`},[y("设备型号："),e.rmodel||"--"])])},{key:"notes",title:"备注",align:"center",width:180,ellipsis:{tooltip:!0},render:e=>l("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[e.notes?l("div",{class:"w-full truncate",title:`${e.notes}`},[e.notes]):O(l(b,{text:!0,type:"primary",size:"small",onClick:()=>rt(e.id,"","sn")},{default:()=>[y("填写")]}),[[G("no-auth"),"aftermarket:update:permission.do"]])])},{key:"duration",title:"处理时长",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"ckdbtime",title:"审核时间",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"responsibleperson",title:"售后处理",align:"center",width:160,render:e=>l("div",{class:"flex-center gap-8px"},[O(l(b,{type:"primary",ghost:!0,size:"small",onClick:()=>Mt(e,"option")},{default:()=>["查看"+(e.rescount>0?"("+e.rescount+")":"")]}),[[G("no-auth"),"aftermarketRes:select:permission.do"]]),O(l(b,{type:"primary",ghost:!0,size:"small",onClick:()=>Je(e,"add")},{default:()=>["添加"]}),[[G("no-auth"),"aftermarketRes:insert:permission.do"]])])},{key:"operate",title:z("common.operate"),align:"center",width:220,fixed:"right",render:e=>l("div",{class:"flex-center gap-8px"},[O(l(b,{type:"primary",ghost:!0,size:"small",onClick:()=>rt(e.id,e.notes,"sn")},{default:()=>["修改备注"]}),[[G("no-auth"),"aftermarket:update:permission.do"]]),O(l(b,{type:"primary",ghost:!0,size:"small",onClick:()=>Ht(e.id,e.mtype)},{default:()=>["修改"]}),[[G("no-auth"),"aftermarket:update:permission.do"]]),l(vt,{onPositiveClick:()=>ut(e.id)},{default:()=>z("common.confirmDelete"),trigger:()=>{let t;return O(l(b,{type:"error",ghost:!0,size:"small"},ht(t=z("common.delete"))?t:{default:()=>[t]}),[[G("no-auth"),"aftermarket:delete:permission.do"]])}})])}]}),{checkedRowKeys:ie}=gt(D,$),{columns:Rt,data:lt,getData:te,loading:Tt,mobilePagination:Re,searchParams:ve}=yt({showTotal:!0,immediate:!1,apiFn:Tl,apiParams:{page:1,pageSize:20,limit:20,aid:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"username",title:"责任人",width:200,align:"center",ellipsis:{tooltip:!0}},{key:"reason",title:"原因分析",align:"center",width:300,ellipsis:{tooltip:!0}},{key:"resolution",title:"处理意见",align:"center",width:300,ellipsis:{tooltip:!0}},{key:"improvement",title:"改进措施",align:"center",width:300,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:160},{key:"operate",title:z("common.operate"),align:"center",width:160,fixed:"right",render:e=>l("div",{class:"flex-center gap-8px"},[O(l(b,{type:"primary",ghost:!0,size:"small",onClick:()=>Je(e,"edit")},{default:()=>["修改"]}),[[G("no-auth"),"aftermarketRes:update:permission.do"]]),l(vt,{onPositiveClick:()=>dt(e.id)},{default:()=>z("common.confirmDelete"),trigger:()=>{let t;return O(l(b,{type:"error",ghost:!0,size:"small"},ht(t=z("common.delete"))?t:{default:()=>[t]}),[[G("no-auth"),"aftermarketRes:delete:permission.do"]])}})])}]}),{checkedRowKeys:he}=gt(lt,te),st=U(null),re=U(!1),u=K({id:0,type:"",returnOrder:"",returnOrderType:1,rsn:"",rdetails:0,raccessory:""}),we={rsn:{required:!1,trigger:["blur","change"],message:"请输入寄出设备编号"},raccessory:{required:!1,trigger:["blur","change"],message:""}},It=tt(()=>{const e={};return u.type==="receipt"&&(e.returnOrder={...we.rsn,message:u.type==="receipt"?"请输入客户寄出信息":"请输入寄出信息"}),u.type==="returnnum"?e.rsn=[{...we.rsn,required:!0},{min:9,trigger:["blur","change"],message:"寄出设备编号长度至少 9 位"}]:e.raccessory={...we.raccessory,required:!1},u.rdetails===1?e.raccessory={...we.raccessory,required:!0,message:u.type==="returnnum"?"请输出寄出配件详情":"请输入寄件配件详情"}:e.raccessory={...we.raccessory,required:!1,message:u.type==="returnnum"?"请输出寄出配件详情":"请输入寄件配件详情"},e});function Dt(e){window.open(e,"_blank")}const at=(e,t=0)=>{a.value=e,S.value=t,pe.value=!0},Nt=e=>{S.value=e};function nt(e,t,c){u.type=c,u.returnOrder=t?t.returnnum:"",u.returnOrderType=t&&t.returnnum.includes("无")?2:1,u.id=e,u.rsn=t&&t.hasOwnProperty("rsn")?t.rsn:"",u.rdetails=t&&t.hasOwnProperty("rdetails")?Number(t.rdetails):0,u.raccessory=t&&t.hasOwnProperty("raccessory")?t.raccessory:"",re.value=!0}function Pt(){re.value=!1,u.id=0,u.type="",u.returnOrder="",u.returnOrderType=1,u.rsn="",u.rdetails=0,u.raccessory=""}async function At(){var t,c,w,v;await st.value.validate();let e=u.type=="receipt"?u.rdetails===0?[{id:u.id,receipt:u.returnOrder,details:u.rdetails}]:[{id:u.id,receipt:u.returnOrder,details:u.rdetails,accessory:u.raccessory}]:u.rdetails===0?[{id:u.id,returnnum:u.returnOrder,rsn:u.rsn,rdetails:u.rdetails}]:[{id:u.id,returnnum:u.returnOrder,rsn:u.rsn,rdetails:u.rdetails,raccessory:u.raccessory}];if(u.type=="receipt"){const{data:F,error:_}=await Ze(e);_||((t=window.$message)==null||t.destroyAll(),(c=window.$message)==null||c.success(F.msg||"操作成功"),re.value=!1,u.type="",u.returnOrder="",u.id=0)}else{const{data:F,error:_}=await qe(e);_||((w=window.$message)==null||w.destroyAll(),(v=window.$message)==null||v.success(F.msg||"操作成功"),$(),re.value=!1,u.type="",u.returnOrder="",u.id=0)}}const oe=U(!1),o=K({id:0,type:"",sendFileList:[],receiveFileList:[],analyzeFileList:[]}),Te=U(!1),B=K({id:0,type:"",notes:""}),Bt=U(!1),He=K({id:[],type:"",password:""}),Ie=U(!1),le=U(!1),p=K({id:0,uid:0,aid:0,type:"add",username:"",sn:"",reason:"",resolution:"",improvement:""}),qt=U(""),_e=U(!1),De=K({aid:null,uid:null,sn:""});function it(e,t){o.sendFileList=[],o.receiveFileList=[],o.analyzeFileList=[],o.id=e.id,o.type=t,e.re5&&o.analyzeFileList.push({id:"0",name:"0",url:e.re5,status:"finished"}),e.re6&&o.analyzeFileList.push({id:"1",name:"1",url:e.re6,status:"finished"}),e.re7&&o.analyzeFileList.push({id:"2",name:"2",url:e.re7,status:"finished"}),oe.value=!0}function Ke(e){var v,F,_,E;const t=["image/jpeg","image/png","image/jpg","image/x-icon"];console.log("data.file.file",e.file.file);const c=t.includes(e.file.file.type),w=e.file.file.size/1024/1024<100;return c||((v=window.$message)==null||v.destroyAll(),(F=window.$message)==null||F.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片")),w||((_=window.$message)==null||_.destroyAll(),(E=window.$message)==null||E.error("上传图片大小不能超过 100MB")),c&&w}async function Ne(e){var v,F;const{file:t,onFinish:c,onError:w}=e;if(!t.file)return c({...t});try{const _=await Be(t.file,t.name,"aftermarket/image");_&&(t.url=_,c({...t,url:_}),(v=window.$message)==null||v.destroyAll(),(F=window.$message)==null||F.success("上传成功"))}catch(_){w(_)}}function Ot(){oe.value=!1,o.sendFileList=[],o.receiveFileList=[],o.analyzeFileList=[]}function Gt(e){return new Promise((t,c)=>{Ne({file:e,onFinish:()=>t(!0),onError:w=>c(w)})})}async function jt(){var v,F,_,E,q,be,Q,Le;let e=[{id:o.id}];const t=o.type==="customer"?o.sendFileList:o.type==="company"?o.receiveFileList:o.analyzeFileList;if(await Promise.all([...t.map(A=>Gt(A))]),t.some(A=>A.url&&A.url.startsWith("blob:"))){(v=window.$message)==null||v.destroyAll(),(F=window.$message)==null||F.warning("还有文件正在上传或上传失败，请稍后提交");return}if(t.some(A=>!A.url||A.url.trim()==="")){(_=window.$message)==null||_.destroyAll(),(E=window.$message)==null||E.warning("存在上传失败的文件，请重新上传");return}if(o.type==="customer"?(o.sendFileList.length==0&&(e[0].re1="",e[0].re2="",e[0].re3=""),o.sendFileList.length==1&&(e[0].re1=o.sendFileList[0].url,e[0].re2="",e[0].re3=""),o.sendFileList.length==2&&(e[0].re1=o.sendFileList[0].url,e[0].re2=o.sendFileList[1].url,e[0].re3=""),o.sendFileList.length==3&&(e[0].re1=o.sendFileList[0].url,e[0].re2=o.sendFileList[1].url,e[0].re3=o.sendFileList[2].url)):o.type==="company"?(o.receiveFileList.length==0&&(e[0].re4="",e[0].re5="",e[0].re6=""),o.receiveFileList.length==1&&(e[0].re4=o.receiveFileList[0].url,e[0].re5="",e[0].re6=""),o.receiveFileList.length==2&&(e[0].re4=o.receiveFileList[0].url,e[0].re5=o.receiveFileList[1].url,e[0].re6=""),o.receiveFileList.length==3&&(e[0].re4=o.receiveFileList[0].url,e[0].re5=o.receiveFileList[1].url,e[0].re6=o.receiveFileList[2].url)):(o.analyzeFileList.length==0&&(e[0].re5="",e[0].re6="",e[0].re7=""),o.analyzeFileList.length==1&&(e[0].re5=o.analyzeFileList[0].url,e[0].re6="",e[0].re7=""),o.analyzeFileList.length==2&&(e[0].re5=o.analyzeFileList[0].url,e[0].re6=o.analyzeFileList[1].url,e[0].re7=""),o.analyzeFileList.length==3&&(e[0].re5=o.analyzeFileList[0].url,e[0].re6=o.analyzeFileList[1].url,e[0].re7=o.analyzeFileList[2].url)),o.type==="customer"||o.type==="company"){const{data:A,error:ue}=await Ze(e);ue||((q=window.$message)==null||q.destroyAll(),(be=window.$message)==null||be.success(A.msg||"操作成功"),oe.value=!1,o.id=0,o.sendFileList=[],o.receiveFileList=[])}else{const{data:A,error:ue}=await qe(e);ue||((Q=window.$message)==null||Q.destroyAll(),(Le=window.$message)==null||Le.success(A.msg||"操作成功"),$(),oe.value=!1,o.id=0,o.analyzeFileList=[])}}function rt(e,t,c){B.id=e,B.notes=t,B.type=c,Te.value=!0}function We(){Te.value=!1,B.id=0,B.notes="",B.type=""}async function Et(){var w,v;if(!B.notes){(w=window.$message)==null||w.destroyAll(),(v=window.$message)==null||v.error("请输入备注");return}const{id:e,notes:t,type:c}=B;if(c==="comp"){const{data:F,error:_}=await Ze([{id:e,notes:t}]);_||We()}else{const{data:F,error:_}=await qe([{id:e,notes:t}]);_||(We(),$())}}const ot=(e,t)=>e===0?t===0?"已受理":t===1?"分析中":t===2?"维修中":t===3?" 维修完成":t===4?"待客户收件":t===5?"处理完毕":"未知":e===1?t===0?"已受理":t===5?"处理完毕":"未知":e===2?t===0?"已受理":t===1?"待客户收件":t===2?"待我司收件":t===5?"处理完毕":"未知":e===3?t===0?"已受理":t===1?"待客户收件":t===5?"处理完毕":"未知":t===0?"已受理":t===1?"分析中":t===2?"维修中":t===3?"维修完成":t===4?"待客户收件":t===5?"处理完毕":"未知";function ut(e){He.id=e?[e]:ie.value,He.type="deleteSn",He.password="",Bt.value=!0}function Mt(e,t){qt.value=t,De.aid=e.id,De.uid="",_e.value=!0,ve.page=1,ve.aid=e.id,te()}function Je(e,t){console.log("row",e),le.value=!1,p.type=t,t==="edit"?(p.uid=e.uid,p.username=e.username,p.aid=e.aid,p.id=e.id,p.reason=e.reason,p.resolution=e.resolution,p.improvement=e.improvement):(p.uid=Number(ce.userInfo.id),p.username=ce.userInfo.username,p.aid=e.id,p.id=0,p.reason="",p.resolution="",p.improvement=""),Ie.value=!0}function Qe(){Ie.value=!1,le.value=!1,p.id=0,p.username="",p.reason="",p.resolution="",p.improvement=""}async function Vt(){var t,c,w,v;let e=[{aid:p.aid,uid:ce.userInfo.id,reason:p.reason,resolution:p.resolution,improvement:p.improvement}];if(le.value=!0,p.id){e[0].id=p.id;const{data:F,error:_}=await Fl(e);_?le.value=!1:(le.value=!1,(t=window.$message)==null||t.destroyAll(),(c=window.$message)==null||c.success(F.msg||"操作成功"),Qe(),_e.value&&(Re.value.page=1,ve.aid=p.aid,te()),$())}else{const{data:F,error:_}=await xl(e);_?le.value=!1:(le.value=!1,(w=window.$message)==null||w.destroyAll(),(v=window.$message)==null||v.success(F.msg||"操作成功"),Qe(),_e.value&&(Re.value.page=1,ve.aid=p.aid,te()),$())}}async function dt(e){var v,F,_,E;let t={};if(e)t.arrIds=[e];else{if(he.value.length===0)return(v=window.$message)==null||v.destroyAll(),(F=window.$message)==null||F.error("请选择要删除的数据"),!1;t.arrIds=he.value}const{data:c,error:w}=await Cl(t.arrIds);if(!w)(_=window.$message)==null||_.destroyAll(),(E=window.$message)==null||E.success(c.msg||"操作成功"),Re.value.page=1,ve.aid=p.aid,te(),$();else return!1}const Ht=(e,t)=>{ne.id=e,ne.mtype=t,ye.value=!0},Kt=U(window.innerHeight-420);return(e,t)=>{const c=pl,w=Ut,v=Ae,F=Il,_=sl,E=ll,q=Ft,be=St,Q=_t,Le=fl,A=tl,ue=ml,H=gl,ct=xt,Wt=kt,ke=Ct,Xe=bt,Jt=el,Qt=Zt,Xt=vl;return R(),Lt("div",Pl,[l(Le,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[l(Q,{ref:"formRef",model:r(L),"label-placement":"left","label-width":100,"show-feedback":!1},{default:s(()=>[l(be,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[l(w,{span:"24 s:12 m:6",label:"客户公司",path:"status"},{default:s(()=>[l(c,{filterable:"",clearable:"",value:r(L).cid,"onUpdate:value":[t[0]||(t[0]=d=>r(L).cid=d),h],placeholder:"请选择客户公司","label-field":"comp","value-field":"id",onClear:i,onSearch:$e,onBlur:n,options:M.value,onScroll:Ge},null,8,["value","options"])]),_:1}),l(w,{span:"24 s:12 m:6",label:"设备编号",path:"sn"},{default:s(()=>[l(v,{clearable:"",value:r(L).sn,"onUpdate:value":[t[1]||(t[1]=d=>r(L).sn=d),r(k)],onClear:I,placeholder:"请输入设备编号"},null,8,["value","onUpdate:value"])]),_:1}),l(w,{span:"24 s:12 m:6",label:"网关型号",path:"gws1"},{default:s(()=>[l(c,{clearable:"",filterable:"",multiple:"",value:r(L).gws1,"onUpdate:value":[t[2]||(t[2]=d=>r(L).gws1=d),r(Se)],placeholder:"请选择网关型号","label-field":"label","value-field":"value",options:Z.value,onSearch:Me,onBlur:Ve,onScroll:xe,onClear:Ce},null,8,["value","options","onUpdate:value"])]),_:1}),l(w,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:s(()=>[l(c,{clearable:"",filterable:"",value:r(L).status,"onUpdate:value":[t[3]||(t[3]=d=>r(L).status=d),g],placeholder:"请选择状态","label-field":"label","value-field":"value",options:fe,onClear:x},null,8,["value","options"])]),_:1}),l(w,{span:"24 s:12 m:8",label:"起止时间"},{default:s(()=>[l(F,{value:r(L).startAndTimeRange,"onUpdate:value":t[4]||(t[4]=d=>r(L).startAndTimeRange=d),type:"datetimerange",clearable:"",shortcuts:Y,"onUpdate:formattedValue":f},null,8,["value"])]),_:1}),l(w,{span:"24 s:12 m:5"},{default:s(()=>[l(q,{class:"w-full"},{default:s(()=>[r(de)("aftermarket:select:permission.do")?(R(),P(r(b),{key:0,ghost:"",onClick:r($)},{icon:s(()=>[l(_,{class:"text-icon"})]),default:s(()=>[t[30]||(t[30]=y(" "+N("查询")))]),_:1,__:[30]},8,["onClick"])):j("",!0),r(de)("aftermarket:delete:permission.do")?(R(),P(r(b),{key:1,type:"error",disabled:r(ie).length===0,onClick:ut},{icon:s(()=>[l(E,{class:"text-icon"})]),default:s(()=>[t[31]||(t[31]=y(" "+N("批量删除")))]),_:1,__:[31]},8,["disabled"])):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(Le,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:s(()=>[l(q,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:s(()=>t[32]||(t[32]=[yl("div",null,"售后设备",-1)])),_:1,__:[32]})]),"header-extra":s(()=>[l(q,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[l(A,{columns:r(ge),"onUpdate:columns":t[5]||(t[5]=d=>Ye(ge)?ge.value=d:null),ctype:4},null,8,["columns"])]),_:1})]),default:s(()=>[l(ue,{"checked-row-keys":r(ie),"onUpdate:checkedRowKeys":t[6]||(t[6]=d=>Ye(ie)?ie.value=d:null),columns:r(ze),data:r(D),size:"small",loading:r($t),remote:"","max-height":Kt.value,"scroll-x":r(ze).reduce((d,Yt)=>d+(Yt.width||100),0),"row-key":d=>d.id,pagination:r(zt),class:"sm:h-full",striped:""},null,8,["checked-row-keys","columns","data","loading","max-height","scroll-x","row-key","pagination"])]),_:1}),l(ke,{show:re.value,"onUpdate:show":t[11]||(t[11]=d=>re.value=d),title:u.type==="receipt"?"填写客户寄出信息":"填写寄出信息",preset:"card",class:"w-800px"},{footer:s(()=>[l(q,{justify:"end"},{default:s(()=>[l(r(b),{size:"small",class:"mt-16px",onClick:Pt},{default:s(()=>[y(N(r(z)("common.cancel")),1)]),_:1}),l(r(b),{type:"primary",size:"small",class:"mt-16px",onClick:At},{default:s(()=>[y(N(r(z)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(Q,{ref_key:"returnOrderFormRef",ref:st,rules:It.value,model:u,"label-placement":"left"},{default:s(()=>[l(H,{label:u.type==="receipt"?"客户寄出信息":"寄出信息",path:"returnOrder",required:""},{default:s(()=>[l(v,{value:u.returnOrder,"onUpdate:value":t[7]||(t[7]=d=>u.returnOrder=d),placeholder:u.type==="receipt"?"请输入客户寄出信息":"请输入寄出信息",clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),u.type==="returnnum"?(R(),P(H,{key:0,label:"寄出设备编号",path:"rsn"},{default:s(()=>[l(v,{value:u.rsn,"onUpdate:value":t[8]||(t[8]=d=>u.rsn=d),placeholder:"请输入寄出设备编号",clearable:""},null,8,["value"])]),_:1})):j("",!0),l(H,{label:(u.type==="returnnum","寄件类型"),path:"rdetails"},{default:s(()=>[l(Wt,{value:u.rdetails,"onUpdate:value":t[9]||(t[9]=d=>u.rdetails=d)},{default:s(()=>[l(q,null,{default:s(()=>[l(ct,{value:0},{default:s(()=>t[33]||(t[33]=[y("仅裸机")])),_:1,__:[33]}),l(ct,{value:1},{default:s(()=>t[34]||(t[34]=[y("含配件")])),_:1,__:[34]})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),u.rdetails===1?(R(),P(H,{key:1,required:"",label:u.type==="returnnum"?"寄出配件详情":"寄件配件详情",path:"raccessory"},{default:s(()=>[l(v,{value:u.raccessory,"onUpdate:value":t[10]||(t[10]=d=>u.raccessory=d),placeholder:u.type==="returnnum"?"请输出寄出配件详情":"请输入寄件配件详情",clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])):j("",!0)]),_:1},8,["rules","model"])]),_:1},8,["show","title"]),l(ke,{show:oe.value,"onUpdate:show":t[15]||(t[15]=d=>oe.value=d),title:o.type==="customer"?"客户寄出照片上传":o.type==="company"?"寄出照片上传":"分析照片上传",preset:"card",class:"w-800px"},{footer:s(()=>[l(q,{justify:"end"},{default:s(()=>[l(r(b),{size:"small",class:"mt-16px",onClick:Ot},{default:s(()=>[y(N(r(z)("common.cancel")),1)]),_:1}),l(r(b),{type:"primary",size:"small",class:"mt-16px",onClick:jt},{default:s(()=>[y(N(r(z)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[o.type==="customer"?(R(),P(Xe,{key:0,multiple:"",max:3,"file-list":o.sendFileList,"onUpdate:fileList":t[12]||(t[12]=d=>o.sendFileList=d),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ke,"custom-request":Ne},{default:s(()=>t[35]||(t[35]=[y(" 点击上传 ")])),_:1,__:[35]},8,["file-list"])):o.type==="company"?(R(),P(Xe,{key:1,multiple:"",max:3,"file-list":o.receiveFileList,"onUpdate:fileList":t[13]||(t[13]=d=>o.receiveFileList=d),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ke,"custom-request":Ne},{default:s(()=>t[36]||(t[36]=[y(" 点击上传 ")])),_:1,__:[36]},8,["file-list"])):(R(),P(Xe,{key:2,multiple:"",max:3,"file-list":o.analyzeFileList,"onUpdate:fileList":t[14]||(t[14]=d=>o.analyzeFileList=d),"list-type":"image-card",onBeforeUpload:Ke,"default-upload":!1,"custom-request":Ne},{default:s(()=>t[37]||(t[37]=[y(" 点击上传 ")])),_:1,__:[37]},8,["file-list"]))]),_:1},8,["show","title"]),l(ke,{show:Te.value,"onUpdate:show":t[17]||(t[17]=d=>Te.value=d),title:"备注",preset:"card",class:"w-600px"},{footer:s(()=>[l(q,{justify:"end"},{default:s(()=>[l(r(b),{size:"small",class:"mt-16px",onClick:We},{default:s(()=>[y(N(r(z)("common.cancel")),1)]),_:1}),l(r(b),{type:"primary",size:"small",class:"mt-16px",onClick:Et},{default:s(()=>[y(N(r(z)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(Q,{ref:"formRef",model:B,"label-placement":"left"},{default:s(()=>[l(H,{label:"备注",path:"notes",required:""},{default:s(()=>[l(v,{type:"textarea",value:B.notes,"onUpdate:value":t[16]||(t[16]=d=>B.notes=d),placeholder:"请输入备注",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),l(ke,{show:_e.value,"onUpdate:show":t[21]||(t[21]=d=>_e.value=d),title:"售后处理",preset:"card",class:"w-85%"},{default:s(()=>[l(Q,{ref:"formRef",model:De,"label-placement":"left","label-width":100,"show-feedback":!1},{default:s(()=>[l(be,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[l(w,{span:"24 s:24 m:24"},{default:s(()=>[l(q,{class:"w-full"},{default:s(()=>[r(de)("aftermarketRes:select:permission.do")?(R(),P(r(b),{key:0,ghost:"",onClick:r(te)},{icon:s(()=>[l(_,{class:"text-icon"})]),default:s(()=>[t[38]||(t[38]=y(" "+N("查询")))]),_:1,__:[38]},8,["onClick"])):j("",!0),r(de)("aftermarketRes:insert:permission.do")?(R(),P(r(b),{key:1,type:"primary",ghost:"",onClick:t[18]||(t[18]=d=>Je({id:De.aid||p.aid},"add"))},{icon:s(()=>[l(Jt,{class:"text-icon"})]),default:s(()=>[t[39]||(t[39]=y(" "+N("添加")))]),_:1,__:[39]})):j("",!0),r(de)("aftermarketRes:delete:permission.do")?(R(),P(r(b),{key:2,type:"error",disabled:r(ie).length===0,onClick:t[19]||(t[19]=d=>dt(void 0))},{icon:s(()=>[l(E,{class:"text-icon"})]),default:s(()=>[t[40]||(t[40]=y(" "+N("批量删除")))]),_:1,__:[40]},8,["disabled"])):j("",!0),r(de)("aftermarketRes:select:permission.do")?(R(),P(r(b),{key:3,onClick:r(te)},{icon:s(()=>[l(Qt,{class:"text-icon"})]),default:s(()=>[t[41]||(t[41]=y(" "+N("刷新")))]),_:1,__:[41]},8,["onClick"])):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),l(ue,{"checked-row-keys":r(he),"onUpdate:checkedRowKeys":t[20]||(t[20]=d=>Ye(he)?he.value=d:null),columns:r(Rt),data:r(lt),size:"small",loading:r(Tt),remote:"",style:{"margin-top":"20px"},"max-height":400,"row-key":d=>d.id,pagination:r(Re),class:"sm:h-full",striped:""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1},8,["show"]),l(ke,{show:Ie.value,"onUpdate:show":t[26]||(t[26]=d=>Ie.value=d),title:p.type==="add"?"添加责任人":"修改责任人",preset:"card",class:"w-600px"},{footer:s(()=>[l(q,{justify:"end"},{default:s(()=>[l(r(b),{size:"small",class:"mt-16px",onClick:Qe},{default:s(()=>[y(N(r(z)("common.cancel")),1)]),_:1}),l(r(b),{type:"primary",size:"small",class:"mt-16px",onClick:Vt},{default:s(()=>[y(N(r(z)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(Q,{ref:"formRef",model:B,"label-placement":"left"},{default:s(()=>[l(H,{label:"责任人",path:"notes",required:""},{default:s(()=>[l(v,{disabled:"",value:p.username,"onUpdate:value":t[22]||(t[22]=d=>p.username=d),placeholder:"请输入责任人",clearable:""},null,8,["value"])]),_:1}),l(H,{label:"原因分析",path:"notes"},{default:s(()=>[l(v,{type:"textarea",value:p.reason,"onUpdate:value":t[23]||(t[23]=d=>p.reason=d),placeholder:"请输入原因分析",clearable:""},null,8,["value"])]),_:1}),l(H,{label:"处理意见",path:"notes"},{default:s(()=>[l(v,{type:"textarea",value:p.resolution,"onUpdate:value":t[24]||(t[24]=d=>p.resolution=d),placeholder:"请输入处理意见",clearable:""},null,8,["value"])]),_:1}),l(H,{label:"改进措施",path:"notes"},{default:s(()=>[l(v,{type:"textarea",value:p.improvement,"onUpdate:value":t[25]||(t[25]=d=>p.improvement=d),placeholder:"请输入改进措施",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),l(Nl,{visible:ye.value,"onUpdate:visible":t[27]||(t[27]=d=>ye.value=d),onSubmitted:r($),"row-id":ne.id,"row-mtype":ne.mtype},null,8,["visible","onSubmitted","row-id","row-mtype"]),l(Xt,{show:pe.value,"onUpdate:show":t[28]||(t[28]=d=>pe.value=d),current:S.value,"onUpdate:current":[t[29]||(t[29]=d=>S.value=d),Nt],"src-list":a.value},null,8,["show","current","src-list"])])}}});export{Xl as default};
