import{_ as De}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BmlDgQ0w.js";import{d as Y,q as Q,s as ie,v as ce,x as Ne,b as Ue,r as le,j as de,y as ne,K as L,o as b,c as w,w as l,g as e,h,t as H,i as n,$ as k,L as W,U as X,N as T,M as ue,ar as Ae,a$ as Re,A as pe,X as me,E as Z,D as fe,B as J,F as Pe,f as Te,e as _e,ai as $e,a9 as ve,Z as ze,aV as Fe,ac as K,ad as Ve}from"./index-COCU-dRC.js";import{u as Oe,a as je}from"./table-DBL-1SAi.js";import{a as Be,h as Me,k as qe,l as Ee,m as Ge,n as Ie,o as Ke,p as Le}from"./Collection-EgmiSt98.js";import{C as He,c as ge,d as We,e as Xe}from"./collection-DUzWNQJt.js";import{r as Ze}from"./asset-Dndavozh.js";import{u as oe}from"./usePageData-YwCZ_Txz.js";import{_ as be}from"./FormItemGridItem-BgX6gCvp.js";import{_ as Je}from"./Cascader-B6O1WJNC.js";import{b as Qe,a as Ye,_ as ea}from"./DataTable-W68blcrm.js";import{_ as he}from"./Grid-DXM2gQBE.js";import{_ as aa,a as ta}from"./arrow-open-up-BmeDYPNQ.js";import{_ as la}from"./round-search-Ozoxzuc1.js";import{_ as na}from"./round-refresh-BJ3UDO-a.js";import{h as se}from"./permission-BUYOAfP5.js";import{_ as oa}from"./Popconfirm-DYcjMzR5.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-CBv9_zCv.js";import"./setting-outlined-eMrnAso8.js";import"./round-delete-CwFw9pTm.js";import"./refresh-CHQRgPck.js";import"./Upload-BGb7fzaY.js";import"./Progress-mNtdJSDf.js";import"./Forward-Cj8r8vQs.js";const sa=Y({name:"CollectorModal",__name:"collector_modal",props:Q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(C,{emit:V}){const p=C,D=V,y=ie(C,"visible"),{formRef:i,validate:x,restoreValidation:O}=ce(),{createConfirmPwdRule:$,defaultRequiredRule:N,patternRules:E}=Ne(),P=Ue(()=>({add:"新增采集器",edit:"编辑采集器"})[p.operateType]),a=le(S());function S(){return{id:void 0,cname:"",cencode:0,accmed:1,proser:void 0,caddr:"",logsoudev:void 0,filterpro:void 0,cdesc:"",proper:0,enable:0,rev:void 0,port:void 0,uname:void 0,pswd:void 0,fpath:void 0}}const _={cname:N,caddr:[{required:!0,message:"请输入采集器地址",trigger:["blur","input"]},{required:!0,validator:Ae,trigger:["blur","input"]}],rev:N,port:{required:!0,trigger:["blur","input"],validator:(c,t,f)=>t?Re(t)?!0:new Error("请输入在0-65535之间的数字"):new Error("请输入端口号")},uname:N,pswd:N,cencode:{type:"number",required:!0,trigger:["blur","change"],message:"请选择编码格式"},accmed:{type:"number",required:!0,trigger:["blur","change"],message:"请选择接入方式"},logsoudev:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源设备"}},{pageData:U,getData:v,nextPage:j}=oe(Be),z=async c=>{const t=c.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&U.data.length<U.total&&j()},{pageData:F,getData:B,nextPage:M}=oe(Me),q=async c=>{const t=c.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&F.data.length<F.total&&M()},A=de(),s=async()=>{const{data:c,error:t}=await Ge();A.value=c.map(f=>({...f,id:"-"+f.id,type:f.cname}))};function r(){v(),s(),B(),Object.assign(a,S()),p.operateType==="edit"&&p.rowData&&(Object.assign(a,p.rowData),R.clickNums=1)}function u(){y.value=!1}const R=le({clickNums:0,isLoading:!1});async function m(){var c,t;if(await x(),p.operateType==="add"){const{data:f,error:d}=await qe([a]);d||((c=window.$message)==null||c.success(k("common.addSuccess")),u(),D("submitted"),a.proper==0&&await Ze([{aname:a.cname,aip:a.caddr,tid:36,cid:f}]))}else{const{data:f,error:d}=await Ee([a]);d||((t=window.$message)==null||t.success(k("common.updateSuccess")),u(),D("submitted"))}}const g=c=>{Object.assign(a,{logsoudev:void 0,rev:void 0,port:void 0,uname:void 0,pswd:void 0}),c==4&&(a.logsoudev=53)};return ne(y,()=>{y.value&&(r(),O())}),ne(()=>a.caddr,()=>{R.clickNums=0}),(c,t)=>{const f=pe,d=be,G=me,ye=Je,I=Qe,ee=Z,ae=Ye,we=he,ke=fe,te=J,Ce=Z,xe=Pe,Se=L("no-space");return b(),w(xe,{show:y.value,"onUpdate:show":t[14]||(t[14]=o=>y.value=o),title:P.value,preset:"card",class:"w-850px"},{footer:l(()=>[e(Ce,{size:16,justify:"end"},{default:l(()=>[e(te,{onClick:u},{default:l(()=>[h(H(n(k)("common.cancel")),1)]),_:1}),e(te,{type:"primary",onClick:m},{default:l(()=>[h(H(n(k)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(ke,{ref_key:"formRef",ref:i,model:a,rules:_,"label-placement":"left","label-width":120,onKeyup:ue(m,["enter"])},{default:l(()=>[e(we,{responsive:"screen","item-responsive":"","x-gap":20},{default:l(()=>[e(d,{span:"24 s:12 m:12",label:"采集器名称",path:"cname"},{default:l(()=>[W(e(f,{value:a.cname,"onUpdate:value":t[0]||(t[0]=o=>a.cname=o),placeholder:"请输入采集器名称",clearable:""},null,8,["value"]),[[Se]])]),_:1}),e(d,{span:"24 s:12 m:12",label:"编码格式",path:"cencode"},{default:l(()=>[e(G,{value:a.cencode,"onUpdate:value":t[1]||(t[1]=o=>a.cencode=o),placeholder:"请选择编码格式",filterable:"",clearable:"",options:n(X)(n(He))},null,8,["value","options"])]),_:1}),e(d,{span:"24 s:12 m:12",label:"接入方式",path:"accmed"},{default:l(()=>[e(G,{value:a.accmed,"onUpdate:value":[t[2]||(t[2]=o=>a.accmed=o),g],placeholder:"请选择接入方式",filterable:"",clearable:"",disabled:c.operateType==="edit",options:n(X)(n(ge))},null,8,["value","disabled","options"])]),_:1}),e(d,{span:"24 s:12 m:12",label:"代理服务器",path:"proser"},{default:l(()=>[e(G,{value:a.proser,"onUpdate:value":t[3]||(t[3]=o=>a.proser=o),placeholder:"请选择代理服务器",clearable:"",filterable:"","value-field":"id","label-field":"pip",options:n(U).data,"reset-menu-on-options-change":!1,onScroll:z},null,8,["value","options"])]),_:1}),e(d,{span:"24 s:12 m:12",label:"采集地址",path:"caddr"},{default:l(()=>[e(f,{value:a.caddr,"onUpdate:value":t[4]||(t[4]=o=>a.caddr=o),placeholder:"请输入采集地址",clearable:""},null,8,["value"])]),_:1}),[0,1,4,5,7,8].includes(a.accmed)?(b(),w(d,{key:0,span:"24 s:12 m:12",label:"日志源设备",path:"logsoudev"},{default:l(()=>[e(ye,{value:a.logsoudev,"onUpdate:value":t[5]||(t[5]=o=>a.logsoudev=o),placeholder:"请选择日志源设备",options:A.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"","show-path":!1},null,8,["value","options"])]),_:1})):T("",!0),e(d,{span:"24 s:12 m:12",label:"过滤策略",path:"filterpro"},{default:l(()=>[e(G,{clearable:"",filterable:"",value:a.filterpro,"onUpdate:value":t[6]||(t[6]=o=>a.filterpro=o),placeholder:"请选择过滤策略",options:n(F).data,"value-field":"id","label-field":"pname","reset-menu-on-options-change":!1,onScroll:q},null,8,["value","options"])]),_:1}),[3,7,8].includes(a.accmed)?(b(),w(d,{key:1,span:"24 s:12 m:12",label:a.accmed==3?"数据库名称":a.accmed==4?"域名":(a.accmed==7,"目录"),path:"rev"},{default:l(()=>[e(f,{value:a.rev,"onUpdate:value":t[7]||(t[7]=o=>a.rev=o),placeholder:"请输入",clearable:""},null,8,["value"])]),_:1},8,["label"])):T("",!0),[3,4,7,8].includes(a.accmed)?(b(),w(d,{key:2,span:"24 s:12 m:12",label:"端口",path:"port"},{default:l(()=>[e(f,{value:a.port,"onUpdate:value":t[8]||(t[8]=o=>a.port=o),placeholder:"请输入端口",clearable:""},null,8,["value"])]),_:1})):T("",!0),[3,4,7,8,9].includes(a.accmed)?(b(),w(d,{key:3,span:"24 s:12 m:12",label:"用户名",path:"uname"},{default:l(()=>[e(f,{value:a.uname,"onUpdate:value":t[9]||(t[9]=o=>a.uname=o),placeholder:"请输入用户名",clearable:""},null,8,["value"])]),_:1})):T("",!0),[3,4,7,8,9].includes(a.accmed)?(b(),w(d,{key:4,span:"24 s:12 m:12",label:"密码",path:"pswd"},{default:l(()=>[e(f,{value:a.pswd,"onUpdate:value":t[10]||(t[10]=o=>a.pswd=o),placeholder:"请输入密码",clearable:""},null,8,["value"])]),_:1})):T("",!0),c.operateType=="add"?(b(),w(d,{key:5,span:"24 s:12 m:12",label:"生成资产",path:"proper"},{default:l(()=>[e(ae,{value:a.proper,"onUpdate:value":t[11]||(t[11]=o=>a.proper=o),name:"radiogroup"},{default:l(()=>[e(ee,null,{default:l(()=>[e(I,{value:0},{default:l(()=>[h("是")]),_:1}),e(I,{value:1},{default:l(()=>[h("否")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})):T("",!0),e(d,{span:"24 s:12 m:12",label:"是否启用",path:"enable"},{default:l(()=>[e(ae,{value:a.enable,"onUpdate:value":t[12]||(t[12]=o=>a.enable=o),name:"radiogroup",disabled:c.operateType=="edit"},{default:l(()=>[e(ee,null,{default:l(()=>[e(I,{value:0},{default:l(()=>[h("是")]),_:1}),e(I,{value:1},{default:l(()=>[h("否")]),_:1})]),_:1})]),_:1},8,["value","disabled"])]),_:1}),e(d,{span:"24 s:24 m:24",label:"描述",path:"cdesc"},{default:l(()=>[e(f,{type:"textarea",value:a.cdesc,"onUpdate:value":t[13]||(t[13]=o=>a.cdesc=o),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),ra=Y({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["reset","search"],["update:model"]),setup(C,{emit:V}){const p=V,{formRef:D,restoreValidation:y}=ce(),i=ie(C,"model"),x=de(!1);function O(S){i.value.enable=S,p("search")}function $(S){i.value.accmed=S,p("search")}function N(){i.value.fuzzy=void 0,p("search")}function E(){i.value.caddr=void 0,p("search")}async function P(){await y(),p("reset")}async function a(){p("search")}return(S,_)=>{const U=pe,v=be,j=na,z=J,F=la,B=aa,M=ta,q=Z,A=me,s=he,r=fe,u=ve,R=L("no-space");return b(),w(u,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[e(r,{ref_key:"formRef",ref:D,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ue(a,["enter"])},{default:l(()=>[e(s,{responsive:"screen","item-responsive":""},{default:l(()=>[e(v,{span:"24 s:12 m:6",label:"采集器名称",path:"fuzzy",class:"pr-24px"},{default:l(()=>[W(e(U,{clearable:"",value:i.value.fuzzy,"onUpdate:value":_[0]||(_[0]=m=>i.value.fuzzy=m),placeholder:"请输入采集器名称",onClear:N},null,8,["value"]),[[R]])]),_:1}),e(v,{span:"24 s:12 m:6",label:"采集地址",path:"caddr",class:"pr-24px"},{default:l(()=>[e(U,{clearable:"",value:i.value.caddr,"onUpdate:value":_[1]||(_[1]=m=>i.value.caddr=m),onClear:E,placeholder:"请输入采集地址"},null,8,["value"])]),_:1}),e(v,{span:"24 m:12",class:"pr-24px"},{default:l(()=>[e(q,{class:"w-full",align:"center"},{default:l(()=>[e(z,{onClick:P},{icon:l(()=>[e(j,{class:"text-icon"})]),default:l(()=>[h(" "+H(n(k)("common.reset")),1)]),_:1}),e(z,{type:"primary",ghost:"",onClick:a},{icon:l(()=>[e(F,{class:"text-icon"})]),default:l(()=>[h(" "+H(n(k)("common.search")),1)]),_:1}),Te("div",{class:"cursor-pointer",title:"精准查询",onClick:_[2]||(_[2]=m=>x.value=!x.value)},[x.value?(b(),w(B,{key:0,class:"text-icon"})):(b(),w(M,{key:1,class:"text-icon"}))])]),_:1})]),_:1}),x.value?(b(),_e($e,{key:0},[e(v,{span:"24 s:12 m:6",label:"接入方式",path:"accmed",class:"pr-24px mt-20px"},{default:l(()=>[e(A,{clearable:"",filterable:"",value:i.value.accmed,"onUpdate:value":_[3]||(_[3]=m=>i.value.accmed=m),placeholder:"请选择接入方式",options:n(X)(n(ge)),onUpdateValue:$,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"状态",path:"enable",class:"pr-24px mt-20px"},{default:l(()=>[e(A,{clearable:"",filterable:"",value:i.value.enable,"onUpdate:value":_[4]||(_[4]=m=>i.value.enable=m),placeholder:"请选择状态",options:n(X)(n(We)),onUpdateValue:O,style:{width:"100%"}},null,8,["value","options"])]),_:1})],64)):T("",!0)]),_:1})]),_:1},8,["model"])]),_:1})}}}),ia={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function re(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!Ve(C)}const Ta=Y({name:"collectionmanagement_collector",__name:"index",setup(C){const V=ze(),{columns:p,columnChecks:D,data:y,getData:i,loading:x,mobilePagination:O,searchParams:$,resetSearchParams:N}=Oe({apiFn:Ie,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,caddr:null,enable:null,accmed:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"cname",title:"采集器名称",align:"center",width:200},{key:"caddr",title:"采集地址",align:"center",width:200},{key:"accmed",title:"接入方式",align:"center",width:160,render:s=>{const r=Xe;return e("span",null,[h(" "),r[s.accmed]])}},{key:"pname",title:"过滤策略",align:"center",width:200},{key:"pip",title:"代理服务器",align:"center",width:200},{key:"type",title:"日志源设备",align:"center",width:200},{key:"enable",title:"状态",align:"center",width:160,render:s=>e(Z,{justify:"center"},{default:()=>[e(Fe,{value:s.enable,"onUpdate:value":[r=>s.enable=r,()=>E(s)],checkedValue:0,uncheckedValue:1},{checked:()=>e("span",null,[h("启用")]),unchecked:()=>e("span",null,[h("禁用")])})]})},{key:"operate",title:k("common.operate"),align:"center",width:130,fixed:"right",render:s=>{let r;return e("div",{class:"flex-center gap-8px"},[W(e(J,{type:"primary",ghost:!0,size:"small",onClick:()=>q(s.id)},re(r=k("common.edit"))?r:{default:()=>[r]}),[[L("no-auth"),"sys.collection.mengement.update"]]),e(oa,{onPositiveClick:()=>M(s.id)},{default:()=>k("common.confirmDelete"),trigger:()=>{let u;return W(e(J,{type:"error",ghost:!0,size:"small"},re(u=k("common.delete"))?u:{default:()=>[u]}),[[L("no-auth"),"sys.collection.mengement.delete"]])}})])}}]}),E=async s=>{var u;const r={id:s.id,enable:s.enable,ip:s.enable==1?s.caddr:void 0};try{const{data:R,error:m}=await Ke(r);m||((u=window.$message)==null||u.success(s.enable==1?"禁用成功":"启用成功"),i())}catch{s.enable=s.enable==1?0:1}},{drawerVisible:P,operateType:a,editingData:S,handleAdd:_,handleEdit:U,checkedRowKeys:v,onBatchDeleted:j,onDeleted:z,closeDrawer:F}=je(y,i);async function B(){console.log(v.value),A(v.value.join(","),s=>{j()})}function M(s){A(s,r=>{z()})}function q(s){U(s)}async function A(s,r){const u=await Le(s);console.log("data",u),r&&r(u)}return(s,r)=>{const u=De,R=ea,m=ve;return b(),_e("div",ia,[e(ra,{model:n($),"onUpdate:model":r[0]||(r[0]=g=>K($)?$.value=g:null),onReset:n(N),onSearch:n(i)},null,8,["model","onReset","onSearch"]),e(m,{title:"采集器管理",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":l(()=>[e(u,{columns:n(D),"onUpdate:columns":r[1]||(r[1]=g=>K(D)?D.value=g:null),"disabled-delete":n(v).length===0,"is-view-add-button":n(se)("sys.collection.mengement.insert"),"is-view-delete-button":n(se)("sys.collection.mengement.delete"),loading:n(x),onAdd:n(_),onDelete:B,onRefresh:n(i)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:l(()=>[e(R,{"checked-row-keys":n(v),"onUpdate:checkedRowKeys":r[2]||(r[2]=g=>K(v)?v.value=g:null),columns:n(p),data:n(y),size:"small","flex-height":!n(V).isMobile,"scroll-x":n(p).reduce((g,c)=>g+c.width,0),loading:n(x),remote:"","row-key":g=>g.id,pagination:n(O),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(sa,{visible:n(P),"onUpdate:visible":r[3]||(r[3]=g=>K(P)?P.value=g:null),"operate-type":n(a),"row-data":n(S),onSubmitted:n(i)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Ta as default};
