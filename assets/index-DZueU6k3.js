import{_ as ie}from"./table-header-operation.vue_vue_type_script_setup_true_lang-sTdi_Mso.js";import{d as E,q as A,s as J,v as Y,x as re,b as se,r as pe,y as ce,K as M,o as K,c as Q,w as n,g as t,h as O,t as F,i as l,$ as f,M as X,L as q,T as Z,am as j,an as W,A as ee,C as ue,W as te,D as oe,B as V,E as G,a9 as de,aa as me,a8 as le,Y as _e,al as fe,j as ve,J as ye,e as ge,ab as B,ac as he}from"./index-CApY-42s.js";import{u as be,a as we}from"./table-0g6HA-JD.js";import{e as ke,g as Ne,h as De,i as Se,j as xe}from"./Collection-Bj7kE1Gd.js";import{b as ae,T as Ce}from"./collection-D6HCIXrh.js";import{_ as Pe}from"./round-search-DSgVyaLD.js";import{_ as Ie}from"./round-refresh-hs2yVnUs.js";import{_ as Te}from"./FormItemGridItem-B1pEyyKm.js";import{_ as Re}from"./Grid-COF4dzUc.js";import{h as H}from"./permission-nYEC8bYp.js";import{_ as ze}from"./Popconfirm-BHUkzs1E.js";import{_ as Ue}from"./DataTable-KOmQCgGF.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-CbkUjrUx.js";import"./setting-outlined-D0remarc.js";import"./round-delete-k3kxFfbM.js";import"./refresh-3sfIJFqS.js";import"./round-plus-XcH-uUkg.js";import"./Upload-CP6eSQhx.js";import"./Progress-BSWfJhwl.js";import"./Forward-Dc9zpZGN.js";const $e=E({name:"OperateDrawer",__name:"operate-drawer",props:A({operateType:{},rowData:{},tTypeList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:A(["submitted"],["update:visible"]),setup(g,{emit:T}){const u=g,b=T,v=J(g,"visible"),{formRef:p,validate:P,restoreValidation:R}=Y(),{createConfirmPwdRule:S,defaultRequiredRule:z,patternRules:x}=re(),w=se(()=>({add:"新增策略",edit:"编辑策略"})[u.operateType]),e=pe(k());function k(){return{id:void 0,pname:"",llevel:[],etype:[],oriip:"",aimip:"",cdesc:""}}const U={pname:z,oriip:{type:"string",required:!0,validator:(h,o)=>!j(o[0])||!j(o[1])?new Error("请输入正确的IP"):!0,trigger:["input","blur"]},aimip:{type:"string",required:!0,validator:(h,o)=>!j(o[0])||!j(o[1])?new Error("请输入正确的IP"):!0,trigger:["input","blur"]},llevel:{type:"array",required:!0,trigger:["blur","change"],message:"请选择日志级别"},etype:{type:"array",required:!0,trigger:["blur","change"],message:"请选择事件类型"}};function y(){Object.assign(e,k()),u.operateType==="edit"&&u.rowData&&(Object.assign(e,u.rowData),e.oriip=e.oriip.split("-"),e.aimip=e.aimip.split("-"),e.llevel=e.llevel.split(",").map(Number),e.etype=e.etype.split(",").map(Number))}function N(){v.value=!1}async function I(){var h,o,m,d;if(await P(),W(e.oriip[0],e.oriip[1])!=-1)return(h=window.$message)==null?void 0:h.error("源起始IP不能大于源结束IP");if(W(e.aimip[0],e.aimip[1])!=-1)return(o=window.$message)==null?void 0:o.error("目的起始IP不能大于目的结束IP");if(e.oriip=e.oriip.join("-"),e.aimip=e.aimip.join("-"),e.llevel=e.llevel.join(","),e.etype=e.etype.join(","),u.operateType==="add"){const{data:D,error:_}=await ke([e]);_||((m=window.$message)==null||m.success(f("common.addSuccess")),N(),b("submitted"))}else{const{data:D,error:_}=await Ne([e]);_||((d=window.$message)==null||d.success(f("common.updateSuccess")),N(),b("submitted"))}}return ce(v,()=>{v.value&&(y(),R())}),(h,o)=>{const m=ee,d=ue,D=te,_=oe,$=V,r=G,a=de,c=me,C=M("no-space");return K(),Q(c,{show:v.value,"onUpdate:show":o[6]||(o[6]=i=>v.value=i),"display-directive":"show",width:360},{default:n(()=>[t(a,{title:w.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[t(r,{size:16},{default:n(()=>[t($,{onClick:N},{default:n(()=>[O(F(l(f)("common.cancel")),1)]),_:1}),t($,{type:"primary",onClick:I},{default:n(()=>[O(F(l(f)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[t(_,{ref_key:"formRef",ref:p,model:e,rules:U,onKeyup:X(I,["enter"])},{default:n(()=>[t(d,{label:"策略名称",path:"pname"},{default:n(()=>[q(t(m,{value:e.pname,"onUpdate:value":o[0]||(o[0]=i=>e.pname=i),placeholder:"请输入策略名称",clearable:""},null,8,["value"]),[[C]])]),_:1}),t(d,{label:"日志级别",path:"llevel"},{default:n(()=>[t(D,{value:e.llevel,"onUpdate:value":o[1]||(o[1]=i=>e.llevel=i),multiple:"",placeholder:"请选择日志级别",options:l(Z)(l(ae))},null,8,["value","options"])]),_:1}),t(d,{label:"事件类型",path:"etype"},{default:n(()=>[t(D,{value:e.etype,"onUpdate:value":o[2]||(o[2]=i=>e.etype=i),multiple:"",placeholder:"请选择日志级别","value-field":"id","label-field":"pname",options:u.tTypeList},null,8,["value","options"])]),_:1}),t(d,{label:"源IP",path:"oriip"},{default:n(()=>[t(m,{pair:"",separator:"-",value:e.oriip,"onUpdate:value":o[3]||(o[3]=i=>e.oriip=i),placeholder:["源起始IP","源终止IP"],clearable:""},null,8,["value"])]),_:1}),t(d,{label:"目的IP",path:"aimip"},{default:n(()=>[t(m,{pair:"",separator:"-",value:e.aimip,"onUpdate:value":o[4]||(o[4]=i=>e.aimip=i),placeholder:["目的起始IP","目的终止IP"],clearable:""},null,8,["value"])]),_:1}),t(d,{label:"描述",path:"cdesc"},{default:n(()=>[t(m,{type:"textarea",value:e.cdesc,"onUpdate:value":o[5]||(o[5]=i=>e.cdesc=i),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),je=E({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:A(["reset","search"],["update:model"]),setup(g,{emit:T}){const u=T,{formRef:b,restoreValidation:v}=Y(),p=J(g,"model");function P(){p.value.fuzzy="",u("search")}async function R(){await v(),u("reset")}async function S(){u("search")}function z(x){p.value.llevel=x,u("search")}return(x,w)=>{const e=ee,k=Te,U=te,y=Ie,N=V,I=Pe,h=G,o=Re,m=oe,d=le,D=M("no-space");return K(),Q(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(m,{ref_key:"formRef",ref:b,model:p.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:X(S,["enter"])},{default:n(()=>[t(o,{responsive:"screen","item-responsive":""},{default:n(()=>[t(k,{span:"24 s:12 m:6",label:"策略名称",path:"fuzzy",class:"pr-24px"},{default:n(()=>[q(t(e,{clearable:"",value:p.value.fuzzy,"onUpdate:value":w[0]||(w[0]=_=>p.value.fuzzy=_),placeholder:"请输入策略名称",onClear:P},null,8,["value"]),[[D]])]),_:1}),t(k,{span:"24 s:12 m:6",label:"日志级别",path:"llevel",class:"pr-24px"},{default:n(()=>[t(U,{clearable:"",filterable:"",value:p.value.llevel,"onUpdate:value":w[1]||(w[1]=_=>p.value.llevel=_),placeholder:"请选择日志级别",options:l(Z)(l(ae)),onUpdateValue:z,style:{width:"100%"}},null,8,["value","options"])]),_:1}),t(k,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[t(h,{class:"w-full"},{default:n(()=>[t(N,{onClick:R},{icon:n(()=>[t(y,{class:"text-icon"})]),default:n(()=>[O(" "+F(l(f)("common.reset")),1)]),_:1}),t(N,{type:"primary",ghost:"",onClick:S},{icon:n(()=>[t(I,{class:"text-icon"})]),default:n(()=>[O(" "+F(l(f)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function L(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!he(g)}const lt=E({name:"collectionmanagement_collectionpolicy",__name:"index",setup(g){const T=_e(),{columns:u,columnChecks:b,data:v,getData:p,loading:P,mobilePagination:R,searchParams:S,resetSearchParams:z}=be({apiFn:De,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,llevel:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"pname",title:"策略名称",align:"center",width:140},{key:"llevel",title:"日志级别",align:"center",width:300,render:r=>{let a;const c=r.llevel.split(",").map(Number),C={0:"default",1:"success",2:"info",3:"warning",4:"error"};return t(G,{justify:"center"},L(a=c.map(i=>{const s=f(Ce[i]);return t(fe,{type:C[i]},L(s)?s:{default:()=>[s]})}))?a:{default:()=>[a]})}},{key:"etype",title:"事件类型",align:"center",render:r=>{const a=r.etype.split(",").map(Number);return t("span",null,[a.map((c,C)=>{var s;const i=(s=o.value.find(ne=>ne.id===c))==null?void 0:s.pname;return i?`${i}${C!==a.length-1?"，":""}`:""})])},ellipsis:{tooltip:!0,tooltipPlacement:"top"}},{key:"oriip",title:"源IP",align:"center"},{key:"aimip",title:"目的IP",align:"center"},{key:"cdesc",title:"描述",align:"center",minWidth:200},{key:"operate",title:f("common.operate"),align:"center",width:130,render:r=>{let a;return t("div",{class:"flex-center gap-8px"},[q(t(V,{type:"primary",ghost:!0,size:"small",onClick:()=>_(r.id)},L(a=f("common.edit"))?a:{default:()=>[a]}),[[M("no-auth"),"sys.collection.policy.update"]]),t(ze,{onPositiveClick:()=>D(r.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let c;return q(t(V,{type:"error",ghost:!0,size:"small"},L(c=f("common.delete"))?c:{default:()=>[c]}),[[M("no-auth"),"sys.collection.policy.delete"]])}})])}}]}),{drawerVisible:x,operateType:w,editingData:e,handleAdd:k,handleEdit:U,checkedRowKeys:y,onBatchDeleted:N,onDeleted:I,closeDrawer:h}=we(v,p),o=ve([]),m=async()=>{const{data:r,error:a}=await xe();o.value=r};async function d(){console.log(y.value),$(y.value.join(","),r=>{N()})}function D(r){console.log(r),$(r,a=>{I()})}function _(r){U(r)}async function $(r,a){const c=await Se(r);console.log("data",c),a&&a(c)}return ye(()=>{m()}),(r,a)=>{const c=ie,C=Ue,i=le;return K(),ge("div",Be,[t(je,{model:l(S),"onUpdate:model":a[0]||(a[0]=s=>B(S)?S.value=s:null),onReset:l(z),onSearch:l(p)},null,8,["model","onReset","onSearch"]),t(i,{title:"采集过滤策略",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":n(()=>[t(c,{columns:l(b),"onUpdate:columns":a[1]||(a[1]=s=>B(b)?b.value=s:null),"disabled-delete":l(y).length===0,"is-view-add-button":l(H)("sys.collection.policy.insert"),"is-view-delete-button":l(H)("sys.collection.policy.delete"),loading:l(P),onAdd:l(k),onDelete:d,onRefresh:l(p)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:n(()=>[t(C,{"checked-row-keys":l(y),"onUpdate:checkedRowKeys":a[2]||(a[2]=s=>B(y)?y.value=s:null),columns:l(u),data:l(v),size:"small","flex-height":!l(T).isMobile,"scroll-x":962,loading:l(P),remote:"","row-key":s=>s.id,pagination:l(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t($e,{visible:l(x),"onUpdate:visible":a[3]||(a[3]=s=>B(x)?x.value=s:null),"operate-type":l(w),"row-data":l(e),tTypeList:o.value,onSubmitted:l(p)},null,8,["visible","operate-type","row-data","tTypeList","onSubmitted"])]),_:1})])}}});export{lt as default};
