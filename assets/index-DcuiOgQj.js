import{d as E,k as $,b as U,bP as re,bQ as ie,ab as G,o as L,e as q,t as b,ag as ce,bR as de,c as j,w as s,g as o,f as A,ae as ue,a4 as pe,i as Y,ap as fe,ao as me,a6 as ae,af as Q,j as _e,_ as F,q as he,a0 as J,bS as te,bT as T,ai as ge,x as be,aj as ve,r as ye,y as we,H as xe,az as Z,aA as Se,aB as De,aC as Ce,h as g,at as ke,aw as ee,S as Te,ak as $e,P as Me,R as Ne,T as Pe}from"./index-BVh4YUdK.js";import{_ as se,a as oe}from"./Grid-BPVsc18m.js";import{u as ne,L as O}from"./echarts-CCKS8Ydb.js";import{h as Ae}from"./permission-T-NisIU-.js";import{G as Ie,h as Be,b as Le}from"./metar-BZs_J1WR.js";import{_ as Oe,a as We}from"./DescriptionsItem-sIsL0wvf.js";const ze="/assets/station-GwqcmkHc.jpeg",Ve=E({name:"CountTo",__name:"count-to",props:{startValue:{default:0},endValue:{default:2021},duration:{default:1500},autoplay:{type:Boolean,default:!0},decimals:{default:0},prefix:{default:""},suffix:{default:""},separator:{default:","},decimal:{default:"."},useEasing:{type:Boolean,default:!0},transition:{default:"linear"}},setup(D){const a=D,C=$(a.startValue),r=U(()=>a.useEasing?re[a.transition]:void 0),N=ie(C,{disabled:!1,duration:a.duration,transition:r.value}),p=U(()=>m(N.value));function m(d){const{decimals:v,decimal:w,separator:x,suffix:n,prefix:e}=a;let l=d.toFixed(v);l=String(l);const t=l.split(".");let i=t[0];const I=t.length>1?w+t[1]:"",_=/(\d+)(\d{3})/;if(x)for(;_.test(i);)i=i.replace(_,`$1${x}$2`);return e+i+I+n}async function M(){await ce(),C.value=a.endValue}return G([()=>a.startValue,()=>a.endValue],()=>{a.autoplay&&M()},{immediate:!0}),(d,v)=>(L(),q("span",null,b(p.value),1))}}),He={class:"ml-20px"},Ge={class:"text-14px"},Ee=E({name:"CardData",__name:"card-data",props:{MeteorologicalData:{type:Object}},setup(D){const a=D,C=U(()=>{var m,M,d,v,w,x;return[{key:"envT",title:"温度",value:((m=a.MeteorologicalData)==null?void 0:m.envT)||0,unit:"℃",color:{start:"#fdd819",end:"#e80505"},icon:"carbon:temperature-celsius"},{key:"envH",title:"湿度",value:((M=a.MeteorologicalData)==null?void 0:M.envH)||0,unit:"%",color:{start:"#97abff",end:"#123597"},icon:"lets-icons:humidity"},{key:"qy",title:"气压",value:((d=a.MeteorologicalData)==null?void 0:d.qy)||0,unit:"hPa",color:{start:"#70f570",end:"#49c628"},icon:"mdi:car-brake-low-pressure"},{key:"windS",title:"风速",value:((v=a.MeteorologicalData)==null?void 0:v.windS)||0,unit:"m/s",color:{start:"#ffe985",end:"#fa742b"},icon:"hugeicons:slow-winds"},{key:"windD",title:"风向",value:((w=a.MeteorologicalData)==null?void 0:w.windD)||0,unit:"°",color:{start:"#bbd2c5",end:"#536976"},icon:"mdi:windsock"},{key:"zfsdCount",title:"总辐射",value:((x=a.MeteorologicalData)==null?void 0:x.zfsd)||0,unit:"W/㎡",color:{start:"#ce9ffc",end:"#7367f0"},icon:"material-symbols:clear-day-rounded"}]}),[r,N]=de();function p(m){return`linear-gradient(to bottom right, ${m.start}, ${m.end})`}return(m,M)=>{const d=_e,v=Ve,w=oe,x=se,n=ae;return L(),j(n,{bordered:!1,size:"small",class:"card-wrapper h-100%","content-style":{padding:"20px 12px",display:"flex",flexDirection:"column",justifyContent:"center"}},{default:s(()=>[o(Y(r),null,{default:s(({$slots:e,gradientColor:l})=>[A("div",{class:"rd-8px pl-15px pb-4px pt-8px text-white",style:pe({backgroundImage:l})},[(L(),j(ue(e.default)))],4)]),_:1}),o(x,{cols:"s:1 m:1 l:2",responsive:"screen","x-gap":10,"y-gap":12},{default:s(()=>[(L(!0),q(me,null,fe(C.value,(e,l)=>(L(),j(w,{key:e.key,class:Q("animated-fade-up-"+l)},{default:s(()=>[o(Y(N),{"gradient-color":p(e.color),class:"flex-1 flex items-center h-100%",style:{"max-height":"75px !important"}},{default:s(()=>[o(d,{icon:e.icon,class:"text-32px"},null,8,["icon"]),A("div",He,[A("h3",Ge,b(e.title),1),o(v,{suffix:e.unit,decimals:1,"start-value":1,"end-value":e.value,class:"text-16px text-white dark:text-dark"},null,8,["suffix","end-value"])])]),_:2},1032,["gradient-color"])]),_:2},1032,["class"]))),128))]),_:1})]),_:1})}}}),Re=F(Ee,[["__scopeId","data-v-5da89340"]]),je=E({name:"LineChart",__name:"line-chart",props:{data:{required:!0},dataModifiers:{}},emits:["update:data"],setup(D){const a=["rgb(233, 4, 69)","rgb(0, 150, 136)","rgb(59, 66, 146)","rgb(255, 99, 71)"],C=["实际功率","预测功率","实际辐射","预测辐射"],r=he(D,"data"),N=J(),p=Date.now(),m=new Date(p).setHours(23,59,59,999),{domRef:M,updateOptions:d,updateOptionsAsync:v}=ne(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function(e){var _;const t=(Array.isArray(e)?e:[e]).filter(h=>{var z;return((z=h==null?void 0:h.value)==null?void 0:z[1])!=null&&(h==null?void 0:h.seriesName)});if(t.length===0)return"";let I=`${((_=t[0])==null?void 0:_.axisValueLabel)||""}<br/>`;return t.forEach((h,z)=>{const f=["实际功率","预测功率"].includes(h.seriesName)?" MW":" W/m²";I+=`
          <span class="round" style="background-color: ${a[C.indexOf(h.seriesName)]||"#ccc"}"></span>
          ${h.seriesName}: ${te(h.value[1],f)}<br/>
        `}),I},backgroundColor:"#6a7985",textStyle:{color:"#d3d6dd"}},legend:{data:["实际功率","预测功率","实际辐射","预测辐射"]},grid:{left:"2%",right:"5%",bottom:"0%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd} {HH}:{mm}"},max:m+60*1e3,data:[]},yAxis:[{name:"功率MW",type:"value",axisLabel:{formatter:"{value} MW"}},{name:"辐射W/m²",type:"value",axisLabel:{formatter:"{value} W/m²"},alignTicks:!0}],series:[{color:a[0],name:"实际功率",type:"line",emphasis:{focus:"series"},yAxisIndex:0,lineStyle:{width:1},smooth:!0,showSymbol:!1,areaStyle:{color:new O(0,0,0,1,[{offset:0,color:T(a[0],.3)},{offset:1,color:T(a[0],0)}],!1),shadowColor:T(a[0],.9),shadowBlur:20},data:[],connectNulls:!0},{color:a[1],name:"预测功率",type:"line",yAxisIndex:0,emphasis:{focus:"series"},lineStyle:{width:1},showSymbol:!1,smooth:!0,areaStyle:{color:new O(0,0,0,1,[{offset:0,color:T(a[1],.3)},{offset:1,color:T(a[1],0)}],!1),shadowColor:T(a[1],.9),shadowBlur:20},data:[],connectNulls:!0},{color:a[2],name:"实际辐射",type:"line",smooth:!0,showSymbol:!1,yAxisIndex:1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new O(0,0,0,1,[{offset:0,color:T(a[2],.3)},{offset:1,color:T(a[2],0)}],!1),shadowColor:T(a[2],.7),shadowBlur:20},data:[],connectNulls:!0},{color:a[3],name:"预测辐射",type:"line",yAxisIndex:1,smooth:!0,showSymbol:!1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new O(0,0,0,1,[{offset:0,color:T(a[3],.3)},{offset:1,color:T(a[3],0)}],!1),shadowColor:T(a[3],.7),shadowBlur:20},data:[],connectNulls:!0}]}));async function w(){await new Promise(e=>{setTimeout(e,1e3)}),d(e=>{if(r.value){const l=r.value.map(t=>({dbtime:t.dbtime,prePower:t.prePower,power:t.power,zfsd:t.zfsd,ssrd:t.ssrd}));e.xAxis.data=l.map(t=>t.dbtime),e.series[0].data=l.map(t=>[t.dbtime,t.power]),e.series[1].data=l.map(t=>[t.dbtime,t.prePower]),e.series[2].data=l.map(t=>[t.dbtime,t.zfsd]),e.series[3].data=l.map(t=>[t.dbtime,t.ssrd])}return e})}G(()=>r.value,e=>{v(l=>{if(r.value){const t=r.value.map(i=>({dbtime:i.dbtime,prePower:i.prePower,power:i.power,zfsd:i.zfsd,ssrd:i.ssrd}));l.xAxis.data=t.map(i=>i.dbtime),l.series[0].data=t.map(i=>[i.dbtime,i.power]),l.series[1].data=t.map(i=>[i.dbtime,i.prePower]),l.series[2].data=t.map(i=>[i.dbtime,i.zfsd]),l.series[3].data=t.map(i=>[i.dbtime,i.ssrd])}return l})});function x(){d((e,l)=>{const t=l();return e.legend.data=t.legend.data,e.series[0].name=t.series[0].name,e.series[1].name=t.series[1].name,e})}async function n(){w()}return G(()=>N.locale,()=>{x()}),n(),(e,l)=>(L(),q("div",{ref_key:"domRef",ref:M,class:"h-100% overflow-hidden"},null,512))}}),Ue=F(je,[["__scopeId","data-v-969cbb27"]]),qe=E({name:"LineChart",__name:"weather-chart",props:{data:{type:Array,default:[]}},setup(D){const a=D,C=J(),r=Date.now(),N=new Date(r).setHours(23,59,59,999),{domRef:p,updateOptions:m,showLoading:M,updateOptionsAsync:d}=ne(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(n){return te(n,"°C")},backgroundColor:"#6a7985",textStyle:{color:"#fff"}},legend:{data:["环境温度","预测温度","组件温度"]},grid:{left:"2%",right:"5%",bottom:"10%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd} {HH}:{mm}"},max:N+60*1e3,data:[]},yAxis:{name:"温度(°C)",type:"value",axisLabel:{formatter:"{value} °C"}},series:[{color:"#27ae60",name:"环境温度",type:"line",lineStyle:{width:1},smooth:!0,showSymbol:!1,areaStyle:{color:new O(0,0,0,1,[{offset:0,color:"rgba(39, 174, 96,0.4)"},{offset:1,color:"rgba(39, 174, 96,0)"}],!1),shadowColor:"rgba(39, 174, 96,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#c0392b",name:"预测温度",type:"line",lineStyle:{width:1},smooth:!0,showSymbol:!1,areaStyle:{color:new O(0,0,0,1,[{offset:0,color:"rgba(192, 57, 43,0.3)"},{offset:1,color:"rgba(192, 57, 43,0)"}],!1),shadowColor:"rgba(192, 57, 43,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#ffa000",name:"组件温度",type:"line",lineStyle:{width:1},smooth:!0,showSymbol:!1,areaStyle:{color:new O(0,0,0,1,[{offset:0,color:"rgba(255, 160, 0,0.3)"},{offset:1,color:"rgba(255, 160, 0,0)"}],!1),shadowColor:"rgba(255, 160, 0,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0}]}));async function v(){await new Promise(n=>{setTimeout(n,1e3)}),m(n=>(a.data&&(n.xAxis.data=a.data.map(e=>e.dbtime),n.series[0].data=a.data.map(e=>[e.dbtime,e.envT]),n.series[1].data=a.data.map(e=>[e.dbtime,e.tt2]),n.series[2].data=a.data.map(e=>[e.dbtime,e.moduleT])),n))}function w(){m((n,e)=>{const l=e();return n.legend.data=l.legend.data,n.series[0].name=l.series[0].name,n.series[1].name=l.series[1].name,n.series[2].name=l.series[2].name,n})}async function x(){v()}return G(()=>C.locale,()=>{w()}),G(()=>a.data,()=>{d(n=>(a.data&&(n.xAxis.data=a.data.map(e=>e.dbtime),n.series[0].data=a.data.map(e=>[e.dbtime,e.envT]),n.series[1].data=a.data.map(e=>[e.dbtime,e.tt2]),n.series[2].data=a.data.map(e=>[e.dbtime,e.moduleT])),n))}),x(),(n,e)=>(L(),q("div",{ref_key:"domRef",ref:p,style:{height:"260px",overflow:"hidden"}},null,512))}}),Fe=F(qe,[["__scopeId","data-v-a7f99f3f"]]),le=D=>(Ne("data-v-616f4c4f"),D=D(),Pe(),D),Qe=le(()=>A("img",{src:ze,alt:"",style:{height:"140px",width:"100%","margin-bottom":"20px"}},null,-1)),Je={class:"flex items-center"},Ke=le(()=>A("div",{class:"w-80px font-size-14px text-right"},"气象站：",-1)),Xe=E({name:"home",__name:"index",setup(D){ge();const a=J(),C=U(()=>a.isMobile?0:16),r=$({stationP:0}),N=async()=>{const{data:f,error:k}=await ke();k||(r.value=f)},p=$(),m=$(),M=async()=>{var u;const{data:f,error:k}=await Ie();k||(m.value=f,m.value.length!=0&&(d.value=(u=f[0])==null?void 0:u.id,w()))},d=$(),v=$(),w=async()=>{const{data:f,error:k}=await Be({devId:d.value});k||(v.value=f)},x=f=>{d.value=f,w(),i()},n=Date.now();new Date(n).setHours(0,0,0,0),new Date(n).setHours(23,59,59,999);const e=$(),l=$(),t=$(),i=async()=>{if(!d.value)return;const{data:f,error:k}=await Le({id:d.value,startTime:ee(0,Date.now())+" 00:00:00",endTime:ee(1,Date.now())});console.log("气象实际数据",f),t.value=f,e.value.forEach(u=>{const B=t.value.find(V=>V.dbtime===u.dbtime);B?Object.assign(B,u):t.value.push(u)}),t.value=t.value.sort((u,B)=>new Date(u.dbtime).getTime()-new Date(B.dbtime).getTime())},I=$(null);be(async()=>{z(),await M(),await N(),I.value=setInterval(async()=>{},1e3*60*1)}),ve(()=>{I.value&&clearInterval(I.value),h.value&&h.value.close()});const _=ye({col:"",trs:""}),h=$(null),z=()=>{var P,W,R;if((P=h.value)==null||P.close(),!Ae("channel:status:websocket")){(W=window.$message)==null||W.destroyAll(),(R=window.$message)==null||R.warning("暂无权限连接websocket");return}const f=new Date().getTime(),k=we(),u=xe(`${k}${f}getchlstatus`),B=Z(u),V=Z("getchlstatus"),S=new Se(De+`/ChannelStatusWebsocket/${V}/${B}/${f}/${k}?token=${Ce()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});h.value=S,S.connect(),S.onclose(()=>{}),S.onerror(()=>{}),S.onopen(()=>{}),S.onmessage(H=>{if(console.log(H,"通道状态websocket接受数据"),!K(H.data))return;const c=JSON.parse(H.data).dataStatus;c&&(_.col=c.col+""=="0"||c.col+""=="1"?c.col+"":"",_.trs=c.trs+""=="0"||c.trs+""=="1"?c.trs+"":"")})},K=f=>{try{return JSON.parse(f),!0}catch{return!1}};return(f,k)=>{const u=Oe,B=We,V=Te,S=ae,P=oe,W=se,R=$e,H=Me;return L(),j(H,{vertical:"",size:16,class:"h-100% home","item-style":{height:"100%"}},{default:s(()=>[o(W,{"y-gap":C.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:s(()=>[o(P,{span:"24 s:24 m:24"},{default:s(()=>[o(S,{title:"",bordered:!1,class:"card-wrapper h-100% bg-transparent","content-style":{padding:"0px"}},{default:s(()=>[o(W,{"x-gap":C.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:s(()=>[o(P,{span:"24 s:24 m:6"},{default:s(()=>[o(S,{title:"电场实时数据",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"12px"},"content-style":{padding:"12px",paddingTop:"0px",display:"flex",flexDirection:"column"}},{"header-extra":s(()=>[g(" 运行状态："+b(r.value.stationP&&r.value.stationP>0&&r.value.stationControlled==0?"并网运行":r.value.stationP&&r.value.stationP>0&&r.value.stationControlled==1?"降额运行":r.value.stationP==0?"待机":""),1)]),default:s(()=>[Qe,o(V,{trigger:"none"},{default:s(()=>[o(B,{bordered:"",column:1,"label-placement":"left",size:"small",class:"flex-1","content-style":{minWidth:"100px"}},{default:s(()=>[o(u,null,{label:s(()=>[g(" 最后更新时间 ")]),default:s(()=>[g(" "+b(r.value.dbtime||"-"),1)]),_:1}),o(u,null,{label:s(()=>{var c,y;return[g(" 总有功功率"+b((c=p.value)!=null&&c.StationP?` (${(y=p.value)==null?void 0:y.StationP})`:"(MW)"),1)]}),default:s(()=>[g(" "+b(r.value.stationP??"-"),1)]),_:1}),o(u,null,{label:s(()=>{var c,y;return[g(" 总无功功率"+b((c=p.value)!=null&&c.StationQ?` (${(y=p.value)==null?void 0:y.StationQ})`:"(MVar)"),1)]}),default:s(()=>[g(" "+b(r.value.stationQ??"-"),1)]),_:1}),o(u,null,{label:s(()=>{var c,y,X;return[g(" 总功率因数"+b(((c=p.value)==null?void 0:c.StationCOS)=="-"?"":(y=p.value)!=null&&y.StationCOS?`
                        (${(X=p.value)==null?void 0:X.StationCOS})`:""),1)]}),default:s(()=>[g(" "+b(r.value.stationCOS??"-"),1)]),_:1}),o(u,null,{label:s(()=>{var c,y;return[g(" 日发电量"+b((c=p.value)!=null&&c.StationDayE?` (${(y=p.value)==null?void 0:y.StationDayE})`:"(MWh)"),1)]}),default:s(()=>[g(" "+b(r.value.stationDayE??"-"),1)]),_:1}),o(u,null,{label:s(()=>{var c,y;return[g(" 总发电量"+b((c=p.value)!=null&&c.StationTotalE?` (${(y=p.value)==null?void 0:y.StationTotalE})`:"(MWh)"),1)]}),default:s(()=>[g(" "+b(r.value.stationTotalE??"-"),1)]),_:1}),o(u,null,{label:s(()=>[g(" 是否限电 ")]),default:s(()=>[A("span",null,b(r.value.stationControlled==1?"是":"否"),1)]),_:1}),o(u,null,{label:s(()=>[g(" 数据接入状态 ")]),default:s(()=>[A("span",{class:Q({success:_.col=="0",error:_.col=="1",default:_.col!="0"&&_.col!="1"})},null,2)]),_:1}),o(u,null,{label:s(()=>[g(" 数据上报状态 ")]),default:s(()=>[A("span",{class:Q({success:_.trs=="0",error:_.trs=="1",default:_.trs!="0"&&_.trs!="1"})},null,2)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(P,{span:"24 s:24 m:18"},{default:s(()=>[o(S,{title:"今日预测功率",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"10px",paddingTop:"0px"}},{default:s(()=>[o(Ue,{data:l.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1}),o(P,{span:"24 s:24 m:24"},{default:s(()=>[o(S,{title:"",bordered:!0,class:"card-wrapper h-100%","content-style":{padding:"0px"}},{default:s(()=>[o(W,{"x-gap":C.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:s(()=>[o(P,{span:"24 s:24 m:6"},{default:s(()=>[o(S,{title:"气象数据",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"12px",paddingBottom:"0px"},"content-style":{padding:"0px"}},{"header-extra":s(()=>[A("div",Je,[Ke,o(R,{filterable:"",placeholder:"请选择气象站",value:d.value,"onUpdate:value":k[0]||(k[0]=c=>d.value=c),options:m.value,"label-field":"sname","value-field":"id",style:{width:"140px"},onUpdateValue:x},null,8,["value","options"])])]),default:s(()=>[o(Re,{MeteorologicalData:v.value},null,8,["MeteorologicalData"])]),_:1})]),_:1}),o(P,{span:"24 s:24 m:18"},{default:s(()=>[o(S,{title:"今日实时气象",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"0px",paddingTop:"0px"}},{default:s(()=>[o(Fe,{data:t.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1})]),_:1},8,["y-gap"])]),_:1})}}}),oa=F(Xe,[["__scopeId","data-v-616f4c4f"]]);export{oa as default};
