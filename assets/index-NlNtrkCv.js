import{d as K,n as J,p as Z,s as X,o as Y,c as ee,w as t,g as a,h as o,t as c,i as v,$ as V,F as le,aG as te,aw as W,ax as ae,Z as ne,J as oe,B as U,N as q,O as se,ad as Q,a3 as ie,j as x,r as G,A as de,e as re,aj as ue,S as pe,ar as ce,P as me,Q as fe,f as ge,R as _e}from"./index-BF7dU-0f.js";import{_ as ve,l as he}from"./lodash-zJARg_eT.js";import{_ as ye}from"./round-search-aES8HRW1.js";import{_ as be}from"./round-refresh-TZNthhfW.js";import{_ as Ie}from"./Cascader-DjAsVNur.js";import{_ as xe}from"./FormItemGridItem-Cp0EomyE.js";import{_ as Le}from"./DatePicker-CIhnAliK.js";import{_ as Se}from"./Grid-DJ0r_XUE.js";import{x as Ce,y as we}from"./events-K2tQhl3p.js";import{c as Ee}from"./common-mT3-MsvH.js";import{e as De}from"./exportExcel-D6OyA9oJ.js";import{_ as ke,a as Ne}from"./DescriptionsItem-Cj1GiEqX.js";import"./TimePicker-BhK5Pz3O.js";import"./defineProperty-BYFtzDRm.js";const Ae={0:"KERN",1:"USER",2:"MAIL",3:"DAEMON",4:"AUTH",5:"SYSYLOG",6:"LPR",7:"NEWS",8:"UUCP",9:"CRON",10:"AUTHPRIV",11:"FTP",12:"RESERVED_12",13:"RESERVED_13",14:"RESERVED_14",15:"RESERVED_15",16:"LOCAL0",17:"LOCAL1",18:"LOCAL2",19:"LOCAL3",20:"LOCAL4",21:"LOCAL5",22:"LOCAL6",23:"LOCAL7"},Re={0:"EMERGENCY",1:"ALERT",2:"CRITICAL",3:"ERROR",4:"WARNING",5:"NOTICE",6:"INFO",7:"DEBUG"},j={logModel:Ae,logLevel:Re},Te=K({name:"FormSearch",__name:"form-search",props:J(["LogSourceDeviceList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:J(["search"],["update:model"]),setup(h,{emit:g}){const R=p=>Object.entries(p).map(([u,b])=>({label:b,value:u})),D={logLevel:R(j.logLevel),logModel:R(j.logModel)},L=h,z=g,{formRef:w,restoreValidation:y}=Z(),e=X(h,"model");async function r(p,u){p&&p.length>0?(e.value.startTime=p[0],e.value.endTime=p[1]):(e.value.startTime=void 0,e.value.endTime=void 0),n()}async function k(){await y(),e.value.lsid=null,e.value.leid=null,e.value.lmid=null,e.value.timeRange=null,e.value.startAndEndIp=null,te(()=>{z("search")})}const E=()=>{e.value.startAndEndIp=null,n()};async function n(){var p,u,b,f;if(e.value.startAndEndIp&&e.value.startAndEndIp.length>0?(e.value.startIp=e.value.startAndEndIp[0]||null,e.value.endIp=e.value.startAndEndIp[1]||null):(e.value.startIp=void 0,e.value.endIp=void 0),e.value.startIp&&!W(e.value.startIp)||e.value.endIp&&!W(e.value.endIp))return(p=window.$message)==null||p.destroyAll(),(u=window.$message)==null||u.error("请输入正确的IP地址"),!1;if(e.value.startIp&&e.value.endIp&&ae(e.value.startIp,e.value.endIp)>0)return(b=window.$message)==null||b.destroyAll(),(f=window.$message)==null||f.error("起始IP不能大于终止IP"),!1;z("search")}const N=ve.debounce(n,1e3,{leading:!0,trailing:!1});return(p,u)=>{const b=Ie,f=xe,S=ne,B=Le,T=oe,H=be,M=U,I=ye,F=q,l=Se,s=se,m=Q;return Y(),ee(m,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[a(s,{ref_key:"formRef",ref:w,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:le(v(N),["enter"])},{default:t(()=>[a(l,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:t(()=>[a(f,{span:"24 s:24 m:8 l:8",label:"日志源设备",path:"lsid"},{default:t(()=>[a(b,{value:e.value.lsid,"onUpdate:value":[u[0]||(u[0]=d=>e.value.lsid=d),n],placeholder:"请选择日志源设备",options:L.LogSourceDeviceList,disabled:L.logsoudev,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options","disabled"])]),_:1}),a(f,{span:"24 s:24 m:8 l:8",label:"级别",path:"leid"},{default:t(()=>[a(S,{filterable:"",clearable:"",placeholder:"请选择级别",value:e.value.leid,"onUpdate:value":[u[1]||(u[1]=d=>e.value.leid=d),n],options:D.logLevel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(f,{span:"24 s:24 m:8 l:8",label:"日志模块",path:"lmid"},{default:t(()=>[a(S,{filterable:"",clearable:"",placeholder:"请选择日志模块",value:e.value.lmid,"onUpdate:value":[u[2]||(u[2]=d=>e.value.lmid=d),n],options:D.logModel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(f,{span:"24 s:24 m:12 l:8",label:"时间",path:"time"},{default:t(()=>[a(B,{value:e.value.timeRange,"onUpdate:value":u[3]||(u[3]=d=>e.value.timeRange=d),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":r},null,8,["value"])]),_:1}),a(f,{s:"",span:"24 s:24 m:12 l:8",label:"IP",path:"startAndEndIp"},{default:t(()=>[a(T,{pair:"",separator:"-",placeholder:["发生源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndIp,"onUpdate:value":u[4]||(u[4]=d=>e.value.startAndEndIp=d),disabled:L.logsoudev,onClear:E},null,8,["value","disabled"])]),_:1}),a(f,{span:"24 s:24 m:8 l:8",label:" "},{default:t(()=>[a(F,{class:"w-full"},{default:t(()=>[a(M,{onClick:k},{icon:t(()=>[a(H,{class:"text-icon"})]),default:t(()=>[o(" "+c(v(V)("common.reset")),1)]),_:1}),a(M,{type:"primary",ghost:"",onClick:v(N)},{icon:t(()=>[a(I,{class:"text-icon"})]),default:t(()=>[o(" "+c(v(V)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Me=h=>(me("data-v-cd835aa4"),h=h(),fe(),h),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Pe=Me(()=>ge("hr",{style:{"border-color":"#ccc","margin-bottom":"20px"}},null,-1)),$e=K({name:"eventalarm_generallog",__name:"index",props:{logsoudev:{},aip:{}},setup(h){const g=h,R=ie(),D=x(window.innerHeight-395),L=x([]);(async()=>{const{data:l,error:s}=await Ee();s||(L.value=l.map(m=>({...m,id:"-"+m.id,type:m.cname})))})();const w=x(!1),y=j,e=G({lsid:void 0,lsdn:"",rdbtime:"",lmid:void 0,leid:void 0,ltext:"",aname:"",procid:"",msgid:"",dbtime:"",hname:"",lcon:"",ip:"",lsip:"",priority:"",type:"",version:"",logtype:void 0,index:0}),r=G({pageId:void 0,pageSize:100,lsid:void 0,leid:void 0,lmid:void 0,startTime:void 0,endTime:void 0,startIp:void 0,endIp:void 0,_t:new Date().getTime()}),k=G([{title:"",key:"index",width:80,align:"center",render:l=>`${l.index}`},{key:"type",title:"设备类型",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"hname",title:"主机名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"rdbtime",title:"接收时间",align:"center",width:160,render:l=>l.rdbtime},{key:"lmid",title:"模块",align:"center",width:160,ellipsis:{tooltip:!0},render:l=>!l.lmid===void 0||l.lmid===null?"":y.logModel[l.lmid]},{key:"leid",title:"级别",align:"center",width:120,ellipsis:{tooltip:!0},render:l=>l.leid===void 0||l.leid===null?"":y.logLevel[l.leid]},{key:"ipaddr",title:"发生源IP",align:"center",width:180},{key:"ltext",title:"日志原文",align:"center",width:320,ellipsis:!0,render:l=>a("span",null,[l.logtype?l.ltext:l.ltext+l.lcon])},{key:"operate",title:V("common.operate"),align:"center",width:120,fixed:"right",render:l=>a("div",{class:"flex-center gap-8px"},[a(U,{type:"info",ghost:!0,size:"small",onClick:()=>b(l)},{default:()=>[o("详情")]})])}]),E=x(!1),n=x([]),N=x(0),p=async(l=!1)=>{if(!E.value)E.value=!0;else return;g.logsoudev&&g.aip&&(S.value=!1,r.lsid=g.logsoudev,r.startAndEndIp=[g.aip,g.aip],r.startIp=g.aip,r.endIp=g.aip);const{data:s,error:m}=await Ce(r);m||(N.value=s.length,l?n.value=[...n.value,...s]:n.value=s,n.value=n.value.map((d,C)=>(d.index=C+1,d)),E.value=!1)},u=async()=>{const{data:l,error:s}=await we({_t:new Date().getTime()});I.total=Number(l),I.itemCount=Number(l)};function b(l){e.lsid=l.lsid,e.lsdn=l.lsdn,e.rdbtime=l.rdbtime,e.lmid=l.lmid,e.leid=l.leid,e.ltext=l.ltext,e.aname=l.aname,e.procid=l.procid,e.msgid=l.msgid,e.dbtime=l.dbtime,e.hname=l.hname,e.lcon=l.lcon,e.ip=l.ip,e.lsip=l.lsip,e.priority=l.priority,e.type=l.type,e.version=l.version,e.logtype=l.logtype,w.value=!0}const f=x(),S=x(!0),B=async()=>{n.value=[],r.lsid||r.leid||r.lmid||r.startIp||r.endIp||r.startTime||r.endTime?S.value=!1:(S.value=!0,u()),r.pageId=void 0,await p(),T()},T=async()=>{var l,s;if(n.value.length<D.value/44&&n.value.length<I.total){if(r.pageId==n.value[n.value.length-1].id)return;r.pageId=((s=(l=n.value)==null?void 0:l[n.value.length-1])==null?void 0:s.id)??void 0,p(!0)}};de(async()=>{await p(),await u(),T()});function H(l){Math.abs(l.target.scrollTop+l.target.offsetHeight-l.target.scrollHeight)<=20&&I.total>n.value.length&&M()}const M=he.debounce(()=>{var l,s;if(n.value.length<I.total){if(r.pageId==n.value[n.value.length-1].id)return;r.pageId=((s=(l=n.value)==null?void 0:l[n.value.length-1])==null?void 0:s.id)??void 0,p(!0)}},300),I=G({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:l,endIndex:s,page:m,pageSize:d,pageCount:C,itemCount:i}){return`已加载${n.value.length}条`+(n.value.length?S.value?` 共计 ${n.value.length>0?i??0:0} 条`:N.value==r.pageSize?"  预计还有更多":"  没有更多了":"")}});async function F(){if(!n.value.length)return;const l=JSON.parse(JSON.stringify(n.value)),s=[];l.forEach(d=>{const C={};k.forEach(i=>{var O,P,$;if(d.hasOwnProperty(i.key)){const _=i.key==="lmid"?((O=y.logModel)==null?void 0:O[d[i.key]])??null:i.key==="leid"?((P=y.logLevel)==null?void 0:P[d[i.key]])??null:i.key==="lsid"?($=L.value.map(A=>A.data).flat(2).find(A=>A.id==d[i.key]))==null?void 0:$.type:i.key=="ltext"?d.ltext+d.lcon:d[i.key];C[i.title]=_}}),s.push(C)}),De(s,500,[{wpx:180},{wpx:120},{wpx:160},{wpx:80},{wpx:80},{wpx:100},{wpx:400}],"通用日志_"+new Date().getTime())}return(l,s)=>{const m=q,d=ue,C=Q,i=ke,O=Ne,P=pe,$=ce;return Y(),re("div",Oe,[a(Te,{model:r,"onUpdate:model":s[0]||(s[0]=_=>r=_),onSearch:B,LogSourceDeviceList:L.value,logsoudev:g.logsoudev},null,8,["model","LogSourceDeviceList","logsoudev"]),a(C,{title:"通用日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[a(m,null,{default:t(()=>[a(v(U),{type:"primary",size:"small",ghost:"",onClick:F,title:"导出已加载"},{default:t(()=>[o("导出已加载")]),_:1})]),_:1})]),default:t(()=>[a(d,{ref_key:"tableContainerRef",ref:f,columns:k,data:n.value,size:"small","flex-height":!v(R).isMobile,"scroll-x":k.reduce((_,A)=>_+A.width,0),loading:E.value,remote:"","row-key":_=>_.index,showTotal:"","max-height":D.value,"virtual-scroll":"",pagination:I,class:"sm:h-full",onScroll:H},null,8,["columns","data","flex-height","scroll-x","loading","row-key","max-height","pagination"])]),_:1}),a($,{show:w.value,"onUpdate:show":s[2]||(s[2]=_=>w.value=_),title:"日志详情",preset:"card",class:"w-800px"},{footer:t(()=>[a(m,{justify:"end",size:16},{default:t(()=>[a(v(U),{type:"primary",onClick:s[1]||(s[1]=_=>{w.value=!1})},{default:t(()=>[o(c(v(V)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[Pe,a(P,{class:"h-480px pr-20px"},{default:t(()=>[a(O,{"label-placement":"left","label-style":{width:"120px"},bordered:"",column:1},{default:t(()=>[a(i,null,{label:t(()=>[o(" 设备类型 ")]),default:t(()=>[o(" "+c(e.type),1)]),_:1}),a(i,null,{label:t(()=>[o(" 接收时间 ")]),default:t(()=>[o(" "+c(e.rdbtime),1)]),_:1}),a(i,null,{label:t(()=>[o(" 模块 ")]),default:t(()=>[o(" "+c(v(y).logModel[e.lmid]),1)]),_:1}),a(i,null,{label:t(()=>[o(" 级别 ")]),default:t(()=>[o(" "+c(v(y).logLevel[e.leid]),1)]),_:1}),a(i,null,{label:t(()=>[o(" 应用名称 ")]),default:t(()=>[o(" "+c(e.aname),1)]),_:1}),a(i,null,{label:t(()=>[o(" PROCID ")]),default:t(()=>[o(" "+c(e.procid),1)]),_:1}),a(i,null,{label:t(()=>[o(" MSGID ")]),default:t(()=>[o(" "+c(e.msgid||"--"),1)]),_:1}),a(i,null,{label:t(()=>[o(" 日志时间 ")]),default:t(()=>[o(" "+c(e.dbtime),1)]),_:1}),a(i,null,{label:t(()=>[o(" 主机名称 ")]),default:t(()=>[o(" "+c(e.hname),1)]),_:1}),a(i,null,{label:t(()=>[o(" 结构数据 ")]),default:t(()=>[o(" -- ")]),_:1}),a(i,null,{label:t(()=>[o(" 日志内容 ")]),default:t(()=>[o(" "+c(e.lcon),1)]),_:1}),a(i,{span:2},{label:t(()=>[o(" 日志原文 ")]),default:t(()=>[o(" "+c(e.logtype?e.ltext:e.ltext+e.lcon),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),Ze=_e($e,[["__scopeId","data-v-cd835aa4"]]);export{Ze as default};
