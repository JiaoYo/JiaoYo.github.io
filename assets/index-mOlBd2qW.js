import{_ as ne}from"./round-add-CcJ-eWvp.js";import{d as ee,aE as se,n as le,ar as re,aG as ie,m as te,H as U,bY as ce,c as B,o as b,Z as ae,w as l,f as e,C as de,A as ue,aD as pe,h as s,z as oe,B as k,g as I,t as q,$ as T,cs as me,aO as Z,b4 as fe,aS as _e,aC as J,i as he,q as V,b as Q,s as A,aT as K,cO as ge,y as z,aH as ye,dN as ve,dO as we,aY as be,am as ke}from"./index-CbkGmsUT.js";import{u as Se,a as xe}from"./table-CST65CZ1.js";import{_ as Te,d as je}from"./drawerLog-C6hoI_AF.js";import{_ as De}from"./round-search-opoHbQsz.js";import{u as W}from"./usePageData-CtVI6YRj.js";import{_ as Ce}from"./Grid-CyaoSB-i.js";import{_ as Pe}from"./FormItemGridItem-D8sOQ-r2.js";import{N as Ne}from"./Popconfirm-CfoHIMzd.js";import"./text-B1ImycHA.js";const ze=ee({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:se(["reset","search","clear"],["update:model"]),setup(_,{emit:L}){const h=L,{formRef:E}=le(),j=re("pname"),r=ie(_,"model"),H=te(),i=U([]),{pageData:m,getData:f,nextPage:g}=W(me),O=async a=>{const t=a.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&m.data.length<m.total&&(await g(),i.value=m.data,await Z(),setTimeout(()=>{t.scrollTop=c}))},{pageData:v,getData:y,nextPage:S}=W(fe),R=async a=>{const t=a.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&v.data.length<v.total&&(await S(),i.value=v.data,await Z(),setTimeout(()=>{t.scrollTop=c}))},$=async a=>{r.value.creater=a,h("search")},D=async a=>{var t,c;a?(r.value.pid=a,h("search"),H.setProjectInfo({pname:(t=i.value.find(p=>p.id==a))==null?void 0:t.proname,pid:a}),j.value=(c=i.value.find(p=>p.id==a))==null?void 0:c.proname):h("search")},F=ce.debounce(async a=>{await f({fuzzy:a,page:1}),i.value=m.data},300),x=a=>{if(!a){r.value.pid=null,C();return}F(a)},C=async()=>{await f({page:1}),i.value=m.data};(async()=>{await f(),i.value=m.data,h("search")})(),y({usertypes:"2,3"});async function P(){h("search")}return(a,t)=>{const c=pe,p=Pe,o=De,n=k,d=oe,N=Ce,G=de,M=ae;return b(),B(M,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[e(G,{ref_key:"formRef",ref:E,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ue(P,["enter"])},{default:l(()=>[e(N,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[e(p,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:l(()=>[e(c,{filterable:"",clearable:"",value:r.value.pid,"onUpdate:value":[t[0]||(t[0]=w=>r.value.pid=w),D],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:i.value,onScroll:O,onClear:C,onSearch:x},null,8,["value","options"])]),_:1}),e(p,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:l(()=>[e(c,{clearable:"",filterable:"",value:r.value.creater,"onUpdate:value":[t[1]||(t[1]=w=>r.value.creater=w),$],placeholder:"请选择","label-field":"username","value-field":"id",options:s(v).data,onScroll:R},null,8,["value","options"])]),_:1}),e(p,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[e(d,{class:"w-full"},{default:l(()=>[e(n,{type:"primary",ghost:"",onClick:P},{icon:l(()=>[e(o,{class:"text-icon"})]),default:l(()=>[I(" "+q(s(T)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ue={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Be={key:0};function X(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!be(_)}const Ve=ee({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0}},emits:["thereIsData"],setup(_,{expose:L,emit:h}){const E=_e(),j=te(),r=_,H=U("");ke("pname",H);const i=h,{columns:m,data:f,getData:g,loading:O,mobilePagination:v,searchParams:y}=Se({showTotal:!0,immediate:!1,apiFn:ve,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:o=>e("div",null,[o.username+"的项目总结"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:T("common.operate"),align:"center",width:140,fixed:"right",render:o=>{let n;return e("div",{class:"flex-center gap-8px"},[e(k,{type:"primary",ghost:!0,size:"small",onClick:()=>c(o)},{default:()=>[I("查看详情")]}),j.userInfo.id==o.creater&&z(e(k,{type:"primary",ghost:!0,size:"small",onClick:()=>P(o.id)},X(n=T("common.edit"))?n:{default:()=>[n]}),[[V("no-auth"),"project:Summary:update"]]),j.userInfo.id==o.creater&&e(Ne,{onPositiveClick:()=>Y(o.id)},{default:()=>T("common.confirmDelete"),trigger:()=>{let d;return z(e(k,{type:"error",ghost:!0,size:"small"},X(d=T("common.delete"))?d:{default:()=>[d]}),[[V("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:S,operateType:R,editingData:$,handleAdd:D,handleEdit:F,checkedRowKeys:x,onDeleted:C}=xe(f,g);async function Y(o){const{data:n,error:d}=await we(o);d||C()}function P(o){F(o)}const a=U(!1),t=U({}),c=o=>{a.value=!0,t.value=o},p=()=>{g()};return J(()=>r.pid,async o=>{o&&(y.pid=o)}),J(()=>f.value,async o=>{o.length>0?i("thereIsData",1):i("thereIsData",0)}),he(()=>{}),L({getData:g}),(o,n)=>{const d=oe,N=ne,G=ye,M=ae,w=V("no-auth");return b(),Q("div",Ue,[r.pid?A("",!0):(b(),B(ze,{key:0,model:s(y),"onUpdate:model":n[0]||(n[0]=u=>K(y)?y.value=u:null),onReset:p,onSearch:s(g),onClear:n[1]||(n[1]=u=>f.value=[])},null,8,["model","onSearch"])),e(M,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},ge({header:l(()=>[e(d,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>[r.pid?A("",!0):(b(),Q("div",Be,"项目总结"))]),_:1}),r.pid?z((b(),B(s(k),{key:0,onClick:s(D),size:"small",ghost:"",type:"primary"},{icon:l(()=>[e(N,{class:"text-icon"})]),default:l(()=>[n[5]||(n[5]=I(" "+q("新增")))]),_:1,__:[5]},8,["onClick"])),[[w,"project:Summary:insert"]]):A("",!0)]),default:l(()=>[e(G,{"checked-row-keys":s(x),"onUpdate:checkedRowKeys":n[2]||(n[2]=u=>K(x)?x.value=u:null),columns:s(m),data:s(f),size:"small","flex-height":!s(E).isMobile,loading:s(O),remote:"","row-key":u=>u.id,pagination:s(v),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Te,{visible:s(S),"onUpdate:visible":n[3]||(n[3]=u=>K(S)?S.value=u:null),onSubmitted:s(g),"operate-type":s(R),pid:r.pid||s(y).pid,"row-data":s($)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),e(je,{visible:a.value,"onUpdate:visible":n[4]||(n[4]=u=>a.value=u),"row-data":t.value},null,8,["visible","row-data"])]),_:2},[r.pid?void 0:{name:"header-extra",fn:l(()=>[e(d,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[z((b(),B(s(k),{onClick:s(D),size:"small",ghost:"",type:"primary"},{icon:l(()=>[e(N,{class:"text-icon"})]),default:l(()=>[n[6]||(n[6]=I(" "+q("新增")))]),_:1,__:[6]},8,["onClick"])),[[w,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{Ve as default};
