import{_ as we}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DWbOghIF.js";import{_ as Ne}from"./round-refresh-XBspyRUO.js";import{_ as Ie}from"./round-add-DEJVFNIF.js";import{_ as ke}from"./round-search-B8p9P7jA.js";import{d as ee,p as X,k as T,q as se,r as oe,s as De,v as xe,ab as ce,ag as pe,b as Ce,$ as D,z as Q,o as K,c as Y,w as t,g as e,h as S,t as V,i as n,A as H,D as Me,C as Se,f as Ue,b9 as $e,ba as Ae,ak as te,L as me,aI as qe,aU as Oe,P as W,aV as ze,Q as ie,B as O,aJ as re,aF as _e,aK as ve,e as fe,aE as Z,ao as Te,ai as Ve,bb as Pe,b7 as Be,x as Ee,bc as Re,af as le,aN as ne,aO as Le,aS as je,aT as Fe,a6 as Ge}from"./index-B7o72uKK.js";import{u as Ke,a as Je}from"./table-BjEG_9Hq.js";import{_ as de}from"./FormItemGridItem-DM3pi6_Z.js";import{_ as ue}from"./Grid-WoSeATVI.js";import{y as Qe}from"./common-C0nu0xAh.js";import{N as He}from"./Popconfirm-D167FYvb.js";import{_ as We}from"./InputGroupLabel-CI6mNWKG.js";const Xe=Ue("span",null,"批量新增：格式为（采集设备1-10）",-1),Ye=ee({__name:"add_model",props:X({operateType:{},rowData:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(N,{emit:R}){const x=T(!1),b=se(N,"visible"),g=R,p=N,l=oe(I());function I(){return{devName:"采集设备1",chlId:void 0,devCommAddr:"1",devPubAddr:"1",devValid:1,devDesc:"",reserve0:"",reserve1:""}}const P=oe({channelList:[]});async function h(){const{data:u,error:s}=await _e({type:0});s||(P.channelList=u)}async function U(){await h(),p.operateType==="edit"&&p.rowData?Object.assign(l,p.rowData):(Object.assign(l,I()),l.chlId=p.chlId||P.channelList[0].id)}const{formRef:v,validate:d,restoreValidation:$}=De();xe(),ce(()=>p.rowData,()=>{U()}),ce(b,()=>{b.value&&(pe(()=>{p.operateType==="add"&&pe(()=>{setTimeout(()=>{x.value=!0},200)})}),U(),$())});const k=()=>{b.value=!1,x.value=!1},z=async()=>{var u,s,j;if(await d(),p.operateType==="add"){let m=[],r=l.devName;if(((u=l.devName)==null?void 0:u.indexOf("-"))!=-1){let a=Math.abs(r==null?void 0:r.substring(r.lastIndexOf("-")).replace(/[^0-9]/gi,"")),o=r.split(/-(?![^-]*-)/),c=r.substring(0,r.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],_=c.replace(/[^0]/g,""),q=c,E=o[0],M=E.substring(0,E.length-E.match(/(\d+)[^0-9]*$/)[1].length),G=a-c+1;for(let i=0;i<G;i++){let w=q++,J=JSON.parse(JSON.stringify(l));J.devName=parseInt(c)==0?_.length>0?String(w).length>=_.length?M+w:M+_.substring(0,_.length-String(w).length)+w:M+w:_.length>0?w>=10?M+_.substring(0,_.length-String(w).length+1)+w:M+_.substring(0,_.length)+w:M+w,J.devCommAddr=Number(l.devCommAddr)+i,m.push(J)}}else m=[l];if(m.length>1e3){(s=window.$message)==null||s.destroyAll(),(j=window.$message)==null||j.warning("批量添加最多仅支持1000条");return}const{data:F,error:B}=await $e(m);B?console.log("error",B):(console.log("success",F),k(),g("submitted"))}else{const{data:m,error:r}=await Ae([l]);r?console.log("error",r):(console.log("success",m),k(),g("submitted"))}},C={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},L={devName:C,chlId:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},devCommAddr:C,devPubAddr:C},y=Ce(()=>({add:D("common.add"),edit:D("common.edit")})[p.operateType]);return(u,s)=>{const j=te,m=de,r=me,F=qe,B=Oe,a=W,o=ze,c=ue,_=ie,q=O,E=W,M=re,G=Q("no-space");return K(),Y(M,{show:b.value,"onUpdate:show":s[8]||(s[8]=i=>b.value=i),title:y.value,preset:"card",class:"w-30%",onAfterLeave:k},{footer:t(()=>[e(E,{size:16,justify:"center"},{default:t(()=>[e(q,{onClick:k,class:"w-100px"},{default:t(()=>[S(V(n(D)("common.cancel")),1)]),_:1}),e(q,{type:"primary",class:"w-100px",onClick:z},{default:t(()=>[S(V(n(D)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(_,{ref_key:"formRef",ref:v,model:l,rules:L,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:Se(z,["enter"])},{default:t(()=>[e(c,{responsive:"screen","item-responsive":""},{default:t(()=>[e(m,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(j,{filterable:"",placeholder:"请选择所属通道",value:l.chlId,"onUpdate:value":s[0]||(s[0]=i=>l.chlId=i),"label-field":"chlName","value-field":"id",options:P.channelList},null,8,["value","options"])]),_:1}),e(m,{span:"24 m:24",label:"设备名称",path:"devName"},{default:t(()=>[e(F,{show:x.value,placement:"right-start"},{trigger:t(()=>[H(e(r,{clearable:"",value:l.devName,"onUpdate:value":s[1]||(s[1]=i=>l.devName=i),maxlength:"64",placeholder:"请输入设备名称"},null,8,["value"]),[[G]])]),default:t(()=>[Xe]),_:1},8,["show"])]),_:1}),e(m,{span:"24 m:24",label:"通讯地址",path:"devCommAddr"},{default:t(()=>[e(r,{clearable:"",value:l.devCommAddr,"onUpdate:value":s[2]||(s[2]=i=>l.devCommAddr=i),maxlength:"50",placeholder:"请输入通讯地址"},null,8,["value"])]),_:1}),e(m,{span:"24 m:24",label:"公共地址",path:"devPubAddr"},{default:t(()=>[e(r,{clearable:"",value:l.devPubAddr,"onUpdate:value":s[3]||(s[3]=i=>l.devPubAddr=i),placeholder:"请输入公共地址"},null,8,["value"])]),_:1}),e(m,{span:"24 m:24",label:"保留0",path:"reserve0"},{default:t(()=>[e(r,{clearable:"",value:l.reserve0,"onUpdate:value":s[4]||(s[4]=i=>l.reserve0=i),placeholder:"(可空)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(m,{span:"24 m:24",label:"保留1",path:"reserve1"},{default:t(()=>[e(r,{clearable:"",value:l.reserve1,"onUpdate:value":s[5]||(s[5]=i=>l.reserve1=i),placeholder:"(可空)",style:{width:"100%"}},null,8,["value"])]),_:1}),p.operateType=="edit"?(K(),Y(m,{key:0,span:"24 m:24",label:"设备有效性",path:"devValid"},{default:t(()=>[e(o,{value:l.devValid,"onUpdate:value":s[6]||(s[6]=i=>l.devValid=i),name:"radiogroup"},{default:t(()=>[e(a,null,{default:t(()=>[e(B,{label:"是",value:1}),e(B,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):Me("",!0),e(m,{span:"24 m:24",label:"设备描述",path:"devDesc"},{default:t(()=>[e(r,{clearable:"",value:l.devDesc,"onUpdate:value":s[7]||(s[7]=i=>l.devDesc=i),placeholder:"请输入设备描述",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ze=ee({__name:"merge_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:X(["submitted"],["update:visible"]),setup(N,{emit:R}){const b=ve({0:"采集104tcp",1:"采集104udp"}),g=se(N,"visible"),p=T(null),l=T({targetDevice:void 0,EquipmentMerged:void 0}),I=()=>{},h={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}},U=T(!1);return(v,d)=>{const $=te,k=de,z=ue,C=ie,A=O,L=W,y=re;return K(),fe(Te,null,[e(y,{show:g.value,"onUpdate:show":d[3]||(d[3]=u=>g.value=u),title:"设备合并",preset:"card",class:"w-40%"},{footer:t(()=>[e(L,{size:16,justify:"center"},{default:t(()=>[e(A,{onClick:d[2]||(d[2]=u=>g.value=!1),class:"w-100px"},{default:t(()=>[S(V(v.$t("common.cancel")),1)]),_:1}),e(A,{type:"primary",class:"w-100px",onClick:I},{default:t(()=>[S(V(v.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(C,{ref_key:"formRef",ref:p,"label-width":120,"label-placement":"left",model:l.value,rules:h},{default:t(()=>[e(z,{responsive:"screen","item-responsive":""},{default:t(()=>[e(k,{span:"24 m:12",label:"目标设备",path:"targetDevice"},{default:t(()=>[e($,{filterable:"",clearable:"",placeholder:"请选择设备",value:l.value.targetDevice,"onUpdate:value":d[0]||(d[0]=u=>l.value.targetDevice=u),options:n(Z)(n(b))},null,8,["value","options"])]),_:1}),e(k,{span:"24 m:12",label:"待合并设备",path:"EquipmentMerged"},{default:t(()=>[e($,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:l.value.EquipmentMerged,"onUpdate:value":d[1]||(d[1]=u=>l.value.EquipmentMerged=u),options:n(Z)(n(b))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(y,{show:U.value,"onUpdate:show":d[4]||(d[4]=u=>U.value=u),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),et=ee({__name:"move_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:X(["submitted"],["update:visible"]),setup(N,{emit:R}){const b=ve({0:"采集104tcp",1:"采集104udp"}),g=se(N,"visible"),p=T(null),l=T({targetDevice:void 0,EquipmentMerged:void 0}),I=()=>{},h={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}};return(U,v)=>{const d=te,$=de,k=ue,z=ie,C=O,A=W,L=re;return K(),Y(L,{show:g.value,"onUpdate:show":v[3]||(v[3]=y=>g.value=y),title:"设备移动至通道",preset:"card",class:"w-40%"},{footer:t(()=>[e(A,{size:16,justify:"center"},{default:t(()=>[e(C,{onClick:v[2]||(v[2]=y=>g.value=!1),class:"w-100px"},{default:t(()=>[S(V(U.$t("common.cancel")),1)]),_:1}),e(C,{type:"primary",class:"w-100px",onClick:I},{default:t(()=>[S(V(U.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(z,{ref_key:"formRef",ref:p,"label-width":120,"label-placement":"left",model:l.value,rules:h},{default:t(()=>[e(k,{responsive:"screen","item-responsive":""},{default:t(()=>[e($,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:t(()=>[e(d,{filterable:"",clearable:"",placeholder:"请选择通道",value:l.value.targetDevice,"onUpdate:value":v[0]||(v[0]=y=>l.value.targetDevice=y),options:n(Z)(n(b))},null,8,["value","options"])]),_:1}),e($,{span:"24 m:12",label:"待移动设备",path:"EquipmentMerged"},{default:t(()=>[e(d,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:l.value.EquipmentMerged,"onUpdate:value":v[1]||(v[1]=y=>l.value.EquipmentMerged=y),options:n(Z)(n(b))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),tt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ae(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!Le(N)}const mt=ee({name:"configsetting_collectionservices_subdevicemanagement",__name:"index",setup(N){const R=Ve(),x=oe({channelList:[],chlIdAndNameMap:{}}),{columns:b,columnChecks:g,data:p,getData:l,loading:I,mobilePagination:P,searchParams:h,resetSearchParams:U}=Ke({apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,type:0,chlId:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",fixed:"left",width:48},{key:"id",title:"设备ID",align:"center",fixed:"left",width:60},{key:"devName",title:"设备名称",align:"center",width:100},{key:"chlId",title:"所属通道",align:"center",width:140,render:a=>e("span",null,[x.chlIdAndNameMap[a.chlId]])},{key:"devDesc",title:"设备描述",align:"center",width:140,render:a=>e("span",null,[a.devDesc?a.devDesc:"无"])},{key:"devCommAddr",title:"设备通信地址",align:"center",width:140},{key:"devPubAddr",title:"设备公共地址",align:"center",width:140},{key:"devValid",title:"有效性",align:"center",width:140,render:a=>{let o;return e(Be,{type:a.devValid==0?"error":"success"},ae(o=D(Qe[a.devValid]))?o:{default:()=>[o]})}},{key:"operate",title:D("common.operate"),align:"center",width:250,fixed:"right",render:a=>{let o;return e("div",{class:"flex-center gap-8px"},[e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>B(a)},{default:()=>["采集测点管理"]}),H(e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>m(a.id)},ae(o=D("common.edit"))?o:{default:()=>[o]}),[[Q("no-auth"),"device:update"]]),H(e(He,{onPositiveClick:()=>s(a.id)},{default:()=>D("common.confirmDelete"),trigger:()=>{let c;return e(O,{type:"error",ghost:!0,size:"small"},ae(c=D("common.delete"))?c:{default:()=>[c]})}}),[[Q("no-auth"),"device:delete"]])])}}]});async function v(){var c;const{data:a,error:o}=await _e({type:0});if(!o){if(a.length==0)return(c=window.$message)==null?void 0:c.warning("暂无通道，请先添加通道");x.channelList=a,a.forEach(q=>{x.chlIdAndNameMap[q.id]=q.chlName});const _=R.currentRoute.value.query.channelId;_&&(h.chlId=Number(_)),l()}}Ee(()=>{v()});const{drawerVisible:d,operateType:$,editingData:k,handleAdd:z,handleEdit:C,checkedRowKeys:A,onBatchDeleted:L,onDeleted:y}=Je(p,l),u=()=>{l()},s=async a=>{const{data:o,error:c}=await Re({ids:a});c||y()},j=a=>{h.chlId=a,l()},m=a=>{C(a)},r=T(!1),F=T(!1),B=a=>{R.push({path:"/configsetting/collectionservices/pointmanagement",query:{channelId:a.chlId,deviceId:a.id}})};return(a,o)=>{const c=We,_=te,q=me,E=ke,M=je,G=W,i=Ie,w=Ne,J=we,ge=Fe,be=Ge,he=Q("no-space"),ye=Q("no-auth");return K(),fe("div",tt,[e(be,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(G,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(M,null,{default:t(()=>[e(c,null,{default:t(()=>[S("所属通道")]),_:1}),e(_,{filterable:"",clearable:"",placeholder:"请选择通道",value:n(h).chlId,"onUpdate:value":o[0]||(o[0]=f=>n(h).chlId=f),"label-field":"chlName","value-field":"id",options:x.channelList,onUpdateValue:j},null,8,["value","options"]),e(c,null,{default:t(()=>[S("设备名称")]),_:1}),H(e(q,{clearable:"",value:n(h).fuzzy,"onUpdate:value":o[1]||(o[1]=f=>n(h).fuzzy=f),placeholder:"请输入设备名称",style:{width:"100%"}},null,8,["value"]),[[he]]),e(n(O),{type:"primary",ghost:"",onClick:u},{icon:t(()=>[e(E,{class:le(["text-icon",{"animate-spin":n(I)}])},null,8,["class"])]),default:t(()=>[S(" "+V(n(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),"header-extra":t(()=>[e(G,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[H((K(),Y(n(O),{onClick:n(z),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(i,{class:le(["text-icon",{"animate-spin":n(I)}])},null,8,["class"])]),default:t(()=>[S(" "+V(n(D)("common.add")),1)]),_:1},8,["onClick"])),[[ye,"device:insert"]]),e(n(O),{onClick:u,size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(w,{class:le(["text-icon",{"animate-spin":n(I)}])},null,8,["class"])]),_:1}),e(J,{columns:n(g),"onUpdate:columns":o[2]||(o[2]=f=>ne(g)?g.value=f:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ge,{"checked-row-keys":n(A),"onUpdate:checkedRowKeys":o[3]||(o[3]=f=>ne(A)?A.value=f:null),columns:n(b),data:n(p),size:"small",loading:n(I),remote:"","row-key":f=>f.id,pagination:n(p).length?n(P):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Ye,{visible:n(d),"onUpdate:visible":o[4]||(o[4]=f=>ne(d)?d.value=f:null),onSubmitted:n(l),"operate-type":n($),"row-data":n(k),chlId:n(h).chlId},null,8,["visible","onSubmitted","operate-type","row-data","chlId"]),e(Ze,{visible:r.value,"onUpdate:visible":o[5]||(o[5]=f=>r.value=f)},null,8,["visible"]),e(et,{visible:F.value,"onUpdate:visible":o[6]||(o[6]=f=>F.value=f)},null,8,["visible"])]),_:1})])}}});export{mt as default};
