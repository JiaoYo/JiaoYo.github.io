import{_ as he,a as ge,b as ye,c as we}from"./edit-Cm7H8HZL.js";import{_ as xe}from"./round-search-CuHcKJND.js";import{cz as $,d as ke,p as Ce,r as y,i as be,cl as $e,x as ze,b as w,o as i,f as a,e as r,w as o,F as Se,E as J,h as s,av as We,N as je,B as k,g as _,t as v,U as R,y as S,b7 as Ne,c as h,a$ as Ae,a5 as O,a4 as Q,C as P,V as Pe,T as Le,A as D,cm as Ue,cA as De,z as Te,b8 as Be,a2 as Ee,b_ as qe,ae as Ve}from"./index-CXGXpIU7.js";import{u as Ge}from"./usePageData-psNCr24a.js";import{_ as Re}from"./Grid-CSuTco9f.js";import{_ as Fe}from"./FormItemGridItem-D31qr53-.js";import{_ as F}from"./Avatar-43FDQDU4.js";import{N as Ie}from"./Popconfirm-D1cRFhe_.js";import{_ as Ke}from"./text-7CvTD8W5.js";function Me(p){return $({url:"/projectWeek/getPage.do",method:"get",params:p})}function He(p){return $({url:"/projectWeek/insert.do",method:"post",data:p})}function Je(p){return $({url:"/projectWeek/update.do",method:"put",data:p})}function Oe(p){return $({url:"/projectWeek/delete.do",method:"delete",params:{arrIds:p}})}function Qe(p){return $({url:"/projectWeekComment/getPage.do",method:"get",params:p})}function Xe(p){return $({url:"/projectWeekComment/insert.do",method:"post",data:p})}function Ye(p){return $({url:"/projectWeekComment/delete.do",method:"delete",params:{arrIds:p}})}const Ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto p-20px"},et={style:{display:"flex",height:"100%"}},tt={key:1},nt={class:"flex items-center"},ot={class:"flex items-center"},at={class:"flex-col ml-10px"},st={class:"font-size-18px font-bold"},lt={class:"c-#868e96 font-size-14px"},it={key:0},rt={class:"mt-3 mb-3 text-gray-700 preview-text"},ct={class:"mt-3 mb-3 text-gray-700 preview-text"},ut={class:"mt-3 mb-3 text-gray-700 preview-text"},dt={key:1,class:"mt-1 flex items-center gap-3 text-sm text-gray-500"},pt=["onClick"],mt={key:0,class:"mt-4 border-t pt-3"},_t={class:"flex items-start gap-2 mb-3"},ft={class:"ml-2 flex-1"},vt={class:"flex items-center"},ht={class:"font-medium font-size-16px font-bold"},gt={class:"text-gray-600 mt-1"},yt={key:0,style:{display:"flex","justify-content":"flex-end","margin-top":"10px"}},wt=ke({name:"projectmanagement_memberlog",__name:"index",setup(p){const I=Ce(),W=y({creater:void 0}),{pageData:j,getData:X,nextPage:Y}=Ge(qe),Z=async t=>{const e=t.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&j.data.length<j.total&&Y()},ee=async t=>{W.value.creater=t,x()},te=async()=>{X({usertypes:"2,3"}),j.data=j.data.map(t=>(t.avatar="https://cdn-icons-png.flaticon.com/128/3135/3135715.png",t))},T={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},ne={content1:{required:!0,message:"请输入标题",trigger:"blur"}},B=y("add"),N=y(!1),E=y(-1),C=y([]),m=y({page:1,limit:10,total:0}),q=y(null),f=y({id:void 0,content1:"",content2:"",content3:""}),oe=t=>{m.value.page=t,x()},ae=t=>{m.value.limit=t,x()},x=async()=>{const{data:t,error:e}=await Me({page:m.value.page,limit:m.value.limit,creater:W.value.creater});t&&(C.value=t.list.map((c,l)=>(E.value!=l?c.showAll=!1:c.showAll=!0,c.showCommentSection=!1,c)),m.value.total=t.total)},se=(t,e)=>{N.value=!0,B.value="edit",f.value=JSON.parse(JSON.stringify(t)),E.value=e},le=async t=>{var l;const{data:e,error:c}=await Oe(t.id);e&&((l=window.$message)==null||l.success("删除成功"),C.value.length===1&&m.value.page>1&&m.value.page--,x())},ie=()=>{N.value=!0,B.value="add",E.value=-1},re=async()=>{var t,e,c;if(await((t=q.value)==null?void 0:t.validate()),f.value.id){const{data:l,error:u}=await Je([f.value]);l&&((e=window.$message)==null||e.success("编辑成功"))}else{const{data:l,error:u}=await He([f.value]);l&&((c=window.$message)==null||c.success("新增成功"))}await x(),K()},K=()=>{N.value=!1,f.value={id:void 0,content1:"",content2:"",content3:""}};be(async()=>{await te(),x()});const V=async t=>{const{data:e,error:c}=await Qe({page:1,limit:100,pid:t});if(e){const l=C.value.find(u=>u.id===t);l&&(l.comments=e.list)}},ce=async t=>{V(t.id),C.value.forEach(e=>{e.id!==t.id&&(e.showCommentSection=!1)}),t.showCommentSection=!t.showCommentSection,t.showCommentSection&&await de(`comment-input-${t.id}`)},ue=async(t,e)=>{var u;const{data:c,error:l}=await Ye(t.id);c&&(V(t.pid),e.num--,(u=window.$message)==null||u.success("删除成功"))},L=y({}),M=$e.debounce(async t=>{var u,b;const e=L.value[t.id];if(!(e!=null&&e.trim()))return(u=window.$message)==null?void 0:u.warning("请输入评论内容");const{data:c,error:l}=await Xe([{pid:t.id,content:e}]);c&&((b=window.$message)==null||b.success("评论成功"),L.value[t.id]="",t.num++,V(t.id))},1e3,{leading:!0,trailing:!1});async function de(t,e=8,c=30){var u;await Ee();for(let b=0;b<e;b++){const g=document.querySelector(`#${t} textarea`);if(g&&typeof g.focus=="function"){g.focus();const z=g.value;if(z&&g.setSelectionRange){const U=z.length;g.setSelectionRange(U,U)}return!0}await new Promise(z=>setTimeout(z,c))}const l=document.getElementById(t);return l&&(l.tabIndex=-1,(u=l.focus)==null||u.call(l)),!1}return(t,e)=>{const c=Fe,l=xe,u=je,b=Re,g=Se,z=we,U=he,pe=ge,me=ye,H=Ie,_e=De,G=Te,fe=Be,A=ze("no-auth");return i(),w("div",Ze,[a(s(R),{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[a(g,{ref_key:"formRef",ref:q,model:W.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:J(x,["enter"])},{default:o(()=>[a(b,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[a(c,{span:"24 s:12 m:6",label:"调试人员",path:"pid"},{default:o(()=>[a(s(We),{clearable:"",filterable:"",value:W.value.creater,"onUpdate:value":[e[0]||(e[0]=n=>W.value.creater=n),ee],placeholder:"请选择","label-field":"username","value-field":"id",options:s(j).data,onScroll:Z},null,8,["value","options"])]),_:1}),a(c,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[a(u,{class:"w-full"},{default:o(()=>[a(s(k),{type:"primary",ghost:"",onClick:x},{icon:o(()=>[a(l,{class:"text-icon"})]),default:o(()=>[_(" "+v(t.$t("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),r("div",et,[a(s(R),null,{header:o(()=>e[7]||(e[7]=[_("项目周报")])),"header-extra":o(()=>[P((i(),h(s(k),{type:"primary",ghost:"",onClick:ie},{icon:o(()=>[a(z)]),default:o(()=>[e[8]||(e[8]=_(" 写周报 "))]),_:1,__:[8]})),[[A,"project:Week:insert"]])]),default:o(()=>[a(s(Ne),{style:{height:"calc(100vh - 350px)"}},{default:o(()=>[C.value.length?(i(),w("div",tt,[(i(!0),w(O,null,Q(C.value,(n,ve)=>(i(),h(s(R),{key:n.id,class:"mb-4",title:"",size:"small"},{default:o(()=>[r("div",nt,[r("div",ot,[n.showAll?(i(),h(U,{key:0,class:"font-size-20px mr-10px cursor-pointer",onClick:d=>n.showAll=!n.showAll},null,8,["onClick"])):(i(),h(pe,{key:1,class:"font-size-20px mr-10px cursor-pointer",onClick:d=>n.showAll=!n.showAll},null,8,["onClick"])),a(s(F),{src:T.avatar},null,8,["src"]),r("div",at,[r("span",st,v(n.username)+"的研发周报",1),r("span",lt,v(n.dbtime),1)])])]),n.showAll?(i(),w("div",it,[e[9]||(e[9]=r("h3",{class:"font-size-18px font-bold mt-2"},"本周完成：",-1)),r("div",rt,v(n.content1),1),e[10]||(e[10]=r("h3",{class:"font-size-18px font-bold mt-2"},"未完成：",-1)),r("div",ct,v(n.content2),1),e[11]||(e[11]=r("h3",{class:"font-size-18px font-bold mt-2"},"下周计划：",-1)),r("div",ut,v(n.content3),1)])):S("",!0),n.showAll?(i(),w("div",dt,[r("span",{class:"cursor-pointer hover:text-blue-500",style:Pe({color:n.showCommentSection?"#1890ff":""}),onClick:d=>ce(n)},[a(me,{class:"font-size-18px"}),_(" "+v(n.num==0?"":n.num),1)],12,pt),s(I).userInfo.id==n.creater?(i(),h(u,{key:0},{default:o(()=>[P((i(),h(s(k),{quaternary:"",type:"info",size:"small",onClick:d=>se(n,ve)},{default:o(()=>e[12]||(e[12]=[_(" 编辑 ")])),_:2,__:[12]},1032,["onClick"])),[[A,"project:Week:update"]]),a(H,{onPositiveClick:d=>le(n)},{trigger:o(()=>[P((i(),h(s(k),{quaternary:"",type:"error",size:"small"},{default:o(()=>e[13]||(e[13]=[_(" 删除 ")])),_:1,__:[13]})),[[A,"project:Week:delete"]])]),default:o(()=>[e[14]||(e[14]=_(" 确定删除吗？ "))]),_:2,__:[14]},1032,["onPositiveClick"])]),_:2},1024)):S("",!0)])):S("",!0),P((i(),h(Le,{name:"fade"},{default:o(()=>[n.showCommentSection?(i(),w("div",mt,[r("div",_t,[r("div",null,[a(s(F),{size:"small",src:T.avatar},null,8,["src"])]),a(s(D),{type:"textarea",id:`comment-input-${n.id}`,value:L.value[n.id],"onUpdate:value":d=>L.value[n.id]=d,placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:J(Ue(d=>s(M)(n),["exact","prevent"]),["enter"])},null,8,["id","value","onUpdate:value","onKeydown"]),a(s(k),{type:"primary",ghost:"",onClick:d=>s(M)(n)},{default:o(()=>e[15]||(e[15]=[_("发送")])),_:2,__:[15]},1032,["onClick"])]),(i(!0),w(O,null,Q(n.comments,d=>(i(),w("div",{key:d.id,class:"flex mb-3"},[a(s(F),{size:"small",src:T.avatar},null,8,["src"]),r("div",ft,[r("div",vt,[r("span",ht,v(d.username),1),a(s(Ke),{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:o(()=>[_(v(d.dbtime),1)]),_:2},1024),s(I).userInfo.id==d.creater?(i(),h(H,{key:0,onPositiveClick:xt=>ue(d,n)},{trigger:o(()=>[P((i(),h(s(k),{quaternary:"",type:"error",size:"small"},{default:o(()=>e[16]||(e[16]=[_(" 删除 ")])),_:1,__:[16]})),[[A,"project:Week:Comment:delete"]])]),default:o(()=>[e[17]||(e[17]=_(" 确定删除吗？ "))]),_:2,__:[17]},1032,["onPositiveClick"])):S("",!0)]),r("div",gt,v(d.content),1)])]))),128))])):S("",!0)]),_:2},1024)),[[A,"project:Week:Comment:insert"]])]),_:2},1024))),128))])):(i(),h(s(Ae),{key:0,description:"暂无信息"}))]),_:1}),C.value.length>0?(i(),w("div",yt,[a(_e,{page:m.value.page,"onUpdate:page":[e[1]||(e[1]=n=>m.value.page=n),oe],"page-size":m.value.limit,"onUpdate:pageSize":[e[2]||(e[2]=n=>m.value.limit=n),ae],"item-count":m.value.total,"show-size-picker":"","page-sizes":[10,20,50],prefix:()=>`共 ${m.value.total} 条`},null,8,["page","page-size","item-count","prefix"])])):S("",!0)]),_:1})]),a(fe,{show:N.value,"onUpdate:show":e[6]||(e[6]=n=>N.value=n),title:B.value==="add"?"新增":"编辑",preset:"card",class:"w-570px"},{footer:o(()=>[a(u,{justify:"end"},{default:o(()=>[a(s(k),{size:"small",class:"mt-16px",onClick:K},{default:o(()=>[_(v(t.$t("common.cancel")),1)]),_:1}),a(s(k),{type:"primary",size:"small",class:"mt-16px",onClick:re},{default:o(()=>[_(v(t.$t("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(g,{ref_key:"formRef",ref:q,model:f.value,rules:ne},{default:o(()=>[a(G,{label:"本周完成",path:"content1"},{default:o(()=>[a(s(D),{value:f.value.content1,"onUpdate:value":e[3]||(e[3]=n=>f.value.content1=n),type:"textarea",placeholder:"请输入内容",rows:3},null,8,["value"])]),_:1}),a(G,{label:"未完成内容",path:"content2"},{default:o(()=>[a(s(D),{value:f.value.content2,"onUpdate:value":e[4]||(e[4]=n=>f.value.content2=n),type:"textarea",placeholder:"请输入内容",rows:3},null,8,["value"])]),_:1}),a(G,{label:"下周计划",path:"content3"},{default:o(()=>[a(s(D),{value:f.value.content3,"onUpdate:value":e[5]||(e[5]=n=>f.value.content3=n),type:"textarea",placeholder:"请输入内容",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}}),At=Ve(wt,[["__scopeId","data-v-d8a2d676"]]);export{At as default};
