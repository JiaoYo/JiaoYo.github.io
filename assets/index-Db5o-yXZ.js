import{_ as ge}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DT7Xw6BF.js";import{_ as he}from"./round-delete-f0Ex9oqZ.js";import{_ as ve}from"./round-add-CR1MGL-O.js";import{d as X,aE as Q,m as ne,r as ye,H as F,bY as W,n as le,a as we,aG as se,aC as be,cB as Ce,cC as ke,c as Z,o as E,w as t,f as e,a0 as xe,C as re,h as o,aD as ie,v as H,y as ee,B as j,g as N,t as M,$ as S,a1 as Se,cu as ce,aO as ue,A as Te,Z as pe,aS as ze,i as De,q as J,b as je,aT as K,aH as Ne,x as Y,aU as Pe,e as Be,cD as te,ct as Ue,aY as $e}from"./index-K-Oe9yen.js";import{u as Fe,a as Me}from"./table-BjKQTj5z.js";import{u as de}from"./usePageData-Cn0zOp5N.js";import{_ as me}from"./Grid-Iszn1RIZ.js";import{_ as fe}from"./FormItemGridItem-B3wj0zec.js";import{_ as Re}from"./round-search-C4uw-VPp.js";import{_ as qe}from"./round-refresh-Cm__CFcQ.js";import{N as ae}from"./Popconfirm-CR5sQlbC.js";const Ie=X({name:"OperateDrawer",__name:"operate-drawer",props:Q({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(C,{emit:R}){const g=R;ne();const v=C,l=ye(i());function i(){return{pid:void 0,id:"",pname:"",pcontact:"",proposition:"",docker:""}}const b=F([]),{pageData:c,getData:d,nextPage:y}=de(ce),T=async r=>{const n=r.currentTarget,f=n.scrollTop;n.scrollTop+n.offsetHeight>=n.scrollHeight&&c.data.length<c.total&&(await y(),b.value=c.data,await ue(),setTimeout(()=>{n.scrollTop=f}))},q=async()=>{await d({page:1}),b.value=c.data},I=W.debounce(async r=>{await d({fuzzy:r,page:1}),b.value=c.data},300),z=F(!1),k=F(!1),h=r=>{if(l.pid=null,z.value=!0,k.value=!1,!r){P();return}I(r)},L=async()=>{z.value&&!k.value&&(await d({page:1}),b.value=c.data,z.value=!1)},P=async()=>{await d({page:1}),b.value=c.data},B=async r=>{l.pid=r,k.value=!0};async function A(){q(),Object.assign(l,i()),v.operateType==="edit"&&v.rowData&&Object.assign(l,v.rowData)}const{formRef:O,validate:V,restoreValidation:U}=le(),p={pid:{type:"number",required:!1,trigger:["blur","change"],message:"请选择"},pname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},pcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},u=we(()=>({add:"新增联系人",edit:"修改联系人"})[v.operateType]),s=se(C,"visible");be(s,()=>{s.value&&(A(),setTimeout(()=>{const r=document.querySelector(".n-scrollbar-content");r==null||r.scrollTo(0,0)},300),U())});function a(){s.value=!1}const m=W.debounce(async()=>{await D()},1e3,{leading:!0,trailing:!1});async function D(){var r,n;if(await V(),v.operateType==="edit"){const{data:f,error:x}=await Ce([l]);x||(a(),g("submitted"),(r=window.$message)==null||r.success("修改成功"))}else{const{data:f,error:x}=await ke([{...l}]);x||(a(),g("submitted"),(n=window.$message)==null||n.success("添加成功"))}}return(r,n)=>{const f=fe,x=me,$=re,_=xe,G=ee,_e=Se;return E(),Z(_e,{show:s.value,"onUpdate:show":n[5]||(n[5]=w=>s.value=w),title:u.value,preset:"card",class:"w-500px","mask-closable":!1,draggable:!0},{footer:t(()=>[e(G,{justify:"end",size:16},{default:t(()=>[e(o(j),{onClick:a},{default:t(()=>[N(M(o(S)("common.cancel")),1)]),_:1}),e(o(j),{type:"primary",onClick:o(m)},{default:t(()=>[N(M(o(S)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(_,{class:"pr-20px"},{default:t(()=>[e($,{ref_key:"formRef",ref:O,model:l,rules:p,"label-placement":"left","label-width":120},{default:t(()=>[e(x,{responsive:"screen","item-responsive":""},{default:t(()=>[e(f,{span:"24 m:24",label:"项目",path:"pid"},{default:t(()=>[e(o(ie),{clearable:"",filterable:"",value:l.pid,"onUpdate:value":[n[0]||(n[0]=w=>l.pid=w),B],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:P,onSearch:h,options:b.value,onScroll:T,onBlur:L},null,8,["value","options"])]),_:1}),e(f,{span:"24 m:24",label:"对接方",path:"docker"},{default:t(()=>[e(o(H),{value:l.docker,"onUpdate:value":n[1]||(n[1]=w=>l.docker=w),placeholder:"请输入"},null,8,["value"])]),_:1}),e(f,{span:"24 m:24",label:"姓名",path:"pname"},{default:t(()=>[e(o(H),{value:l.pname,"onUpdate:value":n[2]||(n[2]=w=>l.pname=w),placeholder:"请输入"},null,8,["value"])]),_:1}),e(f,{span:"24 m:24",label:"联系方式",path:"pcontact"},{default:t(()=>[e(o(H),{value:l.pcontact,"onUpdate:value":n[3]||(n[3]=w=>l.pcontact=w),placeholder:"请输入"},null,8,["value"])]),_:1}),e(f,{span:"24 m:24",label:"备注",path:"proposition"},{default:t(()=>[e(o(H),{value:l.proposition,"onUpdate:value":n[4]||(n[4]=w=>l.proposition=w),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Le=X({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["reset","search","clear"],["update:model"]),setup(C,{emit:R}){const g=R,{formRef:v,restoreValidation:l}=le(),i=se(C,"model"),b=ne(),c=F([]),{pageData:d,getData:y,nextPage:T}=de(ce),q=async p=>{const u=p.currentTarget,s=u.scrollTop;u.scrollTop+u.offsetHeight>=u.scrollHeight&&d.data.length<d.total&&(await T(),c.value=d.data,await ue(),setTimeout(()=>{u.scrollTop=s}))},I=async p=>{var u;h.value=!0,p?(i.value.pid=p,g("search"),b.setProjectInfo({pname:(u=c.value.find(s=>s.id==p))==null?void 0:u.proname,pid:p})):g("clear")},z=W.debounce(async p=>{await y({fuzzy:p,page:1}),c.value=d.data},300),k=F(!1),h=F(!1),L=p=>{if(i.value.pid=null,k.value=!0,h.value=!1,!p){B();return}z(p)},P=async()=>{k.value&&!h.value&&(await y({page:1}),c.value=d.data,g("search"),k.value=!1)},B=async()=>{await y({page:1}),c.value=d.data};(async()=>{await y({page:1}),c.value=d.data,g("search")})();async function O(){await l(),i.value.fuzzy="",g("reset")}const V=()=>{i.value.fuzzy="",g("search")};async function U(){g("search")}return(p,u)=>{const s=ie,a=fe,m=H,D=qe,r=j,n=Re,f=ee,x=me,$=re,_=pe;return E(),Z(_,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e($,{ref_key:"formRef",ref:v,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Te(U,["enter"])},{default:t(()=>[e(x,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(a,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:t(()=>[e(s,{filterable:"",clearable:"",value:i.value.pid,"onUpdate:value":[u[0]||(u[0]=G=>i.value.pid=G),I],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:c.value,onScroll:q,onClear:B,onSearch:L,onBlur:P},null,8,["value","options"])]),_:1}),e(a,{span:"24 s:12 m:6",label:"姓名",path:"fuzzy"},{default:t(()=>[e(m,{value:i.value.fuzzy,"onUpdate:value":u[1]||(u[1]=G=>i.value.fuzzy=G),placeholder:"请输入",clearable:"",onClear:V},null,8,["value"])]),_:1}),e(a,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(f,{class:"w-full"},{default:t(()=>[e(r,{onClick:O},{icon:t(()=>[e(D,{class:"text-icon"})]),default:t(()=>[N(" "+M(o(S)("common.reset")),1)]),_:1}),e(r,{type:"primary",ghost:"",onClick:U},{icon:t(()=>[e(n,{class:"text-icon"})]),default:t(()=>[N(" "+M(o(S)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function oe(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!$e(C)}const Xe=X({name:"projectmanagement_contact",__name:"index",setup(C){const R=ze(),{columns:g,columnChecks:v,data:l,getData:i,pagination:b,loading:c,mobilePagination:d,searchParams:y}=Fe({showTotal:!0,immediate:!1,apiFn:Ue,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"proname",title:"项目名称",align:"center",width:120},{key:"docker",title:"对接方",align:"center",width:120},{key:"pname",title:"姓名",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pcontact",title:"联系方式",align:"center",width:120},{key:"proposition",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:S("common.operate"),align:"center",width:140,fixed:"right",render:s=>{let a;return e("div",{class:"flex-center gap-8px"},[Y(e(j,{type:"primary",ghost:!0,size:"small",onClick:()=>O(s.id)},oe(a=S("common.edit"))?a:{default:()=>[a]}),[[J("no-auth"),"project:Contact:update"]]),e(ae,{onPositiveClick:()=>A(s.id)},{default:()=>S("common.confirmDelete"),trigger:()=>{let m;return Y(e(j,{type:"error",ghost:!0,size:"small"},oe(m=S("common.delete"))?m:{default:()=>[m]}),[[J("no-auth"),"project:Contact:delete"]])}})])}}]}),{drawerVisible:T,operateType:q,editingData:I,handleAdd:z,handleEdit:k,checkedRowKeys:h,onBatchDeleted:L,onDeleted:P}=Me(l,i);De(async()=>{});async function B(){console.log(h.value),V(h.value.join(","),s=>{L()})}async function A(s){const{data:a,error:m}=await te(s);m||P()}function O(s){k(s)}async function V(s,a){const{data:m,error:D}=await te(s);if(!D)a&&a(m);else return!1}const U=s=>{i()},p=()=>{l.value=[],b.itemCount=0},u=()=>{i()};return(s,a)=>{const m=ee,D=ve,r=he,n=ge,f=Ne,x=pe,$=J("no-auth");return E(),je("div",Oe,[e(Le,{model:o(y),"onUpdate:model":a[0]||(a[0]=_=>K(y)?y.value=_:null),onReset:u,onSearch:o(i),onClear:p},null,8,["model","onSearch"]),e(x,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(m,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>a[4]||(a[4]=[Be("div",null,"项目联系人",-1)])),_:1,__:[4]})]),"header-extra":t(()=>[e(m,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[Y((E(),Z(o(j),{onClick:o(z),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(D,{class:"text-icon"})]),default:t(()=>[a[5]||(a[5]=N(" "+M("新增")))]),_:1,__:[5]},8,["onClick"])),[[$,"project:Contact:insert"]]),e(o(ae),{onPositiveClick:B},{trigger:t(()=>[Y((E(),Z(o(j),{size:"small",ghost:"",type:"error",disabled:o(h).length==0},{icon:t(()=>[e(r,{class:Pe(["text-icon",{"animate-spin":o(c)}])},null,8,["class"])]),default:t(()=>[a[6]||(a[6]=N(" "+M("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[$,"project:Contact:delete"]])]),default:t(()=>[a[7]||(a[7]=N(" 确定要删除选中的联系人吗？ "))]),_:1,__:[7]}),e(n,{columns:o(v),"onUpdate:columns":a[1]||(a[1]=_=>K(v)?v.value=_:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(f,{"checked-row-keys":o(h),"onUpdate:checkedRowKeys":a[2]||(a[2]=_=>K(h)?h.value=_:null),columns:o(g),data:o(l),size:"small","flex-height":!o(R).isMobile,loading:o(c),remote:"","row-key":_=>_.id,pagination:o(d),class:"sm:h-full","onUpdate:filters":U},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ie,{visible:o(T),"onUpdate:visible":a[3]||(a[3]=_=>K(T)?T.value=_:null),onSubmitted:o(i),pid:o(y).pid,"operate-type":o(q),"row-data":o(I)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{Xe as default};
