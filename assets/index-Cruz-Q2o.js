import{_ as ue}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CGU0tKL8.js";import{_ as me}from"./round-delete-CF0aoo1P.js";import{_ as fe}from"./round-add-DA14AP1D.js";import{d as J,aw as Z,q as ee,v as _e,r as te,s as ae,a as ge,ay as oe,at as he,bZ as ve,cz as ye,cA as we,c as E,o as V,w as o,f as t,az as be,G as ne,h as n,au as le,C as O,N as Q,B as S,g as T,t as D,$ as k,aF as ke,cu as se,aI as re,F as Ce,U as ie,M as ze,i as xe,y as K,b as Se,aO as A,aA as Te,D as G,aP as je,e as De,cB as W,ct as Ne,aU as Pe}from"./index-Czo_Tv6G.js";import{u as Ue,a as Ie}from"./table-B9pXdLkE.js";import{u as ce}from"./usePageData-DWkJn6n-.js";import{_ as pe}from"./Grid-BhXq_sOL.js";import{_ as de}from"./FormItemGridItem-GFbFCxC3.js";import{_ as $e}from"./round-search-BjMg0BH8.js";import{_ as Be}from"./round-refresh-C2uFpdck.js";import{N as X}from"./Popconfirm-DZokoRqG.js";const Fe=J({name:"OperateDrawer",__name:"operate-drawer",props:Z({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Z(["submitted"],["update:visible"]),setup(v,{emit:N}){const f=N,C=ee(),m=v,a=_e(h());function h(){return{pid:void 0,id:"",pname:"",pcontact:"",proposition:"",docker:""}}const c=te([]),{pageData:d,getData:_,nextPage:z}=ce(se),P=async l=>{const e=l.currentTarget,r=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&d.data.length<d.total&&(await z(),c.value=d.data,await re(),setTimeout(()=>{e.scrollTop=r}))},U=async()=>{await _({fuzzy:C.userInfo.pname,page:1}),c.value=d.data},I=async()=>{await _({page:1}),c.value=d.data},$=async l=>{a.pid=l};async function y(){U(),Object.assign(a,h()),m.operateType==="add"&&(a.pid=m.pid),m.operateType==="edit"&&m.rowData&&Object.assign(a,m.rowData)}const{formRef:B,validate:F,restoreValidation:j}=ae(),i={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},pname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},pcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},s=ge(()=>({add:"新增联系人",edit:"修改联系人"})[m.operateType]),p=oe(v,"visible");he(p,()=>{p.value&&(y(),setTimeout(()=>{const l=document.querySelector(".n-scrollbar-content");l==null||l.scrollTo(0,0)},300),j())});function w(){p.value=!1}const M=ve.debounce(async()=>{await R()},1e3,{leading:!0,trailing:!1});async function R(){var l,e;if(await F(),m.operateType==="edit"){const{data:r,error:g}=await ye([a]);g||(w(),f("submitted"),(l=window.$message)==null||l.success("修改成功"))}else{const{data:r,error:g}=await we([{...a}]);g||(w(),f("submitted"),(e=window.$message)==null||e.success("添加成功"))}}return(l,e)=>{const r=de,g=pe,q=ne,L=be,x=Q,H=ke;return V(),E(H,{show:p.value,"onUpdate:show":e[5]||(e[5]=u=>p.value=u),title:s.value,preset:"card",class:"w-500px","mask-closable":!1,draggable:!0},{footer:o(()=>[t(x,{justify:"end",size:16},{default:o(()=>[t(n(S),{onClick:w},{default:o(()=>[T(D(n(k)("common.cancel")),1)]),_:1}),t(n(S),{type:"primary",onClick:n(M)},{default:o(()=>[T(D(n(k)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:o(()=>[t(L,{class:"pr-20px"},{default:o(()=>[t(q,{ref_key:"formRef",ref:B,model:a,rules:i,"label-placement":"left","label-width":120},{default:o(()=>[t(g,{responsive:"screen","item-responsive":""},{default:o(()=>[t(r,{span:"24 m:24",label:"项目列表",path:"pid"},{default:o(()=>[t(n(le),{clearable:"",filterable:"",value:a.pid,"onUpdate:value":[e[0]||(e[0]=u=>a.pid=u),$],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:I,options:c.value,onScroll:P},null,8,["value","options"])]),_:1}),t(r,{span:"24 m:24",label:"对接方",path:"docker"},{default:o(()=>[t(n(O),{value:a.docker,"onUpdate:value":e[1]||(e[1]=u=>a.docker=u),placeholder:"请输入"},null,8,["value"])]),_:1}),t(r,{span:"24 m:24",label:"姓名",path:"pname"},{default:o(()=>[t(n(O),{value:a.pname,"onUpdate:value":e[2]||(e[2]=u=>a.pname=u),placeholder:"请输入"},null,8,["value"])]),_:1}),t(r,{span:"24 m:24",label:"联系方式",path:"pcontact"},{default:o(()=>[t(n(O),{value:a.pcontact,"onUpdate:value":e[3]||(e[3]=u=>a.pcontact=u),placeholder:"请输入"},null,8,["value"])]),_:1}),t(r,{span:"24 m:24",label:"备注",path:"proposition"},{default:o(()=>[t(n(O),{value:a.proposition,"onUpdate:value":e[4]||(e[4]=u=>a.proposition=u),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Me=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Z(["reset","search","clear"],["update:model"]),setup(v,{emit:N}){const f=N,{formRef:C,restoreValidation:m}=ae(),a=oe(v,"model"),h=ee(),c=te([]),{pageData:d,getData:_,nextPage:z}=ce(se),P=async i=>{const s=i.currentTarget,p=s.scrollTop;s.scrollTop+s.offsetHeight>=s.scrollHeight&&d.data.length<d.total&&(await z(),c.value=d.data,await re(),setTimeout(()=>{s.scrollTop=p}))},U=async i=>{var s;i?(a.value.pid=i,f("search"),h.setProjectInfo({pname:(s=c.value.find(p=>p.id==i))==null?void 0:s.proname,pid:i})):f("clear")},I=async i=>{await _({fuzzy:i,page:1}),c.value=d.data},$=async()=>{await _({page:1}),c.value=d.data};(async()=>{var i,s;await _({fuzzy:h.userInfo.pname}),c.value=d.data,a.value.pid=h.userInfo.pid?h.userInfo.pid:(i=c.value[0])==null?void 0:i.id,h.setProjectInfo({pid:a.value.pid,pname:(s=c.value.find(p=>p.id==a.value.pid))==null?void 0:s.proname}),f("search")})();async function B(){await m(),a.value.fuzzy="",f("reset")}const F=()=>{a.value.fuzzy="",f("search")};async function j(){var i,s;a.value.pid?f("search"):((i=window.$message)==null||i.destroyAll(),(s=window.$message)==null||s.warning("请选择项目"))}return(i,s)=>{const p=le,w=de,M=O,R=Be,l=S,e=$e,r=Q,g=pe,q=ne,L=ie;return V(),E(L,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[t(q,{ref_key:"formRef",ref:C,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ce(j,["enter"])},{default:o(()=>[t(g,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[t(w,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:o(()=>[t(p,{filterable:"",clearable:"",value:a.value.pid,"onUpdate:value":[s[0]||(s[0]=x=>a.value.pid=x),U],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:c.value,onScroll:P,onClear:$,onSearch:I},null,8,["value","options"])]),_:1}),t(w,{span:"24 s:12 m:6",label:"姓名",path:"fuzzy"},{default:o(()=>[t(M,{value:a.value.fuzzy,"onUpdate:value":s[1]||(s[1]=x=>a.value.fuzzy=x),placeholder:"请输入",clearable:"",onClear:F},null,8,["value"])]),_:1}),t(w,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[t(r,{class:"w-full"},{default:o(()=>[t(l,{onClick:B},{icon:o(()=>[t(R,{class:"text-icon"})]),default:o(()=>[T(" "+D(n(k)("common.reset")),1)]),_:1}),t(l,{type:"primary",ghost:"",onClick:j},{icon:o(()=>[t(e,{class:"text-icon"})]),default:o(()=>[T(" "+D(n(k)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Re={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Y(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Pe(v)}const Qe=J({name:"projectmanagement_contact",__name:"index",setup(v){const N=ze(),{columns:f,columnChecks:C,data:m,getData:a,pagination:h,loading:c,mobilePagination:d,searchParams:_}=Ue({showTotal:!0,immediate:!1,apiFn:Ne,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"docker",title:"对接方",align:"center",width:120},{key:"pname",title:"姓名",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pcontact",title:"联系方式",align:"center",width:120},{key:"proposition",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:k("common.operate"),align:"center",width:140,fixed:"right",render:l=>{let e;return t("div",{class:"flex-center gap-8px"},[G(t(S,{type:"primary",ghost:!0,size:"small",onClick:()=>s(l.id)},Y(e=k("common.edit"))?e:{default:()=>[e]}),[[K("no-auth"),"project:Contact:update"]]),t(X,{onPositiveClick:()=>i(l.id)},{default:()=>k("common.confirmDelete"),trigger:()=>{let r;return G(t(S,{type:"error",ghost:!0,size:"small"},Y(r=k("common.delete"))?r:{default:()=>[r]}),[[K("no-auth"),"project:Contact:delete"]])}})])}}]}),{drawerVisible:z,operateType:P,editingData:U,handleAdd:I,handleEdit:$,checkedRowKeys:y,onBatchDeleted:B,onDeleted:F}=Ie(m,a);xe(async()=>{});async function j(){console.log(y.value),p(y.value.join(","),l=>{B()})}async function i(l){const{data:e,error:r}=await W(l);r||F()}function s(l){$(l)}async function p(l,e){const{data:r,error:g}=await W(l);if(!g)e&&e(r);else return!1}const w=l=>{a()},M=()=>{m.value=[],h.itemCount=0},R=()=>{a()};return(l,e)=>{const r=Q,g=fe,q=me,L=ue,x=Te,H=ie,u=K("no-auth");return V(),Se("div",Re,[t(Me,{model:n(_),"onUpdate:model":e[0]||(e[0]=b=>A(_)?_.value=b:null),onReset:R,onSearch:n(a),onClear:M},null,8,["model","onSearch"]),t(H,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[t(r,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>e[4]||(e[4]=[De("div",null,"项目联系人",-1)])),_:1,__:[4]})]),"header-extra":o(()=>[t(r,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[G((V(),E(n(S),{onClick:n(I),size:"small",ghost:"",type:"primary"},{icon:o(()=>[t(g,{class:"text-icon"})]),default:o(()=>[e[5]||(e[5]=T(" "+D("新增")))]),_:1,__:[5]},8,["onClick"])),[[u,"project:Contact:insert"]]),t(n(X),{onPositiveClick:j},{trigger:o(()=>[G((V(),E(n(S),{size:"small",ghost:"",type:"error",disabled:n(y).length==0},{icon:o(()=>[t(q,{class:je(["text-icon",{"animate-spin":n(c)}])},null,8,["class"])]),default:o(()=>[e[6]||(e[6]=T(" "+D("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[u,"project:Contact:delete"]])]),default:o(()=>[e[7]||(e[7]=T(" 确定要删除选中的联系人吗？ "))]),_:1,__:[7]}),t(L,{columns:n(C),"onUpdate:columns":e[1]||(e[1]=b=>A(C)?C.value=b:null)},null,8,["columns"])]),_:1})]),default:o(()=>[t(x,{"checked-row-keys":n(y),"onUpdate:checkedRowKeys":e[2]||(e[2]=b=>A(y)?y.value=b:null),columns:n(f),data:n(m),size:"small","flex-height":!n(N).isMobile,loading:n(c),remote:"","row-key":b=>b.id,pagination:n(d),class:"sm:h-full","onUpdate:filters":w},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Fe,{visible:n(z),"onUpdate:visible":e[3]||(e[3]=b=>A(z)?z.value=b:null),onSubmitted:n(a),pid:n(_).pid,"operate-type":n(P),"row-data":n(U)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{Qe as default};
