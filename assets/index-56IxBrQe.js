import{_ as we}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CDDQUP4x.js";import{d as Z,q as J,s as le,v as re,L as G,o as C,c as L,w as a,g as e,M as P,i as s,V as F,af as ie,h as b,t as U,$ as u,N as pe,A as ue,Y as ce,B as E,E as de,D as me,aa as _e,x as De,y as ae,b as xe,r as fe,ag as Ne,e as Q,ah as se,ai as X,aj as ne,f as K,ak as Se,S as Te,F as ke,a0 as Ae,al as V,am as Re,an as Ce,ad as H,ae as ze}from"./index-D04JbMW3.js";import{u as qe,a as Oe}from"./table-rw5TWla2.js";import{f as ge,a as Ue,b as $e,c as Be,d as Me}from"./asset-DxJ7kibc.js";import{_ as Ie}from"./round-search-4GzPbRV1.js";import{_ as je}from"./round-refresh-Cksy35cT.js";import{_ as be}from"./FormItemGridItem-C_Tdnpx2.js";import{_ as he}from"./Grid-CClg_PJ_.js";import{u as Fe}from"./usePageData-n3t8cZ5V.js";import{a as Pe,b as Ve,_ as Le}from"./DataTable-D6P8SjIN.js";import{h as oe}from"./permission-s6JZ8sUF.js";import{_ as Ge}from"./Popconfirm-BAazq7Q5.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-C-XAbW43.js";import"./setting-outlined-COG0XQfY.js";import"./export-xohM9oOk.js";import"./refresh-CYax9t1N.js";import"./round-delete-DnoxFC76.js";import"./round-plus-D-iVRuvp.js";import"./Upload-DxR1HQU_.js";import"./Progress-CUUUKddI.js";import"./Forward-CLXh4amU.js";const Ee=Z({name:"AssetallocationSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search"],["update:model"]),setup(h,{emit:$}){const p=$,_=le(h,"model"),{formRef:w,restoreValidation:B}=re();async function D(){await B(),p("reset")}function x(){p("search")}return(k,y)=>{const t=ue,f=be,M=ce,N=je,S=E,I=Ie,T=de,z=he,A=me,j=_e,q=G("no-space");return C(),L(j,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(A,{model:_.value,"label-placement":"left","label-width":80,"show-feedback":!1,onKeyup:pe(x,["enter"])},{default:a(()=>[e(z,{responsive:"screen","item-responsive":""},{default:a(()=>[e(f,{span:"24 s:12 m:6",label:"属性名称",path:"fuzzy",class:"pr-24px"},{default:a(()=>[P(e(t,{clearable:"",value:_.value.fuzzy,"onUpdate:value":y[0]||(y[0]=m=>_.value.fuzzy=m),placeholder:"请输入属性名称",onClear:D},null,8,["value"]),[[q]])]),_:1}),e(f,{span:"24 s:12 m:6",label:"控件类型",path:"atype",class:"pr-24px"},{default:a(()=>[e(M,{filterable:"",clearable:"",value:_.value.atype,"onUpdate:value":[y[1]||(y[1]=m=>_.value.atype=m),x],placeholder:"请选择控件类型",options:s(F)(s(ie))},null,8,["value","options"])]),_:1}),e(f,{span:"24 s:12 m:6"},{default:a(()=>[e(T,{class:"w-full"},{default:a(()=>[e(S,{onClick:D},{icon:a(()=>[e(N,{class:"text-icon"})]),default:a(()=>[b(" "+U(s(u)("common.reset")),1)]),_:1}),e(S,{type:"primary",ghost:"",onClick:x},{icon:a(()=>[e(I,{class:"text-icon"})]),default:a(()=>[b(" "+U(s(u)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ke=K("span",null,[b("资产类型 "),K("br"),b("一级分类")],-1),We=K("span",null,[b("资产类型 "),K("br"),b("二级分类")],-1),He=Z({name:"OperateDrawer",__name:"operate-drawer",props:J({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(h,{emit:$}){const p=h,_=$,w=le(h,"visible"),{formRef:B,validate:D,restoreValidation:x}=re(),{defaultRequiredRule:k}=De();ae(()=>p.rowData,()=>{N()});const y=xe(()=>({add:"新建资产属性",edit:"编辑资产属性"})[p.operateType]),t=fe(f());function f(){return{aname:"",req:0,atype:void 0,asseta:void 0,assetb:void 0,textleg:32,mtpche:1,adesc:""}}const M={aname:k,atype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择控件类型"},asseta:{type:"number",required:!0,trigger:["blur","change"],message:"请选择资产一级分类"},assetb:{type:"number",required:!0,trigger:["blur","change"],message:"请选择资产二级分类"}};async function N(){Object.assign(t,f()),p.operateType==="edit"&&p.rowData&&(await z({page:1,pid:p.rowData.asseta}),Object.assign(t,p.rowData))}function S(){w.value=!1}async function I(){T.data=[],t.assetb=null,await z({page:1,pid:t.asseta})}const{pageData:T,getData:z,nextPage:A}=Fe(ge),j=async m=>{const o=m.currentTarget;o.scrollTop+o.offsetHeight>=o.scrollHeight&&T.data.length<T.total&&A({pid:1})};async function q(){var m,o,R;if(await D(),p.operateType==="add"){const{data:d,error:g}=await Ue([{aname:t.aname,atype:t.atype,asseta:t.asseta,assetb:t.assetb,textleg:t.textleg,req:t.req,mtpche:t.mtpche,adesc:t.adesc}]);g||((m=window.$message)==null||m.success(u("common.addSuccess")),S(),_("submitted"))}else{const{data:d,error:g}=await $e([{id:(o=p.rowData)==null?void 0:o.id,aname:t.aname,atype:t.atype,asseta:t.asseta,assetb:t.assetb,textleg:t.textleg,req:t.req,mtpche:t.mtpche,adesc:t.adesc}]);g||((R=window.$message)==null||R.success(u("common.updateSuccess")),S(),_("submitted"))}}return ae(w,()=>{w.value&&(N(),x())}),(m,o)=>{const R=ue,d=be,g=ce,n=Se,l=Ve,i=de,c=Pe,O=he,v=me,ye=Te,ee=E,ve=ke,te=G("no-space");return C(),L(ve,{show:w.value,"onUpdate:show":o[8]||(o[8]=r=>w.value=r),title:y.value,preset:"card",class:"w-800px"},{footer:a(()=>[e(i,{justify:"end",size:16},{default:a(()=>[e(ee,{onClick:S},{default:a(()=>[b(U(s(u)("common.cancel")),1)]),_:1}),e(ee,{type:"primary",onClick:q},{default:a(()=>[b(U(s(u)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(ye,{class:"h-480px pr-20px"},{default:a(()=>[e(v,{ref_key:"formRef",ref:B,model:t,rules:M,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:pe(q,["enter"])},{default:a(()=>[e(O,{responsive:"screen","item-responsive":""},{default:a(()=>[e(d,{span:"24",label:"属性名称",path:"aname"},{default:a(()=>[P(e(R,{clearable:"",value:t.aname,"onUpdate:value":o[0]||(o[0]=r=>t.aname=r),placeholder:"请输入属性名称"},null,8,["value"]),[[te]])]),_:1}),e(d,{span:"24",label:"控件类型",path:"atype"},{default:a(()=>[e(g,{filterable:"",value:t.atype,"onUpdate:value":o[1]||(o[1]=r=>t.atype=r),options:s(F)(s(ie)),placeholder:"请选择控件类型"},null,8,["value","options"])]),_:1}),e(d,{span:"24",label:"资产类型",path:"asseta"},{label:a(()=>[Ke]),default:a(()=>[e(g,{filterable:"",value:t.asseta,"onUpdate:value":[o[2]||(o[2]=r=>t.asseta=r),I],options:s(F)(s(Ne)),placeholder:"请选择资产类型(一级分类)"},null,8,["value","options"])]),_:1}),e(d,{span:"24",label:"资产类型",path:"assetb"},{label:a(()=>[We]),default:a(()=>[e(g,{value:t.assetb,"onUpdate:value":o[3]||(o[3]=r=>t.assetb=r),placeholder:"请选择资产类型(二级分类)",clearable:"",filterable:"","value-field":"id","label-field":"aname",options:s(T).data,"reset-menu-on-options-change":!1,onScroll:j},null,8,["value","options"])]),_:1}),e(d,{span:"24",label:"文本长度",path:"textleg"},{default:a(()=>[e(n,{value:t.textleg,"onUpdate:value":o[4]||(o[4]=r=>t.textleg=r),placeholder:"请输入文本长度",style:{width:"100%"}},null,8,["value"])]),_:1}),e(d,{span:"24",label:"是否必填",path:"req"},{default:a(()=>[e(c,{value:t.req,"onUpdate:value":o[5]||(o[5]=r=>t.req=r),name:"radiogroup"},{default:a(()=>[e(i,null,{default:a(()=>[(C(!0),Q(ne,null,se(s(F)(s(X)),(r,W)=>(C(),L(l,{key:W,value:r.value},{default:a(()=>[b(U(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),e(d,{span:"24",label:"是否多选",path:"mtpche"},{default:a(()=>[e(c,{value:t.mtpche,"onUpdate:value":o[6]||(o[6]=r=>t.mtpche=r),name:"radiogroup"},{default:a(()=>[e(i,null,{default:a(()=>[(C(!0),Q(ne,null,se(s(F)(s(X)),(r,W)=>(C(),L(l,{key:W,value:r.value},{default:a(()=>[b(U(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),e(d,{span:"24",label:"属性描述",path:"adesc"},{default:a(()=>[P(e(R,{type:"textarea",value:t.adesc,"onUpdate:value":o[7]||(o[7]=r=>t.adesc=r),placeholder:s(u)("page.manage.alarm.form.desc")},null,8,["value","placeholder"]),[[te]])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ye={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Y(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!ze(h)}const bt=Z({name:"assetmanagement_assetallocation",__name:"index",setup(h){const $=Ae(),p=fe({treeData:[]});for(const n in V)Object.prototype.hasOwnProperty.call(V,n)&&p.treeData.push({aname:u(V[n]),id:+("-"+n),originId:Number(n),disabled:!0,children:[]});function _(n,l){const i=new Map(n.map(c=>[c.originId,c]));return n.forEach(c=>{c.children=[]}),l.forEach(c=>{const O=i.get(c.pid);O&&O.children.push(c)}),n}async function w(){const{data:n,error:l}=await ge({page:1,limit:2e3});if(!l){let i=n.list;p.treeData=_(p.treeData,i)}}w();const{columns:B,columnChecks:D,data:x,getData:k,loading:y,pagination:t,searchParams:f,resetSearchParams:M}=qe({apiFn:Be,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,atype:null,aid:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",fixed:"left",width:48},{key:"aname",title:"属性名称",align:"center",minWidth:140,ellipsis:{tooltip:!0}},{key:"atype",title:"控件类型",align:"center",render:n=>u(Re[n.atype])},{key:"asseta",title:"资产一级分类",align:"center",minWidth:140,ellipsis:{tooltip:!0},render:n=>u(V[n.atype])},{key:"atname",title:"资产二级分类",align:"center",minWidth:140,ellipsis:{tooltip:!0}},{key:"req",title:"是否必填",align:"center",width:120,render:n=>{n.status==null&&(n.status=0);const l={0:"success",1:"error"},i=u(X[n.status].label);return e(Ce,{size:"small",type:l[n.status]},Y(i)?i:{default:()=>[i]})}},{key:"adesc",title:"描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"operate",title:u("common.operate"),align:"center",width:130,render:n=>{let l;return e("div",{class:"flex-center gap-8px"},[P(e(E,{type:"primary",ghost:!0,size:"small",onClick:()=>d(n.id)},Y(l=u("common.edit"))?l:{default:()=>[l]}),[[G("no-auth"),"sys.asset.attribute.update"]]),e(Ge,{onPositiveClick:()=>R(n.id)},{default:()=>u("common.confirmDelete"),trigger:()=>{let i;return P(e(E,{type:"error",ghost:!0,size:"small"},Y(i=u("common.delete"))?i:{default:()=>[i]}),[[G("no-auth"),"sys.asset.attribute.delete"]])}})])}}]}),{drawerVisible:N,operateType:S,editingData:I,handleAdd:T,handleEdit:z,checkedRowKeys:A,onBatchDeleted:j,onDeleted:q,closeDrawer:m}=Oe(x,k);async function o(){console.log(A.value),g(A.value,n=>{j()})}function R(n){console.log(n),g([n],l=>{q()})}function d(n){z(n)}async function g(n,l){const{data:i,error:c}=await Me(n);if(!c)l&&l(i);else return!1}return(n,l)=>{const i=we,c=Le,O=_e;return C(),Q("div",Ye,[e(Ee,{model:s(f),"onUpdate:model":l[0]||(l[0]=v=>H(f)?f.value=v:null),onReset:s(M),onSearch:s(k)},null,8,["model","onReset","onSearch"]),e(O,{title:"资产属性",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(i,{columns:s(D),"onUpdate:columns":l[1]||(l[1]=v=>H(D)?D.value=v:null),"disabled-delete":s(A).length===0,"is-view-add-button":s(oe)("sys.asset.attribute.insert"),"is-view-delete-button":s(oe)("sys.asset.attribute.delete"),loading:s(y),onAdd:s(T),onDelete:o,onRefresh:s(k)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:a(()=>[e(c,{columns:s(B),data:s(x),size:"small","flex-height":!s($).isMobile,"scroll-x":702,loading:s(y),remote:"","row-key":v=>v.id,pagination:s(t),class:"sm:h-full"},null,8,["columns","data","flex-height","loading","row-key","pagination"]),e(He,{visible:s(N),"onUpdate:visible":l[2]||(l[2]=v=>H(N)?N.value=v:null),"operate-type":s(S),"row-data":s(I),onSubmitted:s(k)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{bt as default};
