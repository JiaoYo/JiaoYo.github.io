import{_ as Ce}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DOAdG1kn.js";import{_ as ze,a as Je}from"./round-settings-BNOZqpa4.js";import{_ as Ie}from"./round-delete-CZDU0CLh.js";import{_ as Ee}from"./round-add-BLDWoBTZ.js";import{_ as Ve}from"./round-search-BOCawFnh.js";import{d as ue,n as ne,j as D,p as be,r as Me,q as je,s as qe,a6 as ye,ab as Ae,b as Fe,$ as z,y as le,o as $,c as W,w as o,g as a,h as N,t as x,i as r,A as Se,z as X,ai as K,C as te,e as re,aB as ve,f as _e,aC as Re,aD as Ge,aE as De,aF as ge,aG as Le,aA as Ke,aH as We,H as we,as as He,aj as Qe,af as ce,K as oe,L as $e,ag as Xe,B as q,ak as Pe,v as Ye,aI as Ze,aJ as ea,aK as me,aL as aa,ah as la,ad as ta,aM as na,aN as oa,aO as Ne,aa as fe,al as he,am as sa,an as ia,a1 as ra}from"./index-CqzOHcIS.js";import{u as ca,a as ua}from"./table-rbqxuxT2.js";import{e as da,f as pa,g as ma,h as fa,s as ha,i as va,j as _a}from"./gather-C5_3wjjb.js";import{_ as xe}from"./FormItemGridItem-BivQWFD-.js";import{_ as ga}from"./Cascader-D0K9sOPl.js";import{_ as ba,a as ya}from"./RadioGroup-DbJqgTyK.js";import{_ as Te}from"./Grid--OF1Knvj.js";import{_ as Ue}from"./DataTable-BdHa8wrw.js";import{N as Be}from"./Popconfirm-CXKTiQzU.js";import{_ as wa}from"./InputGroupLabel-Der8hOKR.js";import"./Forward-DTSMmYEU.js";const Pa=_e("span",null,"批量新增：格式为（转发通道1-10）",-1),ka=ue({__name:"add_model",props:ne({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ne(["submitted"],["update:visible"]),setup(T,{emit:ee}){const O=[{value:1,label:"转发通道"}],y=D(!1),g=be(T,"visible"),M=ee,p=T,e=Me(w());function w(){return{chlName:"转发通道1",chlType:1,chlAddr:1,chlProtocol:"{DB0993DD-089D-4a9e-94B2-90E335A16055}",chlColtFreq:3e5,chlWaitTime:20,chlDesc:void 0,protocolType:1,chlValid:1,chlEnableBkup:0,chlMainParam:{com_name:void 0,timeout:void 0,baud:void 0,check_bit:void 0,stop_bit:void 0,data_bit:void 0,role:void 0,ip_addr:void 0,port:void 0,reserve0:void 0,reserve1:void 0,reserve2:void 0,reserve3:void 0},chlBkupParam:{com_name:void 0,timeout:void 0,baud:void 0,check_bit:void 0,stop_bit:void 0,data_bit:void 0,role:void 0,ip_addr:void 0,port:void 0,reserve0:void 0,reserve1:void 0,reserve2:void 0,reserve3:void 0}}}function U(){Object.assign(e,w()),p.operateType==="edit"&&p.rowData?(Object.assign(e,p.rowData),e.chlMainParam=JSON.parse(e.chlMainParam),e.chlValid=e.chlValid==2?2:1,e.chlBkupParam&&JSON.stringify(e.chlBkupParam)!=="{}"?e.chlBkupParam=JSON.parse(e.chlBkupParam):e.chlBkupParam=Object.assign({},e.chlBkupParam)):F("5",void 0)}const{formRef:B,validate:I,restoreValidation:P}=je();qe(),ye(g,()=>{g.value&&(p.operateType==="add"&&Ae(()=>{setTimeout(()=>{y.value=!0},200)}),U(),P())});const k=()=>{g.value=!1,y.value=!1},A=async()=>{var m,l,i,f,t,d,h,R,G;if(await I(),e.protocolType==0?(e.chlMainParam=JSON.stringify({reserve0:e.chlMainParam.reserve0,reserve1:e.chlMainParam.reserve1,reserve2:e.chlMainParam.reserve2,reserve3:e.chlMainParam.reserve3,role:e.chlMainParam.role,ip_addr:e.chlMainParam.ip_addr,port:e.chlMainParam.port,timeout:e.chlMainParam.timeout}),e.chlEnableBkup===1?e.chlBkupParam=JSON.stringify({reserve0:e.chlBkupParam.reserve0,reserve1:e.chlBkupParam.reserve1,reserve2:e.chlBkupParam.reserve2,reserve3:e.chlBkupParam.reserve3,role:e.chlBkupParam.role,ip_addr:e.chlBkupParam.ip_addr,port:e.chlBkupParam.port,timeout:e.chlBkupParam.timeout}):e.chlBkupParam=JSON.stringify({})):(e.chlMainParam=JSON.stringify({reserve0:e.chlMainParam.reserve0,reserve1:e.chlMainParam.reserve1,timeout:e.chlMainParam.timeout,com_name:e.chlMainParam.com_name,baud:e.chlMainParam.baud,check_bit:e.chlMainParam.check_bit,stop_bit:e.chlMainParam.stop_bit,data_bit:e.chlMainParam.data_bit}),e.chlEnableBkup===1?e.chlBkupParam=JSON.stringify({reserve0:e.chlBkupParam.reserve0,reserve1:e.chlBkupParam.reserve1,timeout:e.chlBkupParam.timeout,com_name:e.chlBkupParam.com_name,baud:e.chlBkupParam.baud,check_bit:e.chlBkupParam.check_bit,stop_bit:e.chlBkupParam.stop_bit,data_bit:e.chlBkupParam.data_bit}):e.chlBkupParam=JSON.stringify({})),p.operateType==="add"){let S=[],E=[],Z=[],J=e.chlName;if(((m=e.chlName)==null?void 0:m.indexOf("-"))!=-1){let Q=Math.abs(J==null?void 0:J.substring(J.lastIndexOf("-")).replace(/[^0-9]/gi,"")),C=J.split(/-(?![^-]*-)/),V=J.substring(0,J.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],n=V.replace(/[^0]/g,""),v=V,ie=C[0],L=ie.substring(0,ie.length-ie.match(/(\d+)[^0-9]*$/)[1].length),de=Q-V+1;for(let ke=0;ke<de;ke++){let j=v++,pe=JSON.parse(JSON.stringify(e));pe.chlName=parseInt(V)==0?n.length>0?String(j).length>=n.length?L+j:L+n.substring(0,n.length-String(j).length)+j:L+j:n.length>0?j>=10?L+n.substring(0,n.length-String(j).length+1)+j:L+n.substring(0,n.length)+j:L+j,S.push(pe),E.push(pe.chlName)}}else S=[e],E=[e.chlName];const{data:se,error:ae}=await Re(S);if(ae)e.chlMainParam=JSON.parse(e.chlMainParam),e.chlBkupParam=JSON.parse(e.chlBkupParam);else{const Q=await Ge({page:1,limit:1e3,chlType:1,_t:new Date().getTime()});if(Q.data.list.length>0)if(Q.data.list.forEach(C=>{E.includes(C.chlName)&&Z.push(C.id)}),Z.length==0)(l=window.$message)==null||l.destroyAll(),(i=window.$message)==null||i.success("添加成功"),k(),M("submitted");else{const C=await De({guid:S[0].chlProtocol});if(!C.error){if(C.data.length==0){(f=window.$message)==null||f.destroyAll(),(t=window.$message)==null||t.success("通道添加成功，未查询到该协议的规约信息"),k(),M("submitted");return}const V=Z.map(async n=>{var L;const v=C.data.map(de=>({...de,chlId:n}));return(await ge(v)).error?((L=window.$message)==null||L.error("通道添加成功，规约信息添加失败"),Promise.reject(new Error("通道添加成功，规约信息添加失败"))):Promise.resolve()});Promise.all(V).then(()=>{var n,v;(n=window.$message)==null||n.destroyAll(),(v=window.$message)==null||v.success("添加成功"),k(),M("submitted")}).catch(n=>{console.error(n)})}}else(d=window.$message)==null||d.destroyAll(),(h=window.$message)==null||h.success("添加成功"),k(),M("submitted")}}else{const{data:S,error:E}=await Le([e]);E?(e.chlMainParam=JSON.parse(e.chlMainParam),e.chlBkupParam=JSON.parse(e.chlBkupParam)):((R=window.$message)==null||R.destroyAll(),(G=window.$message)==null||G.success("修改成功"),k(),M("submitted"))}};let H=Me([]);const Y=async()=>{const{data:m}=await Ke({type:1}),l=JSON.parse(m);console.log(l);function i(f){return Object.keys(f).map(t=>{const d=f[t];return{label:t,value:t,children:d.map(h=>{const[R,G]=Object.entries(h)[0];return{label:R,value:R,children:G.map(S=>({label:S.name,value:S.gUID,id:S.id}))}})}})}H=i(l)},F=async(m,l)=>{console.log(m,l);const{data:i,error:f}=await We({id:l?l.id:5});if(!f){e.protocolType=i.type;let t=JSON.parse(i.defaultCfg);e.chlMainParam=Object.assign(e.chlMainParam,t),e.chlEnableBkup===1&&(e.chlBkupParam=Object.assign(e.chlBkupParam,t))}};Y();const s={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},c={type:"number",required:!0,trigger:["blur","change"],message:"不能为空"},u={required:!0,validator(m,l){let i="^((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$";return new RegExp(i).test(l)?!0:new Error("IP地址错误")},trigger:["input","blur"]},b={chlName:s,chlType:c,chlAddr:c,chlWaitTime:c,chlColtFreq:c,protocolType:c,chlValid:c,chlEnableBkup:c,chlProtocol:s,chlMainParam:{role:c,com_name:s,timeout:c,baud:c,check_bit:c,stop_bit:c,data_bit:c,ip_addr:[s,u],port:c},chlBkupParam:{role:c,com_name:s,timeout:c,baud:c,check_bit:c,stop_bit:c,data_bit:c,ip_addr:[s,u],port:c}},_=Fe(()=>({add:z("common.add"),edit:z("common.edit")})[p.operateType]);return(m,l)=>{const i=we,f=He,t=xe,d=Qe,h=ce,R=ga,G=ba,S=oe,E=ya,Z=Te,J=$e,se=Xe,ae=q,Q=oe,C=Pe,V=le("no-space");return $(),W(C,{show:g.value,"onUpdate:show":l[25]||(l[25]=n=>g.value=n),title:_.value,preset:"card",class:"w-50%",onAfterLeave:k},{footer:o(()=>[a(Q,{size:16,justify:"end"},{default:o(()=>[a(ae,{onClick:k},{default:o(()=>[N(x(r(z)("common.cancel")),1)]),_:1}),a(ae,{type:"primary",onClick:A},{default:o(()=>[N(x(r(z)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(se,{style:{"max-height":"80vh"}},{default:o(()=>[a(J,{ref_key:"formRef",ref:B,model:e,rules:b,"label-placement":"left","label-width":140,"require-mark-placement":"left",onKeyup:Se(A,["enter"])},{default:o(()=>[a(Z,{responsive:"screen","item-responsive":""},{default:o(()=>[a(t,{span:"24 m:12",label:"通道名称",path:"chlName"},{default:o(()=>[a(f,{show:y.value,placement:"top-start"},{trigger:o(()=>[X(a(i,{clearable:"",value:e.chlName,"onUpdate:value":l[0]||(l[0]=n=>e.chlName=n),maxlength:"64",placeholder:"请输入通道名称"},null,8,["value"]),[[V]])]),default:o(()=>[Pa]),_:1},8,["show"])]),_:1}),a(t,{span:"24 m:12",label:"通道描述",path:"chlDesc"},{default:o(()=>[a(i,{clearable:"",value:e.chlDesc,"onUpdate:value":l[1]||(l[1]=n=>e.chlDesc=n),maxlength:"255",placeholder:"请输入通道描述"},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"通道地址",path:"chlAddr"},{default:o(()=>[a(d,{clearable:"",value:e.chlAddr,"onUpdate:value":l[2]||(l[2]=n=>e.chlAddr=n),placeholder:"请输入通道地址",style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"通道类型",path:"chlType"},{default:o(()=>[a(h,{filterable:"",clearable:"",placeholder:"请选择通道类型",value:e.chlType,"onUpdate:value":l[3]||(l[3]=n=>e.chlType=n),disabled:"",options:O},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"交互频率(ms)",path:"chlColtFreq"},{default:o(()=>[a(d,{clearable:"",value:e.chlColtFreq,"onUpdate:value":l[4]||(l[4]=n=>e.chlColtFreq=n),placeholder:"请输入交互频率",precision:0,style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"每帧间隔(ms)",path:"chlWaitTime"},{default:o(()=>[a(d,{clearable:"",value:e.chlWaitTime,"onUpdate:value":l[5]||(l[5]=n=>e.chlWaitTime=n),placeholder:"请输入每帧间隔",precision:0,style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"协议名称",path:"chlProtocol"},{default:o(()=>[a(R,{value:e.chlProtocol,"onUpdate:value":[l[6]||(l[6]=n=>e.chlProtocol=n),F],placeholder:"请选择协议名称","expand-trigger":"click",options:r(H),"check-strategy":"child","show-path":!1},null,8,["value","options"])]),_:1}),a(t,{span:"24 m:12",label:"协议类型",path:"protocolType"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择协议类型",value:e.protocolType,"onUpdate:value":l[7]||(l[7]=n=>e.protocolType=n),options:r(K)(r(da))},null,8,["value","options"])]),_:1}),p.operateType=="edit"?($(),W(t,{key:0,span:"24 m:24",label:"通道有效性",path:"chlValid"},{default:o(()=>[a(E,{value:e.chlValid,"onUpdate:value":l[8]||(l[8]=n=>e.chlValid=n),name:"radiogroup"},{default:o(()=>[a(S,null,{default:o(()=>[a(G,{label:"是",value:1}),a(G,{label:"否",value:2})]),_:1})]),_:1},8,["value"])]),_:1})):te("",!0),e.protocolType!==0?($(),re(ve,{key:1},[a(t,{span:"24 m:12",label:"串口名称",path:"chlMainParam.com_name"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.com_name,"onUpdate:value":l[9]||(l[9]=n=>e.chlMainParam.com_name=n),options:r(K)(r(pa))},null,8,["value","options"])]),_:1}),a(t,{span:"24 m:12",label:"波特率",path:"chlMainParam.baud"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.baud,"onUpdate:value":l[10]||(l[10]=n=>e.chlMainParam.baud=n),options:r(K)(r(ma))},null,8,["value","options"])]),_:1}),a(t,{span:"24 m:12",label:"数据位",path:"chlMainParam.data_bit"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.data_bit,"onUpdate:value":l[11]||(l[11]=n=>e.chlMainParam.data_bit=n),options:r(K)(r(fa))},null,8,["value","options"])]),_:1}),a(t,{span:"24 m:12",label:"停止位",path:"chlMainParam.stop_bit"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.stop_bit,"onUpdate:value":l[12]||(l[12]=n=>e.chlMainParam.stop_bit=n),options:r(K)(r(ha))},null,8,["value","options"])]),_:1}),a(t,{span:"24 m:12",label:"校验位",path:"chlMainParam.check_bit"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.check_bit,"onUpdate:value":l[13]||(l[13]=n=>e.chlMainParam.check_bit=n),options:r(K)(r(va))},null,8,["value","options"])]),_:1}),a(t,{span:"24 m:12",label:"保留0"},{default:o(()=>[a(i,{clearable:"",value:e.chlMainParam.reserve0,"onUpdate:value":l[14]||(l[14]=n=>e.chlMainParam.reserve0=n),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"超时",path:"chlMainParam.timeout"},{default:o(()=>[a(d,{clearable:"",value:e.chlMainParam.timeout,"onUpdate:value":l[15]||(l[15]=n=>e.chlMainParam.timeout=n),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"保留1"},{default:o(()=>[a(i,{clearable:"",value:e.chlMainParam.reserve1,"onUpdate:value":l[16]||(l[16]=n=>e.chlMainParam.reserve1=n),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1})],64)):te("",!0),e.protocolType==0?($(),W(t,{key:2,span:"24 m:12",label:"通讯方向",path:"chlMainParam.role"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.role,"onUpdate:value":l[17]||(l[17]=n=>e.chlMainParam.role=n),options:r(K)(r(_a))},null,8,["value","options"])]),_:1})):te("",!0),e.protocolType==0?($(),re(ve,{key:3},[a(t,{span:"24 m:12",label:"保留0"},{default:o(()=>[a(i,{clearable:"",value:e.chlMainParam.reserve0,"onUpdate:value":l[18]||(l[18]=n=>e.chlMainParam.reserve0=n),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"IP/域名",path:"chlMainParam.ip_addr"},{default:o(()=>[a(i,{clearable:"",value:e.chlMainParam.ip_addr,"onUpdate:value":l[19]||(l[19]=n=>e.chlMainParam.ip_addr=n),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"保留1"},{default:o(()=>[a(i,{clearable:"",value:e.chlMainParam.reserve1,"onUpdate:value":l[20]||(l[20]=n=>e.chlMainParam.reserve1=n),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"端口号",path:"chlMainParam.port"},{default:o(()=>[a(d,{clearable:"",min:1,max:65535,value:e.chlMainParam.port,"onUpdate:value":l[21]||(l[21]=n=>e.chlMainParam.port=n),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"保留2"},{default:o(()=>[a(i,{clearable:"",value:e.chlMainParam.reserve2,"onUpdate:value":l[22]||(l[22]=n=>e.chlMainParam.reserve2=n),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"超时",path:"chlMainParam.timeout"},{default:o(()=>[a(d,{clearable:"",value:e.chlMainParam.timeout,"onUpdate:value":l[23]||(l[23]=n=>e.chlMainParam.timeout=n),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(t,{span:"24 m:12",label:"保留3"},{default:o(()=>[a(i,{clearable:"",value:e.chlMainParam.reserve3,"onUpdate:value":l[24]||(l[24]=n=>e.chlMainParam.reserve3=n),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1})],64)):te("",!0)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ma={class:"font-size-16px"},Na=ue({__name:"regulations_model",props:ne({channelId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ne(["submitted"],["update:visible"]),setup(T,{emit:ee}){const O=D({}),y=D([]),g=D([]),M=D(!1),p=D(!1),e=D(!1),w=be(T,"visible"),U=ee,B=T;ye(()=>B.channelId,s=>{}),Ye(async()=>{await I(),await k()});const I=async()=>{try{p.value=!0;const{data:s,error:c}=await Ze({id:B.channelId});c||(O.value=s)}catch{p.value=!1}},P=async s=>{let c=[];try{const{data:u,error:b}=await De({guid:O.value.chlProtocol});if(!b){if(u.forEach(_=>{_.foptions&&(_.foptions=_.foptions?JSON.parse(_.foptions):_.foptions)}),M.value)if(s.length>0){let _=u.sort((l,i)=>l.fno>i.fno?1:-1),m=s.sort((l,i)=>l.fno>i.fno?1:-1);g.value=_.filter(l=>m.some(i=>i.fname===l.fname&&i.fno===l.fno)),u.forEach(l=>{s.forEach(i=>{l.fname==i.fname&&l.fno==i.fno&&(l.id=i.id,l.fdesc=i.fdesc,l.fdataflag=i.fdataflag,l.fpno=i.fpno,l.fvalue=i.fvalue)}),c.push({chlId:B.channelId,fname:l.fname,fpno:s[0].fpno,fno:l.fno,fdesc:l.fdesc,fdataflag:l.fdataflag,fvalue:l.fvalue,foptions:l.foptions})}),c=c.sort((l,i)=>l.fno>i.fno?1:-1),y.value=c}else y.value=u;else y.value=u;p.value=!1}}catch{p.value=!1}},k=async()=>{try{const{data:s,error:c}=await ea({chlId:B.channelId});c||(s.forEach(u=>{u.foptions&&(u.foptions=JSON.parse(u.foptions))}),s.length>0?M.value=!0:M.value=!1,await P(s),p.value=!1)}catch{p.value=!1}},A=[{key:"fno",title:"编号",align:"center",width:60},{key:"fdesc",title:"参数描述",align:"center",width:160},{key:"fvalue",title:"参数类型",align:"center",width:100,render(s,c){var u;return me(ce,{value:s.fdataflag,options:[{label:"字符串",value:0},{label:"10进制",value:10},{label:"16进制",value:16}],onUpdateValue:b=>{s.fdataflag=b},disabled:((u=s.foptions)==null?void 0:u.length)>0})}},{key:"foptions",title:"参数值",align:"center",width:160,render(s,c){return s.foptions?me(ce,{value:s.fvalue,onUpdateValue:u=>{s.fvalue=u},options:s.foptions,labelField:"desc",valueField:"value"}):me(we,{value:s.fvalue,onUpdateValue:u=>{s.fvalue=u}})}}],H=async()=>{var c,u,b,_;let s=JSON.parse(JSON.stringify(y.value));if(M.value){g.value.forEach(f=>{f.chlId=B.channelId,f.foptions&&(f.foptions=JSON.stringify(f.foptions)),y.value.forEach(t=>{f.fname===t.fname&&f.fno===t.fno&&(f.fvalue=t.fvalue,f.fdataflag=t.fdataflag)})});let m=s.filter(f=>!g.value.some(t=>t.fname===f.fname&&t.fno===f.fno));const{data:l,error:i}=await aa(g.value);i||(m.length>0?await Y(m):((c=window.$message)==null||c.destroyAll(),(u=window.$message)==null||u.success("配置成功"),w.value=!1,U("submitted")))}else{s.forEach(i=>{i.chlId=B.channelId,i.foptions&&(i.foptions=JSON.stringify(i.foptions))});const{data:m,error:l}=await ge(s);l||((b=window.$message)==null||b.destroyAll(),(_=window.$message)==null||_.success("配置成功"),w.value=!1,U("submitted"))}},Y=async s=>{var b,_;s.forEach(m=>{m.chlId=B.channelId,m.foptions&&(m.foptions=JSON.stringify(m.foptions))});const{data:c,error:u}=await ge(s);u||((b=window.$message)==null||b.destroyAll(),(_=window.$message)==null||_.success("配置成功"),w.value=!1,U("submitted"))},F=s=>{};return(s,c)=>{const u=Ue,b=q,_=oe,m=Pe,l=le("no-auth");return $(),W(m,{show:w.value,"onUpdate:show":c[2]||(c[2]=i=>w.value=i),preset:"card",class:"w-40% h-700px"},{header:o(()=>[_e("span",null,[N("规约特征配置"),_e("span",Ma,"(通道："+x(O.value.chlName)+" 协议："+x(O.value.name)+")",1)])]),footer:o(()=>[a(_,{size:16,justify:"end"},{default:o(()=>[X(($(),W(b,{disabled:!M.value,class:"w-140px mb-10px",onClick:c[0]||(c[0]=i=>P([]))},{default:o(()=>[N(x("还原默认设置"))]),_:1},8,["disabled"])),[[l,"proset:update"]]),a(b,{onClick:c[1]||(c[1]=i=>w.value=!1),class:"w-100px"},{default:o(()=>[N(x(s.$t("common.cancel")),1)]),_:1}),X(($(),W(b,{type:"primary",disabled:e.value,class:"w-100px",onClick:H},{default:o(()=>[N(x(s.$t("common.confirm")),1)]),_:1},8,["disabled"])),[[l,"proset:update"]])]),_:1})]),default:o(()=>[a(u,{columns:A,data:y.value,size:"small",loading:p.value,remote:"","row-key":i=>i.id,class:"h-full","flex-height":"",onScroll:F},null,8,["data","loading","row-key"])]),_:1},8,["show"])}}}),Ba=ue({__name:"merge_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:ne(["submitted"],["update:visible"]),setup(T,{emit:ee}){const y=la({0:"采集104tcp",1:"采集104udp"}),g=be(T,"visible"),M=D(null),p=D({targetDevice:void 0,EquipmentMerged:void 0}),e=()=>{},U={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}},B=D(!1);return(I,P)=>{const k=ce,A=xe,H=Te,Y=$e,F=q,s=oe,c=Pe;return $(),re(ve,null,[a(c,{show:g.value,"onUpdate:show":P[3]||(P[3]=u=>g.value=u),title:"通道合并",preset:"card",class:"w-40%"},{footer:o(()=>[a(s,{size:16,justify:"center"},{default:o(()=>[a(F,{onClick:P[2]||(P[2]=u=>g.value=!1),class:"w-100px"},{default:o(()=>[N(x(I.$t("common.cancel")),1)]),_:1}),a(F,{type:"primary",class:"w-100px",onClick:e},{default:o(()=>[N(x(I.$t("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(Y,{ref_key:"formRef",ref:M,"label-width":120,"label-placement":"left",model:p.value,rules:U},{default:o(()=>[a(H,{responsive:"screen","item-responsive":""},{default:o(()=>[a(A,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:o(()=>[a(k,{filterable:"",clearable:"",placeholder:"请选择通道",value:p.value.targetDevice,"onUpdate:value":P[0]||(P[0]=u=>p.value.targetDevice=u),options:r(K)(r(y))},null,8,["value","options"])]),_:1}),a(A,{span:"24 m:12",label:"待合并通道",path:"EquipmentMerged"},{default:o(()=>[a(k,{multiple:"",filterable:"",clearable:"",placeholder:"请选择通道",value:p.value.EquipmentMerged,"onUpdate:value":P[1]||(P[1]=u=>p.value.EquipmentMerged=u),options:r(K)(r(y))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),a(c,{show:B.value,"onUpdate:show":P[4]||(P[4]=u=>B.value=u),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),Oa={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Oe(T){return typeof T=="function"||Object.prototype.toString.call(T)==="[object Object]"&&!sa(T)}const Ra=ue({name:"configsetting_forwardingservice_forwardingchannelmanagement",__name:"index",setup(T){const ee=ta(),O=D(!1),y=D(),g=D(!1),{columns:M,columnChecks:p,data:e,getData:w,loading:U,mobilePagination:B,searchParams:I,resetSearchParams:P}=ca({apiFn:na,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,chlType:1,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",fixed:"left",width:48},{key:"id",title:"通道ID",align:"center",fixed:"left",width:60},{key:"chlName",title:"通道名称",align:"center",width:140},{key:"chlAddr",title:"通道地址",align:"center",width:140},{key:"chlType",title:"通道类型",align:"center",width:100,render:t=>a("span",null,[N("转发通道")])},{key:"name",title:"协议名称",align:"center",minWidth:200,render:t=>a("div",{class:"flex-center justify-center gap-8px"},[a(ze,{class:"text-icon cursor-pointer",color:t.pro>0?"#ff7f50":"",onClick:()=>f(t.id)},null),a("span",null,[t.name])])},{key:"chlMainParam",title:"主通道参数",align:"center",width:240,render:t=>a("span",{class:"font-size-14px"},[t.protocolType===0?JSON.stringify({ip_addr:JSON.parse(t.chlMainParam).ip_addr,port:JSON.parse(t.chlMainParam).port}):JSON.stringify({COM_NAME:JSON.parse(t.chlMainParam).com_name})||{}])},{key:"chlColtFreq",title:"交互频率(ms)",align:"center",width:140},{key:"chlWaitTime",title:"每帧间隔(ms)",align:"center",width:140},{key:"chlValid",title:"有效性",align:"center",width:140,render:t=>a(oa,{type:t.chlValid===2?"error":"success"},{default:()=>[t.chlValid==2?"否":"是"]})},{key:"chlDesc",title:"通道描述",align:"center",width:140},{key:"operate",title:z("common.operate"),align:"center",width:250,fixed:"right",render:t=>{let d;return a("div",{class:"flex-center gap-8px"},[a(q,{type:"primary",ghost:!0,size:"small",onClick:()=>b(t.id)},{default:()=>["子设备管理"]}),X(a(q,{type:"primary",ghost:!0,size:"small",onClick:()=>l(t.id)},Oe(d=z("common.edit"))?d:{default:()=>[d]}),[[le("no-auth"),"channel:update"]]),X(a(Be,{onPositiveClick:()=>m(t.id)},{default:()=>z("common.confirmDelete"),trigger:()=>{let h;return a(q,{type:"error",ghost:!0,size:"small"},Oe(h=z("common.delete"))?h:{default:()=>[h]})}}),[[le("no-auth"),"channel:delete"]])])}}]}),{drawerVisible:k,operateType:A,editingData:H,handleAdd:Y,handleEdit:F,checkedRowKeys:s,onBatchDeleted:c,onDeleted:u}=ua(e,w);ye(()=>I.fuzzy,t=>{t||w()});const b=t=>{ee.push({path:"/configsetting/forwardingservice/forwardingdevicemanagement",query:{channelId:t}})},_=()=>{w()},m=async t=>{const{data:d,error:h}=await Ne({ids:t});h||u()},l=t=>{F(t)},i=async()=>{const{data:t,error:d}=await Ne({ids:s.value.join(",")});d||u()},f=t=>{y.value=t,O.value=!0};return(t,d)=>{const h=wa,R=we,G=Ve,S=ia,E=oe,Z=Ee,J=Ie,se=Je,ae=Ce,Q=Ue,C=ra,V=le("no-space"),n=le("no-auth");return $(),re("div",Oa,[a(C,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[a(E,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:o(()=>[a(S,null,{default:o(()=>[a(h,null,{default:o(()=>[N("通道名称")]),_:1}),X(a(R,{clearable:"",value:r(I).fuzzy,"onUpdate:value":d[0]||(d[0]=v=>r(I).fuzzy=v),placeholder:"请输入通道名称",style:{width:"100%"},onKeyup:Se(_,["enter"])},null,8,["value"]),[[V]]),a(r(q),{type:"primary",ghost:"",onClick:_},{icon:o(()=>[a(G,{class:fe(["text-icon",{"animate-spin":r(U)}])},null,8,["class"])]),default:o(()=>[N(" "+x(r(z)("common.search")),1)]),_:1})]),_:1})]),_:1})]),"header-extra":o(()=>[a(E,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[X(($(),W(r(q),{onClick:r(Y),size:"small",ghost:"",type:"primary"},{icon:o(()=>[a(Z,{class:fe(["text-icon",{"animate-spin":r(U)}])},null,8,["class"])]),default:o(()=>[N(" "+x(r(z)("common.add")),1)]),_:1},8,["onClick"])),[[n,"channel:insert"]]),X(($(),W(r(Be),{onPositiveClick:i},{trigger:o(()=>[a(r(q),{size:"small",ghost:"",type:"error",disabled:r(s).length===0},{icon:o(()=>[a(J,{class:"text-icon"})]),default:o(()=>[N(" "+x(r(z)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:o(()=>[N(" "+x(r(z)("common.confirmDelete")),1)]),_:1})),[[n,"channel:delete"]]),a(r(q),{onClick:d[1]||(d[1]=v=>O.value=!0),size:"small",ghost:"",type:"primary",disabled:r(s).length!==1},{icon:o(()=>[a(se,{class:fe(["text-icon",{"animate-spin":r(U)}])},null,8,["class"])]),default:o(()=>[N(" 规约特征配置 ")]),_:1},8,["disabled"]),a(ae,{columns:r(p),"onUpdate:columns":d[2]||(d[2]=v=>he(p)?p.value=v:null)},null,8,["columns"])]),_:1})]),default:o(()=>[a(Q,{"checked-row-keys":r(s),"onUpdate:checkedRowKeys":d[3]||(d[3]=v=>he(s)?s.value=v:null),columns:r(M),data:r(e),size:"small",loading:r(U),remote:"","row-key":v=>v.id,pagination:r(B),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),a(ka,{visible:r(k),"onUpdate:visible":d[4]||(d[4]=v=>he(k)?k.value=v:null),onSubmitted:r(w),"operate-type":r(A),"row-data":r(H)},null,8,["visible","onSubmitted","operate-type","row-data"]),O.value?($(),W(Na,{key:0,visible:O.value,"onUpdate:visible":d[5]||(d[5]=v=>O.value=v),channelId:r(s).length==0?y.value:r(s)[0],onSubmitted:r(w)},null,8,["visible","channelId","onSubmitted"])):te("",!0),a(Ba,{visible:g.value,"onUpdate:visible":d[6]||(d[6]=v=>g.value=v)},null,8,["visible"])]),_:1})])}}});export{Ra as default};
