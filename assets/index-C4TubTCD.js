import{_ as Me}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CpiEGXGW.js";import{d as W,dD as Ae,j,aM as oe,F as re,bc as ue,dE as ce,dF as pe,ba as Q,bW as Ue,aj as Z,cm as $e,r as xe,q as le,s as Re,v as Te,x as je,b as ze,y as Ie,bk as me,bj as fe,L as te,o as S,c as q,w as n,g as e,h,t as g,i as o,$ as z,M as L,e as ee,ah as _e,V as I,O as ve,av as Pe,H as Ee,aV as ye,A as Ce,C as he,Y as Le,D as De,S as Be,B as G,E as Ne,bm as Fe,N as Ve,aa as se,a0 as Ke,ad as X,f as be}from"./index-CaRSwrxR.js";import{c as qe,d as Ge,f as We,e as He,g as Je,h as ge,i as Ye}from"./reportForm-U7nVR83v.js";import{u as Qe,a as Xe}from"./table-CgzWZkjd.js";import{T as ie,a as Oe,S as Se}from"./task-DKJoMA_0.js";import{a as Ze,b as et,_ as tt}from"./DataTable-CvFsglEk.js";import{_ as at}from"./TimePicker-CE2vfveM.js";import{_ as nt}from"./round-search-DcPqtNKB.js";import{_ as ot}from"./round-refresh-DH4W3hYO.js";import{_ as lt}from"./FormItemGridItem-BXzdliJT.js";import{_ as st}from"./Grid-DI4-4Zeg.js";import{h as ke}from"./permission-DF6J0rCG.js";import{_ as it}from"./Popconfirm-43LXUmBt.js";import{_ as rt,a as ut}from"./DescriptionsItem-1jpat6d_.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Cl49Inc3.js";import"./setting-outlined-CSe-JlS-.js";import"./round-delete-DL6lMCB2.js";import"./refresh-kd4_ypGQ.js";import"./round-plus-Bz5C_u1q.js";import"./Upload-Bwxc15SB.js";import"./Progress-CuBgoOYl.js";import"./Forward-Eh4K3nYq.js";import"./defineProperty-BE3KqpHP.js";const dt=W({name:"ModalEnvironment",props:Object.assign(Object.assign({},Ae),{internalKey:{type:String,required:!0},onInternalAfterLeave:{type:Function,required:!0}}),setup(p){const _=j(!0);function d(){const{onInternalAfterLeave:l,internalKey:c,onAfterLeave:t}=p;l&&l(c),t&&t()}function s(){const{onPositiveClick:l}=p;l?Promise.resolve(l()).then(c=>{c!==!1&&r()}):r()}function v(){const{onNegativeClick:l}=p;l?Promise.resolve(l()).then(c=>{c!==!1&&r()}):r()}function m(){const{onClose:l}=p;l?Promise.resolve(l()).then(c=>{c!==!1&&r()}):r()}function R(l){const{onMaskClick:c,maskClosable:t}=p;c&&(c(l),t&&r())}function T(){const{onEsc:l}=p;l&&l()}function r(){_.value=!1}function b(l){_.value=l}return{show:_,hide:r,handleUpdateShow:b,handleAfterLeave:d,handleCloseClick:m,handleNegativeClick:v,handlePositiveClick:s,handleMaskClick:R,handleEsc:T}},render(){const{handleUpdateShow:p,handleAfterLeave:_,handleMaskClick:d,handleEsc:s,show:v}=this;return oe(re,Object.assign({},this.$props,{show:v,onUpdateShow:p,onMaskClick:d,onEsc:s,onAfterLeave:_,internalAppear:!0,internalModal:!0}))}}),we=ue("n-modal-provider"),ct=ue("n-modal-api"),pt=ue("n-modal-reactive-list"),mt={to:[String,Object]},ft=W({name:"ModalProvider",props:mt,setup(){const p=ce(64),_=pe(),d=j([]),s={};function v(r={}){const b=$e(),l=xe(Object.assign(Object.assign({},r),{key:b,destroy:()=>{var c;(c=s[`n-modal-${b}`])===null||c===void 0||c.hide()}}));return d.value.push(l),l}function m(r){const{value:b}=d;b.splice(b.findIndex(l=>l.key===r),1)}function R(){Object.values(s).forEach(r=>{r==null||r.hide()})}const T={create:v,destroyAll:R};return Q(ct,T),Q(we,{clickedRef:ce(64),clickedPositionRef:pe()}),Q(pt,d),Q(we,{clickedRef:p,clickedPositionRef:_}),Object.assign(Object.assign({},T),{modalList:d,modalInstRefs:s,handleAfterLeave:m})},render(){var p,_;return oe(Z,null,[this.modalList.map(d=>{var s;return oe(dt,Ue(d,["destroy"],{to:(s=d.to)!==null&&s!==void 0?s:this.to,ref:v=>{v===null?delete this.modalInstRefs[`n-modal-${d.key}`]:this.modalInstRefs[`n-modal-${d.key}`]=v},internalKey:d.key,onInternalAfterLeave:this.handleAfterLeave}))}),(_=(p=this.$slots).default)===null||_===void 0?void 0:_.call(p)])}}),_t=W({name:"TaskModal",__name:"task_modal",props:le({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:le(["submitted"],["update:visible"]),setup(p,{expose:_,emit:d}){const s=p,v=d,m=Re(p,"visible"),{formRef:R,validate:T,restoreValidation:r}=Te(),{defaultRequiredRule:b,patternRules:l}=je(),c=ze(()=>({add:"新增任务",edit:"编辑任务"})[s.operateType]),t=xe(P());function P(){return{id:void 0,rname:"",rtype:0,ttype:0,starttime:void 0,endtime:void 0,excute:1,stype:0,recipient:"",rdesc:"",tid:void 0}}const E={rname:b,starttime:b,cron:b,rtype:{type:"number",required:!0,trigger:["input","blur"],message:"请选择实例"},ttype:{type:"number",required:!0,trigger:["input","blur"],message:"请选择任务类型"},stype:{type:"number",required:!0,trigger:["input","blur"],message:"请选择发送类型"},recipient:{required:!0,validator:Pe,trigger:["input","change","blur","password-input"]}};function N(){Object.assign(t,P()),A.value=Ee(),s.operateType==="edit"&&s.rowData&&(s.rowData.starttime=s.rowData.starttime.substring(11,19),Object.assign(t,s.rowData))}function M(){m.value=!1}const A=j(""),H=async()=>{const w=Fe(t.ttype==0?{dayOfWeek:t.excute,time:t.starttime}:null,t.ttype==1?{dayOfMonth:t.excute,time:t.starttime}:null,t.ttype==2?{time:t.starttime}:null),{data:i,error:C}=await We({beanName:"ReportTask",remark:A.value,cronExpression:w,params:JSON.stringify({cron:w})});return C?!1:(await U(),!0)},U=async()=>{const{data:w,error:i}=await He({uuid:A.value});t.tid=w};async function $(){var w,i;if(await T(),s.operateType==="add"&&!await H())return!1;if(t.ttype!==1&&t.ttype!==2&&delete t.excute,s.operateType==="add"){const{data:C,error:k}=await qe({...t,starttime:ye(1,new Date)});k||((w=window.$message)==null||w.success(z("common.addSuccess")),M(),v("submitted"))}else{const{data:C,error:k}=await Ge({...t,starttime:ye(1,new Date)});k||((i=window.$message)==null||i.success(z("common.updateSuccess")),M(),v("submitted"))}}const y=w=>{t.excute=1};return Ie(m,()=>{m.value&&(N(),r())}),_({monthOption:me,weekOption:fe}),(w,i)=>{const C=Ce,k=he,J=et,B=Ze,f=Le,u=at,x=he,F=De,O=Be,Y=G,ae=Ne,ne=re,V=te("no-space");return S(),q(ne,{show:m.value,"onUpdate:show":i[8]||(i[8]=a=>m.value=a),title:c.value,preset:"card",class:"w-600px"},{footer:n(()=>[e(ae,{justify:"end",size:16},{default:n(()=>[e(Y,{onClick:M},{default:n(()=>[h(g(o(z)("common.cancel")),1)]),_:1}),e(Y,{type:"primary",onClick:$},{default:n(()=>[h(g(o(z)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(O,{class:"max-h-520px pr-20px"},{default:n(()=>[e(F,{ref_key:"formRef",ref:R,model:t,rules:E,"label-placement":"left","label-width":110,"require-mark-placement":"left"},{default:n(()=>[e(k,{label:"任务名称",path:"rname"},{default:n(()=>[L(e(C,{value:t.rname,"onUpdate:value":i[0]||(i[0]=a=>t.rname=a),placeholder:"请输入任务名称",clearable:""},null,8,["value"]),[[V]])]),_:1}),e(k,{label:"实例选择",path:"rtype"},{default:n(()=>[e(B,{value:t.rtype,"onUpdate:value":i[1]||(i[1]=a=>t.rtype=a),name:"radiogroup"},{default:n(()=>[(S(!0),ee(Z,null,_e(o(I)(o(ie)),(a,D)=>(S(),q(J,{key:D,value:a.value},{default:n(()=>[h(g(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s.operateType==="add"?(S(),ee(Z,{key:0},[e(k,{label:"任务类型",path:"ttype"},{default:n(()=>[e(B,{value:t.ttype,"onUpdate:value":[i[2]||(i[2]=a=>t.ttype=a),y],name:"radiogroup"},{default:n(()=>[(S(!0),ee(Z,null,_e(o(I)(o(Oe)),(a,D)=>(S(),q(J,{key:D,value:a.value},{default:n(()=>[h(g(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t.ttype==1||t.ttype==2?(S(),q(k,{key:0,label:t.ttype==1?"每周":t.ttype==2?"每月":"",path:"excute"},{default:n(()=>[e(f,{filterable:"",value:t.excute,"onUpdate:value":i[3]||(i[3]=a=>t.excute=a),placeholder:"请选择",options:t.ttype==2?o(me)():o(fe)(),style:{width:"100%"}},null,8,["value","options"])]),_:1},8,["label"])):ve("",!0),e(x,{label:"开始时间",path:"starttime"},{default:n(()=>[e(u,{"formatted-value":t.starttime,"onUpdate:formattedValue":i[4]||(i[4]=a=>t.starttime=a),placeholder:"选择开始时间"},null,8,["formatted-value"])]),_:1})],64)):ve("",!0),e(k,{label:"收件人",path:"recipient"},{default:n(()=>[L(e(C,{value:t.recipient,"onUpdate:value":i[5]||(i[5]=a=>t.recipient=a),placeholder:"请输入收件人",clearable:""},null,8,["value"]),[[V]])]),_:1}),e(k,{label:"发送类型",path:"stype"},{default:n(()=>[e(f,{filterable:"",value:t.stype,"onUpdate:value":i[6]||(i[6]=a=>t.stype=a),placeholder:"请选择发送类型",options:o(I)(o(Se)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(k,{label:"任务描述",path:"rdesc"},{default:n(()=>[L(e(C,{type:"textarea",value:t.rdesc,"onUpdate:value":i[7]||(i[7]=a=>t.rdesc=a),placeholder:"请输入任务描述",clearable:""},null,8,["value"]),[[V]])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),vt=W({name:"TaskSearch",__name:"task_search",props:{model:{required:!0},modelModifiers:{}},emits:le(["reset","search"],["update:model"]),setup(p,{emit:_}){const d=_,{formRef:s,restoreValidation:v}=Te(),m=Re(p,"model");function R(){m.value.fuzzy=void 0,d("search")}async function T(){await v(),d("reset")}async function r(){d("search")}return(b,l)=>{const c=Ce,t=lt,P=ot,E=G,N=nt,M=Ne,A=st,H=De,U=se,$=te("no-space");return S(),q(U,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(H,{ref_key:"formRef",ref:s,model:m.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ve(r,["enter"])},{default:n(()=>[e(A,{responsive:"screen","item-responsive":""},{default:n(()=>[e(t,{span:"24 s:12 m:6",label:"任务名称",path:"fuzzy",class:"pr-24px"},{default:n(()=>[L(e(c,{value:m.value.fuzzy,"onUpdate:value":l[0]||(l[0]=y=>m.value.fuzzy=y),placeholder:"请输入任务名称关键字",clearable:"",onClear:R},null,8,["value"]),[[$]])]),_:1}),e(t,{span:"24 m:6",class:"pr-24px"},{default:n(()=>[e(M,{class:"w-full"},{default:n(()=>[e(E,{onClick:T},{icon:n(()=>[e(P,{class:"text-icon"})]),default:n(()=>[h(" "+g(o(z)("common.reset")),1)]),_:1}),e(E,{type:"primary",ghost:"",onClick:r},{icon:n(()=>[e(N,{class:"text-icon"})]),default:n(()=>[h(" "+g(o(z)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),yt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ht=be("div",{style:{display:"flex","align-items":"center"}},[be("div",null,"报表任务")],-1),Ft=W({name:"reportmanagement_reporttask",__name:"index",setup(p){const _=Ke(),{columns:d,columnChecks:s,data:v,getData:m,loading:R,mobilePagination:T,searchParams:r,resetSearchParams:b}=Qe({apiFn:Je,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"rname",title:"任务名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:f=>{var u;return e("div",null,[(u=I(ie).find(x=>x.value===f.rtype))==null?void 0:u.label])}},{key:"starttime",title:"执行时间",align:"center",width:160},{key:"operate",title:z("common.operate"),align:"center",width:160,render:f=>e("div",{class:"flex-center gap-8px"},[e(ft,null,{default:()=>[e(G,{type:"info",ghost:!0,size:"small",onClick:()=>w(f.id)},{default:()=>[h("详情")]})]}),L(e(G,{type:"warning",ghost:!0,size:"small",onClick:()=>C(f.id)},{default:()=>[h("修改")]}),[[te("no-auth"),"sys.report.task.update"]]),e(it,{onPositiveClick:()=>k(f.id)},{default:()=>"确定要删除改数据吗？",trigger:()=>L(e(G,{type:"error",ghost:!0,size:"small"},{default:()=>[h("删除")]}),[[te("no-auth"),"sys.report.task.delete"]])})])}]}),{drawerVisible:l,operateType:c,editingData:t,handleAdd:P,handleEdit:E,checkedRowKeys:N,onBatchDeleted:M,onDeleted:A,closeDrawer:H}=Xe(v,m),U=j(),$=j(!1),y=j({id:void 0,rname:"",rtype:0,ttype:0,starttime:void 0,endtime:void 0,excute:0,stype:0,recipient:"",rdesc:"",tid:void 0}),w=async f=>{$.value=!0;const{data:u,error:x}=await ge(f);x||(y.value=u)},i=j();async function C(f){const{data:u,error:x}=await ge(f);x||(i.value=u),E(f)}function k(f){B(f,u=>{A()})}async function J(){B(N.value.join(","),f=>{M()})}async function B(f,u){const{data:x,error:F}=await Ye(f);F||u&&u(x)}return(f,u)=>{const x=Me,F=tt,O=rt,Y=ut,ae=se,ne=re,V=se;return S(),ee("div",yt,[e(vt,{model:o(r),"onUpdate:model":u[0]||(u[0]=a=>X(r)?r.value=a:null),onReset:o(b),onSearch:o(m)},null,8,["model","onReset","onSearch"]),e(V,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[ht]),"header-extra":n(()=>[e(x,{columns:o(s),"onUpdate:columns":u[1]||(u[1]=a=>X(s)?s.value=a:null),"disabled-delete":o(N).length===0,loading:o(R),onAdd:o(P),onRefresh:o(m),"is-view-add-button":o(ke)("sys.report.task.insert"),isViewDeleteButton:o(ke)("sys.report.task.delete"),onDelete:J},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","isViewDeleteButton"])]),default:n(()=>[e(F,{"checked-row-keys":o(N),"onUpdate:checkedRowKeys":u[2]||(u[2]=a=>X(N)?N.value=a:null),columns:o(d),data:o(v),size:"small","flex-height":!o(_).isMobile,"scroll-x":962,loading:o(R),remote:"","row-key":a=>a.id,pagination:o(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(_t,{ref_key:"TaskModalRef",ref:U,visible:o(l),"onUpdate:visible":u[3]||(u[3]=a=>X(l)?l.value=a:null),"operate-type":o(c),"row-data":i.value,onSubmitted:o(m)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(ne,{show:$.value,"onUpdate:show":u[4]||(u[4]=a=>$.value=a),preset:"card",class:"w-500px",title:"报表任务详情"},{default:n(()=>[e(ae,null,{default:n(()=>[e(Y,{"label-placement":"left",column:1,"label-style":{width:"100px",display:"inline-block",textAlign:"right",marginRight:"10px"}},{default:n(()=>[e(O,{label:"任务名称"},{default:n(()=>[h(g(y.value.rname),1)]),_:1}),e(O,{label:"实例"},{default:n(()=>{var a;return[h(g((a=o(I)(o(ie)).find(D=>D.value===y.value.rtype))==null?void 0:a.label),1)]}),_:1}),e(O,{label:"开始时间"},{default:n(()=>[h(g(y.value.starttime),1)]),_:1}),e(O,{label:"任务类型"},{default:n(()=>{var a,D,de;return[h(g((a=o(I)(o(Oe)).find(K=>K.value===y.value.ttype))==null?void 0:a.label)+" "+g(y.value.ttype==1?(D=U.value.weekOption().find(K=>K.value==y.value.excute))==null?void 0:D.label:y.value.ttype==2?(de=U.value.monthOption().find(K=>K.value==y.value.excute))==null?void 0:de.label:""),1)]}),_:1}),e(O,{label:"发送类型"},{default:n(()=>{var a;return[h(g((a=o(I)(o(Se)).find(D=>D.value===y.value.stype))==null?void 0:a.label),1)]}),_:1}),e(O,{label:"收件人"},{default:n(()=>[h(g(y.value.recipient),1)]),_:1}),e(O,{label:"描述"},{default:n(()=>[h(g(y.value.rdesc),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})])}}});export{Ft as default};
