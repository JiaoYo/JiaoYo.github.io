import{d as le,n as ee,p as ne,s as oe,r as M,o as H,c as Y,w as l,g as a,i as f,h as n,t as p,$ as J,F as se,aK as ie,Z as ue,J as re,B as F,N as te,O as de,ad as ae,a3 as ce,j as k,az as B,A as pe,D as me,e as fe,E as ge,G as ve,am as _e,an as he,S as be,av as ye,P as xe,Q as Ce,f as Le,R as De}from"./index-CC5dz6Fg.js";import{_ as Te,l as ke}from"./lodash-qu1GOcgR.js";import{_ as Se}from"./round-search-DrOCNvJL.js";import{_ as we}from"./round-refresh-8umJ1-xH.js";import{f as Ne,a as Ee}from"./common-DjE7DTWV.js";import{a as Re,S as q,t as P}from"./alarm-BmP8EHqP.js";import{_ as Ae}from"./FormItemGridItem-C_YzeEzO.js";import{_ as je}from"./DatePicker-BDfTgjRq.js";import{_ as Oe}from"./Grid-NJJ1aoYn.js";import{f as Me}from"./system-log-CAXcF4eX.js";import{y as Ie,z as Ge}from"./events-ZZWO7TAZ.js";import{n as Ue}from"./Collection-DQHUB-ZG.js";import{e as ze}from"./exportExcel-D6OyA9oJ.js";import{_ as Ve,a as $e}from"./DescriptionsItem-BIhKpDh3.js";import"./TimePicker-DW-6d4kH.js";import"./defineProperty-CgJYA2ML.js";const Be={0:"KERN",1:"USER",2:"MAIL",3:"DAEMON",4:"AUTH",5:"SYSYLOG",6:"LPR",7:"NEWS",8:"UUCP",9:"CRON",10:"AUTHPRIV",11:"FTP",12:"RESERVED_12",13:"RESERVED_13",14:"RESERVED_14",15:"RESERVED_15",16:"LOCAL0",17:"LOCAL1",18:"LOCAL2",19:"LOCAL3",20:"LOCAL4",21:"LOCAL5",22:"LOCAL6",23:"LOCAL7"},Pe={0:"EMERGENCY",1:"ALERT",2:"CRITICAL",3:"ERROR",4:"WARNING",5:"NOTICE",6:"INFO",7:"DEBUG"},Q={logModel:Be,logLevel:Pe},He=le({name:"FormSearch",__name:"form-search",props:ee(["collectorList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:ee(["search"],["update:model"]),setup(b,{emit:C}){const I=g=>Object.entries(g).map(([d,D])=>({label:D,value:d}));I(Q.logLevel),I(Q.logModel);const j=b,N=C,{formRef:Z,restoreValidation:E}=ne(),o=oe(b,"model");async function e(g,d){g&&g.length>0?(o.value.startTime=g[0],o.value.endTime=g[1]):(o.value.startTime=void 0,o.value.endTime=void 0),y()}async function c(){await E(),o.value.lsid=null,o.value.leid=null,o.value.lmid=null,o.value.eid=null,o.value.suject="",o.value.object="",o.value.lcon="",o.value.timeRange=null,ie(()=>{N("search")})}const L=M({eventsTypeDataList:[],eventsCategoryDataList:[]});async function S(){const{data:g,error:d}=await Ne();d||(L.eventsCategoryDataList=g)}async function r(){const{data:g,error:d}=await Ee();d||(L.eventsTypeDataList=g)}S(),r(),S();async function y(){N("search")}const w=Te.debounce(y,1e3,{leading:!0,trailing:!1});return(g,d)=>{const D=ue,v=Ae,O=re,G=je,K=we,U=F,T=Se,W=te,t=Oe,s=de,m=ae;return H(),Y(m,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[a(s,{ref_key:"formRef",ref:Z,model:o.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:se(f(w),["enter"])},{default:l(()=>[a(t,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:l(()=>[a(v,{span:"24 s:24 m:8 l:6",label:"采集器",path:"lsid"},{default:l(()=>[a(D,{filterable:"",clearable:"",placeholder:"请选择采集器",value:o.value.lsid,"onUpdate:value":[d[0]||(d[0]=i=>o.value.lsid=i),y],options:j.collectorList,"value-field":"id","label-field":"type",disabled:j.logsoudev,"reset-menu-on-options-change":!1},null,8,["value","options","disabled"])]),_:1}),a(v,{span:"24 s:24 m:8 l:6",label:"安全级别",path:"leid"},{default:l(()=>[a(D,{filterable:"",clearable:"",placeholder:"请选择级别",value:o.value.leid,"onUpdate:value":[d[1]||(d[1]=i=>o.value.leid=i),y],options:f(Re),"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(v,{span:"24 s:12 m:8 l:6",label:"事件类别",path:"lmid"},{default:l(()=>[a(D,{filterable:"",clearable:"",placeholder:"请选择事件类别",value:o.value.lmid,"onUpdate:value":[d[2]||(d[2]=i=>o.value.lmid=i),y],"value-field":"id","label-field":"pname",options:L.eventsCategoryDataList},null,8,["value","options"])]),_:1}),a(v,{span:"24 s:12 m:8 l:6",label:"事件类型",path:"eid"},{default:l(()=>[a(D,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:o.value.eid,"onUpdate:value":[d[3]||(d[3]=i=>o.value.eid=i),y],"value-field":"id","label-field":"pname",options:L.eventsTypeDataList},null,8,["value","options"])]),_:1}),a(v,{span:"24 s:24 m:8 l:6",label:"事件主体",path:"suject"},{default:l(()=>[a(O,{placeholder:"请输入事件主体",value:o.value.suject,"onUpdate:value":d[4]||(d[4]=i=>o.value.suject=i),clearable:"",onClear:y},null,8,["value"])]),_:1}),a(v,{span:"24 s:24 m:8 l:6",label:"事件客体",path:"object"},{default:l(()=>[a(O,{placeholder:"请输入事件客体",value:o.value.object,"onUpdate:value":d[5]||(d[5]=i=>o.value.object=i),clearable:"",onClear:y},null,8,["value"])]),_:1}),a(v,{span:"24 s:24 m:8 l:6",label:"事件内容",path:"lcon"},{default:l(()=>[a(O,{placeholder:"请输入事件内容",value:o.value.lcon,"onUpdate:value":d[6]||(d[6]=i=>o.value.lcon=i),clearable:"",onClear:y},null,8,["value"])]),_:1}),a(v,{span:"24 s:24 m:12 l:8",label:"时间",path:"time"},{default:l(()=>[a(G,{value:o.value.timeRange,"onUpdate:value":d[7]||(d[7]=i=>o.value.timeRange=i),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":e},null,8,["value"])]),_:1}),a(v,{span:"24 s:24 m:8 l:8",label:""},{default:l(()=>[a(W,{class:"w-full"},{default:l(()=>[a(U,{onClick:c},{icon:l(()=>[a(K,{class:"text-icon"})]),default:l(()=>[n(" "+p(f(J)("common.reset")),1)]),_:1}),a(U,{type:"primary",ghost:"",onClick:f(w)},{icon:l(()=>[a(T,{class:"text-icon"})]),default:l(()=>[n(" "+p(f(J)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Fe=b=>(xe("data-v-ee9fd361"),b=b(),Ce(),b),Je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ke=Fe(()=>Le("hr",{style:{"border-color":"#ccc","margin-bottom":"20px"}},null,-1));function We(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!_e(b)}const qe=le({name:"eventalarm_generallog",__name:"index",props:{logsoudev:{},aip:{}},setup(b){const C=b,I=ce(),j=k(window.innerHeight-395),N=k([]);(async()=>{const{data:t,error:s}=await Ue({page:1,limit:1e3,_t:new Date().getTime()});if(s)console.error("获取采集器列表失败:",s);else{const m=t;N.value=m.list.map(i=>({...i,id:i.id,type:i.cname}))}})();const E=k(!1),o=Q,e=M({lsid:void 0,lsdn:"",rdbtime:"",lmid:void 0,leid:void 0,ltext:"",aname:"",procid:"",msgid:"",dbtime:"",hname:"",lcon:"",ip:"",lsip:"",priority:"",type:"",version:"",logtype:void 0,index:0,gsubject:"",gdescribe:"",gresult:"",level:0,eids:"",epids:"",gobject:""}),c=M({pageId:void 0,pageSize:100,lsid:void 0,leid:void 0,lmid:void 0,startTime:void 0,endTime:void 0,startIp:void 0,endIp:void 0,_t:new Date().getTime()}),L=M([{title:"序号",key:"index",width:80,align:"center",render:t=>`${t.index}`},{key:"type",title:"采集器名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gsubject",title:"事件主体",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"gobject",title:"事件客体",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"gdescribe",title:"事件描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gresult",title:"事件结果",align:"center",width:140,ellipsis:{tooltip:!0},render:t=>{var s,m,i;return t.gresult?a(B,{size:"small",type:(s=t.gresult)!=null&&s.includes("成功")||(m=t.gresult)!=null&&m.includes("success")?"success":(i=t.gresult)!=null&&i.includes("失败")?"error":"warning"},{default:()=>{var x;return[(x=t.gresult)!=null&&x.includes("success")?"成功":t.gresult]}}):""}},{key:"level",title:"安全级别",align:"center",width:140,render:t=>{const s=q[t.level];let m={color:P[t.level],textColor:"#ffffff",borderColor:P[t.level]};return a(B,{size:"small",color:m},We(s)?s:{default:()=>[s]})}},{key:"epids",title:"事件类别",align:"center",width:120},{key:"eids",title:"事件类型",align:"center",width:120},{key:"hname",title:"主机名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"dbtime",title:"日志时间",align:"center",width:160},{key:"operate",title:J("common.operate"),align:"center",width:120,fixed:"right",render:t=>a("div",{class:"flex-center gap-8px"},[a(F,{type:"info",ghost:!0,size:"small",onClick:()=>d(t)},{default:()=>[n("详情")]})])}]),S=k(!1),r=k([]),y=k(0),w=async(t=!1)=>{if(!S.value)S.value=!0;else return;C.logsoudev&&C.aip&&(v.value=!1,c.lsid=C.logsoudev,c.startAndEndIp=[C.aip,C.aip],c.startIp=C.aip,c.endIp=C.aip);const{data:s,error:m}=await Ie(c);m||(y.value=s.length,t?r.value=[...r.value,...s]:r.value=s,r.value=r.value.sort((i,x)=>x.id-i.id).map((i,x)=>(i.index=x+1,i)),S.value=!1)},g=async()=>{const{data:t,error:s}=await Ge({_t:new Date().getTime()});T.total=Number(t),T.itemCount=Number(t)};function d(t){e.lsid=t.lsid,e.lsdn=t.lsdn,e.rdbtime=t.rdbtime,e.lmid=t.lmid,e.leid=t.leid,e.ltext=t.ltext,e.aname=t.aname,e.procid=t.procid,e.msgid=t.msgid,e.dbtime=t.dbtime,e.hname=t.hname,e.lcon=t.lcon,e.ip=t.ip,e.lsip=t.lsip,e.priority=t.priority,e.type=t.type,e.version=t.version,e.logtype=t.logtype,e.gsubject=t.gsubject,e.gdescribe=t.gdescribe,e.gresult=t.gresult,e.level=t.level,e.eids=t.eids,e.epids=t.epids,e.gobject=t.gobject,E.value=!0}const D=k(),v=k(!0),O=async()=>{r.value=[],c.lsid||c.leid||c.lmid||c.startIp||c.endIp||c.startTime||c.endTime?v.value=!1:(v.value=!0,g()),c.pageId=void 0,await w(),G()},G=async()=>{var t,s,m;if(r.value.length<j.value/44&&r.value.length<T.total){if(c.pageId==((t=r.value[r.value.length-1])==null?void 0:t.id))return;c.pageId=((m=(s=r.value)==null?void 0:s[r.value.length-1])==null?void 0:m.id)??void 0,w(!0)}};pe(async()=>{await w(),await g(),G()});function K(t){Math.abs(t.target.scrollTop+t.target.offsetHeight-t.target.scrollHeight)<=20&&T.total>r.value.length&&U()}const U=ke.debounce(()=>{var t,s;if(r.value.length<T.total){if(c.pageId==r.value[r.value.length-1].id)return;c.pageId=((s=(t=r.value)==null?void 0:t[r.value.length-1])==null?void 0:s.id)??void 0,w(!0)}},300),T=M({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:t,endIndex:s,page:m,pageSize:i,pageCount:x,itemCount:u}){return`已加载${r.value.length}条`+(r.value.length?v.value?` 共计 ${r.value.length>0?u??0:0} 条`:y.value==c.pageSize?"  预计还有更多":"  没有更多了":"")}});async function W(){const t=new Date().getTime();if(!r.value.length)return;const s=JSON.parse(JSON.stringify(r.value)),m=[];s.forEach(u=>{const z={};L.forEach(_=>{var V,$,h;if(u.hasOwnProperty(_.key)){const R=_.key==="lmid"?((V=o.logModel)==null?void 0:V[u[_.key]])??null:_.key==="leid"?(($=o.logLevel)==null?void 0:$[u[_.key]])??null:_.key==="lsid"?(h=N.value.map(A=>A.data).flat(2).find(A=>A.id==u[_.key]))==null?void 0:h.type:_.key==="level"?q[u[_.key]]??null:_.key=="ltext"?u.ltext+u.lcon:u[_.key];z[_.title]=R}}),m.push(z)}),ze(m,500,[{wpx:50},{wpx:120},{wpx:120},{wpx:120},{wpx:120},{wpx:120},{wpx:100},{wpx:100},{wpx:100},{wpx:120},{wpx:120}],"通用日志_"+new Date().getTime());const x=new Date().getTime();await Me({operation:"导出通用日志",userAgent:navigator.userAgent,status:1,requestTime:x-t<1?1:x-t})}return(t,s)=>{const m=te,i=he,x=ae,u=Ve,z=$e,_=be,V=ye,$=me("no-auth");return H(),fe("div",Je,[a(He,{model:c,"onUpdate:model":s[0]||(s[0]=h=>c=h),onSearch:O,collectorList:N.value,logsoudev:C.logsoudev},null,8,["model","collectorList","logsoudev"]),a(x,{title:"通用日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[a(m,null,{default:l(()=>[ge((H(),Y(f(F),{type:"primary",size:"small",ghost:"",onClick:W,title:"导出已加载"},{default:l(()=>[n("导出已加载")]),_:1})),[[$,"sys:log:operation.insert"]])]),_:1})]),default:l(()=>[a(i,{ref_key:"tableContainerRef",ref:D,columns:L,data:r.value,size:"small","flex-height":!f(I).isMobile,"scroll-x":L.reduce((h,R)=>h+R.width,0),loading:S.value,remote:"","row-key":h=>h.index,showTotal:"","max-height":j.value,"virtual-scroll":"",pagination:T,class:"sm:h-full",onScroll:K},null,8,["columns","data","flex-height","scroll-x","loading","row-key","max-height","pagination"])]),_:1}),a(V,{show:E.value,"onUpdate:show":s[2]||(s[2]=h=>E.value=h),title:"日志详情",preset:"card",class:"w-800px"},{footer:l(()=>[a(m,{justify:"end",size:16},{default:l(()=>[a(f(F),{type:"primary",onClick:s[1]||(s[1]=h=>{E.value=!1})},{default:l(()=>[n(p(f(J)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[Ke,a(_,{class:"h-480px pr-20px"},{default:l(()=>[a(z,{"label-placement":"left","label-style":{width:"120px"},bordered:"",column:1},{default:l(()=>[a(u,null,{label:l(()=>[n(" 采集器名称 ")]),default:l(()=>[n(" "+p(e.type),1)]),_:1}),a(u,null,{label:l(()=>[n(" 事件主体 ")]),default:l(()=>[n(" "+p(e.gsubject),1)]),_:1}),a(u,null,{label:l(()=>[n(" 事件客体 ")]),default:l(()=>[n(" "+p(e.gobject),1)]),_:1}),a(u,null,{label:l(()=>[n(" 事件描述 ")]),default:l(()=>[n(" "+p(e.gdescribe),1)]),_:1}),a(u,null,{label:l(()=>[n(" 事件结果 ")]),default:l(()=>{var h,R,A;return[e!=null&&e.gresult?(H(),Y(f(B),{key:0,size:"small",type:(h=e==null?void 0:e.gresult)!=null&&h.includes("成功")||(R=e==null?void 0:e.gresult)!=null&&R.includes("success")?"success":(A=e==null?void 0:e.gresult)!=null&&A.includes("失败")?"error":"warning"},{default:l(()=>{var X;return[n(p((X=e==null?void 0:e.gresult)!=null&&X.includes("success")?"成功":e==null?void 0:e.gresult),1)]}),_:1},8,["type"])):ve("",!0)]}),_:1}),a(u,null,{label:l(()=>[n(" 安全级别 ")]),default:l(()=>[a(f(B),{size:"small",color:{color:f(P)[e.level],textColor:"#ffffff",borderColor:f(P)[e.level]}},{default:l(()=>[n(p(f(q)[e.level]),1)]),_:1},8,["color"])]),_:1}),a(u,null,{label:l(()=>[n(" 事件类别 ")]),default:l(()=>[n(" "+p(e.epids),1)]),_:1}),a(u,null,{label:l(()=>[n(" 事件类型 ")]),default:l(()=>[n(" "+p(e.eids),1)]),_:1}),a(u,null,{label:l(()=>[n(" 日志时间 ")]),default:l(()=>[n(" "+p(e.dbtime),1)]),_:1}),a(u,null,{label:l(()=>[n(" 接收时间 ")]),default:l(()=>[n(" "+p(e.rdbtime),1)]),_:1}),a(u,null,{label:l(()=>[n(" 模块 ")]),default:l(()=>[n(" "+p(f(o).logModel[e.lmid]),1)]),_:1}),a(u,null,{label:l(()=>[n(" 级别 ")]),default:l(()=>[n(" "+p(f(o).logLevel[e.leid]),1)]),_:1}),a(u,null,{label:l(()=>[n(" 应用名称 ")]),default:l(()=>[n(" "+p(e.aname),1)]),_:1}),a(u,null,{label:l(()=>[n(" PROCID ")]),default:l(()=>[n(" "+p(e.procid),1)]),_:1}),a(u,null,{label:l(()=>[n(" MSGID ")]),default:l(()=>[n(" "+p(e.msgid||"--"),1)]),_:1}),a(u,null,{label:l(()=>[n(" 日志时间 ")]),default:l(()=>[n(" "+p(e.dbtime),1)]),_:1}),a(u,null,{label:l(()=>[n(" 主机名称 ")]),default:l(()=>[n(" "+p(e.hname),1)]),_:1}),a(u,null,{label:l(()=>[n(" 结构数据 ")]),default:l(()=>[n(" -- ")]),_:1}),a(u,null,{label:l(()=>[n(" 日志内容 ")]),default:l(()=>[n(" "+p(e.lcon),1)]),_:1}),a(u,{span:2},{label:l(()=>[n(" 日志原文 ")]),default:l(()=>[n(" "+p(e.logtype?e.ltext:e.ltext+(e.lcon?e.lcon:"")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),pl=De(qe,[["__scopeId","data-v-ee9fd361"]]);export{pl as default};
