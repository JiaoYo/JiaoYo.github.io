import{_ as j}from"./save-outline-C3-ywoQj.js";import{_ as A}from"./round-search--SxcGQWM.js";import{d as G,r as H,aw as D,k as f,ab as J,z as q,o as V,e as R,g as s,w as u,h as x,i as d,B as $,af as C,t as N,$ as T,A as F,c as L,D as Q,ax as W,et as X,eH as Y,aS as Z,P as K,aT as ee,a6 as ae,b4 as v,b1 as ne,_ as te}from"./index-7yfIBuqI.js";import{d as S}from"./debounce-drhMEx72.js";import{_ as I}from"./lodash-DQ4YFNYk.js";import{_ as oe}from"./DatePicker-CfzGw-VJ.js";const se={class:"min-h-500px flex-col-stretch gap-16px lt-sm:overflow-auto"},re=G({name:"stationmanagement_predictionsettings",__name:"index",setup(le){const p=H({dateTime:D(0,Date.now()),type:1}),w=(a,n,t="manuPower",o="isedit")=>{const e=a[n];if(!(e!=null&&e.dbtime))return null;const _=S(l=>{e[t]=l},300);return e[o]?v(ne,{value:e[t],onUpdateValue:_,max:(e==null?void 0:e.maxValue)||void 0,min:e==null?void 0:e.minValue,placeholder:`${e!=null&&e.minValue?`min${e==null?void 0:e.minValue}`:""}${e!=null&&e.minValue&&(e!=null&&e.maxValue)?"~":""}${e!=null&&e.maxValue?`max${e==null?void 0:e.maxValue}`:""}`||"请输入",onBlur:()=>{e[o]=!1}}):v("span",{style:{cursor:"pointer",width:"100%",display:"inline-block",height:"40px",lineHeight:"40px"},onClick:()=>{e[o]=!0,setTimeout(()=>{const l=document.querySelectorAll("input");l.length&&l[l.length-1].focus()},0)}},e[t]||v("span",{style:{color:"rgba(194, 194, 194,.7)",fontSize:"12px"}},"未设置"))},M=[{title:"时间",key:"dbtime",render:a=>{var n;return s("span",null,[(n=a[0])==null?void 0:n.dbtime])}},{title:"预测值",key:"manuPower",render:a=>w(a,0),className:"inputInt"},{title:"时间",key:"dbtime",render:a=>{var n;return s("span",null,[(n=a[1])==null?void 0:n.dbtime])}},{title:"预测值",key:"manuPower",render:a=>w(a,1),className:"inputInt"},{title:"时间",key:"dbtime",render:a=>{var n;return s("span",null,[(n=a[2])==null?void 0:n.dbtime])}},{title:"预测值",key:"manuPower",render:a=>w(a,2),className:"inputInt"},{title:"时间",key:"dbtime",render:a=>{var n;return s("span",null,[(n=a[3])==null?void 0:n.dbtime])}},{title:"预测值",key:"manuPower",render:a=>w(a,3),className:"inputInt"}],i=f(),g=f([]),m=f(!1),h=async()=>{m.value=!0,i.value=[];const{data:a,error:n}=await W({date:p.dateTime});if(!n){g.value=JSON.parse(JSON.stringify(a)),g.value.forEach(t=>{t.manuPower=t.manuPower?t.manuPower:null}),a.forEach(t=>{t.manuPower=t.manuPower?t.manuPower:null,t.isedit=!1});for(let t=0;t<a.length;t+=4)i.value.push(a.slice(t,t+4));m.value=!1}};h(),f(0);const O=a=>{p.dateTime=D(0,a),h()},B=I.debounce(h,1e3,{leading:!0,trailing:!1}),z=async()=>{var l,b,y;let a=(l=i.value)==null?void 0:l.flat();const n=new Map;g.value.forEach(r=>{r.manuPower!==void 0&&n.set(r.id,r.manuPower)}),a=a.filter(r=>{const c=n.get(r.id);return c!==void 0&&c!==r.manuPower});const{data:t,error:o}=await X(a);if(o)return;(b=window.$message)==null||b.success("设置成功"),h();const e={content:"",matime:p.dateTime,otype:0,optime:null};if(a.forEach(r=>{e.content+=r.manuPower?`${r.dbtime} 预测值${r.manuPower} 
`:""}),(await Y([e])).error)return(y=window.$message)==null?void 0:y.error("上报失败")},E=I.debounce(z,1e3,{leading:!0,trailing:!1}),k=f(!1),U=S(a=>{let n=a==null?void 0:a.flat();const t=new Map;g.value.forEach(o=>{t.set(o.id,o.manuPower)}),n=n.filter(o=>t.get(o.id)!==o.manuPower),k.value=n.length>0},300);return J(()=>i.value,a=>{U(a)},{deep:!0}),(a,n)=>{const t=oe,o=A,e=Z,_=K,l=j,b=ee,y=ae,r=q("no-auth");return V(),R("div",se,[s(y,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:u(()=>[s(_,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:u(()=>[x(" 人工干预设置 "),s(e,null,{default:u(()=>[s(t,{"formatted-value":p.dateTime,"onUpdate:formattedValue":n[0]||(n[0]=c=>p.dateTime=c),"value-format":"yyyy-MM-dd",type:"date","onUpdate:value":O,style:{width:"200px"}},null,8,["formatted-value"]),s(d($),{type:"primary",ghost:"",onClick:d(B)},{icon:u(()=>[s(o,{class:C(["text-icon",{"animate-spin":m.value}])},null,8,["class"])]),default:u(()=>[x(" "+N(d(T)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":u(()=>[s(_,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:u(()=>{var c,P;return[(c=i.value)!=null&&c.length&&((P=i.value)==null?void 0:P.length)>0?F((V(),L(d($),{key:0,onClick:d(E),type:"primary",ghost:"",disabled:!k.value},{icon:u(()=>[s(l,{class:C(["text-icon",{"animate-spin":m.value}])},null,8,["class"])]),default:u(()=>[x(" "+N(d(T)("common.save")),1)]),_:1},8,["onClick","disabled"])),[[r,"power.update"]]):Q("",!0)]}),_:1})]),default:u(()=>[s(b,{columns:M,data:i.value,bordered:!1,"flex-height":!0,class:"sm:h-full","row-key":c=>c.id,loading:m.value},null,8,["data","row-key","loading"])]),_:1})])}}}),_e=te(re,[["__scopeId","data-v-bbdbbe18"]]);export{_e as default};
