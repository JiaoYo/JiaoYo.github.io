import{_ as Pl}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Bdcfc8xX.js";import{_ as Rl}from"./round-delete-BcVZiUgs.js";import{_ as Gl}from"./round-search-Bq40G238.js";import{d as he,s as x,z as ql,D as J,aQ as ce,i as Ol,b as Hl,o as j,f as t,w as a,M as Ml,h as n,aH as P,H as Z,J as Jl,c as S,G as R,B as y,g as u,t as T,a2 as Kl,az as Wl,aJ as $e,e as Ie,ay as Ql,aB as Xl,$ as w,a4 as Yl,N as Zl,aE as et,aD as lt,aA as tt,aC as ee,aR as Ne,aG as Ve,n as z,_ as h,I as L,ax as Pe,aN as Re,F as D,aO as Ge,aF as xe,aM as at,aP as nt,W as it}from"./index-CSRAu6Mr.js";import{l as st,g as _e,d as rt,e as ut,i as dt,m as ot,j as ct,n as pt}from"./aftersale-WbdV2uIG.js";import{u as ft,a as mt}from"./table-C4ThAVf4.js";import{h as qe}from"./permission-CmOmN5tX.js";import{u as ze}from"./usePageData-uFuTUu7m.js";import{_ as vt}from"./Grid-FmK2KN02.js";import{_ as yt}from"./FormItemGridItem-C5FHRong.js";import{_ as gt}from"./DatePicker-Bm-4v85q.js";import{N as ht}from"./Popconfirm-BAXNfjls.js";const xt={class:"gap-16px overflow-auto lt-sm:overflow-auto"};function _t(le){return typeof le=="function"||Object.prototype.toString.call(le)==="[object Object]"&&!nt(le)}const zt=he({name:"aftersales_aftersalesdevice",__name:"index",setup(le){const pe=x(!1),te=x(0),be=x([]),Oe=ql(),fe=J([{label:"质保维修返回",value:0},{label:"整体置换返回",value:1},{label:"报废",value:2},{label:"付费维修返回",value:3},{label:"原件返回",value:4},{label:"其他",value:9}]),He={当日:()=>{const e=new Date().getTime();return[e,e]},本周:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*7,e]},上月:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*30,e]},近一年:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*365,e]},近三年:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*365*3,e]}},G=x([]),{pageData:$,getData:ae,nextPage:Me}=ze(dt),Je=async e=>{const l=e.currentTarget,s=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&$.data.length<$.total&&(await Me(),G.value=$.data,await ee(),setTimeout(()=>{l.scrollTop=s}))},Ke=async()=>{await ae({page:1,limit:100,_t:new Date().getTime()}),G.value=$.data},K=x([]),{pageData:q,getData:me,nextPage:We}=ze(ot),Qe=async()=>{await me(),K.value=q.data.map(e=>({label:e,value:e}))},Xe=async e=>{const l=e.currentTarget,s=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&q.data.length<q.total&&(await We(),await ee(),K.value=q.data.map(o=>({label:o,value:o})),setTimeout(()=>{l.scrollTop=s}))},Ye=ce.debounce(async e=>{await me({fuzzy:e,page:1}),K.value=q.data.map(l=>({label:l,value:l}))},300),Ze=e=>{if(c.gws=null,O.value=!0,ne.value=!1,!e){Ce();return}Ye(e)},Ce=()=>{c.gws=null,g()},el=ce.debounce(e=>{var l;c.gws1=e||void 0,c.gws=(l=c.gws1)==null?void 0:l.join(","),g()},300),ll=async()=>{O.value&&!ne.value&&(await me({page:1}),K.value=q.data.map(e=>({label:e,value:e})),O.value=!1)},tl=ce.debounce(async e=>{await ae({fuzzy:e,page:1}),G.value=$.data},300),O=x(!1),ne=x(!1),al=e=>{if(c.cid=null,O.value=!0,ne.value=!1,!e){Fe();return}tl(e)},nl=async()=>{O.value&&!ne.value&&(await ae({page:1}),G.value=$.data,O.value=!1)},Fe=async()=>{await ae({page:1}),G.value=$.data},il=async e=>{c.cid=e,g()};async function sl(e,l){if(!e){c.startTime=void 0,c.endTime=void 0,g();return}c.startTime=String(Ne(1,l[0])),c.endTime=String(Ne(1,l[1])),g()}const rl=()=>{c.sn=null,g()},ul=ce.debounce(e=>{c.sn=e||void 0,g()},300);Ol(async()=>{await Ke(),await g(),await Qe()});const B=he({props:{value:[String,Number],onUpdateValue:Function},setup(e){const l=x(!1),s=x(null),o=x(String(e.value)),v=()=>{l.value=!0,ee(()=>{var r;return(r=s.value)==null?void 0:r.focus()})},p=()=>{var r;(o.value!==void 0||o.value!==null||o.value!=="")&&o.value!=e.value?((r=e.onUpdateValue)==null||r.call(e,o.value),l.value=!1,o.value=""):l.value=!1};return()=>z("div",{style:"min-height:30px;cursor:pointer;min-width:60px",class:"flex items-center justify-center",onClick:v},l.value?z(Z,{ref:s,value:o.value,onUpdateValue:r=>o.value=r,onBlur:p}):e.value||"--")}}),ke=he({props:{value:[String,Number],options:{type:Array,required:!0},onUpdateValue:Function},setup(e){const l=x(!1),s=x(null),o=x(e.value),v=()=>{l.value=!0,ee(()=>{var r,m;(m=(r=s.value)==null?void 0:r.focus)==null||m.call(r)})},p=r=>{var m;o.value=r,(r!==void 0||r!==null)&&r!==e.value?((m=e.onUpdateValue)==null||m.call(e,r),l.value=!1,o.value=null):l.value=!1};return()=>{var r,m;return z("div",{style:"height:100%;cursor:pointer;width:100%",class:"flex items-center justify-center",onClick:v},l.value?z(P,{ref:s,value:o.value,options:e.options,size:"small",style:"width:150px","onUpdate:value":p,placeholder:"请选择",onBlur:()=>l.value=!1}):(m=(r=e.options)==null?void 0:r.find(b=>b.value==e.value))!=null&&m.label?t(at,{type:"info"},{default:()=>{var b,U;return[(U=(b=e.options)==null?void 0:b.find(A=>A.value==e.value))==null?void 0:U.label]}}):"--")}}}),H=x(!1),_=J({id:[],type:"",password:""});async function dl(e){_.id=[e],_.type="deleteComp",_.password="",H.value=!0}async function ol(){_.id=Q.value,_.type="deleteComp",_.password="",H.value=!0}function cl(){H.value=!1,_.id=[],_.type="",_.password=""}async function pl(){var s,o;if(!_.password){(s=window.$message)==null||s.destroyAll(),(o=window.$message)==null||o.error("请输入密码");return}const{data:e,error:l}=await st(_.id,_.password);l||(H.value=!1,_.id=[],_.type="",_.password="",Ul(),c.page=1,g())}const F=async(e,l,s)=>{var p;const{data:o,error:v}=await _e([{id:e.id,[s]:l}]);v?(e[s]=null,console.log(e,"row")):((p=window.$message)==null||p.success("设置成功"),g())},ie=x(!1),f=J({id:0,type:"",value:"",accessory:"",raccessory:""});function se(e,l,s){f.id=e,s=="rdetails"?(f.value=l.rdetails,f.raccessory=l.raccessory):s=="details"?(f.value=l.details,f.accessory=l.accessory):f.value=l,f.type=s,ie.value=!0}const fl=e=>{window.open(e,"_blank")};function we(){ie.value=!1,f.id=0,f.value="",f.type=""}async function ml(){var m,b,U,A,V,C,ue;if(!f.value){(m=window.$message)==null||m.destroyAll(),(b=window.$message)==null||b.error("请选择类型");return}if(f.value==1&&f.type=="details"&&!f.accessory){(U=window.$message)==null||U.destroyAll(),(A=window.$message)==null||A.error("请输入配件详情");return}if(f.value==1&&f.type=="rdetails"&&!f.raccessory){(V=window.$message)==null||V.destroyAll(),(C=window.$message)==null||C.error("请输入配件详情");return}const{id:e,value:l,type:s,accessory:o,raccessory:v}=f,{data:p,error:r}=await _e([{id:e,[s]:l,accessory:s=="details"&&l==1?o:void 0,raccessory:s=="rdetails"&&l==1?v:void 0}]);r||(we(),(ue=window.$message)==null||ue.success("设置成功"),g())}const{pageData:I,getData:N,nextPage:vl}=ze(ct),Le=async e=>{const l=e.currentTarget,s=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&I.data.length<I.total&&(await vl(),await ee(),setTimeout(()=>{l.scrollTop=s}))};N();const De=async()=>{await N({page:1}),Be()},yl=async e=>{if(!e){De();return}gl.value=e,await N({fuzzy:e,page:1}),Be()},W=J(new Map),gl=x("");function Be(){const e=[];I.data.forEach(l=>{W.has(l.id)||e.push(l)}),W.forEach(l=>{e.push(l)}),I.data=e}const Ue=e=>{I.data.forEach(l=>{e.includes(l.id)&&W.set(l.id,l)}),Array.from(W.keys()).forEach(l=>{e.includes(l)||W.delete(l)})},hl=e=>{c.reid=e,g()},xl=async()=>{await N({page:1}),c.reid=null,g()},_l=e=>{if(!e){N({page:1});return}N({fuzzy:e,page:1})},zl=e=>{c.conc=e,g()},bl=async()=>{c.conc=null,g()},Cl=async()=>{c.pending=null,g()},Fl=e=>{c.pending=e==1?1:void 0,g()},kl=e=>{c.conc=e.conc,c.page=1,g()},re=x(!1),k=J({id:0,reidList:[],copyList:[]}),wl=async e=>{await N(),re.value=!0,k.id=e.id,k.reidList=e.list.map(l=>l.reid),k.copyList=JSON.parse(JSON.stringify(e.list)),Ue(k.reidList)},je=()=>{re.value=!1,k.id=0,k.reidList=[]},Ll=async()=>{var v;const e=k.reidList||[],l=k.copyList.map(p=>p.reid)||[],s=e.filter(p=>!l.includes(p)),o=l.filter(p=>!e.includes(p)).map(p=>{var r;return(r=k.copyList.find(m=>m.reid===p))==null?void 0:r.id}).filter(Boolean);if(console.log(s,"addIds"),console.log(o,"delIds",o.join(",")),s.length>0){const{data:p,error:r}=await rt(s.map(m=>({afid:k.id,reid:m})))}if(o.length>0){const{data:p,error:r}=await ut({arrIds:o.join(",")})}(v=window.$message)==null||v.success("设置成功"),je(),g()},{columns:Se,columnChecks:ve,data:Te,getData:g,loading:Dl,mobilePagination:Bl,searchParams:c}=ft({showTotal:!0,immediate:!1,apiFn:pt,apiParams:{page:1,pageSize:20,limit:20,cid:null,gws:void 0,gws1:[],sn:null,reid:null,conc:null,pending:null,dbtime:null,startAndTimeRange:null,startTime:null,endTime:null,_t:new Date().getTime()},columns:()=>Oe.userInfo.usertype!=7?[{type:"selection",align:"center",width:48,fixed:"left",resizable:!0},{title:"网关编号",key:"sn",align:"center",width:180,fixed:"left",resizable:!0},{title:"网关型号",align:"center",key:"model",width:120,resizable:!0},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("是否推送厂家")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"manu",width:200,resizable:!0,render(e){return e.id&&z(ke,{value:e.manu??null,options:[{value:0,label:"否"},{value:1,label:"是"}],onUpdateValue(l){F(e,l,"manu")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("寄回类型")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"details",width:200,resizable:!0,render:e=>t("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[e.details==0||e.details==1?t(Pe,null,[t("div",{class:"w-full",title:`${e.details}`},[t("div",null,[u("类型："),e.details==0?"裸机":"包含配件"]),e.details==1&&t("div",null,[u("配件详情："),e.accessory])]),t(Re,{trigger:"hover",placement:"right"},{trigger:()=>L(t(y,{text:!0,type:"primary",onClick:()=>se(e.id,e,"details")},{default:()=>[t("span",{class:"akar-icons--edit"},null)]}),[[D("no-auth"),"aftermarket:update:permission.do"]]),default:()=>w("common.update")})]):e.id&&L(t(y,{text:!0,type:"primary",size:"small",onClick:()=>se(e.id,"","details")},{default:()=>[u("填写")]}),[[D("no-auth"),"aftermarket:update:permission.do"]])])},{key:"devre1",title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("现场照片")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",width:300,resizable:!0,render:e=>t("div",{class:"flex items-center justify-center gap-4px"},[e.devre1||e.devre2||e.devre3?t(Ge,{value:e.devre1&&e.devre2&&e.devre3?3:e.devre1&&e.devre2?2:void 0,color:"#1890ff"},{default:()=>[t("div",{style:{cursor:"pointer"},onClick:()=>ye([e.devre1||e.devre2||e.devre3].filter(l=>l),0)},[t(xe,{width:70,src:e.devre1||e.devre2||e.devre3,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)])]}):null,e.id&&t("div",null,[!e.devre1&&!e.devre2&&!e.devre3&&e.id&&L(t(y,{size:"small",type:"primary",onClick:()=>E(e,"sceneImg")},{default:()=>[u("点击上传")]}),[[D("no-auth"),"aftermarket:update:permission.do"]]),(e.devre1||e.devre2||e.devre3)&&L(t(y,{size:"small",type:"primary",onClick:()=>E(e,"sceneImg"),style:{marginLeft:"5px"}},{default:()=>[u("编辑图片")]}),[[D("no-auth"),"aftermarket:update:permission.do"]])])])},{key:"devre4",title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("现场视频")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",width:300,resizable:!0,render:e=>t("div",{class:"flex items-center justify-center gap-4px"},[e.devre4?t("video",{src:e.devre4,style:{height:"70px",width:"100%",cursor:"pointer",objectFit:"cover"},onClick:()=>fl(e.devre4)},null):null,t("div",null,[!e.devre4&&e.id&&L(t(y,{size:"small",type:"primary",onClick:()=>E(e,"video")},{default:()=>[u("点击上传")]}),[[D("no-auth"),"aftermarket:update:permission.do"]]),e.devre4&&L(t(y,{size:"small",type:"primary",onClick:()=>E(e,"video"),style:{marginLeft:"5px"}},{default:()=>[u("编辑视频")]}),[[D("no-auth"),"aftermarket:update:permission.do"]])])])},{key:"devre5",title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("分析照片")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",width:300,resizable:!0,render:e=>t("div",{class:"flex items-center justify-center gap-4px"},[e.devre5||e.devre6||e.devre7?t(Ge,{value:e.devre5&&e.devre6&&e.devre7?3:e.devre5&&e.devre6?2:void 0,color:"#1890ff"},{default:()=>[t("div",{style:{cursor:"pointer"},onClick:()=>ye([e.devre5||e.devre6||e.devre7].filter(l=>l),0)},[t(xe,{width:70,src:e.devre5||e.devre6||e.devre7,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)])]}):null,t("div",null,[!e.devre5&&!e.devre6&&!e.devre7&&e.id&&L(t(y,{size:"small",type:"primary",onClick:()=>E(e,"analyze")},{default:()=>[u("点击上传")]}),[[D("no-auth"),"aftermarket:update:permission.do"]]),(e.devre5||e.devre6||e.devre7)&&L(t(y,{size:"small",type:"primary",onClick:()=>E(e,"analyze"),style:{marginLeft:"5px"}},{default:()=>[u("编辑图片")]}),[[D("no-auth"),"aftermarket:update:permission.do"]])])])},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("网关二维码")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"qrcode",width:300,resizable:!0,ellipsis:{tooltip:!0},render:e=>t("div",{class:"flex items-center justify-center gap-4px"},[e.qrcode?t("div",{style:{cursor:"pointer"},onClick:()=>ye([e.qrcode].filter(l=>l),0)},[t(xe,{width:70,src:e.qrcode,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)]):null,t("div",null,[!e.qrcode&&e.id&&L(t(y,{size:"small",type:"primary",onClick:()=>E(e,"qrcode")},{default:()=>[u("点击上传")]}),[[D("no-auth"),"aftermarket:update:permission.do"]]),e.qrcode&&L(t(y,{size:"small",type:"primary",onClick:()=>E(e,"qrcode"),style:{marginLeft:"5px"}},{default:()=>[u("编辑图片")]}),[[D("no-auth"),"aftermarket:update:permission.do"]])])])},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("故障现象")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"fault",width:200,resizable:!0,ellipsis:{tooltip:!0},render(e){return e.id&&z(B,{value:e.fault||"",onUpdateValue(l){F(e,l,"fault")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("售后原因")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"list",width:200,resizable:!0,render:e=>{var l,s;return t("div",{class:"flex items-center justify-center"},[t("div",{class:"text-left"},[((l=e.list)==null?void 0:l.length)&&e.list.map((o,v)=>o.rs).join("、")]),e.id&&t("div",{onClick:()=>wl(e)},[t(h,{"local-icon":"setup",class:"font-size-20px ml-5px",style:{cursor:"pointer",color:((s=e.list)==null?void 0:s.length)>0?"#1890ff":""}},null)])])}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("诊断结论")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",width:200,resizable:!0,key:"diagnosis",ellipsis:{tooltip:!0},render(e){return e.id&&z(B,{value:e.diagnosis||"",onUpdateValue(l){F(e,l,"diagnosis")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("临时处理")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"tphand",width:200,resizable:!0,ellipsis:{tooltip:!0},render(e){return e.id&&z(B,{value:e.tphand||"",onUpdateValue(l){F(e,l,"tphand")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("长期改善")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"impv",width:200,resizable:!0,ellipsis:{tooltip:!0},render(e){return e.id&&z(B,{value:e.impv||"",onUpdateValue(l){F(e,l,"impv")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("处理结论")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"conc",width:200,resizable:!0,ellipsis:{tooltip:!0},defaultFilterOptionValue:null,filterOptions:fe,filter:!0,filterMultiple:!1,render(e){return e.id&&z(ke,{value:e.conc??null,options:fe,onUpdateValue(l){F(e,l,"conc")}})}},{title:"处理时长",key:"duration",width:120,resizable:!0,align:"center",render:e=>e.duration&&e.id?t("div",null,[e.conc!==null&&e.conc!==void 0?"总耗时":"已历时",u(" "),e.duration?e.duration+" 天":"--"]):""},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("备注")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"devnotes",width:200,resizable:!0,align:"center",render(e){return e.id&&z(B,{value:e.devnotes||"",onUpdateValue(l){F(e,l,"devnotes")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("发货信息")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"returnnum",align:"center",width:200,resizable:!0,render(e){return e.id&&z(B,{value:e.returnnum||"",onUpdateValue(l){F(e,l,"returnnum")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("发货网关编号")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"rsn",align:"center",width:200,resizable:!0,render(e){return e.id&&z(B,{value:e.rsn||"",onUpdateValue(l){F(e,l,"rsn")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("发货网关型号")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"rmodel",align:"center",width:200,resizable:!0,render(e){return e.id&&z(B,{value:e.rmodel||"",onUpdateValue(l){F(e,l,"rmodel")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("发货寄件类型")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"rdetails",align:"center",width:200,resizable:!0,render:e=>t("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[e.rdetails==0||e.rdetails==1?t(Pe,null,[t("div",{class:"w-full",title:`${e.rdetails}`},[t("div",null,[u("类型："),e.rdetails==0?"裸机":"包含配件"]),t("div",null,[u("配件详情："),e.raccessory])]),t(Re,{trigger:"hover",placement:"right"},{trigger:()=>L(t(y,{text:!0,type:"primary",onClick:()=>se(e.id,e,"rdetails")},{default:()=>[t("span",{class:"akar-icons--edit"},null)]}),[[D("no-auth"),"aftermarket:update:permission.do"]]),default:()=>w("common.update")})]):e.id&&L(t(y,{text:!0,type:"primary",size:"small",onClick:()=>se(e.id,"","rdetails")},{default:()=>[u("填写")]}),[[D("no-auth"),"aftermarket:update:permission.do"]])])},{title:"发货时间",key:"rdbtime",align:"center",width:180,resizable:!0,render:e=>t("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[t("div",{class:"w-full",title:`${e.rdbtime}`},[e.rdbtime])])},{title:"发货人",key:"rcusername",align:"center",width:100,resizable:!0,render:e=>t("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[t("div",{class:"w-full",title:`${e.rcusername}`},[e.rcusername])])},{key:"operate",title:w("common.operate"),align:"center",width:120,fixed:"right",render:e=>t("div",{class:"flex-center gap-8px"},[t(ht,{onPositiveClick:()=>dl(e.id)},{default:()=>w("common.confirmDelete"),trigger:()=>{let l;return L(t(y,{type:"error",ghost:!0,size:"small"},_t(l=w("common.delete"))?l:{default:()=>[l]}),[[D("no-auth"),"aftermarket:delete:permission.do"]])}})])}]:[{type:"selection",align:"center",width:48,fixed:"left",resizable:!0},{title:"网关编号",key:"sn",align:"center",width:180,fixed:"left",resizable:!0},{title:"网关型号",align:"center",key:"model",width:120,resizable:!0},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("售后原因")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"list",width:200,resizable:!0,render:e=>{var l;return t("div",{class:"flex items-center justify-center"},[t("div",{class:"text-left"},[((l=e.list)==null?void 0:l.length)&&e.list.map((s,o)=>s.rs).join("、")])])}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("诊断结论")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",width:200,resizable:!0,key:"diagnosis",ellipsis:{tooltip:!0},render(e){return e.id&&z(B,{value:e.diagnosis||"",onUpdateValue(l){F(e,l,"diagnosis")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("临时处理")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"tphand",width:200,resizable:!0,ellipsis:{tooltip:!0},render(e){return e.id&&z(B,{value:e.tphand||"",onUpdateValue(l){F(e,l,"tphand")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[u("长期改善")]),t(h,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"impv",width:200,resizable:!0,ellipsis:{tooltip:!0},render(e){return e.id&&z(B,{value:e.impv||"",onUpdateValue(l){F(e,l,"impv")}})}}]}),{checkedRowKeys:Q,onDeleted:Ul}=mt(Te,g),ye=(e,l=0)=>{be.value=e,te.value=l,pe.value=!0},jl=e=>{te.value=e},X=x(!1),i=J({id:0,type:"",analyzeFileList:[]});function E(e,l){console.log(e,i,"row"),i.analyzeFileList=[],i.id=e.id,i.type=l,l==="qrcode"?e.qrcode&&i.analyzeFileList.push({id:"0",name:"0",url:e.qrcode,status:"finished"}):l==="sceneImg"?(e.devre1&&i.analyzeFileList.push({id:"0",name:"0",url:e.devre1,status:"finished"}),e.devre2&&i.analyzeFileList.push({id:"1",name:"1",url:e.devre2,status:"finished"}),e.devre3&&i.analyzeFileList.push({id:"2",name:"2",url:e.devre3,status:"finished"})):l==="video"?e.devre4&&i.analyzeFileList.push({id:"0",name:e.devre4.split("?")[1],url:e.devre4,status:"finished"}):(e.devre5&&i.analyzeFileList.push({id:"0",name:"0",url:e.devre5,status:"finished"}),e.devre6&&i.analyzeFileList.push({id:"1",name:"1",url:e.devre6,status:"finished"}),e.devre7&&i.analyzeFileList.push({id:"2",name:"2",url:e.devre7,status:"finished"})),X.value=!0}function Ae(e){var v,p,r,m;const l=["image/jpeg","image/png","image/jpg","image/x-icon"];console.log("data.file.file",e.file.file);const s=l.includes(e.file.file.type),o=e.file.file.size/1024/1024<100;return s||((v=window.$message)==null||v.destroyAll(),(p=window.$message)==null||p.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片")),o||((r=window.$message)==null||r.destroyAll(),(m=window.$message)==null||m.error("上传图片大小不能超过 100MB")),s&&o}const Y=x(0);async function ge(e){var v,p;Y.value=0;const{file:l,onFinish:s,onError:o}=e;if(!l.file)return s({...l});try{const r=await Ve(l.file,l.name,"aftermarket/image",m=>{Y.value=m});r&&(l.url=r,s({...l,url:r}),(v=window.$message)==null||v.destroyAll(),(p=window.$message)==null||p.success("上传成功"),Y.value=0)}catch(r){o(r)}}function Sl(){X.value=!1,i.analyzeFileList=[]}function Tl(e){return new Promise((l,s)=>{ge({file:e,onFinish:()=>l(!0),onError:o=>s(o)})})}async function Al(){var r,m,b,U,A,V;console.log(i,"uploadImgForm");let e=[{id:i.id}];const l=i.analyzeFileList;if(await Promise.all([...l.map(C=>Tl(C))]),l.some(C=>C.url&&C.url.startsWith("blob:"))){(r=window.$message)==null||r.destroyAll(),(m=window.$message)==null||m.warning("还有文件正在上传或上传失败，请稍后提交");return}if(l.some(C=>!C.url||C.url.trim()==="")){(b=window.$message)==null||b.destroyAll(),(U=window.$message)==null||U.warning("存在上传失败的文件，请重新上传");return}i.type==="qrcode"?i.analyzeFileList.length==0?e[0].qrcode="":e[0].qrcode=i.analyzeFileList[0].url:i.type==="video"?i.analyzeFileList.length==0?e[0].devre4="":e[0].devre4=i.analyzeFileList[0].url:i.type==="sceneImg"?(i.analyzeFileList.length==0&&(e[0].devre1="",e[0].devre2="",e[0].devre3=""),i.analyzeFileList.length==1&&(e[0].devre1=i.analyzeFileList[0].url,e[0].devre2="",e[0].devre3=""),i.analyzeFileList.length==2&&(e[0].devre1=i.analyzeFileList[0].url,e[0].devre2=i.analyzeFileList[1].url,e[0].devre3=""),i.analyzeFileList.length==3&&(e[0].devre1=i.analyzeFileList[0].url,e[0].devre2=i.analyzeFileList[1].url,e[0].devre3=i.analyzeFileList[2].url)):(i.analyzeFileList.length==0&&(e[0].devre5="",e[0].devre6="",e[0].devre7=""),i.analyzeFileList.length==1&&(e[0].devre5=i.analyzeFileList[0].url,e[0].devre6="",e[0].devre7=""),i.analyzeFileList.length==2&&(e[0].devre5=i.analyzeFileList[0].url,e[0].devre6=i.analyzeFileList[1].url,e[0].devre7=""),i.analyzeFileList.length==3&&(e[0].devre5=i.analyzeFileList[0].url,e[0].devre6=i.analyzeFileList[1].url,e[0].devre7=i.analyzeFileList[2].url));const{data:v,error:p}=await _e(e);p||((A=window.$message)==null||A.destroyAll(),(V=window.$message)==null||V.success(v.msg||"操作成功"),g(),X.value=!1,i.id=0,i.analyzeFileList=[])}function El(e){var v,p,r,m;const s=["video/mp4","video/avi","video/mov","video/mpeg"].includes(e.file.file.type),o=e.file.file.size/1024/1024<100;return s||((v=window.$message)==null||v.destroyAll(),(p=window.$message)==null||p.error("格式错误，请上传视频！")),o||((r=window.$message)==null||r.destroyAll(),(m=window.$message)==null||m.error("上传视频大小不能超过 100MB！")),s&&o}async function $l(e){const{file:l,onFinish:s,onError:o}=e;new FormData().append("multipartFile",l.file);try{const p=await Ve(l.file,l.name,"aftermarket/image/",r=>{});p&&(s({...l,url:p}),i.analyzeFileList[0].url=p)}catch(p){o(p)}}const Il=x(window.innerHeight-390);return(e,l)=>{const s=yt,o=gt,v=Gl,p=Rl,r=Jl,m=vt,b=Ml,U=Kl,A=Pl,V=Wl,C=Ql,ue=Xl,de=Yl,oe=lt,Ee=et,M=Zl,Nl=tt;return j(),Hl("div",xt,[t(U,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[t(b,{ref:"formRef",model:n(c),"label-placement":"left","label-width":100,"show-feedback":!1},{default:a(()=>[t(m,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[t(s,{span:"24 s:12 m:6",label:"客户公司",path:"cid"},{default:a(()=>[t(n(P),{filterable:"",clearable:"",value:n(c).cid,"onUpdate:value":[l[0]||(l[0]=d=>n(c).cid=d),il],placeholder:"请选择客户公司","label-field":"comp","value-field":"id",onClear:Fe,onSearch:al,onBlur:nl,options:G.value,onScroll:Je},null,8,["value","options"])]),_:1}),t(s,{span:"24 s:12 m:6",label:"设备编号",path:"sn"},{default:a(()=>[t(n(Z),{clearable:"",value:n(c).sn,"onUpdate:value":[l[1]||(l[1]=d=>n(c).sn=d),n(ul)],onClear:rl,placeholder:"请输入设备编号"},null,8,["value","onUpdate:value"])]),_:1}),t(s,{span:"24 s:12 m:6",label:"网关型号",path:"gws"},{default:a(()=>[t(n(P),{clearable:"",filterable:"",multiple:"",value:n(c).gws1,"onUpdate:value":[l[2]||(l[2]=d=>n(c).gws1=d),n(el)],placeholder:"请选择网关型号","label-field":"label","value-field":"value",options:K.value,onSearch:Ze,onBlur:ll,onScroll:Xe,onClear:Ce},null,8,["value","options","onUpdate:value"])]),_:1}),t(s,{span:"24 s:12 m:6",label:"售后原因",path:"reid"},{default:a(()=>[t(n(P),{value:n(c).reid,"onUpdate:value":[l[3]||(l[3]=d=>n(c).reid=d),hl],clearable:"",filterable:"","label-field":"rs","value-field":"id",options:n(I).data,onScroll:Le,onClear:xl,onSearch:_l,placeholder:"请选择售后原因"},null,8,["value","options"])]),_:1}),t(s,{span:"24 s:12 m:6",label:"处理结论",path:"conc"},{default:a(()=>[t(n(P),{value:n(c).conc,"onUpdate:value":[l[4]||(l[4]=d=>n(c).conc=d),zl],clearable:"",options:fe,onClear:bl,placeholder:"请选择处理结论"},null,8,["value","options"])]),_:1}),t(s,{span:"24 s:12 m:4",label:"待厂家处理",path:"pending"},{default:a(()=>[t(n(P),{value:n(c).pending,"onUpdate:value":[l[5]||(l[5]=d=>n(c).pending=d),Fl],clearable:"",options:[{label:"待处理",value:1},{label:"全部",value:0}],onClear:Cl,placeholder:"请选择"},null,8,["value"])]),_:1}),t(s,{span:"24 s:12 m:8",label:"起止时间"},{default:a(()=>[t(o,{value:n(c).startAndTimeRange,"onUpdate:value":l[6]||(l[6]=d=>n(c).startAndTimeRange=d),type:"datetimerange",clearable:"",shortcuts:He,"onUpdate:formattedValue":sl},null,8,["value"])]),_:1}),t(s,{span:"24 s:12 m:5"},{default:a(()=>[t(r,{class:"w-full"},{default:a(()=>[n(qe)("aftermarket:select:permission.do")?(j(),S(n(y),{key:0,ghost:"",onClick:n(g)},{icon:a(()=>[t(v,{class:"text-icon"})]),default:a(()=>[l[24]||(l[24]=u(" "+T("查询")))]),_:1,__:[24]},8,["onClick"])):R("",!0),n(qe)("aftermarket:delete:permission.do")?(j(),S(n(y),{key:1,type:"error",disabled:n(Q).length===0,onClick:ol},{icon:a(()=>[t(p,{class:"text-icon"})]),default:a(()=>[l[25]||(l[25]=u(" "+T("批量删除")))]),_:1,__:[25]},8,["disabled"])):R("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(U,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t(r,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>l[26]||(l[26]=[Ie("div",null,"售后设备",-1)])),_:1,__:[26]})]),"header-extra":a(()=>[t(r,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[t(A,{columns:n(ve),"onUpdate:columns":l[7]||(l[7]=d=>$e(ve)?ve.value=d:null),ctype:4},null,8,["columns"])]),_:1})]),default:a(()=>[t(V,{"checked-row-keys":n(Q),"onUpdate:checkedRowKeys":l[8]||(l[8]=d=>$e(Q)?Q.value=d:null),columns:n(Se),data:n(Te),size:"small",loading:n(Dl),remote:"","max-height":Il.value,"scroll-x":n(Se).reduce((d,Vl)=>d+(Vl.width||100),0),"row-key":d=>d.id,pagination:n(Bl),class:"sm:h-full",striped:"","onUpdate:filters":kl},null,8,["checked-row-keys","columns","data","loading","max-height","scroll-x","row-key","pagination"])]),_:1}),t(de,{show:X.value,"onUpdate:show":l[12]||(l[12]=d=>X.value=d),title:i.type==="qrcode"?"二维码上传":i.type==="sceneImg"?"现场照片上传":i.type==="video"?"现场视频上传":"分析照片上传",preset:"card",class:"w-800px"},{footer:a(()=>[t(r,{justify:"end"},{default:a(()=>[t(n(y),{size:"small",class:"mt-16px",onClick:Sl},{default:a(()=>[u(T(n(w)("common.cancel")),1)]),_:1}),t(n(y),{type:"primary",size:"small",class:"mt-16px",onClick:Al},{default:a(()=>[u(T(n(w)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[i.type==="qrcode"?(j(),S(C,{key:0,multiple:"",max:1,"file-list":i.analyzeFileList,"onUpdate:fileList":l[9]||(l[9]=d=>i.analyzeFileList=d),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ae,"custom-request":ge},{default:a(()=>l[27]||(l[27]=[u(" 点击上传 ")])),_:1,__:[27]},8,["file-list"])):i.type==="video"?(j(),S(C,{key:1,"file-list":i.analyzeFileList,"onUpdate:fileList":l[10]||(l[10]=d=>i.analyzeFileList=d),"default-upload":!1,onBeforeUpload:El,max:1,"custom-request":$l},{default:a(()=>[t(n(y),{type:"primary"},{default:a(()=>l[28]||(l[28]=[u(" 上传视频 ")])),_:1,__:[28]})]),_:1},8,["file-list"])):(j(),S(C,{key:2,multiple:"",max:3,"file-list":i.analyzeFileList,"onUpdate:fileList":l[11]||(l[11]=d=>i.analyzeFileList=d),"list-type":"image-card",onBeforeUpload:Ae,"default-upload":!1,"custom-request":ge},{default:a(()=>l[29]||(l[29]=[u(" 点击上传 ")])),_:1,__:[29]},8,["file-list"])),Ie("div",null,[Y.value?(j(),S(ue,{key:0,type:"line",percentage:Y.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):R("",!0)])]),_:1},8,["show","title"]),t(de,{show:ie.value,"onUpdate:show":l[17]||(l[17]=d=>ie.value=d),title:f.type=="rdetails"?"设备发货网关寄回类型":f.type=="details"?"寄回类型":"",preset:"card",class:"w-600px"},{footer:a(()=>[t(r,{justify:"end"},{default:a(()=>[t(n(y),{size:"small",class:"mt-16px",onClick:we},{default:a(()=>[u(T(n(w)("common.cancel")),1)]),_:1}),t(n(y),{type:"primary",size:"small",class:"mt-16px",onClick:ml},{default:a(()=>[u(T(n(w)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[f.type==="details"?(j(),S(b,{key:0,ref:"formRef",model:f,"label-placement":"left"},{default:a(()=>[t(M,{label:"设备寄回类型",path:"value"},{default:a(()=>[t(Ee,{value:f.value,"onUpdate:value":l[13]||(l[13]=d=>f.value=d),name:"radiogroup"},{default:a(()=>[t(r,null,{default:a(()=>[t(oe,{value:0},{default:a(()=>l[30]||(l[30]=[u("仅裸机")])),_:1,__:[30]}),t(oe,{value:1},{default:a(()=>l[31]||(l[31]=[u("含配件")])),_:1,__:[31]})]),_:1})]),_:1},8,["value"])]),_:1}),f.value==1?(j(),S(M,{key:0,label:"配件详情",path:"accessory"},{default:a(()=>[t(n(Z),{value:f.accessory,"onUpdate:value":l[14]||(l[14]=d=>f.accessory=d),placeholder:"请输入配件详情",clearable:""},null,8,["value"])]),_:1})):R("",!0)]),_:1},8,["model"])):R("",!0),f.type==="rdetails"?(j(),S(b,{key:1,ref:"formRef",model:f,"label-placement":"left"},{default:a(()=>[t(M,{label:"设备发货网关寄回类型",path:"value"},{default:a(()=>[t(Ee,{value:f.value,"onUpdate:value":l[15]||(l[15]=d=>f.value=d),name:"radiogroup"},{default:a(()=>[t(r,null,{default:a(()=>[t(oe,{value:0},{default:a(()=>l[32]||(l[32]=[u("仅裸机")])),_:1,__:[32]}),t(oe,{value:1},{default:a(()=>l[33]||(l[33]=[u("含配件")])),_:1,__:[33]})]),_:1})]),_:1},8,["value"])]),_:1}),f.value==1?(j(),S(M,{key:0,label:"发货配件详情",path:"raccessory"},{default:a(()=>[t(n(Z),{value:f.raccessory,"onUpdate:value":l[16]||(l[16]=d=>f.raccessory=d),placeholder:"请输入发货配件详情",clearable:""},null,8,["value"])]),_:1})):R("",!0)]),_:1},8,["model"])):R("",!0)]),_:1},8,["show","title"]),t(de,{show:H.value,"onUpdate:show":l[19]||(l[19]=d=>H.value=d),title:"二次确认",preset:"card",class:"w-600px"},{footer:a(()=>[t(r,{justify:"end"},{default:a(()=>[t(n(y),{size:"small",class:"mt-16px",onClick:cl},{default:a(()=>[u(T(n(w)("common.cancel")),1)]),_:1}),t(n(y),{type:"primary",size:"small",class:"mt-16px",onClick:pl},{default:a(()=>[u(T(n(w)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(b,{ref:"formRef",model:_,"label-placement":"left"},{default:a(()=>[t(M,{label:"密码",path:"password",required:""},{default:a(()=>[t(n(Z),{type:"password","show-password-on":"mousedown",value:_.password,"onUpdate:value":l[18]||(l[18]=d=>_.password=d),placeholder:"请输入密码",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),t(de,{show:re.value,"onUpdate:show":l[21]||(l[21]=d=>re.value=d),title:"设置售后原因",preset:"card",class:"w-600px"},{footer:a(()=>[t(r,{justify:"end"},{default:a(()=>[t(n(y),{size:"small",class:"mt-16px",onClick:je},{default:a(()=>[u(T(n(w)("common.cancel")),1)]),_:1}),t(n(y),{type:"primary",size:"small",class:"mt-16px",onClick:Ll},{default:a(()=>[u(T(n(w)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(b,{ref:"formRef",model:k,"label-placement":"left"},{default:a(()=>[t(M,{label:"售后原因",path:"value",required:""},{default:a(()=>[t(n(P),{value:k.reidList,"onUpdate:value":[l[20]||(l[20]=d=>k.reidList=d),Ue],multiple:"",clearable:"",filterable:"","label-field":"rs","value-field":"id",options:n(I).data,onScroll:Le,onClear:De,onSearch:yl,placeholder:"请选择售后原因"},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),t(Nl,{show:pe.value,"onUpdate:show":l[22]||(l[22]=d=>pe.value=d),current:te.value,"onUpdate:current":[l[23]||(l[23]=d=>te.value=d),jl],"src-list":be.value},null,8,["show","current","src-list"])])}}}),At=it(zt,[["__scopeId","data-v-4636fa28"]]);export{At as default};
