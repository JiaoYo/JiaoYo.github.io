import{_ as ze}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BQRvg-Hu.js";import{d as ie,q as se,x as ve,s as ge,v as be,b as Te,r as re,j as W,ag as pe,F as ae,o as R,c as A,w as t,g as e,h as b,t as Q,i as o,$ as w,G as Y,Y as te,I as E,H as he,aD as ye,bf as Ae,a3 as de,L as ce,a1 as we,ar as $e,au as Pe,P as J,as as Fe,Q as ue,B as K,at as ke,af as Ce,a5 as je,b3 as me,e as Ve,aj as ee,ak as qe,al as Me,M as Oe,S as Ie}from"./index-CSY4KV-i.js";import{u as Be,a as Ee}from"./table-CqbANCsu.js";import{h as Ge,k as Le,l as Ne,m as He,n as Ke,o as We,p as Qe,q as Ye}from"./Collection-DqJLZvp4.js";import{C as Je,c as De,d as Xe,e as Ze}from"./collection-LKblHUM4.js";import{r as ea}from"./asset-DpxA7GmG.js";import{u as aa}from"./usePageData-DsSl_AX0.js";import{_ as Se}from"./FormItemGridItem-Dgw0Dz2b.js";import{_ as ta}from"./Cascader-C1jazazX.js";import{_ as Ue}from"./Grid-ck9V68D0.js";import{_ as la}from"./round-search-Byi5mG8e.js";import{_ as na}from"./round-refresh-Dw3TF0KI.js";import{_ as oa}from"./lodash-CrKaSiIQ.js";import{_ as sa}from"./DatePicker-DEN4nFkX.js";import{h as fe}from"./permission-3BfYgbzx.js";import{_ as ra}from"./Popconfirm-CWKSwExM.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Cg6UU5xr.js";import"./setting-outlined-D21dcNye.js";import"./export-lqz7kj5G.js";import"./refresh-C3Qnc6Gy.js";import"./round-delete-vWMGssZt.js";import"./round-plus-BIsWZlrP.js";import"./Upload-CHk0vH33.js";import"./Progress-j3WAmcYg.js";import"./TimePicker-CYkg2Z-j.js";import"./defineProperty-DRlf3C8K.js";const da=ie({name:"CollectorModal",__name:"collector_modal",props:se({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:se(["submitted"],["update:visible"]),setup(D,{emit:X}){const g=D,V=X,S=ve(D,"visible"),{formRef:q,validate:c,restoreValidation:z}=ge(),{createConfirmPwdRule:U,defaultRequiredRule:x,patternRules:Z}=be(),h=Te(()=>({add:"新增采集器",edit:"编辑采集器"})[g.operateType]),a=re(M());function M(){return{id:void 0,cname:"",cencode:0,accmed:1,proser:void 0,caddr:"",logsoudev:void 0,filterpro:void 0,cdesc:"",proper:0,enable:0,ctime:void 0,rev:void 0,port:void 0,uname:void 0,pswd:void 0,fpath:void 0}}const O={cname:x,caddr:[{required:!0,message:"请输入采集器地址",trigger:["blur","input"]},{required:!0,validator:ye,trigger:["blur","input"]}],rev:x,port:{required:!0,trigger:["blur","input"],validator:(u,l,p)=>l?Ae(l)?!0:new Error("请输入在0-65535之间的数字"):new Error("请输入端口号")},uname:x,pswd:x,cencode:{type:"number",required:!0,trigger:["blur","change"],message:"请选择编码格式"},accmed:{type:"number",required:!0,trigger:["blur","change"],message:"请选择接入方式"},logsoudev:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源设备"}},{pageData:T,getData:f,nextPage:_}=aa(Ge),$=async u=>{const l=u.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&T.data.length<T.total&&_()},y=W(),G=async()=>{const{data:u,error:l}=await He();y.value=u.map(p=>({...p,id:"-"+p.id,type:p.cname}))};function k(){G(),f(),Object.assign(a,M()),g.operateType==="edit"&&g.rowData&&(console.log("props.rowData",g.rowData),Object.assign(a,g.rowData),F.clickNums=1)}function P(){S.value=!1}const F=re({clickNums:0,isLoading:!1});async function L(){var l,p,d,i,j;await c();const u={};if(a.uname&&a.pswd&&Object.assign(u,{uname:de(a.uname),pswd:de(a.pswd)}),g.operateType==="add"){const{data:I,error:C}=await Le([{...a,...u}]);if(!C&&((l=window.$message)==null||l.success("采集器添加成功"),P(),V("submitted"),a.proper==0)){const n=await ea([{aname:a.cname,aip:a.caddr,tid:36,cid:I}]);n.error&&((p=n.error.response)==null?void 0:p.data.msg)=="数据库中已存在该记录"&&((d=window.$message)==null||d.destroyAll(),(i=window.$message)==null||i.error("资产添加失败,请前往资产管理进行修改"))}}else{const{data:I,error:C}=await Ne([{...a,...u}]);C||((j=window.$message)==null||j.success(w("common.updateSuccess")),P(),V("submitted"))}}const H=u=>{Object.assign(a,{logsoudev:void 0,rev:void 0,port:void 0,uname:void 0,pswd:void 0}),u==4&&(a.logsoudev=53),a.port=u==5?22:null};return pe(S,()=>{S.value&&(k(),z())}),pe(()=>a.caddr,()=>{F.clickNums=0}),(u,l)=>{const p=ce,d=Se,i=we,j=ta,I=$e,C=Pe,n=J,s=Fe,m=Ue,N=ue,B=K,le=J,ne=ke,oe=ae("no-space");return R(),A(ne,{show:S.value,"onUpdate:show":l[13]||(l[13]=r=>S.value=r),title:h.value,preset:"card",class:"w-850px"},{footer:t(()=>[e(le,{size:16,justify:"end"},{default:t(()=>[e(B,{onClick:P},{default:t(()=>[b(Q(o(w)("common.cancel")),1)]),_:1}),e(B,{type:"primary",onClick:L},{default:t(()=>[b(Q(o(w)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(N,{ref_key:"formRef",ref:q,model:a,rules:O,"label-placement":"left","label-width":120,onKeyup:he(L,["enter"])},{default:t(()=>[e(m,{responsive:"screen","item-responsive":"","x-gap":20},{default:t(()=>[e(d,{span:"24 s:12 m:12",label:"采集器名称",path:"cname"},{default:t(()=>[Y(e(p,{value:a.cname,"onUpdate:value":l[0]||(l[0]=r=>a.cname=r),placeholder:"请输入采集器名称",clearable:""},null,8,["value"]),[[oe]])]),_:1}),e(d,{span:"24 s:12 m:12",label:"编码格式",path:"cencode"},{default:t(()=>[e(i,{value:a.cencode,"onUpdate:value":l[1]||(l[1]=r=>a.cencode=r),placeholder:"请选择编码格式",filterable:"",clearable:"",options:o(te)(o(Je))},null,8,["value","options"])]),_:1}),e(d,{span:"24 s:12 m:12",label:"接入方式",path:"accmed"},{default:t(()=>[e(i,{value:a.accmed,"onUpdate:value":[l[2]||(l[2]=r=>a.accmed=r),H],placeholder:"请选择接入方式",filterable:"",clearable:"",disabled:u.operateType==="edit",options:o(te)(o(De))},null,8,["value","disabled","options"])]),_:1}),e(d,{span:"24 s:12 m:12",label:"采集地址",path:"caddr"},{default:t(()=>[e(p,{value:a.caddr,"onUpdate:value":l[3]||(l[3]=r=>a.caddr=r),placeholder:"请输入采集地址",clearable:""},null,8,["value"])]),_:1}),[0,1,7,8].includes(a.accmed)?(R(),A(d,{key:0,span:"24 s:12 m:12",label:"日志源设备",path:"logsoudev"},{default:t(()=>[e(j,{value:a.logsoudev,"onUpdate:value":l[4]||(l[4]=r=>a.logsoudev=r),placeholder:"请选择日志源设备",options:y.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"","show-path":!1},null,8,["value","options"])]),_:1})):E("",!0),e(d,{span:"24 s:12 m:12",label:"过滤策略",path:"filterpro"},{default:t(()=>[e(i,{clearable:"",filterable:"",value:a.filterpro,"onUpdate:value":l[5]||(l[5]=r=>a.filterpro=r),placeholder:"请选择过滤策略",options:o(T).data,"value-field":"id","label-field":"pname","reset-menu-on-options-change":!1,onScroll:$},null,8,["value","options"])]),_:1}),[3,7,8].includes(a.accmed)?(R(),A(d,{key:1,span:"24 s:12 m:12",label:a.accmed==3?"数据库名称":a.accmed==4?"域名":(a.accmed==7,"目录"),path:"rev"},{default:t(()=>[e(p,{value:a.rev,"onUpdate:value":l[6]||(l[6]=r=>a.rev=r),placeholder:"请输入",clearable:""},null,8,["value"])]),_:1},8,["label"])):E("",!0),[3,4,5,7,8].includes(a.accmed)?(R(),A(d,{key:2,span:"24 s:12 m:12",label:"端口",path:"port"},{default:t(()=>[e(I,{value:a.port,"onUpdate:value":l[7]||(l[7]=r=>a.port=r),placeholder:"请输入端口",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1})):E("",!0),[3,4,5,7,8,9].includes(a.accmed)?(R(),A(d,{key:3,span:"24 s:12 m:12",label:"用户名",path:"uname"},{default:t(()=>[e(p,{value:a.uname,"onUpdate:value":l[8]||(l[8]=r=>a.uname=r),placeholder:"请输入用户名",clearable:""},null,8,["value"])]),_:1})):E("",!0),[3,4,5,7,8,9].includes(a.accmed)?(R(),A(d,{key:4,span:"24 s:12 m:12",label:"密码",path:"pswd"},{default:t(()=>[e(p,{type:"password","show-password-on":"click",value:a.pswd,"onUpdate:value":l[9]||(l[9]=r=>a.pswd=r),placeholder:"请输入密码",clearable:""},null,8,["value"])]),_:1})):E("",!0),u.operateType=="add"?(R(),A(d,{key:5,span:"24 s:12 m:12",label:"生成资产",path:"proper"},{default:t(()=>[e(s,{value:a.proper,"onUpdate:value":l[10]||(l[10]=r=>a.proper=r),name:"radiogroup"},{default:t(()=>[e(n,null,{default:t(()=>[e(C,{value:0},{default:t(()=>[b("是")]),_:1}),e(C,{value:1},{default:t(()=>[b("否")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})):E("",!0),e(d,{span:"24 s:12 m:12",label:"是否启用",path:"enable"},{default:t(()=>[e(s,{value:a.enable,"onUpdate:value":l[11]||(l[11]=r=>a.enable=r),name:"radiogroup",disabled:u.operateType=="edit"},{default:t(()=>[e(n,null,{default:t(()=>[e(C,{value:0},{default:t(()=>[b("是")]),_:1}),e(C,{value:1},{default:t(()=>[b("否")]),_:1})]),_:1})]),_:1},8,["value","disabled"])]),_:1}),e(d,{span:"24 s:24 m:24",label:"描述",path:"cdesc"},{default:t(()=>[e(p,{type:"textarea",value:a.cdesc,"onUpdate:value":l[12]||(l[12]=r=>a.cdesc=r),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),ia=ie({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:se(["reset","search"],["update:model"]),setup(D,{emit:X}){const g=X,{formRef:V,restoreValidation:S}=ge(),q={caddr:[{validator:ye,trigger:["change","input"]}]},c=ve(D,"model");W(!1);const z=W(null);async function U(f,_){f&&f.length>0?(c.value.startTime=f[0],c.value.endTime=f[1]):(c.value.startTime=void 0,c.value.endTime=void 0),O()}function x(f){c.value.enable=f,g("search")}function Z(f){c.value.accmed=f,g("search")}function h(){c.value.fuzzy=void 0,g("search")}function a(){c.value.caddr=void 0,g("search")}async function M(){await S(),z.value=null,g("reset")}async function O(){g("search")}const T=oa.throttle(O,1e3,{trailing:!1});return(f,_)=>{const $=ce,y=Se,G=we,k=sa,P=na,F=K,L=la,H=J,u=Ue,l=ue,p=Ce,d=ae("no-space");return R(),A(p,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(l,{ref_key:"formRef",ref:V,model:c.value,"label-placement":"left",rules:q,"label-width":"100px",onKeyup:he(o(T),["enter"]),"show-require-mark":!1},{default:t(()=>[e(u,{responsive:"screen","item-responsive":"","x-gap":12},{default:t(()=>[e(y,{span:"24 s:12 m:8 l:6",label:"采集器名称",path:"fuzzy","show-feedback":!1},{default:t(()=>[Y(e($,{clearable:"",value:c.value.fuzzy,"onUpdate:value":_[0]||(_[0]=i=>c.value.fuzzy=i),placeholder:"请输入采集器名称",onClear:h},null,8,["value"]),[[d]])]),_:1}),e(y,{span:"24 s:12 m:8 l:6",label:"采集地址",path:"caddr"},{default:t(()=>[Y(e($,{clearable:"",value:c.value.caddr,"onUpdate:value":_[1]||(_[1]=i=>c.value.caddr=i),onClear:a,placeholder:"请输入采集地址"},null,8,["value"]),[[d]])]),_:1}),e(y,{span:"24 s:12 m:8 l:6",label:"接入方式",path:"accmed","show-feedback":!1},{default:t(()=>[e(G,{clearable:"",filterable:"",value:c.value.accmed,"onUpdate:value":_[2]||(_[2]=i=>c.value.accmed=i),placeholder:"请选择接入方式",options:o(te)(o(De)),onUpdateValue:Z,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(y,{span:"24 s:12 m:8 l:6",label:"状态",path:"enable","show-feedback":!1},{default:t(()=>[e(G,{clearable:"",filterable:"",value:c.value.enable,"onUpdate:value":_[3]||(_[3]=i=>c.value.enable=i),placeholder:"请选择状态",options:o(te)(o(Xe)),onUpdateValue:x,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(y,{span:"24 s:16 m:16 l:8",label:"创建时间",path:"enable","show-feedback":!1},{default:t(()=>[e(k,{value:z.value,"onUpdate:value":_[4]||(_[4]=i=>z.value=i),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":U},null,8,["value"])]),_:1}),e(y,{span:"24 s:8 m:8 l:6","show-feedback":!1},{default:t(()=>[e(H,{class:"w-full",align:"center"},{default:t(()=>[e(F,{onClick:M},{icon:t(()=>[e(P,{class:"text-icon"})]),default:t(()=>[b(" "+Q(o(w)("common.reset")),1)]),_:1}),e(F,{type:"primary",ghost:"",onClick:o(T)},{icon:t(()=>[e(L,{class:"text-icon"})]),default:t(()=>[b(" "+Q(o(w)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),ca={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function _e(D){return typeof D=="function"||Object.prototype.toString.call(D)==="[object Object]"&&!qe(D)}const Va=ie({name:"collectionmanagement_collector",__name:"index",setup(D){const{createConfirmPwdRule:X,defaultRequiredRule:g,patternRules:V}=be(),S=je(),{columns:q,columnChecks:c,data:z,getData:U,loading:x,mobilePagination:Z,searchParams:h,resetSearchParams:a}=Be({apiFn:Ke,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,caddr:null,enable:null,accmed:null,startTime:null,endTime:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"cname",title:"采集器名称",align:"center",width:200},{key:"caddr",title:"采集地址",align:"center",width:200},{key:"accmed",title:"接入方式",align:"center",width:160,render:n=>{const s=Ze;return e("span",null,[b(" "),s[n.accmed]])}},{key:"pname",title:"过滤策略",align:"center",width:160},{key:"type",title:"日志源设备",align:"center",width:200},{key:"ctime",title:"创建时间",align:"center",width:200},{key:"enable",title:"状态",align:"center",width:160,render:n=>e(J,{justify:"center"},{default:()=>[n.accmed==4?e(me,{value:n.enable,"onUpdate:value":[s=>n.enable=s,()=>O(n)],checkedValue:0,uncheckedValue:1},{checked:()=>e("span",null,[b("启用")]),unchecked:()=>e("span",null,[b("禁用")])}):e(me,{value:n.enable,"onUpdate:value":[s=>n.enable=s,()=>T(n)],checkedValue:0,uncheckedValue:1},{checked:()=>e("span",null,[b("启用")]),unchecked:()=>e("span",null,[b("禁用")])})]})},{key:"operate",title:w("common.operate"),align:"center",width:130,fixed:"right",render:n=>{let s;return e("div",{class:"flex-center gap-8px"},[Y(e(K,{type:"primary",ghost:!0,size:"small",onClick:()=>l(n.id)},_e(s=w("common.edit"))?s:{default:()=>[s]}),[[ae("no-auth"),"sys.collection.mengement.update"]]),e(ra,{onPositiveClick:()=>u(n.id)},{default:()=>w("common.confirmDelete"),trigger:()=>{let m;return Y(e(K,{type:"error",ghost:!0,size:"small"},_e(m=w("common.delete"))?m:{default:()=>[m]}),[[ae("no-auth"),"sys.collection.mengement.delete"]])}})])}}]}),M=()=>{h.caddr=h.caddr==""?void 0:h.caddr,h.fuzzy=h.fuzzy==""?void 0:h.fuzzy,U()},O=async n=>{var m;const s={id:n.id,enable:n.enable,ip:n.enable==1?n.caddr:void 0};try{const{data:N,error:B}=await We(s);B||((m=window.$message)==null||m.success(n.enable==1?"禁用成功":"启用成功"),U())}catch{n.enable=n.enable==1?0:1}},T=async n=>{var s;try{const{data:m,error:N}=await Ne([n]);N||((s=window.$message)==null||s.success(n.enable==1?"禁用成功":"启用成功"),U())}catch{n.enable=n.enable==1?0:1}},{drawerVisible:f,operateType:_,editingData:$,handleAdd:y,handleEdit:G,checkedRowKeys:k,onBatchDeleted:P,onDeleted:F,closeDrawer:L}=Ee(z,U);async function H(){console.log(k.value),p(k.value.join(","),n=>{P()})}function u(n){p(n,s=>{F()})}function l(n){_.value="edit",i.id=n,d.value=!0}async function p(n,s){const m=await Qe(n,1);console.log("data",m),s&&s(m)}const d=W(!1),i=re({id:void 0,pwd:""}),j=W(null),I={pwd:[{required:!0,message:"请输入密码",trigger:"blur"},V.passwordL]},C=async()=>{var N;await((N=j.value)==null?void 0:N.validate());const n=de(i.pwd),{data:s,error:m}=await Ye(i.id,n);m||($.value=s,d.value=!1,f.value=!0,i.pwd="")};return(n,s)=>{const m=ze,N=Me,B=Ce,le=ce,ne=Oe,oe=ue,r=Ie,xe=ke;return R(),Ve("div",ca,[e(ia,{model:o(h),"onUpdate:model":s[0]||(s[0]=v=>ee(h)?h.value=v:null),onReset:o(a),onSearch:M},null,8,["model","onReset"]),e(B,{title:"采集器管理",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":t(()=>[e(m,{columns:o(c),"onUpdate:columns":s[1]||(s[1]=v=>ee(c)?c.value=v:null),"disabled-delete":o(k).length===0,"is-view-add-button":o(fe)("sys.collection.mengement.insert"),"is-view-delete-button":o(fe)("sys.collection.mengement.delete"),loading:o(x),onAdd:o(y),onDelete:H,onRefresh:o(U)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:t(()=>[e(N,{"checked-row-keys":o(k),"onUpdate:checkedRowKeys":s[2]||(s[2]=v=>ee(k)?k.value=v:null),columns:o(q),data:o(z),size:"small","flex-height":!o(S).isMobile,"scroll-x":o(q).reduce((v,Re)=>v+Re.width,0),loading:o(x),remote:"","row-key":v=>v.id,pagination:o(Z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(da,{visible:o(f),"onUpdate:visible":s[3]||(s[3]=v=>ee(f)?f.value=v:null),"operate-type":o(_),"row-data":o($),onSubmitted:o(U)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1}),e(xe,{show:d.value,"onUpdate:show":s[5]||(s[5]=v=>d.value=v),title:"编辑采集器信息",preset:"card",class:"w-420px"},{footer:t(()=>[e(o(J),{justify:"end",size:16},{default:t(()=>[e(o(K),{type:"primary",onClick:C},{default:t(()=>[b(Q(o(w)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(r,{class:"max-h-480px pr-20px"},{default:t(()=>[e(oe,{ref_key:"checkformRef",ref:j,model:i,"label-placement":"left",rules:I,"label-width":80,"require-mark-placement":"left"},{default:t(()=>[e(ne,{label:o(w)("page.login.common.password"),path:"pwd"},{default:t(()=>[e(le,{type:"password","show-password-on":"click",clearable:"",value:i.pwd,"onUpdate:value":s[4]||(s[4]=v=>i.pwd=v),placeholder:"请输入当前登录账号密码"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}});export{Va as default};
