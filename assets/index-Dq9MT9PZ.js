import{_ as ce}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C4VRQsxL.js";import{d as L,q as j,s as Z,v as te,x as pe,c0 as oe,y as H,b as F,$ as a,r as ue,K as V,o as z,c as E,w as l,g as o,h as $,t as B,i as t,M as ne,L as I,U as de,V as me,A as ae,C as _e,X as fe,D as le,B as A,E as J,aa as he,ab as ge,a9 as se,dp as Q,j as X,f as Y,F as ve,aK as ye,am as re,Z as be,dq as we,e as ke,ac as O,ad as xe}from"./index-CsSYpLym.js";import{a as Re,b as De,c as Ne,d as Ce,e as Se,g as Te}from"./system-manage-DdfagYHv.js";import{u as Me,a as $e}from"./table-DCxpav6d.js";import{_ as Be}from"./round-search-Dtp7E9Hm.js";import{_ as Ue}from"./round-refresh-DOrEb6Qo.js";import{_ as ze}from"./FormItemGridItem-Bdm6h163.js";import{_ as Ie}from"./Grid-C4cZ6WxQ.js";import{_ as Ae,a as Ke}from"./arrow-open-up-BdC2WXAm.js";import{l as Oe}from"./lodash-DCZj5awB.js";import{_ as Ve}from"./Tree-BU71w7aN.js";import{h as ee}from"./permission-CTF5Ee2q.js";import{_ as Ee}from"./Popconfirm-DEvmG-Lq.js";import{_ as Fe}from"./DataTable-aZh4mZz2.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DA9Hc1O-.js";import"./setting-outlined-D6k74DJG.js";import"./round-delete-CGs2xQbQ.js";import"./refresh-C8V4ZZfl.js";import"./round-plus-BCWcqFXE.js";import"./Upload-Dto-1aHs.js";import"./Progress-6NqKhq42.js";import"./Forward-C9tKHKQU.js";const je=L({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(g,{emit:k}){const p=g,f=k,y=Z(g,"visible"),{formRef:v,validate:x,restoreValidation:M}=te(),{defaultRequiredRule:h}=pe();oe(),H(()=>p.rowData,()=>{S()});const R=F(()=>({add:a("page.manage.role.addRole"),edit:a("page.manage.role.editRole")})[p.operateType]),u=ue(D());function D(){return{name:"",remark:"",rtype:0}}const C={name:h};F(()=>{var c;return((c=p.rowData)==null?void 0:c.id)||-1}),F(()=>p.operateType==="add"||p.operateType==="edit");function S(){Object.assign(u,D()),p.operateType==="edit"&&p.rowData&&Object.assign(u,p.rowData)}function N(){y.value=!1}async function n(){var _,e;await x();const{data:c,error:r}=await Re(p.operateType==="edit"?(_=p.rowData)==null?void 0:_.id:null,u.name,[],u.remark,u.rtype);r||((e=window.$message)==null||e.success(a("common.updateSuccess")),N(),f("submitted"))}return H(y,()=>{y.value&&(S(),M())}),(c,r)=>{const _=ae,e=_e,i=fe,m=le,U=A,T=J,P=he,G=ge,K=V("no-space");return z(),E(G,{show:y.value,"onUpdate:show":r[3]||(r[3]=s=>y.value=s),"display-directive":"show",width:360},{default:l(()=>[o(P,{title:R.value,"native-scrollbar":!1,closable:""},{footer:l(()=>[o(T,{size:16},{default:l(()=>[o(U,{onClick:N},{default:l(()=>[$(B(t(a)("common.cancel")),1)]),_:1}),o(U,{type:"primary",onClick:n},{default:l(()=>[$(B(t(a)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[o(m,{ref_key:"formRef",ref:v,model:u,rules:C,onKeyup:ne(n,["enter"])},{default:l(()=>[o(e,{label:t(a)("page.manage.role.name"),path:"name"},{default:l(()=>[I(o(_,{value:u.name,"onUpdate:value":r[0]||(r[0]=s=>u.name=s),placeholder:t(a)("page.manage.role.form.name"),clearable:""},null,8,["value","placeholder"]),[[K]])]),_:1},8,["label"]),o(e,{label:t(a)("page.manage.role.remark"),path:"remark"},{default:l(()=>[I(o(_,{clearable:"",value:u.remark,"onUpdate:value":r[1]||(r[1]=s=>u.remark=s),placeholder:t(a)("page.manage.role.form.remark")},null,8,["value","placeholder"]),[[K]])]),_:1},8,["label"]),o(e,{label:t(a)("page.manage.role.type"),path:"rtype"},{default:l(()=>[o(i,{filterable:"",value:u.rtype,"onUpdate:value":r[2]||(r[2]=s=>u.rtype=s),disabled:p.operateType==="edit",placeholder:t(a)("page.manage.role.form.type"),options:t(de)(t(me)),style:{width:"100%"}},null,8,["value","disabled","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Le=L({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(g,{emit:k}){const p=k,f=Z(g,"model"),{formRef:y,restoreValidation:v}=te();function x(){f.value.name="",p("search")}async function M(){await v(),p("reset")}function h(){p("search")}return(R,u)=>{const D=ae,C=ze,S=Ue,N=A,n=Be,c=J,r=Ie,_=le,e=se,i=V("no-space");return z(),E(e,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[o(_,{model:f.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(h,["enter"])},{default:l(()=>[o(r,{responsive:"screen","item-responsive":""},{default:l(()=>[o(C,{span:"24 s:12 m:6",label:t(a)("page.manage.role.name"),path:"name",class:"pr-24px"},{default:l(()=>[I(o(D,{clearable:"",value:f.value.name,"onUpdate:value":u[0]||(u[0]=m=>f.value.name=m),placeholder:t(a)("page.manage.role.form.name"),onClear:x},null,8,["value","placeholder"]),[[i]])]),_:1},8,["label"]),o(C,{span:"24 s:12 m:6"},{default:l(()=>[o(c,{class:"w-full"},{default:l(()=>[o(N,{onClick:M},{icon:l(()=>[o(S,{class:"text-icon"})]),default:l(()=>[$(" "+B(t(a)("common.reset")),1)]),_:1}),o(N,{type:"primary",ghost:"",onClick:h},{icon:l(()=>[o(n,{class:"text-icon"})]),default:l(()=>[$(" "+B(t(a)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Pe={class:"flex"},Ge=L({name:"MenuAuthModal",__name:"menu-auth-modal",props:j({roleRow:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(g){const k=g,p=Z(g,"visible");function f(){p.value=!1}const y=F(()=>a("common.edit")+a("page.manage.role.menuAuth")),v=Q([]);function x(n,c=0){let r=[];function _(e){return e.sort((i,m)=>(i.sort||0)-(m.sort||0))}return n.forEach(e=>{if(e.suffix=()=>ye(re,{text:!0,type:e.pid==0&&e.type==0?"warning":e.type==1?"info":"success",size:"small"},{default:()=>e.pid==0&&e.type==0?"目录":e.type==1?"按钮":"菜单"}),e.pid==c){const i=x(n,e.id);i.length>0?e.children=i:e.children=[],r.push(e)}}),_(r)}const M=async()=>{const{error:n,data:c}=await Ne({rtype:k.roleRow.rtype}),r=x(c);if(!n){let _=function(i){for(let m=i.length-1;m>=0;m--)i[m].children&&i[m].children.length>0?_(i[m].children):i[m].children=void 0;return i},e=Oe.cloneDeep(r);e=_(e),v.value=e.filter(i=>i.id>=900)}},h=X(!0),R=Q([]);async function u(){const{data:n,error:c}=await Ce(k.roleRow.id+""),r=[];function _(e,i){return!i.includes(e.id)||e.children&&!e.children.every(m=>_(m,i))?(r.push(e.id),!1):!0}v.value.forEach(e=>{_(e,n.menuIdList)}),R.value=n.menuIdList.filter(e=>!r.includes(e))}const D=X(),C=n=>{D.value=n};function S(){var n,c;De({id:k.roleRow.id,name:k.roleRow.name,menuIdList:R.value.concat(D.value).filter(r=>r!==null)}),(c=(n=window.$message)==null?void 0:n.success)==null||c.call(n,a("common.modifySuccess")),f()}function N(){M(),u()}return H(p,n=>{n&&N()}),(n,c)=>{const r=Ae,_=Ke,e=Ve,i=A,m=J,U=ve;return z(),E(U,{show:p.value,"onUpdate:show":c[2]||(c[2]=T=>p.value=T),preset:"card",class:"w-480px"},{header:l(()=>[Y("div",Pe,[$(B(y.value)+" ",1),Y("div",{class:"ml-10px cursor-pointer",title:"展开/收起",onClick:c[0]||(c[0]=T=>h.value=!h.value)},[h.value?(z(),E(_,{key:1,class:"text-icon"})):(z(),E(r,{key:0,class:"text-icon"}))])])]),footer:l(()=>[o(m,{justify:"end"},{default:l(()=>[o(i,{size:"small",class:"mt-16px",onClick:f},{default:l(()=>[$(B(t(a)("common.cancel")),1)]),_:1}),o(i,{type:"primary",size:"small",class:"mt-16px",onClick:S},{default:l(()=>[$(B(t(a)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[o(e,{cascade:"","checked-keys":R.value,"onUpdate:checkedKeys":c[1]||(c[1]=T=>R.value=T),data:v.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"",class:"h-60vh","label-field":"name","key-field":"id","children-field":"children","default-expand-all":h.value,onUpdateIndeterminateKeys:C},null,8,["checked-keys","data","default-expand-all"])]),_:1},8,["show"])}}}),qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!xe(g)}const ft=L({name:"manage_role",__name:"index",setup(g){const k=be(),{columns:p,columnChecks:f,data:y,getData:v,loading:x,mobilePagination:M,searchParams:h,resetSearchParams:R}=Me({apiFn:Se,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,name:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:a("page.manage.role.name"),align:"center",minWidth:120,ellipsis:!0},{key:"remark",title:a("page.manage.role.remark"),minWidth:120,align:"center",ellipsis:!0},{key:"rtype",title:a("page.manage.role.type"),width:140,align:"center",render:s=>{s.rtype===void 0&&(s.rtype=0);const d={0:"primary",1:"primary",2:"primary"},b=a(we[s.rtype]);return o(re,{type:d[s.rtype]},W(b)?b:{default:()=>[b]})}},{key:"operate",title:a("common.operate"),align:"center",render:s=>{let d;return o("div",{class:"flex-center gap-8px"},[I(o(A,{type:"primary",ghost:!0,size:"small",onClick:()=>G(s.id)},W(d=a("common.edit"))?d:{default:()=>[d]}),[[V("no-auth"),"sys:role:update"]]),I(o(A,{type:"primary",ghost:!0,size:"small",onClick:()=>U(s)},{default:()=>["分配权限"]}),[[V("no-auth"),"sys:role:update"]]),o(Ee,{onPositiveClick:()=>P(s.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let b;return I(o(A,{type:"error",ghost:!0,size:"small"},W(b=a("common.delete"))?b:{default:()=>[b]}),[[V("no-auth"),"sys:role:delete"]])}})])}}]}),{drawerVisible:u,operateType:D,editingData:C,handleAdd:S,handleEdit:N,checkedRowKeys:n,onBatchDeleted:c,onDeleted:r,closeDrawer:_}=$e(y,v),{bool:e,setTrue:i}=oe(),m=X({id:0,name:"",remark:"",rtype:0});function U(s){i(),m.value=s}async function T(){console.log(n.value),K(n.value,s=>{c()})}function P(s){console.log(s),K([s],d=>{r()})}function G(s){N(s)}async function K(s,d){const{data:b,error:q}=await Te(s);if(!q)d&&d(b);else return!1}return(s,d)=>{const b=ce,q=Fe,ie=se;return z(),ke("div",qe,[o(Le,{model:t(h),"onUpdate:model":d[0]||(d[0]=w=>O(h)?h.value=w:null),onReset:t(R),onSearch:t(v)},null,8,["model","onReset","onSearch"]),o(ie,{title:t(a)("page.manage.role.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[o(b,{columns:t(f),"onUpdate:columns":d[1]||(d[1]=w=>O(f)?f.value=w:null),"disabled-delete":t(n).length===0,"is-view-add-button":t(ee)("sys:role:save"),"is-view-delete-button":t(ee)("sys:role:delete"),loading:t(x),onAdd:t(S),onDelete:T,onRefresh:t(v)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:l(()=>[o(q,{"checked-row-keys":t(n),"onUpdate:checkedRowKeys":d[2]||(d[2]=w=>O(n)?n.value=w:null),columns:t(p),data:t(y),size:"small","flex-height":!t(k).isMobile,"scroll-x":702,loading:t(x),remote:"","row-key":w=>w.id,pagination:t(M),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),o(je,{visible:t(u),"onUpdate:visible":d[3]||(d[3]=w=>O(u)?u.value=w:null),"operate-type":t(D),"row-data":t(C),onSubmitted:t(v)},null,8,["visible","operate-type","row-data","onSubmitted"]),o(Ge,{visible:t(e),"onUpdate:visible":d[4]||(d[4]=w=>O(e)?e.value=w:null),roleRow:m.value},null,8,["visible","roleRow"])]),_:1},8,["title"])])}}});export{ft as default};
