import{_ as xe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-EHNO_Faz.js";import{_ as Ce}from"./round-delete-De_Adgrb.js";import{_ as De}from"./round-add-Ceubgvwo.js";import{d as te,aE as ee,m as ie,r as ze,H as K,n as re,a as Ne,aG as ue,aC as Se,bY as de,c_ as je,c$ as Te,c as z,o as g,w as l,f as t,a0 as Ue,C as pe,h as n,aD as ce,v as T,b as Y,s as Q,g as b,e as P,t as x,aI as $e,B as U,aJ as Pe,y as ae,$ as q,a1 as qe,cs as fe,aO as me,aQ as Re,A as Be,Z as ge,aS as Ie,i as Fe,q as X,aT as Z,aH as Le,x as W,aU as Me,d0 as ne,d1 as Oe,aY as Ve}from"./index-ByRkKuMU.js";import{u as Ae,a as Ee}from"./table-VoODD8Rc.js";import{u as ve}from"./usePageData-DJSm323_.js";import{_ as _e}from"./Grid-CFg9gfMA.js";import{_ as ye}from"./FormItemGridItem-BCpPvk0p.js";import{_ as Ge}from"./round-search-SxIJJabH.js";import{_ as He}from"./round-refresh-_Q7iiaNa.js";import{N as oe}from"./Popconfirm-BARyXAms.js";const Ke={key:0,style:{"margin-left":"20px"}},Ye={key:0,style:{"margin-left":"20px"}},Je={key:0,style:{"margin-left":"20px"}},Qe={key:0,style:{"margin-left":"20px"}},Ze=te({name:"OperateDrawer",__name:"operate-drawer",props:ee({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ee(["submitted"],["update:visible"]),setup($,{emit:L}){const N=L,R=ie(),C=$,e=ze(S());K();function S(){return{pid:void 0,id:"",affectedbusiness:"",devname:"",apidocument:"",uid:void 0,period:"",notes:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const v=K([]),{pageData:w,getData:D,nextPage:B}=ve(fe),M=async s=>{const a=s.currentTarget,r=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&w.data.length<w.total&&(await B(),v.value=w.data,await me(),setTimeout(()=>{a.scrollTop=r}))},O=async()=>{var s;await D({fuzzy:R.userInfo.pname,page:1}),v.value=w.data,e.pid=C.pid?C.pid:(s=v.value[0])==null?void 0:s.id},V=async()=>{await D({page:1}),v.value=w.data},A=async s=>{e.pid=s};async function j(){O(),Object.assign(e,S()),C.operateType==="edit"&&C.rowData&&Object.assign(e,C.rowData)}const{formRef:J,validate:E,restoreValidation:G}=re(),F={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},affectedbusiness:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},apidocument:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},period:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},uid:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},p=Ne(()=>({add:"新增需要开发",edit:"修改需要开发"})[C.operateType]),u=ue($,"visible");async function k(s){if(s)try{const r=await(await fetch(s==null?void 0:s.split("?")[0],{mode:"cors"})).blob(),y=URL.createObjectURL(r),c=document.createElement("a");c.href=y,c.download=s==null?void 0:s.split("?")[1],c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(y)}catch(a){console.error("下载失败:",a)}}Se(u,()=>{u.value&&(j(),setTimeout(()=>{const s=document.querySelector(".n-scrollbar-content");s==null||s.scrollTo(0,0)},300),G())});const d=K(0),m=K("");async function f({file:s},a){d.value=0,m.value=a;const r=await Re(s.file,s.name,"",y=>{d.value=y});r&&(e[a]=r,d.value=0)}function i(){u.value=!1}async function _(s){var a;return s.file.file.size>100*1024*1024?((a=window.$message)==null||a.error("文件大小不能超过100M"),!1):!0}const I=de.debounce(async()=>{await H()},1e3,{leading:!0,trailing:!1});async function H(){var s,a;if(await E(),C.operateType==="edit"){const{data:r,error:y}=await je([e]);y||(i(),N("submitted"),(s=window.$message)==null||s.success("修改成功"))}else{const{data:r,error:y}=await Te([{...e}]);y||(i(),N("submitted"),(a=window.$message)==null||a.success("添加成功"))}}return(s,a)=>{const r=ye,y=$e,c=Pe,le=_e,he=pe,be=Ue,we=ae,ke=qe;return g(),z(ke,{show:u.value,"onUpdate:show":a[19]||(a[19]=o=>u.value=o),title:p.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:l(()=>[t(we,{justify:"end",size:16},{default:l(()=>[t(n(U),{onClick:i},{default:l(()=>[b(x(n(q)("common.cancel")),1)]),_:1}),t(n(U),{type:"primary",onClick:n(I)},{default:l(()=>[b(x(n(q)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:l(()=>[t(be,{class:"pr-20px"},{default:l(()=>[t(he,{ref_key:"formRef",ref:J,model:e,rules:F,"label-placement":"left","label-width":120},{default:l(()=>[t(le,{responsive:"screen","item-responsive":""},{default:l(()=>[t(r,{span:"24 m:12",label:"项目列表",path:"pid"},{default:l(()=>[t(n(ce),{clearable:"",filterable:"",value:e.pid,"onUpdate:value":[a[0]||(a[0]=o=>e.pid=o),A],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:V,options:v.value,onScroll:M},null,8,["value","options"])]),_:1}),t(r,{span:"24 m:12",label:"影响的业务",path:"affectedbusiness"},{default:l(()=>[t(n(T),{value:e.affectedbusiness,"onUpdate:value":a[1]||(a[1]=o=>e.affectedbusiness=o),placeholder:"请输入"},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"设备名称",path:"devname"},{default:l(()=>[t(n(T),{value:e.devname,"onUpdate:value":a[2]||(a[2]=o=>e.devname=o),placeholder:"请输入"},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"接口文档",path:"apidocument"},{default:l(()=>[t(n(T),{value:e.apidocument,"onUpdate:value":a[3]||(a[3]=o=>e.apidocument=o),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"研发对接人",path:"uid"},{default:l(()=>[t(n(T),{value:e.uid,"onUpdate:value":a[4]||(a[4]=o=>e.uid=o),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"研发周期",path:"period"},{default:l(()=>[t(n(T),{value:e.period,"onUpdate:value":a[5]||(a[5]=o=>e.period=o),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"备注",path:"notes"},{default:l(()=>[t(n(T),{value:e.notes,"onUpdate:value":a[6]||(a[6]=o=>e.notes=o),placeholder:"请输入"},null,8,["value"])]),_:1}),t(r,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:l(()=>[t(le,{responsive:"screen","item-responsive":""},{default:l(()=>[t(r,{span:"24 m:12",label:"附件1",path:"notes"},{default:l(()=>[t(n(T),{value:e.re1,"onUpdate:value":a[7]||(a[7]=o=>e.re1=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[e.fl1?(g(),Y("span",Ke,[b(x((o=e.fl1)==null?void 0:o.split("?")[1])+" ",1),P("span",{class:"cursor-pointer c-#c92a2a",onClick:a[8]||(a[8]=h=>e.fl1="")},"删除"),P("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[9]||(a[9]=h=>k(e.fl1))},"下载")])):(g(),z(y,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":h=>f(h,"fl1"),"show-file-list":!1,onBeforeUpload:_},{default:l(()=>[t(n(U),{loading:d.value>0&&!e.fl1&&m.value=="fl1",size:"small",ghost:"",type:"primary"},{default:l(()=>[b(x(d.value>0&&!e.fl1&&m.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),d.value&&!e.fl1&&m.value=="fl1"?(g(),z(c,{key:2,type:"line",percentage:d.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):Q("",!0)]}),_:1})]),_:1})]),_:1}),t(r,{span:"24 m:12",label:"附件2",path:"notes"},{default:l(()=>[t(n(T),{value:e.re2,"onUpdate:value":a[10]||(a[10]=o=>e.re2=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[e.fl2?(g(),Y("span",Ye,[b(x((o=e.fl2)==null?void 0:o.split("?")[1])+" ",1),P("span",{class:"cursor-pointer c-#c92a2a",onClick:a[11]||(a[11]=h=>e.fl2="")},"删除"),P("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[12]||(a[12]=h=>k(e.fl2))},"下载")])):(g(),z(y,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":h=>f(h,"fl2"),"show-file-list":!1,onBeforeUpload:_},{default:l(()=>[t(n(U),{loading:d.value>0&&!e.fl2&&m.value=="fl2",size:"small",ghost:"",type:"primary"},{default:l(()=>[b(x(d.value>0&&!e.fl2&&m.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),d.value&&!e.fl2&&m.value=="fl2"?(g(),z(c,{key:2,type:"line",percentage:d.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):Q("",!0)]}),_:1}),t(r,{span:"24 m:12",label:"附件3",path:"notes"},{default:l(()=>[t(n(T),{value:e.re3,"onUpdate:value":a[13]||(a[13]=o=>e.re3=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[e.fl3?(g(),Y("span",Je,[b(x((o=e.fl3)==null?void 0:o.split("?")[1])+" ",1),P("span",{class:"cursor-pointer c-#c92a2a",onClick:a[14]||(a[14]=h=>e.fl3="")},"删除"),P("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[15]||(a[15]=h=>k(e.fl3))},"下载")])):(g(),z(y,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":h=>f(h,"fl3"),"show-file-list":!1,onBeforeUpload:_},{default:l(()=>[t(n(U),{loading:d.value>0&&!e.fl3&&m.value=="fl3",size:"small",ghost:"",type:"primary"},{default:l(()=>[b(x(d.value>0&&!e.fl3&&m.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),d.value&&!e.fl3&&m.value=="fl3"?(g(),z(c,{key:2,type:"line",percentage:d.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):Q("",!0)]}),_:1}),t(r,{span:"24 m:12",label:"附件4",path:"notes"},{default:l(()=>[t(n(T),{value:e.re4,"onUpdate:value":a[16]||(a[16]=o=>e.re4=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[e.fl4?(g(),Y("span",Qe,[b(x((o=e.fl4)==null?void 0:o.split("?")[1])+" ",1),P("span",{class:"cursor-pointer c-#c92a2a",onClick:a[17]||(a[17]=h=>e.fl4="")},"删除"),P("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[18]||(a[18]=h=>k(e.fl4))},"下载")])):(g(),z(y,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":h=>f(h,"fl4"),"show-file-list":!1},{default:l(()=>[t(n(U),{loading:d.value>0&&!e.fl4&&m.value=="fl4",size:"small",ghost:"",type:"primary"},{default:l(()=>[b(x(d.value>0&&!e.fl4&&m.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),d.value&&!e.fl4&&m.value=="fl4"?(g(),z(c,{key:2,type:"line",percentage:d.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):Q("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),We=te({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ee(["reset","search","clear"],["update:model"]),setup($,{emit:L}){const N=L,{formRef:R,restoreValidation:C}=re(),e=ue($,"model"),S=ie(),v=K([]),{pageData:w,getData:D,nextPage:B}=ve(fe),M=async p=>{const u=p.currentTarget,k=u.scrollTop;u.scrollTop+u.offsetHeight>=u.scrollHeight&&w.data.length<w.total&&(await B(),v.value=w.data,await me(),setTimeout(()=>{u.scrollTop=k}))},O=async p=>{var u;p?(e.value.pid=p,N("search"),S.setProjectInfo({pname:(u=v.value.find(k=>k.id==p))==null?void 0:u.proname,pid:p})):N("clear")},V=de.debounce(async p=>{await D({fuzzy:p,page:1}),v.value=w.data},300),A=p=>{if(!p){e.value.pid=null,j();return}V(p)},j=async()=>{await D({page:1}),v.value=w.data};(async()=>{var p,u;await D({fuzzy:S.userInfo.pname}),v.value=w.data,e.value.pid=S.userInfo.pid?S.userInfo.pid:(p=v.value[0])==null?void 0:p.id,S.setProjectInfo({pid:e.value.pid,pname:(u=v.value.find(k=>k.id==e.value.pid))==null?void 0:u.proname}),N("search")})();async function E(){await C(),e.value.fuzzy="",N("reset")}const G=()=>{e.value.fuzzy="",N("search")};async function F(){var p,u;e.value.pid?N("search"):((p=window.$message)==null||p.destroyAll(),(u=window.$message)==null||u.warning("请选择项目"))}return(p,u)=>{const k=ce,d=ye,m=T,f=He,i=U,_=Ge,I=ae,H=_e,s=pe,a=ge;return g(),z(a,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[t(s,{ref_key:"formRef",ref:R,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Be(F,["enter"])},{default:l(()=>[t(H,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[t(d,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:l(()=>[t(k,{filterable:"",clearable:"",value:e.value.pid,"onUpdate:value":[u[0]||(u[0]=r=>e.value.pid=r),O],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:v.value,onScroll:M,onClear:j,onSearch:A},null,8,["value","options"])]),_:1}),t(d,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:l(()=>[t(m,{value:e.value.fuzzy,"onUpdate:value":u[1]||(u[1]=r=>e.value.fuzzy=r),placeholder:"请输入",clearable:"",onClear:G},null,8,["value"])]),_:1}),t(d,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[t(I,{class:"w-full"},{default:l(()=>[t(i,{onClick:E},{icon:l(()=>[t(f,{class:"text-icon"})]),default:l(()=>[b(" "+x(n(q)("common.reset")),1)]),_:1}),t(i,{type:"primary",ghost:"",onClick:F},{icon:l(()=>[t(_,{class:"text-icon"})]),default:l(()=>[b(" "+x(n(q)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Xe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function se($){return typeof $=="function"||Object.prototype.toString.call($)==="[object Object]"&&!Ve($)}const pt=te({name:"projectmanagement_need",__name:"index",setup($){const L=Ie(),{columns:N,columnChecks:R,data:C,getData:e,loading:S,pagination:v,mobilePagination:w,searchParams:D}=Ae({showTotal:!0,immediate:!1,apiFn:Oe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"affectedbusiness",title:"影响的业务",align:"center",width:120},{key:"devname",title:"设备名称",align:"center",width:120},{key:"apidocument",title:"接口文档",align:"center",width:120},{key:"uid",title:"研发对接人",align:"center",width:120},{key:"period",title:"研发周期",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"操作人",align:"center",width:120},{key:"dbtime",title:"操作时间",align:"center",width:120},{key:"operate",title:q("common.operate"),align:"center",width:140,fixed:"right",render:f=>{let i;return t("div",{class:"flex-center gap-8px"},[W(t(U,{type:"primary",ghost:!0,size:"small",onClick:()=>p(f.id)},se(i=q("common.edit"))?i:{default:()=>[i]}),[[X("no-auth"),"project:Development:update"]]),t(oe,{onPositiveClick:()=>F(f.id)},{default:()=>q("common.confirmDelete"),trigger:()=>{let _;return W(t(U,{type:"error",ghost:!0,size:"small"},se(_=q("common.delete"))?_:{default:()=>[_]}),[[X("no-auth"),"project:Development:delete"]])}})])}}]}),{drawerVisible:B,operateType:M,editingData:O,handleAdd:V,handleEdit:A,checkedRowKeys:j,onBatchDeleted:J,onDeleted:E}=Ee(C,e);Fe(async()=>{});async function G(){console.log(j.value),u(j.value.join(","),f=>{J()})}async function F(f){const{data:i,error:_}=await ne(f,D.pid);_||E()}function p(f){A(f)}async function u(f,i){const{data:_,error:I}=await ne(f,D.pid);if(!I)i&&i(_);else return!1}const k=f=>{e()},d=()=>{C.value=[],v.itemCount=0},m=()=>{e()};return(f,i)=>{const _=ae,I=De,H=Ce,s=xe,a=Le,r=ge,y=X("no-auth");return g(),Y("div",Xe,[t(We,{model:n(D),"onUpdate:model":i[0]||(i[0]=c=>Z(D)?D.value=c:null),onReset:m,onSearch:n(e),onClear:d},null,8,["model","onSearch"]),t(r,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[t(_,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>i[4]||(i[4]=[P("div",null,"需要开发",-1)])),_:1,__:[4]})]),"header-extra":l(()=>[t(_,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[W((g(),z(n(U),{onClick:n(V),size:"small",ghost:"",type:"primary"},{icon:l(()=>[t(I,{class:"text-icon"})]),default:l(()=>[i[5]||(i[5]=b(" "+x("新增")))]),_:1,__:[5]},8,["onClick"])),[[y,"project:Development:insert"]]),t(n(oe),{onPositiveClick:G},{trigger:l(()=>[W((g(),z(n(U),{size:"small",ghost:"",type:"error",disabled:n(j).length==0},{icon:l(()=>[t(H,{class:Me(["text-icon",{"animate-spin":n(S)}])},null,8,["class"])]),default:l(()=>[i[6]||(i[6]=b(" "+x("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[y,"project:Development:delete"]])]),default:l(()=>[i[7]||(i[7]=b(" 确定要删除选中的吗？ "))]),_:1,__:[7]}),t(s,{columns:n(R),"onUpdate:columns":i[1]||(i[1]=c=>Z(R)?R.value=c:null)},null,8,["columns"])]),_:1})]),default:l(()=>[t(a,{"checked-row-keys":n(j),"onUpdate:checkedRowKeys":i[2]||(i[2]=c=>Z(j)?j.value=c:null),columns:n(N),data:n(C),size:"small","flex-height":!n(L).isMobile,loading:n(S),remote:"","row-key":c=>c.id,pagination:n(w),class:"sm:h-full","onUpdate:filters":k},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Ze,{visible:n(B),"onUpdate:visible":i[3]||(i[3]=c=>Z(B)?B.value=c:null),onSubmitted:n(e),pid:n(D).pid,"operate-type":n(M),"row-data":n(O)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{pt as default};
