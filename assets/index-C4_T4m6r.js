import{_ as be}from"./table-column-setting.vue_vue_type_script_setup_true_lang-uXm8mfun.js";import{_ as ke}from"./round-delete-BINue5nP.js";import{_ as Ne}from"./round-add-qbOrVMgk.js";import{d as J,au as E,av as Y,s as re,x as ie,a as xe,$ as l,v as ue,Z as ce,y as K,c as I,o as M,w as a,f as e,aG as De,G as ee,A as de,h as t,D as F,C as ae,aw as Se,bx as Ce,N as L,B as R,g as x,t as U,aI as Ue,by as Pe,bz as Re,bA as $e,F as Te,U as pe,be as oe,e as Be,ax as me,bB as ze,bq as Me,M as Fe,r as Q,b as Ie,aB as A,ac as je,ab as Oe,aa as Ve,bC as qe,bD as Ge,bE as Ae,aE as ne,aF as Ke}from"./index-BvFB2cuj.js";import{u as Ee,a as Je}from"./table-BGg3LzBr.js";import{u as Le}from"./business-Bvyd4LPC.js";import{_ as We}from"./round-search-Nrgthioa.js";import{_ as Ze}from"./round-refresh-BjvpCeMo.js";import{_ as He}from"./Grid-Y7np-iXa.js";import{_ as Qe}from"./FormItemGridItem-hipcXcB6.js";import{_ as Xe}from"./Tree-4M3oMEC4.js";import{N as le}from"./Popconfirm-1kDZsQG6.js";const Ye=J({name:"OperateDrawer",__name:"operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(y,{emit:D}){const u=y,h=D,_=Y(y,"visible"),{formRef:w,validate:b,restoreValidation:T}=re(),{defaultRequiredRule:g,patternRules:$}=ie(),c=xe(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[u.operateType]),o=ue(d());function d(){return{id:void 0,username:"",oripwd:"",password:"",confirmPassword:"",usertype:"0",superadmin:1,userimage:"",phnum:"",udesc:""}}const p={username:g,oripwd:{...g,...$.password},password:{...g,...$.password},phnum:{...g,...$.mobile}};async function S(){if(Object.assign(o,d()),u.operateType==="edit"&&u.rowData){const{data:C,error:i}=await Pe(u.rowData.id);i?Object.assign(o,u.rowData):(Object.assign(o,C),o.usertype=o.usertype+"")}}function m(){_.value=!1}async function B(){var C,i;if(await b(),u.operateType==="add"){const{data:P,error:v}=await Re(o.username,o.password,o.usertype,o.superadmin,o.phnum,o.udesc);v||((C=window.$message)==null||C.success(l("common.addSuccess")),m(),h("submitted"))}else{const{data:P,error:v}=await $e({id:o.id,usertype:o.usertype,phnum:o.phnum,udesc:o.udesc});v||((i=window.$message)==null||i.success(l("common.updateSuccess")),m(),h("submitted"))}}return ce(_,()=>{_.value&&(S(),T())}),(C,i)=>{const P=ae,v=de,j=Se,O=ee,V=R,W=L,z=De,q=Ue,f=K("no-special");return M(),I(q,{show:_.value,"onUpdate:show":i[4]||(i[4]=k=>_.value=k),"display-directive":"show",width:360},{default:a(()=>[e(z,{title:c.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(W,{size:16},{default:a(()=>[e(V,{onClick:m},{default:a(()=>[x(U(t(l)("common.cancel")),1)]),_:1}),e(V,{type:"primary",onClick:B},{default:a(()=>[x(U(t(l)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(O,{ref_key:"formRef",ref:w,model:o,rules:p},{default:a(()=>[e(v,{label:t(l)("page.manage.user.username"),path:"username"},{default:a(()=>[F(e(P,{value:o.username,"onUpdate:value":i[0]||(i[0]=k=>o.username=k),placeholder:t(l)("page.manage.user.form.username"),readonly:u.operateType==="edit"},null,8,["value","placeholder","readonly"]),[[f]])]),_:1},8,["label"]),e(v,{label:"用户类型",path:"usertype"},{default:a(()=>[e(j,{value:o.usertype,"onUpdate:value":i[1]||(i[1]=k=>o.usertype=k),filterable:"",placeholder:"请选择用户类型",options:t(Ce)(t(Le)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{label:"手机号码",path:"phnum"},{default:a(()=>[e(P,{clearable:"",value:o.phnum,"onUpdate:value":i[2]||(i[2]=k=>o.phnum=k),maxlength:11,placeholder:"请输入手机号码"},null,8,["value"])]),_:1}),e(v,{label:"描述",path:"udesc"},{default:a(()=>[e(P,{type:"textarea",clearable:"",value:o.udesc,"onUpdate:value":i[3]||(i[3]=k=>o.udesc=k),placeholder:"请输入描述",autosize:{minRows:3}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ea=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(y,{emit:D}){const u=D,{formRef:h,restoreValidation:_}=re(),w=Y(y,"model");function b(){w.value.username="",u("search")}async function T(){await _(),u("reset")}async function g(){u("search")}return($,c)=>{const o=ae,d=Qe,p=Ze,S=R,m=We,B=L,C=He,i=ee,P=pe;return M(),I(P,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(i,{ref_key:"formRef",ref:h,model:w.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Te(g,["enter"])},{default:a(()=>[e(C,{responsive:"screen","item-responsive":""},{default:a(()=>[e(d,{span:"24 s:12 m:6",label:t(l)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:a(()=>[e(o,{clearable:"",value:w.value.username,"onUpdate:value":c[0]||(c[0]=v=>w.value.username=v),valueModifiers:{trim:!0},placeholder:t(l)("page.manage.user.form.username"),onClear:b},null,8,["value","placeholder"])]),_:1},8,["label"]),e(d,{span:"24 s:12 m:6",class:"pr-24px"},{default:a(()=>[e(B,{class:"w-full"},{default:a(()=>[e(S,{onClick:T},{icon:a(()=>[e(p,{class:"text-icon"})]),default:a(()=>[x(" "+U(t(l)("common.reset")),1)]),_:1}),e(S,{type:"primary",ghost:"",onClick:g},{icon:a(()=>[e(m,{class:"text-icon"})]),default:a(()=>[x(" "+U(t(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),aa=J({name:"assignRoles",__name:"assign-roles",props:E({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(y){const D=y,u=Y(y,"visible");function h(){u.value=!1}const _=oe([]),w=async()=>{const{error:c,data:o}=await Me();if(!c){const d=JSON.parse(JSON.stringify(o));_.value=d.list.map(p=>p)}},b=oe([]),T=async(c,o,d)=>{var p;b.value=[(p=d.node)==null?void 0:p.id]};async function g(){var c,o,d;if(D.rowData.id){const{data:p,error:S}=await ze(D.rowData.id,b.value.join(","));S||((c=window.$message)==null||c.destroyAll(),(d=(o=window.$message)==null?void 0:o.success)==null||d.call(o,l("common.modifySuccess")),h())}}function $(){D.rowData.id&&(w(),b.value=[D.rowData.roleId])}return ce(u,c=>{c&&$()}),(c,o)=>{const d=Xe,p=R,S=L,m=me;return M(),I(m,{show:u.value,"onUpdate:show":o[0]||(o[0]=B=>u.value=B),preset:"card",class:"w-480px"},{header:a(()=>o[1]||(o[1]=[Be("div",{class:"flex"},"设置用户角色",-1)])),footer:a(()=>[e(S,{justify:"end"},{default:a(()=>[e(p,{size:"small",class:"mt-16px",onClick:h},{default:a(()=>[x(U(t(l)("common.cancel")),1)]),_:1}),e(p,{type:"primary",size:"small",class:"mt-16px",onClick:g},{default:a(()=>[x(U(t(l)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(d,{cascade:"","checked-keys":b.value,data:_.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"","label-field":"name","key-field":"id","children-field":"children","onUpdate:checkedKeys":T},null,8,["checked-keys","data"])]),_:1},8,["show"])}}}),ta={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function X(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Ke(y)}const _a=J({name:"manage_user",__name:"index",setup(y){const D=Fe(),{columns:u,columnChecks:h,data:_,getData:w,loading:b,mobilePagination:T,searchParams:g,resetSearchParams:$}=Ee({apiFn:Ae,apiParams:{page:1,pageSize:50,limit:50,username:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"username",title:l("page.manage.user.username"),align:"center",minWidth:160},{key:"usertype",title:"用户类型",align:"center",width:120,render:n=>{const s=n.usertype===0?"超级管理员":n.usertype===1?"销售":n.usertype===2?"项目负责人":n.usertype===3?"调试工程师":n.usertype===4?"综合管理":"";return n.usertype===0||n.usertype===1||n.usertype,e(ne,{type:"primary"},X(s)?s:{default:()=>[s]})}},{key:"phnum",title:"手机号码",align:"center",width:160},{key:"udesc",title:"描述",align:"center",minWidth:200},{key:"status",title:l("page.manage.user.status"),align:"center",width:180,render:n=>(n.status===null?n.status=0:(n.status===2||n.status===3)&&(n.status=1),e(ne,{type:n.status==0?"success":n.status==1?"error":n.status==2?"warning":"success"},{default:()=>[n.status==0?"正常":n.status==1?"异常":n.status==2?"锁定":"正常"]}))},{key:"createdate",title:l("page.manage.user.createDate"),align:"center",width:180},{key:"operate",title:l("common.operate"),align:"center",width:320,render:n=>{let s;return e("div",{class:"flex-center gap-8px"},[F(e(R,{type:"primary",ghost:!0,size:"small",onClick:()=>v(n.id)},X(s=l("common.edit"))?s:{default:()=>[s]}),[[K("no-auth"),"sys:user:update"]]),e(le,{onPositiveClick:()=>P(n.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let N;return F(e(R,{type:"error",ghost:!0,size:"small"},X(N=l("common.delete"))?N:{default:()=>[N]}),[[K("no-auth"),"sys:user:delete"]])}})])}}]}),{drawerVisible:c,operateType:o,editingData:d,handleAdd:p,handleEdit:S,checkedRowKeys:m,onBatchDeleted:B,onDeleted:C}=Je(_,w);async function i(){console.log(m.value),j(m.value,n=>{B()})}function P(n){j([n],s=>{C()})}function v(n){S(n)}async function j(n,s){const N=await qe(n);console.log("data",N),s&&s(N)}const O=Q(!1),{defaultRequiredRule:V,patternRules:W}=ie(),z=Q(!1),q=Q(),f=ue({username:"",password:"",confirmPassword:"",id:null}),k={password:[V,W.password],confirmPassword:[{required:!0,message:l("form.confirmPwd.required")},{asyncValidator:(n,s)=>s.trim()!==""&&s!==f.password?Promise.reject(n.message):Promise.resolve(),message:l("form.confirmPwd.invalid"),trigger:"input"}]},fe=async()=>{var N,G;if(!f.id)return;await((N=q.value)==null?void 0:N.validate());const{data:n,error:s}=await Ge(f.username,f.id,f.password);s||((G=window.$message)==null||G.success("修改成功"),z.value=!1)};return(n,s)=>{const N=Ne,G=ke,_e=be,te=L,ge=je,ye=pe,Z=ae,H=de,we=ee,ve=Ve,he=me,se=K("no-auth");return M(),Ie("div",ta,[e(ea,{model:t(g),"onUpdate:model":s[0]||(s[0]=r=>A(g)?g.value=r:null),onReset:t($),onSearch:t(w)},null,8,["model","onReset","onSearch"]),e(ye,{title:t(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(te,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[F((M(),I(t(R),{onClick:t(p),size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(N,{class:"text-icon"})]),default:a(()=>[s[10]||(s[10]=x(" "+U("新增")))]),_:1,__:[10]},8,["onClick"])),[[se,"sys:user:insert"]]),e(t(le),{onPositiveClick:i},{trigger:a(()=>[F((M(),I(t(R),{size:"small",ghost:"",type:"error",disabled:t(m).length==0},{icon:a(()=>[e(G,{class:Oe(["text-icon",{"animate-spin":t(b)}])},null,8,["class"])]),default:a(()=>[s[11]||(s[11]=x(" "+U("批量删除")))]),_:1,__:[11]},8,["disabled"])),[[se,"sys:user:delete"]])]),default:a(()=>[s[12]||(s[12]=x(" 确定要删除选中的吗？ "))]),_:1,__:[12]}),e(_e,{columns:t(h),"onUpdate:columns":s[1]||(s[1]=r=>A(h)?h.value=r:null)},null,8,["columns"])]),_:1})]),default:a(()=>[e(ge,{"checked-row-keys":t(m),"onUpdate:checkedRowKeys":s[2]||(s[2]=r=>A(m)?m.value=r:null),columns:t(u),data:t(_),size:"small","flex-height":!t(D).isMobile,"scroll-x":962,loading:t(b),remote:"","row-key":r=>r.id,pagination:t(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ye,{visible:t(c),"onUpdate:visible":s[3]||(s[3]=r=>A(c)?c.value=r:null),"operate-type":t(o),"row-data":t(d),onSubmitted:t(w)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(aa,{"row-data":t(d),visible:O.value,"onUpdate:visible":s[4]||(s[4]=r=>O.value=r)},null,8,["row-data","visible"])]),_:1},8,["title"]),e(he,{show:z.value,"onUpdate:show":s[9]||(s[9]=r=>z.value=r),title:t(l)("common.updatePassword"),preset:"card",class:"w-620px"},{footer:a(()=>[e(te,{justify:"end",size:16},{default:a(()=>[e(t(R),{onClick:s[8]||(s[8]=r=>z.value=!1)},{default:a(()=>[x(U(t(l)("common.cancel")),1)]),_:1}),e(t(R),{type:"primary",onClick:fe},{default:a(()=>[x(U(t(l)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(ve,{class:"max-h-480px pr-20px"},{default:a(()=>[e(we,{ref_key:"formRef",ref:q,model:f,rules:k,"label-placement":"left","label-width":100,"require-mark-placement":"left"},{default:a(()=>[e(H,{label:t(l)("page.manage.user.username"),path:"username"},{default:a(()=>[e(Z,{readonly:"",value:f.username,"onUpdate:value":s[5]||(s[5]=r=>f.username=r),placeholder:t(l)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(H,{label:t(l)("page.login.common.password"),path:"password"},{default:a(()=>[e(Z,{type:"password","show-password-on":"click",clearable:"",value:f.password,"onUpdate:value":s[6]||(s[6]=r=>f.password=r),placeholder:t(l)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(H,{label:t(l)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:a(()=>[e(Z,{type:"password","show-password-on":"click",clearable:"",value:f.confirmPassword,"onUpdate:value":s[7]||(s[7]=r=>f.confirmPassword=r),placeholder:t(l)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])])}}});export{_a as default};
