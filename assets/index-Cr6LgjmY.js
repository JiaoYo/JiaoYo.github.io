import{_ as U}from"./save-outline-eLF6MMTk.js";import{_ as q}from"./round-search-B8p9P7jA.js";import{d as P,r as j,aw as b,k as p,ab as A,z as E,o as D,e as G,g as i,w as u,h as w,i as g,B as C,af as N,t as I,A as J,c as H,av as L,ax as W,eu as F,aS as Q,P as R,aT as X,a6 as Y,b4 as y,b1 as Z,_ as K}from"./index-B7o72uKK.js";import{d as T}from"./debounce-CYo0qw43.js";import{_ as ee}from"./lodash-D2vPoUUv.js";import{_ as ae}from"./DatePicker-C2ZJcYZw.js";const te={class:"min-h-500px flex-col-stretch gap-16px lt-sm:overflow-auto"},ne=P({name:"stationmanagement_reportingdatarestrictions",__name:"index",setup(le){const _=j({dateTime:b(0,Date.now()),type:1}),c=(e,n,t,l)=>{const a=e[n];if(!(a!=null&&a.dbtime))return null;const r=T(s=>{a[t]=s,!(t==="maxValue"&&a.minValue&&s<a.minValue&&s)&&t==="minValue"&&a.maxValue&&s>a.maxValue},300);return a[l]?y(Z,{value:a[t],onUpdateValue:r,status:a.maxValue&&a.minValue&&a.maxValue<a.minValue?"error":"success",onBlur:()=>{a.maxValue&&a.minValue&&a.maxValue<a.minValue||(a[l]=!1)},min:1,max:k.value}):y("span",{style:{cursor:"pointer",width:"100%",display:"inline-block",height:"40px",lineHeight:"40px"},onClick:()=>{a[l]=!0,setTimeout(()=>{const s=document.querySelectorAll("input");s.length&&s[s.length-1].focus()},0)}},a[t]||y("span",{style:{color:"rgba(194, 194, 194,.7)",fontSize:"12px"}},"未设置"))},S=[{title:"时间",key:"dbtime",render:e=>{var n;return i("span",null,[(n=e[0])==null?void 0:n.dbtime])}},{title:"上限值",key:"maxValue",render:e=>c(e,0,"maxValue","isedit"),className:"inputInt"},{title:"下限值",key:"minValue",render:e=>c(e,0,"minValue","isedit1"),className:"inputInt"},{title:"时间",key:"key",render:e=>{var n;return i("span",null,[(n=e[1])==null?void 0:n.dbtime])}},{title:"上限值",key:"value",minWidth:180,render:e=>c(e,1,"maxValue","isedit"),className:"inputInt"},{title:"下限值",key:"value",render:e=>c(e,1,"minValue","isedit1"),className:"inputInt"},{title:"时间",key:"key",render:e=>{var n;return i("span",null,[(n=e[2])==null?void 0:n.dbtime])}},{title:"上限值",key:"maxValue",render:e=>c(e,2,"maxValue","isedit"),className:"inputInt"},{title:"下限值",key:"minValue",render:e=>c(e,2,"minValue","isedit1"),className:"inputInt"}],k=p(0);(async()=>{const{data:e,error:n}=await L({_t:new Date().getTime()});n||(k.value=e.maxeqmt)})();const m=p(!1);let d=p([]);const x=p([]),f=async()=>{m.value=!0,d.value=[];const{data:e,error:n}=await W({date:_.dateTime});if(!n){x.value=JSON.parse(JSON.stringify(e)),e.forEach(t=>{t.maxValue=t.maxValue?t.maxValue:null,t.minValue=t.minValue?t.minValue:null,t.isedit=!1,t.isedit1=!1});for(let t=0;t<e.length;t+=3)d.value.push(e.slice(t,t+3));m.value=!1}};f();const B=ee.debounce(f,1e3,{leading:!0,trailing:!1}),M=e=>{_.dateTime=b(0,e),f()},O=async()=>{var a,r,s;let e=d.value.flat();const n=new Map;if(x.value.forEach(o=>{n.set(o.id,[o.maxValue,o.minValue])}),e=e.filter(o=>{const V=n.get(o.id);return V[0]!==o.maxValue&&o.maxValue!==null||V[1]!==o.minValue&&o.minValue!==null}),e.some(o=>o.isedit1||o.isedit))return(a=window.$message)==null?void 0:a.warning("请填写符合逻辑的数据");if(e.length==0)return(r=window.$message)==null?void 0:r.warning("请填写数据");const{data:t,error:l}=await F(e);l||((s=window.$message)==null||s.success("设置成功"),f())},v=p(!1),$=T(e=>{let n=e==null?void 0:e.flat();const t=new Map;x.value.forEach(l=>{t.set(l.id,[l.maxValue,l.minValue])}),n=n.filter(l=>{const a=t.get(l.id);return a[0]!==l.maxValue&&l.maxValue!==null||a[1]!==l.minValue&&l.minValue!==null}),v.value=n.length>0},300);return A(()=>d.value,e=>{$(e)},{deep:!0}),(e,n)=>{const t=ae,l=q,a=Q,r=R,s=U,o=X,V=Y,z=E("no-auth");return D(),G("div",te,[i(V,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:u(()=>[i(r,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:u(()=>[w(" 上报数据限制 "),i(a,null,{default:u(()=>[i(t,{"formatted-value":_.dateTime,"onUpdate:formattedValue":n[0]||(n[0]=h=>_.dateTime=h),"value-format":"yyyy-MM-dd",type:"date","onUpdate:value":M,style:{width:"200px"}},null,8,["formatted-value"]),i(g(C),{type:"primary",ghost:"",onClick:g(B)},{icon:u(()=>[i(l,{class:N(["text-icon",{"animate-spin":m.value}])},null,8,["class"])]),default:u(()=>[w(" "+I(e.$t("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":u(()=>[i(r,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:u(()=>[J((D(),H(g(C),{onClick:O,ghost:"",type:"primary",disabled:!v.value},{icon:u(()=>[i(s,{class:N(["text-icon",{"animate-spin":m.value}])},null,8,["class"])]),default:u(()=>[w(" "+I(e.$t("common.save")),1)]),_:1},8,["disabled"])),[[z,"power.update"]])]),_:1})]),default:u(()=>[i(o,{columns:S,data:g(d),bordered:!1,"flex-height":!0,class:"sm:h-full","row-key":h=>h.id,loading:m.value},null,8,["data","row-key","loading"])]),_:1})])}}}),de=K(ne,[["__scopeId","data-v-c5837ff0"]]);export{de as default};
