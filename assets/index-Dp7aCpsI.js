import{_ as tn}from"./correct-BWeKuQNW.js";import{_ as Hl,a as Gl,V as ln,b as an,c as nn,d as sn,e as on,f as rn,g as dn}from"./index-Bxx-_JhL.js";import{_ as va}from"./round-plus-C1IOaOCW.js";import{_ as un}from"./round-search-zdbG5kkR.js";import{R as kt,b as k,o as r,e as f,d as Tt,z as Mt,s as b,at as qt,i as Wl,aK as Kl,F as ft,aP as Oe,f as a,I as je,c as A,w as s,g as p,h as c,B as _,a3 as cn,bN as pn,a$ as It,dj as fn,a2 as Yl,G as L,t as B,aM as Ft,a7 as St,J as qe,b3 as ya,H as ie,L as ha,da as Lt,aE as gt,W as Cl,ay as tt,a4 as il,M as ba,N as Ll,aA as _l,az as sl,$ as ee,aN as gn,dk as mn,n as l,aG as wt,dl as vn,dm as yn,dn as hn,aJ as _a,cZ as Ql,av as xl,A as bn,a as _n,ax as xa,au as Pe,aD as Xl,K as Ml,a5 as xt,aS as it,cy as ka,cB as Ol,aT as Ca,cD as Rl,cG as La,bg as Sa,cQ as wa,c$ as $a,D as st,aH as xn,dp as ra,dq as kn,dr as Cn,S as Ln,d4 as Sn,ds as wn,dt as $n,du as Dn,dv as zn,dw as jn,dx as Un,X as Bn,Y as Fn,cL as In,cJ as Tn,cK as Nn,dy as Vt,d1 as Pn,d0 as En,c_ as da,cH as An,cI as Vn,cE as ua,cF as ca,dd as qn,de as Mn,db as On,dc as Rn,dh as Jn,di as Hn,df as Gn,dg as Wn,dz as Kn,dA as pa,dB as Yn,dC as Qn,dD as Xn,bo as Zn,bq as es,dE as ts,aO as ls,dF as as,dG as ns,cC as ss,aR as is}from"./index-CYM7WsrU.js";import{u as mt}from"./usePageData-DZmITRE8.js";import{f as Da,b as os,_ as za,c as rs,a as ds,e as us,d as cs}from"./drawerLog-B0SI4QqF.js";import{N as He}from"./Popconfirm-C8JWPuCK.js";import{_ as fa,a as ps}from"./text-DSTU4hbh.js";import{h as Ye}from"./permission-CMBcp-KE.js";import{u as fs}from"./table-DBhYnjkY.js";import{_ as kl}from"./DatePicker-kRu-lJ01.js";import{N as Jl}from"./Cascader-CshNhxHg.js";import{_ as gs}from"./round-delete-CPUsZN4F.js";import{a as ms,_ as vs,A as ys}from"./index-CRUsD1CH.js";import{p as ga,f as ma}from"./business-Djf4miNR.js";import{_ as hs,a as bs}from"./DescriptionsItem-DcDzPTW9.js";import{_ as ja,a as _s}from"./Grid-XBh6Ijop.js";import{_ as xs,d as ks}from"./drawerLog-Cvl5T0VQ.js";import{l as Cs}from"./lookdebuggingSheetModal-cKAO5sj4.js";import{f as Ls}from"./mojicb-2ahC4oo8.js";import{_ as Ss}from"./FormItemGridItem-DU6pdzl5.js";import{N as ws}from"./Table-rnzd9UQ0.js";const $s={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ds(_e,P){return r(),k("svg",$s,P[0]||(P[0]=[f("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H5.2L4 17.2V4h16zm-3-5h-2V9h2m-4 2h-2V9h2m-4 2H7V9h2"},null,-1)]))}const zs=kt({name:"mdi-message-processing-outline",render:Ds}),js={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Us(_e,P){return r(),k("svg",js,P[0]||(P[0]=[f("path",{fill:"currentColor",d:"m12 10.8l-4.6 4.6L6 14l6-6l6 6l-1.4 1.4z"},null,-1)]))}const Bs=kt({name:"material-symbols-keyboard-arrow-up",render:Us}),Fs={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Is(_e,P){return r(),k("svg",Fs,P[0]||(P[0]=[f("path",{fill:"currentColor",d:"M12 14.975q-.2 0-.375-.062T11.3 14.7l-4.6-4.6q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l3.9 3.9l3.9-3.9q.275-.275.7-.275t.7.275t.275.7t-.275.7l-4.6 4.6q-.15.15-.325.213t-.375.062"},null,-1)]))}const Ts=kt({name:"material-symbols-keyboard-arrow-down-rounded",render:Is}),Ns={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ps(_e,P){return r(),k("svg",Ns,P[0]||(P[0]=[f("path",{fill:"currentColor",d:"M3 21v-4.25L16.2 3.575q.3-.275.663-.425t.762-.15t.775.15t.65.45L20.425 5q.3.275.438.65T21 6.4q0 .4-.137.763t-.438.662L7.25 21zM17.6 7.8L19 6.4L17.6 5l-1.4 1.4z"},null,-1)]))}const Es=kt({name:"material-symbols-edit",render:Ps}),As={class:"flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto h-100%"},Vs={style:{display:"flex","flex-direction":"column","justify-content":"space-between",gap:"16px",height:"100%"}},qs={key:1},Ms={class:"flex items-center justify-between"},Os={class:"flex items-center"},Rs={class:"font-size-16px font-bold"},Js={class:"font-size-12px c-#868e96"},Hs={key:0},Gs={class:"font-size-12px c-#a19f9d my-5px"},Ws={key:1,class:"mt-1 flex items-center justify-between gap-3 text-sm text-gray-500"},Ks=["onClick"],Ys={key:0,class:"mt-4 border-t pt-3"},Qs={class:"flex items-start gap-2 mb-3"},Xs={class:"ml-2 flex-1"},Zs={class:"flex justify-between items-center"},ei={class:"font-medium mr-20px"},ti={class:"text-gray-600 mt-1"},li={style:{display:"flex","justify-content":"flex-end"}},ai=Tt({__name:"dayLog",props:{pid:{},pname:{}},setup(_e){const P=Mt(),Q=_e,I=b([]);qt(()=>Q.pid,V=>{V&&re()});const oe=b({page:1,limit:10,total:0}),re=async()=>{const{data:V,error:S}=await Da({pid:Q.pid,page:oe.value.page,limit:oe.value.limit});V&&(oe.value.total=V.total,I.value=V.list.map(he=>(he.showCommentSection=!1,he.showAll=!1,he)))},T=V=>{oe.value.page=V,re()},m=V=>{oe.value.limit=V,re()};Wl(()=>{re()});const K=b("add"),me=b({}),Fe=b(!1),ve=()=>{Fe.value=!0,K.value="add"},ke=V=>{Fe.value=!0,K.value="edit",me.value=V},$e=async V=>{var Ce;const{data:S,error:he}=await ds(V.id);S&&((Ce=window.$message)==null||Ce.success("删除成功"),I.value.length===1&&oe.value.page>1&&oe.value.page--,re())},De=V=>{I.value.forEach(S=>{S.id!==V.id&&(S.showAll=!1)}),V.showAll=!V.showAll};async function Re(V,S=8,he=30){var de;await gt();for(let Ee=0;Ee<S;Ee++){const X=document.querySelector(`#${V} textarea`);if(X&&typeof X.focus=="function"){X.focus();const xe=X.value;if(xe&&X.setSelectionRange){const le=xe.length;X.setSelectionRange(le,le)}return!0}await new Promise(xe=>setTimeout(xe,he))}const Ce=document.getElementById(V);return Ce&&(Ce.tabIndex=-1,(de=Ce.focus)==null||de.call(Ce)),!1}const Ue=async V=>{I.value.forEach(S=>{S.id!==V.id&&(S.showCommentSection=!1)}),V.showCommentSection=!V.showCommentSection,V.showCommentSection&&await Re(`comment-input-${V.id}`),Ie(V)},Ie=async V=>{const{data:S,error:he}=await rs({page:1,limit:100,pid:V.id});S&&(V.comments=S.list)},ye=b({}),fe=Kl.debounce(async V=>{var de;const S=ye.value[V.id];if(!(S!=null&&S.trim()))return(de=window.$message)==null?void 0:de.warning("请输入评论内容");const{data:he,error:Ce}=await os([{pid:V.id,context:S}]);he&&(Ie(V),V.num++,ye.value[V.id]="")},1e3,{leading:!0,trailing:!1}),Se=async(V,S)=>{var de;const{data:he,error:Ce}=await us(V.id);he&&(Ie(S),S.num--,(de=window.$message)==null||de.success("删除成功"))};return(V,S)=>{const he=Es,Ce=Ts,de=Bs,Ee=zs,X=He,xe=qe,le=fn,Be=ft("no-auth");return r(),k(Oe,null,[f("div",As,[je((r(),A(c(_),{type:"primary",onClick:ve},{icon:s(()=>[a(he)]),default:s(()=>[S[3]||(S[3]=p(" 写日报"))]),_:1,__:[3]})),[[Be,"project:DailyReport:insert"]]),f("div",Vs,[a(c(cn),{style:{height:"calc(100vh - 181px)"}},{default:s(()=>[I.value.length?(r(),k("div",qs,[(r(!0),k(Oe,null,It(I.value,D=>(r(),A(c(Yl),{key:D.id,class:"mb-4",title:"",size:"small"},{default:s(()=>[f("div",Ms,[f("div",Os,[D.showAll?(r(),A(Ce,{key:0,class:"font-size-20px mr-10px cursor-pointer",onClick:H=>De(D)},null,8,["onClick"])):(r(),A(de,{key:1,class:"font-size-20px mr-10px cursor-pointer",onClick:H=>De(D)},null,8,["onClick"])),f("span",Rs,B(D.username)+"的日报",1)]),f("span",Js,B(D.dbtime),1)]),D.showAll?(r(),k("div",Hs,[S[4]||(S[4]=f("div",{class:"font-size-14px font-bold"},"项目名称",-1)),f("div",{class:Ft(["preview-text",{textstyle:JSON.parse(D.context).proname}])},B(JSON.parse(D.context).proname),3),S[5]||(S[5]=f("div",{class:"font-size-14px font-bold"},"当前工作内容及成果描述",-1)),f("div",{class:Ft(["preview-text",{textstyle:JSON.parse(D.context).notes}])},B(JSON.parse(D.context).notes),3),S[6]||(S[6]=f("div",{class:"font-size-14px font-bold"},"遇到问题",-1)),f("div",{class:Ft(["preview-text",{textstyle:JSON.parse(D.context).problem}])},B(JSON.parse(D.context).problem),3),S[7]||(S[7]=f("div",{class:"font-size-14px font-bold"},"解决措施",-1)),f("div",{class:Ft(["preview-text",{textstyle:JSON.parse(D.context).solutions}])},B(JSON.parse(D.context).solutions),3),S[8]||(S[8]=f("div",{class:"font-size-14px font-bold"},"建议意见反馈",-1)),f("div",{class:Ft(["preview-text",{textstyle:JSON.parse(D.context).feedback}])},B(JSON.parse(D.context).feedback),3),S[9]||(S[9]=f("div",{class:"font-size-14px font-bold"},"（总结）自己对一天工作的感受和体感",-1)),f("div",{class:Ft(["preview-text",{textstyle:JSON.parse(D.context).summarize}])},B(JSON.parse(D.context).summarize),3)])):L("",!0),f("div",Gs,"字符数："+B(D.charctras),1),D.showAll?(r(),k("div",Ws,[f("span",{class:"cursor-pointer hover:text-blue-500",style:St({color:D.showCommentSection?"#1890ff":""}),onClick:H=>Ue(D)},[a(Ee,{class:"font-size-18px"}),p(B(D.num==0?"":D.num),1)],12,Ks),c(P).userInfo.id==D.creater?(r(),A(xe,{key:0},{default:s(()=>[a(c(_),{quaternary:"",type:"info",size:"small",onClick:H=>ke(D)},{default:s(()=>S[10]||(S[10]=[p(" 编辑 ")])),_:2,__:[10]},1032,["onClick"]),a(X,{onPositiveClick:H=>$e(D)},{trigger:s(()=>[a(c(_),{quaternary:"",type:"error",size:"small"},{default:s(()=>S[11]||(S[11]=[p(" 删除 ")])),_:1,__:[11]})]),default:s(()=>[S[12]||(S[12]=p(" 确定删除吗？ "))]),_:2,__:[12]},1032,["onPositiveClick"])]),_:2},1024)):L("",!0)])):L("",!0),a(ya,{name:"fade"},{default:s(()=>[D.showCommentSection?(r(),k("div",Ys,[f("div",Qs,[f("div",null,[a(c(fa),{size:"small",src:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"})]),a(c(ie),{type:"textarea",id:`comment-input-${D.id}`,value:ye.value[D.id],"onUpdate:value":H=>ye.value[D.id]=H,placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ha(Lt(H=>c(fe)(D),["exact","prevent"]),["enter"])},null,8,["id","value","onUpdate:value","onKeydown"]),a(c(_),{type:"primary",ghost:"",onClick:H=>c(fe)(D)},{default:s(()=>S[13]||(S[13]=[p("发送")])),_:2,__:[13]},1032,["onClick"])]),(r(!0),k(Oe,null,It(D.comments,H=>(r(),k("div",{key:H.id,class:"flex mb-3"},[a(c(fa),{size:"small",src:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"}),f("div",Xs,[f("div",Zs,[f("div",null,[f("span",ei,B(H.username),1),a(c(ps),{depth:"3",style:{"font-size":"12px"}},{default:s(()=>[p(B(H.dbtime),1)]),_:2},1024),c(P).userInfo.id==H.creater?(r(),A(X,{key:0,onPositiveClick:Ge=>Se(H,D)},{trigger:s(()=>[a(c(_),{quaternary:"",type:"error",size:"small"},{default:s(()=>S[14]||(S[14]=[p(" 删除 ")])),_:1,__:[14]})]),default:s(()=>[S[15]||(S[15]=p(" 确定删除吗？ "))]),_:2,__:[15]},1032,["onPositiveClick"])):L("",!0),f("div",ti,B(H.context),1)])])])]))),128))])):L("",!0)]),_:2},1024)]),_:2},1024))),128))])):(r(),A(c(pn),{key:0,description:"暂无日志"}))]),_:1}),f("div",li,[a(le,{page:oe.value.page,"onUpdate:page":[S[0]||(S[0]=D=>oe.value.page=D),T],"page-size":oe.value.limit,"onUpdate:pageSize":[S[1]||(S[1]=D=>oe.value.limit=D),m],"item-count":oe.value.total,"show-size-picker":"","page-sizes":[10,20,50],prefix:()=>`共 ${oe.value.total} 条记录`},null,8,["page","page-size","item-count","prefix"])])])]),a(za,{visible:Fe.value,"onUpdate:visible":S[2]||(S[2]=D=>Fe.value=D),onSubmitted:re,"operate-type":K.value,pname:Q.pname,pid:Q.pid,"row-data":me.value},null,8,["visible","operate-type","pname","pid","row-data"])],64)}}}),ni=Cl(ai,[["__scopeId","data-v-3f32dd5a"]]),si={class:"flex items-center justify-between"},ii={class:"flex items-center"},oi={style:{margin:"10px 0","font-weight":"bolder",width:"140px"}},ri={key:0,class:"font-size-12px c-#ffa502 ml-10px"},di={key:0},ui={style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},ci={key:0},pi={style:{display:"flex","justify-content":"space-between"}},fi={key:0,class:"preview-content"},gi=["src"],mi={key:4},vi=["src"],yi=Tt({__name:"fileList",props:{pid:{},data:{},fileType:{},typename:{}},emits:["getData"],setup(_e,{emit:P}){const Q=_e,I=Mt(),oe=P,re=[{title:"文件别名",key:"name",align:"center",width:200,ellipsis:{tooltip:!0}},{title:"文件名称",key:"filename",align:"center",width:200,ellipsis:{tooltip:!0}},{title:"上传人",key:"creator",align:"center",width:100},{title:"上传时间",key:"dbtime",align:"center",width:200},{title:"操作",key:"actions",align:"center",width:180,render(v,h){return l(qe,{justify:"center"},[l(_,{type:"info",size:"small",ghost:!0,onClick:()=>{Ce(v)}},{default:()=>"查看"}),l(_,{type:"info",size:"small",ghost:!0,onClick:()=>{De(v)}},{default:()=>"下载"}),Ye("project:File:update")&&l(_,{type:"info",size:"small",ghost:!0,onClick:()=>{xe(v)}},{default:()=>"编辑"}),Ye("project:File:delete")&&(I.userInfo.usertype==0||I.userInfo.usertype==2)&&l(He,{onPositiveClick:async()=>{var z;if(v.id){const{data:M,error:G}=await yn(v.url),{data:d,error:y}=await hn(v.id);y||((z=window.$message)==null||z.success("删除成功"),oe("getData"))}}},{default:()=>ee("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>ee("common.delete")})})])}}];async function T(v){var h;return v.file.file.size>100*1024*1024?((h=window.$message)==null||h.error("文件大小不能超过100M"),!1):!0}const m=b(!1),K=b(null),me=b({fileName:"",file:null,id:void 0}),Fe={fileName:[{required:!0,message:"请输入文件别名",trigger:["blur","change"]}]},ve=b(0),ke=()=>{H.value=[],m.value=!0,ve.value=0,me.value.id=void 0,me.value.fileName="",me.value.file=null},$e=async()=>{var v,h,z,M;try{if(await((v=K.value)==null?void 0:v.validate()),me.value.id){const{data:G,error:d}=await mn([{id:me.value.id,filename:me.value.fileName}]);if(d)return(h=window.$message)==null?void 0:h.error("保存文件记录失败");(z=window.$message)==null||z.destroyAll(),(M=window.$message)==null||M.success("编辑成功"),oe("getData"),X.value=!1;return}}catch{X.value=!1}};async function De(v){if(v!=null&&v.url)try{const z=await(await fetch(v.url,{mode:"cors"})).blob(),M=URL.createObjectURL(z),G=document.createElement("a");G.href=M,G.download=v.filename,G.style.display="none",document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(M)}catch(h){console.error("下载失败:",h)}}const Re=()=>{console.log("渲染完成")},Ue=v=>{console.log(v,"渲染失败")},Ie=b(!1),ye=b(""),fe=b([]),Se=b(""),V=b("预览文件"),S=b(!1),he=b(0),Ce=v=>{var z,M;if(!(v!=null&&v.url))return;const h=(z=v.filename.split(".").pop())==null?void 0:z.toLowerCase();if(ye.value=v.url,V.value=v.filename,["xls","xlsx"].includes(h))Se.value="xls";else if(["doc","docx"].includes(h))Se.value="doc";else if(["pdf"].includes(h))Se.value="pdf";else if(["png","jpg","jpeg","gif","bmp"].includes(h)){Se.value="img",fe.value=Q.data.map(d=>{var y;return["png","jpg","jpeg","gif","bmp"].includes((y=d.filename.split(".").pop())==null?void 0:y.toLowerCase())?d.url:""}).filter(d=>d!=="");const G=fe.value.findIndex(d=>d===v.url);he.value=G,S.value=!0;return}else if(["mp4"].includes(h))Se.value="mp4";else{(M=window.$message)==null||M.warning("暂不支持该文件类型预览");return}Ie.value=!0},de=b(45),Ee=()=>{de.value==45?de.value=350:de.value=45},X=b(!1);function xe(v){me.value.id=v.id,me.value.fileName=v.name,X.value=!0}const le=()=>{X.value=!1};function Be(v){return v.replace(/\.[^/.]+$/,"")}const D=[{title:"文件名称",key:"filename",align:"center",render(v){if(!v.name){const h=async({file:M,onFinish:G,onError:d})=>{var y,x;try{v.status=!0;const R=await wt(M.file,M.name,"",O=>{v.progress=O});R&&(v.url=R,v.name=M.name,v.status=!1)}catch(R){console.error(R),(x=(y=window.$message)==null?void 0:y.error)==null||x.call(y,"文件上传出错"),v.status=!1}};async function z(M){var G;return M.file.file.size>100*1024*1024?((G=window.$message)==null||G.error("文件大小不能超过100M"),!1):!0}return l("div",{style:"display: flex; justify-content: center; align-items: center;"},[l(sl,{action:"#",showFileList:!1,customRequest:h,onBeforeUpload:z},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:v.status},{default:()=>"上传文件"})}),v.progress?l(_l,{type:"line",percentage:v.progress,indicatorPlacement:"inside",processing:!0}):null])}return l("div",{},v.name)}},{title:"文件别名",key:"filename",align:"center",render(v){return l(ie,{value:v.filename??Be(v.name)??"",onUpdateValue:h=>{v.filename=h}})}},{title:"操作",key:"actions",align:"center",width:100,render(v){return l(qe,{justify:"center"},[l(_,{type:"error",size:"small",ghost:!0,onClick:()=>{H.value=H.value.filter(h=>h!==v)}},{default:()=>"删除"})])}}],H=b([]),Ge=b(0),We=b(!1),u=async()=>{var h,z,M,G,d,y;if(H.value.length==0)return(h=window.$message)==null?void 0:h.warning("请选择文件");let v=!0;for(let x=0;x<H.value.length;x++){const R=H.value[x];if(!R.name){(z=window.$message)==null||z.warning(`第${x+1}个文件的文件名称不能为空`),v=!1;break}if(!R.filename){(M=window.$message)==null||M.warning(`第${x+1}个文件的文件别名不能为空`),v=!1;break}}if(v){We.value=!0;const x=H.value.length;for(let ae=0;ae<x;ae++){Ge.value=ae;const J=H.value[ae];J.indexText=`${ae+1}/${x}`,J.progress=0,J.status="uploading";try{J.url=await wt(J.file,J.name,"",te=>{J.progress=te}),J.progress=100,J.status="done"}catch{J.status="error"}}const R=H.value.map(ae=>({file:ae.url,filename:ae.filename,pid:Q.pid,sort:Q.fileType})),{data:O,error:Y}=await vn(R);if(Y)return(G=window.$message)==null?void 0:G.error("保存文件记录失败");oe("getData"),(d=window.$message)==null||d.destroyAll(),(y=window.$message)==null||y.success("上传成功"),m.value=!1,We.value=!1}},w=()=>{m.value=!1};function $(v){v.fileList.forEach(h=>{h.filename||(h.filename=Be(h.name))}),H.value=v.fileList}return(v,h)=>{const z=va,M=Hl,G=Gl,d=Ll,y=ba,x=il,R=gn,O=ft("no-auth");return r(),k(Oe,null,[f("div",si,[f("div",ii,[f("h2",oi,B(Q.typename),1),je((r(),A(c(_),{size:"small",ghost:"",type:"primary",onClick:ke},{icon:s(()=>[a(z,{class:"text-icon"})]),default:s(()=>[p(" 新增"+B(Q.typename),1)]),_:1})),[[O,"project:File:insert"]]),Q.fileType==4?(r(),k("span",ri,"照片数不少于6张")):L("",!0)]),Q.data.length>0?(r(),k("div",di,"共"+B(Q.data.length)+"条",1)):L("",!0)]),Q.data.length>0?(r(),A(c(tt),{key:0,columns:re,data:Q.data,size:"small","scroll-x":702,"row-key":Y=>Y.id,"max-height":de.value},null,8,["data","row-key","max-height"])):L("",!0),f("div",ui,[de.value==45&&Q.data.length>1?(r(),k("span",{key:0,onClick:Ee},[h[7]||(h[7]=p(" 更多 ")),a(M,{class:"font-size-20px"})])):L("",!0),de.value==350&&Q.data.length>1?(r(),k("span",{key:1,onClick:Ee},[h[8]||(h[8]=p(" 收起 ")),a(G,{class:"font-size-20px"})])):L("",!0)]),a(x,{show:X.value,"onUpdate:show":h[1]||(h[1]=Y=>X.value=Y),title:(me.value.id?"编辑":"新增")+Q.typename,preset:"card",class:"w-700px"},{default:s(()=>[a(y,{ref_key:"formRef",ref:K,model:me.value,rules:Fe,"label-width":"auto",style:{width:"100%"}},{default:s(()=>[a(d,{label:"文件别名",path:"fileName"},{default:s(()=>[a(c(ie),{value:me.value.fileName,"onUpdate:value":h[0]||(h[0]=Y=>me.value.fileName=Y),placeholder:"请输入"},null,8,["value"])]),_:1}),ve.value?(r(),A(c(_l),{key:0,type:"line",percentage:ve.value,color:ve.value==100?"#18a058":"#2080f0","indicator-placement":"inside",processing:""},null,8,["percentage","color"])):L("",!0),a(d,null,{default:s(()=>[a(c(qe),{justify:"center",style:{width:"100%"}},{default:s(()=>[a(c(_),{type:"primary",onClick:$e},{default:s(()=>h[9]||(h[9]=[p(B("确认"))])),_:1,__:[9]}),a(c(_),{onClick:le},{default:s(()=>h[10]||(h[10]=[p("取消")])),_:1,__:[10]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),a(x,{show:m.value,"onUpdate:show":h[3]||(h[3]=Y=>m.value=Y),title:(me.value.id?"编辑":"新增")+Q.typename,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:s(()=>[a(c(qe),{justify:"end"},{default:s(()=>[a(c(_),{size:"small",class:"mt-16px",onClick:w},{default:s(()=>[p(B(c(ee)("common.cancel")),1)]),_:1}),a(c(_),{type:"primary",size:"small",class:"mt-16px",onClick:u},{default:s(()=>[p(B(c(ee)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(c(sl),{ref:"uploadRef",action:void 0,class:"mb-10px","file-list":H.value,"onUpdate:fileList":h[2]||(h[2]=Y=>H.value=Y),onBeforeUpload:T,multiple:!0,onChange:$,"show-file-list":!1},{default:s(()=>[a(c(_),{size:"small",ghost:"",type:"primary"},{default:s(()=>h[11]||(h[11]=[p("选择文件")])),_:1,__:[11]})]),_:1},8,["file-list"]),a(c(tt),{columns:D,"paginate-single-page":!1,data:H.value,"max-height":350},null,8,["data"]),H.value[Ge.value]&&We.value?(r(),k("div",ci,[f("div",pi,[f("span",null,B(H.value[Ge.value].filename||H.value[Ge.value].name),1),f("span",null,B(H.value[Ge.value].indexText),1)]),a(c(_l),{percentage:H.value[Ge.value].progress,status:H.value[Ge.value].status==="error"?"error":"success","show-indicator":""},null,8,["percentage","status"])])):L("",!0)]),_:1},8,["show","title"]),a(x,{show:Ie.value,"onUpdate:show":h[4]||(h[4]=Y=>Ie.value=Y),title:V.value,preset:"card",style:{width:"80%"}},{default:s(()=>[Se.value==="img"?(r(),k("div",fi,[f("img",{src:ye.value,alt:"预览图片",style:{"max-width":"100%",height:"80vh"}},null,8,gi)])):L("",!0),Se.value.includes("xls")?(r(),A(c(ln),{key:1,options:{xls:!0,minColLength:0,minRowLength:0,widthOffset:20,heightOffset:5},src:ye.value,style:{height:"80vh"},onRendered:Re,onError:Ue},null,8,["src"])):L("",!0),Se.value.includes("doc")?(r(),A(c(an),{key:2,src:ye.value,style:{height:"80vh"},onRendered:Re,onError:Ue},null,8,["src"])):L("",!0),Se.value.includes("pdf")?(r(),A(c(nn),{key:3,src:ye.value,style:{height:"80vh"},onRendered:Re,onError:Ue},null,8,["src"])):L("",!0),Se.value.includes("mp4")?(r(),k("div",mi,[f("video",{src:ye.value,controls:"",style:{width:"100%",height:"80vh"}},null,8,vi)])):L("",!0)]),_:1},8,["show","title"]),a(R,{show:S.value,"onUpdate:show":h[5]||(h[5]=Y=>S.value=Y),"src-list":fe.value,current:he.value,"onUpdate:current":h[6]||(h[6]=Y=>he.value=Y)},null,8,["show","src-list","current"])],64)}}}),Bt=Cl(yi,[["__scopeId","data-v-435ee6a5"]]),hi={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},bi=Tt({__name:"contractList",props:{id:{}},setup(_e){const P=_e,Q=_a(),{columns:I,data:oe,getData:re,loading:T,mobilePagination:m,searchParams:K}=fs({showTotal:!0,apiFn:Ql,apiParams:{page:1,pageSize:20,limit:20,id:void 0,_t:new Date().getTime()},immediate:!1,columns:()=>[{key:"contractname",title:"合同名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"contractnum",title:"合同编号",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"businesscon",title:"商务负责人",align:"center",width:100,ellipsis:{tooltip:!0}},{key:"businessinfo",title:"商务联系方式",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"precautions",title:"注意事项",align:"center",width:100},{key:"username",title:"创建者",align:"center",width:100,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0}]});return Wl(async()=>{K.id=P.id,P.id&&re()}),(me,Fe)=>{const ve=qe,ke=tt,$e=Yl;return r(),k("div",hi,[a($e,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:s(()=>[a(ve,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:s(()=>Fe[0]||(Fe[0]=[f("div",null,"关联合同列表",-1)])),_:1,__:[0]})]),default:s(()=>[a(ke,{columns:c(I),data:c(oe),size:"small","flex-height":!c(Q).isMobile,"scroll-x":c(I).reduce((De,Re)=>De+(Re.width||100),0),loading:c(T),remote:"","row-key":De=>De.id,pagination:c(m),class:"h-400px"},null,8,["columns","data","flex-height","scroll-x","loading","row-key","pagination"])]),_:1})])}}}),_i=Tt({name:"businessModal",__name:"businessModal",props:xl({pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:xl(["submitted"],["update:visible"]),setup(_e,{emit:P}){const Q=P,I=Mt(),oe=_e;async function re(){me(),Ue(),Se(),Ee(),le.value=[],xe.value=!0,X.value=!0,H.value=[]}bn();const T=_n(()=>"新增待调试业务"),m=xa(_e,"visible");qt(m,()=>{m.value&&re()});const{pageData:K,getData:me,nextPage:Fe}=mt(ka),ve=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&K.data.length<K.total&&Fe()},{pageData:ke,getData:$e,nextPage:De}=mt(Ol),Re=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&ke.data.length<ke.total&&(De(),ke.data=ke.data.map(x=>({...x,value:x.docker+"&id="+x.id})))},Ue=async()=>{await $e({pid:oe.pid}),ke.data=ke.data.map(d=>({...d,value:d.docker+"&id="+d.id}))},{pageData:Ie,getData:ye,nextPage:fe}=mt(Ca),Se=async()=>{await ye({usertypes:"2,3"})},V=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&Ie.data.length<Ie.total&&fe()},{pageData:S,getData:he,nextPage:Ce}=mt(Rl),de=async d=>{const y=d.currentTarget,x=y.scrollTop;y.scrollTop+y.offsetHeight>=y.scrollHeight&&K.data.length<K.total&&(await Ce(),await gt(),setTimeout(()=>{y.scrollTop=x}))},Ee=async()=>{await he({pid:oe.pid})},X=b(!0),xe=b(!0),le=b([]),Be=[{title:"权重",key:"dtype",width:180,align:"center",render(d,y){return d.setStatus?l(Pe,{value:d.dtype,filterable:!0,placeholder:"请选择权重",options:K.data,labelField:"tname",valueField:"id",onUpdateValue(x){var R;le.value[y].dtype=Number(x)||0,le.value[y].debugname=((R=K.data.find(O=>O.id==x))==null?void 0:R.tname)||""},onScroll(x){ve(x)}}):l("div",{},d.tname)}},{title:"业务名称",key:"debugname",width:180,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.debugname,placeholder:"请输入业务名称",onUpdateValue(x){le.value[y].debugname=x}}):l("div",{},d.debugname)}},{title:"状态",key:"status",width:120,align:"center",render(d,y){return d.setStatus&&d.id?l(Pe,{value:d.status,filterable:!0,placeholder:"请选择状态",options:I.userInfo.usertype==0||I.userInfo.usertype==2?[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}],onUpdateValue(x){le.value[y].status=Number(x)||0}}):l(Xl,{type:d.status==0?"info":d.status==1||d.status==2?"warning":"success"},d.status==0?"待调试":d.status==1?"开始调试":d.status==2?"待审核":"审核完成")}},{key:"eqmname",title:"调试设备",align:"center",width:150,render(d,y){return l(Pe,{value:d.eqmid,placeholder:"请选择调试设备",options:S.data,onscroll:de,labelField:"devname",valueField:"id",clearable:!0,filterable:!0,onUpdateValue(x){le.value[y].eqmid=x}})}},{key:"docker",width:140,align:"center",title:()=>l("div",{style:"display:flex;align-items:center;justify-content:center;gap:6px;"},[l("span",null,"对接方"),l(Ml,{size:"small",checked:X.value,label:"联动",style:"margin-left: 10px;font-size: 12px;",onUpdateChecked:d=>{X.value=d}})]),render(d,y){var x;return d.setStatus?l(Pe,{value:d.docker,placeholder:"请输入或选择对接方",options:ke.data,onscroll:Re,labelField:"docker",valueField:"value",clearable:!0,filterable:!0,tag:!0,onClear(){d.dockcharge="",d.dockcontact=""},onUpdateValue(R){var O;if(X.value)le.value.forEach((Y,ae)=>{var o;Y.docker=R;const[J,te]=(o=d.docker)==null?void 0:o.split("&id="),C=ke.data.find(U=>U.docker===J&&U.id===Number(te));C?(Y.dockcharge=C.pname,Y.dockcontact=C.pcontact):(Y.dockcharge="",Y.dockcontact="")});else{le.value[y].docker=R;const[Y,ae]=(O=d.docker)==null?void 0:O.split("&id="),J=ke.data.find(te=>te.docker===Y&&te.id===Number(ae));J?(d.dockcharge=J.pname,d.dockcontact=J.pcontact):(d.dockcharge="",d.dockcontact="")}}}):l("div",{},(x=d.docker)==null?void 0:x.split("&id=")[0])}},{title:"对接方负责人",key:"dockcharge",width:100,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.dockcharge,placeholder:"请输入对接方负责人",onUpdateValue(x){le.value[y].dockcharge=x}}):l("div",{},d.dockcharge)}},{title:"联系方式",key:"dockcontact",width:120,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.dockcontact,placeholder:"请输入联系方式",onUpdateValue(x){le.value[y].dockcontact=x}}):l("div",{},d.dockcontact)}},{key:"dbcreater",width:140,align:"center",title:()=>l("div",{style:"display:flex;align-items:center;justify-content:center;gap:6px;"},[l("span",null,"调试人"),l(Ml,{size:"small",checked:xe.value,label:"联动",style:"margin-left: 10px;font-size: 12px;",onUpdateChecked:d=>{xe.value=d}})]),render(d,y){return d.setStatus?l(Pe,{value:d.dbcreater,filterable:!0,placeholder:"请选择调试人",options:Ie.data,labelField:"username",valueField:"id",onUpdateValue(x){xe.value?le.value.forEach((R,O)=>{R.dbcreater=x||0}):le.value[y].dbcreater=x||0},onScroll(x){V(x)}}):l("div",{},d.dbusername)}},{title:"文件",key:"re1",width:100,align:"center",render(d,y){return d.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>v(d,y)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const x=[{alias:d.re1,file:d.fl1},{alias:d.re2,file:d.fl2},{alias:d.re3,file:d.fl3},{alias:d.re4,file:d.fl4}].filter(R=>R.alias||R.file);return x.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件")])]),l("tbody",x.map(R=>{var O;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},R.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((O=R.file)==null?void 0:O.split("?")[1])||"-")])}))])])}})}},{title:"备注",key:"notes",width:200,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.notes,placeholder:"请输入备注",onUpdateValue(x){le.value[y].notes=x}}):l("div",{},d.notes)}},{title:"计划开始时间",key:"starttime",width:200,align:"center",render(d,y){return d.setStatus?l(kl,{type:"date",clearable:!0,value:d.starttime,valueFormat:"yyyy-MM-dd",placeholder:"请选择",onUpdateValue(x){le.value[y].starttime=x}}):l("div",it(0,d.starttime))}},{title:"计划结束时间",key:"endtime",width:200,align:"center",render:(d,y)=>d.setStatus?l(kl,{type:"date",clearable:!0,valueFormat:"yyyy-MM-dd",value:d.endtime,placeholder:"请选择",onUpdateValue(x){le.value[y].endtime=x}}):it(0,d.endtime)},{key:"operate",title:ee("common.operate"),align:"center",width:120,fixed:"right",render(d,y){return l("div",{class:"flex-center gap-8px"},[l(He,{onPositiveClick:()=>{le.value.splice(y,1),H.value.splice(y,1)}},{default:()=>ee("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>ee("common.delete")})})])}}];function D(){m.value=!1}const H=b([]),Ge=d=>{le.value=[],d.forEach(y=>{var x;le.value.push({debugname:(x=K.data.find(R=>R.id==y))==null?void 0:x.tname,docker:void 0,dockcharge:"",dockcontact:"",debugresult:0,status:0,notes:"",dbcreater:void 0,dtype:y,setStatus:!0,pid:oe.pid,starttime:null,endtime:null})})},We=b(!1);async function u(){var x,R,O,Y,ae,J,te,C;const d=["dtype","debugname","docker","dbcreater"];if(le.value.find(o=>d.some(U=>!o[U]||o[U].toString().trim()===""))){(R=(x=window.$message)==null?void 0:x.error)==null||R.call(x,"请完整填写所有必填项（权重、业务名称、对接方、调试人）");return}We.value=!0;try{const o=[];for(const W of le.value){if(!Array.isArray(W.fileList)||W.fileList.length===0)continue;const Le=W.fileList.filter(Z=>Z.file&&typeof Z.file=="object"),Ke=Le.length;for(let Z=0;Z<Ke;Z++){const ze=Le[Z];ze.indexText=`${Z+1}/${Ke}`,ze.progress=0,ze.status="uploading";try{ze.url=await wt(ze.file.file||ze.file,ze.file.name||ze.name,""),ze.progress=100,ze.status="done"}catch{ze.status="error",o.push(ze)}}W.fileList.forEach((Z,ze)=>{const Te=`re${ze+1}`,ot=`fl${ze+1}`;Z.status==="done"?(W[Te]=Z.name||"",W[ot]=Z.url||""):(W[Te]="",W[ot]="")}),delete W.fileList}if(o.length){(Y=(O=window.$message)==null?void 0:O.warning)==null||Y.call(O,`有 ${o.length} 个文件上传失败，可重新提交重试`);return}const U=le.value.map(W=>{var Le;return{...W,starttime:it(0,W.starttime),endtime:it(0,W.endtime),docker:(Le=W.docker)==null?void 0:Le.split("&id=")[0]}}),{error:E}=await La(U);E||((J=(ae=window.$message)==null?void 0:ae.success)==null||J.call(ae,"添加成功"),D(),Q("submitted"))}catch(o){console.error(o),(C=(te=window.$message)==null?void 0:te.error)==null||C.call(te,"提交失败，请稍后重试")}finally{We.value=!1}}const w=b(!1),$=b(),v=(d,y)=>{w.value=!0,$.value=y,d.fileList&&d.fileList.length>0?z.value=d.fileList:z.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]},h=[{title:"",key:"",align:"center",width:80,render(d,y){return`附件${y+1}`}},{title:"文件名称",key:"filename",align:"center",render(d){var R;const y=async({file:O,onFinish:Y,onError:ae})=>{var J,te;try{d.name=O.name,d.file=O}catch(C){console.error(C),(te=(J=window.$message)==null?void 0:J.error)==null||te.call(J,"文件上传出错")}};async function x(O){var Y;return O.file.file.size>100*1024*1024?((Y=window.$message)==null||Y.error("文件大小不能超过100M"),!1):!0}return l("div",{style:"display:flex;justify-content:center;align-items:center;"},[d.file||d.url?l("span",{},[l("span",{},((R=d.file)==null?void 0:R.name)||d.url.split("?")[1]||""),l("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{d.url="",d.file=null}},"删除")]):l(sl,{action:"#",showFileList:!1,customRequest:y,onBeforeUpload:x},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:d.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(d){return l(ie,{value:d.name,clearable:!0,onUpdateValue:y=>{d.name=y}})}}],z=b([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]),M=async()=>{var y,x;let d=!0;if(z.value.forEach((R,O)=>{var J,te;const Y=R.name||"",ae=((J=R.url)==null?void 0:J.split("?")[1])||((te=R.file)==null?void 0:te.name);(Y&&!ae||!Y&&ae)&&(d=!1)}),!d){(x=(y=window.$message)==null?void 0:y.error)==null||x.call(y,"文件名称和文件地址必须同时存在，不能只填一个");return}le.value[$.value].fileList=z.value,d&&(w.value=!1,$.value=void 0)},G=()=>{w.value=!1};return(d,y)=>{const x=Ll,R=tt,O=il,Y=ft("loading");return r(),k(Oe,null,[a(O,{show:m.value,"onUpdate:show":y[1]||(y[1]=ae=>m.value=ae),title:T.value,preset:"card",class:"w-80%","mask-closable":!1,draggable:!0},{footer:s(()=>[a(c(qe),{justify:"end",size:16},{default:s(()=>[a(c(_),{onClick:D},{default:s(()=>[p(B(c(ee)("common.cancel")),1)]),_:1}),a(c(_),{type:"primary",onClick:u},{default:s(()=>[p(B(c(ee)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(x,{label:"权重","label-placement":"left"},{default:s(()=>[a(c(Pe),{filterable:"",multiple:"",value:H.value,"onUpdate:value":[y[0]||(y[0]=ae=>H.value=ae),Ge],tag:"",style:{width:"300px"},placeholder:"请选择权重","label-field":"tname","value-field":"id",options:c(K).data,onScroll:ve},null,8,["value","options"])]),_:1}),je(a(R,{style:{width:"100%"},columns:Be,data:le.value,size:"small","row-key":ae=>ae.id,striped:"","scroll-x":Be.reduce((ae,J)=>ae+J.width,0),"max-height":350},null,8,["data","row-key","scroll-x"]),[[Y,We.value]])]),_:1},8,["show","title"]),a(O,{show:w.value,"onUpdate:show":y[2]||(y[2]=ae=>w.value=ae),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:s(()=>y[3]||(y[3]=[p(" 待调试业务文件列表 ")])),footer:s(()=>[a(c(qe),{justify:"end"},{default:s(()=>[a(c(_),{size:"small",class:"mt-16px",onClick:G},{default:s(()=>[p(B(c(ee)("common.cancel")),1)]),_:1}),a(c(_),{type:"primary",size:"small",class:"mt-16px",onClick:M},{default:s(()=>[p(B(c(ee)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(R,{columns:h,"paginate-single-page":!1,data:z.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])],64)}}}),xi=Tt({name:"deviceModal",__name:"deviceModal",props:xl({pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:xl(["submitted"],["update:visible"]),setup(_e,{emit:P}){const Q=P;Mt();const I=_e;async function oe(){m(),ye.value=[],fe.value=[]}const re=xa(_e,"visible");qt(re,()=>{re.value&&oe()});const T=b([]),m=async()=>{var $,v;const{data:u,error:w}=await Ql({page:1,limit:100,id:I.pid});if(u){if(T.value=u==null?void 0:u.list.map(h=>({value:h.id,label:h.contractname,isLeaf:!1})),T.value.length==0)return($=window.$message)==null?void 0:$.error("该项目没有绑定合同！");$e((v=u==null?void 0:u.list[0])==null?void 0:v.id)}},K=b([]),me=b(),{pageData:Fe,getData:ve,nextPage:ke}=mt(wa),$e=async u=>{await ve({pids:u}),me.value=[],K.value=Array.from(new Set([...K.value,...Fe.data])),me.value=Fe.data.map(w=>({label:w.devname,value:w.id}))},De=async u=>{var w;await $e(u.value),u.children=(w=me.value)==null?void 0:w.map($=>({label:$.label,value:$.value,isLeaf:!0})),await gt(),setTimeout(()=>{const $=document.querySelectorAll(".n-cascader-submenu-wrapper .n-scrollbar");console.log($[1]),$[1]&&($[1].removeEventListener("scroll",X),$[1].addEventListener("scroll",X))},2e3)};function Re(u,w){const $=u.filter(h=>!w.includes(h)),v=w.filter(h=>!u.includes(h));return{toDelete:$,toAdd:v}}const Ue=b([]),Ie=async u=>{const{toDelete:w,toAdd:$}=Re(Ue.value,u);w.forEach(v=>{const h=fe.value.findIndex(z=>z.cid==v);h!=-1&&fe.value.splice(h,1)}),$.forEach(async v=>{var h,z,M,G,d,y,x,R,O,Y,ae,J,te,C,o,U;fe.value.push({devname:((z=(h=K.value)==null?void 0:h.find(E=>E.id==v))==null?void 0:z.devname)||"",devmodel:((G=(M=K.value)==null?void 0:M.find(E=>E.id==v))==null?void 0:G.devmodel)||"",devnum:((y=(d=K.value)==null?void 0:d.find(E=>E.id==v))==null?void 0:y.devcount)||0,devmanu:((R=(x=K.value)==null?void 0:x.find(E=>E.id==v))==null?void 0:R.devmanu)||"",etype:((Y=(O=K.value)==null?void 0:O.find(E=>E.id==v))==null?void 0:Y.etype)||0,status:0,devunit:((J=(ae=K.value)==null?void 0:ae.find(E=>E.id==v))==null?void 0:J.devunit)||"",notes:((C=(te=K.value)==null?void 0:te.find(E=>E.id==v))==null?void 0:C.notes)||"",setStatus:!0,cid:v,pid:I.pid,devnumber:((U=(o=K.value)==null?void 0:o.find(E=>E.id==v))==null?void 0:U.devcount)||0})}),Ue.value=u},ye=b([]),fe=b([]),Se=[{title:"绑定合同设备",key:"cid",width:300,align:"center",render(u,w){var $,v;return u.setStatus?l(Jl,{style:"width: 270px",value:u.cid,filterable:!0,placeholder:"请选择合同设备",options:T.value,checkStrategy:"child",showPath:!1,remote:!0,onLoad:De,onUpdateValue(h){var M;fe.value[w].cid=Number(h)||0;const z=(M=K.value)==null?void 0:M.find(G=>G.id==h);u.devname=(z==null?void 0:z.devname)||"",u.devnum=(z==null?void 0:z.devcount)||"",u.notes=(z==null?void 0:z.notes)||"",u.devnumber=(z==null?void 0:z.devcount)||0,u.etype=(z==null?void 0:z.devtype)||0,u.devmanu=(z==null?void 0:z.devmanu)||"",u.devmodel=((z==null?void 0:z.devmodel.length)>64?z==null?void 0:z.devname:z==null?void 0:z.devmodel)||"",u.devunit=(z==null?void 0:z.devunit)||""}}):l("div",{},u.devname2||((v=($=me.value)==null?void 0:$.find(h=>h.value==u.cid))==null?void 0:v.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(u,w){return u.setStatus?l(ie,{value:u.devname,placeholder:"请输入",onUpdateValue($){fe.value[w].devname=$}}):l("div",{},u.devname)}},{title:"型号",key:"devmodel",width:220,align:"center",render(u,w){return l("div",{},u.devmodel)}},{title:"设备单位",key:"devunit",width:120,align:"center",render(u,w){return l("div",{},u.devunit)}},{title:"数量",key:"devnum",width:100,align:"center",render(u,w){return u.setStatus?l(Sa,{value:u.devnum,placeholder:"请输入",max:u.devnumber,onUpdateValue($){fe.value[w].devnum=$}}):l("div",{},u.devnum)}},{title:"是否为我司设备",key:"etype",width:260,align:"center",render(u,w){return l("div",{},u.etype==0?"是":"否")}},{title:"设备厂家",key:"devmanu",width:200,align:"center",render(u,w){return l("div",{},u.devmanu)}},{title:"清点状态",key:"status",width:120,align:"center",render(u,w){return u.setStatus&&u.id?l(Pe,{value:u.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue($){fe.value.debuggedDevieceList[w].status=Number($)||0}}):l("div",{},u.status===0?"未清点":u.status===1?"正常":u.status===2?"增补":u.status===3?"退货":"换货")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(u,w){return l("div",{},u.devmanu)}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(u,w){return u.setStatus?l(ie,{value:u.manucontact,placeholder:"请输入",onUpdateValue($){fe.value[w].manucontact=$}}):l("div",{},u.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(u,w){return u.setStatus?l(ie,{value:u.manuinfo,placeholder:"请输入",onUpdateValue($){fe.value[w].manuinfo=$}}):l("div",{},u.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(u,w){return u.setStatus&&u.id?l(Pe,{value:u.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue($){fe.value[w].devstatus=Number($)||0}}):l("div",{},u.devstatus===0?"设备无异常":u.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(u,w){return u.setStatus?l(ie,{value:u.connectionmode,placeholder:"请输入",onUpdateValue($){fe.value[w].connectionmode=$}}):l("div",{},u.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(u,w){return u.setStatus&&u.id?l(Pe,{value:u.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue($){fe.value[w].install=Number($)||0}}):l("div",{},u.install===0?"是":"否")}},{title:"备注",key:"notes",width:200,align:"center",render(u,w){return l("div",{},u.notes)}},{title:"文件",key:"re1",width:160,align:"center",render(u,w){return u.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Be(u,w)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const $=[{alias:u.re1,file:u.fl1},{alias:u.re2,file:u.fl2},{alias:u.re3,file:u.fl3},{alias:u.re4,file:u.fl4}].filter(v=>v.alias||v.file);return $.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件")])]),l("tbody",$.map(v=>{var h;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},v.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((h=v.file)==null?void 0:h.split("?")[1])||"-")])}))])])}})}},{title:"操作信息",key:"dbtime",width:180,align:"center",render(u,w){return l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},u.dbtime?it(1,u.dbtime):""),default:()=>l("div",{style:"padding: 10px;"},a("div",null,[a("div",null,[p("操作人："),u.username]),a("div",null,[p("操作时间："),u.dbtime]),a("div",null,[p("清点人："),u.dusername]),a("div",null,[p("清点时间："),u.ddbtime])]))})}},{key:"operate",title:ee("common.operate"),align:"center",width:180,fixed:"right",render(u,w){return l("div",{class:"flex-center gap-8px"},[l(He,{onPositiveClick:()=>{u.id||(fe.value.splice(w,1),ye.value.splice(w,1))}},{default:()=>ee("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>ee("common.delete")})})])}}];function V(){re.value=!1}const S=b(!1);async function he(){var $,v,h,z,M,G,d,y;const u=["cid","devname","devnum"];if(fe.value.find(x=>u.some(R=>!x[R]||x[R].toString().trim()===""))){(v=($=window.$message)==null?void 0:$.error)==null||v.call($,"请完整填写所有必填项（合同设备、设备名称、数量）");return}if(!S.value){S.value=!0;try{const x=[];for(const O of fe.value){if(!Array.isArray(O.fileList)||O.fileList.length===0)continue;const Y=O.fileList.filter(J=>J.file&&typeof J.file=="object"),ae=Y.length;for(let J=0;J<ae;J++){const te=Y[J];te.indexText=`${J+1}/${ae}`,te.progress=0,te.status="uploading";try{te.url=await wt(te.file.file||te.file,te.file.name||te.name,""),te.progress=100,te.status="done"}catch{te.status="error",x.push(te)}}O.fileList.forEach((J,te)=>{const C=`re${te+1}`,o=`fl${te+1}`;J.status==="done"?(O[C]=J.name||"",O[o]=J.url||""):(O[C]="",O[o]="")}),delete O.fileList}if(x.length){(z=(h=window.$message)==null?void 0:h.warning)==null||z.call(h,`有 ${x.length} 个文件上传失败，请重新提交`);return}const{error:R}=await $a(fe.value);R||((G=(M=window.$message)==null?void 0:M.success)==null||G.call(M,"添加成功"),V(),Q("submitted"))}catch(x){console.error(x),(y=(d=window.$message)==null?void 0:d.error)==null||y.call(d,"提交失败，请稍后再试")}finally{S.value=!1}}}const Ce=async u=>{},de=b(!1),Ee=b(!0),X=async u=>{console.log(u);const w=u.target;w.scrollHeight-w.scrollTop-w.clientHeight<10&&!de.value&&Ee.value&&(de.value=!0,ke(),me.value=Fe.data.map(v=>({label:v.devname,value:v.id})),de.value=!1)},xe=b(!1),le=b(),Be=(u,w)=>{xe.value=!0,le.value=w,u.fileList&&u.fileList.length>0?H.value=u.fileList:H.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]},D=[{title:"",key:"",align:"center",width:80,render(u,w){return`附件${w+1}`}},{title:"文件名称",key:"filename",align:"center",render(u){var v;const w=async({file:h,onFinish:z,onError:M})=>{var G,d;try{u.name=h.name,u.file=h}catch(y){console.error(y),(d=(G=window.$message)==null?void 0:G.error)==null||d.call(G,"文件上传出错")}};async function $(h){var z;return h.file.file.size>100*1024*1024?((z=window.$message)==null||z.error("文件大小不能超过100M"),!1):!0}return l("div",{style:"display:flex;justify-content:center;align-items:center;"},[u.file||u.url?l("span",{},[l("span",{},((v=u.file)==null?void 0:v.name)||u.url.split("?")[1]||""),l("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{u.url="",u.file=null}},"删除")]):l(sl,{action:"#",showFileList:!1,customRequest:w,onBeforeUpload:$},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:u.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(u){return l(ie,{value:u.name,clearable:!0,onUpdateValue:w=>{u.name=w}})}}],H=b([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]),Ge=async()=>{var w,$;let u=!0;if(H.value.forEach((v,h)=>{var G,d;const z=v.name||"",M=((G=v.url)==null?void 0:G.split("?")[1])||((d=v.file)==null?void 0:d.name);(z&&!M||!z&&M)&&(u=!1)}),!u){($=(w=window.$message)==null?void 0:w.error)==null||$.call(w,"文件名称和文件地址必须同时存在，不能只填一个");return}fe.value[le.value].fileList=H.value,u&&(xe.value=!1,le.value=void 0)},We=()=>{xe.value=!1};return(u,w)=>{const $=Ll,v=tt,h=il,z=ft("loading");return r(),k(Oe,null,[a(h,{show:re.value,"onUpdate:show":w[1]||(w[1]=M=>re.value=M),title:"新增待调试设备",preset:"card",class:"w-80%","mask-closable":!1,draggable:!0},{footer:s(()=>[a(c(qe),{justify:"end",size:16},{default:s(()=>[a(c(_),{onClick:V},{default:s(()=>[p(B(c(ee)("common.cancel")),1)]),_:1}),a(c(_),{type:"primary",onClick:he},{default:s(()=>[p(B(c(ee)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a($,{label:"合同设备","label-placement":"left"},{default:s(()=>[a(c(Jl),{value:ye.value,"onUpdate:value":[w[0]||(w[0]=M=>ye.value=M),Ie],placeholder:"请选择合同设备",options:T.value,"check-strategy":"child","show-path":!1,labelKey:"label",remote:"",multiple:"",style:{width:"300px"},"on-load":De,"onUpdate:show":Ce},null,8,["value","options"])]),_:1}),je(a(v,{style:{width:"100%"},columns:Se,data:fe.value,size:"small","row-key":M=>M.id,striped:"","scroll-x":Se.reduce((M,G)=>M+G.width,0),"max-height":350},null,8,["data","row-key","scroll-x"]),[[z,S.value]])]),_:1},8,["show"]),a(h,{show:xe.value,"onUpdate:show":w[2]||(w[2]=M=>xe.value=M),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:s(()=>w[3]||(w[3]=[p(" 待调试设备文件列表 ")])),footer:s(()=>[a(c(qe),{justify:"end"},{default:s(()=>[a(c(_),{size:"small",class:"mt-16px",onClick:We},{default:s(()=>[p(B(c(ee)("common.cancel")),1)]),_:1}),a(c(_),{type:"primary",size:"small",class:"mt-16px",onClick:Ge},{default:s(()=>[p(B(c(ee)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(v,{columns:D,"paginate-single-page":!1,data:H.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])],64)}}}),ki={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ci(_e,P){return r(),k("svg",ki,P[0]||(P[0]=[f("path",{fill:"currentColor",d:"M11 13H5v-2h6V5h2v6h6v2h-6v6h-2z"},null,-1)]))}const Li=kt({name:"material-symbols-add",render:Ci}),Si={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function wi(_e,P){return r(),k("svg",Si,P[0]||(P[0]=[f("path",{fill:"currentColor",d:"M10.825 22q-.675 0-1.162-.45t-.588-1.1L8.85 18.8q-.325-.125-.612-.3t-.563-.375l-1.55.65q-.625.275-1.25.05t-.975-.8l-1.175-2.05q-.35-.575-.2-1.225t.675-1.075l1.325-1Q4.5 12.5 4.5 12.337v-.675q0-.162.025-.337l-1.325-1Q2.675 9.9 2.525 9.25t.2-1.225L3.9 5.975q.35-.575.975-.8t1.25.05l1.55.65q.275-.2.575-.375t.6-.3l.225-1.65q.1-.65.588-1.1T10.825 2h2.35q.675 0 1.163.45t.587 1.1l.225 1.65q.325.125.613.3t.562.375l1.55-.65q.625-.275 1.25-.05t.975.8l1.175 2.05q.35.575.2 1.225t-.675 1.075l-1.325 1q.025.175.025.338v.674q0 .163-.05.338l1.325 1q.525.425.675 1.075t-.2 1.225l-1.2 2.05q-.35.575-.975.8t-1.25-.05l-1.5-.65q-.275.2-.575.375t-.6.3l-.225 1.65q-.1.65-.587 1.1t-1.163.45zm1.225-6.5q1.45 0 2.475-1.025T15.55 12t-1.025-2.475T12.05 8.5q-1.475 0-2.488 1.025T8.55 12t1.013 2.475T12.05 15.5"},null,-1)]))}const $i=kt({name:"material-symbols-settings-rounded",render:wi}),Di={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function zi(_e,P){return r(),k("svg",Di,P[0]||(P[0]=[f("path",{fill:"currentColor",d:"m10.6 16.6l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const ji=kt({name:"material-symbols-check-circle-outline",render:zi}),Ui={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Bi(_e,P){return r(),k("svg",Ui,P[0]||(P[0]=[f("path",{fill:"currentColor",d:"M8 16h2V8H8zm4 0l6-4l-6-4zm0 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const Fi=kt({name:"material-symbols-not-started-outline",render:Bi}),Ii={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ti(_e,P){return r(),k("svg",Ii,P[0]||(P[0]=[f("path",{fill:"currentColor",d:"M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.2 0 .375.038t.35.112L17.875 5H5v14h14v-6.65l2-2V19q0 .825-.587 1.413T19 21zm6.525-4l-5.65-5.65l1.4-1.4l4.25 4.25L20.7 5.025L22.125 6.4z"},null,-1)]))}const Ni=kt({name:"material-symbols-select-check-box",render:Ti}),Pi={class:"w-500px whitespace-normal"},Ei={style:{display:"flex",alignItems:"center",justifyContent:"space-between",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Ai={key:1,style:{display:"none"}},Vi={key:1,style:{display:"none"}},qi={key:1,style:{display:"none"}},Mi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Oi={style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Ri={class:"flex items-center"},Ji={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Hi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Gi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Wi={style:{display:"flex","align-items":"center",width:"100%",gap:"8px"}},Ki={style:{"font-weight":"500",color:"#333","margin-bottom":"4px"}},Yi={style:{"font-size":"13px",color:"#666"}},Qi={class:"flex items-center",style:{position:"absolute",top:"50%",transform:"translateY(-50%)"}},Xi={style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Zi={class:"flex-col w-100%"},eo={class:"w-100px"},to=2,lo=Tt({__name:"prjDetail",props:{prjDetailInfo:{},pid:{},userList:{}},emits:["searchDetail"],setup(_e,{emit:P}){const Q=Mt(),I=_e,oe=P,re=b(!1),T=st({}),m=async(C,o)=>{var W;const{data:U,error:E}=await ra([{id:C.id,status:o}]);E||((W=window.$message)==null||W.success("操作成功"),oe("searchDetail"))},K=b([]),me=async()=>{const{data:C,error:o}=await Sn();C&&(K.value=C)},Fe=C=>{$e(C),T.region=void 0,T.prosite="",T.proaddr="",de.value=""},ve=C=>{var U;const o=(U=ke.value.find(E=>E.id===C))==null?void 0:U.name;Ge(o)},ke=b([]),$e=async C=>{var E;if(!C)return(E=window.$message)==null?void 0:E.warning("请先选择省份");const{data:o,error:U}=await kn({province:C});o&&(ke.value=o)};qt(()=>I.prjDetailInfo,async C=>{Object.assign(T,C),console.log(T)},{immediate:!0,deep:!0});const De=b(!1),Re=b();let Ue=null,Ie=null,ye=null,fe=null,Se=null,V=null;const S=st({longitude:0,latitude:0});let he;const Ce=b(!1),de=b(""),Ee=b([]);let X=0;async function xe(){try{if(window._AMapSecurityConfig={securityJsCode:Q.userInfo.sdksecret},!Re.value)return;V=await ys.load({key:Q.userInfo.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),Ue=new V.Map(Re.value,{zoom:18,center:[D.value>0?$.value[D.value-1].longitude:T.longitude,D.value>0?$.value[D.value-1].latitude:T.latitude],viewMode:"3D",resizeEnable:!0}),Ie=new V.Geocoder,fe=new V.PlaceSearch({city:"全国",pageSize:50}),Se=new V.AutoComplete({city:"全国"}),We(V,{lng:D.value>0?$.value[D.value-1].longitude:T.longitude,lat:D.value>0?$.value[D.value-1].latitude:T.latitude}),Ue.on("click",C=>{const{lng:o,lat:U}=C.lnglat;he=2,S.latitude=U,S.longitude=o,We(V,{lng:o,lat:U})}),X=0,gt(()=>{window.dispatchEvent(new Event("resize"))})}catch(C){console.error("地图加载失败：",C),X<to?(X++,console.warn(`地图加载失败，正在第 ${X} 次重试...`),setTimeout(()=>{xe()},1500)):console.error("地图加载失败，已达到最大重试次数，停止重试")}}const le=Kl.debounce(async C=>{if(!C.trim()){Ee.value=[];return}Se.search(C,(o,U)=>{var E;console.log(U,"result"),o=="complete"&&U.info=="OK"&&((E=U==null?void 0:U.tips)!=null&&E.length)?Ee.value=U.tips.map(W=>({label:`${W.name}（${W.district||W.address||"无详细地址"}）`,value:`${W.location.lng}_${W.location.lat}`,raw:W})):Ee.value=[]})},300);qt(de,C=>{le(C)});function Be(C,o){if(console.log(C,o,"option"),!C)return;const[U,E]=C.split("_").map(Number);!U||!E||(Ue.setCenter([U,E]),he=1,We(V,{lng:U,lat:E}),S.longitude=U,S.latitude=E)}const D=b(0);async function H(C){C?D.value=C:D.value=0,await me(),De.value=!0,Ce.value=!1,he=void 0,T.proaddr=I.prjDetailInfo.proaddr,T.prosite=I.prjDetailInfo.prosite,T.provice=I.prjDetailInfo.provice,T.region=I.prjDetailInfo.region,T.provice&&$e(T.provice),gt(async()=>{await xe(),setTimeout(()=>{Ce.value=!0;const o=document.querySelector(".n-auto-complete input");o==null||o.blur()},500)})}function Ge(C){!C||!Ie||!Ue||Ie.getLocation(C,(o,U)=>{var E;if(o==="complete"&&((E=U.geocodes)!=null&&E.length)){const{location:W,formattedAddress:Le}=U.geocodes[0],Ke=W.lng,Z=W.lat;Ue.setZoomAndCenter(14,[Ke,Z]),S.longitude=Ke,S.latitude=Z,We(V,{lng:Ke,lat:Z}),T.proaddr=Le,T.prosite=Le,de.value=Le}})}function We(C,o){ye&&Ue.remove(ye),ye=new C.Marker({position:[o.lng,o.lat],map:Ue}),Ue.add(ye),Ie.getAddress(o,async(U,E)=>{U==="complete"&&E.regeocode&&(console.log("result",E),console.log("formattedAddress",E.regeocode.formattedAddress),o.latitude=o.lat,o.longitude=o.lng,he==1?(T.proaddr=E.regeocode.formattedAddress,T.provice=y(T.proaddr,K.value),await $e(T.provice),T.region=x(T.proaddr,ke.value)):he==2?(de.value=E.regeocode.formattedAddress,T.proaddr=E.regeocode.formattedAddress,T.provice=y(T.proaddr,K.value),await $e(T.provice),T.region=x(T.proaddr,ke.value)):de.value=D.value>0?$.value[D.value-1].addr||E.regeocode.formattedAddress:T.prosite||E.regeocode.formattedAddress)})}function u(){De.value=!1}const w=async()=>{var C,o,U,E;if(D.value==0){T.latitude=S.latitude,T.longitude=S.longitude,T.prosite=de.value,De.value=!1;const{data:W,error:Le}=await ra([{prosite:T.prosite,latitude:T.latitude,longitude:T.longitude,proaddr:T.proaddr,provice:T.provice,region:T.region,id:T.id}]);W&&((C=window.$message)==null||C.success("修改位置成功"),oe("searchDetail"))}else{$.value[D.value-1].addr=de.value,$.value[D.value-1].latitude=S.latitude,$.value[D.value-1].longitude=S.longitude;let W=$.value[D.value-1];if($.value[D.value-1].id){const{data:Le,error:Ke}=await wn([W]);Le&&((o=window.$message)==null||o.success("修改位置成功"),De.value=!1,D.value=0,M())}else{W.pid=(U=I.prjDetailInfo)==null?void 0:U.id;const{data:Le,error:Ke}=await $n([W]);Le&&((E=window.$message)==null||E.success("添加位置成功"),De.value=!1,D.value=0,M())}}},$=b([{latitude:30.303899,longitude:120.373885,addr:""}]),v=b([]),h=b(!1),z=()=>{h.value=!0,M()},M=async()=>{var U,E;if(!((U=I.prjDetailInfo)!=null&&U.id))return;const{data:C,error:o}=await Cn({pid:(E=I.prjDetailInfo)==null?void 0:E.id,page:1,limit:100});C&&(C.list.length>0?($.value=C.list,v.value=JSON.parse(JSON.stringify(C.list))):$.value=[{longitude:120.373885,latitude:30.303899,addr:""}])},G=()=>{h.value=!1},d=async C=>{var o;if(C.id){const{data:U,error:E}=await Dn(C.id);U&&((o=window.$message)==null||o.success("删除成功"),M())}else $.value.splice($.value.indexOf(C),1)};function y(C,o){let U=null;for(const E of o)if(C.includes(E.name)){U=E.id;break}return U}function x(C,o){let U=null;for(const E of o)if(C.includes(E.name)){U=E.id;break}return U}const R=b([]),O=b([]),Y=b([]),ae=async()=>{const{data:C,error:o}=await Un({pid:I.pid,page:1,limit:100});C&&(R.value=C.list,O.value=C.list.map(U=>U.participant),Y.value=JSON.parse(JSON.stringify(C.list.map(U=>U.participant))))};qt(()=>I.pid,async()=>{I.pid});const J=b(!1),te=async()=>{var W,Le,Ke;const C=O.value||[],o=Y.value||[],U=C.filter(Z=>!o.includes(Z)),E=o.filter(Z=>!C.includes(Z));if(U.length===0&&E.length===0){(W=window.$message)==null||W.info("未做任何修改"),J.value=!1;return}try{if(U.length>0){const{data:Z,error:ze}=await zn(U.map(Te=>({pid:I.pid,participant:Te})));if(ze)return}if(E.length>0){const Z=R.value.filter(ot=>E.includes(ot.participant)).map(ot=>ot.id).join(","),{data:ze,error:Te}=await jn(Z);if(Te)return}(Le=window.$message)==null||Le.success("设置成功"),J.value=!1,await ae()}catch(Z){console.error(Z),(Ke=window.$message)==null||Ke.error("设置失败，请重试")}};return(C,o)=>{const U=bs,E=Ni,W=_,Le=He,Ke=Fi,Z=ji,ze=_l,Te=Xl,ot=$i,Ot=hs,Sl=Hl,wl=Gl,Nt=Pe,Rt=Ll,Pt=qe,Ae=ms,Jt=ie,rt=il,$l=Li,Dl=vs,zl=Ln,jl=gs,Ul=Ml,Ve=_s,ol=ja,ht=xn,rl=ft("no-auth");return r(),k(Oe,null,[a(Ot,{bordered:"","label-placement":"left","label-align":"center",columns:4,"label-style":{width:"130px"}},{default:s(()=>[a(U,null,{label:s(()=>o[20]||(o[20]=[p(" 项目名称 ")])),default:s(()=>{var N;return[f("div",Pi,B((N=I.prjDetailInfo)==null?void 0:N.proname),1)]}),_:1}),a(U,{"content-style":{position:"relative",width:"220px"}},{label:s(()=>o[21]||(o[21]=[p(" 项目状态 ")])),default:s(()=>{var N,Me,Je,g,Ht,Ze,Et,bt,dl,ul,$t;return[f("div",Ei,[((N=I.prjDetailInfo)==null?void 0:N.status)!==void 0?(r(),k("div",{key:0,style:St({display:"flex",alignItems:"center",justifyContent:"center",marginRight:"20px",color:((Me=I.prjDetailInfo)==null?void 0:Me.status)==-1?"#a43cf9":((Je=I.prjDetailInfo)==null?void 0:Je.status)===0?"#9ca3af":((g=I.prjDetailInfo)==null?void 0:g.status)===1?"#3498db":((Ht=I.prjDetailInfo)==null?void 0:Ht.status)===2?"#facc15":"#22c55e",borderRadius:"50%"})},[f("span",{style:St({width:"10px",height:"10px",marginRight:"5px",backgroundColor:((Ze=I.prjDetailInfo)==null?void 0:Ze.status)==-1?"#a43cf9":((Et=I.prjDetailInfo)==null?void 0:Et.status)===0?"#9ca3af":((bt=I.prjDetailInfo)==null?void 0:bt.status)===1?"#3498db":((dl=I.prjDetailInfo)==null?void 0:dl.status)===2?"#facc15":"#22c55e",borderRadius:"50%"})},null,4),f("span",null,B(c(ga)[(ul=I.prjDetailInfo)==null?void 0:ul.status]?C.$t(c(ga)[($t=I.prjDetailInfo)==null?void 0:$t.status]):""),1)],4)):L("",!0),a(Le,{onPositiveClick:o[0]||(o[0]=lt=>m(I.prjDetailInfo,0))},{trigger:s(()=>{var lt;return[(c(Q).userInfo.usertype==0||c(Q).userInfo.usertype==4||c(Q).userInfo.id==1021||c(Q).userInfo.id==1023)&&((lt=I.prjDetailInfo)==null?void 0:lt.status)==-1?(r(),A(W,{key:0,size:"small",ghost:"",color:"#a43cf9"},{icon:s(()=>[a(E,{class:"text-icon"})]),default:s(()=>[o[22]||(o[22]=p(" 核准 "))]),_:1,__:[22]})):(r(),k("span",Ai))]}),default:s(()=>[o[23]||(o[23]=p(" 确定核准该项目吗？ "))]),_:1,__:[23]}),a(Le,{onPositiveClick:o[1]||(o[1]=lt=>m(I.prjDetailInfo,1))},{trigger:s(()=>{var lt;return[(c(Q).userInfo.usertype==0||c(Q).userInfo.usertype==2)&&((lt=I.prjDetailInfo)==null?void 0:lt.status)==0?je((r(),A(W,{key:0,size:"small",ghost:"",type:"success"},{icon:s(()=>[a(Ke,{class:"text-icon"})]),default:s(()=>[o[24]||(o[24]=p(" 启动 "))]),_:1,__:[24]})),[[rl,"project:Info:update"]]):(r(),k("span",Vi))]}),default:s(()=>[o[25]||(o[25]=p(" 确定启动该项目吗？ "))]),_:1,__:[25]}),a(Le,{onPositiveClick:o[2]||(o[2]=lt=>m(I.prjDetailInfo,3))},{trigger:s(()=>{var lt;return[(c(Q).userInfo.usertype==0||c(Q).userInfo.usertype==2)&&((lt=I.prjDetailInfo)==null?void 0:lt.status)==2?je((r(),A(W,{key:0,size:"small",ghost:"",type:"warning"},{icon:s(()=>[a(Z,{class:"text-icon"})]),default:s(()=>[o[26]||(o[26]=p(" "+B("审核")))]),_:1,__:[26]})),[[rl,"project:Info:update"]]):(r(),k("span",qi))]}),default:s(()=>[o[27]||(o[27]=p(" 是否确认执行审核操作？ "))]),_:1,__:[27]})])]}),_:1}),a(U,{"content-style":{position:"relative",width:"200px"}},{label:s(()=>o[28]||(o[28]=[p(" 项目进度 ")])),default:s(()=>{var N;return[f("div",Mi,[a(ze,{type:"line",percentage:(N=I.prjDetailInfo)==null?void 0:N.progess,"indicator-placement":"inside","show-indicator":"",processing:"",style:{width:"140px"},color:"#1890ff"},null,8,["percentage"])])]}),_:1}),a(U,{"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[29]||(o[29]=[p(" 调试类型 ")])),default:s(()=>[f("div",Oi,[a(Te,{size:"small",type:"info"},{default:s(()=>{var N,Me;return[p(B(c(ma)[(N=I.prjDetailInfo)==null?void 0:N.dtype]?C.$t(c(ma)[(Me=I.prjDetailInfo)==null?void 0:Me.dtype]):""),1)]}),_:1})])]),_:1}),re.value?(r(),A(U,{key:0},{label:s(()=>o[30]||(o[30]=[p(" 预计完成日期 ")])),default:s(()=>{var N;return[f("div",Ri,B((N=I.prjDetailInfo)==null?void 0:N.cpdbtime),1)]}),_:1})):L("",!0),re.value?(r(),A(U,{key:1,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[31]||(o[31]=[p(" 进度状态 ")])),default:s(()=>[f("div",Ji,[a(Te,{size:"small",type:I.prjDetailInfo.ptype==0?"success":"warning"},{default:s(()=>[p(B(I.prjDetailInfo.ptype==0?"正常":"已延期"),1)]),_:1},8,["type"])])]),_:1})):L("",!0),re.value?(r(),A(U,{key:2,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[32]||(o[32]=[p(" 周期 ")])),default:s(()=>{var N,Me;return[f("div",Hi,[f("span",null,B((N=I.prjDetailInfo)!=null&&N.period?((Me=I.prjDetailInfo)==null?void 0:Me.period)+"天":""),1)])]}),_:1})):L("",!0),re.value?(r(),A(U,{key:3,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[33]||(o[33]=[p(" 调度名称 ")])),default:s(()=>{var N;return[f("div",Gi,[f("span",null,B((N=I.prjDetailInfo)==null?void 0:N.dispatch),1)])]}),_:1})):L("",!0),re.value?(r(),A(U,{key:4,span:3},{label:s(()=>o[34]||(o[34]=[p(" 项目默认地址 ")])),default:s(()=>{var N,Me;return[f("div",Wi,[f("div",null,[f("div",Ki,B(((N=I.prjDetailInfo)==null?void 0:N.prosite)||"—"),1),f("div",Yi,[o[35]||(o[35]=f("b",{style:{color:"#888"}},"详细地址：",-1)),p(B(((Me=I.prjDetailInfo)==null?void 0:Me.proaddr)||"暂无"),1)])]),a(ot,{class:"font-size-20px cursor-pointer",style:{color:"#1890ff","flex-shrink":"0","margin-top":"2px",transition:"transform 0.2s ease"},onClick:o[3]||(o[3]=Je=>H()),onMouseenter:o[4]||(o[4]=Je=>Je.target.style.transform="rotate(90deg)"),onMouseleave:o[5]||(o[5]=Je=>Je.target.style.transform="rotate(0deg)")}),f("div",{class:"cursor-pointer c-#1890ff ml-50px flex items-center",onClick:z},[o[36]||(o[36]=p(" 其他地址 ")),a(ot,{class:"font-size-20px",style:{color:"#1890ff","flex-shrink":"0",transition:"transform 0.2s ease"},onMouseenter:o[6]||(o[6]=Je=>Je.target.style.transform="rotate(90deg)"),onMouseleave:o[7]||(o[7]=Je=>Je.target.style.transform="rotate(0deg)")})])])]}),_:1})):L("",!0),re.value?(r(),A(U,{key:5,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[37]||(o[37]=[p(" 开始时间 ")])),default:s(()=>{var N;return[f("div",Qi,[f("span",null,B((N=I.prjDetailInfo)==null?void 0:N.sdbtime),1)])]}),_:1})):L("",!0),re.value?(r(),A(U,{key:6},{label:s(()=>o[38]||(o[38]=[p(" 计划调试时间 ")])),default:s(()=>{var N;return[p(" "+B((N=I.prjDetailInfo)==null?void 0:N.plantime),1)]}),_:1})):L("",!0),re.value?(r(),A(U,{key:7},{label:s(()=>o[39]||(o[39]=[p(" 验收人 ")])),default:s(()=>{var N;return[p(" "+B((N=I.prjDetailInfo)==null?void 0:N.ckusername),1)]}),_:1})):L("",!0),re.value?(r(),A(U,{key:8},{label:s(()=>o[40]||(o[40]=[p(" 验收时间 ")])),default:s(()=>{var N;return[p(" "+B((N=I.prjDetailInfo)==null?void 0:N.ckdbtime),1)]}),_:1})):L("",!0),re.value?(r(),A(U,{key:9},{label:s(()=>o[41]||(o[41]=[p(" 商务联系人 ")])),default:s(()=>{var N;return[p(" "+B((N=I.prjDetailInfo)==null?void 0:N.businesscon),1)]}),_:1})):L("",!0)]),_:1}),f("div",{style:St([{background:"#409eff",position:"absolute",width:"5px",top:"-20px",left:"38px"},{height:re.value?"115%":"145%"}])},null,4),f("div",Xi,[re.value?(r(),k("span",{key:1,onClick:o[9]||(o[9]=N=>re.value=!1)},[o[43]||(o[43]=p(" 收起 ")),a(wl,{class:"font-size-20px"})])):(r(),k("span",{key:0,onClick:o[8]||(o[8]=N=>re.value=!0)},[o[42]||(o[42]=p(" 更多 ")),a(Sl,{class:"font-size-20px"})]))]),a(rt,{show:De.value,"onUpdate:show":o[14]||(o[14]=N=>De.value=N),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:s(()=>[a(Pt,{justify:"end",size:16},{default:s(()=>[a(W,{onClick:u},{default:s(()=>[p(B(C.$t("common.cancel")),1)]),_:1}),[0,2,4].includes(c(Q).userInfo.usertype)?(r(),A(W,{key:0,type:"primary",onClick:w},{default:s(()=>[p(B(C.$t("common.confirm")),1)]),_:1})):L("",!0)]),_:1})]),default:s(()=>[a(Pt,null,{default:s(()=>[a(Rt,{label:"省份",path:"provice","label-placement":"left","label-width":"70"},{default:s(()=>[a(Nt,{filterable:"",value:T.provice,"onUpdate:value":[o[10]||(o[10]=N=>T.provice=N),Fe],placeholder:"请选择省份","label-field":"name","value-field":"id",options:K.value},null,8,["value","options"])]),_:1}),a(Rt,{label:"地区",path:"region","label-placement":"left","label-width":"70"},{default:s(()=>[a(Nt,{filterable:"",value:T.region,"onUpdate:value":[o[11]||(o[11]=N=>T.region=N),ve],placeholder:"请选择地区","label-field":"name","value-field":"id",options:ke.value},null,8,["value","options"])]),_:1})]),_:1}),Ce.value?(r(),A(Rt,{key:0,label:D.value==0?"项目地址":"项目地址"+D.value,"label-placement":"left"},{default:s(()=>[f("div",Zi,[a(Ae,{value:de.value,"onUpdate:value":[o[12]||(o[12]=N=>de.value=N),c(le)],options:Ee.value,style:{"margin-bottom":"7px"},placeholder:"请输入地点关键字",clearable:"",onSelect:Be},null,8,["value","options","onUpdate:value"]),D.value==0?(r(),A(Jt,{key:0,type:"textarea",rows:2,clearable:"",value:T.proaddr,"onUpdate:value":o[13]||(o[13]=N=>T.proaddr=N),placeholder:"请输入详细地址"},null,8,["value"])):L("",!0)])]),_:1},8,["label"])):L("",!0),f("div",{ref_key:"domRef",ref:Re,class:"h-full w-full",style:{width:"100%",height:"500px","margin-bottom":"10px"}},null,512)]),_:1},8,["show"]),a(rt,{show:h.value,"onUpdate:show":o[16]||(o[16]=N=>h.value=N),title:"其他地址",preset:"card",class:"w-800px"},{footer:s(()=>[a(Pt,{justify:"end",size:16},{default:s(()=>[a(W,{type:"primary",ghost:"",onClick:G},{default:s(()=>o[46]||(o[46]=[p("关闭")])),_:1,__:[46]})]),_:1})]),default:s(()=>[[0,2,4].includes(c(Q).userInfo.usertype)?(r(),A(W,{key:0,type:"primary",size:"small",ghost:"",onClick:o[15]||(o[15]=N=>$.value.push({latitude:30.303899,longitude:120.373885,addr:""}))},{icon:s(()=>[a($l,{class:"text-icon"})]),default:s(()=>[o[44]||(o[44]=p(" "+B("添加地址")))]),_:1,__:[44]})):L("",!0),(r(!0),k(Oe,null,It($.value,(N,Me)=>(r(),k("div",{class:"flex items-center mt-10px",key:N.latitude},[f("span",eo,"项目地址"+B(Me+1),1),a(zl,{onClick:Je=>H(Me+1)},{default:s(()=>[a(Jt,{readonly:"",value:N.addr,"onUpdate:value":Je=>N.addr=Je,placeholder:"请选择项目地点"+(Me+1)},null,8,["value","onUpdate:value","placeholder"]),a(W,null,{icon:s(()=>[a(Dl,{class:"text-icon"})]),_:1})]),_:2},1032,["onClick"]),a(Le,{onPositiveClick:Je=>d(N)},{trigger:s(()=>[[0,2,4].includes(c(Q).userInfo.usertype)?(r(),A(W,{key:0,size:"small",ghost:"",type:"error",class:"ml-10px"},{icon:s(()=>[a(jl,{class:"text-icon"})]),default:s(()=>[o[45]||(o[45]=p(" "+B("删除")))]),_:1,__:[45]})):L("",!0)]),default:s(()=>[p(" 确定要删除项目地址"+B(Me+1)+"吗？ ",1)]),_:2},1032,["onPositiveClick"])]))),128))]),_:1},8,["show"]),a(rt,{show:J.value,"onUpdate:show":o[19]||(o[19]=N=>J.value=N),title:"项目参与人设置",preset:"card",class:"w-700px"},{footer:s(()=>[a(Pt,{justify:"end",size:16},{default:s(()=>[a(W,{onClick:o[18]||(o[18]=N=>{J.value=!1})},{default:s(()=>[p(B(C.$t("common.cancel")),1)]),_:1}),[0,2,4].includes(c(Q).userInfo.usertype)?(r(),A(W,{key:0,type:"primary",onClick:te},{default:s(()=>[p(B(C.$t("common.confirm")),1)]),_:1})):L("",!0)]),_:1})]),default:s(()=>[a(ht,{value:O.value,"onUpdate:value":o[17]||(o[17]=N=>O.value=N)},{default:s(()=>[a(ol,{"y-gap":8,cols:5},{default:s(()=>[(r(!0),k(Oe,null,It(I.userList,N=>(r(),A(Ve,{key:N.id},{default:s(()=>[a(Ul,{size:"large",value:N.id,label:N.username},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["show"])],64)}}}),ao=Cl(lo,[["__scopeId","data-v-0414a0f0"]]),no={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},so={class:"timeline-wrapper"},io={class:"timeline-layout"},oo={class:"timeline"},ro=["id"],uo={class:"timeline-icon"},co=["onClick"],po={class:"flex justify-between"},fo=["onClick"],go={style:{"font-weight":"500",color:"#1890ff","margin-right":"15px"}},mo={key:0},vo={class:"w-200px inline-block"},yo=["onClick"],ho={key:1},bo={class:"w-200px inline-block"},_o=["onClick"],xo={key:2},ko={class:"w-200px inline-block"},Co=["onClick"],Lo={key:3},So={class:"w-200px inline-block"},wo=["onClick"],$o={key:1},Do={class:"timeline-rows"},zo={key:0,class:"timeline-content",style:{"padding-left":"80px",position:"relative"}},jo={class:"timeline-icon"},Uo=["onClick"],Bo=["onClick"],Fo=["id"],Io={style:{display:"flex","align-items":"center",gap:"10px"}},To={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},No={style:{display:"flex","align-items":"center",gap:"10px"}},Po={class:"pos-absolute left-140px flex gap-x-10px"},Eo={key:0},Ao={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Vo={key:0,style:{height:"20px"}},qo={style:{display:"flex","align-items":"center",gap:"10px"}},Mo={key:0},Oo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Ro={style:{display:"flex","align-items":"center",gap:"10px"}},Jo={key:0},Ho={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Go={style:{display:"flex","align-items":"center",gap:"10px"}},Wo={key:0},Ko={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Yo={key:0,style:{height:"20px"}},Qo={key:0,style:{height:"20px"}},Xo={key:0,class:"flex items-center justify-between"},Zo={key:0},er={class:"flex items-center justify-between"},tr={key:0},lr={class:"flex items-center justify-end"};function bl(_e){return typeof _e=="function"||Object.prototype.toString.call(_e)==="[object Object]"&&!is(_e)}const ar=Tt({name:"projectmanagement_orderdetail",__name:"index",setup(_e){const P=Mt(),Q=_a(),I=b(""),oe=Bn(),re=Fn(),T=st({debuggedBusinessList:[],developBusinessList:[],needsList:[]}),m=st({pid:void 0});let K=st([{id:"phase1",title:"基本信息",show:!0,tables:[]},{id:"phase2",title:"实施信息",show:!0,tables:[]},{id:"phase3",title:"验收信息",show:!0,tables:[]},{id:"phase4",title:"项目总结",show:P.userInfo.usertype!=1,tables:[1]},{id:"phase5",title:"项目日报",show:P.userInfo.usertype!=1,tables:[1]}]);const me=async e=>{if(!e)return;g.value.projectDetail={};const{data:t}=await ts(e);Object.assign(g.value.projectDetail,t),await gt()},Fe=()=>{ve.pageSize==1?ve.pageSize=20:ve.pageSize=1,$e(m.pid)},ve=st({page:1,pageSize:1,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${ve.itemCount} 条`,onChange:e=>{ve.page=e,$e(m.pid)},onUpdatePageSize:e=>{ve.pageSize=e,ve.page=1,$e(m.pid)}}),ke=[{title:"对接方",key:"docker",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.docker,placeholder:"请输入",onUpdateValue(n){g.value.contactList[t].docker=n}}):l("div",{},e.docker)}},{title:"姓名",key:"pname",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.pname,placeholder:"请输入",onUpdateValue(n){g.value.contactList[t].pname=n}}):l("div",{},e.pname)}},{title:"联系方式",key:"pcontact",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.pcontact,placeholder:"请输入",onUpdateValue(n){g.value.contactList[t].pcontact=n}}):l("div",{},e.pcontact)}},{title:"备注",key:"proposition",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.proposition,placeholder:"请输入",onUpdateValue(n){g.value.contactList[t].proposition=n}}):l("div",{},e.proposition)}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?it(1,e.dbtime):""},{key:"operate",title:ee("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[Ye("project:Contact:insert")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ue(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>Re(e,t)},{default:()=>"取消"}),Ye("project:Contact:delete")&&l(He,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:j}=await In(e.id);i&&(g.value.contactList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),$e(m.pid),Qe())}else g.value.contactList.splice(t,1)}},{default:()=>ee("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>ee("common.delete")})})]:Ye("project:Contact:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>De(e)},{default:()=>"编辑"})])}}],$e=async e=>{if(!e)return;const{data:t}=await Ol({page:ve.page,limit:ve.pageSize,pid:e});g.value.contactList=t==null?void 0:t.list,ve.itemCount=t==null?void 0:t.total,g.value.contactList.forEach(n=>{n.setStatus=!1}),T.contactList=JSON.parse(JSON.stringify(g.value.contactList))},De=e=>{g.value.contactList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},Re=(e,t)=>{e.setStatus=!e.setStatus,e.id?g.value.contactList=JSON.parse(JSON.stringify(T.contactList)):g.value.contactList.splice(t,1)},Ue=async e=>{var t,n,i,j,F;if(!e.docker){(t=window.$message)==null||t.warning("请输入对接方");return}if(!e.pname){(n=window.$message)==null||n.warning("请输入联系人姓名");return}if(!e.pcontact){(i=window.$message)==null||i.warning("请输入联系方式");return}if(e.id){const{data:ce,error:pe}=await Tn([e]);pe||((j=window.$message)==null||j.success("修改成功"),$e(m.pid),e.setStatus=!e.setStatus)}else{const{data:ce,error:pe}=await Nn([{...e,pid:m.pid}]);pe||((F=window.$message)==null||F.success("添加成功"),$e(m.pid),e.setStatus=!e.setStatus,Qe())}te()};function Ie(){var e;yl.value.includes("1")||yl.value.push("1"),((e=g.value.contactList[0])!=null&&e.pname||g.value.contactList.length==0)&&g.value.contactList.unshift({pname:"",pcontact:"",proposition:"",setStatus:!0})}const ye=b([]),fe=async()=>{var n;const{data:e,error:t}=await Ql({page:1,limit:100,id:m.pid});ye.value=e==null?void 0:e.list.map(i=>({value:i.id,label:i.contractname,isLeaf:!1})),Ce((n=e==null?void 0:e.list[0])==null?void 0:n.id)},Se=b([]),V=b(),{pageData:S,getData:he}=mt(wa),Ce=async e=>{await he({pids:e}),V.value=[],Se.value=Array.from(new Set([...Se.value,...S.data])),V.value=S.data.map(t=>({label:t.devname,value:t.id}))},de=async e=>{var t;await Ce(e.value),e.children=(t=V.value)==null?void 0:t.map(n=>({label:n.label,value:n.value,isLeaf:!0}))},Ee=()=>{X.pageSize==1?X.pageSize=20:X.pageSize=1,Be(m.pid)},X=st({page:1,pageSize:1,itemCount:0,showSizePicker:!0,fuzzy:"",pageSizes:[10,20],prefix:()=>`共 ${X.itemCount} 条`,onChange:e=>{X.page=e,Be(m.pid)},onUpdatePageSize:e=>{X.pageSize=e,X.page=1,Be(m.pid)}}),xe=b(),le=[{title:"绑定合同设备",key:"cid",width:220,align:"center",render(e,t){var n,i;return e.setStatus?l(Jl,{style:"width: 200px",value:e.cid,filterable:!0,placeholder:"请选择合同设备",options:ye.value,checkStrategy:"child",showPath:!1,remote:!0,renderSuffix:j=>j.option.hidden?null:j.node,renderLabel:j=>j.hidden?null:j.label,onLoad:de,onUpdateValue(j){var ce;g.value.debuggedDevieceList[t].cid=Number(j)||0;const F=(ce=Se.value)==null?void 0:ce.find(pe=>pe.id==j);e.devname=(F==null?void 0:F.devname)||"",e.devnum=(F==null?void 0:F.devcount)||"",e.notes=(F==null?void 0:F.notes)||"",xe.value=(F==null?void 0:F.devcount)||0,e.etype=(F==null?void 0:F.devtype)||0,e.devmanu=(F==null?void 0:F.devmanu)||"",e.devmodel=((F==null?void 0:F.devmodel.length)>64?F==null?void 0:F.devname:F==null?void 0:F.devmodel)||"",e.devunit=(F==null?void 0:F.devunit)||""}}):l("div",{},e.devname2||((i=(n=V.value)==null?void 0:n.find(j=>j.value==e.cid))==null?void 0:i.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.devname,placeholder:"请输入",onUpdateValue(n){g.value.debuggedDevieceList[t].devname=n}}):l("div",{},e.devname)}},{key:"devmodel",title:"设备信息",align:"center",width:180,render(e){return a("div",{style:"display:flex;align-items:flex-start;flex-direction:column; gap:3px; line-height:1.4;"},[a(Vt,{tooltip:!0,style:"max-width:160px;"},{default:()=>a("span",null,[a("span",null,[p("型号：")]),a("span",{style:"font-weight:500"},[e.devmodel||"-"])])}),a("div",null,[a("span",null,[p("单位：")]),a("span",null,[e.devunit||"-"])])])}},{title:"数量",key:"devnum",width:100,align:"center",render(e,t){return e.setStatus?l(Sa,{value:e.devnum,placeholder:"请输入",max:xe.value,onUpdateValue(n){g.value.debuggedDevieceList[t].devnum=n}}):l("div",{},e.devnum)}},{title:"设备信息",key:"deviceInfo",width:160,align:"center",render(e){return a("div",{style:"display:flex;align-items:flex-start;flex-direction:column;gap:3px;line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[p("我司设备：")]),a("span",{style:"font-weight:500"},[e.etype==0?"是":"否"])]),a("div",null,[a("span",{style:"color:#666"},[p("厂家：")]),a("span",null,[e.devmanu||"-"])])])}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.manucontact,placeholder:"请输入",onUpdateValue(n){g.value.debuggedDevieceList[t].manucontact=n}}):l("div",{},e.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.manuinfo,placeholder:"请输入",onUpdateValue(n){g.value.debuggedDevieceList[t].manuinfo=n}}):l("div",{},e.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Pe,{value:e.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(n){g.value.debuggedDevieceList[t].devstatus=Number(n)||0}}):l("div",{},e.devstatus===0?"设备无异常":e.devstatus===1?"异常":"未知")}},{title:"清点状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Pe,{value:e.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(n){g.value.debuggedDevieceList[t].status=Number(n)||0}}):l("div",{},e.status===0?"未清点":e.status===1?"正常":e.status===2?"增补":e.status===3?"退货":"换货")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.connectionmode,placeholder:"请输入",onUpdateValue(n){g.value.debuggedDevieceList[t].connectionmode=n}}):l("div",{},e.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Pe,{value:e.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(n){g.value.debuggedDevieceList[t].install=Number(n)||0}}):l("div",{},e.install===0?"是":"否")}},{title:"文件",key:"re1",width:100,align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>gl(e,"debuggedDevieceList",t)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,j)=>{var F;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((F=i.file)==null?void 0:F.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>ml({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"备注",key:"notes",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入",onUpdateValue(n){g.value.debuggedDevieceList[t].notes=n}}):l("div",{},e.notes)}},{key:"dusername",title:"清点信息",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:flex-start;  flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[p("清点人：")]),a("span",{style:"font-weight:500"},[e.dusername||"-"])]),a("div",null,[a("span",{style:"color:#666"},[p("时间：")]),a("span",null,[e.ddbtime||"-"])])])}},{key:"dbtime",title:"创建信息",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:flex-start;  flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[p("创建人：")]),a("span",{style:"font-weight:500"},[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[p("时间：")]),a("span",null,[e.dbtime||"-"])])])}},{key:"operate",title:ee("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ge(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>H(e,t)},{default:()=>"取消"}),Ye("project:Equipment:delete")&&l(He,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:j}=await Pn(e.id);i&&(g.value.debuggedDevieceList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),Be(m.pid),Qe())}else g.value.debuggedDevieceList.splice(t,1)}},{default:()=>ee("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>ee("common.delete")})})]:Ye("project:Equipment:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>D(e)},{default:()=>"编辑"})])}}],Be=async e=>{if(!e)return;const{data:t}=await Rl({page:X.page,limit:X.pageSize,fuzzy:X.fuzzy,pid:e});g.value.debuggedDevieceList=t.list,X.itemCount=t.total,g.value.debuggedDevieceList.forEach(n=>{n.setStatus=!1}),T.debuggedDevieceList=JSON.parse(JSON.stringify(g.value.debuggedDevieceList))},D=async e=>{var i;console.log(S.data,e.cid,"ssssssssssssssss"),g.value.debuggedDevieceList.forEach(j=>{j.setStatus=!1});const{data:t,error:n}=await En(e.cid);n||(((i=ye.value[ye.value.length-1])==null?void 0:i.value)!=t.id&&ye.value.push({value:t.id,label:t.devname,disabled:!0,isLeaf:!0,hidden:!0}),xe.value=t.devcount||0),e.setStatus=!e.setStatus},H=(e,t)=>{e.setStatus=!e.setStatus,e.id?g.value.debuggedDevieceList=JSON.parse(JSON.stringify(T.debuggedDevieceList)):g.value.debuggedDevieceList.splice(t,1)},Ge=async e=>{var t,n,i,j,F,ce,pe;if(!e.cid){(t=window.$message)==null||t.warning("请选择合同设备");return}if(!e.devname){(n=window.$message)==null||n.warning("设备名称不能为空");return}if(!e.devmodel){(i=window.$message)==null||i.warning("设备型号不能为空");return}if(!e.devnum){(j=window.$message)==null||j.warning("设备数量不能为空");return}if(((F=e.fileList)==null?void 0:F.length)>0){const be=e.fileList.filter(se=>se.file),ue=be.length;for(let se=0;se<ue;se++){const ge=be[se];ge.indexText=`${se+1}/${ue}`,ge.progress=0,ge.status="uploading";try{ge.url=await wt(ge.file.file,ge.file.name,""),ge.progress=100,ge.status="done"}catch{ge.status="error"}}e.fileList.forEach((se,ge)=>{e[`re${ge+1}`]=se.name||"",e[`fl${ge+1}`]=se.url||""}),delete e.fileList}if(e.id){const{data:be,error:ue}=await da([e]);ue||((ce=window.$message)==null||ce.success("修改成功"),Be(m.pid),e.setStatus=!e.setStatus)}else{const{data:be,error:ue}=await $a([{...e,pid:m.pid}]);ue||((pe=window.$message)==null||pe.success("添加成功"),Be(m.pid),e.setStatus=!e.setStatus,Qe())}},We=async()=>{var i;const e=g.value.debuggedDevieceList.map(j=>j.status==0?{id:j.id,status:1}:null).filter(j=>j!==null),{data:t,error:n}=await da(e);n||((i=window.$message)==null||i.success("清点成功"),Be(m.pid))},u=b(!1);function w(){u.value=!0}const{pageData:$,getData:v,nextPage:h}=mt(Ca),z=async()=>{await v({usertypes:"2,3"})},M=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&$.data.length<$.total&&(await h(),await gt(),setTimeout(()=>{t.scrollTop=n}))};z();const{pageData:G,getData:d,nextPage:y}=mt(ka),x=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&G.data.length<G.total&&(await y(),await gt(),setTimeout(()=>{t.scrollTop=n}))};(async()=>{await d(),G.data=G.data.map(e=>(e.name=`${e.weight}  `+e.tname,e))})();const{pageData:O,getData:Y,nextPage:ae}=mt(Ol),J=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&O.data.length<O.total&&(await ae(),O.data=O.data.map(i=>({...i,value:i.docker+"&id="+i.id})),await gt(),setTimeout(()=>{t.scrollTop=n}))},te=async()=>{await Y({pid:m.pid}),O.data=O.data.map(e=>({...e,value:e.docker+"&id="+e.id}))},{pageData:C,getData:o,nextPage:U}=mt(Rl),E=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&G.data.length<G.total&&(await U(),await gt(),setTimeout(()=>{t.scrollTop=n}))},W=async()=>{await o({pid:m.pid})},Le=b(),Ke=[{title:"权重",key:"dtype",width:180,align:"center",render(e,t){return e.setStatus?l(Pe,{value:e.dtype,filterable:!0,placeholder:"请选择权重",options:G.data,labelField:"tname",valueField:"id",onUpdateValue(n){var i;g.value.debuggedBusinessList[t].dtype=Number(n)||0,g.value.debuggedBusinessList[t].debugname=((i=G.data.find(j=>j.id==n))==null?void 0:i.tname)||""},onScroll(n){x(n)}}):l("div",{},e.tname)}},{title:"业务名称",key:"debugname",width:180,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.debugname,placeholder:"请输入业务名称",onUpdateValue(n){g.value.debuggedBusinessList[t].debugname=n}}):l("div",{},e.debugname)}},{title:"状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Pe,{value:e.status,filterable:!0,placeholder:"请选择状态",options:P.userInfo.usertype==0||P.userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}],onUpdateValue(n){g.value.debuggedBusinessList[t].status=Number(n)||0}}):l(Xl,{color:{color:e.status==-1?"rgba(251, 146, 60, 0.15)":e.status==0?"rgba(156, 163, 175,0.15)":e.status==1?"rgba(59, 130, 246,0.15)":e.status==2?"rgba(250, 204, 21,0.15)":"rgba(16, 185, 129,0.15)",textColor:e.status==-1?"#FB923C":e.status==0?"#9ca3af":e.status==1?"#3B82F6":e.status==2?"#FACC15":"#10B981",borderColor:e.status==-1?"#FB923C":e.status==0?"#9ca3af":e.status==1?"#3B82F6":e.status==2?"#FACC15":"#10B981"}},e.status==-1?"申请中":e.status==0?"待调试":e.status==1?"开始调试":e.status==2?"待审核":"审核完成")}},{key:"eqmname",title:"调试设备",align:"center",width:150,render(e,t){return e.setStatus?l(Pe,{value:e.eqmid,placeholder:"请选择调试设备",options:C.data,onscroll:E,labelField:"devname",valueField:"id",clearable:!0,filterable:!0,onUpdateValue(n){g.value.debuggedBusinessList[t].eqmid=n}}):l("div",{},e.eqmname)}},{title:"对接方",key:"docker",width:120,align:"center",render(e,t){var n;return e.setStatus?l(Pe,{value:e.docker,placeholder:"请输入或选择对接方",options:O.data,onscroll:J,labelField:"docker",valueField:"value",clearable:!0,filterable:!0,tag:!0,onClear(){e.dockcharge="",e.dockcontact=""},onUpdateValue(i){var pe;g.value.debuggedBusinessList[t].docker=i;const[j,F]=(pe=e.docker)==null?void 0:pe.split("&id="),ce=O.data.find(be=>be.docker===j&&be.id===Number(F));ce?(e.dockcharge=ce.pname,e.dockcontact=ce.pcontact):(e.dockcharge="",e.dockcontact="")}}):l("div",{},(n=e.docker)==null?void 0:n.split("&id=")[0])}},{title:"对接方负责人",key:"dockcharge",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.dockcharge,placeholder:"请输入对接方负责人",onUpdateValue(n){g.value.debuggedBusinessList[t].dockcharge=n}}):l("div",{},e.dockcharge)}},{title:"联系方式",key:"dockcontact",width:140,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.dockcontact,placeholder:"请输入联系方式",onUpdateValue(n){g.value.debuggedBusinessList[t].dockcontact=n}}):l("div",{},e.dockcontact)}},{title:"调试人",key:"dbcreater",width:120,align:"center",render(e,t){return e.setStatus?l(Pe,{value:e.dbcreater,filterable:!0,placeholder:"请选择调试人",options:$.data,labelField:"username",valueField:"id",onUpdateValue(n){g.value.debuggedBusinessList[t].dbcreater=n||0},onScroll(n){M(n)}}):l("div",{},e.dbusername)}},{key:"duration",title:"调试信息",align:"center",width:200,render(e){return a("div",{style:"display:flex; align-items:flex-start; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[p("工时：")]),a("span",{style:"color:#1890ff; font-weight:500"},[e.duration||"-"])]),a("div",null,[a("span",{style:"color:#666"},[p("开始：")]),a("span",null,[e.dbdbtime||"-"])]),a("div",null,[a("span",{style:"color:#666"},[p("结束：")]),a("span",null,[e.dedbtime||"-"])])])}},{title:"文件",key:"re1",width:80,align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>gl(e,"debuggedBusinessList",t)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,j)=>{var F;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((F=i.file)==null?void 0:F.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>ml({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"备注",key:"notes",width:120,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入备注",onUpdateValue(n){g.value.debuggedBusinessList[t].notes=n}}):l("div",{},e.notes)}},{key:"username",title:"创建信息",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:flex-start; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[p("创建人：")]),a("span",null,[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[p("时间：")]),a("span",null,[e.dbtime||"-"])])])}},{key:"ckusername",title:"审核信息",align:"center",width:200,render(e){return a("div",{style:"display:flex; align-items:flex-start; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[p("审核人：")]),a("span",null,[e.ckusername||"-"])]),a("div",null,[a("span",{style:"color:#666"},[p("时间：")]),a("span",null,[e.ckdbtime||"-"])])])}},{title:"计划开始时间",key:"starttime",width:120,align:"center",render(e,t){return e.setStatus?l(kl,{type:"date",clearable:!0,value:e.starttime,valueFormat:"yyyy-MM-dd",placeholder:"请选择",onUpdateValue(n){g.value.debuggedBusinessList[t].starttime=n}}):l("div",e.starttime?it(0,e.starttime):"")}},{title:"计划结束时间",key:"endtime",width:120,align:"center",render:(e,t)=>e.setStatus?l(kl,{type:"date",clearable:!0,valueFormat:"yyyy-MM-dd",value:e.endtime,placeholder:"请选择",onUpdateValue(n){g.value.debuggedBusinessList[t].endtime=n}}):e.endtime?it(0,e.endtime):""},{key:"operate",title:ee("common.operate"),align:"center",width:280,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[!e.setStatus&&e.status==0&&e.dbcreater==P.userInfo.id&&l(He,{onPositiveClick:()=>{Ot(e,1)}},{default:()=>"确定开始调试吗？",trigger:()=>l(_,{type:"success",ghost:!0,size:"small"},{default:()=>"开始"})}),!e.setStatus&&e.status==1&&e.dbcreater==P.userInfo.id&&l(He,{onPositiveClick:()=>{Ot(e,2)}},{default:()=>l("div",[l("div","确定完成调试？"),l("div",{style:{color:"#d03050",fontWeight:"500",marginTop:"6px"}},"请确认资料已提交，否则将拒绝审核！")]),trigger:()=>l(_,{type:"success",ghost:!0,size:"small"},{default:()=>"完成"})}),!e.setStatus&&e.status==2&&(P.userInfo.usertype==0||P.userInfo.usertype==2)&&l(He,{onPositiveClick:()=>{Ot(e,3)}},{default:()=>"是否确认执行审核操作？",trigger:()=>l(_,{type:"warning",ghost:!0,size:"small"},{default:()=>"审核"})}),e.setStatus?[Ye("project:Debug:insert")&&l(He,{onPositiveClick:()=>{wl(e)}},{default:()=>"是否确认保存？",trigger:()=>l(_,{type:"info",ghost:!0,size:"small"},{default:()=>"保存"})}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>Sl(e,t)},{default:()=>"取消"}),Ye("project:Debug:delete")&&l(He,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:j}=await An(e.id,m.pid);i&&(g.value.debuggedBusinessList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),Te(m.pid),Qe())}else g.value.debuggedBusinessList.splice(t,1)}},{default:()=>ee("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>ee("common.delete")})})]:Ye("project:Debug:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>ot(e)},{default:()=>"编辑"})])}}],Z=st({page:1,pageSize:1,showSizePicker:!0,itemCount:0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${Z.itemCount} 条`,onChange:e=>{Z.page=e,Te(m.pid)},onUpdatePageSize:e=>{Z.pageSize=e,Z.page=1,Te(m.pid)}}),ze=()=>{Z.pageSize==1?Z.pageSize=20:Z.pageSize=1,Te(m.pid)},Te=async e=>{if(!e)return;const{data:t}=await Vn({page:Z.page,limit:Z.pageSize,fuzzy:Z.fuzzy,creater:Z.creater,pid:e});g.value.debuggedBusinessList=t.list,Z.itemCount=t.total,g.value.debuggedBusinessList.forEach(n=>{n.setStatus=!1}),T.debuggedBusinessList=JSON.parse(JSON.stringify(g.value.debuggedBusinessList))},ot=e=>{e.starttime=ua(e.starttime),e.endtime=ua(e.endtime),Le.value=e.status,g.value.debuggedBusinessList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},Ot=async(e,t)=>{var j;const{data:n,error:i}=await ca([{id:e.id,status:t,pid:e.pid}]);i||((j=window.$message)==null||j.success("操作成功"),Te(m.pid),t==3&&window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:e.pid,type:"debug"}})))},Sl=(e,t)=>{e.setStatus=!e.setStatus,e.id?g.value.debuggedBusinessList=JSON.parse(JSON.stringify(T.debuggedBusinessList)):g.value.debuggedBusinessList.splice(t,1)},wl=async e=>{var i,j,F,ce,pe,be,ue,se,ge,we,hl;if(!e.dtype){(i=window.$message)==null||i.warning("请选择权重");return}if(!e.debugname){(j=window.$message)==null||j.warning("请输入业务名称");return}if(!e.docker){(F=window.$message)==null||F.warning("请选择或输入对接方");return}if(!e.dockcharge){(ce=window.$message)==null||ce.warning("请输入对接方负责人");return}if(!e.dockcontact){(pe=window.$message)==null||pe.warning("请输入对接方联系方式");return}if(!e.dbcreater){(be=window.$message)==null||be.warning("请选择调试人");return}const t=it(0,e.starttime),n=it(0,e.endtime);if(((ue=e.fileList)==null?void 0:ue.length)>0){const at=e.fileList.filter(nt=>nt.file),jt=at.length;for(let nt=0;nt<jt;nt++){const et=at[nt];et.indexText=`${nt+1}/${jt}`,et.progress=0,et.status="uploading";try{et.url=await wt(et.file.file,et.file.name,""),et.progress=100,et.status="done"}catch{et.status="error"}}e.fileList.forEach((nt,et)=>{e[`re${et+1}`]=nt.name||"",e[`fl${et+1}`]=nt.url||""}),delete e.fileList}if(e.id){const at=JSON.parse(JSON.stringify(e));Le.value==at.status&&delete at.status,at.docker=(se=at.docker)==null?void 0:se.split("&id=")[0];const{data:jt,error:nt}=await ca([{...at,starttime:t,endtime:n}]);nt||((ge=window.$message)==null||ge.success("修改成功"),Te(m.pid),e.setStatus=!e.setStatus)}else{e.docker=(we=e.docker)==null?void 0:we.split("&id=")[0];const{data:at,error:jt}=await La([{...e,starttime:t,endtime:n,pid:m.pid}]);jt||((hl=window.$message)==null||hl.success("添加成功"),Te(m.pid),e.setStatus=!e.setStatus,Qe())}},Nt=b(!1);function Rt(){Nt.value=!0}const Pt=[{title:"影响的业务",key:"affectedbusiness",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.affectedbusiness,placeholder:"请输入影响的业务",onUpdateValue(n){g.value.developBusinessList[t].affectedbusiness=n}}):l("div",{},e.affectedbusiness)}},{title:"设备名称",key:"devname",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.devname,placeholder:"请输入设备名称",onUpdateValue(n){g.value.developBusinessList[t].devname=n}}):l("div",{},e.devname)}},{title:"接口文档",key:"apidocument",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.apidocument,placeholder:"请输入接口文档",onUpdateValue(n){g.value.developBusinessList[t].apidocument=n}}):l("div",{},e.apidocument)}},{title:"研发对接人",key:"uid",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.uid,placeholder:"请输入研发对接人",onUpdateValue(n){g.value.developBusinessList[t].uid=n}}):l("div",{},e.uid)}},{title:"研发周期",key:"period",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.period,placeholder:"请输入文件上传路径",onUpdateValue(n){g.value.developBusinessList[t].period=n}}):l("div",{},e.period)}},{title:"备注",key:"notes",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入备注",onUpdateValue(n){g.value.developBusinessList[t].notes=n}}):l("div",{},e.notes)}},{title:"文件",key:"re1",align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>gl(e,"developBusinessList",t)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,j)=>{var F;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((F=i.file)==null?void 0:F.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>ml({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?it(1,e.dbtime):""},{key:"operate",title:ee("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[Ye("project:Development:insert")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>zl(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>Dl(e,t)},{default:()=>"取消"}),Ye("project:Development:delete")&&l(He,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:j}=await qn(e.id,m.pid);i&&(g.value.developBusinessList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),rt(m.pid),Qe())}else g.value.developBusinessList.splice(t,1)}},{default:()=>ee("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>ee("common.delete")})})]:Ye("project:Development:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>$l(e)},{default:()=>"编辑"})])}}],Ae=st({page:1,pageSize:1,itemCount:0,showSizePicker:!0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${Ae.itemCount} 条`,onChange:e=>{Ae.page=e,rt(m.pid)},onUpdatePageSize:e=>{Ae.pageSize=e,Ae.page=1,rt(m.pid)}}),Jt=()=>{Ae.pageSize==1?Ae.pageSize=20:Ae.pageSize=1,rt(m.pid)},rt=async e=>{if(!e)return;const{data:t}=await Mn({page:Ae.page,limit:Ae.pageSize,fuzzy:Ae.fuzzy,creater:Ae.creater,pid:e});g.value.developBusinessList=t.list,Ae.itemCount=t.total,g.value.developBusinessList.forEach(n=>{n.setStatus=!1}),T.developBusinessList=JSON.parse(JSON.stringify(g.value.developBusinessList))},$l=e=>{g.value.developBusinessList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},Dl=(e,t)=>{e.setStatus=!e.setStatus,e.id?g.value.developBusinessList=JSON.parse(JSON.stringify(T.developBusinessList)):g.value.developBusinessList.splice(t,1)},zl=async e=>{var t,n,i,j,F,ce,pe,be;if(!e.affectedbusiness){(t=window.$message)==null||t.warning("请输入影响的业务");return}if(!e.devname){(n=window.$message)==null||n.warning("请输入设备名称");return}if(!e.apidocument){(i=window.$message)==null||i.warning("请输入接口文档");return}if(!e.uid){(j=window.$message)==null||j.warning("请输入研发对接人");return}if(!e.period){(F=window.$message)==null||F.warning("请输入研发周期");return}if(((ce=e.fileList)==null?void 0:ce.length)>0){const ue=e.fileList.filter(ge=>ge.file),se=ue.length;for(let ge=0;ge<se;ge++){const we=ue[ge];we.indexText=`${ge+1}/${se}`,we.progress=0,we.status="uploading";try{we.url=await wt(we.file.file,we.file.name,""),we.progress=100,we.status="done"}catch{we.status="error"}}e.fileList.forEach((ge,we)=>{e[`re${we+1}`]=ge.name||"",e[`fl${we+1}`]=ge.url||""}),delete e.fileList}if(e.id){const{data:ue,error:se}=await On([e]);se||((pe=window.$message)==null||pe.success("修改成功"),rt(m.pid),e.setStatus=!e.setStatus)}else{const{data:ue,error:se}=await Rn([{...e,pid:m.pid}]);se||((be=window.$message)==null||be.success("添加成功"),rt(m.pid),e.setStatus=!e.setStatus,Qe())}};function jl(){var e;At.value.includes("2")||At.value.push("2"),((e=g.value.developBusinessList[0])!=null&&e.id||g.value.developBusinessList.length==0)&&g.value.developBusinessList.unshift({affectedbusiness:"",devname:"",apidocument:"",uid:"",period:void 0,notes:"",setStatus:!0})}const Ul=[{title:"需求内容",key:"reqcontent",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.reqcontent,placeholder:"请输入需求内容",onUpdateValue(n){g.value.needsList[t].reqcontent=n}}):l("div",{},e.reqcontent)}},{title:"客户联系人",key:"customer",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.customer,placeholder:"请输入客户联系人",onUpdateValue(n){g.value.needsList[t].customer=n}}):l("div",{},e.customer)}},{title:"联系方式",key:"cstcontact",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.cstcontact,placeholder:"请输入联系方式",onUpdateValue(n){g.value.needsList[t].cstcontact=n}}):l("div",{},e.cstcontact)}},{title:"结果",key:"cstresult",align:"center",render(e,t){return e.setStatus?l(Pe,{value:e.cstresult,filterable:!0,placeholder:"请选择结果",options:[{label:"成功",value:1},{label:"失败",value:0}],onUpdateValue(n){g.value.needsList[t].cstresult=Number(n)||0}}):l("div",{},e.cstresult==1?"成功":"失败")}},{title:"备注",key:"notes",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入备注",onUpdateValue(n){g.value.needsList[t].notes=n}}):l("div",{},e.notes)}},{title:"文件",key:"re1",align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>gl(e,"needsList",t)},{default:()=>"上传文件"}):l(xt,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,j)=>{var F;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((F=i.file)==null?void 0:F.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>ml({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?it(1,e.dbtime):""},{key:"operate",title:ee("common.operate"),align:"center",minWidth:120,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[Ye("project:Customer:insert")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Me(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>N(e,t)},{default:()=>"取消"}),Ye("project:Customer:delete")&&l(He,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:j}=await Jn(e.id,m.pid);i&&(g.value.needsList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),ht(m.pid),Qe())}else g.value.needsList.splice(t,1)}},{default:()=>ee("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>ee("common.delete")})})]:Ye("project:Customer:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>rl(e)},{default:()=>"编辑"})])}}],Ve=st({page:1,pageSize:1,showSizePicker:!0,itemCount:0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${Ve.itemCount} 条`,onChange:e=>{Ve.page=e,ht(m.pid)},onUpdatePageSize:e=>{Ve.pageSize=e,Ve.page=1,ht(m.pid)}}),ol=()=>{Ve.pageSize==1?Ve.pageSize=20:Ve.pageSize=1,ht(m.pid)},ht=async e=>{if(!e)return;const{data:t}=await Hn({page:Ve.page,limit:Ve.pageSize,fuzzy:Ve.fuzzy,creater:Ve.creater,pid:e});g.value.needsList=t.list,Ve.itemCount=t.total,g.value.needsList.forEach(n=>{n.setStatus=!1}),T.needsList=JSON.parse(JSON.stringify(g.value.needsList))},rl=e=>{g.value.needsList.forEach(t=>{t.setStatus=!1}),e.cstresult=e.cstresult&&e.cstresult*1,e.setStatus=!e.setStatus},N=(e,t)=>{e.setStatus=!e.setStatus,e.id?g.value.needsList=JSON.parse(JSON.stringify(T.needsList)):g.value.needsList.splice(t,1)},Me=async e=>{var t,n,i,j,F,ce;if(!e.reqcontent){(t=window.$message)==null||t.error("需求内容不能为空");return}if(!e.customer){(n=window.$message)==null||n.error("客户联系人不能为空");return}if(!e.cstcontact){(i=window.$message)==null||i.error("联系方式不能为空");return}if(((j=e.fileList)==null?void 0:j.length)>0){const pe=e.fileList.filter(ue=>ue.file),be=pe.length;for(let ue=0;ue<be;ue++){const se=pe[ue];se.indexText=`${ue+1}/${be}`,se.progress=0,se.status="uploading";try{se.url=await wt(se.file.file,se.file.name,""),se.progress=100,se.status="done"}catch{se.status="error"}}e.fileList.forEach((ue,se)=>{e[`re${se+1}`]=ue.name||"",e[`fl${se+1}`]=ue.url||""}),delete e.fileList}if(e.id){const{data:pe,error:be}=await Gn([e]);be||((F=window.$message)==null||F.success("修改成功"),ht(m.pid),e.setStatus=!e.setStatus)}else{const{data:pe,error:be}=await Wn([{...e,pid:m.pid}]);be||((ce=window.$message)==null||ce.success("添加成功"),ht(m.pid),e.setStatus=!e.setStatus,Qe())}};function Je(){var e;At.value.includes("3")||At.value.push("3"),((e=g.value.needsList[0])!=null&&e.id||g.value.needsList.length==0)&&g.value.needsList.unshift({reqcontent:"",customer:"",cstcontact:"",cstresult:0,notes:"",setStatus:!0})}const g=b({projectDetail:{},contactList:[],prjCycleList:[],fileList:[],DebuggingEngineerList:[],debuggedDevieceList:[],debuggedBusinessList:[],developBusinessList:[],needsList:[]}),Ht=[{key:"kk",title:" ",align:"center",width:120,render:e=>a("div",null,[e.username+"的项目总结"])},{key:"charctras",title:"字符数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:ee("common.operate"),align:"center",width:140,fixed:"right",render:e=>{let t;return a("div",{class:"flex-center gap-8px"},[a(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ua(e)},{default:()=>[p("查看详情")]}),P.userInfo.id==e.creater&&je(a(_,{type:"primary",ghost:!0,size:"small",onClick:()=>lt(e)},bl(t=ee("common.edit"))?t:{default:()=>[t]}),[[ft("no-auth"),"project:Summary:update"]]),P.userInfo.id==e.creater&&a(He,{onPositiveClick:()=>ul(e.id)},{default:()=>ee("common.confirmDelete"),trigger:()=>{let n;return je(a(_,{type:"error",ghost:!0,size:"small"},bl(n=ee("common.delete"))?n:{default:()=>[n]}),[[ft("no-auth"),"project:Summary:delete"]])}})])}}],Ze=st({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${Ze.itemCount} 条`,onChange:e=>{Ze.page=e,bt(m.pid)},onUpdatePageSize:e=>{Ze.pageSize=e,Ze.page=1,bt(m.pid)}}),Et=b([]),bt=async e=>{const{data:t,error:n}=await Kn({page:Ze.page,limit:Ze.pageSize,pid:e});n||(Et.value=t.list,Ze.itemCount=t.total,Qe())},dl=()=>{dt.value=void 0,$t.value=!0};async function ul(e){var i;const{data:t,error:n}=await pa(e);n||((i=window.$message)==null||i.success("删除成功"),bt(m.pid))}const $t=b(!1);function lt(e){dt.value=e,$t.value=!0}const Bl=b(!1),dt=b({}),Ua=e=>{Bl.value=!0,dt.value=e},Zl=[{key:"notes",title:"今日工作内容",align:"center",width:300,render(e){return l(Vt,{tooltipPlacement:"center",lineClamp:3,style:{minWidth:"280px"}},{default:()=>e.notes||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.notes||"")})}},{key:"problem",title:"遇到问题",align:"center",width:120,render(e){return l(Vt,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.problem||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.problem||"")})}},{key:"solutions",title:"解决措施",align:"center",width:120,render(e){return l(Vt,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.solutions||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.solutions||"")})}},{key:"feedback",title:"建议意见反馈",align:"center",width:120,render(e){return l(Vt,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.feedback||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.feedback||"")})}},{key:"summarize",title:"总结",align:"center",width:120,render(e){return l(Vt,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.summarize||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.summarize||"")})}},{key:"username",title:"创建信息",align:"left",width:200,render(e){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[p("创建人：")]),a("span",null,[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[p("创建时间：")]),a("span",null,[e.dbtime||"-"])])])}},{key:"operate",title:ee("common.operate"),align:"center",width:100,fixed:"right",render:e=>{let t;return a("div",{class:"flex-center gap-8px"},[P.userInfo.id==e.creater&&je(a(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ia(e)},bl(t=ee("common.edit"))?t:{default:()=>[t]}),[[ft("no-auth"),"project:Summary:update"]]),P.userInfo.id==e.creater&&a(He,{onPositiveClick:()=>Fa(e.id)},{default:()=>ee("common.confirmDelete"),trigger:()=>{let n;return je(a(_,{type:"error",ghost:!0,size:"small"},bl(n=ee("common.delete"))?n:{default:()=>[n]}),[[ft("no-auth"),"project:Summary:delete"]])}})])}}],ut=st({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${ut.itemCount} 条`,onChange:e=>{ut.page=e,cl(m.pid)},onUpdatePageSize:e=>{ut.pageSize=e,ut.page=1,cl(m.pid)}}),Fl=b([]),cl=async e=>{const{data:t,error:n}=await Da({page:ut.page,limit:ut.pageSize,pid:e});n||(Fl.value=t.list.map(i=>{const j=JSON.parse(i.context);return i.notes=j.notes,i.problem=j.problem,i.solutions=j.solutions,i.feedback=j.feedback,i.summarize=j.summarize,i}),ut.itemCount=t.total,Qe())},Ba=()=>{dt.value=void 0,pl.value=!0};async function Fa(e){var i;const{data:t,error:n}=await pa(e);n||((i=window.$message)==null||i.success("删除成功"),bt(m.pid))}const pl=b(!1);function Ia(e){dt.value=e,pl.value=!0}const ea=b(!1);function ta(){Wt()}const Il=b(!1),Ta=async e=>{if(!e){g.value={projectDetail:{},contactList:[],debuggedBusinessList:[],fileList:[],debuggedDevieceList:[],DebuggingEngineerList:[],developBusinessList:[],needsList:[]};return}Il.value=!0;try{const t=await Promise.allSettled([me(e),Ct(e),W(),$e(e),Te(e),Be(e),Na(),rt(e),ht(e),bt(e),cl(e)]);Qe(),t.forEach((n,i)=>{n.status==="fulfilled"?console.log(`任务 ${i} 成功:`,n):console.warn(`任务 ${i} 失败:`,n.reason)})}catch(t){console.error("意料之外的错误:",t)}finally{Il.value=!1}},Gt=b(),la=[{key:"cusname",title:"客户名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"token",title:"气象信息Token",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[a("span",null,[e.token||"-"]),a(ls,{trigger:"hover"},{trigger:()=>a(_,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>aa(e.token)},{default:()=>[p("复制")]}),default:()=>"复制 token"})])}},{key:"passward",title:"气象信息Passward",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[a("span",null,[e.passward||"-"]),a(_,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>aa(e.passward)},{default:()=>[p("复制")]})])}},{key:"longitude",title:"经度",align:"center",width:120},{key:"latitude",title:"维度",align:"center",width:120},{key:"pro",title:"墨迹合同项目名称",align:"center",width:140},{key:"expiare",title:"过期时间",align:"center",width:180},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(e){return a("div",{style:"display:flex; flex-direction:column; font-size:13px; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[p("创建人：")]),a("span",{style:"font-weight:500"},[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[p("时间：")]),a("span",{style:" font-weight:500"},[e.dbtime||"-"])])])}}],Na=async()=>{const{data:e,error:t}=await Ls({page:1,limit:99,pid:m.pid});Gt.value=e.list,Gt.value.length>0&&P.userInfo.usertype!=1&&(K[5]={id:"phase6",title:"气象信息",show:!0,tables:[{id:1,name:"气象信息",type:1}]})},aa=async e=>{var t;e&&(await navigator.clipboard.writeText(e),(t=window.$message)==null||t.success("已复制"))},Qe=()=>{K[0].tables=[{id:1,name:"项目联系人",type:g.value.contactList.length>0?1:0},{id:2,name:"待调试设备",type:g.value.debuggedDevieceList.length>0?1:0},{id:3,name:"图纸",type:g.value.fileList.length>0?1:0}],K[1].tables=[{id:1,name:"待调试业务",type:g.value.debuggedBusinessList.length>0?1:0},{id:2,name:"需要开发",type:g.value.developBusinessList.length>0?1:0},{id:3,name:"需求变更",type:g.value.needsList.length>0?1:0},{id:4,name:"文件",type:Kt.value.length>0||Yt.value.length>0||Qt.value.length>0||Xt.value.length>0||Zt.value.length>0?1:0}],K[2].tables=[{id:1,name:"项目验收",type:el.value.length>0?1:0}],K[3].tables=[{id:1,name:"项目总结",type:Et.value.length>0?1:0}],K[4].tables=[{id:1,name:"项目日报",type:Fl.value.length>0?1:0}]};async function Wt(){P.userInfo.usertype==1&&(K[3]=null,K[4]=null,K=K.filter(e=>e!==null)),m.pid&&(await Ta(m.pid),fe(),te(),Qe(),setTimeout(()=>{re.replace({path:oe.path,query:{}})},100))}const Pa=()=>{const e=document.getElementById("__SCROLL_EL_ID__");e==null||e.scrollTo({top:0,behavior:"smooth"})},na=e=>{K[e].show=!K[e].show},Tl=e=>{const t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth",block:"start"}),I.value=e)},Nl=()=>{const e=[];K.forEach(i=>{i.tables.forEach((j,F)=>e.push(`${i.id}-${F}`))});const t=window.scrollY;let n="";for(const i of e){const j=document.getElementById(i);j&&j.offsetTop-100<=t&&(n=i)}I.value=n},Kt=b([]),Yt=b([]),Qt=b([]),Xt=b([]),Zt=b([]),el=b([]),sa=b({});async function Ct(e){const{data:t,error:n}=await as({limit:100,page:1,pid:e});n||(g.value.fileList=[],Kt.value=[],Yt.value=[],Qt.value=[],Xt.value=[],Zt.value=[],el.value=[],sa.value=t,console.log("data",sa.value),t.list.forEach(i=>{i.sort==1&&g.value.fileList.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==2&&Kt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==3&&Yt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==4&&Qt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==5&&Xt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==6&&Zt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==7&&el.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime})}),g.value.fileList.reverse(),Kt.value.reverse(),Yt.value.reverse(),Qt.value.reverse(),Xt.value.reverse(),Zt.value.reverse(),el.value.reverse(),Qe())}const Ea=e=>{const t=e.target,n=document.getElementById("__SCROLL_EL_ID__"),i=document.getElementById("scrollToTop");!n||!i||(t.scrollTop>(n.clientHeight||0)+500?i.classList.add("show"):i.classList.remove("show"))},ct=b([]),{pageData:Dt,getData:fl,nextPage:Aa}=mt(ss),Va=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&Dt.data.length<Dt.total&&(await Aa(),ct.value=Dt.data,await gt(),setTimeout(()=>{t.scrollTop=n}))},qa=Kl.debounce(async e=>{await fl({fuzzy:e,page:1}),ct.value=Dt.data},300),Pl=b(!1),El=b(!1),Ma=e=>{if(m.pid=null,Pl.value=!0,El.value=!1,!e){ia();return}qa(e)},Oa=async()=>{Pl.value&&!El.value&&(await fl({page:1}),ct.value=Dt.data,Pl.value=!1,await Wt())},ia=async()=>{await fl({page:1}),ct.value=Dt.data,await Wt()},Ra=async e=>{var t;El.value=!0,e&&(m.pid=e,P.setProjectInfo({pid:e,pname:(t=ct.value.find(n=>n.id==m.pid))==null?void 0:t.proname}),await Wt())},Ja=async()=>{var e;await fl({fuzzy:oe.query.pname?oe.query.pname:P.userInfo.pname||void 0}),ct.value=Dt.data,m.pid=(oe.query.prjId?Number(oe.query.prjId):P.userInfo.pid?Number(P.userInfo.pid):Number((e=ct.value[0])==null?void 0:e.id))||void 0,P.setProjectInfo({pid:m.pid,pname:P.userInfo.pname})},tl=b(!1),zt=b(""),Al=b(),gl=(e,t,n)=>{_t.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}],tl.value=!0,zt.value=t,Al.value=n,e.re1&&(_t.value[0]={name:e.re1,url:e.fl1,file:void 0}),e.re2&&(_t.value[1]={name:e.re2,url:e.fl2,file:void 0}),e.re3&&(_t.value[2]={name:e.re3,url:e.fl3,file:void 0}),e.re4&&(_t.value[3]={name:e.re4,url:e.fl4,file:void 0}),console.log(_t.value)},Ha=[{title:"",key:"",align:"center",render(e,t){return`附件${t+1}`}},{title:"文件名称",key:"filename",align:"center",render(e){var i;const t=async({file:j,onFinish:F,onError:ce})=>{var pe,be;try{e.name=j.name,e.file=j}catch(ue){console.error(ue),(be=(pe=window.$message)==null?void 0:pe.error)==null||be.call(pe,"文件上传出错")}};async function n(j){var F;return j.file.file.size>100*1024*1024?((F=window.$message)==null||F.error("文件大小不能超过100M"),!1):!0}return l("div",{style:"display:flex;justify-content:center;align-items:center;"},[e.file||e.url?l("span",{},[l("span",{},((i=e.file)==null?void 0:i.name)||e.url.split("?")[1]||""),l("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{e.url="",e.file=null,e.name=""}},"删除")]):l(sl,{action:"#",showFileList:!1,customRequest:t,onBeforeUpload:n},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(e){return l(ie,{value:e.name,clearable:!0,onUpdateValue:t=>{e.name=t}})}}],_t=b([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",rl:"",file:void 0}]);async function ml(e){if(e!=null&&e.url)try{const n=await(await fetch(e.url.split("?")[0],{mode:"cors"})).blob(),i=URL.createObjectURL(n),j=document.createElement("a");j.href=i,j.download=e.url.split("?")[1],j.style.display="none",document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(i)}catch(t){console.error("下载失败:",t)}}const Ga=async()=>{var t,n;let e=!0;if(_t.value.forEach((i,j)=>{var pe,be;const F=i.name||"",ce=((pe=i.url)==null?void 0:pe.split("?")[1])||((be=i.file)==null?void 0:be.name);(F&&!ce||!F&&ce)&&(e=!1)}),!e){(n=(t=window.$message)==null?void 0:t.error)==null||n.call(t,"文件名称和文件地址必须同时存在，不能只填一个");return}g.value[zt.value][Al.value].fileList=_t.value,e&&(tl.value=!1,zt.value="",Al.value=void 0)},Wa=()=>{tl.value=!1},oa=b(!1),Vl=b([]),Ka=async()=>{var n;if(!m.pid)return(n=window.$message)==null?void 0:n.warning("请选择项目");const{data:e,error:t}=await ns({page:1,limit:100,pid:m.pid});Vl.value=(e==null?void 0:e.list)||[]},Ya=e=>{e&&navigator.clipboard.writeText(e).then(()=>{var t;(t=window.$message)==null||t.success("已复制到剪贴板")}).catch(()=>{var t;(t=window.$message)==null||t.error("复制失败，请手动复制")})};Wl(async()=>{await Ja(),Wt(),oe.query.IsScroll&&setTimeout(()=>{Tl("phase2-0")},800),window.addEventListener("scroll",Nl);const e=document.getElementById("__SCROLL_EL_ID__");e&&e.addEventListener("scroll",Ea)}),Yn(()=>{window.removeEventListener("scroll",Nl);const e=document.getElementById("__SCROLL_EL_ID__");e&&e.removeEventListener("scroll",Nl)});async function vl(e){if(!e)return;const t=e.split("?")[0],n=e.split("?")[1];try{const j=await(await fetch(t,{mode:"cors"})).blob(),F=URL.createObjectURL(j),ce=document.createElement("a");ce.href=F,ce.download=n,ce.style.display="none",document.body.appendChild(ce),ce.click(),document.body.removeChild(ce),URL.revokeObjectURL(F)}catch(i){console.error("下载失败:",i)}}const yl=b(["1","2","3"]),Qa=e=>{yl.value=e},At=b(["1","2","3","4"]),Xa=e=>{At.value=e},ql=b(!1),Za=()=>{var e;m.pid?ql.value=!0:(e=window.$message)==null||e.warning("请选择项目")};return(e,t)=>{const n=sn,i=Ss,j=un,F=ja,ce=ba,pe=Yl,be=on,ue=va,se=Hl,ge=Gl,we=dn,hl=tn,at=rn,jt=il,nt=Zn,et=es,vt=ft("no-auth"),en=ft("loading");return r(),k("div",no,[f("div",{id:"scrollToTop",onClick:Pa,title:"回到顶部"},[a(n,{class:"font-size-30px"})]),a(pe,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[a(ce,{ref:"formRef",model:m,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ha(ta,["enter"])},{default:s(()=>[a(F,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[a(i,{span:"24 s:12 m:8",label:"所属项目",path:"pid"},{default:s(()=>[a(c(Pe),{filterable:"",clearable:"",value:m.pid,"onUpdate:value":[t[0]||(t[0]=Ne=>m.pid=Ne),Ra],placeholder:"请选择所属项目","label-field":"proname","value-field":"id",onClear:ia,onSearch:Ma,onBlur:Oa,options:c(Qn)(ct.value),onScroll:Va},null,8,["value","options"])]),_:1}),a(i,{span:"24  s:12 m:8",class:"pr-24px"},{default:s(()=>[a(c(qe),{class:"w-full"},{default:s(()=>[a(c(_),{type:"primary",ghost:"",onClick:ta},{icon:s(()=>[a(j,{class:"text-icon"})]),default:s(()=>[p(" "+B(c(ee)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(pe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper overflow-auto pb-40px content","content-style":{padding:"20px 10px 5px 0"}},{default:s(()=>[je((r(),k("div",so,[f("div",io,[f("div",oo,[(r(!0),k(Oe,null,It(c(K),(Ne,Xe)=>(r(),k("div",{key:Ne.id,class:"timeline-phase"},[f("div",{class:"timeline-row",id:"phase"+(Xe+1)},[f("div",uo,[t[22]||(t[22]=f("div",{class:"vertical-line"},null,-1)),f("div",{class:"flashing-icon",onClick:ne=>na(Xe)},null,8,co)]),f("div",po,[f("div",{class:"phase-title",onClick:ne=>na(Xe)},B(Ne.title),9,fo),a(c(qe),null,{default:s(()=>[Xe===0?(r(),A(c(_),{key:0,onClick:Za,ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:s(()=>t[23]||(t[23]=[p("工程调试确认单")])),_:1,__:[23]})):L("",!0),Xe===0?(r(),A(c(xt),{key:1,trigger:"click",placement:"left-start",width:1e3},{trigger:s(()=>[je((r(),A(c(_),{ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:s(()=>t[24]||(t[24]=[p("查询关联合同")])),_:1,__:[24]})),[[vt,"project:Contract:select"]])]),default:s(()=>[a(bi,{id:m.pid},null,8,["id"])]),_:1})):L("",!0),Xe===0?(r(),A(c(xt),{key:2,trigger:"click",placement:"left-start"},{trigger:s(()=>[je((r(),A(c(_),{onClick:Ka,ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:s(()=>t[25]||(t[25]=[p("查询项目调度")])),_:1,__:[25]})),[[vt,"project:Dispatch:select"]])]),default:s(()=>[Vl.value.length>0?(r(),A(c(ws),{key:0,bordered:!1,"single-line":!1},{default:s(()=>[t[35]||(t[35]=f("thead",null,[f("tr",null,[f("th",null,"调度名称"),f("th",null,"调度联系方式"),f("th",null,"相关文件")])],-1)),f("tbody",null,[(r(!0),k(Oe,null,It(Vl.value,ne=>{var yt,ll,al,nl;return r(),k("tr",{key:ne.id},[f("td",null,B(ne.dname),1),f("td",null,[f("span",go,B(ne.dcon),1),a(c(_),{size:"tiny",type:"primary",ghost:"",onClick:Ut=>Ya(ne.dcon)},{default:s(()=>t[26]||(t[26]=[p(" 复制 ")])),_:2,__:[26]},1032,["onClick"])]),f("td",null,[ne.re1&&ne.fl1?(r(),k("div",mo,[f("span",vo,"文件别名："+B(ne.re1),1),t[27]||(t[27]=f("span",{class:"ml-10px"},"文件名称:",-1)),t[28]||(t[28]=p()),f("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Ut=>vl(ne.fl1)},B((yt=ne.fl1)==null?void 0:yt.split("?")[1]),9,yo)])):L("",!0),ne.re2&&ne.fl2?(r(),k("div",ho,[f("span",bo,"文件别名："+B(ne.re2),1),t[29]||(t[29]=f("span",{class:"ml-10px"},"文件名称:",-1)),t[30]||(t[30]=p()),f("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Ut=>vl(ne.fl1)},B((ll=ne.fl2)==null?void 0:ll.split("?")[1]),9,_o)])):L("",!0),ne.re3&&ne.fl3?(r(),k("div",xo,[f("span",ko,"文件别名："+B(ne.re3),1),t[31]||(t[31]=f("span",{class:"ml-10px"},"文件名称:",-1)),t[32]||(t[32]=p()),f("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Ut=>vl(ne.fl1)},B((al=ne.fl3)==null?void 0:al.split("?")[1]),9,Co)])):L("",!0),ne.re4&&ne.fl4?(r(),k("div",Lo,[f("span",So,"文件别名："+B(ne.re4),1),t[33]||(t[33]=f("span",{class:"ml-10px"},"文件名称:",-1)),t[34]||(t[34]=p()),f("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Ut=>vl(ne.fl1)},B((nl=ne.fl4)==null?void 0:nl.split("?")[1]),9,wo)])):L("",!0)])])}),128))])]),_:2,__:[35]},1024)):(r(),k("div",$o,"暂无调度"))]),_:2},1024)):L("",!0)]),_:2},1024)])],8,ro),a(ya,{name:"fade"},{default:s(()=>[je(f("div",Do,[Xe===0?(r(),k("div",zo,[a(ao,{pid:m.pid,onSearchDetail:t[1]||(t[1]=ne=>me(m.pid)),ref_for:!0,ref:"detailRef",userList:c($).data,prjDetailInfo:g.value.projectDetail},null,8,["pid","userList","prjDetailInfo"])])):L("",!0),(r(!0),k(Oe,null,It(Ne.tables,(ne,yt)=>{var ll,al,nl,Ut;return r(),k("div",{key:`${Ne.id}-${yt}`,class:"timeline-row"},[f("div",jo,[t[36]||(t[36]=f("div",{class:"vertical-line"},null,-1)),ne.type==1?(r(),k("div",{key:0,class:Ft(["icon",{active:I.value===`${Ne.id}-${yt}`}]),style:{"font-size":"20px",border:"3px solid #409eff",color:"#409eff"},onClick:q=>Tl(`${Ne.id}-${yt}`)},[a(be)],10,Uo)):(r(),k("div",{key:1,class:"icon",style:{"font-size":"20px",border:"3px solid #ccc",color:"#ccc"},onClick:q=>Tl(`${Ne.id}-${yt}`)}," 一 ",8,Bo))]),f("div",{class:"actProgress",style:St({background:ne.type==1?"#409eff":"#ccc"})},null,4),f("div",{class:"timeline-content",id:`${Ne.id}-${yt}`},[Xe===0?(r(),k(Oe,{key:0},[a(at,{"expanded-names":yl.value,"onUpdate:expandedNames":Qa,"trigger-areas":["arrow"]},{default:s(()=>[ne.id==1?(r(),A(we,{key:0,name:"1"},{header:s(()=>[a(c(qe),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[f("div",Io,[t[38]||(t[38]=f("span",null,"项目联系人",-1)),je((r(),A(c(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:Lt(Ie,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[37]||(t[37]=p(" 添加项目联系人 "))]),_:1,__:[37]})),[[vt,"project:Contact:insert"]])])]),_:1})]),default:s(()=>[g.value.contactList.length>0?(r(),A(c(tt),{key:0,columns:ke,data:g.value.contactList,size:"small","scroll-x":702,"row-key":q=>q.id,"paginate-single-page":!1,"max-height":350,pagination:ve.pageSize==1?!1:ve,remote:""},null,8,["data","row-key","pagination"])):L("",!0),ve.itemCount>1?(r(),k("div",To,[g.value.contactList.length==1?(r(),k("span",{key:0,onClick:Fe},[t[39]||(t[39]=p("更多")),a(se,{class:"font-size-20px"})])):(r(),k("span",{key:1,onClick:Fe},[t[40]||(t[40]=p("收起")),a(ge,{class:"font-size-20px"})]))])):L("",!0)]),_:1})):L("",!0),ne.id==2?(r(),A(we,{key:1,title:"待调试设备",name:"2"},{header:s(()=>[a(c(qe),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>{var q;return[f("div",No,[t[44]||(t[44]=f("span",null,"待调试设备",-1)),f("div",Po,[je((r(),A(c(_),{size:"small",ghost:"",type:"primary",onClick:Lt(w,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[41]||(t[41]=p(" 添加待调试设备 "))]),_:1,__:[41]})),[[vt,"project:Equipment:insert"]]),(q=g.value.debuggedDevieceList)!=null&&q.some(pt=>pt.status===0)?(r(),A(c(He),{key:0,onPositiveClick:We},{trigger:s(()=>[je((r(),A(c(_),{size:"small",ghost:"",type:"primary"},{default:s(()=>[a(hl,{class:"text-icon"}),t[42]||(t[42]=p(" 一键清点设备 "))]),_:1,__:[42]})),[[vt,"project:Equipment:update"]])]),default:s(()=>[t[43]||(t[43]=p(" 确定要清点当前列表中未清点的设备吗？ "))]),_:1,__:[43]})):L("",!0)])]),X.itemCount>0?(r(),k("div",Eo,"共"+B(X.itemCount)+"条",1)):L("",!0)]}),_:2},1024)]),default:s(()=>[a(xi,{onSubmitted:t[2]||(t[2]=q=>Be(m.pid)),visible:u.value,"onUpdate:visible":t[3]||(t[3]=q=>u.value=q),pid:m.pid},null,8,["visible","pid"]),g.value.debuggedDevieceList.length>0?(r(),A(c(tt),{key:0,style:St({width:c(Q).siderCollapse?"calc(100vw - 219px)":"calc(100vw - 352px)"}),columns:le,data:g.value.debuggedDevieceList,size:"small","scroll-x":le.reduce((q,pt)=>q+pt.width,0),"row-key":q=>q.id,"max-height":350,pagination:X.pageSize==1?!1:X,remote:"","paginate-single-page":!1},null,8,["style","data","scroll-x","row-key","pagination"])):L("",!0),X.itemCount>1?(r(),k("div",Ao,[g.value.debuggedDevieceList.length==1?(r(),k("span",{key:0,onClick:Ee},[t[45]||(t[45]=p("更多")),a(se,{class:"font-size-20px"})])):(r(),k("span",{key:1,onClick:Ee},[t[46]||(t[46]=p("收起")),a(ge,{class:"font-size-20px"})]))])):L("",!0)]),_:2},1024)):L("",!0),ne.id==3?(r(),A(we,{key:2,title:"图纸",name:"3"},{default:s(()=>[a(Bt,{data:g.value.fileList,pid:m.pid,onGetData:t[4]||(t[4]=q=>Ct(m.pid)),typename:"图纸",fileType:1},null,8,["data","pid"])]),_:1})):L("",!0)]),_:2},1032,["expanded-names"]),ne==4?(r(),k("div",Vo)):L("",!0)],64)):L("",!0),Xe===1?(r(),k(Oe,{key:1},[a(at,{"expanded-names":At.value,"onUpdate:expandedNames":Xa,"trigger-areas":["arrow"]},{default:s(()=>[ne.id==1?(r(),A(we,{key:0,title:"待调试业务",name:"1"},{header:s(()=>[a(c(qe),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[f("div",qo,[t[48]||(t[48]=f("span",null,[p("待调试业务 "),f("span",{class:"c-#f0a020 font-bold"},"※")],-1)),je((r(),A(c(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:Lt(Rt,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[47]||(t[47]=p(" 添加待调试业务 "))]),_:1,__:[47]})),[[vt,"project:Debug:insert"]])]),Z.itemCount>0?(r(),k("div",Mo,"共"+B(Z.itemCount)+"条",1)):L("",!0)]),_:1})]),default:s(()=>[a(_i,{onSubmitted:t[5]||(t[5]=q=>Te(m.pid)),visible:Nt.value,"onUpdate:visible":t[6]||(t[6]=q=>Nt.value=q),pid:m.pid},null,8,["visible","pid"]),g.value.debuggedBusinessList.length>0?(r(),A(c(tt),{key:0,style:St({width:c(Q).siderCollapse?"calc(100vw - 219px)":"calc(100vw - 352px)"}),columns:Ke,data:g.value.debuggedBusinessList,size:"small","row-key":q=>q.id,striped:"","scroll-x":Ke.reduce((q,pt)=>q+pt.width,0),"paginate-single-page":!1,pagination:Z.pageSize==1?!1:Z,remote:"","max-height":350},null,8,["style","data","row-key","scroll-x","pagination"])):L("",!0),Z.itemCount>1?(r(),k("div",Oo,[g.value.debuggedBusinessList.length==1?(r(),k("span",{key:0,onClick:ze},[t[49]||(t[49]=p(" 更多 ")),a(se,{class:"font-size-20px"})])):(r(),k("span",{key:1,onClick:ze},[t[50]||(t[50]=p(" 收起 ")),a(ge,{class:"font-size-20px"})]))])):L("",!0)]),_:1})):L("",!0),ne.id===2&&c(P).userInfo.usertype!==1?(r(),A(we,{key:1,title:"需要开发",name:"2"},{header:s(()=>[a(c(qe),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[f("div",Ro,[t[52]||(t[52]=f("span",null,"需要开发",-1)),je((r(),A(c(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:Lt(jl,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[51]||(t[51]=p(" 添加需要开发 "))]),_:1,__:[51]})),[[vt,"project:Development:insert"]])]),Ae.itemCount>0?(r(),k("div",Jo,"共"+B(Ae.itemCount)+"条",1)):L("",!0)]),_:1})]),default:s(()=>[g.value.developBusinessList.length>0?(r(),A(c(tt),{key:0,columns:Pt,data:g.value.developBusinessList,size:"small","scroll-x":702,"row-key":q=>q.id,pagination:Ae.pageSize==1?!1:Ae,remote:"","paginate-single-page":!1,"max-height":350},null,8,["data","row-key","pagination"])):L("",!0),Ae.itemCount>1?(r(),k("div",Ho,[g.value.developBusinessList.length==1?(r(),k("span",{key:0,onClick:Jt},[t[53]||(t[53]=p(" 更多 ")),a(se,{class:"font-size-20px"})])):(r(),k("span",{key:1,onClick:Jt},[t[54]||(t[54]=p(" 收起 ")),a(ge,{class:"font-size-20px"})]))])):L("",!0)]),_:1})):L("",!0),ne.id===3&&c(P).userInfo.usertype!==1?(r(),A(we,{key:2,title:"客户需求变更",name:"3"},{header:s(()=>[a(c(qe),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[f("div",Go,[t[56]||(t[56]=f("span",null,"客户需求变更",-1)),je((r(),A(c(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:Lt(Je,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[55]||(t[55]=p(" 添加客户需求变更 "))]),_:1,__:[55]})),[[vt,"project:Customer:insert"]])]),Ve.itemCount>0?(r(),k("div",Wo,"共"+B(Ve.itemCount)+"条",1)):L("",!0)]),_:1})]),default:s(()=>[g.value.needsList.length>0?(r(),A(c(tt),{key:0,columns:Ul,data:g.value.needsList,size:"small","scroll-x":702,"row-key":q=>q.id,pagination:Ve.pageSize==1?!1:Ve,remote:"","paginate-single-page":!1,"max-height":350},null,8,["data","row-key","pagination"])):L("",!0),Ve.itemCount>1?(r(),k("div",Ko,[g.value.needsList.length==1?(r(),k("span",{key:0,onClick:ol},[t[57]||(t[57]=p(" 更多 ")),a(se,{class:"font-size-20px"})])):(r(),k("span",{key:1,onClick:ol},[t[58]||(t[58]=p(" 收起 ")),a(ge,{class:"font-size-20px"})]))])):L("",!0)]),_:1})):L("",!0),ne.id===4?(r(),A(we,{key:3,title:"文件",name:"4"},{default:s(()=>[a(Bt,{data:Kt.value,pid:m.pid,onGetData:t[7]||(t[7]=q=>Ct(m.pid)),typename:"项目文件",fileType:2},null,8,["data","pid"]),c(P).userInfo.usertype!==1?(r(),A(Bt,{key:0,data:Yt.value,pid:m.pid,onGetData:t[8]||(t[8]=q=>Ct(m.pid)),typename:"工程文件压缩包",fileType:3},null,8,["data","pid"])):L("",!0),c(P).userInfo.usertype!==1?(r(),A(Bt,{key:1,data:Qt.value,pid:m.pid,onGetData:t[9]||(t[9]=q=>Ct(m.pid)),typename:"项目现场照片",fileType:4},null,8,["data","pid"])):L("",!0),c(P).userInfo.usertype!==1?(r(),A(Bt,{key:2,data:Xt.value,pid:m.pid,onGetData:t[10]||(t[10]=q=>Ct(m.pid)),typename:"网络通讯简图",fileType:5},null,8,["data","pid"])):L("",!0),c(P).userInfo.usertype!==1?(r(),A(Bt,{key:3,data:Zt.value,pid:m.pid,onGetData:t[11]||(t[11]=q=>Ct(m.pid)),typename:"组态画面工程备份",fileType:6},null,8,["data","pid"])):L("",!0)]),_:1})):L("",!0)]),_:2},1032,["expanded-names"]),yt===4?(r(),k("div",Yo)):L("",!0)],64)):L("",!0),Xe===2?(r(),k(Oe,{key:2},[a(at,{"default-expanded-names":["1"],"trigger-areas":["arrow"]},{default:s(()=>[ne.id===1?(r(),A(we,{key:0,title:"验收文件",name:"1"},{default:s(()=>[a(Bt,{data:el.value,pid:m.pid,onGetData:t[12]||(t[12]=q=>Ct(m.pid)),typename:"验收确认单拍照",fileType:7},null,8,["data","pid"])]),_:1})):L("",!0)]),_:2},1024),yt===0?(r(),k("div",Qo)):L("",!0)],64)):L("",!0),Xe===3?(r(),k(Oe,{key:3},[ne.id===1?(r(),k("div",Xo,[je((r(),A(c(_),{size:"small",ghost:"",type:"primary",class:"w-160px",onClick:Lt(dl,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[59]||(t[59]=p(" 添加项目总结 "))]),_:1,__:[59]})),[[vt,"project:Customer:insert"]]),Ze.itemCount>0?(r(),k("div",Zo,"共"+B(Ze.itemCount)+"条",1)):L("",!0)])):L("",!0),a(c(tt),{class:"h-250px","max-height":250,remote:"",pagination:Ze.pageSize==1?!1:Ze,"scroll-x":Ht.reduce((q,pt)=>q+(pt.width||100),0),columns:Ht,data:Et.value,bordered:!1,"row-key":q=>q.id,"paginate-single-page":!1,"flex-height":!c(Q).isMobile},null,8,["pagination","scroll-x","data","row-key","flex-height"]),a(xs,{visible:$t.value,"onUpdate:visible":t[13]||(t[13]=q=>$t.value=q),onSubmitted:t[14]||(t[14]=q=>bt(m.pid)),"operate-type":(ll=dt.value)!=null&&ll.id?"edit":"add",pid:m.pid,showtype:"detail",pname:(al=ct.value.find(q=>q.id==m.pid))==null?void 0:al.proname,"row-data":dt.value},null,8,["visible","operate-type","pid","pname","row-data"]),a(ks,{visible:Bl.value,"onUpdate:visible":t[15]||(t[15]=q=>Bl.value=q),showtype:"detail","row-data":dt.value},null,8,["visible","row-data"])],64)):L("",!0),Xe===4?(r(),k(Oe,{key:4},[f("div",er,[je((r(),A(c(_),{size:"small",ghost:"",type:"primary",class:"w-160px",onClick:Lt(Ba,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[60]||(t[60]=p(" 添加项目日报 "))]),_:1,__:[60]})),[[vt,"project:Customer:insert"]]),ut.itemCount>0?(r(),k("div",tr,"共"+B(ut.itemCount)+"条",1)):L("",!0)]),a(c(tt),{class:"h-350px","max-height":350,remote:"",pagination:ut.pageSize==1?!1:ut,"scroll-x":Zl.reduce((q,pt)=>q+(pt.width||100),0),columns:Zl,data:Fl.value,bordered:!1,"row-key":q=>q.id,"paginate-single-page":!1,"flex-height":!c(Q).isMobile},null,8,["pagination","scroll-x","data","row-key","flex-height"]),a(za,{visible:pl.value,"onUpdate:visible":t[16]||(t[16]=q=>pl.value=q),onSubmitted:t[17]||(t[17]=q=>cl(m.pid)),"operate-type":(nl=dt.value)!=null&&nl.id?"edit":"add",pid:m.pid,pname:(Ut=ct.value.find(q=>q.id==m.pid))==null?void 0:Ut.proname,showtype:"detail","row-data":dt.value},null,8,["visible","operate-type","pid","pname","row-data"]),a(cs,{visible:ea.value,"onUpdate:visible":t[18]||(t[18]=q=>ea.value=q),showtype:"detail","row-data":dt.value},null,8,["visible","row-data"])],64)):L("",!0),Xe===5?(r(),k(Oe,{key:5},[f("div",lr,[f("div",null,"共"+B(Gt.value.length)+"条",1)]),a(c(tt),{"max-height":150,style:St({height:Gt.value.length==1?"100px":"160px"}),remote:"","scroll-x":la.reduce((q,pt)=>q+(pt.width||100),0),columns:la,data:Gt.value,bordered:!1,"row-key":q=>q.id,"paginate-single-page":!1,"flex-height":!c(Q).isMobile},null,8,["style","scroll-x","data","row-key","flex-height"])],64)):L("",!0)],8,Fo)])}),128))],512),[[Xn,Ne.show]])]),_:2},1024)]))),128))])])])),[[en,Il.value]])]),_:1}),a(jt,{show:tl.value,"onUpdate:show":t[19]||(t[19]=Ne=>tl.value=Ne),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:s(()=>[p(B(zt.value=="debuggedDevieceList"?"待调试设备":zt.value=="debuggedBusinessList"?"待调试业务":zt.value=="needsList"?"客户需求变更":zt.value=="developBusinessList"?"需要开发":"")+" 文件列表 ",1)]),footer:s(()=>[a(c(qe),{justify:"end"},{default:s(()=>[a(c(_),{size:"small",class:"mt-16px",onClick:Wa},{default:s(()=>[p(B(c(ee)("common.cancel")),1)]),_:1}),a(c(_),{type:"primary",size:"small",class:"mt-16px",onClick:Ga},{default:s(()=>[p(B(c(ee)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(c(tt),{columns:Ha,"paginate-single-page":!1,data:_t.value,"max-height":350},null,8,["data"])]),_:1},8,["show"]),a(et,{show:oa.value,"onUpdate:show":t[20]||(t[20]=Ne=>oa.value=Ne),"display-directive":"show",width:700},{default:s(()=>[a(nt,{title:"日报","native-scrollbar":!1,closable:""},{default:s(()=>{var Ne;return[a(ni,{type:"detail",pid:m.pid,pname:((Ne=ct.value.find(Xe=>Xe.id==m.pid))==null?void 0:Ne.proname)||"",style:{height:"100%"}},null,8,["pid","pname"])]}),_:1})]),_:1},8,["show"]),a(Cs,{visible:ql.value,"onUpdate:visible":t[21]||(t[21]=Ne=>ql.value=Ne),pid:m.pid},null,8,["visible","pid"])])}}}),$r=Cl(ar,[["__scopeId","data-v-3ff914b8"]]);export{$r as default};
