import{_ as Q,l as Z}from"./lodash-BOEMR3ZM.js";import{d as W,q as F,j as h,s as ee,x as ae,o as J,c as te,w as r,g as l,i as _,$ as x,X as le,h as G,t as j,G as ne,aF as oe,aw as k,ax as H,a0 as re,K as ie,B,O as X,P as se,ad as Y,a4 as ue,r as K,av as de,D as pe,e as ce,ai as ve,aY as ge,aj as me,T as fe}from"./index-D7mQqpt0.js";import{_ as he}from"./round-search-Dx84b4UW.js";import{_ as Ie}from"./round-refresh-Cb-JvNfU.js";import{u as _e}from"./usePageData-DsxhjksL.js";import{a as ye,T as q}from"./basicconf-Cxugr5e7.js";import{f as we}from"./system-manage-BzSxbh82.js";import{_ as Se}from"./DatePicker-Cb-sWowM.js";import{_ as Ae}from"./Cascader-CDpxVBAZ.js";import{_ as be}from"./FormItemGridItem-CRYgfShT.js";import{_ as Oe}from"./Grid-2onT2uBK.js";import{_ as xe}from"./originlogInfo.vue_vue_type_script_setup_true_lang-DiopM6aH.js";import{e as Ee}from"./exportExcel-D6OyA9oJ.js";import{A as De,u as ke}from"./events-AJQSVGVR.js";import{b as Le,f as Ce,a as Te}from"./common-BNPEQwc1.js";import"./TimePicker-tRvpBH9e.js";import"./defineProperty-BIyzosjY.js";import"./DescriptionsItem-DxSt7xE4.js";import"./CollapseItem-DwNRHxeg.js";const Pe=W({name:"FormSearch",__name:"form-search",props:F(["eventsTypeDataList","LogSourceDeviceList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:F(["search"],["update:model"]),setup(w,{emit:V}){const S=w,I=V;h(0);const{formRef:P,restoreValidation:R}=ee(),e=ae(w,"model"),{pageData:L,getData:M,nextPage:z}=_e(we),C=async f=>{const n=f.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&L.data.length<L.total&&z()};M();async function $(){await R(),e.value.etypeid=null,e.value.elevel=null,e.value.rtime=null,e.value.user=null,e.value.logodid=null,e.value.target=null,e.value.startAndEndOriginIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.expression=null,e.value.startOriginIp=null,e.value.endOriginIp=null,e.value.startAimOriginIp=null,e.value.endAimOriginIp=null,e.value.startSourceIp=null,e.value.endSourceIp=null,oe(()=>{I("search")})}const N=f=>{e.value.elevel=f,g()},A=(f,n)=>{e.value.rtime=n,g()},u=f=>{e.value.logodid=f,g()},T=()=>{e.value.startAndEndOriginIp=null,g()},o=()=>{e.value.startAndEndSourceIp=null,g()},U=()=>{e.value.startAndEndAimSourceIp=null,g()};async function g(){var f,n,m,p,O,E,y,D,a,t,i,c;if(e.value.startAndEndOriginIp&&e.value.startAndEndOriginIp.length>0?(e.value.startOriginIp=e.value.startAndEndOriginIp[0]||null,e.value.endOriginIp=e.value.startAndEndOriginIp[1]||null):(e.value.startOriginIp=null,e.value.endOriginIp=null),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimOriginIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimOriginIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimOriginIp=null,e.value.endAimOriginIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=null,e.value.endSourceIp=null),e.value.startOriginIp&&!k(e.value.startOriginIp)||e.value.endOriginIp&&!k(e.value.endOriginIp))return(f=window.$message)==null||f.destroyAll(),(n=window.$message)==null||n.error("请输入正确的IP地址"),!1;if(e.value.startOriginIp&&e.value.endOriginIp&&H(e.value.startOriginIp,e.value.endOriginIp)>0)return(m=window.$message)==null||m.destroyAll(),(p=window.$message)==null||p.error("起始IP不能大于终止IP"),!1;if(e.value.startAimOriginIp&&!k(e.value.startAimOriginIp)||e.value.endAimOriginIp&&!k(e.value.endAimOriginIp))return(O=window.$message)==null||O.destroyAll(),(E=window.$message)==null||E.error("请输入正确的IP地址"),!1;if(e.value.startAimOriginIp&&e.value.endAimOriginIp&&H(e.value.startAimOriginIp,e.value.endAimOriginIp)>0)return(y=window.$message)==null||y.destroyAll(),(D=window.$message)==null||D.error("起始IP不能大于终止IP"),!1;if(e.value.startSourceIp&&!k(e.value.startSourceIp)||e.value.endSourceIp&&!k(e.value.endSourceIp))return(a=window.$message)==null||a.destroyAll(),(t=window.$message)==null||t.error("请输入正确的IP地址"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&H(e.value.startSourceIp,e.value.endSourceIp)>0)return(i=window.$message)==null||i.destroyAll(),(c=window.$message)==null||c.error("起始IP不能大于终止IP"),!1;I("search")}const b=Q.throttle(g,1e3,{trailing:!1});return(f,n)=>{const m=Ae,p=be,O=re,E=Se,y=ie,D=Ie,a=B,t=he,i=X,c=Oe,v=se,d=Y;return J(),te(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[l(v,{ref_key:"formRef",ref:P,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(_(b),["enter"])},{default:r(()=>[l(c,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:r(()=>[l(p,{span:"24 s:24 m:8 l:6",label:"事件类型",path:"etypeid"},{default:r(()=>[l(m,{value:e.value.etypeid,"onUpdate:value":[n[0]||(n[0]=s=>e.value.etypeid=s),u],clearable:"",placeholder:"请选择事件","max-tag-count":1,options:S.eventsTypeDataList,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),l(p,{span:"24 s:24 m:8 l:6",label:_(x)("page.manage.alarm.level"),path:"elevel"},{default:r(()=>[l(O,{filterable:"",clearable:"",placeholder:_(x)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[n[1]||(n[1]=s=>e.value.elevel=s),N],"reset-menu-on-options-change":!1,options:_(le)(_(ye))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),l(p,{span:"24 s:24 m:8 l:6",label:"接收时间",path:"rtime"},{default:r(()=>[l(E,{placeholder:"请选择接收时间","formatted-value":e.value.rtime,"onUpdate:formattedValue":n[2]||(n[2]=s=>e.value.rtime=s),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:"",style:{width:"100%"},"onUpdate:value":A},null,8,["formatted-value"])]),_:1}),l(p,{span:"24 s:24 m:8 l:6",label:"用户",path:"user"},{default:r(()=>[l(O,{value:e.value.user,"onUpdate:value":n[3]||(n[3]=s=>e.value.user=s),placeholder:"请选择用户",clearable:"",filterable:"","value-field":"id","label-field":"username",options:_(L).data,"reset-menu-on-options-change":!1,onScroll:C},null,8,["value","options"])]),_:1}),l(p,{span:"24 s:24 m:10 l:8",label:"源IP",path:"startAndEndOriginIp"},{default:r(()=>[l(y,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndOriginIp,"onUpdate:value":n[4]||(n[4]=s=>e.value.startAndEndOriginIp=s),onClear:T},null,8,["value"])]),_:1}),l(p,{span:"24 s:24 m:10 l:8",label:"目的IP",path:"startAndEndAimSourceIp"},{default:r(()=>[l(y,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":n[5]||(n[5]=s=>e.value.startAndEndAimSourceIp=s),onClear:U},null,8,["value"])]),_:1}),l(p,{span:"24 s:24 m:10 l:8",label:"发生源IP",path:"startAndEndSourceIp"},{default:r(()=>[l(y,{pair:"",separator:"-",disabled:S.logsoudev,placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":n[6]||(n[6]=s=>e.value.startAndEndSourceIp=s),onClear:o},null,8,["disabled","value"])]),_:1}),l(p,{span:"24 s:24 m:8 l:6",label:"日志源设备",path:"logodid"},{default:r(()=>[l(m,{disabled:S.logsoudev,value:e.value.logodid,"onUpdate:value":[n[7]||(n[7]=s=>e.value.logodid=s),g],placeholder:"请选择日志源设备",options:S.LogSourceDeviceList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["disabled","value","options"])]),_:1}),l(p,{span:"24 s:24 m:8 l:6",label:"目标对象",path:"target"},{default:r(()=>[l(y,{placeholder:"请输入目标对象",value:e.value.target,"onUpdate:value":n[8]||(n[8]=s=>e.value.target=s),clearable:""},null,8,["value"])]),_:1}),l(p,{span:"24 s:24 m:8 l:6"},{default:r(()=>[l(i,{class:"w-full"},{default:r(()=>[l(a,{onClick:$},{icon:r(()=>[l(D,{class:"text-icon"})]),default:r(()=>[G(" "+j(_(x)("common.reset")),1)]),_:1}),l(a,{type:"primary",ghost:"",onClick:_(b)},{icon:r(()=>[l(t,{class:"text-icon"})]),default:r(()=>[G(" "+j(_(x)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),$e={class:"min-h-500px flex-col-stretch overflow-hidden lt-sm:overflow-auto"};function Ne(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!ve(w)}const Ue=W({name:"eventalarm_originlog",__name:"index",props:{logsoudev:{},aip:{}},setup(w){const V=ue(),S=h(window.innerHeight-395),I=w,P=h([]);(async()=>{const{data:a,error:t}=await Le();t||(P.value=a.map(i=>({...i,id:"+"+i.id,type:i.cname})))})();const e=h([]),L=h([]);async function M(){const{data:a,error:t}=await Ce();t||(e.value=a,await z())}async function z(){const{data:a,error:t}=await Te();if(!t){L.value=a;let i=e.value.concat(a);e.value=ge(i)}}M();const C=h(!1),$=h(),N=h(),A=h(!1),u=K({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),T=[{title:"",key:"key",width:80,render:(a,t)=>`${t+1}`},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"elevel",title:"事件等级",align:"center",width:120,render:a=>{(a.elevel===void 0||a.elevel===null)&&(a.elevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},i=x(q[a.elevel]);let c={color:t[a.elevel],textColor:"#ffffff",borderColor:t[a.elevel]};return l(de,{size:"small",color:c},Ne(i)?i:{default:()=>[i]})}},{key:"cname",title:"设备类别",align:"center",width:180},{key:"type",title:"设备类型",align:"center",width:180},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"sourceip",title:"发生源IP",align:"center",width:180},{key:"prifinallog",title:"日志原文",align:"center",width:240,ellipsis:{tooltip:!0}},{key:"operate",title:x("common.operate"),align:"center",width:100,fixed:"right",render:a=>l("div",{class:"flex-center gap-8px"},[l(B,{type:"info",ghost:!0,size:"small",onClick:()=>O(a)},{default:()=>[G("详情")]})])}],o=h([]),U=h(0),g=async(a=!1)=>{if(!A.value)A.value=!0;else return;A.value=!0,I.logsoudev&&I.aip&&(b.value=!1,u.logodid=I.logsoudev,u.startAndEndSourceIp=[I.aip,I.aip],u.startSourceIp=I.aip,u.endSourceIp=I.aip);const{data:t,error:i}=await ke(u);i||(U.value=t.length,a?o.value=[...o.value,...t]:o.value=t,A.value=!1)},b=h(!0),f=async()=>{o.value=[],u.pageId=void 0,(t=>Object.keys(t).filter(v=>v!=="limit"&&v!=="_t").some(v=>t[v]!==void 0&&t[v]!==""&&t[v]!==null))(u)?b.value=!1:(b.value=!0,p()),u.pageId=void 0,await g(),n()},n=async()=>{var a,t;if(o.value.length<S.value/44&&o.value.length<m.total){if(u.pageId==o.value[o.value.length-1].id)return;u.pageId=((t=(a=o.value)==null?void 0:a[o.value.length-1])==null?void 0:t.id)??void 0,g(!0)}};pe(async()=>{await g(),await p(),n()});const m=K({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:t,page:i,pageSize:c,pageCount:v,itemCount:d}){return`已加载${o.value.length}条`+(o.value.length?b.value?` 共计 ${o.value.length>0?d??0:0} 条`:U.value==u.limit?"  预计还有更多":"  没有更多了":"")}});async function p(){const{data:a,error:t}=await De();t||(m.pageCount=20,m.total=Number(a),m.itemCount=Number(a))}const O=a=>{$.value=a.id,N.value=a,C.value=!0};function E(a){Math.abs(a.target.scrollTop+a.target.offsetHeight-a.target.scrollHeight)<=20&&m.total>o.value.length&&y()}const y=Z.debounce(()=>{var a;if(((a=o.value)==null?void 0:a.length)<m.total){if(u.pageId==o.value[o.value.length-1].id)return;u.pageId=o.value[o.value.length-1].id,g(!0)}},300);async function D(){if(!o.value.length)return;const a=JSON.parse(JSON.stringify(o.value)),t=[];a.forEach(c=>{const v={};T.forEach(d=>{if(c.hasOwnProperty(d.key)){const s=d.key=="elevel"?x(q[c[d.key]]):c[d.key];v[d.title]=s}}),t.push(v)}),Ee(t,500,[{wpx:120},{wpx:120},{wpx:80},{wpx:100},{wpx:100},{wpx:120},{wpx:100},{wpx:500}],"原始日志_"+new Date().getTime())}return(a,t)=>{const i=X,c=me,v=Y;return J(),ce("div",$e,[l(Pe,{model:u,"onUpdate:model":t[0]||(t[0]=d=>u=d),onSearch:f,eventsTypeDataList:e.value,LogSourceDeviceList:P.value,class:"mb-16px",logsoudev:I.logsoudev},null,8,["model","eventsTypeDataList","LogSourceDeviceList","logsoudev"]),l(v,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":r(()=>[l(i,null,{default:r(()=>[l(_(B),{type:"primary",size:"small",ghost:"",onClick:D,title:"导出已加载"},{default:r(()=>[G("导出已加载")]),_:1})]),_:1})]),default:r(()=>[l(c,{columns:T,data:o.value,size:"small","flex-height":!_(V).isMobile,loading:A.value,remote:"","row-key":d=>d.id,"virtual-scroll":"","scroll-x":T.reduce((d,s)=>d+s.width,0),pagination:m,class:"sm:h-full",onScroll:E,"max-height":S.value},null,8,["data","flex-height","loading","row-key","scroll-x","pagination","max-height"])]),_:1}),l(xe,{detailVisible:C.value,"onUpdate:detailVisible":t[1]||(t[1]=d=>C.value=d),detailId:$.value,detailInfo:N.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),ta=fe(Ue,[["__scopeId","data-v-845762af"]]);export{ta as default};
