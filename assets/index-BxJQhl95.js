import{j as U,b as E,k as ie,m as ce,d as q,n as W,p as G,u as le,a as H,q as J,r as O,s as Q,v as de,x as D,y as ue,o as v,c as L,w as h,g as m,z as K,i as g,$ as y,A as F,f as S,C as T,h as z,t as P,D as pe,E as me,F as $,G as fe,H as ge,I as Y,J as Z,K as _e,B as ee,L as oe,M as te,N as he,O as we,P as A,Q as ve,R as ye,S as ke,T as xe,U as Ce,V as Se,W as Pe,X as be,Y as Re,e as x,Z as Ee,a0 as Ue,a1 as j,a2 as Le}from"./index-KeVZZYr1.js";function Ne(s){const c=U(0),w=E(()=>Math.ceil(c.value/60)),l=E(()=>c.value>0),{pause:t,resume:e}=ie(()=>{c.value>0?c.value-=1:t()},{immediate:!1});function n(r=s){c.value=60*r,e()}function a(){c.value=0,t()}return ce(()=>{t()}),{count:w,isCounting:l,start:n,stop:a}}/*! js-cookie v3.0.5 | MIT */function N(s){for(var i=1;i<arguments.length;i++){var c=arguments[i];for(var w in c)s[w]=c[w]}return s}var Ie={read:function(s){return s[0]==='"'&&(s=s.slice(1,-1)),s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(s){return encodeURIComponent(s).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function V(s,i){function c(l,t,e){if(!(typeof document>"u")){e=N({},i,e),typeof e.expires=="number"&&(e.expires=new Date(Date.now()+e.expires*864e5)),e.expires&&(e.expires=e.expires.toUTCString()),l=encodeURIComponent(l).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var n="";for(var a in e)e[a]&&(n+="; "+a,e[a]!==!0&&(n+="="+e[a].split(";")[0]));return document.cookie=l+"="+s.write(t,l)+n}}function w(l){if(!(typeof document>"u"||arguments.length&&!l)){for(var t=document.cookie?document.cookie.split("; "):[],e={},n=0;n<t.length;n++){var a=t[n].split("="),r=a.slice(1).join("=");try{var d=decodeURIComponent(a[0]);if(e[d]=s.read(r,d),l===d)break}catch{}}return l?e[l]:e}}return Object.create({set:c,get:w,remove:function(l,t){c(l,"",N({},t,{expires:-1}))},withAttributes:function(l){return V(this.converter,N({},this.attributes,l))},withConverter:function(l){return V(N({},this.converter,l),this.attributes)}},{attributes:{value:Object.freeze(i)},converter:{value:Object.freeze(s)}})}var se=V(Ie,{path:"/"});const B=(s,i,c)=>{se.set(s,i)},I=s=>se.get(s),ze=s=>(he("data-v-1e98859c"),s=s(),we(),s),$e={class:"w-full flex-y-center gap-16px"},je=["src"],Me={class:"flex-y-center justify-between updatePsd"},De=ze(()=>S("div",{style:{display:"flex","justify-content":"right","align-items":"center"}},null,-1)),Fe=q({name:"PwdLogin",__name:"pwd-login",props:{status:{type:String,required:!0},statusModifiers:{}},emits:W(["getUsername"],["update:status"]),setup(s,{emit:i}){const c=G(s,"status"),w=le();H();const{formRef:l,validate:t}=J(),e=O({username:"",captcha:"",password:""}),n=O({uuid:"",captchaSrc:"",captchaEnable:0,checked:!1});async function a(){const{data:o,error:p}=await pe();p||(n.captchaEnable=o,n.captchaEnable==1&&r())}async function r(){n.uuid=D(),n.captchaSrc=me+"/captcha?uuid="+n.uuid;const o=D(),p=Date.now().toString(),C=$(`${o}${p}`);fe.get(n.captchaSrc,{headers:{"X-Nonce":o,"X-Timestamp":p,"X-Signature":C},responseType:"blob"}).then(b=>{const M=URL.createObjectURL(b.data);n.captchaSrc=M}).catch(b=>{console.error("Error:",b)})}const d=E(()=>{const{formRules:o}=Q();return{username:o.username,captcha:o.captcha,password:o.password1}});async function u(){var p;await t(),n.checked?f(e.username,$(e.password),n.checked):k();const o=await w.login(e.username,e.password,e.captcha.trim(),n.uuid);console.log(o),((p=o==null?void 0:o.data)==null?void 0:p.login)===0&&setTimeout(()=>{const C=new CustomEvent("myCustomEvent");document.dispatchEvent(C)},1e3),o=="fail"&&n.captchaEnable==1&&(e.captcha="",r())}function f(o,p,C){B("power-prediction_user",o),B("power-prediction_pwd",p),B("power-prediction_check",String(C))}function _(){e.username=I("power-prediction_user")||"";const o=I("power-prediction_pwd")||"";e.password=ge(o).substring(16),c.value=="pwd-login1"&&(e.password=""),n.checked=I("power-prediction_check")?I("power-prediction_check")=="true":!1}function k(){f("","",!1)}return U(!1),de(()=>{n.uuid=D(),_(),a()}),(o,p)=>{const C=Y,b=Z,M=_e,ne=ee,ae=oe,re=te,X=ue("no-space");return v(),L(re,{ref_key:"formRef",ref:l,model:e,rules:d.value,size:"large","show-label":!1},{default:h(()=>[m(b,{path:"userName"},{default:h(()=>[K(m(C,{autofocus:"",value:e.username,"onUpdate:value":p[0]||(p[0]=R=>e.username=R),placeholder:g(y)("page.login.common.userNamePlaceholder"),onKeyup:F(u,["enter"])},null,8,["value","placeholder"]),[[X]])]),_:1}),m(b,{path:"password"},{default:h(()=>[K(m(C,{value:e.password,"onUpdate:value":p[1]||(p[1]=R=>e.password=R),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:g(y)("page.login.common.passwordPlaceholder"),onKeyup:F(u,["enter"])},null,8,["value","placeholder"]),[[X]])]),_:1}),n.captchaEnable==1?(v(),L(b,{key:0,path:"captcha"},{default:h(()=>[S("div",$e,[m(C,{value:e.captcha,"onUpdate:value":p[2]||(p[2]=R=>e.captcha=R),placeholder:"请输入验证码",onKeyup:F(u,["enter"])},null,8,["value"]),S("img",{src:n.captchaSrc,alt:"captcha",style:{height:"40px"},onClick:r},null,8,je)])]),_:1})):T("",!0),m(ae,{vertical:"",size:8},{default:h(()=>[S("div",Me,[m(M,{checked:n.checked,"onUpdate:checked":p[3]||(p[3]=R=>n.checked=R)},{default:h(()=>[z(P(g(y)("page.login.pwdLogin.rememberMe")),1)]),_:1},8,["checked"])]),m(ne,{type:"primary",size:"large",ghost:"",round:"",block:"",loading:g(w).loginLoading,onClick:u},{default:h(()=>[z(P(g(y)("common.confirm")),1)]),_:1},8,["loading"]),De]),_:1})]),_:1},8,["model","rules"])}}}),Be=A(Fe,[["__scopeId","data-v-1e98859c"]]);function Oe(){const{loading:s,startLoading:i,endLoading:c}=ve(),{count:w,start:l,stop:t,isCounting:e}=Ne(60),n=E(()=>{let d=y("page.login.codeLogin.getCode");const u=y("page.login.codeLogin.reGetCode",{time:w.value});return s.value&&(d=""),e.value&&(d=u),d});function a(d){var u,f,_,k;return d.trim()===""?((f=(u=window.$message)==null?void 0:u.error)==null||f.call(u,y("form.mobile.required")),!1):ke.test(d)?!0:((k=(_=window.$message)==null?void 0:_.error)==null||k.call(_,y("form.mobile.invalid")),!1)}async function r(d,u){!a(d)||s.value||(i(),await new Promise(_=>{ye(d,u).then(k=>{var o,p;console.log("response",k),k.error||(setTimeout(_,500),(p=(o=window.$message)==null?void 0:o.success)==null||p.call(o,y("page.login.codeLogin.sendCodeSuccess")),l(),c())}).catch(k=>{var o,p;return console.log("error",k),(p=(o=window.$message)==null?void 0:o.error)==null||p.call(o,y("page.login.codeLogin.sendCodeFailed")),!1})}))}return{label:n,start:l,stop:t,isCounting:e,loading:s,getCaptcha:r}}const Te=q({name:"ResetPwd",__name:"reset-pwd",props:W({username:{type:String,required:!0}},{status:{type:String,required:!0},statusModifiers:{}}),emits:["update:status"],setup(s){const i=G(s,"status"),c=s;H();const{formRef:w,validate:l}=J();Oe();const t=O({username:c.username||"",oripwd:"",code:"",password:"",confirmPassword:""}),e=E(()=>{const{formRules:a,createConfirmPwdRule:r,defaultRequiredRule:d}=Q();return{username:a.username,oripwd:a.password,password:[{...d},{asyncValidator:(u,f)=>f==""||f==null?Promise.resolve():xe(f)?t.username&&f.toLocaleLowerCase().includes(t.username.toLocaleLowerCase())?Promise.reject("密码禁止与用户名相同或包含用户名(不区分大小写)"):t.password==t.oripwd?Promise.reject("新密码不能与旧密码相同"):Promise.resolve():Promise.reject("密码应符合：大、小写字母、数字、特殊字符的三种或以上的组合"),trigger:["blur","input"]}],code:a.code,confirmPassword:r(t.password)}});async function n(){var f,_;await l();const a=await $(t.oripwd),r=await $(t.password),{data:d,error:u}=await Ce(t.username,a,r);console.log("data",d),u?(_=window.$message)==null||_.error("修改失败"):((f=window.$message)==null||f.success("修改成功"),i.value="pwd-login1")}return(a,r)=>{const d=Y,u=Z,f=ee,_=oe,k=te;return v(),L(k,{ref_key:"formRef",ref:w,model:t,rules:e.value,size:"large","show-label":!1},{default:h(()=>[m(u,{path:"username"},{default:h(()=>[m(d,{value:t.username,"onUpdate:value":r[0]||(r[0]=o=>t.username=o),placeholder:g(y)("page.login.common.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1}),m(u,{path:"oripwd"},{default:h(()=>[m(d,{value:t.oripwd,"onUpdate:value":r[1]||(r[1]=o=>t.oripwd=o),type:"password","show-password-on":"click",placeholder:"请输入原密码"},null,8,["value"])]),_:1}),m(u,{path:"password"},{default:h(()=>[m(d,{value:t.password,"onUpdate:value":r[2]||(r[2]=o=>t.password=o),type:"password","show-password-on":"click",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),m(u,{path:"confirmPassword"},{default:h(()=>[m(d,{value:t.confirmPassword,"onUpdate:value":r[3]||(r[3]=o=>t.confirmPassword=o),type:"password","show-password-on":"click",placeholder:g(y)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1}),m(_,{vertical:"",size:18,class:"w-full"},{default:h(()=>[m(f,{type:"primary",size:"large",ghost:"",round:"",block:"",onClick:n},{default:h(()=>[z(P(g(y)("common.confirm")),1)]),_:1}),m(f,{size:"large",ghost:"",round:"",block:"",onClick:r[4]||(r[4]=o=>i.value="pwd-login"),class:"c-#fff"},{default:h(()=>[z(P(g(y)("page.login.common.back")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),Ve=A(Te,[["__scopeId","data-v-5c916aca"]]),qe={class:"w-400px lt-sm:w-300px"},Ae={class:"flex-y-center justify-center"},Xe={key:0,src:j,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},Ke={key:1,src:j,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},We={key:2,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},Ge={key:3,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},He={class:"pt-24px"},Je={class:"pt-16px"},Qe={class:"flex justify-center items-center",style:{position:"fixed",top:"20px",right:"20px","z-index":"999"}},Ye={key:0,src:j,alt:"Linkqi",class:"w-100px pr-10px"},Ze={key:1,src:j,alt:"Linkqi",class:"w-100px pr-10px"},eo={key:2,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},oo={key:3,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},to={key:0,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},so={key:1,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},no=q({name:"login",__name:"index",props:{module:{}},setup(s){Se();const i=Pe(),c=U("pwd-login");E(()=>i.darkMode?be(i.themeColor,600):i.themeColor);const w=U(""),l=a=>{w.value=a},t=E(()=>{const a="#ffffff",r=i.darkMode?.5:.2;return Re(a,i.themeColor,r)}),e=U();return(async()=>{fetch("/version.json").then(a=>a.json()).then(a=>{e.value=a}).catch(a=>{console.error("Error fetching version.json:",a)})})(),(a,r)=>{var u,f;const d=Le;return v(),x("div",{class:"relative size-full flex-center overflow-hidden login",style:Ue({backgroundColor:t.value})},[m(d,{bordered:!1,class:"relative z-4 w-auto rd-12px loginClass","content-style":{padding:"24px 36px"}},{default:h(()=>[S("div",qe,[S("header",Ae,[g(i).darkMode?(v(),x("img",Ke)):(v(),x("img",Xe)),g(i).darkMode?(v(),x("h3",We,P(g(y)("system.title")),1)):(v(),x("h3",Ge,P(g(y)("system.title")),1))]),S("main",He,[S("div",Je,[m(Ee,{name:g(i).page.animateMode,mode:"out-in",appear:""},{default:h(()=>[c.value=="pwd-login"||c.value=="pwd-login1"?(v(),L(Be,{key:0,status:c.value,"onUpdate:status":r[0]||(r[0]=_=>c.value=_),onGetUsername:l},null,8,["status"])):(v(),L(Ve,{key:1,status:c.value,"onUpdate:status":r[1]||(r[1]=_=>c.value=_),username:w.value},null,8,["status","username"]))]),_:1},8,["name"])])])])]),_:1}),S("div",Qe,[g(i).darkMode?(v(),x("img",Ze)):(v(),x("img",Ye)),g(i).darkMode?(v(),x("span",eo,P(((u=e.value)==null?void 0:u.ver)||"V1.1.6"),1)):(v(),x("span",oo,P(((f=e.value)==null?void 0:f.ver)||"V1.1.6"),1))]),g(i).darkMode?T("",!0):(v(),x("div",to," Copyright (c) 2025 · 杭州领祺科技有限公司")),g(i).darkMode?(v(),x("div",so," Copyright (c) 2025 · 杭州领祺科技有限公司")):T("",!0)],4)}}}),ro=A(no,[["__scopeId","data-v-3d33f339"]]);export{ro as default};
