import{aq as S,d as Ue,q as We,r as k,bZ as ne,i as Te,y as Le,b as y,o as c,f as o,e as u,w as s,G as Ne,F as oe,h as a,az as Pe,N as Ae,B as h,g as p,t as m,U as I,z as b,ax as qe,c as g,bG as Re,aT as se,aX as ae,D as A,aS as Be,V as De,T as Ee,C as W,cI as Ge,c_ as Fe,A as Ie,c$ as Me,aA as Ve,aB as Je,aE as Oe,aH as le,aJ as Ke,b4 as He,aM as Xe}from"./index-y_CfkRcC.js";import{_ as Ze,a as Qe,b as Ye,c as et}from"./edit-CeS8ySJd.js";import{_ as tt}from"./round-search-D3YN4W0D.js";import{u as nt}from"./usePageData-Bc0LzTXb.js";import{_ as ot}from"./Grid-Ds6V98x7.js";import{_ as st}from"./FormItemGridItem-B1TTqIMk.js";import{_ as M,a as at}from"./text-D6DDYe2C.js";import{N as lt}from"./Popconfirm-dwqbpujW.js";function it(v){return S({url:"/projectWeek/getPage.do",method:"get",params:v})}function rt(v){return S({url:"/projectWeek/insert.do",method:"post",data:v})}function ct(v){return S({url:"/projectWeek/update.do",method:"put",data:v})}function ut(v){return S({url:"/projectWeek/delete.do",method:"delete",params:{arrIds:v}})}function dt(v){return S({url:"/projectWeekComment/getPage.do",method:"get",params:v})}function pt(v){return S({url:"/projectWeekComment/insert.do",method:"post",data:v})}function mt(v){return S({url:"/projectWeekComment/delete.do",method:"delete",params:{arrIds:v}})}const ft={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto p-20px"},_t={style:{display:"flex",height:"100%"}},vt={key:1},yt={class:"flex items-center"},gt={class:"flex items-center"},wt={class:"flex-col ml-10px"},ht={class:"font-size-18px font-bold"},xt={class:"c-#868e96 font-size-14px"},kt={key:0},bt={class:"mt-3 mb-3 text-gray-700 preview-text"},Ct={class:"mt-3 mb-3 text-gray-700 preview-text"},$t={class:"mt-3 mb-3 text-gray-700 preview-text"},zt={class:"mt-3 mb-3 text-gray-700 preview-text"},St={class:"mt-3 mb-3 text-gray-700 preview-text"},jt={key:1,class:"mt-3 mb-3 text-gray-700 preview-text"},Ut={key:2,class:"mt-3 mb-3 text-gray-700 preview-text"},Wt={key:1,class:"mt-1 flex items-center gap-3 text-sm text-gray-500"},Tt=["onClick"],Lt={key:0,class:"mt-4 border-t pt-3"},Nt={class:"flex items-start gap-2 mb-3"},Pt={class:"ml-2 flex-1"},At={class:"flex items-center"},qt={class:"font-medium font-size-16px font-bold"},Rt={class:"text-gray-600 mt-1"},Bt={key:0,style:{display:"flex","justify-content":"flex-end","margin-top":"10px"}},Dt={key:0,class:"relative inline-block group"},Et={key:0,class:""},Gt={key:1,class:"flex items-center w-300px"},Ft=Ue({name:"projectmanagement_memberlog",__name:"index",setup(v){const V=We(),T=k({creater:void 0}),{pageData:L,getData:ie,nextPage:re}=nt(He),ce=async n=>{const e=n.currentTarget,l=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&L.data.length<L.total&&(await re(),await le(),setTimeout(()=>{e.scrollTop=l}))},ue=async n=>{T.value.creater=n,C()},de=async()=>{ie({usertypes:"2,3"}),L.data=L.data.map(n=>(n.avatar="https://cdn-icons-png.flaticon.com/128/3135/3135715.png",n))},B={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},pe={content1:{required:!0,message:"请输入",trigger:"blur"}},D=k("add"),N=k(!1),E=k(-1),$=k([]),w=k({page:1,limit:10,total:0}),G=k(null),r=k({id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}),me=n=>{w.value.page=n,C()},fe=n=>{w.value.limit=n,C()},C=async()=>{const{data:n,error:e}=await it({page:w.value.page,limit:w.value.limit,creater:T.value.creater});n&&($.value=n.list.map((l,i)=>(E.value!=i?l.showAll=!1:l.showAll=!0,l.showCommentSection=!1,l)),w.value.total=n.total)},j=k(0);async function J({file:n},e){const l=await Ke(n.file,n.name,"",i=>{j.value=i});l&&(console.log("文件上传成功"),e=="file1"?r.value.file1=l:r.value.file2=l,j.value=0)}async function O(n,e){var l,i,d;return e=="file1"&&!["image/jpeg","image/png","image/jpg","image/x-icon"].includes(n.file.file.type)?((l=window.$message)==null||l.destroyAll(),(i=window.$message)==null||i.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1):n.file.file.size>100*1024*1024?((d=window.$message)==null||d.error("文件大小不能超过100M"),!1):!0}const _e=(n,e)=>{N.value=!0,D.value="edit",r.value=JSON.parse(JSON.stringify(n)),E.value=e},ve=async n=>{var i;const{data:e,error:l}=await ut(n.id);e&&((i=window.$message)==null||i.success("删除成功"),$.value.length===1&&w.value.page>1&&w.value.page--,C())},ye=()=>{N.value=!0,D.value="add",r.value={id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""},E.value=-1},ge=ne.debounce(async()=>{var n,e,l;if(await((n=G.value)==null?void 0:n.validate()),r.value.id){const{data:i,error:d}=await ct([r.value]);i&&((e=window.$message)==null||e.success("编辑成功"))}else{const{data:i,error:d}=await rt([r.value]);i&&((l=window.$message)==null||l.success("新增成功"))}await C(),K()},1e3,{leading:!0,trailing:!1}),K=()=>{N.value=!1,r.value={id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}};Te(async()=>{await de(),C()});const F=async n=>{const{data:e,error:l}=await dt({page:1,limit:100,pid:n});if(e){const i=$.value.find(d=>d.id===n);i&&(i.comments=e.list)}},we=async n=>{F(n.id),$.value.forEach(e=>{e.id!==n.id&&(e.showCommentSection=!1)}),n.showCommentSection=!n.showCommentSection,n.showCommentSection&&await xe(`comment-input-${n.id}`)},he=async(n,e)=>{var d;const{data:l,error:i}=await mt(n.id);l&&(F(n.pid),e.num--,(d=window.$message)==null||d.success("删除成功"))},q=k({}),H=ne.debounce(async n=>{var d,x;const e=q.value[n.id];if(!(e!=null&&e.trim()))return(d=window.$message)==null?void 0:d.warning("请输入评论内容");const{data:l,error:i}=await pt([{pid:n.id,content:e}]);l&&((x=window.$message)==null||x.success("评论成功"),q.value[n.id]="",n.num++,F(n.id))},1e3,{leading:!0,trailing:!1});async function xe(n,e=8,l=30){var d;await le();for(let x=0;x<e;x++){const f=document.querySelector(`#${n} textarea`);if(f&&typeof f.focus=="function"){f.focus();const U=f.value;if(U&&f.setSelectionRange){const R=U.length;f.setSelectionRange(R,R)}return!0}await new Promise(U=>setTimeout(U,l))}const i=document.getElementById(n);return i&&(i.tabIndex=-1,(d=i.focus)==null||d.call(i)),!1}async function X(n){if(!n)return;const e=n.split("?")[0],l=n.split("?")[1];try{const d=await(await fetch(e,{mode:"cors"})).blob(),x=URL.createObjectURL(d),f=document.createElement("a");f.href=x,f.download=l,f.style.display="none",document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(x)}catch(i){console.error("下载失败:",i)}}return(n,e)=>{const l=st,i=tt,d=Ae,x=ot,f=Ne,U=et,R=Ze,ke=Qe,Z=Be,be=Ye,Q=lt,Ce=Fe,z=Ie,$e=Me,Y=Ve,ze=Je,Se=Oe,P=Le("no-auth");return c(),y("div",ft,[o(a(I),{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[o(f,{ref_key:"formRef",ref:G,model:T.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:oe(C,["enter"])},{default:s(()=>[o(x,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[o(l,{span:"24 s:12 m:6",label:"调试人员",path:"pid"},{default:s(()=>[o(a(Pe),{clearable:"",filterable:"",value:T.value.creater,"onUpdate:value":[e[0]||(e[0]=t=>T.value.creater=t),ue],placeholder:"请选择","label-field":"username","value-field":"id",options:a(L).data,onScroll:ce},null,8,["value","options"])]),_:1}),o(l,{span:"24  s:12 m:6",class:"pr-24px"},{default:s(()=>[o(d,{class:"w-full"},{default:s(()=>[o(a(h),{type:"primary",ghost:"",onClick:C},{icon:s(()=>[o(i,{class:"text-icon"})]),default:s(()=>[p(" "+m(n.$t("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),u("div",_t,[o(a(I),null,{header:s(()=>e[13]||(e[13]=[p("技术支持周报")])),"header-extra":s(()=>[A((c(),g(a(h),{type:"primary",ghost:"",onClick:ye},{icon:s(()=>[o(U)]),default:s(()=>[e[14]||(e[14]=p(" 写周报 "))]),_:1,__:[14]})),[[P,"project:Week:insert"]])]),default:s(()=>[o(a(qe),{style:{height:"calc(100vh - 350px)"}},{default:s(()=>[$.value.length?(c(),y("div",vt,[(c(!0),y(se,null,ae($.value,(t,je)=>(c(),g(a(I),{key:t.id,class:"mb-4",title:"",size:"small"},{default:s(()=>{var ee,te;return[u("div",yt,[u("div",gt,[t.showAll?(c(),g(R,{key:0,class:"font-size-20px mr-10px cursor-pointer",onClick:_=>t.showAll=!t.showAll},null,8,["onClick"])):(c(),g(ke,{key:1,class:"font-size-20px mr-10px cursor-pointer",onClick:_=>t.showAll=!t.showAll},null,8,["onClick"])),o(a(M),{src:B.avatar},null,8,["src"]),u("div",wt,[u("span",ht,m(t.username)+"的技术支持周报",1),u("span",xt,m(t.dbtime),1)])])]),t.showAll?(c(),y("div",kt,[e[17]||(e[17]=u("h3",{class:"font-size-16px font-bold mt-2"},"本周完成：",-1)),u("div",bt,m(t.content1),1),e[18]||(e[18]=u("h3",{class:"font-size-16px font-bold mt-2"},"本周对你帮助最大的人，具体描述一下对你的帮助：",-1)),u("div",Ct,m(t.content2),1),e[19]||(e[19]=u("h3",{class:"font-size-16px font-bold mt-2"},"未完成项目",-1)),u("div",$t,m(t.content3),1),e[20]||(e[20]=u("h3",{class:"font-size-16px font-bold mt-2"},"下周计划：",-1)),u("div",zt,m(t.content4),1),e[21]||(e[21]=u("h3",{class:"font-size-16px font-bold mt-2"},"需协调与帮助：",-1)),u("div",St,m(t.content5),1),e[22]||(e[22]=u("h3",{class:"font-size-16px font-bold mt-2"},"图片：",-1)),t.file1?(c(),g(Z,{key:0,width:"80",height:"80",src:t.file1,class:"rounded-md object-cover"},null,8,["src"])):b("",!0),t.file1?(c(),y("div",jt,[p(m((ee=t.file1)==null?void 0:ee.split("?")[1])+" ",1),o(a(h),{text:"",type:"primary",size:"small",onClick:_=>X(t.file1)},{default:s(()=>e[15]||(e[15]=[p("下载")])),_:2,__:[15]},1032,["onClick"])])):b("",!0),e[23]||(e[23]=u("h3",{class:"font-size-16px font-bold mt-2"},"附件：",-1)),t.file2?(c(),y("div",Ut,[p(m((te=t.file2)==null?void 0:te.split("?")[1])+" ",1),o(a(h),{text:"",type:"primary",size:"small",onClick:_=>X(t.file2)},{default:s(()=>e[16]||(e[16]=[p("下载")])),_:2,__:[16]},1032,["onClick"])])):b("",!0)])):b("",!0),t.showAll?(c(),y("div",Wt,[u("span",{class:"cursor-pointer hover:text-blue-500",style:De({color:t.showCommentSection?"#1890ff":""}),onClick:_=>we(t)},[o(be,{class:"font-size-18px"}),p(" "+m(t.num==0?"":t.num),1)],12,Tt),a(V).userInfo.id==t.creater?(c(),g(d,{key:0},{default:s(()=>[A((c(),g(a(h),{quaternary:"",type:"info",size:"small",onClick:_=>_e(t,je)},{default:s(()=>e[24]||(e[24]=[p(" 编辑 ")])),_:2,__:[24]},1032,["onClick"])),[[P,"project:Week:update"]]),o(Q,{onPositiveClick:_=>ve(t)},{trigger:s(()=>[A((c(),g(a(h),{quaternary:"",type:"error",size:"small"},{default:s(()=>e[25]||(e[25]=[p(" 删除 ")])),_:1,__:[25]})),[[P,"project:Week:delete"]])]),default:s(()=>[e[26]||(e[26]=p(" 确定删除吗？ "))]),_:2,__:[26]},1032,["onPositiveClick"])]),_:2},1024)):b("",!0)])):b("",!0),A((c(),g(Ee,{name:"fade"},{default:s(()=>[t.showCommentSection?(c(),y("div",Lt,[u("div",Nt,[u("div",null,[o(a(M),{size:"small",src:B.avatar},null,8,["src"])]),o(a(W),{type:"textarea",id:`comment-input-${t.id}`,value:q.value[t.id],"onUpdate:value":_=>q.value[t.id]=_,placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:oe(Ge(_=>a(H)(t),["exact","prevent"]),["enter"])},null,8,["id","value","onUpdate:value","onKeydown"]),o(a(h),{type:"primary",ghost:"",onClick:_=>a(H)(t)},{default:s(()=>e[27]||(e[27]=[p("发送")])),_:2,__:[27]},1032,["onClick"])]),(c(!0),y(se,null,ae(t.comments,_=>(c(),y("div",{key:_.id,class:"flex mb-3"},[o(a(M),{size:"small",src:B.avatar},null,8,["src"]),u("div",Pt,[u("div",At,[u("span",qt,m(_.username),1),o(a(at),{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:s(()=>[p(m(_.dbtime),1)]),_:2},1024),a(V).userInfo.id==_.creater?(c(),g(Q,{key:0,onPositiveClick:It=>he(_,t)},{trigger:s(()=>[A((c(),g(a(h),{quaternary:"",type:"error",size:"small"},{default:s(()=>e[28]||(e[28]=[p(" 删除 ")])),_:1,__:[28]})),[[P,"project:Week:Comment:delete"]])]),default:s(()=>[e[29]||(e[29]=p(" 确定删除吗？ "))]),_:2,__:[29]},1032,["onPositiveClick"])):b("",!0)]),u("div",Rt,m(_.content),1)])]))),128))])):b("",!0)]),_:2},1024)),[[P,"project:Week:Comment:insert"]])]}),_:2},1024))),128))])):(c(),g(a(Re),{key:0,description:"暂无信息"}))]),_:1}),$.value.length>0?(c(),y("div",Bt,[o(Ce,{page:w.value.page,"onUpdate:page":[e[1]||(e[1]=t=>w.value.page=t),me],"page-size":w.value.limit,"onUpdate:pageSize":[e[2]||(e[2]=t=>w.value.limit=t),fe],"item-count":w.value.total,"show-size-picker":"","page-sizes":[10,20,50],prefix:()=>`共 ${w.value.total} 条`},null,8,["page","page-size","item-count","prefix"])])):b("",!0)]),_:1})]),o(Se,{show:N.value,"onUpdate:show":e[12]||(e[12]=t=>N.value=t),title:D.value==="add"?"新增":"编辑",preset:"card",class:"w-570px"},{footer:s(()=>[o(d,{justify:"end"},{default:s(()=>[o(a(h),{size:"small",class:"mt-16px",onClick:K},{default:s(()=>[p(m(n.$t("common.cancel")),1)]),_:1}),o(a(h),{type:"primary",size:"small",class:"mt-16px",onClick:a(ge)},{default:s(()=>[p(m(n.$t("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:s(()=>[o(f,{ref_key:"formRef",ref:G,model:r.value,rules:pe},{default:s(()=>[o(z,{label:"本周完成",path:"content1"},{default:s(()=>[o(a(W),{value:r.value.content1,"onUpdate:value":e[3]||(e[3]=t=>r.value.content1=t),type:"textarea",placeholder:"请输入内容",rows:3},null,8,["value"])]),_:1}),o(z,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{default:s(()=>[o(a(W),{value:r.value.content2,"onUpdate:value":e[4]||(e[4]=t=>r.value.content2=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o(z,{label:"未完成项目",path:"content3"},{default:s(()=>[o(a(W),{value:r.value.content3,"onUpdate:value":e[5]||(e[5]=t=>r.value.content3=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o(z,{label:"下周计划",path:"content4"},{default:s(()=>[o(a(W),{value:r.value.content4,"onUpdate:value":e[6]||(e[6]=t=>r.value.content4=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o(z,{label:"需协调与帮助:",path:"content5"},{default:s(()=>[o(a(W),{value:r.value.content5,"onUpdate:value":e[7]||(e[7]=t=>r.value.content5=t),type:"textarea",placeholder:"请输入内容",rows:1},null,8,["value"])]),_:1}),o(z,{label:"图片:",path:"file1"},{default:s(()=>[o(d,{justify:"center"},{default:s(()=>[r.value.file1?(c(),y("div",Dt,[o(Z,{width:"100",height:"100","preview-disabled":"",src:r.value.file1,class:"rounded-md object-cover"},null,8,["src"]),u("div",{class:"absolute inset-0 flex w-100px items-center justify-center bg-black/50 opacity-0 c-#ccc group-hover:opacity-100 transition-opacity duration-200 cursor-pointer rounded-md",onClick:e[8]||(e[8]=t=>r.value.file1="")},[o($e,{class:"font-size-24px"})])])):(c(),g(Y,{key:1,ref:"uploadRef",action:"#","list-type":"image-card","custom-request":t=>J(t,"file1"),onBeforeUpload:e[9]||(e[9]=t=>O(t,"file1"))},null,8,["custom-request"]))]),_:1})]),_:1}),o(z,{label:"附件:",path:"file2"},{default:s(()=>[r.value.file2?(c(),y("div",Et,[u("span",null,m(r.value.file2.split("?")[1]),1),o(a(h),{text:"",type:"error",onClick:e[10]||(e[10]=t=>r.value.file2="")},{default:s(()=>e[30]||(e[30]=[p("删除")])),_:1,__:[30]})])):(c(),y("div",Gt,[o(Y,{ref:"uploadRef",action:"#","show-file-list":!1,"custom-request":t=>J(t,"file2"),onBeforeUpload:e[11]||(e[11]=t=>O(t,"file2"))},{default:s(()=>[o(a(h),{loading:j.value>0&&!r.value.file2},{default:s(()=>[p(m(j.value>0&&!r.value.file2?"上传中":"上传文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"]),j.value&&!r.value.file2?(c(),g(ze,{key:0,type:"line",percentage:j.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):b("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}}),Qt=Xe(Ft,[["__scopeId","data-v-df0205c9"]]);export{Qt as default};
