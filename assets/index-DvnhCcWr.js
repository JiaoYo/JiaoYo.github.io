import{_ as oe,a as ne,A as le}from"./index-CKZkb4Hf.js";import{d as ae,q as re,p as se,s as ie,i as ue,r as k,b as de,o as y,f as o,w as n,c as M,y as h,z as E,am as I,g as u,B as K,an as pe,h as x,A as ce,N as $,F as me,e as _e,t as U,b6 as fe,bn as ge,bo as ve,a2 as ke,bp as ye,ac as we}from"./index-IJPUKuVg.js";const be={class:"flex justify-center"},Ae=ae({name:"manage_systemconfig",__name:"index",setup(Se){const{formRef:B,validate:R}=re(),w=se(),t=ie(z());function z(){return{id:0,merror:0,errortime:0,sdkkey:"",sdkh5:"",sdksecret:"",prosite:"",longitude:void 0,latitude:void 0}}const f={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},G={prosite:{type:"string",required:!0,message:"不能为空",trigger:["blur","change"]},longitude:f,latitude:f,merror:f,errortime:f},N=async()=>{const{data:l,error:e}=await ge();e||(Object.assign(t,l),t.errortime=l.errortime/1e3/60)};ue(()=>{N()});const T=async()=>{var a;await R();const l=t.errortime*1e3*60,{error:e}=await ve({...t,errortime:l});e||(a=window.$message)==null||a.success("设置成功")},_=k(!1),b=k();async function V(){const l="https://dingiiot.com/map-sdk.json";try{return(await ye.get(`${l}?_t=${Date.now()}`)).data}catch(e){throw console.error("获取地图 SDK 配置失败:",e),e}}let p=null,D=null,g=null,P=null,i=null;const c=k(""),A=k([]);async function j(){const l=await V();if(window._AMapSecurityConfig={securityJsCode:l.AMAP_SDK_SECRET},!!b.value)try{i=await le.load({key:l.AMAP_SDK_KEY,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Lnglat","AMap.Geocoder","AMap.Geolocation"]}),p=new i.Map(b.value,{zoom:18,center:[t.longitude,t.latitude],viewMode:"3D",resizeEnable:!0});const e=new i.Geolocation({enableHighAccuracy:!0,timeout:1e4,position:"RT",buttonOffset:new i.Pixel(10,20),zoomToAccuracy:!0});p.addControl(e),p.addControl(new i.Scale),D=new i.Geocoder,P=new i.PlaceSearch({pageSize:50}),p.on("click",a=>{console.log("e",a);const s=a.lnglat.lng,m=a.lnglat.lat;S(i,{lng:s,lat:m})}),S(i,{lng:t.longitude,lat:t.latitude})}catch(e){console.error("地图加载失败:",e)}}function L(){c.value.trim()&&P.search(c.value,(l,e)=>{if(console.log(l,e),A.value=[],l==="complete"&&e.info==="OK"){const a=e.poiList.pois;a.length>0&&a.forEach(s=>{const{address:m,location:d}=s;A.value.push({label:m,value:d.lng+"_"+d.lat})})}else console.log("搜索失败或无结果")})}function O(){_.value=!0,ke(()=>{j()})}function q(l){console.log("key",c.value),console.log("val",l);let e=l.split("_")[0],a=l.split("_")[1];p.setCenter([e,a]),S(i,{lng:e,lat:a})}function S(l,e){g&&p.remove(g),g=new l.Marker({position:[e.lng,e.lat],map:p}),p.add(g),D.getAddress(e,(a,s)=>{a==="complete"&&s.regeocode&&(console.log("result",s),console.log("formattedAddress",s.regeocode.formattedAddress),t.latitude=e.lat,t.longitude=e.lng,c.value=s.regeocode.formattedAddress)})}function F(){_.value=!1}const Y=async()=>{t.prosite=c.value,_.value=!1,console.log(t)};return(l,e)=>{const a=K,s=pe,m=I,d=E,v=ce,H=oe,C=K,J=I,Q=E,W=$,X=me,Z=ne,ee=$,te=fe;return y(),de("div",be,[o(X,{ref_key:"formRef",ref:B,"label-width":240,"label-placement":"left",model:t,rules:G},{default:n(()=>[o(d,{label:"打卡误差范围（米）",path:"merror"},{default:n(()=>[o(m,{class:"flex items-center"},{default:n(()=>[o(a,{onClick:e[0]||(e[0]=r=>t.merror--),disabled:t.merror==0},{default:n(()=>e[12]||(e[12]=[u(" − ")])),_:1,__:[12]},8,["disabled"]),o(s,{"show-button":!1,value:t.merror,"onUpdate:value":e[1]||(e[1]=r=>t.merror=r),placeholder:"",min:0,precision:0},null,8,["value"]),o(a,{onClick:e[2]||(e[2]=r=>t.merror++),class:"mr-5px"},{default:n(()=>e[13]||(e[13]=[u(" + ")])),_:1,__:[13]}),e[14]||(e[14]=u(" 米 "))]),_:1,__:[14]})]),_:1}),o(d,{label:"打卡时间误差最大值（分钟）",path:"errortime"},{default:n(()=>[o(m,{class:"flex items-center"},{default:n(()=>[o(a,{onClick:e[3]||(e[3]=r=>t.errortime--),disabled:t.errortime==0},{default:n(()=>e[15]||(e[15]=[u(" − ")])),_:1,__:[15]},8,["disabled"]),o(s,{"show-button":!1,value:t.errortime,"onUpdate:value":e[4]||(e[4]=r=>t.errortime=r),placeholder:"",min:0,precision:0},null,8,["value"]),o(a,{onClick:e[5]||(e[5]=r=>t.errortime++),class:"mr-5px"},{default:n(()=>e[16]||(e[16]=[u(" + ")])),_:1,__:[16]}),e[17]||(e[17]=u(" 分钟 "))]),_:1,__:[17]})]),_:1}),x(w).userInfo.id=="1024"?(y(),M(d,{key:0,label:"AMAP_SDK_KEY",path:"sdkkey"},{default:n(()=>[o(v,{style:{width:"300px"},value:t.sdkkey,"onUpdate:value":e[6]||(e[6]=r=>t.sdkkey=r),placeholder:""},null,8,["value"])]),_:1})):h("",!0),x(w).userInfo.id=="1024"?(y(),M(d,{key:1,label:"AMAP_SDK_KEY_H5",path:"sdkh5"},{default:n(()=>[o(v,{style:{width:"300px"},value:t.sdkh5,"onUpdate:value":e[7]||(e[7]=r=>t.sdkh5=r),placeholder:""},null,8,["value"])]),_:1})):h("",!0),x(w).userInfo.id=="1024"?(y(),M(d,{key:2,label:"AMAP_SDK_SECRET",path:"sdksecret"},{default:n(()=>[o(v,{style:{width:"300px"},value:t.sdksecret,"onUpdate:value":e[8]||(e[8]=r=>t.sdksecret=r),placeholder:""},null,8,["value"])]),_:1})):h("",!0),o(Q,{label:"项目地点",path:"prosite"},{default:n(()=>[o(J,{onClick:O},{default:n(()=>[o(v,{value:t.prosite,"onUpdate:value":e[9]||(e[9]=r=>t.prosite=r),style:{width:"400px"},placeholder:"请输入项目地点"},null,8,["value"]),o(C,null,{icon:n(()=>[o(H,{class:"text-icon"})]),_:1})]),_:1})]),_:1}),o(d,{label:" "},{default:n(()=>[o(W,null,{default:n(()=>[o(a,{type:"default",ghost:"",onClick:N},{default:n(()=>e[18]||(e[18]=[u(" 刷新 ")])),_:1,__:[18]}),o(a,{type:"info",ghost:"",onClick:T},{default:n(()=>e[19]||(e[19]=[u(" 保存 ")])),_:1,__:[19]})]),_:1})]),_:1})]),_:1},8,["model"]),o(te,{show:_.value,"onUpdate:show":e[11]||(e[11]=r=>_.value=r),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:n(()=>[o(ee,{justify:"end",size:16},{default:n(()=>[o(C,{onClick:F},{default:n(()=>[u(U(l.$t("common.cancel")),1)]),_:1}),o(C,{type:"primary",onClick:Y},{default:n(()=>[u(U(l.$t("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[o(Z,{value:c.value,"onUpdate:value":[e[10]||(e[10]=r=>c.value=r),L],options:A.value,placeholder:"请输入地点关键字",clearable:"",onSelect:q},null,8,["value","options"]),_e("div",{ref_key:"domRef",ref:b,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])])}}}),he=we(Ae,[["__scopeId","data-v-0b843f06"]]);export{he as default};
