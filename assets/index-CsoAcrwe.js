import{_ as ts}from"./correct-BgRHRbIB.js";import{_ as Aa,a as Va,V as as,b as ls,c as ss,d as ns,e as is,f as os,g as rs}from"./index-76hykJZg.js";import{_ as _a}from"./round-plus-DZWXO6eq.js";import{_ as ds}from"./round-search-Cl9yVEe0.js";import{R as ut,b as L,o as u,e as f,d as Ct,z as $t,s as x,at as Wt,i as Ma,aJ as qa,F as dt,aO as Ee,f as l,I as we,c as A,w as n,g as p,h as c,B as k,a3 as us,bM as cs,a_ as zt,dd as ps,a2 as Oa,G as D,t as U,aL as kt,a7 as yt,J as he,b2 as cl,H as X,L as pl,d4 as vt,aE as rt,W as ka,ay as Re,a4 as Qt,M as fl,N as xa,aA as xt,az as Kt,$ as K,aM as fs,de as gs,n as a,aG as Yt,df as ms,dg as vs,dh as ys,aI as gl,cW as Ra,av as ha,A as hs,a as bs,ax as ml,au as De,aD as Ja,K as al,a5 as ot,aR as Ge,cu as vl,cw as Pa,aS as yl,cy as Ta,cB as hl,bf as bl,cL as _l,cV as kl,D as Ye,di as ll,dj as _s,dk as ks,S as xs,c$ as Cs,dl as Ss,dm as Ls,dn as ws,X as Ds,Y as zs,cG as $s,cE as Us,cF as js,dp as Dt,cY as Bs,cX as Fs,cU as sl,cC as Ns,cD as Is,cz as nl,cA as il,d7 as Ps,d8 as Ts,d5 as Es,d6 as As,db as Vs,dc as Ms,d9 as qs,da as Os,dq as Rs,dr as ol,ds as Js,dt as Hs,du as Gs,bn as Ws,bp as Ks,dv as Ys,aN as Qs,dw as Xs,dx as Zs,cx as en,aQ as tn}from"./index-BHYK3A_G.js";import{u as lt}from"./usePageData-BU1qqIQs.js";import{f as xl,b as an,_ as Cl,c as ln,a as sn,e as nn,d as on}from"./drawerLog-CmXpFQou.js";import{N as Te}from"./Popconfirm-CZ_7v-Ns.js";import{_ as rl,a as rn}from"./text-CC434OfY.js";import{h as Ve}from"./permission-BBP7PMT_.js";import{u as dn}from"./table-B6LlmD7Q.js";import{_ as ba}from"./DatePicker-Bf16rwUA.js";import{N as Ea}from"./Cascader-xi9pWh20.js";import{_ as un}from"./round-delete-B_8F17d_.js";import{a as cn,_ as pn,A as fn}from"./index-BTQKwTLU.js";import{p as dl,f as ul}from"./business-B_veVQll.js";import{_ as gn,a as mn}from"./DescriptionsItem-DmzTyFLi.js";import{_ as vn,d as yn}from"./drawerLog-lMtkMYdc.js";import{l as hn}from"./lookdebuggingSheetModal-D9el-2jb.js";import{f as bn}from"./mojicb-boSlS7E_.js";import{_ as _n}from"./Grid-B2A8-T_X.js";import{_ as kn}from"./FormItemGridItem-C5bXUl4-.js";import{N as xn}from"./Table-Ma1-Ugmt.js";const Cn={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Sn(de,B){return u(),L("svg",Cn,B[0]||(B[0]=[f("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H5.2L4 17.2V4h16zm-3-5h-2V9h2m-4 2h-2V9h2m-4 2H7V9h2"},null,-1)]))}const Ln=ut({name:"mdi-message-processing-outline",render:Sn}),wn={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Dn(de,B){return u(),L("svg",wn,B[0]||(B[0]=[f("path",{fill:"currentColor",d:"m12 10.8l-4.6 4.6L6 14l6-6l6 6l-1.4 1.4z"},null,-1)]))}const zn=ut({name:"material-symbols-keyboard-arrow-up",render:Dn}),$n={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Un(de,B){return u(),L("svg",$n,B[0]||(B[0]=[f("path",{fill:"currentColor",d:"M12 14.975q-.2 0-.375-.062T11.3 14.7l-4.6-4.6q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l3.9 3.9l3.9-3.9q.275-.275.7-.275t.7.275t.275.7t-.275.7l-4.6 4.6q-.15.15-.325.213t-.375.062"},null,-1)]))}const jn=ut({name:"material-symbols-keyboard-arrow-down-rounded",render:Un}),Bn={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Fn(de,B){return u(),L("svg",Bn,B[0]||(B[0]=[f("path",{fill:"currentColor",d:"M3 21v-4.25L16.2 3.575q.3-.275.663-.425t.762-.15t.775.15t.65.45L20.425 5q.3.275.438.65T21 6.4q0 .4-.137.763t-.438.662L7.25 21zM17.6 7.8L19 6.4L17.6 5l-1.4 1.4z"},null,-1)]))}const Nn=ut({name:"material-symbols-edit",render:Fn}),In={class:"flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto h-100%"},Pn={style:{display:"flex","flex-direction":"column","justify-content":"space-between",gap:"16px",height:"100%"}},Tn={key:1},En={class:"flex items-center justify-between"},An={class:"flex items-center"},Vn={class:"font-size-16px font-bold"},Mn={class:"font-size-12px c-#868e96"},qn={key:0},On={class:"font-size-12px c-#a19f9d my-5px"},Rn={key:1,class:"mt-1 flex items-center justify-between gap-3 text-sm text-gray-500"},Jn=["onClick"],Hn={key:0,class:"mt-4 border-t pt-3"},Gn={class:"flex items-start gap-2 mb-3"},Wn={class:"ml-2 flex-1"},Kn={class:"flex justify-between items-center"},Yn={class:"font-medium mr-20px"},Qn={class:"text-gray-600 mt-1"},Xn={style:{display:"flex","justify-content":"flex-end"}},Zn=Ct({__name:"dayLog",props:{pid:{},pname:{}},setup(de){const B=$t(),W=de,P=x([]);Wt(()=>W.pid,V=>{V&&ee()});const Z=x({page:1,limit:10,total:0}),ee=async()=>{const{data:V,error:z}=await xl({pid:W.pid,page:Z.value.page,limit:Z.value.limit});V&&(Z.value.total=V.total,P.value=V.list.map(re=>(re.showCommentSection=!1,re.showAll=!1,re)))},T=V=>{Z.value.page=V,ee()},m=V=>{Z.value.limit=V,ee()};Ma(()=>{ee()});const J=x("add"),ne=x({}),ke=x(!1),ie=()=>{ke.value=!0,J.value="add"},ge=V=>{ke.value=!0,J.value="edit",ne.value=V},ye=async V=>{var ue;const{data:z,error:re}=await sn(V.id);z&&((ue=window.$message)==null||ue.success("删除成功"),P.value.length===1&&Z.value.page>1&&Z.value.page--,ee())},ve=V=>{P.value.forEach(z=>{z.id!==V.id&&(z.showAll=!1)}),V.showAll=!V.showAll};async function Be(V,z=8,re=30){var te;await rt();for(let Ce=0;Ce<z;Ce++){const R=document.querySelector(`#${V} textarea`);if(R&&typeof R.focus=="function"){R.focus();const fe=R.value;if(fe&&R.setSelectionRange){const Q=fe.length;R.setSelectionRange(Q,Q)}return!0}await new Promise(fe=>setTimeout(fe,re))}const ue=document.getElementById(V);return ue&&(ue.tabIndex=-1,(te=ue.focus)==null||te.call(ue)),!1}const be=async V=>{P.value.forEach(z=>{z.id!==V.id&&(z.showCommentSection=!1)}),V.showCommentSection=!V.showCommentSection,V.showCommentSection&&await Be(`comment-input-${V.id}`),xe(V)},xe=async V=>{const{data:z,error:re}=await ln({page:1,limit:100,pid:V.id});z&&(V.comments=z.list)},oe=x({}),le=qa.debounce(async V=>{var te;const z=oe.value[V.id];if(!(z!=null&&z.trim()))return(te=window.$message)==null?void 0:te.warning("请输入评论内容");const{data:re,error:ue}=await an([{pid:V.id,context:z}]);re&&(xe(V),V.num++,oe.value[V.id]="")},1e3,{leading:!0,trailing:!1}),me=async(V,z)=>{var te;const{data:re,error:ue}=await nn(V.id);re&&(xe(z),z.num--,(te=window.$message)==null||te.success("删除成功"))};return(V,z)=>{const re=Nn,ue=jn,te=zn,Ce=Ln,R=Te,fe=he,Q=ps,_e=dt("no-auth");return u(),L(Ee,null,[f("div",In,[we((u(),A(c(k),{type:"primary",onClick:ie},{icon:n(()=>[l(re)]),default:n(()=>[z[3]||(z[3]=p(" 写日报"))]),_:1,__:[3]})),[[_e,"project:DailyReport:insert"]]),f("div",Pn,[l(c(us),{style:{height:"calc(100vh - 181px)"}},{default:n(()=>[P.value.length?(u(),L("div",Tn,[(u(!0),L(Ee,null,zt(P.value,C=>(u(),A(c(Oa),{key:C.id,class:"mb-4",title:"",size:"small"},{default:n(()=>[f("div",En,[f("div",An,[C.showAll?(u(),A(ue,{key:0,class:"font-size-20px mr-10px cursor-pointer",onClick:H=>ve(C)},null,8,["onClick"])):(u(),A(te,{key:1,class:"font-size-20px mr-10px cursor-pointer",onClick:H=>ve(C)},null,8,["onClick"])),f("span",Vn,U(C.username)+"的日报",1)]),f("span",Mn,U(C.dbtime),1)]),C.showAll?(u(),L("div",qn,[z[4]||(z[4]=f("div",{class:"font-size-14px font-bold"},"项目名称",-1)),f("div",{class:kt(["preview-text",{textstyle:JSON.parse(C.context).proname}])},U(JSON.parse(C.context).proname),3),z[5]||(z[5]=f("div",{class:"font-size-14px font-bold"},"当前工作内容及成果描述",-1)),f("div",{class:kt(["preview-text",{textstyle:JSON.parse(C.context).notes}])},U(JSON.parse(C.context).notes),3),z[6]||(z[6]=f("div",{class:"font-size-14px font-bold"},"遇到问题",-1)),f("div",{class:kt(["preview-text",{textstyle:JSON.parse(C.context).problem}])},U(JSON.parse(C.context).problem),3),z[7]||(z[7]=f("div",{class:"font-size-14px font-bold"},"解决措施",-1)),f("div",{class:kt(["preview-text",{textstyle:JSON.parse(C.context).solutions}])},U(JSON.parse(C.context).solutions),3),z[8]||(z[8]=f("div",{class:"font-size-14px font-bold"},"建议意见反馈",-1)),f("div",{class:kt(["preview-text",{textstyle:JSON.parse(C.context).feedback}])},U(JSON.parse(C.context).feedback),3),z[9]||(z[9]=f("div",{class:"font-size-14px font-bold"},"（总结）自己对一天工作的感受和体感",-1)),f("div",{class:kt(["preview-text",{textstyle:JSON.parse(C.context).summarize}])},U(JSON.parse(C.context).summarize),3)])):D("",!0),f("div",On,"字符数："+U(C.charctras),1),C.showAll?(u(),L("div",Rn,[f("span",{class:"cursor-pointer hover:text-blue-500",style:yt({color:C.showCommentSection?"#1890ff":""}),onClick:H=>be(C)},[l(Ce,{class:"font-size-18px"}),p(U(C.num==0?"":C.num),1)],12,Jn),c(B).userInfo.id==C.creater?(u(),A(fe,{key:0},{default:n(()=>[l(c(k),{quaternary:"",type:"info",size:"small",onClick:H=>ge(C)},{default:n(()=>z[10]||(z[10]=[p(" 编辑 ")])),_:2,__:[10]},1032,["onClick"]),l(R,{onPositiveClick:H=>ye(C)},{trigger:n(()=>[l(c(k),{quaternary:"",type:"error",size:"small"},{default:n(()=>z[11]||(z[11]=[p(" 删除 ")])),_:1,__:[11]})]),default:n(()=>[z[12]||(z[12]=p(" 确定删除吗？ "))]),_:2,__:[12]},1032,["onPositiveClick"])]),_:2},1024)):D("",!0)])):D("",!0),l(cl,{name:"fade"},{default:n(()=>[C.showCommentSection?(u(),L("div",Hn,[f("div",Gn,[f("div",null,[l(c(rl),{size:"small",src:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"})]),l(c(X),{type:"textarea",id:`comment-input-${C.id}`,value:oe.value[C.id],"onUpdate:value":H=>oe.value[C.id]=H,placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:pl(vt(H=>c(le)(C),["exact","prevent"]),["enter"])},null,8,["id","value","onUpdate:value","onKeydown"]),l(c(k),{type:"primary",ghost:"",onClick:H=>c(le)(C)},{default:n(()=>z[13]||(z[13]=[p("发送")])),_:2,__:[13]},1032,["onClick"])]),(u(!0),L(Ee,null,zt(C.comments,H=>(u(),L("div",{key:H.id,class:"flex mb-3"},[l(c(rl),{size:"small",src:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"}),f("div",Wn,[f("div",Kn,[f("div",null,[f("span",Yn,U(H.username),1),l(c(rn),{depth:"3",style:{"font-size":"12px"}},{default:n(()=>[p(U(H.dbtime),1)]),_:2},1024),c(B).userInfo.id==H.creater?(u(),A(R,{key:0,onPositiveClick:Ae=>me(H,C)},{trigger:n(()=>[l(c(k),{quaternary:"",type:"error",size:"small"},{default:n(()=>z[14]||(z[14]=[p(" 删除 ")])),_:1,__:[14]})]),default:n(()=>[z[15]||(z[15]=p(" 确定删除吗？ "))]),_:2,__:[15]},1032,["onPositiveClick"])):D("",!0),f("div",Qn,U(H.context),1)])])])]))),128))])):D("",!0)]),_:2},1024)]),_:2},1024))),128))])):(u(),A(c(cs),{key:0,description:"暂无日志"}))]),_:1}),f("div",Xn,[l(Q,{page:Z.value.page,"onUpdate:page":[z[0]||(z[0]=C=>Z.value.page=C),T],"page-size":Z.value.limit,"onUpdate:pageSize":[z[1]||(z[1]=C=>Z.value.limit=C),m],"item-count":Z.value.total,"show-size-picker":"","page-sizes":[10,20,50],prefix:()=>`共 ${Z.value.total} 条记录`},null,8,["page","page-size","item-count","prefix"])])])]),l(Cl,{visible:ke.value,"onUpdate:visible":z[2]||(z[2]=C=>ke.value=C),onSubmitted:ee,"operate-type":J.value,pname:W.pname,pid:W.pid,"row-data":ne.value},null,8,["visible","operate-type","pname","pid","row-data"])],64)}}}),ei=ka(Zn,[["__scopeId","data-v-3f32dd5a"]]),ti={class:"flex items-center justify-between"},ai={class:"flex items-center"},li={style:{margin:"10px 0","font-weight":"bolder",width:"140px"}},si={key:0,class:"font-size-12px c-#ffa502 ml-10px"},ni={key:0},ii={style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},oi={key:0},ri={style:{display:"flex","justify-content":"space-between"}},di={key:0,class:"preview-content"},ui=["src"],ci={key:4},pi=["src"],fi=Ct({__name:"fileList",props:{pid:{},data:{},fileType:{},typename:{}},emits:["getData"],setup(de,{emit:B}){const W=de,P=$t(),Z=B,ee=[{title:"文件别名",key:"name",align:"center",width:200,ellipsis:{tooltip:!0}},{title:"文件名称",key:"filename",align:"center",width:200,ellipsis:{tooltip:!0}},{title:"上传人",key:"creator",align:"center",width:100},{title:"上传时间",key:"dbtime",align:"center",width:200},{title:"操作",key:"actions",align:"center",width:180,render(h,v){return a(he,{justify:"center"},[a(k,{type:"info",size:"small",ghost:!0,onClick:()=>{ue(h)}},{default:()=>"查看"}),a(k,{type:"info",size:"small",ghost:!0,onClick:()=>{ve(h)}},{default:()=>"下载"}),Ve("project:File:update")&&a(k,{type:"info",size:"small",ghost:!0,onClick:()=>{fe(h)}},{default:()=>"编辑"}),Ve("project:File:delete")&&(P.userInfo.usertype==0||P.userInfo.usertype==2)&&a(Te,{onPositiveClick:async()=>{var E;if(h.id){const{data:q,error:G}=await vs(h.url),{data:d,error:y}=await ys(h.id);y||((E=window.$message)==null||E.success("删除成功"),Z("getData"))}}},{default:()=>K("common.confirmDelete"),trigger:()=>a(k,{type:"error",ghost:!0,size:"small"},{default:()=>K("common.delete")})})])}}];async function T(h){var v;return h.file.file.size>100*1024*1024?((v=window.$message)==null||v.error("文件大小不能超过100M"),!1):!0}const m=x(!1),J=x(null),ne=x({fileName:"",file:null,id:void 0}),ke={fileName:[{required:!0,message:"请输入文件别名",trigger:["blur","change"]}]},ie=x(0),ge=()=>{H.value=[],m.value=!0,ie.value=0,ne.value.id=void 0,ne.value.fileName="",ne.value.file=null},ye=async()=>{var h,v,E,q;try{if(await((h=J.value)==null?void 0:h.validate()),ne.value.id){const{data:G,error:d}=await gs([{id:ne.value.id,filename:ne.value.fileName}]);if(d)return(v=window.$message)==null?void 0:v.error("保存文件记录失败");(E=window.$message)==null||E.destroyAll(),(q=window.$message)==null||q.success("编辑成功"),Z("getData"),R.value=!1;return}}catch{R.value=!1}};async function ve(h){if(h!=null&&h.url)try{const E=await(await fetch(h.url,{mode:"cors"})).blob(),q=URL.createObjectURL(E),G=document.createElement("a");G.href=q,G.download=h.filename,G.style.display="none",document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(q)}catch(v){console.error("下载失败:",v)}}const Be=()=>{console.log("渲染完成")},be=h=>{console.log(h,"渲染失败")},xe=x(!1),oe=x(""),le=x([]),me=x(""),V=x("预览文件"),z=x(!1),re=x(0),ue=h=>{var E,q;if(!(h!=null&&h.url))return;const v=(E=h.filename.split(".").pop())==null?void 0:E.toLowerCase();if(oe.value=h.url,V.value=h.filename,["xls","xlsx"].includes(v))me.value="xls";else if(["doc","docx"].includes(v))me.value="doc";else if(["pdf"].includes(v))me.value="pdf";else if(["png","jpg","jpeg","gif","bmp"].includes(v)){me.value="img",le.value=W.data.map(d=>{var y;return["png","jpg","jpeg","gif","bmp"].includes((y=d.filename.split(".").pop())==null?void 0:y.toLowerCase())?d.url:""}).filter(d=>d!=="");const G=le.value.findIndex(d=>d===h.url);re.value=G,z.value=!0;return}else if(["mp4"].includes(v))me.value="mp4";else{(q=window.$message)==null||q.warning("暂不支持该文件类型预览");return}xe.value=!0},te=x(45),Ce=()=>{te.value==45?te.value=350:te.value=45},R=x(!1);function fe(h){ne.value.id=h.id,ne.value.fileName=h.name,R.value=!0}const Q=()=>{R.value=!1};function _e(h){return h.replace(/\.[^/.]+$/,"")}const C=[{title:"文件名称",key:"filename",align:"center",render(h){if(!h.name){const v=async({file:q,onFinish:G,onError:d})=>{var y,j;try{h.status=!0;const _=await Yt(q.file,q.name,"",r=>{h.progress=r});_&&(h.url=_,h.name=q.name,h.status=!1)}catch(_){console.error(_),(j=(y=window.$message)==null?void 0:y.error)==null||j.call(y,"文件上传出错"),h.status=!1}};async function E(q){var G;return q.file.file.size>100*1024*1024?((G=window.$message)==null||G.error("文件大小不能超过100M"),!1):!0}return a("div",{style:"display: flex; justify-content: center; align-items: center;"},[a(Kt,{action:"#",showFileList:!1,customRequest:v,onBeforeUpload:E},{default:()=>a(k,{type:"info",size:"small",ghost:!0,loading:h.status},{default:()=>"上传文件"})}),h.progress?a(xt,{type:"line",percentage:h.progress,indicatorPlacement:"inside",processing:!0}):null])}return a("div",{},h.name)}},{title:"文件别名",key:"filename",align:"center",render(h){return a(X,{value:h.filename??_e(h.name)??"",onUpdateValue:v=>{h.filename=v}})}},{title:"操作",key:"actions",align:"center",width:100,render(h){return a(he,{justify:"center"},[a(k,{type:"error",size:"small",ghost:!0,onClick:()=>{H.value=H.value.filter(v=>v!==h)}},{default:()=>"删除"})])}}],H=x([]),Ae=x(0),Oe=x(!1),o=async()=>{var v,E,q,G,d;let h=!0;for(let y=0;y<H.value.length;y++){const j=H.value[y];if(!j.name){(v=window.$message)==null||v.warning(`第${y+1}个文件的文件名称不能为空`),h=!1;break}if(!j.name){(E=window.$message)==null||E.warning(`第${y+1}个文件的文件别名不能为空`),h=!1;break}}if(h){Oe.value=!0;const y=H.value.length;for(let b=0;b<y;b++){Ae.value=b;const w=H.value[b];w.indexText=`${b+1}/${y}`,w.progress=0,w.status="uploading";try{w.url=await Yt(w.file,w.name,"",O=>{w.progress=O}),w.progress=100,w.status="done"}catch{w.status="error"}}const j=H.value.map(b=>({file:b.url,filename:b.filename,pid:W.pid,sort:W.fileType})),{data:_,error:r}=await ms(j);if(r)return(q=window.$message)==null?void 0:q.error("保存文件记录失败");Z("getData"),(G=window.$message)==null||G.destroyAll(),(d=window.$message)==null||d.success("上传成功"),m.value=!1,Oe.value=!1}},S=()=>{m.value=!1};function F(h){h.fileList.forEach(v=>{v.filename||(v.filename=_e(v.name))}),H.value=h.fileList}return(h,v)=>{const E=_a,q=Aa,G=Va,d=xa,y=fl,j=Qt,_=fs,r=dt("no-auth");return u(),L(Ee,null,[f("div",ti,[f("div",ai,[f("h2",li,U(W.typename),1),we((u(),A(c(k),{size:"small",ghost:"",type:"primary",onClick:ge},{icon:n(()=>[l(E,{class:"text-icon"})]),default:n(()=>[p(" 新增"+U(W.typename),1)]),_:1})),[[r,"project:File:insert"]]),W.fileType==4?(u(),L("span",si,"照片数不少于6张")):D("",!0)]),W.data.length>0?(u(),L("div",ni,"共"+U(W.data.length)+"条",1)):D("",!0)]),W.data.length>0?(u(),A(c(Re),{key:0,columns:ee,data:W.data,size:"small","scroll-x":702,"row-key":b=>b.id,"max-height":te.value},null,8,["data","row-key","max-height"])):D("",!0),f("div",ii,[te.value==45&&W.data.length>1?(u(),L("span",{key:0,onClick:Ce},[v[7]||(v[7]=p(" 更多 ")),l(q,{class:"font-size-20px"})])):D("",!0),te.value==350&&W.data.length>1?(u(),L("span",{key:1,onClick:Ce},[v[8]||(v[8]=p(" 收起 ")),l(G,{class:"font-size-20px"})])):D("",!0)]),l(j,{show:R.value,"onUpdate:show":v[1]||(v[1]=b=>R.value=b),title:(ne.value.id?"编辑":"新增")+W.typename,preset:"card",class:"w-700px"},{default:n(()=>[l(y,{ref_key:"formRef",ref:J,model:ne.value,rules:ke,"label-width":"auto",style:{width:"100%"}},{default:n(()=>[l(d,{label:"文件别名",path:"fileName"},{default:n(()=>[l(c(X),{value:ne.value.fileName,"onUpdate:value":v[0]||(v[0]=b=>ne.value.fileName=b),placeholder:"请输入"},null,8,["value"])]),_:1}),ie.value?(u(),A(c(xt),{key:0,type:"line",percentage:ie.value,color:ie.value==100?"#18a058":"#2080f0","indicator-placement":"inside",processing:""},null,8,["percentage","color"])):D("",!0),l(d,null,{default:n(()=>[l(c(he),{justify:"center",style:{width:"100%"}},{default:n(()=>[l(c(k),{type:"primary",onClick:ye},{default:n(()=>v[9]||(v[9]=[p(U("确认"))])),_:1,__:[9]}),l(c(k),{onClick:Q},{default:n(()=>v[10]||(v[10]=[p("取消")])),_:1,__:[10]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),l(j,{show:m.value,"onUpdate:show":v[3]||(v[3]=b=>m.value=b),title:(ne.value.id?"编辑":"新增")+W.typename,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:n(()=>[l(c(he),{justify:"end"},{default:n(()=>[l(c(k),{size:"small",class:"mt-16px",onClick:S},{default:n(()=>[p(U(c(K)("common.cancel")),1)]),_:1}),l(c(k),{type:"primary",size:"small",class:"mt-16px",onClick:o},{default:n(()=>[p(U(c(K)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[l(c(Kt),{ref:"uploadRef",action:void 0,class:"mb-10px","file-list":H.value,"onUpdate:fileList":v[2]||(v[2]=b=>H.value=b),onBeforeUpload:T,multiple:!0,onChange:F,"show-file-list":!1},{default:n(()=>[l(c(k),{size:"small",ghost:"",type:"primary"},{default:n(()=>v[11]||(v[11]=[p("选择文件")])),_:1,__:[11]})]),_:1},8,["file-list"]),l(c(Re),{columns:C,"paginate-single-page":!1,data:H.value,"max-height":350},null,8,["data"]),H.value[Ae.value]&&Oe.value?(u(),L("div",oi,[f("div",ri,[f("span",null,U(H.value[Ae.value].filename||H.value[Ae.value].name),1),f("span",null,U(H.value[Ae.value].indexText),1)]),l(c(xt),{percentage:H.value[Ae.value].progress,status:H.value[Ae.value].status==="error"?"error":"success","show-indicator":""},null,8,["percentage","status"])])):D("",!0)]),_:1},8,["show","title"]),l(j,{show:xe.value,"onUpdate:show":v[4]||(v[4]=b=>xe.value=b),title:V.value,preset:"card",style:{width:"80%"}},{default:n(()=>[me.value==="img"?(u(),L("div",di,[f("img",{src:oe.value,alt:"预览图片",style:{"max-width":"100%",height:"80vh"}},null,8,ui)])):D("",!0),me.value.includes("xls")?(u(),A(c(as),{key:1,options:{xls:!0,minColLength:0,minRowLength:0,widthOffset:20,heightOffset:5},src:oe.value,style:{height:"80vh"},onRendered:Be,onError:be},null,8,["src"])):D("",!0),me.value.includes("doc")?(u(),A(c(ls),{key:2,src:oe.value,style:{height:"80vh"},onRendered:Be,onError:be},null,8,["src"])):D("",!0),me.value.includes("pdf")?(u(),A(c(ss),{key:3,src:oe.value,style:{height:"80vh"},onRendered:Be,onError:be},null,8,["src"])):D("",!0),me.value.includes("mp4")?(u(),L("div",ci,[f("video",{src:oe.value,controls:"",style:{width:"100%",height:"80vh"}},null,8,pi)])):D("",!0)]),_:1},8,["show","title"]),l(_,{show:z.value,"onUpdate:show":v[5]||(v[5]=b=>z.value=b),"src-list":le.value,current:re.value,"onUpdate:current":v[6]||(v[6]=b=>re.value=b)},null,8,["show","src-list","current"])],64)}}}),_t=ka(fi,[["__scopeId","data-v-a26ce7d1"]]),gi={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},mi=Ct({__name:"contractList",props:{id:{}},setup(de){const B=de,W=gl(),{columns:P,data:Z,getData:ee,loading:T,mobilePagination:m,searchParams:J}=dn({showTotal:!0,apiFn:Ra,apiParams:{page:1,pageSize:20,limit:20,id:void 0,_t:new Date().getTime()},immediate:!1,columns:()=>[{key:"contractname",title:"合同名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"contractnum",title:"合同编号",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"businesscon",title:"商务负责人",align:"center",width:100,ellipsis:{tooltip:!0}},{key:"businessinfo",title:"商务联系方式",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"precautions",title:"注意事项",align:"center",width:100},{key:"username",title:"创建者",align:"center",width:100,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0}]});return Ma(async()=>{J.id=B.id,B.id&&ee()}),(ne,ke)=>{const ie=he,ge=Re,ye=Oa;return u(),L("div",gi,[l(ye,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[l(ie,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:n(()=>ke[0]||(ke[0]=[f("div",null,"关联合同列表",-1)])),_:1,__:[0]})]),default:n(()=>[l(ge,{columns:c(P),data:c(Z),size:"small","flex-height":!c(W).isMobile,"scroll-x":c(P).reduce((ve,Be)=>ve+(Be.width||100),0),loading:c(T),remote:"","row-key":ve=>ve.id,pagination:c(m),class:"h-400px"},null,8,["columns","data","flex-height","scroll-x","loading","row-key","pagination"])]),_:1})])}}}),vi=Ct({name:"businessModal",__name:"businessModal",props:ha({pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ha(["submitted"],["update:visible"]),setup(de,{emit:B}){const W=B,P=$t(),Z=de;async function ee(){ne(),be(),me(),Ce(),Q.value=[],fe.value=!0,R.value=!0,H.value=[]}hs();const T=bs(()=>"新增待调试业务"),m=ml(de,"visible");Wt(m,()=>{m.value&&ee()});const{pageData:J,getData:ne,nextPage:ke}=lt(vl),ie=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&J.data.length<J.total&&ke()},{pageData:ge,getData:ye,nextPage:ve}=lt(Pa),Be=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&ge.data.length<ge.total&&(ve(),ge.data=ge.data.map(j=>({...j,value:j.docker+"&id="+j.id})))},be=async()=>{await ye({pid:Z.pid}),ge.data=ge.data.map(d=>({...d,value:d.docker+"&id="+d.id}))},{pageData:xe,getData:oe,nextPage:le}=lt(yl),me=async()=>{await oe({usertypes:"2,3"})},V=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&xe.data.length<xe.total&&le()},{pageData:z,getData:re,nextPage:ue}=lt(Ta),te=async d=>{const y=d.currentTarget,j=y.scrollTop;y.scrollTop+y.offsetHeight>=y.scrollHeight&&J.data.length<J.total&&(await ue(),await rt(),setTimeout(()=>{y.scrollTop=j}))},Ce=async()=>{await re({pid:Z.pid})},R=x(!0),fe=x(!0),Q=x([]),_e=[{title:"权重",key:"dtype",width:180,align:"center",render(d,y){return d.setStatus?a(De,{value:d.dtype,filterable:!0,placeholder:"请选择权重",options:J.data,labelField:"tname",valueField:"id",onUpdateValue(j){var _;Q.value[y].dtype=Number(j)||0,Q.value[y].debugname=((_=J.data.find(r=>r.id==j))==null?void 0:_.tname)||""},onScroll(j){ie(j)}}):a("div",{},d.tname)}},{title:"业务名称",key:"debugname",width:180,align:"center",render(d,y){return d.setStatus?a(X,{value:d.debugname,placeholder:"请输入业务名称",onUpdateValue(j){Q.value[y].debugname=j}}):a("div",{},d.debugname)}},{title:"状态",key:"status",width:120,align:"center",render(d,y){return d.setStatus&&d.id?a(De,{value:d.status,filterable:!0,placeholder:"请选择状态",options:P.userInfo.usertype==0||P.userInfo.usertype==2?[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}],onUpdateValue(j){Q.value[y].status=Number(j)||0}}):a(Ja,{type:d.status==0?"info":d.status==1||d.status==2?"warning":"success"},d.status==0?"待调试":d.status==1?"开始调试":d.status==2?"待审核":"审核完成")}},{key:"eqmname",title:"调试设备",align:"center",width:150,render(d,y){return a(De,{value:d.eqmid,placeholder:"请选择调试设备",options:z.data,onscroll:te,labelField:"devname",valueField:"id",clearable:!0,filterable:!0,onUpdateValue(j){Q.value[y].eqmid=j}})}},{key:"docker",width:140,align:"center",title:()=>a("div",{style:"display:flex;align-items:center;justify-content:center;gap:6px;"},[a("span",null,"对接方"),a(al,{size:"small",checked:R.value,label:"联动",style:"margin-left: 10px;font-size: 12px;",onUpdateChecked:d=>{R.value=d}})]),render(d,y){var j;return d.setStatus?a(De,{value:d.docker,placeholder:"请输入或选择对接方",options:ge.data,onscroll:Be,labelField:"docker",valueField:"value",clearable:!0,filterable:!0,tag:!0,onClear(){d.dockcharge="",d.dockcontact=""},onUpdateValue(_){var r;if(R.value)Q.value.forEach((b,w)=>{var Fe;b.docker=_;const[O,se]=(Fe=d.docker)==null?void 0:Fe.split("&id="),ce=ge.data.find(We=>We.docker===O&&We.id===Number(se));ce?(b.dockcharge=ce.pname,b.dockcontact=ce.pcontact):(b.dockcharge="",b.dockcontact="")});else{Q.value[y].docker=_;const[b,w]=(r=d.docker)==null?void 0:r.split("&id="),O=ge.data.find(se=>se.docker===b&&se.id===Number(w));O?(d.dockcharge=O.pname,d.dockcontact=O.pcontact):(d.dockcharge="",d.dockcontact="")}}}):a("div",{},(j=d.docker)==null?void 0:j.split("&id=")[0])}},{title:"对接方负责人",key:"dockcharge",width:100,align:"center",render(d,y){return d.setStatus?a(X,{value:d.dockcharge,placeholder:"请输入对接方负责人",onUpdateValue(j){Q.value[y].dockcharge=j}}):a("div",{},d.dockcharge)}},{title:"联系方式",key:"dockcontact",width:120,align:"center",render(d,y){return d.setStatus?a(X,{value:d.dockcontact,placeholder:"请输入联系方式",onUpdateValue(j){Q.value[y].dockcontact=j}}):a("div",{},d.dockcontact)}},{key:"dbcreater",width:140,align:"center",title:()=>a("div",{style:"display:flex;align-items:center;justify-content:center;gap:6px;"},[a("span",null,"调试人"),a(al,{size:"small",checked:fe.value,label:"联动",style:"margin-left: 10px;font-size: 12px;",onUpdateChecked:d=>{fe.value=d}})]),render(d,y){return d.setStatus?a(De,{value:d.dbcreater,filterable:!0,placeholder:"请选择调试人",options:xe.data,labelField:"username",valueField:"id",onUpdateValue(j){fe.value?Q.value.forEach((_,r)=>{_.dbcreater=j||0}):Q.value[y].dbcreater=j||0},onScroll(j){V(j)}}):a("div",{},d.dbusername)}},{title:"文件",key:"re1",width:100,align:"center",render(d,y){return d.setStatus?a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>F(d,y)},{default:()=>"上传文件"}):a(ot,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const j=[{alias:d.re1,file:d.fl1},{alias:d.re2,file:d.fl2},{alias:d.re3,file:d.fl3},{alias:d.re4,file:d.fl4}].filter(_=>_.alias||_.file);return j.length===0?a("div",{style:"padding: 10px; color: #999;"},"暂无文件"):a("div",{style:"padding: 10px;"},[a("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[a("thead",[a("tr",[a("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),a("th",{style:"text-align:center; padding: 4px 8px;"},"文件")])]),a("tbody",j.map(_=>{var r;return a("tr",[a("td",{style:"text-align:center; padding: 4px 8px;"},_.alias||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},((r=_.file)==null?void 0:r.split("?")[1])||"-")])}))])])}})}},{title:"备注",key:"notes",width:200,align:"center",render(d,y){return d.setStatus?a(X,{value:d.notes,placeholder:"请输入备注",onUpdateValue(j){Q.value[y].notes=j}}):a("div",{},d.notes)}},{title:"计划开始时间",key:"starttime",width:200,align:"center",render(d,y){return d.setStatus?a(ba,{type:"date",clearable:!0,value:d.starttime,valueFormat:"yyyy-MM-dd",placeholder:"请选择",onUpdateValue(j){Q.value[y].starttime=j}}):a("div",Ge(0,d.starttime))}},{title:"计划结束时间",key:"endtime",width:200,align:"center",render:(d,y)=>d.setStatus?a(ba,{type:"date",clearable:!0,valueFormat:"yyyy-MM-dd",value:d.endtime,placeholder:"请选择",onUpdateValue(j){Q.value[y].endtime=j}}):Ge(0,d.endtime)},{key:"operate",title:K("common.operate"),align:"center",width:120,fixed:"right",render(d,y){return a("div",{class:"flex-center gap-8px"},[a(Te,{onPositiveClick:()=>{Q.value.splice(y,1),H.value.splice(y,1)}},{default:()=>K("common.confirmDelete"),trigger:()=>a(k,{type:"error",ghost:!0,size:"small"},{default:()=>K("common.delete")})})])}}];function C(){m.value=!1}const H=x([]),Ae=d=>{Q.value=[],d.forEach(y=>{var j;Q.value.push({debugname:(j=J.data.find(_=>_.id==y))==null?void 0:j.tname,docker:void 0,dockcharge:"",dockcontact:"",debugresult:0,status:0,notes:"",dbcreater:void 0,dtype:y,setStatus:!0,pid:Z.pid,starttime:null,endtime:null})})};async function Oe(){var b,w,O,se;const d=["dtype","debugname","docker","dbcreater"];if(Q.value.find((ce,Fe)=>d.some(We=>!ce[We]||ce[We].toString().trim()===""))){(w=(b=window.$message)==null?void 0:b.error)==null||w.call(b,"请完整填写所有必填项（权重、业务名称、对接方、调试人）");return}const j=Q.value.map(ce=>{var Fe;return{...ce,starttime:Ge(0,ce.starttime),endtime:Ge(0,ce.endtime),docker:(Fe=ce.docker)==null?void 0:Fe.split("&id=")[0]}}),{data:_,error:r}=await hl(j);r||((se=(O=window.$message)==null?void 0:O.success)==null||se.call(O,"添加成功"),C(),W("submitted"))}const o=x(!1),S=x(),F=(d,y)=>{v.value=[],o.value=!0,S.value=y,d.re1&&v.value.push({id:"",name:d.re1,url:d.fl1,status:!1}),d.re2&&v.value.push({id:"",name:d.re2,url:d.fl2,status:!1}),d.re3&&v.value.push({id:"",name:d.re3,url:d.fl3,status:!1}),d.re4&&v.value.push({id:"",name:d.re4,url:d.fl4,status:!1})},h=[{title:"文件名称",key:"filename",align:"center",render(d){if(!d.url){const y=async({file:_,onFinish:r,onError:b})=>{var w,O;try{d.status=!0;const se=await Yt(_.file,_.name,"",ce=>{d.progress=ce});se&&(d.url=se,d.name=_.name,d.status=!1)}catch(se){console.error(se),(O=(w=window.$message)==null?void 0:w.error)==null||O.call(w,"文件上传出错"),d.status=!1}};async function j(_){var r;return _.file.file.size>100*1024*1024?((r=window.$message)==null||r.error("文件大小不能超过100M"),!1):!0}return a("div",{style:"display: flex; justify-content: center; align-items: center;"},[a(Kt,{action:"#",showFileList:!1,customRequest:y,onBeforeUpload:j},{default:()=>a(k,{type:"info",size:"small",ghost:!0,loading:d.status},{default:()=>"上传文件"})}),d.progress?a(xt,{type:"line",percentage:d.progress,indicatorPlacement:"inside",processing:!0}):null])}return d.url&&!d.id?l("span",null,[d.url.split("?")[1],p(" "),l("span",{onClick:()=>d.url="",style:"color: red;cursor: pointer;font-size: 12px;"},[p("删除")])]):a("div",{},d.url.split("?")[1])}},{title:"文件别名",key:"name",align:"center",render(d){return a(X,{value:d.name,onUpdateValue:y=>{d.name=y}})}},{title:"操作",key:"actions",align:"center",width:100,render(d){return a(he,{justify:"center"},[a(k,{type:"error",size:"small",ghost:!0,onClick:()=>{v.value=v.value.filter(y=>y!==d)}},{default:()=>"删除"})])}}],v=x([]),E=()=>{var d,y;if(v.value.length>=4)return(y=(d=window.$message)==null?void 0:d.warning)==null?void 0:y.call(d,"最多上传4个文件");v.value.push({id:"",name:"",url:"",status:!1,setStatus:!0})},q=async()=>{v.value.forEach(async(d,y)=>{Q.value[S.value][`re${y+1}`]=d.name,Q.value[S.value][`fl${y+1}`]=d.url}),o.value=!1,S.value=void 0},G=()=>{o.value=!1};return(d,y)=>{const j=xa,_=Re,r=Qt,b=_a;return u(),L(Ee,null,[l(r,{show:m.value,"onUpdate:show":y[1]||(y[1]=w=>m.value=w),title:T.value,preset:"card",class:"w-80%","mask-closable":!1,draggable:!0},{footer:n(()=>[l(c(he),{justify:"end",size:16},{default:n(()=>[l(c(k),{onClick:C},{default:n(()=>[p(U(c(K)("common.cancel")),1)]),_:1}),l(c(k),{type:"primary",onClick:Oe},{default:n(()=>[p(U(c(K)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[l(j,{label:"权重","label-placement":"left"},{default:n(()=>[l(c(De),{filterable:"",multiple:"",value:H.value,"onUpdate:value":[y[0]||(y[0]=w=>H.value=w),Ae],tag:"",style:{"min-width":"300px"},placeholder:"请选择权重","label-field":"tname","value-field":"id",options:c(J).data,onScroll:ie},null,8,["value","options"])]),_:1}),l(_,{style:{width:"100%"},columns:_e,data:Q.value,size:"small","row-key":w=>w.id,striped:"","scroll-x":_e.reduce((w,O)=>w+O.width,0),"max-height":350},null,8,["data","row-key","scroll-x"])]),_:1},8,["show","title"]),l(r,{show:o.value,"onUpdate:show":y[2]||(y[2]=w=>o.value=w),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:n(()=>y[3]||(y[3]=[p(" 待调试业务文件列表 ")])),footer:n(()=>[l(c(he),{justify:"end"},{default:n(()=>[l(c(k),{size:"small",class:"mt-16px",onClick:G},{default:n(()=>[p(U(c(K)("common.cancel")),1)]),_:1}),l(c(k),{type:"primary",size:"small",class:"mt-16px",onClick:q},{default:n(()=>[p(U(c(K)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[l(c(k),{size:"small",ghost:"",type:"primary",onClick:E},{icon:n(()=>[l(b,{class:"text-icon"})]),default:n(()=>[y[4]||(y[4]=p(" 添加 "))]),_:1,__:[4]}),l(_,{columns:h,"paginate-single-page":!1,data:v.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])],64)}}}),yi=Ct({name:"deviceModal",__name:"deviceModal",props:ha({pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ha(["submitted"],["update:visible"]),setup(de,{emit:B}){const W=B;$t();const P=de;async function Z(){m(),oe.value=[],le.value=[]}const ee=ml(de,"visible");Wt(ee,()=>{ee.value&&Z()});const T=x([]),m=async()=>{var F,h;const{data:o,error:S}=await Ra({page:1,limit:100,id:P.pid});if(o){if(T.value=o==null?void 0:o.list.map(v=>({value:v.id,label:v.contractname,isLeaf:!1})),T.value.length==0)return(F=window.$message)==null?void 0:F.error("该项目没有绑定合同！");ye((h=o==null?void 0:o.list[0])==null?void 0:h.id)}},J=x([]),ne=x(),{pageData:ke,getData:ie,nextPage:ge}=lt(_l),ye=async o=>{await ie({pids:o}),ne.value=[],J.value=Array.from(new Set([...J.value,...ke.data])),ne.value=ke.data.map(S=>({label:S.devname,value:S.id}))},ve=async o=>{var S;await ye(o.value),o.children=(S=ne.value)==null?void 0:S.map(F=>({label:F.label,value:F.value,isLeaf:!0})),await rt(),setTimeout(()=>{const F=document.querySelectorAll(".n-cascader-submenu-wrapper .n-scrollbar");console.log(F[1]),F[1]&&(F[1].removeEventListener("scroll",Ce),F[1].addEventListener("scroll",Ce))},2e3)};function Be(o,S){const F=o.filter(v=>!S.includes(v)),h=S.filter(v=>!o.includes(v));return{toDelete:F,toAdd:h}}const be=x([]),xe=async o=>{const{toDelete:S,toAdd:F}=Be(be.value,o);S.forEach(h=>{const v=le.value.findIndex(E=>E.cid==h);v!=-1&&le.value.splice(v,1)}),F.forEach(async h=>{var v,E,q,G,d,y,j,_,r,b,w,O,se,ce,Fe,We;le.value.push({devname:((E=(v=J.value)==null?void 0:v.find(Se=>Se.id==h))==null?void 0:E.devname)||"",devmodel:((G=(q=J.value)==null?void 0:q.find(Se=>Se.id==h))==null?void 0:G.devmodel)||"",devnum:((y=(d=J.value)==null?void 0:d.find(Se=>Se.id==h))==null?void 0:y.devcount)||0,devmanu:((_=(j=J.value)==null?void 0:j.find(Se=>Se.id==h))==null?void 0:_.devmanu)||"",etype:((b=(r=J.value)==null?void 0:r.find(Se=>Se.id==h))==null?void 0:b.etype)||0,status:0,devunit:((O=(w=J.value)==null?void 0:w.find(Se=>Se.id==h))==null?void 0:O.devunit)||"",notes:((ce=(se=J.value)==null?void 0:se.find(Se=>Se.id==h))==null?void 0:ce.notes)||"",setStatus:!0,cid:h,pid:P.pid,devnumber:((We=(Fe=J.value)==null?void 0:Fe.find(Se=>Se.id==h))==null?void 0:We.devcount)||0})}),be.value=o},oe=x([]),le=x([]),me=[{title:"绑定合同设备",key:"cid",width:300,align:"center",render(o,S){var F,h;return o.setStatus?a(Ea,{style:"width: 270px",value:o.cid,filterable:!0,placeholder:"请选择合同设备",options:T.value,checkStrategy:"child",showPath:!1,remote:!0,onLoad:ve,onUpdateValue(v){var q;le.value[S].cid=Number(v)||0;const E=(q=J.value)==null?void 0:q.find(G=>G.id==v);o.devname=(E==null?void 0:E.devname)||"",o.devnum=(E==null?void 0:E.devcount)||"",o.notes=(E==null?void 0:E.notes)||"",o.devnumber=(E==null?void 0:E.devcount)||0,o.etype=(E==null?void 0:E.devtype)||0,o.devmanu=(E==null?void 0:E.devmanu)||"",o.devmodel=((E==null?void 0:E.devmodel.length)>64?E==null?void 0:E.devname:E==null?void 0:E.devmodel)||"",o.devunit=(E==null?void 0:E.devunit)||""}}):a("div",{},o.devname2||((h=(F=ne.value)==null?void 0:F.find(v=>v.value==o.cid))==null?void 0:h.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(o,S){return o.setStatus?a(X,{value:o.devname,placeholder:"请输入",onUpdateValue(F){le.value[S].devname=F}}):a("div",{},o.devname)}},{title:"型号",key:"devmodel",width:220,align:"center",render(o,S){return a("div",{},o.devmodel)}},{title:"设备单位",key:"devunit",width:120,align:"center",render(o,S){return a("div",{},o.devunit)}},{title:"数量",key:"devnum",width:100,align:"center",render(o,S){return o.setStatus?a(bl,{value:o.devnum,placeholder:"请输入",max:o.devnumber,onUpdateValue(F){le.value[S].devnum=F}}):a("div",{},o.devnum)}},{title:"是否为我司设备",key:"etype",width:260,align:"center",render(o,S){return a("div",{},o.etype==0?"是":"否")}},{title:"设备厂家",key:"devmanu",width:200,align:"center",render(o,S){return a("div",{},o.devmanu)}},{title:"清点状态",key:"status",width:120,align:"center",render(o,S){return o.setStatus&&o.id?a(De,{value:o.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(F){le.value.debuggedDevieceList[S].status=Number(F)||0}}):a("div",{},o.status===0?"未清点":o.status===1?"正常":o.status===2?"增补":o.status===3?"退货":"换货")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(o,S){return a("div",{},o.devmanu)}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(o,S){return o.setStatus?a(X,{value:o.manucontact,placeholder:"请输入",onUpdateValue(F){le.value[S].manucontact=F}}):a("div",{},o.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(o,S){return o.setStatus?a(X,{value:o.manuinfo,placeholder:"请输入",onUpdateValue(F){le.value[S].manuinfo=F}}):a("div",{},o.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(o,S){return o.setStatus&&o.id?a(De,{value:o.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(F){le.value[S].devstatus=Number(F)||0}}):a("div",{},o.devstatus===0?"设备无异常":o.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(o,S){return o.setStatus?a(X,{value:o.connectionmode,placeholder:"请输入",onUpdateValue(F){le.value[S].connectionmode=F}}):a("div",{},o.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(o,S){return o.setStatus&&o.id?a(De,{value:o.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(F){le.value[S].install=Number(F)||0}}):a("div",{},o.install===0?"是":"否")}},{title:"备注",key:"notes",width:200,align:"center",render(o,S){return a("div",{},o.notes)}},{title:"文件",key:"re1",width:160,align:"center",render(o,S){return o.setStatus?a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>Q(o,S)},{default:()=>"上传文件"}):a(ot,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const F=[{alias:o.re1,file:o.fl1},{alias:o.re2,file:o.fl2},{alias:o.re3,file:o.fl3},{alias:o.re4,file:o.fl4}].filter(h=>h.alias||h.file);return F.length===0?a("div",{style:"padding: 10px; color: #999;"},"暂无文件"):a("div",{style:"padding: 10px;"},[a("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[a("thead",[a("tr",[a("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),a("th",{style:"text-align:center; padding: 4px 8px;"},"文件")])]),a("tbody",F.map(h=>{var v;return a("tr",[a("td",{style:"text-align:center; padding: 4px 8px;"},h.alias||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},((v=h.file)==null?void 0:v.split("?")[1])||"-")])}))])])}})}},{title:"操作信息",key:"dbtime",width:180,align:"center",render(o,S){return a(ot,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},o.dbtime?Ge(1,o.dbtime):""),default:()=>a("div",{style:"padding: 10px;"},l("div",null,[l("div",null,[p("操作人："),o.username]),l("div",null,[p("操作时间："),o.dbtime]),l("div",null,[p("清点人："),o.dusername]),l("div",null,[p("清点时间："),o.ddbtime])]))})}},{key:"operate",title:K("common.operate"),align:"center",width:180,fixed:"right",render(o,S){return a("div",{class:"flex-center gap-8px"},[a(Te,{onPositiveClick:()=>{o.id||(le.value.splice(S,1),oe.value.splice(S,1))}},{default:()=>K("common.confirmDelete"),trigger:()=>a(k,{type:"error",ghost:!0,size:"small"},{default:()=>K("common.delete")})})])}}];function V(){ee.value=!1}async function z(){var v,E,q,G;const o=["cid","devname","devnum"];if(le.value.find((d,y)=>o.some(j=>!d[j]||d[j].toString().trim()===""))){(E=(v=window.$message)==null?void 0:v.error)==null||E.call(v,"请完整填写所有必填项（合同设备、设备名称、数量）");return}const{data:F,error:h}=await kl(le.value);h||((G=(q=window.$message)==null?void 0:q.success)==null||G.call(q,"添加成功"),V(),W("submitted"))}const re=async o=>{},ue=x(!1),te=x(!0),Ce=async o=>{console.log(o);const S=o.target;S.scrollHeight-S.scrollTop-S.clientHeight<10&&!ue.value&&te.value&&(ue.value=!0,ge(),ne.value=ke.data.map(h=>({label:h.devname,value:h.id})),ue.value=!1)},R=x(!1),fe=x(),Q=(o,S)=>{C.value=[],R.value=!0,fe.value=S,o.re1&&C.value.push({id:"",name:o.re1,url:o.fl1,status:"uploading",progress:0}),o.re2&&C.value.push({id:"",name:o.re2,url:o.fl2,status:!1,progress:0}),o.re3&&C.value.push({id:"",name:o.re3,url:o.fl3,status:!1,progress:0}),o.re4&&C.value.push({id:"",name:o.re4,url:o.fl4,status:!1,progress:0})},_e=[{title:"文件名称",key:"filename",align:"center",render(o){if(!o.url){const S=async({file:h,onFinish:v,onError:E})=>{var q,G;try{o.status=!0;const d=await Yt(h.file,h.name,"",y=>{o.progress=y});d&&(o.url=d,o.name=h.name,o.status=!1)}catch(d){console.error(d),(G=(q=window.$message)==null?void 0:q.error)==null||G.call(q,"文件上传出错"),o.status=!1}};async function F(h){var v;return h.file.file.size>100*1024*1024?((v=window.$message)==null||v.error("文件大小不能超过100M"),!1):!0}return a("div",{style:"display: flex; justify-content: center; align-items: center;"},[a(Kt,{action:"#",showFileList:!1,customRequest:S,onBeforeUpload:F},{default:()=>a(k,{type:"info",size:"small",ghost:!0,loading:o.status},{default:()=>"上传文件"})}),o.progress?a(xt,{type:"line",percentage:o.progress,indicatorPlacement:"inside",processing:!0}):null])}return o.url&&!o.id?l("span",null,[o.url.split("?")[1],p(" "),l("span",{onClick:()=>o.url="",style:"color: red;cursor: pointer;font-size: 12px;"},[p("删除")])]):a("div",{},o.url.split("?")[1])}},{title:"文件别名",key:"name",align:"center",render(o){return a(X,{value:o.name,onUpdateValue:S=>{o.name=S}})}},{title:"操作",key:"actions",align:"center",width:100,render(o){return a(he,{justify:"center"},[a(k,{type:"error",size:"small",ghost:!0,onClick:()=>{C.value=C.value.filter(S=>S!==o)}},{default:()=>"删除"})])}}],C=x([]),H=()=>{var o,S;if(C.value.length>=4)return(S=(o=window.$message)==null?void 0:o.warning)==null?void 0:S.call(o,"最多上传4个文件");C.value.push({id:"",name:"",url:"",status:!1,setStatus:!0})},Ae=async()=>{C.value.forEach(async(o,S)=>{le.value[fe.value][`re${S+1}`]=o.name,le.value[fe.value][`fl${S+1}`]=o.url}),R.value=!1,fe.value=void 0},Oe=()=>{R.value=!1};return(o,S)=>{const F=xa,h=Re,v=Qt,E=_a;return u(),L(Ee,null,[l(v,{show:ee.value,"onUpdate:show":S[1]||(S[1]=q=>ee.value=q),title:"新增待调试设备",preset:"card",class:"w-80%","mask-closable":!1,draggable:!0},{footer:n(()=>[l(c(he),{justify:"end",size:16},{default:n(()=>[l(c(k),{onClick:V},{default:n(()=>[p(U(c(K)("common.cancel")),1)]),_:1}),l(c(k),{type:"primary",onClick:z},{default:n(()=>[p(U(c(K)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[l(F,{label:"合同设备","label-placement":"left"},{default:n(()=>[l(c(Ea),{value:oe.value,"onUpdate:value":[S[0]||(S[0]=q=>oe.value=q),xe],placeholder:"请选择合同设备",options:T.value,"check-strategy":"child","show-path":!1,labelKey:"label",remote:"",multiple:"","on-load":ve,"onUpdate:show":re},null,8,["value","options"])]),_:1}),l(h,{style:{width:"100%"},columns:me,data:le.value,size:"small","row-key":q=>q.id,striped:"","scroll-x":me.reduce((q,G)=>q+G.width,0),"max-height":350},null,8,["data","row-key","scroll-x"])]),_:1},8,["show"]),l(v,{show:R.value,"onUpdate:show":S[2]||(S[2]=q=>R.value=q),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:n(()=>S[3]||(S[3]=[p(" 待调试设备文件列表 ")])),footer:n(()=>[l(c(he),{justify:"end"},{default:n(()=>[l(c(k),{size:"small",class:"mt-16px",onClick:Oe},{default:n(()=>[p(U(c(K)("common.cancel")),1)]),_:1}),l(c(k),{type:"primary",size:"small",class:"mt-16px",onClick:Ae},{default:n(()=>[p(U(c(K)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[l(c(k),{size:"small",ghost:"",type:"primary",onClick:H},{icon:n(()=>[l(E,{class:"text-icon"})]),default:n(()=>[S[4]||(S[4]=p(" 添加 "))]),_:1,__:[4]}),l(h,{columns:_e,"paginate-single-page":!1,data:C.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])],64)}}}),hi={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function bi(de,B){return u(),L("svg",hi,B[0]||(B[0]=[f("path",{fill:"currentColor",d:"M11 13H5v-2h6V5h2v6h6v2h-6v6h-2z"},null,-1)]))}const _i=ut({name:"material-symbols-add",render:bi}),ki={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function xi(de,B){return u(),L("svg",ki,B[0]||(B[0]=[f("path",{fill:"currentColor",d:"M10.825 22q-.675 0-1.162-.45t-.588-1.1L8.85 18.8q-.325-.125-.612-.3t-.563-.375l-1.55.65q-.625.275-1.25.05t-.975-.8l-1.175-2.05q-.35-.575-.2-1.225t.675-1.075l1.325-1Q4.5 12.5 4.5 12.337v-.675q0-.162.025-.337l-1.325-1Q2.675 9.9 2.525 9.25t.2-1.225L3.9 5.975q.35-.575.975-.8t1.25.05l1.55.65q.275-.2.575-.375t.6-.3l.225-1.65q.1-.65.588-1.1T10.825 2h2.35q.675 0 1.163.45t.587 1.1l.225 1.65q.325.125.613.3t.562.375l1.55-.65q.625-.275 1.25-.05t.975.8l1.175 2.05q.35.575.2 1.225t-.675 1.075l-1.325 1q.025.175.025.338v.674q0 .163-.05.338l1.325 1q.525.425.675 1.075t-.2 1.225l-1.2 2.05q-.35.575-.975.8t-1.25-.05l-1.5-.65q-.275.2-.575.375t-.6.3l-.225 1.65q-.1.65-.587 1.1t-1.163.45zm1.225-6.5q1.45 0 2.475-1.025T15.55 12t-1.025-2.475T12.05 8.5q-1.475 0-2.488 1.025T8.55 12t1.013 2.475T12.05 15.5"},null,-1)]))}const Ci=ut({name:"material-symbols-settings-rounded",render:xi}),Si={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Li(de,B){return u(),L("svg",Si,B[0]||(B[0]=[f("path",{fill:"currentColor",d:"m10.6 16.6l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const wi=ut({name:"material-symbols-check-circle-outline",render:Li}),Di={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function zi(de,B){return u(),L("svg",Di,B[0]||(B[0]=[f("path",{fill:"currentColor",d:"M8 16h2V8H8zm4 0l6-4l-6-4zm0 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const $i=ut({name:"material-symbols-not-started-outline",render:zi}),Ui={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function ji(de,B){return u(),L("svg",Ui,B[0]||(B[0]=[f("path",{fill:"currentColor",d:"M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.2 0 .375.038t.35.112L17.875 5H5v14h14v-6.65l2-2V19q0 .825-.587 1.413T19 21zm6.525-4l-5.65-5.65l1.4-1.4l4.25 4.25L20.7 5.025L22.125 6.4z"},null,-1)]))}const Bi=ut({name:"material-symbols-select-check-box",render:ji}),Fi={class:"w-500px whitespace-normal"},Ni={style:{display:"flex",alignItems:"center",justifyContent:"space-between",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Ii={key:1,style:{display:"none"}},Pi={key:1,style:{display:"none"}},Ti={key:1,style:{display:"none"}},Ei={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Ai={style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Vi={class:"flex items-center"},Mi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},qi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Oi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Ri={style:{display:"flex","align-items":"center",width:"100%",gap:"8px"}},Ji={style:{"font-weight":"500",color:"#333","margin-bottom":"4px"}},Hi={style:{"font-size":"13px",color:"#666"}},Gi={class:"flex items-center",style:{position:"absolute",top:"50%",transform:"translateY(-50%)"}},Wi={style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Ki={class:"flex-col w-100%"},Yi={class:"w-100px"},Qi=2,Xi=Ct({__name:"prjDetail",props:{prjDetailInfo:{}},emits:["searchDetail"],setup(de,{emit:B}){const W=$t(),P=de,Z=B,ee=x(!1),T=Ye({}),m=async(_,r)=>{var O;const{data:b,error:w}=await ll([{id:_.id,status:r}]);w||((O=window.$message)==null||O.success("操作成功"),Z("searchDetail"))},J=x([]),ne=async()=>{const{data:_,error:r}=await Cs();_&&(J.value=_)},ke=_=>{ye(_),T.region=void 0,T.prosite="",T.proaddr="",te.value=""},ie=_=>{var b;const r=(b=ge.value.find(w=>w.id===_))==null?void 0:b.name;Ae(r)},ge=x([]),ye=async _=>{var w;if(!_)return(w=window.$message)==null?void 0:w.warning("请先选择省份");const{data:r,error:b}=await _s({province:_});r&&(ge.value=r)};Wt(()=>P.prjDetailInfo,async _=>{Object.assign(T,_),console.log(T)},{immediate:!0,deep:!0});const ve=x(!1),Be=x();let be=null,xe=null,oe=null,le=null,me=null,V=null;const z=Ye({longitude:0,latitude:0});let re;const ue=x(!1),te=x(""),Ce=x([]);let R=0;async function fe(){try{if(window._AMapSecurityConfig={securityJsCode:W.userInfo.sdksecret},!Be.value)return;V=await fn.load({key:W.userInfo.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),be=new V.Map(Be.value,{zoom:18,center:[C.value>0?F.value[C.value-1].longitude:T.longitude,C.value>0?F.value[C.value-1].latitude:T.latitude],viewMode:"3D",resizeEnable:!0}),xe=new V.Geocoder,le=new V.PlaceSearch({city:"全国",pageSize:50}),me=new V.AutoComplete({city:"全国"}),Oe(V,{lng:C.value>0?F.value[C.value-1].longitude:T.longitude,lat:C.value>0?F.value[C.value-1].latitude:T.latitude}),be.on("click",_=>{const{lng:r,lat:b}=_.lnglat;re=2,z.latitude=b,z.longitude=r,Oe(V,{lng:r,lat:b})}),R=0,rt(()=>{window.dispatchEvent(new Event("resize"))})}catch(_){console.error("地图加载失败：",_),R<Qi?(R++,console.warn(`地图加载失败，正在第 ${R} 次重试...`),setTimeout(()=>{fe()},1500)):console.error("地图加载失败，已达到最大重试次数，停止重试")}}const Q=qa.debounce(async _=>{if(!_.trim()){Ce.value=[];return}me.search(_,(r,b)=>{var w;console.log(b,"result"),r=="complete"&&b.info=="OK"&&((w=b==null?void 0:b.tips)!=null&&w.length)?Ce.value=b.tips.map(O=>({label:`${O.name}（${O.district||O.address||"无详细地址"}）`,value:`${O.location.lng}_${O.location.lat}`,raw:O})):Ce.value=[]})},300);Wt(te,_=>{Q(_)});function _e(_,r){if(console.log(_,r,"option"),!_)return;const[b,w]=_.split("_").map(Number);!b||!w||(be.setCenter([b,w]),re=1,Oe(V,{lng:b,lat:w}),z.longitude=b,z.latitude=w)}const C=x(0);async function H(_){_?C.value=_:C.value=0,await ne(),ve.value=!0,ue.value=!1,re=void 0,T.proaddr=P.prjDetailInfo.proaddr,T.prosite=P.prjDetailInfo.prosite,T.provice=P.prjDetailInfo.provice,T.region=P.prjDetailInfo.region,T.provice&&ye(T.provice),rt(async()=>{await fe(),setTimeout(()=>{ue.value=!0;const r=document.querySelector(".n-auto-complete input");r==null||r.blur()},500)})}function Ae(_){!_||!xe||!be||xe.getLocation(_,(r,b)=>{var w;if(r==="complete"&&((w=b.geocodes)!=null&&w.length)){const{location:O,formattedAddress:se}=b.geocodes[0],ce=O.lng,Fe=O.lat;be.setZoomAndCenter(14,[ce,Fe]),z.longitude=ce,z.latitude=Fe,Oe(V,{lng:ce,lat:Fe}),T.proaddr=se,T.prosite=se,te.value=se}})}function Oe(_,r){oe&&be.remove(oe),oe=new _.Marker({position:[r.lng,r.lat],map:be}),be.add(oe),xe.getAddress(r,async(b,w)=>{b==="complete"&&w.regeocode&&(console.log("result",w),console.log("formattedAddress",w.regeocode.formattedAddress),r.latitude=r.lat,r.longitude=r.lng,re==1?T.proaddr=w.regeocode.formattedAddress:re==2?(te.value=w.regeocode.formattedAddress,T.proaddr=w.regeocode.formattedAddress,T.provice=y(T.proaddr,J.value),await ye(T.provice),T.region=j(T.proaddr,ge.value)):te.value=C.value>0?F.value[C.value-1].addr||w.regeocode.formattedAddress:T.prosite||w.regeocode.formattedAddress)})}function o(){ve.value=!1}const S=async()=>{var _,r,b,w;if(C.value==0){T.latitude=z.latitude,T.longitude=z.longitude,T.prosite=te.value,ve.value=!1;const{data:O,error:se}=await ll([{prosite:T.prosite,latitude:T.latitude,longitude:T.longitude,proaddr:T.proaddr,provice:T.provice,region:T.region,id:T.id}]);O&&((_=window.$message)==null||_.success("修改位置成功"),Z("searchDetail"))}else{F.value[C.value-1].addr=te.value,F.value[C.value-1].latitude=z.latitude,F.value[C.value-1].longitude=z.longitude;let O=F.value[C.value-1];if(F.value[C.value-1].id){const{data:se,error:ce}=await Ss([O]);se&&((r=window.$message)==null||r.success("修改位置成功"),ve.value=!1,C.value=0,q())}else{O.pid=(b=P.prjDetailInfo)==null?void 0:b.id;const{data:se,error:ce}=await Ls([O]);se&&((w=window.$message)==null||w.success("添加位置成功"),ve.value=!1,C.value=0,q())}}},F=x([{latitude:30.303899,longitude:120.373885,addr:""}]),h=x([]),v=x(!1),E=()=>{v.value=!0,q()},q=async()=>{var b,w;if(!((b=P.prjDetailInfo)!=null&&b.id))return;const{data:_,error:r}=await ks({pid:(w=P.prjDetailInfo)==null?void 0:w.id,page:1,limit:100});_&&(_.list.length>0?(F.value=_.list,h.value=JSON.parse(JSON.stringify(_.list))):F.value=[{longitude:120.373885,latitude:30.303899,addr:""}])},G=()=>{v.value=!1},d=async _=>{var r;if(_.id){const{data:b,error:w}=await ws(_.id);b&&((r=window.$message)==null||r.success("删除成功"),q())}else F.value.splice(F.value.indexOf(_),1)};function y(_,r){let b=null;for(const w of r)if(_.includes(w.name)){b=w.id;break}return b}function j(_,r){let b=null;for(const w of r)if(_.includes(w.name)){b=w.id;break}return b}return(_,r)=>{const b=mn,w=Bi,O=k,se=Te,ce=$i,Fe=wi,We=xt,Se=Ja,Xt=Ci,Zt=gn,ea=Aa,ze=Va,Ut=De,Je=xa,jt=he,Bt=cn,ta=X,aa=Qt,Ft=_i,Ca=pn,Sa=xs,Ne=un,Nt=dt("no-auth");return u(),L(Ee,null,[l(Zt,{bordered:"","label-placement":"left","label-align":"center",columns:4,"label-style":{width:"130px"}},{default:n(()=>[l(b,null,{label:n(()=>r[17]||(r[17]=[p(" 项目名称 ")])),default:n(()=>{var I;return[f("div",Fi,U((I=P.prjDetailInfo)==null?void 0:I.proname),1)]}),_:1}),l(b,{"content-style":{position:"relative",width:"220px"}},{label:n(()=>r[18]||(r[18]=[p(" 项目状态 ")])),default:n(()=>{var I,$e,Ie,la,sa,na,Ue,It,st,ia,oa;return[f("div",Ni,[((I=P.prjDetailInfo)==null?void 0:I.status)!==void 0?(u(),L("div",{key:0,style:yt({display:"flex",alignItems:"center",justifyContent:"center",marginRight:"20px",color:(($e=P.prjDetailInfo)==null?void 0:$e.status)==-1?"#a43cf9":((Ie=P.prjDetailInfo)==null?void 0:Ie.status)===0?"#9ca3af":((la=P.prjDetailInfo)==null?void 0:la.status)===1?"#3498db":((sa=P.prjDetailInfo)==null?void 0:sa.status)===2?"#facc15":"#22c55e",borderRadius:"50%"})},[f("span",{style:yt({width:"10px",height:"10px",marginRight:"5px",backgroundColor:((na=P.prjDetailInfo)==null?void 0:na.status)==-1?"#a43cf9":((Ue=P.prjDetailInfo)==null?void 0:Ue.status)===0?"#9ca3af":((It=P.prjDetailInfo)==null?void 0:It.status)===1?"#3498db":((st=P.prjDetailInfo)==null?void 0:st.status)===2?"#facc15":"#22c55e",borderRadius:"50%"})},null,4),f("span",null,U(c(dl)[(ia=P.prjDetailInfo)==null?void 0:ia.status]?_.$t(c(dl)[(oa=P.prjDetailInfo)==null?void 0:oa.status]):""),1)],4)):D("",!0),l(se,{onPositiveClick:r[0]||(r[0]=He=>m(P.prjDetailInfo,0))},{trigger:n(()=>{var He;return[(c(W).userInfo.usertype==0||c(W).userInfo.usertype==4||c(W).userInfo.id==1021||c(W).userInfo.id==1023)&&((He=P.prjDetailInfo)==null?void 0:He.status)==-1?(u(),A(O,{key:0,size:"small",ghost:"",color:"#a43cf9"},{icon:n(()=>[l(w,{class:"text-icon"})]),default:n(()=>[r[19]||(r[19]=p(" 核准 "))]),_:1,__:[19]})):(u(),L("span",Ii))]}),default:n(()=>[r[20]||(r[20]=p(" 确定核准该项目吗？ "))]),_:1,__:[20]}),l(se,{onPositiveClick:r[1]||(r[1]=He=>m(P.prjDetailInfo,1))},{trigger:n(()=>{var He;return[(c(W).userInfo.usertype==0||c(W).userInfo.usertype==2)&&((He=P.prjDetailInfo)==null?void 0:He.status)==0?we((u(),A(O,{key:0,size:"small",ghost:"",type:"success"},{icon:n(()=>[l(ce,{class:"text-icon"})]),default:n(()=>[r[21]||(r[21]=p(" 启动 "))]),_:1,__:[21]})),[[Nt,"project:Info:update"]]):(u(),L("span",Pi))]}),default:n(()=>[r[22]||(r[22]=p(" 确定启动该项目吗？ "))]),_:1,__:[22]}),l(se,{onPositiveClick:r[2]||(r[2]=He=>m(P.prjDetailInfo,3))},{trigger:n(()=>{var He;return[(c(W).userInfo.usertype==0||c(W).userInfo.usertype==2)&&((He=P.prjDetailInfo)==null?void 0:He.status)==2?we((u(),A(O,{key:0,size:"small",ghost:"",type:"warning"},{icon:n(()=>[l(Fe,{class:"text-icon"})]),default:n(()=>[r[23]||(r[23]=p(" "+U("审核")))]),_:1,__:[23]})),[[Nt,"project:Info:update"]]):(u(),L("span",Ti))]}),default:n(()=>[r[24]||(r[24]=p(" 是否确认执行审核操作？ "))]),_:1,__:[24]})])]}),_:1}),l(b,{"content-style":{position:"relative",width:"200px"}},{label:n(()=>r[25]||(r[25]=[p(" 项目进度 ")])),default:n(()=>{var I;return[f("div",Ei,[l(We,{type:"line",percentage:(I=P.prjDetailInfo)==null?void 0:I.progess,"indicator-placement":"inside","show-indicator":"",processing:"",style:{width:"140px"},color:"#1890ff"},null,8,["percentage"])])]}),_:1}),l(b,{"content-style":{position:"relative",width:"180px"}},{label:n(()=>r[26]||(r[26]=[p(" 调试类型 ")])),default:n(()=>[f("div",Ai,[l(Se,{size:"small",type:"info"},{default:n(()=>{var I,$e;return[p(U(c(ul)[(I=P.prjDetailInfo)==null?void 0:I.dtype]?_.$t(c(ul)[($e=P.prjDetailInfo)==null?void 0:$e.dtype]):""),1)]}),_:1})])]),_:1}),ee.value?(u(),A(b,{key:0},{label:n(()=>r[27]||(r[27]=[p(" 预计完成日期 ")])),default:n(()=>{var I;return[f("div",Vi,U((I=P.prjDetailInfo)==null?void 0:I.cpdbtime),1)]}),_:1})):D("",!0),ee.value?(u(),A(b,{key:1,"content-style":{position:"relative",width:"180px"}},{label:n(()=>r[28]||(r[28]=[p(" 进度状态 ")])),default:n(()=>[f("div",Mi,[l(Se,{size:"small",type:P.prjDetailInfo.ptype==0?"success":"warning"},{default:n(()=>[p(U(P.prjDetailInfo.ptype==0?"正常":"已延期"),1)]),_:1},8,["type"])])]),_:1})):D("",!0),ee.value?(u(),A(b,{key:2,"content-style":{position:"relative",width:"180px"}},{label:n(()=>r[29]||(r[29]=[p(" 周期 ")])),default:n(()=>{var I,$e;return[f("div",qi,[f("span",null,U((I=P.prjDetailInfo)!=null&&I.period?(($e=P.prjDetailInfo)==null?void 0:$e.period)+"天":""),1)])]}),_:1})):D("",!0),ee.value?(u(),A(b,{key:3,"content-style":{position:"relative",width:"180px"}},{label:n(()=>r[30]||(r[30]=[p(" 调度名称 ")])),default:n(()=>{var I;return[f("div",Oi,[f("span",null,U((I=P.prjDetailInfo)==null?void 0:I.dispatch),1)])]}),_:1})):D("",!0),ee.value?(u(),A(b,{key:4,span:3},{label:n(()=>r[31]||(r[31]=[p(" 项目默认地址 ")])),default:n(()=>{var I,$e;return[f("div",Ri,[f("div",null,[f("div",Ji,U(((I=P.prjDetailInfo)==null?void 0:I.prosite)||"—"),1),f("div",Hi,[r[32]||(r[32]=f("b",{style:{color:"#888"}},"详细地址：",-1)),p(U((($e=P.prjDetailInfo)==null?void 0:$e.proaddr)||"暂无"),1)])]),l(Xt,{class:"font-size-20px cursor-pointer",style:{color:"#1890ff","flex-shrink":"0","margin-top":"2px",transition:"transform 0.2s ease"},onClick:r[3]||(r[3]=Ie=>H()),onMouseenter:r[4]||(r[4]=Ie=>Ie.target.style.transform="rotate(90deg)"),onMouseleave:r[5]||(r[5]=Ie=>Ie.target.style.transform="rotate(0deg)")}),f("div",{class:"cursor-pointer c-#1890ff ml-50px flex items-center",onClick:E},[r[33]||(r[33]=p(" 其他地址 ")),l(Xt,{class:"font-size-20px",style:{color:"#1890ff","flex-shrink":"0",transition:"transform 0.2s ease"},onMouseenter:r[6]||(r[6]=Ie=>Ie.target.style.transform="rotate(90deg)"),onMouseleave:r[7]||(r[7]=Ie=>Ie.target.style.transform="rotate(0deg)")})])])]}),_:1})):D("",!0),ee.value?(u(),A(b,{key:5,"content-style":{position:"relative",width:"180px"}},{label:n(()=>r[34]||(r[34]=[p(" 开始时间 ")])),default:n(()=>{var I;return[f("div",Gi,[f("span",null,U((I=P.prjDetailInfo)==null?void 0:I.sdbtime),1)])]}),_:1})):D("",!0),ee.value?(u(),A(b,{key:6},{label:n(()=>r[35]||(r[35]=[p(" 计划调试时间 ")])),default:n(()=>{var I;return[p(" "+U((I=P.prjDetailInfo)==null?void 0:I.plantime),1)]}),_:1})):D("",!0),ee.value?(u(),A(b,{key:7},{label:n(()=>r[36]||(r[36]=[p(" 验收人 ")])),default:n(()=>{var I;return[p(" "+U((I=P.prjDetailInfo)==null?void 0:I.ckusername),1)]}),_:1})):D("",!0),ee.value?(u(),A(b,{key:8},{label:n(()=>r[37]||(r[37]=[p(" 验收时间 ")])),default:n(()=>{var I;return[p(" "+U((I=P.prjDetailInfo)==null?void 0:I.ckdbtime),1)]}),_:1})):D("",!0),ee.value?(u(),A(b,{key:9},{label:n(()=>r[38]||(r[38]=[p(" 商务联系人 ")])),default:n(()=>{var I;return[p(" "+U((I=P.prjDetailInfo)==null?void 0:I.businesscon),1)]}),_:1})):D("",!0)]),_:1}),f("div",{style:yt([{background:"#409eff",position:"absolute",width:"5px",top:"-20px",left:"38px"},{height:ee.value?"115%":"145%"}])},null,4),f("div",Wi,[ee.value?(u(),L("span",{key:1,onClick:r[9]||(r[9]=I=>ee.value=!1)},[r[40]||(r[40]=p(" 收起 ")),l(ze,{class:"font-size-20px"})])):(u(),L("span",{key:0,onClick:r[8]||(r[8]=I=>ee.value=!0)},[r[39]||(r[39]=p(" 更多 ")),l(ea,{class:"font-size-20px"})]))]),l(aa,{show:ve.value,"onUpdate:show":r[14]||(r[14]=I=>ve.value=I),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:n(()=>[l(jt,{justify:"end",size:16},{default:n(()=>[l(O,{onClick:o},{default:n(()=>[p(U(_.$t("common.cancel")),1)]),_:1}),[0,2,4].includes(c(W).userInfo.usertype)?(u(),A(O,{key:0,type:"primary",onClick:S},{default:n(()=>[p(U(_.$t("common.confirm")),1)]),_:1})):D("",!0)]),_:1})]),default:n(()=>[l(jt,null,{default:n(()=>[l(Je,{label:"省份",path:"provice","label-placement":"left","label-width":"70"},{default:n(()=>[l(Ut,{filterable:"",value:T.provice,"onUpdate:value":[r[10]||(r[10]=I=>T.provice=I),ke],placeholder:"请选择省份","label-field":"name","value-field":"id",options:J.value},null,8,["value","options"])]),_:1}),l(Je,{label:"地区",path:"region","label-placement":"left","label-width":"70"},{default:n(()=>[l(Ut,{filterable:"",value:T.region,"onUpdate:value":[r[11]||(r[11]=I=>T.region=I),ie],placeholder:"请选择地区","label-field":"name","value-field":"id",options:ge.value},null,8,["value","options"])]),_:1})]),_:1}),ue.value?(u(),A(Je,{key:0,label:C.value==0?"项目地址":"项目地址"+C.value,"label-placement":"left"},{default:n(()=>[f("div",Ki,[l(Bt,{value:te.value,"onUpdate:value":[r[12]||(r[12]=I=>te.value=I),c(Q)],options:Ce.value,style:{"margin-bottom":"7px"},placeholder:"请输入地点关键字",clearable:"",onSelect:_e},null,8,["value","options","onUpdate:value"]),C.value==0?(u(),A(ta,{key:0,type:"textarea",rows:2,clearable:"",value:T.proaddr,"onUpdate:value":r[13]||(r[13]=I=>T.proaddr=I),placeholder:"请输入详细地址"},null,8,["value"])):D("",!0)])]),_:1},8,["label"])):D("",!0),f("div",{ref_key:"domRef",ref:Be,class:"h-full w-full",style:{width:"100%",height:"500px","margin-bottom":"10px"}},null,512)]),_:1},8,["show"]),l(aa,{show:v.value,"onUpdate:show":r[16]||(r[16]=I=>v.value=I),title:"其他地址",preset:"card",class:"w-800px"},{footer:n(()=>[l(jt,{justify:"end",size:16},{default:n(()=>[l(O,{type:"primary",ghost:"",onClick:G},{default:n(()=>r[43]||(r[43]=[p("关闭")])),_:1,__:[43]})]),_:1})]),default:n(()=>[[0,2,4].includes(c(W).userInfo.usertype)?(u(),A(O,{key:0,type:"primary",size:"small",ghost:"",onClick:r[15]||(r[15]=I=>F.value.push({latitude:30.303899,longitude:120.373885,addr:""}))},{icon:n(()=>[l(Ft,{class:"text-icon"})]),default:n(()=>[r[41]||(r[41]=p(" "+U("添加地址")))]),_:1,__:[41]})):D("",!0),(u(!0),L(Ee,null,zt(F.value,(I,$e)=>(u(),L("div",{class:"flex items-center mt-10px",key:I.latitude},[f("span",Yi,"项目地址"+U($e+1),1),l(Sa,{onClick:Ie=>H($e+1)},{default:n(()=>[l(ta,{readonly:"",value:I.addr,"onUpdate:value":Ie=>I.addr=Ie,placeholder:"请选择项目地点"+($e+1)},null,8,["value","onUpdate:value","placeholder"]),l(O,null,{icon:n(()=>[l(Ca,{class:"text-icon"})]),_:1})]),_:2},1032,["onClick"]),l(se,{onPositiveClick:Ie=>d(I)},{trigger:n(()=>[[0,2,4].includes(c(W).userInfo.usertype)?(u(),A(O,{key:0,size:"small",ghost:"",type:"error",class:"ml-10px"},{icon:n(()=>[l(Ne,{class:"text-icon"})]),default:n(()=>[r[42]||(r[42]=p(" "+U("删除")))]),_:1,__:[42]})):D("",!0)]),default:n(()=>[p(" 确定要删除项目地址"+U($e+1)+"吗？ ",1)]),_:2},1032,["onPositiveClick"])]))),128))]),_:1},8,["show"])],64)}}}),Zi=ka(Xi,[["__scopeId","data-v-28988354"]]),eo={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},to={class:"timeline-wrapper"},ao={class:"timeline-layout"},lo={class:"timeline"},so=["id"],no={class:"timeline-icon"},io=["onClick"],oo={class:"flex justify-between"},ro=["onClick"],uo={style:{"font-weight":"500",color:"#1890ff","margin-right":"15px"}},co={key:0},po={class:"w-200px inline-block"},fo=["onClick"],go={key:1},mo={class:"w-200px inline-block"},vo=["onClick"],yo={key:2},ho={class:"w-200px inline-block"},bo=["onClick"],_o={key:3},ko={class:"w-200px inline-block"},xo=["onClick"],Co={key:1},So={class:"timeline-rows"},Lo={key:0,class:"timeline-content",style:{"padding-left":"80px",position:"relative"}},wo={class:"timeline-icon"},Do=["onClick"],zo=["onClick"],$o=["id"],Uo={style:{display:"flex","align-items":"center",gap:"10px"}},jo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Bo={style:{display:"flex","align-items":"center",gap:"10px"}},Fo={class:"pos-absolute left-140px flex gap-x-10px"},No={key:0},Io={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Po={key:0,style:{height:"20px"}},To={style:{display:"flex","align-items":"center",gap:"10px"}},Eo={key:0},Ao={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Vo={style:{display:"flex","align-items":"center",gap:"10px"}},Mo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},qo={style:{display:"flex","align-items":"center",gap:"10px"}},Oo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Ro={key:0,style:{height:"20px"}},Jo={key:0,style:{height:"20px"}},Ho={key:0,class:"flex items-center justify-between"},Go={key:0},Wo={class:"flex items-center justify-between"},Ko={key:0},Yo={class:"flex items-center justify-end"};function ya(de){return typeof de=="function"||Object.prototype.toString.call(de)==="[object Object]"&&!tn(de)}const Qo=Ct({name:"projectmanagement_orderdetail",__name:"index",setup(de){const B=$t(),W=gl(),P=x(""),Z=Ds(),ee=zs(),T=Ye({debuggedBusinessList:[],developBusinessList:[],needsList:[]}),m=Ye({pid:void 0});let J=Ye([{id:"phase1",title:"基本信息",show:!0,tables:[]},{id:"phase2",title:"实施信息",show:!0,tables:[]},{id:"phase3",title:"验收信息",show:!0,tables:[]},{id:"phase4",title:"项目总结",show:B.userInfo.usertype!=1,tables:[1]},{id:"phase5",title:"项目日报",show:B.userInfo.usertype!=1,tables:[1]}]);const ne=async e=>{if(!e)return;g.value.projectDetail={};const{data:t}=await Ys(e);Object.assign(g.value.projectDetail,t)},ke=()=>{ie.pageSize==1?ie.pageSize=20:ie.pageSize=1,ye(m.pid)},ie=Ye({page:1,pageSize:1,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${ie.itemCount} 条`,onChange:e=>{ie.page=e,ye(m.pid)},onUpdatePageSize:e=>{ie.pageSize=e,ie.page=1,ye(m.pid)}}),ge=[{title:"对接方",key:"docker",align:"center",render(e,t){return e.setStatus?a(X,{value:e.docker,placeholder:"请输入",onUpdateValue(s){g.value.contactList[t].docker=s}}):a("div",{},e.docker)}},{title:"姓名",key:"pname",align:"center",render(e,t){return e.setStatus?a(X,{value:e.pname,placeholder:"请输入",onUpdateValue(s){g.value.contactList[t].pname=s}}):a("div",{},e.pname)}},{title:"联系方式",key:"pcontact",align:"center",render(e,t){return e.setStatus?a(X,{value:e.pcontact,placeholder:"请输入",onUpdateValue(s){g.value.contactList[t].pcontact=s}}):a("div",{},e.pcontact)}},{title:"备注",key:"proposition",align:"center",render(e,t){return e.setStatus?a(X,{value:e.proposition,placeholder:"请输入",onUpdateValue(s){g.value.contactList[t].proposition=s}}):a("div",{},e.proposition)}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?Ge(1,e.dbtime):""},{key:"operate",title:K("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return a("div",{class:"flex-center gap-8px"},[e.setStatus?[Ve("project:Contact:insert")&&a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>be(e)},{default:()=>"保存"}),a(k,{type:"default",ghost:!0,size:"small",onClick:()=>Be(e,t)},{default:()=>"取消"}),Ve("project:Contact:delete")&&a(Te,{onPositiveClick:async()=>{var s;if(e.id){const{data:i,error:$}=await $s(e.id);i&&(g.value.contactList.splice(t,1),(s=window.$message)==null||s.success("删除成功"),ye(m.pid),Me())}else g.value.contactList.splice(t,1)}},{default:()=>K("common.confirmDelete"),trigger:()=>a(k,{type:"error",ghost:!0,size:"small"},{default:()=>K("common.delete")})})]:Ve("project:Contact:update")&&a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>ve(e)},{default:()=>"编辑"})])}}],ye=async e=>{if(!e)return;const{data:t}=await Pa({page:ie.page,limit:ie.pageSize,pid:e});g.value.contactList=t==null?void 0:t.list,ie.itemCount=t==null?void 0:t.total,g.value.contactList.forEach(s=>{s.setStatus=!1}),T.contactList=JSON.parse(JSON.stringify(g.value.contactList))},ve=e=>{g.value.contactList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},Be=(e,t)=>{e.setStatus=!e.setStatus,e.id?g.value.contactList=JSON.parse(JSON.stringify(T.contactList)):g.value.contactList.splice(t,1)},be=async e=>{var t,s,i,$,N;if(!e.docker){(t=window.$message)==null||t.warning("请输入对接方");return}if(!e.pname){(s=window.$message)==null||s.warning("请输入联系人姓名");return}if(!e.pcontact){(i=window.$message)==null||i.warning("请输入联系方式");return}if(e.id){const{data:ae,error:pe}=await Us([e]);pe||(($=window.$message)==null||$.success("修改成功"),ye(m.pid),e.setStatus=!e.setStatus)}else{const{data:ae,error:pe}=await js([{...e,pid:m.pid}]);pe||((N=window.$message)==null||N.success("添加成功"),ye(m.pid),e.setStatus=!e.setStatus,Me())}se()};function xe(){var e;va.value.includes("1")||va.value.push("1"),((e=g.value.contactList[0])!=null&&e.pname||g.value.contactList.length==0)&&g.value.contactList.unshift({pname:"",pcontact:"",proposition:"",setStatus:!0})}const oe=x([]),le=async()=>{var s;const{data:e,error:t}=await Ra({page:1,limit:100,id:m.pid});oe.value=e==null?void 0:e.list.map(i=>({value:i.id,label:i.contractname,isLeaf:!1})),ue((s=e==null?void 0:e.list[0])==null?void 0:s.id)},me=x([]),V=x(),{pageData:z,getData:re}=lt(_l),ue=async e=>{await re({pids:e}),V.value=[],me.value=Array.from(new Set([...me.value,...z.data])),V.value=z.data.map(t=>({label:t.devname,value:t.id}))},te=async e=>{var t;await ue(e.value),e.children=(t=V.value)==null?void 0:t.map(s=>({label:s.label,value:s.value,isLeaf:!0}))},Ce=()=>{R.pageSize==1?R.pageSize=20:R.pageSize=1,_e(m.pid)},R=Ye({page:1,pageSize:1,itemCount:0,showSizePicker:!0,fuzzy:"",pageSizes:[10,20],prefix:()=>`共 ${R.itemCount} 条`,onChange:e=>{R.page=e,_e(m.pid)},onUpdatePageSize:e=>{R.pageSize=e,R.page=1,_e(m.pid)}}),fe=x(),Q=[{title:"绑定合同设备",key:"cid",width:220,align:"center",render(e,t){var s,i;return e.setStatus?a(Ea,{style:"width: 200px",value:e.cid,filterable:!0,placeholder:"请选择合同设备",options:oe.value,checkStrategy:"child",showPath:!1,remote:!0,renderSuffix:$=>$.option.hidden?null:$.node,renderLabel:$=>$.hidden?null:$.label,onLoad:te,onUpdateValue($){var ae;g.value.debuggedDevieceList[t].cid=Number($)||0;const N=(ae=me.value)==null?void 0:ae.find(pe=>pe.id==$);e.devname=(N==null?void 0:N.devname)||"",e.devnum=(N==null?void 0:N.devcount)||"",e.notes=(N==null?void 0:N.notes)||"",fe.value=(N==null?void 0:N.devcount)||0,e.etype=(N==null?void 0:N.devtype)||0,e.devmanu=(N==null?void 0:N.devmanu)||"",e.devmodel=((N==null?void 0:N.devmodel.length)>64?N==null?void 0:N.devname:N==null?void 0:N.devmodel)||"",e.devunit=(N==null?void 0:N.devunit)||""}}):a("div",{},e.devname2||((i=(s=V.value)==null?void 0:s.find($=>$.value==e.cid))==null?void 0:i.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(e,t){return e.setStatus?a(X,{value:e.devname,placeholder:"请输入",onUpdateValue(s){g.value.debuggedDevieceList[t].devname=s}}):a("div",{},e.devname)}},{title:"型号",key:"devmodel",width:120,align:"center",render(e){return a(Dt,{tooltipPlacement:"center",style:{maxWidth:"100px"}},{default:()=>e.devmodel||"",tooltip:()=>a("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.devmodel||"")})}},{title:"设备单位",key:"devunit",width:80,align:"center",render(e,t){return a("div",{},e.devunit)}},{title:"数量",key:"devnum",width:100,align:"center",render(e,t){return e.setStatus?a(bl,{value:e.devnum,placeholder:"请输入",max:fe.value,onUpdateValue(s){g.value.debuggedDevieceList[t].devnum=s}}):a("div",{},e.devnum)}},{title:"是否为我司设备",key:"etype",width:120,align:"center",render(e,t){return a("div",{},e.etype==0?"是":"否")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(e,t){return a("div",{},e.devmanu)}},{title:"清点状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?a(De,{value:e.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(s){g.value.debuggedDevieceList[t].status=Number(s)||0}}):a("div",{},e.status===0?"未清点":e.status===1?"正常":e.status===2?"增补":e.status===3?"退货":"换货")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(e,t){return a("div",{},e.devmanu)}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(e,t){return e.setStatus?a(X,{value:e.manucontact,placeholder:"请输入",onUpdateValue(s){g.value.debuggedDevieceList[t].manucontact=s}}):a("div",{},e.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(e,t){return e.setStatus?a(X,{value:e.manuinfo,placeholder:"请输入",onUpdateValue(s){g.value.debuggedDevieceList[t].manuinfo=s}}):a("div",{},e.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(e,t){return e.setStatus&&e.id?a(De,{value:e.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(s){g.value.debuggedDevieceList[t].devstatus=Number(s)||0}}):a("div",{},e.devstatus===0?"设备无异常":e.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(e,t){return e.setStatus?a(X,{value:e.connectionmode,placeholder:"请输入",onUpdateValue(s){g.value.debuggedDevieceList[t].connectionmode=s}}):a("div",{},e.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(e,t){return e.setStatus&&e.id?a(De,{value:e.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(s){g.value.debuggedDevieceList[t].install=Number(s)||0}}):a("div",{},e.install===0?"是":"否")}},{title:"备注",key:"notes",width:100,align:"center",render(e,t){return e.setStatus?a(X,{value:e.notes,placeholder:"请输入",onUpdateValue(s){g.value.debuggedDevieceList[t].notes=s}}):a("div",{},e.notes)}},{title:"文件",key:"re1",width:100,align:"center",render(e,t){return e.setStatus?a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>fa(e,"debuggedDevieceList",t)},{default:()=>"上传文件"}):a(ot,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const s=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return s.length===0?a("div",{style:"padding: 10px; color: #999;"},"暂无文件"):a("div",{style:"padding: 10px;"},[a("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[a("thead",[a("tr",[a("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),a("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),a("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),a("tbody",s.map((i,$)=>{var N;return a("tr",[a("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},((N=i.file)==null?void 0:N.split("?")[1])||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>ga({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作信息",key:"dbtime",width:180,align:"center",render(e,t){return a(ot,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},e.dbtime?Ge(1,e.dbtime):""),default:()=>a("div",{style:"padding: 10px;"},l("div",null,[l("div",null,[p("操作人："),e.username]),l("div",null,[p("操作时间："),e.dbtime]),l("div",null,[p("清点人："),e.dusername]),l("div",null,[p("清点时间："),e.ddbtime])]))})}},{key:"operate",title:K("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return a("div",{class:"flex-center gap-8px"},[e.setStatus?[a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>Ae(e)},{default:()=>"保存"}),a(k,{type:"default",ghost:!0,size:"small",onClick:()=>H(e,t)},{default:()=>"取消"}),Ve("project:Equipment:delete")&&a(Te,{onPositiveClick:async()=>{var s;if(e.id){const{data:i,error:$}=await Bs(e.id);i&&(g.value.debuggedDevieceList.splice(t,1),(s=window.$message)==null||s.success("删除成功"),_e(m.pid),Me())}else g.value.debuggedDevieceList.splice(t,1)}},{default:()=>K("common.confirmDelete"),trigger:()=>a(k,{type:"error",ghost:!0,size:"small"},{default:()=>K("common.delete")})})]:Ve("project:Equipment:update")&&a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>C(e)},{default:()=>"编辑"})])}}],_e=async e=>{if(!e)return;const{data:t}=await Ta({page:R.page,limit:R.pageSize,fuzzy:R.fuzzy,pid:e});g.value.debuggedDevieceList=t.list,R.itemCount=t.total,g.value.debuggedDevieceList.forEach(s=>{s.setStatus=!1}),T.debuggedDevieceList=JSON.parse(JSON.stringify(g.value.debuggedDevieceList))},C=async e=>{console.log(z.data,e.cid,"ssssssssssssssss"),g.value.debuggedDevieceList.forEach(i=>{i.setStatus=!1});const{data:t,error:s}=await Fs(e.cid);s||(oe.value[oe.value.length-1].value!=t.id&&oe.value.push({value:t.id,label:t.devname,disabled:!0,isLeaf:!0,hidden:!0}),fe.value=t.devcount||0),e.setStatus=!e.setStatus},H=(e,t)=>{e.setStatus=!e.setStatus,e.id?g.value.debuggedDevieceList=JSON.parse(JSON.stringify(T.debuggedDevieceList)):g.value.debuggedDevieceList.splice(t,1)},Ae=async e=>{var t,s,i,$,N,ae;if(!e.cid){(t=window.$message)==null||t.warning("请选择合同设备");return}if(!e.devname){(s=window.$message)==null||s.warning("设备名称不能为空");return}if(!e.devmodel){(i=window.$message)==null||i.warning("设备型号不能为空");return}if(!e.devnum){($=window.$message)==null||$.warning("设备数量不能为空");return}if(e.id){const{data:pe,error:je}=await sl([e]);je||((N=window.$message)==null||N.success("修改成功"),_e(m.pid),e.setStatus=!e.setStatus)}else{const{data:pe,error:je}=await kl([{...e,pid:m.pid}]);je||((ae=window.$message)==null||ae.success("添加成功"),_e(m.pid),e.setStatus=!e.setStatus,Me())}},Oe=async()=>{var i;const e=g.value.debuggedDevieceList.map($=>$.status==0?{id:$.id,status:1}:null).filter($=>$!==null),{data:t,error:s}=await sl(e);s||((i=window.$message)==null||i.success("清点成功"),_e(m.pid))},o=x(!1);function S(){o.value=!0}const{pageData:F,getData:h,nextPage:v}=lt(yl),E=async()=>{await h({usertypes:"2,3"})},q=async e=>{const t=e.currentTarget,s=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&F.data.length<F.total&&(await v(),await rt(),setTimeout(()=>{t.scrollTop=s}))};E();const{pageData:G,getData:d,nextPage:y}=lt(vl),j=async e=>{const t=e.currentTarget,s=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&G.data.length<G.total&&(await y(),await rt(),setTimeout(()=>{t.scrollTop=s}))};(async()=>{await d(),G.data=G.data.map(e=>(e.name=`${e.weight}  `+e.tname,e))})();const{pageData:r,getData:b,nextPage:w}=lt(Pa),O=async e=>{const t=e.currentTarget,s=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&r.data.length<r.total&&(await w(),r.data=r.data.map(i=>({...i,value:i.docker+"&id="+i.id})),await rt(),setTimeout(()=>{t.scrollTop=s}))},se=async()=>{await b({pid:m.pid}),r.data=r.data.map(e=>({...e,value:e.docker+"&id="+e.id}))},{pageData:ce,getData:Fe,nextPage:We}=lt(Ta),Se=async e=>{const t=e.currentTarget,s=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&G.data.length<G.total&&(await We(),await rt(),setTimeout(()=>{t.scrollTop=s}))},Xt=async()=>{await Fe({pid:m.pid})},Zt=x(),ea=[{title:"权重",key:"dtype",width:180,align:"center",render(e,t){return e.setStatus?a(De,{value:e.dtype,filterable:!0,placeholder:"请选择权重",options:G.data,labelField:"tname",valueField:"id",onUpdateValue(s){var i;g.value.debuggedBusinessList[t].dtype=Number(s)||0,g.value.debuggedBusinessList[t].debugname=((i=G.data.find($=>$.id==s))==null?void 0:i.tname)||""},onScroll(s){j(s)}}):a("div",{},e.tname)}},{title:"业务名称",key:"debugname",width:180,align:"center",render(e,t){return e.setStatus?a(X,{value:e.debugname,placeholder:"请输入业务名称",onUpdateValue(s){g.value.debuggedBusinessList[t].debugname=s}}):a("div",{},e.debugname)}},{title:"状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?a(De,{value:e.status,filterable:!0,placeholder:"请选择状态",options:B.userInfo.usertype==0||B.userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}],onUpdateValue(s){g.value.debuggedBusinessList[t].status=Number(s)||0}}):a(Ja,{color:{color:e.status==-1?"rgba(251, 146, 60, 0.15)":e.status==0?"rgba(156, 163, 175,0.15)":e.status==1?"rgba(59, 130, 246,0.15)":e.status==2?"rgba(250, 204, 21,0.15)":"rgba(16, 185, 129,0.15)",textColor:e.status==-1?"#FB923C":e.status==0?"#9ca3af":e.status==1?"#3B82F6":e.status==2?"#FACC15":"#10B981",borderColor:e.status==-1?"#FB923C":e.status==0?"#9ca3af":e.status==1?"#3B82F6":e.status==2?"#FACC15":"#10B981"}},e.status==-1?"申请中":e.status==0?"待调试":e.status==1?"开始调试":e.status==2?"待审核":"审核完成")}},{key:"eqmname",title:"调试设备",align:"center",width:150,render(e,t){return e.setStatus?a(De,{value:e.eqmid,placeholder:"请选择调试设备",options:ce.data,onscroll:Se,labelField:"devname",valueField:"id",clearable:!0,filterable:!0,onUpdateValue(s){g.value.debuggedBusinessList[t].eqmid=s}}):a("div",{},e.eqmname)}},{title:"对接方",key:"docker",width:120,align:"center",render(e,t){var s;return e.setStatus?a(De,{value:e.docker,placeholder:"请输入或选择对接方",options:r.data,onscroll:O,labelField:"docker",valueField:"value",clearable:!0,filterable:!0,tag:!0,onClear(){e.dockcharge="",e.dockcontact=""},onUpdateValue(i){var pe;g.value.debuggedBusinessList[t].docker=i;const[$,N]=(pe=e.docker)==null?void 0:pe.split("&id="),ae=r.data.find(je=>je.docker===$&&je.id===Number(N));ae?(e.dockcharge=ae.pname,e.dockcontact=ae.pcontact):(e.dockcharge="",e.dockcontact="")}}):a("div",{},(s=e.docker)==null?void 0:s.split("&id=")[0])}},{title:"对接方负责人",key:"dockcharge",width:100,align:"center",render(e,t){return e.setStatus?a(X,{value:e.dockcharge,placeholder:"请输入对接方负责人",onUpdateValue(s){g.value.debuggedBusinessList[t].dockcharge=s}}):a("div",{},e.dockcharge)}},{title:"联系方式",key:"dockcontact",width:140,align:"center",render(e,t){return e.setStatus?a(X,{value:e.dockcontact,placeholder:"请输入联系方式",onUpdateValue(s){g.value.debuggedBusinessList[t].dockcontact=s}}):a("div",{},e.dockcontact)}},{title:"调试人",key:"dbcreater",width:120,align:"center",render(e,t){return e.setStatus?a(De,{value:e.dbcreater,filterable:!0,placeholder:"请选择调试人",options:F.data,labelField:"username",valueField:"id",onUpdateValue(s){g.value.debuggedBusinessList[t].dbcreater=s||0},onScroll(s){q(s)}}):a("div",{},e.dbusername)}},{key:"duration",title:"调试信息",align:"left",width:200,render(e){return l("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[l("div",null,[l("span",{style:"color:#666"},[p("工时：")]),l("span",{style:"color:#1890ff; font-weight:500"},[e.duration||"-"])]),l("div",null,[l("span",{style:"color:#666"},[p("开始：")]),l("span",null,[e.dbdbtime||"-"])]),l("div",null,[l("span",{style:"color:#666"},[p("结束：")]),l("span",null,[e.dedbtime||"-"])])])}},{title:"文件",key:"re1",width:80,align:"center",render(e,t){return e.setStatus?a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>fa(e,"debuggedBusinessList",t)},{default:()=>"上传文件"}):a(ot,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const s=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return s.length===0?a("div",{style:"padding: 10px; color: #999;"},"暂无文件"):a("div",{style:"padding: 10px;"},[a("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[a("thead",[a("tr",[a("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),a("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),a("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),a("tbody",s.map((i,$)=>{var N;return a("tr",[a("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},((N=i.file)==null?void 0:N.split("?")[1])||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>ga({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"备注",key:"notes",width:120,align:"center",render(e,t){return e.setStatus?a(X,{value:e.notes,placeholder:"请输入备注",onUpdateValue(s){g.value.debuggedBusinessList[t].notes=s}}):a("div",{},e.notes)}},{key:"username",title:"创建信息",align:"left",width:240,render(e){return l("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[l("div",null,[l("span",{style:"color:#666"},[p("创建人：")]),l("span",null,[e.username||"-"])]),l("div",null,[l("span",{style:"color:#666"},[p("时间：")]),l("span",null,[e.dbtime||"-"])])])}},{key:"ckusername",title:"审核信息",align:"left",width:240,render(e){return l("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[l("div",null,[l("span",{style:"color:#666"},[p("审核人：")]),l("span",null,[e.ckusername||"-"])]),l("div",null,[l("span",{style:"color:#666"},[p("时间：")]),l("span",null,[e.ckdbtime||"-"])])])}},{title:"计划开始时间",key:"starttime",width:200,align:"center",render(e,t){return e.setStatus?a(ba,{type:"date",clearable:!0,value:e.starttime,valueFormat:"yyyy-MM-dd",placeholder:"请选择",onUpdateValue(s){g.value.debuggedBusinessList[t].starttime=s}}):a("div",e.starttime?Ge(0,e.starttime):"")}},{title:"计划结束时间",key:"endtime",width:200,align:"center",render:(e,t)=>e.setStatus?a(ba,{type:"date",clearable:!0,valueFormat:"yyyy-MM-dd",value:e.endtime,placeholder:"请选择",onUpdateValue(s){g.value.debuggedBusinessList[t].endtime=s}}):e.endtime?Ge(0,e.endtime):""},{key:"operate",title:K("common.operate"),align:"center",width:280,fixed:"right",render(e,t){return a("div",{class:"flex-center gap-8px"},[!e.setStatus&&e.status==0&&e.dbcreater==B.userInfo.id&&a(Te,{onPositiveClick:()=>{Bt(e,1)}},{default:()=>"确定开始调试吗？",trigger:()=>a(k,{type:"success",ghost:!0,size:"small"},{default:()=>"开始"})}),!e.setStatus&&e.status==1&&e.dbcreater==B.userInfo.id&&a(Te,{onPositiveClick:()=>{Bt(e,2)}},{default:()=>a("div",[a("div","确定完成调试？"),a("div",{style:{color:"#d03050",fontWeight:"500",marginTop:"6px"}},"请确认资料已提交，否则将拒绝审核！")]),trigger:()=>a(k,{type:"success",ghost:!0,size:"small"},{default:()=>"完成"})}),!e.setStatus&&e.status==2&&(B.userInfo.usertype==0||B.userInfo.usertype==2)&&a(Te,{onPositiveClick:()=>{Bt(e,3)}},{default:()=>"是否确认执行审核操作？",trigger:()=>a(k,{type:"warning",ghost:!0,size:"small"},{default:()=>"审核"})}),e.setStatus?[Ve("project:Debug:insert")&&a(Te,{onPositiveClick:()=>{aa(e)}},{default:()=>"是否确认保存？",trigger:()=>a(k,{type:"info",ghost:!0,size:"small"},{default:()=>"保存"})}),a(k,{type:"default",ghost:!0,size:"small",onClick:()=>ta(e,t)},{default:()=>"取消"}),Ve("project:Debug:delete")&&a(Te,{onPositiveClick:async()=>{var s;if(e.id){const{data:i,error:$}=await Ns(e.id,m.pid);i&&(g.value.debuggedBusinessList.splice(t,1),(s=window.$message)==null||s.success("删除成功"),Je(m.pid),Me())}else g.value.debuggedBusinessList.splice(t,1)}},{default:()=>K("common.confirmDelete"),trigger:()=>a(k,{type:"error",ghost:!0,size:"small"},{default:()=>K("common.delete")})})]:Ve("project:Debug:update")&&a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>jt(e)},{default:()=>"编辑"})])}}],ze=Ye({page:1,pageSize:1,showSizePicker:!0,itemCount:0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${ze.itemCount} 条`,onChange:e=>{ze.page=e,Je(m.pid)},onUpdatePageSize:e=>{ze.pageSize=e,ze.page=1,Je(m.pid)}}),Ut=()=>{ze.pageSize==1?ze.pageSize=20:ze.pageSize=1,Je(m.pid)},Je=async e=>{if(!e)return;const{data:t}=await Is({page:ze.page,limit:ze.pageSize,fuzzy:ze.fuzzy,creater:ze.creater,pid:e});g.value.debuggedBusinessList=t.list,ze.itemCount=t.total,g.value.debuggedBusinessList.forEach(s=>{s.setStatus=!1}),T.debuggedBusinessList=JSON.parse(JSON.stringify(g.value.debuggedBusinessList))},jt=e=>{e.starttime=nl(e.starttime),e.endtime=nl(e.endtime),Zt.value=e.status,g.value.debuggedBusinessList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},Bt=async(e,t)=>{var $;const{data:s,error:i}=await il([{id:e.id,status:t,pid:e.pid}]);i||(($=window.$message)==null||$.success("操作成功"),Je(m.pid),t==3&&window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:e.pid,type:"debug"}})))},ta=(e,t)=>{e.setStatus=!e.setStatus,e.id?g.value.debuggedBusinessList=JSON.parse(JSON.stringify(T.debuggedBusinessList)):g.value.debuggedBusinessList.splice(t,1)},aa=async e=>{var i,$,N,ae,pe,je,Pe,ft,gt,tt;if(!e.dtype){(i=window.$message)==null||i.warning("请选择权重");return}if(!e.debugname){($=window.$message)==null||$.warning("请输入业务名称");return}if(!e.docker){(N=window.$message)==null||N.warning("请选择或输入对接方");return}if(!e.dockcharge){(ae=window.$message)==null||ae.warning("请输入对接方负责人");return}if(!e.dockcontact){(pe=window.$message)==null||pe.warning("请输入对接方联系方式");return}if(!e.dbcreater){(je=window.$message)==null||je.warning("请选择调试人");return}const t=Ge(0,e.starttime),s=Ge(0,e.endtime);if(e.id){const mt=JSON.parse(JSON.stringify(e));Zt.value==mt.status&&delete mt.status,mt.docker=(Pe=mt.docker)==null?void 0:Pe.split("&id=")[0];const{data:wt,error:Ia}=await il([{...mt,starttime:t,endtime:s}]);Ia||((ft=window.$message)==null||ft.success("修改成功"),Je(m.pid),e.setStatus=!e.setStatus)}else{e.docker=(gt=e.docker)==null?void 0:gt.split("&id=")[0];const{data:mt,error:wt}=await hl([{...e,starttime:t,endtime:s,pid:m.pid}]);wt||((tt=window.$message)==null||tt.success("添加成功"),Je(m.pid),e.setStatus=!e.setStatus,Me())}},Ft=x(!1);function Ca(){Ft.value=!0}const Sa=[{title:"影响的业务",key:"affectedbusiness",align:"center",render(e,t){return e.setStatus?a(X,{value:e.affectedbusiness,placeholder:"请输入影响的业务",onUpdateValue(s){g.value.developBusinessList[t].affectedbusiness=s}}):a("div",{},e.affectedbusiness)}},{title:"设备名称",key:"devname",align:"center",render(e,t){return e.setStatus?a(X,{value:e.devname,placeholder:"请输入设备名称",onUpdateValue(s){g.value.developBusinessList[t].devname=s}}):a("div",{},e.devname)}},{title:"接口文档",key:"apidocument",align:"center",render(e,t){return e.setStatus?a(X,{value:e.apidocument,placeholder:"请输入接口文档",onUpdateValue(s){g.value.developBusinessList[t].apidocument=s}}):a("div",{},e.apidocument)}},{title:"研发对接人",key:"uid",align:"center",render(e,t){return e.setStatus?a(X,{value:e.uid,placeholder:"请输入研发对接人",onUpdateValue(s){g.value.developBusinessList[t].uid=s}}):a("div",{},e.uid)}},{title:"研发周期",key:"period",align:"center",render(e,t){return e.setStatus?a(X,{value:e.period,placeholder:"请输入文件上传路径",onUpdateValue(s){g.value.developBusinessList[t].period=s}}):a("div",{},e.period)}},{title:"备注",key:"notes",align:"center",render(e,t){return e.setStatus?a(X,{value:e.notes,placeholder:"请输入备注",onUpdateValue(s){g.value.developBusinessList[t].notes=s}}):a("div",{},e.notes)}},{title:"文件",key:"re1",align:"center",render(e,t){return e.setStatus?a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>fa(e,"developBusinessList",t)},{default:()=>"上传文件"}):a(ot,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const s=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return s.length===0?a("div",{style:"padding: 10px; color: #999;"},"暂无文件"):a("div",{style:"padding: 10px;"},[a("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[a("thead",[a("tr",[a("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),a("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),a("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),a("tbody",s.map((i,$)=>{var N;return a("tr",[a("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},((N=i.file)==null?void 0:N.split("?")[1])||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>ga({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?Ge(1,e.dbtime):""},{key:"operate",title:K("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return a("div",{class:"flex-center gap-8px"},[e.setStatus?[Ve("project:Development:insert")&&a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>la(e)},{default:()=>"保存"}),a(k,{type:"default",ghost:!0,size:"small",onClick:()=>Ie(e,t)},{default:()=>"取消"}),Ve("project:Development:delete")&&a(Te,{onPositiveClick:async()=>{var s;if(e.id){const{data:i,error:$}=await Ps(e.id,m.pid);i&&(g.value.developBusinessList.splice(t,1),(s=window.$message)==null||s.success("删除成功"),I(m.pid),Me())}else g.value.developBusinessList.splice(t,1)}},{default:()=>K("common.confirmDelete"),trigger:()=>a(k,{type:"error",ghost:!0,size:"small"},{default:()=>K("common.delete")})})]:Ve("project:Development:update")&&a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>$e(e)},{default:()=>"编辑"})])}}],Ne=Ye({page:1,pageSize:1,itemCount:0,showSizePicker:!0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${Ne.itemCount} 条`,onChange:e=>{Ne.page=e,I(m.pid)},onUpdatePageSize:e=>{Ne.pageSize=e,Ne.page=1,I(m.pid)}}),Nt=()=>{Ne.pageSize==1?Ne.pageSize=20:Ne.pageSize=1,I(m.pid)},I=async e=>{if(!e)return;const{data:t}=await Ts({page:Ne.page,limit:Ne.pageSize,fuzzy:Ne.fuzzy,creater:Ne.creater,pid:e});g.value.developBusinessList=t.list,Ne.itemCount=t.total,g.value.developBusinessList.forEach(s=>{s.setStatus=!1}),T.developBusinessList=JSON.parse(JSON.stringify(g.value.developBusinessList))},$e=e=>{g.value.developBusinessList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},Ie=(e,t)=>{e.setStatus=!e.setStatus,e.id?g.value.developBusinessList=JSON.parse(JSON.stringify(T.developBusinessList)):g.value.developBusinessList.splice(t,1)},la=async e=>{var t,s,i,$,N,ae,pe;if(!e.affectedbusiness){(t=window.$message)==null||t.warning("请输入影响的业务");return}if(!e.devname){(s=window.$message)==null||s.warning("请输入设备名称");return}if(!e.apidocument){(i=window.$message)==null||i.warning("请输入接口文档");return}if(!e.uid){($=window.$message)==null||$.warning("请输入研发对接人");return}if(!e.period){(N=window.$message)==null||N.warning("请输入研发周期");return}if(e.id){const{data:je,error:Pe}=await Es([e]);Pe||((ae=window.$message)==null||ae.success("修改成功"),I(m.pid),e.setStatus=!e.setStatus)}else{const{data:je,error:Pe}=await As([{...e,pid:m.pid}]);Pe||((pe=window.$message)==null||pe.success("添加成功"),I(m.pid),e.setStatus=!e.setStatus,Me())}};function sa(){var e;Lt.value.includes("2")||Lt.value.push("2"),((e=g.value.developBusinessList[0])!=null&&e.id||g.value.developBusinessList.length==0)&&g.value.developBusinessList.unshift({affectedbusiness:"",devname:"",apidocument:"",uid:"",period:void 0,notes:"",setStatus:!0})}const na=[{title:"需求内容",key:"reqcontent",align:"center",render(e,t){return e.setStatus?a(X,{value:e.reqcontent,placeholder:"请输入需求内容",onUpdateValue(s){g.value.needsList[t].reqcontent=s}}):a("div",{},e.reqcontent)}},{title:"客户联系人",key:"customer",align:"center",render(e,t){return e.setStatus?a(X,{value:e.customer,placeholder:"请输入客户联系人",onUpdateValue(s){g.value.needsList[t].customer=s}}):a("div",{},e.customer)}},{title:"联系方式",key:"cstcontact",align:"center",render(e,t){return e.setStatus?a(X,{value:e.cstcontact,placeholder:"请输入联系方式",onUpdateValue(s){g.value.needsList[t].cstcontact=s}}):a("div",{},e.cstcontact)}},{title:"结果",key:"cstresult",align:"center",render(e,t){return e.setStatus?a(De,{value:e.cstresult,filterable:!0,placeholder:"请选择结果",options:[{label:"成功",value:1},{label:"失败",value:0}],onUpdateValue(s){g.value.needsList[t].cstresult=Number(s)||0}}):a("div",{},e.cstresult==1?"成功":"失败")}},{title:"备注",key:"notes",align:"center",render(e,t){return e.setStatus?a(X,{value:e.notes,placeholder:"请输入备注",onUpdateValue(s){g.value.needsList[t].notes=s}}):a("div",{},e.notes)}},{title:"文件",key:"re1",align:"center",render(e,t){return e.setStatus?a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>fa(e,"needsList",t)},{default:()=>"上传文件"}):a(ot,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const s=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return s.length===0?a("div",{style:"padding: 10px; color: #999;"},"暂无文件"):a("div",{style:"padding: 10px;"},[a("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[a("thead",[a("tr",[a("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),a("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),a("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),a("tbody",s.map((i,$)=>{var N;return a("tr",[a("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},((N=i.file)==null?void 0:N.split("?")[1])||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>ga({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?Ge(1,e.dbtime):""},{key:"operate",title:K("common.operate"),align:"center",minWidth:120,fixed:"right",render(e,t){return a("div",{class:"flex-center gap-8px"},[e.setStatus?[Ve("project:Customer:insert")&&a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>He(e)},{default:()=>"保存"}),a(k,{type:"default",ghost:!0,size:"small",onClick:()=>oa(e,t)},{default:()=>"取消"}),Ve("project:Customer:delete")&&a(Te,{onPositiveClick:async()=>{var s;if(e.id){const{data:i,error:$}=await Vs(e.id,m.pid);i&&(g.value.needsList.splice(t,1),(s=window.$message)==null||s.success("删除成功"),st(m.pid),Me())}else g.value.needsList.splice(t,1)}},{default:()=>K("common.confirmDelete"),trigger:()=>a(k,{type:"error",ghost:!0,size:"small"},{default:()=>K("common.delete")})})]:Ve("project:Customer:update")&&a(k,{type:"primary",ghost:!0,size:"small",onClick:()=>ia(e)},{default:()=>"编辑"})])}}],Ue=Ye({page:1,pageSize:1,showSizePicker:!0,itemCount:0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${Ue.itemCount} 条`,onChange:e=>{Ue.page=e,st(m.pid)},onUpdatePageSize:e=>{Ue.pageSize=e,Ue.page=1,st(m.pid)}}),It=()=>{Ue.pageSize==1?Ue.pageSize=20:Ue.pageSize=1,st(m.pid)},st=async e=>{if(!e)return;const{data:t}=await Ms({page:Ue.page,limit:Ue.pageSize,fuzzy:Ue.fuzzy,creater:Ue.creater,pid:e});g.value.needsList=t.list,Ue.itemCount=t.total,g.value.needsList.forEach(s=>{s.setStatus=!1}),T.needsList=JSON.parse(JSON.stringify(g.value.needsList))},ia=e=>{g.value.needsList.forEach(t=>{t.setStatus=!1}),e.cstresult=e.cstresult&&e.cstresult*1,e.setStatus=!e.setStatus},oa=(e,t)=>{e.setStatus=!e.setStatus,e.id?g.value.needsList=JSON.parse(JSON.stringify(T.needsList)):g.value.needsList.splice(t,1)},He=async e=>{var t,s,i,$,N;if(!e.reqcontent){(t=window.$message)==null||t.error("需求内容不能为空");return}if(!e.customer){(s=window.$message)==null||s.error("客户联系人不能为空");return}if(!e.cstcontact){(i=window.$message)==null||i.error("联系方式不能为空");return}if(e.id){const{data:ae,error:pe}=await qs([e]);pe||(($=window.$message)==null||$.success("修改成功"),st(m.pid),e.setStatus=!e.setStatus)}else{const{data:ae,error:pe}=await Os([{...e,pid:m.pid}]);pe||((N=window.$message)==null||N.success("添加成功"),st(m.pid),e.setStatus=!e.setStatus,Me())}};function Sl(){var e;Lt.value.includes("3")||Lt.value.push("3"),((e=g.value.needsList[0])!=null&&e.id||g.value.needsList.length==0)&&g.value.needsList.unshift({reqcontent:"",customer:"",cstcontact:"",cstresult:0,notes:"",setStatus:!0})}const g=x({projectDetail:{},contactList:[],prjCycleList:[],fileList:[],DebuggingEngineerList:[],debuggedDevieceList:[],debuggedBusinessList:[],developBusinessList:[],needsList:[]}),Ha=[{key:"kk",title:" ",align:"center",width:120,render:e=>l("div",null,[e.username+"的项目总结"])},{key:"charctras",title:"字符数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:K("common.operate"),align:"center",width:140,fixed:"right",render:e=>{let t;return l("div",{class:"flex-center gap-8px"},[l(k,{type:"primary",ghost:!0,size:"small",onClick:()=>zl(e)},{default:()=>[p("查看详情")]}),B.userInfo.id==e.creater&&we(l(k,{type:"primary",ghost:!0,size:"small",onClick:()=>Dl(e)},ya(t=K("common.edit"))?t:{default:()=>[t]}),[[dt("no-auth"),"project:Summary:update"]]),B.userInfo.id==e.creater&&l(Te,{onPositiveClick:()=>wl(e.id)},{default:()=>K("common.confirmDelete"),trigger:()=>{let s;return we(l(k,{type:"error",ghost:!0,size:"small"},ya(s=K("common.delete"))?s:{default:()=>[s]}),[[dt("no-auth"),"project:Summary:delete"]])}})])}}],Qe=Ye({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${Qe.itemCount} 条`,onChange:e=>{Qe.page=e,St(m.pid)},onUpdatePageSize:e=>{Qe.pageSize=e,Qe.page=1,St(m.pid)}}),La=x([]),St=async e=>{const{data:t,error:s}=await Rs({page:Qe.page,limit:Qe.pageSize,pid:e});s||(La.value=t.list,Qe.itemCount=t.total,Me())},Ll=()=>{Xe.value=void 0,ra.value=!0};async function wl(e){var i;const{data:t,error:s}=await ol(e);s||((i=window.$message)==null||i.success("删除成功"),St(m.pid))}const ra=x(!1);function Dl(e){Xe.value=e,ra.value=!0}const wa=x(!1),Xe=x({}),zl=e=>{wa.value=!0,Xe.value=e},Ga=[{key:"notes",title:"今日工作内容",align:"center",width:300,render(e){return a(Dt,{tooltipPlacement:"center",lineClamp:3,style:{minWidth:"280px"}},{default:()=>e.notes||"",tooltip:()=>a("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.notes||"")})}},{key:"problem",title:"遇到问题",align:"center",width:120,render(e){return a(Dt,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.problem||"",tooltip:()=>a("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.problem||"")})}},{key:"solutions",title:"解决措施",align:"center",width:120,render(e){return a(Dt,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.solutions||"",tooltip:()=>a("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.solutions||"")})}},{key:"feedback",title:"建议意见反馈",align:"center",width:120,render(e){return a(Dt,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.feedback||"",tooltip:()=>a("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.feedback||"")})}},{key:"summarize",title:"总结",align:"center",width:120,render(e){return a(Dt,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.summarize||"",tooltip:()=>a("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.summarize||"")})}},{key:"username",title:"创建信息",align:"left",width:200,render(e){return l("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[l("div",null,[l("span",{style:"color:#666"},[p("创建人：")]),l("span",null,[e.username||"-"])]),l("div",null,[l("span",{style:"color:#666"},[p("创建时间：")]),l("span",null,[e.dbtime||"-"])])])}},{key:"operate",title:K("common.operate"),align:"center",width:100,fixed:"right",render:e=>{let t;return l("div",{class:"flex-center gap-8px"},[B.userInfo.id==e.creater&&we(l(k,{type:"primary",ghost:!0,size:"small",onClick:()=>jl(e)},ya(t=K("common.edit"))?t:{default:()=>[t]}),[[dt("no-auth"),"project:Summary:update"]]),B.userInfo.id==e.creater&&l(Te,{onPositiveClick:()=>Ul(e.id)},{default:()=>K("common.confirmDelete"),trigger:()=>{let s;return we(l(k,{type:"error",ghost:!0,size:"small"},ya(s=K("common.delete"))?s:{default:()=>[s]}),[[dt("no-auth"),"project:Summary:delete"]])}})])}}],Ze=Ye({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${Ze.itemCount} 条`,onChange:e=>{Ze.page=e,da(m.pid)},onUpdatePageSize:e=>{Ze.pageSize=e,Ze.page=1,da(m.pid)}}),Da=x([]),da=async e=>{const{data:t,error:s}=await xl({page:Ze.page,limit:Ze.pageSize,pid:e});s||(Da.value=t.list.map(i=>{const $=JSON.parse(i.context);return i.notes=$.notes,i.problem=$.problem,i.solutions=$.solutions,i.feedback=$.feedback,i.summarize=$.summarize,i}),Ze.itemCount=t.total,Me())},$l=()=>{Xe.value=void 0,ua.value=!0};async function Ul(e){var i;const{data:t,error:s}=await ol(e);s||((i=window.$message)==null||i.success("删除成功"),St(m.pid))}const ua=x(!1);function jl(e){Xe.value=e,ua.value=!0}const Wa=x(!1);function Ka(){Tt()}const za=x(!1),Bl=async e=>{if(!e){g.value={projectDetail:{},contactList:[],debuggedBusinessList:[],fileList:[],debuggedDevieceList:[],DebuggingEngineerList:[],developBusinessList:[],needsList:[]};return}za.value=!0;try{const t=await Promise.allSettled([ne(e),ct(e),Xt(),ye(e),Je(e),_e(e),Fl(),I(e),st(e),St(e),da(e)]);Me(),t.forEach((s,i)=>{s.status==="fulfilled"?console.log(`任务 ${i} 成功:`,s):console.warn(`任务 ${i} 失败:`,s.reason)})}catch(t){console.error("意料之外的错误:",t)}finally{za.value=!1}},Pt=x(),Ya=[{key:"cusname",title:"客户名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"token",title:"气象信息Token",align:"center",width:200,render(e){return l("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[l("span",null,[e.token||"-"]),l(Qs,{trigger:"hover"},{trigger:()=>l(k,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>Qa(e.token)},{default:()=>[p("复制")]}),default:()=>"复制 token"})])}},{key:"passward",title:"气象信息Passward",align:"center",width:200,render(e){return l("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[l("span",null,[e.passward||"-"]),l(k,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>Qa(e.passward)},{default:()=>[p("复制")]})])}},{key:"longitude",title:"经度",align:"center",width:120},{key:"latitude",title:"维度",align:"center",width:120},{key:"pro",title:"墨迹合同项目名称",align:"center",width:140},{key:"expiare",title:"过期时间",align:"center",width:180},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(e){return l("div",{style:"display:flex; flex-direction:column; font-size:13px; gap:3px; line-height:1.4;"},[l("div",null,[l("span",{style:"color:#666"},[p("创建人：")]),l("span",{style:"font-weight:500"},[e.username||"-"])]),l("div",null,[l("span",{style:"color:#666"},[p("时间：")]),l("span",{style:" font-weight:500"},[e.dbtime||"-"])])])}}],Fl=async()=>{const{data:e,error:t}=await bn({page:1,limit:99,pid:m.pid});Pt.value=e.list,Pt.value.length>0&&B.userInfo.usertype!=1&&(J[5]={id:"phase6",title:"气象信息",show:!0,tables:[{id:1,name:"气象信息",type:1}]})},Qa=async e=>{var t;e&&(await navigator.clipboard.writeText(e),(t=window.$message)==null||t.success("已复制"))},Me=()=>{J[0].tables=[{id:1,name:"项目联系人",type:g.value.contactList.length>0?1:0},{id:2,name:"待调试设备",type:g.value.debuggedDevieceList.length>0?1:0},{id:3,name:"图纸",type:g.value.fileList.length>0?1:0}],J[1].tables=[{id:1,name:"待调试业务",type:g.value.debuggedBusinessList.length>0?1:0},{id:2,name:"需要开发",type:g.value.developBusinessList.length>0?1:0},{id:3,name:"需求变更",type:g.value.needsList.length>0?1:0},{id:4,name:"文件",type:Et.value.length>0||At.value.length>0||Vt.value.length>0||Mt.value.length>0||qt.value.length>0?1:0}],J[2].tables=[{id:1,name:"项目验收",type:Ot.value.length>0?1:0}],J[3].tables=[{id:1,name:"项目总结",type:La.value.length>0?1:0}],J[4].tables=[{id:1,name:"项目日报",type:Da.value.length>0?1:0}]};async function Tt(){B.userInfo.usertype==1&&(J[3]=null,J[4]=null,J=J.filter(e=>e!==null)),m.pid&&(await Bl(m.pid),le(),se(),Me(),setTimeout(()=>{ee.replace({path:Z.path,query:{}})},100))}const Nl=()=>{const e=document.getElementById("__SCROLL_EL_ID__");e==null||e.scrollTo({top:0,behavior:"smooth"})},Xa=e=>{J[e].show=!J[e].show},$a=e=>{const t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth",block:"start"}),P.value=e)},Ua=()=>{const e=[];J.forEach(i=>{i.tables.forEach(($,N)=>e.push(`${i.id}-${N}`))});const t=window.scrollY;let s="";for(const i of e){const $=document.getElementById(i);$&&$.offsetTop-100<=t&&(s=i)}P.value=s},Et=x([]),At=x([]),Vt=x([]),Mt=x([]),qt=x([]),Ot=x([]),Za=x({});async function ct(e){const{data:t,error:s}=await Xs({limit:100,page:1,pid:e});s||(g.value.fileList=[],Et.value=[],At.value=[],Vt.value=[],Mt.value=[],qt.value=[],Ot.value=[],Za.value=t,console.log("data",Za.value),t.list.forEach(i=>{i.sort==1&&g.value.fileList.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==2&&Et.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==3&&At.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==4&&Vt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==5&&Mt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==6&&qt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==7&&Ot.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime})}),g.value.fileList.reverse(),Et.value.reverse(),At.value.reverse(),Vt.value.reverse(),Mt.value.reverse(),qt.value.reverse(),Ot.value.reverse(),Me())}const Il=e=>{const t=e.target,s=document.getElementById("__SCROLL_EL_ID__"),i=document.getElementById("scrollToTop");!s||!i||(t.scrollTop>(s.clientHeight||0)+500?i.classList.add("show"):i.classList.remove("show"))},et=x([]),{pageData:ht,getData:ca,nextPage:Pl}=lt(en),Tl=async e=>{const t=e.currentTarget,s=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&ht.data.length<ht.total&&(await Pl(),et.value=ht.data,await rt(),setTimeout(()=>{t.scrollTop=s}))},El=qa.debounce(async e=>{await ca({fuzzy:e,page:1}),et.value=ht.data},300),ja=x(!1),Ba=x(!1),Al=e=>{if(m.pid=null,ja.value=!0,Ba.value=!1,!e){el();return}El(e)},Vl=async()=>{ja.value&&!Ba.value&&(await ca({page:1}),et.value=ht.data,ja.value=!1,await Tt())},el=async()=>{await ca({page:1}),et.value=ht.data,await Tt()},Ml=async e=>{var t;Ba.value=!0,e&&(m.pid=e,B.setProjectInfo({pid:e,pname:(t=et.value.find(s=>s.id==m.pid))==null?void 0:t.proname}),await Tt())},ql=async()=>{var e;await ca({fuzzy:Z.query.pname?Z.query.pname:B.userInfo.pname||void 0}),et.value=ht.data,m.pid=(Z.query.prjId?Number(Z.query.prjId):B.userInfo.pid?Number(B.userInfo.pid):Number((e=et.value[0])==null?void 0:e.id))||void 0,B.setProjectInfo({pid:m.pid,pname:B.userInfo.pname})},Rt=x(!1),pt=x(""),pa=x(),fa=(e,t,s)=>{Ke.value=[],Rt.value=!0,pt.value=t,pa.value=s,e.re1&&Ke.value.push({id:"",name:e.re1,url:e.fl1,status:"uploading",setStatus:!1,progress:0}),e.re2&&Ke.value.push({id:"",name:e.re2,url:e.fl2,status:"uploading",setStatus:!1,progress:0}),e.re3&&Ke.value.push({id:"",name:e.re3,url:e.fl3,status:"uploading",setStatus:!1,progress:0}),e.re4&&Ke.value.push({id:"",name:e.re4,url:e.fl4,status:"uploading",setStatus:!1,progress:0})},Ol=[{title:"文件名称",key:"filename",align:"center",render(e){if(!e.url){const t=async({file:i,onFinish:$,onError:N})=>{var ae,pe;try{e.status=!0;const je=await Yt(i.file,i.name,"",Pe=>{e.progress=Pe});je&&(e.url=je,e.name=i.name,e.status=!1)}catch(je){console.error(je),(pe=(ae=window.$message)==null?void 0:ae.error)==null||pe.call(ae,"文件上传出错"),e.status=!1}};async function s(i){var $;return i.file.file.size>100*1024*1024?(($=window.$message)==null||$.error("文件大小不能超过100M"),!1):!0}return a("div",{style:"display: flex; justify-content: center; align-items: center;"},[a(Kt,{action:"#",showFileList:!1,customRequest:t,onBeforeUpload:s},{default:()=>a(k,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})}),e.progress?a(xt,{type:"line",percentage:e.progress,indicatorPlacement:"inside",processing:!0}):null])}return e.url&&!e.id?l("span",null,[e.url.split("?")[1],p(" "),l("span",{onClick:()=>{e.url="",e.progress=0,e.status=!1},style:"color: red;cursor: pointer;font-size: 12px;"},[p("删除")])]):a("div",{},e.url.split("?")[1])}},{title:"文件别名",key:"name",align:"center",render(e){return a(X,{value:e.name,onUpdateValue:t=>{e.name=t}})}},{title:"操作",key:"actions",align:"center",width:100,render(e){return a(he,{justify:"center"},[a(k,{type:"error",size:"small",ghost:!0,onClick:()=>{Ke.value=Ke.value.filter(t=>t!==e)}},{default:()=>"删除"})])}}],Ke=x([]),Rl=()=>{var e,t;if(Ke.value.length>=4)return(t=(e=window.$message)==null?void 0:e.warning)==null?void 0:t.call(e,"最多上传4个文件");Ke.value.push({id:"",name:"",url:"",status:!1,setStatus:!0,progress:0})};async function ga(e){if(e!=null&&e.url)try{const s=await(await fetch(e.url.split("?")[0],{mode:"cors"})).blob(),i=URL.createObjectURL(s),$=document.createElement("a");$.href=i,$.download=e.url.split("?")[1],$.style.display="none",document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(i)}catch(t){console.error("下载失败:",t)}}const Jl=async()=>{var t,s;let e=!0;for(let i=0;i<Ke.value.length;i++){const $=Ke.value[i];if(!$.url){(t=window.$message)==null||t.warning(`第${i+1}个文件的文件名称不能为空`),e=!1;break}if(!$.name){(s=window.$message)==null||s.warning(`第${i+1}个文件的文件别名不能为空`),e=!1;break}g.value[pt.value][pa.value][`re${i+1}`]=$.name,g.value[pt.value][pa.value][`fl${i+1}`]=$.url}e&&(Rt.value=!1,pt.value="",pa.value=void 0)},Hl=()=>{Rt.value=!1},tl=x(!1),Fa=x([]),Gl=async()=>{var s;if(!m.pid)return(s=window.$message)==null?void 0:s.warning("请选择项目");const{data:e,error:t}=await Zs({page:1,limit:100,pid:m.pid});Fa.value=(e==null?void 0:e.list)||[]},Wl=e=>{e&&navigator.clipboard.writeText(e).then(()=>{var t;(t=window.$message)==null||t.success("已复制到剪贴板")}).catch(()=>{var t;(t=window.$message)==null||t.error("复制失败，请手动复制")})};Ma(async()=>{await ql(),Tt(),Z.query.IsScroll&&setTimeout(()=>{$a("phase2-0")},800),window.addEventListener("scroll",Ua);const e=document.getElementById("__SCROLL_EL_ID__");e&&e.addEventListener("scroll",Il)}),Js(()=>{window.removeEventListener("scroll",Ua);const e=document.getElementById("__SCROLL_EL_ID__");e&&e.removeEventListener("scroll",Ua)});async function ma(e){if(!e)return;const t=e.split("?")[0],s=e.split("?")[1];try{const $=await(await fetch(t,{mode:"cors"})).blob(),N=URL.createObjectURL($),ae=document.createElement("a");ae.href=N,ae.download=s,ae.style.display="none",document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(N)}catch(i){console.error("下载失败:",i)}}const va=x(["1","2","3"]),Kl=e=>{va.value=e},Lt=x(["1","2","3","4"]),Yl=e=>{Lt.value=e},Na=x(!1),Ql=()=>{var e;m.pid?Na.value=!0:(e=window.$message)==null||e.warning("请选择项目")};return(e,t)=>{const s=ns,i=kn,$=ds,N=_n,ae=fl,pe=Oa,je=is,Pe=_a,ft=Aa,gt=Va,tt=rs,mt=ts,wt=os,Ia=Qt,Xl=Ws,Zl=Ks,nt=dt("no-auth"),es=dt("loading");return u(),L("div",eo,[f("div",{id:"scrollToTop",onClick:Nl,title:"回到顶部"},[l(s,{class:"font-size-30px"})]),l(pe,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[l(ae,{ref:"formRef",model:m,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:pl(Ka,["enter"])},{default:n(()=>[l(N,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:n(()=>[l(i,{span:"24 s:12 m:8",label:"所属项目",path:"pid"},{default:n(()=>[l(c(De),{filterable:"",clearable:"",value:m.pid,"onUpdate:value":[t[0]||(t[0]=Le=>m.pid=Le),Ml],placeholder:"请选择所属项目","label-field":"proname","value-field":"id",onClear:el,onSearch:Al,onBlur:Vl,options:c(Hs)(et.value),onScroll:Tl},null,8,["value","options"])]),_:1}),l(i,{span:"24  s:12 m:8",class:"pr-24px"},{default:n(()=>[l(c(he),{class:"w-full"},{default:n(()=>[l(c(k),{type:"primary",ghost:"",onClick:Ka},{icon:n(()=>[l($,{class:"text-icon"})]),default:n(()=>[p(" "+U(c(K)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(pe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper overflow-auto pb-40px content","content-style":{padding:"5px"}},{default:n(()=>[we((u(),L("div",to,[f("div",ao,[f("div",lo,[(u(!0),L(Ee,null,zt(c(J),(Le,qe)=>(u(),L("div",{key:Le.id,class:"timeline-phase"},[f("div",{class:"timeline-row",id:"phase"+(qe+1)},[f("div",no,[t[22]||(t[22]=f("div",{class:"vertical-line"},null,-1)),f("div",{class:"flashing-icon",onClick:Y=>Xa(qe)},null,8,io)]),f("div",oo,[f("div",{class:"phase-title",onClick:Y=>Xa(qe)},U(Le.title),9,ro),l(c(he),null,{default:n(()=>[qe===0?(u(),A(c(k),{key:0,onClick:Ql,ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:n(()=>t[23]||(t[23]=[p("工程调试确认单")])),_:1,__:[23]})):D("",!0),qe===0?(u(),A(c(ot),{key:1,trigger:"click",placement:"left-start",width:1e3},{trigger:n(()=>[we((u(),A(c(k),{ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:n(()=>t[24]||(t[24]=[p("查询关联合同")])),_:1,__:[24]})),[[nt,"project:Contract:select"]])]),default:n(()=>[l(mi,{id:m.pid},null,8,["id"])]),_:1})):D("",!0),qe===0?(u(),A(c(ot),{key:2,trigger:"click",placement:"left-start"},{trigger:n(()=>[we((u(),A(c(k),{onClick:Gl,ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:n(()=>t[25]||(t[25]=[p("查询项目调度")])),_:1,__:[25]})),[[nt,"project:Dispatch:select"]])]),default:n(()=>[Fa.value.length>0?(u(),A(c(xn),{key:0,bordered:!1,"single-line":!1},{default:n(()=>[t[35]||(t[35]=f("thead",null,[f("tr",null,[f("th",null,"调度名称"),f("th",null,"调度联系方式"),f("th",null,"相关文件")])],-1)),f("tbody",null,[(u(!0),L(Ee,null,zt(Fa.value,Y=>{var it,Jt,Ht,Gt;return u(),L("tr",{key:Y.id},[f("td",null,U(Y.dname),1),f("td",null,[f("span",uo,U(Y.dcon),1),l(c(k),{size:"tiny",type:"primary",ghost:"",onClick:bt=>Wl(Y.dcon)},{default:n(()=>t[26]||(t[26]=[p(" 复制 ")])),_:2,__:[26]},1032,["onClick"])]),f("td",null,[Y.re1&&Y.fl1?(u(),L("div",co,[f("span",po,"文件别名："+U(Y.re1),1),t[27]||(t[27]=f("span",{class:"ml-10px"},"文件名称:",-1)),t[28]||(t[28]=p()),f("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:bt=>ma(Y.fl1)},U((it=Y.fl1)==null?void 0:it.split("?")[1]),9,fo)])):D("",!0),Y.re2&&Y.fl2?(u(),L("div",go,[f("span",mo,"文件别名："+U(Y.re2),1),t[29]||(t[29]=f("span",{class:"ml-10px"},"文件名称:",-1)),t[30]||(t[30]=p()),f("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:bt=>ma(Y.fl1)},U((Jt=Y.fl2)==null?void 0:Jt.split("?")[1]),9,vo)])):D("",!0),Y.re3&&Y.fl3?(u(),L("div",yo,[f("span",ho,"文件别名："+U(Y.re3),1),t[31]||(t[31]=f("span",{class:"ml-10px"},"文件名称:",-1)),t[32]||(t[32]=p()),f("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:bt=>ma(Y.fl1)},U((Ht=Y.fl3)==null?void 0:Ht.split("?")[1]),9,bo)])):D("",!0),Y.re4&&Y.fl4?(u(),L("div",_o,[f("span",ko,"文件别名："+U(Y.re4),1),t[33]||(t[33]=f("span",{class:"ml-10px"},"文件名称:",-1)),t[34]||(t[34]=p()),f("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:bt=>ma(Y.fl1)},U((Gt=Y.fl4)==null?void 0:Gt.split("?")[1]),9,xo)])):D("",!0)])])}),128))])]),_:2,__:[35]},1024)):(u(),L("div",Co,"暂无调度"))]),_:2},1024)):D("",!0)]),_:2},1024)])],8,so),l(cl,{name:"fade"},{default:n(()=>[we(f("div",So,[qe===0?(u(),L("div",Lo,[l(Zi,{pid:m.pid,onSearchDetail:t[1]||(t[1]=Y=>ne(m.pid)),prjDetailInfo:g.value.projectDetail},null,8,["pid","prjDetailInfo"])])):D("",!0),(u(!0),L(Ee,null,zt(Le.tables,(Y,it)=>{var Jt,Ht,Gt,bt;return u(),L("div",{key:`${Le.id}-${it}`,class:"timeline-row"},[f("div",wo,[t[36]||(t[36]=f("div",{class:"vertical-line"},null,-1)),Y.type==1?(u(),L("div",{key:0,class:kt(["icon",{active:P.value===`${Le.id}-${it}`}]),style:{"font-size":"20px",border:"3px solid #409eff",color:"#409eff"},onClick:M=>$a(`${Le.id}-${it}`)},[l(je)],10,Do)):(u(),L("div",{key:1,class:"icon",style:{"font-size":"20px",border:"3px solid #ccc",color:"#ccc"},onClick:M=>$a(`${Le.id}-${it}`)}," 一 ",8,zo))]),f("div",{class:"actProgress",style:yt({background:Y.type==1?"#409eff":"#ccc"})},null,4),f("div",{class:"timeline-content",id:`${Le.id}-${it}`},[qe===0?(u(),L(Ee,{key:0},[l(wt,{"expanded-names":va.value,"onUpdate:expandedNames":Kl,"trigger-areas":["arrow"]},{default:n(()=>[Y.id==1?(u(),A(tt,{key:0,name:"1"},{header:n(()=>[l(c(he),{align:"center",justify:"space-between",style:{width:"100%"}},{default:n(()=>[f("div",Uo,[t[38]||(t[38]=f("span",null,"项目联系人",-1)),we((u(),A(c(k),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:vt(xe,["stop"])},{icon:n(()=>[l(Pe,{class:"text-icon"})]),default:n(()=>[t[37]||(t[37]=p(" 添加项目联系人 "))]),_:1,__:[37]})),[[nt,"project:Contact:insert"]])])]),_:1})]),default:n(()=>[g.value.contactList.length>0?(u(),A(c(Re),{key:0,columns:ge,data:g.value.contactList,size:"small","scroll-x":702,"row-key":M=>M.id,"paginate-single-page":!1,"max-height":350,pagination:ie.pageSize==1?!1:ie,remote:""},null,8,["data","row-key","pagination"])):D("",!0),ie.itemCount>1?(u(),L("div",jo,[g.value.contactList.length==1?(u(),L("span",{key:0,onClick:ke},[t[39]||(t[39]=p("更多")),l(ft,{class:"font-size-20px"})])):(u(),L("span",{key:1,onClick:ke},[t[40]||(t[40]=p("收起")),l(gt,{class:"font-size-20px"})]))])):D("",!0)]),_:1})):D("",!0),Y.id==2?(u(),A(tt,{key:1,title:"待调试设备",name:"2"},{header:n(()=>[l(c(he),{align:"center",justify:"space-between",style:{width:"100%"}},{default:n(()=>{var M;return[f("div",Bo,[t[44]||(t[44]=f("span",null,"待调试设备",-1)),f("div",Fo,[we((u(),A(c(k),{size:"small",ghost:"",type:"primary",onClick:vt(S,["stop"])},{icon:n(()=>[l(Pe,{class:"text-icon"})]),default:n(()=>[t[41]||(t[41]=p(" 添加待调试设备 "))]),_:1,__:[41]})),[[nt,"project:Equipment:insert"]]),(M=g.value.debuggedDevieceList)!=null&&M.some(at=>at.status===0)?(u(),A(c(Te),{key:0,onPositiveClick:Oe},{trigger:n(()=>[we((u(),A(c(k),{size:"small",ghost:"",type:"primary"},{default:n(()=>[l(mt,{class:"text-icon"}),t[42]||(t[42]=p(" 一键清点设备 "))]),_:1,__:[42]})),[[nt,"project:Equipment:update"]])]),default:n(()=>[t[43]||(t[43]=p(" 确定要清点当前列表中未清点的设备吗？ "))]),_:1,__:[43]})):D("",!0)])]),R.itemCount>0?(u(),L("div",No,"共"+U(R.itemCount)+"条",1)):D("",!0)]}),_:2},1024)]),default:n(()=>[l(yi,{onSubmitted:t[2]||(t[2]=M=>_e(m.pid)),visible:o.value,"onUpdate:visible":t[3]||(t[3]=M=>o.value=M),pid:m.pid},null,8,["visible","pid"]),g.value.debuggedDevieceList.length>0?(u(),A(c(Re),{key:0,style:yt({width:c(W).siderCollapse?"calc(100vw - 219px)":"calc(100vw - 375px)"}),columns:Q,data:g.value.debuggedDevieceList,size:"small","scroll-x":Q.reduce((M,at)=>M+at.width,0),"row-key":M=>M.id,"max-height":350,pagination:R.pageSize==1?!1:R,remote:"","paginate-single-page":!1},null,8,["style","data","scroll-x","row-key","pagination"])):D("",!0),R.itemCount>1?(u(),L("div",Io,[g.value.debuggedDevieceList.length==1?(u(),L("span",{key:0,onClick:Ce},[t[45]||(t[45]=p("更多")),l(ft,{class:"font-size-20px"})])):(u(),L("span",{key:1,onClick:Ce},[t[46]||(t[46]=p("收起")),l(gt,{class:"font-size-20px"})]))])):D("",!0)]),_:2},1024)):D("",!0),Y.id==3?(u(),A(tt,{key:2,title:"图纸",name:"3"},{default:n(()=>[l(_t,{data:g.value.fileList,pid:m.pid,onGetData:t[4]||(t[4]=M=>ct(m.pid)),typename:"图纸",fileType:1},null,8,["data","pid"])]),_:1})):D("",!0)]),_:2},1032,["expanded-names"]),Y==4?(u(),L("div",Po)):D("",!0)],64)):D("",!0),qe===1?(u(),L(Ee,{key:1},[l(wt,{"expanded-names":Lt.value,"onUpdate:expandedNames":Yl,"trigger-areas":["arrow"]},{default:n(()=>[Y.id==1?(u(),A(tt,{key:0,title:"待调试业务",name:"1"},{header:n(()=>[l(c(he),{align:"center",justify:"space-between",style:{width:"100%"}},{default:n(()=>[f("div",To,[t[48]||(t[48]=f("span",null,[p("待调试业务 "),f("span",{class:"c-#f0a020 font-bold"},"※")],-1)),we((u(),A(c(k),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:vt(Ca,["stop"])},{icon:n(()=>[l(Pe,{class:"text-icon"})]),default:n(()=>[t[47]||(t[47]=p(" 添加待调试业务 "))]),_:1,__:[47]})),[[nt,"project:Debug:insert"]])]),ze.itemCount>0?(u(),L("div",Eo,"共"+U(ze.itemCount)+"条",1)):D("",!0)]),_:1})]),default:n(()=>[l(vi,{onSubmitted:t[5]||(t[5]=M=>Je(m.pid)),visible:Ft.value,"onUpdate:visible":t[6]||(t[6]=M=>Ft.value=M),pid:m.pid},null,8,["visible","pid"]),g.value.debuggedBusinessList.length>0?(u(),A(c(Re),{key:0,style:yt({width:c(W).siderCollapse?"calc(100vw - 219px)":"calc(100vw - 375px)"}),columns:ea,data:g.value.debuggedBusinessList,size:"small","row-key":M=>M.id,striped:"","scroll-x":ea.reduce((M,at)=>M+at.width,0),"paginate-single-page":!1,pagination:ze.pageSize==1?!1:ze,remote:"","max-height":350},null,8,["style","data","row-key","scroll-x","pagination"])):D("",!0),ze.itemCount>1?(u(),L("div",Ao,[g.value.debuggedBusinessList.length==1?(u(),L("span",{key:0,onClick:Ut},[t[49]||(t[49]=p(" 更多 ")),l(ft,{class:"font-size-20px"})])):(u(),L("span",{key:1,onClick:Ut},[t[50]||(t[50]=p(" 收起 ")),l(gt,{class:"font-size-20px"})]))])):D("",!0)]),_:1})):D("",!0),Y.id===2&&c(B).userInfo.usertype!==1?(u(),A(tt,{key:1,title:"需要开发",name:"2"},{header:n(()=>[l(c(he),{align:"center",justify:"space-between",style:{width:"100%"}},{default:n(()=>[f("div",Vo,[t[52]||(t[52]=f("span",null,"需要开发",-1)),we((u(),A(c(k),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:vt(sa,["stop"])},{icon:n(()=>[l(Pe,{class:"text-icon"})]),default:n(()=>[t[51]||(t[51]=p(" 添加需要开发 "))]),_:1,__:[51]})),[[nt,"project:Development:insert"]])])]),_:1})]),default:n(()=>[g.value.developBusinessList.length>0?(u(),A(c(Re),{key:0,columns:Sa,data:g.value.developBusinessList,size:"small","scroll-x":702,"row-key":M=>M.id,pagination:Ne.pageSize==1?!1:Ne,remote:"","paginate-single-page":!1,"max-height":350},null,8,["data","row-key","pagination"])):D("",!0),Ne.itemCount>1?(u(),L("div",Mo,[g.value.developBusinessList.length==1?(u(),L("span",{key:0,onClick:Nt},[t[53]||(t[53]=p(" 更多 ")),l(ft,{class:"font-size-20px"})])):(u(),L("span",{key:1,onClick:Nt},[t[54]||(t[54]=p(" 收起 ")),l(gt,{class:"font-size-20px"})]))])):D("",!0)]),_:1})):D("",!0),Y.id===3&&c(B).userInfo.usertype!==1?(u(),A(tt,{key:2,title:"客户需求变更",name:"3"},{header:n(()=>[l(c(he),{align:"center",justify:"space-between",style:{width:"100%"}},{default:n(()=>[f("div",qo,[t[56]||(t[56]=f("span",null,"客户需求变更",-1)),we((u(),A(c(k),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:vt(Sl,["stop"])},{icon:n(()=>[l(Pe,{class:"text-icon"})]),default:n(()=>[t[55]||(t[55]=p(" 添加客户需求变更 "))]),_:1,__:[55]})),[[nt,"project:Customer:insert"]])])]),_:1})]),default:n(()=>[g.value.needsList.length>0?(u(),A(c(Re),{key:0,columns:na,data:g.value.needsList,size:"small","scroll-x":702,"row-key":M=>M.id,pagination:Ue.pageSize==1?!1:Ue,remote:"","paginate-single-page":!1,"max-height":350},null,8,["data","row-key","pagination"])):D("",!0),Ue.itemCount>1?(u(),L("div",Oo,[g.value.needsList.length==1?(u(),L("span",{key:0,onClick:It},[t[57]||(t[57]=p(" 更多 ")),l(ft,{class:"font-size-20px"})])):(u(),L("span",{key:1,onClick:It},[t[58]||(t[58]=p(" 收起 ")),l(gt,{class:"font-size-20px"})]))])):D("",!0)]),_:1})):D("",!0),Y.id===4?(u(),A(tt,{key:3,title:"文件",name:"4"},{default:n(()=>[l(_t,{data:Et.value,pid:m.pid,onGetData:t[7]||(t[7]=M=>ct(m.pid)),typename:"项目文件",fileType:2},null,8,["data","pid"]),c(B).userInfo.usertype!==1?(u(),A(_t,{key:0,data:At.value,pid:m.pid,onGetData:t[8]||(t[8]=M=>ct(m.pid)),typename:"工程文件压缩包",fileType:3},null,8,["data","pid"])):D("",!0),c(B).userInfo.usertype!==1?(u(),A(_t,{key:1,data:Vt.value,pid:m.pid,onGetData:t[9]||(t[9]=M=>ct(m.pid)),typename:"项目现场照片",fileType:4},null,8,["data","pid"])):D("",!0),c(B).userInfo.usertype!==1?(u(),A(_t,{key:2,data:Mt.value,pid:m.pid,onGetData:t[10]||(t[10]=M=>ct(m.pid)),typename:"网络通讯简图",fileType:5},null,8,["data","pid"])):D("",!0),c(B).userInfo.usertype!==1?(u(),A(_t,{key:3,data:qt.value,pid:m.pid,onGetData:t[11]||(t[11]=M=>ct(m.pid)),typename:"组态画面工程备份",fileType:6},null,8,["data","pid"])):D("",!0)]),_:1})):D("",!0)]),_:2},1032,["expanded-names"]),it===4?(u(),L("div",Ro)):D("",!0)],64)):D("",!0),qe===2?(u(),L(Ee,{key:2},[l(wt,{"default-expanded-names":["1"],"trigger-areas":["arrow"]},{default:n(()=>[Y.id===1?(u(),A(tt,{key:0,title:"验收文件",name:"1"},{default:n(()=>[l(_t,{data:Ot.value,pid:m.pid,onGetData:t[12]||(t[12]=M=>ct(m.pid)),typename:"验收确认单拍照",fileType:7},null,8,["data","pid"])]),_:1})):D("",!0)]),_:2},1024),it===0?(u(),L("div",Jo)):D("",!0)],64)):D("",!0),qe===3?(u(),L(Ee,{key:3},[Y.id===1?(u(),L("div",Ho,[we((u(),A(c(k),{size:"small",ghost:"",type:"primary",class:"w-160px",onClick:vt(Ll,["stop"])},{icon:n(()=>[l(Pe,{class:"text-icon"})]),default:n(()=>[t[59]||(t[59]=p(" 添加项目总结 "))]),_:1,__:[59]})),[[nt,"project:Customer:insert"]]),Qe.itemCount>0?(u(),L("div",Go,"共"+U(Qe.itemCount)+"条",1)):D("",!0)])):D("",!0),l(c(Re),{class:"h-250px","max-height":250,remote:"",pagination:Qe.pageSize==1?!1:Qe,"scroll-x":Ha.reduce((M,at)=>M+(at.width||100),0),columns:Ha,data:La.value,bordered:!1,"row-key":M=>M.id,"flex-height":!c(W).isMobile},null,8,["pagination","scroll-x","data","row-key","flex-height"]),l(vn,{visible:ra.value,"onUpdate:visible":t[13]||(t[13]=M=>ra.value=M),onSubmitted:t[14]||(t[14]=M=>St(m.pid)),"operate-type":(Jt=Xe.value)!=null&&Jt.id?"edit":"add",pid:m.pid,showtype:"detail",pname:(Ht=et.value.find(M=>M.id==m.pid))==null?void 0:Ht.proname,"row-data":Xe.value},null,8,["visible","operate-type","pid","pname","row-data"]),l(yn,{visible:wa.value,"onUpdate:visible":t[15]||(t[15]=M=>wa.value=M),showtype:"detail","row-data":Xe.value},null,8,["visible","row-data"])],64)):D("",!0),qe===4?(u(),L(Ee,{key:4},[f("div",Wo,[we((u(),A(c(k),{size:"small",ghost:"",type:"primary",class:"w-160px",onClick:vt($l,["stop"])},{icon:n(()=>[l(Pe,{class:"text-icon"})]),default:n(()=>[t[60]||(t[60]=p(" 添加项目日报 "))]),_:1,__:[60]})),[[nt,"project:Customer:insert"]]),Ze.itemCount>0?(u(),L("div",Ko,"共"+U(Ze.itemCount)+"条",1)):D("",!0)]),l(c(Re),{class:"h-350px","max-height":350,remote:"",pagination:Ze.pageSize==1?!1:Ze,"scroll-x":Ga.reduce((M,at)=>M+(at.width||100),0),columns:Ga,data:Da.value,bordered:!1,"row-key":M=>M.id,"flex-height":!c(W).isMobile},null,8,["pagination","scroll-x","data","row-key","flex-height"]),l(Cl,{visible:ua.value,"onUpdate:visible":t[16]||(t[16]=M=>ua.value=M),onSubmitted:t[17]||(t[17]=M=>da(m.pid)),"operate-type":(Gt=Xe.value)!=null&&Gt.id?"edit":"add",pid:m.pid,pname:(bt=et.value.find(M=>M.id==m.pid))==null?void 0:bt.proname,showtype:"detail","row-data":Xe.value},null,8,["visible","operate-type","pid","pname","row-data"]),l(on,{visible:Wa.value,"onUpdate:visible":t[18]||(t[18]=M=>Wa.value=M),showtype:"detail","row-data":Xe.value},null,8,["visible","row-data"])],64)):D("",!0),qe===5?(u(),L(Ee,{key:5},[f("div",Yo,[f("div",null,"共"+U(Pt.value.length)+"条",1)]),l(c(Re),{"max-height":150,style:yt({height:Pt.value.length==1?"100px":"160px"}),remote:"","scroll-x":Ya.reduce((M,at)=>M+(at.width||100),0),columns:Ya,data:Pt.value,bordered:!1,"row-key":M=>M.id,"flex-height":!c(W).isMobile},null,8,["style","scroll-x","data","row-key","flex-height"])],64)):D("",!0)],8,$o)])}),128))],512),[[Gs,Le.show]])]),_:2},1024)]))),128))])])])),[[es,za.value]])]),_:1}),l(Ia,{show:Rt.value,"onUpdate:show":t[19]||(t[19]=Le=>Rt.value=Le),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:n(()=>[p(U(pt.value=="debuggedDevieceList"?"待调试设备":pt.value=="debuggedBusinessList"?"待调试业务":pt.value=="needsList"?"客户需求变更":pt.value=="developBusinessList"?"需要开发":"")+" 文件列表 ",1)]),footer:n(()=>[l(c(he),{justify:"end"},{default:n(()=>[l(c(k),{size:"small",class:"mt-16px",onClick:Hl},{default:n(()=>[p(U(c(K)("common.cancel")),1)]),_:1}),l(c(k),{type:"primary",size:"small",class:"mt-16px",onClick:Jl},{default:n(()=>[p(U(c(K)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[l(c(k),{size:"small",ghost:"",type:"primary",onClick:Rl},{icon:n(()=>[l(Pe,{class:"text-icon"})]),default:n(()=>[t[61]||(t[61]=p(" 添加 "))]),_:1,__:[61]}),l(c(Re),{columns:Ol,"paginate-single-page":!1,data:Ke.value,"max-height":350},null,8,["data"])]),_:1},8,["show"]),l(Zl,{show:tl.value,"onUpdate:show":t[20]||(t[20]=Le=>tl.value=Le),"display-directive":"show",width:700},{default:n(()=>[l(Xl,{title:"日报","native-scrollbar":!1,closable:""},{default:n(()=>{var Le;return[l(ei,{type:"detail",pid:m.pid,pname:((Le=et.value.find(qe=>qe.id==m.pid))==null?void 0:Le.proname)||"",style:{height:"100%"}},null,8,["pid","pname"])]}),_:1})]),_:1},8,["show"]),l(hn,{visible:Na.value,"onUpdate:visible":t[21]||(t[21]=Le=>Na.value=Le),pid:m.pid},null,8,["visible","pid"])])}}}),kr=ka(Qo,[["__scopeId","data-v-e7ab4827"]]);export{kr as default};
