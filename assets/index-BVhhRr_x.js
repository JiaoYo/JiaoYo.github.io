import{_ as Ae}from"./table-header-operation.vue_vue_type_script_setup_true_lang-LQXhcny6.js";import{d as W,q as se,v as me,s as oe,L as ae,o as G,c as Q,w as d,g as t,M as K,h as w,t as te,i as p,$ as C,N as Ie,A as ne,B as x,E as V,D as fe,aa as ve,r as ue,j as be,K as ge,f as ie,aM as ee,Y as A,ak as le,V as he,ao as ye,by as _e,bj as we,S as re,aw as de,x as Ue,b as Pe,y as Le,C as Ne,aY as xe,F as Re,a0 as $e,an as ce,as as Fe,e as ze,ad as X,ae as Me}from"./index-BAVDbSG0.js";import{u as Ve,a as Be}from"./table-KJ4OXJa6.js";import{_ as Oe}from"./round-search-Bcb0t4Jv.js";import{_ as Ge}from"./round-refresh-yP8uig6G.js";import{_ as Qe}from"./FormItemGridItem-xXViKYEE.js";import{_ as He}from"./Grid-BDOf_ubP.js";import{u as H}from"./usePageData-C_dzg6Wv.js";import{a as je,T as Je}from"./basicconf-CAeQx9Ji.js";import{j as qe,g as Ke,a as We,k as Ye,l as Xe,h as Ze,e as el}from"./events-B-qGf2G1.js";import{q as De,u as Ee}from"./Collection-C7NwMJhE.js";import{f as Se,a as ke}from"./common-B4dekMWc.js";import{_ as q}from"./Popconfirm-CUDFKPM8.js";import{_ as Ce}from"./Tree-DdelJ9Fr.js";import{h as pe}from"./permission-CLrEu3_U.js";import{_ as ll}from"./DataTable-BDYCfsCN.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-C9U6osR4.js";import"./setting-outlined-D3n2FZ9Z.js";import"./round-delete-DS0ILC9q.js";import"./refresh-C3aYfWsn.js";import"./round-plus-BaLKVTfF.js";import"./Upload-B9yETaen.js";import"./Progress-CaLEcM5E.js";import"./Forward-edmZhOxW.js";const al=W({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:se(["reset","search"],["update:model"]),setup(j,{emit:m}){const e=m,{formRef:S,restoreValidation:h}=me(),y=oe(j,"model");function D(){y.value.fuzzy=void 0,e("search")}async function P(){await h(),e("reset")}async function E(){e("search")}return(L,o)=>{const I=ne,U=Qe,N=Ge,k=x,_=Oe,R=V,$=He,z=fe,T=ve,F=ae("no-space");return G(),Q(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:d(()=>[t(z,{ref_key:"formRef",ref:S,model:y.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ie(E,["enter"])},{default:d(()=>[t($,{responsive:"screen","item-responsive":""},{default:d(()=>[t(U,{span:"24 s:12 m:6",label:"策略名称",path:"fuzzy",class:"pr-24px"},{default:d(()=>[K(t(I,{clearable:"",value:y.value.fuzzy,"onUpdate:value":o[0]||(o[0]=n=>y.value.fuzzy=n),placeholder:"请输入策略名称",onClear:D},null,8,["value"]),[[F]])]),_:1}),t(U,{span:"24 m:4",class:"pr-24px"},{default:d(()=>[t(R,{class:"w-full"},{default:d(()=>[t(k,{onClick:P},{icon:d(()=>[t(N,{class:"text-icon"})]),default:d(()=>[w(" "+te(p(C)("common.reset")),1)]),_:1}),t(k,{type:"primary",ghost:"",onClick:E},{icon:d(()=>[t(_,{class:"text-icon"})]),default:d(()=>[w(" "+te(p(C)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),tl=W({name:"ConditionTree",__name:"conditionTree",props:{data:{default:[]},dataModifiers:{}},emits:["update:data"],setup(j){const m=oe(j,"data"),e=ue({showValueDom:1,obj:{colume:void 0,option:void 0,value:void 0},options1:[{value:"addr0",label:"发生源IP 数字",type:"long"},{value:"addr1",label:"源IP 数字",type:"long"},{value:"addr2",label:"目的IP 数字 ",type:"long"},{value:"ip0",label:"发生源IP",type:"string"},{value:"ip1",label:"源IP",type:"string"},{value:"ip2",label:"目的IP",type:"string"},{value:"port1",label:"源端口",type:"int"},{value:"port2",label:"目的端口",type:"int"},{value:"mac1",label:"源MAC地址",type:"string"},{value:"mac2",label:"目的MAC",type:"string"},{value:"category",label:"发生源设备类别",type:"int"},{value:"device",label:"发生源设备类型",type:"int"},{value:"kind",label:"事件类别",type:"int"},{value:"type",label:"事件类型",type:"int"},{value:"level",label:"事件等级",type:"int"},{value:"proType",label:"日志来源协议",type:"string"},{value:"protocol",label:"协议",type:"string"},{value:"code",label:"关键字",type:"string"}],options2:[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],options3:[]});function S({option:n}){return t("div",{style:{display:"flex",alignItems:"center"}},[t("div",{class:"flex-center  mr-30px",style:{gap:"8px 20px"}},[n.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>L("||或",n)},{default:()=>[w("||或")]}),n.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>L("&&与",n)},{default:()=>[w("&&与")]}),n.children&&t(q,{onPositiveClick:()=>o(n),showIcon:!1,show:n.isShow,onNegativeClick:()=>n.isShow=!1,onUpdateShow:s=>{e.obj={colume:void 0,option:void 0,value:void 0},e.showValueDom=1}},{default:ee(t(V,null,{default:()=>[t(A,{options:e.options1,value:e.obj.colume,"onUpdate:value":s=>P(s),placeholder:"请选择",style:{width:"180px"}},null),t(A,{options:e.options2,value:e.obj.option,"onUpdate:value":s=>e.obj.option=s,placeholder:"请选择",style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="category"||e.obj.colume=="device")&&t(A,{clearable:!0,options:e.options3,key:e.obj.colume,value:e.obj.value,placeholder:"请选择",labelField:e.obj.colume=="category"?"cname":e.obj.colume=="device"?"type":"",valueField:"id",onScroll:s=>F(s),"onUpdate:value":s=>e.obj.value=s,style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="kind"||e.obj.colume=="type"||e.obj.colume=="level")&&t(A,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,"onUpdate:value":s=>e.obj.value=s,style:{width:"180px"},placeholder:"请选择"},null),e.showValueDom==1&&t(ne,{clearable:!0,value:e.obj.value,"onUpdate:value":s=>e.obj.value=s},null),e.showValueDom==0&&t(le,{clearable:!0,value:e.obj.value,"onUpdate:value":s=>e.obj.value=s},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>n.isShow=!0},{default:()=>[w("配置")]})}),t(x,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>I(n)},{default:()=>[w("删除")]})])])}const h=be(1),y=()=>(h.value++,h.value),D=()=>{const n=s=>{let b=-1/0;const i=l=>{for(const a of l)a.id>b&&(b=a.id),a.children&&i(a.children)};return i(s),b};h.value=n(m.value)};ge(()=>{setTimeout(()=>{m.value.length>0&&D()},500)});const P=async n=>{const s=["addr0","addr1","addr2"],b=["ip0","ip1","ip2","mac1","mac2","port1","port2","proType","protocol","code"];s.includes(n)?e.showValueDom=0:b.includes(n)?e.showValueDom=1:e.showValueDom=2,n=="category"?(await N(),e.options3=U.data):n=="device"?(await R(),e.options3=_.data):n=="kind"?z():n=="type"?T():n=="level"&&(e.options3=he(je)),["ip0","ip1","ip2","mac1","mac2","proType","protocol","code"].includes(n)?e.options2=[{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"},{label:"匹配",value:"MATCH"}]:e.options2=[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],e.obj.option=e.options2[0].value,e.obj.colume=n,e.obj.value=void 0},E=n=>{m.value.length>0||(m.value.push({label:n,id:1,isShow:!1,children:[]}),h.value=1)},L=(n,s)=>{s.children.push({label:n,id:y(),children:[],isShow:!1})},o=n=>{var a,u,r,c,v,B,O;if(!e.obj.colume)return(a=window.$message)==null?void 0:a.warning("选择的信息项不能为空");if(e.obj.value==null)return(u=window.$message)==null?void 0:u.warning("条件值不能为空");const s=["ip0","ip1","ip2"],b=["mac1","mac2"],i=["port1","port2"];if(s.includes(e.obj.colume)&&!ye(e.obj.value))return(r=window.$message)==null?void 0:r.warning("请输入正确的IP地址");if(b.includes(e.obj.colume)&&!_e(e.obj.value))return(c=window.$message)==null?void 0:c.warning("请输入正确的MAC地址");if(i.includes(e.obj.colume)&&!we(e.obj.value))return(v=window.$message)==null?void 0:v.warning("请输入正确的端口号");let l=e.obj.value;if(e.showValueDom==2)if(e.obj.colume=="category"||e.obj.colume=="device"){const g=e.options3.find(M=>M.id==e.obj.value);l=e.obj.colume=="category"?g==null?void 0:g.cname:g==null?void 0:g.type}else{const g=e.options3.find(M=>M.value==e.obj.value);l=g==null?void 0:g.label}n.children.push({colume:e.obj.colume,option:e.obj.option,value:e.obj.value,id:y(),label:`${(B=e.options1.find(g=>g.value==e.obj.colume))==null?void 0:B.label} ${(O=e.options2.find(g=>g.value==e.obj.option))==null?void 0:O.label} ${l} `,flag:!1}),e.obj={colume:void 0,option:void 0,value:void 0},e.showValueDom=1,n.isShow=!1},I=n=>{console.log(n,"row");function s(b,i){return b.reduce((l,a)=>(a.id===i||(a.children&&(a.children=s(a.children,i)),l.push(a)),l),[])}m.value=s(m.value,n.id)},{pageData:U,getData:N,nextPage:k}=H(De),{pageData:_,getData:R,nextPage:$}=H(Ee),z=async()=>{const{data:n,error:s}=await Se();console.log(n),e.options3=n.map(b=>({label:b.pname,value:b.id}))},T=async()=>{const{data:n,error:s}=await ke();console.log(n),e.options3=n.map(b=>({label:b.pname,value:b.id}))},F=async n=>{const s=n.currentTarget;s.scrollTop+s.offsetHeight>=s.scrollHeight&&(e.obj.colume=="category"&&k(),e.obj.colume=="device"&&$())};return(n,s)=>{const b=Ce,i=re;return G(),Q(i,{class:"h-220px",style:{border:"1px solid #dcdcdc","border-radius":"6px"}},{default:d(()=>[t(p(V),{justify:"end",class:"p-5px"},{default:d(()=>[ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:s[0]||(s[0]=l=>E("||或"))},"||或"),ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:s[1]||(s[1]=l=>E("&&与"))},"&&与")]),_:1}),(G(),Q(b,{"block-line":"",data:m.value,"default-expand-all":"",selectable:!1,"render-suffix":S,key:h.value,"key-field":"id"},null,8,["data"]))]),_:1})}}}),ol=de(tl,[["__scopeId","data-v-8027c5a8"]]),nl=W({name:"RelationRuleTree",__name:"relationRuleTree",props:{data:{default:[]},dataModifiers:{}},emits:["update:data"],setup(j){const m=oe(j,"data"),e=ue({showValueDom:1,obj:{colume:void 0,option:void 0,value:void 0,duration:60,times:2,columns:[],ishappen:1},options1:[{value:"addr0",label:"发生源IP 数字",type:"long"},{value:"addr1",label:"源IP 数字",type:"long"},{value:"addr2",label:"目的IP 数字 ",type:"long"},{value:"ip0",label:"发生源IP",type:"string"},{value:"ip1",label:"源IP",type:"string"},{value:"ip2",label:"目的IP",type:"string"},{value:"port1",label:"源端口",type:"int"},{value:"port2",label:"目的端口",type:"int"},{value:"mac1",label:"源MAC地址",type:"string"},{value:"mac2",label:"目的MAC",type:"string"},{value:"category",label:"发生源设备类别",type:"int"},{value:"device",label:"发生源设备类型",type:"int"},{value:"kind",label:"事件类别",type:"int"},{value:"type",label:"事件类型",type:"int"},{value:"level",label:"事件等级",type:"int"},{value:"proType",label:"日志来源协议",type:"string"},{value:"protocol",label:"协议",type:"string"},{value:"code",label:"关键字",type:"string"}],options2:[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],options3:[]});function S({option:l}){return t("div",{style:{display:"flex",alignItems:"center"}},[t("span",{style:{minWidth:"50px"}},[l.label]),t("div",{class:"flex-center mx-30px",style:{gap:"8px 20px"}},[l.children&&!l.logic&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>o("||或",l)},{default:()=>[w("||或")]}),l.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>o("&&与",l)},{default:()=>[w("&&与")]}),l.children&&!l.logic&&!l.times&&!l.duration&&t(q,{onPositiveClick:()=>I(l),showIcon:!1,show:l.isShow,onNegativeClick:()=>l.isShow=!1},{default:ee(t(V,null,{default:()=>[t(A,{options:e.options1,value:e.obj.colume,"onUpdate:value":a=>E(a),placeholder:"请选择",style:{width:"180px"}},null),t(A,{options:e.options2,value:e.obj.option,"onUpdate:value":a=>e.obj.option=a,placeholder:"请选择",style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="category"||e.obj.colume=="device")&&t(A,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,labelField:e.obj.colume=="category"?"cname":e.obj.colume=="device"?"type":"",placeholder:"请选择",onScroll:a=>i(a),valueField:"id","onUpdate:value":a=>e.obj.value=a,style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="kind"||e.obj.colume=="type"||e.obj.colume=="level")&&t(A,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,"onUpdate:value":a=>e.obj.value=a,style:{width:"180px"},placeholder:"请选择"},null),e.showValueDom==1&&t(ne,{clearable:!0,value:e.obj.value,"onUpdate:value":a=>e.obj.value=a},null),e.showValueDom==0&&t(le,{clearable:!0,value:e.obj.value,"onUpdate:value":a=>e.obj.value=a},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>l.isShow=!0},{default:()=>[w("配置")]})}),l.children&&l.times&&l.duration&&t(q,{onPositiveClick:()=>U(l),showIcon:!1},{default:ee(t(V,null,{default:()=>[t(le,{style:{width:"140px"},clearable:!0,value:e.obj.duration,"onUpdate:value":a=>e.obj.duration=a},null),t(le,{style:{width:"140px"},clearable:!0,value:e.obj.times,"onUpdate:value":a=>e.obj.times=a},null),t(A,{clearable:!0,options:e.options1,value:e.obj.columns,multiple:!0,"onUpdate:value":a=>e.obj.columns=a,placeholder:"请选择",style:{width:"180px"}},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>{e.obj.columns=l.columns,e.obj.duration=l.duration,e.obj.times=l.times}},{default:()=>[w("配置")]})}),l.children&&l.logic&&t(q,{onPositiveClick:()=>h(l),showIcon:!1},{default:ee(t(V,null,{default:()=>[t(A,{clearable:!0,options:[{label:"发生",value:1},{label:"不发生",value:0}],value:e.obj.ishappen,"onUpdate:value":a=>e.obj.ishappen=a,placeholder:"请选择",style:{width:"180px"}},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>e.obj.ishappen=l.ishappen},{default:()=>[w("配置")]})}),!l.logic&&t(x,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>N(l)},{default:()=>[w("删除")]})]),l.duration&&l.times&&t("span",null,["在"+l.duration+"秒内，发生"+l.times+"次   归并字段："+k(l.columns)])])}const h=l=>{const a=/状态(\d+)/g;let u;const r=[];for(;(u=a.exec(l.label))!==null;)r.push(u[1]);l.ishappen=e.obj.ishappen,l.label=`状态${r[0]}之后${e.obj.ishappen?"发生":"不发生"}状态${r[1]}`},y=be(1),D=()=>y.value+=1,P=()=>{const l=a=>{let u=-1/0;const r=c=>{for(const v of c)v.id>u&&(u=v.id),v.children&&r(v.children)};return r(a),u};y.value=l(m.value)};ge(()=>{setTimeout(()=>{m.value.length>0&&P()},500)});const E=async l=>{const a=["addr0","addr1","addr2"],u=["ip0","ip1","ip2","mac1","mac2","port1","port2","proType","protocol","code"];a.includes(l)?e.showValueDom=0:u.includes(l)?e.showValueDom=1:e.showValueDom=2,l=="category"?(await $(),e.options3=R.data):l=="device"?(await F(),e.options3=T.data):l=="kind"?s():l=="type"?b():l=="level"&&(e.options3=[]),["ip0","ip1","ip2","mac1","mac2","proType","protocol","code"].includes(l)?e.options2=[{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"},{label:"匹配",value:"MATCH"}]:e.options2=[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],e.obj.option=e.options2[0].value,e.obj.colume=l,e.obj.value=void 0},L=()=>{if(m.value.length==0){m.value.push({label:"状态1",id:1,children:[],duration:60,times:2,columns:[]});return}const l=(m.value.length-1)/2+1;m.value.push({label:`状态${l}之后发生状态${l+1}`,id:D(),ishappen:1,logic:"and",children:[]});const a=m.value[m.value.length-1].id;m.value.push({label:`状态${l+1}`,id:D(),subId:a,children:[],duration:60,times:2,columns:[]})},o=(l,a)=>{a.children.push({label:l,id:D(),children:[],isShow:!1})},I=l=>{var v,B,O,g,M,Y,J;if(!e.obj.colume)return(v=window.$message)==null?void 0:v.warning("选择的信息项不能为空");if(e.obj.value==null)return(B=window.$message)==null?void 0:B.warning("条件值不能为空");const a=["ip0","ip1","ip2"],u=["mac1","mac2"],r=["port1","port2"];if(a.includes(e.obj.colume)&&!ye(e.obj.value))return(O=window.$message)==null?void 0:O.warning("请输入正确的IP地址");if(u.includes(e.obj.colume)&&!_e(e.obj.value))return(g=window.$message)==null?void 0:g.warning("请输入正确的MAC地址");if(r.includes(e.obj.colume)&&!we(e.obj.value))return(M=window.$message)==null?void 0:M.warning("请输入正确的端口号");let c=e.obj.value;if(e.showValueDom==2){const f=e.options3.find(Te=>Te.value==e.obj.value);c=f==null?void 0:f.label}l.children.push({colume:e.obj.colume,option:e.obj.option,value:e.obj.value,id:D(),label:`${(Y=e.options1.find(f=>f.value==e.obj.colume))==null?void 0:Y.label} ${(J=e.options2.find(f=>f.value==e.obj.option))==null?void 0:J.label} ${c} `,flag:!1}),_(),l.isShow=!1},U=l=>{l.duration=e.obj.duration,l.times=e.obj.times,l.columns=e.obj.columns},N=l=>{function a(u,r){return u.reduce((c,v)=>(r.includes(v.id)||(v.children&&(v.children=a(v.children,r)),c.push(v)),c),[])}l.subId?m.value=a(m.value,[l.id,l.subId]):m.value=a(m.value,[l.id])},k=l=>{let a="";return l.forEach((u,r)=>{var c;a+=`${(c=e.options1.find(v=>v.value==u))==null?void 0:c.label}${r==l.length-1?"":"、"}`}),a},_=()=>{e.obj={colume:void 0,option:void 0,value:void 0,duration:60,times:2,ishappen:1,columns:[]}},{pageData:R,getData:$,nextPage:z}=H(De),{pageData:T,getData:F,nextPage:n}=H(Ee),s=async()=>{const{data:l,error:a}=await Se();console.log(l),e.options3=l.map(u=>({label:u.pname,value:u.id}))},b=async()=>{const{data:l,error:a}=await ke();console.log(l),e.options3=l.map(u=>({label:u.pname,value:u.id}))},i=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&(e.obj.colume=="category"&&z(),e.obj.colume=="device"&&n())};return(l,a)=>{const u=Ce,r=re;return G(),Q(r,{class:"h-220px",style:{border:"1px solid #dcdcdc","border-radius":"6px"}},{default:d(()=>[t(p(V),{justify:"end",class:"p-5px"},{default:d(()=>[ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:L},"㊉ 新增关联状态")]),_:1}),(G(),Q(u,{"block-line":"",data:m.value,"default-expand-all":"",selectable:!1,"render-label":S,"key-field":"id",key:y.value},null,8,["data"]))]),_:1})}}}),sl=de(nl,[["__scopeId","data-v-0bdad4b6"]]),il=W({name:"OperateDrawer",__name:"operate-drawer",props:se({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:se(["submitted"],["update:visible"]),setup(j,{emit:m}){const e=j,S=m,h=oe(j,"visible"),{formRef:y,validate:D,restoreValidation:P}=me(),{defaultRequiredRule:E}=Ue(),L=Pe(()=>({add:"新增关联策略",edit:"修改关联策略"})[e.operateType]),o=ue(I());function I(){return{aname:"",adesc:"",acond:[],arules:[],eid:null,elevel:null,fid:null,etext:"",syspara:1,dbtime:"",status:1}}const U={aname:E,eid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"}};async function N(){var l;if(await R(),await F(),Object.assign(o,I()),e.operateType==="edit"&&e.rowData){const{data:a,error:u}=await qe(e.rowData.id);u||(Object.assign(o,a),o.fid=(l=o.fid)==null?void 0:l.split(","),o.acond=a.acond.replace(/&amp;/g,"&"),o.arules=a.arules.replace(/&amp;/g,"&"),o.acond=JSON.parse(o.acond),o.arules=JSON.parse(o.arules))}}function k(){h.value=!1}const{pageData:_,getData:R,nextPage:$}=H(Ke),z=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&_.data.length<_.total&&$()},{pageData:T,getData:F,nextPage:n}=H(We),s=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&T.data.length<T.total&&n()},b=l=>l.ipaddr+":"+l.fport+" ("+(l.ftype==0?"syslog":"SNMP Trap")+")";async function i(){var l,a,u,r;if(console.log(o.acond),console.log(o.arules),await D(),e.operateType==="add"){const{data:c,error:v}=await Ye([{acond:JSON.stringify(o.acond),adesc:o.adesc,aname:o.aname,arules:JSON.stringify(o.arules),dbtime:o.dbtime,eid:o.eid,elevel:o.elevel,fid:(l=o.fid)==null?void 0:l.join(","),etext:o.etext,syspara:o.syspara,status:o.status}]);v||((a=window.$message)==null||a.success(C("common.addSuccess")),k(),S("submitted"))}else{const{data:c,error:v}=await Xe([{id:e.rowData.id,acond:JSON.stringify(o.acond),adesc:o.adesc,aname:o.aname,arules:JSON.stringify(o.arules),dbtime:o.dbtime,eid:o.eid,elevel:o.elevel,fid:(u=o.fid)==null?void 0:u.join(","),etext:o.etext,syspara:o.syspara,status:o.status}]);v||((r=window.$message)==null||r.success(C("common.updateSuccess")),k(),S("submitted"))}}return Le(h,()=>{h.value&&(N(),P())}),(l,a)=>{const u=ne,r=Ne,c=A,v=xe,B=fe,O=re,g=x,M=V,Y=Re,J=ae("no-space");return G(),Q(Y,{show:h.value,"onUpdate:show":a[9]||(a[9]=f=>h.value=f),title:L.value,preset:"card",class:"w-800px"},{footer:d(()=>[t(M,{size:16,justify:"center"},{default:d(()=>[t(g,{onClick:k},{default:d(()=>[w(te(p(C)("common.cancel")),1)]),_:1}),t(g,{type:"primary",onClick:i},{default:d(()=>[w(te(p(C)("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[t(O,{class:"max-h-480px pr-20px"},{default:d(()=>[t(B,{ref_key:"formRef",ref:y,model:o,rules:U,"label-placement":"top","label-width":"120"},{default:d(()=>[t(r,{label:"策略名称",path:"aname"},{default:d(()=>[K(t(u,{value:o.aname,"onUpdate:value":a[0]||(a[0]=f=>o.aname=f),clearable:"",placeholder:"请输入策略名称"},null,8,["value"]),[[J]])]),_:1}),t(r,{label:"策略描述",path:"adesc"},{default:d(()=>[K(t(u,{type:"textarea",value:o.adesc,"onUpdate:value":a[1]||(a[1]=f=>o.adesc=f),placeholder:"请输入策略描述",clearable:""},null,8,["value"]),[[J]])]),_:1}),t(r,{label:"条件",path:"acond"},{default:d(()=>[t(ol,{data:o.acond,"onUpdate:data":a[2]||(a[2]=f=>o.acond=f)},null,8,["data"])]),_:1}),t(r,{label:"关联规则",path:"arules"},{default:d(()=>[t(sl,{data:o.arules,"onUpdate:data":a[3]||(a[3]=f=>o.arules=f)},null,8,["data"])]),_:1}),t(r,{label:"事件名称",path:"eid"},{default:d(()=>[t(c,{value:o.eid,"onUpdate:value":a[4]||(a[4]=f=>o.eid=f),placeholder:"请选择事件名称",clearable:"",filterable:"","value-field":"id","label-field":"ename",options:p(_).data,"reset-menu-on-options-change":!1,onScroll:z},null,8,["value","options"])]),_:1}),t(r,{label:"事件等级",path:"elevel"},{default:d(()=>[t(c,{filterable:"",value:o.elevel,"onUpdate:value":a[5]||(a[5]=f=>o.elevel=f),placeholder:"请选择事件等级",options:p(he)(p(je)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),t(r,{label:"转发外系统",path:"fid"},{default:d(()=>[t(c,{multiple:"","max-tag-count":1,value:o.fid,"onUpdate:value":a[6]||(a[6]=f=>o.fid=f),placeholder:"请选择转发外系统",clearable:"",filterable:"","render-label":b,"value-field":"id","label-field":"ipaddr",options:p(T).data,"reset-menu-on-options-change":!1,onScroll:s},null,8,["value","options"])]),_:1}),t(r,{label:"事件文本",path:"etext"},{default:d(()=>[t(u,{type:"textarea",value:o.etext,"onUpdate:value":a[7]||(a[7]=f=>o.etext=f),placeholder:"请输入事件文本",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"使用状态",path:"maxagg"},{default:d(()=>[t(v,{value:o.status,"onUpdate:value":a[8]||(a[8]=f=>o.status=f),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),ul=de(il,[["__scopeId","data-v-4d146dd4"]]),rl={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Z(j){return typeof j=="function"||Object.prototype.toString.call(j)==="[object Object]"&&!Me(j)}const Ll=W({name:"eventalarm_associatedeventspolicy",__name:"index",setup(j){const m=$e(),{columns:e,columnChecks:S,data:h,getData:y,loading:D,mobilePagination:P,searchParams:E,resetSearchParams:L}=Ve({apiFn:Ze,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"aname",title:"策略名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"adesc",title:"策略描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",minWidth:120,render:i=>{(i.elevel===void 0||i.elevel===null)&&(i.elevel=1);const l={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},a=C(Je[i.elevel]);let u={color:l[i.elevel],textColor:"#ffffff",borderColor:l[i.elevel]};return t(ce,{size:"small",color:u},Z(a)?a:{default:()=>[a]})}},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"status",title:"使用状态",align:"center",width:160,render:i=>t(xe,{disabled:!0,value:i.status,"checked-value":1,"unchecked-value":0},null)},{key:"syspara",title:"系统内置",align:"center",width:240,render:i=>{i.sysparam==null&&(i.sysparam=0);const l={0:"success",1:"info"},a=C(Fe[i.sysparam]);return t(ce,{size:"small",type:l[i.sysparam]},Z(a)?a:{default:()=>[a]})}},{key:"operate",title:C("common.operate"),align:"center",width:160,fixed:"right",render:i=>{let l;return i.syspara!=0?t("div",{class:"flex-center gap-8px"},[K(t(x,{type:"primary",ghost:!0,size:"small",onClick:()=>F(i.id)},Z(l=C("common.edit"))?l:{default:()=>[l]}),[[ae("no-auth"),"assocition.policy.update"]]),t(q,{onPositiveClick:()=>n(i.id)},{default:()=>C("common.confirmDelete"),trigger:()=>{let a;return K(t(x,{type:"error",ghost:!0,size:"small"},Z(a=C("common.delete"))?a:{default:()=>[a]}),[[ae("no-auth"),"assocition.policy.delete"]])}})]):null}}]}),{drawerVisible:o,operateType:I,editingData:U,handleAdd:N,handleEdit:k,checkedRowKeys:_,onBatchDeleted:R,onDeleted:$,closeDrawer:z}=Be(h,y);async function T(){console.log(_.value),s(_.value,i=>{R()})}function F(i){k(i)}function n(i){console.log(i),s([i],l=>{$()})}async function s(i,l){const{data:a,error:u}=await el(i);if(!u)l&&l(a);else return!1}async function b(){}return(i,l)=>{const a=Ae,u=ll,r=ve;return G(),ze("div",rl,[t(al,{model:p(E),"onUpdate:model":l[0]||(l[0]=c=>X(E)?E.value=c:null),onReset:p(L),onSearch:p(y)},null,8,["model","onReset","onSearch"]),t(r,{title:"关联策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":d(()=>[t(a,{columns:p(S),"onUpdate:columns":l[1]||(l[1]=c=>X(S)?S.value=c:null),"disabled-delete":p(_).length===0,loading:p(D),onAdd:p(N),onDelete:T,onRefresh:p(y),"is-view-export-button":!0,onExportHandler:b,"is-view-add-button":p(pe)("assocition.policy.insert"),"is-view-delete-button":p(pe)("assocition.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:d(()=>[t(u,{"checked-row-keys":p(_),"onUpdate:checkedRowKeys":l[2]||(l[2]=c=>X(_)?_.value=c:null),columns:p(e),data:p(h),size:"small","flex-height":!p(m).isMobile,"scroll-x":962,loading:p(D),remote:"","row-key":c=>c.id,pagination:p(P),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(ul,{visible:p(o),"onUpdate:visible":l[3]||(l[3]=c=>X(o)?o.value=c:null),"operate-type":p(I),"row-data":p(U),onSubmitted:p(y)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Ll as default};
