import{_ as ne}from"./round-add-CHsveicE.js";import{d as G,aq as J,p as Y,bY as se,s as le,r as E,ar as Q,a1 as ie,c1 as re,x as K,c as P,o as m,w as e,f as t,as as de,b as R,y as I,F as W,z as ce,e as l,t as u,T as pe,C as B,h as s,A as ue,E as X,c2 as me,B as C,g as z,a5 as fe,a4 as _e,aw as ge,q as ve,U as Z,at as be,N as ee,$ as U,L as ye,i as he,az as A,c3 as we,av as xe,aC as ke}from"./index-IJPUKuVg.js";import{f as De,a as Ce,b as ze,_ as Ne,c as je,d as Se}from"./operate-drawer.vue_vue_type_style_index_0_lang-CfnMMYA1.js";import{u as Pe,a as Le}from"./table-CogYQEHF.js";import{_ as $e}from"./Avatar-CrqbR7q6.js";import{_ as Te}from"./text-BGrMs6Cj.js";import{N as te}from"./Popconfirm-C-8L0Flv.js";import{_ as Re}from"./round-search-Bm2wvj6V.js";import{u as Be}from"./usePageData-BFTSiBnI.js";import{f as Fe}from"./project-BDdZNt5n.js";import{_ as Me}from"./Grid-L-iwlohn.js";import{_ as Ue}from"./FormItemGridItem-D247iqno.js";import"./v4-FuVw324d.js";import"./utils-Dreq_XfI.js";const Ie={key:0},Ee={class:"mt-4 border-t pt-3"},Ve={class:"flex items-start gap-2 mb-3"},Ke={class:"ml-2 flex-1"},Ae={class:"flex items-center"},Ge={class:"font-medium font-size-16px font-bold"},Oe={class:"text-gray-600 mt-1"},qe=G({name:"drawerLog",__name:"drawerLog",props:J({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(g){const V=Y();se();const o=le({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0}),N=g,c={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},v=E({});async function b(){f.value=[],Object.assign(o,N.rowData);const n=JSON.parse(N.rowData.context);o.proname=n.proname,o.notes=n.notes,o.problem=n.problem,o.solutions=n.solutions,o.feedback=n.feedback,o.summarize=n.summarize,o.percent=n.percent,x()}const f=E([]),y=Q(g,"visible");ie(y,()=>{y.value?b():(f.value=[],o.id=void 0)});function F(n){n||h()}function h(){y.value=!1}const x=async()=>{const{data:n,error:a}=await Ce({page:1,limit:100,pid:o.id});n&&(f.value=n.list)},j=re.debounce(async()=>{var _;const n=v.value[o.id];if(!(n!=null&&n.trim()))return(_=window.$message)==null?void 0:_.warning("请输入评论内容");const{data:a,error:r}=await De([{pid:o.id,context:n}]);a&&(v.value[o.id]="",o.num++,x())},1e3,{leading:!0,trailing:!1}),k=async n=>{var _;const{data:a,error:r}=await ze(n.id);a&&(x(),o.num--,(_=window.$message)==null||_.success("删除成功"))};return(n,a)=>{const r=ce,_=W,L=$e,M=Te,S=de,$=ge,T=K("no-auth");return m(),P($,{show:y.value,"onUpdate:show":[a[1]||(a[1]=p=>y.value=p),F],"display-directive":"show",width:600,onMaskClick:h,onEsc:h},{default:e(()=>[t(S,{title:o.username+"的项目日报","native-scrollbar":!1,closable:""},{default:e(()=>[t(_,{ref:"formRef",model:o},{default:e(()=>[t(r,{label:"项目名称",path:"proname","label-placement":"left"},{label:e(()=>a[2]||(a[2]=[l("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:e(()=>[l("span",null,u(o.proname),1)]),_:1}),t(r,{label:"当前项目进度百分比",path:"percent","label-placement":"left"},{label:e(()=>a[3]||(a[3]=[l("div",{class:"font-size-16px font-bold"},"当前项目进度百分比",-1)])),default:e(()=>[l("span",null,u(o.percent?o.percent+"%":""),1)]),_:1}),t(r,{label:"当前工作内容及成果描述",path:"notes"},{label:e(()=>a[4]||(a[4]=[l("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述",-1)])),default:e(()=>[l("span",null,u(o.notes),1)]),_:1}),t(r,{label:"遇到问题",path:"problem"},{label:e(()=>a[5]||(a[5]=[l("div",{class:"font-size-16px font-bold"},"遇到问题",-1)])),default:e(()=>[l("span",null,u(o.problem),1)]),_:1}),t(r,{label:"解决措施",path:"solutions"},{label:e(()=>a[6]||(a[6]=[l("div",{class:"font-size-16px font-bold"},"解决措施",-1)])),default:e(()=>[l("span",null,u(o.solutions),1)]),_:1}),t(r,{label:"建议意见反馈",path:"feedback"},{label:e(()=>a[7]||(a[7]=[l("div",{class:"font-size-16px font-bold"},"建议意见反馈",-1)])),default:e(()=>[l("span",null,u(o.feedback),1)]),_:1}),t(r,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:e(()=>a[8]||(a[8]=[l("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感",-1)])),default:e(()=>[l("span",null,u(o.summarize),1)]),_:1})]),_:1},8,["model"]),o.num?(m(),R("div",Ie,u(o.num)+"评论",1)):I("",!0),t(pe,{name:"fade"},{default:e(()=>[l("div",Ee,[B((m(),R("div",Ve,[l("div",null,[t(L,{size:"small",src:c.avatar},null,8,["src"])]),t(s(ue),{type:"textarea",id:`comment-input-${o.id}`,value:v.value[o.id],"onUpdate:value":a[0]||(a[0]=p=>v.value[o.id]=p),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:X(me(s(j),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),t(s(C),{type:"primary",ghost:"",onClick:s(j)},{default:e(()=>a[9]||(a[9]=[z("发送")])),_:1,__:[9]},8,["onClick"])])),[[T,"project:Comment:insert"]]),(m(!0),R(fe,null,_e(f.value,p=>(m(),R("div",{key:p.id,class:"flex mb-3"},[t(L,{size:"small",src:c.avatar},null,8,["src"]),l("div",Ke,[l("div",Ae,[l("span",Ge,u(p.username),1),t(M,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:e(()=>[z(u(p.dbtime),1)]),_:2},1024),s(V).userInfo.id==p.creater?(m(),P(s(te),{key:0,onPositiveClick:d=>k(p)},{trigger:e(()=>[B((m(),P(s(C),{quaternary:"",type:"error",size:"small"},{default:e(()=>a[10]||(a[10]=[z(" 删除 ")])),_:1,__:[10]})),[[T,"project:Comment:delete"]])]),default:e(()=>[a[11]||(a[11]=z(" 确定删除吗？ "))]),_:2,__:[11]},1032,["onPositiveClick"])):I("",!0)]),l("div",Oe,u(p.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),He=G({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search","clear"],["update:model"]),setup(g,{emit:V}){const o=V,{formRef:N}=ve(),c=Q(g,"model"),v=E([]),{pageData:b,getData:f,nextPage:y}=Be(Fe),F=async k=>{const n=k.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&b.data.length<b.total&&(y(),v.value=b.data)},h=async k=>{c.value.pid=k,o("search")};(async()=>{await f(),v.value=b.data})();async function j(){o("search")}return(k,n)=>{const a=be,r=Ue,_=Re,L=C,M=ee,S=Me,$=W,T=Z;return m(),P(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:e(()=>[t($,{ref_key:"formRef",ref:N,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:X(j,["enter"])},{default:e(()=>[t(S,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:e(()=>[t(r,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:e(()=>[t(a,{clearable:"",filterable:"",value:c.value.pid,"onUpdate:value":[n[0]||(n[0]=p=>c.value.pid=p),h],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:v.value,onScroll:F},null,8,["value","options"])]),_:1}),t(r,{span:"24  s:12 m:6",class:"pr-24px"},{default:e(()=>[t(M,{class:"w-full"},{default:e(()=>[t(L,{type:"primary",ghost:"",onClick:j},{icon:e(()=>[t(_,{class:"text-icon"})]),default:e(()=>[z(" "+u(s(U)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ye={key:0};function H(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!ke(g)}const ct=G({name:"projectmanagement_daylog",__name:"index",props:{pid:{default:void 0},type:{}},emits:["thereIsData"],setup(g,{emit:V}){const o=ye(),N=Y(),c=g,{columns:v,data:b,getData:f,loading:y,mobilePagination:F,searchParams:h}=Pe({showTotal:!0,immediate:!1,apiFn:je,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:d=>t("div",null,[d.username+"的项目日报"])},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:U("common.operate"),align:"center",width:140,fixed:"right",render:d=>{let i;return t("div",{class:"flex-center gap-8px"},[t(C,{type:"primary",ghost:!0,size:"small",onClick:()=>T(d)},{default:()=>[z("查看详情")]}),N.userInfo.id==d.creater&&B(t(C,{type:"primary",ghost:!0,size:"small",onClick:()=>M(d.id)},H(i=U("common.edit"))?i:{default:()=>[i]}),[[K("no-auth"),"project:DailyReport:update"]]),N.userInfo.id==d.creater&&t(te,{onPositiveClick:()=>L(d.id)},{default:()=>U("common.confirmDelete"),trigger:()=>{let D;return B(t(C,{type:"error",ghost:!0,size:"small"},H(D=U("common.delete"))?D:{default:()=>[D]}),[[K("no-auth"),"project:DailyReport:delete"]])}})])}}]}),{drawerVisible:x,operateType:j,editingData:k,handleAdd:n,handleEdit:a,checkedRowKeys:r,onDeleted:_}=Le(b,f);async function L(d){const{data:i,error:D}=await Se(d);D||_()}function M(d){a(d)}const S=E(!1),$=E({}),T=d=>{S.value=!0,$.value=d},p=()=>{f()};return he(()=>{c.type!="externalLiaison"&&f()}),(d,i)=>{const D=ee,O=ne,oe=xe,ae=Z,q=K("no-auth");return m(),R("div",Je,[c.pid?I("",!0):(m(),P(He,{key:0,model:s(h),"onUpdate:model":i[0]||(i[0]=w=>A(h)?h.value=w:null),onReset:p,onSearch:s(f)},null,8,["model","onSearch"])),t(ae,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},we({header:e(()=>[t(D,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:e(()=>[c.pid?I("",!0):(m(),R("div",Ye,"项目日报"))]),_:1}),c.pid?B((m(),P(s(C),{key:0,onClick:s(n),size:"small",ghost:"",type:"primary"},{icon:e(()=>[t(O,{class:"text-icon"})]),default:e(()=>[i[4]||(i[4]=z(" "+u("新增")))]),_:1,__:[4]},8,["onClick"])),[[q,"project:DailyReport:insert"]]):I("",!0)]),default:e(()=>[t(oe,{"checked-row-keys":s(r),"onUpdate:checkedRowKeys":i[1]||(i[1]=w=>A(r)?r.value=w:null),columns:s(v),data:s(b),size:"small","flex-height":!s(o).isMobile,loading:s(y),remote:"","row-key":w=>w.id,pagination:s(F),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Ne,{visible:s(x),"onUpdate:visible":i[2]||(i[2]=w=>A(x)?x.value=w:null),onSubmitted:s(f),"operate-type":s(j),pid:c.pid,"row-data":s(k)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),t(qe,{visible:S.value,"onUpdate:visible":i[3]||(i[3]=w=>S.value=w),"row-data":$.value},null,8,["visible","row-data"])]),_:2},[c.pid?void 0:{name:"header-extra",fn:e(()=>[t(D,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:e(()=>[B((m(),P(s(C),{onClick:s(n),size:"small",ghost:"",type:"primary"},{icon:e(()=>[t(O,{class:"text-icon"})]),default:e(()=>[i[5]||(i[5]=z(" "+u("新增")))]),_:1,__:[5]},8,["onClick"])),[[q,"project:DailyReport:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{ct as default};
