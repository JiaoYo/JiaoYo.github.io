import{_ as ie}from"./refresh-DDT70CE0.js";import{_ as re,l as ce}from"./lodash-21GmhknM.js";import{d as q,q as ue,a4 as j,j as h,v as pe,s as me,K as M,o as D,c as z,w as s,g as t,L as P,i,$ as m,Z as E,e as Z,an as de,N as fe,h as S,t as U,f as _e,M as ge,aD as ve,A as he,a2 as ye,B as A,E as J,D as be,ad as Q,r as K,at as F,bl as xe,ah as ke,ai as Te,V as Ce}from"./index-ByfxsQvj.js";import{f as De,a as Se,b as we,c as Ne}from"./alarm-WX-JILWj.js";import{_ as ze,a as Ae}from"./arrow-open-up-BQr4szyH.js";import{_ as Le}from"./round-search-U_wZ0GRt.js";import{_ as $e}from"./round-refresh-BRVSTvae.js";import{u as G}from"./usePageData-lPm5H_26.js";import{C as Re,a as Ve}from"./common-BkNv20Ip.js";import{f as He}from"./audit-events-Bl4EoXOV.js";import{a as Ie,T as Me}from"./basicconf-DJQBiVhW.js";import{_ as Pe}from"./FormItemGridItem-Dtr_7n7z.js";import{_ as Ue}from"./DatePicker-ChOIwL9T.js";import{_ as Be}from"./Grid-B9K_tFX2.js";import{_ as O}from"./Popconfirm-Bx1fZnQD.js";import"./TimePicker-Bw31iYnN.js";import"./defineProperty-D9xlJP3p.js";const Ee=q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ue(["reset","search"],["update:model"]),setup(y,{emit:L}){const b=L,d=j(),x=h(!1),{formRef:r,restoreValidation:f}=pe(),n=me(y,"model"),{pageData:_,getData:w,nextPage:$}=G(He),g=async o=>{const a=o.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&_.data.length<_.total&&$()};w();const{pageData:k,getData:R,nextPage:V}=G(De),v=async o=>{const a=o.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&k.data.length<k.total&&V()};R();async function H(o,a){o?(n.value.startTime=o[0],n.value.endTime=o[1]):(n.value.startTime=null,n.value.endTime=null),b("search")}function I(){n.value.fuzzy=void 0,b("search")}async function N(){await f(),n.value.timeRange=null,n.value.atype=null,n.value.alevel=null,n.value.alatype=null,n.value.apolicy=null,n.value.startTime=null,n.value.endTime=null,ve(()=>{b("search")})}async function e(){b("search")}const l=re.throttle(e,1e3,{trailing:!1});return(o,a)=>{const u=he,p=Pe,T=ye,C=Ue,X=$e,B=A,Y=Le,ee=ze,ae=Ae,te=J,le=Be,ne=be,oe=Q,se=M("no-space");return D(),z(oe,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[t(ne,{ref_key:"formRef",ref:r,model:n.value,"label-placement":"left","label-width":i(d).locale=="en-US"?120:80,"show-feedback":!1,onKeyup:ge(i(l),["enter"])},{default:s(()=>[t(le,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:s(()=>[t(p,{span:"24 s:12 m:8 l:6",label:"审计名称",path:"fuzzy"},{default:s(()=>[P(t(u,{autofocus:"",value:n.value.fuzzy,"onUpdate:value":a[0]||(a[0]=c=>n.value.fuzzy=c),placeholder:"请输入审计名称",clearable:"",onClear:I},null,8,["value"]),[[se]])]),_:1}),t(p,{span:"24 s:12 m:8 l:6",label:i(m)("page.manage.alarm.level"),path:"alevel"},{default:s(()=>[t(T,{filterable:"",clearable:"",placeholder:i(m)("page.manage.alarm.form.level"),value:n.value.alevel,"onUpdate:value":[a[1]||(a[1]=c=>n.value.alevel=c),e],options:i(E)(i(Ie))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),t(p,{span:"24 s:12 m:8 l:6",label:"告警状态",path:"alatype"},{default:s(()=>[t(T,{filterable:"",clearable:"",placeholder:i(m)("page.manage.alarm.form.status"),value:n.value.alatype,"onUpdate:value":[a[2]||(a[2]=c=>n.value.alatype=c),e],options:i(E)(i(Re))},null,8,["placeholder","value","options"])]),_:1}),x.value?(D(),Z(de,{key:0},[t(p,{span:"24 s:12 m:8 l:6",label:"审计类型",path:"atype"},{default:s(()=>[t(T,{value:n.value.atype,"onUpdate:value":[a[3]||(a[3]=c=>n.value.atype=c),e],placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:i(_).data,"reset-menu-on-options-change":!1,onScroll:g},null,8,["value","options"])]),_:1}),t(p,{span:"24 s:12 m:8 l:6",label:"告警策略",path:"apolicy"},{default:s(()=>[t(T,{value:n.value.apolicy,"onUpdate:value":[a[4]||(a[4]=c=>n.value.apolicy=c),e],placeholder:"请选择告警策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:i(k).data,"reset-menu-on-options-change":!1,onScroll:v},null,8,["value","options"])]),_:1}),t(p,{span:"24 s:12 m:12 l:8",label:"时间",path:"timeRange"},{default:s(()=>[t(C,{clearable:"",value:n.value.timeRange,"onUpdate:value":a[5]||(a[5]=c=>n.value.timeRange=c),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":H},null,8,["value"])]),_:1})],64)):fe("",!0),t(p,{span:"24 s:12 m:8 l:6"},{default:s(()=>[t(te,{class:"w-full flex items-center"},{default:s(()=>[t(B,{onClick:N},{icon:s(()=>[t(X,{class:"text-icon"})]),default:s(()=>[S(" "+U(i(m)("common.reset")),1)]),_:1}),t(B,{type:"primary",ghost:"",onClick:i(l)},{icon:s(()=>[t(Y,{class:"text-icon"})]),default:s(()=>[S(" "+U(i(m)("common.search")),1)]),_:1},8,["onClick"]),_e("div",{class:"cursor-pointer",title:"精准查询",onClick:a[6]||(a[6]=c=>x.value=!x.value)},[x.value?(D(),z(ee,{key:0,class:"text-icon"})):(D(),z(ae,{key:1,class:"text-icon"}))])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width","onKeyup"])]),_:1})}}}),Ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!ke(y)}const Fe=q({name:"platformalarm_alarm",__name:"index",setup(y){const L=j(),b=h(window.innerHeight-395),d=K({limit:20,alatype:void 0,aname:void 0,pageId:void 0,alevel:void 0,atype:void 0,apolicy:void 0,startTime:void 0,endTime:void 0,_t:new Date().getTime()}),x=[{type:"selection",align:"center",width:48,fixed:"left"},{key:"aname",title:"审计名称",align:"center",minWidth:120,ellipsis:!0},{key:"alevel",title:"事件级别",align:"center",width:100,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=0);const l={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},o=m(Me[e.alevel]);let a={color:l[e.alevel],textColor:"#ffffff",borderColor:l[e.alevel]};return t(F,{size:"small",color:a},W(o)?o:{default:()=>[o]})}},{key:"pname",title:"审计类型",align:"center",minWidth:120},{key:"pname1",title:"告警策略",align:"center",minWidth:120},{key:"etol",title:"事件总数",align:"center",width:120},{key:"grtime",title:"产生时间",align:"center",width:160},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"alatype",title:m("page.manage.alarm.status"),align:"center",minWidth:120,render:e=>{e.alatype!==1&&(e.alatype=0);const l={0:"error",1:"success"},o=m(Ve[e==null?void 0:e.alatype]);return t(F,{size:"small",type:l[e==null?void 0:e.alatype]},W(o)?o:{default:()=>[o]})}},{key:"operate",title:m("common.operate"),align:"center",width:130,fixed:"right",render:e=>e.alatype===0&&t("div",{class:"flex-center gap-8px"},[t(O,{onPositiveClick:()=>N([e.id])},{default:()=>"确定要确认改数据吗？",trigger:()=>P(t(A,{type:"error",ghost:!0,size:"small"},{default:()=>[S("确认")]}),[[M("no-auth"),"audit.alarm.update"]])})])}],r=h([]),f=h(!1),n=h(0),_=async(e=!1)=>{if(!f.value)f.value=!0;else return;f.value=!0;const{data:l,error:o}=await we(d);o||(n.value=l.length,e?r.value=[...r.value,...l]:r.value=l,f.value=!1)};_();const w=h(!0),$=()=>{r.value=[],d.pageId=void 0,(l=>Object.keys(l).filter(u=>u!=="limit"&&u!=="_t").some(u=>l[u]!==void 0&&l[u]!==""&&l[u]!==null))(d)?w.value=!1:(w.value=!0,k()),_()},g=K({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:l,page:o,pageSize:a,pageCount:u,itemCount:p}){return`已加载${r.value.length}条`+(r.value.length?w.value?` 共计 ${r.value.length>0?p??0:0} 条`:n.value==d.limit?"  预计还有更多":"  没有更多了":"")}});async function k(){const{data:e,error:l}=await Ne();l||(g.pageCount=20,g.total=Number(e),g.itemCount=Number(e))}k();function R(e){var l;e.target.scrollTop+e.target.offsetHeight==e.target.scrollHeight&&g.total>((l=r.value)==null?void 0:l.length)&&V()}const V=ce.debounce(()=>{var e;((e=r.value)==null?void 0:e.length)<g.total&&(d.pageId=r.value[r.value.length-1].id,_(!0))},300),v=h([]),H=e=>{v.value=e},I=()=>{N(v.value),v.value=[]},N=async e=>{var l,o;await Se(e),r.value.forEach(a=>{e.includes(a.id)&&(a.alatype=1)}),(l=window.$message)==null||l.destroyAll(),(o=window.$message)==null||o.success("确认成功")};return(e,l)=>{const o=ie,a=J,u=Te,p=Q,T=M("no-auth");return D(),Z("div",Ke,[t(Ee,{model:d,"onUpdate:model":l[0]||(l[0]=C=>d=C),onSearch:$},null,8,["model"]),t(p,{title:"审计告警",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[t(a,null,{default:s(()=>[t(i(O),{onPositiveClick:I},{trigger:s(()=>[P((D(),z(i(A),{size:"small",ghost:"",type:"primary",disabled:v.value.length==0},{default:s(()=>[S(" 批量确认 ")]),_:1},8,["disabled"])),[[T,"audit.alarm.update"]])]),default:s(()=>[S(" 确定要确认选中的数据吗？ ")]),_:1}),t(i(A),{size:"small",onClick:l[1]||(l[1]=C=>_())},{icon:s(()=>[t(o,{class:xe(["text-icon",{"animate-spin":f.value}])},null,8,["class"])]),default:s(()=>[S(" "+U(i(m)("common.refresh")),1)]),_:1})]),_:1})]),default:s(()=>[t(u,{columns:x,"checked-row-keys":v.value,data:r.value,onUpdateCheckedRowKeys:H,size:"small","flex-height":!i(L).isMobile,"scroll-x":702,loading:f.value,remote:"","row-key":C=>C.id,pagination:g,class:"sm:h-full",onScroll:R,"max-height":b.value,"virtual-scroll":""},null,8,["checked-row-keys","data","flex-height","loading","row-key","pagination","max-height"])]),_:1})])}}}),ia=Ce(Fe,[["__scopeId","data-v-d110596f"]]);export{ia as default};
