import{_ as De}from"./table-column-setting.vue_vue_type_script_setup_true_lang-D0lRqPz4.js";import{_ as Re}from"./round-delete-Dxr52Tdg.js";import{_ as Fe}from"./round-add-CfYkVrv9.js";import{d as J,av as K,at as oe,A as me,E as fe,a as $e,$ as l,D as _e,au as ge,F as V,c as I,o as F,w as s,f as e,bp as ze,M as ne,G as ue,N as ve,h as t,I as O,H as le,ay as ye,c9 as Te,aB as Be,J as H,b as we,aP as Me,b0 as Ie,B as S,g as v,t as P,br as Oe,ca as je,cb as Ve,cc as Ae,aC as qe,L as Ge,bq as Ee,a2 as he,bS as de,e as Le,a4 as be,cd as Ke,c5 as Je,aJ as He,z as Qe,s as ae,aL as E,ax as We,aM as Xe,a3 as Ye,ce as Ze,cf as ea,cg as aa,aD as te,aR as ta}from"./index-DCPTYPg6.js";import{u as sa,a as oa}from"./table-wEqNRbcE.js";import{u as se,d as na}from"./business-lhu-rMxc.js";import{_ as la}from"./round-search-Digdfr9X.js";import{_ as ra}from"./round-refresh-Bsy-Eh7C.js";import{_ as ia}from"./Grid-p0WIMYG_.js";import{_ as ua}from"./FormItemGridItem-C8JcVRRJ.js";import{_ as da}from"./Tree-CSQUpASj.js";import{h as pe}from"./permission-dOyevU_s.js";import{N as ce}from"./Popconfirm-BQoV-jsN.js";const pa=J({name:"OperateDrawer",__name:"operate-drawer",props:K({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(w,{emit:U}){const g=[{label:"是",value:0},{label:"否",value:1}],c=w,x=U,d=oe(w,"visible"),{formRef:h,validate:$,restoreValidation:z}=me(),{createConfirmPwdRule:D,defaultRequiredRule:m,patternRules:i}=fe(),f=$e(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[c.operateType]),n=_e(b());function b(){return{id:void 0,username:"",oripwd:"",password:"",confirmPassword:"",usertype:void 0,superadmin:0,userimage:"",phnum:"",udesc:"",status:0}}const B={username:m,usertype:{type:"string",required:!0,trigger:"change",message:"请选择用户类型"},status:{type:"number",required:!0,trigger:"change",message:"请选择用户状态"},oripwd:{...m,...i.password},password:{...m,...i.password},phnum:{...m,...i.mobile}};async function k(){if(Object.assign(n,b()),c.operateType==="edit"&&c.rowData){const{data:C,error:r}=await je(c.rowData.id);r?Object.assign(n,c.rowData):(Object.assign(n,C),n.usertype=n.usertype+"")}}function T(){d.value=!1}async function j(){var C,r;if(await $(),c.operateType==="add"){const{data:N,error:_}=await Ve(n);_||((C=window.$message)==null||C.success(l("common.addSuccess")),T(),x("submitted"))}else{const{data:N,error:_}=await Ae(n);_||((r=window.$message)==null||r.success(l("common.updateSuccess")),T(),x("submitted"))}}return ge(d,()=>{d.value&&(k(),z())}),(C,r)=>{const N=le,_=ve,R=ye,Q=qe,A=H,M=Be,q=ne,p=S,W=ze,X=Oe,Y=V("no-special");return F(),I(X,{show:d.value,"onUpdate:show":r[8]||(r[8]=a=>d.value=a),"display-directive":"show",width:360},{default:s(()=>[e(W,{title:f.value,"native-scrollbar":!1,closable:""},{footer:s(()=>[e(A,{size:16},{default:s(()=>[e(p,{onClick:T},{default:s(()=>[v(P(t(l)("common.cancel")),1)]),_:1}),e(p,{type:"primary",onClick:j},{default:s(()=>[v(P(t(l)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[e(q,{ref_key:"formRef",ref:h,model:n,rules:B},{default:s(()=>[e(_,{label:t(l)("page.manage.user.username"),path:"username"},{default:s(()=>[O(e(N,{value:n.username,"onUpdate:value":r[0]||(r[0]=a=>n.username=a),placeholder:t(l)("page.manage.user.form.username"),readonly:c.operateType==="edit"},null,8,["value","placeholder","readonly"]),[[Y]])]),_:1},8,["label"]),c.operateType==="add"?(F(),I(_,{key:0,label:t(l)("page.login.common.password"),path:"password"},{default:s(()=>[e(N,{value:n.password,"onUpdate:value":r[1]||(r[1]=a=>n.password=a),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:t(l)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])):ue("",!0),c.operateType==="add"?(F(),I(_,{key:1,label:t(l)("page.login.common.confirmPassword"),path:"confirmPassword",rule:t(D)(n.password)},{default:s(()=>[e(N,{value:n.confirmPassword,"onUpdate:value":r[2]||(r[2]=a=>n.confirmPassword=a),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:t(l)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rule"])):ue("",!0),e(_,{label:"用户类型",path:"usertype"},{default:s(()=>[e(R,{value:n.usertype,"onUpdate:value":r[3]||(r[3]=a=>n.usertype=a),clearable:"",filterable:"",placeholder:"请选择用户类型",options:t(Te)(n.usertype==0?t(se):t(se).slice(1)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(_,{label:"用户状态",path:"status"},{default:s(()=>[e(R,{value:n.status,"onUpdate:value":r[4]||(r[4]=a=>n.status=a),clearable:"",filterable:"",placeholder:"请选择用户类型",options:[{label:"正常",value:0},{label:"异常",value:1}],style:{width:"100%"}},null,8,["value"])]),_:1}),e(_,{label:"是否为我司内部人员",path:"superadmin"},{default:s(()=>[e(M,{value:n.superadmin,"onUpdate:value":r[5]||(r[5]=a=>n.superadmin=a),name:"radiogroup",disabled:""},{default:s(()=>[e(A,null,{default:s(()=>[(F(),we(Me,null,Ie(g,(a,o)=>e(Q,{key:o,value:a.value},{default:s(()=>[v(P(a.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])]),_:1}),e(_,{label:"手机号码",path:"phnum"},{default:s(()=>[e(N,{clearable:"",value:n.phnum,"onUpdate:value":r[6]||(r[6]=a=>n.phnum=a),maxlength:11,placeholder:"请输入手机号码"},null,8,["value"])]),_:1}),e(_,{label:"描述",path:"udesc"},{default:s(()=>[e(N,{type:"textarea",clearable:"",value:n.udesc,"onUpdate:value":r[7]||(r[7]=a=>n.udesc=a),placeholder:"请输入描述",autosize:{minRows:3}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ca=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search"],["update:model"]),setup(w,{emit:U}){const g=U,{formRef:c,restoreValidation:x}=me(),d=oe(w,"model");function h(){d.value.username="",g("search")}async function $(){await x(),d.value.usertype=null,d.value.username="",g("reset")}async function z(){g("search")}const D=i=>{d.value.usertype=i,g("search")},m=()=>{d.value.usertype=null,g("search")};return(i,f)=>{const n=le,b=ua,B=ye,k=ra,T=S,j=la,C=H,r=ia,N=ne,_=he;return F(),I(_,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[e(N,{ref_key:"formRef",ref:c,model:d.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ge(z,["enter"])},{default:s(()=>[e(r,{responsive:"screen","item-responsive":""},{default:s(()=>[e(b,{span:"24 s:12 m:6",label:t(l)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:s(()=>[e(n,{clearable:"",value:d.value.username,"onUpdate:value":f[0]||(f[0]=R=>d.value.username=R),valueModifiers:{trim:!0},placeholder:t(l)("page.manage.user.form.username"),onClear:h},null,8,["value","placeholder"])]),_:1},8,["label"]),e(b,{span:"24 s:12 m:6",label:"用户类型",path:"usertype",class:"pr-24px"},{default:s(()=>[e(B,{value:d.value.usertype,"onUpdate:value":[f[1]||(f[1]=R=>d.value.usertype=R),D],clearable:"",placeholder:"请选择用户类型",onClear:m,options:t(Ee)(t(se))},null,8,["value","options"])]),_:1}),e(b,{span:"24 s:12 m:6",class:"pr-24px"},{default:s(()=>[e(C,{class:"w-full"},{default:s(()=>[e(T,{onClick:$},{icon:s(()=>[e(k,{class:"text-icon"})]),default:s(()=>[v(" "+P(t(l)("common.reset")),1)]),_:1}),e(T,{type:"primary",ghost:"",onClick:z},{icon:s(()=>[e(j,{class:"text-icon"})]),default:s(()=>[v(" "+P(t(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ma=J({name:"assignRoles",__name:"assign-roles",props:K({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(w){const U=w,g=oe(w,"visible");function c(){g.value=!1}const x=de([]),d=async()=>{const{error:m,data:i}=await Je();if(!m){const f=JSON.parse(JSON.stringify(i));x.value=f.list.map(n=>n)}},h=de([]),$=async(m,i,f)=>{var n;h.value=[(n=f.node)==null?void 0:n.id]};async function z(){var m,i,f;if(U.rowData.id){const{data:n,error:b}=await Ke(U.rowData.id,h.value.join(","));b||((m=window.$message)==null||m.destroyAll(),(f=(i=window.$message)==null?void 0:i.success)==null||f.call(i,l("common.modifySuccess")),c())}}function D(){U.rowData.id&&(d(),h.value=[U.rowData.roleId])}return ge(g,m=>{m&&D()}),(m,i)=>{const f=da,n=S,b=H,B=be;return F(),I(B,{show:g.value,"onUpdate:show":i[0]||(i[0]=k=>g.value=k),preset:"card",class:"w-480px"},{header:s(()=>i[1]||(i[1]=[Le("div",{class:"flex"},"设置用户角色",-1)])),footer:s(()=>[e(b,{justify:"end"},{default:s(()=>[e(n,{size:"small",class:"mt-16px",onClick:c},{default:s(()=>[v(P(t(l)("common.cancel")),1)]),_:1}),e(n,{type:"primary",size:"small",class:"mt-16px",onClick:z},{default:s(()=>[v(P(t(l)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[e(f,{cascade:"","checked-keys":h.value,data:x.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"","label-field":"name","key-field":"id","children-field":"children","onUpdate:checkedKeys":$},null,8,["checked-keys","data"])]),_:1},8,["show"])}}}),fa={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function L(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!ta(w)}const Sa=J({name:"manage_user",__name:"index",setup(w){const U=He(),g=Qe(),{columns:c,columnChecks:x,data:d,getData:h,loading:$,mobilePagination:z,searchParams:D,resetSearchParams:m}=sa({apiFn:aa,apiParams:{page:1,pageSize:50,limit:50,username:null,usertype:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"username",title:l("page.manage.user.username"),align:"center",width:160},{key:"usertype",title:"用户类型",align:"center",width:120,render:a=>{const o=l(na[a.usertype]);return e(te,{type:"primary"},L(o)?o:{default:()=>[o]})}},{key:"phnum",title:"手机号码",align:"center",width:160},{key:"nickname",title:"绑定微信信息",width:270,render(a){return e("div",{style:"text-align: left; line-height: 1.4;"},[e("div",{style:"font-size: 14px; color: #666;"},[v("微信昵称："),e("span",{style:"color: #333; font-weight: 500;"},[a.nickname||"-"])]),e("div",{style:"margin-top: 4px; font-size: 14px; color: #666;"},[v("绑定时间："),e("span",{style:"color: #333; font-weight: 500;"},[a.dbtime||"-"])])])}},{key:"udesc",title:"描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"status",title:l("page.manage.user.status"),align:"center",width:120,render:a=>(a.status===null?a.status=0:(a.status===2||a.status===3)&&(a.status=1),e(te,{type:a.status==0?"success":a.status==1?"error":a.status==2?"warning":"success"},{default:()=>[a.status==0?"正常":a.status==1?"异常":a.status==2?"锁定":"正常"]}))},{key:"superadmin",title:"是否为我司内部人员",align:"center",width:160,render:a=>{const o=a.superadmin===0?"是":a.superadmin===1?"否":"未知",y=a.superadmin===0?"success":a.superadmin===1?"error":"default";return e(te,{type:y},L(o)?o:{default:()=>[o]})}},{key:"createdate",title:l("page.manage.user.createDate"),align:"center",width:180},{key:"operate",title:l("common.operate"),align:"center",fixed:"right",width:pe("sys:user:update")||pe("sys:user:delete")?320:0,render:a=>{let o;return e("div",{class:"flex-center gap-8px"},[O(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>N(a.id)},L(o=l("common.edit"))?o:{default:()=>[o]}),[[V("no-auth"),"sys:user:update"]]),g.userInfo.usertype==0&&O(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>X(a)},{default:()=>["修改密码"]}),[[V("no-auth"),"sys:user:update"]]),a.superadmin!=0&&e(ce,{onPositiveClick:()=>r(a.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let y;return O(e(S,{type:"error",ghost:!0,size:"small"},L(y=l("common.delete"))?y:{default:()=>[y]}),[[V("no-auth"),"sys:user:delete"]])}})])}}]}),{drawerVisible:i,operateType:f,editingData:n,handleAdd:b,handleEdit:B,checkedRowKeys:k,onBatchDeleted:T,onDeleted:j}=oa(d,h);async function C(){console.log(k.value),_(k.value,a=>{T()})}function r(a){_([a],o=>{j()})}function N(a){B(a)}async function _(a,o){const y=await Ze(a);console.log("data",y),o&&o(y)}const R=ae(!1),{defaultRequiredRule:Q,patternRules:A}=fe(),M=ae(!1),q=ae(),p=_e({username:"",password:"",confirmPassword:"",id:null}),W={password:[Q,A.password],confirmPassword:[{required:!0,message:l("form.confirmPwd.required")},{asyncValidator:(a,o)=>o.trim()!==""&&o!==p.password?Promise.reject(a.message):Promise.resolve(),message:l("form.confirmPwd.invalid"),trigger:"input"}]},X=a=>{M.value=!0,p.id=a.id,p.username=a.username,p.password="",p.confirmPassword=""},Y=async()=>{var y,G;if(!p.id)return;await((y=q.value)==null?void 0:y.validate());const{data:a,error:o}=await ea(p.username,p.id,p.password);o||((G=window.$message)==null||G.success("修改成功"),M.value=!1)};return(a,o)=>{const y=Fe,G=Re,ke=De,re=H,xe=We,Ne=he,Z=le,ee=ve,Pe=ne,Ue=Ye,Ce=be,ie=V("no-auth");return F(),we("div",fa,[e(ca,{model:t(D),"onUpdate:model":o[0]||(o[0]=u=>E(D)?D.value=u:null),onReset:t(m),onSearch:t(h)},null,8,["model","onReset","onSearch"]),e(Ne,{title:t(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[e(re,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[O((F(),I(t(S),{onClick:t(b),size:"small",ghost:"",type:"primary"},{icon:s(()=>[e(y,{class:"text-icon"})]),default:s(()=>[o[10]||(o[10]=v(" "+P("新增")))]),_:1,__:[10]},8,["onClick"])),[[ie,"sys:user:insert"]]),e(t(ce),{onPositiveClick:C},{trigger:s(()=>[O((F(),I(t(S),{size:"small",ghost:"",type:"error",disabled:t(k).length==0},{icon:s(()=>[e(G,{class:Xe(["text-icon",{"animate-spin":t($)}])},null,8,["class"])]),default:s(()=>[o[11]||(o[11]=v(" "+P("批量删除")))]),_:1,__:[11]},8,["disabled"])),[[ie,"sys:user:delete"]])]),default:s(()=>[o[12]||(o[12]=v(" 确定要删除选中的吗？ "))]),_:1,__:[12]}),e(ke,{columns:t(x),"onUpdate:columns":o[1]||(o[1]=u=>E(x)?x.value=u:null),ctype:9},null,8,["columns"])]),_:1})]),default:s(()=>[e(xe,{"checked-row-keys":t(k),"onUpdate:checkedRowKeys":o[2]||(o[2]=u=>E(k)?k.value=u:null),columns:t(c),data:t(d),size:"small","flex-height":!t(U).isMobile,"scroll-x":t(c).reduce((u,Se)=>u+(Se.width||100),0),loading:t($),remote:"","row-key":u=>u.id,pagination:t(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(pa,{visible:t(i),"onUpdate:visible":o[3]||(o[3]=u=>E(i)?i.value=u:null),"operate-type":t(f),"row-data":t(n),onSubmitted:t(h)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(ma,{"row-data":t(n),visible:R.value,"onUpdate:visible":o[4]||(o[4]=u=>R.value=u)},null,8,["row-data","visible"])]),_:1},8,["title"]),e(Ce,{show:M.value,"onUpdate:show":o[9]||(o[9]=u=>M.value=u),title:t(l)("common.updatePassword"),preset:"card",class:"w-620px"},{footer:s(()=>[e(re,{justify:"end",size:16},{default:s(()=>[e(t(S),{onClick:o[8]||(o[8]=u=>M.value=!1)},{default:s(()=>[v(P(t(l)("common.cancel")),1)]),_:1}),e(t(S),{type:"primary",onClick:Y},{default:s(()=>[v(P(t(l)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[e(Ue,{class:"max-h-480px pr-20px"},{default:s(()=>[e(Pe,{ref_key:"formRef",ref:q,model:p,rules:W,"label-placement":"left","label-width":100,"require-mark-placement":"left"},{default:s(()=>[e(ee,{label:t(l)("page.manage.user.username"),path:"username"},{default:s(()=>[e(Z,{readonly:"",value:p.username,"onUpdate:value":o[5]||(o[5]=u=>p.username=u),placeholder:t(l)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(ee,{label:t(l)("page.login.common.password"),path:"password"},{default:s(()=>[e(Z,{type:"password","show-password-on":"click",clearable:"",value:p.password,"onUpdate:value":o[6]||(o[6]=u=>p.password=u),placeholder:t(l)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(ee,{label:t(l)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:s(()=>[e(Z,{type:"password","show-password-on":"click",clearable:"",value:p.confirmPassword,"onUpdate:value":o[7]||(o[7]=u=>p.confirmPassword=u),placeholder:t(l)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])])}}});export{Sa as default};
