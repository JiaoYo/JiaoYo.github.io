import{c4 as u,d as G,aq as x,s as I,q as A,a as J,ar as E,a1 as H,c as v,o as _,w as s,f as l,F as K,y as N,z as Q,h as d,at as W,e as X,t as j,A as b,N as Y,B as z,g as C,$ as S,b6 as Z}from"./index-CLRi5FH8.js";import{f as ee}from"./project-COZa6i1y.js";import{u as te}from"./usePageData-CkKoM9lp.js";import{v as ae}from"./v4-FuVw324d.js";function fe(a){return u({url:"/projectDailyReport/getPage.do",method:"get",params:a})}function oe(a){return u({url:"/projectDailyReport/insert.do",method:"post",data:a})}function re(a){return u({url:"/projectDailyReport/getIdByUuid.do",method:"get",params:a})}function le(a){return u({url:"/projectDailyReport/update.do",method:"put",data:a})}function be(a){return u({url:"/projectDailyReport/delete.do",method:"delete",params:{arrIds:a}})}function se(a){return u({url:"/projectDaily/insert.do",method:"post",data:a})}function ge(a){return u({url:"/projectComment/getPage.do",method:"get",params:a})}function ye(a){return u({url:"/projectComment/insert.do",method:"post",data:a})}function he(a){return u({url:"/projectComment/delete.do",method:"delete",params:{arrIds:a}})}const ve=G({name:"OperateDrawer",__name:"operate-drawer",props:x({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:x(["submitted"],["update:visible"]),setup(a,{emit:T}){const w=T,{pageData:p,getData:L,nextPage:U}=te(ee),B=async o=>{const t=o.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&p.data.length<p.total&&U()},i=a,e=I(D());function D(){return{id:"",proname:"",notes:"",problem:"",solutions:"",feedback:"",summarize:"",pids:[]}}const R={notes:{required:!0,message:"请输入",trigger:"blur"},pids:{type:"array",required:!0,message:"请选择",trigger:"blur"}};async function q(){if(await L(),Object.assign(e,D()),i.pid&&(p.data.forEach(o=>{o.id==i.pid&&(o.disabled=!0)}),e.pids.push(i.pid)),i.operateType==="edit"&&i.rowData){Object.assign(e,i.rowData);const o=JSON.parse(i.rowData.context);e.proname=o.proname,e.notes=o.notes,e.problem=o.problem,e.solutions=o.solutions,e.feedback=o.feedback,e.summarize=o.summarize}}const{formRef:M,validate:O,restoreValidation:V}=A(),$=J(()=>({add:"新增项目日报",edit:"修改项目日报"})[i.operateType]),c=E(a,"visible"),y=()=>{c.value=!1},F=async()=>{var o,t;if(await O(),i.operateType==="edit"){const n=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:g,error:m}=await le([{context:n,id:e.id}]);m||((o=window.$message)==null||o.success("修改成功"),w("submitted"),y())}else{const n=ae(),g=p.data.filter(f=>e.pids.includes(f.id)).map(f=>f.proname);e.proname=g.join(",");const m=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:k,error:r}=await oe([{context:m,uuid:n}]);if(!r){const{data:f,error:ne}=await re({uuid:n});let P=e.pids.map(h=>({pid:h}));P.forEach(h=>{h.did=f});const{data:ie,error:de}=await se(P);(t=window.$message)==null||t.success("添加成功"),w("submitted"),y()}}};return H(c,()=>{c.value&&(q(),setTimeout(()=>{const o=document.querySelector(".n-scrollbar-content");o==null||o.scrollTo(0,0)},300),V())}),(o,t)=>{const n=Q,g=K,m=Y,k=Z;return _(),v(k,{show:c.value,"onUpdate:show":t[6]||(t[6]=r=>c.value=r),title:$.value,preset:"card",class:"w-570px"},{footer:s(()=>[l(m,{justify:"end"},{default:s(()=>[l(d(z),{size:"small",class:"mt-16px",onClick:y},{default:s(()=>[C(j(d(S)("common.cancel")),1)]),_:1}),l(d(z),{type:"primary",size:"small",class:"mt-16px",onClick:F},{default:s(()=>[C(j(d(S)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(g,{ref_key:"formRef",ref:M,model:e,rules:R},{default:s(()=>[i.operateType==="add"?(_(),v(n,{key:0,label:"关联项目",path:"pids","label-placement":"left"},{default:s(()=>[l(d(W),{clearable:"",filterable:"",value:e.pids,"onUpdate:value":t[0]||(t[0]=r=>e.pids=r),placeholder:"请选择项目","label-field":"proname",multiple:"","value-field":"id",options:d(p).data,onScroll:B},null,8,["value","options"])]),_:1})):N("",!0),i.operateType==="edit"?(_(),v(n,{key:1,label:"项目名称",path:"proname","label-placement":"left"},{default:s(()=>[X("span",null,j(e.proname),1)]),_:1})):N("",!0),l(n,{label:"当前工作内容及成果描述",path:"notes"},{default:s(()=>[l(d(b),{clearable:"",type:"textarea",value:e.notes,"onUpdate:value":t[1]||(t[1]=r=>e.notes=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"遇到问题",path:"problem"},{default:s(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.problem,"onUpdate:value":t[2]||(t[2]=r=>e.problem=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"解决措施",path:"solutions"},{default:s(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.solutions,"onUpdate:value":t[3]||(t[3]=r=>e.solutions=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"建议意见反馈",path:"feedback"},{default:s(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.feedback,"onUpdate:value":t[4]||(t[4]=r=>e.feedback=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{default:s(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.summarize,"onUpdate:value":t[5]||(t[5]=r=>e.summarize=r),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}});export{ve as _,ge as a,he as b,fe as c,be as d,ye as f};
