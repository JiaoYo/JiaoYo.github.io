import{_ as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-3WFkccas.js";import{d as E,q as G,s as W,v as Y,x as me,b as fe,r as _e,y as ge,K as j,o as J,c as ee,w as n,g as e,h as B,t as F,i as o,$ as _,M as te,L as O,A as ae,C as he,X as oe,D as ne,B as q,E as le,aa as ye,ab as ve,J as be,a9 as se,Z as we,j as X,e as Se,ac as V,ad as xe,S as De,F as Ce,ay as ke}from"./index-Ddi2sB0k.js";import{u as Te,a as Ne}from"./table-BPjc3v9J.js";import{q as re,r as ce,s as Me,t as ze,u as Ue,v as Re}from"./Collection-De4qlwIC.js";import{u as I}from"./usePageData-CZxRXUFA.js";import{_ as Le}from"./round-search-C_65O74k.js";import{_ as Pe}from"./round-refresh-yoRg4w0p.js";import{_ as Ae}from"./FormItemGridItem-Doopd_q6.js";import{_ as $e}from"./Grid-BNlat6r7.js";import{h as Z}from"./permission-Dn1j-x2l.js";import{_ as Be}from"./Popconfirm-DSMr_7Fc.js";import{_ as Fe}from"./DataTable-C6XgD3bf.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DNcfHKva.js";import"./setting-outlined-Cy2HY943.js";import"./round-delete-CvMTF8iX.js";import"./refresh-UThiTZoh.js";import"./round-plus-BCEww8i6.js";import"./Upload-CeGwRy84.js";import"./Progress-BrPKcu_X.js";import"./Forward-CbtUBMk5.js";const He=E({name:"OperateDrawer",__name:"operate-drawer",props:G({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:G(["submitted"],["update:visible"]),setup(g,{emit:M}){const d=g,y=M,f=W(g,"visible"),{formRef:c,validate:D,restoreValidation:z}=Y(),{createConfirmPwdRule:C,defaultRequiredRule:U,patternRules:S}=me(),x=fe(()=>({add:"新增日志源设备",edit:"编辑日志源设备"})[d.operateType]),i=_e(k());function k(){return{id:void 0,manu:null,category:null,type:"",sysparam:void 0,ldesc:""}}const R={type:U,category:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源类别"},manu:{type:"number",required:!0,trigger:["blur","change"],message:"请选择厂商"}},{pageData:p,getData:L,nextPage:P}=I(re),H=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&p.data.length<p.total&&P()},{pageData:u,getData:r,nextPage:A}=I(ce),v=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&u.data.length<u.total&&A()};function T(){L(),r(),Object.assign(i,k()),d.operateType==="edit"&&d.rowData&&Object.assign(i,d.rowData)}function b(){f.value=!1}async function l(){var a,t;if(await D(),d.operateType==="add"){const{data:w,error:m}=await Me([i]);m||((a=window.$message)==null||a.success(_("common.addSuccess")),b(),y("submitted"))}else{const{data:w,error:m}=await ze([i]);m||((t=window.$message)==null||t.success(_("common.updateSuccess")),b(),y("submitted"))}}return ge(f,()=>{f.value&&(T(),z())}),(a,t)=>{const w=ae,m=he,N=oe,$=ne,s=q,K=le,ie=ye,ue=ve,de=j("no-space");return J(),ee(ue,{show:f.value,"onUpdate:show":t[4]||(t[4]=h=>f.value=h),"display-directive":"show",width:360},{default:n(()=>[e(ie,{title:x.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(K,{size:16},{default:n(()=>[e(s,{onClick:b},{default:n(()=>[B(F(o(_)("common.cancel")),1)]),_:1}),e(s,{type:"primary",onClick:l},{default:n(()=>[B(F(o(_)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e($,{ref_key:"formRef",ref:c,model:i,rules:R,onKeyup:te(l,["entep"])},{default:n(()=>[e(m,{label:"日志源类型",path:"type"},{default:n(()=>[O(e(w,{clearable:"",value:i.type,"onUpdate:value":t[0]||(t[0]=h=>i.type=h),placeholder:"请输入日志源类型"},null,8,["value"]),[[de]])]),_:1}),e(m,{label:"日志源类别",path:"category"},{default:n(()=>[e(N,{clearable:"",filterable:"",value:i.category,"onUpdate:value":t[1]||(t[1]=h=>i.category=h),placeholder:"请选择日志源类别",options:o(p).data,"reset-menu-on-options-change":!1,onScroll:H,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"厂商",path:"manu"},{default:n(()=>[e(N,{clearable:"",filterable:"",value:i.manu,"onUpdate:value":t[2]||(t[2]=h=>i.manu=h),placeholder:"请选择厂商",options:o(u).data,"value-field":"id","label-field":"mname",onScroll:v,"reset-menu-on-options-change":!1,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"描述",path:"ldesc"},{default:n(()=>[e(w,{type:"textarea",value:i.ldesc,"onUpdate:value":t[3]||(t[3]=h=>i.ldesc=h),placeholder:"请输入备注",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ve=E({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:G(["reset","search"],["update:model"]),setup(g,{emit:M}){const d=M,{formRef:y,restoreValidation:f}=Y(),c=W(g,"model");function D(u){c.value.category=u,d("search")}function z(u){c.value.manu=u,d("search")}function C(){c.value.fuzzy="",d("search")}async function U(){await f(),d("reset")}async function S(){d("search")}const{pageData:x,getData:i,nextPage:k}=I(re),R=async u=>{const r=u.currentTarget;r.scrollTop+r.offsetHeight>=r.scrollHeight&&x.data.length<x.total&&k()},{pageData:p,getData:L,nextPage:P}=I(ce),H=async u=>{const r=u.currentTarget;r.scrollTop+r.offsetHeight>=r.scrollHeight&&p.data.length<p.total&&P()};return be(()=>{i(),L()}),(u,r)=>{const A=ae,v=Ae,T=oe,b=Pe,l=q,a=Le,t=le,w=$e,m=ne,N=se,$=j("no-space");return J(),ee(N,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(m,{ref_key:"formRef",ref:y,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(S,["enter"])},{default:n(()=>[e(w,{responsive:"screen","item-responsive":""},{default:n(()=>[e(v,{span:"24 s:12 m:6",label:"日志源类型",path:"fuzzy",class:"pr-24px"},{default:n(()=>[O(e(A,{clearable:"",value:c.value.fuzzy,"onUpdate:value":r[0]||(r[0]=s=>c.value.fuzzy=s),placeholder:"请输入日志源类型关键字",onClear:C},null,8,["value"]),[[$]])]),_:1}),e(v,{span:"24 s:12 m:6",label:"厂商",path:"manu",class:"pr-24px"},{default:n(()=>[e(T,{clearable:"",filterable:"",value:c.value.manu,"onUpdate:value":r[1]||(r[1]=s=>c.value.manu=s),placeholder:"请选择厂商",options:o(p).data,"value-field":"id","label-field":"mname",onScroll:H,onUpdateValue:z,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"日志源类别",path:"category",class:"pr-24px"},{default:n(()=>[e(T,{clearable:"",filterable:"",value:c.value.category,"onUpdate:value":r[2]||(r[2]=s=>c.value.category=s),placeholder:"请选择日志源类别",options:o(x).data,onScroll:R,onUpdateValue:D,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{span:"24  s:12 m:6",class:"pr-24px"},{default:n(()=>[e(t,{class:"w-full"},{default:n(()=>[e(l,{onClick:U},{icon:n(()=>[e(b,{class:"text-icon"})]),default:n(()=>[B(" "+F(o(_)("common.reset")),1)]),_:1}),e(l,{type:"primary",ghost:"",onClick:S},{icon:n(()=>[e(a,{class:"text-icon"})]),default:n(()=>[B(" "+F(o(_)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),je={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function Q(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!xe(g)}const Oe=E({name:"collectionmanagement_logsource",__name:"index",setup(g){const M=we(),{columns:d,columnChecks:y,data:f,getData:c,loading:D,mobilePagination:z,searchParams:C,resetSearchParams:U}=Te({apiFn:Ue,apiParams:{page:1,pageSize:20,limit:20,fuzzy:void 0,category:void 0,manu:void 0,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48,disabled(l){return l.sysparam!==1}},{key:"mname",title:"厂商",align:"center",width:240},{key:"cname",title:"日志源类别",align:"center",width:240},{key:"type",title:"日志源类型",align:"center",width:240},{key:"ldesc",title:"描述",align:"center",width:500,render:l=>e("span",{class:"text-ellipsis",onClick:()=>{u.value=l.ldesc,r.value=!0},style:{display:"block",width:"100%"}},[l.ldesc])},{key:"operate",title:_("common.operate"),align:"center",width:130,render:l=>{let a;return l.sysparam==1&&e("div",{class:"flex-center gap-8px"},[O(e(q,{type:"primary",ghost:!0,size:"small",onClick:()=>T(l.id)},Q(a=_("common.edit"))?a:{default:()=>[a]}),[[j("no-auth"),"sys.log.source.device.update"]]),e(Be,{onPositiveClick:()=>v(l.id)},{default:()=>_("common.confirmDelete"),trigger:()=>{let t;return O(e(q,{type:"error",ghost:!0,size:"small"},Q(t=_("common.delete"))?t:{default:()=>[t]}),[[j("no-auth"),"sys.log.source.device.delete"]])}})])}}]}),{drawerVisible:S,operateType:x,editingData:i,handleAdd:k,handleEdit:R,checkedRowKeys:p,onBatchDeleted:L,onDeleted:P,closeDrawer:H}=Ne(f,c),u=X(""),r=X(!1);async function A(){console.log(p.value),b(p.value.join(","),l=>{L()})}function v(l){console.log(l),b(l,a=>{P()})}function T(l){R(l)}async function b(l,a){const t=await Re(l);a&&a(t)}return(l,a)=>{const t=pe,w=Fe,m=De,N=Ce,$=se;return J(),Se("div",je,[e(Ve,{model:o(C),"onUpdate:model":a[0]||(a[0]=s=>V(C)?C.value=s:null),onReset:o(U),onSearch:o(c)},null,8,["model","onReset","onSearch"]),e($,{title:"日志源设备",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":n(()=>[e(t,{columns:o(y),"onUpdate:columns":a[1]||(a[1]=s=>V(y)?y.value=s:null),"disabled-delete":o(p).length===0,"is-view-add-button":o(Z)("sys.log.source.device.insert"),"is-view-delete-button":o(Z)("sys.log.source.device.delete"),loading:o(D),onAdd:o(k),onDelete:A,onRefresh:o(c)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:n(()=>[e(w,{"checked-row-keys":o(p),"onUpdate:checkedRowKeys":a[2]||(a[2]=s=>V(p)?p.value=s:null),columns:o(d),data:o(f),size:"small","flex-height":!o(M).isMobile,"scroll-x":o(d).reduce((s,K)=>s+K.width,0),loading:o(D),remote:"","row-key":s=>s.id,pagination:o(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(He,{visible:o(S),"onUpdate:visible":a[3]||(a[3]=s=>V(S)?S.value=s:null),"operate-type":o(x),"row-data":o(i),onSubmitted:o(c)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(N,{show:r.value,"onUpdate:show":a[4]||(a[4]=s=>r.value=s),title:"描述",preset:"card",class:"w-600px"},{default:n(()=>[e(m,{style:{"max-height":"300px"}},{default:n(()=>[B(F(u.value),1)]),_:1})]),_:1},8,["show"])]),_:1})])}}}),it=ke(Oe,[["__scopeId","data-v-ac942f0f"]]);export{it as default};
