import{_ as H}from"./round-plus-zqxfLO2L.js";import{_ as Q}from"./round-search-CMwyc___.js";import{_ as Y}from"./round-refresh-hHhFfqfD.js";import{d as ee,Z as te,j as $,r as f,$ as p,g as t,L as m,K as D,B as _,J as ne,o as S,e as oe,w as o,i,h,t as w,c as ae,ad as se,X as le,A as re,E as ie,D as ce,a9 as pe,C as ue,aa as de,ab as me,ay as _e}from"./index-ClKiVTJI.js";import{f as fe,a as ve,c as ge,d as ye,e as he}from"./common-HTDQMOxS.js";import{_ as we}from"./Popconfirm-DggMJhcu.js";import{_ as be}from"./FormItemGridItem-OIGZ-ZEg.js";import{_ as xe}from"./Grid-D0xzNjlx.js";import{_ as Ce}from"./DataTable-W6X70lwR.js";import"./Forward-CgMA_ruy.js";const De={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function E(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!se(b)}const ze=ee({name:"eventalarm_eventtype",__name:"index",setup(b){const F=te(),v=$(!1),d=$(!1),u=f({fuzzy:"",pid:null}),l=f({pid:null,pname:null,id:null}),I=f({pid:{type:"number",required:!0,message:"请选择事件类别",trigger:["blur","change"]},pname:{type:"string",required:!0,message:"请输入事件类型",trigger:["blur","change"]}}),c=f({eventsCategoryDataList:[],eventsTypeDataList:[]}),A=f({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:n,endIndex:e,page:a,pageSize:s,pageCount:y,itemCount:x}){return`${c.eventsTypeDataList.length}条`}}),B=f([{key:"pid",title:"事件类别",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:n=>{var a;return(a=c.eventsCategoryDataList.find(s=>s.id===n.pid))==null?void 0:a.pname}},{key:"pname",title:"事件类型",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"operate",title:p("common.operate"),align:"center",width:160,render:n=>{let e;return n.sysparam!=0?t("div",{class:"flex-center gap-8px"},[m(t(_,{type:"primary",ghost:!0,size:"small",onClick:()=>V(n)},E(e=p("common.edit"))?e:{default:()=>[e]}),[[D("no-auth"),"event.type.update"]]),t(we,{onPositiveClick:()=>R(n.id)},{default:()=>p("common.confirmDelete"),trigger:()=>{let a;return m(t(_,{type:"error",ghost:!0,size:"small"},E(a=p("common.delete"))?a:{default:()=>[a]}),[[D("no-auth"),"event.type.delete"]])}})]):null}}]);ne(()=>{U(),g()});async function U(){try{const{data:n,error:e}=await fe();e||(c.eventsCategoryDataList=n)}catch(n){console.error("Failed to fetch event categories:",n)}}async function g(){try{v.value=!0;const{data:n,error:e}=await ve();e||(c.eventsTypeDataList=n)}catch(n){console.error("Failed to fetch event types:",n)}finally{v.value=!1}}const j=()=>{d.value=!0},G=async()=>{var n,e;try{if(l.id){const{data:a,error:s}=await he([l]);s||((e=window.$message)==null||e.success("修改成功"),d.value=!1,g())}else{const{data:a,error:s}=await ye([{pname:l.pname,pid:l.pid}]);s||((n=window.$message)==null||n.success("添加成功"),d.value=!1,g())}}catch(a){console.error("Failed to submit event type:",a)}},O=()=>{d.value=!1,l.pid=null,l.pname=null},R=async n=>{var e;try{const{data:a,error:s}=await ge({ids:n});s||((e=window.$message)==null||e.success("删除成功"),g())}catch(a){console.error("Failed to delete event type:",a)}},V=n=>{d.value=!0,Object.assign(l,n)},q=()=>{u.fuzzy=null,u.pid=null,z()},z=()=>{v.value=!0;const{fuzzy:n,pid:e}=u;if(!n&&!e){g();return}const a=c.eventsTypeDataList.filter(s=>{const y=e?s.pid===e:!0,x=n?s.pname.toLowerCase().includes(n.toLowerCase()):!0;return y&&x});c.eventsTypeDataList=a,v.value=!1};return(n,e)=>{const a=le,s=be,y=re,x=Y,M=Q,L=ie,W=xe,k=ce,T=pe,J=H,K=Ce,N=ue,P=de,X=me,C=D("no-space"),Z=D("no-auth");return S(),oe("div",De,[t(T,{title:"",bordered:!1,size:"small"},{header:o(()=>[t(k,{ref:"formRef",model:u,"label-placement":"left","label-width":100,"show-feedback":!1},{default:o(()=>[t(W,{responsive:"screen","item-responsive":""},{default:o(()=>[t(s,{span:"24 s:12 m:6",label:"类别",path:"pid",class:"pr-24px"},{default:o(()=>[m(t(a,{clearable:"",value:u.pid,"onUpdate:value":[e[0]||(e[0]=r=>u.pid=r),z],placeholder:"请选择事件类别",options:c.eventsCategoryDataList,"reset-menu-on-options-change":!1,"value-field":"id","label-field":"pname"},null,8,["value","options"]),[[C]])]),_:1}),t(s,{span:"24 s:12 m:6",label:"类型",path:"fuzzy",class:"pr-24px"},{default:o(()=>[m(t(y,{value:u.fuzzy,"onUpdate:value":e[1]||(e[1]=r=>u.fuzzy=r),placeholder:"请输入事件类型"},null,8,["value"]),[[C]])]),_:1}),t(s,{span:"24 m:12",class:"pr-24px"},{default:o(()=>[t(L,{class:"w-full"},{default:o(()=>[t(i(_),{onClick:q},{icon:o(()=>[t(x,{class:"text-icon"})]),default:o(()=>[h(" "+w(i(p)("common.reset")),1)]),_:1}),t(i(_),{type:"primary",ghost:"",onClick:z},{icon:o(()=>[t(M,{class:"text-icon"})]),default:o(()=>[h(" "+w(i(p)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(T,{title:"事件类型",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[m((S(),ae(i(_),{size:"small",ghost:"",type:"primary",onClick:j},{icon:o(()=>[t(J,{class:"text-icon"})]),default:o(()=>[h(" "+w(i(p)("common.add")),1)]),_:1})),[[Z,"event.type.insert"]])]),default:o(()=>[t(K,{columns:B,data:c.eventsTypeDataList,size:"small",pagination:A,"flex-height":!i(F).isMobile,"scroll-x":962,loading:v.value,remote:"","row-key":r=>r.id,class:"sm:h-full"},null,8,["columns","data","pagination","flex-height","loading","row-key"])]),_:1}),t(X,{show:d.value,"onUpdate:show":e[4]||(e[4]=r=>d.value=r),"display-directive":"show",width:300},{default:o(()=>[t(P,{title:l.id?"编辑":"添加","native-scrollbar":!1,closable:""},{footer:o(()=>[t(L,{size:16},{default:o(()=>[t(i(_),{onClick:O},{default:o(()=>[h(w(i(p)("common.cancel")),1)]),_:1}),t(i(_),{type:"primary",onClick:G},{default:o(()=>[h(w(i(p)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[t(k,{ref:"formRef",model:l,rules:I},{default:o(()=>[t(N,{label:"事件类别",path:"pid"},{default:o(()=>[m(t(a,{clearable:"",value:l.pid,"onUpdate:value":e[2]||(e[2]=r=>l.pid=r),placeholder:"请选择事件类别",options:c.eventsCategoryDataList,"reset-menu-on-options-change":!1,"value-field":"id","label-field":"pname"},null,8,["value","options"]),[[C]])]),_:1}),t(N,{label:"事件类型",path:"pname"},{default:o(()=>[m(t(y,{value:l.pname,"onUpdate:value":e[3]||(e[3]=r=>l.pname=r),placeholder:"请输入事件类型"},null,8,["value"]),[[C]])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])])}}}),Be=_e(ze,[["__scopeId","data-v-81554709"]]);export{Be as default};
