import{_ as ze}from"./table-column-setting.vue_vue_type_script_setup_true_lang-D0lRqPz4.js";import{_ as $e}from"./round-delete-Dxr52Tdg.js";import{_ as Se}from"./round-add-CfYkVrv9.js";import{d as te,av as X,D as pe,A as ue,a as Re,at as ce,au as Le,aK as je,d2 as qe,d3 as Pe,s as V,c as C,o as m,w as t,f as e,a3 as de,M as le,h as n,H as R,ay as me,b as G,G as K,g as v,e as D,t as _,az as Fe,B as N,aA as Me,J as ae,$,a4 as fe,aG as Te,bm as Be,L as Ie,a2 as ve,aJ as Oe,E as Ve,F as ee,aL as Q,ax as Ee,I as W,aM as Ae,N as Ge,d4 as Ke,d5 as se,Q as Je,d6 as He,d7 as Qe,aR as We}from"./index-DCPTYPg6.js";import{u as Xe,a as Ye}from"./table-wEqNRbcE.js";import{_ as _e}from"./Grid-p0WIMYG_.js";import{_ as ge}from"./FormItemGridItem-C8JcVRRJ.js";import{_ as Ze}from"./round-search-Digdfr9X.js";import{_ as et}from"./round-refresh-Bsy-Eh7C.js";import{N as re}from"./Popconfirm-BQoV-jsN.js";const tt={key:0,style:{"margin-left":"20px"}},lt={key:0,style:{"margin-left":"20px"}},at={key:0,style:{"margin-left":"20px"}},nt={key:0,style:{"margin-left":"20px"}},ot=te({name:"OperateDrawer",__name:"operate-drawer",props:X({operateType:{},rowData:{},provinceList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(z,{emit:E}){const M=E,y=z,l=pe(T());function T(){return{id:"",dname:"",dcon:"",province:null,region:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}async function h(){Object.assign(l,T()),y.operateType==="edit"&&y.rowData&&Object.assign(l,y.rowData)}const{formRef:B,validate:S,restoreValidation:I}=ue(),F={dname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},province:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dcon:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},region:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},O=Re(()=>({add:"新增调度",edit:"修改调度"})[y.operateType]),g=ce(z,"visible");Le(g,()=>{g.value&&(h(),setTimeout(()=>{const r=document.querySelector(".n-scrollbar-content");r==null||r.scrollTo(0,0)},300),I())});function L(){g.value=!1}const j=je.debounce(async()=>{var r,a;if(await S(),y.operateType==="edit"){const{data:p,error:c}=await qe([l]);c||(L(),M("submitted"),(r=window.$message)==null||r.success("修改成功"))}else{const{data:p,error:c}=await Pe([{...l}]);c||(L(),M("submitted"),(a=window.$message)==null||a.success("添加成功"))}},1e3,{leading:!0,trailing:!0}),u=V(0),f=V("");async function w({file:r},a){u.value=0,f.value=a;const p=await Te(r.file,r.name,"",c=>{u.value=c});p&&(l[a]=p,u.value=0)}async function q(r){var a;return r.file.file.size>100*1024*1024?((a=window.$message)==null||a.error("文件大小不能超过100M"),!1):!0}async function P(r){if(r)try{const p=await(await fetch(r==null?void 0:r.split("?")[0],{mode:"cors"})).blob(),c=URL.createObjectURL(p),x=document.createElement("a");x.href=c,x.download=r==null?void 0:r.split("?")[1],x.style.display="none",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(c)}catch(a){console.error("下载失败:",a)}}return(r,a)=>{const p=ge,c=Fe,x=Me,J=_e,A=le,U=de,H=ae,Y=fe;return m(),C(Y,{show:g.value,"onUpdate:show":a[16]||(a[16]=s=>g.value=s),title:O.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:t(()=>[e(H,{justify:"end",size:16},{default:t(()=>[e(n(N),{onClick:L},{default:t(()=>[v(_(n($)("common.cancel")),1)]),_:1}),e(n(N),{type:"primary",onClick:n(j)},{default:t(()=>[v(_(n($)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(U,{class:"pr-20px"},{default:t(()=>[e(A,{ref_key:"formRef",ref:B,model:l,rules:F,"label-placement":"left","label-width":120},{default:t(()=>[e(J,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 m:12",label:"主站名称",path:"dname"},{default:t(()=>[e(n(R),{value:l.dname,"onUpdate:value":a[0]||(a[0]=s=>l.dname=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"主站联系方式",path:"dcon"},{default:t(()=>[e(n(R),{value:l.dcon,"onUpdate:value":a[1]||(a[1]=s=>l.dcon=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"省份",path:"province"},{default:t(()=>[e(n(me),{filterable:"",options:y.provinceList,clearable:"",value:l.province,"onUpdate:value":a[2]||(a[2]=s=>l.province=s),"value-field":"id","label-field":"name"},null,8,["options","value"])]),_:1}),e(p,{span:"24 m:12",label:"地区",path:"region"},{default:t(()=>[e(n(R),{value:l.region,"onUpdate:value":a[3]||(a[3]=s=>l.region=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(p,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:t(()=>[e(J,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 m:12",label:"附件1",path:"notes"},{default:t(()=>[e(n(R),{value:l.re1,"onUpdate:value":a[4]||(a[4]=s=>l.re1=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var s;return[l.fl1?(m(),G("span",tt,[v(_((s=l.fl1)==null?void 0:s.split("?")[1])+" ",1),D("span",{class:"cursor-pointer c-#c92a2a",onClick:a[5]||(a[5]=d=>l.fl1="")},"删除"),D("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[6]||(a[6]=d=>P(l.fl1))},"下载")])):(m(),C(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":d=>w(d,"fl1"),"show-file-list":!1,onBeforeUpload:q},{default:t(()=>[e(n(N),{loading:u.value>0&&!l.fl1&&f.value=="fl1",size:"small",ghost:"",type:"primary"},{default:t(()=>[v(_(u.value>0&&!l.fl1&&f.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),u.value&&!l.fl1&&f.value=="fl1"?(m(),C(x,{key:2,type:"line",percentage:u.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):K("",!0)]}),_:1})]),_:1})]),_:1}),e(p,{span:"24 m:12",label:"附件2",path:"notes"},{default:t(()=>[e(n(R),{value:l.re2,"onUpdate:value":a[7]||(a[7]=s=>l.re2=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var s;return[l.fl2?(m(),G("span",lt,[v(_((s=l.fl2)==null?void 0:s.split("?")[1])+" ",1),D("span",{class:"cursor-pointer c-#c92a2a",onClick:a[8]||(a[8]=d=>l.fl2="")},"删除"),D("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[9]||(a[9]=d=>P(l.fl2))},"下载")])):(m(),C(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":d=>w(d,"fl2"),"show-file-list":!1,onBeforeUpload:q},{default:t(()=>[e(n(N),{loading:u.value>0&&!l.fl2&&f.value=="fl2",size:"small",ghost:"",type:"primary"},{default:t(()=>[v(_(u.value>0&&!l.fl2&&f.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),u.value&&!l.fl2&&f.value=="fl2"?(m(),C(x,{key:2,type:"line",percentage:u.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):K("",!0)]}),_:1}),e(p,{span:"24 m:12",label:"附件3",path:"notes"},{default:t(()=>[e(n(R),{value:l.re3,"onUpdate:value":a[10]||(a[10]=s=>l.re3=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var s;return[l.fl3?(m(),G("span",at,[v(_((s=l.fl3)==null?void 0:s.split("?")[1])+" ",1),D("span",{class:"cursor-pointer c-#c92a2a",onClick:a[11]||(a[11]=d=>l.fl3="")},"删除"),D("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[12]||(a[12]=d=>P(l.fl3))},"下载")])):(m(),C(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":d=>w(d,"fl3"),"show-file-list":!1,onBeforeUpload:q},{default:t(()=>[e(n(N),{loading:u.value>0&&!l.fl3&&f.value=="fl3",size:"small",ghost:"",type:"primary"},{default:t(()=>[v(_(u.value>0&&!l.fl3&&f.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),u.value&&!l.fl3&&f.value=="fl3"?(m(),C(x,{key:2,type:"line",percentage:u.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):K("",!0)]}),_:1}),e(p,{span:"24 m:12",label:"附件4",path:"notes"},{default:t(()=>[e(n(R),{value:l.re4,"onUpdate:value":a[13]||(a[13]=s=>l.re4=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var s;return[l.fl4?(m(),G("span",nt,[v(_((s=l.fl4)==null?void 0:s.split("?")[1])+" ",1),D("span",{class:"cursor-pointer c-#c92a2a",onClick:a[14]||(a[14]=d=>l.fl4="")},"删除"),D("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[15]||(a[15]=d=>P(l.fl4))},"下载")])):(m(),C(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":d=>w(d,"fl4"),"show-file-list":!1,onBeforeUpload:q},{default:t(()=>[e(n(N),{loading:u.value>0&&!l.fl4&&f.value=="fl4",size:"small",ghost:"",type:"primary"},{default:t(()=>[v(_(u.value>0&&!l.fl4&&f.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),u.value&&!l.fl4&&f.value=="fl4"?(m(),C(x,{key:2,type:"line",percentage:u.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):K("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),st=te({name:"FormSearch",__name:"form-search",props:X({provinceList:{}},{model:{required:!0},modelModifiers:{}}),emits:X(["reset","search"],["update:model"]),setup(z,{emit:E}){const M=z;Be();const y=E,{formRef:l,restoreValidation:T}=ue(),h=ce(z,"model");function B(){h.value.fuzzy="",y("search")}const S=()=>{h.value.region="",y("search")};async function I(){await T(),y("reset")}async function F(){y("search")}return(O,g)=>{const L=R,j=ge,u=me,f=et,w=N,q=Ze,P=ae,r=_e,a=le,p=ve;return m(),C(p,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(a,{ref_key:"formRef",ref:l,model:h.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ie(F,["enter"])},{default:t(()=>[e(r,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(j,{span:"24 s:12 m:6",label:"调度名称",path:"fuzzy"},{default:t(()=>[e(L,{clearable:"",value:h.value.fuzzy,"onUpdate:value":g[0]||(g[0]=c=>h.value.fuzzy=c),placeholder:"请输入调度名称",onClear:B},null,8,["value"])]),_:1}),e(j,{span:"24 s:12 m:4",label:"省份",path:"province"},{default:t(()=>[e(u,{clearable:"",filterable:"",value:h.value.province,"onUpdate:value":[g[1]||(g[1]=c=>h.value.province=c),F],placeholder:"请选择省份","label-field":"name","value-field":"id",options:M.provinceList},null,8,["value","options"])]),_:1}),e(j,{span:"24 s:12 m:6",label:"地区",path:"region"},{default:t(()=>[e(L,{clearable:"",value:h.value.region,"onUpdate:value":g[2]||(g[2]=c=>h.value.region=c),placeholder:"请输入地区",onClear:S},null,8,["value"])]),_:1}),e(j,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(P,{class:"w-full"},{default:t(()=>[e(w,{onClick:I},{icon:t(()=>[e(f,{class:"text-icon"})]),default:t(()=>[v(" "+_(n($)("common.reset")),1)]),_:1}),e(w,{type:"primary",ghost:"",onClick:F},{icon:t(()=>[e(q,{class:"text-icon"})]),default:t(()=>[v(" "+_(n($)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),rt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},it={style:{"font-weight":"500",color:"#1890ff","margin-right":"15px","font-size":"20px"}};function ie(z){return typeof z=="function"||Object.prototype.toString.call(z)==="[object Object]"&&!We(z)}const ht=te({name:"projectmanagement_dispatch",__name:"index",setup(z){const E=Oe(),{patternRules:M}=Ve(),y=V([]);(async()=>{const{data:i}=await Ke();i&&(y.value=i)})();const{columns:T,columnChecks:h,data:B,getData:S,loading:I,mobilePagination:F,searchParams:O}=Xe({showTotal:!0,apiFn:Qe,apiParams:{page:1,pageSize:20,limit:20,province:void 0,region:"",fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"dname",title:"主站名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"dcon",title:"主站联系方式",align:"center",width:120,ellipsis:{tooltip:!0},render:i=>e("span",{style:"cursor: pointer;color: #1890ff",onClick:()=>s(i)},[i.dcon])},{key:"provinceName",title:"省份",align:"center",width:120},{key:"region",title:"地区",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:$("common.operate"),align:"center",width:140,fixed:"right",render:i=>{let o;return e("div",{class:"flex-center gap-8px"},[W(e(N,{type:"primary",ghost:!0,size:"small",onClick:()=>p(i.id)},ie(o=$("common.edit"))?o:{default:()=>[o]}),[[ee("no-auth"),"project:Dispatch:update"]]),e(re,{onPositiveClick:()=>a(i.id)},{default:()=>$("common.confirmDelete"),trigger:()=>{let b;return W(e(N,{type:"error",ghost:!0,size:"small"},ie(b=$("common.delete"))?b:{default:()=>[b]}),[[ee("no-auth"),"project:Dispatch:delete"]])}})])}}]}),{drawerVisible:g,operateType:L,editingData:j,handleAdd:u,handleEdit:f,checkedRowKeys:w,onBatchDeleted:q,onDeleted:P}=Ye(B,S);async function r(){console.log(w.value),c(w.value.join(","),i=>{q()})}async function a(i){const{data:o,error:b}=await se(i);b||P()}function p(i){f(i)}async function c(i,o){const{data:b,error:Z}=await se(i);if(!Z)o&&o(b);else return!1}const x=i=>{S()},J=()=>{S()},A=V(!1),U=pe({id:"",name:"",pwd:""}),H=V(null),Y={pwd:[{required:!0,message:"请输入密码",trigger:"blur"},M.password]},s=i=>{U.id=i.id,A.value=!0,U.name=i.dname,U.pwd="",d.value=""},d=V(""),ye=async()=>{var b;await((b=H.value)==null?void 0:b.validate());const i=Je(U.pwd),o=await He({id:U.id,pwd:i});o.error||(d.value=o.data)},he=i=>{i&&navigator.clipboard.writeText(i).then(()=>{var o;(o=window.$message)==null||o.success("已复制到剪贴板")}).catch(()=>{var o;(o=window.$message)==null||o.error("复制失败，请手动复制")})};return(i,o)=>{const b=ae,Z=Se,we=$e,be=ze,ke=Ee,xe=ve,Ce=R,ne=Ge,Ne=le,De=de,Ue=fe,oe=ee("no-auth");return m(),G("div",rt,[e(st,{model:n(O),"onUpdate:model":o[0]||(o[0]=k=>Q(O)?O.value=k:null),onReset:J,onSearch:n(S),provinceList:y.value},null,8,["model","onSearch","provinceList"]),e(xe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(b,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>o[7]||(o[7]=[D("div",null,"主站联系人",-1)])),_:1,__:[7]})]),"header-extra":t(()=>[e(b,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[W((m(),C(n(N),{onClick:n(u),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(Z,{class:"text-icon"})]),default:t(()=>[o[8]||(o[8]=v(" "+_("新增")))]),_:1,__:[8]},8,["onClick"])),[[oe,"project:Dispatch:insert"]]),e(n(re),{onPositiveClick:r},{trigger:t(()=>[W((m(),C(n(N),{size:"small",ghost:"",type:"error",disabled:n(w).length==0},{icon:t(()=>[e(we,{class:Ae(["text-icon",{"animate-spin":n(I)}])},null,8,["class"])]),default:t(()=>[o[9]||(o[9]=v(" "+_("批量删除")))]),_:1,__:[9]},8,["disabled"])),[[oe,"project:Dispatch:delete"]])]),default:t(()=>[o[10]||(o[10]=v(" 确定要删除选中的调度吗？ "))]),_:1,__:[10]}),e(be,{columns:n(h),"onUpdate:columns":o[1]||(o[1]=k=>Q(h)?h.value=k:null),ctype:10},null,8,["columns"])]),_:1})]),default:t(()=>[e(ke,{"checked-row-keys":n(w),"onUpdate:checkedRowKeys":o[2]||(o[2]=k=>Q(w)?w.value=k:null),columns:n(T),data:n(B),size:"small","flex-height":!n(E).isMobile,loading:n(I),remote:"","row-key":k=>k.id,pagination:n(F),class:"sm:h-full","onUpdate:filters":x},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(ot,{visible:n(g),"onUpdate:visible":o[3]||(o[3]=k=>Q(g)?g.value=k:null),onSubmitted:n(S),"operate-type":n(L),provinceList:y.value,"row-data":n(j)},null,8,["visible","onSubmitted","operate-type","provinceList","row-data"])]),_:1}),e(Ue,{show:A.value,"onUpdate:show":o[6]||(o[6]=k=>A.value=k),title:"查看主站联系方式",preset:"card",class:"w-420px"},{footer:t(()=>[e(b,{justify:"end",size:16},{default:t(()=>[e(n(N),{type:"primary",onClick:ye},{default:t(()=>[v(_(n($)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(De,{class:"max-h-480px pr-20px"},{default:t(()=>[e(Ne,{ref_key:"checkformRef",ref:H,model:U,"label-placement":"left",rules:Y,"label-width":80,"require-mark-placement":"left"},{default:t(()=>[e(ne,{label:n($)("page.login.common.password"),path:"pwd"},{default:t(()=>[e(Ce,{type:"password","show-password-on":"click",clearable:"",value:U.pwd,"onUpdate:value":o[4]||(o[4]=k=>U.pwd=k),placeholder:"请输入当前登录账号密码"},null,8,["value"])]),_:1},8,["label"]),d.value?(m(),C(ne,{key:0,label:" "},{default:t(()=>[D("div",null,[D("span",null,_(`${U.name}的主站联系方式为：`),1),D("span",it,_(d.value),1),e(n(N),{size:"tiny",type:"primary",ghost:"",onClick:o[5]||(o[5]=k=>he(d.value))},{default:t(()=>o[11]||(o[11]=[v(" 复制 ")])),_:1,__:[11]})])]),_:1})):K("",!0)]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}});export{ht as default};
