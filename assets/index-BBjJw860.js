import{d as q,n as Y,p as ee,s as le,j as x,o as Z,c as te,w as e,g as a,i as f,h as n,t as c,$ as B,F as ae,aG as ne,aZ as oe,Z as se,B as $,N as Q,O as ie,ad as X,a3 as de,r as z,av as V,A as re,e as ue,ai as ce,aj as pe,S as me,ar as fe,P as ge,Q as _e,f as ve,R as he}from"./index-CS8QM5bD.js";import{_ as be,l as ye}from"./lodash-CxOjlDgb.js";import{_ as xe}from"./round-search-Bw7iZQHV.js";import{_ as Ce}from"./round-refresh-AOy4LhfF.js";import{f as Le,a as ke}from"./common-CmfW0aJA.js";import{a as Se,S as W,t as U}from"./alarm-CEa6GCEX.js";import{_ as we}from"./FormItemGridItem-DsqFX9Ui.js";import{_ as Te}from"./Cascader-C_yyXJad.js";import{_ as Ee}from"./DatePicker-BGcbCzUH.js";import{_ as Ne}from"./Grid-DcFHM4Ea.js";import{y as De,z as Re}from"./events-U8rqqDNe.js";import{n as Ie}from"./Collection-CoUCeALi.js";import{e as Ae}from"./exportExcel-D6OyA9oJ.js";import{_ as Oe,a as Me}from"./DescriptionsItem-7TE9Aotv.js";import"./TimePicker-DPdKaJy4.js";import"./defineProperty-CbkEtlED.js";const Ge={0:"KERN",1:"USER",2:"MAIL",3:"DAEMON",4:"AUTH",5:"SYSYLOG",6:"LPR",7:"NEWS",8:"UUCP",9:"CRON",10:"AUTHPRIV",11:"FTP",12:"RESERVED_12",13:"RESERVED_13",14:"RESERVED_14",15:"RESERVED_15",16:"LOCAL0",17:"LOCAL1",18:"LOCAL2",19:"LOCAL3",20:"LOCAL4",21:"LOCAL5",22:"LOCAL6",23:"LOCAL7"},je={0:"EMERGENCY",1:"ALERT",2:"CRITICAL",3:"ERROR",4:"WARNING",5:"NOTICE",6:"INFO",7:"DEBUG"},J={logModel:Ge,logLevel:je},ze=q({name:"FormSearch",__name:"form-search",props:Y(["collectorList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:Y(["search"],["update:model"]),setup(v,{emit:h}){const I=g=>Object.entries(g).map(([m,k])=>({label:k,value:m}));I(J.logLevel),I(J.logModel);const R=v,E=h,{formRef:K,restoreValidation:N}=ee(),r=le(v,"model");async function l(g,m){g&&g.length>0?(r.value.startTime=g[0],r.value.endTime=g[1]):(r.value.startTime=void 0,r.value.endTime=void 0),L()}async function u(){await N(),r.value.lsid=null,r.value.leid=null,r.value.lmid=null,r.value.timeRange=null,r.value.startAndEndIp=null,ne(()=>{E("search")})}const C=x([]);async function D(){const{data:g,error:m}=await Le();m||(C.value=g,await d())}async function d(){const{data:g,error:m}=await ke();if(!m){let k=C.value.concat(g);C.value=oe(k)}}D();async function L(){E("search")}const T=be.debounce(L,1e3,{leading:!0,trailing:!1});return(g,m)=>{const k=se,b=we,P=Te,A=Ee,H=Ce,O=$,S=xe,F=Q,t=Ne,s=ie,p=X;return Z(),te(p,{bordered:!1,size:"small",class:"card-wrapper"},{default:e(()=>[a(s,{ref_key:"formRef",ref:K,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ae(f(T),["enter"])},{default:e(()=>[a(t,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:e(()=>[a(b,{span:"24 s:24 m:8 l:8",label:"采集器",path:"lsid"},{default:e(()=>[a(k,{filterable:"",clearable:"",placeholder:"请选择采集器",value:r.value.lsid,"onUpdate:value":[m[0]||(m[0]=i=>r.value.lsid=i),L],options:R.collectorList,"value-field":"id","label-field":"type",disabled:R.logsoudev,"reset-menu-on-options-change":!1},null,8,["value","options","disabled"])]),_:1}),a(b,{span:"24 s:24 m:8 l:8",label:"安全级别",path:"leid"},{default:e(()=>[a(k,{filterable:"",clearable:"",placeholder:"请选择级别",value:r.value.leid,"onUpdate:value":[m[1]||(m[1]=i=>r.value.leid=i),L],options:f(Se),"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(b,{span:"24 s:24 m:8 l:6",label:"事件类型",path:"etypeid"},{default:e(()=>[a(P,{value:r.value.lmid,"onUpdate:value":[m[2]||(m[2]=i=>r.value.lmid=i),L],clearable:"",placeholder:"请选择事件","max-tag-count":1,options:C.value,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),a(b,{span:"24 s:24 m:12 l:8",label:"时间",path:"time"},{default:e(()=>[a(A,{value:r.value.timeRange,"onUpdate:value":m[3]||(m[3]=i=>r.value.timeRange=i),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":l},null,8,["value"])]),_:1}),a(b,{span:"24 s:24 m:8 l:8",label:" "},{default:e(()=>[a(F,{class:"w-full"},{default:e(()=>[a(O,{onClick:u},{icon:e(()=>[a(H,{class:"text-icon"})]),default:e(()=>[n(" "+c(f(B)("common.reset")),1)]),_:1}),a(O,{type:"primary",ghost:"",onClick:f(T)},{icon:e(()=>[a(S,{class:"text-icon"})]),default:e(()=>[n(" "+c(f(B)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Ve=v=>(ge("data-v-7b19e57d"),v=v(),_e(),v),Ue={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},$e=Ve(()=>ve("hr",{style:{"border-color":"#ccc","margin-bottom":"20px"}},null,-1));function Be(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!ce(v)}const Pe=q({name:"eventalarm_generallog",__name:"index",props:{logsoudev:{},aip:{}},setup(v){const h=v,I=de(),R=x(window.innerHeight-395),E=x([]);(async()=>{const{data:t,error:s}=await Ie({page:1,limit:1e3,_t:new Date().getTime()});if(s)console.error("获取采集器列表失败:",s);else{const p=t;E.value=p.list.map(i=>({...i,id:i.id,type:i.cname}))}})();const N=x(!1),r=J,l=z({lsid:void 0,lsdn:"",rdbtime:"",lmid:void 0,leid:void 0,ltext:"",aname:"",procid:"",msgid:"",dbtime:"",hname:"",lcon:"",ip:"",lsip:"",priority:"",type:"",version:"",logtype:void 0,index:0,gsubject:"",gdescribe:"",gresult:"",level:0,eids:"",epids:"",gobject:""}),u=z({pageId:void 0,pageSize:100,lsid:void 0,leid:void 0,lmid:void 0,startTime:void 0,endTime:void 0,startIp:void 0,endIp:void 0,_t:new Date().getTime()}),C=z([{title:"序号",key:"index",width:80,align:"center",render:t=>`${t.index}`},{key:"type",title:"采集器名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gsubject",title:"事件主体",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"gobject",title:"事件客体",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"gdescribe",title:"事件描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gresult",title:"事件结果",align:"center",width:140,ellipsis:{tooltip:!0},render:t=>{var s,p;return a(V,{size:"small",type:(s=t.gresult)!=null&&s.includes("成功")?"success":(p=t.gresult)!=null&&p.includes("失败")?"error":"warning"},{default:()=>[t.gresult]})}},{key:"level",title:"安全级别",align:"center",width:140,render:t=>{const s=W[t.level];let p={color:U[t.level],textColor:"#ffffff",borderColor:U[t.level]};return a(V,{size:"small",color:p},Be(s)?s:{default:()=>[s]})}},{key:"epids",title:"事件类别",align:"center",width:120},{key:"eids",title:"事件类型",align:"center",width:120},{key:"hname",title:"主机名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"dbtime",title:"日志时间",align:"center",width:160},{key:"operate",title:B("common.operate"),align:"center",width:120,fixed:"right",render:t=>a("div",{class:"flex-center gap-8px"},[a($,{type:"info",ghost:!0,size:"small",onClick:()=>m(t)},{default:()=>[n("详情")]})])}]),D=x(!1),d=x([]),L=x(0),T=async(t=!1)=>{if(!D.value)D.value=!0;else return;h.logsoudev&&h.aip&&(b.value=!1,u.lsid=h.logsoudev,u.startAndEndIp=[h.aip,h.aip],u.startIp=h.aip,u.endIp=h.aip);const{data:s,error:p}=await De(u);p||(L.value=s.length,t?d.value=[...d.value,...s]:d.value=s,d.value=d.value.sort((i,y)=>y.id-i.id).map((i,y)=>(i.index=y+1,i)),D.value=!1)},g=async()=>{const{data:t,error:s}=await Re({_t:new Date().getTime()});S.total=Number(t),S.itemCount=Number(t)};function m(t){l.lsid=t.lsid,l.lsdn=t.lsdn,l.rdbtime=t.rdbtime,l.lmid=t.lmid,l.leid=t.leid,l.ltext=t.ltext,l.aname=t.aname,l.procid=t.procid,l.msgid=t.msgid,l.dbtime=t.dbtime,l.hname=t.hname,l.lcon=t.lcon,l.ip=t.ip,l.lsip=t.lsip,l.priority=t.priority,l.type=t.type,l.version=t.version,l.logtype=t.logtype,l.gsubject=t.gsubject,l.gdescribe=t.gdescribe,l.gresult=t.gresult,l.level=t.level,l.eids=t.eids,l.epids=t.epids,l.gobject=t.gobject,N.value=!0}const k=x(),b=x(!0),P=async()=>{d.value=[],u.lsid||u.leid||u.lmid||u.startIp||u.endIp||u.startTime||u.endTime?b.value=!1:(b.value=!0,g()),u.pageId=void 0,await T(),A()},A=async()=>{var t,s,p;if(d.value.length<R.value/44&&d.value.length<S.total){if(u.pageId==((t=d.value[d.value.length-1])==null?void 0:t.id))return;u.pageId=((p=(s=d.value)==null?void 0:s[d.value.length-1])==null?void 0:p.id)??void 0,T(!0)}};re(async()=>{await T(),await g(),A()});function H(t){Math.abs(t.target.scrollTop+t.target.offsetHeight-t.target.scrollHeight)<=20&&S.total>d.value.length&&O()}const O=ye.debounce(()=>{var t,s;if(d.value.length<S.total){if(u.pageId==d.value[d.value.length-1].id)return;u.pageId=((s=(t=d.value)==null?void 0:t[d.value.length-1])==null?void 0:s.id)??void 0,T(!0)}},300),S=z({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:t,endIndex:s,page:p,pageSize:i,pageCount:y,itemCount:o}){return`已加载${d.value.length}条`+(d.value.length?b.value?` 共计 ${d.value.length>0?o??0:0} 条`:L.value==u.pageSize?"  预计还有更多":"  没有更多了":"")}});async function F(){if(!d.value.length)return;const t=JSON.parse(JSON.stringify(d.value)),s=[];t.forEach(i=>{const y={};C.forEach(o=>{var M,G,j;if(i.hasOwnProperty(o.key)){const _=o.key==="lmid"?((M=r.logModel)==null?void 0:M[i[o.key]])??null:o.key==="leid"?((G=r.logLevel)==null?void 0:G[i[o.key]])??null:o.key==="lsid"?(j=E.value.map(w=>w.data).flat(2).find(w=>w.id==i[o.key]))==null?void 0:j.type:o.key==="level"?W[i[o.key]]??null:o.key=="ltext"?i.ltext+i.lcon:i[o.key];y[o.title]=_}}),s.push(y)}),Ae(s,500,[{wpx:120},{wpx:120},{wpx:160},{wpx:80},{wpx:80},{wpx:100},{wpx:100},{wpx:100},{wpx:400}],"通用日志_"+new Date().getTime())}return(t,s)=>{const p=Q,i=pe,y=X,o=Oe,M=Me,G=me,j=fe;return Z(),ue("div",Ue,[a(ze,{model:u,"onUpdate:model":s[0]||(s[0]=_=>u=_),onSearch:P,collectorList:E.value,logsoudev:h.logsoudev},null,8,["model","collectorList","logsoudev"]),a(y,{title:"通用日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":e(()=>[a(p,null,{default:e(()=>[a(f($),{type:"primary",size:"small",ghost:"",onClick:F,title:"导出已加载"},{default:e(()=>[n("导出已加载")]),_:1})]),_:1})]),default:e(()=>[a(i,{ref_key:"tableContainerRef",ref:k,columns:C,data:d.value,size:"small","flex-height":!f(I).isMobile,"scroll-x":C.reduce((_,w)=>_+w.width,0),loading:D.value,remote:"","row-key":_=>_.index,showTotal:"","max-height":R.value,"virtual-scroll":"",pagination:S,class:"sm:h-full",onScroll:H},null,8,["columns","data","flex-height","scroll-x","loading","row-key","max-height","pagination"])]),_:1}),a(j,{show:N.value,"onUpdate:show":s[2]||(s[2]=_=>N.value=_),title:"日志详情",preset:"card",class:"w-800px"},{footer:e(()=>[a(p,{justify:"end",size:16},{default:e(()=>[a(f($),{type:"primary",onClick:s[1]||(s[1]=_=>{N.value=!1})},{default:e(()=>[n(c(f(B)("common.confirm")),1)]),_:1})]),_:1})]),default:e(()=>[$e,a(G,{class:"h-480px pr-20px"},{default:e(()=>[a(M,{"label-placement":"left","label-style":{width:"120px"},bordered:"",column:1},{default:e(()=>[a(o,null,{label:e(()=>[n(" 采集器名称 ")]),default:e(()=>[n(" "+c(l.type),1)]),_:1}),a(o,null,{label:e(()=>[n(" 事件主体 ")]),default:e(()=>[n(" "+c(l.gsubject),1)]),_:1}),a(o,null,{label:e(()=>[n(" 事件客体 ")]),default:e(()=>[n(" "+c(l.gobject),1)]),_:1}),a(o,null,{label:e(()=>[n(" 事件描述 ")]),default:e(()=>[n(" "+c(l.gdescribe),1)]),_:1}),a(o,null,{label:e(()=>[n(" 事件结果 ")]),default:e(()=>{var _,w;return[a(f(V),{size:"small",type:(_=l==null?void 0:l.gresult)!=null&&_.includes("成功")?"success":(w=l==null?void 0:l.gresult)!=null&&w.includes("失败")?"error":"warning"},{default:e(()=>[n(c(l==null?void 0:l.gresult),1)]),_:1},8,["type"])]}),_:1}),a(o,null,{label:e(()=>[n(" 安全级别 ")]),default:e(()=>[a(f(V),{size:"small",color:{color:f(U)[l.level],textColor:"#ffffff",borderColor:f(U)[l.level]}},{default:e(()=>[n(c(f(W)[l.level]),1)]),_:1},8,["color"])]),_:1}),a(o,null,{label:e(()=>[n(" 事件类别 ")]),default:e(()=>[n(" "+c(l.epids),1)]),_:1}),a(o,null,{label:e(()=>[n(" 事件类型 ")]),default:e(()=>[n(" "+c(l.eids),1)]),_:1}),a(o,null,{label:e(()=>[n(" 日志时间 ")]),default:e(()=>[n(" "+c(l.dbtime),1)]),_:1}),a(o,null,{label:e(()=>[n(" 接收时间 ")]),default:e(()=>[n(" "+c(l.rdbtime),1)]),_:1}),a(o,null,{label:e(()=>[n(" 模块 ")]),default:e(()=>[n(" "+c(f(r).logModel[l.lmid]),1)]),_:1}),a(o,null,{label:e(()=>[n(" 级别 ")]),default:e(()=>[n(" "+c(f(r).logLevel[l.leid]),1)]),_:1}),a(o,null,{label:e(()=>[n(" 应用名称 ")]),default:e(()=>[n(" "+c(l.aname),1)]),_:1}),a(o,null,{label:e(()=>[n(" PROCID ")]),default:e(()=>[n(" "+c(l.procid),1)]),_:1}),a(o,null,{label:e(()=>[n(" MSGID ")]),default:e(()=>[n(" "+c(l.msgid||"--"),1)]),_:1}),a(o,null,{label:e(()=>[n(" 日志时间 ")]),default:e(()=>[n(" "+c(l.dbtime),1)]),_:1}),a(o,null,{label:e(()=>[n(" 主机名称 ")]),default:e(()=>[n(" "+c(l.hname),1)]),_:1}),a(o,null,{label:e(()=>[n(" 结构数据 ")]),default:e(()=>[n(" -- ")]),_:1}),a(o,null,{label:e(()=>[n(" 日志内容 ")]),default:e(()=>[n(" "+c(l.lcon),1)]),_:1}),a(o,{span:2},{label:e(()=>[n(" 日志原文 ")]),default:e(()=>[n(" "+c(l.logtype?l.ltext:l.ltext+(l.lcon?l.lcon:"")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),sl=he(Pe,[["__scopeId","data-v-7b19e57d"]]);export{sl as default};
