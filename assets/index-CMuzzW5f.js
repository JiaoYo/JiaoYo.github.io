import{d as Q,n as W,p as le,s as te,o as Z,c as ae,w as l,g as t,h as o,t as p,i as _,$ as j,F as ne,aG as oe,aw as K,ax as se,Z as ie,J as de,B as V,N as X,O as re,ad as ee,a3 as ue,j as S,r as U,av as Y,A as ce,e as pe,ai as me,aj as fe,S as ge,ar as _e,P as ve,Q as he,f as be,R as ye}from"./index-hPhqsP7I.js";import{_ as xe,l as Ie}from"./lodash-bHFCHpPI.js";import{_ as Le}from"./round-search-CyqIEQDu.js";import{_ as Se}from"./round-refresh-C3OCWjl-.js";import{_ as Ce}from"./Cascader-hqiwL8XA.js";import{_ as we}from"./FormItemGridItem-K5k-w1Iy.js";import{_ as Ee}from"./DatePicker-yrjNKI9D.js";import{_ as ke}from"./Grid-Ckt2uQrN.js";import{x as Ne,y as De}from"./events-Bs3_eKnc.js";import{c as Te}from"./common-CgnhcyxT.js";import{e as Ae}from"./exportExcel-D6OyA9oJ.js";import{S as q}from"./alarm-DxzUk6VF.js";import{_ as Re,a as Me}from"./DescriptionsItem-MWhwuR3q.js";import"./TimePicker-ScZi84Jn.js";import"./defineProperty-Ck4-33s0.js";const Oe={0:"KERN",1:"USER",2:"MAIL",3:"DAEMON",4:"AUTH",5:"SYSYLOG",6:"LPR",7:"NEWS",8:"UUCP",9:"CRON",10:"AUTHPRIV",11:"FTP",12:"RESERVED_12",13:"RESERVED_13",14:"RESERVED_14",15:"RESERVED_15",16:"LOCAL0",17:"LOCAL1",18:"LOCAL2",19:"LOCAL3",20:"LOCAL4",21:"LOCAL5",22:"LOCAL6",23:"LOCAL7"},Pe={0:"EMERGENCY",1:"ALERT",2:"CRITICAL",3:"ERROR",4:"WARNING",5:"NOTICE",6:"INFO",7:"DEBUG"},F={logModel:Oe,logLevel:Pe},$e=Q({name:"FormSearch",__name:"form-search",props:W(["LogSourceDeviceList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:W(["search"],["update:model"]),setup(g,{emit:C}){const v=f=>Object.entries(f).map(([c,x])=>({label:x,value:c})),A={logLevel:v(F.logLevel),logModel:v(F.logModel)},w=g,E=C,{formRef:J,restoreValidation:k}=le(),n=te(g,"model");async function a(f,c){f&&f.length>0?(n.value.startTime=f[0],n.value.endTime=f[1]):(n.value.startTime=void 0,n.value.endTime=void 0),h()}async function r(){await k(),n.value.lsid=null,n.value.leid=null,n.value.lmid=null,n.value.timeRange=null,n.value.startAndEndIp=null,oe(()=>{E("search")})}const D=()=>{n.value.startAndEndIp=null,h()};async function h(){var f,c,x,b;if(n.value.startAndEndIp&&n.value.startAndEndIp.length>0?(n.value.startIp=n.value.startAndEndIp[0]||null,n.value.endIp=n.value.startAndEndIp[1]||null):(n.value.startIp=void 0,n.value.endIp=void 0),n.value.startIp&&!K(n.value.startIp)||n.value.endIp&&!K(n.value.endIp))return(f=window.$message)==null||f.destroyAll(),(c=window.$message)==null||c.error("请输入正确的IP地址"),!1;if(n.value.startIp&&n.value.endIp&&se(n.value.startIp,n.value.endIp)>0)return(x=window.$message)==null||x.destroyAll(),(b=window.$message)==null||b.error("起始IP不能大于终止IP"),!1;E("search")}const d=xe.debounce(h,1e3,{leading:!0,trailing:!1});return(f,c)=>{const x=Ce,b=we,R=ie,N=Ee,z=de,M=Se,O=V,B=Le,L=X,H=ke,e=re,s=ee;return Z(),ae(s,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[t(e,{ref_key:"formRef",ref:J,model:n.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(_(d),["enter"])},{default:l(()=>[t(H,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:l(()=>[t(b,{span:"24 s:24 m:8 l:8",label:"日志源设备",path:"lsid"},{default:l(()=>[t(x,{value:n.value.lsid,"onUpdate:value":[c[0]||(c[0]=u=>n.value.lsid=u),h],placeholder:"请选择日志源设备",options:w.LogSourceDeviceList,disabled:w.logsoudev,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options","disabled"])]),_:1}),t(b,{span:"24 s:24 m:8 l:8",label:"级别",path:"leid"},{default:l(()=>[t(R,{filterable:"",clearable:"",placeholder:"请选择级别",value:n.value.leid,"onUpdate:value":[c[1]||(c[1]=u=>n.value.leid=u),h],options:A.logLevel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(b,{span:"24 s:24 m:8 l:8",label:"日志模块",path:"lmid"},{default:l(()=>[t(R,{filterable:"",clearable:"",placeholder:"请选择日志模块",value:n.value.lmid,"onUpdate:value":[c[2]||(c[2]=u=>n.value.lmid=u),h],options:A.logModel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(b,{span:"24 s:24 m:12 l:8",label:"时间",path:"time"},{default:l(()=>[t(N,{value:n.value.timeRange,"onUpdate:value":c[3]||(c[3]=u=>n.value.timeRange=u),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":a},null,8,["value"])]),_:1}),t(b,{s:"",span:"24 s:24 m:12 l:8",label:"IP",path:"startAndEndIp"},{default:l(()=>[t(z,{pair:"",separator:"-",placeholder:["发生源起始IP","发生源终止IP"],clearable:"",value:n.value.startAndEndIp,"onUpdate:value":c[4]||(c[4]=u=>n.value.startAndEndIp=u),disabled:w.logsoudev,onClear:D},null,8,["value","disabled"])]),_:1}),t(b,{span:"24 s:24 m:8 l:8",label:" "},{default:l(()=>[t(L,{class:"w-full"},{default:l(()=>[t(O,{onClick:r},{icon:l(()=>[t(M,{class:"text-icon"})]),default:l(()=>[o(" "+p(_(j)("common.reset")),1)]),_:1}),t(O,{type:"primary",ghost:"",onClick:_(d)},{icon:l(()=>[t(B,{class:"text-icon"})]),default:l(()=>[o(" "+p(_(j)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Ge=g=>(ve("data-v-37a32ac3"),g=g(),he(),g),Ue={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ve=Ge(()=>be("hr",{style:{"border-color":"#ccc","margin-bottom":"20px"}},null,-1));function je(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!me(g)}const ze=Q({name:"eventalarm_generallog",__name:"index",props:{logsoudev:{},aip:{}},setup(g){const C={1:"#8e9dff",2:"#5da8ff",3:"#fedc69",4:"#ff9874",5:"#ff0000"},v=g,A=ue(),w=S(window.innerHeight-395),E=S([]);(async()=>{const{data:e,error:s}=await Te();s||(E.value=e.map(u=>({...u,id:"-"+u.id,type:u.cname})))})();const k=S(!1),n=F,a=U({lsid:void 0,lsdn:"",rdbtime:"",lmid:void 0,leid:void 0,ltext:"",aname:"",procid:"",msgid:"",dbtime:"",hname:"",lcon:"",ip:"",lsip:"",priority:"",type:"",version:"",logtype:void 0,index:0,gsubject:"",gdescribe:"",gresult:"",level:void 0}),r=U({pageId:void 0,pageSize:100,lsid:void 0,leid:void 0,lmid:void 0,startTime:void 0,endTime:void 0,startIp:void 0,endIp:void 0,_t:new Date().getTime()}),D=U([{title:"序号",key:"index",width:80,align:"center",render:e=>`${e.index}`},{key:"type",title:"采集器名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gsubject",title:"事件主体",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gdescribe",title:"事件描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gresult",title:"事件结果",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"level",title:"安全级别",align:"center",width:140,render:e=>{const s=q[e.level];let u={color:C[e.level],textColor:"#ffffff",borderColor:C[e.level]};return t(Y,{size:"small",color:u},je(s)?s:{default:()=>[s]})}},{key:"hname",title:"主机名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"rdbtime",title:"接收时间",align:"center",width:160,render:e=>e.rdbtime},{key:"lmid",title:"模块",align:"center",width:160,ellipsis:{tooltip:!0},render:e=>!e.lmid===void 0||e.lmid===null?"":n.logModel[e.lmid]},{key:"leid",title:"级别",align:"center",width:120,ellipsis:{tooltip:!0},render:e=>e.leid===void 0||e.leid===null?"":n.logLevel[e.leid]},{key:"ipaddr",title:"发生源IP",align:"center",width:180},{key:"ltext",title:"日志原文",align:"center",width:320,ellipsis:!0,render:e=>t("span",null,[e.logtype?e.ltext:e.ltext+e.lcon])},{key:"operate",title:j("common.operate"),align:"center",width:120,fixed:"right",render:e=>t("div",{class:"flex-center gap-8px"},[t(V,{type:"info",ghost:!0,size:"small",onClick:()=>b(e)},{default:()=>[o("详情")]})])}]),h=S(!1),d=S([]),f=S(0),c=async(e=!1)=>{if(!h.value)h.value=!0;else return;v.logsoudev&&v.aip&&(N.value=!1,r.lsid=v.logsoudev,r.startAndEndIp=[v.aip,v.aip],r.startIp=v.aip,r.endIp=v.aip);const{data:s,error:u}=await Ne(r);u||(f.value=s.length,e?d.value=[...d.value,...s]:d.value=s,d.value=d.value.sort((m,I)=>I.id-m.id).map((m,I)=>(m.index=I+1,m)),h.value=!1)},x=async()=>{const{data:e,error:s}=await De({_t:new Date().getTime()});L.total=Number(e),L.itemCount=Number(e)};function b(e){a.lsid=e.lsid,a.lsdn=e.lsdn,a.rdbtime=e.rdbtime,a.lmid=e.lmid,a.leid=e.leid,a.ltext=e.ltext,a.aname=e.aname,a.procid=e.procid,a.msgid=e.msgid,a.dbtime=e.dbtime,a.hname=e.hname,a.lcon=e.lcon,a.ip=e.ip,a.lsip=e.lsip,a.priority=e.priority,a.type=e.type,a.version=e.version,a.logtype=e.logtype,a.gsubject=e.gsubject,a.gdescribe=e.gdescribe,a.gresult=e.gresult,a.level=e.level,k.value=!0}const R=S(),N=S(!0),z=async()=>{d.value=[],r.lsid||r.leid||r.lmid||r.startIp||r.endIp||r.startTime||r.endTime?N.value=!1:(N.value=!0,x()),r.pageId=void 0,await c(),M()},M=async()=>{var e,s;if(d.value.length<w.value/44&&d.value.length<L.total){if(r.pageId==d.value[d.value.length-1].id)return;r.pageId=((s=(e=d.value)==null?void 0:e[d.value.length-1])==null?void 0:s.id)??void 0,c(!0)}};ce(async()=>{await c(),await x(),M()});function O(e){Math.abs(e.target.scrollTop+e.target.offsetHeight-e.target.scrollHeight)<=20&&L.total>d.value.length&&B()}const B=Ie.debounce(()=>{var e,s;if(d.value.length<L.total){if(r.pageId==d.value[d.value.length-1].id)return;r.pageId=((s=(e=d.value)==null?void 0:e[d.value.length-1])==null?void 0:s.id)??void 0,c(!0)}},300),L=U({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:s,page:u,pageSize:m,pageCount:I,itemCount:i}){return`已加载${d.value.length}条`+(d.value.length?N.value?` 共计 ${d.value.length>0?i??0:0} 条`:f.value==r.pageSize?"  预计还有更多":"  没有更多了":"")}});async function H(){if(!d.value.length)return;const e=JSON.parse(JSON.stringify(d.value)),s=[];e.forEach(m=>{const I={};D.forEach(i=>{var P,$,G;if(m.hasOwnProperty(i.key)){const y=i.key==="lmid"?((P=n.logModel)==null?void 0:P[m[i.key]])??null:i.key==="leid"?(($=n.logLevel)==null?void 0:$[m[i.key]])??null:i.key==="lsid"?(G=E.value.map(T=>T.data).flat(2).find(T=>T.id==m[i.key]))==null?void 0:G.type:i.key=="ltext"?m.ltext+m.lcon:m[i.key];I[i.title]=y}}),s.push(I)}),Ae(s,500,[{wpx:120},{wpx:120},{wpx:160},{wpx:80},{wpx:80},{wpx:100},{wpx:100},{wpx:100},{wpx:400}],"通用日志_"+new Date().getTime())}return(e,s)=>{const u=X,m=fe,I=ee,i=Re,P=Me,$=ge,G=_e;return Z(),pe("div",Ue,[t($e,{model:r,"onUpdate:model":s[0]||(s[0]=y=>r=y),onSearch:z,LogSourceDeviceList:E.value,logsoudev:v.logsoudev},null,8,["model","LogSourceDeviceList","logsoudev"]),t(I,{title:"通用日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[t(u,null,{default:l(()=>[t(_(V),{type:"primary",size:"small",ghost:"",onClick:H,title:"导出已加载"},{default:l(()=>[o("导出已加载")]),_:1})]),_:1})]),default:l(()=>[t(m,{ref_key:"tableContainerRef",ref:R,columns:D,data:d.value,size:"small","flex-height":!_(A).isMobile,"scroll-x":D.reduce((y,T)=>y+T.width,0),loading:h.value,remote:"","row-key":y=>y.index,showTotal:"","max-height":w.value,"virtual-scroll":"",pagination:L,class:"sm:h-full",onScroll:O},null,8,["columns","data","flex-height","scroll-x","loading","row-key","max-height","pagination"])]),_:1}),t(G,{show:k.value,"onUpdate:show":s[2]||(s[2]=y=>k.value=y),title:"日志详情",preset:"card",class:"w-800px"},{footer:l(()=>[t(u,{justify:"end",size:16},{default:l(()=>[t(_(V),{type:"primary",onClick:s[1]||(s[1]=y=>{k.value=!1})},{default:l(()=>[o(p(_(j)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[Ve,t($,{class:"h-480px pr-20px"},{default:l(()=>[t(P,{"label-placement":"left","label-style":{width:"120px"},bordered:"",column:1},{default:l(()=>[t(i,null,{label:l(()=>[o(" 采集器名称 ")]),default:l(()=>[o(" "+p(a.type),1)]),_:1}),t(i,null,{label:l(()=>[o(" 事件主体 ")]),default:l(()=>[o(" "+p(a.gsubject),1)]),_:1}),t(i,null,{label:l(()=>[o(" 事件描述 ")]),default:l(()=>[o(" "+p(a.gdescribe),1)]),_:1}),t(i,null,{label:l(()=>[o(" 事件结果 ")]),default:l(()=>[o(" "+p(a.gresult),1)]),_:1}),t(i,null,{label:l(()=>[o(" 安全级别 ")]),default:l(()=>[t(_(Y),{size:"small",color:{color:C[a.level],textColor:"#ffffff",borderColor:C[a.level]}},{default:l(()=>[o(p(_(q)[a.level]),1)]),_:1},8,["color"])]),_:1}),t(i,null,{label:l(()=>[o(" 接收时间 ")]),default:l(()=>[o(" "+p(a.rdbtime),1)]),_:1}),t(i,null,{label:l(()=>[o(" 模块 ")]),default:l(()=>[o(" "+p(_(n).logModel[a.lmid]),1)]),_:1}),t(i,null,{label:l(()=>[o(" 级别 ")]),default:l(()=>[o(" "+p(_(n).logLevel[a.leid]),1)]),_:1}),t(i,null,{label:l(()=>[o(" 应用名称 ")]),default:l(()=>[o(" "+p(a.aname),1)]),_:1}),t(i,null,{label:l(()=>[o(" PROCID ")]),default:l(()=>[o(" "+p(a.procid),1)]),_:1}),t(i,null,{label:l(()=>[o(" MSGID ")]),default:l(()=>[o(" "+p(a.msgid||"--"),1)]),_:1}),t(i,null,{label:l(()=>[o(" 日志时间 ")]),default:l(()=>[o(" "+p(a.dbtime),1)]),_:1}),t(i,null,{label:l(()=>[o(" 主机名称 ")]),default:l(()=>[o(" "+p(a.hname),1)]),_:1}),t(i,null,{label:l(()=>[o(" 结构数据 ")]),default:l(()=>[o(" -- ")]),_:1}),t(i,null,{label:l(()=>[o(" 日志内容 ")]),default:l(()=>[o(" "+p(a.lcon),1)]),_:1}),t(i,{span:2},{label:l(()=>[o(" 日志原文 ")]),default:l(()=>[o(" "+p(a.logtype?a.ltext:a.ltext+(a.lcon?a.lcon:"")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),nl=ye(ze,[["__scopeId","data-v-37a32ac3"]]);export{nl as default};
