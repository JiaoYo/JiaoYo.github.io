import{_ as ue}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BWEx_i0B.js";import{_ as pe}from"./export-DhJDZiK1.js";import{_ as _e}from"./round-search-UWMsZz_4.js";import{d as J,ab as G,a0 as fe,k as _,x as ge,aj as he,o as N,e as F,_ as K,aw as x,g as t,w as a,i as l,B as b,af as ye,h as D,t as g,$ as I,f as V,aI as j,c as E,aX as we,Q as ve,P as ke,aL as xe,M as be,aH as De,a6 as Te}from"./index-C6luuQp7.js";import{c as A,d as Ce,e as Se}from"./metar-BGDq6beL.js";import{u as Ne,a as Me}from"./table-BTUCzjGj.js";import{e as ze}from"./exportExcel-Bv4G4H50.js";import{u as Le}from"./echarts-BLQLXKL7.js";import{_ as Oe}from"./RadioButton-BwbShajE.js";import{_ as H}from"./DatePicker-DteLRteI.js";import{_ as Pe}from"./FormItemGridItem-Av-fUFAV.js";import{_ as Re}from"./Grid-DFE-5Yuu.js";const Ue=J({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(P){const d=P;G(()=>d.data,async n=>{M(),z()});const h=fe(),m=_(null),{domRef:y,updateOptions:w,showLoading:M,hideLoading:p}=Le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0}}},legend:{data:["功率标准差","均方根误差","平均绝对误差","平均误差","最大预测误差"]},calculable:!0,grid:{left:"6%",right:"6%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!0,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value}"},position:"left"},series:[{name:"功率标准差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"均方根误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"平均绝对误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"平均误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"最大预测误差",type:"bar",emphasis:{focus:"series"},data:[]}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function z(){await new Promise(n=>{setTimeout(n,1e3)}),w(n=>(n.xAxis.data=d.data.map(i=>i.dbtime),n.series[0].data=d.data.map(i=>i.stdpower),n.series[1].data=d.data.map(i=>i.prmse),n.series[2].data=d.data.map(i=>i.pmae),n.series[3].data=d.data.map(i=>i.pme),n.series[4].data=d.data.map(i=>i.pmaxe),n))}function f(){w((n,i)=>{const v=i();return n.legend.data=v.legend.data,n.series[0].name=v.series[0].name,n.series[1].name=v.series[1].name,n})}async function T(){z()}return G(()=>h.locale,()=>{f()}),T(),ge(()=>{m.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),he(()=>{m.value!==null&&(clearInterval(m.value),m.value=null)}),(n,i)=>(N(),F("div",{ref_key:"domRef",ref:y,class:"h-100% overflow-hidden"},null,512))}}),$e=K(Ue,[["__scopeId","data-v-7655cf3a"]]),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ge={style:{width:"200px","margin-left":"20px"}},Ie=J({name:"realtimequery_datastatistics",__name:"index",setup(P){const{columns:d,columnChecks:h,data:m,getData:y,loading:w,mobilePagination:M,searchParams:p,resetSearchParams:z}=Ne({apiFn:A,apiParams:{page:1,pageSize:20,limit:20,startTime:x(0,Date.now()-2592e5),endTime:x(0,Date.now()),_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",width:50},{key:"dbtime",title:"更新时间",align:"center",width:160,fixed:"left"},{key:"etime",title:"有效时长(小时)",align:"center",width:120},{key:"powermax",title:"功率最大值",align:"center",width:120},{key:"avgpower",title:"功率平均值",align:"center",width:120},{key:"stdpower",title:"功率标准差",align:"center",width:120},{key:"powertime",title:"功率最大发生时间",align:"center",width:160},{key:"uhours",title:"利用小时数",align:"center",width:120},{key:"avgload",title:"平均负荷率",align:"center",width:120},{key:"prmse",title:"均方根误差",align:"center",width:120},{key:"pmae",title:"平均绝对误差",align:"center",width:120},{key:"pme",title:"平均误差",align:"center",width:120},{key:"pclcf",title:"相关性系数",align:"center",width:120},{key:"pmaxe",title:"最大预测误差",align:"center",width:120},{key:"prate",title:"合格率",align:"center",width:120},{key:"avgenvt",title:"环境温度平均值",align:"center",width:120},{key:"avgenvh",title:"环境湿度平均值",align:"center",width:120},{key:"avgldt",title:"露点温度平均值",align:"center",width:120},{key:"avgqy",title:"气压平均值",align:"center",width:120},{key:"avgwindd",title:"风向平均值",align:"center",width:120},{key:"avgwinds",title:"风速平均值",align:"center",width:120},{key:"avgzfsd",title:"总辐射平均值",align:"center",width:120}]}),{checkedRowKeys:f}=Me(m,y),T=()=>{k.value=="0"?y():U()},n=_([Date.now()-864e5*3,Date.now()]);async function i(s,e){p.startTime=x(0,e[0]),p.endTime=x(0,e[1]),T()}const v=()=>{const s={};d.value.forEach(o=>{o.key!="index"&&o.key!="operate"&&o.type!=="selection"&&(s[o.key]=typeof o.title=="string"?o.title:o.title().children[0])});const e=[];m.value.forEach(o=>{if(f.value.includes(o.id)){const c=JSON.parse(JSON.stringify(s));for(const u in c)o.hasOwnProperty(u)?c[u]=o[u]:c[u]="";e.push(c)}}),ze(e,s,"数据统计")},q={近七天:[Date.now()-864e5*7,Date.now()],近一月:[Date.now()-864e5*30,Date.now()],近三月:[Date.now()-864e5*90,Date.now()]},C=_(!1),L=_(new Date().getTime()),O=_(0),Q=()=>{$(),C.value=!0},X=(s,e)=>{$()},Z=()=>{C.value=!1},k=_("0"),W=s=>{k.value=s,s=="0"?y():U()},Y=(s,e)=>{const o=new Date(s).getTime(),u=(new Date(e).getTime()-o)/(1e3*60*60*24);return Math.abs(u)},R=_([]),U=async()=>{const{data:s,error:e}=await A({startTime:p.startTime,endTime:p.endTime,page:1,limit:Math.floor(Y(p.startTime,p.endTime)+1)});R.value=JSON.parse(JSON.stringify(s)).list.sort((o,c)=>new Date(o.dbtime).getTime()-new Date(c.dbtime).getTime())},$=async()=>{const{data:s,error:e}=await Ce({date:x(3,L.value)});e||(typeof s=="number"?O.value=s:O.value="")},S=_(),ee=async()=>{const{data:s,error:e}=await Se();S.value=s};return(s,e)=>{const o=H,c=Pe,u=Oe,te=we,ae=_e,ne=Re,se=ve,oe=pe,le=ue,B=ke,ie=xe,re=H,ce=be,de=De,me=Te;return N(),F("div",Be,[t(me,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t(se,{ref:"formRef",model:l(p),"label-placement":"left","show-feedback":!1},{default:a(()=>[t(ne,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:a(()=>[t(c,{span:"24 s:12 m:12 l:8",label:"起止时间",path:"startTime"},{default:a(()=>[t(o,{value:n.value,"onUpdate:value":e[0]||(e[0]=r=>n.value=r),type:"daterange","value-format":"yyyy-MM-dd","onUpdate:formattedValue":i,"default-time":["00:00:00","23:59:59"],shortcuts:q},null,8,["value"])]),_:1}),t(c,{span:"24 s:12 m:12 l:5",label:"",path:"startTime"},{default:a(()=>[t(te,{value:k.value,"onUpdate:value":[e[1]||(e[1]=r=>k.value=r),W],class:"ml-20px"},{default:a(()=>[t(u,{value:"0",label:"表格"}),t(u,{value:"1",label:"图表"})]),_:1},8,["value"]),t(l(b),{type:"primary",ghost:"",onClick:T,class:"ml-20px"},{icon:a(()=>[t(ae,{class:ye(["text-icon",{"animate-spin":l(w)}])},null,8,["class"])]),default:a(()=>[D(" "+g(l(I)("common.search")),1)]),_:1})]),_:1}),t(c,{span:"24 s:12  m:20 l:10",label:"",path:"startTime"},{default:a(()=>[t(l(b),{type:"primary",ghost:"",onClick:Q,class:"ml-20px"},{default:a(()=>[D(g("月均方根误差"))]),_:1}),t(l(b),{type:"primary",ghost:"",onClick:ee,class:"ml-20px"},{default:a(()=>[D(" 查询日照时数平均值 ")]),_:1}),V("span",Ge,g(S.value&&S.value>0?"日照时数平均值为："+S.value:""),1)]),_:1})]),_:1})]),_:1},8,["model"])]),"header-extra":a(()=>[t(B,{justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[t(l(b),{onClick:v,size:"small",disabled:l(f).length==0},{icon:a(()=>[t(oe,{class:"text-icon"})]),default:a(()=>[D(" "+g(l(I)("common.export")),1)]),_:1},8,["disabled"]),t(le,{columns:l(h),"onUpdate:columns":e[2]||(e[2]=r=>j(h)?h.value=r:null)},null,8,["columns"])]),_:1})]),default:a(()=>[k.value=="0"?(N(),E(ie,{key:0,"checked-row-keys":l(f),"onUpdate:checkedRowKeys":e[3]||(e[3]=r=>j(f)?f.value=r:null),columns:l(d),data:l(m),size:"small",loading:l(w),remote:"","row-key":r=>r.id,pagination:l(m).length?l(M):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])):(N(),E($e,{key:1,data:R.value},null,8,["data"])),t(de,{show:C.value,"onUpdate:show":e[5]||(e[5]=r=>C.value=r),preset:"card",class:"w-320px"},{footer:a(()=>[t(B,{justify:"end"},{default:a(()=>[t(l(b),{size:"small",class:"mt-16px",onClick:Z},{default:a(()=>[D(g("关闭"))]),_:1})]),_:1})]),default:a(()=>[t(ce,{label:"日期","label-placement":"left"},{default:a(()=>[t(re,{value:L.value,"onUpdate:value":[e[4]||(e[4]=r=>L.value=r),X],type:"month",clearable:""},null,8,["value"])]),_:1}),V("h2",null,"月均方根误差："+g(O.value),1)]),_:1},8,["show"])]),_:1})])}}}),We=K(Ie,[["__scopeId","data-v-f3df7d6e"]]);export{We as default};
