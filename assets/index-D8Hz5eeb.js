import{_ as se}from"./location-outline-BKntWS-a.js";import{_ as ie,A as ue}from"./index-C0c8aNVM.js";import{d as de,s as pe,q as me,v as P,i as fe,bV as D,bW as ce,r as k,aw as _e,b as ge,o as b,f as o,w as l,c as x,z as S,A as z,b4 as G,g as i,B as K,b5 as ve,h as M,C as ke,N as V,G as be,e as ye,t as R,aE as we,bX as Ce,aH as q,aL as Ae}from"./index-DGUcENSr.js";const xe={class:"flex justify-center"},Se=de({name:"manage_systemconfig",__name:"index",setup(Me){const{formRef:T,validate:j}=pe(),N=me(),t=P(F());function F(){return{id:0,merror:0,errortime:0,sdkkey:"",sdkh5:"",sdksecret:"",prosite:"",longitude:120.373885,latitude:30.303899,diserror:0}}const _={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},L={prosite:{type:"string",required:!0,message:"不能为空",trigger:["blur","change"]},longitude:_,latitude:_,merror:_,errortime:_,diserror:_},E=async()=>{const{data:r,error:e}=await Ce();e||(Object.assign(t,r),t.errortime=r.errortime/1e3/60)};fe(()=>{E()});const O=D.debounce(async()=>{var n;await j();const r=t.errortime*1e3*60,{error:e}=await ce({...t,errortime:r});e||(n=window.$message)==null||n.success("设置成功")},1e3,{leading:!0,trailing:!1}),g=k(!1),$=k();let m=null,B=null,y=null,I=null,d=null;const f=P({longitude:0,latitude:0});let v;const w=k(!1),c=k(""),C=k([]);async function H(){window._AMapSecurityConfig={securityJsCode:t.sdksecret},$.value&&(d=await ue.load({key:t.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),m=new d.Map($.value,{zoom:18,center:[t.longitude,t.latitude],viewMode:"3D",resizeEnable:!0}),B=new d.Geocoder,new d.PlaceSearch({city:"全国",pageSize:50}),I=new d.AutoComplete({city:"全国"}),U(d,{lng:t.longitude,lat:t.latitude}),m.on("click",r=>{const{lng:e,lat:n}=r.lnglat;v=2,f.latitude=n,f.longitude=e,U(d,{lng:e,lat:n})}),q(()=>window.dispatchEvent(new Event("resize"))))}const Y=D.debounce(async r=>{if(!w.value||!r.trim()){C.value=[];return}I.search(r,(e,n)=>{var s;console.log(n,"result"),e=="complete"&&n.info=="OK"&&((s=n==null?void 0:n.tips)!=null&&s.length)?C.value=n.tips.map(u=>({label:`${u.name}（${u.district||u.address||"无详细地址"}）`,value:`${u.location.lng}_${u.location.lat}`,raw:u})):C.value=[]})},300);_e(c,r=>{Y(r)});function J(r,e){if(console.log(r,e,"option"),!r)return;const[n,s]=r.split("_").map(Number);!n||!s||(m.setCenter([n,s]),v=1,U(d,{lng:n,lat:s}),f.longitude=n,f.latitude=s)}function W(){g.value=!0,w.value=!1,v=void 0,q(async()=>{await H(),setTimeout(()=>{w.value=!0;const r=document.querySelector(".n-auto-complete input");r==null||r.blur()},500)})}function U(r,e){y&&m.remove(y),y=new r.Marker({position:[e.lng,e.lat],map:m}),m.add(y),B.getAddress(e,(n,s)=>{n==="complete"&&s.regeocode&&(console.log("result",s),console.log("formattedAddress",s.regeocode.formattedAddress),e.latitude=e.lat,e.longitude=e.lng,v==1||(v==2?c.value=s.regeocode.formattedAddress:c.value=t.prosite))})}function X(){g.value=!1}const Q=async()=>{t.latitude=f.latitude,t.longitude=f.longitude,t.prosite=c.value,g.value=!1};return(r,e)=>{const n=K,s=ve,u=G,p=z,A=ke,Z=se,h=K,ee=G,te=z,oe=V,ne=be,le=ie,re=V,ae=we;return b(),ge("div",xe,[o(ne,{ref_key:"formRef",ref:T,"label-width":240,"label-placement":"left",model:t,rules:L},{default:l(()=>[o(p,{label:"打卡误差范围（米）",path:"merror"},{default:l(()=>[o(u,{class:"flex items-center"},{default:l(()=>[o(n,{onClick:e[0]||(e[0]=a=>t.merror--),disabled:t.merror==0},{default:l(()=>e[15]||(e[15]=[i(" − ")])),_:1,__:[15]},8,["disabled"]),o(s,{"show-button":!1,value:t.merror,"onUpdate:value":e[1]||(e[1]=a=>t.merror=a),placeholder:"",min:0,precision:0},null,8,["value"]),o(n,{onClick:e[2]||(e[2]=a=>t.merror++),class:"mr-5px"},{default:l(()=>e[16]||(e[16]=[i(" + ")])),_:1,__:[16]}),e[17]||(e[17]=i(" 米 "))]),_:1,__:[17]})]),_:1}),o(p,{label:"打卡时间误差最大值（分钟）",path:"errortime"},{default:l(()=>[o(u,{class:"flex items-center"},{default:l(()=>[o(n,{onClick:e[3]||(e[3]=a=>t.errortime--),disabled:t.errortime==0},{default:l(()=>e[18]||(e[18]=[i(" − ")])),_:1,__:[18]},8,["disabled"]),o(s,{"show-button":!1,value:t.errortime,"onUpdate:value":e[4]||(e[4]=a=>t.errortime=a),placeholder:"",min:0,precision:0},null,8,["value"]),o(n,{onClick:e[5]||(e[5]=a=>t.errortime++),class:"mr-5px"},{default:l(()=>e[19]||(e[19]=[i(" + ")])),_:1,__:[19]}),e[20]||(e[20]=i(" 分钟 "))]),_:1,__:[20]})]),_:1}),o(p,{label:"静默打卡范围（当超过此数值将认为异常默认100）",path:"diserror"},{default:l(()=>[o(u,{class:"flex items-center"},{default:l(()=>[o(n,{onClick:e[6]||(e[6]=a=>t.diserror--),disabled:t.diserror==0},{default:l(()=>e[21]||(e[21]=[i(" − ")])),_:1,__:[21]},8,["disabled"]),o(s,{"show-button":!1,value:t.diserror,"onUpdate:value":e[7]||(e[7]=a=>t.diserror=a),placeholder:"",min:0,max:5e3,precision:0},null,8,["value"]),o(n,{onClick:e[8]||(e[8]=a=>t.diserror++),class:"mr-5px"},{default:l(()=>e[22]||(e[22]=[i(" + ")])),_:1,__:[22]}),e[23]||(e[23]=i(" 米 "))]),_:1,__:[23]})]),_:1}),M(N).userInfo.id=="1024"?(b(),x(p,{key:0,label:"AMAP_SDK_KEY",path:"sdkkey"},{default:l(()=>[o(A,{style:{width:"300px"},value:t.sdkkey,"onUpdate:value":e[9]||(e[9]=a=>t.sdkkey=a),placeholder:""},null,8,["value"])]),_:1})):S("",!0),M(N).userInfo.id=="1024"?(b(),x(p,{key:1,label:"AMAP_SDK_KEY_H5",path:"sdkh5"},{default:l(()=>[o(A,{style:{width:"300px"},value:t.sdkh5,"onUpdate:value":e[10]||(e[10]=a=>t.sdkh5=a),placeholder:""},null,8,["value"])]),_:1})):S("",!0),M(N).userInfo.id=="1024"?(b(),x(p,{key:2,label:"AMAP_SDK_SECRET",path:"sdksecret"},{default:l(()=>[o(A,{style:{width:"300px"},value:t.sdksecret,"onUpdate:value":e[11]||(e[11]=a=>t.sdksecret=a),placeholder:""},null,8,["value"])]),_:1})):S("",!0),o(te,{label:"项目地点",path:"prosite"},{default:l(()=>[o(ee,{onClick:W},{default:l(()=>[o(A,{value:t.prosite,"onUpdate:value":e[12]||(e[12]=a=>t.prosite=a),style:{width:"400px"},placeholder:"请输入项目地点"},null,8,["value"]),o(h,null,{icon:l(()=>[o(Z,{class:"text-icon"})]),_:1})]),_:1})]),_:1}),o(p,{label:" "},{default:l(()=>[o(oe,null,{default:l(()=>[o(n,{type:"default",ghost:"",onClick:E},{default:l(()=>e[24]||(e[24]=[i(" 刷新 ")])),_:1,__:[24]}),o(n,{type:"info",ghost:"",onClick:M(O)},{default:l(()=>e[25]||(e[25]=[i(" 保存 ")])),_:1,__:[25]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model"]),o(ae,{show:g.value,"onUpdate:show":e[14]||(e[14]=a=>g.value=a),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:l(()=>[o(re,{justify:"end",size:16},{default:l(()=>[o(h,{onClick:X},{default:l(()=>[i(R(r.$t("common.cancel")),1)]),_:1}),o(h,{type:"primary",onClick:Q},{default:l(()=>[i(R(r.$t("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[w.value?(b(),x(le,{key:0,value:c.value,"onUpdate:value":e[13]||(e[13]=a=>c.value=a),options:C.value,placeholder:"请输入地点关键字",clearable:"",onSelect:J},null,8,["value","options"])):S("",!0),ye("div",{ref_key:"domRef",ref:$,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])])}}}),he=Ae(Se,[["__scopeId","data-v-ed15870a"]]);export{he as default};
