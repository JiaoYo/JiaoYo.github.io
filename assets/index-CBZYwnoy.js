import{Q as me,p as _e,_ as we,a as fe}from"./pako.esm-BwRKjrCh.js";import{_ as ge}from"./export-D7w4fFNy.js";import{_ as ve}from"./round-search-CRTbykM-.js";import{d as W,ac as E,a0 as he,o as x,b as q,_ as j,ea as ye,b0 as c,g as t,m as g,z as be,ak as xe,w as n,f as d,B as A,h as C,t as S,$ as O,c as R,F as N,aq as De,e as H,eb as ke,aG as Te,Q as Pe,T as Ce,a7 as Se,c0 as Ne,at as $e,R as Ie,c1 as Be,ap as Me,p as Ue,i as ze}from"./index-D5B256Dj.js";import{u as Ae,a as Re}from"./table-CAJzliPP.js";import{e as qe}from"./exportExcel-Bv4G4H50.js";import{u as Le,L as V}from"./echarts-DAF0ZABC.js";import{_ as Fe}from"./DatePicker-D-_zJaOu.js";import{_ as Ge}from"./RadioButton-DScMUa7-.js";import{_ as Ee}from"./FormItemGridItem-DAyicM1P.js";import{_ as Oe}from"./Grid-BRXFl_1Z.js";const Ve=W({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(y){const m=y;E(()=>m.data,async i=>{v(o=>(o.xAxis.data=m.data.map(s=>s.dbtime),o.series[0].data=m.data.map(s=>s.power),o.series[1].data=m.data.map(s=>s.prePower),o))});const $=he(),{domRef:L,updateOptions:w,updateOptionsAsync:v}=Le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:"#6a7985",textStyle:{color:"rgb(224, 224, 224)"},valueFormatter:function(i){return(i+""!="undefined"?i:"--")+"MW"}},legend:{data:["实际功率","预测功率"]},toolbox:{show:!0,feature:{saveAsImage:{show:!0,name:"功率图表"},magicType:{show:!0,type:["line","bar"]}}},grid:{left:"2%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} MW"}},series:[{color:"#e90445",name:"实际功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new V(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.9)",shadowBlur:20},data:[],connectNulls:!0},{color:"#009688",name:"预测功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new V(0,0,0,1,[{offset:0,color:"rgba(0, 150, 136,0.3)"},{offset:1,color:"rgba(0, 150, 136,0)"}],!1),shadowColor:"rgba(0, 150, 136,0.9)",shadowBlur:20},data:[],connectNulls:!0}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function I(){await new Promise(i=>{setTimeout(i,200)}),w(i=>(i.xAxis.data=m.data.map(o=>o.dbtime),i.series[0].data=m.data.map(o=>o.power),i.series[1].data=m.data.map(o=>o.prePower),i))}function B(){w((i,o)=>{const s=o();return i.legend.data=s.legend.data,i.series[0].name=s.series[0].name,i.series[1].name=s.series[1].name,i})}async function r(){I()}return E(()=>$.locale,()=>{B()}),r(),(i,o)=>(x(),q("div",{ref_key:"domRef",ref:L,class:"h-600px overflow-hidden"},null,512))}}),We=j(Ve,[["__scopeId","data-v-462d4bff"]]),je=y=>(Ue("data-v-571f9e21"),y=y(),ze(),y),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Qe={key:1},Ke=je(()=>H("span",null,"二维码",-1)),Je=W({name:"realtimequery_powerquery",__name:"index",setup(y){const m=Date.now();new Date(m).setHours(0,0,0,0),new Date(m).setHours(23,59,59,999);const{columns:$,columnChecks:L,data:w,getData:v,loading:I,mobilePagination:B,searchParams:r,resetSearchParams:i}=Ae({apiFn:ye,apiParams:{page:1,pageSize:20,limit:20,startTime:c(1,Date.now())||null,endTime:c(1,Date.now()+144e5)||null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"dbtime",title:"时间",align:"center",width:100},{key:"power",title:"实际功率(MW)",align:"center",width:140},{key:"prePower",title:"预测功率(MW)",align:"center",width:140},{key:"ctime",title:"预测计算时间(s)",align:"center",width:140},{key:"operate",title:"误差(MW)",align:"center",width:100,render(a){const e=a.prePower-a.power>=0?a.prePower-a.power:a.power-a.prePower;return t("span",null,[e?parseFloat(e.toFixed(6)):""])}}]}),{checkedRowKeys:o}=Re(w,v),s=g(null),M=g(!1),Q=a=>{if(a){if(s.value!==null)return;f(),s.value=window.setInterval(async()=>f(),1e3*60*3)}else s.value!==null&&(clearInterval(s.value),s.value=null),f()},K=async()=>{_.value=="0"?await f():await v()},D=g([]),k=g(""),f=async()=>{const{data:a,error:e}=await ke({startTime:r.startTime,endTime:r.endTime});e||(D.value=a.sort((p,l)=>new Date(p.dbtime).getTime()-new Date(l.dbtime).getTime()))},T=g([Date.now(),Date.now()+144e5]);async function J(a,e){r.startTime=c(1,e[0]),r.endTime=c(1,e[1]),r.startTime==c(1,Date.now())&&r.endTime==c(1,Date.now()+144e5)?b.value="0":r.startTime==c(1,Date.now())&&r.endTime==c(1,Date.now()+864e5*10)?b.value="1":b.value="2",_.value=="1"?v():f()}const Z=a=>{a=="1"?v():f()};be(()=>{f()});const X=()=>{var p;if(w.value.length==0)return(p=window.$message)==null?void 0:p.warning("暂无数据。请查询数据后重试。");const a={dbtime:"时间",power:"实际功率",prePower:"预测功率",ctime:"预测计算时间",error:"误差"},e=[];w.value.forEach(l=>{o.value.includes(l.id)&&e.push({dbtime:l.dbtime,power:l.power,prePower:l.prePower,error:l.prePower-l.power>=0?l.prePower-l.power:l.power-l.prePower||""})}),qe(e,a,"预测数据")},_=g("0"),U=g(!1),Y=()=>{var l,P;if(D.value.length==0)return(l=window.$message)==null?void 0:l.warning("暂无数据。请查询数据后重试。");const a={data:D.value.map(h=>({t:h.dbtime,pP:h.prePower,p:h.power})),type:0,dateTime:c(1,r.startTime)+" --- "+(M.value?c(1,new Date):c(1,r.endTime))},p=_e.gzip(JSON.stringify(a),{to:"string"}).reduce((h,z)=>h+String.fromCharCode(z),"");if(k.value=`https://dingiiot.com/powerPrediction/?${btoa(p)}`,k.value.length>2700)return(P=window.$message)==null?void 0:P.warning("二维码生成失败，请缩小查询范围后重试");console.log("地址",k.value),U.value=!0},ee=()=>{var e;const a=document.getElementById("qrcode");if(a){const p=document.createElement("a");p.href=a.toDataURL("image/png"),p.download="qrcode.png",p.click(),(e=window.$message)==null||e.success("下载成功")}else console.error("无法找到二维码 canvas 元素")},ae={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()]},b=g("0"),te=a=>{b.value=a,a=="0"?(T.value=[Date.now(),Date.now()+144e5],r.startTime=c(1,Date.now()),r.endTime=c(1,Date.now()+144e5)):(T.value=[Date.now(),Date.now()+864e5*10],r.startTime=c(1,Date.now()),r.endTime=c(1,Date.now()+864e5*10)),_.value=="1"?v():f()};return xe(()=>{s.value!==null&&(clearInterval(s.value),s.value=null)}),(a,e)=>{const p=Fe,l=Ge,P=Te,h=ve,z=we,ne=Pe,oe=Ee,se=Oe,le=Ce,F=Se,G=Ne,re=$e,ie=ge,ce=Ie,ue=Be,de=fe,pe=Me;return x(),q("div",He,[t(F,{bordered:!1,size:"small"},{default:n(()=>[t(le,{ref:"formRef",model:d(r),"label-placement":"left","show-feedback":!1},{default:n(()=>[t(se,{"y-gap":16,responsive:"screen","item-responsive":""},{default:n(()=>[t(oe,{span:"24 s:12 m:18",label:"起止时间",path:"startTime"},{default:n(()=>[t(p,{value:T.value,"onUpdate:value":e[0]||(e[0]=u=>T.value=u),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":J,"default-time":["00:00:00","23:59:59"],shortcuts:ae},null,8,["value"]),t(P,{value:b.value,"onUpdate:value":[e[1]||(e[1]=u=>b.value=u),te],class:"ml-20px"},{default:n(()=>[t(l,{value:"0",label:"超短期"}),t(l,{value:"1",label:"短期"})]),_:1},8,["value"]),t(d(A),{type:"primary",ghost:"",onClick:K,class:"ml-20px"},{icon:n(()=>[t(h,{class:"text-icon"})]),default:n(()=>[C(" "+S(d(O)("common.search")),1)]),_:1}),_.value=="0"?(x(),R(d(A),{key:0,type:"primary",ghost:"",onClick:Y,class:"ml-20px"},{icon:n(()=>[t(z,{class:"text-icon"})]),default:n(()=>[C(" "+S("生成二维码"))]),_:1})):N("",!0),_.value=="0"?(x(),R(ne,{key:1,checked:M.value,"onUpdate:checked":[e[2]||(e[2]=u=>M.value=u),Q],class:"ml-20px",title:"3分钟自动刷新"},{default:n(()=>[C(" 定时刷新 ")]),_:1},8,["checked"])):N("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(F,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:n(()=>[t(ue,{type:"card",animated:"",value:_.value,"onUpdate:value":[e[4]||(e[4]=u=>_.value=u),Z],class:"h-100%","tab-style":{height:"40px"},"pane-wrapper-style":{flex:1}},{suffix:n(()=>[_.value=="1"?(x(),R(ce,{key:0,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[t(d(A),{onClick:X,size:"small",disabled:d(o).length==0},{icon:n(()=>[t(ie,{class:"text-icon"})]),default:n(()=>[C(" "+S(d(O)("common.export")),1)]),_:1},8,["disabled"])]),_:1})):N("",!0),_.value=="0"?(x(),q("span",Qe,"共"+S(D.value.length)+"条数据",1)):N("",!0)]),default:n(()=>[t(G,{name:"0",tab:"图表"},{default:n(()=>[t(We,{data:D.value},null,8,["data"])]),_:1}),t(G,{name:"1",tab:"表格",class:"h-100%"},{default:n(()=>[t(re,{"checked-row-keys":d(o),"onUpdate:checkedRowKeys":e[3]||(e[3]=u=>De(o)?o.value=u:null),columns:d($),data:d(w),size:"small",loading:d(I),remote:"","row-key":u=>u.id,pagination:d(w).length?d(B):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1}),t(pe,{show:U.value,"onUpdate:show":e[5]||(e[5]=u=>U.value=u),title:"",preset:"card",class:"w-auto"},{header:n(()=>[H("div",null,[Ke,t(de,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:ee})])]),default:n(()=>[t(me,{id:"qrcode",style:{margin:"0 auto"},value:k.value,margin:3,size:500,level:"L"},null,8,["value"])]),_:1},8,["show"])])}}}),ia=j(Je,[["__scopeId","data-v-571f9e21"]]);export{ia as default};
