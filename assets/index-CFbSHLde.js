import{_ as Q}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CvYtnbqB.js";import{o as i,e as f,f as M,d as W,a3 as X,g as n,av as Y,j as p,A as Z,D as ee,w as t,t as x,G as S,E as C,c as v,H as ae,h as w,i as s,B as $,ah as te,K as oe,N as ne,O as se,ad as le,aj as ie,P as re,Q as ce,R as ue}from"./index-DqR-s4w3.js";import{_ as de,a as pe}from"./close-small-rounded-V3Y-QbF1.js";import{G as _e,H as me,I as fe,J as ge}from"./basic-config-D3jaxLM3.js";import{u as he}from"./table-h8GqLGXE.js";import{_ as ve}from"./Progress-BQv5MD9E.js";import{_ as we}from"./Upload-B3BDZY5E.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-E_oryi12.js";import"./setting-outlined-CTeedqNY.js";import"./export-BSP7dOrb.js";import"./refresh-BTsHfxAU.js";import"./round-delete-BDwNXc1C.js";import"./round-plus-ZPv0S9Lb.js";import"./Popconfirm-9MCMyHQG.js";const ye={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},ke=M("path",{fill:"currentColor",d:"M16 18v2H8v-2zM11 7.99V16h2V7.99h3L12 4L8 7.99z"},null,-1),be=[ke];function xe(_,N){return i(),f("svg",ye,[...be])}const Ce={name:"ic-twotone-upgrade",render:xe},$e=_=>(re("data-v-6a620413"),_=_(),ce(),_),Ne={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ze={key:0,class:"version"},Re={key:0,style:{width:"300px"}},Ve=$e(()=>M("div",null,"升级记录",-1)),De=W({name:"basicconfig_upgrade-management",__name:"index",setup(_){const N=X(),{columns:B,columnChecks:y,data:F,getData:T,loading:z,mobilePagination:U,searchParams:Ie,resetSearchParams:Pe}=he({apiFn:_e,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"dbtime",title:"升级时间",align:"center"},{key:"upgradecon",title:"升级内容",align:"center"},{key:"prever",title:"升级前版本",align:"center"},{key:"version",title:"升级后版本",align:"center"},{key:"status",title:"状态",align:"center",render:e=>(e.status===null&&(e.status=0),n(Y,{type:{0:"error",1:"success"}[e.status]},{default:()=>[e.status==1?"成功":"失败"]}))}]}),g=p(""),R=async()=>{const{data:e,error:o}=await me();o||(typeof e=="object"?g.value=e.data:g.value=e)},G=async()=>{var a;const{data:e,error:o}=await fe({uid:c.value[0]});o||(a=window.$message)==null||a.success(e)},l=p(""),d=p(null),H=({file:e,data:o,headers:a,withCredentials:u,action:h,onFinish:D,onError:I,onProgress:k})=>{console.log(e),d.value=e.file,l.value=e.name},V=p(0),r=p(!1),K=e=>{r.value=!0,V.value=e},c=p([]),j=(e,o,a)=>{var u;a.action==="check"?c.value=[(u=a.row)==null?void 0:u.uid]:c.value=[]},E=async()=>{var e,o;if(!l.value.endsWith(".tar.gz"))return(e=window.$message)==null?void 0:e.error("请上传tar.gz文件");try{const a=new FormData;a.append("fname",l.value),a.append("fi",d.value);const{data:u,error:h}=await ge(a,K);if(h)return;(o=window.$message)==null||o.success(u),r.value=!1,l.value="",d.value=null,R()}catch(a){console.error(a),r.value=!1,l.value="",d.value=null}finally{r.value=!1,l.value="",d.value=null}},L=e=>{e.stopPropagation(),l.value="",d.value=null};return Z(()=>{R()}),(e,o)=>{const a=oe,u=de,h=pe,D=we,I=Ce,k=ne,q=ve,A=se,P=le,O=Q,J=ie,b=ee("no-auth");return i(),f("div",Ne,[n(P,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[n(A,{ref:"formRef",inline:"","label-placement":"left","label-width":100,"show-feedback":!1},{default:t(()=>[n(a,null,{default:t(()=>[g.value?(i(),f("span",ze,"当前版本号："+x(g.value),1)):S("",!0)]),_:1}),C((i(),v(a,{label:"升级包选择",path:"fi"},{default:t(()=>[n(D,{action:"","custom-request":H,"show-file-list":!1,accept:".gz"},{default:t(()=>[l.value?(i(),f("div",{key:0,onClick:o[0]||(o[0]=ae(()=>{},["stop"]))},[w(x(l.value)+" ",1),n(u,{class:"font-size-30px cursor-pointer",onClick:L})])):(i(),v(s($),{key:1},{icon:t(()=>[n(h,{class:"text-icon"})]),default:t(()=>[w(" 上传文件")]),_:1}))]),_:1})]),_:1})),[[b,"sys.upgrade.upload"]]),n(a,null,{default:t(()=>[n(k,{class:"w-full"},{default:t(()=>[C((i(),v(s($),{onClick:E,loading:r.value,disabled:!l.value,type:"primary",ghost:""},{icon:t(()=>[n(I,{class:"text-icon"})]),default:t(()=>[w(" "+x(r.value?"正在升级中":"升级"),1)]),_:1},8,["loading","disabled"])),[[b,"sys.upgrade.upload"]]),C((i(),v(s($),{onClick:G,type:"primary",ghost:"",disabled:c.value.length==0},{default:t(()=>[w(" 回退版本 ")]),_:1},8,["disabled"])),[[b,"sys.upgrade.fallback.version"]])]),_:1})]),_:1}),n(a,null,{default:t(()=>[r.value?(i(),f("div",Re,[n(q,{"indicator-placement":"inside",type:"line",percentage:V.value},null,8,["percentage"])])):S("",!0)]),_:1})]),_:1},512)]),_:1}),n(P,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[n(k,{align:"center"},{default:t(()=>[Ve]),_:1})]),"header-extra":t(()=>[n(O,{columns:s(y),"onUpdate:columns":o[1]||(o[1]=m=>te(y)?y.value=m:null),"disabled-delete":c.value.length===0,loading:s(z),onRefresh:s(T)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:t(()=>[n(J,{"checked-row-keys":c.value,"onUpdate:checkedRowKeys":o[2]||(o[2]=m=>c.value=m),columns:s(B),data:s(F),size:"small","flex-height":!s(N).isMobile,"scroll-x":962,loading:s(z),remote:"","row-key":m=>m.uid,pagination:s(U),class:"sm:h-full",onUpdateCheckedRowKeys:j},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1})])}}}),Oe=ue(De,[["__scopeId","data-v-6a620413"]]);export{Oe as default};
