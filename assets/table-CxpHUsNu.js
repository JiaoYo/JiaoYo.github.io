import{P as B,b$ as T,r as j,j as w,b as x,c0 as K,Y as L,$ as N,y as I,l as Y,c1 as H}from"./index-B6CaFrdK.js";function U(n){const{loading:u,startLoading:y,endLoading:i}=B(),{bool:P,setBool:p}=T(),{apiFn:C,apiParams:l,transformer:k,immediate:d=!1,getColumnChecks:S,getColumns:v}=n,s=j({...l}),m=w(n.columns()),b=w([]),h=w(S(n.columns())),z=x(()=>v(m.value,h.value));function _(){m.value=n.columns();const r=new Map(h.value.map(a=>[a.key,a.checked])),e=S(m.value);h.value=e.map(a=>({...a,checked:r.get(a.key)??a.checked}))}async function f(r){var g;y();const e=D(r?Object.assign(s,r):s),a=await C(e),t=k(a);b.value=t.data,p(t.data.length===0),await((g=n.onFetched)==null?void 0:g.call(n,t)),i()}function D(r){const e={};return Object.entries(r).forEach(([a,t])=>{t!=null&&(e[a]=t)}),e}function c(r){Object.assign(s,r)}function O(){Object.assign(s,l),f()}return d&&f(),{loading:u,empty:P,data:b,columns:z,columnChecks:h,reloadColumns:_,getData:f,searchParams:s,updateSearchParams:c,resetSearchParams:O}}function W(n){const u=K(),y=L(),i=x(()=>y.isMobile),{apiFn:P,apiParams:p,immediate:C,showTotal:l=!0}=n,k="__selection__",d="__expand__",{loading:S,empty:v,data:s,columns:m,columnChecks:b,reloadColumns:h,getData:z,searchParams:_,updateSearchParams:f,resetSearchParams:D}=U({apiFn:P,apiParams:p,columns:n.columns,transformer:e=>{let a=_;if(e.error)return{data:[],pageNum:a.page,pageSize:a.pageSize,total:0};e.hasOwnProperty("total")||(e.total=0);const{data:t=[],pageNum:g=1,pageSize:o=20,total:A=0}=e||{};console.log("res",e);const M=(t instanceof Array?t:t?t.hasOwnProperty("list")?t.list:t.data||[]:[]).map((F,$)=>({...F,index:(g-1)*o+$+1}));return e.total=t instanceof Array?Object.prototype.hasOwnProperty.call(t,"total")?Number(t.total):Number(A):Number(t.total),{data:M,pageNum:a.page,pageSize:a.pageSize,total:Number.isNaN(e.total)?0:e.total}},getColumnChecks:e=>{const a=[];return e.forEach(t=>{E(t)?a.push({key:t.key,title:t.title,checked:!0}):t.type==="selection"?a.push({key:k,title:N("common.check"),checked:!0}):t.type==="expand"&&a.push({key:d,title:N("common.expandColumn"),checked:!0})}),a},getColumns:(e,a)=>{const t=new Map;return e.forEach(o=>{E(o)?t.set(o.key,o):o.type==="selection"?t.set(k,o):o.type==="expand"&&t.set(d,o)}),a.filter(o=>o.checked).map(o=>t.get(o.key))},onFetched:async e=>{const{pageNum:a,pageSize:t,total:g}=e;r({page:a,pageSize:t,itemCount:g})},immediate:C}),c=j({page:1,pageSize:20,itemCount:0,showSizePicker:!0,pageSizes:[20,50,100,200],onUpdatePage:async e=>{c.page=e,f({page:e,pageSize:c.pageSize||20,limit:c.pageSize||20,_t:new Date().getTime()}),z()},onUpdatePageSize:async e=>{c.pageSize=e,c.page=1,f({page:c.page,pageSize:e,limit:e,_t:new Date().getTime()}),z()},...l?{prefix:e=>N("datatable.itemCount",{total:e.itemCount})}:{}}),O=x(()=>({...c,pageSlot:i.value?3:9,prefix:!i.value&&l?c.prefix:void 0}));function r(e){Object.assign(c,e)}return u.run(()=>{I(()=>y.locale,()=>{h()})}),Y(()=>{u.stop()}),{loading:S,empty:v,data:s,columns:m,columnChecks:b,reloadColumns:h,pagination:c,mobilePagination:O,updatePagination:r,getData:z,searchParams:_,updateSearchParams:f,resetSearchParams:D}}function X(n,u){const{bool:y,setTrue:i,setFalse:P}=T(),p=w("add");function C(){p.value="add",i()}const l=w(null);function k(s){p.value="edit";const m=n.value.find(b=>b.id===s)||null;l.value=H(m),i()}const d=w([]);async function S(){var s;(s=window.$message)==null||s.success(N("common.deleteSuccess")),d.value=[],await u()}async function v(){var s;(s=window.$message)==null||s.success(N("common.deleteSuccess")),await u()}return{drawerVisible:y,openDrawer:i,closeDrawer:P,operateType:p,handleAdd:C,editingData:l,handleEdit:k,checkedRowKeys:d,onBatchDeleted:S,onDeleted:v}}function E(n){return!!n.key}export{X as a,W as u};
