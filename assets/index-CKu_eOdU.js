import{_ as Ce}from"./round-add-CmnuyzV1.js";import{d as le,aG as ce,z as ie,W as pe,C as ze,s as N,aI as fe,aE as se,bZ as _e,E as te,c as D,o as v,w as a,f as n,bh as Ne,b as K,F as R,L as ve,e as c,N as je,t as b,aV as J,a5 as Pe,H as O,h as r,G as Re,K as ge,cM as Me,B,g as T,a2 as $e,a3 as Ie,bj as Le,V as Ue,X as Be,A as Fe,i as ye,b3 as f,a7 as he,aF as Ve,aM as He,I as we,$ as Z,cu as qe,aP as re,b5 as Ge,cN as Ee,cO as ue,cP as Ke,cQ as Oe,aT as Ae,aU as oe,cR as We,aJ as Ye,aZ as Je}from"./index-CYktWG4g.js";import{f as Ze,a as Qe,b as Xe,_ as et,c as tt,d as at}from"./operate-drawer.vue_vue_type_style_index_0_lang-CyHpmb5u.js";import{u as nt,a as ot}from"./table-5HkGqXjJ.js";import{_ as st,a as lt}from"./text-DOrZBLOM.js";import{N as be}from"./Popconfirm-CztqIDpP.js";import{_ as it}from"./round-search-DE64LlxI.js";import{u as de}from"./usePageData-B3dmJo7x.js";import{_ as rt}from"./Grid-yccwcNrM.js";import{_ as ut}from"./FormItemGridItem-CEINFz71.js";import{_ as dt}from"./RadioButton-Dh1hBWEB.js";import{_ as mt}from"./DatePicker-DtsJbsvC.js";const ct={class:"font-size-12px c-#a19f9d my-5px"},pt={key:0},ft={class:"mt-4 border-t pt-3"},_t={class:"flex items-start gap-2 mb-3"},vt={class:"ml-2 flex-1"},gt={class:"flex items-center"},yt={class:"font-medium font-size-16px font-bold"},ht={class:"text-gray-600 mt-1"},wt=le({name:"drawerLog",__name:"drawerLog",props:ce({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(S){const Q=ie();pe();const t=ze({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0,charctras:0}),M=S,d={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},$=N({});async function o(){_.value=[],Object.assign(t,M.rowData);const u=JSON.parse(M.rowData.context);t.proname=u.proname,t.notes=u.notes,t.problem=u.problem,t.solutions=u.solutions,t.feedback=u.feedback,t.summarize=u.summarize,j()}const _=N([]),g=fe(S,"visible");se(g,()=>{g.value?o():(_.value=[],t.id=void 0)}),se(()=>M.rowData,()=>{g.value&&o()});function I(u){u||C()}function C(){g.value=!1}const j=async()=>{const{data:u,error:l}=await Qe({page:1,limit:100,pid:t.id});u&&(_.value=u.list)},L=_e.debounce(async()=>{var k;const u=$.value[t.id];if(!(u!=null&&u.trim()))return(k=window.$message)==null?void 0:k.warning("请输入评论内容");const{data:l,error:w}=await Ze([{pid:t.id,context:u}]);l&&($.value[t.id]="",t.num++,j())},1e3,{leading:!0,trailing:!1}),A=async u=>{var k;const{data:l,error:w}=await Xe(u.id);l&&(j(),t.num--,(k=window.$message)==null||k.success("删除成功"))};return(u,l)=>{const w=je,k=ve,H=st,F=lt,P=Ne,q=Le,G=te("no-auth");return v(),D(q,{show:g.value,"onUpdate:show":[l[1]||(l[1]=y=>g.value=y),I],"display-directive":"show",width:600,onMaskClick:C,onEsc:C},{default:a(()=>[n(P,{title:t.username+"的项目日报","native-scrollbar":!1,closable:""},{default:a(()=>[n(k,{ref:"formRef",model:t,"show-feedback":!1},{default:a(()=>[t.proname?(v(),D(w,{key:0,label:"项目名称",path:"proname","label-placement":"left"},{label:a(()=>l[2]||(l[2]=[c("div",{class:"font-size-16px font-bold"},"项目名称：",-1)])),default:a(()=>[c("span",null,b(t.proname),1)]),_:1})):R("",!0),n(w,{label:"当前工作内容及成果描述",path:"notes"},{label:a(()=>l[3]||(l[3]=[c("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述：",-1)])),default:a(()=>[c("span",{class:J(["preview-text",{textstyle:t.notes}])},b(t.notes),3)]),_:1}),n(w,{label:"遇到问题",path:"problem"},{label:a(()=>l[4]||(l[4]=[c("div",{class:"font-size-16px font-bold"},"遇到问题：",-1)])),default:a(()=>[c("span",{class:J(["preview-text",{textstyle:t.problem}])},b(t.problem),3)]),_:1}),n(w,{label:"解决措施",path:"solutions"},{label:a(()=>l[5]||(l[5]=[c("div",{class:"font-size-16px font-bold"},"解决措施：",-1)])),default:a(()=>[c("span",{class:J(["preview-text",{textstyle:t.solutions}])},b(t.solutions),3)]),_:1}),n(w,{label:"建议意见反馈",path:"feedback"},{label:a(()=>l[6]||(l[6]=[c("div",{class:"font-size-16px font-bold"},"建议意见反馈：",-1)])),default:a(()=>[c("span",{class:J(["preview-text",{textstyle:t.feedback}])},b(t.feedback),3)]),_:1}),n(w,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:a(()=>l[7]||(l[7]=[c("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感：",-1)])),default:a(()=>[c("span",{class:J(["preview-text",{textstyle:t.summarize}])},b(t.summarize),3)]),_:1}),c("div",ct,"字符数："+b(t.charctras),1)]),_:1},8,["model"]),t.num?(v(),K("div",pt,b(t.num)+"评论",1)):R("",!0),n(Pe,{name:"fade"},{default:a(()=>[c("div",ft,[O((v(),K("div",_t,[c("div",null,[n(H,{size:"small",src:d.avatar},null,8,["src"])]),n(r(Re),{type:"textarea",id:`comment-input-${t.id}`,value:$.value[t.id],"onUpdate:value":l[0]||(l[0]=y=>$.value[t.id]=y),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ge(Me(r(L),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),n(r(B),{type:"primary",ghost:"",onClick:r(L)},{default:a(()=>l[8]||(l[8]=[T("发送")])),_:1,__:[8]},8,["onClick"])])),[[G,"project:Comment:insert"]]),(v(!0),K($e,null,Ie(_.value,y=>(v(),K("div",{key:y.id,class:"flex mb-3"},[n(H,{size:"small",src:d.avatar},null,8,["src"]),c("div",vt,[c("div",gt,[c("span",yt,b(y.username),1),n(F,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:a(()=>[T(b(y.dbtime),1)]),_:2},1024),r(Q).userInfo.id==y.creater?(v(),D(r(be),{key:0,onPositiveClick:W=>A(y)},{trigger:a(()=>[O((v(),D(r(B),{quaternary:"",type:"error",size:"small"},{default:a(()=>l[9]||(l[9]=[T(" 删除 ")])),_:1,__:[9]})),[[G,"project:Comment:delete"]])]),default:a(()=>[l[10]||(l[10]=T(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):R("",!0)]),c("div",ht,b(y.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),bt=Ue(wt,[["__scopeId","data-v-d3933054"]]),Tt=le({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ce(["reset","search","clear","setPname"],["update:model"]),setup(S,{emit:Q}){const t=pe(),M=Be(),d=Q,{formRef:$}=Fe(),o=fe(S,"model");ie();const _=N([]),{pageData:g,getData:I,nextPage:C}=de(qe),j=async s=>{const e=s.currentTarget,i=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&g.data.length<g.total&&(await C(),_.value=g.data,await re(),setTimeout(()=>{e.scrollTop=i}))},{pageData:L,getData:A,nextPage:u}=de(Ge),l=async s=>{const e=s.currentTarget,i=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&L.data.length<L.total&&(await u(),await re(),setTimeout(()=>{e.scrollTop=i}))},w=async s=>{o.value.creater=s,d("search")},k=async s=>{var e;P.value=!0,s&&(o.value.pid=s),d("search"),d("setPname",((e=_.value.find(i=>i.id==s))==null?void 0:e.proname)||"")},H=_e.debounce(async s=>{await I({fuzzy:s,page:1}),_.value=g.data},300),F=N(!1),P=N(!1),q=s=>{if(o.value.pid=null,F.value=!0,P.value=!1,!s){y();return}H(s)},G=async()=>{F.value&&!P.value&&(await I({page:1}),_.value=g.data,F.value=!1)},y=async()=>{await I({page:1}),_.value=g.data},W=async()=>{await I(),_.value=g.data,o.value.pid=t.query.prjId?Number(t.query.prjId):void 0,o.value.fuzzy=t.query.pname?t.query.pname:"",U.value=t.query.prjId&&t.query.pname?"all":"day",d("search"),setTimeout(()=>{M.replace({path:t.path,query:{}})},10)};A({usertypes:"2,3"}),ye(async()=>{if(!t.query.prjId&&!t.query.pname){const s=new Date;if(s.getHours()<18){const e=new Date;e.setDate(s.getDate()-1),e.setHours(0,0,0,0),h.value.dayTime=String(f(0,e.getTime())),o.value.statrtTime=String(f(0,e.getTime()))+" 00:00:00",o.value.endTime=String(f(0,e.getTime()+24*60*60*1e3))+" 00:00:00"}else{const e=new Date;e.setHours(0,0,0,0),h.value.dayTime=String(f(0,e.getTime())),o.value.statrtTime=String(f(0,e.getTime()))+" 00:00:00",o.value.endTime=String(f(0,e.getTime()+24*60*60*1e3))+" 00:00:00"}}await W()}),se(()=>t,async s=>{s.prjId&&s.pname&&X("all")},{immediate:!0});const h=N({dayTime:null,weekTime:null,monthTime:null}),p=async s=>{o.value.statrtTime=String(f(0,s))+" 00:00:00",o.value.endTime=String(f(0,new Date(s).getTime()+24*60*60*1e3))+" 00:00:00",d("search")},m=async s=>{const{monday:e,sunday:i}=Ee(s);o.value.statrtTime=e,o.value.endTime=f(0,new Date(i).getTime()+24*60*60*1e3),d("search")},z=async s=>{const{start:e,end:i}=ue(s);o.value.statrtTime=e,o.value.endTime=f(0,new Date(i).getTime()+24*60*60*1e3),d("search")};async function Y(){d("search")}const U=N("day"),X=async s=>{if(s=="day"){const e=new Date;if(e.getHours()<18){const i=new Date;i.setDate(e.getDate()-1),i.setHours(0,0,0,0),h.value.dayTime=String(f(0,i.getTime())),o.value.statrtTime=String(f(0,i.getTime()))+" 00:00:00",o.value.endTime=String(f(0,i.getTime()+24*60*60*1e3))+" 00:00:00"}else{const i=new Date;i.setHours(0,0,0,0),h.value.dayTime=String(f(0,i.getTime())),o.value.statrtTime=String(f(0,i.getTime()))+" 00:00:00",o.value.endTime=String(f(0,i.getTime()+24*60*60*1e3))+" 00:00:00"}}else if(s=="week"){h.value.weekTime=Ke();const{start:e,end:i}=Oe(new Date().getTime());o.value.statrtTime=e,o.value.endTime=f(0,new Date(i).getTime()+24*60*60*1e3)}else if(s=="month"){let e=function(){const V=new Date,ae=V.getFullYear(),ne=(V.getMonth()+1).toString().padStart(2,"0");return`${ae}-${ne}`};h.value.monthTime=e();const{start:i,end:E}=ue(h.value.monthTime);o.value.statrtTime=i,o.value.endTime=f(0,new Date(E).getTime()+24*60*60*1e3)}else s=="all"&&(o.value.statrtTime=void 0,o.value.endTime=void 0);d("search")};return(s,e)=>{const i=Ve,E=ut,V=dt,ae=He,ee=mt,ne=it,Te=B,ke=we,xe=rt,De=ve,Se=he;return v(),D(Se,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[n(De,{ref_key:"formRef",ref:$,model:o.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ge(Y,["enter"])},{default:a(()=>[n(xe,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[n(E,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:a(()=>[n(i,{filterable:"",clearable:"",value:o.value.pid,"onUpdate:value":[e[0]||(e[0]=x=>o.value.pid=x),k],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:_.value,onScroll:j,onClear:y,onSearch:q,onBlur:G},null,8,["value","options"])]),_:1}),n(E,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:a(()=>[n(ae,{value:U.value,"onUpdate:value":[e[1]||(e[1]=x=>U.value=x),X],style:{"margin-right":"20px"}},{default:a(()=>[n(V,{value:"day"},{default:a(()=>e[6]||(e[6]=[T("天")])),_:1,__:[6]}),n(V,{value:"week"},{default:a(()=>e[7]||(e[7]=[T("周")])),_:1,__:[7]}),n(V,{value:"month"},{default:a(()=>e[8]||(e[8]=[T("月")])),_:1,__:[8]}),n(V,{value:"all"},{default:a(()=>e[9]||(e[9]=[T("全部")])),_:1,__:[9]})]),_:1},8,["value"]),U.value==="day"?(v(),D(ee,{key:0,"formatted-value":h.value.dayTime,"onUpdate:formattedValue":[e[2]||(e[2]=x=>h.value.dayTime=x),p],type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])):R("",!0),U.value==="week"?(v(),D(ee,{key:1,"formatted-value":h.value.weekTime,"onUpdate:formattedValue":[e[3]||(e[3]=x=>h.value.weekTime=x),m],type:"week",style:{width:"100%"}},null,8,["formatted-value"])):R("",!0),U.value==="month"?(v(),D(ee,{key:2,"formatted-value":h.value.monthTime,"onUpdate:formattedValue":[e[4]||(e[4]=x=>h.value.monthTime=x),z],type:"month","value-format":"yyyy-MM",style:{width:"100%"}},null,8,["formatted-value"])):R("",!0)]),_:1}),n(E,{span:"24 s:12 m:5",label:"用户",path:"creater"},{default:a(()=>[n(i,{clearable:"",filterable:"",value:o.value.creater,"onUpdate:value":[e[5]||(e[5]=x=>o.value.creater=x),w],placeholder:"请选择","label-field":"username","value-field":"id",options:r(L).data,onScroll:l},null,8,["value","options"])]),_:1}),n(E,{span:"24  s:12 m:4",class:"pr-24px"},{default:a(()=>[n(ke,{class:"w-full"},{default:a(()=>[n(Te,{type:"primary",ghost:"",onClick:Y},{icon:a(()=>[n(ne,{class:"text-icon"})]),default:a(()=>[T(" "+b(r(Z)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),kt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},xt={key:0};function me(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Je(S)}const Ut=le({name:"projectmanagement_daylog",__name:"index",props:{pid:{default:void 0},type:{}},emits:["thereIsData"],setup(S,{emit:Q}){const t=Ae(),M=ie(),d=S,{columns:$,data:o,getData:_,loading:g,mobilePagination:I,searchParams:C}=nt({showTotal:!0,immediate:!1,apiFn:tt,apiParams:{page:1,pageSize:20,limit:20,statrtTime:void 0,endTime:void 0,creater:void 0,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:p=>n("div",null,[p.username+"的项目日报"])},{key:"charctras",title:"字符数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:Z("common.operate"),align:"center",width:140,fixed:"right",render:p=>{let m;return n("div",{class:"flex-center gap-8px"},[n(B,{type:"primary",ghost:!0,size:"small",onClick:()=>G(p)},{default:()=>[T("查看详情")]}),M.userInfo.id==p.creater&&O(n(B,{type:"primary",ghost:!0,size:"small",onClick:()=>F(p.id)},me(m=Z("common.edit"))?m:{default:()=>[m]}),[[te("no-auth"),"project:DailyReport:update"]]),M.userInfo.id==p.creater&&n(be,{onPositiveClick:()=>H(p.id)},{default:()=>Z("common.confirmDelete"),trigger:()=>{let z;return O(n(B,{type:"error",ghost:!0,size:"small"},me(z=Z("common.delete"))?z:{default:()=>[z]}),[[te("no-auth"),"project:DailyReport:delete"]])}})])}}]}),{drawerVisible:j,operateType:L,editingData:A,handleAdd:u,handleEdit:l,checkedRowKeys:w,onDeleted:k}=ot(o,_);async function H(p){const{data:m,error:z}=await at(p);z||k()}function F(p){l(p)}const P=N(!1),q=N({}),G=p=>{P.value=!0,q.value=p},y=()=>{_()},W=N(""),h=p=>{W.value=p};return ye(()=>{d.type!="externalLiaison"}),(p,m)=>{const z=we,Y=Ce,U=Ye,X=he,s=te("no-auth");return v(),K("div",kt,[d.pid?R("",!0):(v(),D(Tt,{key:0,model:r(C),"onUpdate:model":m[0]||(m[0]=e=>oe(C)?C.value=e:null),onReset:y,onSearch:r(_),onSetPname:h},null,8,["model","onSearch"])),n(X,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},We({header:a(()=>[n(z,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>[d.pid?R("",!0):(v(),K("div",xt,"项目日报"))]),_:1}),d.pid?O((v(),D(r(B),{key:0,onClick:r(u),size:"small",ghost:"",type:"primary"},{icon:a(()=>[n(Y,{class:"text-icon"})]),default:a(()=>[m[4]||(m[4]=T(" "+b("新增")))]),_:1,__:[4]},8,["onClick"])),[[s,"project:DailyReport:insert"]]):R("",!0)]),default:a(()=>[n(U,{"checked-row-keys":r(w),"onUpdate:checkedRowKeys":m[1]||(m[1]=e=>oe(w)?w.value=e:null),columns:r($),data:r(o),size:"small","flex-height":!r(t).isMobile,loading:r(g),remote:"","row-key":e=>e.id,pagination:r(I),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),n(et,{visible:r(j),"onUpdate:visible":m[2]||(m[2]=e=>oe(j)?j.value=e:null),onSubmitted:r(_),"operate-type":r(L),pname:W.value,pid:d.pid||r(C).pid,"row-data":r(A)},null,8,["visible","onSubmitted","operate-type","pname","pid","row-data"]),n(bt,{visible:P.value,"onUpdate:visible":m[3]||(m[3]=e=>P.value=e),"row-data":q.value},null,8,["visible","row-data"])]),_:2},[d.pid?void 0:{name:"header-extra",fn:a(()=>[n(z,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[O((v(),D(r(B),{onClick:r(u),size:"small",ghost:"",type:"primary"},{icon:a(()=>[n(Y,{class:"text-icon"})]),default:a(()=>[m[5]||(m[5]=T(" "+b("新增")))]),_:1,__:[5]},8,["onClick"])),[[s,"project:DailyReport:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{Ut as default};
