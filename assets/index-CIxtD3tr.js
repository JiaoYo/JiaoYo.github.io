import{_ as se}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CCvnnz1-.js";import{_ as le}from"./export-Dxi7SdSG.js";import{_ as ie}from"./round-delete-wrLYiM23.js";import{_ as re}from"./round-add-D0WrdfTG.js";import{d as K,n as E,p as H,r as me,j as W,q as X,a6 as A,b as ue,$ as _,o as B,c as V,w as t,g as e,h as f,t as C,i as a,ej as ce,ek as pe,H as Y,K as G,af as Z,L as ee,B as D,ak as de,c5 as _e,ai as fe,el as ge,a1 as te,em as ve,aN as ye,z as q,y as I,en as he,e as be,al as F,aa as L,am as we}from"./index-Pu-ecW3m.js";import{u as xe,a as ke}from"./table-B-tC3aJN.js";import{_ as ae}from"./FormItemGridItem-BuP4tzlJ.js";import{_ as Ne,a as De}from"./RadioGroup-CdePeEWq.js";import{_ as ne}from"./Grid-cx5oYJRf.js";import{_ as Ce}from"./round-search-BTMYWU48.js";import{_ as ze}from"./round-refresh-CjnR0Dcy.js";import{_ as Se}from"./DatePicker-M3pgg8Qp.js";import{e as Te}from"./exportExcel-Bv4G4H50.js";import{N as J}from"./Popconfirm-Dhct3qWO.js";import{_ as Ue}from"./DataTable-BT2dbSfK.js";import"./TimePicker-DdM3oWJk.js";import"./Forward-Bwa4pvoO.js";const $e=K({name:"maintenancePlan",__name:"maintenancePlan_model",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(g,{emit:z}){const m=H(g,"visible"),s=z,u=g,l=me(b());function b(){return{mname:"",mtext:"",mstatus:1,createrid:void 0}}const v=W([]),S=async()=>{var p;if(!v.value.length){const{data:n,error:o}=await _e({page:1,limit:1e3});o||(v.value=((p=JSON.parse(JSON.stringify(n)))==null?void 0:p.list)||[])}},w=()=>{Object.assign(l,b()),u.operateType==="edit"&&u.rowData&&Object.assign(l,u.rowData),S()},{formRef:T,validate:U,restoreValidation:$}=X();A(()=>u.rowData,w),A(m,p=>{p&&(w(),$())});const c=()=>{m.value=!1},i=async()=>{var o;await U();const p=u.operateType==="add"?ce:pe,{error:n}=await p([l]);n||((o=window.$message)==null||o.success(u.operateType==="add"?"添加成功":"修改成功"),c(),s("submitted"))},R={mname:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},mtext:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},mstatus:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},createrid:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]}},x=ue(()=>({add:_("common.add"),edit:_("common.edit")})[u.operateType]);return(p,n)=>{const o=Y,r=ae,k=Ne,N=G,P=De,j=Z,M=ne,y=ee,O=D,d=G,oe=de;return B(),V(oe,{show:m.value,"onUpdate:show":n[4]||(n[4]=h=>m.value=h),title:x.value,preset:"card",class:"w-600px"},{footer:t(()=>[e(d,{size:16,justify:"center"},{default:t(()=>[e(O,{onClick:c,class:"w-100px"},{default:t(()=>[f(C(a(_)("common.cancel")),1)]),_:1}),e(O,{type:"primary",class:"w-100px",onClick:i},{default:t(()=>[f(C(a(_)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(y,{ref_key:"formRef",ref:T,model:l,rules:R,"label-placement":"left","label-width":"100","require-mark-placement":"left"},{default:t(()=>[e(M,{responsive:"screen","item-responsive":""},{default:t(()=>[e(r,{span:"24",label:"检修名称",path:"mname"},{default:t(()=>[e(o,{value:l.mname,"onUpdate:value":n[0]||(n[0]=h=>l.mname=h),clearable:"",maxlength:"64",placeholder:"请输入"},null,8,["value"])]),_:1}),e(r,{span:"24",label:"检修状态",path:"mstatus"},{default:t(()=>[e(P,{value:l.mstatus,"onUpdate:value":n[1]||(n[1]=h=>l.mstatus=h)},{default:t(()=>[e(N,null,{default:t(()=>[e(k,{value:0},{default:t(()=>[f("已检修")]),_:1}),e(k,{value:1},{default:t(()=>[f("未检修")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),e(r,{span:"24",label:"检修人",path:"createrid"},{default:t(()=>[e(j,{value:l.createrid,"onUpdate:value":n[2]||(n[2]=h=>l.createrid=h),filterable:"",placeholder:"选择",options:v.value,"label-field":"username","value-field":"id"},null,8,["value","options"])]),_:1}),e(r,{span:"24",label:"检修内容",path:"mtext"},{default:t(()=>[e(o,{value:l.mtext,"onUpdate:value":n[3]||(n[3]=h=>l.mtext=h),clearable:"",type:"textarea",placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Re=K({name:"SearchQuery",__name:"searchQuery",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(g,{emit:z}){const m=z,s=H(g,"model"),{formRef:u,restoreValidation:l}=X(),b=W(null),v=c=>{c?(s.value.startTime=c[0],s.value.endTime=c[1]):(s.value.startTime=void 0,s.value.endTime=void 0),m("search")};async function S(){await l(),s.value.startTime=null,s.value.endTime=null,b.value=null,s.value.fuzzy=null,s.value.mstatus=null,m("reset")}const w=()=>{s.value.fuzzy="",m("search")},T={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()]};async function U(){m("search")}const $=c=>{s.value.mstatus=c,m("search")};return(c,i)=>{const R=Y,x=ae,p=Se,n=Z,o=ze,r=D,k=Ce,N=G,P=ne,j=ee,M=te;return B(),V(M,{bordered:!1,size:"small"},{default:t(()=>[e(j,{ref_key:"formRef",ref:u,model:s.value,"label-placement":"left","show-feedback":!1},{default:t(()=>[e(P,{"y-gap":16,responsive:"screen","item-responsive":""},{default:t(()=>[e(x,{span:"24 s:12 m:6",label:"",class:"pr-24px"},{default:t(()=>[e(R,{value:s.value.fuzzy,"onUpdate:value":i[0]||(i[0]=y=>s.value.fuzzy=y),clearable:"",placeholder:"请输入检修名称",onClear:w},null,8,["value"])]),_:1}),e(x,{span:"24 s:12 m:8",label:"起止时间",class:"pr-24px"},{default:t(()=>[e(p,{value:b.value,"onUpdate:value":i[1]||(i[1]=y=>b.value=y),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":v,clearable:"",shortcuts:T},null,8,["value"])]),_:1}),e(x,{span:"24 s:12 m:5",label:"检修状态",class:"pr-24px"},{default:t(()=>[e(n,{value:s.value.mstatus,"onUpdate:value":[i[2]||(i[2]=y=>s.value.mstatus=y),$],options:a(fe)(a(ge)),filterable:"",placeholder:"请选择检修状态",clearable:"",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(x,{span:"24 s:12 m:5",label:"",class:"pr-24px"},{default:t(()=>[e(N,{class:"w-full"},{default:t(()=>[e(r,{onClick:S},{icon:t(()=>[e(o,{class:"text-icon"})]),default:t(()=>[f(" "+C(c.$t("common.reset")),1)]),_:1}),e(r,{type:"primary",ghost:"",onClick:U},{icon:t(()=>[e(k,{class:"text-icon"})]),default:t(()=>[f(" "+C(c.$t("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Pe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Q(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!we(g)}const Xe=K({name:"stationmanagement_maintenanceplan",__name:"index",setup(g){const{columns:z,columnChecks:m,data:s,getData:u,loading:l,mobilePagination:b,searchParams:v,resetSearchParams:S}=xe({apiFn:ve,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"mname",title:"检修名称",align:"center",width:140},{key:"creater",title:"检修人",align:"center",width:100},{key:"mstatus",title:"检修状态",align:"center",width:140,render:n=>e(ye,{type:n.mstatus===0?"success":"warning"},{default:()=>[n.mstatus===0?"已检修":"未检修"]})},{key:"dbtime",title:"检修时间",align:"center",width:140},{key:"mtext",title:"检修内容",align:"center",width:100},{key:"operate",title:_("common.operate"),align:"center",width:200,fixed:"right",render:n=>{let o;return e("div",{class:"flex-center gap-8px"},[q(e(D,{type:"primary",ghost:!0,size:"small",onClick:()=>c(n.id)},Q(o=_("common.edit"))?o:{default:()=>[o]}),[[I("no-auth"),"maintenance:update"]]),q(e(J,{onPositiveClick:()=>p([n.id])},{default:()=>_("common.confirmDelete"),trigger:()=>{let r;return e(D,{type:"error",ghost:!0,size:"small"},Q(r=_("common.delete"))?r:{default:()=>[r]})}}),[[I("no-auth"),"'maintenance:delete'"]])])}}]}),{drawerVisible:w,operateType:T,editingData:U,handleAdd:$,handleEdit:c,checkedRowKeys:i,onDeleted:R}=ke(s,u),x=()=>{Te(s.value.map(({mname:n,mtext:o,mstatus:r,dbtime:k,creater:N})=>({mname:n,mtext:o,mstatus:r===0?"已检修":"未检修",dbtime:k,creater:N})),{mname:"检修名称",mtext:"检修内容",mstatus:"检修状态",dbtime:"检修时间",creater:"检修人"},"检修计划","sheet1")},p=async n=>{if(!n.length)return;const{error:o}=await he({ids:n.join(",")});o||(R(),i.value=[])};return(n,o)=>{const r=G,k=re,N=ie,P=le,j=se,M=Ue,y=te,O=I("no-auth");return B(),be("div",Pe,[e(Re,{model:a(v),"onUpdate:model":o[0]||(o[0]=d=>F(v)?v.value=d:null),onReset:a(S),onSearch:a(u)},null,8,["model","onReset","onSearch"]),e(y,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(r,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[f(" 检修计划 ")]),_:1})]),"header-extra":t(()=>[e(r,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[q((B(),V(a(D),{onClick:a($),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(k,{class:L(["text-icon",{"animate-spin":a(l)}])},null,8,["class"])]),default:t(()=>[f(" "+C(a(_)("common.add")),1)]),_:1},8,["onClick"])),[[O,"maintenance:insert"]]),q((B(),V(a(J),{onPositiveClick:o[1]||(o[1]=d=>p(a(i)))},{trigger:t(()=>[e(a(D),{size:"small",ghost:"",type:"error",disabled:!a(i).length},{icon:t(()=>[e(N,{class:L(["text-icon",{"animate-spin":a(l)}])},null,8,["class"])]),default:t(()=>[f(" "+C(a(_)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:t(()=>[f(" 确认删除选中的项吗？ ")]),_:1})),[[O,"maintenance:delete"]]),e(a(D),{onClick:x,size:"small",disabled:!a(i).length},{icon:t(()=>[e(P,{class:L(["text-icon",{"animate-spin":a(l)}])},null,8,["class"])]),default:t(()=>[f(" "+C(a(_)("common.export")),1)]),_:1},8,["disabled"]),e(j,{columns:a(m),"onUpdate:columns":o[2]||(o[2]=d=>F(m)?m.value=d:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(M,{"checked-row-keys":a(i),"onUpdate:checkedRowKeys":o[3]||(o[3]=d=>F(i)?i.value=d:null),columns:a(z),data:a(s),size:"small",loading:a(l),remote:"","row-key":d=>d.id,pagination:a(b),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e($e,{visible:a(w),"onUpdate:visible":o[4]||(o[4]=d=>F(w)?w.value=d:null),onSubmitted:a(u),"operate-type":a(T),"row-data":a(U)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{Xe as default};
