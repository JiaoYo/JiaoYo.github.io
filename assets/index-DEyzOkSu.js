import{_ as ke}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CCvnnz1-.js";import{_ as Te}from"./round-refresh-CjnR0Dcy.js";import{o as F,e as pe,f as me,d as Z,n as W,j,p as se,r as ne,q as xe,s as Ce,a6 as ae,ab as De,b as Se,$ as U,y as J,c as G,w as t,g as e,h as $,t as V,i as a,z as Q,C as _e,A as Ae,aP as Ue,aQ as $e,af as ee,H as ie,as as Me,K,L as re,B as z,ak as de,ap as ue,ai as oe,aT as qe,ag as ze,ah as Le,ad as Oe,aR as Pe,aN as Ve,v as Be,aS as Re,aa as X,al as te,am as je,an as Fe,a1 as Ee}from"./index-Pu-ecW3m.js";import{_ as Ge}from"./round-add-D0WrdfTG.js";import{_ as Ke}from"./round-search-BTMYWU48.js";import{u as He,a as Je}from"./table-B-tC3aJN.js";import{_ as ce}from"./FormItemGridItem-BuP4tzlJ.js";import{_ as ve,a as fe}from"./RadioGroup-CdePeEWq.js";import{_ as Y,a as Qe}from"./Grid-cx5oYJRf.js";import{p as We}from"./gather-DIblcgKP.js";import{_ as Xe}from"./Tree-DvOW-YrF.js";import{y as Ye}from"./common-BejU61Xj.js";import{N as Ze}from"./Popconfirm-Dhct3qWO.js";import{_ as et}from"./InputGroupLabel-CHW2Sx5V.js";import{_ as tt}from"./DataTable-BT2dbSfK.js";import"./Forward-Bwa4pvoO.js";const lt={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},nt=me("path",{fill:"currentColor",d:"M11 13v3q0 .425.288.713T12 17t.713-.288T13 16v-3h3q.425 0 .713-.288T17 12t-.288-.712T16 11h-3V8q0-.425-.288-.712T12 7t-.712.288T11 8v3H8q-.425 0-.712.288T7 12t.288.713T8 13zm1 9q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1),at=[nt];function ot(k,B){return F(),pe("svg",lt,[...at])}const st={name:"material-symbols-add-circle-outline-rounded",render:ot},it=me("span",null,"批量新增：格式为（转发设备1-10）",-1),rt=Z({__name:"add_model",props:W({operateType:{},rowData:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:W(["submitted"],["update:visible"]),setup(k,{emit:B}){const _=j(!1),T=se(k,"visible"),C=B,c=k,n=ne(D());function D(){return{devName:"转发设备1",chlId:void 0,devCommAddr:"1",devPubAddr:"1",devValid:1,devDesc:"",reserve0:"",reserve1:""}}const d=ne({channelList:[]});async function h(){const{data:x,error:r}=await ue({type:1});r||(d.channelList=x)}async function L(){await h(),c.operateType==="edit"&&c.rowData?Object.assign(n,c.rowData):(Object.assign(n,D()),n.chlId=c.chlId||d.channelList[0].id)}const{formRef:b,validate:v,restoreValidation:i}=xe();Ce(),ae(()=>c.rowData,()=>{L()}),ae(T,()=>{T.value&&(c.operateType==="add"&&De(()=>{setTimeout(()=>{_.value=!0},200)}),L(),i())});const p=()=>{T.value=!1,_.value=!1},y=async()=>{var x;if(await v(),c.operateType==="add"){let r=[],m=n.devName;if(((x=n.devName)==null?void 0:x.indexOf("-"))!=-1){let R=Math.abs(m==null?void 0:m.substring(m.lastIndexOf("-")).replace(/[^0-9]/gi,"")),P=m.split(/-(?![^-]*-)/),o=m.substring(0,m.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],l=o.replace(/[^0]/g,""),s=o,q=P[0],I=q.substring(0,q.length-q.match(/(\d+)[^0-9]*$/)[1].length),H=R-o+1;for(let E=0;E<H;E++){let f=s++,u=JSON.parse(JSON.stringify(n));u.devName=parseInt(o)==0?l.length>0?String(f).length>=l.length?I+f:I+l.substring(0,l.length-String(f).length)+f:I+f:l.length>0?f>=10?I+l.substring(0,l.length-String(f).length+1)+f:I+l.substring(0,l.length)+f:I+f,u.devCommAddr=Number(n.devCommAddr)+E,r.push(u)}}else r=[n];const{data:N,error:A}=await Ue(r);A?console.log("error",A):(console.log("success",N),p(),C("submitted"))}else{const{data:r,error:m}=await $e([n]);m?console.log("error",m):(console.log("success",r),p(),C("submitted"))}},w={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},M={devName:w,chlId:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},devCommAddr:w,devPubAddr:w},S=Se(()=>({add:U("common.add"),edit:U("common.edit")})[c.operateType]);return(x,r)=>{const m=ee,N=ce,A=ie,R=Me,P=ve,o=K,l=fe,s=Y,q=re,I=z,H=K,E=de,f=J("no-space");return F(),G(E,{show:T.value,"onUpdate:show":r[6]||(r[6]=u=>T.value=u),title:S.value,preset:"card",class:"w-30%",onAfterLeave:p},{footer:t(()=>[e(H,{size:16,justify:"center"},{default:t(()=>[e(I,{onClick:p,class:"w-100px"},{default:t(()=>[$(V(a(U)("common.cancel")),1)]),_:1}),e(I,{type:"primary",class:"w-100px",onClick:y},{default:t(()=>[$(V(a(U)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(q,{ref_key:"formRef",ref:b,model:n,rules:M,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:Ae(y,["enter"])},{default:t(()=>[e(s,{responsive:"screen","item-responsive":""},{default:t(()=>[e(N,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(m,{filterable:"",placeholder:"请选择所属通道",value:n.chlId,"onUpdate:value":r[0]||(r[0]=u=>n.chlId=u),"label-field":"chlName","value-field":"id",options:d.channelList},null,8,["value","options"])]),_:1}),e(N,{span:"24 m:24",label:"设备名称",path:"devName"},{default:t(()=>[e(R,{show:_.value,placement:"right-start"},{trigger:t(()=>[Q(e(A,{clearable:"",value:n.devName,"onUpdate:value":r[1]||(r[1]=u=>n.devName=u),maxlength:"64",placeholder:"请输入设备名称"},null,8,["value"]),[[f]])]),default:t(()=>[it]),_:1},8,["show"])]),_:1}),e(N,{span:"24 m:24",label:"通讯地址",path:"devCommAddr"},{default:t(()=>[e(A,{clearable:"",value:n.devCommAddr,"onUpdate:value":r[2]||(r[2]=u=>n.devCommAddr=u),maxlength:"50",placeholder:"请输入通讯地址"},null,8,["value"])]),_:1}),e(N,{span:"24 m:24",label:"公共地址",path:"devPubAddr"},{default:t(()=>[e(A,{clearable:"",value:n.devPubAddr,"onUpdate:value":r[3]||(r[3]=u=>n.devPubAddr=u),placeholder:"请输入公共地址"},null,8,["value"])]),_:1}),c.operateType=="edit"?(F(),G(N,{key:0,span:"24 m:24",label:"设备有效性",path:"devValid"},{default:t(()=>[e(l,{value:n.devValid,"onUpdate:value":r[4]||(r[4]=u=>n.devValid=u),name:"radiogroup"},{default:t(()=>[e(o,null,{default:t(()=>[e(P,{label:"是",value:1}),e(P,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):_e("",!0),e(N,{span:"24 m:24",label:"设备描述",path:"devDesc"},{default:t(()=>[e(A,{clearable:"",value:n.devDesc,"onUpdate:value":r[5]||(r[5]=u=>n.devDesc=u),maxlength:"64",placeholder:"请输入设备描述",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),dt=Z({__name:"batch_addModel",props:W({chlList:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:W(["submitted"],["update:visible"]),setup(k,{emit:B}){const _=se(k,"visible"),T=k,C=B,c=j([]),n=async()=>{const{data:v,error:i}=await ue({type:0});i||(c.value=v.map(p=>{var y;return{label:p.chlName,key:p.id,children:(y=p.devicePojoList)==null?void 0:y.map(w=>({label:w.devName,key:w.id}))}}))};ae(()=>_.value,async v=>{v&&(n(),d.value.chlId=T.chlId)});const D=j(null),d=j({devIds:[],chlId:void 0,pre:void 0,valid:1,tagType:void 0,enbleType:!0}),h=async()=>{var p,y;const{data:v,error:i}=await qe({...d.value,devIds:(p=d.value.devIds)==null?void 0:p.join(",")});i||((y=window.$message)==null||y.success("新增成功"),_.value=!1,C("submitted"))},L={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},b={chlId:L,tagType:L};return(v,i)=>{const p=Xe,y=ze,w=Qe,O=ee,M=ce,S=ie,x=ve,r=K,m=fe,N=Y,A=re,R=Y,P=z,o=K,l=de;return F(),G(l,{show:_.value,"onUpdate:show":i[7]||(i[7]=s=>_.value=s),title:"批量新增",preset:"card",class:"w-40%"},{footer:t(()=>[e(o,{size:16,justify:"center"},{default:t(()=>[e(P,{onClick:i[6]||(i[6]=s=>_.value=!1),class:"w-100px"},{default:t(()=>[$(V(v.$t("common.cancel")),1)]),_:1}),e(P,{type:"primary",class:"w-100px",onClick:h},{default:t(()=>[$(V(v.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(R,{"x-gap":"12"},{default:t(()=>[e(w,{span:8},{default:t(()=>[e(y,{style:{"max-height":"220px"}},{default:t(()=>[e(p,{"block-line":"",data:c.value,"checked-keys":d.value.devIds,"onUpdate:checkedKeys":i[0]||(i[0]=s=>d.value.devIds=s),"expand-on-click":"","default-expand-all":!0,checkable:""},null,8,["data","checked-keys"])]),_:1})]),_:1}),e(w,{span:16},{default:t(()=>[e(A,{ref_key:"formRef",ref:D,"label-width":140,"label-placement":"left",model:d.value,rules:b},{default:t(()=>[e(N,{responsive:"screen","item-responsive":""},{default:t(()=>[e(M,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(O,{filterable:"",placeholder:"请选择所属通道",value:d.value.chlId,"onUpdate:value":i[1]||(i[1]=s=>d.value.chlId=s),"label-field":"chlName","value-field":"id",options:T.chlList},null,8,["value","options"])]),_:1}),e(M,{span:"24 m:24",label:"转发设备前缀",path:"pre"},{default:t(()=>[e(S,{value:d.value.pre,"onUpdate:value":i[2]||(i[2]=s=>d.value.pre=s),style:{width:"100%"},placeholder:"请输入转发设备前缀(可空)"},null,8,["value"])]),_:1}),e(M,{span:"24 m:24",label:"是否匹配测点类型",path:"enbleType"},{default:t(()=>[e(m,{value:d.value.enbleType,"onUpdate:value":i[3]||(i[3]=s=>d.value.enbleType=s),name:"radiogroup"},{default:t(()=>[e(r,null,{default:t(()=>[e(x,{label:"是",value:!0}),e(x,{label:"否",value:!1})]),_:1})]),_:1},8,["value"])]),_:1}),d.value.enbleType==!1?(F(),G(M,{key:0,span:"24 m:24",label:"测点类型",path:"tagType"},{default:t(()=>[e(O,{filterable:"",placeholder:"请选择测点类型",value:d.value.tagType,"onUpdate:value":i[4]||(i[4]=s=>d.value.tagType=s),options:a(oe)(a(We))},null,8,["value","options"])]),_:1})):_e("",!0),e(M,{span:"24 m:24",label:"设备有效性",path:"valid"},{default:t(()=>[e(m,{value:d.value.valid,"onUpdate:value":i[5]||(i[5]=s=>d.value.valid=s),name:"radiogroup"},{default:t(()=>[e(r,null,{default:t(()=>[e(x,{label:"是",value:1}),e(x,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1},8,["show"])}}}),ut=Z({__name:"move_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:W(["submitted"],["update:visible"]),setup(k,{emit:B}){const T=Le({0:"采集104tcp",1:"采集104udp"}),C=se(k,"visible"),c=j(null),n=j({targetDevice:void 0,EquipmentMerged:void 0}),D=()=>{},h={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}};return(L,b)=>{const v=ee,i=ce,p=Y,y=re,w=z,O=K,M=de;return F(),G(M,{show:C.value,"onUpdate:show":b[3]||(b[3]=S=>C.value=S),title:"设备移动至通道",preset:"card",class:"w-40%"},{footer:t(()=>[e(O,{size:16,justify:"center"},{default:t(()=>[e(w,{onClick:b[2]||(b[2]=S=>C.value=!1),class:"w-100px"},{default:t(()=>[$(V(L.$t("common.cancel")),1)]),_:1}),e(w,{type:"primary",class:"w-100px",onClick:D},{default:t(()=>[$(V(L.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(y,{ref_key:"formRef",ref:c,"label-width":120,"label-placement":"left",model:n.value,rules:h},{default:t(()=>[e(p,{responsive:"screen","item-responsive":""},{default:t(()=>[e(i,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:t(()=>[e(v,{filterable:"",clearable:"",placeholder:"请选择通道",value:n.value.targetDevice,"onUpdate:value":b[0]||(b[0]=S=>n.value.targetDevice=S),options:a(oe)(a(T))},null,8,["value","options"])]),_:1}),e(i,{span:"24 m:12",label:"待移动设备",path:"EquipmentMerged"},{default:t(()=>[e(v,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.EquipmentMerged,"onUpdate:value":b[1]||(b[1]=S=>n.value.EquipmentMerged=S),options:a(oe)(a(T))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),ct={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function le(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!je(k)}const Dt=Z({name:"configsetting_forwardingservice_forwardingdevicemanagement",__name:"index",setup(k){const B=Oe(),_=ne({channelList:[],chlIdAndNameMap:{}}),{columns:T,columnChecks:C,data:c,getData:n,loading:D,mobilePagination:d,searchParams:h,resetSearchParams:L}=He({apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,type:1,chlId:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"设备ID",align:"center",width:60},{key:"devName",title:"设备名称",align:"center",width:100},{key:"chlId",title:"所属通道",align:"center",width:140,render:o=>e("span",null,[_.chlIdAndNameMap[o.chlId]])},{key:"devDesc",title:"设备描述",align:"center",width:140,render:o=>e("span",null,[o.devDesc?o.devDesc:"无"])},{key:"devCommAddr",title:"设备通信地址",align:"center",width:140},{key:"devPubAddr",title:"设备公共地址",align:"center",width:140},{key:"devValid",title:"有效性",align:"center",width:140,render:o=>{let l;return e(Ve,{type:o.devValid==0?"error":"success"},le(l=U(Ye[o.devValid]))?l:{default:()=>[l]})}},{key:"operate",title:U("common.operate"),align:"center",width:240,fixed:"right",render:o=>{let l;return e("div",{class:"flex-center gap-8px"},[e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>P(o)},{default:()=>["转发测点管理"]}),Q(e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>r(o.id)},le(l=U("common.edit"))?l:{default:()=>[l]}),[[J("no-auth"),"device:update"]]),Q(e(Ze,{onPositiveClick:()=>x(o.id)},{default:()=>U("common.confirmDelete"),trigger:()=>{let s;return e(z,{type:"error",ghost:!0,size:"small"},le(s=U("common.delete"))?s:{default:()=>[s]})}}),[[J("no-auth"),"device:delete"]])])}}]});async function b(){var s;const{data:o,error:l}=await ue({type:1});if(!l){if(o.length==0)return(s=window.$message)==null?void 0:s.warning("暂无转发通道，请先添加通道");_.channelList=o,o.forEach(I=>{_.chlIdAndNameMap[I.id]=I.chlName});const q=B.currentRoute.value.query.channelId;q&&(h.chlId=Number(q)),n()}}Be(()=>{b()});const{drawerVisible:v,operateType:i,editingData:p,handleAdd:y,handleEdit:w,checkedRowKeys:O,onBatchDeleted:M,onDeleted:S}=Je(c,n),x=async o=>{const{data:l,error:s}=await Re({ids:o});s||S()},r=o=>{w(o)},m=o=>{h.chlId=o,n()},N=j(!1),A=()=>{N.value=!0},R=j(!1),P=o=>{B.push({path:"/configsetting/forwardingservice/forwardingpointmanagement",query:{channelId:o.chlId,deviceId:o.id}})};return(o,l)=>{const s=et,q=ee,I=ie,H=Ke,E=Fe,f=K,u=Ge,ge=st,he=Te,be=ke,ye=tt,we=Ee,Ne=J("no-space"),Ie=J("no-auth");return F(),pe("div",ct,[e(we,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(f,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(E,null,{default:t(()=>[e(s,null,{default:t(()=>[$("所属通道")]),_:1}),e(q,{filterable:"",clearable:"",placeholder:"请选择通道",value:a(h).chlId,"onUpdate:value":l[0]||(l[0]=g=>a(h).chlId=g),"label-field":"chlName","value-field":"id",options:_.channelList,onUpdateValue:m},null,8,["value","options"]),e(s,null,{default:t(()=>[$("设备名称")]),_:1}),Q(e(I,{clearable:"",value:a(h).fuzzy,"onUpdate:value":l[1]||(l[1]=g=>a(h).fuzzy=g),placeholder:"请输入设备名称",style:{width:"100%"}},null,8,["value"]),[[Ne]]),e(a(z),{type:"primary",ghost:"",onClick:a(n)},{icon:t(()=>[e(H,{class:X(["text-icon",{"animate-spin":a(D)}])},null,8,["class"])]),default:t(()=>[$(" "+V(a(U)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":t(()=>[e(f,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[Q((F(),G(a(z),{onClick:a(y),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(u,{class:X(["text-icon",{"animate-spin":a(D)}])},null,8,["class"])]),default:t(()=>[$(" "+V(a(U)("common.add")),1)]),_:1},8,["onClick"])),[[Ie,"device:insert"]]),e(a(z),{onClick:A,size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(ge,{class:X(["text-icon",{"animate-spin":a(D)}])},null,8,["class"])]),default:t(()=>[$(" "+V("批量新增"))]),_:1}),e(a(z),{onClick:a(n),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(he,{class:X(["text-icon",{"animate-spin":a(D)}])},null,8,["class"])]),_:1},8,["onClick"]),e(be,{columns:a(C),"onUpdate:columns":l[2]||(l[2]=g=>te(C)?C.value=g:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ye,{"checked-row-keys":a(O),"onUpdate:checkedRowKeys":l[3]||(l[3]=g=>te(O)?O.value=g:null),columns:a(T),data:a(c),size:"small",loading:a(D),remote:"","row-key":g=>g.id,pagination:a(d),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(rt,{visible:a(v),"onUpdate:visible":l[4]||(l[4]=g=>te(v)?v.value=g:null),onSubmitted:a(n),"operate-type":a(i),"row-data":a(p),chlId:a(h).chlId},null,8,["visible","onSubmitted","operate-type","row-data","chlId"]),e(dt,{visible:N.value,"onUpdate:visible":l[5]||(l[5]=g=>N.value=g),chlList:_.channelList,chlId:a(h).chlId,onSubmitted:a(n)},null,8,["visible","chlList","chlId","onSubmitted"]),e(ut,{visible:R.value,"onUpdate:visible":l[6]||(l[6]=g=>R.value=g)},null,8,["visible"])]),_:1})])}}});export{Dt as default};
