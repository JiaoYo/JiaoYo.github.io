import{_ as ve}from"./round-add-Dxx1Q5ac.js";import{d as Q,aw as X,q as W,v as re,s as ie,a as ge,ay as ne,bZ as ce,ef as ye,eg as he,at as Z,c as I,o as x,w as t,f as e,G as oe,z as K,A as de,h as n,au as ue,C as V,N as le,B as N,g as T,t as w,$ as B,aF as be,ct as pe,aI as te,aN as we,r as J,eh as xe,y as G,bh as ke,D as R,e as v,aP as A,b as H,T as Se,F as me,cJ as Ce,aT as je,aX as Te,bj as De,ei as Pe,ej as Ne,av as ze,U as fe,b4 as Ue,M as Ie,i as $e,aO as ee,cO as Le,aA as Me,ek as Fe,el as Be,aU as Re}from"./index-BG16ZifG.js";import{u as Oe,a as qe}from"./table-B-6Bq47M.js";import{u as ae}from"./usePageData-D966OD4e.js";import{_ as Ee,a as Ae}from"./text-WD1kSkGM.js";import{N as _e}from"./Popconfirm-CW7rsSN1.js";import{_ as Ve}from"./round-search-0CRuG0ER.js";import{_ as He}from"./Grid-52o7xY5h.js";import{_ as Ke}from"./FormItemGridItem-CVMlyKk-.js";const Ge=Q({name:"OperateDrawer",__name:"operate-drawer",props:X({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(S,{emit:M}){const o=W(),z=M,c=S,l=re(h());function h(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null}}const f={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施"}},{pageData:m,getData:$,nextPage:U}=ae(pe),y=async r=>{const a=r.currentTarget,i=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&m.data.length<m.total&&(await U(),await te(),setTimeout(()=>{a.scrollTop=i}))},D=async r=>{r?l.pid=r:l.value.pid=null},F=async()=>{var r,a;if(await $({fuzzy:(r=o.userInfo)==null?void 0:r.pname,page:1}),m.data.length==0)return(a=window.$message)==null?void 0:a.warning("没有项目")},_=()=>{$({page:1})};async function s(){Object.assign(l,h()),await F(),c.pid&&(m.data.forEach(r=>{r.id==c.pid&&(r.disabled=!0)}),l.pid=c.pid),c.operateType==="edit"&&c.rowData&&Object.assign(l,c.rowData)}const{formRef:k,validate:b,restoreValidation:L}=ie(),O=ge(()=>({add:"新增项目总结",edit:"修改项目总结"})[c.operateType]),C=ne(S,"visible"),u=()=>{C.value=!1},p=ce.debounce(async()=>{var r,a;if(await b(),c.operateType==="edit"){const{data:i,error:d}=await ye([{...l}]);d||((r=window.$message)==null||r.success("修改成功"),z("submitted"),u())}else{const{data:i,error:d}=await he([{pid:l.pid,content1:l.content1,content2:l.content2,content3:l.content3,content4:l.content4,content5:l.content5}]);d||((a=window.$message)==null||a.success("添加成功"),z("submitted"),u())}},1e3,{leading:!0,trailing:!1});return Z(C,()=>{C.value&&(s(),setTimeout(()=>{const r=document.querySelector(".n-scrollbar-content");r==null||r.scrollTo(0,0)},300),L())}),(r,a)=>{const i=de,d=oe,j=le,q=be;return x(),I(q,{show:C.value,"onUpdate:show":a[6]||(a[6]=g=>C.value=g),title:O.value,preset:"card",class:"w-570px"},{footer:t(()=>[e(j,{justify:"end"},{default:t(()=>[e(n(N),{size:"small",class:"mt-16px",onClick:u},{default:t(()=>[T(w(n(B)("common.cancel")),1)]),_:1}),e(n(N),{type:"primary",size:"small",class:"mt-16px",onClick:n(p)},{default:t(()=>[T(w(n(B)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(d,{ref_key:"formRef",ref:k,model:l,rules:f},{default:t(()=>[c.operateType==="add"?(x(),I(i,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:t(()=>[e(n(ue),{clearable:"",filterable:"",value:l.pid,"onUpdate:value":[a[0]||(a[0]=g=>l.pid=g),D],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:_,options:n(m).data,onScroll:y},null,8,["value","options"])]),_:1})):K("",!0),e(i,{label:"前期准备阶段描述",path:"content1"},{default:t(()=>[e(n(V),{clearable:"",type:"textarea",value:l.content1,"onUpdate:value":a[1]||(a[1]=g=>l.content1=g),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),e(i,{label:"遇到问题及对项目的影响",path:"content2"},{default:t(()=>[e(n(V),{clearable:"",type:"textarea",value:l.content2,"onUpdate:value":a[2]||(a[2]=g=>l.content2=g),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),e(i,{label:"经验教训与改进方案或措施",path:"content3"},{default:t(()=>[e(n(V),{clearable:"",type:"textarea",value:l.content3,"onUpdate:value":a[3]||(a[3]=g=>l.content3=g),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(i,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:t(()=>[e(n(V),{clearable:"",type:"textarea",value:l.content4,"onUpdate:value":a[4]||(a[4]=g=>l.content4=g),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(i,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:t(()=>[e(n(V),{clearable:"",type:"textarea",value:l.content5,"onUpdate:value":a[5]||(a[5]=g=>l.content5=g),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Je={class:"mt-4 border-t pt-3"},Xe={class:"flex items-start gap-2 mb-3"},Ze={class:"ml-2 flex-1"},Qe={class:"flex items-center"},We={class:"font-medium font-size-16px font-bold"},Ye={class:"text-gray-600 mt-1"},et=Q({name:"drawerLog",__name:"drawerLog",props:X({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(S){const M=W();we();const o=re({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""}),z=S,c={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},l=J({});async function h(){f.value=[],Object.assign(o,z.rowData),y()}const f=J([]),m=ne(S,"visible");Z(m,()=>{m.value?h():(f.value=[],o.id=void 0)});function $(_){_||U()}function U(){m.value=!1}const y=async()=>{const{data:_,error:s}=await Pe({page:1,limit:100,pid:o.id});_&&(f.value=_.list)},D=ce.debounce(async()=>{var b;const _=l.value[o.id];if(!(_!=null&&_.trim()))return(b=window.$message)==null?void 0:b.warning("请输入评论内容");const{data:s,error:k}=await xe([{pid:o.id,content:_}]);s&&(l.value[o.id]="",o.num++,y())},1e3,{leading:!0,trailing:!1}),F=async _=>{var b;const{data:s,error:k}=await Ne(_.id);s&&(y(),o.num--,(b=window.$message)==null||b.success("删除成功"))};return(_,s)=>{const k=de,b=oe,L=Ee,O=Ae,C=ke,u=De,p=G("i"),r=G("no-auth");return x(),I(u,{show:m.value,"onUpdate:show":[s[1]||(s[1]=a=>m.value=a),$],"display-directive":"show",width:600,onMaskClick:U,onEsc:U},{default:t(()=>[e(C,{title:o.username+"的项目总结","native-scrollbar":!1,closable:""},{default:t(()=>[e(b,{ref:"formRef",model:o,"show-feedback":!1},{default:t(()=>[e(k,{label:"",path:"contractname"},{label:t(()=>s[2]||(s[2]=[v("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:t(()=>[v("span",{class:A(["preview-text",{textstyle:o.proname}])},w(o.proname),3)]),_:1}),e(k,{label:"前期准备阶段描述",path:"content1"},{label:t(()=>s[3]||(s[3]=[v("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:t(()=>[v("span",{class:A(["preview-text",{textstyle:o.content1}])},w(o.content1),3)]),_:1}),e(k,{label:"遇到问题及对项目的影响",path:"content2"},{label:t(()=>s[4]||(s[4]=[v("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:t(()=>[v("span",{class:A(["preview-text",{textstyle:o.content2}])},w(o.content2),3)]),_:1}),e(k,{label:"经验教训与改进方案或措施",path:"content3"},{label:t(()=>s[5]||(s[5]=[v("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:t(()=>[v("span",{class:A(["preview-text",{textstyle:o.content3}])},w(o.content3),3)]),_:1}),e(k,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:t(()=>s[6]||(s[6]=[v("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:t(()=>[v("span",{class:A(["preview-text",{textstyle:o.content4}])},w(o.content4),3)]),_:1}),e(k,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:t(()=>s[7]||(s[7]=[v("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:t(()=>[v("span",{class:A(["preview-text",{textstyle:o.content5}])},w(o.content5),3)]),_:1})]),_:1},8,["model"]),R((x(),H("div",null,[T(w(o.num)+"评论",1)])),[[p,o.num]]),e(Se,{name:"fade"},{default:t(()=>[v("div",Je,[R((x(),H("div",Xe,[v("div",null,[e(L,{size:"small",src:c.avatar},null,8,["src"])]),e(n(V),{type:"textarea",id:`comment-input-${o.id}`,value:l.value[o.id],"onUpdate:value":s[0]||(s[0]=a=>l.value[o.id]=a),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:me(Ce(n(D),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),e(n(N),{type:"primary",ghost:"",onClick:n(D)},{default:t(()=>s[8]||(s[8]=[T("发送")])),_:1,__:[8]},8,["onClick"])])),[[r,"project:Summary:Comment:insert"]]),(x(!0),H(je,null,Te(f.value,a=>(x(),H("div",{key:a.id,class:"flex mb-3"},[e(L,{size:"small",src:c.avatar},null,8,["src"]),v("div",Ze,[v("div",Qe,[v("span",We,w(a.username),1),e(O,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:t(()=>[T(w(a.dbtime),1)]),_:2},1024),n(M).userInfo.id==a.creater?(x(),I(n(_e),{key:0,onPositiveClick:i=>F(a)},{trigger:t(()=>[R((x(),I(n(N),{quaternary:"",type:"error",size:"small"},{default:t(()=>s[9]||(s[9]=[T(" 删除 ")])),_:1,__:[9]})),[[r,"project:Summary:Comment:delete"]])]),default:t(()=>[s[10]||(s[10]=T(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):K("",!0)]),v("div",Ye,w(a.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),tt=ze(et,[["__scopeId","data-v-f23a3381"]]),at=Q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:X(["reset","search","clear"],["update:model"]),setup(S,{emit:M}){const o=M,{formRef:z}=ie(),c=ne(S,"model"),l=W(),h=J([]),{pageData:f,getData:m,nextPage:$}=ae(pe),U=async u=>{const p=u.currentTarget,r=p.scrollTop;p.scrollTop+p.offsetHeight>=p.scrollHeight&&f.data.length<f.total&&(await $(),h.value=f.data,await te(),setTimeout(()=>{p.scrollTop=r}))},{pageData:y,getData:D,nextPage:F}=ae(Ue),_=async u=>{const p=u.currentTarget,r=p.scrollTop;p.scrollTop+p.offsetHeight>=p.scrollHeight&&y.data.length<y.total&&(await F(),h.value=y.data,await te(),setTimeout(()=>{p.scrollTop=r}))},s=async u=>{c.value.creater=u,o("search")},k=async u=>{var p;u?(c.value.pid=u,o("search"),l.setProjectInfo({pname:(p=h.value.find(r=>r.id==u))==null?void 0:p.proname,pid:u})):o("search")},b=async u=>{await m({fuzzy:u,page:1}),h.value=f.data},L=async()=>{await m({page:1}),h.value=f.data};(async()=>{var u;await m(),h.value=f.data,c.value.pid=l.userInfo.pid?l.userInfo.pid:(u=h.value[0])==null?void 0:u.id,o("search")})(),D({usertypes:"2,3"});async function C(){o("search")}return(u,p)=>{const r=ue,a=Ke,i=Ve,d=N,j=le,q=He,g=oe,Y=fe;return x(),I(Y,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(g,{ref_key:"formRef",ref:z,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:me(C,["enter"])},{default:t(()=>[e(q,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(a,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:t(()=>[e(r,{filterable:"",clearable:"",value:c.value.pid,"onUpdate:value":[p[0]||(p[0]=E=>c.value.pid=E),k],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:h.value,onScroll:U,onClear:L,onSearch:b},null,8,["value","options"])]),_:1}),e(a,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:t(()=>[e(r,{clearable:"",filterable:"",value:c.value.creater,"onUpdate:value":[p[1]||(p[1]=E=>c.value.creater=E),s],placeholder:"请选择","label-field":"username","value-field":"id",options:n(y).data,onScroll:_},null,8,["value","options"])]),_:1}),e(a,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(j,{class:"w-full"},{default:t(()=>[e(d,{type:"primary",ghost:"",onClick:C},{icon:t(()=>[e(i,{class:"text-icon"})]),default:t(()=>[T(" "+w(n(B)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),nt={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ot={key:0};function se(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Re(S)}const ft=Q({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(S,{emit:M}){const o=Ie(),z=W(),c=S,l=M,{columns:h,data:f,getData:m,loading:$,mobilePagination:U,searchParams:y}=Oe({showTotal:!0,immediate:!1,apiFn:Fe,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:i=>e("div",null,[i.username+"的项目总结"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:B("common.operate"),align:"center",width:140,fixed:"right",render:i=>{let d;return e("div",{class:"flex-center gap-8px"},[e(N,{type:"primary",ghost:!0,size:"small",onClick:()=>r(i)},{default:()=>[T("查看详情")]}),z.userInfo.id==i.creater&&R(e(N,{type:"primary",ghost:!0,size:"small",onClick:()=>C(i.id)},se(d=B("common.edit"))?d:{default:()=>[d]}),[[G("no-auth"),"project:Summary:update"]]),z.userInfo.id==i.creater&&e(_e,{onPositiveClick:()=>O(i.id)},{default:()=>B("common.confirmDelete"),trigger:()=>{let j;return R(e(N,{type:"error",ghost:!0,size:"small"},se(j=B("common.delete"))?j:{default:()=>[j]}),[[G("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:D,operateType:F,editingData:_,handleAdd:s,handleEdit:k,checkedRowKeys:b,onDeleted:L}=qe(f,m);async function O(i){const{data:d,error:j}=await Be(i);j||L()}function C(i){k(i)}const u=J(!1),p=J({}),r=i=>{u.value=!0,p.value=i},a=()=>{m()};return Z(()=>c.pid,async i=>{i&&(y.pid=i,await m())}),Z(()=>f.value,async i=>{i.length>0?l("thereIsData",1):l("thereIsData",0)}),$e(()=>{c.type!="externalLiaison"}),(i,d)=>{const j=le,q=ve,g=Me,Y=fe,E=G("no-auth");return x(),H("div",nt,[c.pid?K("",!0):(x(),I(at,{key:0,model:n(y),"onUpdate:model":d[0]||(d[0]=P=>ee(y)?y.value=P:null),onReset:a,onSearch:n(m),onClear:d[1]||(d[1]=P=>f.value=[])},null,8,["model","onSearch"])),e(Y,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Le({header:t(()=>[e(j,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[c.pid?K("",!0):(x(),H("div",ot,"项目总结"))]),_:1}),c.pid?R((x(),I(n(N),{key:0,onClick:n(s),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(q,{class:"text-icon"})]),default:t(()=>[d[5]||(d[5]=T(" "+w("新增")))]),_:1,__:[5]},8,["onClick"])),[[E,"project:Summary:insert"]]):K("",!0)]),default:t(()=>[e(g,{"checked-row-keys":n(b),"onUpdate:checkedRowKeys":d[2]||(d[2]=P=>ee(b)?b.value=P:null),columns:n(h),data:n(f),size:"small","flex-height":!n(o).isMobile,loading:n($),remote:"","row-key":P=>P.id,pagination:n(U),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ge,{visible:n(D),"onUpdate:visible":d[3]||(d[3]=P=>ee(D)?D.value=P:null),onSubmitted:n(m),"operate-type":n(F),pid:c.pid||n(y).pid,"row-data":n(_)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),e(tt,{visible:u.value,"onUpdate:visible":d[4]||(d[4]=P=>u.value=P),"row-data":p.value},null,8,["visible","row-data"])]),_:2},[c.pid?void 0:{name:"header-extra",fn:t(()=>[e(j,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[R((x(),I(n(N),{onClick:n(s),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(q,{class:"text-icon"})]),default:t(()=>[d[6]||(d[6]=T(" "+w("新增")))]),_:1,__:[6]},8,["onClick"])),[[E,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{ft as _};
