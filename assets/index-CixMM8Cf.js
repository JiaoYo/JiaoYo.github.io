import{_ as ce}from"./export-BdHlkXxq.js";import{d as de,Y as pe,z as me,s as p,D as ge,aU as A,f as o,aS as fe,$ as F,aR as he,aF as L,i as ye,b as M,o as y,w as m,e as O,J as _e,N as ve,aM as we,h as j,c as T,G,aI as ke,aA as be,b0 as xe,B as H,g as W,t as J,aD as Ce,em as Te,a2 as Se,ft as Ne,aG as ze,b8 as Re,aV as je,W as We}from"./index-DTejdFLI.js";import{u as $e}from"./usePageData-BjjY6agq.js";import{E as Be,F as De}from"./FileSaver.min-D7FI1YMa.js";import{f as q}from"./business-D1O2jGqr.js";import{_ as Ee}from"./RadioButton-BZrUrTX5.js";import{_ as Ue}from"./DatePicker-CotE2hZN.js";const Ie={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Pe={style:{"margin-top":"20px"}},Ve={style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}};function Ae(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!je(S)}const Fe=de({name:"reportmanagement_debug",__name:"index",setup(S){const Y=pe(),K=me(),g=p("year"),Q=p([{label:"月",value:"month"},{label:"年",value:"year"}]),X=p([{label:"50 每页",value:50},{label:"100 每页",value:100},{label:"500 每页",value:500}]),_=p(1),R=p(500),$=p(0),r=ge({monthTime:String(A(3,null)),yearTime:String(A(4,null)),creater:null}),Z=t=>{g.value=t,_.value=1,f()},N=p([]),f=async()=>{let t={page:_.value,limit:R.value,dates:g.value=="month"?r.monthTime:r.yearTime};r.creater&&(t.userid=r.creater);const{data:e}=await Ne(t);N.value=e.list.map(c=>({...c,userstat:r.creater?"":JSON.parse(c.userstat)})),$.value=Number(e.total)},{pageData:w,getData:ee,nextPage:te}=$e(Re),ae=async t=>{const e=t.currentTarget,c=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&w.data.length<w.total&&(await te(),await ze(),setTimeout(()=>{e.scrollTop=c}))},ne=p(1),le=async t=>{r.creater=t,t||setTimeout(()=>{ne.value++},500),f()};async function B(t){g.value=="month"?r.monthTime=t:r.yearTime=t,_.value=1,f()}function oe(t){return t.map((e,c)=>({key:`group_${e.id}`,align:"center",width:680,title:()=>o("div",{style:{fontWeight:600}},[e.username]),children:[{key:`${e.id}_totalcnt`,title:"全部任务数",width:100,align:"center",className:c==0?"first-user-left":"user-group-left",render:s=>{var a,i;return((i=(a=s.userstat)==null?void 0:a.find(u=>u.uid==e.id))==null?void 0:i.totalcnt)??0}},{key:`${e.id}_finishcnt`,title:"已完成任务数",width:120,align:"center",render:s=>{var a,i;return((i=(a=s.userstat)==null?void 0:a.find(u=>u.uid==e.id))==null?void 0:i.finishcnt)??0}},{key:`${e.id}_finishcntRate`,title:"任务数占比率",width:120,align:"center",render:s=>{var a,i;return(((i=(a=s.userstat)==null?void 0:a.find(u=>u.uid==e.id))==null?void 0:i.finishcntRate)??0)+"%"}},{key:`${e.id}_finishWeight`,title:"已完成权重分",width:120,align:"center",render:s=>{var a,i;return((i=(a=s.userstat)==null?void 0:a.find(u=>u.uid==e.id))==null?void 0:i.finishWeight)??0}},{key:`${e.id}_finishWeightRate`,title:"权重分占比率",width:120,align:"center",render:s=>{var a,i;return(((i=(a=s.userstat)==null?void 0:a.find(u=>u.uid==e.id))==null?void 0:i.finishWeightRate)??0)+"%"}},{key:`${e.id}_score`,title:"得分",width:100,align:"center",render:()=>"",className:"user-group-right"}]}))}const z=p([{key:"proname",title:"项目名称",align:"center",width:240,resizable:!0,fixed:"left",render:t=>o("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[o(fe,{trigger:"hover",style:"maxWidth:500px"},{trigger:()=>o("div",{style:{display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitBoxOrient:"vertical",WebkitLineClamp:1,wordBreak:"break-all",whiteSpace:"normal",cursor:"pointer"},onClick:()=>D(t)},[t.proname||""]),default:()=>t.proname})])},{key:"dtype",title:"调试类型",align:"center",width:100,render:t=>{if(t.dtype===null)return null;const e=F(q[t.dtype]);return o(he,{type:t.dtype==0?"warning":t.dtype==1?"success":"info"},Ae(e)?e:{default:()=>[e]})}},{key:"totalweight",title:"项目总权重分",align:"center",width:140,sorter:(t,e)=>t.totalweight-e.totalweight},{key:"progess",title:"项目进度",align:"center",width:140,sorter:(t,e)=>t.progess-e.progess,render:t=>o(L,{type:"line",showIndicator:!0,percentage:t.progess,"indicator-placement":"inside",processing:!0,color:"#1890ff"},null)},{key:"projectdebugcount",title:"项目调试任务数",align:"center",sorter:(t,e)=>t.projectdebugcount-e.projectdebugcount,width:180}]);ye(async()=>{await ee({usertypes:"2,3"}),z.value=[...z.value,...oe(w.data.filter(t=>t.id!="1024"))],f()});const ie=[{key:"proname",title:"项目名称",align:"center",render:t=>o("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[o("div",{class:"cursor-pointer",onClick:()=>D(t)},[t.proname||""])])},{key:"progess",title:"项目进度",align:"center",width:140,sorter:(t,e)=>t.progess-e.progess,render:t=>o(L,{type:"line",showIndicator:!0,percentage:t.progess,"indicator-placement":"inside",processing:!0,color:"#1890ff"},null)},{key:"projectdebugcount",title:"项目调试任务数",align:"center",sorter:(t,e)=>t.projectdebugcount-e.projectdebugcount,width:180},{key:"debugcount",title:"调试数量",align:"center",sorter:(t,e)=>t.debugcount-e.debugcount,width:180},{key:"debugpercent",title:"调试占比",align:"center",width:180,render(t){return o("div",{style:{}},[t.debugpercent])}}],D=t=>{Y.push("/projectmanagement/orderdetail?prjId="+t.proid+"&pname="+t.proname),K.setProjectInfo({pid:t.id,pname:t.proname})},re=t=>{f()},se=t=>{_.value=1,f()},E=p(window.innerHeight-365),ue=async()=>{const t=w.data.filter(n=>n.id!="1024")||[],e=[{title:"项目名称",key:"proname",width:25},{title:"调试类型",key:"dtype",width:12},{title:"项目总权重分",key:"totalweight",width:14},{title:"项目进度",key:"progess",width:12,percent:!0},{title:"项目分",key:"projectScore",width:12},{title:"项目调试任务数",key:"projectdebugcount",width:16}],c=[{key:"totalcnt",title:"全部任务数",default:0},{key:"finishcnt",title:"已完成任务数",default:0},{key:"finishcntRate",title:"任务数占比率",percent:!0,default:0},{key:"finishWeight",title:"已完成权重分",default:0},{key:"finishWeightRate",title:"权重分占比率",percent:!0,default:0},{key:"score",title:"得分",default:""}],s=new Be.Workbook,a=s.addWorksheet("调试报表"),i=e.map(n=>n.title),u=new Array(e.length).fill("");t.forEach(n=>{i.push(n.username,...new Array(c.length-1).fill("")),u.push(...c.map(d=>d.title))}),a.addRow(i),a.addRow(u);const k=e.length,b=c.length;for(let n=1;n<=k;n++)a.mergeCells(1,n,2,n);let v=k+1;t.forEach(()=>{a.mergeCells(1,v,1,v+b-1),v+=b}),N.value.filter(n=>n.progess>0).forEach(n=>{const d=[];e.forEach(x=>{let h=n[x.key];x.key==="dtype"&&(h=F(q[h])),x.percent&&(h=(h??0)+"%"),d.push(h??"")}),t.forEach(x=>{var P;const h=((P=n.userstat)==null?void 0:P.find(C=>C.uid==x.id))||{};c.forEach(C=>{let V=h[C.key]??C.default;C.percent&&(V+="%"),d.push(V)})}),a.addRow(d)}),a.eachRow(n=>{n.eachCell(d=>{d.font={name:"微软雅黑",size:11},d.alignment={vertical:"middle",horizontal:"center",wrapText:!0},d.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}})}),a.getRow(1).font={bold:!0},a.getRow(2).font={bold:!0},[...e.map(n=>n.width),...t.flatMap(()=>new Array(b).fill(14))].forEach((n,d)=>{a.getColumn(d+1).width=n}),a.views=[{state:"frozen",xSplit:1,ySplit:2}];const l=await s.xlsx.writeBuffer();De.saveAs(new Blob([l]),`调试报表_${g.value=="month"?r.monthTime:r.yearTime}.xlsx`)};return(t,e)=>{const c=we,s=ve,a=Ee,i=ke,u=Ue,k=_e,b=ce,v=Ce,U=Te,I=Se;return y(),M("div",Ie,[o(I,{bordered:"",style:{height:"100%"}},{default:m(()=>[o(k,{align:"center"},{default:m(()=>[o(s,{label:"用户",path:"creater","label-placement":"left","show-feedback":!1},{default:m(()=>[o(c,{clearable:"",filterable:"",value:r.creater,"onUpdate:value":[e[0]||(e[0]=l=>r.creater=l),le],placeholder:"请选择","label-field":"username",size:"small","value-field":"id",options:j(w).data,onScroll:ae},null,8,["value","options"])]),_:1}),o(s,{label:"查询日期","label-placement":"left","show-feedback":!1},{default:m(()=>[o(k,null,{default:m(()=>[o(i,{value:g.value,"onUpdate:value":[e[1]||(e[1]=l=>g.value=l),Z],size:"small"},{default:m(()=>[(y(!0),M(be,null,xe(Q.value,l=>(y(),T(a,{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["value"]),g.value==="year"?(y(),T(u,{key:0,size:"small","formatted-value":r.yearTime,"onUpdate:formattedValue":[e[2]||(e[2]=l=>r.yearTime=l),B],type:"year","value-format":"yyyy",style:{width:"120px"}},null,8,["formatted-value"])):G("",!0),g.value=="month"?(y(),T(u,{key:1,size:"small","formatted-value":r.monthTime,"onUpdate:formattedValue":[e[3]||(e[3]=l=>r.monthTime=l),B],type:"month","value-format":"yyyy-MM",style:{width:"120px"}},null,8,["formatted-value"])):G("",!0)]),_:1}),o(j(H),{type:"primary",size:"small",ghost:"",style:{"margin-left":"20px"},onClick:f},{default:m(()=>e[6]||(e[6]=[W("查询")])),_:1,__:[6]}),o(j(H),{style:{"margin-left":"20px"},size:"small",onClick:ue},{icon:m(()=>[o(b,{class:"text-icon"})]),default:m(()=>[e[7]||(e[7]=W(" "+J("导出")))]),_:1,__:[7]})]),_:1})]),_:1}),O("div",Pe,[r.creater?(y(),T(v,{key:0,columns:ie,data:N.value,"max-height":E.value},null,8,["data","max-height"])):(y(),T(v,{key:1,columns:z.value,"virtual-row-height":140,"min-row-height":50,"virtual-scroll":"","virtual-scroll-x":"","scroll-x":z.value.reduce((l,n)=>l+(n.width||100),0),data:N.value,"max-height":E.value},null,8,["columns","scroll-x","data","max-height"]))]),O("div",Ve,[o(U,{page:_.value,"onUpdate:page":[e[4]||(e[4]=l=>_.value=l),re],"page-size":R.value,"onUpdate:pageSize":[e[5]||(e[5]=l=>R.value=l),se],"item-count":$.value,"show-size-picker":"","show-quick-jumper":"","page-sizes":X.value},{prefix:m(({itemCount:l})=>[W(" 共 "+J(l)+" 项 ",1)]),_:1},8,["page","page-size","item-count","page-sizes"])])]),_:1})])}}}),Ye=We(Fe,[["__scopeId","data-v-425972f1"]]);export{Ye as default};
