import{_ as te}from"./round-plus-C1_mdJEQ.js";import{_ as ae}from"./round-search-sT84wODp.js";import{_ as ne}from"./round-refresh-nOdDnwO4.js";import{d as oe,a3 as le,j as I,r as f,g as a,av as A,$ as c,aA as se,E as d,D as h,B as m,A as re,o as k,e as ie,w as o,i,h as b,t as w,c as T,G as R,ai as ce,Z as pe,J as ue,N as de,O as me,ad as _e,aj as fe,K as ve,af as ge,ag as ye,R as he}from"./index-DFnbiRUJ.js";import{_ as be}from"./lodash-C9dVfRGL.js";import{f as we,a as Ce,d as xe,e as De,g as ze}from"./common-CS3wOzpP.js";import{S as ke,a as Le}from"./alarm-D1QhhK1A.js";import{_ as Ne}from"./Popconfirm--k5TJm7m.js";import{_ as Te}from"./FormItemGridItem-B4LS4jyU.js";import{_ as Se}from"./Grid-CvxW3gMF.js";const $e={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function C(x){return typeof x=="function"||Object.prototype.toString.call(x)==="[object Object]"&&!ce(x)}const Ee=oe({name:"eventalarm_eventtype",__name:"index",setup(x){const U=le(),v=I(!1),_=I(!1),u=f({fuzzy:"",pid:null}),l=f({pid:null,pname:null,id:null,level:1,sysparam:null}),j=f({pid:{type:"number",required:!0,message:"请选择事件类别",trigger:["blur","change"]},pname:{type:"string",required:!0,message:"请输入事件类型",trigger:["blur","change"]},level:{type:"number",required:!0,message:"请选择安全级别",trigger:["blur","change"]}}),p=f({eventsCategoryDataList:[],eventsTypeDataList:[]}),B=f({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:t,endIndex:e,page:n,pageSize:s,pageCount:y,itemCount:D}){return`${p.eventsTypeDataList.length}条`}}),O=f([{key:"pid",title:"事件类别",align:"center",width:180,ellipsis:{tooltip:!0},render:t=>{var n;return(n=p.eventsCategoryDataList.find(s=>s.id===t.pid))==null?void 0:n.pname}},{key:"pname",title:"事件类型",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"level",title:"安全等级",align:"center",width:140,render:t=>{const e={1:"#8e9dff",2:"#5da8ff",3:"#fedc69",4:"#ff9874",5:"#ff0000"},n=ke[t.level];let s={color:e[t.level],textColor:"#ffffff",borderColor:e[t.level]};return a(A,{color:s},C(n)?n:{default:()=>[n]})}},{key:"sysparam",title:"系统内置",align:"center",width:140,render:t=>{const e={0:"success",1:"info"},n=c(se[t.sysparam]);return a(A,{size:"small",type:e[t.sysparam]},C(n)?n:{default:()=>[n]})}},{key:"operate",title:c("common.operate"),align:"center",width:160,render:t=>{let e,n;return t.sysparam!=0?a("div",{class:"flex-center gap-8px"},[d(a(m,{type:"primary",ghost:!0,size:"small",onClick:()=>S(t)},C(e=c("common.edit"))?e:{default:()=>[e]}),[[h("no-auth"),"event.type.update"]]),a(Ne,{onPositiveClick:()=>J(t.id)},{default:()=>c("common.confirmDelete"),trigger:()=>{let s;return d(a(m,{type:"error",ghost:!0,size:"small"},C(s=c("common.delete"))?s:{default:()=>[s]}),[[h("no-auth"),"event.type.delete"]])}})]):d(a(m,{type:"primary",ghost:!0,size:"small",onClick:()=>S(t)},C(n=c("common.edit"))?n:{default:()=>[n]}),[[h("no-auth"),"event.type.update"]])}}]);re(()=>{G(),g()});async function G(){try{const{data:t,error:e}=await we();e||(p.eventsCategoryDataList=t)}catch(t){console.error("Failed to fetch event categories:",t)}}async function g(){try{v.value=!0;const{data:t,error:e}=await Ce();e||(p.eventsTypeDataList=t)}catch(t){console.error("Failed to fetch event types:",t)}finally{v.value=!1}}const M=()=>{_.value=!0,l.id=null,l.pid=null,l.pname=null,l.level=1,l.sysparam=null},V=async()=>{var t,e;try{if(l.id){const{data:n,error:s}=await ze([l]);s||((e=window.$message)==null||e.success("修改成功"),_.value=!1,g())}else{const{data:n,error:s}=await De([{pname:l.pname,pid:l.pid,level:l.level}]);s||((t=window.$message)==null||t.success("添加成功"),_.value=!1,g())}}catch(n){console.error("Failed to submit event type:",n)}},q=()=>{_.value=!1,l.pid=null,l.pname=null},J=async t=>{var e;try{const{data:n,error:s}=await xe({ids:t});s||((e=window.$message)==null||e.success("删除成功"),g())}catch(n){console.error("Failed to delete event type:",n)}},S=t=>{_.value=!0,Object.assign(l,t)},K=()=>{u.fuzzy=null,u.pid=null,L()},L=()=>{v.value=!0;const{fuzzy:t,pid:e}=u;if(!t&&!e){g();return}const n=p.eventsTypeDataList.filter(s=>{const y=e?s.pid===e:!0,D=t?s.pname.toLowerCase().includes(t.toLowerCase()):!0;return y&&D});p.eventsTypeDataList=n,v.value=!1},P=be.debounce(L,1e3,{leading:!0,trailing:!1});return(t,e)=>{const n=pe,s=Te,y=ue,D=ne,Z=ae,$=de,H=Se,E=me,F=_e,Q=te,W=fe,N=ve,X=ge,Y=ye,z=h("no-space"),ee=h("no-auth");return k(),ie("div",$e,[a(F,{title:"",bordered:!1,size:"small"},{header:o(()=>[a(E,{ref:"formRef",model:u,"label-placement":"left","label-width":"auto","show-feedback":!1},{default:o(()=>[a(H,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":12},{default:o(()=>[a(s,{span:"24 s:12 m:8 l:6",label:"类别",path:"pid"},{default:o(()=>[d(a(n,{clearable:"",value:u.pid,"onUpdate:value":[e[0]||(e[0]=r=>u.pid=r),L],placeholder:"请选择事件类别",options:p.eventsCategoryDataList,"reset-menu-on-options-change":!1,"value-field":"id","label-field":"pname"},null,8,["value","options"]),[[z]])]),_:1}),a(s,{span:"24 s:12 m:8 l:6",label:"类型",path:"fuzzy"},{default:o(()=>[d(a(y,{value:u.fuzzy,"onUpdate:value":e[1]||(e[1]=r=>u.fuzzy=r),placeholder:"请输入事件类型"},null,8,["value"]),[[z]])]),_:1}),a(s,{span:"24 s:12 m:8 l:6"},{default:o(()=>[a($,{class:"w-full"},{default:o(()=>[a(i(m),{onClick:K},{icon:o(()=>[a(D,{class:"text-icon"})]),default:o(()=>[b(" "+w(i(c)("common.reset")),1)]),_:1}),a(i(m),{type:"primary",ghost:"",onClick:i(P)},{icon:o(()=>[a(Z,{class:"text-icon"})]),default:o(()=>[b(" "+w(i(c)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(F,{title:"事件类型",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[d((k(),T(i(m),{size:"small",ghost:"",type:"primary",onClick:M},{icon:o(()=>[a(Q,{class:"text-icon"})]),default:o(()=>[b(" "+w(i(c)("common.add")),1)]),_:1})),[[ee,"event.type.insert"]])]),default:o(()=>[a(W,{columns:O,data:p.eventsTypeDataList,size:"small",pagination:B,"flex-height":!i(U).isMobile,"scroll-x":962,loading:v.value,remote:"","row-key":r=>r.id,class:"sm:h-full"},null,8,["columns","data","pagination","flex-height","loading","row-key"])]),_:1}),a(Y,{show:_.value,"onUpdate:show":e[5]||(e[5]=r=>_.value=r),"display-directive":"show",width:300},{default:o(()=>[a(X,{title:l.id?"编辑":"添加","native-scrollbar":!1,closable:""},{footer:o(()=>[a($,{size:16},{default:o(()=>[a(i(m),{onClick:q},{default:o(()=>[b(w(i(c)("common.cancel")),1)]),_:1}),a(i(m),{type:"primary",onClick:V},{default:o(()=>[b(w(i(c)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(E,{ref:"formRef",model:l,rules:j},{default:o(()=>[l.sysparam!=0?(k(),T(N,{key:0,label:"事件类别",path:"pid"},{default:o(()=>[d(a(n,{clearable:"",value:l.pid,"onUpdate:value":e[2]||(e[2]=r=>l.pid=r),placeholder:"请选择事件类别",options:p.eventsCategoryDataList,"reset-menu-on-options-change":!1,"value-field":"id","label-field":"pname"},null,8,["value","options"]),[[z]])]),_:1})):R("",!0),l.sysparam!=0?(k(),T(N,{key:1,label:"事件类型",path:"pname"},{default:o(()=>[d(a(y,{value:l.pname,"onUpdate:value":e[3]||(e[3]=r=>l.pname=r),placeholder:"请输入事件类型"},null,8,["value"]),[[z]])]),_:1})):R("",!0),a(N,{label:"安全级别",path:"level"},{default:o(()=>[a(n,{filterable:"",clearable:"",value:l.level,"onUpdate:value":e[4]||(e[4]=r=>l.level=r),placeholder:"请选择安全级别",options:i(Le)},null,8,["value","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])])}}}),Ve=he(Ee,[["__scopeId","data-v-7cd4efc0"]]);export{Ve as default};
