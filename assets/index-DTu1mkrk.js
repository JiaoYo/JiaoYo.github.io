import{_ as te}from"./table-header-operation.vue_vue_type_script_setup_true_lang-3sdWRkja.js";import{d as j,aE as P,aG as K,n as q,p as ae,a as ne,r as le,$ as p,ae as $,x as L,B as x,aC as oe,c as E,o as A,w as n,f as e,bg as se,C as W,v as ie,h as a,aD as H,bh as J,aH as Y,e as G,g as O,z as Z,t as V,bi as re,bj as ce,bk as pe,A as ue,Z as Q,aS as de,b as me,aT as B,bl as _e,bm as fe,aM as ge,aY as be}from"./index-CbkGmsUT.js";import{e as X,a as he}from"./business-DAxKw-B3.js";import{u as ve,a as ye}from"./table-CST65CZ1.js";import{_ as we}from"./round-plus-Cs7LS9FY.js";import{N as ee}from"./Popconfirm-CfoHIMzd.js";import{_ as ke}from"./round-search-opoHbQsz.js";import{_ as De}from"./round-refresh-BzOWd9gI.js";import{_ as Se}from"./Grid-CyaoSB-i.js";import{_ as xe}from"./FormItemGridItem-D8sOQ-r2.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Dg__PXp0.js";import"./export-DnPxy9gR.js";import"./round-delete-CojfW_rY.js";const Ne={style:{display:"flex","align-items":"center"}},Ce=j({name:"OperateDrawer",__name:"operate-drawer",props:P({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:P(["submitted"],["update:visible"]),setup(h,{emit:R}){const d=h,v=R,f=K(h,"visible"),{formRef:i,validate:N,restoreValidation:T}=q(),{defaultRequiredRule:k}=ae(),D=ne(()=>({add:"新增调试步骤列表",edit:"修改调试步骤列表"})[d.operateType]),t=le(m());function m(){return{name:"",desc:"",enable:1,stepsList:[]}}const C={name:k,stepsList:{type:"array",required:!0,message:"请输入调试步骤",trigger:["input","change","blur"]}},y=[{key:"no",title:"序号",align:"center",render(c,l){return $(L,{value:c.no,clearable:!0,placeholder:"请输入序号",onUpdateValue(r){t.stepsList[l].no=r}})}},{key:"name",title:"名称",align:"center",render(c,l){return $(L,{value:c.name,clearable:!0,placeholder:"请输入名称",onUpdateValue(r){t.stepsList[l].name=r}})}},{key:"desc",title:"描述",align:"center",render(c,l){return $(L,{value:c.desc,clearable:!0,placeholder:"请输入描述",onUpdateValue(r){t.stepsList[l].desc=r}})}},{key:"operate",title:p("common.operate"),align:"center",width:80,fixed:"right",render(c,l){return $(ee,{onPositiveClick:()=>{t.stepsList.splice(l,1)}},{default:()=>p("common.confirmDelete"),trigger:()=>$(x,{type:"error",ghost:!0,size:"small"},{default:()=>p("common.delete")})})}}];function U(){Object.assign(t,m()),d.operateType==="edit"&&d.rowData&&Object.assign(t,d.rowData)}function g(){t.stepsList.push({no:t.stepsList.length+1,name:"",desc:""})}function w(){f.value=!1}async function z(){var c,l;if(await N(),d.operateType==="add"){const{data:r,error:b}=await ce({name:t.name,desc:t.desc,enable:t.enable,stepsList:t.stepsList.length>0?JSON.stringify(t.stepsList):""});b||((c=window.$message)==null||c.success(p("common.addSuccess")),w(),v("submitted"))}else{const{data:r,error:b}=await pe({id:d.rowData.id,name:t.name,desc:t.desc,enable:t.enable,stepsList:t.stepsList.length>0?JSON.stringify(t.stepsList):""});b||((l=window.$message)==null||l.success(p("common.updateSuccess")),w(),v("submitted"))}}return oe(f,()=>{f.value&&(U(),T())}),(c,l)=>{const r=ie,b=H,o=we,s=Y,u=W,M=Z,F=se,_=re;return A(),E(_,{show:f.value,"onUpdate:show":l[3]||(l[3]=S=>f.value=S),"display-directive":"show",width:1e3},{default:n(()=>[e(F,{title:D.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(M,{size:16},{default:n(()=>[e(a(x),{onClick:w},{default:n(()=>[O(V(a(p)("common.cancel")),1)]),_:1}),e(a(x),{type:"primary",onClick:z},{default:n(()=>[O(V(a(p)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(u,{ref_key:"formRef",ref:i,model:t,rules:C},{default:n(()=>[e(r,{label:"名称",path:"name"},{default:n(()=>[e(a(L),{clearable:"",value:t.name,"onUpdate:value":l[0]||(l[0]=S=>t.name=S),placeholder:"请输入名称"},null,8,["value"])]),_:1}),e(r,{label:"是否启用",path:"enable"},{default:n(()=>[e(b,{filterable:"",value:t.enable,"onUpdate:value":l[1]||(l[1]=S=>t.enable=S),options:a(J)(a(X)),placeholder:"请选择是否启用"},null,8,["value","options"])]),_:1}),e(r,{label:"调试步骤",path:"stepsList"},{label:n(()=>[G("div",Ne,[l[5]||(l[5]=G("span",{style:{"margin-right":"10px"}},"调试步骤",-1)),e(a(x),{size:"small",ghost:"",type:"primary",onClick:g},{icon:n(()=>[e(o,{class:"text-icon"})]),default:n(()=>[l[4]||(l[4]=O(" 添加调试步骤 "))]),_:1,__:[4]})])]),default:n(()=>[e(s,{bordered:"",size:"small",data:t.stepsList,columns:y,pagination:!1},null,8,["data"])]),_:1}),e(r,{label:"描述",path:"desc"},{default:n(()=>[e(a(L),{type:"textarea",clearable:"",value:t.desc,"onUpdate:value":l[2]||(l[2]=S=>t.desc=S),placeholder:"请输入描述",autosize:{minRows:4}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Le=j({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:P(["reset","search"],["update:model"]),setup(h,{emit:R}){const d=R,{formRef:v,restoreValidation:f}=q(),i=K(h,"model");function N(){i.value.name=null,d("search")}function T(){i.value.desc=null,d("search")}async function k(){await f(),d("reset")}async function D(){d("search")}return(t,m)=>{const C=L,y=xe,U=H,g=De,w=x,z=ke,c=Z,l=Se,r=W,b=Q;return A(),E(b,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(r,{ref_key:"formRef",ref:v,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ue(D,["enter"])},{default:n(()=>[e(l,{responsive:"screen","item-responsive":""},{default:n(()=>[e(y,{span:"24 s:12 m:6",label:"名称",path:"name",class:"pr-24px"},{default:n(()=>[e(C,{clearable:"",value:i.value.name,"onUpdate:value":m[0]||(m[0]=o=>i.value.name=o),placeholder:"请输入名称",onClear:N},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:6",label:"描述",path:"desc",class:"pr-24px"},{default:n(()=>[e(C,{clearable:"",value:i.value.desc,"onUpdate:value":m[1]||(m[1]=o=>i.value.desc=o),placeholder:"请输入描述",onClear:T},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:6",label:"是否启用",path:"desc",class:"pr-24px"},{default:n(()=>[e(U,{clearable:"",filterable:"",value:i.value.enable,"onUpdate:value":[m[2]||(m[2]=o=>i.value.enable=o),D],options:a(J)(a(X)),placeholder:"请选择是否启用"},null,8,["value","options"])]),_:1}),e(y,{span:"24 s:12 m:6",class:"pr-24px"},{default:n(()=>[e(c,{class:"w-full"},{default:n(()=>[e(w,{onClick:k},{icon:n(()=>[e(g,{class:"text-icon"})]),default:n(()=>[O(" "+V(a(p)("common.reset")),1)]),_:1}),e(w,{type:"primary",ghost:"",onClick:D},{icon:n(()=>[e(z,{class:"text-icon"})]),default:n(()=>[O(" "+V(a(p)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Re={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function I(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!be(h)}const Ge=j({name:"manage_debugstep",__name:"index",setup(h){const R=de(),{columns:d,columnChecks:v,data:f,getData:i,loading:N,mobilePagination:T,searchParams:k,resetSearchParams:D}=ve({apiFn:fe,immediate:!1,apiParams:{page:1,pageSize:20,limit:20,name:null,desc:null,enable:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:"名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"desc",title:"描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"stepsList",title:"调试步骤",align:"center",minWidth:300},{key:"enable",title:"是否启用",align:"center",width:180,render:o=>{o.enable===null&&(o.enable=0);const s={0:"error",1:"success"},u=p(he[o.enable]);return e(ge,{type:s[o.enable]},I(u)?u:{default:()=>[u]})}},{key:"createTime",title:p("page.manage.user.createDate"),align:"center",width:180},{key:"operate",title:p("common.operate"),align:"center",width:130,render:o=>{let s;return e("div",{class:"flex-center gap-8px"},[e(x,{type:"primary",ghost:!0,size:"small",onClick:()=>r(o.id)},I(s=p("common.edit"))?s:{default:()=>[s]}),e(ee,{onPositiveClick:()=>l(o.id)},{default:()=>p("common.confirmDelete"),trigger:()=>{let u;return e(x,{type:"error",ghost:!0,size:"small"},I(u=p("common.delete"))?u:{default:()=>[u]})}})])}}]}),{drawerVisible:t,operateType:m,editingData:C,handleAdd:y,handleEdit:U,checkedRowKeys:g,onBatchDeleted:w,onDeleted:z}=ye(f,i);async function c(){console.log(g.value),b(g.value,o=>{w()})}function l(o){console.log(o),b([o],s=>{z()})}function r(o){U(o)}async function b(o,s){const u=await _e(o);console.log("data",u),s&&s(u)}return(o,s)=>{const u=te,M=Y,F=Q;return A(),me("div",Re,[e(Le,{model:a(k),"onUpdate:model":s[0]||(s[0]=_=>B(k)?k.value=_:null),onReset:a(D),onSearch:a(i)},null,8,["model","onReset","onSearch"]),e(F,{title:"调试步骤列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[e(u,{columns:a(v),"onUpdate:columns":s[1]||(s[1]=_=>B(v)?v.value=_:null),"disabled-delete":a(g).length===0,loading:a(N),onAdd:a(y),onDelete:c,onRefresh:a(i)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:n(()=>[e(M,{"checked-row-keys":a(g),"onUpdate:checkedRowKeys":s[2]||(s[2]=_=>B(g)?g.value=_:null),columns:a(d),data:a(f),size:"small","flex-height":!a(R).isMobile,"scroll-x":962,loading:a(N),remote:"","row-key":_=>_.id,pagination:a(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ce,{visible:a(t),"onUpdate:visible":s[3]||(s[3]=_=>B(t)?t.value=_:null),"operate-type":a(m),"row-data":a(C),onSubmitted:a(i)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Ge as default};
