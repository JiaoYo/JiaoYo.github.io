import{d as X,n as ee,a3 as le,p as pe,s as ae,j as b,r as W,D as ce,o as R,c as te,w as n,g as l,E as fe,i as S,W as ve,h as m,t as I,$ as C,F as me,aG as ge,aw as U,ax as q,J as _e,Z as he,B as J,N as Y,O as Ie,ad as ne,ae as ye,av as Q,e as Z,ai as oe,ay as Se,aj as se,az as be,S as xe,ar as we,P as Ae,Q as Ee,f as ie,R as re}from"./index-DsBlqHIZ.js";import{_ as ke,l as ue}from"./lodash-BKkYyAYu.js";import{_ as Ce}from"./round-search-WKsxqVLg.js";import{_ as De}from"./round-refresh-Ck-gzDyX.js";import{a as Te,T as K}from"./basicconf-qVti1s3u.js";import{c as ze,a as $e,f as Pe}from"./common-BLIP-7Ob.js";import{_ as Ne}from"./Cascader-CcU5kZhe.js";import{_ as Le}from"./FormItemGridItem-C6y586sw.js";import{_ as Ve}from"./DatePicker-4pyuMN2r.js";import{_ as Oe}from"./Grid-Bcvow_UB.js";import{u as Me,f as Ue,v as Re}from"./events-DFOTjHc8.js";import{e as Be}from"./exportExcel-D6OyA9oJ.js";import{_ as Ge}from"./originlogInfo.vue_vue_type_script_setup_true_lang-ByIFW696.js";import{_ as je,a as He}from"./DescriptionsItem-DpT6T6he.js";import"./TimePicker-hu-WrP3g.js";import"./defineProperty-oXR_XZ_g.js";import"./collection-DFjnHVvR.js";import"./CollapseItem-DpGbR8Az.js";const Fe=X({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ee(["search"],["update:model"]),setup(_,{emit:D}){const E=D,o=le(),{formRef:O,restoreValidation:y}=pe(),e=ae(_,"model"),f=b();(async()=>{const{data:u,error:t}=await ze();t||(f.value=u.map(p=>({...p,id:"-"+p.id,type:p.cname})))})();const w=W({eventsTypeDataList:[],eventsCategoryData:[]});async function z(){const{data:u,error:t}=await $e();t||(w.eventsTypeDataList=u)}z();async function $(){const{data:u,error:t}=await Pe();t||(w.eventsCategoryData=u.map(p=>({value:p.id,label:p.pname})))}$();function P(){e.value.fuzzy=void 0,g()}async function x(u,t){u?(e.value.startTime=u[0],e.value.endTime=u[1]):(e.value.startTime=null,e.value.endTime=null),E("search")}async function M(){await y(),e.value.lsid=null,e.value.etype=null,e.value.elevel=null,e.value.fuzzy=null,e.value.startAndEndSendSourceIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.timeRange=null,e.value.ectgr=null,e.value.startSourceIp=null,e.value.endSourceIp=null,e.value.startAimIp=null,e.value.endAimIp=null,e.value.startSIp=null,e.value.endSIp=null,e.value.startTime=null,e.value.endTime=null,ge(()=>{E("search")})}const c=()=>{e.value.startAndEndSendSourceIp=null,g()},v=()=>{e.value.startAndEndSourceIp=null,g()},r=()=>{e.value.startAndEndAimSourceIp=null,g()};async function g(){var u,t,p,i,a,A,N,L,k,V;if(e.value.startAndEndSendSourceIp&&e.value.startAndEndSendSourceIp.length>0?(e.value.startSIp=e.value.startAndEndSendSourceIp[0]||null,e.value.endSIp=e.value.startAndEndSendSourceIp[1]||null):(e.value.startSIp=null,e.value.endSIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=void 0,e.value.endSourceIp=void 0),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimIp=void 0,e.value.endAimIp=void 0),e.value.startSIp&&!U(e.value.startSIp)||e.value.startSourceIp&&!U(e.value.startSourceIp)||e.value.startAimIp&&!U(e.value.startAimIp))return(u=window.$message)==null||u.destroyAll(),(t=window.$message)==null||t.error("请输入正确的IP地址"),!1;if(e.value.endSIp&&!U(e.value.endSIp)||e.value.endSourceIp&&!U(e.value.endSourceIp)||e.value.endAimIp&&!U(e.value.endAimIp))return(p=window.$message)==null||p.destroyAll(),(i=window.$message)==null||i.error("请输入正确的IP地址"),!1;if(e.value.startSIp&&e.value.endSIp&&q(e.value.startSIp,e.value.endSIp)>0)return(a=window.$message)==null||a.destroyAll(),(A=window.$message)==null||A.error("发生源起始IP不能大于发生源终止IP"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&q(e.value.startSourceIp,e.value.endSourceIp)>0)return(N=window.$message)==null||N.destroyAll(),(L=window.$message)==null||L.error("源起始IP不能大于源终止IP"),!1;if(e.value.startAimIp&&e.value.endAimIp&&q(e.value.startAimIp,e.value.endAimIp)>0)return(k=window.$message)==null||k.destroyAll(),(V=window.$message)==null||V.error("目的起始IP不能大于目的终止IP"),!1;E("search")}const s=u=>{e.value.ectgr=u,E("search")},d=ke.debounce(g,1e3,{leading:!0,trailing:!1});return(u,t)=>{const p=Ne,i=Le,a=_e,A=he,N=Ve,L=De,k=J,V=Ce,B=Y,G=Oe,j=Ie,H=ne,F=ce("no-space");return R(),te(H,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[l(j,{ref_key:"formRef",ref:O,model:e.value,"label-placement":"left","label-width":S(o).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:me(S(d),["enter"])},{default:n(()=>[l(G,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[l(i,{span:"24 s:12 m:8 l:6",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:n(()=>[l(p,{value:e.value.lsid,"onUpdate:value":[t[0]||(t[0]=h=>e.value.lsid=h),g],placeholder:"请选择日志源设备",options:f.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),l(i,{span:"24 s:12 m:8 l:6",label:"事件名称",path:"fuzzy",class:"pr-24px"},{default:n(()=>[fe(l(a,{value:e.value.fuzzy,"onUpdate:value":t[1]||(t[1]=h=>e.value.fuzzy=h),placeholder:"请输入事件名称",clearable:"",onClear:P},null,8,["value"]),[[F]])]),_:1}),l(i,{span:"24 s:12 m:8 l:6",label:"事件类型",path:"etype",class:"pr-24px"},{default:n(()=>[l(A,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.etype,"onUpdate:value":[t[2]||(t[2]=h=>e.value.etype=h),g],"value-field":"id","label-field":"pname",options:w.eventsTypeDataList},null,8,["value","options"])]),_:1}),l(i,{span:"24 s:12 m:8 l:6",label:"事件等级",path:"elevel",class:"pr-24px"},{default:n(()=>[l(A,{filterable:"",clearable:"",placeholder:"请选择事件等级",value:e.value.elevel,"onUpdate:value":[t[3]||(t[3]=h=>e.value.elevel=h),g],options:S(ve)(S(Te))},null,8,["value","options"])]),_:1}),l(i,{span:"24 s:12 m:10 l:8",label:"发生源IP",path:"startAndEndSendSourceIp",class:"pr-24px"},{default:n(()=>[l(a,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSendSourceIp,"onUpdate:value":t[4]||(t[4]=h=>e.value.startAndEndSendSourceIp=h),onClear:v},null,8,["value"])]),_:1}),l(i,{span:"24 s:12 m:10 l:8",label:"源IP",path:"startAndEndSourceIp",class:"pr-24px"},{default:n(()=>[l(a,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":t[5]||(t[5]=h=>e.value.startAndEndSourceIp=h),onClear:c},null,8,["value"])]),_:1}),l(i,{span:"24 s:12 m:10 l:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px"},{default:n(()=>[l(a,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":t[6]||(t[6]=h=>e.value.startAndEndAimSourceIp=h),onClear:r},null,8,["value"])]),_:1}),l(i,{span:"24 s:12 m:10 l:8",label:"产生时间",path:"timeRange",class:"pr-24px"},{default:n(()=>[l(N,{clearable:"",value:e.value.timeRange,"onUpdate:value":t[7]||(t[7]=h=>e.value.timeRange=h),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":x},null,8,["value"])]),_:1}),l(i,{span:"24 s:12 m:10 l:8",label:"事件类别",path:"ectgr",class:"pr-24px"},{default:n(()=>[l(A,{filterable:"",clearable:"",placeholder:"请选择事件类别",value:e.value.ectgr,"onUpdate:value":[t[8]||(t[8]=h=>e.value.ectgr=h),s],options:w.eventsCategoryData},null,8,["value","options"])]),_:1}),l(i,{span:"24 s:12 m:10 l:6",class:"pr-24px"},{default:n(()=>[l(B,{class:"w-full",align:"center"},{default:n(()=>[l(k,{onClick:M},{icon:n(()=>[l(L,{class:"text-icon"})]),default:n(()=>[m(" "+I(S(C)("common.reset")),1)]),_:1}),l(k,{type:"primary",ghost:"",onClick:S(d)},{icon:n(()=>[l(V,{class:"text-icon"})]),default:n(()=>[m(" "+I(S(C)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width","onKeyup"])]),_:1})}}}),de=_=>(Ae("data-v-9ffba191"),_=_(),Ee(),_),We=de(()=>ie("span",null,"基本信息",-1)),Je=de(()=>ie("span",null,"原始日志信息",-1)),Ke={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"400px"}},qe={key:1,class:"max-h-500px min-h-450px"};function Qe(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!oe(_)}const Ze=X({__name:"detailInfo",props:ee({detailInfo:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(_){const D=ae(_,"detailVisible"),E=_,o=b();ye(()=>D.value,async c=>{c&&(o.value=E.detailInfo,await f(),T())});const O=[{title:"",key:"index",width:50,render:(c,v)=>`${v+1}`},{key:"pname2",title:"事件类别",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:c=>{(c.elevel===void 0||c.elevel===null)&&(c.elevel=1);const v={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},r=C(K[c.elevel]);let g={color:v[c.elevel],textColor:"#ffffff",borderColor:v[c.elevel]};return l(Q,{size:"small",color:g},Qe(r)?r:{default:()=>[r]})}},{key:"sourceip",title:"发生源IP",align:"center",width:120},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"operate",title:C("common.operate"),align:"center",width:80,fixed:"right",render:c=>l("div",{class:"flex-center gap-8px"},[l(J,{type:"info",ghost:!0,size:"small",onClick:()=>M(c)},{default:()=>[m("详情")]})])}],y=b(!1);let e=b([]);const f=async c=>{var g;if(!y.value)y.value=!0;else return;const{data:v,error:r}=await Me({aggid:(g=o.value)==null?void 0:g.aggid,limit:20,pageId:c});r||(y.value=!1,c?e.value=[...e.value,...v]:e.value=v)},T=async()=>{var c,v,r;e.value.length<450/44&&e.value.length<((c=o.value)==null?void 0:c.aggre)&&f(((r=(v=e.value)==null?void 0:v[e.value.length-1])==null?void 0:r.id)??void 0)};function w(c){var r;Math.abs(c.target.scrollTop+c.target.offsetHeight-c.target.scrollHeight)<=20&&((r=o.value)==null?void 0:r.aggre)>e.value.length&&z()}const z=ue.debounce(()=>{f(e.value[e.value.length-1].id)},300),$=W({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:c,endIndex:v,page:r,pageSize:g,pageCount:s,itemCount:d}){var u;return`已加载${e.value.length}条 共计${(u=o.value)==null?void 0:u.aggre} 条`}}),P=b(!1),x=b(),M=async c=>{P.value=!0,x.value=c};return(c,v)=>{const r=je,g=He,s=Y,d=Se,u=se,t=be,p=xe,i=we;return R(),te(i,{show:D.value,"onUpdate:show":v[1]||(v[1]=a=>D.value=a),title:"事件详情",preset:"card",class:"w-1000px"},{default:n(()=>[l(p,{class:"max-h-600px pr-20px"},{default:n(()=>[l(t,{type:"line",animated:""},{default:n(()=>[l(d,{name:"1"},{tab:n(()=>[We]),default:n(()=>[l(s,{vertical:"",size:12},{default:n(()=>[l(g,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:n(()=>[l(r,{label:"事件名称"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.ename),1)]}),_:1}),l(r,{label:"事件类型"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.pname1),1)]}),_:1}),l(r,{label:"事件类别"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.pname2),1)]}),_:1}),l(r,{label:"事件等级"},{default:n(()=>{var a,A,N,L,k,V,B,G,j,H;return[l(S(Q),{size:"small",color:{textColor:"#ffffff",borderColor:((a=o.value)==null?void 0:a.elevel)===0?"#8e9dff":((A=o.value)==null?void 0:A.elevel)===1?"#5da8ff":((N=o.value)==null?void 0:N.elevel)===2?"#fedc69":((L=o.value)==null?void 0:L.elevel)===3?"#ff9874":((k=o.value)==null?void 0:k.elevel)===4?"#ff0000":"#5da8ff",color:((V=o.value)==null?void 0:V.elevel)===0?"#8e9dff":((B=o.value)==null?void 0:B.elevel)===1?"#5da8ff":((G=o.value)==null?void 0:G.elevel)===2?"#fedc69":((j=o.value)==null?void 0:j.elevel)===3?"#ff9874":((H=o.value)==null?void 0:H.elevel)===4?"#ff0000":"#5da8ff"}},{default:n(()=>{var F;return[m(I(S(C)(S(K)[(F=o.value)==null?void 0:F.elevel])),1)]}),_:1},8,["color"])]}),_:1}),l(r,{label:"日志源设备"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.type),1)]}),_:1}),l(r,{label:"聚合开始时间"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.aggrestarttime),1)]}),_:1}),l(r,{label:"聚合结束时间"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.aggreendtime),1)]}),_:1}),l(r,{label:"聚合数量"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.aggre),1)]}),_:1}),l(r,{label:"发生源IP"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.sip),1)]}),_:1}),l(r,{label:"源IP"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.sourceip),1)]}),_:1}),l(r,{label:"源端口"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.sourceport),1)]}),_:1}),l(r,{label:"目的IP"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.aimip),1)]}),_:1}),l(r,{label:"目的端口"},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.aimport),1)]}),_:1}),l(r,{label:"事件描述",span:3},{default:n(()=>{var a;return[m(I((a=o.value)==null?void 0:a.aimip),1)]}),_:1})]),_:1})]),_:1})]),_:1}),l(d,{name:"2"},{tab:n(()=>[Je]),default:n(()=>[S(e).length==0?(R(),Z("div",Ke," 暂无原始日志信息 ")):(R(),Z("div",qe,[l(u,{columns:O,data:S(e),size:"small","scroll-x":762,"row-key":a=>a.id,"virtual-scroll":"",class:"sm:h-full",pagination:$,onScroll:w,loading:y.value,"max-height":400,remote:""},null,8,["data","row-key","pagination","loading"])])),l(Ge,{detailVisible:P.value,"onUpdate:detailVisible":v[0]||(v[0]=a=>P.value=a),detailInfo:x.value},null,8,["detailVisible","detailInfo"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Xe=re(Ze,[["__scopeId","data-v-9ffba191"]]),Ye={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function el(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!oe(_)}const ll=X({name:"eventalarm_eventalarm",__name:"index",setup(_){const D=le(),E=b(window.innerHeight-306),o=b(!1),O=b(),y=W({pageId:void 0,limit:100,lsid:void 0,etype:void 0,ectgr:void 0,elevel:void 0,startSIp:void 0,endSIp:void 0,startSourceIp:void 0,endSourceIp:void 0,startAimIp:void 0,endAimIp:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),e=[{title:"",key:"index",width:80,align:"center",render:s=>`${s.index}`},{key:"pname1",title:"事件名称",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:160},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",width:120,render:s=>{(s.elevel===void 0||s.elevel===null)&&(s.elevel=1);const d={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},u=C(K[s.elevel]);let t={color:d[s.elevel],textColor:"#ffffff",borderColor:d[s.elevel]};return l(Q,{size:"small",color:t},el(u)?u:{default:()=>[u]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"sip",title:"发生源IP",align:"center",width:160},{key:"aggreendtime",title:"聚合结束时间",align:"center",width:160},{key:"operate",title:C("common.operate"),align:"center",width:100,fixed:"right",render:s=>l("div",{class:"flex-center gap-8px"},[l(J,{type:"primary",ghost:!0,size:"small",onClick:()=>r(s)},{default:()=>[m("查看")]})])}],f=b([]),T=b(!1),w=b(0),z=async(s=!1)=>{if(!T.value)T.value=!0;else return;const{data:d,error:u}=await Ue(y);u||(w.value=d.length,s?f.value=[...f.value,...d]:f.value=d,f.value=f.value.sort((t,p)=>p.id-t.id).map((t,p)=>(t.index=p+1,t)),T.value=!1)};z();const $=b(!0),P=()=>{f.value=[],y.pageId=void 0,(d=>Object.keys(d).filter(p=>p!=="limit"&&p!=="_t").some(p=>d[p]!==void 0&&d[p]!==""&&d[p]!==null))(y)?$.value=!1:($.value=!0,M()),z()},x=W({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:s,endIndex:d,page:u,pageSize:t,pageCount:p,itemCount:i}){return`已加载${f.value.length}条`+(f.value.length?$.value?` 共计 ${f.value.length>0?i??0:0} 条`:w.value==y.limit?"  预计还有更多":"  没有更多了":"")}});async function M(){const{data:s,error:d}=await Re();d||(x.pageCount=20,x.total=Number(s),x.itemCount=Number(s))}M();function c(s){Math.abs(s.target.scrollTop+s.target.offsetHeight-s.target.scrollHeight)<=20&&x.total>f.value.length&&v()}const v=ue.debounce(()=>{var s;((s=f.value)==null?void 0:s.length)<x.total&&(y.pageId=f.value[f.value.length-1].id,z(!0))},300);async function r(s){O.value=s,o.value=!0}async function g(){if(!f.value.length)return;const s=JSON.parse(JSON.stringify(f.value)),d=[];s.forEach(t=>{const p={};e.forEach(i=>{if(t.hasOwnProperty(i.key)){const a=i.key=="elevel"?t[i.key]!=null?C(K[t[i.key]]):"":t[i.key];p[i.title]=a}}),d.push(p)}),Be(d,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50},{wpx:100},{wpx:150}],"安全事件_"+new Date().getTime())}return(s,d)=>{const u=Y,t=se,p=ne;return R(),Z("div",Ye,[l(Fe,{model:y,"onUpdate:model":d[0]||(d[0]=i=>y=i),onSearch:P},null,8,["model"]),l(p,{title:"安全事件",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[l(u,null,{default:n(()=>[l(S(J),{type:"primary",size:"small",ghost:"",onClick:g,title:"导出已加载"},{default:n(()=>[m("导出已加载")]),_:1})]),_:1})]),default:n(()=>[l(t,{columns:e,data:f.value,size:"small","flex-height":!S(D).isMobile,loading:T.value,remote:"","scroll-x":e.reduce((i,a)=>i+a.width,0),"row-key":i=>i.id,pagination:x,"virtual-scroll":"",onScroll:c,class:"sm:h-full","max-height":E.value},null,8,["data","flex-height","loading","scroll-x","row-key","pagination","max-height"])]),_:1}),l(Xe,{detailVisible:o.value,"onUpdate:detailVisible":d[1]||(d[1]=i=>o.value=i),detailInfo:O.value},null,8,["detailVisible","detailInfo"])])}}}),yl=re(ll,[["__scopeId","data-v-6533567e"]]);export{yl as default};
