import{_ as de}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DiicDJ6u.js";import{_ as ue}from"./round-delete-C8pUf6-5.js";import{_ as ce}from"./round-add-DSU4---4.js";import{d as K,aq as H,s as pe,r as Z,q as ee,a as me,ar as te,a1 as fe,c as I,o as O,w as t,f as e,b5 as _e,F as ae,h as o,at as ne,A as U,an as ve,aa as ge,b8 as ye,g as _,N as J,B as z,t as j,$ as k,b6 as he,E as be,U as oe,L as we,i as Ce,x as E,b as Ne,az as G,av as ke,C as V,bl as xe,e as De,ab as Q,aC as Se}from"./index-CfN19u6s.js";import{k as le,l as ze,m as Te,n as W,o as Ue}from"./project-CwkSRyVT.js";import{u as je,a as qe}from"./table-CTILkJri.js";import{u as se}from"./usePageData-C-0Y-TY2.js";import{_ as re}from"./Grid-tk7t2oy6.js";import{_ as ie}from"./FormItemGridItem-Dijuv5Ig.js";import{_ as Fe}from"./round-search-Cj7afvtO.js";import{_ as Pe}from"./round-refresh-BR5chSNE.js";import{N as X}from"./Popconfirm-BGCcZzLh.js";const Re=K({name:"OperateDrawer",__name:"operate-drawer",props:H({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(y,{emit:q}){const h=q,f=y,s=pe(i());function i(){return{pid:void 0,id:"",devname:"",devcount:0,devtype:0,devmanu:"",notes:"",devmodel:"",devunit:""}}const N=async()=>{},b=Z(),{pageData:w,nextPage:x}=se(le),F=async d=>{const n=d.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&w.data.length<w.total&&(x(),b.value=w.data.map(l=>({label:l.contractname,value:l.id})))},P=async d=>{s.pid=d};async function R(){N(),Object.assign(s,i()),f.operateType==="edit"&&f.rowData&&Object.assign(s,f.rowData)}const{formRef:$,validate:v,restoreValidation:T}=ee(),c={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devmanu:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devcount:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},devtype:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},devmodel:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devunit:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},p=me(()=>({add:"新增合同设备",edit:"修改合同设备"})[f.operateType]),m=te(y,"visible");fe(m,()=>{m.value&&(R(),setTimeout(()=>{const d=document.querySelector(".n-scrollbar-content");d==null||d.scrollTo(0,0)},300),T())});function C(){m.value=!1}async function B(){var d,n;if(await v(),f.operateType==="edit"){const{data:l,error:a}=await ze([s]);a||(C(),h("submitted"),(d=window.$message)==null||d.success("修改成功"))}else{const{data:l,error:a}=await Te([{...s}]);a||(C(),h("submitted"),(n=window.$message)==null||n.success("添加成功"))}}return(d,n)=>{const l=ie,a=ye,u=ge,D=re,M=ae,S=_e,L=J,A=he;return O(),I(A,{show:m.value,"onUpdate:show":n[8]||(n[8]=r=>m.value=r),title:p.value,preset:"card",class:"w-580px"},{footer:t(()=>[e(L,{justify:"end",size:16},{default:t(()=>[e(o(z),{onClick:C},{default:t(()=>[_(j(o(k)("common.cancel")),1)]),_:1}),e(o(z),{type:"primary",onClick:B},{default:t(()=>[_(j(o(k)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(S,{class:"pr-20px"},{default:t(()=>[e(M,{ref_key:"formRef",ref:$,model:s,rules:c,"label-placement":"left","label-width":140},{default:t(()=>[e(D,{responsive:"screen","item-responsive":""},{default:t(()=>[e(l,{span:"24 m:24",label:"合同名称",path:"pid"},{default:t(()=>[e(o(ne),{clearable:"",value:s.pid,"onUpdate:value":[n[0]||(n[0]=r=>s.pid=r),P],placeholder:"请选择合同名称",onScroll:F,options:b.value},null,8,["value","options"])]),_:1}),e(l,{span:"24 m:24",label:"设备名称",path:"devname"},{default:t(()=>[e(o(U),{value:s.devname,"onUpdate:value":n[1]||(n[1]=r=>s.devname=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"设备数量",path:"devcount"},{default:t(()=>[e(o(ve),{value:s.devcount,"onUpdate:value":n[2]||(n[2]=r=>s.devcount=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"设备型号",path:"devmodel"},{default:t(()=>[e(o(U),{value:s.devmodel,"onUpdate:value":n[3]||(n[3]=r=>s.devmodel=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"设备单位",path:"devunit"},{default:t(()=>[e(o(U),{value:s.devunit,"onUpdate:value":n[4]||(n[4]=r=>s.devunit=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"是否为我司设备",path:"devtype"},{default:t(()=>[e(u,{value:s.devtype,"onUpdate:value":n[5]||(n[5]=r=>s.devtype=r),name:"radiogroup"},{default:t(()=>[e(a,{value:0},{default:t(()=>n[9]||(n[9]=[_("是")])),_:1,__:[9]}),e(a,{value:1},{default:t(()=>n[10]||(n[10]=[_("否")])),_:1,__:[10]})]),_:1},8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"设备厂家",path:"devmanu"},{default:t(()=>[e(o(U),{value:s.devmanu,"onUpdate:value":n[6]||(n[6]=r=>s.devmanu=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(l,{span:"24 m:24",label:"备注",path:"notes"},{default:t(()=>[e(o(U),{value:s.notes,"onUpdate:value":n[7]||(n[7]=r=>s.notes=r),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),$e=K({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:H(["reset","search","clear"],["update:model"]),setup(y,{emit:q}){const h=q,{formRef:f,restoreValidation:s}=ee(),i=te(y,"model"),N=Z(),{pageData:b,getData:w,nextPage:x}=se(le),F=async()=>{await w({limit:100}),i.value.pids=void 0,N.value=b.data.map(c=>({label:c.contractname,value:c.id}))},P=async c=>{const p=c.currentTarget;p.scrollTop+p.offsetHeight>=p.scrollHeight&&b.data.length<b.total&&(x(),N.value=b.data.map(m=>({label:m.contractname,value:m.id})))},R=async c=>{i.value.pid=c,c&&h("search")};F();async function $(){await s(),i.value.fuzzy="",h("reset")}const v=()=>{i.value.fuzzy="",h("search")};async function T(){h("search")}return(c,p)=>{const m=U,C=ie,B=ne,d=Pe,n=z,l=Fe,a=J,u=re,D=ae,M=oe;return O(),I(M,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(D,{ref_key:"formRef",ref:f,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:be(T,["enter"])},{default:t(()=>[e(u,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(C,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:t(()=>[e(m,{value:i.value.fuzzy,"onUpdate:value":p[0]||(p[0]=S=>i.value.fuzzy=S),placeholder:"请输入",clearable:"",onClear:v},null,8,["value"])]),_:1}),e(C,{span:"24 s:12 m:6",label:"合同名称",path:"pids"},{default:t(()=>[e(B,{filterable:"",multiple:"",value:i.value.pids,"onUpdate:value":[p[1]||(p[1]=S=>i.value.pids=S),R],placeholder:"请选择合同名称",onScroll:P,options:N.value},null,8,["value","options"])]),_:1}),e(C,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(a,{class:"w-full"},{default:t(()=>[e(n,{onClick:$},{icon:t(()=>[e(d,{class:"text-icon"})]),default:t(()=>[_(" "+j(o(k)("common.reset")),1)]),_:1}),e(n,{type:"primary",ghost:"",onClick:T},{icon:t(()=>[e(l,{class:"text-icon"})]),default:t(()=>[_(" "+j(o(k)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Y(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Se(y)}const We=K({name:"projectmanagement_contractdevice",__name:"index",setup(y){const q=we(),{columns:h,columnChecks:f,data:s,getData:i,loading:N,mobilePagination:b,searchParams:w}=je({showTotal:!0,apiFn:Ue,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",pids:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"devname",title:"设备名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"devcount",title:"数量",align:"center",width:120},{key:"devmodel",title:"型号",align:"center",width:120},{key:"devunit",title:"单位",align:"center",width:120},{key:"devtype",title:"是否为我司厂家",align:"center",width:120,render:l=>l.devtype==1?e(Q,{type:"success"},{default:()=>[_("是")]}):e(Q,{type:"info"},{default:()=>[_("否")]})},{key:"devmanu",title:"设备厂家",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:k("common.operate"),align:"center",width:140,fixed:"right",render:l=>{let a;return e("div",{class:"flex-center gap-8px"},[V(e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>C(l.id)},Y(a=k("common.edit"))?a:{default:()=>[a]}),[[E("no-auth"),"project:device:update"]]),e(X,{onPositiveClick:()=>m(l.id)},{default:()=>k("common.confirmDelete"),trigger:()=>{let u;return V(e(z,{type:"error",ghost:!0,size:"small"},Y(u=k("common.delete"))?u:{default:()=>[u]}),[[E("no-auth"),"project:device:delete"]])}})])}}]}),{drawerVisible:x,operateType:F,editingData:P,handleAdd:R,handleEdit:$,checkedRowKeys:v,onBatchDeleted:T,onDeleted:c}=qe(s,i);Ce(async()=>{});async function p(){console.log(v.value),B(v.value.join(","),l=>{T()})}async function m(l){const{data:a,error:u}=await W(l);u||c()}function C(l){$(l)}async function B(l,a){const{data:u,error:D}=await W(l);if(!D)a&&a(u);else return!1}const d=l=>{i()},n=()=>{i()};return(l,a)=>{const u=J,D=ce,M=ue,S=de,L=ke,A=oe,r=E("no-auth");return O(),Ne("div",Be,[e($e,{model:o(w),"onUpdate:model":a[0]||(a[0]=g=>G(w)?w.value=g:null),onReset:n,onSearch:o(i),onClear:a[1]||(a[1]=g=>s.value=[])},null,8,["model","onSearch"]),e(A,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(u,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>a[5]||(a[5]=[De("div",null,"合同设备",-1)])),_:1,__:[5]})]),"header-extra":t(()=>[e(u,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[V((O(),I(o(z),{onClick:o(R),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(D,{class:"text-icon"})]),default:t(()=>[a[6]||(a[6]=_(" "+j("新增")))]),_:1,__:[6]},8,["onClick"])),[[r,"project:device:insert"]]),e(o(X),{onPositiveClick:p},{trigger:t(()=>[V((O(),I(o(z),{size:"small",ghost:"",type:"error",disabled:o(v).length==0},{icon:t(()=>[e(M,{class:xe(["text-icon",{"animate-spin":o(N)}])},null,8,["class"])]),default:t(()=>[a[7]||(a[7]=_(" "+j("批量删除")))]),_:1,__:[7]},8,["disabled"])),[[r,"project:device:delete"]])]),default:t(()=>[a[8]||(a[8]=_(" 确定要删除选中的联系人吗？ "))]),_:1,__:[8]}),e(S,{columns:o(f),"onUpdate:columns":a[2]||(a[2]=g=>G(f)?f.value=g:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(L,{"checked-row-keys":o(v),"onUpdate:checkedRowKeys":a[3]||(a[3]=g=>G(v)?v.value=g:null),columns:o(h),data:o(s),size:"small","flex-height":!o(q).isMobile,loading:o(N),remote:"","row-key":g=>g.id,pagination:o(b),class:"sm:h-full","onUpdate:filters":d},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Re,{visible:o(x),"onUpdate:visible":a[4]||(a[4]=g=>G(x)?x.value=g:null),onSubmitted:o(i),"operate-type":o(F),"row-data":o(P)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{We as default};
