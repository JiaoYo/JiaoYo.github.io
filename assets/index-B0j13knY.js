import{d as R,q as M,v as le,s as J,o as P,c as W,w as o,g as t,i as y,T as ne,at as ie,h as b,t as D,$ as m,M as oe,au as se,W as ue,B as q,E as K,D as re,a8 as Y,j as S,y as ce,r as $,al as L,e as O,ao as de,ap as pe,S as fe,F as me,av as _e,aw as ve,f as Q,ac as X,ax as Z,Y as ge}from"./index-B6CaFrdK.js";import{f as ye,a as he,b as be,c as xe}from"./audit-events-80MfkFPy.js";import{l as ee}from"./lodash-BCkEcMa2.js";import{T as E}from"./basicconf-st_OmXhq.js";import{_ as Te}from"./round-search-D3Y2ilQp.js";import{_ as De}from"./round-refresh-xFEcy0W1.js";import{u as Se}from"./usePageData-DeDMJRK5.js";import{f as ke}from"./system-manage-B8Xh4E3K.js";import{_ as we}from"./DatePicker-CEunlrwC.js";import{_ as Ce}from"./FormItemGridItem-B1S8z6D6.js";import{_ as Ae}from"./Grid-Bc3MJ5ql.js";import{f as Ne}from"./events-Chq6xeeV.js";import{_ as ze,a as Ie}from"./DescriptionsItem-eB1Etpo9.js";import{_ as te}from"./DataTable-Bk5Sz1vp.js";import"./TimePicker-DvHwKwh_.js";import"./defineProperty-C89NUysx.js";import"./Forward-CrI4707i.js";const Pe=R({name:"FormSearch",__name:"form-search",props:M({AuditTypeData:{},AuditPolicyData:{}},{model:{required:!0},modelModifiers:{}}),emits:M(["reset","search"],["update:model"]),setup(p,{emit:A}){const h=p,s=A,{formRef:k,restoreValidation:N}=le(),l=J(p,"model");Se(ke);async function z(d,n){d&&d.length>0?(l.value.startTime=d[0],l.value.endTime=d[1]):(l.value.startTime=null,l.value.endTime=null)}async function _(){await N(),l.value.timeRange=null,l.value.atype=null,l.value.ap=null,l.value.startTime=null,l.value.endTime=null,l.value.elevel=null,se(()=>{s("search")})}async function x(){s("search")}return(d,n)=>{const r=ue,u=Ce,v=we,g=De,T=q,w=Te,C=K,I=Ae,a=re,e=Y;return P(),W(e,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[t(a,{ref_key:"formRef",ref:k,model:l.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:oe(x,["enter"])},{default:o(()=>[t(I,{responsive:"screen","item-responsive":""},{default:o(()=>[t(u,{span:"24 s:12 m:8",label:"事件等级",path:"elevel",class:"pr-24px"},{default:o(()=>[t(r,{filterable:"",clearable:"",value:l.value.elevel,"onUpdate:value":[n[0]||(n[0]=i=>l.value.elevel=i),x],placeholder:"请选择事件等级",options:y(ne)(y(ie))},null,8,["value","options"])]),_:1}),t(u,{span:"24 s:12 m:8",label:"审计类型",path:"atype",class:"pr-24px"},{default:o(()=>[t(r,{value:l.value.atype,"onUpdate:value":[n[1]||(n[1]=i=>l.value.atype=i),x],placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:h.AuditTypeData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(u,{span:"24 s:12 m:8",label:"审计策略",path:"ap",class:"pr-24px"},{default:o(()=>[t(r,{value:l.value.ap,"onUpdate:value":[n[2]||(n[2]=i=>l.value.ap=i),x],placeholder:"请选择审计策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:h.AuditPolicyData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(u,{span:"24 s:12 m:8",label:"产生时间",path:"timeRange",class:"pr-24px mt-20px"},{default:o(()=>[t(v,{clearable:"",value:l.value.timeRange,"onUpdate:value":n[3]||(n[3]=i=>l.value.timeRange=i),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":z},null,8,["value"])]),_:1}),t(u,{span:"24 s:12 m:6",class:"pr-24px mt-20px",label:" "},{default:o(()=>[t(C,{class:"w-full"},{default:o(()=>[t(T,{onClick:_},{icon:o(()=>[t(g,{class:"text-icon"})]),default:o(()=>[b(" "+D(y(m)("common.reset")),1)]),_:1}),t(T,{type:"primary",ghost:"",onClick:x},{icon:o(()=>[t(w,{class:"text-icon"})]),default:o(()=>[b(" "+D(y(m)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ae=p=>(_e("data-v-bb968884"),p=p(),ve(),p),Ve=ae(()=>Q("span",null,"事件信息",-1)),$e=ae(()=>Q("span",null,"事件溯源",-1)),Me={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"500px"}},Le={key:1,class:"max-h-500px min-h-320px"};function Oe(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!X(p)}const Ee=R({__name:"detailInfo",props:M({detailInfo:{},AuditTypeData:{},AuditPolicyData:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(p){const A=J(p,"detailVisible"),h=p,s=S();ce(()=>A.value,async n=>{n&&(s.value=h.detailInfo,z())});const k=[{title:"",key:"index",width:50,render:(n,r)=>`${r+1}`},{key:"ename",title:"安全事件名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"安全事件类型",align:"center",width:140},{key:"pname2",title:"安全事件类别",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:n=>{(n.elevel===void 0||n.elevel===null)&&(n.elevel=1);const r={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},u=m(E[n.elevel]);let v={color:r[n.elevel],textColor:"#ffffff",borderColor:r[n.elevel]};return t(L,{size:"small",color:v},Oe(u)?u:{default:()=>[u]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:180},{key:"type",title:"发生源设备类型",align:"center",width:160}],N=S(!1);let l=$([]);const z=async n=>{var v;if(!N.value)N.value=!0;else return;const{data:r,error:u}=await Ne({pageId:n,auditid:(v=s.value)==null?void 0:v.auditid,limit:20});u||(N.value=!1,n?l=[...l,...r]:l=r)};function _(n){var r;n.target.scrollTop+n.target.offsetHeight==n.target.scrollHeight&&((r=s.value)==null?void 0:r.eco)>l.length&&x()}const x=ee.debounce(()=>{z(l[l.length-1].id)},300),d=$({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:n,endIndex:r,page:u,pageSize:v,pageCount:g,itemCount:T}){var w,C;return`已加载${l.length}条 共${(l.length>((w=s.value)==null?void 0:w.eco)?l.length:(C=s.value)==null?void 0:C.eco)||0}条`}});return(n,r)=>{const u=ze,v=Ie,g=K,T=de,w=te,C=pe,I=fe,a=me;return P(),W(a,{show:A.value,"onUpdate:show":r[0]||(r[0]=e=>A.value=e),title:"事件详情",preset:"card",class:"w-1200px"},{default:o(()=>[t(I,{class:"max-h-600px pr-20px"},{default:o(()=>[t(C,{type:"line",animated:""},{default:o(()=>[t(T,{name:"1"},{tab:o(()=>[Ve]),default:o(()=>[t(g,{vertical:"",size:12},{default:o(()=>[t(v,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:o(()=>[t(u,{label:"审计事件名称"},{default:o(()=>{var e;return[b(D((e=s.value)==null?void 0:e.aename),1)]}),_:1}),t(u,{label:"审计类型"},{default:o(()=>{var e,i;return[b(D(((e=h.AuditTypeData.find(f=>{var c;return f.id===((c=s.value)==null?void 0:c.atype)}))==null?void 0:e.atypename)||((i=s.value)==null?void 0:i.atype)||""),1)]}),_:1}),t(u,{label:"审计策略"},{default:o(()=>{var e,i;return[b(D(((e=h.AuditPolicyData.find(f=>{var c;return f.id===((c=s.value)==null?void 0:c.ap)}))==null?void 0:e.pname)||((i=s.value)==null?void 0:i.ap)||""),1)]}),_:1}),t(u,{label:"事件等级"},{default:o(()=>{var e,i,f,c,V,U,B,G,j,H;return[t(y(L),{size:"small",color:{textColor:"#ffffff",borderColor:((e=s.value)==null?void 0:e.alevel)===0?"#8e9dff":((i=s.value)==null?void 0:i.alevel)===1?"#5da8ff":((f=s.value)==null?void 0:f.alevel)===2?"#fedc69":((c=s.value)==null?void 0:c.alevel)===3?"#ff9874":((V=s.value)==null?void 0:V.alevel)===4?"#ff0000":"#5da8ff",color:((U=s.value)==null?void 0:U.alevel)===0?"#8e9dff":((B=s.value)==null?void 0:B.alevel)===1?"#5da8ff":((G=s.value)==null?void 0:G.alevel)===2?"#fedc69":((j=s.value)==null?void 0:j.alevel)===3?"#ff9874":((H=s.value)==null?void 0:H.alevel)===4?"#ff0000":"#5da8ff"}},{default:o(()=>{var F;return[b(D(y(m)(y(E)[(F=s.value)==null?void 0:F.alevel])),1)]}),_:1},8,["color"])]}),_:1}),t(u,{label:"产生时间"},{default:o(()=>{var e;return[b(D((e=s.value)==null?void 0:e.dbtime),1)]}),_:1}),t(u,{label:"更新时间"},{default:o(()=>{var e;return[b(D((e=s.value)==null?void 0:e.uptime),1)]}),_:1}),t(u,{label:"事件总数"},{default:o(()=>{var e;return[b(D((e=s.value)==null?void 0:e.eco),1)]}),_:1})]),_:1})]),_:1})]),_:1}),t(T,{name:"2"},{tab:o(()=>[$e]),default:o(()=>[y(l).length==0?(P(),O("div",Me," 暂无安全事件信息 ")):(P(),O("div",Le,[t(w,{columns:k,data:y(l),size:"small","scroll-x":762,"row-key":e=>e.id,"virtual-scroll":"",class:"sm:h-full","max-height":400,loading:N.value,pagination:d,onScroll:_},null,8,["data","row-key","loading","pagination"])]))]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Re=Z(Ee,[["__scopeId","data-v-bb968884"]]),Ue={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Be(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!X(p)}const Ge=R({name:"audit_event",__name:"index",setup(p){const A=ge(),h=S(!1),s=S(),k=S([]);(async()=>{const{data:a,error:e}=await ye({page:1,limit:1e3});e||(k.value=JSON.parse(JSON.stringify(a)).list)})();const l=S([]);(async()=>{const{data:a,error:e}=await he({page:1,limit:1e3});e||(l.value=JSON.parse(JSON.stringify(a)).list)})();const _=$({limit:20,pageId:void 0,elevel:void 0,atype:void 0,uid:void 0,suditPolicy:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),x=[{key:"aename",title:m("page.audit.event.eventName"),align:"center",minWidth:160,ellipsis:!0,resizable:!0},{key:"atype",title:m("page.audit.event.type"),align:"center",minWidth:160,render:a=>{var i;const e=(i=k.value.find(f=>f.id===a.atype))==null?void 0:i.atypename;return t("span",null,[e||a.atype])},resizable:!0},{key:"dbtime",title:m("page.audit.event.createTime"),align:"center",width:180,resizable:!0},{key:"uptime",title:m("page.audit.event.updateTime"),align:"center",width:180,resizable:!0},{key:"ap",title:m("page.audit.event.strategy"),align:"center",width:120,render:a=>{var i;const e=(i=l.value.find(f=>f.id===a.ap))==null?void 0:i.pname;return t("span",null,[e||a.ap])},resizable:!0},{key:"alevel",title:m("page.audit.event.eventRanK"),align:"center",width:120,render:a=>{(a.alevel===void 0||a.alevel===null)&&(a.alevel=0);const e={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},i=m(E[a.alevel]);let f={color:e[a.alevel],textColor:"#ffffff",borderColor:e[a.alevel]};return t(L,{size:"small",color:f},Be(i)?i:{default:()=>[i]})},resizable:!0},{key:"eco",title:m("page.audit.event.eventCount"),align:"center",width:120,resizable:!0},{key:"operate",title:m("common.operate"),align:"center",width:130,fixed:"right",render:a=>t("div",{class:"flex-center gap-8px"},[t(q,{type:"primary",ghost:!0,size:"small",onClick:()=>I(a)},{default:()=>[b("详情")]})])}],d=S([]),n=S(!1),r=async(a=!1)=>{if(!n.value)n.value=!0;else return;n.value=!0;const{data:e,error:i}=await be(_);i||(a?d.value=[...d.value,...e]:d.value=e,n.value=!1)};r();const u=S(!0),v=()=>{d.value=[],_.pageId=void 0,(e=>Object.keys(e).filter(c=>c!=="limit"&&c!=="_t").some(c=>e[c]!==void 0&&e[c]!==""&&e[c]!==null))(_)?u.value=!1:(u.value=!0,T()),r()},g=$({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:e,page:i,pageSize:f,pageCount:c,itemCount:V}){return`已加载${d.value.length}条`+(d.value.length?u.value?` 共计 ${d.value.length>0?V??0:0} 条`:d.value.length>=_.limit?"  预计还有更多":"":"")}});async function T(){const{data:a,error:e}=await xe();e||(g.pageCount=20,g.total=Number(a),g.itemCount=Number(a))}T();function w(a){var e;a.target.scrollTop+a.target.offsetHeight==a.target.scrollHeight&&g.total>((e=d.value)==null?void 0:e.length)&&C()}const C=ee.debounce(()=>{var a;((a=d.value)==null?void 0:a.length)<g.total&&(_.pageId=d.value[d.value.length-1].id,r(!0))},300);async function I(a){s.value=a,h.value=!0}return(a,e)=>{const i=te,f=Y;return P(),O("div",Ue,[t(Pe,{model:_,"onUpdate:model":e[0]||(e[0]=c=>_=c),onSearch:v,AuditTypeData:k.value,AuditPolicyData:l.value},null,8,["model","AuditTypeData","AuditPolicyData"]),t(f,{title:y(m)("page.audit.event.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[]),default:o(()=>[t(i,{columns:x,data:d.value,size:"small","flex-height":!y(A).isMobile,loading:n.value,remote:"","row-key":c=>c.id,pagination:g,onScroll:w,class:"sm:h-full","scroll-x":""},null,8,["data","flex-height","loading","row-key","pagination"]),t(Re,{"detail-visible":h.value,"onUpdate:detailVisible":e[1]||(e[1]=c=>h.value=c),"detail-info":s.value,AuditTypeData:k.value,AuditPolicyData:l.value},null,8,["detail-visible","detail-info","AuditTypeData","AuditPolicyData"])]),_:1},8,["title"])])}}}),ot=Z(Ge,[["__scopeId","data-v-01c91391"]]);export{ot as default};
