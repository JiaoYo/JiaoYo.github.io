import{aB as c,d as K,aG as C,C as Q,A as W,s as X,bZ as N,a as Y,aI as ee,cs as te,aE as S,d0 as ae,c as j,o as D,w as i,f as l,L as oe,F as L,e as B,N as re,h as d,aF as se,t as h,G as b,I as le,B as U,g as I,$ as F,a9 as ne,cu as ie,aP as de}from"./index-CYktWG4g.js";import{u as ce}from"./usePageData-B3dmJo7x.js";function we(o){return c({url:"/projectDailyReport/getPage.do",method:"get",params:o})}function ue(o){return c({url:"/projectDailyReport/insert.do",method:"post",data:o})}function pe(o){return c({url:"/projectDailyReport/getIdByUuid.do",method:"get",params:o})}function me(o){return c({url:"/projectDailyReport/update.do",method:"put",data:o})}function je(o){return c({url:"/projectDailyReport/delete.do",method:"delete",params:{arrIds:o}})}function fe(o){return c({url:"/projectDaily/insert.do",method:"post",data:o})}function De(o){return c({url:"/projectComment/getPage.do",method:"get",params:o})}function _e(o){return c({url:"/projectComment/insert.do",method:"post",data:o})}function ke(o){return c({url:"/projectComment/delete.do",method:"delete",params:{arrIds:o}})}const Pe=K({name:"OperateDrawer",__name:"operate-drawer",props:C({operateType:{},rowData:{},pid:{},pname:{},type:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:C(["submitted"],["update:visible"]),setup(o,{emit:R}){const _=R,{pageData:u,getData:y,nextPage:G}=ce(ie),M=async t=>{const a=t.currentTarget,n=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&u.data.length<u.total&&(await G(),await de(),setTimeout(()=>{a.scrollTop=n}))},r=o,e=Q(k());function k(){return{id:"",proname:"",notes:"",problem:"",solutions:"",feedback:"",summarize:"",pids:[],charctras:0}}const O={notes:{required:!0,message:"请输入",trigger:"blur"}};async function V(){if(await y({fuzzy:r.pname,page:1}),Object.assign(e,k()),r.operateType==="add"&&(console.log(r.pid),r.pid&&(u.data.forEach(t=>{t.id==r.pid&&(t.disabled=!0)}),e.pids.push(r.pid))),r.operateType==="edit"&&r.rowData){Object.assign(e,r.rowData);const t=JSON.parse(r.rowData.context);e.proname=t.proname,e.notes=t.notes,e.problem=t.problem,e.solutions=t.solutions,e.feedback=t.feedback,e.summarize=t.summarize}}const{formRef:A,validate:E,restoreValidation:$}=W(),P=()=>{r.type=="detail"&&(e.pids=r.pid),y({page:1})},x=X([]),q=N.debounce(async t=>{x.value=u.data.filter(a=>e.pids.includes(a.id)),await y({fuzzy:t,page:1}),u.data=u.data.concat(x.value)},300),J=t=>{if(!t){e.pids=null,P();return}q(t)},H=Y(()=>({add:"新增项目日报",edit:"修改项目日报"})[r.operateType]),p=ee(o,"visible"),v=()=>{p.value=!1},Z=N.debounce(async()=>{var t,a;if(await E(),r.operateType==="edit"){const n=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:g,error:m}=await me([{context:n,id:e.id,charctras:e.charctras}]);m||((t=window.$message)==null||t.success("修改成功"),_("submitted"),v())}else{const n=te(),g=u.data.filter(f=>e.pids.includes(f.id)).map(f=>f.proname);e.proname=g.join(",");const m=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:z,error:s}=await ue([{context:m,uuid:n,charctras:e.charctras}]);if(!s){const{data:f,error:be}=await pe({uuid:n});if(e.pids.length>0){let T=e.pids.map(w=>({pid:w}));T.forEach(w=>{w.did=f});const{data:ge,error:he}=await fe(T)}(a=window.$message)==null||a.success("添加成功"),_("submitted"),v()}}},1e3,{leading:!0,trailing:!1});return S(p,()=>{p.value&&(V(),setTimeout(()=>{const t=document.querySelector(".n-scrollbar-content");t==null||t.scrollTo(0,0)},300),$())}),S(()=>[e.notes,e.problem,e.solutions,e.feedback,e.summarize],()=>{e.charctras=ae(e.notes+e.problem+e.solutions+e.feedback+e.summarize)},{immediate:!0}),(t,a)=>{const n=re,g=oe,m=le,z=ne;return D(),j(z,{show:p.value,"onUpdate:show":a[6]||(a[6]=s=>p.value=s),title:H.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:i(()=>[l(m,{justify:"end"},{default:i(()=>[l(d(U),{size:"small",class:"mt-16px",onClick:v},{default:i(()=>[I(h(d(F)("common.cancel")),1)]),_:1}),l(d(U),{type:"primary",size:"small",class:"mt-16px",onClick:d(Z)},{default:i(()=>[I(h(d(F)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:i(()=>[l(g,{ref_key:"formRef",ref:A,model:e,rules:O},{default:i(()=>[r.operateType==="add"?(D(),j(n,{key:0,label:"关联项目",path:"pids","label-placement":"left"},{default:i(()=>[l(d(se),{clearable:"",filterable:"",value:e.pids,"onUpdate:value":a[0]||(a[0]=s=>e.pids=s),placeholder:"请选择项目","label-field":"proname",multiple:"","value-field":"id",onClear:P,onSearch:J,options:d(u).data,onScroll:M},null,8,["value","options"])]),_:1})):L("",!0),r.operateType==="edit"&&e.proname?(D(),j(n,{key:1,label:"项目名称",path:"proname","label-placement":"left"},{default:i(()=>[B("span",null,h(e.proname),1)]),_:1})):L("",!0),l(n,{label:"当前工作内容及成果描述：",path:"notes"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",value:e.notes,"onUpdate:value":a[1]||(a[1]=s=>e.notes=s),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"遇到问题：",path:"problem"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.problem,"onUpdate:value":a[2]||(a[2]=s=>e.problem=s),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"解决措施：",path:"solutions"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.solutions,"onUpdate:value":a[3]||(a[3]=s=>e.solutions=s),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"建议意见反馈：",path:"feedback"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.feedback,"onUpdate:value":a[4]||(a[4]=s=>e.feedback=s),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"（总结）自己对一天工作的感受和体感：",path:"summarize"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.summarize,"onUpdate:value":a[5]||(a[5]=s=>e.summarize=s),placeholder:"请输入"},null,8,["value"])]),_:1}),B("div",null,"字符数："+h(e.charctras),1)]),_:1},8,["model"])]),_:1},8,["show","title"])}}});export{Pe as _,De as a,ke as b,we as c,je as d,_e as f};
