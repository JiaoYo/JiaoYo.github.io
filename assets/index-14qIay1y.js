import{_ as Zt}from"./round-refresh-BDZcKrQw.js";import{_ as el}from"./round-add-CL2Vba1y.js";import{_ as tl}from"./table-column-setting.vue_vue_type_script_setup_true_lang-D-WWUWev.js";import{_ as ll}from"./round-delete-BJCk8P86.js";import{_ as sl}from"./round-search-D_VWcob1.js";import{d as wt,av as pt,D as K,s as S,A as al,a as tt,ax as nl,at as rl,c as P,o as R,w as s,f as l,M as bt,L as il,a3 as ol,G as j,h as i,H as Ae,az as _t,g as y,B as _,b as kt,aA as ul,aB as Lt,J as Ft,aC as xt,t as I,$ as U,a4 as Ct,aE as Fe,aG as Be,z as dl,aJ as Pe,i as cl,au as pl,a2 as fl,ay as ml,aK as Ye,e as yl,N as gl,aM as vl,aR as ft,aS as hl,n as m,aP as mt,aD as wl,a5 as bl,I as O,aN as _l,F as G,aQ as kl}from"./index-BTeMkgsf.js";import{e as Ll,g as qe,d as Ze,j as Fl,k as xl,l as Cl,m as zl,q as Sl,r as $l,N as Ul,v as Rl,a as C,o as Tl}from"./maskstr-Dv7D7Qym.js";import{u as yt,a as gt}from"./table-nKGzp9nE.js";import{_ as zt}from"./Grid-D1GO_CFb.js";import{_ as St}from"./FormItemGridItem-DlZX07SE.js";import{h as de}from"./permission-Dvxa1exs.js";import{u as et}from"./usePageData-BtaN_wXr.js";import{_ as Dl}from"./DatePicker-ABP-mfiZ.js";import{N as vt}from"./Popconfirm-BVBTnPX5.js";const Nl=["src"],Il=wt({name:"UpdateSn",__name:"update-sn",props:pt({rowId:{},rowMtype:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:pt(["submitted"],["update:visible"]),setup(X,{emit:ce}){const pe=ce,z=X,a=K(M()),fe=S(100),Y=S(0);function M(){return{id:0,sn:"",fault:"",details:0,accessory:"",returnnum:"",re1:"",re2:"",re3:"",re4:"",re5:"",re6:"",re7:"",rsn:"",rdetails:0,raccessory:"",videoSrc:"",fileList:[],uploadVideoFileList:[],analyzeFileList:[],notes:""}}async function V(){a.videoSrc="",a.fileList=[],a.uploadVideoFileList=[],a.analyzeFileList=[],Object.assign(a,M()),await J()}const{formRef:se,validate:Oe,restoreValidation:Ge}=al(),T={sn:{validator:(n,r)=>{if(!r||r.trim().length===0)return new Error("请输入设备编号");const f=xe(r);for(const h of f){if(!h||h.trim().length===0)return new Error("存在空的设备编号，请检查输入");if(h==="null"||h==="undefined")return new Error("存在无效的设备编号，请检查输入");if(h.length<9)return new Error("设备编号长度至少 9 位")}return!0},trigger:["input","blur"]},fault:{type:"string",required:!0,trigger:["blur","change"],message:"请输入故障现象"},accessory:{type:"string",required:!1,trigger:["blur","change"],message:"请输入客户寄件配件详情"},raccessory:{type:"string",required:!1,trigger:["blur","change"],message:"请输入寄件配件详情"}},Z=tt(()=>{const n={sn:T.sn,fault:T.fault};return z.rowMtype===0?(a.details===1?n.accessory={...T.accessory,required:!0}:n.accessory={...T.accessory,required:!1},a.rdetails===1?n.raccessory={...T.raccessory,required:!0}:n.raccessory={...T.raccessory,required:!1}):z.rowMtype===1?a.details===1?n.accessory={...T.accessory,required:!0}:n.accessory={...T.accessory,required:!1}:z.rowMtype===2?(a.details===1?n.accessory={...T.accessory,required:!0}:n.accessory={...T.accessory,required:!1},a.rdetails===1?n.raccessory={...T.raccessory,required:!0}:n.raccessory={...T.raccessory,required:!1}):z.rowMtype===3&&(a.rdetails===1?n.raccessory={...T.raccessory,required:!0}:n.raccessory={...T.raccessory,required:!1}),n});async function J(){const{data:n,error:r}=await Ll({id:z.rowId,_t:new Date().getTime()});r||(Object.assign(a,n),a.rdetails=Number(a.rdetails),n.re1&&a.fileList.push({id:"0",name:"0",url:n.re1,status:"finished"}),n.re2&&a.fileList.push({id:"1",name:"1",url:n.re2,status:"finished"}),n.re3&&a.fileList.push({id:"2",name:"2",url:n.re2,status:"finished"}),n.re4&&(a.videoSrc=n.re4,a.uploadVideoFileList.push({id:"0",name:"0",url:n.re4,status:"finished"})),n.re5&&a.analyzeFileList.push({id:"0",name:"0",url:n.re5,status:"finished"}),n.re6&&a.analyzeFileList.push({id:"1",name:"1",url:n.re6,status:"finished"}),n.re7&&a.analyzeFileList.push({id:"2",name:"2",url:n.re7,status:"finished"}))}const me=tt(()=>{if(!a.sn)return[];let n=a.sn.trim();return n===""?[]:(n=n.replace(/，|、/g,","),n[n.length-1]===","&&(n=n.substring(0,n.length-1)),n.split(",").map(r=>r.trim().replace(/\u3000/g,"").trim()).filter(r=>r!==""))}),ee=nl(X,"visible");rl(ee,()=>{ee.value&&(V(),Ge())});function je(n){let r=n.replace(/，/g,",").replace(/、/g,",").replace(/　/g," ");const f=xe(r),h=r[r.length-1];if(f.length>=fe.value&&h===","){Fe(()=>{a.sn=n.substring(0,n.length-1)});return}if(f.length>fe.value){const D=f.slice(0,fe.value).join(", ");Fe(()=>{a.sn=D});return}r!==n&&Fe(()=>{a.sn=r})}function xe(n){return n?(n=n.trim(),n===""?[]:n.split(",").map(r=>r.trim().replace(/\u3000/g,"").trim()).filter(r=>r!=="")):[]}function Ee(n){var D,L,x,g;const r=["image/jpeg","image/png","image/jpg","image/x-icon"];console.log("data.file.file",n.file.file);const f=r.includes(n.file.file.type),h=n.file.file.size/1024/1024<100;return f||((D=window.$message)==null||D.destroyAll(),(L=window.$message)==null||L.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片")),h||((x=window.$message)==null||x.destroyAll(),(g=window.$message)==null||g.error("上传图片大小不能超过 100MB")),f&&h}async function Me(n){var L,x;const{file:r,onFinish:f,onError:h}=n;new FormData().append("multipartFile",r.file);try{const g=await Be(r.file,r.name,"aftermarket/image");g&&(r.url=g,f({...r,url:g}),(L=window.$message)==null||L.destroyAll(),(x=window.$message)==null||x.success("上传成功"))}catch(g){h(g)}}function Ce(n){var D,L,x,g;const f=["video/mp4","video/avi","video/mov","video/mpeg"].includes(n.file.file.type),h=n.file.file.size/1024/1024<100;return f||((D=window.$message)==null||D.destroyAll(),(L=window.$message)==null||L.error("格式错误，请上传视频！")),h||((x=window.$message)==null||x.destroyAll(),(g=window.$message)==null||g.error("上传视频大小不能超过 100MB！")),f&&h}async function ze(n){Y.value=0;const{file:r,onFinish:f,onError:h}=n;new FormData().append("multipartFile",r.file);try{const L=await Be(r.file,r.name,"aftermarket/image/",x=>{Y.value=x});L&&(f({...r,url:L}),a.videoSrc=L,Y.value=0)}catch(L){h(L)}}async function Ve(n){var L,x;const{file:r,onFinish:f,onError:h}=n;new FormData().append("multipartFile",r.file);try{const g=await Be(r.file,r.name,"aftermarket/image");g&&(r.url=g,f({...r,url:g}),(L=window.$message)==null||L.destroyAll(),(x=window.$message)==null||x.success("上传成功"))}catch(g){h(g)}}function Se(){ee.value=!1}function W(n){return new Promise((r,f)=>{Ve({file:n,onFinish:()=>r(!0),onError:h=>f(h)})})}function ae(n){return new Promise((r,f)=>{ze({file:n,onFinish:()=>r(!0),onError:h=>f(h)})})}async function $e(){var L,x;await Oe();let n=[];await Promise.all([...a.fileList.map(g=>(g.url&&!g.url.startsWith("https://pictures.linkqi.cn")||!g.url)&&W(g)),...a.uploadVideoFileList.map(g=>(g.url&&!g.url.startsWith("https://pictures.linkqi.cn")||!g.url)&&ae(g))]);let r=me.value;for(var f=0;f<r.length;f++)z.rowMtype===0?n.push({id:z.rowId,sn:r[f],details:a.details,accessory:a.accessory,fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null}):z.rowMtype===1?n.push({id:z.rowId,sn:r[f],details:a.details,accessory:a.accessory,fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null}):z.rowMtype===2?n.push({id:z.rowId,sn:r[f],details:a.details,accessory:a.accessory,fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null}):z.rowMtype===3&&n.push({id:z.rowId,sn:r[f],fault:a.fault,re1:a.fileList.length>0?a.fileList[0].url:null,re2:a.fileList.length>1?a.fileList[1].url:null,re3:a.fileList.length>2?a.fileList[2].url:null,re4:a.videoSrc||null});const{data:h,error:D}=await qe(n);D||((L=window.$message)==null||L.destroyAll(),(x=window.$message)==null||x.success("修改成功"),Se(),pe("submitted"))}return(n,r)=>{const f=St,h=_t,D=ul,L=xt,x=Ft,g=Lt,ye=zt,ne=ol,Ue=bt,ge=Ct;return R(),P(ge,{show:ee.value,"onUpdate:show":r[6]||(r[6]=N=>ee.value=N),title:"修改",preset:"card",class:"w-60%"},{footer:s(()=>[l(x,{justify:"end",size:16,class:"pr-20px"},{default:s(()=>[l(i(_),{onClick:Se},{default:s(()=>[y(I(i(U)("common.cancel")),1)]),_:1}),l(i(_),{type:"primary",onClick:$e},{default:s(()=>[y(I(i(U)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(Ue,{ref_key:"formRef",ref:se,model:a,rules:Z.value,"label-placement":"left","label-width":140,onKeyup:il($e,["enter"])},{default:s(()=>[l(ne,{style:{"max-height":"600px"},class:"pr-20px"},{default:s(()=>[l(ye,{responsive:"screen","item-responsive":""},{default:s(()=>[l(f,{span:"24 m:24 s:24",label:"设备编号",path:"sn"},{default:s(()=>[l(i(Ae),{clearable:"",value:a.sn,"onUpdate:value":r[0]||(r[0]=N=>a.sn=N),placeholder:"请输入设备编号",disabled:"",onInput:je},null,8,["value"])]),_:1}),l(f,{span:"24 m:24 s:24",label:"故障现象",path:"fault"},{default:s(()=>[l(i(Ae),{type:"textarea",value:a.fault,"onUpdate:value":r[1]||(r[1]=N=>a.fault=N),placeholder:"请输入故障现象",clearable:""},null,8,["value"])]),_:1}),l(f,{span:"24 m:24 s:24",label:"现场照片"},{default:s(()=>[l(h,{multiple:"",max:3,"file-list":a.fileList,"onUpdate:fileList":r[2]||(r[2]=N=>a.fileList=N),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ee,"custom-request":Me},{default:s(()=>r[7]||(r[7]=[y(" 点击上传 ")])),_:1,__:[7]},8,["file-list"])]),_:1}),l(f,{span:"24 m:24 s:24",label:"现场视频"},{default:s(()=>[l(h,{"show-file-list":!a.videoSrc,"file-list":a.uploadVideoFileList,"onUpdate:fileList":r[3]||(r[3]=N=>a.uploadVideoFileList=N),"default-upload":!1,onBeforeUpload:Ce,"custom-request":ze},{default:s(()=>[l(i(_),{type:"primary"},{default:s(()=>r[8]||(r[8]=[y(" 上传视频 ")])),_:1,__:[8]})]),_:1},8,["show-file-list","file-list"])]),_:1}),l(f,{span:"24 m:24 s:24",label:"","label-width":"0"},{default:s(()=>[Y.value&&!a.videoSrc?(R(),P(D,{key:0,type:"line",percentage:Y.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):j("",!0),a.videoSrc?(R(),kt("video",{key:1,src:a.videoSrc,autoplay:"",style:{width:"100%"}},null,8,Nl)):j("",!0)]),_:1}),z.rowMtype!==3?(R(),P(f,{key:0,span:"24 m:24 s:24",label:"客户寄件类型"},{default:s(()=>[l(g,{value:a.details,"onUpdate:value":r[4]||(r[4]=N=>a.details=N),name:"radiogroup"},{default:s(()=>[l(x,null,{default:s(()=>[l(L,{value:0},{default:s(()=>r[9]||(r[9]=[y("仅裸机")])),_:1,__:[9]}),l(L,{value:1},{default:s(()=>r[10]||(r[10]=[y("含配件")])),_:1,__:[10]})]),_:1})]),_:1},8,["value"])]),_:1})):j("",!0),a.details==1&&z.rowMtype!==3?(R(),P(f,{key:1,span:"24 m:24 s:24",label:"客户寄件配件详情",path:"accessory"},{default:s(()=>[l(i(Ae),{value:a.accessory,"onUpdate:value":r[5]||(r[5]=N=>a.accessory=N),placeholder:"请输入客户寄件配件详情",clearable:""},null,8,["value"])]),_:1})):j("",!0)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show"])}}}),Pl={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ht(X){return typeof X=="function"||Object.prototype.toString.call(X)==="[object Object]"&&!kl(X)}const Xl=wt({name:"aftersales_aftersalesdevice",__name:"index",setup(X){const ce=dl(),pe=S(!1),z=S(0),a=S([]),fe=K([{label:"已受理",value:0},{label:"分析中",value:1},{label:"维修中",value:2},{label:"维修完成",value:3},{label:"待客户收件",value:4},{label:"处理完毕",value:5}]),Y={当日:()=>{const e=new Date().getTime();return[e,e]},本周:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*7,e]},上月:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*30,e]},近一年:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*365,e]},近三年:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*365*3,e]}},M=S([]),{pageData:V,getData:se,nextPage:Oe}=et(zl),Ge=async e=>{const t=e.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&V.data.length<V.total&&(await Oe(),M.value=V.data,await Fe(),setTimeout(()=>{t.scrollTop=c}))},T=async()=>{await se({page:1,limit:100,_t:new Date().getTime()}),M.value=V.data};et(hl);const Z=S([]),{pageData:J,getData:me,nextPage:ee}=et(Sl),je=async()=>{await me(),Z.value=J.data.map(e=>({label:e,value:e}))},xe=async e=>{const t=e.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&J.data.length<J.total&&(await ee(),await Fe(),Z.value=J.data.map(w=>({label:w,value:w})),setTimeout(()=>{t.scrollTop=c}))},Ee=Pe.debounce(async e=>{await me({fuzzy:e,page:1}),Z.value=J.data.map(t=>({label:t,value:t}))},300),Me=e=>{if(k.gws=null,W.value=!0,ae.value=!1,!e){Ce();return}Ee(e)},Ce=()=>{k.gws=null,$()},ze=Pe.debounce(e=>{var t;k.gws1=e||void 0,k.gws=(t=k.gws1)==null?void 0:t.join(","),$()},300),Ve=async()=>{W.value&&!ae.value&&(await me({page:1}),Z.value=J.data.map(e=>({label:e,value:e})),W.value=!1)},Se=Pe.debounce(async e=>{await se({fuzzy:e,page:1}),M.value=V.data},300),W=S(!1),ae=S(!1),$e=e=>{if(k.cid=null,W.value=!0,ae.value=!1,!e){r();return}Se(e)},n=async()=>{W.value&&!ae.value&&(await se({page:1}),M.value=V.data,W.value=!1)},r=async()=>{await se({page:1}),M.value=V.data};async function f(e,t){if(!e){k.startTime=void 0,k.endTime=void 0,$();return}k.startTime=String(ft(1,t[0])),k.endTime=String(ft(1,t[1])),$()}const h=async e=>{k.cid=e,$()},D=()=>{k.sn=null,$()},L=Pe.debounce(e=>{k.sn=e||void 0,$()},300),x=()=>{k.status=null,$()},g=e=>{k.status=e,$()};cl(async()=>{await T(),await $(),await je()});const ye=S(!1),ne=K({id:0,mtype:0}),{columns:Ue,columnChecks:ge,data:N,getData:$,loading:$t,mobilePagination:Ut,searchParams:k}=yt({showTotal:!0,immediate:!1,apiFn:$l,apiParams:{page:1,pageSize:20,limit:20,cid:null,gws:void 0,gws1:[],sn:null,status:null,uid:null,dbtime:null,startAndTimeRange:null,startTime:null,endTime:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left",resizable:!0},{key:"comp",title:"客户公司名称",align:"center",width:220,resizable:!0,ellipsis:{tooltip:!0}},{key:"sn",title:"客户设备信息",width:240,titleAlign:"center",ellipsis:{tooltip:!0},resizable:!0,render:e=>l("div",{class:"flex flex-col items-start justify-start gap-1"},[l("div",{class:"w-full truncate",title:`设备编号：${e.sn}`},[y("设备编号："),e.sn?e.rsn?e.rsn==e.sn||e.rsn.includes("无")?e.sn:l("span",null,[e.sn,y(" ("),l("span",{style:"color: red; font-weight: bold;"},[y("更换")]),y(")")]):e.sn:"--"]),l("div",{class:"w-full truncate",title:`设备型号：${e.model||"--"}`},[y("设备型号："),e.model||"--"])])},{key:"fault",title:"故障现象",align:"center",width:220,resizable:!0,ellipsis:{tooltip:!0}},{key:"re1",title:"现场照片",align:"center",width:300,resizable:!0,render:e=>l("div",{class:"flex items-center justify-center gap-4px"},[e.re1||e.re2||e.re3?l("div",{style:{cursor:"pointer"},onClick:()=>at([e.re1,e.re2,e.re3].filter(t=>t),0)},[l(mt,{width:70,src:e.re1||e.re2||e.re3,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)]):null])},{key:"re4",title:"现场视频",align:"center",width:300,resizable:!0,render:e=>l("div",{class:"flex items-center justify-center gap-4px"},[e.re4?l("video",{src:e.re4,style:{height:"70px",width:"100%",cursor:"pointer",objectFit:"cover"},onClick:()=>Nt(e.re4)},null):null])},{key:"status",align:"center",width:120,resizable:!0,title:()=>m("div",{class:"flex flex-col items-center justify-center"},[m("span","当前状态"),m("span",{style:"font-size: 11px; color: #FF0000; margin-top: 2px;"},"悬浮查看详情")]),render:e=>{const t=()=>{const{status:c}=e;return e.mtype===0?[m(C,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),m(C,{type:c>=1?"success":"default",time:e.redbtime},{default:()=>["分析中",e.receipt&&m("span",{style:{marginLeft:"5px"}},["(寄出单号: ",m("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.receipt)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.receipt),")"])]}),m(C,{type:c>=2?"success":"default"},{default:()=>"维修中"}),m(C,{type:c>=3?"success":"default"},{default:()=>"维修完成"}),m(C,{type:c>=4?"success":"default"},{default:()=>"待客户收件"}),m(C,{type:c>=5?"success":"default",time:e.rdbtime},{default:()=>["处理完毕",e.returnnum&&m("span",{style:{marginLeft:"5px"}},["(寄出单号: ",m("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.returnnum)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.returnnum),")"])]})]:e.mtype===1?[m(C,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),m(C,{type:c>=1?"success":"default",time:e.return_time||e.complete_time},{default:()=>"处理完毕"})]:e.mtype===2?[m(C,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),m(C,{type:c>=1?"success":"default"},{default:()=>"待客户收件"}),m(C,{type:c>=2?"success":"default"},{default:()=>"待我司收件"}),m(C,{type:c>=3?"success":"default",time:e.return_time||e.complete_time},{default:()=>"处理完毕"})]:e.mtype===3?[m(C,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),m(C,{type:c>=1?"success":"default"},{default:()=>"待客户收件"}),m(C,{type:c>=2?"success":"default",time:e.return_time||e.complete_time},{default:()=>"处理完毕"})]:[m(C,{type:c>=0?"success":"default",time:e.dbtime},{default:()=>"已受理"}),m(C,{type:c>=1?"success":"default",time:e.redbtime},{default:()=>["分析中",e.receipt&&m("span",{style:{marginLeft:"5px"}},["(寄出单号: ",m("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.receipt)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.receipt),")"])]}),m(C,{type:c>=2?"success":"default"},{default:()=>"维修中"}),m(C,{type:c>=3?"success":"default"},{default:()=>"维修完成"}),m(C,{type:c>=4?"success":"default"},{default:()=>"待客户收件"}),m(C,{type:c>=5?"success":"default",time:e.rdbtime},{default:()=>["处理完毕",e.returnnum&&m("span",{style:{marginLeft:"5px"}},["(寄出单号: ",m("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.returnnum)}`,target:"_blank",style:{color:"#4169E1",marginLeft:"5px"}},e.returnnum),")"])]})]};return m(bl,{placement:"top",style:{maxWidth:"450px"}},{trigger:()=>m(wl,{type:"primary",style:{cursor:"pointer"}},{default:()=>ot(e.mtype,e.status)}),default:()=>m("div",{class:"custom-timeline",style:{padding:"12px"}},[m("p",{style:{marginBottom:"12px",fontWeight:"bold"}},[m("strong",null,"当前状态："),ot(e.mtype,e.status)]),m(Ul,null,{default:()=>t()})])})}},{key:"returnnum",title:"物流信息",align:"center",width:220,resizable:!0,titleAlign:"center",ellipsis:{tooltip:!0},render:e=>l("div",{class:"flex flex-col items-start justify-start gap-1"},[e.returnnum&&e.mtype!==1&&l("div",{class:"flex items-center gap-4px"},[Rl(e.returnnum)?l("a",{href:`https://www.kuaidi100.com?nu=${encodeURIComponent(e.returnnum)}`,target:"_blank",style:"color: #4169E1;"},[e.returnnum||"--"]):l("span",null,[e.returnnum||"--"]),l(_l,{trigger:"hover",placement:"right"},{trigger:()=>O(l(_,{text:!0,type:"primary",onClick:()=>nt(e.id,e,"returnnum")},{default:()=>[l("span",{class:"akar-icons--edit"},null)]}),[[G("no-auth"),"aftermarket:update:permission.do"]]),default:()=>U("common.update")})]),e.returnnum&&l("div",null,[`时间：${e.rdbtime?e.rdbtime:""}`]),e.returnnum&&l("div",null,[`寄件类型：${e.rdetails==0?"仅裸机":e.raccessory?"含配件("+e.raccessory+")":"未知"}`]),!e.returnnum&&O(l(_,{text:!0,type:"primary",onClick:()=>nt(e.id,null,"returnnum")},{default:()=>["填写"]}),[[G("no-auth"),"aftermarket:update:permission.do"]])])},{key:"re8",title:"分析照片",align:"center",width:300,resizable:!0,render:e=>l("div",{class:"flex items-center justify-center gap-4px"},[e.re5||e.re6||e.re7?l("div",{style:{cursor:"pointer"},onClick:()=>at([e.re5||e.re6||e.re7].filter(t=>t),0)},[l(mt,{width:70,src:e.re5||e.re6||e.re7,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)]):null,l("div",null,[!e.re5&&!e.re6&&!e.re7&&O(l(_,{size:"small",type:"primary",onClick:()=>rt(e,"analyze")},{default:()=>[y("点击上传")]}),[[G("no-auth"),"aftermarket:update:permission.do"]]),(e.re5||e.re6||e.re7)&&O(l(_,{size:"small",type:"primary",onClick:()=>rt(e,"analyze"),style:{marginLeft:"5px"}},{default:()=>[y("编辑图片")]}),[[G("no-auth"),"aftermarket:update:permission.do"]])])])},{key:"rsn",title:"设备信息",width:200,resizable:!0,titleAlign:"center",ellipsis:{tooltip:!0},render:e=>l("div",{class:"flex flex-col items-start justify-start gap-1"},[l("div",{class:"w-full truncate",title:`设备编号：${e.rsn||"--"}`},[y("设备编号："),e.rsn||"--"]),l("div",{class:"w-full truncate",title:`设备型号：${e.rmodel||"--"}`},[y("设备型号："),e.rmodel||"--"])])},{key:"notes",title:"备注",align:"center",width:180,resizable:!0,ellipsis:{tooltip:!0},render:e=>l("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[e.notes?l("div",{class:"w-full truncate",title:`${e.notes}`},[e.notes]):O(l(_,{text:!0,type:"primary",size:"small",onClick:()=>it(e.id,"","sn")},{default:()=>[y("填写")]}),[[G("no-auth"),"aftermarket:update:permission.do"]])])},{key:"duration",title:"处理时长",align:"center",width:180,resizable:!0,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:180,resizable:!0,ellipsis:{tooltip:!0}},{key:"ckdbtime",title:"审核时间",align:"center",width:180,resizable:!0,ellipsis:{tooltip:!0}},{key:"responsibleperson",title:"售后处理",align:"center",resizable:!0,width:160,render:e=>l("div",{class:"flex-center gap-8px"},[O(l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Mt(e,"option")},{default:()=>["查看"+(e.rescount>0?"("+e.rescount+")":"")]}),[[G("no-auth"),"aftermarketRes:select:permission.do"]]),O(l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>We(e,"add")},{default:()=>["添加"]}),[[G("no-auth"),"aftermarketRes:insert:permission.do"]])])},{key:"operate",title:U("common.operate"),align:"center",width:220,fixed:"right",render:e=>l("div",{class:"flex-center gap-8px"},[O(l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>it(e.id,e.notes,"sn")},{default:()=>["修改备注"]}),[[G("no-auth"),"aftermarket:update:permission.do"]]),O(l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ht(e.id,e.mtype)},{default:()=>["修改"]}),[[G("no-auth"),"aftermarket:update:permission.do"]]),l(vt,{onPositiveClick:()=>ut(e.id)},{default:()=>U("common.confirmDelete"),trigger:()=>{let t;return O(l(_,{type:"error",ghost:!0,size:"small"},ht(t=U("common.delete"))?t:{default:()=>[t]}),[[G("no-auth"),"aftermarket:delete:permission.do"]])}})])}]}),{checkedRowKeys:re}=gt(N,$),{columns:Rt,data:lt,getData:te,loading:Tt,mobilePagination:Re,searchParams:ve}=yt({showTotal:!0,immediate:!1,apiFn:Tl,apiParams:{page:1,pageSize:20,limit:20,aid:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"username",title:"责任人",width:200,align:"center",ellipsis:{tooltip:!0}},{key:"reason",title:"原因分析",align:"center",width:300,ellipsis:{tooltip:!0}},{key:"resolution",title:"处理意见",align:"center",width:300,ellipsis:{tooltip:!0}},{key:"improvement",title:"改进措施",align:"center",width:300,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:160},{key:"operate",title:U("common.operate"),align:"center",width:160,fixed:"right",render:e=>l("div",{class:"flex-center gap-8px"},[O(l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>We(e,"edit")},{default:()=>["修改"]}),[[G("no-auth"),"aftermarketRes:update:permission.do"]]),l(vt,{onPositiveClick:()=>dt(e.id)},{default:()=>U("common.confirmDelete"),trigger:()=>{let t;return O(l(_,{type:"error",ghost:!0,size:"small"},ht(t=U("common.delete"))?t:{default:()=>[t]}),[[G("no-auth"),"aftermarketRes:delete:permission.do"]])}})])}]}),{checkedRowKeys:he}=gt(lt,te),st=S(null),ie=S(!1),u=K({id:0,type:"",returnOrder:"",returnOrderType:1,rsn:"",rdetails:0,raccessory:""}),we={rsn:{required:!1,trigger:["blur","change"],message:"请输入寄出设备编号"},raccessory:{required:!1,trigger:["blur","change"],message:""}},Dt=tt(()=>{const e={};return u.type==="receipt"&&(e.returnOrder={...we.rsn,message:u.type==="receipt"?"请输入客户寄出信息":"请输入寄出信息"}),u.type==="returnnum"?e.rsn=[{...we.rsn,required:!0},{min:9,trigger:["blur","change"],message:"寄出设备编号长度至少 9 位"}]:e.raccessory={...we.raccessory,required:!1},u.rdetails===1?e.raccessory={...we.raccessory,required:!0,message:u.type==="returnnum"?"请输出寄出配件详情":"请输入寄件配件详情"}:e.raccessory={...we.raccessory,required:!1,message:u.type==="returnnum"?"请输出寄出配件详情":"请输入寄件配件详情"},e});function Nt(e){window.open(e,"_blank")}const at=(e,t=0)=>{a.value=e,z.value=t,pe.value=!0},It=e=>{z.value=e};function nt(e,t,c){u.type=c,u.returnOrder=t?t.returnnum:"",u.returnOrderType=t&&t.returnnum.includes("无")?2:1,u.id=e,u.rsn=t&&t.hasOwnProperty("rsn")?t.rsn:"",u.rdetails=t&&t.hasOwnProperty("rdetails")?Number(t.rdetails):0,u.raccessory=t&&t.hasOwnProperty("raccessory")?t.raccessory:"",ie.value=!0}function Pt(){ie.value=!1,u.id=0,u.type="",u.returnOrder="",u.returnOrderType=1,u.rsn="",u.rdetails=0,u.raccessory=""}async function At(){var t,c,w,v;await st.value.validate();let e=u.type=="receipt"?u.rdetails===0?[{id:u.id,receipt:u.returnOrder,details:u.rdetails}]:[{id:u.id,receipt:u.returnOrder,details:u.rdetails,accessory:u.raccessory}]:u.rdetails===0?[{id:u.id,returnnum:u.returnOrder,rsn:u.rsn,rdetails:u.rdetails}]:[{id:u.id,returnnum:u.returnOrder,rsn:u.rsn,rdetails:u.rdetails,raccessory:u.raccessory}];if(u.type=="receipt"){const{data:F,error:b}=await Ze(e);b||((t=window.$message)==null||t.destroyAll(),(c=window.$message)==null||c.success(F.msg||"操作成功"),ie.value=!1,u.type="",u.returnOrder="",u.id=0)}else{const{data:F,error:b}=await qe(e);b||((w=window.$message)==null||w.destroyAll(),(v=window.$message)==null||v.success(F.msg||"操作成功"),$(),ie.value=!1,u.type="",u.returnOrder="",u.id=0)}}const oe=S(!1),o=K({id:0,type:"",sendFileList:[],receiveFileList:[],analyzeFileList:[]}),Te=S(!1),B=K({id:0,type:"",notes:""}),Bt=S(!1),He=K({id:[],type:"",password:""}),De=S(!1),le=S(!1),p=K({id:0,uid:0,aid:0,type:"add",username:"",sn:"",reason:"",resolution:"",improvement:""}),qt=S(""),be=S(!1),Ne=K({aid:null,uid:null,sn:""});function rt(e,t){o.sendFileList=[],o.receiveFileList=[],o.analyzeFileList=[],o.id=e.id,o.type=t,e.re5&&o.analyzeFileList.push({id:"0",name:"0",url:e.re5,status:"finished"}),e.re6&&o.analyzeFileList.push({id:"1",name:"1",url:e.re6,status:"finished"}),e.re7&&o.analyzeFileList.push({id:"2",name:"2",url:e.re7,status:"finished"}),oe.value=!0}function Ke(e){var v,F,b,E;const t=["image/jpeg","image/png","image/jpg","image/x-icon"];console.log("data.file.file",e.file.file);const c=t.includes(e.file.file.type),w=e.file.file.size/1024/1024<100;return c||((v=window.$message)==null||v.destroyAll(),(F=window.$message)==null||F.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片")),w||((b=window.$message)==null||b.destroyAll(),(E=window.$message)==null||E.error("上传图片大小不能超过 100MB")),c&&w}async function Ie(e){var v,F;const{file:t,onFinish:c,onError:w}=e;if(!t.file)return c({...t});try{const b=await Be(t.file,t.name,"aftermarket/image");b&&(t.url=b,c({...t,url:b}),(v=window.$message)==null||v.destroyAll(),(F=window.$message)==null||F.success("上传成功"))}catch(b){w(b)}}function Ot(){oe.value=!1,o.sendFileList=[],o.receiveFileList=[],o.analyzeFileList=[]}function Gt(e){return new Promise((t,c)=>{Ie({file:e,onFinish:()=>t(!0),onError:w=>c(w)})})}async function jt(){var v,F,b,E,q,_e,Q,ke;let e=[{id:o.id}];const t=o.type==="customer"?o.sendFileList:o.type==="company"?o.receiveFileList:o.analyzeFileList;if(await Promise.all([...t.map(A=>Gt(A))]),t.some(A=>A.url&&A.url.startsWith("blob:"))){(v=window.$message)==null||v.destroyAll(),(F=window.$message)==null||F.warning("还有文件正在上传或上传失败，请稍后提交");return}if(t.some(A=>!A.url||A.url.trim()==="")){(b=window.$message)==null||b.destroyAll(),(E=window.$message)==null||E.warning("存在上传失败的文件，请重新上传");return}if(o.type==="customer"?(o.sendFileList.length==0&&(e[0].re1="",e[0].re2="",e[0].re3=""),o.sendFileList.length==1&&(e[0].re1=o.sendFileList[0].url,e[0].re2="",e[0].re3=""),o.sendFileList.length==2&&(e[0].re1=o.sendFileList[0].url,e[0].re2=o.sendFileList[1].url,e[0].re3=""),o.sendFileList.length==3&&(e[0].re1=o.sendFileList[0].url,e[0].re2=o.sendFileList[1].url,e[0].re3=o.sendFileList[2].url)):o.type==="company"?(o.receiveFileList.length==0&&(e[0].re4="",e[0].re5="",e[0].re6=""),o.receiveFileList.length==1&&(e[0].re4=o.receiveFileList[0].url,e[0].re5="",e[0].re6=""),o.receiveFileList.length==2&&(e[0].re4=o.receiveFileList[0].url,e[0].re5=o.receiveFileList[1].url,e[0].re6=""),o.receiveFileList.length==3&&(e[0].re4=o.receiveFileList[0].url,e[0].re5=o.receiveFileList[1].url,e[0].re6=o.receiveFileList[2].url)):(o.analyzeFileList.length==0&&(e[0].re5="",e[0].re6="",e[0].re7=""),o.analyzeFileList.length==1&&(e[0].re5=o.analyzeFileList[0].url,e[0].re6="",e[0].re7=""),o.analyzeFileList.length==2&&(e[0].re5=o.analyzeFileList[0].url,e[0].re6=o.analyzeFileList[1].url,e[0].re7=""),o.analyzeFileList.length==3&&(e[0].re5=o.analyzeFileList[0].url,e[0].re6=o.analyzeFileList[1].url,e[0].re7=o.analyzeFileList[2].url)),o.type==="customer"||o.type==="company"){const{data:A,error:ue}=await Ze(e);ue||((q=window.$message)==null||q.destroyAll(),(_e=window.$message)==null||_e.success(A.msg||"操作成功"),oe.value=!1,o.id=0,o.sendFileList=[],o.receiveFileList=[])}else{const{data:A,error:ue}=await qe(e);ue||((Q=window.$message)==null||Q.destroyAll(),(ke=window.$message)==null||ke.success(A.msg||"操作成功"),$(),oe.value=!1,o.id=0,o.analyzeFileList=[])}}function it(e,t,c){B.id=e,B.notes=t,B.type=c,Te.value=!0}function Je(){Te.value=!1,B.id=0,B.notes="",B.type=""}async function Et(){var w,v;if(!B.notes){(w=window.$message)==null||w.destroyAll(),(v=window.$message)==null||v.error("请输入备注");return}const{id:e,notes:t,type:c}=B;if(c==="comp"){const{data:F,error:b}=await Ze([{id:e,notes:t}]);b||Je()}else{const{data:F,error:b}=await qe([{id:e,notes:t}]);b||(Je(),$())}}const ot=(e,t)=>e===0?t===0?"已受理":t===1?"分析中":t===2?"维修中":t===3?" 维修完成":t===4?"待客户收件":t===5?"处理完毕":"未知":e===1?t===0?"已受理":t===5?"处理完毕":"未知":e===2?t===0?"已受理":t===1?"待客户收件":t===2?"待我司收件":t===5?"处理完毕":"未知":e===3?t===0?"已受理":t===1?"待客户收件":t===5?"处理完毕":"未知":t===0?"已受理":t===1?"分析中":t===2?"维修中":t===3?"维修完成":t===4?"待客户收件":t===5?"处理完毕":"未知";function ut(e){He.id=e?[e]:re.value,He.type="deleteSn",He.password="",Bt.value=!0}function Mt(e,t){qt.value=t,Ne.aid=e.id,Ne.uid="",be.value=!0,ve.page=1,ve.aid=e.id,te()}function We(e,t){console.log("row",e),le.value=!1,p.type=t,t==="edit"?(p.uid=e.uid,p.username=e.username,p.aid=e.aid,p.id=e.id,p.reason=e.reason,p.resolution=e.resolution,p.improvement=e.improvement):(p.uid=Number(ce.userInfo.id),p.username=ce.userInfo.username,p.aid=e.id,p.id=0,p.reason="",p.resolution="",p.improvement=""),De.value=!0}function Qe(){De.value=!1,le.value=!1,p.id=0,p.username="",p.reason="",p.resolution="",p.improvement=""}async function Vt(){var t,c,w,v;let e=[{aid:p.aid,uid:ce.userInfo.id,reason:p.reason,resolution:p.resolution,improvement:p.improvement}];if(le.value=!0,p.id){e[0].id=p.id;const{data:F,error:b}=await Fl(e);b?le.value=!1:(le.value=!1,(t=window.$message)==null||t.destroyAll(),(c=window.$message)==null||c.success(F.msg||"操作成功"),Qe(),be.value&&(Re.value.page=1,ve.aid=p.aid,te()),$())}else{const{data:F,error:b}=await xl(e);b?le.value=!1:(le.value=!1,(w=window.$message)==null||w.destroyAll(),(v=window.$message)==null||v.success(F.msg||"操作成功"),Qe(),be.value&&(Re.value.page=1,ve.aid=p.aid,te()),$())}}async function dt(e){var v,F,b,E;let t={};if(e)t.arrIds=[e];else{if(he.value.length===0)return(v=window.$message)==null||v.destroyAll(),(F=window.$message)==null||F.error("请选择要删除的数据"),!1;t.arrIds=he.value}const{data:c,error:w}=await Cl(t.arrIds);if(!w)(b=window.$message)==null||b.destroyAll(),(E=window.$message)==null||E.success(c.msg||"操作成功"),Re.value.page=1,ve.aid=p.aid,te(),$();else return!1}const Ht=(e,t)=>{ne.id=e,ne.mtype=t,ye.value=!0},Kt=S(window.innerHeight-420);return(e,t)=>{const c=pl,w=St,v=Ae,F=Dl,b=sl,E=ll,q=Ft,_e=zt,Q=bt,ke=fl,A=tl,ue=ml,H=gl,ct=xt,Jt=Lt,Le=Ct,Xe=_t,Wt=el,Qt=Zt,Xt=vl;return R(),kt("div",Pl,[l(ke,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[l(Q,{ref:"formRef",model:i(k),"label-placement":"left","label-width":100,"show-feedback":!1},{default:s(()=>[l(_e,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[l(w,{span:"24 s:12 m:6",label:"客户公司",path:"status"},{default:s(()=>[l(c,{filterable:"",clearable:"",value:i(k).cid,"onUpdate:value":[t[0]||(t[0]=d=>i(k).cid=d),h],placeholder:"请选择客户公司","label-field":"comp","value-field":"id",onClear:r,onSearch:$e,onBlur:n,options:M.value,onScroll:Ge},null,8,["value","options"])]),_:1}),l(w,{span:"24 s:12 m:6",label:"设备编号",path:"sn"},{default:s(()=>[l(v,{clearable:"",value:i(k).sn,"onUpdate:value":[t[1]||(t[1]=d=>i(k).sn=d),i(L)],onClear:D,placeholder:"请输入设备编号"},null,8,["value","onUpdate:value"])]),_:1}),l(w,{span:"24 s:12 m:6",label:"网关型号",path:"gws1"},{default:s(()=>[l(c,{clearable:"",filterable:"",multiple:"",value:i(k).gws1,"onUpdate:value":[t[2]||(t[2]=d=>i(k).gws1=d),i(ze)],placeholder:"请选择网关型号","label-field":"label","value-field":"value",options:Z.value,onSearch:Me,onBlur:Ve,onScroll:xe,onClear:Ce},null,8,["value","options","onUpdate:value"])]),_:1}),l(w,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:s(()=>[l(c,{clearable:"",filterable:"",value:i(k).status,"onUpdate:value":[t[3]||(t[3]=d=>i(k).status=d),g],placeholder:"请选择状态","label-field":"label","value-field":"value",options:fe,onClear:x},null,8,["value","options"])]),_:1}),l(w,{span:"24 s:12 m:8",label:"起止时间"},{default:s(()=>[l(F,{value:i(k).startAndTimeRange,"onUpdate:value":t[4]||(t[4]=d=>i(k).startAndTimeRange=d),type:"datetimerange",clearable:"",shortcuts:Y,"onUpdate:formattedValue":f},null,8,["value"])]),_:1}),l(w,{span:"24 s:12 m:5"},{default:s(()=>[l(q,{class:"w-full"},{default:s(()=>[i(de)("aftermarket:select:permission.do")?(R(),P(i(_),{key:0,ghost:"",onClick:i($)},{icon:s(()=>[l(b,{class:"text-icon"})]),default:s(()=>[t[30]||(t[30]=y(" "+I("查询")))]),_:1,__:[30]},8,["onClick"])):j("",!0),i(de)("aftermarket:delete:permission.do")?(R(),P(i(_),{key:1,type:"error",disabled:i(re).length===0,onClick:ut},{icon:s(()=>[l(E,{class:"text-icon"})]),default:s(()=>[t[31]||(t[31]=y(" "+I("批量删除")))]),_:1,__:[31]},8,["disabled"])):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(ke,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:s(()=>[l(q,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:s(()=>t[32]||(t[32]=[yl("div",null,"售后设备",-1)])),_:1,__:[32]})]),"header-extra":s(()=>[l(q,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[l(A,{columns:i(ge),"onUpdate:columns":t[5]||(t[5]=d=>Ye(ge)?ge.value=d:null),ctype:4},null,8,["columns"])]),_:1})]),default:s(()=>[l(ue,{"checked-row-keys":i(re),"onUpdate:checkedRowKeys":t[6]||(t[6]=d=>Ye(re)?re.value=d:null),columns:i(Ue),data:i(N),size:"small",loading:i($t),remote:"","max-height":Kt.value,"scroll-x":i(Ue).reduce((d,Yt)=>d+(Yt.width||100),0),"row-key":d=>d.id,pagination:i(Ut),class:"sm:h-full",striped:""},null,8,["checked-row-keys","columns","data","loading","max-height","scroll-x","row-key","pagination"])]),_:1}),l(Le,{show:ie.value,"onUpdate:show":t[11]||(t[11]=d=>ie.value=d),title:u.type==="receipt"?"填写客户寄出信息":"填写寄出信息",preset:"card",class:"w-800px"},{footer:s(()=>[l(q,{justify:"end"},{default:s(()=>[l(i(_),{size:"small",class:"mt-16px",onClick:Pt},{default:s(()=>[y(I(i(U)("common.cancel")),1)]),_:1}),l(i(_),{type:"primary",size:"small",class:"mt-16px",onClick:At},{default:s(()=>[y(I(i(U)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(Q,{ref_key:"returnOrderFormRef",ref:st,rules:Dt.value,model:u,"label-placement":"left"},{default:s(()=>[l(H,{label:u.type==="receipt"?"客户寄出信息":"寄出信息",path:"returnOrder",required:""},{default:s(()=>[l(v,{value:u.returnOrder,"onUpdate:value":t[7]||(t[7]=d=>u.returnOrder=d),placeholder:u.type==="receipt"?"请输入客户寄出信息":"请输入寄出信息",clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),u.type==="returnnum"?(R(),P(H,{key:0,label:"寄出设备编号",path:"rsn"},{default:s(()=>[l(v,{value:u.rsn,"onUpdate:value":t[8]||(t[8]=d=>u.rsn=d),placeholder:"请输入寄出设备编号",clearable:""},null,8,["value"])]),_:1})):j("",!0),l(H,{label:(u.type==="returnnum","寄件类型"),path:"rdetails"},{default:s(()=>[l(Jt,{value:u.rdetails,"onUpdate:value":t[9]||(t[9]=d=>u.rdetails=d)},{default:s(()=>[l(q,null,{default:s(()=>[l(ct,{value:0},{default:s(()=>t[33]||(t[33]=[y("仅裸机")])),_:1,__:[33]}),l(ct,{value:1},{default:s(()=>t[34]||(t[34]=[y("含配件")])),_:1,__:[34]})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),u.rdetails===1?(R(),P(H,{key:1,required:"",label:u.type==="returnnum"?"寄出配件详情":"寄件配件详情",path:"raccessory"},{default:s(()=>[l(v,{value:u.raccessory,"onUpdate:value":t[10]||(t[10]=d=>u.raccessory=d),placeholder:u.type==="returnnum"?"请输出寄出配件详情":"请输入寄件配件详情",clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])):j("",!0)]),_:1},8,["rules","model"])]),_:1},8,["show","title"]),l(Le,{show:oe.value,"onUpdate:show":t[15]||(t[15]=d=>oe.value=d),title:o.type==="customer"?"客户寄出照片上传":o.type==="company"?"寄出照片上传":"分析照片上传",preset:"card",class:"w-800px"},{footer:s(()=>[l(q,{justify:"end"},{default:s(()=>[l(i(_),{size:"small",class:"mt-16px",onClick:Ot},{default:s(()=>[y(I(i(U)("common.cancel")),1)]),_:1}),l(i(_),{type:"primary",size:"small",class:"mt-16px",onClick:jt},{default:s(()=>[y(I(i(U)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[o.type==="customer"?(R(),P(Xe,{key:0,multiple:"",max:3,"file-list":o.sendFileList,"onUpdate:fileList":t[12]||(t[12]=d=>o.sendFileList=d),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ke,"custom-request":Ie},{default:s(()=>t[35]||(t[35]=[y(" 点击上传 ")])),_:1,__:[35]},8,["file-list"])):o.type==="company"?(R(),P(Xe,{key:1,multiple:"",max:3,"file-list":o.receiveFileList,"onUpdate:fileList":t[13]||(t[13]=d=>o.receiveFileList=d),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ke,"custom-request":Ie},{default:s(()=>t[36]||(t[36]=[y(" 点击上传 ")])),_:1,__:[36]},8,["file-list"])):(R(),P(Xe,{key:2,multiple:"",max:3,"file-list":o.analyzeFileList,"onUpdate:fileList":t[14]||(t[14]=d=>o.analyzeFileList=d),"list-type":"image-card",onBeforeUpload:Ke,"default-upload":!1,"custom-request":Ie},{default:s(()=>t[37]||(t[37]=[y(" 点击上传 ")])),_:1,__:[37]},8,["file-list"]))]),_:1},8,["show","title"]),l(Le,{show:Te.value,"onUpdate:show":t[17]||(t[17]=d=>Te.value=d),title:"备注",preset:"card",class:"w-600px"},{footer:s(()=>[l(q,{justify:"end"},{default:s(()=>[l(i(_),{size:"small",class:"mt-16px",onClick:Je},{default:s(()=>[y(I(i(U)("common.cancel")),1)]),_:1}),l(i(_),{type:"primary",size:"small",class:"mt-16px",onClick:Et},{default:s(()=>[y(I(i(U)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(Q,{ref:"formRef",model:B,"label-placement":"left"},{default:s(()=>[l(H,{label:"备注",path:"notes",required:""},{default:s(()=>[l(v,{type:"textarea",value:B.notes,"onUpdate:value":t[16]||(t[16]=d=>B.notes=d),placeholder:"请输入备注",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),l(Le,{show:be.value,"onUpdate:show":t[21]||(t[21]=d=>be.value=d),title:"售后处理",preset:"card",class:"w-85%"},{default:s(()=>[l(Q,{ref:"formRef",model:Ne,"label-placement":"left","label-width":100,"show-feedback":!1},{default:s(()=>[l(_e,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[l(w,{span:"24 s:24 m:24"},{default:s(()=>[l(q,{class:"w-full"},{default:s(()=>[i(de)("aftermarketRes:select:permission.do")?(R(),P(i(_),{key:0,ghost:"",onClick:i(te)},{icon:s(()=>[l(b,{class:"text-icon"})]),default:s(()=>[t[38]||(t[38]=y(" "+I("查询")))]),_:1,__:[38]},8,["onClick"])):j("",!0),i(de)("aftermarketRes:insert:permission.do")?(R(),P(i(_),{key:1,type:"primary",ghost:"",onClick:t[18]||(t[18]=d=>We({id:Ne.aid||p.aid},"add"))},{icon:s(()=>[l(Wt,{class:"text-icon"})]),default:s(()=>[t[39]||(t[39]=y(" "+I("添加")))]),_:1,__:[39]})):j("",!0),i(de)("aftermarketRes:delete:permission.do")?(R(),P(i(_),{key:2,type:"error",disabled:i(re).length===0,onClick:t[19]||(t[19]=d=>dt(void 0))},{icon:s(()=>[l(E,{class:"text-icon"})]),default:s(()=>[t[40]||(t[40]=y(" "+I("批量删除")))]),_:1,__:[40]},8,["disabled"])):j("",!0),i(de)("aftermarketRes:select:permission.do")?(R(),P(i(_),{key:3,onClick:i(te)},{icon:s(()=>[l(Qt,{class:"text-icon"})]),default:s(()=>[t[41]||(t[41]=y(" "+I("刷新")))]),_:1,__:[41]},8,["onClick"])):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),l(ue,{"checked-row-keys":i(he),"onUpdate:checkedRowKeys":t[20]||(t[20]=d=>Ye(he)?he.value=d:null),columns:i(Rt),data:i(lt),size:"small",loading:i(Tt),remote:"",style:{"margin-top":"20px"},"max-height":400,"row-key":d=>d.id,pagination:i(Re),class:"sm:h-full",striped:""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1},8,["show"]),l(Le,{show:De.value,"onUpdate:show":t[26]||(t[26]=d=>De.value=d),title:p.type==="add"?"添加责任人":"修改责任人",preset:"card",class:"w-600px"},{footer:s(()=>[l(q,{justify:"end"},{default:s(()=>[l(i(_),{size:"small",class:"mt-16px",onClick:Qe},{default:s(()=>[y(I(i(U)("common.cancel")),1)]),_:1}),l(i(_),{type:"primary",size:"small",class:"mt-16px",onClick:Vt},{default:s(()=>[y(I(i(U)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(Q,{ref:"formRef",model:B,"label-placement":"left"},{default:s(()=>[l(H,{label:"责任人",path:"notes",required:""},{default:s(()=>[l(v,{disabled:"",value:p.username,"onUpdate:value":t[22]||(t[22]=d=>p.username=d),placeholder:"请输入责任人",clearable:""},null,8,["value"])]),_:1}),l(H,{label:"原因分析",path:"notes"},{default:s(()=>[l(v,{type:"textarea",value:p.reason,"onUpdate:value":t[23]||(t[23]=d=>p.reason=d),placeholder:"请输入原因分析",clearable:""},null,8,["value"])]),_:1}),l(H,{label:"处理意见",path:"notes"},{default:s(()=>[l(v,{type:"textarea",value:p.resolution,"onUpdate:value":t[24]||(t[24]=d=>p.resolution=d),placeholder:"请输入处理意见",clearable:""},null,8,["value"])]),_:1}),l(H,{label:"改进措施",path:"notes"},{default:s(()=>[l(v,{type:"textarea",value:p.improvement,"onUpdate:value":t[25]||(t[25]=d=>p.improvement=d),placeholder:"请输入改进措施",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),l(Il,{visible:ye.value,"onUpdate:visible":t[27]||(t[27]=d=>ye.value=d),onSubmitted:i($),"row-id":ne.id,"row-mtype":ne.mtype},null,8,["visible","onSubmitted","row-id","row-mtype"]),l(Xt,{show:pe.value,"onUpdate:show":t[28]||(t[28]=d=>pe.value=d),current:z.value,"onUpdate:current":[t[29]||(t[29]=d=>z.value=d),It],"src-list":a.value},null,8,["show","current","src-list"])])}}});export{Xl as default};
