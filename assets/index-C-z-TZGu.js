import{_ as _t}from"./table-column-setting.vue_vue_type_script_setup_true_lang-HJyl93tW.js";import{_ as ft}from"./export-BxD5llXZ.js";import{_ as vt}from"./round-delete-B37yrxm8.js";import{_ as bt}from"./round-add-C1dTQfQV.js";import{_ as yt}from"./round-search-Nne0w_ly.js";import{d as ut,s as nt,v as ht,r as gt,x as St,y as wt,ab as ot,a as Dt,$ as c,o as R,c as et,w as a,g as t,h as v,t as j,f as s,ec as Ot,ed as Ct,an as kt,aE as xt,R as V,aF as jt,T as dt,B as D,ao as Et,m as lt,z as Ut,ee as Tt,a$ as Q,P as Nt,D as H,C as Y,ef as it,b as Mt,af as Z,ap as tt,aq as $t,eg as Pt,as as Ft,a6 as Bt,_ as qt}from"./index-5hkPBQCR.js";import{u as It,a as zt}from"./table-BYNeGBNP.js";import{M as Qt}from"./shield-question-outline-rounded-D1LdoXfh.js";import{e as Ht}from"./exportExcel-Bv4G4H50.js";import{_ as pt}from"./DatePicker-CVVxFSUS.js";import{_ as ct}from"./FormItemGridItem-D9fWTmgU.js";import{_ as mt}from"./Grid-znTu50fx.js";import{N as st}from"./Popconfirm-CnbdDSAV.js";const Rt=ut({__name:"siteModel",props:nt({operateType:{},rowData:{},unitObj:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:nt(["submitted"],["update:visible"]),setup(h,{emit:u}){const g=ht(h,"visible"),E=u,l=h,n=gt(O());function O(){return{dbtime:void 0,stationP:void 0,stationQ:void 0,stationS:void 0,stationCOS:void 0,stationU:void 0,stationI:void 0,stationFreq:void 0,stationDayE:void 0,stationTotalE:void 0,stationControlled:0}}function S(){Object.assign(n,O()),l.operateType==="edit"&&l.rowData&&(Object.assign(n,l.rowData),n.dbtime=n.dbtime.replace(/:00$/,""))}const{formRef:W,validate:x,restoreValidation:at}=St();wt(),ot(()=>l.rowData,()=>{S()}),ot(g,()=>{g.value&&(S(),at())});const C=()=>{g.value=!1},G=async()=>{var i;await x();const w=JSON.parse(JSON.stringify(n));if(w.dbtime=w.dbtime+":00",l.operateType==="add"){const{data:k,error:p}=await Ot([w]);if(p)return}else{const{data:k,error:p}=await Ct([w]);if(p)return}(i=window.$message)==null||i.success(l.operateType==="add"?"添加成功":"修改成功"),C(),E("submitted")},A={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},U={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},J={dbtime:A,ratpower:U,devid:U},y=Dt(()=>({add:c("common.add"),edit:c("common.edit")})[l.operateType]);return(w,i)=>{const k=pt,p=ct,f=kt,T=xt,N=V,K=jt,L=mt,X=dt,e=D,o=V,d=Et;return R(),et(d,{show:g.value,"onUpdate:show":i[11]||(i[11]=m=>g.value=m),title:y.value,preset:"card",class:"w-50%"},{footer:a(()=>[t(o,{size:16,justify:"center"},{default:a(()=>[t(e,{onClick:C,class:"w-100px"},{default:a(()=>[v(j(s(c)("common.cancel")),1)]),_:1}),t(e,{type:"primary",class:"w-100px",onClick:G},{default:a(()=>[v(j(s(c)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(X,{ref_key:"formRef",ref:W,model:n,rules:J,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:a(()=>[t(L,{responsive:"screen","item-responsive":""},{default:a(()=>{var m,_,M,$,P,F,B,q,I,z;return[t(p,{span:"24 m:12",label:"数据更新时间",path:"dbtime"},{default:a(()=>[t(k,{"formatted-value":n.dbtime,"onUpdate:formattedValue":i[0]||(i[0]=r=>n.dbtime=r),"value-format":"yyyy-MM-dd HH:mm",type:"datetime",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),t(p,{span:"24 m:12",label:"总有功功率"+((m=l.unitObj)!=null&&m.StationP?"("+l.unitObj.StationP+")":"(MW)"),path:"stationP"},{default:a(()=>[t(f,{clearable:"",value:n.stationP,"onUpdate:value":i[1]||(i[1]=r=>n.stationP=r),placeholder:"请输入",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总无功功率"+((_=l.unitObj)!=null&&_.StationQ?"("+l.unitObj.StationQ+")":"(MVar)"),path:"stationQ"},{default:a(()=>[t(f,{clearable:"",value:n.stationQ,"onUpdate:value":i[2]||(i[2]=r=>n.stationQ=r),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总视在功率"+((M=l.unitObj)!=null&&M.StationS?"("+l.unitObj.StationS+")":"(MW)"),path:"stationS"},{default:a(()=>[t(f,{clearable:"",value:n.stationS,"onUpdate:value":i[3]||(i[3]=r=>n.stationS=r),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总功率因数"+((($=l.unitObj)==null?void 0:$.StationCOS)=="-"?"":(P=l.unitObj)!=null&&P.StationCOS?"("+l.unitObj.StationCOS+")":""),path:"stationCOS"},{default:a(()=>[t(f,{clearable:"",value:n.stationCOS,"onUpdate:value":i[4]||(i[4]=r=>n.stationCOS=r),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总电压"+((F=l.unitObj)!=null&&F.StationU?"("+l.unitObj.StationU+")":"(V)"),path:"stationU"},{default:a(()=>[t(f,{clearable:"",value:n.stationU,"onUpdate:value":i[5]||(i[5]=r=>n.stationU=r),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总电流"+((B=l.unitObj)!=null&&B.StationI?"("+l.unitObj.StationI+")":"(A)"),path:"stationI"},{default:a(()=>[t(f,{clearable:"",value:n.stationI,"onUpdate:value":i[6]||(i[6]=r=>n.stationI=r),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"频率"+((q=l.unitObj)!=null&&q.StationFreq?"("+l.unitObj.StationFreq+")":"(Hz)"),path:"stationFreq"},{default:a(()=>[t(f,{clearable:"",value:n.stationFreq,"onUpdate:value":i[7]||(i[7]=r=>n.stationFreq=r),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"日发电量"+((I=l.unitObj)!=null&&I.StationDayE?"("+l.unitObj.StationDayE+")":"(MWh)"),path:"stationDayE"},{default:a(()=>[t(f,{clearable:"",value:n.stationDayE,"onUpdate:value":i[8]||(i[8]=r=>n.stationDayE=r),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总发电量"+((z=l.unitObj)!=null&&z.StationTotalE?"("+l.unitObj.StationTotalE+")":"(MWh)"),path:"stationTotalE"},{default:a(()=>[t(f,{clearable:"",value:n.stationTotalE,"onUpdate:value":i[9]||(i[9]=r=>n.stationTotalE=r),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"是否限电",path:"stationControlled"},{default:a(()=>[t(K,{value:n.stationControlled,"onUpdate:value":i[10]||(i[10]=r=>n.stationControlled=r),name:"radiogroup"},{default:a(()=>[t(N,null,{default:a(()=>[t(T,{label:s(c)("common.yesOrNo.yes"),value:1},null,8,["label"]),t(T,{label:s(c)("common.yesOrNo.no"),value:0},null,8,["label"])]),_:1})]),_:1},8,["value"])]),_:1})]}),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Vt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function rt(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!$t(h)}const Wt=ut({name:"realtimequery_sitehistoryquery",__name:"index",setup(h){const u=lt(),g=async()=>{const{data:e,error:o}=await Pt();o||(u.value=e)};Ut(()=>{g(),l.value.forEach(e=>{typeof e.title=="function"&&(e.title=e.title().children[0])})});const{columns:E,columnChecks:l,data:n,getData:O,loading:S,mobilePagination:W,searchParams:x,resetSearchParams:at}=It({apiFn:Tt,apiParams:{page:1,limit:20,pageSize:20,startTime:Q(1,Date.now()-864e5*3)||null,endTime:Q(1,Date.now())||null,_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",width:50,disabled:e=>e.mtype==1},{key:"dbtime",title:()=>t("span",null,["更新时间",t(Nt,{trigger:"hover",placement:"top","content-style":"padding: 5px;"},{default:()=>t("span",null,[v("表格中有标识 "),t("span",{class:"c-#ff6f00"},[v("※")]),v(" 的为人工补录数据")]),trigger:()=>t(Qt,{class:"text-xl cursor-pointer c-#7a7b78"},null)})]),align:"center",width:200,render(e){return t("span",{style:{color:e.mtype==0?"#ff6f00":""}},[t("span",null,[e.mtype==0?"※":""]),v(" "),e.dbtime])}},{key:"stationP",title:()=>{var e;return t("span",null,[`总有功功率${(e=u.value)!=null&&e.StationP?"("+u.value.StationP+")":"(MW)"}`])},align:"center",width:120},{key:"stationQ",title:()=>{var e;return t("span",null,[`总无功功率${(e=u.value)!=null&&e.StationQ?"("+u.value.StationQ+")":"(MW)"}`])},align:"center",width:140},{key:"stationS",title:()=>{var e;return t("span",null,[`总视在功率${(e=u.value)!=null&&e.StationS?"("+u.value.StationS+")":"(MW)"}`])},align:"center",width:140},{key:"stationCOS",title:()=>{var e,o;return t("span",null,[`总功率因数${((e=u.value)==null?void 0:e.StationCOS)=="-"?"":(o=u.value)!=null&&o.StationCOS?"("+u.value.StationCOS+")":""}`])},align:"center",width:100},{key:"stationU",title:()=>{var e,o;return t("span",null,[`总电压${(e=u.value)!=null&&e.StationU?"("+((o=u.value)==null?void 0:o.StationU)+")":"(V)"}`])},align:"center",width:100},{key:"stationI",title:()=>{var e,o;return t("span",null,[`总电流${(e=u.value)!=null&&e.StationI?"("+((o=u.value)==null?void 0:o.StationI)+")":"(A)"}`])},align:"center",width:100},{key:"stationFreq",title:()=>{var e;return t("span",null,[`频率${(e=u.value)!=null&&e.StationFreq?"("+u.value.StationFreq+")":"(Hz)"}`])},align:"center",width:100},{key:"stationDayE",title:()=>{var e;return t("span",null,[`日发电量${(e=u.value)!=null&&e.StationDayE?"("+u.value.StationDayE+")":"(MWh)"}`])},align:"center",width:120},{key:"stationTotalE",title:()=>{var e;return t("span",null,[`总发电量${(e=u.value)!=null&&e.StationTotalE?"("+u.value.StationTotalE+")":"(MWh)"}`])},align:"center",width:140},{key:"stationControlled",title:"是否限电",align:"center",width:140,render:e=>t("span",null,[e.stationControlled?e.stationControlled==1?"是":"否":""])},{key:"operate",title:c("common.operate"),align:"center",width:200,fixed:"right",render:e=>{let o;return t("div",{class:"flex-center gap-8px"},[e.mtype==0?t(V,null,{default:()=>[H(t(D,{type:"primary",ghost:!0,size:"small",onClick:()=>T(e.id)},rt(o=c("common.edit"))?o:{default:()=>[o]}),[[Y("no-auth"),"station:his:update"]]),H(t(st,{onPositiveClick:()=>f(e.id)},{default:()=>c("common.confirmDelete"),trigger:()=>{let d;return t(D,{type:"error",ghost:!0,size:"small"},rt(d=c("common.delete"))?d:{default:()=>[d]})}}),[[Y("no-auth"),"station:his:delete"]])]}):""])}}]}),{drawerVisible:C,operateType:G,editingData:A,handleAdd:U,handleEdit:J,checkedRowKeys:y,onBatchDeleted:w,onDeleted:i}=zt(n,O),k=()=>{O()},p=async()=>{const e=y.value.join(","),{data:o,error:d}=await it({ids:e});d||(i(),y.value=[])},f=async e=>{const{data:o,error:d}=await it({ids:e});d||i()},T=e=>{J(e)},N=lt([Date.now()-864e5*3,Date.now()]);async function K(e,o){x.startTime=Q(1,o[0]),x.endTime=Q(1,o[1]),O()}const L=()=>{const e={};E.value.forEach(d=>{d.key!="index"&&d.key!="operate"&&d.type!=="selection"&&(e[d.key]=typeof d.title=="string"?d.title:d.title().children[0])});const o=[];n.value.forEach(d=>{const m=JSON.parse(JSON.stringify(e));for(const _ in m)d.hasOwnProperty(_)?_=="stationControlled"?m[_]=d[_]==1?"是":"否":m[_]=d[_]:m[_]="";o.push(m)}),Ht(o,e,"站点历史数据")},X={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()]};return(e,o)=>{const d=pt,m=yt,_=ct,M=mt,$=dt,P=bt,F=vt,B=ft,q=_t,I=Ft,z=Bt,r=Y("no-auth");return R(),Mt("div",Vt,[t(z,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t($,{ref:"formRef",model:s(x),"label-placement":"left","show-feedback":!1},{default:a(()=>[t(M,{"y-gap":16,responsive:"screen","item-responsive":""},{default:a(()=>[t(_,{span:"24 s:12 m:12",label:"起止时间",path:"startTime"},{default:a(()=>[t(d,{value:N.value,"onUpdate:value":o[0]||(o[0]=b=>N.value=b),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":K,shortcuts:X,"default-time":["00:00:00","23:59:59"]},null,8,["value"]),t(s(D),{type:"primary",ghost:"",onClick:k,class:"ml-20px"},{icon:a(()=>[t(m,{class:Z(["text-icon",{"animate-spin":s(S)}])},null,8,["class"])]),default:a(()=>[v(" "+j(s(c)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),"header-extra":a(()=>[t(s(V),{justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[H((R(),et(s(D),{onClick:s(U),size:"small",ghost:"",type:"primary"},{icon:a(()=>[t(P,{class:Z(["text-icon",{"animate-spin":s(S)}])},null,8,["class"])]),default:a(()=>[v(" "+j(s(c)("common.add")),1)]),_:1},8,["onClick"])),[[r,"station:his:insert"]]),H((R(),et(s(st),{onPositiveClick:p},{trigger:a(()=>[t(s(D),{size:"small",ghost:"",type:"error",disabled:s(y).length==0},{icon:a(()=>[t(F,{class:Z(["text-icon",{"animate-spin":s(S)}])},null,8,["class"])]),default:a(()=>[v(" "+j(s(c)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:a(()=>[v(" 确认删除选中的项吗？ ")]),_:1})),[[r,"station:his:delete"]]),t(s(D),{onClick:L,size:"small"},{icon:a(()=>[t(B,{class:"text-icon"})]),default:a(()=>[v(" 导出当前页 ")]),_:1}),t(q,{columns:s(l),"onUpdate:columns":o[1]||(o[1]=b=>tt(l)?l.value=b:null)},null,8,["columns"])]),_:1})]),default:a(()=>[t(I,{"checked-row-keys":s(y),"onUpdate:checkedRowKeys":o[2]||(o[2]=b=>tt(y)?y.value=b:null),columns:s(E),data:s(n),size:"small",loading:s(S),remote:"","row-key":b=>b.id,pagination:s(n).length?s(W):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1}),t(Rt,{visible:s(C),"onUpdate:visible":o[3]||(o[3]=b=>tt(C)?C.value=b:null),onSubmitted:k,"operate-type":s(G),"row-data":s(A),unitObj:u.value},null,8,["visible","operate-type","row-data","unitObj"])])}}}),le=qt(Wt,[["__scopeId","data-v-ed7113ab"]]);export{le as default};
