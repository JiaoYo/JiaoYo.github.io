import{_ as ke,a as xe}from"./close-small-rounded-C6mNvm3T.js";import{d as O,s as X,r as F,D as Ce,E as A,o as h,c as S,w as t,f as N,g as e,h as m,i as U,F as D,M as $e,b0 as ee,L as M,B as q,ap as Y,bc as te,O as B,P as H,S as K,Q as Se,R as Te,T as ne,j as V,t as G,ad as L,v as Ne,e as J,ao as ae,bd as Ue,be as Ie,aD as De,a2 as z,K as W,ar as Ee,aZ as Ve,H as R,bf as se,bg as le,aB as Pe,bh as oe,bi as ie,as as qe,aq as Re,a0 as Q,aj as re,av as Be,ae as Me,bj as Oe,bk as je,N as Fe,I as Ae,ay as Ge,az as ze}from"./index-EW2EHvBZ.js";import{h as He,i as Le,j as Je,k as We,l as Ke,m as Qe,n as Ze,o as Xe,p as Ye,q as et,r as tt,s as nt,t as at,u as st,v as lt,w as ot,x as it,y as rt,z as ut,A as ct,B as dt,C as mt,D as pt}from"./basic-config-DSOtNpkU.js";import{M as _t}from"./shield-question-outline-rounded-CGoQPNew.js";import{_ as ft}from"./Table-Djw7_Hjy.js";import{f as ue}from"./reportForm-BdxswCPX.js";import{f as ce}from"./scheduleTask-DiF5ayhB.js";import{_ as gt}from"./DatePicker-R2dPNy-B.js";import{_ as de}from"./TimePicker-C1vs24tG.js";import{u as me}from"./table-BM2Nndfm.js";import{_ as vt}from"./Popconfirm-TDUTgjWd.js";import{u as yt}from"./usePageData-BrxLaPmr.js";import{a as bt}from"./events-CW6Qv9Pf.js";import{_ as ht}from"./Upload-DoM6KtKf.js";import"./defineProperty-DWbRgQB0.js";import"./Progress-CQtr656V.js";const pe=E=>(Se("data-v-3d7d470c"),E=E(),Te(),E),wt={class:"flex justify-center"},kt=pe(()=>N("span",{class:"font-bold"},"提示：",-1)),xt=pe(()=>N("span",{style:{"text-decoration":"underline"}},"被锁定的账号会在设定的时间周期后自动解锁",-1)),Ct=O({name:"basicConfig",__name:"basicConfig",setup(E){const{formRef:d,validate:w,restoreValidation:l}=X(),o=F($());function $(){return{enablelock:1,locktime:5,lockcount:3,unlockeanble:1,unlocktime:5,aceffective:1,pwdexpire:1,expiretime:1,cputhreshold:80,memthreshold:80,captcha:1,tokentime:30}}const i={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},k={locktime:i,lockcount:i,unlocktime:i,expiretime:i,cputhreshold:i,memthreshold:i,tokentime:i},_=async()=>{const{data:r,error:a}=await He();a||(Object.assign(o,r),o.locktime=r.locktime/60,o.unlocktime=r.unlocktime/60/24)};Ce(()=>{_()});const n=async()=>{var b;const r=o.locktime*60,a=o.unlocktime*60*24;await w();const{error:T}=await Le({...o,locktime:r,unlocktime:a});T||(b=window.$message)==null||b.success("设置成功")};return(r,a)=>{const T=$e,b=ee,c=M,u=q,y=Y,x=te,v=B,s=H,f=K,p=A("no-auth");return h(),S(f,{style:{"max-height":"calc(100vh - 245px)"}},{default:t(()=>[N("div",wt,[e(s,{ref_key:"formRef",ref:d,"label-width":180,"label-placement":"left",model:o,rules:k},{default:t(()=>[e(c,{label:"是否开启自动解锁",path:"unlockeanble"},{label:t(()=>[m(" 是否开启自动解锁 "),e(T,{trigger:"hover",placement:"top","content-style":"padding: 5px;"},{trigger:t(()=>[e(U(_t),{class:"text-xl cursor-pointer c-#7a7b78"})]),default:t(()=>[kt,xt]),_:1})]),default:t(()=>[e(b,{value:o.unlockeanble,"onUpdate:value":a[0]||(a[0]=g=>o.unlockeanble=g),disabled:"","checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(c,{label:"解锁时间",path:"unlocktime"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(u,{onClick:a[1]||(a[1]=g=>o.unlocktime--),disabled:o.unlocktime==1},{default:t(()=>[m(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:o.unlocktime,"onUpdate:value":a[2]||(a[2]=g=>o.unlocktime=g),placeholder:"",min:1,max:3},null,8,["value"]),e(u,{onClick:a[3]||(a[3]=g=>o.unlocktime++),class:"mr-5px",disabled:o.unlocktime==3},{default:t(()=>[m(" + ")]),_:1},8,["disabled"]),m(" 天 ")]),_:1})]),_:1}),e(c,{label:"是否开启验证码",path:"captcha"},{default:t(()=>[e(b,{value:o.captcha,"onUpdate:value":a[4]||(a[4]=g=>o.captcha=g),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(c,{label:"密码过期时间",path:"expiretime"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(u,{onClick:a[5]||(a[5]=g=>o.expiretime--),disabled:o.expiretime==1},{default:t(()=>[m(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:o.expiretime,"onUpdate:value":a[6]||(a[6]=g=>o.expiretime=g),placeholder:"",min:1,max:90},null,8,["value"]),e(u,{onClick:a[7]||(a[7]=g=>o.expiretime++),class:"mr-5px",disabled:o.expiretime==90},{default:t(()=>[m(" + ")]),_:1},8,["disabled"]),m(" 天 ")]),_:1})]),_:1}),e(c,{label:"CPU阈值",path:"cputhreshold"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(u,{onClick:a[8]||(a[8]=g=>o.cputhreshold--),disabled:o.cputhreshold==0},{default:t(()=>[m(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:o.cputhreshold,"onUpdate:value":a[9]||(a[9]=g=>o.cputhreshold=g),placeholder:"",min:0,precision:0,max:100},null,8,["value"]),e(u,{onClick:a[10]||(a[10]=g=>o.cputhreshold++),disabled:o.cputhreshold==100,class:"mr-5px"},{default:t(()=>[m(" + ")]),_:1},8,["disabled"]),m(" % ")]),_:1})]),_:1}),e(c,{label:"MEM阈值",path:"memthreshold"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(u,{onClick:a[11]||(a[11]=g=>o.memthreshold--),disabled:o.memthreshold==0},{default:t(()=>[m(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:o.memthreshold,"onUpdate:value":a[12]||(a[12]=g=>o.memthreshold=g),placeholder:"",min:0,precision:0,max:100},null,8,["value"]),e(u,{onClick:a[13]||(a[13]=g=>o.memthreshold++),disabled:o.memthreshold==100,class:"mr-5px"},{default:t(()=>[m(" + ")]),_:1},8,["disabled"]),m(" % ")]),_:1})]),_:1}),e(c,{label:"token过期时间",path:"tokentime"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(u,{onClick:a[14]||(a[14]=g=>o.tokentime--),disabled:o.tokentime==1},{default:t(()=>[m(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:o.tokentime,"onUpdate:value":a[15]||(a[15]=g=>o.tokentime=g),placeholder:"",min:1},null,8,["value"]),e(u,{onClick:a[16]||(a[16]=g=>o.tokentime++),class:"mr-5px"},{default:t(()=>[m(" + ")]),_:1}),m(" 小时 ")]),_:1})]),_:1}),e(c,{label:" "},{default:t(()=>[e(v,null,{default:t(()=>[D((h(),S(u,{type:"default",ghost:"",onClick:_},{default:t(()=>[m(" 刷新 ")]),_:1})),[[p,"system.conf.select"]]),D((h(),S(u,{type:"info",ghost:"",onClick:n},{default:t(()=>[m(" 保存 ")]),_:1})),[[p,"system.conf.update"]])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})}}}),$t=ne(Ct,[["__scopeId","data-v-3d7d470c"]]),St=N("td",null,"产品名称",-1),Tt=N("td",null,"产品版本",-1),Nt=N("td",null,"build号",-1),Ut=N("td",null,"产品型号",-1),It=O({name:"basicInfo",__name:"basicInfo",setup(E){const d=V({id:1,pname:"",pversion:"",pbuild:"",pmodel:""});(async()=>{const{data:$,error:i}=await Je();i||(d.value=$)})(),V(0);const l=async()=>{var k,_;const{data:$,error:i}=await We();i||($==="重启失败"?(k=window.$message)==null||k.error($):(_=window.$message)==null||_.success($))},o=async()=>{var k,_;const{data:$,error:i}=await Ke();i||($==="关机失败"?(k=window.$message)==null||k.error($):(_=window.$message)==null||_.success($))};return($,i)=>{const k=ft,_=q,n=B,r=L,a=A("no-auth");return h(),S(r,{class:"w-600px text-center m-auto mt-20px"},{default:t(()=>[e(k,{bordered:!0,"single-line":!1},{default:t(()=>[N("tbody",null,[N("tr",null,[St,N("td",null,G(d.value.pname||""),1)]),N("tr",null,[Tt,N("td",null,G(d.value.pversion),1)]),N("tr",null,[Nt,N("td",null,G(d.value.pbuild),1)]),N("tr",null,[Ut,N("td",null,G(d.value.pmodel),1)])])]),_:1}),e(n,{justify:"center",class:"mt-50px"},{default:t(()=>[D((h(),S(_,{type:"info",ghost:"",onClick:l},{default:t(()=>[m("重启")]),_:1})),[[a,"sysmanger.basicInfo.restart"]]),D((h(),S(_,{type:"info",ghost:"",onClick:o},{default:t(()=>[m("关机")]),_:1})),[[a,"sysmanger.basicInfo.shutdown"]])]),_:1})]),_:1})}}}),Dt=O({name:"emailService",__name:"emailSever",setup(E){const{createConfirmPwdRule:d,defaultRequiredRule:w,patternRules:l}=Ne(),{formRef:o,validate:$}=X(),i=V({port:void 0,pwd:"",sendserver:"",essl:0,uname:""}),k={sendserver:[{required:!0,validator:(v,s,f)=>s?Ue(s)?f():f(new Error("请输入正确的IP地址或域名")):new Error("请输入服务器地址"),trigger:["blur","input"]}],port:{type:"number",required:!0,trigger:["blur","input"],validator:(v,s,f)=>s==null||s==null?new Error("请输入端口号"):Ie(s)?!0:new Error("请输入在0-65535之间的数字")},uname:[{required:!0,message:"请输入账号",trigger:"blur"}],pwd:[{required:!0,message:"请输入密码",trigger:"blur"}],sendaddr:[{required:!0,message:"请输入发件邮箱",trigger:["blur","input"]},{validator:De,trigger:["blur","input"]}]},_=V(!1),n=F({pwd:""}),r={pwd:[{required:!0,message:"请输入密码",trigger:"blur"},l.passwordL]},a=()=>{n.pwd="",_.value=!0},T=V(),b=async()=>{var p,g;await((p=T.value)==null?void 0:p.validate());const v=z(n.pwd),{data:s,error:f}=await Qe({pwd:v});f||(s!=null&&s.id||(g=window.$message)==null||g.warning("查询到系统未设置邮件服务,请先添加邮件服务"),i.value.sendserver=(s==null?void 0:s.sendserver)??i.value.sendserver,i.value.port=(s==null?void 0:s.port)??i.value.port,i.value.pwd=(s==null?void 0:s.pwd)??i.value.pwd,i.value.essl=(s==null?void 0:s.essl)??i.value.essl,i.value.uname=(s==null?void 0:s.uname)??i.value.uname,i.value.id=(s==null?void 0:s.id)??i.value.id,_.value=!1)},c=async()=>{var f,p,g,P;await $();const v=z(i.value.pwd),s=z(i.value.uname);if(i.value.id){const{data:j,error:C}=await Ze({...i.value,pwd:v,uname:s});C||((f=window.$message)==null||f.destroyAll(),(p=window.$message)==null||p.success("保存成功"))}else{const{data:j,error:C}=await Xe({...i.value,pwd:v,uname:s});C||((g=window.$message)==null||g.destroyAll(),(P=window.$message)==null||P.success("保存成功"))}},u=async()=>{var f,p;const{data:v,error:s}=await Ye();s||((f=window.$message)==null||f.destroyAll(),(p=window.$message)==null||p.success("重置成功"),b())},y=V(!1),x=async()=>{var f,p;const v=z(i.value.pwd),s=z(i.value.uname);y.value=!0,await $();try{const{data:g,error:P}=await et({...i.value,pwd:v,uname:s});P||((f=window.$message)==null||f.destroyAll(),(p=window.$message)==null||p.success("测试成功"))}finally{y.value=!1}};return(v,s)=>{const f=W,p=M,g=Y,P=ee,j=H,C=q,_e=B,fe=W,ge=M,ve=H,ye=K,be=q,he=B,we=Ee,Z=A("no-auth");return h(),J(ae,null,[e(j,{ref_key:"formRef",ref:o,"label-width":150,model:i.value,rules:k,"label-placement":"left",class:"w-400px",style:{margin:"50px auto"}},{default:t(()=>[e(p,{label:"发送邮件服务器",path:"sendserver"},{default:t(()=>[e(f,{value:i.value.sendserver,"onUpdate:value":s[0]||(s[0]=I=>i.value.sendserver=I),placeholder:"输入服务器或IP地址"},null,8,["value"])]),_:1}),e(p,{label:"端口",path:"port"},{default:t(()=>[e(g,{value:i.value.port,"onUpdate:value":s[1]||(s[1]=I=>i.value.port=I),placeholder:"输入端口",style:{width:"100%"}},null,8,["value"])]),_:1}),e(p,{label:"用户名",path:"uname"},{default:t(()=>[e(f,{value:i.value.uname,"onUpdate:value":s[2]||(s[2]=I=>i.value.uname=I),placeholder:"用户名"},null,8,["value"])]),_:1}),e(p,{label:"密码",path:"pwd"},{default:t(()=>[e(f,{type:"password",value:i.value.pwd,"onUpdate:value":s[3]||(s[3]=I=>i.value.pwd=I),placeholder:"密码","show-password-on":"click"},null,8,["value"])]),_:1}),e(p,{label:"ssl",path:"essl"},{default:t(()=>[e(P,{value:i.value.essl,"onUpdate:value":s[4]||(s[4]=I=>i.value.essl=I),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"]),e(_e,{justify:"center"},{default:t(()=>[e(C,{type:"info",ghost:"",onClick:a},{default:t(()=>[m("查询")]),_:1}),D((h(),S(C,{type:"info",ghost:"",onClick:x},{default:t(()=>[m("测试")]),_:1})),[[Z,"sysmanger.basicInfo.test.mailInfo"]]),D((h(),S(C,{type:"info",ghost:"",onClick:c},{default:t(()=>[m("保存")]),_:1})),[[Z,"sysmanger.mailInfo.update"]]),D((h(),S(C,{type:"info",ghost:"",onClick:u},{default:t(()=>[m("重置")]),_:1})),[[Z,"sysmanger.mailInfo.delete"]])]),_:1}),e(we,{show:_.value,"onUpdate:show":s[6]||(s[6]=I=>_.value=I),title:"查询邮件地址",preset:"card",class:"w-420px"},{footer:t(()=>[e(he,{justify:"center",size:16},{default:t(()=>[e(be,{type:"primary",onClick:b},{default:t(()=>[m(G(v.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(ye,{class:"max-h-480px pr-20px"},{default:t(()=>[e(ve,{ref_key:"checkformRef",ref:T,model:n,"label-placement":"left",rules:r,"label-width":80,"require-mark-placement":"left"},{default:t(()=>[e(ge,{label:v.$t("page.login.common.password"),path:"pwd"},{default:t(()=>[e(fe,{type:"password","show-password-on":"click",class:"eipaddrCss",clearable:"",value:n.pwd,"onUpdate:value":s[5]||(s[5]=I=>n.pwd=I),placeholder:"请输入当前登录账号密码"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])],64)}}}),Et=O({name:"TimingConfig",__name:"timingConfig",setup(E){const{formRef:d,validate:w}=X(),l=F({automatic:1,time:Ve(1,new Date),ip:"",taskId:"",showCron:!1,setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),o={time:{required:!0,message:"请选择时间",trigger:"blur"},ip:[{required:!0,message:"请输入IP",trigger:"blur"},{validator:Pe,trigger:"blur"}],task:{required:!0,message:"请设置表达式",trigger:"blur"},setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}},$=async()=>{const{data:_,error:n}=await tt();n||(l.time=_)};$(),(async()=>{const{data:_,error:n}=await nt();if(n)return;const{id:r,params:a}=_;try{if(a){const{cron:T,ip:b}=JSON.parse(a),c=oe(T);l.setting.settingCycle=c==null?void 0:c.settingCycle,l.setting.settingTime=c==null?void 0:c.settingTime,l.setting.settingCycleValue=c==null?void 0:c.settingCycleValue,l.ip=b,l.taskId=r}}catch(T){console.error("Error parsing params:",T)}})();const k=async()=>{var _,n;if(await w(),l.automatic){const{data:r,error:a}=await at({dtime:l.time});a||(_=window.$message)==null||_.success(r)}else{const r=ie(l.setting.settingCycle==1?{dayOfWeek:l.setting.settingCycleValue,time:l.setting.settingTime}:null,l.setting.settingCycle==2?{dayOfMonth:l.setting.settingCycleValue,time:l.setting.settingTime}:null,l.setting.settingCycle==3?{time:l.setting.settingTime}:null);l.taskId?await ce({id:l.taskId,beanName:"NtpTask",cronExpression:r,remark:"",status:1,params:JSON.stringify({ip:l.ip,cron:r})}):await ue({beanName:"NtpTask",cronExpression:r,remark:"",status:1,params:JSON.stringify({ip:l.ip,cron:r})});const{data:a,error:T}=await st({ip:l.ip});T||(n=window.$message)==null||n.success(a)}};return(_,n)=>{const r=qe,a=B,T=Re,b=M,c=gt,u=W,y=Q,x=de,v=q,s=H,f=A("no-auth");return h(),S(s,{ref_key:"formRef",ref:d,"label-width":180,"label-placement":"left",model:l,class:"m-auto w-600px mt-20px",rules:o},{default:t(()=>[e(b,{label:"校时",path:"enablelock"},{default:t(()=>[e(T,{value:l.automatic,"onUpdate:value":n[0]||(n[0]=p=>l.automatic=p),name:"radiogroup"},{default:t(()=>[e(a,null,{default:t(()=>[e(r,{value:1},{default:t(()=>[m("手动校时")]),_:1}),e(r,{value:0},{default:t(()=>[m("自动校时")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),l.automatic?(h(),S(b,{key:0,label:"设置中心服务器时间",path:"time"},{default:t(()=>[e(c,{"formatted-value":l.time,"onUpdate:formattedValue":n[1]||(n[1]=p=>l.time=p),format:"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:""},null,8,["formatted-value"])]),_:1})):R("",!0),l.automatic?R("",!0):(h(),J(ae,{key:1},[e(b,{label:"NTP服务器设置",path:"ip"},{default:t(()=>[e(u,{value:l.ip,"onUpdate:value":n[2]||(n[2]=p=>l.ip=p),placeholder:"输入NTP服务器设置",style:{width:"200px"}},null,8,["value"])]),_:1}),e(b,{label:"设置周期",path:"setting.settingCycle"},{default:t(()=>[e(a,{justify:"space-between"},{default:t(()=>[e(y,{value:l.setting.settingCycle,"onUpdate:value":[n[3]||(n[3]=p=>l.setting.settingCycle=p),n[4]||(n[4]=p=>l.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"200px"}},null,8,["value"]),e(b,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:t(()=>[e(a,null,{default:t(()=>[l.setting.settingCycle==1?(h(),S(y,{key:0,value:l.setting.settingCycleValue,"onUpdate:value":n[5]||(n[5]=p=>l.setting.settingCycleValue=p),options:U(se)(),style:{width:"200px"}},null,8,["value","options"])):R("",!0),l.setting.settingCycle==2?(h(),S(y,{key:1,value:l.setting.settingCycleValue,"onUpdate:value":n[6]||(n[6]=p=>l.setting.settingCycleValue=p),options:U(le)(),style:{width:"200px"}},null,8,["value","options"])):R("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(b,{label:"设置时间",path:"setting.settingTime"},{default:t(()=>[e(x,{"formatted-value":l.setting.settingTime,"onUpdate:formattedValue":n[7]||(n[7]=p=>l.setting.settingTime=p)},null,8,["formatted-value"])]),_:1})],64)),e(b,null,{label:t(()=>[l.automatic?D((h(),S(v,{key:0,type:"info",ghost:"",onClick:$},{default:t(()=>[m(" 查看服务器时间 ")]),_:1})),[[f,"sysmanger.basicInfo.gettiming"]]):R("",!0)]),default:t(()=>[e(a,null,{default:t(()=>[D((h(),S(v,{type:"info",ghost:"",onClick:k},{default:t(()=>[m(" 保存 ")]),_:1})),[[f,"sysmanger.basicInfo.manu.timing"]])]),_:1})]),_:1})]),_:1},8,["model"])}}}),Vt=O({name:"dataBase",__name:"dataBase",setup(E){const d=()=>[...Array(12).keys()].map(b=>({label:`${b+1}个月`,value:b+1})),w=F({space:80,retention:void 0,id:void 0}),{columns:l,columnChecks:o,data:$,getData:i,loading:k,mobilePagination:_,searchParams:n,resetSearchParams:r}=me({apiFn:lt,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center"}]});(async()=>{const{data:b,error:c}=await ot();c||(w.space=b.space,w.retention=b.retention,w.id=b.id)})();const T=async()=>{var u;const{data:b,error:c}=await it({space:w.space,retention:w.retention,id:w.id});c||(u=window.$message)==null||u.success("保存成功")};return(b,c)=>{const u=q,y=Y,x=te,v=M,s=Q,f=B,p=L,g=re,P=K,j=A("no-auth");return h(),S(P,{class:"h-full flex-col",style:{maxHeight:"calc(100vh - 220px)"}},{default:t(()=>[e(p,{title:"数据库维护配置",bordered:!1,class:"mb-20px","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:t(()=>[e(f,{class:"ml-50px"},{default:t(()=>[e(v,{label:"已用空间超过","label-placement":"left"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(u,{onClick:c[0]||(c[0]=C=>w.space--),disabled:w.space==1},{default:t(()=>[m(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:w.space,"onUpdate:value":c[1]||(c[1]=C=>w.space=C),placeholder:"",min:1,max:100,style:{width:"100px","text-align":"center"}},null,8,["value"]),e(u,{onClick:c[2]||(c[2]=C=>w.space++),disabled:w.space==100,class:"mr-5px"},{default:t(()=>[m(" + ")]),_:1},8,["disabled"]),m(" % 时自动维护 ")]),_:1})]),_:1}),e(v,{label:"数据保留时间","label-placement":"left",class:"mx-20px"},{default:t(()=>[e(s,{value:w.retention,"onUpdate:value":c[3]||(c[3]=C=>w.retention=C),placeholder:"请选择",options:d(),style:{width:"150px"}},null,8,["value","options"])]),_:1}),e(v,{label:" ","label-placement":"left"},{default:t(()=>[D((h(),S(u,{type:"info",ghost:"",onClick:T},{default:t(()=>[m("保存")]),_:1})),[[j,"sysmanger.basicInfo.insert.dataBaseMaintenance"]])]),_:1})]),_:1})]),_:1}),e(p,{title:"数据库维护列表",bordered:!1,class:"flex-1","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:t(()=>[e(g,{columns:U(l),data:U($),size:"small","scroll-x":462,"max-height":420,loading:U(k),remote:"","row-key":C=>C.id,pagination:U(_),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})]),_:1})}}}),Pt=O({name:"systemSnapshot",__name:"systemSnapshot",setup(E){const{columns:d,columnChecks:w,data:l,getData:o,loading:$,mobilePagination:i,searchParams:k,resetSearchParams:_}=me({apiFn:rt,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center",render:u=>e(Be,{type:u.resultmsg==1?"error":"success"},{default:()=>[u.resultmsg==1?"失败":"成功"]})},{title:"操作",key:"operate",align:"center",width:100,fixed:"right",render:u=>e(vt,{onPositiveClick:()=>c(u.id)},{default:()=>"确定恢复吗?恢复后将重启系统",trigger:()=>e(q,{type:"info",ghost:!0,size:"small"},{default:()=>[m("恢复")]})})}]}),n=F({id:"",setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),r=V(n),a={setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:["blur","change"]},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:["blur","change"]},settingTime:{required:!0,message:"请选择设置时间",trigger:["blur","change"]}}};(async()=>{const{data:u,error:y}=await ut();if(y)return;console.log(u,"asdas");const x=oe(u.cronExpression);Object.assign(n,{id:u.id,setting:x})})();const b=async()=>{var y,x,v;await((y=r.value)==null?void 0:y.validate());const u=ie(n.setting.settingCycle==1?{dayOfWeek:n.setting.settingCycleValue,time:n.setting.settingTime}:null,n.setting.settingCycle==2?{dayOfMonth:n.setting.settingCycleValue,time:n.setting.settingTime}:null,n.setting.settingCycle==3?{time:n.setting.settingTime}:null);if(n.id){const{data:s,error:f}=await ce({id:n.id,beanName:"SnapshotTask",cronExpression:u,status:1,params:JSON.stringify({corn:u})});f||(x=window.$message)==null||x.success("设置成功")}else{const{data:s,error:f}=await ue({beanName:"SnapshotTask",cronExpression:u,remark:"",status:1,params:JSON.stringify({corn:u})});f||(v=window.$message)==null||v.success("设置成功")}},c=async u=>{var v;const{data:y,error:x}=await ct({id:u});x||(v=window.$message)==null||v.success("恢复成功")};return(u,y)=>{const x=Q,v=M,s=B,f=de,p=H,g=L,P=re,j=K;return h(),S(j,{class:"h-full flex-col",style:{maxHeight:"calc(100vh - 220px)"}},{default:t(()=>[e(g,{title:"应用配置设置",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:t(()=>[e(s,{class:"ml-50px"},{default:t(()=>[e(p,{"label-placement":"left",inline:"",model:n,rules:a,ref_key:"formRef",ref:r,"label-width":150,class:"px-100px"},{default:t(()=>[e(v,{label:"设置周期",path:"setting.settingCycle"},{default:t(()=>[e(s,{justify:"space-between"},{default:t(()=>[e(x,{value:n.setting.settingCycle,"onUpdate:value":[y[0]||(y[0]=C=>n.setting.settingCycle=C),y[1]||(y[1]=C=>n.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"140px"}},null,8,["value"]),e(v,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:t(()=>[n.setting.settingCycle==1?(h(),S(x,{key:0,value:n.setting.settingCycleValue,"onUpdate:value":y[2]||(y[2]=C=>n.setting.settingCycleValue=C),options:U(se)(),style:{width:"140px"}},null,8,["value","options"])):R("",!0),n.setting.settingCycle==2?(h(),S(x,{key:1,value:n.setting.settingCycleValue,"onUpdate:value":y[3]||(y[3]=C=>n.setting.settingCycleValue=C),options:U(le)(),style:{width:"140px"}},null,8,["value","options"])):R("",!0)]),_:1})]),_:1})]),_:1}),e(v,{label:"设置时间",path:"setting.settingTime"},{default:t(()=>[e(f,{"formatted-value":n.setting.settingTime,"onUpdate:formattedValue":y[4]||(y[4]=C=>n.setting.settingTime=C)},null,8,["formatted-value"])]),_:1}),e(v,{label:" ","label-placement":"left"},{default:t(()=>[e(U(q),{type:"info",ghost:"",onClick:b},{default:t(()=>[m("保存")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(g,{title:"应用配置列表",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"},class:"flex-1"},{default:t(()=>[e(P,{columns:U(d),data:U(l),size:"small","scroll-x":462,"max-height":420,loading:U($),remote:"","row-key":C=>C.id,pagination:U(i),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})]),_:1})}}}),qt=O({__name:"sysStatus",setup(E){const d=F({mailaddr:"",snmpaddr:void 0,stype:0,tmail:0,tsnmp:0});(async()=>{const{data:n,error:r}=await dt();r||(d.mailaddr=(n==null?void 0:n.mailaddr)??d.mailaddr,d.snmpaddr=(n==null?void 0:n.snmpaddr)??d.snmpaddr,d.stype=(n==null?void 0:n.stype)??d.stype,d.tmail=(n==null?void 0:n.tmail)??d.tmail,d.tsnmp=(n==null?void 0:n.tsnmp)??d.tsnmp)})();const l=async()=>{var a;const{data:n,error:r}=await mt(d);r||(a=window.$message)==null||a.success("保存成功")},{pageData:o,getData:$,nextPage:i}=yt(bt),k=async n=>{const r=n.currentTarget;r.scrollTop+r.offsetHeight>=r.scrollHeight&&o.data.length<o.total&&i()},_=V();return Me(()=>o.data,n=>{n&&(_.value=n.filter(r=>r.ftype===1))}),$(),(n,r)=>{const a=je,T=Fe,b=W,c=M,u=Q,y=q,x=B,v=L,s=A("no-auth");return h(),S(x,{justify:"center"},{default:t(()=>[e(v,{title:"通知方式",class:"w-600px"},{default:t(()=>[e(a),e(T,{checked:d.tmail,"onUpdate:checked":r[0]||(r[0]=f=>d.tmail=f),"checked-value":1,"unchecked-value":0},{default:t(()=>[m(" 邮件 ")]),_:1},8,["checked"]),d.tmail?(h(),S(c,{key:0,label:"邮件地址","label-placement":"left","label-width":"120",class:"mt-30px",rule:{required:!0,validator:()=>{if(!d.mailaddr)return new Error("请输入邮件地址");if(!U(Oe)(d.mailaddr))return new Error("请输入正确的邮件地址")},trigger:["blur","input"]}},{default:t(()=>[e(b,{value:d.mailaddr,"onUpdate:value":r[1]||(r[1]=f=>d.mailaddr=f)},null,8,["value"])]),_:1},8,["rule"])):R("",!0),e(a),e(T,{checked:d.tsnmp,"onUpdate:checked":r[2]||(r[2]=f=>d.tsnmp=f),"checked-value":1,"unchecked-value":0},{default:t(()=>[m(" snmp trap ")]),_:1},8,["checked"]),d.tsnmp?(h(),S(c,{key:1,label:"通知服务器","label-placement":"left","label-width":"120",class:"mt-30px"},{default:t(()=>[e(u,{value:d.snmpaddr,"onUpdate:value":r[3]||(r[3]=f=>d.snmpaddr=f),options:_.value,"label-field":"ipaddr","value-field":"ipaddr",onScroll:k},null,8,["value","options"])]),_:1})):R("",!0),e(a),e(x,{justify:"end"},{default:t(()=>[D((h(),S(y,{type:"info",ghost:"",onClick:l},{default:t(()=>[m("保存")]),_:1})),[[s,"sysmanger.basicInfo.alarmNotification"]])]),_:1})]),_:1})]),_:1})}}}),Rt={class:"h-full"},Bt=O({name:"basicconfig_system-config",__name:"index",setup(E){const d=V("基本信息"),w=V(""),l=V(null),o=({file:k})=>{l.value=k.file,w.value=k.name},$=k=>{k.stopPropagation(),w.value="",l.value=null};F({fs:""});const i=async()=>{var k;try{const _=new FormData;_.append("file",l.value);const{data:n,error:r}=await pt(_);if(r)return;(k=window.$message)==null||k.success(n)}catch{}};return(k,_)=>{const n=Ge,r=ke,a=xe,T=q,b=ht,c=M,u=B,y=ze,x=L,v=A("no-auth");return h(),J("div",Rt,[e(x,{style:{"margin-bottom":"16px"},class:"h-full","content-style":{height:"100%"}},{default:t(()=>[e(y,{type:"card",animated:"",class:"h-100%",value:d.value,"onUpdate:value":_[1]||(_[1]=s=>d.value=s)},{default:t(()=>[e(n,{name:"基本信息",tab:"基本信息"},{default:t(()=>[e(It)]),_:1}),e(n,{name:"安全设置",tab:"安全设置"},{default:t(()=>[e($t)]),_:1}),e(n,{name:"邮件服务",tab:"邮件服务"},{default:t(()=>[e(Dt)]),_:1}),e(n,{name:"校时配置",tab:"校时配置"},{default:t(()=>[e(Et)]),_:1}),e(n,{name:"数据库维护",tab:"数据库维护",class:"h-100%"},{default:t(()=>[e(Vt)]),_:1}),e(n,{name:"应用配置备份",tab:"应用配置备份",class:"h-100%"},{default:t(()=>[e(Pt)]),_:1}),e(n,{name:"漏洞信息库",tab:"漏洞信息库"},{default:t(()=>[e(u,{justify:"center",class:"pt-20px important-flex-col items-center"},{default:t(()=>[e(c,{label:"上传漏洞信息文件","label-placement":"left"},{default:t(()=>[e(b,{action:"","custom-request":o,"show-file-list":!1,accept:".xlsx"},{default:t(()=>[w.value?(h(),J("div",{key:0,onClick:_[0]||(_[0]=Ae(()=>{},["stop"]))},[m(G(w.value)+" ",1),e(r,{class:"font-size-30px cursor-pointer",onClick:$})])):(h(),S(T,{key:1},{icon:t(()=>[e(a,{class:"text-icon"})]),default:t(()=>[m(" 选择文件")]),_:1}))]),_:1})]),_:1}),e(c,{label:"","label-placement":"left",class:"ml-20px"},{default:t(()=>[D((h(),S(T,{type:"info",ghost:"",disabled:!w.value,onClick:i},{default:t(()=>[m("提交")]),_:1},8,["disabled"])),[[v,"sysmanger.basicInfo.intelligence"]])]),_:1})]),_:1})]),_:1}),e(n,{name:"系统告警通知",tab:"系统告警通知"},{default:t(()=>[e(qt)]),_:1})]),_:1},8,["value"])]),_:1})])}}}),en=ne(Bt,[["__scopeId","data-v-7e22cfc4"]]);export{en as default};
