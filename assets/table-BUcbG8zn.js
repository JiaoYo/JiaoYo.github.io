import{U as L,b_ as M,r as j,k as P,b as x,dd as $,a0 as I,$ as z,ab as U,n as H,df as Y}from"./index-00pZtPBt.js";function G(o){const{loading:d,startLoading:k,endLoading:l}=L(),{bool:v,setBool:m}=M(),{apiFn:N,apiParams:u,transformer:w,immediate:g=!0,getColumnChecks:S,getColumns:D}=o,s=j({...u}),h=P(o.columns()),b=P([]),f=P(S(o.columns())),_=x(()=>D(h.value,f.value));function C(){h.value=o.columns();const i=new Map(f.value.map(e=>[e.key,e.checked])),r=S(h.value);f.value=r.map(e=>({...e,checked:i.get(e.key)??e.checked}))}async function y(i){var a;k();const r=O(i?Object.assign(s,i):s),e=await N(r),t=w(e);b.value=t.data,m(t.data.length===0),await((a=o.onFetched)==null?void 0:a.call(o,t)),l()}function O(i){const r={};return Object.entries(i).forEach(([e,t])=>{t!=null&&(r[e]=t)}),r}function n(i){Object.assign(s,i)}function T(){Object.assign(s,u),y()}return g&&y(),{loading:d,empty:v,data:b,columns:_,columnChecks:f,reloadColumns:C,getData:y,searchParams:s,updateSearchParams:n,resetSearchParams:T}}function W(o){const d=$(),k=I(),l=x(()=>k.isMobile),{apiFn:v,apiParams:m,immediate:N,showTotal:u=!0}=o,w="__selection__",g="__expand__",{loading:S,empty:D,data:s,columns:h,columnChecks:b,reloadColumns:f,getData:_,searchParams:C,updateSearchParams:y,resetSearchParams:O}=G({apiFn:v,apiParams:m,columns:o.columns,transformer:e=>{e.hasOwnProperty("total")||(e.total=0);const{data:t=[],pageNum:a=1,pageSize:p=20,total:c}=e||{},F=(t instanceof Array?t:t?t.hasOwnProperty("list")?t.list:t.data||[]:[]).map((B,K)=>({...B,index:(a-1)*p+K+1}));let E=C;return e.total=t instanceof Array?Object.prototype.hasOwnProperty.call(t,"total")?Number(t.total):Number(c):Number(t.total),n.itemCount=Number.isNaN(e.total)?0:e.total,{data:F,pageNum:E.page,pageSize:E.pageSize,total:Number.isNaN(e.total)?0:e.total}},getColumnChecks:e=>{const t=[];return e.forEach(a=>{A(a)?t.push({key:a.key,title:a.title,checked:!0}):a.type==="selection"?t.push({key:w,title:z("common.check"),checked:!0}):a.type==="expand"&&t.push({key:g,title:z("common.expandColumn"),checked:!0})}),t},getColumns:(e,t)=>{const a=new Map;return e.forEach(c=>{A(c)?a.set(c.key,c):c.type==="selection"?a.set(w,c):c.type==="expand"&&a.set(g,c)}),t.filter(c=>c.checked).map(c=>a.get(c.key))},onFetched:async e=>{const{pageNum:t,pageSize:a,total:p}=e;i({page:t,pageSize:a,itemCount:p})},immediate:N}),n=j({page:1,pageSize:20,showSizePicker:!0,pageSizes:[20,50,100,200],itemCount:0,onUpdatePage:async e=>{n.page=e,y({page:e,pageSize:n.pageSize||20,limit:n.pageSize||20,_t:new Date().getTime()}),r()},onUpdatePageSize:async e=>{n.pageSize=e,n.page=1,y({page:n.page,pageSize:e,limit:e,_t:new Date().getTime()}),r()},...u?{prefix:e=>z("datatable.itemCount",{total:e.itemCount})}:{}}),T=x(()=>({...n,pageSlot:l.value?3:9,prefix:!l.value&&u?n.prefix:void 0}));function i(e){Object.assign(n,e)}d.run(()=>{U(()=>k.locale,()=>{f()})}),H(()=>{d.stop()});const r=async()=>{const e=n.page,t=n.pageSize;await _();const a=n.itemCount,p=Math.ceil(a/t);e>p&&e>1?(n.page=p,C.page=p,await _()):s.value.length===0&&e>1&&(n.page=e-1,C.page=e-1,await _())};return{loading:S,empty:D,data:s,columns:h,columnChecks:b,reloadColumns:f,pagination:n,mobilePagination:T,updatePagination:i,getData:r,searchParams:C,updateSearchParams:y,resetSearchParams:O}}function X(o,d){const{bool:k,setTrue:l,setFalse:v}=M(),m=P("add");function N(){m.value="add",l()}const u=P(null);function w(s){m.value="edit";const h=o.value.find(b=>b.id===s)||null;u.value=Y(h),l()}const g=P([]);async function S(){var s;(s=window.$message)==null||s.success(z("common.deleteSuccess")),g.value=[],await d()}async function D(){var s;(s=window.$message)==null||s.success(z("common.deleteSuccess")),await d()}return{drawerVisible:k,openDrawer:l,closeDrawer:v,operateType:m,handleAdd:N,editingData:u,handleEdit:w,checkedRowKeys:g,onBatchDeleted:S,onDeleted:D}}function A(o){return!!o.key}export{X as a,W as u};
