import{T as K,bQ as E,r as j,j as w,b as T,bp as L,a3 as $,$ as N,ae as I,l as H,bR as R}from"./index-EjGipE9R.js";function U(n){const{loading:u,startLoading:y,endLoading:i}=K(),{bool:C,setBool:p}=E(),{apiFn:P,apiParams:l,transformer:k,immediate:d=!1,getColumnChecks:S,getColumns:v}=n,s=j({...l}),m=w(n.columns()),b=w([]),h=w(S(n.columns())),z=T(()=>v(m.value,h.value));function _(){m.value=n.columns();const r=new Map(h.value.map(t=>[t.key,t.checked])),e=S(m.value);h.value=e.map(t=>({...t,checked:r.get(t.key)??t.checked}))}async function f(r){var g;y();const e=D(r?Object.assign(s,r):s),t=await P(e),a=k(t);b.value=a.data,p(a.data.length===0),await((g=n.onFetched)==null?void 0:g.call(n,a)),i()}function D(r){const e={};return Object.entries(r).forEach(([t,a])=>{a!=null&&(e[t]=a)}),e}function c(r){Object.assign(s,r)}function O(){Object.assign(s,l),f()}return d&&f(),{loading:u,empty:C,data:b,columns:z,columnChecks:h,reloadColumns:_,getData:f,searchParams:s,updateSearchParams:c,resetSearchParams:O}}function V(n){const u=L(),y=$(),i=T(()=>y.isMobile),{apiFn:C,apiParams:p,immediate:P,showTotal:l=!0}=n,k="__selection__",d="__expand__",{loading:S,empty:v,data:s,columns:m,columnChecks:b,reloadColumns:h,getData:z,searchParams:_,updateSearchParams:f,resetSearchParams:D}=U({apiFn:C,apiParams:p,columns:n.columns,transformer:e=>{let t=_;if(e.error)return{data:[],pageNum:t.page,pageSize:t.pageSize,total:0};e.hasOwnProperty("total")||(e.total=0);const{data:a=[],pageNum:g=1,pageSize:o=20,total:A=0}=e||{};console.log("res",e);const M=(a instanceof Array?a:a?a.hasOwnProperty("list")?a.list:a.data||[]:[]).map((F,B)=>({...F,index:(g-1)*o+B+1}));return e.total=a instanceof Array?Object.prototype.hasOwnProperty.call(a,"total")?Number(a.total):Number(A):Number(a.total),{data:M,pageNum:t.page,pageSize:t.pageSize,total:Number.isNaN(e.total)?0:e.total}},getColumnChecks:e=>{const t=[];return e.forEach(a=>{x(a)?t.push({key:a.key,title:a.title,checked:!0}):a.type==="selection"?t.push({key:k,title:N("common.check"),checked:!0}):a.type==="expand"&&t.push({key:d,title:N("common.expandColumn"),checked:!0})}),t},getColumns:(e,t)=>{const a=new Map;return e.forEach(o=>{x(o)?a.set(o.key,o):o.type==="selection"?a.set(k,o):o.type==="expand"&&a.set(d,o)}),t.filter(o=>o.checked).map(o=>a.get(o.key))},onFetched:async e=>{const{pageNum:t,pageSize:a,total:g}=e;r({page:t,pageSize:a,itemCount:g})},immediate:P}),c=j({page:1,pageSize:20,itemCount:0,showSizePicker:!0,pageSizes:[20,50,100,200],onUpdatePage:async e=>{c.page=e,f({page:e,pageSize:c.pageSize||20,limit:c.pageSize||20,_t:new Date().getTime()}),z()},onUpdatePageSize:async e=>{c.pageSize=e,c.page=1,f({page:c.page,pageSize:e,limit:e,_t:new Date().getTime()}),z()},...l?{prefix:e=>N("datatable.itemCount",{total:e.itemCount})}:{}}),O=T(()=>({...c,pageSlot:i.value?3:9,prefix:!i.value&&l?c.prefix:void 0}));function r(e){Object.assign(c,e)}return u.run(()=>{I(()=>y.locale,()=>{h()})}),H(()=>{u.stop()}),{loading:S,empty:v,data:s,columns:m,columnChecks:b,reloadColumns:h,pagination:c,mobilePagination:O,updatePagination:r,getData:z,searchParams:_,updateSearchParams:f,resetSearchParams:D}}function W(n,u){const{bool:y,setTrue:i,setFalse:C}=E(),p=w("add");function P(){p.value="add",i()}const l=w(null);function k(s){p.value="edit";const m=n.value.find(b=>b.id===s)||null;l.value=R(m),i()}const d=w([]);async function S(){var s;(s=window.$message)==null||s.success(N("common.deleteSuccess")),d.value=[],await u()}async function v(){var s;(s=window.$message)==null||s.success(N("common.deleteSuccess")),await u()}return{drawerVisible:y,openDrawer:i,closeDrawer:C,operateType:p,handleAdd:P,editingData:l,handleEdit:k,checkedRowKeys:d,onBatchDeleted:S,onDeleted:v}}function x(n){return!!n.key}export{W as a,V as u};
