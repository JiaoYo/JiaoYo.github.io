import{_ as q}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BraKu64w.js";import{d as L,q as M,s as E,v as G,x as H,b as Z,r as J,y as Q,L as B,o as V,c as W,w as s,g as t,h as O,t as z,i as e,$ as m,N as X,M as $,A as Y,C as ee,aj as te,D as oe,B as j,E as ae,aa as ne,ab as le,Z as se,e as ie,ac as A,ad as re,a9 as ue}from"./index-DdFRcMsp.js";import{u as de,a as ce}from"./table-BsTW9ABZ.js";import{f as pe,a as me,b as _e,c as fe}from"./log-Dl33Vgm_.js";import{h as U}from"./permission-CbewqLcP.js";import{_ as ge}from"./Popconfirm-B2my08_G.js";import{_ as he}from"./DataTable-BtNWuVb4.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-s0NFLylz.js";import"./setting-outlined-BwbZ2xnc.js";import"./round-delete-BpT5z0wb.js";import"./refresh-sbMXe3AT.js";import"./round-plus-DEoRZ8xG.js";import"./Upload-DT01sVlP.js";import"./Progress-CjbFKRLF.js";import"./Forward-wDqmGldW.js";const we=L({name:"OperateDrawer",__name:"operate-drawer",props:M({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:M(["submitted"],["update:visible"]),setup(_,{emit:N}){const u=_,f=N,c=E(_,"visible"),{formRef:h,validate:y,restoreValidation:S}=G(),{defaultRequiredRule:K,formRules:I}=H(),w=Z(()=>({add:"新增日志审计",edit:"编辑日志审计"})[u.operateType]),l=J(D());function D(){return{id:void 0,ip:"",port:null}}const C={ip:I.ip,port:{type:"number",required:!0,message:"请输入端口",trigger:["input","blur"]}};function P(){Object.assign(l,D()),u.operateType==="edit"&&u.rowData&&(u.rowData.port=Number(u.rowData.port),Object.assign(l,u.rowData))}function i(){c.value=!1}async function k(){var g,r;if(await y(),u.operateType==="add"){const{data:v,error:p}=await pe([l]);p||((g=window.$message)==null||g.success(m("common.addSuccess")),i(),f("submitted"))}else{const{data:v,error:p}=await me([l]);p||((r=window.$message)==null||r.success(m("common.updateSuccess")),i(),f("submitted"))}}return Q(c,()=>{c.value&&(P(),S())}),(g,r)=>{const v=Y,p=ee,R=te,x=oe,a=j,o=ae,d=ne,b=le,T=B("no-space");return V(),W(b,{show:c.value,"onUpdate:show":r[2]||(r[2]=n=>c.value=n),"display-directive":"show",width:360},{default:s(()=>[t(d,{title:w.value,"native-scrollbar":!1,closable:""},{footer:s(()=>[t(o,{size:16},{default:s(()=>[t(a,{onClick:i},{default:s(()=>[O(z(e(m)("common.cancel")),1)]),_:1}),t(a,{type:"primary",onClick:k},{default:s(()=>[O(z(e(m)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[t(x,{ref_key:"formRef",ref:h,model:l,rules:C,onKeyup:X(k,["enter"])},{default:s(()=>[t(p,{label:"IP",path:"ip"},{default:s(()=>[$(t(v,{clearable:"",value:l.ip,"onUpdate:value":r[0]||(r[0]=n=>l.ip=n),placeholder:"请输入IP"},null,8,["value"]),[[T]])]),_:1}),t(p,{label:"端口",path:"port"},{default:s(()=>[t(R,{min:0,max:65535,value:l.port,"onUpdate:value":r[1]||(r[1]=n=>l.port=n),placeholder:"请输入端口",clearable:"",style:{width:"100%"},"show-button":!1},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ve={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function F(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!re(_)}const Ie=L({name:"logretrieval_logaudit",__name:"index",setup(_){const N=se(),{columns:u,columnChecks:f,data:c,getData:h,loading:y,mobilePagination:S,searchParams:K,resetSearchParams:I}=de({apiFn:_e,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"ip",title:"IP",align:"center",width:240},{key:"port",title:"端口",align:"center",width:240},{key:"operate",title:m("common.operate"),align:"center",width:130,render:a=>{let o;return t("div",{class:"flex-center gap-8px"},[$(t(j,{type:"primary",ghost:!0,size:"small",onClick:()=>R(a.id)},F(o=m("common.edit"))?o:{default:()=>[o]}),[[B("no-auth"),"logretrieval.logaudit.edit"]]),t(ge,{onPositiveClick:()=>p(a.id)},{default:()=>m("common.confirmDelete"),trigger:()=>{let d;return $(t(j,{type:"error",ghost:!0,size:"small"},F(d=m("common.delete"))?d:{default:()=>[d]}),[[B("no-auth"),"logretrieval.logaudit.delete"]])}})])}}]}),{drawerVisible:w,operateType:l,editingData:D,handleAdd:C,handleEdit:P,checkedRowKeys:i,onBatchDeleted:k,onDeleted:g,closeDrawer:r}=ce(c,h);async function v(){console.log(i.value),x(i.value.join(","),a=>{k()})}function p(a){console.log(a),x(a,o=>{g()})}function R(a){P(a)}async function x(a,o){const{data:d,error:b}=await fe(a);if(!b)o&&o(d);else return!1}return(a,o)=>{const d=q,b=he,T=ue;return V(),ie("div",ve,[t(T,{title:"日志审计",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":s(()=>[t(d,{columns:e(f),"onUpdate:columns":o[0]||(o[0]=n=>A(f)?f.value=n:null),"disabled-delete":e(i).length===0,"is-view-add-button":e(U)("logretrieval.logaudit.add"),"is-view-delete-button":e(U)("logretrieval.logaudit.delete"),loading:e(y),onAdd:e(C),onDelete:v,onRefresh:e(h)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:s(()=>[t(b,{"checked-row-keys":e(i),"onUpdate:checkedRowKeys":o[1]||(o[1]=n=>A(i)?i.value=n:null),columns:e(u),data:e(c),size:"small","flex-height":!e(N).isMobile,"scroll-x":962,loading:e(y),remote:"","row-key":n=>n.id,pagination:e(S),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(we,{visible:e(w),"onUpdate:visible":o[2]||(o[2]=n=>A(w)?w.value=n:null),"operate-type":e(l),"row-data":e(D),onSubmitted:e(h)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Ie as default};
