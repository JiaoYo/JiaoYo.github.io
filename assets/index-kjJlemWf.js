import{_ as be}from"./round-search-DE64LlxI.js";import{d as ne,Y as me,s as S,a as ee,aE as re,i as ie,dS as pe,b as B,o as E,e as o,F as L,f as c,B as ve,w as A,g as F,a2 as ue,a3 as de,t as z,cM as we,aV as ke,ac as _e,aQ as fe,V as se,aG as xe,aI as Fe,c as R,aO as ae,aM as oe,a8 as ge,a9 as Me,eG as Te,aT as $e,b3 as ce,eH as De,eI as Ce,aY as Ee,h as P,aJ as Se,I as je,N as Ae,aF as ze,$ as Oe,a7 as Pe,eJ as Be,aP as Ie,b5 as Ne,aZ as Ve}from"./index-CYktWG4g.js";import{u as Ue}from"./usePageData-B3dmJo7x.js";import{_ as te}from"./RadioButton-Dh1hBWEB.js";import{_ as le}from"./DatePicker-DtsJbsvC.js";const Re={class:"map-wrapper",style:{height:"100%",position:"relative"}},Le={class:"map-legend"},We={class:"legend-header"},Ye={class:"legend-actions"},qe={class:"legend-list"},He=["onClick","onContextmenu"],Ze={key:0,class:"visibility-icon"},Je={key:1,class:"solo-icon"},Ke={class:"legend-name"},Xe={class:"visibility-toggle"},Ge={key:0,class:"solo-notice"},Qe=ne({__name:"historyMap",props:{trackData:{}},setup(I){const V=me(),s=S(null);let _=null;const O=I,M=S([]),i=["#FF6B9D","#6BCF7F","#4A90E2","#FFD166","#7B68EE","#00D4AA","#FF8C42","#BA68C8","#4ECDC4","#FFA726","#42B883","#FF5252","#536DFE","#00E5FF","#69F0AE","#FF4081","#18FFFF","#B388FF","#76FF03","#FF9100","#EA80FC","#84FFFF","#CCFF90","#FF9E80","#80D8FF","#FFFF8D","#A7FFEB","#FF80AB","#8C9EFF","#B9F6CA"],h=S({}),T=S(""),m=ee(()=>{const n={};return Object.keys(M.value).forEach((t,e)=>{n[t]=i[e%i.length],h.value[t]===void 0&&(h.value[t]=!0)}),n});function N(n){if(T.value){W(n);return}h.value[n]=!h.value[n],b()}function W(n){T.value===n?U():(T.value=n,Object.keys(h.value).forEach(l=>{h.value[l]=l===n}),b())}function U(){T.value="",Object.keys(h.value).forEach(n=>{h.value[n]=!0}),b()}function Y(){Object.keys(h.value).forEach(n=>{h.value[n]=!h.value[n]}),T.value="",b()}function J(){Object.keys(h.value).forEach(n=>{h.value[n]=!0}),T.value="",b()}function K(){Object.keys(h.value).forEach(n=>{h.value[n]=!1}),T.value="",b()}const C=ee(()=>{const n=[];return Object.values(M.value).forEach(l=>{n.push(...l)}),n.sort((l,t)=>new Date(l.dbtime).getTime()-new Date(t.dbtime).getTime())}),G=ee(()=>{if(C.value.length===0)return[120.370086,30.305716];const n=C.value.map(a=>a.longitude),l=C.value.map(a=>a.latitude),t=(Math.min(...n)+Math.max(...n))/2,e=(Math.min(...l)+Math.max(...l))/2;return console.log(t,e),[t,e]});async function f(){const n="/map-sdk.json",{data:l}=await fe.get(`${n}?_t=${Date.now()}`);return l}function g(n){return new Promise((l,t)=>{if(window.AMap)return l(window.AMap);const e=document.createElement("script");e.src=`https://webapi.amap.com/maps?v=2.0&key=${n}&plugin=AMap.PolylineEditor`,e.defer=!0,e.onload=()=>window.AMap?l(window.AMap):t(new Error("AMapåŠ è½½å¤±è´¥")),e.onerror=()=>t(new Error("AMapè„šæœ¬åŠ è½½é”™è¯¯")),document.head.appendChild(e)})}const w=S({});function $(n,l){const t=l.lng-n.lng,e=l.lat-n.lat;return(Math.atan2(-e,t)*180/Math.PI-90+360)%360-175}function x(n,l,t,e){const a=document.createElement("div");return a.style.cssText=`
    width: 12px;
    height: 18px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 18px solid ${e};
    transform: translate(-50%, -50%) rotate(${t}deg);
    transform-origin: center center;
  `,new n.Marker({position:[l.lng,l.lat],content:a,offset:new n.Pixel(0,0)})}function u(n,l,t,e,a){const p=document.createElement("div");return p.className="custom-marker",p.style.transform="translate(calc(-50% + 4px),-120%)",p.innerHTML=`
    <div class="avatar-wrapper" style="border-color: ${e};box-shadow: 0 0 5px ${e}, 0 0 6px ${e};">
      <img src="${a||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"}" class="marker-avatar" />
    </div>
    <div class="marker-name" style="color: ${e};">${t}</div>
  `,new n.Marker({position:[l.lng,l.lat],content:p})}function y(){s.value&&s.value.clearMap(),w.value={}}function b(){!window.AMap||!s.value||Object.keys(w.value).forEach(n=>{const l=h.value[n];(w.value[n]||[]).forEach(e=>{l?e.show():e.hide()})})}function q(n){if(!s.value)return;y();const l={};Object.entries(M.value).forEach(([e,a])=>{l[e]=a.map(p=>({lng:p.longitude,lat:p.latitude,address:p.address,dbtime:p.dbtime,proname:p.proname||"æœªæŒ‡å®šé¡¹ç›®",duration:p.duration||0,userimage:p.userimage,longitude:p.longitude,latitude:p.latitude}))}),Object.keys(l).forEach(e=>{const a=l[e],p=m.value[e];if(a.length===0)return;const k=[];if(a.length>1){const d=new n.Polyline({path:a.map(D=>[D.lng,D.lat]),strokeColor:p,strokeWeight:4,strokeOpacity:.7,strokeStyle:"solid",lineJoin:"round",lineCap:"round",isOutline:!0,outlineColor:"#FFFFFF",borderWeight:2});d.setMap(s.value),k.push(d)}a.forEach((d,D)=>{new n.Marker({position:[d.longitude,d.latitude],content:'<div class="marker-dot"></div>',anchor:"center",offset:new n.Pixel(0,0)}).setMap(s.value);const v=u(n,d,e,p,a[0].userimage);v.setMap(s.value),k.push(v),v.on("click",()=>{const j=`
          <div style="min-width:220px; background:#fff; padding:12px 14px; font-size:13px; color:#333; line-height:1.6">
            <div style="font-weight:bold; color:${p}; font-size:15px; margin-bottom:6px; border-bottom:1px solid #f0f0f0; padding-bottom:4px">
              ${e}
            </div>
            <div><b style="color:#555">åœ°ç‚¹ï¼š</b>${d.address}</div>
            <div><b style="color:#555">æ—¶é—´ï¼š</b>${d.dbtime}</div>
            <div><b style="color:#555">é¡¹ç›®ï¼š</b>${d.proname}</div>
            <div><b style="color:#555">ç»çº¬åº¦ï¼š</b><span style="font-size:12px;color:#666">${d.longitude}, ${d.latitude}</span></div>

          </div>
          <div style="margin-top:8px; text-align:right; font-size:12px; color:#999">ç¬¬ ${D+1} ä¸ªæ‰“å¡ç‚¹</div>
        `;_.setContent(j),_.setOffset(new n.Pixel(4,-60)),_.open(s.value,v.getPosition())}),v.on("dblclick",()=>{_.open(s.value,v.getPosition()),s.value.setCenter(v.getPosition()),s.value.setZoom(14)})});for(let d=1;d<a.length;d++){const D=a[d-1],r=a[d];if(Z(D,r))continue;const v={lng:(D.lng+r.lng)/2,lat:(D.lat+r.lat)/2},j=$(D,r),Q=x(n,v,j,p);Q.isArrow=!0,Q.setMap(s.value),k.push(Q)}Object.keys(l).length==1&&s.value.setFitView(k,!1,[60,60,60,60]),w.value[e]=k});const t=()=>{const a=s.value.getZoom()>=7,p=H(w.value,h.value);Object.values(p).forEach(k=>{k==null||k.forEach(d=>{d.isArrow&&(a?d.show():d.hide())})})};s.value.on("zoomend",t),t(),Object.keys(w.value).forEach(e=>{(w.value[e]||[]).forEach(p=>{p.isArrow||(h.value[e]?p.show():p.hide())})})}function H(n,l){const t={};for(const e in n)l[e]&&(t[e]=n[e]);return t}function Z(n,l,t=1e-7){return Math.abs(n.lng-l.lng)<t&&Math.abs(n.lat-l.lat)<t}async function X(){try{const n=await f(),l=await g(n.AMAP_SDK_KEY);s.value=new l.Map("amap-container",{viewMode:"2D",center:G.value,zoom:5,features:["bg","point"]}),V.themeScheme==="dark"&&s.value.setMapStyle("amap://styles/dark"),l.plugin(["AMap.Scale","AMap.ToolBar"],()=>{s.value.addControl(new l.Scale),s.value.addControl(new l.ToolBar)}),s.value.on("zoomend",()=>{const e=s.value.getZoom()>=12,a=H(w.value,h.value);Object.values(a).forEach(p=>{p.forEach(k=>{k.isArrow&&(e?k.show():k.hide())})})}),_=new l.InfoWindow({anchor:"bottom-center",closeWhenClickMap:!0}),q(l)}catch(n){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",n)}}return re(()=>O.trackData??[],n=>{console.log(n,"så¤„ç†æ•°æ®æˆ–æ¸²æŸ“å†…å®¹"),M.value=n,window.AMap&&s.value&&q(window.AMap)},{immediate:!0,deep:!0}),ie(()=>{X()}),pe(()=>{s.value&&s.value.destroy()}),(n,l)=>{const t=ve;return E(),B("div",Re,[l[4]||(l[4]=o("div",{id:"amap-container",style:{width:"100%",height:"100%","border-radius":"8px"}},null,-1)),o("div",Le,[o("div",We,[l[3]||(l[3]=o("div",{class:"legend-title"},"äººå‘˜è½¨è¿¹",-1)),o("div",Ye,[c(t,{type:"primary",onClick:J},{default:A(()=>l[0]||(l[0]=[F("å…¨æ˜¾")])),_:1,__:[0]}),c(t,{type:"primary",onClick:K},{default:A(()=>l[1]||(l[1]=[F("å…¨éš")])),_:1,__:[1]}),c(t,{type:"primary",onClick:Y},{default:A(()=>l[2]||(l[2]=[F("åé€‰")])),_:1,__:[2]})])]),o("div",qe,[(E(!0),B(ue,null,de(m.value,(e,a)=>(E(),B("div",{key:a,class:ke(["legend-item",{"legend-item-hidden":!h.value[a],"legend-item-solo":T.value===a}]),onClick:p=>N(a),onContextmenu:we(p=>W(a),["prevent"])},[o("div",{class:"legend-color",style:_e({backgroundColor:e})},[h.value[a]?L("",!0):(E(),B("span",Ze,"ğŸ‘ï¸â€ğŸ—¨ï¸")),T.value===a?(E(),B("span",Je,"â­")):L("",!0)],4),o("span",Ke,z(a),1),o("span",Xe,z(h.value[a]?"éšè—":"æ˜¾ç¤º"),1)],42,He))),128))]),T.value?(E(),B("div",Ge,[F(" ä»…æ˜¾ç¤º: "+z(T.value)+" ",1),o("button",{class:"cancel-solo-btn",onClick:U},"å–æ¶ˆ")])):L("",!0)])])}}}),et=se(Qe,[["__scopeId","data-v-21c4c99e"]]),tt={class:"map-wrapper",style:{height:"100%",position:"relative"}},at=ne({__name:"map",props:{trackData:{},username:{},projectName:{}},setup(I){const V=me(),s=S(null);let _=null;const O=I,M=[{id:25,pid:10,longitude:120.367925,latitude:30.300161,address:"æµ™æ±Ÿçœæ­å·å¸‚é’±å¡˜åŒºç™½æ¨è¡—é“ç•™å­¦ç”Ÿåˆ›ä¸š",dbtime:"2025-10-28 22:38:57",username:"auditor",daytime:"2025-10-28"},{id:25,pid:10,ctype:2,longitude:120.373554,latitude:30.288942,address:"ä¸‰èŠ±-é“è·¯åœè½¦ä½",dbtime:"2025-10-28 22:38:57",username:"auditor",daytime:"2025-10-28"}],i=S(O.trackData??M),h=["#FFA726","#6BCF7F"],T=ee(()=>{if(i.value.length===0)return[120.370086,30.305716];const f=i.value.map(w=>w.longitude),g=i.value.map(w=>w.latitude);return[(Math.min(...f)+Math.max(...f))/2,(Math.min(...g)+Math.max(...g))/2]});async function m(){const f="/map-sdk.json",{data:g}=await fe.get(`${f}?_t=${Date.now()}`);return g}function N(f){return new Promise((g,w)=>{if(window.AMap)return g(window.AMap);const $=document.createElement("script");$.src=`https://webapi.amap.com/maps?v=2.0&key=${f}&plugin=AMap.PolylineEditor`,$.defer=!0,$.onload=()=>window.AMap?g(window.AMap):w(new Error("AMapåŠ è½½å¤±è´¥")),$.onerror=()=>w(new Error("AMapè„šæœ¬åŠ è½½é”™è¯¯")),document.head.appendChild($)})}const W=S({});function U(f,g,w,$,x){const u=document.createElement("div");return u.className="custom-marker",u.style.transform="translate(calc(-50% + 4px), -110%)",u.innerHTML=`
    <div class="avatar-wrapper" style="border-color: ${$}; box-shadow: 0 0 10px ${$}, 0 0 20px ${$};">
      <img src="${x||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"}" class="marker-avatar" />
    </div>
    <div class="marker-name" style="color: ${$};">${w}</div>
  `,new f.Marker({position:[g.lng,g.lat],content:u})}function Y(f,g){const w=document.createElement("div");return w.className="custom-marker",w.style.transform="translateX(-50%)",w.innerHTML='<div class="marker-dot"></div>',new f.Marker({position:[g.lng,g.lat],content:w})}function J(){s.value&&s.value.clearMap(),W.value={}}function K(f){J();const g=i.value.map(u=>({lng:u.longitude,lat:u.latitude,address:u.address,dbtime:u.dbtime,proname:u.proname||"æœªæŒ‡å®šé¡¹ç›®",duration:u.duration||0,distanse:u.distanse.toFixed(2)||0,userimage:u.userimage,ctype:u.ctype||1})),w=h[0],$=[];if(g.length>1){const u=new f.Polyline({path:g.map(y=>[y.lng,y.lat]),strokeColor:w,strokeWeight:3,strokeOpacity:.7,strokeStyle:"solid",lineJoin:"round",lineCap:"round",isOutline:!0,outlineColor:"#FFFFFF",borderWeight:2});u.setMap(s.value),$.push(u)}g.forEach(u=>{let y;u.ctype!=2?(y=U(f,u,O.username,w,g[0].userimage),new f.Marker({position:[u.lng,u.lat],content:'<div class="marker-dot"></div>',anchor:"center"}).setMap(s.value)):y=Y(f,u),y.setMap(s.value),$.push(y),y.on("click",()=>{const b=`
        <div style="min-width:220px; background:#fff; padding:12px 14px; font-size:13px;">
          <div style="font-weight:bold; color:${w}; font-size:15px; margin-bottom:6px;">
            ${O.username}
          </div>
          <div><b>åœ°ç‚¹ï¼š</b>${u.address}</div>
          <div><b>æ—¶é—´ï¼š</b>${u.dbtime}</div>
          <div><b>é¡¹ç›®ï¼š</b>${O.projectName||"æœªæŒ‡å®šé¡¹ç›®"}</div>
          <div><b>ç±»å‹ï¼š</b>${u.ctype==0?"ä¸Šç­æ‰“å¡":u.ctype==1?"ä¸‹ç­æ‰“å¡":"ç³»ç»Ÿä¸ŠæŠ¥"}</div>
          <div><b>ç»çº¬åº¦ï¼š</b>${u.lng}, ${u.lat}</div>
          ${u.duration?`<div><b>å·¥æ—¶ï¼š</b>${u.duration} å°æ—¶</div>`:""}
        </div>
      `;_.setContent(b),_.setOffset(new f.Pixel(4,-60)),_.open(s.value,y.getPosition())})});for(let u=1;u<g.length;u++){const y=g[u-1],b=g[u];if(Math.abs(y.lng-b.lng)<1e-7&&Math.abs(y.lat-b.lat)<1e-7)continue;const q={lng:(y.lng+b.lng)/2,lat:(y.lat+b.lat)/2},H=Math.atan2(-(b.lat-y.lat),b.lng-y.lng)*180/Math.PI-90,Z=C(f,q,H,"#1890ff");Z.setMap(s.value),$.push(Z)}s.value.setFitView($,!1,[60,60,60,60]),W.value.single=$;const x=i.value[0]?{address:i.value[0].caddress,lng:i.value[0].clongitude,lat:i.value[0].clatitude}:null;if(x&&x.lng&&x.lat){const u=new f.Marker({position:[x.lng,x.lat],offset:new f.Pixel(-13,-30),icon:new f.Icon({size:new f.Size(26,30),imageSize:new f.Size(26,30),image:"https://cdn-icons-png.flaticon.com/512/684/684908.png"})}),y=new f.InfoWindow({content:`<div style="font-size:14px;">ğŸ“é¡¹ç›®ä½ç½®ï¼š${x.address}</div>`,offset:new f.Pixel(0,-30)});u.on("click",()=>y.open(s.value,u.getPosition())),s.value.add(u)}if(x&&x.lng&&x.lat){const u=new f.Marker({position:[x.lng,x.lat],offset:new f.Pixel(-13,-30),icon:new f.Icon({size:new f.Size(26,30),imageSize:new f.Size(26,30),image:"https://cdn-icons-png.flaticon.com/512/684/684908.png"})}),y=new f.InfoWindow({content:`<div style="font-size:14px;">ğŸ“é¡¹ç›®ä½ç½®ï¼š${x.address}</div>`,offset:new f.Pixel(0,-30)});u.on("click",()=>y.open(s.value,u.getPosition())),s.value.add(u),g.forEach(b=>{if(b.ctype===0||b.ctype===1){const q=new f.Polyline({path:[[b.lng,b.lat],[x.lng,x.lat]],strokeColor:"#6BCF7F",strokeOpacity:.7,strokeWeight:2,strokeStyle:"dashed",showDir:!0});q.setMap(s.value),$.push(q);const H=(b.lng+x.lng)/2,Z=(b.lat+x.lat)/2,X=new f.Marker({position:[H,Z],content:`<div style="white-space: pre;padding:2px 4px; background:#fff; border:1px solid #6BCF7F; border-radius:3px; font-size:12px;">${b.distanse} m</div>`,offset:new f.Pixel(0,-10)});X.setMap(s.value),$.push(X)}})}}function C(f,g,w,$){const x=document.createElement("div");x.style.cssText=`
    position: relative; width:60px; height:24px; display:flex; align-items:center;
    transform: translate(-50%, -50%) rotate(${w-90}deg); transform-origin:center center;
  `;for(let y=0;y<3;y++){const b=document.createElement("div");b.style.cssText=`
      position:absolute;width:0;height:0;
      border-top:8px solid transparent; border-bottom:8px solid transparent;
      border-left:12px solid ${$};
      opacity:${.3+y*.2};
      left:${y*8}px;
      animation: arrowFlow 1.5s infinite; animation-delay:${y*.2}s;
    `,x.appendChild(b)}const u=document.createElement("style");return u.textContent=`
    @keyframes arrowFlow {
      0%{opacity:0.3; transform:translateX(0px) scale(1);}
      50%{opacity:1; transform:translateX(4px) scale(1.1);}
      100%{opacity:0.3; transform:translateX(0px) scale(1);}
    }
  `,document.head.appendChild(u),new f.Marker({position:[g.lng,g.lat],content:x,offset:new f.Pixel(0,0)})}async function G(){try{const f=await m(),g=await N(f.AMAP_SDK_KEY);s.value=new g.Map("amap-container",{viewMode:"2D",zoom:15,center:T.value,features:["bg","point"]}),V.themeScheme==="dark"&&s.value.setMapStyle("amap://styles/dark"),g.plugin(["AMap.Scale","AMap.ToolBar"],()=>{s.value.addControl(new g.Scale),s.value.addControl(new g.ToolBar)}),_=new g.InfoWindow({anchor:"bottom-center",closeWhenClickMap:!0}),K(g)}catch(f){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",f)}}return ie(()=>{i.value=O.trackData??M,G()}),pe(()=>{s.value&&s.value.destroy()}),(f,g)=>(E(),B("div",tt,g[0]||(g[0]=[o("div",{id:"amap-container",style:{width:"100%",height:"100%","border-radius":"8px"}},null,-1)])))}}),nt=se(at,[["__scopeId","data-v-6a65b39a"]]),st={class:"p-1 border-b border-gray-100 last:border-b-0 font-size-16px"},lt={class:"flex mb-3 items-center"},ot={class:"flex-col justify-center items-center mr-20px"},rt=["src"],it={class:"font-bold mt-10px text-[#000] calendarName"},ut={class:"flex mb-1"},dt={class:"c-#4169e1 font-bold"},ct={class:"flex mb-1"},mt={class:"c-#4169e1 font-bold"},pt={class:"flex mb-1"},vt={class:"mr-20px"},ft={class:"c-#4169e1 font-bold"},gt={class:"c-#4169e1 font-bold"},yt={class:"flex mb-1"},ht={class:"c-#4169e1 font-bold"},bt={class:"mx-20px flex items-center"},wt={class:"flex items-center"},kt={class:"flex mb-1"},_t={key:0},xt={class:"fontC"},Ft={class:"fontC"},Mt={class:"fontC"},Tt={class:"fontC"},$t=ne({__name:"calendarModal",props:xe({lookdetail:{},creater:{}},{dialogVisible:{type:Boolean,default:!1},dialogVisibleModifiers:{}}),emits:["update:dialogVisible"],setup(I){const V=Fe(I,"dialogVisible"),s=I,_=S({pid:0,address:"",startTime:void 0,endTime:void 0,duration:0,status:0,dailyReport:0,username:"",daytime:"",projectName:"",userImage:"",ctype:0}),O=S([]),M=async()=>{const{data:T,error:m}=await Te({startTime:s.lookdetail.startTime||s.lookdetail.daytime+" 00:00:00",endTime:s.lookdetail.endTime||s.lookdetail.daytime+" 23:59:59",pid:s.lookdetail.pid,creater:s.creater});T&&(O.value=T,_.value.address=T[0].caddress)};re(()=>V.value,async T=>{T&&(Object.assign(_.value,s.lookdetail),h.value="table",O.value=[],M())});const i=()=>{V.value=!1,setTimeout(()=>{_.value={pid:0,address:"",startTime:void 0,endTime:void 0,duration:0,status:0,dailyReport:0,username:"",daytime:"",projectName:"",userImage:"",ctype:0}},200)},h=S("table");return(T,m)=>{const N=ae,W=ae,U=te,Y=oe,J=ge,K=Me;return E(),R(K,{show:V.value,"onUpdate:show":m[1]||(m[1]=C=>V.value=C),class:"w-1000px",preset:"card",onClose:i,"modal-animation-name":"el-fade"},{header:A(()=>m[2]||(m[2]=[F(" è¯¦æƒ… ")])),default:A(()=>[o("div",st,[o("div",lt,[o("div",ot,[o("img",{class:"w-60px h-60px rounded-full shadow-sm",src:_.value.userImage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"},null,8,rt),o("div",it,z(_.value.username),1)]),o("div",null,[o("div",ut,[m[3]||(m[3]=o("span",{class:"mr-2"}," ğŸ—ï¸ é¡¹ç›®åç§°ï¼š ",-1)),o("span",dt,z(_.value.projectName||"æš‚æ— é¡¹ç›®"),1)]),o("div",ct,[m[4]||(m[4]=o("span",{style:{"white-space":"nowrap"}},"ğŸ“ é¡¹ç›®åœ°å€ï¼š",-1)),o("span",mt,z(_.value.address),1)]),o("div",pt,[o("div",vt,[m[5]||(m[5]=o("span",null,"ğŸ“… ä¸Šç­æ‰“å¡æ—¶é—´ï¼š",-1)),o("span",ft,z(_.value.startTime||"æ— "),1)]),o("div",null,[m[6]||(m[6]=o("span",null,"ğŸ“… ä¸‹ç­æ‰“å¡æ—¶é—´ï¼š",-1)),o("span",gt,z(_.value.endTime||"æ— "),1)])]),o("div",yt,[o("div",null,[m[7]||(m[7]=o("span",null,"â³ å·¥æ—¶ï¼š",-1)),o("span",ht,z(_.value.duration||0)+"å°æ—¶",1)]),o("div",bt,[m[10]||(m[10]=o("span",null,"ğŸ”” æ‰“å¡çŠ¶æ€ï¼š",-1)),o("span",null,[_.value.status==1?(E(),R(N,{key:0,type:"error",size:"small"},{default:A(()=>m[8]||(m[8]=[o("span",{class:"mr-1"},null,-1),F("å¼‚å¸¸ ")])),_:1,__:[8]})):L("",!0),_.value.status==0?(E(),R(N,{key:1,type:"success",size:"small"},{default:A(()=>m[9]||(m[9]=[o("span",{class:"mr-1"},null,-1),F("æ­£å¸¸ ")])),_:1,__:[9]})):L("",!0)])]),o("div",wt,[m[11]||(m[11]=o("span",null,"ğŸ“ æ—¥æŠ¥ï¼š",-1)),o("span",null,[c(W,{size:"small",type:_.value.dailyReport==1?"success":"error"},{default:A(()=>[F(z(_.value.dailyReport==1?"å·²æäº¤":"æœªæäº¤"),1)]),_:1},8,["type"])])])])])]),o("div",kt,[m[12]||(m[12]=o("div",{class:"mr-15px"},"å†å²è½¨è¿¹",-1)),c(Y,{size:"small",value:h.value,"onUpdate:value":m[0]||(m[0]=C=>h.value=C),name:"radiobuttongroup1"},{default:A(()=>[c(U,{value:"table",label:"è¡¨æ ¼"}),c(U,{value:"map",label:"åœ°å›¾"})]),_:1},8,["value"])]),h.value=="table"?(E(),B("div",_t,[c(J,{style:{height:"600px"},trigger:"hover"},{default:A(()=>[(E(!0),B(ue,null,de(O.value,C=>(E(),B("div",{class:"tableItem",key:C.id},[o("div",null,[m[13]||(m[13]=F("æ‰“å¡ç±»å‹ï¼š")),o("span",xt,z(C.ctype==0?"ä¸Šç­æ‰“å¡":C.ctype==1?"ä¸‹ç­æ‰“å¡":"ç³»ç»Ÿä¸ŠæŠ¥"),1)]),o("div",null,[m[14]||(m[14]=F("æ‰“å¡çŠ¶æ€ï¼š")),c(N,{type:C.status==1?"error":"success"},{default:A(()=>[o("div",null,z(C.status==0?"æ­£å¸¸":"å¼‚å¸¸"),1)]),_:2},1032,["type"])]),o("div",null,[m[15]||(m[15]=F("åœ°å€ï¼š ")),o("span",Ft,z(C.address),1)]),o("div",null,[m[16]||(m[16]=F("æ‰“å¡æ—¶é—´ï¼š")),o("span",Mt,z(C.dbtime),1)]),o("div",null,[m[17]||(m[17]=F("æ‰“å¡è¯¯å·®å€¼ï¼š")),o("span",Tt,z(C.distanse?C.distanse.toFixed(2)+"ç±³":"æ— "),1)])]))),128))]),_:1})])):L("",!0),h.value=="map"?(E(),R(nt,{key:1,trackData:O.value,projectName:_.value.projectName,username:s.lookdetail.username,class:"map"},null,8,["trackData","projectName","username"])):L("",!0)])]),_:1},8,["show"])}}}),Dt=se($t,[["__scopeId","data-v-b3ff7001"]]),Ct={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Et(I){return typeof I=="function"||Object.prototype.toString.call(I)==="[object Object]"&&!Ve(I)}const St=ne({name:"reportmanagement_calendar",__name:"index",setup(I){const V=$e();function s(t){return t.getFullYear()}function _(t){const e=new Date(t.getFullYear(),0,1),a=(t.getTime()-e.getTime())/864e5,p=e.getDay()||7;return Math.ceil((a+p)/7)}function O(){const t=new Date,e=s(t),a=_(t).toString().padStart(2,"0");return`${e}-${a}å‘¨`}const M=S("week"),i=S({dayTime:String(ce(0,null)),monthTime:String(ce(3,null)),weekTime:O(),startTime:null,endTime:null,dates:null,creater:null}),h=S([{label:"æ—¥",value:"day"},{label:"å‘¨",value:"week"},{label:"æœˆ",value:"month"}]),T=S("table"),m=S({}),N=S({}),W=ee(()=>Object.keys(m.value||{}).map(t=>{var e,a;return{key:t,name:t,userimage:(a=(e=m.value[t])==null?void 0:e[0])==null?void 0:a.userimage}})),U=ee(()=>{const t=[{title:"ç”¨æˆ·å",key:"name",width:120,align:"center",fixed:"left",render(a){return c("div",{class:"text-blue-600 flex-col items-center font-medium"},[c(Ee,{width:"60",height:"60","preview-disabled":!0,src:a.userimage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png",class:"rounded-md object-cover"},null),c("span",null,[a.name])])}}];let e=[];switch(M.value){case"week":i.value.startTime&&i.value.endTime&&(e=Ce(i.value.startTime,i.value.endTime).map(p=>Y(p)));break;case"month":i.value.monthTime&&(e=De(i.value.monthTime).map(p=>Y(p)));break;case"day":default:i.value.dayTime&&(e=[Y(i.value.dayTime)]);break}return[...t,...e]}),Y=t=>({title:J(t),key:t,width:340,align:"center",render:e=>K(e.name,t)}),J=t=>{const e=new Date(t),a=e.getMonth()+1,p=e.getDate(),k=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()];return`${a}/${p} å‘¨${k}`},K=(t,e)=>{let a;const k=(m.value[t]||[]).filter(r=>r.daytime===e);if(k.length===0)return c("div",{class:"text-gray-400 text-sm"},[F("æ— è®°å½•")]);console.log(k,"dayRecords");const d=k.every(r=>r.dailyReport==1),D=k.every(r=>r.status==0);return c("div",{class:"text-left space-y-1"},[c("div",{class:"flex justify-between px-8px"},[c("div",null,[F("æ‰“å¡çŠ¶æ€ï¼š"),c(ae,{size:"small",type:D?"success":"error"},{default:()=>[D?"æ­£å¸¸":"å¼‚å¸¸"]})]),c(ae,{size:"small",type:d?"success":"error"},{default:()=>[d?"æ—¥æŠ¥å·²æäº¤":"æ—¥æŠ¥æœªæäº¤"]})]),c(ge,{style:"max-height: 250px;",trigger:"none"},Et(a=k.map((r,v)=>c("div",{key:v,class:"tableItem p-1 border-b border-gray-100 last:border-b-0",onClick:()=>g(r,t)},[c("div",{class:"flex justify-between items-center"},[c("div",null,[F("è°ƒè¯•äººï¼š"),c("span",null,[r==null?void 0:r.username])]),c("div",null,[F("å·¥æ—¶ï¼š"),c("span",null,[(r==null?void 0:r.duration)||0,F("å°æ—¶")])])]),c("div",null,[F("é¡¹ç›®åç§°ï¼š "),c("span",null,[(r==null?void 0:r.projectName)||"æš‚æ— é¡¹ç›®"]),F(" ")]),c("div",null,[F("ä¸Šç­æ‰“å¡åœ°å€ï¼š"),c("span",null,[r.nowaddress?r.nowaddress:"æ— "])]),c("div",null,[F("ä¸Šç­æ‰“å¡æ—¶é—´ï¼š"),c("span",null,[r.startTime?r.startTime:"æ— "])]),c("div",null,[F("ä¸Šç­æ‰“å¡è¯¯å·®å€¼ï¼š"),c("span",null,[r.nowdistanse?r.nowdistanse.toFixed(2)+"ç±³":"æ— "])]),c("div",null,[F("ä¸‹ç­æ‰“å¡åœ°å€ï¼š"),c("span",null,[r.nextaddress?r.nextaddress:"æ— "])]),c("div",null,[F("ä¸‹ç­æ‰“å¡æ—¶é—´ï¼š"),c("span",null,[r.endTime||"æ— "])]),c("div",null,[F("ä¸‹ç­æ‰“å¡è¯¯å·®å€¼ï¼š"),c("span",null,[r.nextdistanse?r.nextdistanse.toFixed(2)+"ç±³":"æ— "])])])))?a:{default:()=>[a]})])},C=S(!1),G=S(),f=S(),g=async(t,e)=>{f.value=t,G.value=b.data.find(a=>a.username==e).id,C.value=!0},w=t=>{const e=t.match(/^(\d{4})-(\d{1,2})å‘¨$/);if(!e)return null;const a=Number(e[1]),p=Number(e[2]),k=new Date(a,0,1+(p-1)*7),d=k.getDay(),D=new Date(k);d<=4?D.setDate(k.getDate()-k.getDay()+1):D.setDate(k.getDate()+8-k.getDay());const r=new Date(D);r.setDate(D.getDate()+6);const v=j=>{const Q=j.getFullYear(),ye=String(j.getMonth()+1).padStart(2,"0"),he=String(j.getDate()).padStart(2,"0");return`${Q}-${ye}-${he}`};return{start:v(D),end:v(r)}},$=t=>{m.value={},M.value=t,u()},x=t=>{u(t),y()},u=t=>{switch(M.value){case"week":if(t){const e=w(t);e&&(i.value.startTime=e.start,i.value.endTime=e.end)}break;case"month":i.value.dates=t||i.value.monthTime;break;case"day":default:i.value.dates=t||i.value.dayTime;break}},y=async()=>{var t;try{const e={};i.value.creater&&(e.creater=i.value.creater),M.value==="week"?(e.startTime=i.value.startTime+" 00:00:00",e.endTime=i.value.endTime+" 23:59:59"):M.value==="month"?e.dates=i.value.monthTime:e.dates=i.value.dayTime;const{data:a,error:p}=await Be(e);if(!p){if(JSON.stringify(a)=="{}")return m.value={},N.value={},(t=window.$message)==null?void 0:t.warning("æ— æ•°æ®");m.value=l(a),N.value=a}}catch(e){console.error("æœç´¢è€ƒå‹¤æŠ¥è¡¨å¤±è´¥:",e)}},{pageData:b,getData:q,nextPage:H}=Ue(Ne),Z=async t=>{const e=t.currentTarget,a=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&b.data.length<b.total&&(await H(),await Ie(),setTimeout(()=>{e.scrollTop=a}))},X=S(1),n=async t=>{i.value.creater=t,t||setTimeout(()=>{X.value++},500),y()};re([M,()=>i.value.dates],()=>{if(M.value=="week"&&i.value.weekTime){const t=w(i.value.weekTime);t&&(i.value.startTime=t.start,i.value.endTime=t.end),y()}else(M.value=="month"&&i.value.monthTime||M.value=="day"&&i.value.dayTime)&&y()},{immediate:!0}),ie(()=>{i.value.weekTime=O(),q({usertypes:"2,3"}),y()});const l=t=>{const e={};for(const a in t){const p=new Map;t[a].forEach(r=>{const v=`${r.pid}_${r.ctype}_${r.dbtime}_${r.daytime}_${r.address}`;p.has(v)||p.set(v,r)});const d=Array.from(p.values()).sort((r,v)=>r.daytime===v.daytime?r.dbtime.localeCompare(v.dbtime):r.daytime.localeCompare(v.daytime)),D=[];for(let r=0;r<d.length;r++){const v=d[r],j=d[r+1];v.ctype===0&&j&&j.ctype===1&&v.daytime===j.daytime?(D.push({nowaddress:v.address,nextaddress:j.address,startTime:v.dbtime,endTime:j.dbtime,status:j.status==1||v.status==1?1:j.status,duration:j.duration||0,dailyReport:j.dailyReport,username:v.username,daytime:v.daytime,projectName:v.proname,userImage:v.userimage,ctype:j.ctype,pid:v.pid,nowdistanse:v.distanse,nextdistanse:j.distanse}),r++):D.push({nowaddress:v.address,startTime:v.ctype===0?v.dbtime:"",endTime:v.ctype===1?v.dbtime:"",duration:v.duration||0,status:v.status,dailyReport:v.dailyReport,username:v.username,daytime:v.daytime,projectName:v.proname,userImage:v.userimage,ctype:v.ctype,pid:v.pid,nowdistanse:v.distanse})}e[a]=D}return e};return(t,e)=>{const a=ze,p=Ae,k=be;return E(),B("div",Ct,[c(P(Pe),{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper h-full"},{header:A(()=>[c(P(je),{align:"center"},{default:A(()=>[e[7]||(e[7]=o("div",{class:"font-semibold"},"è€ƒå‹¤æŠ¥è¡¨",-1)),c(p,{label:"ç”¨æˆ·",path:"creater","label-placement":"left","show-feedback":!1},{default:A(()=>[c(a,{clearable:"",filterable:"",value:i.value.creater,"onUpdate:value":[e[0]||(e[0]=d=>i.value.creater=d),n],placeholder:"è¯·é€‰æ‹©","label-field":"username",size:"small","value-field":"id",options:P(b).data,onScroll:Z},null,8,["value","options"])]),_:1}),c(P(oe),{value:M.value,"onUpdate:value":[e[1]||(e[1]=d=>M.value=d),$],size:"small"},{default:A(()=>[(E(!0),B(ue,null,de(h.value,d=>(E(),R(P(te),{key:d.value,value:d.value,label:d.label},null,8,["value","label"]))),128))]),_:1},8,["value"]),M.value==="day"?(E(),R(P(le),{key:0,size:"small","formatted-value":i.value.dayTime,"onUpdate:formattedValue":[e[2]||(e[2]=d=>i.value.dayTime=d),x],type:"date","value-format":"yyyy-MM-dd",style:{width:"140px"}},null,8,["formatted-value"])):L("",!0),M.value==="week"?(E(),R(P(le),{key:1,size:"small","formatted-value":i.value.weekTime,"onUpdate:formattedValue":[e[3]||(e[3]=d=>i.value.weekTime=d),x],type:"week",style:{width:"140px"}},null,8,["formatted-value"])):L("",!0),M.value==="month"?(E(),R(P(le),{key:2,size:"small","formatted-value":i.value.monthTime,"onUpdate:formattedValue":[e[4]||(e[4]=d=>i.value.monthTime=d),x],type:"month","value-format":"yyyy-MM",style:{width:"140px"}},null,8,["formatted-value"])):L("",!0),c(P(ve),{type:"primary",onClick:y,size:"small",class:"w-full sm:w-auto"},{icon:A(()=>[c(k,{class:"text-icon"})]),default:A(()=>[F(" "+z(P(Oe)("common.search")),1)]),_:1}),c(P(oe),{size:"small",value:T.value,"onUpdate:value":e[5]||(e[5]=d=>T.value=d),name:"radiobuttongroup1"},{default:A(()=>[c(P(te),{value:"table",label:"è¡¨æ ¼"}),c(P(te),{value:"map",label:"åœ°å›¾"})]),_:1},8,["value"])]),_:1,__:[7]})]),default:A(()=>[c(Dt,{"dialog-visible":C.value,"onUpdate:dialogVisible":e[6]||(e[6]=d=>C.value=d),lookdetail:f.value,creater:G.value},null,8,["dialog-visible","lookdetail","creater"]),T.value=="table"?(E(),R(P(Se),{key:0,"bottom-bordered":"",bordered:"",columns:U.value,data:W.value,size:"small","flex-height":!P(V).isMobile,"scroll-x":U.value.reduce((d,D)=>d+D.width,0),remote:"","row-key":d=>d.key,class:"h-full",striped:""},null,8,["columns","data","flex-height","scroll-x","row-key"])):(E(),R(et,{trackData:N.value,key:X.value},null,8,["trackData"]))]),_:1})])}}}),Bt=se(St,[["__scopeId","data-v-e97bd6f8"]]);export{Bt as default};
