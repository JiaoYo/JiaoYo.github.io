import{j as R,b as N,k as se,m as ae,d as B,n as K,p as W,u as ne,a as G,q as A,r as D,s as H,v as re,x as F,y as le,o as g,c as U,w as f,g as i,z as X,i as m,$ as h,A as q,f as b,C as V,h as $,t as S,D as ie,E as ce,F as I,G as ue,H as M,I as de,J,K as Q,B as Y,L as Z,M as ee,N as pe,O as me,P as T,Q as fe,R as _e,S as ge,T as we,U as he,V as ve,W as ye,X as xe,Y as ke,e as k,Z as Ce,a0 as Pe,a1 as j,a2 as be}from"./index-CQx2Ff8S.js";function Se(w){const d=R(0),C=N(()=>Math.ceil(d.value/60)),x=N(()=>d.value>0),{pause:t,resume:v}=se(()=>{d.value>0?d.value-=1:t()},{immediate:!1});function n(o=w){d.value=60*o,v()}function e(){d.value=0,t()}return ae(()=>{t()}),{count:C,isCounting:x,start:n,stop:e}}const Le=w=>(pe("data-v-c56f6687"),w=w(),me(),w),Ne={class:"w-full flex-y-center gap-16px"},Ee=["src"],Re={class:"flex-y-center justify-end updatePsd"},Ue=Le(()=>b("div",{style:{display:"flex","justify-content":"right","align-items":"center"}},null,-1)),ze=B({name:"PwdLogin",__name:"pwd-login",props:{status:{type:String,required:!0},statusModifiers:{}},emits:K(["getUsername"],["update:status"]),setup(w,{emit:c}){const d=W(w,"status"),C=c,x=ne();G();const{formRef:t,validate:v}=A(),n=D({username:"",captcha:"",password:""}),e=D({uuid:"",captchaSrc:"",captchaEnable:0,checked:!1});async function o(){const{data:a,error:_}=await ie();_||(e.captchaEnable=a,e.captchaEnable==1&&s())}async function s(){e.uuid=F(),e.captchaSrc=ce+"/captcha?uuid="+e.uuid;const a=F(),_=Date.now().toString(),P=I(`${a}${_}`);ue.get(e.captchaSrc,{headers:{"X-Nonce":a,"X-Timestamp":_,"X-Signature":P},responseType:"blob"}).then(L=>{const z=URL.createObjectURL(L.data);e.captchaSrc=z}).catch(L=>{console.error("Error:",L)})}const l=N(()=>{const{formRules:a}=H();return{username:a.username,captcha:a.captcha,password:a.password1}});async function r(){var _;await v(),e.checked?y(n.username,I(n.password),e.checked):u();const a=await x.login(n.username,n.password,n.captcha.trim(),e.uuid);console.log(a),((_=a==null?void 0:a.data)==null?void 0:_.login)===0?setTimeout(()=>{const P=new CustomEvent("myCustomEvent");document.dispatchEvent(P),M("power-PsdLogin",n.username)},1e3):de("power-PsdLogin"),a=="fail"&&e.captchaEnable==1&&(n.captcha="",s())}const p=()=>{d.value="resetPwd",C("getUsername",n.username)};function y(a,_,P){M("power-prediction_user",a),M("power-prediction_pwd",_),M("power-prediction_check",String(P))}function u(){y("","",!1)}return R(!1),re(()=>{e.uuid=F(),o()}),(a,_)=>{const P=J,L=Q,z=Y,te=Z,oe=ee,O=le("no-space");return g(),U(oe,{ref_key:"formRef",ref:t,model:n,rules:l.value,size:"large","show-label":!1},{default:f(()=>[i(L,{path:"userName"},{default:f(()=>[X(i(P,{autofocus:"",value:n.username,"onUpdate:value":_[0]||(_[0]=E=>n.username=E),placeholder:m(h)("page.login.common.userNamePlaceholder"),onKeyup:q(r,["enter"])},null,8,["value","placeholder"]),[[O]])]),_:1}),i(L,{path:"password"},{default:f(()=>[X(i(P,{value:n.password,"onUpdate:value":_[1]||(_[1]=E=>n.password=E),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:m(h)("page.login.common.passwordPlaceholder"),onKeyup:q(r,["enter"])},null,8,["value","placeholder"]),[[O]])]),_:1}),e.captchaEnable==1?(g(),U(L,{key:0,path:"captcha"},{default:f(()=>[b("div",Ne,[i(P,{value:n.captcha,"onUpdate:value":_[2]||(_[2]=E=>n.captcha=E),placeholder:"请输入验证码",onKeyup:q(r,["enter"])},null,8,["value"]),b("img",{src:e.captchaSrc,alt:"captcha",style:{height:"40px"},onClick:s},null,8,Ee)])]),_:1})):V("",!0),i(te,{vertical:"",size:8},{default:f(()=>[b("div",Re,[i(z,{quaternary:"",onClick:p},{default:f(()=>[$(S("修改密码"))]),_:1})]),i(z,{type:"primary",size:"large",ghost:"",round:"",block:"",loading:m(x).loginLoading,onClick:r},{default:f(()=>[$(S(m(h)("common.confirm")),1)]),_:1},8,["loading"]),Ue]),_:1})]),_:1},8,["model","rules"])}}}),Me=T(ze,[["__scopeId","data-v-c56f6687"]]);function $e(){const{loading:w,startLoading:c,endLoading:d}=fe(),{count:C,start:x,stop:t,isCounting:v}=Se(60),n=N(()=>{let s=h("page.login.codeLogin.getCode");const l=h("page.login.codeLogin.reGetCode",{time:C.value});return w.value&&(s=""),v.value&&(s=l),s});function e(s){var l,r,p,y;return s.trim()===""?((r=(l=window.$message)==null?void 0:l.error)==null||r.call(l,h("form.mobile.required")),!1):ge.test(s)?!0:((y=(p=window.$message)==null?void 0:p.error)==null||y.call(p,h("form.mobile.invalid")),!1)}async function o(s,l){!e(s)||w.value||(c(),await new Promise(p=>{_e(s,l).then(y=>{var u,a;console.log("response",y),y.error||(setTimeout(p,500),(a=(u=window.$message)==null?void 0:u.success)==null||a.call(u,h("page.login.codeLogin.sendCodeSuccess")),x(),d())}).catch(y=>{var u,a;return console.log("error",y),(a=(u=window.$message)==null?void 0:u.error)==null||a.call(u,h("page.login.codeLogin.sendCodeFailed")),!1})}))}return{label:n,start:x,stop:t,isCounting:v,loading:w,getCaptcha:o}}const Ie=B({name:"ResetPwd",__name:"reset-pwd",props:K({username:{type:String,required:!0}},{status:{type:String,required:!0},statusModifiers:{}}),emits:["update:status"],setup(w){const c=W(w,"status"),d=w;G();const{formRef:C,validate:x}=A();$e();const t=D({username:d.username||"",oripwd:"",code:"",password:"",confirmPassword:""}),v=N(()=>{const{formRules:e,createConfirmPwdRule:o,defaultRequiredRule:s}=H();return{username:e.username,oripwd:e.password1,password:[{...s},{asyncValidator:(l,r)=>r==""||r==null?Promise.resolve():we(r)?t.username&&r.toLocaleLowerCase().includes(t.username.toLocaleLowerCase())?Promise.reject("密码禁止与用户名相同或包含用户名(不区分大小写)"):t.password==t.oripwd?Promise.reject("新密码不能与旧密码相同"):Promise.resolve():Promise.reject("密码应符合：大、小写字母、数字、特殊字符的8-18位组合"),trigger:["blur","input"]}],code:e.code,confirmPassword:o(t.password)}});async function n(){var r,p;await x();const e=await I(t.oripwd),o=await I(t.password),{data:s,error:l}=await he(t.username,e,o);console.log("data",s),l?(p=window.$message)==null||p.error("修改失败"):((r=window.$message)==null||r.success("修改成功"),c.value="pwd-login1")}return(e,o)=>{const s=J,l=Q,r=Y,p=Z,y=ee;return g(),U(y,{ref_key:"formRef",ref:C,model:t,rules:v.value,size:"large","show-label":!1},{default:f(()=>[i(l,{path:"username"},{default:f(()=>[i(s,{value:t.username,"onUpdate:value":o[0]||(o[0]=u=>t.username=u),placeholder:m(h)("page.login.common.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1}),i(l,{path:"oripwd"},{default:f(()=>[i(s,{value:t.oripwd,"onUpdate:value":o[1]||(o[1]=u=>t.oripwd=u),type:"password","show-password-on":"click",placeholder:"请输入原密码"},null,8,["value"])]),_:1}),i(l,{path:"password"},{default:f(()=>[i(s,{value:t.password,"onUpdate:value":o[2]||(o[2]=u=>t.password=u),type:"password","show-password-on":"click",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),i(l,{path:"confirmPassword"},{default:f(()=>[i(s,{value:t.confirmPassword,"onUpdate:value":o[3]||(o[3]=u=>t.confirmPassword=u),type:"password","show-password-on":"click",placeholder:m(h)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1}),i(p,{vertical:"",size:18,class:"w-full"},{default:f(()=>[i(r,{type:"primary",size:"large",ghost:"",round:"",block:"",onClick:n},{default:f(()=>[$(S(m(h)("common.confirm")),1)]),_:1}),i(r,{size:"large",ghost:"",round:"",block:"",onClick:o[4]||(o[4]=u=>c.value="pwd-login"),class:"c-#fff"},{default:f(()=>[$(S(m(h)("page.login.common.back")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),je=T(Ie,[["__scopeId","data-v-bca1411f"]]),Fe={class:"w-400px lt-sm:w-300px"},qe={class:"flex-y-center justify-center"},De={key:0,src:j,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},Ve={key:1,src:j,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},Be={key:2,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},Te={key:3,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},Oe={class:"pt-24px"},Xe={class:"pt-16px"},Ke={class:"flex justify-center items-center",style:{position:"fixed",top:"20px",right:"20px","z-index":"999"}},We={key:0,src:j,alt:"Linkqi",class:"w-100px pr-10px"},Ge={key:1,src:j,alt:"Linkqi",class:"w-100px pr-10px"},Ae={key:2,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},He={key:3,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},Je={key:0,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},Qe={key:1,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},Ye=B({name:"login",__name:"index",props:{module:{}},setup(w){ve();const c=ye(),d=R("pwd-login");N(()=>c.darkMode?xe(c.themeColor,600):c.themeColor);const C=R(""),x=e=>{C.value=e},t=N(()=>{const e="#ffffff",o=c.darkMode?.5:.2;return ke(e,c.themeColor,o)}),v=R();return(async()=>{fetch("/version.json").then(e=>e.json()).then(e=>{v.value=e}).catch(e=>{console.error("Error fetching version.json:",e)})})(),(e,o)=>{var l,r;const s=be;return g(),k("div",{class:"relative size-full flex-center overflow-hidden login",style:Pe({backgroundColor:t.value})},[i(s,{bordered:!1,class:"relative z-4 w-auto rd-12px loginClass","content-style":{padding:"24px 36px"}},{default:f(()=>[b("div",Fe,[b("header",qe,[m(c).darkMode?(g(),k("img",Ve)):(g(),k("img",De)),m(c).darkMode?(g(),k("h3",Be,S(m(h)("system.title")),1)):(g(),k("h3",Te,S(m(h)("system.title")),1))]),b("main",Oe,[b("div",Xe,[i(Ce,{name:m(c).page.animateMode,mode:"out-in",appear:""},{default:f(()=>[d.value=="pwd-login"||d.value=="pwd-login1"?(g(),U(Me,{key:0,status:d.value,"onUpdate:status":o[0]||(o[0]=p=>d.value=p),onGetUsername:x},null,8,["status"])):(g(),U(je,{key:1,status:d.value,"onUpdate:status":o[1]||(o[1]=p=>d.value=p),username:C.value},null,8,["status","username"]))]),_:1},8,["name"])])])])]),_:1}),b("div",Ke,[m(c).darkMode?(g(),k("img",Ge)):(g(),k("img",We)),m(c).darkMode?(g(),k("span",Ae,S(((l=v.value)==null?void 0:l.ver)||"V1.1.6"),1)):(g(),k("span",He,S(((r=v.value)==null?void 0:r.ver)||"V1.1.6"),1))]),m(c).darkMode?V("",!0):(g(),k("div",Je," Copyright (c) 2025 · 杭州领祺科技有限公司")),m(c).darkMode?(g(),k("div",Qe," Copyright (c) 2025 · 杭州领祺科技有限公司")):V("",!0)],4)}}}),et=T(Ye,[["__scopeId","data-v-3d33f339"]]);export{et as default};
