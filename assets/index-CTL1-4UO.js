import{_ as Ue}from"./table-column-setting.vue_vue_type_script_setup_true_lang-nNpCY9lJ.js";import{_ as Ce}from"./round-delete-B5av1Q-z.js";import{_ as De}from"./round-add-Dxx1Q5ac.js";import{d as J,aw as E,ay as te,s as pe,x as ce,a as Se,$ as o,v as me,at as fe,y as V,c as j,o as $,w as t,f as a,bh as Re,G as oe,z as Te,A as _e,h as s,D as O,C as ne,au as ge,c0 as $e,aD as ze,N as W,b as we,aT as Me,aX as Be,B as S,g as k,t as x,bj as Fe,c1 as Oe,c2 as je,c3 as Ie,aE as Ve,F as Ge,bi as qe,U as ve,bL as ie,e as Ae,aF as ye,c4 as Ke,bW as Le,M as Ee,r as ee,aO as K,aA as Je,aP as We,az as Xe,c5 as He,c6 as Qe,c7 as Ye,aG as ae,aU as Ze}from"./index-BG16ZifG.js";import{u as ea,a as aa}from"./table-B-6Bq47M.js";import{u as se,d as sa}from"./business-HtFx3oYH.js";import{_ as ta}from"./round-search-0CRuG0ER.js";import{_ as oa}from"./round-refresh-FqTmFNSv.js";import{_ as na}from"./Grid-52o7xY5h.js";import{_ as la}from"./FormItemGridItem-CVMlyKk-.js";import{_ as ra}from"./Tree-Bstfecf5.js";import{h as ue}from"./permission-BDlWMFqK.js";import{N as de}from"./Popconfirm-CW7rsSN1.js";const ia=J({name:"OperateDrawer",__name:"operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(y,{emit:P}){const w=[{label:"是",value:0},{label:"否",value:1}],f=y,U=P,i=te(y,"visible"),{formRef:N,validate:z,restoreValidation:C}=pe(),{createConfirmPwdRule:M,defaultRequiredRule:p,patternRules:u}=ce(),c=Se(()=>({add:o("page.manage.user.addUser"),edit:o("page.manage.user.editUser")})[f.operateType]),n=me(h());function h(){return{id:void 0,username:"",oripwd:"",password:"",confirmPassword:"",usertype:void 0,superadmin:1,userimage:"",phnum:"",udesc:""}}const b={username:p,usertype:{type:"string",required:!0,trigger:"change",message:"请选择用户类型"},oripwd:{...p,...u.password},password:{...p,...u.password},phnum:{...p,...u.mobile}};async function B(){if(Object.assign(n,h()),f.operateType==="edit"&&f.rowData){const{data:D,error:r}=await Oe(f.rowData.id);r?Object.assign(n,f.rowData):(Object.assign(n,D),n.usertype=n.usertype+"")}}function R(){i.value=!1}async function I(){var D,r;if(await z(),f.operateType==="add"){const{data:v,error:_}=await je(n);_||((D=window.$message)==null||D.success(o("common.addSuccess")),R(),U("submitted"))}else{const{data:v,error:_}=await Ie(n);_||((r=window.$message)==null||r.success(o("common.updateSuccess")),R(),U("submitted"))}}return fe(i,()=>{i.value&&(B(),C())}),(D,r)=>{const v=ne,_=_e,F=ge,X=Ve,T=W,G=ze,m=oe,q=S,H=Re,Q=Fe,l=V("no-special");return $(),j(Q,{show:i.value,"onUpdate:show":r[8]||(r[8]=e=>i.value=e),"display-directive":"show",width:360},{default:t(()=>[a(H,{title:c.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[a(T,{size:16},{default:t(()=>[a(q,{onClick:R},{default:t(()=>[k(x(s(o)("common.cancel")),1)]),_:1}),a(q,{type:"primary",onClick:I},{default:t(()=>[k(x(s(o)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[a(m,{ref_key:"formRef",ref:N,model:n,rules:b},{default:t(()=>[a(_,{label:s(o)("page.manage.user.username"),path:"username"},{default:t(()=>[O(a(v,{value:n.username,"onUpdate:value":r[0]||(r[0]=e=>n.username=e),placeholder:s(o)("page.manage.user.form.username"),readonly:f.operateType==="edit"},null,8,["value","placeholder","readonly"]),[[l]])]),_:1},8,["label"]),f.operateType==="edit"?($(),j(_,{key:0,label:s(o)("page.manage.user.administratorPassword"),path:"oripwd"},{default:t(()=>[a(v,{value:n.oripwd,"onUpdate:value":r[1]||(r[1]=e=>n.oripwd=e),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:s(o)("page.manage.user.form.administratorPassword")},null,8,["value","placeholder"])]),_:1},8,["label"])):Te("",!0),a(_,{label:s(o)("page.login.common.password"),path:"password"},{default:t(()=>[a(v,{value:n.password,"onUpdate:value":r[2]||(r[2]=e=>n.password=e),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:s(o)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(_,{label:s(o)("page.login.common.confirmPassword"),path:"confirmPassword",rule:s(M)(n.password)},{default:t(()=>[a(v,{value:n.confirmPassword,"onUpdate:value":r[3]||(r[3]=e=>n.confirmPassword=e),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:s(o)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rule"]),a(_,{label:"用户类型",path:"usertype"},{default:t(()=>[a(F,{value:n.usertype,"onUpdate:value":r[4]||(r[4]=e=>n.usertype=e),clearable:"",filterable:"",placeholder:"请选择用户类型",options:s($e)(n.usertype==0?s(se):s(se).slice(1)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),a(_,{label:"是否为我司内部人员",path:"superadmin"},{default:t(()=>[a(G,{value:n.superadmin,"onUpdate:value":r[5]||(r[5]=e=>n.superadmin=e),name:"radiogroup"},{default:t(()=>[a(T,null,{default:t(()=>[($(),we(Me,null,Be(w,(e,g)=>a(X,{key:g,value:e.value},{default:t(()=>[k(x(e.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])]),_:1}),a(_,{label:"手机号码",path:"phnum"},{default:t(()=>[a(v,{clearable:"",value:n.phnum,"onUpdate:value":r[6]||(r[6]=e=>n.phnum=e),maxlength:11,placeholder:"请输入手机号码"},null,8,["value"])]),_:1}),a(_,{label:"描述",path:"udesc"},{default:t(()=>[a(v,{type:"textarea",clearable:"",value:n.udesc,"onUpdate:value":r[7]||(r[7]=e=>n.udesc=e),placeholder:"请输入描述",autosize:{minRows:3}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ua=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(y,{emit:P}){const w=P,{formRef:f,restoreValidation:U}=pe(),i=te(y,"model");function N(){i.value.username="",w("search")}async function z(){await U(),i.value.usertype=null,i.value.username="",w("reset")}async function C(){w("search")}const M=u=>{i.value.usertype=u,w("search")},p=()=>{i.value.usertype=null,w("search")};return(u,c)=>{const n=ne,h=la,b=ge,B=oa,R=S,I=ta,D=W,r=na,v=oe,_=ve;return $(),j(_,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[a(v,{ref_key:"formRef",ref:f,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ge(C,["enter"])},{default:t(()=>[a(r,{responsive:"screen","item-responsive":""},{default:t(()=>[a(h,{span:"24 s:12 m:6",label:s(o)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:t(()=>[a(n,{clearable:"",value:i.value.username,"onUpdate:value":c[0]||(c[0]=F=>i.value.username=F),valueModifiers:{trim:!0},placeholder:s(o)("page.manage.user.form.username"),onClear:N},null,8,["value","placeholder"])]),_:1},8,["label"]),a(h,{span:"24 s:12 m:6",label:"用户类型",path:"usertype",class:"pr-24px"},{default:t(()=>[a(b,{value:i.value.usertype,"onUpdate:value":[c[1]||(c[1]=F=>i.value.usertype=F),M],clearable:"",placeholder:"请选择用户类型",onClear:p,options:s(qe)(s(se))},null,8,["value","options"])]),_:1}),a(h,{span:"24 s:12 m:6",class:"pr-24px"},{default:t(()=>[a(D,{class:"w-full"},{default:t(()=>[a(R,{onClick:z},{icon:t(()=>[a(B,{class:"text-icon"})]),default:t(()=>[k(" "+x(s(o)("common.reset")),1)]),_:1}),a(R,{type:"primary",ghost:"",onClick:C},{icon:t(()=>[a(I,{class:"text-icon"})]),default:t(()=>[k(" "+x(s(o)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),da=J({name:"assignRoles",__name:"assign-roles",props:E({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(y){const P=y,w=te(y,"visible");function f(){w.value=!1}const U=ie([]),i=async()=>{const{error:p,data:u}=await Le();if(!p){const c=JSON.parse(JSON.stringify(u));U.value=c.list.map(n=>n)}},N=ie([]),z=async(p,u,c)=>{var n;N.value=[(n=c.node)==null?void 0:n.id]};async function C(){var p,u,c;if(P.rowData.id){const{data:n,error:h}=await Ke(P.rowData.id,N.value.join(","));h||((p=window.$message)==null||p.destroyAll(),(c=(u=window.$message)==null?void 0:u.success)==null||c.call(u,o("common.modifySuccess")),f())}}function M(){P.rowData.id&&(i(),N.value=[P.rowData.roleId])}return fe(w,p=>{p&&M()}),(p,u)=>{const c=ra,n=S,h=W,b=ye;return $(),j(b,{show:w.value,"onUpdate:show":u[0]||(u[0]=B=>w.value=B),preset:"card",class:"w-480px"},{header:t(()=>u[1]||(u[1]=[Ae("div",{class:"flex"},"设置用户角色",-1)])),footer:t(()=>[a(h,{justify:"end"},{default:t(()=>[a(n,{size:"small",class:"mt-16px",onClick:f},{default:t(()=>[k(x(s(o)("common.cancel")),1)]),_:1}),a(n,{type:"primary",size:"small",class:"mt-16px",onClick:C},{default:t(()=>[k(x(s(o)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[a(c,{cascade:"","checked-keys":N.value,data:U.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"","label-field":"name","key-field":"id","children-field":"children","onUpdate:checkedKeys":z},null,8,["checked-keys","data"])]),_:1},8,["show"])}}}),pa={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function L(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Ze(y)}const Pa=J({name:"manage_user",__name:"index",setup(y){const P=Ee(),{columns:w,columnChecks:f,data:U,getData:i,loading:N,mobilePagination:z,searchParams:C,resetSearchParams:M}=ea({apiFn:Ye,apiParams:{page:1,pageSize:50,limit:50,username:null,usertype:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"username",title:o("page.manage.user.username"),align:"center",width:160},{key:"usertype",title:"用户类型",align:"center",width:120,render:l=>{const e=o(sa[l.usertype]);return a(ae,{type:"primary"},L(e)?e:{default:()=>[e]})}},{key:"phnum",title:"手机号码",align:"center",width:160},{key:"udesc",title:"描述",align:"center",width:200},{key:"status",title:o("page.manage.user.status"),align:"center",width:180,render:l=>(l.status===null?l.status=0:(l.status===2||l.status===3)&&(l.status=1),a(ae,{type:l.status==0?"success":l.status==1?"error":l.status==2?"warning":"success"},{default:()=>[l.status==0?"正常":l.status==1?"异常":l.status==2?"锁定":"正常"]}))},{key:"superadmin",title:"是否为我司内部人员",align:"center",width:160,render:l=>{const e=l.superadmin===0?"是":l.superadmin===1?"否":"未知",g=l.superadmin===0?"success":l.superadmin===1?"error":"default";return a(ae,{type:g},L(e)?e:{default:()=>[e]})}},{key:"createdate",title:o("page.manage.user.createDate"),align:"center",width:180},{key:"operate",title:o("common.operate"),align:"center",width:ue("sys:user:update")&&ue("sys:user:delete")?320:0,render:l=>{let e;return a("div",{class:"flex-center gap-8px"},[O(a(S,{type:"primary",ghost:!0,size:"small",onClick:()=>r(l.id)},L(e=o("common.edit"))?e:{default:()=>[e]}),[[V("no-auth"),"sys:user:update"]]),O(a(S,{type:"primary",ghost:!0,size:"small",onClick:()=>H(l)},{default:()=>["修改密码"]}),[[V("no-auth"),"sys:user:update"]]),l.superadmin!=0&&a(de,{onPositiveClick:()=>D(l.id)},{default:()=>o("common.confirmDelete"),trigger:()=>{let g;return O(a(S,{type:"error",ghost:!0,size:"small"},L(g=o("common.delete"))?g:{default:()=>[g]}),[[V("no-auth"),"sys:user:delete"]])}})])}}]}),{drawerVisible:p,operateType:u,editingData:c,handleAdd:n,handleEdit:h,checkedRowKeys:b,onBatchDeleted:B,onDeleted:R}=aa(U,i);async function I(){console.log(b.value),v(b.value,l=>{B()})}function D(l){v([l],e=>{R()})}function r(l){h(l)}async function v(l,e){const g=await He(l);console.log("data",g),e&&e(g)}const _=ee(!1),{defaultRequiredRule:F,patternRules:X}=ce(),T=ee(!1),G=ee(),m=me({username:"",password:"",confirmPassword:"",id:null}),q={password:[F,X.password],confirmPassword:[{required:!0,message:o("form.confirmPwd.required")},{asyncValidator:(l,e)=>e.trim()!==""&&e!==m.password?Promise.reject(l.message):Promise.resolve(),message:o("form.confirmPwd.invalid"),trigger:"input"}]},H=l=>{T.value=!0,m.id=l.id,m.username=l.username,m.password="",m.confirmPassword=""},Q=async()=>{var g,A;if(!m.id)return;await((g=G.value)==null?void 0:g.validate());const{data:l,error:e}=await Qe(m.username,m.id,m.password);e||((A=window.$message)==null||A.success("修改成功"),T.value=!1)};return(l,e)=>{const g=De,A=Ce,he=Ue,le=W,be=Je,ke=ve,Y=ne,Z=_e,Ne=oe,xe=Xe,Pe=ye,re=V("no-auth");return $(),we("div",pa,[a(ua,{model:s(C),"onUpdate:model":e[0]||(e[0]=d=>K(C)?C.value=d:null),onReset:s(M),onSearch:s(i)},null,8,["model","onReset","onSearch"]),a(ke,{title:s(o)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[a(le,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[O(($(),j(s(S),{onClick:s(n),size:"small",ghost:"",type:"primary"},{icon:t(()=>[a(g,{class:"text-icon"})]),default:t(()=>[e[10]||(e[10]=k(" "+x("新增")))]),_:1,__:[10]},8,["onClick"])),[[re,"sys:user:insert"]]),a(s(de),{onPositiveClick:I},{trigger:t(()=>[O(($(),j(s(S),{size:"small",ghost:"",type:"error",disabled:s(b).length==0},{icon:t(()=>[a(A,{class:We(["text-icon",{"animate-spin":s(N)}])},null,8,["class"])]),default:t(()=>[e[11]||(e[11]=k(" "+x("批量删除")))]),_:1,__:[11]},8,["disabled"])),[[re,"sys:user:delete"]])]),default:t(()=>[e[12]||(e[12]=k(" 确定要删除选中的吗？ "))]),_:1,__:[12]}),a(he,{columns:s(f),"onUpdate:columns":e[1]||(e[1]=d=>K(f)?f.value=d:null)},null,8,["columns"])]),_:1})]),default:t(()=>[a(be,{"checked-row-keys":s(b),"onUpdate:checkedRowKeys":e[2]||(e[2]=d=>K(b)?b.value=d:null),columns:s(w),data:s(U),size:"small","flex-height":!s(P).isMobile,"scroll-x":962,loading:s(N),remote:"","row-key":d=>d.id,pagination:s(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(ia,{visible:s(p),"onUpdate:visible":e[3]||(e[3]=d=>K(p)?p.value=d:null),"operate-type":s(u),"row-data":s(c),onSubmitted:s(i)},null,8,["visible","operate-type","row-data","onSubmitted"]),a(da,{"row-data":s(c),visible:_.value,"onUpdate:visible":e[4]||(e[4]=d=>_.value=d)},null,8,["row-data","visible"])]),_:1},8,["title"]),a(Pe,{show:T.value,"onUpdate:show":e[9]||(e[9]=d=>T.value=d),title:s(o)("common.updatePassword"),preset:"card",class:"w-620px"},{footer:t(()=>[a(le,{justify:"end",size:16},{default:t(()=>[a(s(S),{onClick:e[8]||(e[8]=d=>T.value=!1)},{default:t(()=>[k(x(s(o)("common.cancel")),1)]),_:1}),a(s(S),{type:"primary",onClick:Q},{default:t(()=>[k(x(s(o)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[a(xe,{class:"max-h-480px pr-20px"},{default:t(()=>[a(Ne,{ref_key:"formRef",ref:G,model:m,rules:q,"label-placement":"left","label-width":100,"require-mark-placement":"left"},{default:t(()=>[a(Z,{label:s(o)("page.manage.user.username"),path:"username"},{default:t(()=>[a(Y,{readonly:"",value:m.username,"onUpdate:value":e[5]||(e[5]=d=>m.username=d),placeholder:s(o)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(Z,{label:s(o)("page.login.common.password"),path:"password"},{default:t(()=>[a(Y,{type:"password","show-password-on":"click",clearable:"",value:m.password,"onUpdate:value":e[6]||(e[6]=d=>m.password=d),placeholder:s(o)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(Z,{label:s(o)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:t(()=>[a(Y,{type:"password","show-password-on":"click",clearable:"",value:m.confirmPassword,"onUpdate:value":e[7]||(e[7]=d=>m.confirmPassword=d),placeholder:s(o)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])])}}});export{Pa as default};
