import{_ as _e}from"./round-add-DC3jKO0K.js";import{d as W,at as J,q as X,v as se,s as re,a as ve,av as ae,bU as ie,e0 as ge,e1 as ye,aw as Q,c as I,o as x,w as t,f as e,G as ne,z as A,A as ce,h as o,az as de,C as V,N as oe,B as z,g as D,t as w,$ as F,aE as be,cn as ue,aH as ee,cq as he,r as K,e2 as we,y as G,bc as xe,D as R,e as v,b as O,T as Se,F as pe,cG as ke,aR as Ce,aV as je,be as De,e3 as Te,e4 as Pe,U as me,cl as ze,M as Ne,i as Ue,aM as Z,cH as Ie,ay as $e,e5 as Me,e6 as Le,aS as Be}from"./index--GDXRx9n.js";import{u as Fe,a as Re}from"./table-B_dvW33V.js";import{u as te}from"./usePageData-GADHvGie.js";import{_ as qe,a as Ee}from"./text-zWUA8Q-w.js";import{N as fe}from"./Popconfirm-qjJSRAua.js";import{_ as He}from"./round-search-6gH5MaEH.js";import{_ as Ve}from"./Grid-BGC0jP0v.js";import{_ as Oe}from"./FormItemGridItem-E0R4IJbx.js";const Ae=W({name:"OperateDrawer",__name:"operate-drawer",props:J({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(k,{emit:L}){const i=X(),N=L,c=k,n=se(y());function y(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null}}const f={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施"}},{pageData:m,getData:$,nextPage:U}=te(ue),b=async l=>{const a=l.currentTarget,r=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&m.data.length<m.total&&(await U(),await ee(),setTimeout(()=>{a.scrollTop=r}))},T=async l=>{l?n.pid=l:n.value.pid=null},B=async()=>{var l,a;if(await $({fuzzy:(l=i.userInfo)==null?void 0:l.pname,page:1}),m.data.length==0)return(a=window.$message)==null?void 0:a.warning("没有项目")},_=()=>{$({page:1})};async function s(){Object.assign(n,y()),await B(),c.pid&&(m.data.forEach(l=>{l.id==c.pid&&(l.disabled=!0)}),n.pid=c.pid),c.operateType==="edit"&&c.rowData&&Object.assign(n,c.rowData)}const{formRef:S,validate:h,restoreValidation:M}=re(),q=ve(()=>({add:"新增项目总结",edit:"修改项目总结"})[c.operateType]),C=ae(k,"visible"),p=()=>{C.value=!1},d=ie.debounce(async()=>{var l,a;if(await h(),c.operateType==="edit"){const{data:r,error:u}=await ge([{...n}]);u||((l=window.$message)==null||l.success("修改成功"),N("submitted"),p())}else{const{data:r,error:u}=await ye([{pid:n.pid,content1:n.content1,content2:n.content2,content3:n.content3,content4:n.content4,content5:n.content5}]);u||((a=window.$message)==null||a.success("添加成功"),N("submitted"),p())}},1e3,{leading:!0,trailing:!1});return Q(C,()=>{C.value&&(s(),setTimeout(()=>{const l=document.querySelector(".n-scrollbar-content");l==null||l.scrollTo(0,0)},300),M())}),(l,a)=>{const r=ce,u=ne,j=oe,E=be;return x(),I(E,{show:C.value,"onUpdate:show":a[6]||(a[6]=g=>C.value=g),title:q.value,preset:"card",class:"w-570px"},{footer:t(()=>[e(j,{justify:"end"},{default:t(()=>[e(o(z),{size:"small",class:"mt-16px",onClick:p},{default:t(()=>[D(w(o(F)("common.cancel")),1)]),_:1}),e(o(z),{type:"primary",size:"small",class:"mt-16px",onClick:o(d)},{default:t(()=>[D(w(o(F)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(u,{ref_key:"formRef",ref:S,model:n,rules:f},{default:t(()=>[c.operateType==="add"?(x(),I(r,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:t(()=>[e(o(de),{clearable:"",filterable:"",value:n.pid,"onUpdate:value":[a[0]||(a[0]=g=>n.pid=g),T],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:_,options:o(m).data,onScroll:b},null,8,["value","options"])]),_:1})):A("",!0),e(r,{label:"前期准备阶段描述",path:"content1"},{default:t(()=>[e(o(V),{clearable:"",type:"textarea",value:n.content1,"onUpdate:value":a[1]||(a[1]=g=>n.content1=g),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),e(r,{label:"遇到问题及对项目的影响",path:"content2"},{default:t(()=>[e(o(V),{clearable:"",type:"textarea",value:n.content2,"onUpdate:value":a[2]||(a[2]=g=>n.content2=g),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),e(r,{label:"经验教训与改进方案或措施",path:"content3"},{default:t(()=>[e(o(V),{clearable:"",type:"textarea",value:n.content3,"onUpdate:value":a[3]||(a[3]=g=>n.content3=g),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(r,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:t(()=>[e(o(V),{clearable:"",type:"textarea",value:n.content4,"onUpdate:value":a[4]||(a[4]=g=>n.content4=g),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(r,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:t(()=>[e(o(V),{clearable:"",type:"textarea",value:n.content5,"onUpdate:value":a[5]||(a[5]=g=>n.content5=g),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ge={class:"mt-4 border-t pt-3"},Ke={class:"flex items-start gap-2 mb-3"},Je={class:"ml-2 flex-1"},Qe={class:"flex items-center"},We={class:"font-medium font-size-16px font-bold"},Xe={class:"text-gray-600 mt-1"},Ye=W({name:"drawerLog",__name:"drawerLog",props:J({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(k){const L=X();he();const i=se({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""}),N=k,c={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},n=K({});async function y(){f.value=[],Object.assign(i,N.rowData),b()}const f=K([]),m=ae(k,"visible");Q(m,()=>{m.value?y():(f.value=[],i.id=void 0)});function $(_){_||U()}function U(){m.value=!1}const b=async()=>{const{data:_,error:s}=await Te({page:1,limit:100,pid:i.id});_&&(f.value=_.list)},T=ie.debounce(async()=>{var h;const _=n.value[i.id];if(!(_!=null&&_.trim()))return(h=window.$message)==null?void 0:h.warning("请输入评论内容");const{data:s,error:S}=await we([{pid:i.id,content:_}]);s&&(n.value[i.id]="",i.num++,b())},1e3,{leading:!0,trailing:!1}),B=async _=>{var h;const{data:s,error:S}=await Pe(_.id);s&&(b(),i.num--,(h=window.$message)==null||h.success("删除成功"))};return(_,s)=>{const S=ce,h=ne,M=qe,q=Ee,C=xe,p=De,d=G("i"),l=G("no-auth");return x(),I(p,{show:m.value,"onUpdate:show":[s[1]||(s[1]=a=>m.value=a),$],"display-directive":"show",width:600,onMaskClick:U,onEsc:U},{default:t(()=>[e(C,{title:i.username+"的项目总结","native-scrollbar":!1,closable:""},{default:t(()=>[e(h,{ref:"formRef",model:i},{default:t(()=>[e(S,{label:"",path:"contractname"},{label:t(()=>s[2]||(s[2]=[v("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:t(()=>[v("span",null,w(i.proname),1)]),_:1}),e(S,{label:"前期准备阶段描述",path:"content1"},{label:t(()=>s[3]||(s[3]=[v("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:t(()=>[v("span",null,w(i.content1),1)]),_:1}),e(S,{label:"遇到问题及对项目的影响",path:"content2"},{label:t(()=>s[4]||(s[4]=[v("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:t(()=>[v("span",null,w(i.content2),1)]),_:1}),e(S,{label:"经验教训与改进方案或措施",path:"content3"},{label:t(()=>s[5]||(s[5]=[v("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:t(()=>[v("span",null,w(i.content3),1)]),_:1}),e(S,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:t(()=>s[6]||(s[6]=[v("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:t(()=>[v("span",null,w(i.content4),1)]),_:1}),e(S,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:t(()=>s[7]||(s[7]=[v("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:t(()=>[v("span",null,w(i.content5),1)]),_:1})]),_:1},8,["model"]),R((x(),O("div",null,[D(w(i.num)+"评论",1)])),[[d,i.num]]),e(Se,{name:"fade"},{default:t(()=>[v("div",Ge,[R((x(),O("div",Ke,[v("div",null,[e(M,{size:"small",src:c.avatar},null,8,["src"])]),e(o(V),{type:"textarea",id:`comment-input-${i.id}`,value:n.value[i.id],"onUpdate:value":s[0]||(s[0]=a=>n.value[i.id]=a),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:pe(ke(o(T),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),e(o(z),{type:"primary",ghost:"",onClick:o(T)},{default:t(()=>s[8]||(s[8]=[D("发送")])),_:1,__:[8]},8,["onClick"])])),[[l,"project:Summary:Comment:insert"]]),(x(!0),O(Ce,null,je(f.value,a=>(x(),O("div",{key:a.id,class:"flex mb-3"},[e(M,{size:"small",src:c.avatar},null,8,["src"]),v("div",Je,[v("div",Qe,[v("span",We,w(a.username),1),e(q,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:t(()=>[D(w(a.dbtime),1)]),_:2},1024),o(L).userInfo.id==a.creater?(x(),I(o(fe),{key:0,onPositiveClick:r=>B(a)},{trigger:t(()=>[R((x(),I(o(z),{quaternary:"",type:"error",size:"small"},{default:t(()=>s[9]||(s[9]=[D(" 删除 ")])),_:1,__:[9]})),[[l,"project:Summary:Comment:delete"]])]),default:t(()=>[s[10]||(s[10]=D(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):A("",!0)]),v("div",Xe,w(a.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ze=W({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search","clear"],["update:model"]),setup(k,{emit:L}){const i=L,{formRef:N}=re(),c=ae(k,"model"),n=X(),y=K([]),{pageData:f,getData:m,nextPage:$}=te(ue),U=async p=>{const d=p.currentTarget,l=d.scrollTop;d.scrollTop+d.offsetHeight>=d.scrollHeight&&f.data.length<f.total&&(await $(),y.value=f.data,await ee(),setTimeout(()=>{d.scrollTop=l}))},{pageData:b,getData:T,nextPage:B}=te(ze),_=async p=>{const d=p.currentTarget,l=d.scrollTop;d.scrollTop+d.offsetHeight>=d.scrollHeight&&b.data.length<b.total&&(await B(),y.value=b.data,await ee(),setTimeout(()=>{d.scrollTop=l}))},s=async p=>{c.value.creater=p,i("search")},S=async p=>{var d;p?(c.value.pid=p,i("search"),n.setProjectInfo({pname:(d=y.value.find(l=>l.id==p))==null?void 0:d.proname,pid:p})):i("search")},h=async p=>{await m({fuzzy:p,page:1}),y.value=f.data},M=async()=>{await m({page:1}),y.value=f.data};(async()=>{var p,d;await m({fuzzy:n.userInfo.pname}),y.value=f.data,c.value.pid=n.userInfo.pid?n.userInfo.pid:(p=y.value[0])==null?void 0:p.id,n.setProjectInfo({pid:c.value.pid,pname:(d=y.value.find(l=>l.id==c.value.pid))==null?void 0:d.proname}),i("search")})(),T({usertypes:"0,1,2,3,4"});async function C(){i("search")}return(p,d)=>{const l=de,a=Oe,r=He,u=z,j=oe,E=Ve,g=ne,Y=me;return x(),I(Y,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(g,{ref_key:"formRef",ref:N,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:pe(C,["enter"])},{default:t(()=>[e(E,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(a,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:t(()=>[e(l,{filterable:"",clearable:"",value:c.value.pid,"onUpdate:value":[d[0]||(d[0]=H=>c.value.pid=H),S],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:y.value,onScroll:U,onClear:M,onSearch:h},null,8,["value","options"])]),_:1}),e(a,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:t(()=>[e(l,{clearable:"",filterable:"",value:c.value.creater,"onUpdate:value":[d[1]||(d[1]=H=>c.value.creater=H),s],placeholder:"请选择","label-field":"username","value-field":"id",options:o(b).data,onScroll:_},null,8,["value","options"])]),_:1}),e(a,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(j,{class:"w-full"},{default:t(()=>[e(u,{type:"primary",ghost:"",onClick:C},{icon:t(()=>[e(r,{class:"text-icon"})]),default:t(()=>[D(" "+w(o(F)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),et={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},tt={key:0};function le(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!Be(k)}const ut=W({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(k,{emit:L}){const i=Ne(),N=X(),c=k,n=L,{columns:y,data:f,getData:m,loading:$,mobilePagination:U,searchParams:b}=Fe({showTotal:!0,immediate:!1,apiFn:Me,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:r=>e("div",null,[r.username+"的项目总结"])},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:F("common.operate"),align:"center",width:140,fixed:"right",render:r=>{let u;return e("div",{class:"flex-center gap-8px"},[e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>l(r)},{default:()=>[D("查看详情")]}),N.userInfo.id==r.creater&&R(e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>C(r.id)},le(u=F("common.edit"))?u:{default:()=>[u]}),[[G("no-auth"),"project:Summary:update"]]),N.userInfo.id==r.creater&&e(fe,{onPositiveClick:()=>q(r.id)},{default:()=>F("common.confirmDelete"),trigger:()=>{let j;return R(e(z,{type:"error",ghost:!0,size:"small"},le(j=F("common.delete"))?j:{default:()=>[j]}),[[G("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:T,operateType:B,editingData:_,handleAdd:s,handleEdit:S,checkedRowKeys:h,onDeleted:M}=Re(f,m);async function q(r){const{data:u,error:j}=await Le(r);j||M()}function C(r){S(r)}const p=K(!1),d=K({}),l=r=>{p.value=!0,d.value=r},a=()=>{m()};return Q(()=>c.pid,async r=>{r&&(b.pid=r,await m())}),Q(()=>f.value,async r=>{r.length>0?n("thereIsData",1):n("thereIsData",0)}),Ue(()=>{c.type!="externalLiaison"&&m()}),(r,u)=>{const j=oe,E=_e,g=$e,Y=me,H=G("no-auth");return x(),O("div",et,[c.pid?A("",!0):(x(),I(Ze,{key:0,model:o(b),"onUpdate:model":u[0]||(u[0]=P=>Z(b)?b.value=P:null),onReset:a,onSearch:o(m),onClear:u[1]||(u[1]=P=>f.value=[])},null,8,["model","onSearch"])),e(Y,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Ie({header:t(()=>[e(j,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[c.pid?A("",!0):(x(),O("div",tt,"项目总结"))]),_:1}),c.pid?R((x(),I(o(z),{key:0,onClick:o(s),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(E,{class:"text-icon"})]),default:t(()=>[u[5]||(u[5]=D(" "+w("新增")))]),_:1,__:[5]},8,["onClick"])),[[H,"project:Summary:insert"]]):A("",!0)]),default:t(()=>[e(g,{"checked-row-keys":o(h),"onUpdate:checkedRowKeys":u[2]||(u[2]=P=>Z(h)?h.value=P:null),columns:o(y),data:o(f),size:"small","flex-height":!o(i).isMobile,loading:o($),remote:"","row-key":P=>P.id,pagination:o(U),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ae,{visible:o(T),"onUpdate:visible":u[3]||(u[3]=P=>Z(T)?T.value=P:null),onSubmitted:o(m),"operate-type":o(B),pid:c.pid||o(b).pid,"row-data":o(_)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),e(Ye,{visible:p.value,"onUpdate:visible":u[4]||(u[4]=P=>p.value=P),"row-data":d.value},null,8,["visible","row-data"])]),_:2},[c.pid?void 0:{name:"header-extra",fn:t(()=>[e(j,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[R((x(),I(o(z),{onClick:o(s),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(E,{class:"text-icon"})]),default:t(()=>[u[6]||(u[6]=D(" "+w("新增")))]),_:1,__:[6]},8,["onClick"])),[[H,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{ut as _};
