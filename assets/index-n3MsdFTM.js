import{_ as me}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Dg__PXp0.js";import{_ as fe}from"./round-delete-CojfW_rY.js";import{_ as _e}from"./round-add-CcJ-eWvp.js";import{d as Y,aE as K,m as ee,r as ge,H as te,n as ae,a as he,aG as oe,aC as ve,bY as ne,cy as ye,cz as we,c as I,o as V,w as o,f as e,a0 as be,C as le,h as n,aD as se,x as O,z as Z,B as T,g as z,t as D,$ as k,a1 as ke,cs as re,aO as ie,A as Ce,Z as ce,aS as xe,i as Se,q as E,b as Te,aT as G,aH as ze,y as H,aU as je,e as De,cA as Q,cr as Ne,aY as Pe}from"./index-CbkGmsUT.js";import{u as Ue,a as $e}from"./table-CST65CZ1.js";import{u as pe}from"./usePageData-CtVI6YRj.js";import{_ as ue}from"./Grid-CyaoSB-i.js";import{_ as de}from"./FormItemGridItem-D8sOQ-r2.js";import{_ as Be}from"./round-search-opoHbQsz.js";import{_ as Fe}from"./round-refresh-BzOWd9gI.js";import{N as W}from"./Popconfirm-CfoHIMzd.js";const Me=Y({name:"OperateDrawer",__name:"operate-drawer",props:K({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(v,{emit:N}){const m=N;ee();const f=v,s=ge(i());function i(){return{pid:void 0,id:"",pname:"",pcontact:"",proposition:"",docker:""}}const b=te([]),{pageData:d,getData:_,nextPage:h}=pe(re),C=async u=>{const a=u.currentTarget,t=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&d.data.length<d.total&&(await h(),b.value=d.data,await ie(),setTimeout(()=>{a.scrollTop=t}))},P=async()=>{await _({page:1}),b.value=d.data},U=async()=>{await _({page:1}),b.value=d.data},$=async u=>{s.pid=u};async function B(){P(),Object.assign(s,i()),f.operateType==="edit"&&f.rowData&&Object.assign(s,f.rowData)}const{formRef:g,validate:A,restoreValidation:F}=ae(),M={pid:{type:"number",required:!1,trigger:["blur","change"],message:"请选择"},pname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},pcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},j=he(()=>({add:"新增联系人",edit:"修改联系人"})[f.operateType]),l=oe(v,"visible");ve(l,()=>{l.value&&(B(),setTimeout(()=>{const u=document.querySelector(".n-scrollbar-content");u==null||u.scrollTo(0,0)},300),F())});function r(){l.value=!1}const y=ne.debounce(async()=>{await x()},1e3,{leading:!0,trailing:!1});async function x(){var u,a;if(await A(),f.operateType==="edit"){const{data:t,error:c}=await ye([s]);c||(r(),m("submitted"),(u=window.$message)==null||u.success("修改成功"))}else{const{data:t,error:c}=await we([{...s}]);c||(r(),m("submitted"),(a=window.$message)==null||a.success("添加成功"))}}return(u,a)=>{const t=de,c=ue,S=le,R=be,q=Z,L=ke;return V(),I(L,{show:l.value,"onUpdate:show":a[5]||(a[5]=p=>l.value=p),title:j.value,preset:"card",class:"w-500px","mask-closable":!1,draggable:!0},{footer:o(()=>[e(q,{justify:"end",size:16},{default:o(()=>[e(n(T),{onClick:r},{default:o(()=>[z(D(n(k)("common.cancel")),1)]),_:1}),e(n(T),{type:"primary",onClick:n(y)},{default:o(()=>[z(D(n(k)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:o(()=>[e(R,{class:"pr-20px"},{default:o(()=>[e(S,{ref_key:"formRef",ref:g,model:s,rules:M,"label-placement":"left","label-width":120},{default:o(()=>[e(c,{responsive:"screen","item-responsive":""},{default:o(()=>[e(t,{span:"24 m:24",label:"项目",path:"pid"},{default:o(()=>[e(n(se),{clearable:"",filterable:"",value:s.pid,"onUpdate:value":[a[0]||(a[0]=p=>s.pid=p),$],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:U,options:b.value,onScroll:C},null,8,["value","options"])]),_:1}),e(t,{span:"24 m:24",label:"对接方",path:"docker"},{default:o(()=>[e(n(O),{value:s.docker,"onUpdate:value":a[1]||(a[1]=p=>s.docker=p),placeholder:"请输入"},null,8,["value"])]),_:1}),e(t,{span:"24 m:24",label:"姓名",path:"pname"},{default:o(()=>[e(n(O),{value:s.pname,"onUpdate:value":a[2]||(a[2]=p=>s.pname=p),placeholder:"请输入"},null,8,["value"])]),_:1}),e(t,{span:"24 m:24",label:"联系方式",path:"pcontact"},{default:o(()=>[e(n(O),{value:s.pcontact,"onUpdate:value":a[3]||(a[3]=p=>s.pcontact=p),placeholder:"请输入"},null,8,["value"])]),_:1}),e(t,{span:"24 m:24",label:"备注",path:"proposition"},{default:o(()=>[e(n(O),{value:s.proposition,"onUpdate:value":a[4]||(a[4]=p=>s.proposition=p),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Re=Y({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search","clear"],["update:model"]),setup(v,{emit:N}){const m=N,{formRef:f,restoreValidation:s}=ae(),i=oe(v,"model"),b=ee(),d=te([]),{pageData:_,getData:h,nextPage:C}=pe(re),P=async l=>{const r=l.currentTarget,y=r.scrollTop;r.scrollTop+r.offsetHeight>=r.scrollHeight&&_.data.length<_.total&&(await C(),d.value=_.data,await ie(),setTimeout(()=>{r.scrollTop=y}))},U=async l=>{var r;l?(i.value.pid=l,m("search"),b.setProjectInfo({pname:(r=d.value.find(y=>y.id==l))==null?void 0:r.proname,pid:l})):m("clear")},$=ne.debounce(async l=>{await h({fuzzy:l,page:1}),d.value=_.data},300),B=l=>{if(!l){i.value.pid=null,g();return}$(l)},g=async()=>{await h({page:1}),d.value=_.data};(async()=>{await h({page:1}),d.value=_.data,m("search")})();async function F(){await s(),i.value.fuzzy="",m("reset")}const M=()=>{i.value.fuzzy="",m("search")};async function j(){var l,r;i.value.pid?m("search"):((l=window.$message)==null||l.destroyAll(),(r=window.$message)==null||r.warning("请选择项目"))}return(l,r)=>{const y=se,x=de,u=O,a=Fe,t=T,c=Be,S=Z,R=ue,q=le,L=ce;return V(),I(L,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[e(q,{ref_key:"formRef",ref:f,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ce(j,["enter"])},{default:o(()=>[e(R,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[e(x,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:o(()=>[e(y,{filterable:"",clearable:"",value:i.value.pid,"onUpdate:value":[r[0]||(r[0]=p=>i.value.pid=p),U],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:d.value,onScroll:P,onClear:g,onSearch:B},null,8,["value","options"])]),_:1}),e(x,{span:"24 s:12 m:6",label:"姓名",path:"fuzzy"},{default:o(()=>[e(u,{value:i.value.fuzzy,"onUpdate:value":r[1]||(r[1]=p=>i.value.fuzzy=p),placeholder:"请输入",clearable:"",onClear:M},null,8,["value"])]),_:1}),e(x,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[e(S,{class:"w-full"},{default:o(()=>[e(t,{onClick:F},{icon:o(()=>[e(a,{class:"text-icon"})]),default:o(()=>[z(" "+D(n(k)("common.reset")),1)]),_:1}),e(t,{type:"primary",ghost:"",onClick:j},{icon:o(()=>[e(c,{class:"text-icon"})]),default:o(()=>[z(" "+D(n(k)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function X(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Pe(v)}const Je=Y({name:"projectmanagement_contact",__name:"index",setup(v){const N=xe(),{columns:m,columnChecks:f,data:s,getData:i,pagination:b,loading:d,mobilePagination:_,searchParams:h}=Ue({showTotal:!0,immediate:!1,apiFn:Ne,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"proname",title:"项目名称",align:"center",width:120},{key:"docker",title:"对接方",align:"center",width:120},{key:"pname",title:"姓名",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pcontact",title:"联系方式",align:"center",width:120},{key:"proposition",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:k("common.operate"),align:"center",width:140,fixed:"right",render:a=>{let t;return e("div",{class:"flex-center gap-8px"},[H(e(T,{type:"primary",ghost:!0,size:"small",onClick:()=>l(a.id)},X(t=k("common.edit"))?t:{default:()=>[t]}),[[E("no-auth"),"project:Contact:update"]]),e(W,{onPositiveClick:()=>j(a.id)},{default:()=>k("common.confirmDelete"),trigger:()=>{let c;return H(e(T,{type:"error",ghost:!0,size:"small"},X(c=k("common.delete"))?c:{default:()=>[c]}),[[E("no-auth"),"project:Contact:delete"]])}})])}}]}),{drawerVisible:C,operateType:P,editingData:U,handleAdd:$,handleEdit:B,checkedRowKeys:g,onBatchDeleted:A,onDeleted:F}=$e(s,i);Se(async()=>{});async function M(){console.log(g.value),r(g.value.join(","),a=>{A()})}async function j(a){const{data:t,error:c}=await Q(a);c||F()}function l(a){B(a)}async function r(a,t){const{data:c,error:S}=await Q(a);if(!S)t&&t(c);else return!1}const y=a=>{i()},x=()=>{s.value=[],b.itemCount=0},u=()=>{i()};return(a,t)=>{const c=Z,S=_e,R=fe,q=me,L=ze,p=ce,J=E("no-auth");return V(),Te("div",qe,[e(Re,{model:n(h),"onUpdate:model":t[0]||(t[0]=w=>G(h)?h.value=w:null),onReset:u,onSearch:n(i),onClear:x},null,8,["model","onSearch"]),e(p,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[e(c,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>t[4]||(t[4]=[De("div",null,"项目联系人",-1)])),_:1,__:[4]})]),"header-extra":o(()=>[e(c,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[H((V(),I(n(T),{onClick:n($),size:"small",ghost:"",type:"primary"},{icon:o(()=>[e(S,{class:"text-icon"})]),default:o(()=>[t[5]||(t[5]=z(" "+D("新增")))]),_:1,__:[5]},8,["onClick"])),[[J,"project:Contact:insert"]]),e(n(W),{onPositiveClick:M},{trigger:o(()=>[H((V(),I(n(T),{size:"small",ghost:"",type:"error",disabled:n(g).length==0},{icon:o(()=>[e(R,{class:je(["text-icon",{"animate-spin":n(d)}])},null,8,["class"])]),default:o(()=>[t[6]||(t[6]=z(" "+D("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[J,"project:Contact:delete"]])]),default:o(()=>[t[7]||(t[7]=z(" 确定要删除选中的联系人吗？ "))]),_:1,__:[7]}),e(q,{columns:n(f),"onUpdate:columns":t[1]||(t[1]=w=>G(f)?f.value=w:null)},null,8,["columns"])]),_:1})]),default:o(()=>[e(L,{"checked-row-keys":n(g),"onUpdate:checkedRowKeys":t[2]||(t[2]=w=>G(g)?g.value=w:null),columns:n(m),data:n(s),size:"small","flex-height":!n(N).isMobile,loading:n(d),remote:"","row-key":w=>w.id,pagination:n(_),class:"sm:h-full","onUpdate:filters":y},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Me,{visible:n(C),"onUpdate:visible":t[3]||(t[3]=w=>G(C)?C.value=w:null),onSubmitted:n(i),pid:n(h).pid,"operate-type":n(P),"row-data":n(U)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{Je as default};
