import{_ as le}from"./round-delete-DDXstZni.js";import{_ as se}from"./round-add-CDuxp0E4.js";import{d as G,av as V,D as re,A as J,a as ie,ax as Q,at as ce,F as R,c as M,o as T,w as t,f as e,a3 as ue,M as W,G as de,I as P,h as n,H as X,au as Y,J as O,B as k,g as D,t as S,$ as y,a4 as me,bi as pe,bj as _e,bk as fe,s as ge,L as he,a2 as Z,aR as A,aI as ve,b as be,aK as I,ay as ye,aL as we,e as xe,bl as K,bm as Ce,aD as ke,aQ as De}from"./index-CddQmI-c.js";import{u as Ne,a as Te}from"./table-DDoF-sKE.js";import{_ as ee}from"./Grid-CG_YWdVR.js";import{_ as te}from"./FormItemGridItem-CBPP8HMS.js";import{_ as Se}from"./round-search-DnVu2ZZt.js";import{_ as ze}from"./round-refresh-BklTS0D6.js";import{_ as je}from"./DatePicker-D516kcb4.js";import{h as L}from"./permission-C3pQCx4P.js";import{N as E}from"./Popconfirm-CkfL-ZaH.js";const $e=G({name:"OperateDrawer",__name:"operate-drawer",props:V({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(f,{emit:z}){const g=z,p=f,r=re(i());function i(){return{id:0,connum:"",edbtime:void 0,execute:void 0}}async function j(){Object.assign(r,i()),p.operateType==="edit"&&p.rowData&&Object.assign(r,p.rowData)}const{formRef:w,validate:h,restoreValidation:N}=J(),$={connum:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},execute:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},edbtime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"}},x=ie(()=>({add:"新增合同变更",edit:"修改合同变更"})[p.operateType]),o=Q(f,"visible");ce(o,()=>{o.value&&(j(),setTimeout(()=>{const c=document.querySelector(".n-scrollbar-content");c==null||c.scrollTo(0,0)},300),N())});function l(){o.value=!1}async function U(){var c;await h(),(c=window.$dialog)==null||c.info({title:"提示",content:"提交后即时执行,不可回滚是否继续?",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await v()}})}async function v(){var c,m;if(await h(),p.operateType==="edit"){const{data:b,error:_}=await pe([r]);_||(l(),g("submitted"),(c=window.$message)==null||c.success("修改成功"))}else{const{data:b,error:_}=await _e([{...r}]);_||(l(),g("submitted"),(m=window.$message)==null||m.success("添加成功"))}}return(c,m)=>{const b=te,_=ee,B=W,F=ue,s=O,a=me,d=R("no-space");return T(),M(a,{show:o.value,"onUpdate:show":m[2]||(m[2]=u=>o.value=u),title:x.value,preset:"card",class:"w-600px"},{footer:t(()=>[e(s,{justify:"end",size:16},{default:t(()=>[e(n(k),{onClick:l},{default:t(()=>[D(S(n(y)("common.cancel")),1)]),_:1}),e(n(k),{type:"primary",onClick:U},{default:t(()=>[D(S(n(y)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(F,{class:"pr-20px"},{default:t(()=>[e(B,{ref_key:"formRef",ref:w,model:r,rules:$,"label-placement":"left","label-width":120},{default:t(()=>[e(_,{responsive:"screen","item-responsive":""},{default:t(()=>[e(b,{span:"24 m:24",label:"合同编号",path:"connum"},{default:t(()=>[P(e(n(X),{value:r.connum,"onUpdate:value":m[0]||(m[0]=u=>r.connum=u),placeholder:"请输入"},null,8,["value"]),[[d]])]),_:1}),p.operateType=="edit"?(T(),M(b,{key:0,span:"24 m:24",label:"执行状态",path:"execute"},{default:t(()=>[e(n(Y),{filterable:"",options:[{label:"未执行",value:0},{label:"执行成功",value:1},{label:"未执失败",value:2}],clearable:"",value:r.execute,"onUpdate:value":m[1]||(m[1]=u=>r.execute=u)},null,8,["value"])]),_:1})):de("",!0)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ue=G({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:V(["reset","search"],["update:model"]),setup(f,{emit:z}){fe();const g=z,{formRef:p,restoreValidation:r}=J(),i=Q(f,"model"),j={当日:()=>{const o=new Date().getTime();return[o,o]},本周:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*7,o]},上月:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*30,o]},近一年:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*365,o]},近三年:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*365*3,o]}};function w(){i.value.fuzzy="",g("search")}async function h(){await r(),g("reset")}const N=ge(null);async function $(o,l){l?(i.value.startTime=String(A(0,l[0])),i.value.endTime=String(A(0,l[1]))):(i.value.startTime=null,i.value.endTime=null),g("search")}async function x(){g("search")}return(o,l)=>{const U=X,v=te,c=Y,m=je,b=ze,_=k,B=Se,F=O,s=ee,a=W,d=Z;return T(),M(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(a,{ref_key:"formRef",ref:p,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:he(x,["enter"])},{default:t(()=>[e(s,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(v,{span:"24 s:12 m:6",label:"名称",path:"fuzzy"},{default:t(()=>[e(U,{clearable:"",value:i.value.fuzzy,"onUpdate:value":l[0]||(l[0]=u=>i.value.fuzzy=u),placeholder:"请输入名称",onClear:w},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:4",label:"执行状态",path:"execute"},{default:t(()=>[e(c,{clearable:"",filterable:"",value:i.value.execute,"onUpdate:value":[l[1]||(l[1]=u=>i.value.execute=u),x],placeholder:"请选择执行状态",options:[{label:"未执行",value:0},{label:"执行成功",value:1},{label:"未执失败",value:2}]},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:t(()=>[e(m,{value:N.value,"onUpdate:value":l[2]||(l[2]=u=>N.value=u),type:"daterange",clearable:"",class:"w-100%",shortcuts:j,"onUpdate:formattedValue":$},null,8,["value"])]),_:1}),e(v,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(F,{class:"w-full"},{default:t(()=>[e(_,{onClick:h},{icon:t(()=>[e(b,{class:"text-icon"})]),default:t(()=>[D(" "+S(n(y)("common.reset")),1)]),_:1}),e(_,{type:"primary",ghost:"",onClick:x},{icon:t(()=>[e(B,{class:"text-icon"})]),default:t(()=>[D(" "+S(n(y)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function H(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!De(f)}const Le=G({name:"manage_contractamendment",__name:"index",setup(f){const z=ve(),{columns:g,data:p,getData:r,loading:i,mobilePagination:j,searchParams:w}=Ne({showTotal:!0,apiFn:Ce,apiParams:{page:1,pageSize:20,limit:20,execute:void 0,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"connum",title:"合同编号",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"execute",title:"执行状态",align:"center",width:120,render:s=>e(ke,{type:s.execute==0?"warning":s.execute==1?"success":"error",round:!0},{default:()=>[s.execute==0?"未执行":s.execute==1?"执行成功":"执行失败"]})},{key:"edbtime",title:"执行时间",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:y("common.operate"),align:"center",width:L("project:Change:Contract:update")||L("project:Change:Contract:delete")?140:0,fixed:"right",render:s=>{let a;return e("div",{class:"flex-center gap-8px"},[P(e(k,{type:"primary",ghost:!0,size:"small",onClick:()=>b(s.id)},H(a=y("common.edit"))?a:{default:()=>[a]}),[[R("no-auth"),"project:Change:Contract:update"]]),e(E,{onPositiveClick:()=>m(s.id)},{default:()=>y("common.confirmDelete"),trigger:()=>{let d;return P(e(k,{type:"error",ghost:!0,size:"small"},H(d=y("common.delete"))?d:{default:()=>[d]}),[[R("no-auth"),"project:Change:Contract:delete"]])}})])}}]}),{drawerVisible:h,operateType:N,editingData:$,handleAdd:x,handleEdit:o,checkedRowKeys:l,onBatchDeleted:U,onDeleted:v}=Te(p,r);async function c(){console.log(l.value),_(l.value.join(","),s=>{U()})}async function m(s){const{data:a,error:d}=await K(s);d||v()}function b(s){o(s)}async function _(s,a){const{data:d,error:u}=await K(s);if(!u)a&&a(d);else return!1}const B=s=>{r()},F=()=>{r()};return(s,a)=>{const d=O,u=se,ae=le,ne=ye,oe=Z,q=R("no-auth");return T(),be("div",Be,[e(Ue,{model:n(w),"onUpdate:model":a[0]||(a[0]=C=>I(w)?w.value=C:null),onReset:F,onSearch:n(r)},null,8,["model","onSearch"]),e(oe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(d,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>a[3]||(a[3]=[xe("div",null,"合同变更",-1)])),_:1,__:[3]})]),"header-extra":t(()=>[e(d,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[P((T(),M(n(k),{onClick:n(x),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(u,{class:"text-icon"})]),default:t(()=>[a[4]||(a[4]=D(" "+S("新增")))]),_:1,__:[4]},8,["onClick"])),[[q,"project:Change:Contract:insert"]]),e(n(E),{onPositiveClick:c},{trigger:t(()=>[P((T(),M(n(k),{size:"small",ghost:"",type:"error",disabled:n(l).length==0},{icon:t(()=>[e(ae,{class:we(["text-icon",{"animate-spin":n(i)}])},null,8,["class"])]),default:t(()=>[a[5]||(a[5]=D(" "+S("批量删除")))]),_:1,__:[5]},8,["disabled"])),[[q,"project:Change:Contract:delete"]])]),default:t(()=>[a[6]||(a[6]=D(" 确定要删除选中的数据吗？ "))]),_:1,__:[6]})]),_:1})]),default:t(()=>[e(ne,{"checked-row-keys":n(l),"onUpdate:checkedRowKeys":a[1]||(a[1]=C=>I(l)?l.value=C:null),columns:n(g),data:n(p),size:"small","flex-height":!n(z).isMobile,loading:n(i),remote:"","row-key":C=>C.id,pagination:n(j),class:"sm:h-full","onUpdate:filters":B},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e($e,{visible:n(h),"onUpdate:visible":a[2]||(a[2]=C=>I(h)?h.value=C:null),onSubmitted:n(r),"operate-type":n(N),"row-data":n($)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{Le as default};
