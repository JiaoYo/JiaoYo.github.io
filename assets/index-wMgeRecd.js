import{_ as X,l as Y}from"./lodash-JCyYSLuI.js";import{d as K,n as F,j as g,p as ee,s as ae,o as q,c as le,w as s,g as o,i as I,$ as b,W as te,h as N,t as j,F as ne,aG as oe,aw as L,ax as B,Z as ie,J as re,B as R,N as Z,O as se,ad as Q,a3 as ue,r as W,av as de,A as pe,e as ce,ai as ve,aZ as ge,aj as me,R as fe}from"./index-DLUsNmq1.js";import{_ as Ie}from"./round-search-BbPxbkp0.js";import{_ as he}from"./round-refresh-D6qtE-EZ.js";import{a as _e,T as J}from"./basicconf-BcBYLyg7.js";import{_ as ye}from"./DatePicker-Cj3ivfQr.js";import{_ as we}from"./Cascader-BYMllz3g.js";import{_ as Ae}from"./FormItemGridItem-Dc2T-Nkg.js";import{_ as Se}from"./Grid-CI2uRap6.js";import{_ as be}from"./originlogInfo.vue_vue_type_script_setup_true_lang-DYu4oqPW.js";import{e as Oe}from"./exportExcel-D6OyA9oJ.js";import{w as xe,u as Ee}from"./events-Bw0mHDW-.js";import{c as ke,f as Ce,a as Le}from"./common-DyG7Df7a.js";import"./TimePicker-B3xDiIpB.js";import"./defineProperty-XKJCmY6Z.js";import"./collection-Dq208Za7.js";import"./DescriptionsItem-6voC6PGD.js";import"./CollapseItem-BDvTalpJ.js";const De=K({name:"FormSearch",__name:"form-search",props:F(["eventsTypeDataList","LogSourceDeviceList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:F(["search"],["update:model"]),setup(h,{emit:U}){const _=h,m=U;g(0);const{formRef:T,restoreValidation:H}=ee(),e=ae(h,"model");async function V(){await H(),e.value.etypeid=null,e.value.elevel=null,e.value.rtime=null,e.value.user=null,e.value.logodid=null,e.value.target=null,e.value.startAndEndOriginIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.expression=null,e.value.startOriginIp=null,e.value.endOriginIp=null,e.value.startAimOriginIp=null,e.value.endAimOriginIp=null,e.value.startSourceIp=null,e.value.endSourceIp=null,oe(()=>{m("search")})}const G=n=>{e.value.elevel=n,i()},M=(n,r)=>{e.value.rtime=r,i()},D=n=>{e.value.logodid=n,i()},P=()=>{e.value.startAndEndOriginIp=null,i()},$=()=>{e.value.startAndEndSourceIp=null,i()},y=()=>{e.value.startAndEndAimSourceIp=null,i()};async function i(){var n,r,f,u,x,w,c,A,S,E,k,C;if(e.value.startAndEndOriginIp&&e.value.startAndEndOriginIp.length>0?(e.value.startOriginIp=e.value.startAndEndOriginIp[0]||null,e.value.endOriginIp=e.value.startAndEndOriginIp[1]||null):(e.value.startOriginIp=null,e.value.endOriginIp=null),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimOriginIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimOriginIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimOriginIp=null,e.value.endAimOriginIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=null,e.value.endSourceIp=null),e.value.startOriginIp&&!L(e.value.startOriginIp)||e.value.endOriginIp&&!L(e.value.endOriginIp))return(n=window.$message)==null||n.destroyAll(),(r=window.$message)==null||r.error("请输入正确的IP地址"),!1;if(e.value.startOriginIp&&e.value.endOriginIp&&B(e.value.startOriginIp,e.value.endOriginIp)>0)return(f=window.$message)==null||f.destroyAll(),(u=window.$message)==null||u.error("起始IP不能大于终止IP"),!1;if(e.value.startAimOriginIp&&!L(e.value.startAimOriginIp)||e.value.endAimOriginIp&&!L(e.value.endAimOriginIp))return(x=window.$message)==null||x.destroyAll(),(w=window.$message)==null||w.error("请输入正确的IP地址"),!1;if(e.value.startAimOriginIp&&e.value.endAimOriginIp&&B(e.value.startAimOriginIp,e.value.endAimOriginIp)>0)return(c=window.$message)==null||c.destroyAll(),(A=window.$message)==null||A.error("起始IP不能大于终止IP"),!1;if(e.value.startSourceIp&&!L(e.value.startSourceIp)||e.value.endSourceIp&&!L(e.value.endSourceIp))return(S=window.$message)==null||S.destroyAll(),(E=window.$message)==null||E.error("请输入正确的IP地址"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&B(e.value.startSourceIp,e.value.endSourceIp)>0)return(k=window.$message)==null||k.destroyAll(),(C=window.$message)==null||C.error("起始IP不能大于终止IP"),!1;m("search")}const O=X.debounce(i,1e3,{leading:!0,trailing:!1});return(n,r)=>{const f=we,u=Ae,x=ie,w=ye,c=re,A=he,S=R,E=Ie,k=Z,C=Se,a=se,t=Q;return q(),le(t,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[o(a,{ref_key:"formRef",ref:T,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(I(O),["enter"])},{default:s(()=>[o(C,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:s(()=>[o(u,{span:"24 s:24 m:8 l:6",label:"事件类型",path:"etypeid"},{default:s(()=>[o(f,{value:e.value.etypeid,"onUpdate:value":[r[0]||(r[0]=l=>e.value.etypeid=l),D],clearable:"",placeholder:"请选择事件","max-tag-count":1,options:_.eventsTypeDataList,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),o(u,{span:"24 s:24 m:8 l:6",label:I(b)("page.manage.alarm.level"),path:"elevel"},{default:s(()=>[o(x,{filterable:"",clearable:"",placeholder:I(b)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[r[1]||(r[1]=l=>e.value.elevel=l),G],"reset-menu-on-options-change":!1,options:I(te)(I(_e))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),o(u,{span:"24 s:24 m:8 l:6",label:"接收时间",path:"rtime"},{default:s(()=>[o(w,{placeholder:"请选择接收时间","formatted-value":e.value.rtime,"onUpdate:formattedValue":r[2]||(r[2]=l=>e.value.rtime=l),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:"",style:{width:"100%"},"onUpdate:value":M},null,8,["formatted-value"])]),_:1}),o(u,{span:"24 s:24 m:8 l:6",label:"日志源设备",path:"logodid"},{default:s(()=>[o(f,{disabled:_.logsoudev,value:e.value.logodid,"onUpdate:value":[r[3]||(r[3]=l=>e.value.logodid=l),i],placeholder:"请选择日志源设备",options:_.LogSourceDeviceList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["disabled","value","options"])]),_:1}),o(u,{span:"24 s:24 m:10 l:8",label:"源IP",path:"startAndEndOriginIp"},{default:s(()=>[o(c,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndOriginIp,"onUpdate:value":r[4]||(r[4]=l=>e.value.startAndEndOriginIp=l),onClear:P},null,8,["value"])]),_:1}),o(u,{span:"24 s:24 m:10 l:8",label:"目的IP",path:"startAndEndAimSourceIp"},{default:s(()=>[o(c,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":r[5]||(r[5]=l=>e.value.startAndEndAimSourceIp=l),onClear:y},null,8,["value"])]),_:1}),o(u,{span:"24 s:24 m:10 l:8",label:"发生源IP",path:"startAndEndSourceIp"},{default:s(()=>[o(c,{pair:"",separator:"-",disabled:_.logsoudev,placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":r[6]||(r[6]=l=>e.value.startAndEndSourceIp=l),onClear:$},null,8,["disabled","value"])]),_:1}),o(u,{span:"24 s:24 m:8 l:6",label:"目标对象",path:"target"},{default:s(()=>[o(c,{placeholder:"请输入目标对象",value:e.value.target,"onUpdate:value":r[7]||(r[7]=l=>e.value.target=l),clearable:""},null,8,["value"])]),_:1}),o(u,{span:"24 s:24 m:8 l:6"},{default:s(()=>[o(k,{class:"w-full"},{default:s(()=>[o(S,{onClick:V},{icon:s(()=>[o(A,{class:"text-icon"})]),default:s(()=>[N(" "+j(I(b)("common.reset")),1)]),_:1}),o(S,{type:"primary",ghost:"",onClick:I(O)},{icon:s(()=>[o(E,{class:"text-icon"})]),default:s(()=>[N(" "+j(I(b)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Te={class:"min-h-500px flex-col-stretch overflow-hidden lt-sm:overflow-auto"};function Pe(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!ve(h)}const $e=K({name:"eventalarm_originlog",__name:"index",props:{logsoudev:{},aip:{}},setup(h){const U=ue(),_=g(window.innerHeight-395),m=h,T=g([]);(async()=>{const{data:a,error:t}=await ke();t||(T.value=a.map(l=>({...l,id:"+"+l.id,type:l.cname})))})();const e=g([]),V=g([]);async function G(){const{data:a,error:t}=await Ce();t||(e.value=a,await M())}async function M(){const{data:a,error:t}=await Le();if(!t){V.value=a;let l=e.value.concat(a);e.value=ge(l)}}G();const D=g(!1),P=g(),$=g(),y=g(!1),i=W({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),O=[{title:"序号",key:"index",width:80,align:"center",render:a=>`${a.index}`},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"elevel",title:"事件等级",align:"center",width:120,render:a=>{(a.elevel===void 0||a.elevel===null)&&(a.elevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},l=b(J[a.elevel]);let v={color:t[a.elevel],textColor:"#ffffff",borderColor:t[a.elevel]};return o(de,{size:"small",color:v},Pe(l)?l:{default:()=>[l]})}},{key:"cname",title:"设备类别",align:"center",width:180},{key:"type",title:"设备类型",align:"center",width:180},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"sourceip",title:"发生源IP",align:"center",width:180},{key:"prifinallog",title:"日志原文",align:"center",width:240,ellipsis:!0},{key:"operate",title:b("common.operate"),align:"center",width:100,fixed:"right",render:a=>o("div",{class:"flex-center gap-8px"},[o(R,{type:"info",ghost:!0,size:"small",onClick:()=>S(a)},{default:()=>[N("详情")]})])}],n=g([]),r=g(0),f=async(a=!1)=>{if(!y.value)y.value=!0;else return;y.value=!0,m.logsoudev&&m.aip&&(u.value=!1,i.logodid=m.logsoudev,i.startAndEndSourceIp=[m.aip,m.aip],i.startSourceIp=m.aip,i.endSourceIp=m.aip);const{data:t,error:l}=await Ee(i);l||(r.value=t.length,a?n.value=[...n.value,...t]:n.value=t,n.value=n.value.sort((v,d)=>d.id-v.id).map((v,d)=>(v.index=d+1,v)),y.value=!1)},u=g(!0),x=async()=>{n.value=[],i.pageId=void 0,(t=>Object.keys(t).filter(d=>d!=="limit"&&d!=="_t").some(d=>t[d]!==void 0&&t[d]!==""&&t[d]!==null))(i)?u.value=!1:(u.value=!0,A()),i.pageId=void 0,await f(),w()},w=async()=>{var a,t,l;if(n.value.length<_.value/44&&n.value.length<c.total){if(i.pageId==((a=n.value[n.value.length-1])==null?void 0:a.id))return;i.pageId=((l=(t=n.value)==null?void 0:t[n.value.length-1])==null?void 0:l.id)??void 0,f(!0)}};pe(async()=>{await f(),await A(),w()});const c=W({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:t,page:l,pageSize:v,pageCount:d,itemCount:p}){return`已加载${n.value.length}条`+(n.value.length?u.value?` 共计 ${n.value.length>0?p??0:0} 条`:r.value==i.limit?"  预计还有更多":"  没有更多了":"")}});async function A(){const{data:a,error:t}=await xe();t||(c.pageCount=20,c.total=Number(a),c.itemCount=Number(a))}const S=a=>{P.value=a.id,$.value=a,D.value=!0};function E(a){Math.abs(a.target.scrollTop+a.target.offsetHeight-a.target.scrollHeight)<=20&&c.total>n.value.length&&k()}const k=Y.debounce(()=>{var a;if(((a=n.value)==null?void 0:a.length)<c.total){if(i.pageId==n.value[n.value.length-1].id)return;i.pageId=n.value[n.value.length-1].id,f(!0)}},300);async function C(){if(!n.value.length)return;const a=JSON.parse(JSON.stringify(n.value));console.log(a);const t=[];a.forEach(v=>{const d={};O.forEach(p=>{if(v.hasOwnProperty(p.key)){const z=p.key=="elevel"?v[p.key]!=null?b(J[v[p.key]]):"":v[p.key];d[p.title]=z}}),t.push(d)}),Oe(t,500,[{wpx:120},{wpx:120},{wpx:80},{wpx:100},{wpx:100},{wpx:120},{wpx:100},{wpx:100},{wpx:500}],"原始日志_"+new Date().getTime())}return(a,t)=>{const l=Z,v=me,d=Q;return q(),ce("div",Te,[o(De,{model:i,"onUpdate:model":t[0]||(t[0]=p=>i=p),onSearch:x,eventsTypeDataList:e.value,LogSourceDeviceList:T.value,class:"mb-16px",logsoudev:m.logsoudev},null,8,["model","eventsTypeDataList","LogSourceDeviceList","logsoudev"]),o(d,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[o(l,null,{default:s(()=>[o(I(R),{type:"primary",size:"small",ghost:"",onClick:C,title:"导出已加载"},{default:s(()=>[N("导出已加载")]),_:1})]),_:1})]),default:s(()=>[o(v,{columns:O,data:n.value,size:"small","flex-height":!I(U).isMobile,loading:y.value,remote:"","row-key":p=>p.id,"virtual-scroll":"","scroll-x":O.reduce((p,z)=>p+z.width,0),pagination:c,class:"sm:h-full",onScroll:E,"max-height":_.value},null,8,["data","flex-height","loading","row-key","scroll-x","pagination","max-height"])]),_:1}),o(be,{detailVisible:D.value,"onUpdate:detailVisible":t[1]||(t[1]=p=>D.value=p),detailId:P.value,detailInfo:$.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),Ye=fe($e,[["__scopeId","data-v-141ac40c"]]);export{Ye as default};
