import{az as p,d as J,aE as C,r as Y,n as K,H as Q,bY as N,a as W,aG as X,cq as Z,aC as ee,c as w,o as j,w as i,f as s,C as te,s as S,N as ae,h as d,aD as oe,e as re,t as D,v as b,y as le,B as L,g as U,$ as B,a1 as se,cs as ne,aO as ie}from"./index-ByRkKuMU.js";import{u as de}from"./usePageData-DJSm323_.js";function ve(o){return p({url:"/projectDailyReport/getPage.do",method:"get",params:o})}function pe(o){return p({url:"/projectDailyReport/insert.do",method:"post",data:o})}function ue(o){return p({url:"/projectDailyReport/getIdByUuid.do",method:"get",params:o})}function ce(o){return p({url:"/projectDailyReport/update.do",method:"put",data:o})}function we(o){return p({url:"/projectDailyReport/delete.do",method:"delete",params:{arrIds:o}})}function me(o){return p({url:"/projectDaily/insert.do",method:"post",data:o})}function je(o){return p({url:"/projectComment/getPage.do",method:"get",params:o})}function De(o){return p({url:"/projectComment/insert.do",method:"post",data:o})}function _e(o){return p({url:"/projectComment/delete.do",method:"delete",params:{arrIds:o}})}const ke=J({name:"OperateDrawer",__name:"operate-drawer",props:C({operateType:{},rowData:{},pid:{},pname:{},type:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:C(["submitted"],["update:visible"]),setup(o,{emit:O}){const _=O,{pageData:u,getData:y,nextPage:R}=de(ne),I=async t=>{const a=t.currentTarget,n=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&u.data.length<u.total&&(await R(),await ie(),setTimeout(()=>{a.scrollTop=n}))},r=o,e=Y(k());function k(){return{id:"",proname:"",notes:"",problem:"",solutions:"",feedback:"",summarize:"",pids:[]}}const M={notes:{required:!0,message:"请输入",trigger:"blur"}};async function F(){if(await y({fuzzy:r.pname,page:1}),Object.assign(e,k()),r.operateType==="add"&&(console.log(r.pid),r.pid&&(u.data.forEach(t=>{t.id==r.pid&&(t.disabled=!0)}),e.pids.push(r.pid))),r.operateType==="edit"&&r.rowData){Object.assign(e,r.rowData);const t=JSON.parse(r.rowData.context);e.proname=t.proname,e.notes=t.notes,e.problem=t.problem,e.solutions=t.solutions,e.feedback=t.feedback,e.summarize=t.summarize}}const{formRef:G,validate:V,restoreValidation:q}=K(),x=()=>{r.type=="detail"&&(e.pids=r.pid),y({page:1})},P=Q([]),E=N.debounce(async t=>{P.value=u.data.filter(a=>e.pids.includes(a.id)),await y({fuzzy:t,page:1}),u.data=u.data.concat(P.value)},300),$=t=>{if(!t){e.pids=null,x();return}E(t)},A=W(()=>({add:"新增项目日报",edit:"修改项目日报"})[r.operateType]),c=X(o,"visible"),h=()=>{c.value=!1},H=N.debounce(async()=>{var t,a;if(await V(),r.operateType==="edit"){const n=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:g,error:m}=await ce([{context:n,id:e.id}]);m||((t=window.$message)==null||t.success("修改成功"),_("submitted"),h())}else{const n=Z(),g=u.data.filter(f=>e.pids.includes(f.id)).map(f=>f.proname);e.proname=g.join(",");const m=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:T,error:l}=await pe([{context:m,uuid:n}]);if(!l){const{data:f,error:fe}=await ue({uuid:n});if(e.pids.length>0){let z=e.pids.map(v=>({pid:v}));z.forEach(v=>{v.did=f});const{data:be,error:ge}=await me(z)}(a=window.$message)==null||a.success("添加成功"),_("submitted"),h()}}},1e3,{leading:!0,trailing:!1});return ee(c,()=>{c.value&&(F(),setTimeout(()=>{const t=document.querySelector(".n-scrollbar-content");t==null||t.scrollTo(0,0)},300),q())}),(t,a)=>{const n=ae,g=te,m=le,T=se;return j(),w(T,{show:c.value,"onUpdate:show":a[6]||(a[6]=l=>c.value=l),title:A.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:i(()=>[s(m,{justify:"end"},{default:i(()=>[s(d(L),{size:"small",class:"mt-16px",onClick:h},{default:i(()=>[U(D(d(B)("common.cancel")),1)]),_:1}),s(d(L),{type:"primary",size:"small",class:"mt-16px",onClick:d(H)},{default:i(()=>[U(D(d(B)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:i(()=>[s(g,{ref_key:"formRef",ref:G,model:e,rules:M},{default:i(()=>[r.operateType==="add"?(j(),w(n,{key:0,label:"关联项目",path:"pids","label-placement":"left"},{default:i(()=>[s(d(oe),{clearable:"",filterable:"",value:e.pids,"onUpdate:value":a[0]||(a[0]=l=>e.pids=l),placeholder:"请选择项目","label-field":"proname",multiple:"","value-field":"id",onClear:x,onSearch:$,options:d(u).data,onScroll:I},null,8,["value","options"])]),_:1})):S("",!0),r.operateType==="edit"&&e.proname?(j(),w(n,{key:1,label:"项目名称",path:"proname","label-placement":"left"},{default:i(()=>[re("span",null,D(e.proname),1)]),_:1})):S("",!0),s(n,{label:"当前工作内容及成果描述：",path:"notes"},{default:i(()=>[s(d(b),{clearable:"",type:"textarea",value:e.notes,"onUpdate:value":a[1]||(a[1]=l=>e.notes=l),placeholder:"请输入"},null,8,["value"])]),_:1}),s(n,{label:"遇到问题：",path:"problem"},{default:i(()=>[s(d(b),{clearable:"",type:"textarea",rows:2,value:e.problem,"onUpdate:value":a[2]||(a[2]=l=>e.problem=l),placeholder:"请输入"},null,8,["value"])]),_:1}),s(n,{label:"解决措施：",path:"solutions"},{default:i(()=>[s(d(b),{clearable:"",type:"textarea",rows:2,value:e.solutions,"onUpdate:value":a[3]||(a[3]=l=>e.solutions=l),placeholder:"请输入"},null,8,["value"])]),_:1}),s(n,{label:"建议意见反馈：",path:"feedback"},{default:i(()=>[s(d(b),{clearable:"",type:"textarea",rows:2,value:e.feedback,"onUpdate:value":a[4]||(a[4]=l=>e.feedback=l),placeholder:"请输入"},null,8,["value"])]),_:1}),s(n,{label:"（总结）自己对一天工作的感受和体感：",path:"summarize"},{default:i(()=>[s(d(b),{clearable:"",type:"textarea",rows:2,value:e.summarize,"onUpdate:value":a[5]||(a[5]=l=>e.summarize=l),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}});export{ke as _,je as a,_e as b,ve as c,we as d,De as f};
