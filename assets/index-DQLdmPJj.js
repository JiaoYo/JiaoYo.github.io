import{_ as ie}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DSLF4GvF.js";import{d as q,q as G,s as Y,x as J,F as M,o as H,c as X,w as l,g as t,G as D,h as O,t as j,i as o,$ as d,H as ce,L as Z,B as V,P as ee,Q as te,af as ae,v as pe,b as ue,r as de,ag as me,Y as fe,aF as _e,M as ge,a1 as ye,b3 as oe,ah as ve,ai as he,a5 as be,e as we,aj as I,ak as De,al as ke}from"./index-BP7F9FxI.js";import{u as xe,a as Se}from"./table-BZRWUD8G.js";import{_ as Ne}from"./round-search-DyyzfEdI.js";import{_ as Te}from"./round-refresh-81nSFoBL.js";import{_ as ze}from"./lodash-BXGszeVa.js";import{_ as Ce}from"./FormItemGridItem-C7_XHVbB.js";import{_ as Fe}from"./Grid-Bo5eh9Zu.js";import{u as E}from"./usePageData-EyGt1fNJ.js";import{a as Re}from"./basicconf-CuQrCUHQ.js";import{d as Ue,e as Ae,g as Pe,f as Le,h as $e}from"./alarm-CJXGs9J9.js";import{f as Be}from"./audit-events-DbvNWFoo.js";import{a as Ie}from"./events-BpH4HVS3.js";import{h as W}from"./permission-DYmPksV5.js";import{_ as Me}from"./Popconfirm-Dg6vV92x.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-HgT7VkxX.js";import"./setting-outlined-D9DSfit9.js";import"./export-D1GS-u1R.js";import"./refresh-DvrXeenc.js";import"./round-delete-Ch_nGZvJ.js";import"./round-plus-BypMaIJk.js";import"./Upload-K8gDmy3J.js";import"./Progress-DwZ6AxQJ.js";const Oe=q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:G(["reset","search"],["update:model"]),setup(g,{emit:T}){const u=T,{formRef:y,restoreValidation:f}=Y(),m=J(g,"model");function k(){m.value.fuzzy="",u("search")}async function z(){await f(),u("reset")}async function v(){u("search")}const x=ze.debounce(v,1e3,{leading:!0,trailing:!1});return(e,h)=>{const C=Z,S=Ce,b=Te,p=V,F=Ne,R=ee,$=Fe,w=te,U=ae,A=M("no-space");return H(),X(U,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[t(w,{ref_key:"formRef",ref:y,model:m.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ce(o(x),["enter"])},{default:l(()=>[t($,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:l(()=>[t(S,{span:"24 s:12 m:8 l:6",label:"策略名称",path:"fuzzy"},{default:l(()=>[D(t(C,{clearable:"",value:m.value.fuzzy,"onUpdate:value":h[0]||(h[0]=N=>m.value.fuzzy=N),placeholder:"请输入策略名称",onClear:k},null,8,["value"]),[[A]])]),_:1}),t(S,{span:"24 s:12 m:8 l:6"},{default:l(()=>[t(R,{class:"w-full"},{default:l(()=>[t(p,{onClick:z},{icon:l(()=>[t(b,{class:"text-icon"})]),default:l(()=>[O(" "+j(o(d)("common.reset")),1)]),_:1}),t(p,{type:"primary",ghost:"",onClick:o(x)},{icon:l(()=>[t(F,{class:"text-icon"})]),default:l(()=>[O(" "+j(o(d)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),je=q({name:"OperateDrawer",__name:"operate-drawer",props:G({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:G(["submitted"],["update:visible"]),setup(g,{emit:T}){const u=g,y=T,f=J(g,"visible"),{formRef:m,validate:k,restoreValidation:z}=Y(),{defaultRequiredRule:v}=pe(),x=ue(()=>({add:"新增告警策略",edit:"修改告警策略"})[u.operateType]),e=de(h());function h(){return{pname:"",aenc:"",atype:void 0,alevel:void 0,forsys:"",formail:"",pdesc:"",pstatus:0}}const C={pname:v,atype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择审计类型"},alevel:{type:"number",required:!0,trigger:["blur","change"],message:"请选择审计等级"},formail:{required:!1,validator:_e,trigger:["input","change","blur","password-input"]}};async function S(){var n;if(await F(),await U(),Object.assign(e,h()),u.operateType==="edit"&&u.rowData){const{data:a,error:_}=await Ue((n=u.rowData)==null?void 0:n.id);Object.assign(e,a),e.forsys=e.forsys?e.forsys.split(",").map(Number):[]}}function b(){f.value=!1}const{pageData:p,getData:F,nextPage:R}=E(Be),$=async n=>{const a=n.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&p.data.length<p.total&&R()},{pageData:w,getData:U,nextPage:A}=E(Ie),N=async n=>{const a=n.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&w.data.length<w.total&&A()};async function c(){var n,a,_,s;if(await k(),u.operateType==="add"){const{data:P,error:L}=await Ae([{pname:e.pname,aenc:e.aenc,atype:e.atype,alevel:e.alevel,forsys:e.forsys.length?(n=e.forsys)==null?void 0:n.join(","):"",formail:e.formail,pdesc:e.pdesc,pstatus:e.pstatus}]);L||((a=window.$message)==null||a.success(d("common.addSuccess")),b(),y("submitted"))}else{const{data:P,error:L}=await Pe([{id:u.rowData.id,pname:e.pname,aenc:e.aenc,atype:e.atype,alevel:e.alevel,forsys:e.forsys.length>0?(_=e.forsys)==null?void 0:_.join(","):"",formail:e.formail,pdesc:e.pdesc,pstatus:e.pstatus}]);L||((s=window.$message)==null||s.success(d("common.updateSuccess")),b(),y("submitted"))}}const r=n=>n.ipaddr+":"+n.fport+" ("+(n.ftype==0?"syslog":"SNMP Trap")+")";return me(f,()=>{f.value&&(S(),z())}),(n,a)=>{const _=Z,s=ge,P=ye,L=oe,le=te,K=V,ne=ee,se=ve,re=he,B=M("no-space");return H(),X(re,{show:f.value,"onUpdate:show":a[8]||(a[8]=i=>f.value=i),"display-directive":"show",width:450},{default:l(()=>[t(se,{title:x.value,"native-scrollbar":!1,closable:""},{footer:l(()=>[t(ne,{size:16},{default:l(()=>[t(K,{onClick:b},{default:l(()=>[O(j(o(d)("common.cancel")),1)]),_:1}),t(K,{type:"primary",onClick:c},{default:l(()=>[O(j(o(d)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[t(le,{ref_key:"formRef",ref:m,model:e,rules:C},{default:l(()=>[t(s,{label:"策略名称",path:"pname"},{default:l(()=>[D(t(_,{value:e.pname,"onUpdate:value":a[0]||(a[0]=i=>e.pname=i),placeholder:"请输入策略名称",clearable:""},null,8,["value"]),[[B]])]),_:1}),t(s,{label:"审计事件名称包含",path:"aenc"},{default:l(()=>[D(t(_,{value:e.aenc,"onUpdate:value":a[1]||(a[1]=i=>e.aenc=i),placeholder:"请输入审计事件名称包含",clearable:""},null,8,["value"]),[[B]])]),_:1}),t(s,{label:"审计类型",path:"atype"},{default:l(()=>[t(P,{value:e.atype,"onUpdate:value":a[2]||(a[2]=i=>e.atype=i),placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:o(p).data,"reset-menu-on-options-change":!1,onScroll:$},null,8,["value","options"])]),_:1}),t(s,{label:"审计等级",path:"alevel"},{default:l(()=>[t(P,{filterable:"",clearable:"",placeholder:o(d)("page.manage.alarm.form.level"),value:e.alevel,"onUpdate:value":a[3]||(a[3]=i=>e.alevel=i),options:o(fe)(o(Re))},null,8,["placeholder","value","options"])]),_:1}),t(s,{label:"转发类型",path:"forsys"},{default:l(()=>[t(P,{"max-tag-count":1,value:e.forsys,"onUpdate:value":a[4]||(a[4]=i=>e.forsys=i),multiple:"",placeholder:"请选择转发类型",clearable:"","render-label":r,filterable:"","value-field":"id","label-field":"ipaddr",options:o(w).data,"reset-menu-on-options-change":!1,onScroll:N},null,8,["value","options"])]),_:1}),t(s,{label:"外转邮箱",path:"formail"},{default:l(()=>[D(t(_,{value:e.formail,"onUpdate:value":a[5]||(a[5]=i=>e.formail=i),placeholder:"请输入外转邮箱",clearable:""},null,8,["value"]),[[B]])]),_:1}),t(s,{label:"使用状态",path:"pstatus"},{default:l(()=>[t(L,{value:e.pstatus,"onUpdate:value":a[6]||(a[6]=i=>e.pstatus=i),"checked-value":0,"unchecked-value":1},null,8,["value"])]),_:1}),t(s,{label:"备注"},{default:l(()=>[D(t(_,{value:e.pdesc,"onUpdate:value":a[7]||(a[7]=i=>e.pdesc=i),type:"textarea",placeholder:"请输入备注",clearable:""},null,8,["value"]),[[B]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ve={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Q(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!De(g)}const dt=q({name:"platformalarm_alarmrules",__name:"index",setup(g){const T=be(),{columns:u,columnChecks:y,data:f,getData:m,loading:k,mobilePagination:z,searchParams:v,resetSearchParams:x}=xe({apiFn:Le,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"pname",title:"策略名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pdesc",title:"描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"dbtime",title:d("page.eventalarm.alarmrule.updateTime"),align:"center",width:180},{key:"pstatus",title:"使用状态",align:"center",width:160,render:c=>t(oe,{disabled:!0,value:c.pstatus,checkedValue:0,uncheckedValue:1},null)},{key:"operate",title:d("common.operate"),align:"center",width:160,render:c=>{let r;return t("div",{class:"flex-center gap-8px"},[D(t(V,{type:"info",ghost:!0,size:"small",onClick:()=>U(c.id)},Q(r=d("common.edit"))?r:{default:()=>[r]}),[[M("no-auth"),"sys.alarm.policy.update"]]),t(Me,{onPositiveClick:()=>A(c.id)},{default:()=>d("common.confirmDelete"),trigger:()=>{let n;return D(t(V,{type:"error",ghost:!0,size:"small"},Q(n=d("common.delete"))?n:{default:()=>[n]}),[[M("no-auth"),"sys.alarm.policy.delete"]])}})])}}]}),{drawerVisible:e,operateType:h,editingData:C,handleAdd:S,handleEdit:b,checkedRowKeys:p,onBatchDeleted:F,onDeleted:R,closeDrawer:$}=Se(f,m);async function w(){console.log(p.value),N(p.value,c=>{F()})}function U(c){b(c)}function A(c){console.log(c),N([c],r=>{R()})}async function N(c,r){const{data:n,error:a}=await $e(c);if(!a)r&&r(n);else return!1}return(c,r)=>{const n=ie,a=ke,_=ae;return H(),we("div",Ve,[t(Oe,{model:o(v),"onUpdate:model":r[0]||(r[0]=s=>I(v)?v.value=s:null),onReset:o(x),onSearch:o(m)},null,8,["model","onReset","onSearch"]),t(_,{title:"告警策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[t(n,{columns:o(y),"onUpdate:columns":r[1]||(r[1]=s=>I(y)?y.value=s:null),"disabled-delete":o(p).length===0,loading:o(k),onAdd:o(S),onDelete:w,onRefresh:o(m),"is-view-add-button":o(W)("sys.alarm.policy.insert"),"is-view-delete-button":o(W)("sys.alarm.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:l(()=>[t(a,{"checked-row-keys":o(p),"onUpdate:checkedRowKeys":r[2]||(r[2]=s=>I(p)?p.value=s:null),columns:o(u),data:o(f),size:"small","flex-height":!o(T).isMobile,"scroll-x":962,loading:o(k),remote:"","row-key":s=>s.id,pagination:o(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(je,{visible:o(e),"onUpdate:visible":r[3]||(r[3]=s=>I(e)?e.value=s:null),"operate-type":o(h),"row-data":o(C),onSubmitted:o(m)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{dt as default};
