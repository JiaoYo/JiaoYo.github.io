import{_ as W}from"./table-header-operation.vue_vue_type_script_setup_true_lang-B6_w-svJ.js";import{d as q,q as M,j as H,x as G,s as J,v as Q,b as X,r as Y,ae as Z,o as I,c as ee,w as l,g as t,h as O,t as $,i as a,$ as _,e as K,ao as te,H as oe,a0 as ae,L as ne,K as le,ap as ie,P as se,B,O as re,af as de,ag as pe,a4 as ue,F as j,E as V,ah as R,ai as ce,aj as me,ad as fe}from"./index-EW2EHvBZ.js";import{D as _e,E as ye,a as ve,F as ge}from"./events-CW6Qv9Pf.js";import{u as we,a as be}from"./table-BM2Nndfm.js";import{h as A}from"./permission-Pt6453DZ.js";import{_ as he}from"./Popconfirm-TDUTgjWd.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Be20msHI.js";import"./setting-outlined-BxtKhYfw.js";import"./export-CRAVcHUz.js";import"./refresh-DaAMQoyy.js";import"./round-delete-DbWWWZSj.js";import"./round-plus-CN_Via8e.js";import"./Upload-DoM6KtKf.js";import"./Progress-CQtr656V.js";const De=q({name:"OperateDrawer",__name:"operate-drawer",props:M({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:M(["submitted"],["update:visible"]),setup(y,{emit:S}){const c=y,v=H([{label:"syslog",value:0},{label:"SNMP Trap",value:1}]),g=S,p=G(y,"visible"),{formRef:x,validate:P,restoreValidation:z}=J(),{defaultRequiredRule:L,formRules:w}=Q(),T=X(()=>({add:"新增转发策略",edit:"编辑转发策略"})[c.operateType]),e=Y(N());function N(){return{ftype:1,community:"",etpnode:"",oidnode:"",ipaddr:"",fport:void 0,fdesc:""}}const C={ipaddr:w.ip,fport:{type:"number",required:!0,trigger:["blur","change"],message:"请输入端口号"}};function m(){Object.assign(e,N()),c.operateType==="edit"&&c.rowData&&Object.assign(e,c.rowData)}function b(){p.value=!1}async function F(){var h,o;if(await P(),c.operateType==="add"){const{data:D,error:r}=await _e([{ftype:e.ftype,community:e.community,etpnode:e.etpnode,oidnode:e.oidnode,ipaddr:e.ipaddr,fport:e.fport,fdesc:e.fdesc}]);r||((h=window.$message)==null||h.success(_("common.addSuccess")),b(),g("submitted"))}else{const{data:D,error:r}=await ye([{id:c.rowData.id,ftype:e.ftype,community:e.community,etpnode:e.etpnode,oidnode:e.oidnode,ipaddr:e.ipaddr,fport:e.fport,fdesc:e.fdesc}]);r||((o=window.$message)==null||o.success(_("common.updateSuccess")),b(),g("submitted"))}}return Z(p,()=>{p.value&&(m(),z())}),(h,o)=>{const D=ae,r=ne,f=le,i=ie,n=se,d=B,k=re,U=de,u=pe;return I(),ee(u,{show:p.value,"onUpdate:show":o[7]||(o[7]=s=>p.value=s),"display-directive":"show",width:360},{default:l(()=>[t(U,{title:T.value,"native-scrollbar":!1,closable:""},{footer:l(()=>[t(k,{size:16},{default:l(()=>[t(d,{onClick:b},{default:l(()=>[O($(a(_)("common.cancel")),1)]),_:1}),t(d,{type:"primary",onClick:F},{default:l(()=>[O($(a(_)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[t(n,{ref_key:"formRef",ref:x,model:e,rules:C},{default:l(()=>[t(r,{label:"转发方式",path:"ftype"},{default:l(()=>[t(D,{filterable:"",value:e.ftype,"onUpdate:value":o[0]||(o[0]=s=>e.ftype=s),placeholder:"请选择转发方式",options:v.value,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e.ftype==1?(I(),K(te,{key:0},[t(r,{label:"Community",path:"community"},{default:l(()=>[t(f,{value:e.community,"onUpdate:value":o[1]||(o[1]=s=>e.community=s),placeholder:"请输入community",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"企业节点号",path:"etpnode"},{default:l(()=>[t(f,{value:e.etpnode,"onUpdate:value":o[2]||(o[2]=s=>e.etpnode=s),placeholder:"请输入企业节点号",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"oid节点号",path:"oidnode"},{default:l(()=>[t(f,{value:e.oidnode,"onUpdate:value":o[3]||(o[3]=s=>e.oidnode=s),placeholder:"请输入oid节点号",clearable:""},null,8,["value"])]),_:1})],64)):oe("",!0),t(r,{label:"其它服务器IP",path:"ipaddr"},{default:l(()=>[t(f,{value:e.ipaddr,"onUpdate:value":o[4]||(o[4]=s=>e.ipaddr=s),placeholder:"请输入其它服务器IP",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"端口号",path:"fport"},{default:l(()=>[t(i,{min:0,max:65535,value:e.fport,"onUpdate:value":o[5]||(o[5]=s=>e.fport=s),placeholder:"请输入端口号",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{label:"描述",path:"fdesc"},{default:l(()=>[t(f,{type:"textarea",value:e.fdesc,"onUpdate:value":o[6]||(o[6]=s=>e.fdesc=s),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function E(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!ce(y)}const $e=q({name:"manage_forwardserver",__name:"index",setup(y){const S=ue(),{columns:c,columnChecks:v,data:g,getData:p,loading:x,mobilePagination:P,searchParams:z,resetSearchParams:L}=we({apiFn:ve,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"ftype",title:"转发方式",align:"center",width:160,render:i=>i.ftype==0?"syslog":"SNMP Trap"},{key:"community",title:"Community",align:"center",width:160},{key:"etpnode",title:"企业节点号",align:"center",minWidth:180},{key:"oidnode",title:"oid节点号",align:"center",minWidth:220},{key:"ipaddr",title:"其它服务器IP",align:"center",width:200},{key:"fport",title:"端口号",align:"center",width:140},{key:"fdesc",title:"用户描述",align:"center",minWidth:180,ellipsis:{tooltip:!0}},{key:"operate",title:_("common.operate"),align:"center",render:i=>{let n;return t("div",{class:"flex-center gap-8px"},[j(t(B,{type:"primary",ghost:!0,size:"small",onClick:()=>r(i.id)},E(n=_("common.edit"))?n:{default:()=>[n]}),[[V("no-auth"),"sys.forward.policy.update"]]),t(he,{onPositiveClick:()=>D(i.id)},{default:()=>_("common.confirmDelete"),trigger:()=>{let d;return j(t(B,{type:"error",ghost:!0,size:"small"},E(d=_("common.delete"))?d:{default:()=>[d]}),[[V("no-auth"),"sys.forward.policy.delete"]])}})])}}]}),{drawerVisible:w,operateType:T,editingData:e,handleAdd:N,handleEdit:C,checkedRowKeys:m,onBatchDeleted:b,onDeleted:F,closeDrawer:h}=be(g,p);async function o(){console.log(m.value),f(m.value,i=>{b()})}function D(i){console.log(i),f([i],n=>{F()})}function r(i){C(i)}async function f(i,n){const{data:d,error:k}=await ge(i);if(!k)n&&n(d);else return!1}return(i,n)=>{const d=W,k=me,U=fe;return I(),K("div",ke,[t(U,{title:"转发策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[t(d,{columns:a(v),"onUpdate:columns":n[0]||(n[0]=u=>R(v)?v.value=u:null),"disabled-delete":a(m).length===0,loading:a(x),onAdd:a(N),onDelete:o,onRefresh:a(p),"is-view-add-button":a(A)("sys.forward.policy.insert"),"is-view-delete-button":a(A)("sys.forward.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:l(()=>[t(k,{"checked-row-keys":a(m),"onUpdate:checkedRowKeys":n[1]||(n[1]=u=>R(m)?m.value=u:null),columns:a(c),data:a(g),size:"small","flex-height":!a(S).isMobile,"scroll-x":962,loading:a(x),remote:"","row-key":u=>u.id,pagination:a(P),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(De,{visible:a(w),"onUpdate:visible":n[2]||(n[2]=u=>R(w)?w.value=u:null),"operate-type":a(T),"row-data":a(e),onSubmitted:a(p)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{$e as default};
