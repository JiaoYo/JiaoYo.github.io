import{_ as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Cxcfxqjv.js";import{d as G,n as q,p as Z,s as Q,D as O,o as K,c as X,w as n,g as a,E as D,h as I,t as j,i as l,$ as f,F as ce,J as Y,B as M,N as ee,O as te,ad as ae,q as ue,b as de,r as me,ae as fe,W as _e,aD as ge,K as ye,Z as he,b1 as oe,af as ve,ag as be,a3 as we,e as De,ah as B,ai as ke,aj as xe}from"./index-ceBNQZ86.js";import{u as Se,a as Ne}from"./table-Cwx-mm4V.js";import{_ as Te}from"./round-search-BcCfg6Rs.js";import{_ as ze}from"./round-refresh-XHI1_HgH.js";import{_ as Ce}from"./lodash-mKDvD7pG.js";import{_ as Ue}from"./FormItemGridItem-CD-6gtvr.js";import{_ as Fe}from"./Grid-D1BWnhHy.js";import{u as E}from"./usePageData-CDSm91M7.js";import{a as Re}from"./basicconf-q2mf-s1o.js";import{d as Ae,e as Pe,g as le,f as $e,h as Le}from"./alarm-CzRJntGo.js";import{f as Be}from"./audit-events-Q9XqB8tS.js";import{a as Oe}from"./events-CiWBxrbu.js";import{h as W}from"./permission-DyJpvaaK.js";import{_ as Ie}from"./Popconfirm-Bmvw5sKT.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-BDLk7ElL.js";import"./setting-outlined-CNghbagY.js";import"./export-DpVhcvN8.js";import"./refresh-DxuY7wy-.js";import"./round-delete-DvbQsJY0.js";import"./round-plus-3bZN76iw.js";import"./Upload-BUy5bQcQ.js";import"./Progress-wPQ_PjEL.js";const je=G({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["reset","search"],["update:model"]),setup(g,{emit:T}){const d=T,{formRef:y,restoreValidation:_}=Z(),m=Q(g,"model");function k(){m.value.fuzzy="",d("search")}async function z(){await _(),d("reset")}async function h(){d("search")}const x=Ce.debounce(h,1e3,{leading:!0,trailing:!1});return(e,v)=>{const C=Y,S=Ue,b=ze,u=M,U=Te,F=ee,$=Fe,w=te,R=ae,A=O("no-space");return K(),X(R,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(w,{ref_key:"formRef",ref:y,model:m.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ce(l(x),["enter"])},{default:n(()=>[a($,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[a(S,{span:"24 s:12 m:8 l:6",label:"策略名称",path:"fuzzy"},{default:n(()=>[D(a(C,{clearable:"",value:m.value.fuzzy,"onUpdate:value":v[0]||(v[0]=N=>m.value.fuzzy=N),placeholder:"请输入策略名称",onClear:k},null,8,["value"]),[[A]])]),_:1}),a(S,{span:"24 s:12 m:8 l:6"},{default:n(()=>[a(F,{class:"w-full"},{default:n(()=>[a(u,{onClick:z},{icon:n(()=>[a(b,{class:"text-icon"})]),default:n(()=>[I(" "+j(l(f)("common.reset")),1)]),_:1}),a(u,{type:"primary",ghost:"",onClick:l(x)},{icon:n(()=>[a(U,{class:"text-icon"})]),default:n(()=>[I(" "+j(l(f)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Me=G({name:"OperateDrawer",__name:"operate-drawer",props:q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["submitted"],["update:visible"]),setup(g,{emit:T}){const d=g,y=T,_=Q(g,"visible"),{formRef:m,validate:k,restoreValidation:z}=Z(),{defaultRequiredRule:h}=ue(),x=de(()=>({add:"新增告警策略",edit:"修改告警策略"})[d.operateType]),e=me(v());function v(){return{pname:"",aenc:"",atype:void 0,alevel:void 0,forsys:"",formail:"",pdesc:"",pstatus:0}}const C={pname:h,atype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择审计类型"},alevel:{type:"number",required:!0,trigger:["blur","change"],message:"请选择审计等级"},formail:{required:!1,validator:ge,trigger:["input","change","blur","password-input"]}};async function S(){var o;if(await U(),await R(),Object.assign(e,v()),d.operateType==="edit"&&d.rowData){const{data:t,error:p}=await Ae((o=d.rowData)==null?void 0:o.id);Object.assign(e,t),e.forsys=e.forsys?e.forsys.split(",").map(Number):[]}}function b(){_.value=!1}const{pageData:u,getData:U,nextPage:F}=E(Be),$=async o=>{const t=o.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&u.data.length<u.total&&F()},{pageData:w,getData:R,nextPage:A}=E(Oe),N=async o=>{const t=o.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&w.data.length<w.total&&A()};async function V(){var o,t,p,i;if(await k(),d.operateType==="add"){const{data:c,error:P}=await Pe([{pname:e.pname,aenc:e.aenc,atype:e.atype,alevel:e.alevel,forsys:e.forsys.length?(o=e.forsys)==null?void 0:o.join(","):"",formail:e.formail,pdesc:e.pdesc,pstatus:e.pstatus}]);P||((t=window.$message)==null||t.success(f("common.addSuccess")),b(),y("submitted"))}else{const{data:c,error:P}=await le([{id:d.rowData.id,pname:e.pname,aenc:e.aenc,atype:e.atype,alevel:e.alevel,forsys:e.forsys.length>0?(p=e.forsys)==null?void 0:p.join(","):"",formail:e.formail,pdesc:e.pdesc,pstatus:e.pstatus}]);P||((i=window.$message)==null||i.success(f("common.updateSuccess")),b(),y("submitted"))}}const s=o=>o.ipaddr+":"+o.fport+" ("+(o.ftype==0?"syslog":"SNMP Trap")+")";return fe(_,()=>{_.value&&(S(),z())}),(o,t)=>{const p=Y,i=ye,c=he,P=oe,ne=te,H=M,se=ee,re=ve,ie=be,L=O("no-space");return K(),X(ie,{show:_.value,"onUpdate:show":t[8]||(t[8]=r=>_.value=r),"display-directive":"show",width:450},{default:n(()=>[a(re,{title:x.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[a(se,{size:16},{default:n(()=>[a(H,{onClick:b},{default:n(()=>[I(j(l(f)("common.cancel")),1)]),_:1}),a(H,{type:"primary",onClick:V},{default:n(()=>[I(j(l(f)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(ne,{ref_key:"formRef",ref:m,model:e,rules:C},{default:n(()=>[a(i,{label:"策略名称",path:"pname"},{default:n(()=>[D(a(p,{value:e.pname,"onUpdate:value":t[0]||(t[0]=r=>e.pname=r),placeholder:"请输入策略名称",clearable:""},null,8,["value"]),[[L]])]),_:1}),a(i,{label:"审计事件名称包含",path:"aenc"},{default:n(()=>[D(a(p,{value:e.aenc,"onUpdate:value":t[1]||(t[1]=r=>e.aenc=r),placeholder:"请输入审计事件名称包含",clearable:""},null,8,["value"]),[[L]])]),_:1}),a(i,{label:"审计类型",path:"atype"},{default:n(()=>[a(c,{value:e.atype,"onUpdate:value":t[2]||(t[2]=r=>e.atype=r),placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:l(u).data,"reset-menu-on-options-change":!1,onScroll:$},null,8,["value","options"])]),_:1}),a(i,{label:"审计等级",path:"alevel"},{default:n(()=>[a(c,{filterable:"",clearable:"",placeholder:l(f)("page.manage.alarm.form.level"),value:e.alevel,"onUpdate:value":t[3]||(t[3]=r=>e.alevel=r),options:l(_e)(l(Re))},null,8,["placeholder","value","options"])]),_:1}),a(i,{label:"转发类型",path:"forsys"},{default:n(()=>[a(c,{"max-tag-count":1,value:e.forsys,"onUpdate:value":t[4]||(t[4]=r=>e.forsys=r),multiple:"",placeholder:"请选择转发类型",clearable:"","render-label":s,filterable:"","value-field":"id","label-field":"ipaddr",options:l(w).data,"reset-menu-on-options-change":!1,onScroll:N},null,8,["value","options"])]),_:1}),a(i,{label:"外转邮箱",path:"formail"},{default:n(()=>[D(a(p,{value:e.formail,"onUpdate:value":t[5]||(t[5]=r=>e.formail=r),placeholder:"请输入外转邮箱",clearable:""},null,8,["value"]),[[L]])]),_:1}),a(i,{label:"使用状态",path:"pstatus"},{default:n(()=>[a(P,{value:e.pstatus,"onUpdate:value":t[6]||(t[6]=r=>e.pstatus=r),"checked-value":0,"unchecked-value":1},null,8,["value"])]),_:1}),a(i,{label:"备注"},{default:n(()=>[D(a(p,{value:e.pdesc,"onUpdate:value":t[7]||(t[7]=r=>e.pdesc=r),type:"textarea",placeholder:"请输入备注",clearable:""},null,8,["value"]),[[L]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ve={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function J(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!ke(g)}const dt=G({name:"platformalarm_alarmrules",__name:"index",setup(g){const T=we(),{columns:d,columnChecks:y,data:_,getData:m,loading:k,mobilePagination:z,searchParams:h,resetSearchParams:x}=Se({apiFn:$e,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"pname",title:"策略名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pdesc",title:"描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"dbtime",title:f("page.eventalarm.alarmrule.updateTime"),align:"center",width:180},{key:"pstatus",title:"使用状态",align:"center",width:160,render:s=>a(oe,{value:s.pstatus,"onUpdate:value":[o=>s.pstatus=o,()=>V(s)],checkedValue:0,uncheckedValue:1},null)},{key:"operate",title:f("common.operate"),align:"center",width:160,render:s=>{let o;return a("div",{class:"flex-center gap-8px"},[D(a(M,{type:"info",ghost:!0,size:"small",onClick:()=>R(s.id)},J(o=f("common.edit"))?o:{default:()=>[o]}),[[O("no-auth"),"sys.alarm.policy.update"]]),a(Ie,{onPositiveClick:()=>A(s.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let t;return D(a(M,{type:"error",ghost:!0,size:"small"},J(t=f("common.delete"))?t:{default:()=>[t]}),[[O("no-auth"),"sys.alarm.policy.delete"]])}})])}}]}),{drawerVisible:e,operateType:v,editingData:C,handleAdd:S,handleEdit:b,checkedRowKeys:u,onBatchDeleted:U,onDeleted:F,closeDrawer:$}=Ne(_,m);async function w(){console.log(u.value),N(u.value,s=>{U()})}function R(s){b(s)}function A(s){console.log(s),N([s],o=>{F()})}async function N(s,o){const{data:t,error:p}=await Le(s);if(!p)o&&o(t);else return!1}const V=async s=>{var p,i;const{data:o,error:t}=await le([{pstatus:s.pstatus,id:s.id}]);t?((i=window.$message)==null||i.error(s.pstatus==0?"禁用失败":"启用失败"),s.pstatus=s.pstatus==1?0:1):((p=window.$message)==null||p.success(s.pstatus==0?"启用成功":"禁用成功"),m())};return(s,o)=>{const t=pe,p=xe,i=ae;return K(),De("div",Ve,[a(je,{model:l(h),"onUpdate:model":o[0]||(o[0]=c=>B(h)?h.value=c:null),onReset:l(x),onSearch:l(m)},null,8,["model","onReset","onSearch"]),a(i,{title:"告警策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(t,{columns:l(y),"onUpdate:columns":o[1]||(o[1]=c=>B(y)?y.value=c:null),"disabled-delete":l(u).length===0,loading:l(k),onAdd:l(S),onDelete:w,onRefresh:l(m),"is-view-add-button":l(W)("sys.alarm.policy.insert"),"is-view-delete-button":l(W)("sys.alarm.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:n(()=>[a(p,{"checked-row-keys":l(u),"onUpdate:checkedRowKeys":o[2]||(o[2]=c=>B(u)?u.value=c:null),columns:l(d),data:l(_),size:"small","flex-height":!l(T).isMobile,"scroll-x":962,loading:l(k),remote:"","row-key":c=>c.id,pagination:l(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Me,{visible:l(e),"onUpdate:visible":o[3]||(o[3]=c=>B(e)?e.value=c:null),"operate-type":l(v),"row-data":l(C),onSubmitted:l(m)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{dt as default};
