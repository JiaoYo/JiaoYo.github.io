import{d as J,q as H,v as Q,s as X,o as K,c as Z,w as t,g as a,h as o,t as f,i as v,$ as M,N as ee,ax as le,ao as j,ap as te,Y as ae,A as ne,B as O,E as Y,D as oe,aa as q,a0 as se,j as C,r as T,bw as B,e as ie,S as de,F as re,ay as ue,az as pe,f as ce,av as me}from"./index-D04JbMW3.js";import{l as fe}from"./lodash-282WxugM.js";import{_ as _e}from"./round-search-4GzPbRV1.js";import{_ as ge}from"./round-refresh-Cksy35cT.js";import{_ as ve}from"./Cascader-ZolH62T2.js";import{_ as he}from"./FormItemGridItem-C_Tdnpx2.js";import{_ as ye}from"./DatePicker-B0BFX8Ph.js";import{_ as be}from"./Grid-CClg_PJ_.js";import{w as Ie,x as xe}from"./events-DIrZ-tFx.js";import{b as Le}from"./common-D0gLO6r9.js";import{e as Se}from"./exportExcel-CZ2AjtLT.js";import{_ as Ce}from"./DataTable-D6P8SjIN.js";import{_ as Ee,a as De}from"./DescriptionsItem-CEEn3L9n.js";import"./TimePicker-B0v41vew.js";import"./defineProperty-BwUKmY7q.js";import"./Forward-CLXh4amU.js";const Ne={0:"KERN",1:"USER",2:"MAIL",3:"DAEMON",4:"AUTH",5:"SYSYLOG",6:"LPR",7:"NEWS",8:"UUCP",9:"CRON",10:"AUTHPRIV",11:"FTP",12:"RESERVED_12",13:"RESERVED_13",14:"RESERVED_14",15:"RESERVED_15",16:"LOCAL0",17:"LOCAL1",18:"LOCAL2",19:"LOCAL3",20:"LOCAL4",21:"LOCAL5",22:"LOCAL6",23:"LOCAL7"},ke={0:"EMERGENCY",1:"ALERT",2:"CRITICAL",3:"ERROR",4:"WARNING",5:"NOTICE",6:"INFO",7:"DEBUG"},F={logModel:Ne,logLevel:ke},we=J({name:"FormSearch",__name:"form-search",props:H(["LogSourceDeviceList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:H(["search"],["update:model"]),setup(y,{emit:E}){const N=c=>Object.entries(c).map(([d,I])=>({label:I,value:d})),L={logLevel:N(F.logLevel),logModel:N(F.logModel)},P=y,x=E,{formRef:b,restoreValidation:n}=Q(),e=X(y,"model");async function D(c,d){c&&c.length>0?(e.value.startTime=c[0],e.value.endTime=c[1]):(e.value.startTime=void 0,e.value.endTime=void 0)}async function S(){await n(),e.value.lsid=null,e.value.leid=null,e.value.lmid=null,e.value.timeRange=null,e.value.startAndEndIp=null,le(()=>{x("search")})}async function s(){var c,d,I,m;if(e.value.startAndEndIp&&e.value.startAndEndIp.length>0?(e.value.startIp=e.value.startAndEndIp[0]||null,e.value.endIp=e.value.startAndEndIp[1]||null):(e.value.startIp=void 0,e.value.endIp=void 0),e.value.startIp&&!j(e.value.startIp)||e.value.endIp&&!j(e.value.endIp))return(c=window.$message)==null||c.destroyAll(),(d=window.$message)==null||d.error("请输入正确的IP地址"),!1;if(e.value.startIp&&e.value.endIp&&te(e.value.startIp,e.value.endIp)>0)return(I=window.$message)==null||I.destroyAll(),(m=window.$message)==null||m.error("起始IP不能大于终止IP"),!1;x("search")}return(c,d)=>{const I=ve,m=he,k=ae,$=ye,U=ne,G=ge,h=O,w=_e,V=Y,l=be,i=oe,r=q;return K(),Z(r,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[a(i,{ref_key:"formRef",ref:b,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ee(s,["enter"])},{default:t(()=>[a(l,{responsive:"screen","item-responsive":""},{default:t(()=>[a(m,{span:"24 s:24 m:8",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:t(()=>[a(I,{value:e.value.lsid,"onUpdate:value":[d[0]||(d[0]=p=>e.value.lsid=p),s],placeholder:"请选择日志源设备",options:P.LogSourceDeviceList,disabled:P.logsoudev,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options","disabled"])]),_:1}),a(m,{span:"24 s:24 m:8",label:"级别",path:"leid",class:"pr-24px"},{default:t(()=>[a(k,{filterable:"",clearable:"",placeholder:"请选择级别",value:e.value.leid,"onUpdate:value":[d[1]||(d[1]=p=>e.value.leid=p),s],options:L.logLevel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(m,{span:"24 s:24 m:8",label:"日志模块",path:"lmid",class:"pr-24px"},{default:t(()=>[a(k,{filterable:"",clearable:"",placeholder:"请选择日志模块",value:e.value.lmid,"onUpdate:value":[d[2]||(d[2]=p=>e.value.lmid=p),s],options:L.logModel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(m,{span:"24 s:24 m:8",label:"时间",path:"time",class:"pr-24px mt-10px"},{default:t(()=>[a($,{value:e.value.timeRange,"onUpdate:value":d[3]||(d[3]=p=>e.value.timeRange=p),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":D},null,8,["value"])]),_:1}),a(m,{span:"24 s:24 m:8",label:"IP",path:"startAndEndIp",class:"pr-24px mt-10px"},{default:t(()=>[a(U,{pair:"",separator:"-",placeholder:["发生源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndIp,"onUpdate:value":d[4]||(d[4]=p=>e.value.startAndEndIp=p)},null,8,["value"])]),_:1}),a(m,{span:"24 m:8",class:"pr-24px mt-10px",label:" "},{default:t(()=>[a(V,{class:"w-full"},{default:t(()=>[a(h,{onClick:S},{icon:t(()=>[a(G,{class:"text-icon"})]),default:t(()=>[o(" "+f(v(M)("common.reset")),1)]),_:1}),a(h,{type:"primary",ghost:"",onClick:s},{icon:t(()=>[a(w,{class:"text-icon"})]),default:t(()=>[o(" "+f(v(M)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Re=y=>(ue("data-v-0792adcd"),y=y(),pe(),y),Ae={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Te=Re(()=>ce("hr",{style:{"border-color":"#ccc","margin-bottom":"20px"}},null,-1)),Oe=J({name:"eventalarm_generallog",__name:"index",props:{logsoudev:{}},setup(y){const E=y,N=se(),L=C([]);(async()=>{const{data:l,error:i}=await Le();i||(L.value=l.map(r=>({...r,id:"-"+r.id,type:r.cname})))})();const x=C(!1),b=F,n=T({lsid:void 0,lsdn:"",rdbtime:"",lmid:void 0,leid:void 0,ltext:"",aname:"",procid:"",msgid:"",dbtime:"",hname:"",lcon:"",ip:"",lsip:"",priority:"",type:"",version:"",logtype:void 0}),e=T({pageId:void 0,pageSize:100,lsid:void 0,leid:void 0,lmid:void 0,startTime:void 0,endTime:void 0,startIp:void 0,endIp:void 0,_t:new Date().getTime()}),D=T([{title:"",key:"key",width:80,align:"center",render:(l,i)=>`${i+1}`},{key:"type",title:"设备类型",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"hname",title:"主机名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"rdbtime",title:"接收时间",align:"center",width:160,render:l=>B(l.rdbtime)},{key:"lmid",title:"模块",align:"center",width:160,ellipsis:{tooltip:!0},render:l=>((!l.lmid===void 0||l.lmid===null)&&(l.lmid=0),b.logModel[l.lmid])},{key:"leid",title:"级别",align:"center",width:120,ellipsis:{tooltip:!0},render:l=>((l.leid===void 0||l.leid===null)&&(l.leid=0),b.logLevel[l.leid])},{key:"ipaddr",title:"发生源IP",align:"center",width:180},{key:"ltext",title:"日志原文",align:"center",width:320,ellipsis:{tooltip:!0}},{key:"operate",title:M("common.operate"),align:"center",width:120,fixed:"right",render:l=>a("div",{class:"flex-center gap-8px"},[a(O,{type:"info",ghost:!0,size:"small",onClick:()=>d(l)},{default:()=>[o("详情")]})])}]),S=C(!1),s=C([]),c=async(l=!1)=>{if(!S.value)S.value=!0;else return;E.logsoudev&&(m.value=!1,e.lsid=E.logsoudev);const{data:i,error:r}=await Ie(e);r||(l?s.value=[...s.value,...i]:s.value=i,S.value=!1)};function d(l){n.lsid=l.lsid,n.lsdn=l.lsdn,n.rdbtime=l.rdbtime,n.lmid=l.lmid,n.leid=l.leid,n.ltext=l.ltext,n.aname=l.aname,n.procid=l.procid,n.msgid=l.msgid,n.dbtime=l.dbtime,n.hname=l.hname,n.lcon=l.lcon,n.ip=l.ip,n.lsip=l.lsip,n.priority=l.priority,n.type=l.type,n.version=l.version,n.logtype=l.logtype,x.value=!0}const I=C(null),m=C(!0),k=()=>{s.value=[],e.lsid||e.leid||e.lmid||e.startIp||e.endIp||e.startTime||e.endTime?m.value=!1:(m.value=!0,w()),e.pageId=void 0,c()};c();function $(l){l.target.scrollTop+l.target.offsetHeight==l.target.scrollHeight&&h.total>s.value.length&&U()}const U=fe.debounce(()=>{if(s.value.length<h.total){if(e.pageId==s.value[s.value.length-1].id)return;e.pageId=s.value[s.value.length-1].id,c(!0)}},300);function G(l){return l.index}const h=T({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:l,endIndex:i,page:r,pageSize:p,pageCount:_,itemCount:u}){return`已加载${s.value.length}条`+(s.value.length?m.value?` 共计 ${s.value.length>0?u??0:0} 条`:s.value.length>=e.pageSize?"  预计还有更多":"":"")}});async function w(){const{data:l,error:i}=await xe({_t:new Date().getTime()});i||(h.pageCount=20,h.total=Number(l),h.itemCount=Number(l))}w();async function V(){if(!s.value.length)return;const l=JSON.parse(JSON.stringify(s.value)),i=[];l.forEach(r=>{const p={};D.forEach(_=>{var u,R,A;if(r.hasOwnProperty(_.key)){const z=_.key==="lmid"?((u=b.logModel)==null?void 0:u[r[_.key]])??null:_.key==="leid"?((R=b.logLevel)==null?void 0:R[r[_.key]])??null:_.key==="lsid"?(A=L.value.map(g=>g.data).flat(2).find(g=>g.id==r[_.key]))==null?void 0:A.type:r[_.key];p[_.title]=z}}),i.push(p)}),Se(i,500,"general-log"+new Date().getTime())}return(l,i)=>{const r=Y,p=Ce,_=q,u=Ee,R=De,A=de,z=re;return K(),ie("div",Ae,[a(we,{model:e,"onUpdate:model":i[0]||(i[0]=g=>e=g),onSearch:k,LogSourceDeviceList:L.value,logsoudev:E.logsoudev},null,8,["model","LogSourceDeviceList","logsoudev"]),a(_,{title:"通用日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[a(r,null,{default:t(()=>[a(v(O),{type:"primary",size:"small",ghost:"",onClick:V,title:"导出已加载"},{default:t(()=>[o("导出已加载")]),_:1})]),_:1})]),default:t(()=>[a(p,{ref_key:"tableContainerRef",ref:I,columns:D,data:s.value,size:"small","flex-height":!v(N).isMobile,"scroll-x":D.reduce((g,W)=>g+W.width,0),loading:S.value,remote:"","row-key":G,showTotal:"",pagination:h,class:"sm:h-full",onScroll:$},null,8,["columns","data","flex-height","scroll-x","loading","pagination"])]),_:1}),a(z,{show:x.value,"onUpdate:show":i[2]||(i[2]=g=>x.value=g),title:"日志详情",preset:"card",class:"w-800px"},{footer:t(()=>[a(r,{justify:"end",size:16},{default:t(()=>[a(v(O),{type:"primary",onClick:i[1]||(i[1]=g=>{x.value=!1})},{default:t(()=>[o(f(v(M)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[Te,a(A,{class:"h-480px pr-20px"},{default:t(()=>[a(R,{"label-placement":"left","label-style":{width:"120px"},bordered:"",column:1},{default:t(()=>[a(u,null,{label:t(()=>[o(" 设备类型 ")]),default:t(()=>[o(" "+f(n.type),1)]),_:1}),a(u,null,{label:t(()=>[o(" 接收时间 ")]),default:t(()=>[o(" "+f(v(B)(n.rdbtime)),1)]),_:1}),a(u,null,{label:t(()=>[o(" 模块 ")]),default:t(()=>[o(" "+f(v(b).logModel[n.lmid]),1)]),_:1}),a(u,null,{label:t(()=>[o(" 级别 ")]),default:t(()=>[o(" "+f(v(b).logLevel[n.leid]),1)]),_:1}),a(u,null,{label:t(()=>[o(" 应用名称 ")]),default:t(()=>[o(" "+f(n.aname),1)]),_:1}),a(u,null,{label:t(()=>[o(" PROCID ")]),default:t(()=>[o(" "+f(n.procid),1)]),_:1}),a(u,null,{label:t(()=>[o(" MSGID ")]),default:t(()=>[o(" "+f(n.msgid||"--"),1)]),_:1}),a(u,null,{label:t(()=>[o(" 日志时间 ")]),default:t(()=>[o(" "+f(v(B)(n.dbtime)),1)]),_:1}),a(u,null,{label:t(()=>[o(" 主机名称 ")]),default:t(()=>[o(" "+f(n.hname),1)]),_:1}),a(u,null,{label:t(()=>[o(" 结构数据 ")]),default:t(()=>[o(" -- ")]),_:1}),a(u,null,{label:t(()=>[o(" 日志内容 ")]),default:t(()=>[o(" "+f(n.lcon),1)]),_:1}),a(u,{span:2},{label:t(()=>[o(" 日志原文 ")]),default:t(()=>[o(" "+f(n.logtype?n.ltext:n.ltext+n.lcon),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),Qe=me(Oe,[["__scopeId","data-v-0792adcd"]]);export{Qe as default};
