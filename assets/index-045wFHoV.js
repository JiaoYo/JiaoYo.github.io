import{_ as he}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CcpTnhnc.js";import{_ as je}from"./refresh-C0ltCUtv.js";import{d as M,q as ye,s as xe,x as ve,E as F,o as V,c as Ce,w as r,g as o,F as A,h as z,t as G,i as l,$ as O,G as be,K as we,B as I,O as K,P as Ne,ad as Pe,du as Le,a5 as ke,j as $,ae as Se,f as B,aa as $e,S as ge,ar as Re,Q as ze,R as De,T as Ee,a4 as Te,X as Be,r as ce,aZ as Ie,e as Fe,ah as me,bl as Ae,aF as Ke,aj as Oe}from"./index-D7mQqpt0.js";import{a as Ge,c as Me,d as Ve,e as _e,g as Ue}from"./reportForm-BQsaUyFw.js";import{u as Je}from"./table-CunGwkLE.js";import{_ as qe}from"./round-search-Dx84b4UW.js";import{_ as We}from"./round-refresh-Cb-JvNfU.js";import{_ as He}from"./lodash-BOEMR3ZM.js";import{_ as Qe}from"./FormItemGridItem-CRYgfShT.js";import{_ as Xe}from"./Grid-2onT2uBK.js";import{T as Ze}from"./task-DfpAsuVr.js";import{_ as Ye,a as ea,b as aa,c as ta}from"./file-pdf-OPnm3NLO.js";import{_ as fe}from"./Popconfirm-YDyWYnSc.js";import"./setting-outlined-pWlFd9sX.js";import"./echarts.vue_vue_type_script_setup_true_lang-CYtK-aor.js";import"./index-BS8KoN7o.js";import"./installCanvasRenderer-iCPGNWhM.js";const oa=M({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:ye(["reset","search"],["update:model"]),setup(b,{emit:D}){const E=D,{formRef:_,restoreValidation:w}=xe(),d=ve(b,"model"),R=()=>{d.value.fuzzy="",h()};async function g(){await w(),E("reset")}async function h(){E("search")}const N=He.throttle(h,1e3,{trailing:!1});return(v,T)=>{const C=we,t=Qe,e=We,u=I,p=qe,j=K,L=Xe,k=Ne,S=Pe,n=F("no-space");return V(),Ce(S,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[o(k,{ref_key:"formRef",ref:_,model:d.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:be(l(N),["enter"])},{default:r(()=>[o(L,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:r(()=>[o(t,{span:"24 s:12 m:8 l:6",label:"实例名称",path:"alatype"},{default:r(()=>[A(o(C,{autofocus:"",value:d.value.fuzzy,"onUpdate:value":T[0]||(T[0]=s=>d.value.fuzzy=s),placeholder:"请输入实例名称关键字",clearable:"",onClear:R},null,8,["value"]),[[n]])]),_:1}),o(t,{span:"24 s:12 m:8 l:6"},{default:r(()=>[o(j,{class:"w-full"},{default:r(()=>[o(u,{onClick:g},{icon:r(()=>[o(e,{class:"text-icon"})]),default:r(()=>[z(" "+G(l(O)("common.reset")),1)]),_:1}),o(u,{type:"primary",ghost:"",onClick:l(N)},{icon:r(()=>[o(p,{class:"text-icon"})]),default:r(()=>[z(" "+G(l(O)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),na=b=>(ze("data-v-048aad99"),b=b(),De(),b),sa=na(()=>B("span",{class:"mr-20px"},"报表预览",-1)),la={title:"导出PDF"},ra={title:"导出Word"},ua={title:"导出Excel"},ia=M({name:"reportPreview",__name:"reportPreview",props:ye({data:{},detaliParams:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(b){Le(t=>({"9771e606":l(E)}));const D=ke(),E=D.themeScheme=="dark"?"#001428":"#fff",_=b,w=ve(b,"visible"),d=$([]),R=async t=>{const{data:e,error:u}=await Ge({rtype:t});u||(e.forEach(p=>{p.rtext=JSON.parse(p.rtext)}),d.value=e[0].rtext)},g=["一般","低级","中级","高级","严重"],h=["#99CC00","#1e90ff","#FF9900","#FF6666","#CC0033"],N=$(),v=$(""),T=async()=>{if(_.detaliParams.rtype=1,_.detaliParams.rtype==0)await R(0),d.value.forEach(t=>{t.type=="chart"&&t.dataName=="assetType"&&(t.value.data.series[0].data=Object.entries(_.data.assetType).map(([e,u],p)=>({value:u,name:e}))),t.type=="table"&&t.dataName=="baseInfo"&&(t.value.body=_.data.baseInfo.map(e=>t.value.tableHeaderValue.map(u=>e[u])))}),N.value=d.value,v.value=_.detaliParams.name+"_资产信息表";else if(_.detaliParams.rtype==1){await R(1),v.value=_.detaliParams.name+"_审计信息表";const t=_.data;d.value.forEach(e=>{var u,p,j,L,k,S,n,s,c,m,f,x,P,U,J,q,W,H,Q,X,Z,Y,ee,ae,te,oe,ne,se,le,re,ue,ie,de;e.type=="chart"&&(e.dataName=="secureCountPojo"&&(e.value.data.series[0].data=g.map((a,y)=>{const i=`e${y+1}`;return{value:t.secureCountPojo[i]==0||t.secureCountPojo[i]==null?null:t.secureCountPojo[i],name:a,itemStyle:{color:h[y]}}})),e.dataName=="secureCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data=(p=(u=t.secureCountPojo)==null?void 0:u.typeCountPojoList)==null?void 0:p.map(a=>a.tname),e.value.data.series[0].data=(L=(j=t.secureCountPojo)==null?void 0:j.typeCountPojoList)==null?void 0:L.map(a=>a.tcount)),e.dataName=="secureCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(S=(k=t.secureCountPojo)==null?void 0:k.dayCountPojoList)==null?void 0:S.map(a=>a.date.substring(0,10)),e.value.data.series[0].data=(s=(n=t.secureCountPojo)==null?void 0:n.dayCountPojoList)==null?void 0:s.map(a=>a.dailycount)),e.dataName=="auditCountPojo"&&(e.value.data.series[0].data=g.map((a,y)=>{const i=`e${y+1}`;return{value:t.auditCountPojo[i]==0||t.auditCountPojo[i]==null?null:t.auditCountPojo[i],name:a,itemStyle:{color:h[y]}}})),e.dataName=="auditCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data=(m=(c=t.auditCountPojo)==null?void 0:c.typeCountPojoList)==null?void 0:m.map(a=>a.tname),e.value.data.series[0].data=(x=(f=t.auditCountPojo)==null?void 0:f.typeCountPojoList)==null?void 0:x.map(a=>a.tcount)),e.dataName=="auditCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(U=(P=t.auditCountPojo)==null?void 0:P.dayCountPojoList)==null?void 0:U.map(a=>a.date.substring(0,10)),e.value.data.series[0].data=(q=(J=t.auditCountPojo)==null?void 0:J.dayCountPojoList)==null?void 0:q.map(a=>a.dailycount)),e.dataName=="alarmCountPojo"&&(e.value.data.series[0].data=g.map((a,y)=>{const i=`e${y+1}`;return{value:t.alarmCountPojo[i]==0||t.alarmCountPojo[i]==null?null:t.alarmCountPojo[i],name:a,itemStyle:{color:h[y]}}})),e.dataName=="alarmCountPojo_typeCountPojoList"&&(e.value.data.xAxis.data=(H=(W=t.alarmCountPojo)==null?void 0:W.typeCountPojoList)==null?void 0:H.map(a=>a.tname),e.value.data.series[0].data=(X=(Q=t.alarmCountPojo)==null?void 0:Q.typeCountPojoList)==null?void 0:X.map(a=>a.tcount)),e.dataName=="alarmCountPojo_dayCountPojoList"&&(e.value.data.xAxis.data=(Y=(Z=t.alarmCountPojo)==null?void 0:Z.dayCountPojoList)==null?void 0:Y.map(a=>a.date.substring(0,10)),e.value.data.series[0].data=(ae=(ee=t.alarmCountPojo)==null?void 0:ee.dayCountPojoList)==null?void 0:ae.map(a=>a.dailycount))),e.type=="table"&&(e.dataName==""&&(e.value.body=[["安全事件",t.e1],["审计事件",t.e3],["告警事件",t.e4]]),e.dataName=="secureCountPojo"&&(e.value.body=g.map((a,y)=>{const i=t.secureCountPojo[`e${y+1}`];return[a,i]})),e.dataName=="secureCountPojo_typeCountPojoList"&&(e.value.body=(oe=(te=t.secureCountPojo)==null?void 0:te.typeCountPojoList)==null?void 0:oe.map(a=>[a.tname,a.tcount])),e.dataName=="secureCountPojo_dayCountPojoList"&&(e.value.body=(ne=t.secureCountPojo.dayCountPojoList)==null?void 0:ne.map(a=>[a.date.substring(0,10),a.dailycount])),e.dataName=="auditCountPojo"&&(e.value.body=g.map((a,y)=>{const i=t.auditCountPojo[`e${y+1}`];return[a,i]})),e.dataName=="auditCountPojo_typeCountPojoList"&&(e.value.body=(le=(se=t.auditCountPojo)==null?void 0:se.typeCountPojoList)==null?void 0:le.map(a=>[a.tname,a.tcount])),e.dataName=="auditCountPojo_dayCountPojoList"&&(e.value.body=(re=t.auditCountPojo.dayCountPojoList)==null?void 0:re.map(a=>[a.date.substring(0,10),a.dailycount])),e.dataName=="alarmCountPojo"&&(e.value.body=g.map((a,y)=>{const i=t.alarmCountPojo[`e${y+1}`];return[a,i]})),e.dataName=="alarmCountPojo_typeCountPojoList"&&(e.value.body=(ie=(ue=t.alarmCountPojo)==null?void 0:ue.typeCountPojoList)==null?void 0:ie.map(a=>[a.tname,a.tcount])),e.dataName=="alarmCountPojo_dayCountPojoList"&&(e.value.body=(de=t.alarmCountPojo.dayCountPojoList)==null?void 0:de.map(a=>[a.date.substring(0,10),a.dailycount])))}),N.value=d.value}};Se(w,()=>{w.value&&T()});const C=$();return(t,e)=>{const u=Ye,p=ea,j=aa,L=ta,k=ge,S=Re;return V(),Ce(S,{show:w.value,"onUpdate:show":e[3]||(e[3]=n=>w.value=n),preset:"card",class:"w-1000px reportPreview",style:$e({"background-color":l(D).themeScheme=="dark"?"#001428":"#fff"})},{header:r(()=>[sa,B("span",la,[o(u,{class:"text-32px c-#d63031 cursor-pointer",onClick:e[0]||(e[0]=n=>C.value.toPdf(v.value))})]),B("span",ra,[o(p,{class:"text-32px c-#1e90ff cursor-pointer",onClick:e[1]||(e[1]=n=>C.value.toWord(v.value))})]),B("span",ua,[o(j,{class:"text-32px c-#15703d cursor-pointer",onClick:e[2]||(e[2]=n=>C.value.toExcel(v.value))})])]),default:r(()=>[o(k,{class:"max-h-600px"},{default:r(()=>[o(L,{ref_key:"filePreviewExportRef",ref:C,width:800,data:N.value},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),da=Ee(ia,[["__scopeId","data-v-048aad99"]]),pa={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ca=B("div",{style:{display:"flex","align-items":"center"}},[B("div",null,"报表实例")],-1),$a=M({name:"reportmanagement_reportlist",__name:"index",setup(b){const D=Te(),{columns:E,columnChecks:_,data:w,getData:d,loading:R,mobilePagination:g,searchParams:h,resetSearchParams:N}=Je({apiFn:Me,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:n=>!0,renderExpand:n=>o("div",{class:"detailList"},[o(ge,{style:"max-height: 360px"},{default:()=>[C.value.length>0?C.value.map((s,c)=>o(K,{justify:"space-between",style:{marginBottom:"8px",padding:"0px 50px 8px 50px",borderBottom:c!==C.value.length-1?"1px dashed #ccc":"none"},key:s.sn},{default:()=>[o("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[s.sn]),o(K,null,{default:()=>[A(o(I,{type:"info",size:"small",ghost:!0,onClick:()=>L(s.sn,n.rtype)},{default:()=>[z("查看")]}),[[F("no-auth"),"sys.report.instance.select"]]),o(fe,{onPositiveClick:()=>S(s.sn,n.rtype,n.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>A(o(I,{type:"error",size:"small",ghost:!0},{default:()=>[z("删除")]}),[[F("no-auth"),"sys.report.instance.delete"]])})]})]})):o("div",{style:{textAlign:"center",padding:"10px"}},[z("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:n=>{var s;return o("div",null,[(s=Be(Ze).find(c=>c.value===n.rtype))==null?void 0:s.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:O("common.operate"),align:"center",width:160,render:n=>o("div",{class:"flex-center gap-8px"},[o(fe,{onPositiveClick:()=>k(n.tid,n.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>A(o(I,{type:"primary",ghost:!0,size:"small"},{default:()=>[z("清空")]}),[[F("no-auth"),"sys.report.instance.delete"]])})])}]}),v=$([]),T=n=>{v.value=[n[n.length-1]],v.value[0]&&(C.value=[],e())},C=$([]),t=ce({page:1,limit:10}),e=async()=>{const n=JSON.parse(JSON.stringify(w.value)).find(m=>m.tid===v.value[0]),{data:s,error:c}=await Ue({tid:v.value[0],page:t.page,limit:Number(n.num)||10});c||(C.value=s.list,Ke(()=>{const m=document.querySelector(".detailList");if(m){const{height:f}=m.getBoundingClientRect();m.animate([{height:"0px"},{height:`${f}px`}],{duration:300,easing:"linear"})}}))},u=$(!1),p=$({}),j=ce({name:"",rtype:0}),L=async(n,s)=>{var f;const{data:c,error:m}=await Ve({name:n,type:s,tid:v.value[0]});j.name=n,j.rtype=s,m||(u.value=!0,p.value=JSON.parse(c),p.value.baseInfo=(f=p.value.baseInfo)==null?void 0:f.map(x=>({...x,dbtime:Ie(1,x.dbtime)})))},k=async(n,s)=>{var f;const{data:c,error:m}=await _e({tid:n,type:s});m||((f=window.$message)==null||f.success("清空成功"),d())},S=async(n,s,c)=>{var x;const{data:m,error:f}=await _e({fname:n,type:s,tid:c});f||((x=window.$message)==null||x.success("删除成功"),d(),e())};return(n,s)=>{const c=je,m=he,f=Oe,x=Pe;return V(),Fe("div",pa,[o(oa,{model:l(h),"onUpdate:model":s[0]||(s[0]=P=>me(h)?h.value=P:null),onReset:l(N),onSearch:l(d)},null,8,["model","onReset","onSearch"]),o(x,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:r(()=>[ca]),"header-extra":r(()=>[o(l(K),null,{default:r(()=>[o(l(I),{size:"small",onClick:s[1]||(s[1]=P=>l(d)())},{icon:r(()=>[o(c,{class:Ae(["text-icon",{"animate-spin":l(R)}])},null,8,["class"])]),default:r(()=>[z(" "+G(l(O)("common.refresh")),1)]),_:1}),o(m,{columns:l(_),"onUpdate:columns":s[2]||(s[2]=P=>me(_)?_.value=P:null)},null,8,["columns"])]),_:1})]),default:r(()=>[o(f,{columns:l(E),data:l(w),size:"small","flex-height":!l(D).isMobile,"scroll-x":962,loading:l(R),remote:"","row-key":P=>P.tid,pagination:l(g),class:"sm:h-full","expanded-row-keys":v.value,"onUpdate:expandedRowKeys":T},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),o(da,{visible:u.value,"onUpdate:visible":s[3]||(s[3]=P=>u.value=P),data:p.value,detaliParams:j},null,8,["visible","data","detaliParams"])]),_:1})])}}});export{$a as default};
