import{_ as ze}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BUKSABy7.js";import{d as ie,q as se,x as ve,s as ge,v as be,b as Te,r as re,j as W,ae as pe,E as ae,o as R,c as A,w as t,g as e,h as b,t as X,i as o,$ as w,F as J,X as te,H as I,G as he,aB as ye,be as Ae,a2 as de,K as ce,a0 as we,ap as $e,as as Pe,O as Q,aq as Fe,P as ue,B as H,ar as ke,ad as Ce,a4 as je,b0 as me,e as qe,ah as ee,ai as Oe,aj as Ve,L as Me,S as Be}from"./index-ClauSBeM.js";import{u as Ee,a as Ie}from"./table-B4UxM38A.js";import{h as Ge,k as Ke,l as Ne,m as Le,n as He,o as We,p as Xe,q as Je}from"./Collection-DR1yMFyh.js";import{C as Qe,c as Se,d as Ye,e as Ze}from"./collection-DNgRauOc.js";import{r as ea}from"./asset-CBZQNnzg.js";import{u as aa}from"./usePageData-CLFW4LvR.js";import{_ as De}from"./FormItemGridItem-Bkp7d801.js";import{_ as ta}from"./Cascader-D9Wjyddr.js";import{_ as Ue}from"./Grid-CUJzRed2.js";import{_ as la}from"./round-search-Da1i9mIT.js";import{_ as na}from"./round-refresh-Cl1S1sFo.js";import{_ as oa}from"./lodash-gDW8amFC.js";import{_ as sa}from"./DatePicker-DOuxM_7-.js";import{h as fe}from"./permission-i8fqamoe.js";import{_ as ra}from"./Popconfirm-DV82iAbv.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DrMa0Anc.js";import"./setting-outlined-bIsSxdRG.js";import"./export-DieFT_MY.js";import"./refresh-D10u-1xZ.js";import"./round-delete-CoS8u3XE.js";import"./round-plus-MiUPkZaP.js";import"./Upload-Cl4-vvin.js";import"./Progress-BfqSg8RF.js";import"./TimePicker-BL4syJdD.js";import"./defineProperty-UrT_uKs3.js";const da=ie({name:"CollectorModal",__name:"collector_modal",props:se({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:se(["submitted"],["update:visible"]),setup(S,{emit:Y}){const g=S,q=Y,D=ve(S,"visible"),{formRef:O,validate:c,restoreValidation:z}=ge(),{createConfirmPwdRule:U,defaultRequiredRule:x,patternRules:Z}=be(),h=Te(()=>({add:"新增采集器",edit:"编辑采集器"})[g.operateType]),a=re(V());function V(){return{id:void 0,cname:"",cencode:0,accmed:1,proser:void 0,caddr:"",logsoudev:void 0,filterpro:void 0,cdesc:"",proper:0,enable:0,ctime:void 0,rev:void 0,port:void 0,uname:void 0,pswd:void 0,fpath:void 0}}const M={cname:x,caddr:[{required:!0,message:"请输入采集器地址",trigger:["blur","input"]},{required:!0,validator:ye,trigger:["blur","input"]}],rev:x,port:{required:!0,trigger:["blur","input"],validator:(u,l,p)=>l?Ae(l)?!0:new Error("请输入在0-65535之间的数字"):new Error("请输入端口号")},uname:x,pswd:x,cencode:{type:"number",required:!0,trigger:["blur","change"],message:"请选择编码格式"},accmed:{type:"number",required:!0,trigger:["blur","change"],message:"请选择接入方式"},logsoudev:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源设备"}},{pageData:T,getData:f,nextPage:_}=aa(Ge),$=async u=>{const l=u.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&T.data.length<T.total&&_()},y=W(),G=async()=>{const{data:u,error:l}=await Le();y.value=u.map(p=>({...p,id:"-"+p.id,type:p.cname}))};function k(){G(),f(),Object.assign(a,V()),g.operateType==="edit"&&g.rowData&&(console.log("props.rowData",g.rowData),Object.assign(a,g.rowData),F.clickNums=1)}function P(){D.value=!1}const F=re({clickNums:0,isLoading:!1});async function K(){var l,p,d,i,j;await c();const u={};if(a.uname&&a.pswd&&Object.assign(u,{uname:de(a.uname),pswd:de(a.pswd)}),g.operateType==="add"){const{data:B,error:C}=await Ke([{...a,...u}]);if(!C&&((l=window.$message)==null||l.success("采集器添加成功"),P(),q("submitted"),a.proper==0)){const n=await ea([{aname:a.cname,aip:a.caddr,tid:36,cid:B}]);n.error&&((p=n.error.response)==null?void 0:p.data.msg)=="数据库中已存在该记录"&&((d=window.$message)==null||d.destroyAll(),(i=window.$message)==null||i.error("资产添加失败,请前往资产管理进行修改"))}}else{const{data:B,error:C}=await Ne([{...a,...u}]);C||((j=window.$message)==null||j.success(w("common.updateSuccess")),P(),q("submitted"))}}const L=u=>{Object.assign(a,{logsoudev:void 0,rev:void 0,port:void 0,uname:void 0,pswd:void 0}),u==4&&(a.logsoudev=53),a.port=u==5?22:null};return pe(D,()=>{D.value&&(k(),z())}),pe(()=>a.caddr,()=>{F.clickNums=0}),(u,l)=>{const p=ce,d=De,i=we,j=ta,B=$e,C=Pe,n=Q,s=Fe,m=Ue,N=ue,E=H,le=Q,ne=ke,oe=ae("no-space");return R(),A(ne,{show:D.value,"onUpdate:show":l[13]||(l[13]=r=>D.value=r),title:h.value,preset:"card",class:"w-850px"},{footer:t(()=>[e(le,{size:16,justify:"end"},{default:t(()=>[e(E,{onClick:P},{default:t(()=>[b(X(o(w)("common.cancel")),1)]),_:1}),e(E,{type:"primary",onClick:K},{default:t(()=>[b(X(o(w)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(N,{ref_key:"formRef",ref:O,model:a,rules:M,"label-placement":"left","label-width":120,onKeyup:he(K,["enter"])},{default:t(()=>[e(m,{responsive:"screen","item-responsive":"","x-gap":20},{default:t(()=>[e(d,{span:"24 s:12 m:12",label:"采集器名称",path:"cname"},{default:t(()=>[J(e(p,{value:a.cname,"onUpdate:value":l[0]||(l[0]=r=>a.cname=r),placeholder:"请输入采集器名称",clearable:""},null,8,["value"]),[[oe]])]),_:1}),e(d,{span:"24 s:12 m:12",label:"编码格式",path:"cencode"},{default:t(()=>[e(i,{value:a.cencode,"onUpdate:value":l[1]||(l[1]=r=>a.cencode=r),placeholder:"请选择编码格式",filterable:"",clearable:"",options:o(te)(o(Qe))},null,8,["value","options"])]),_:1}),e(d,{span:"24 s:12 m:12",label:"接入方式",path:"accmed"},{default:t(()=>[e(i,{value:a.accmed,"onUpdate:value":[l[2]||(l[2]=r=>a.accmed=r),L],placeholder:"请选择接入方式",filterable:"",clearable:"",disabled:u.operateType==="edit",options:o(te)(o(Se))},null,8,["value","disabled","options"])]),_:1}),e(d,{span:"24 s:12 m:12",label:"采集地址",path:"caddr"},{default:t(()=>[e(p,{value:a.caddr,"onUpdate:value":l[3]||(l[3]=r=>a.caddr=r),placeholder:"请输入采集地址",clearable:""},null,8,["value"])]),_:1}),[0,1,7,8].includes(a.accmed)?(R(),A(d,{key:0,span:"24 s:12 m:12",label:"日志源设备",path:"logsoudev"},{default:t(()=>[e(j,{value:a.logsoudev,"onUpdate:value":l[4]||(l[4]=r=>a.logsoudev=r),placeholder:"请选择日志源设备",options:y.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"","show-path":!1},null,8,["value","options"])]),_:1})):I("",!0),e(d,{span:"24 s:12 m:12",label:"过滤策略",path:"filterpro"},{default:t(()=>[e(i,{clearable:"",filterable:"",value:a.filterpro,"onUpdate:value":l[5]||(l[5]=r=>a.filterpro=r),placeholder:"请选择过滤策略",options:o(T).data,"value-field":"id","label-field":"pname","reset-menu-on-options-change":!1,onScroll:$},null,8,["value","options"])]),_:1}),[3,7,8].includes(a.accmed)?(R(),A(d,{key:1,span:"24 s:12 m:12",label:a.accmed==3?"数据库名称":a.accmed==4?"域名":(a.accmed==7,"目录"),path:"rev"},{default:t(()=>[e(p,{value:a.rev,"onUpdate:value":l[6]||(l[6]=r=>a.rev=r),placeholder:"请输入",clearable:""},null,8,["value"])]),_:1},8,["label"])):I("",!0),[3,4,5,7,8].includes(a.accmed)?(R(),A(d,{key:2,span:"24 s:12 m:12",label:"端口",path:"port"},{default:t(()=>[e(B,{value:a.port,"onUpdate:value":l[7]||(l[7]=r=>a.port=r),placeholder:"请输入端口",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1})):I("",!0),[3,4,5,7,8,9].includes(a.accmed)?(R(),A(d,{key:3,span:"24 s:12 m:12",label:"用户名",path:"uname"},{default:t(()=>[e(p,{value:a.uname,"onUpdate:value":l[8]||(l[8]=r=>a.uname=r),placeholder:"请输入用户名",clearable:""},null,8,["value"])]),_:1})):I("",!0),[3,4,5,7,8,9].includes(a.accmed)?(R(),A(d,{key:4,span:"24 s:12 m:12",label:"密码",path:"pswd"},{default:t(()=>[e(p,{type:"password","show-password-on":"click",value:a.pswd,"onUpdate:value":l[9]||(l[9]=r=>a.pswd=r),placeholder:"请输入密码",clearable:""},null,8,["value"])]),_:1})):I("",!0),u.operateType=="add"?(R(),A(d,{key:5,span:"24 s:12 m:12",label:"生成资产",path:"proper"},{default:t(()=>[e(s,{value:a.proper,"onUpdate:value":l[10]||(l[10]=r=>a.proper=r),name:"radiogroup"},{default:t(()=>[e(n,null,{default:t(()=>[e(C,{value:0},{default:t(()=>[b("是")]),_:1}),e(C,{value:1},{default:t(()=>[b("否")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})):I("",!0),e(d,{span:"24 s:12 m:12",label:"是否启用",path:"enable"},{default:t(()=>[e(s,{value:a.enable,"onUpdate:value":l[11]||(l[11]=r=>a.enable=r),name:"radiogroup",disabled:u.operateType=="edit"},{default:t(()=>[e(n,null,{default:t(()=>[e(C,{value:0},{default:t(()=>[b("是")]),_:1}),e(C,{value:1},{default:t(()=>[b("否")]),_:1})]),_:1})]),_:1},8,["value","disabled"])]),_:1}),e(d,{span:"24 s:24 m:24",label:"描述",path:"cdesc"},{default:t(()=>[e(p,{type:"textarea",value:a.cdesc,"onUpdate:value":l[12]||(l[12]=r=>a.cdesc=r),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),ia=ie({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:se(["reset","search"],["update:model"]),setup(S,{emit:Y}){const g=Y,{formRef:q,restoreValidation:D}=ge(),O={caddr:[{validator:ye,trigger:["change","input"]}]},c=ve(S,"model");W(!1);const z=W(null);async function U(f,_){f&&f.length>0?(c.value.startTime=f[0],c.value.endTime=f[1]):(c.value.startTime=void 0,c.value.endTime=void 0),M()}function x(f){c.value.enable=f,g("search")}function Z(f){c.value.accmed=f,g("search")}function h(){c.value.fuzzy=void 0,g("search")}function a(){c.value.caddr=void 0,g("search")}async function V(){await D(),z.value=null,g("reset")}async function M(){g("search")}const T=oa.throttle(M,1e3,{trailing:!1});return(f,_)=>{const $=ce,y=De,G=we,k=sa,P=na,F=H,K=la,L=Q,u=Ue,l=ue,p=Ce,d=ae("no-space");return R(),A(p,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(l,{ref_key:"formRef",ref:q,model:c.value,"label-placement":"left",rules:O,"label-width":"100px",onKeyup:he(o(T),["enter"]),"show-require-mark":!1},{default:t(()=>[e(u,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:t(()=>[e(y,{span:"24 s:12 m:8 l:6",label:"采集器名称",path:"fuzzy","show-feedback":!1},{default:t(()=>[J(e($,{clearable:"",value:c.value.fuzzy,"onUpdate:value":_[0]||(_[0]=i=>c.value.fuzzy=i),placeholder:"请输入采集器名称",onClear:h},null,8,["value"]),[[d]])]),_:1}),e(y,{span:"24 s:12 m:8 l:6",label:"采集地址",path:"caddr"},{default:t(()=>[J(e($,{clearable:"",value:c.value.caddr,"onUpdate:value":_[1]||(_[1]=i=>c.value.caddr=i),onClear:a,placeholder:"请输入采集地址"},null,8,["value"]),[[d]])]),_:1}),e(y,{span:"24 s:12 m:8 l:6",label:"接入方式",path:"accmed","show-feedback":!1},{default:t(()=>[e(G,{clearable:"",filterable:"",value:c.value.accmed,"onUpdate:value":_[2]||(_[2]=i=>c.value.accmed=i),placeholder:"请选择接入方式",options:o(te)(o(Se)),onUpdateValue:Z,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(y,{span:"24 s:12 m:8 l:6",label:"状态",path:"enable","show-feedback":!1},{default:t(()=>[e(G,{clearable:"",filterable:"",value:c.value.enable,"onUpdate:value":_[3]||(_[3]=i=>c.value.enable=i),placeholder:"请选择状态",options:o(te)(o(Ye)),onUpdateValue:x,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(y,{span:"24 s:16 m:16 l:8",label:"创建时间",path:"enable","show-feedback":!1},{default:t(()=>[e(k,{value:z.value,"onUpdate:value":_[4]||(_[4]=i=>z.value=i),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":U},null,8,["value"])]),_:1}),e(y,{span:"24 s:8 m:8 l:6","show-feedback":!1},{default:t(()=>[e(L,{class:"w-full",align:"center"},{default:t(()=>[e(F,{onClick:V},{icon:t(()=>[e(P,{class:"text-icon"})]),default:t(()=>[b(" "+X(o(w)("common.reset")),1)]),_:1}),e(F,{type:"primary",ghost:"",onClick:o(T)},{icon:t(()=>[e(K,{class:"text-icon"})]),default:t(()=>[b(" "+X(o(w)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),ca={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function _e(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Oe(S)}const qa=ie({name:"collectionmanagement_collector",__name:"index",setup(S){const{createConfirmPwdRule:Y,defaultRequiredRule:g,patternRules:q}=be(),D=je(),{columns:O,columnChecks:c,data:z,getData:U,loading:x,mobilePagination:Z,searchParams:h,resetSearchParams:a}=Ee({apiFn:He,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,caddr:null,enable:null,accmed:null,startTime:null,endTime:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"cname",title:"采集器名称",align:"center",width:200},{key:"caddr",title:"采集地址",align:"center",width:200},{key:"accmed",title:"接入方式",align:"center",width:160,render:n=>{const s=Ze;return e("span",null,[b(" "),s[n.accmed]])}},{key:"pname",title:"过滤策略",align:"center",width:160},{key:"type",title:"日志源设备",align:"center",width:200},{key:"ctime",title:"创建时间",align:"center",width:200},{key:"enable",title:"状态",align:"center",width:160,render:n=>e(Q,{justify:"center"},{default:()=>[n.accmed==4?e(me,{value:n.enable,"onUpdate:value":[s=>n.enable=s,()=>M(n)],checkedValue:0,uncheckedValue:1},{checked:()=>e("span",null,[b("启用")]),unchecked:()=>e("span",null,[b("禁用")])}):e(me,{value:n.enable,"onUpdate:value":[s=>n.enable=s,()=>T(n)],checkedValue:0,uncheckedValue:1},{checked:()=>e("span",null,[b("启用")]),unchecked:()=>e("span",null,[b("禁用")])})]})},{key:"operate",title:w("common.operate"),align:"center",width:130,fixed:"right",render:n=>{let s;return e("div",{class:"flex-center gap-8px"},[J(e(H,{type:"primary",ghost:!0,size:"small",onClick:()=>l(n.id)},_e(s=w("common.edit"))?s:{default:()=>[s]}),[[ae("no-auth"),"sys.collection.mengement.update"]]),e(ra,{onPositiveClick:()=>u(n.id)},{default:()=>w("common.confirmDelete"),trigger:()=>{let m;return J(e(H,{type:"error",ghost:!0,size:"small"},_e(m=w("common.delete"))?m:{default:()=>[m]}),[[ae("no-auth"),"sys.collection.mengement.delete"]])}})])}}]}),V=()=>{h.caddr=h.caddr==""?void 0:h.caddr,h.fuzzy=h.fuzzy==""?void 0:h.fuzzy,U()},M=async n=>{var m;const s={id:n.id,enable:n.enable,ip:n.enable==1?n.caddr:void 0};try{const{data:N,error:E}=await We(s);E||((m=window.$message)==null||m.success(n.enable==1?"禁用成功":"启用成功"),U())}catch{n.enable=n.enable==1?0:1}},T=async n=>{var s;try{const{data:m,error:N}=await Ne([n]);N||((s=window.$message)==null||s.success(n.enable==1?"禁用成功":"启用成功"),U())}catch{n.enable=n.enable==1?0:1}},{drawerVisible:f,operateType:_,editingData:$,handleAdd:y,handleEdit:G,checkedRowKeys:k,onBatchDeleted:P,onDeleted:F,closeDrawer:K}=Ie(z,U);async function L(){console.log(k.value),p(k.value.join(","),n=>{P()})}function u(n){p(n,s=>{F()})}function l(n){_.value="edit",i.id=n,d.value=!0}async function p(n,s){const m=await Xe(n,1);console.log("data",m),s&&s(m)}const d=W(!1),i=re({id:void 0,pwd:""}),j=W(null),B={pwd:[{required:!0,message:"请输入密码",trigger:"blur"},q.passwordL]},C=async()=>{var N;await((N=j.value)==null?void 0:N.validate());const n=de(i.pwd),{data:s,error:m}=await Je(i.id,n);m||($.value=s,d.value=!1,f.value=!0,i.pwd="")};return(n,s)=>{const m=ze,N=Ve,E=Ce,le=ce,ne=Me,oe=ue,r=Be,xe=ke;return R(),qe("div",ca,[e(ia,{model:o(h),"onUpdate:model":s[0]||(s[0]=v=>ee(h)?h.value=v:null),onReset:o(a),onSearch:V},null,8,["model","onReset"]),e(E,{title:"采集器管理",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":t(()=>[e(m,{columns:o(c),"onUpdate:columns":s[1]||(s[1]=v=>ee(c)?c.value=v:null),"disabled-delete":o(k).length===0,"is-view-add-button":o(fe)("sys.collection.mengement.insert"),"is-view-delete-button":o(fe)("sys.collection.mengement.delete"),loading:o(x),onAdd:o(y),onDelete:L,onRefresh:o(U)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:t(()=>[e(N,{"checked-row-keys":o(k),"onUpdate:checkedRowKeys":s[2]||(s[2]=v=>ee(k)?k.value=v:null),columns:o(O),data:o(z),size:"small","flex-height":!o(D).isMobile,"scroll-x":o(O).reduce((v,Re)=>v+Re.width,0),loading:o(x),remote:"","row-key":v=>v.id,pagination:o(Z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(da,{visible:o(f),"onUpdate:visible":s[3]||(s[3]=v=>ee(f)?f.value=v:null),"operate-type":o(_),"row-data":o($),onSubmitted:o(U)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1}),e(xe,{show:d.value,"onUpdate:show":s[5]||(s[5]=v=>d.value=v),title:"编辑采集器信息",preset:"card",class:"w-420px"},{footer:t(()=>[e(o(Q),{justify:"end",size:16},{default:t(()=>[e(o(H),{type:"primary",onClick:C},{default:t(()=>[b(X(o(w)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(r,{class:"max-h-480px pr-20px"},{default:t(()=>[e(oe,{ref_key:"checkformRef",ref:j,model:i,"label-placement":"left",rules:B,"label-width":80,"require-mark-placement":"left"},{default:t(()=>[e(ne,{label:o(w)("page.login.common.password"),path:"pwd"},{default:t(()=>[e(le,{type:"password","show-password-on":"click",clearable:"",value:i.pwd,"onUpdate:value":s[4]||(s[4]=v=>i.pwd=v),placeholder:"请输入当前登录账号密码"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}});export{qa as default};
