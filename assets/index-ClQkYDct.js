import{_ as X}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BHdjnJGE.js";import{d as j,q as P,s as E,v as G,x as Y,b as Z,$ as a,r as ee,y as te,L as A,o as q,c as L,w as n,g as t,h as F,t as M,i as e,M as B,A as W,C as ae,ak as oe,D as H,B as O,E as J,ab as ne,ac as se,N as le,aa as Q,a0 as ie,as as re,an as pe,e as ce,ad as U,ae as de}from"./index-hw7QOW1T.js";import{p as ue,q as me,f as _e,r as fe}from"./audit-events-CmfcTxzd.js";import{u as ye,a as ge}from"./table-BKuYvkWU.js";import{_ as he}from"./round-search-Wdn6cQPo.js";import{_ as ve}from"./round-refresh-CTnCderg.js";import{_ as be}from"./FormItemGridItem-BJtyHf3C.js";import{_ as we}from"./Grid-Cw6tbggG.js";import{h as K}from"./permission-BgxCDMSi.js";import{_ as De}from"./Popconfirm-BEEFAPPE.js";import{_ as ke}from"./DataTable-qeqEjtEf.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Db4-USgA.js";import"./setting-outlined-6-9KjY3w.js";import"./round-delete-BKIC0WVe.js";import"./refresh-wIPyYUe8.js";import"./round-plus-DF4zpV2C.js";import"./Upload-BGvaNzBI.js";import"./Progress-76kDcVby.js";import"./Forward-iJK0D6Xc.js";const Ne=j({name:"OperateDrawer",__name:"operate-drawer",props:P({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:P(["submitted"],["update:visible"]),setup(_,{emit:z}){const p=_,g=z,u=E(_,"visible"),{formRef:c,validate:D,restoreValidation:S}=G(),{defaultRequiredRule:h}=Y(),I=Z(()=>({add:a("page.audit.type.addTitle"),edit:a("page.audit.type.editTitle")})[p.operateType]),o=ee(k());function k(){return{atypename:"",typedesc:"",asort:0,syspara:1}}const N={atypename:h};function T(){Object.assign(o,k()),p.operateType==="edit"&&p.rowData&&Object.assign(o,p.rowData)}function v(){u.value=!1}async function m(){var b,i;if(await D(),p.operateType==="add"){const{data:w,error:d}=await ue([{atypename:o.atypename,typedesc:o.typedesc,asort:o.asort,syspara:o.syspara}]);d||((b=window.$message)==null||b.success(a("common.addSuccess")),v(),g("submitted"))}else{const{data:w,error:d}=await me([{id:p.rowData.id,atypename:o.atypename,typedesc:o.typedesc,asort:o.asort,syspara:o.syspara}]);d||((i=window.$message)==null||i.success(a("common.updateSuccess")),v(),g("submitted"))}}return te(u,()=>{u.value&&(T(),S())}),(b,i)=>{const w=W,d=ae,C=oe,R=H,$=O,l=J,s=ne,r=se,x=A("no-space");return q(),L(r,{show:u.value,"onUpdate:show":i[3]||(i[3]=f=>u.value=f),"display-directive":"show",width:360},{default:n(()=>[t(s,{title:I.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[t(l,{size:16},{default:n(()=>[t($,{onClick:v},{default:n(()=>[F(M(e(a)("common.cancel")),1)]),_:1}),t($,{type:"primary",onClick:m},{default:n(()=>[F(M(e(a)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[t(R,{ref_key:"formRef",ref:c,model:o,rules:N},{default:n(()=>[t(d,{label:e(a)("page.audit.type.name"),path:"atypename"},{default:n(()=>[B(t(w,{clearable:"",value:o.atypename,"onUpdate:value":i[0]||(i[0]=f=>o.atypename=f),placeholder:e(a)("page.audit.type.form.name")},null,8,["value","placeholder"]),[[x]])]),_:1},8,["label"]),t(d,{label:e(a)("page.audit.type.describe"),path:"typedesc"},{default:n(()=>[B(t(w,{clearable:"",value:o.typedesc,"onUpdate:value":i[1]||(i[1]=f=>o.typedesc=f),placeholder:e(a)("page.audit.type.form.describe"),type:"textarea"},null,8,["value","placeholder"]),[[x]])]),_:1},8,["label"]),t(d,{label:e(a)("page.audit.type.sort"),path:"asort"},{default:n(()=>[t(C,{min:0,value:o.asort,"onUpdate:value":i[2]||(i[2]=f=>o.asort=f),placeholder:e(a)("page.audit.type.form.sort"),style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),xe=j({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:P(["reset","search"],["update:model"]),setup(_,{emit:z}){const p=z,{formRef:g,restoreValidation:u}=G(),c=E(_,"model");function D(){c.value.fuzzy="",p("search")}async function S(){await u(),p("reset")}async function h(){p("search")}return(I,o)=>{const k=W,N=be,T=ve,v=O,m=he,b=J,i=we,w=H,d=Q,C=A("no-space");return q(),L(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(w,{ref_key:"formRef",ref:g,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:le(h,["enter"])},{default:n(()=>[t(i,{responsive:"screen","item-responsive":""},{default:n(()=>[t(N,{span:"24 s:12 m:6",label:e(a)("page.audit.type.name"),path:"fuzzy",class:"pr-24px"},{default:n(()=>[B(t(k,{clearable:"",value:c.value.fuzzy,"onUpdate:value":o[0]||(o[0]=R=>c.value.fuzzy=R),placeholder:e(a)("page.audit.type.form.name"),onClear:D},null,8,["value","placeholder"]),[[C]])]),_:1},8,["label"]),t(N,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[t(b,{class:"w-full"},{default:n(()=>[t(v,{onClick:S},{icon:n(()=>[t(T,{class:"text-icon"})]),default:n(()=>[F(" "+M(e(a)("common.reset")),1)]),_:1}),t(v,{type:"primary",ghost:"",onClick:h},{icon:n(()=>[t(m,{class:"text-icon"})]),default:n(()=>[F(" "+M(e(a)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function V(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!de(_)}const Le=j({name:"audit_type",__name:"index",setup(_){const z=ie(),{columns:p,columnChecks:g,data:u,getData:c,loading:D,mobilePagination:S,searchParams:h,resetSearchParams:I}=ye({apiFn:_e,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"atypename",title:a("page.audit.type.name"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"typedesc",title:a("page.audit.type.describe"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"asort",title:a("page.audit.type.sort"),align:"center",width:120},{key:"syspara",title:"系统内置",align:"center",width:100,render:l=>{const s={0:"primary",1:"info"},r=a(re[l.syspara]);return t(pe,{size:"small",type:s[l.syspara]},V(r)?r:{default:()=>[r]})}},{key:"operate",title:a("common.operate"),align:"center",width:130,render:l=>{let s;return l.syspara!=0?t("div",{class:"flex-center gap-8px"},[B(t(O,{type:"primary",ghost:!0,size:"small",onClick:()=>R(l.id)},V(s=a("common.edit"))?s:{default:()=>[s]}),[[A("no-auth"),"sys.audit.type.update"]]),t(De,{onPositiveClick:()=>C(l.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let r;return B(t(O,{type:"error",ghost:!0,size:"small"},V(r=a("common.delete"))?r:{default:()=>[r]}),[[A("no-auth"),"sys.audit.type.delete"]])}})]):null}}]}),{drawerVisible:o,operateType:k,editingData:N,handleAdd:T,handleEdit:v,checkedRowKeys:m,onBatchDeleted:b,onDeleted:i,closeDrawer:w}=ge(u,c);async function d(){console.log(m.value),$(m.value,l=>{b()})}function C(l){console.log(l),$([l],s=>{i()})}function R(l){v(l)}async function $(l,s){const{data:r,error:x}=await fe(l);if(!x)s&&s(r);else return!1}return(l,s)=>{const r=X,x=ke,f=Q;return q(),ce("div",ze,[t(xe,{model:e(h),"onUpdate:model":s[0]||(s[0]=y=>U(h)?h.value=y:null),onReset:e(I),onSearch:e(c)},null,8,["model","onReset","onSearch"]),t(f,{title:e(a)("page.audit.type.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[t(r,{columns:e(g),"onUpdate:columns":s[1]||(s[1]=y=>U(g)?g.value=y:null),"disabled-delete":e(m).length===0,loading:e(D),onAdd:e(T),onDelete:d,onRefresh:e(c),"is-view-delete-button":e(K)("sys.audit.type.delete"),"is-view-add-button":e(K)("sys.audit.type.insert")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-delete-button","is-view-add-button"])]),default:n(()=>[t(x,{"checked-row-keys":e(m),"onUpdate:checkedRowKeys":s[2]||(s[2]=y=>U(m)?m.value=y:null),columns:e(p),data:e(u),size:"small","flex-height":!e(z).isMobile,"scroll-x":962,loading:e(D),remote:"","row-key":y=>y.id,pagination:e(S),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Ne,{visible:e(o),"onUpdate:visible":s[3]||(s[3]=y=>U(o)?o.value=y:null),"operate-type":e(k),"row-data":e(N),onSubmitted:e(c)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{Le as default};
