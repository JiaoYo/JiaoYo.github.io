import{_ as ce}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DblglBez.js";import{d as G,q as P,s as J,v as te,x as de,bK as oe,y as H,b as L,$ as l,r as ue,K as V,o as z,c as j,w as r,g as t,h as I,t as U,i as e,M as ne,L as K,Z as pe,a0 as me,A as ae,C as _e,a2 as fe,D as le,B as O,E as Q,ae as he,af as ge,ad as se,dw as X,j as Z,f as Y,F as ve,aM as ye,aq as re,a4 as be,dx as we,e as ke,ag as F,ah as xe}from"./index-7Q9xZuwa.js";import{a as Re,b as De,c as Ne,d as Ce,e as Se,g as Te}from"./system-manage--O3CHZ2D.js";import{u as Me,a as $e}from"./table-G6_8Abm0.js";import{_ as Be}from"./round-search-BQOA9W6m.js";import{_ as Ie}from"./round-refresh-DJiiF7wv.js";import{_ as Ue}from"./FormItemGridItem-DYTXkfwP.js";import{_ as ze}from"./Grid-CRtcNhSF.js";import{_ as Ke,a as Oe}from"./arrow-open-up-BX6Tp5j_.js";import{l as Ae}from"./lodash-CYudMFH4.js";import{_ as Ee}from"./Tree-Dp6lOJnC.js";import{h as ee}from"./permission-BYoerBbx.js";import{_ as Fe}from"./Popconfirm-BEMrdOuM.js";import{_ as Ve}from"./DataTable-n3fP4Loy.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-D8fMBsYv.js";import"./setting-outlined-V9qGIWHT.js";import"./export-oh2-I3ZA.js";import"./refresh-av0Mcmzj.js";import"./round-delete-BZFRn3Yp.js";import"./round-plus-Cy8c1zzO.js";import"./Upload-CwzIyBrH.js";import"./Progress-DAZ1S5w7.js";import"./Forward-BzUEeUAa.js";const je=G({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:P({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:P(["submitted"],["update:visible"]),setup(v,{emit:x}){const u=v,h=x,b=J(v,"visible"),{formRef:y,validate:R,restoreValidation:B}=te(),{defaultRequiredRule:g}=de();oe(),H(()=>u.rowData,()=>{M()});const D=L(()=>({add:l("page.manage.role.addRole"),edit:l("page.manage.role.editRole")})[u.operateType]),p=ue(N());function N(){return{name:"",remark:"",rtype:0}}const T={name:g};L(()=>{var d;return((d=u.rowData)==null?void 0:d.id)||-1}),L(()=>u.operateType==="add"||u.operateType==="edit");function M(){Object.assign(p,N()),u.operateType==="edit"&&u.rowData&&Object.assign(p,u.rowData)}function C(){b.value=!1}async function n(){var f,a,c;await R();const{data:d,error:i}=await Re(u.operateType==="edit"?(f=u.rowData)==null?void 0:f.id:null,p.name,[],p.remark,p.rtype);i||((a=window.$message)==null||a.destroyAll(),(c=window.$message)==null||c.success(u.operateType==="edit"?l("common.modifySuccess"):l("common.addSuccess")),C(),h("submitted"))}return H(b,()=>{b.value&&(M(),B())}),(d,i)=>{const f=ae,a=_e,c=fe,m=le,S=O,o=Q,$=he,A=ge,E=V("no-space");return z(),j(A,{show:b.value,"onUpdate:show":i[3]||(i[3]=s=>b.value=s),"display-directive":"show",width:360},{default:r(()=>[t($,{title:D.value,"native-scrollbar":!1,closable:""},{footer:r(()=>[t(o,{size:16},{default:r(()=>[t(S,{onClick:C},{default:r(()=>[I(U(e(l)("common.cancel")),1)]),_:1}),t(S,{type:"primary",onClick:n},{default:r(()=>[I(U(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(m,{ref_key:"formRef",ref:y,model:p,rules:T,onKeyup:ne(n,["enter"])},{default:r(()=>[t(a,{label:e(l)("page.manage.role.name"),path:"name"},{default:r(()=>[K(t(f,{value:p.name,"onUpdate:value":i[0]||(i[0]=s=>p.name=s),placeholder:e(l)("page.manage.role.form.name"),clearable:""},null,8,["value","placeholder"]),[[E]])]),_:1},8,["label"]),t(a,{label:e(l)("page.manage.role.remark"),path:"remark"},{default:r(()=>[K(t(f,{clearable:"",value:p.remark,"onUpdate:value":i[1]||(i[1]=s=>p.remark=s),placeholder:e(l)("page.manage.role.form.remark")},null,8,["value","placeholder"]),[[E]])]),_:1},8,["label"]),t(a,{label:e(l)("page.manage.role.type"),path:"rtype"},{default:r(()=>[t(c,{filterable:"",value:p.rtype,"onUpdate:value":i[2]||(i[2]=s=>p.rtype=s),disabled:u.operateType==="edit",placeholder:e(l)("page.manage.role.form.type"),options:e(pe)(e(me)),style:{width:"100%"}},null,8,["value","disabled","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Le=G({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:P(["reset","search"],["update:model"]),setup(v,{emit:x}){const u=x,h=J(v,"model"),{formRef:b,restoreValidation:y}=te();function R(){h.value.name="",u("search")}async function B(){await y(),u("reset")}function g(){u("search")}return(D,p)=>{const N=ae,T=Ue,M=Ie,C=O,n=Be,d=Q,i=ze,f=le,a=se,c=V("no-space");return z(),j(a,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[t(f,{model:h.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(g,["enter"])},{default:r(()=>[t(i,{responsive:"screen","item-responsive":""},{default:r(()=>[t(T,{span:"24 s:12 m:6",label:e(l)("page.manage.role.name"),path:"name",class:"pr-24px"},{default:r(()=>[K(t(N,{clearable:"",value:h.value.name,"onUpdate:value":p[0]||(p[0]=m=>h.value.name=m),placeholder:e(l)("page.manage.role.form.name"),onClear:R},null,8,["value","placeholder"]),[[c]])]),_:1},8,["label"]),t(T,{span:"24 s:12 m:6"},{default:r(()=>[t(d,{class:"w-full"},{default:r(()=>[t(C,{onClick:B},{icon:r(()=>[t(M,{class:"text-icon"})]),default:r(()=>[I(" "+U(e(l)("common.reset")),1)]),_:1}),t(C,{type:"primary",ghost:"",onClick:g},{icon:r(()=>[t(n,{class:"text-icon"})]),default:r(()=>[I(" "+U(e(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Pe={class:"flex"},Ge=G({name:"MenuAuthModal",__name:"menu-auth-modal",props:P({roleRow:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(v){const x=v,u=J(v,"visible");function h(){u.value=!1}const b=L(()=>l("common.edit")+l("page.manage.role.menuAuth")),y=X([]);function R(n,d=0){var m,S;const i=(m=n.find(o=>o.url=="/manage/role"))==null?void 0:m.id,f=(S=n.find(o=>o.url=="/manage/user"))==null?void 0:S.id;let a=[];function c(o){return o.sort(($,A)=>($.sort||0)-(A.sort||0))}return n.forEach(o=>{if(o.suffix=()=>ye(re,{text:!0,type:o.pid==0&&o.type==0?"warning":o.type==1?"info":"success",size:"small"},{default:()=>o.pid==0&&o.type==0?"目录":o.type==1?"按钮":"菜单"}),(o.pid==i||o.id==i||o.pid==f||o.id==f)&&(o.disabled=!0),o.pid==d){const $=R(n,o.id);$.length>0?o.children=$:o.children=[],a.push(o)}}),c(a)}const B=async()=>{const{error:n,data:d}=await Ne({rtype:x.roleRow.rtype}),i=R(d);if(!n){let f=function(c){for(let m=c.length-1;m>=0;m--)c[m].children&&c[m].children.length>0?f(c[m].children):c[m].children=void 0;return c},a=Ae.cloneDeep(i);a=f(a),y.value=a.filter(c=>c.id<=1e4)}},g=Z(!0),D=X([]);async function p(){const{data:n,error:d}=await Ce(x.roleRow.id+""),i=[];function f(a,c){return!c.includes(a.id)||a.children&&!a.children.every(m=>f(m,c))?(i.push(a.id),!1):!0}y.value.forEach(a=>{f(a,n.menuIdList)}),D.value=n.menuIdList.filter(a=>!i.includes(a))}const N=Z(),T=n=>{N.value=n};function M(){var n,d;De({id:x.roleRow.id,name:x.roleRow.name,menuIdList:D.value.concat(N.value).filter(i=>i!==null)}),(d=(n=window.$message)==null?void 0:n.success)==null||d.call(n,l("common.modifySuccess")),h()}function C(){B(),p()}return H(u,n=>{n&&C()}),(n,d)=>{const i=Ke,f=Oe,a=Ee,c=O,m=Q,S=ve;return z(),j(S,{show:u.value,"onUpdate:show":d[2]||(d[2]=o=>u.value=o),preset:"card",class:"w-480px"},{header:r(()=>[Y("div",Pe,[I(U(b.value)+" ",1),Y("div",{class:"ml-10px cursor-pointer",title:"展开/收起",onClick:d[0]||(d[0]=o=>g.value=!g.value)},[g.value?(z(),j(f,{key:1,class:"text-icon"})):(z(),j(i,{key:0,class:"text-icon"}))])])]),footer:r(()=>[t(m,{justify:"end"},{default:r(()=>[t(c,{size:"small",class:"mt-16px",onClick:h},{default:r(()=>[I(U(e(l)("common.cancel")),1)]),_:1}),t(c,{type:"primary",size:"small",class:"mt-16px",onClick:M},{default:r(()=>[I(U(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(a,{cascade:"","checked-keys":D.value,"onUpdate:checkedKeys":d[1]||(d[1]=o=>D.value=o),data:y.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"",class:"h-60vh","label-field":"name","key-field":"id","children-field":"children","default-expand-all":g.value,onUpdateIndeterminateKeys:T},null,8,["checked-keys","data","default-expand-all"])]),_:1},8,["show"])}}}),qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!xe(v)}const ht=G({name:"manage_role",__name:"index",setup(v){const x=be(),{columns:u,columnChecks:h,data:b,getData:y,loading:R,mobilePagination:B,searchParams:g,resetSearchParams:D}=Me({apiFn:Se,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,name:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:l("page.manage.role.name"),align:"center",minWidth:120,ellipsis:!0},{key:"remark",title:l("page.manage.role.remark"),minWidth:120,align:"center",ellipsis:!0},{key:"rtype",title:l("page.manage.role.type"),width:140,align:"center",render:s=>{s.rtype===void 0&&(s.rtype=0);const _={0:"primary",1:"primary",2:"primary"},w=l(we[s.rtype]);return t(re,{type:_[s.rtype]},W(w)?w:{default:()=>[w]})}},{key:"operate",title:l("common.operate"),align:"center",render:s=>{let _;return t("div",{class:"flex-center gap-8px"},[K(t(O,{type:"primary",ghost:!0,size:"small",onClick:()=>A(s.id)},W(_=l("common.edit"))?_:{default:()=>[_]}),[[V("no-auth"),"sys:role:update"]]),K(t(O,{type:"primary",ghost:!0,size:"small",onClick:()=>S(s)},{default:()=>["分配权限"]}),[[V("no-auth"),"sys:role:update"]]),[1,2,3].includes(Number(s.id))?"":t(Fe,{onPositiveClick:()=>$(s.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let w;return K(t(O,{type:"error",ghost:!0,size:"small"},W(w=l("common.delete"))?w:{default:()=>[w]}),[[V("no-auth"),"sys:role:delete"]])}})])}}]}),{drawerVisible:p,operateType:N,editingData:T,handleAdd:M,handleEdit:C,checkedRowKeys:n,onBatchDeleted:d,onDeleted:i,closeDrawer:f}=$e(b,y),{bool:a,setTrue:c}=oe(),m=Z({id:0,name:"",remark:"",rtype:0});function S(s){c(),m.value=s}async function o(){console.log(n.value),E(n.value,s=>{d()})}function $(s){console.log(s),E([s],_=>{i()})}function A(s){C(s)}async function E(s,_){const{data:w,error:q}=await Te(s);if(!q)_&&_(w);else return!1}return(s,_)=>{const w=ce,q=Ve,ie=se;return z(),ke("div",qe,[t(Le,{model:e(g),"onUpdate:model":_[0]||(_[0]=k=>F(g)?g.value=k:null),onReset:e(D),onSearch:e(y)},null,8,["model","onReset","onSearch"]),t(ie,{title:e(l)("page.manage.role.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":r(()=>[t(w,{columns:e(h),"onUpdate:columns":_[1]||(_[1]=k=>F(h)?h.value=k:null),"disabled-delete":e(n).length===0,"is-view-add-button":e(ee)("sys:role:save"),"is-view-delete-button":e(ee)("sys:role:delete"),loading:e(R),onAdd:e(M),onDelete:o,onRefresh:e(y)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:r(()=>[t(q,{"checked-row-keys":e(n),"onUpdate:checkedRowKeys":_[2]||(_[2]=k=>F(n)?n.value=k:null),columns:e(u),data:e(b),size:"small","flex-height":!e(x).isMobile,"scroll-x":702,loading:e(R),remote:"","row-key":k=>k.id,pagination:e(B),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(je,{visible:e(p),"onUpdate:visible":_[3]||(_[3]=k=>F(p)?p.value=k:null),"operate-type":e(N),"row-data":e(T),onSubmitted:e(y)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(Ge,{visible:e(a),"onUpdate:visible":_[4]||(_[4]=k=>F(a)?a.value=k:null),roleRow:m.value},null,8,["visible","roleRow"])]),_:1},8,["title"])])}}});export{ht as default};
