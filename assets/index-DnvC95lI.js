import{cz as S,d as be,q as ke,r as k,i as Ce,cl as ze,y as $e,b as x,o as c,f as o,e as i,w as s,G as Se,F as Y,h as a,aw as je,N as Ue,B as w,g as m,t as _,U as G,z as j,b8 as We,c as h,b0 as Le,a5 as Z,a4 as ee,D as P,cA as Ne,V as Ae,T as Pe,C as U,cm as De,cB as qe,A as Re,cC as Te,bp as Be,b9 as Ee,c1 as Fe,a3 as Ge,b_ as Oe,a6 as Ve}from"./index-DMk9ecAg.js";import{_ as Ie,a as Ke,b as Me,c as He}from"./edit-DphuX39D.js";import{_ as Je}from"./round-search-D0NIJO1w.js";import{u as Qe}from"./usePageData-KTtgYQ98.js";import{_ as Xe}from"./Grid-BIOqdWqR.js";import{_ as Ye}from"./FormItemGridItem-CblRT5zG.js";import{_ as O}from"./Avatar-BkzHb7bh.js";import{N as Ze}from"./Popconfirm-ZXnEhqzl.js";import{_ as et}from"./text-DB5ihSVv.js";function tt(v){return S({url:"/projectWeek/getPage.do",method:"get",params:v})}function nt(v){return S({url:"/projectWeek/insert.do",method:"post",data:v})}function ot(v){return S({url:"/projectWeek/update.do",method:"put",data:v})}function st(v){return S({url:"/projectWeek/delete.do",method:"delete",params:{arrIds:v}})}function at(v){return S({url:"/projectWeekComment/getPage.do",method:"get",params:v})}function lt(v){return S({url:"/projectWeekComment/insert.do",method:"post",data:v})}function it(v){return S({url:"/projectWeekComment/delete.do",method:"delete",params:{arrIds:v}})}const rt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto p-20px"},ct={style:{display:"flex",height:"100%"}},ut={key:1},dt={class:"flex items-center"},pt={class:"flex items-center"},mt={class:"flex-col ml-10px"},ft={class:"font-size-18px font-bold"},_t={class:"c-#868e96 font-size-14px"},vt={key:0},yt={class:"mt-3 mb-3 text-gray-700 preview-text"},gt={class:"mt-3 mb-3 text-gray-700 preview-text"},ht={class:"mt-3 mb-3 text-gray-700 preview-text"},wt={class:"mt-3 mb-3 text-gray-700 preview-text"},xt={class:"mt-3 mb-3 text-gray-700 preview-text"},bt={class:"mt-3 mb-3 text-gray-700 preview-text"},kt={class:"mt-3 mb-3 text-gray-700 preview-text"},Ct={key:1,class:"mt-1 flex items-center gap-3 text-sm text-gray-500"},zt=["onClick"],$t={key:0,class:"mt-4 border-t pt-3"},St={class:"flex items-start gap-2 mb-3"},jt={class:"ml-2 flex-1"},Ut={class:"flex items-center"},Wt={class:"font-medium font-size-16px font-bold"},Lt={class:"text-gray-600 mt-1"},Nt={key:0,style:{display:"flex","justify-content":"flex-end","margin-top":"10px"}},At={key:0,class:"relative inline-block group"},Pt={key:0,class:""},Dt=be({name:"projectmanagement_memberlog",__name:"index",setup(v){const V=ke(),W=k({creater:void 0}),{pageData:L,getData:te,nextPage:ne}=Qe(Oe),oe=async n=>{const e=n.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&L.data.length<L.total&&ne()},se=async n=>{W.value.creater=n,C()},ae=async()=>{te({usertypes:"2,3"}),L.data=L.data.map(n=>(n.avatar="https://cdn-icons-png.flaticon.com/128/3135/3135715.png",n))},R={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},le={content1:{required:!0,message:"请输入",trigger:"blur"}},T=k("add"),N=k(!1),B=k(-1),z=k([]),y=k({page:1,limit:10,total:0}),E=k(null),r=k({id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}),ie=n=>{y.value.page=n,C()},re=n=>{y.value.limit=n,C()},C=async()=>{const{data:n,error:e}=await tt({page:y.value.page,limit:y.value.limit,creater:W.value.creater});n&&(z.value=n.list.map((u,l)=>(B.value!=l?u.showAll=!1:u.showAll=!0,u.showCommentSection=!1,u)),y.value.total=n.total)};async function I({file:n},e){var g,p,b;let u=new FormData;u.append("multipartFile",n.file);const{data:l,error:d}=await Fe(u);d||(Object.prototype.hasOwnProperty.call(l,"result")?((g=window.$message)==null||g.destroyAll(),(b=(p=window.$message)==null?void 0:p.error)==null||b.call(p,l.result)):(console.log("文件上传成功"),e=="file1"?r.value.file1=l:r.value.file2=l))}const ce=(n,e)=>{N.value=!0,T.value="edit",r.value=JSON.parse(JSON.stringify(n)),B.value=e},ue=async n=>{var l;const{data:e,error:u}=await st(n.id);e&&((l=window.$message)==null||l.success("删除成功"),z.value.length===1&&y.value.page>1&&y.value.page--,C())},de=()=>{N.value=!0,T.value="add",B.value=-1},pe=async()=>{var n,e,u;if(await((n=E.value)==null?void 0:n.validate()),r.value.id){const{data:l,error:d}=await ot([r.value]);l&&((e=window.$message)==null||e.success("编辑成功"))}else{const{data:l,error:d}=await nt([r.value]);l&&((u=window.$message)==null||u.success("新增成功"))}await C(),K()},K=()=>{N.value=!1,r.value={id:void 0,content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}};Ce(async()=>{await ae(),C()});const F=async n=>{const{data:e,error:u}=await at({page:1,limit:100,pid:n});if(e){const l=z.value.find(d=>d.id===n);l&&(l.comments=e.list)}},me=async n=>{F(n.id),z.value.forEach(e=>{e.id!==n.id&&(e.showCommentSection=!1)}),n.showCommentSection=!n.showCommentSection,n.showCommentSection&&await _e(`comment-input-${n.id}`)},fe=async(n,e)=>{var d;const{data:u,error:l}=await it(n.id);u&&(F(n.pid),e.num--,(d=window.$message)==null||d.success("删除成功"))},D=k({}),M=ze.debounce(async n=>{var d,g;const e=D.value[n.id];if(!(e!=null&&e.trim()))return(d=window.$message)==null?void 0:d.warning("请输入评论内容");const{data:u,error:l}=await lt([{pid:n.id,content:e}]);u&&((g=window.$message)==null||g.success("评论成功"),D.value[n.id]="",n.num++,F(n.id))},1e3,{leading:!0,trailing:!1});async function _e(n,e=8,u=30){var d;await Ge();for(let g=0;g<e;g++){const p=document.querySelector(`#${n} textarea`);if(p&&typeof p.focus=="function"){p.focus();const b=p.value;if(b&&p.setSelectionRange){const q=b.length;p.setSelectionRange(q,q)}return!0}await new Promise(b=>setTimeout(b,u))}const l=document.getElementById(n);return l&&(l.tabIndex=-1,(d=l.focus)==null||d.call(l)),!1}async function H(n){if(!n)return;const e=n.split("?")[0],u=n.split("?")[1];try{const d=await(await fetch(e,{mode:"cors"})).blob(),g=URL.createObjectURL(d),p=document.createElement("a");p.href=g,p.download=u,p.style.display="none",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(g)}catch(l){console.error("下载失败:",l)}}return(n,e)=>{const u=Ye,l=Je,d=Ue,g=Xe,p=Se,b=He,q=Ie,ve=Ke,J=Ne,ye=Me,Q=Ze,ge=qe,$=Re,he=Te,X=Be,we=Ee,A=$e("no-auth");return c(),x("div",rt,[o(a(G),{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[o(p,{ref_key:"formRef",ref:E,model:W.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Y(C,["enter"])},{default:s(()=>[o(g,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[o(u,{span:"24 s:12 m:6",label:"调试人员",path:"pid"},{default:s(()=>[o(a(je),{clearable:"",filterable:"",value:W.value.creater,"onUpdate:value":[e[0]||(e[0]=t=>W.value.creater=t),se],placeholder:"请选择","label-field":"username","value-field":"id",options:a(L).data,onScroll:oe},null,8,["value","options"])]),_:1}),o(u,{span:"24  s:12 m:6",class:"pr-24px"},{default:s(()=>[o(d,{class:"w-full"},{default:s(()=>[o(a(w),{type:"primary",ghost:"",onClick:C},{icon:s(()=>[o(l,{class:"text-icon"})]),default:s(()=>[m(" "+_(n.$t("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),i("div",ct,[o(a(G),null,{header:s(()=>e[11]||(e[11]=[m("技术支持周报")])),"header-extra":s(()=>[P((c(),h(a(w),{type:"primary",ghost:"",onClick:de},{icon:s(()=>[o(b)]),default:s(()=>[e[12]||(e[12]=m(" 写周报 "))]),_:1,__:[12]})),[[A,"project:Week:insert"]])]),default:s(()=>[o(a(We),{style:{height:"calc(100vh - 350px)"}},{default:s(()=>[z.value.length?(c(),x("div",ut,[(c(!0),x(Z,null,ee(z.value,(t,xe)=>(c(),h(a(G),{key:t.id,class:"mb-4",title:"",size:"small"},{default:s(()=>[i("div",dt,[i("div",pt,[t.showAll?(c(),h(q,{key:0,class:"font-size-20px mr-10px cursor-pointer",onClick:f=>t.showAll=!t.showAll},null,8,["onClick"])):(c(),h(ve,{key:1,class:"font-size-20px mr-10px cursor-pointer",onClick:f=>t.showAll=!t.showAll},null,8,["onClick"])),o(a(O),{src:R.avatar},null,8,["src"]),i("div",mt,[i("span",ft,_(t.username)+"的技术支持周报",1),i("span",_t,_(t.dbtime),1)])])]),t.showAll?(c(),x("div",vt,[e[15]||(e[15]=i("h3",{class:"font-size-16px font-bold mt-2"},"本周完成：",-1)),i("div",yt,_(t.content1),1),e[16]||(e[16]=i("h3",{class:"font-size-16px font-bold mt-2"},"本周对你帮助最大的人，具体描述一下对你的帮助：",-1)),i("div",gt,_(t.content2),1),e[17]||(e[17]=i("h3",{class:"font-size-16px font-bold mt-2"},"未完成项目",-1)),i("div",ht,_(t.content3),1),e[18]||(e[18]=i("h3",{class:"font-size-16px font-bold mt-2"},"下周计划：",-1)),i("div",wt,_(t.content4),1),e[19]||(e[19]=i("h3",{class:"font-size-16px font-bold mt-2"},"需协调与帮助：",-1)),i("div",xt,_(t.content5),1),e[20]||(e[20]=i("h3",{class:"font-size-16px font-bold mt-2"},"图片：",-1)),o(J,{width:"80",height:"80",src:t.file1,class:"rounded-md object-cover"},null,8,["src"]),i("div",bt,[m(_(t.file1.split("?")[1])+" ",1),o(a(w),{text:"",type:"primary",size:"small",onClick:f=>H(t.file1)},{default:s(()=>e[13]||(e[13]=[m("下载")])),_:2,__:[13]},1032,["onClick"])]),e[21]||(e[21]=i("h3",{class:"font-size-16px font-bold mt-2"},"附件：",-1)),i("div",kt,[m(_(t.file2.split("?")[1])+" ",1),o(a(w),{text:"",type:"primary",size:"small",onClick:f=>H(t.file2)},{default:s(()=>e[14]||(e[14]=[m("下载")])),_:2,__:[14]},1032,["onClick"])])])):j("",!0),t.showAll?(c(),x("div",Ct,[i("span",{class:"cursor-pointer hover:text-blue-500",style:Ae({color:t.showCommentSection?"#1890ff":""}),onClick:f=>me(t)},[o(ye,{class:"font-size-18px"}),m(" "+_(t.num==0?"":t.num),1)],12,zt),a(V).userInfo.id==t.creater?(c(),h(d,{key:0},{default:s(()=>[P((c(),h(a(w),{quaternary:"",type:"info",size:"small",onClick:f=>ce(t,xe)},{default:s(()=>e[22]||(e[22]=[m(" 编辑 ")])),_:2,__:[22]},1032,["onClick"])),[[A,"project:Week:update"]]),o(Q,{onPositiveClick:f=>ue(t)},{trigger:s(()=>[P((c(),h(a(w),{quaternary:"",type:"error",size:"small"},{default:s(()=>e[23]||(e[23]=[m(" 删除 ")])),_:1,__:[23]})),[[A,"project:Week:delete"]])]),default:s(()=>[e[24]||(e[24]=m(" 确定删除吗？ "))]),_:2,__:[24]},1032,["onPositiveClick"])]),_:2},1024)):j("",!0)])):j("",!0),P((c(),h(Pe,{name:"fade"},{default:s(()=>[t.showCommentSection?(c(),x("div",$t,[i("div",St,[i("div",null,[o(a(O),{size:"small",src:R.avatar},null,8,["src"])]),o(a(U),{type:"textarea",id:`comment-input-${t.id}`,value:D.value[t.id],"onUpdate:value":f=>D.value[t.id]=f,placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:Y(De(f=>a(M)(t),["exact","prevent"]),["enter"])},null,8,["id","value","onUpdate:value","onKeydown"]),o(a(w),{type:"primary",ghost:"",onClick:f=>a(M)(t)},{default:s(()=>e[25]||(e[25]=[m("发送")])),_:2,__:[25]},1032,["onClick"])]),(c(!0),x(Z,null,ee(t.comments,f=>(c(),x("div",{key:f.id,class:"flex mb-3"},[o(a(O),{size:"small",src:R.avatar},null,8,["src"]),i("div",jt,[i("div",Ut,[i("span",Wt,_(f.username),1),o(a(et),{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:s(()=>[m(_(f.dbtime),1)]),_:2},1024),a(V).userInfo.id==f.creater?(c(),h(Q,{key:0,onPositiveClick:qt=>fe(f,t)},{trigger:s(()=>[P((c(),h(a(w),{quaternary:"",type:"error",size:"small"},{default:s(()=>e[26]||(e[26]=[m(" 删除 ")])),_:1,__:[26]})),[[A,"project:Week:Comment:delete"]])]),default:s(()=>[e[27]||(e[27]=m(" 确定删除吗？ "))]),_:2,__:[27]},1032,["onPositiveClick"])):j("",!0)]),i("div",Lt,_(f.content),1)])]))),128))])):j("",!0)]),_:2},1024)),[[A,"project:Week:Comment:insert"]])]),_:2},1024))),128))])):(c(),h(a(Le),{key:0,description:"暂无信息"}))]),_:1}),z.value.length>0?(c(),x("div",Nt,[o(ge,{page:y.value.page,"onUpdate:page":[e[1]||(e[1]=t=>y.value.page=t),ie],"page-size":y.value.limit,"onUpdate:pageSize":[e[2]||(e[2]=t=>y.value.limit=t),re],"item-count":y.value.total,"show-size-picker":"","page-sizes":[10,20,50],prefix:()=>`共 ${y.value.total} 条`},null,8,["page","page-size","item-count","prefix"])])):j("",!0)]),_:1})]),o(we,{show:N.value,"onUpdate:show":e[10]||(e[10]=t=>N.value=t),title:T.value==="add"?"新增":"编辑",preset:"card",class:"w-570px"},{footer:s(()=>[o(d,{justify:"end"},{default:s(()=>[o(a(w),{size:"small",class:"mt-16px",onClick:K},{default:s(()=>[m(_(n.$t("common.cancel")),1)]),_:1}),o(a(w),{type:"primary",size:"small",class:"mt-16px",onClick:pe},{default:s(()=>[m(_(n.$t("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[o(p,{ref_key:"formRef",ref:E,model:r.value,rules:le},{default:s(()=>[o($,{label:"本周完成",path:"content1"},{default:s(()=>[o(a(U),{value:r.value.content1,"onUpdate:value":e[3]||(e[3]=t=>r.value.content1=t),type:"textarea",placeholder:"请输入内容",rows:3},null,8,["value"])]),_:1}),o($,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{default:s(()=>[o(a(U),{value:r.value.content2,"onUpdate:value":e[4]||(e[4]=t=>r.value.content2=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o($,{label:"未完成项目",path:"content3"},{default:s(()=>[o(a(U),{value:r.value.content3,"onUpdate:value":e[5]||(e[5]=t=>r.value.content3=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o($,{label:"下周计划",path:"content4"},{default:s(()=>[o(a(U),{value:r.value.content4,"onUpdate:value":e[6]||(e[6]=t=>r.value.content4=t),type:"textarea",placeholder:"请输入内容",rows:2},null,8,["value"])]),_:1}),o($,{label:"需协调与帮助:",path:"content5"},{default:s(()=>[o(a(U),{value:r.value.content5,"onUpdate:value":e[7]||(e[7]=t=>r.value.content5=t),type:"textarea",placeholder:"请输入内容",rows:1},null,8,["value"])]),_:1}),o($,{label:"图片:",path:"file1"},{default:s(()=>[o(d,{justify:"center"},{default:s(()=>[r.value.file1?(c(),x("div",At,[o(J,{width:"100",height:"100","preview-disabled":"",src:r.value.file1,class:"rounded-md object-cover"},null,8,["src"]),i("div",{class:"absolute inset-0 flex w-100px items-center justify-center bg-black/50 opacity-0 c-#ccc group-hover:opacity-100 transition-opacity duration-200 cursor-pointer rounded-md",onClick:e[8]||(e[8]=t=>r.value.file1="")},[o(he,{class:"font-size-24px"})])])):(c(),h(X,{key:1,ref:"uploadRef",action:"#","list-type":"image-card","custom-request":t=>I(t,"file1")},null,8,["custom-request"]))]),_:1})]),_:1}),o($,{label:"附件:",path:"file2"},{default:s(()=>[r.value.file2?(c(),x("div",Pt,[i("span",null,_(r.value.file2.split("?")[1]),1),o(a(w),{text:"",type:"error",onClick:e[9]||(e[9]=t=>r.value.file2="")},{default:s(()=>e[28]||(e[28]=[m("删除")])),_:1,__:[28]})])):(c(),h(X,{key:1,ref:"uploadRef",action:"#","custom-request":t=>I(t,"file2")},{default:s(()=>[o(a(w),null,{default:s(()=>e[29]||(e[29]=[m("上传文件")])),_:1,__:[29]})]),_:1},8,["custom-request"]))]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}}),Kt=Ve(Dt,[["__scopeId","data-v-25951272"]]);export{Kt as default};
