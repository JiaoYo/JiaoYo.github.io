import{d as B,o as y,b as x,e,a4 as re,_ as M,m as b,al as ge,a as K,am as ye,f as S,an as ce,p as U,i as q,c as de,w as z,t as v,F as ie,af as X,ao as Z,ap as ue,g as D,k as $e,z as ee,ag as oe,ac as Se,h as Q,v as xe,ab as fe,u as ke,r as De,aq as Le,ar as le,as as Ce,at as Ie,au as Te,av as j,aw as Ne,ax as Me,A as Ae,J as Oe,ay as ne,az as We,aA as Be,aB as He,aC as Pe,ak as Re}from"./index-BbHCbOwF.js";import{u as _e,L as R}from"./echarts-CyFgPcBt.js";import{G as ze,h as Ve,a as Fe,b as Ee}from"./metar-DN0Svn23.js";const je={class:"loader-overlay"},Ge=B({__name:"loading",props:{color:{default:"#1890ff"}},setup(c){const t=c;return(d,s)=>(y(),x("div",je,[e("div",{class:"loader",style:re({"--c":`no-repeat linear-gradient(${t.color} 0 0)`})},null,4)]))}}),Je=M(Ge,[["__scopeId","data-v-c4fc24aa"]]),Ue=c=>(U("data-v-4ea05f61"),c=c(),q(),c),qe=["width","height"],Ye=["fill","stroke","d"],Qe=["stroke"],Ke=Ue(()=>e("path",{fill:"transparent",stroke:"{mergedColor[1]}",d:"M 5 20 L 5 10 L 12 3  L 60 3 L 68 10"},null,-1)),Xe=["stroke","d"],Ze={class:"dv-border-box-content"},et=B({__name:"border-box-13",props:{color:{type:Array,default:()=>[]},backgroundColor:{type:String,default:"transparent"}},setup(c){const t=c,d=["#6586ec","#2cf7fe"],s=b(null),{width:_,height:f}=ge(s,{width:0,height:0},{box:"border-box"}),m=K(()=>ye(d,t.color));return(g,k)=>(y(),x("div",{class:"dv-border-box-13 dv-border-box",ref_key:"domRef",ref:s},[(y(),x("svg",{width:S(_),height:S(f),class:"dv-border-svg-container"},[e("path",{fill:c.backgroundColor,stroke:m.value[0],d:`
            M 5 20 L 5 10 L 12 3  L 60 3 L 68 10
            L ${S(_)-20} 10 L ${S(_)-5} 25
            L ${S(_)-5} ${S(f)-5} L 20 ${S(f)-5}
            L 5 ${S(f)-20} L 5 20
        `},null,8,Ye),e("path",{fill:"transparent","stroke-width":"3","stroke-linecap":"round","stroke-dasharray":"10, 5",stroke:m.value[0],d:"M 16 9 L 61 9"},null,8,Qe),Ke,e("path",{fill:"transparent",stroke:m.value[1],d:`M ${S(_)-5} ${S(f)-30} L ${S(_)-5} ${S(f)-5} L ${S(_)-30} ${S(f)-5}`},null,8,Xe)],8,qe)),e("div",Ze,[ce(g.$slots,"default",{},void 0,!0)])],512))}}),tt=M(et,[["__scopeId","data-v-4ea05f61"]]),me=c=>(U("data-v-586f7d9f"),c=c(),q(),c),at={key:0,class:"item_title"},st=me(()=>e("div",{class:"zuo"},null,-1)),ot={class:"title-inner"},lt=me(()=>e("div",{class:"you"},null,-1)),nt=B({__name:"item-wrap",props:{title:{default:""}},setup(c){return(t,d)=>{const s=tt;return y(),de(s,null,{default:z(()=>[t.title!==""?(y(),x("div",at,[st,e("span",ot,"   "+v(t.title)+"   ",1),lt])):ie("",!0),e("div",{class:X(t.title!==""?"item_title_content":"item_title_content_def")},[ce(t.$slots,"default",{},void 0,!0)],2)]),_:3})}}}),rt=M(nt,[["__scopeId","data-v-586f7d9f"]]),ct={class:"list"},dt={class:"item_info"},it={class:"title"},ut={class:"value"},ft=B({__name:"left-bottom",props:{data:{type:Object,default:()=>({})}},setup(c){const t=c,d=K(()=>{var s,_,f,m,g,k;return[{key:"envT",title:"温度",value:((s=t.data)==null?void 0:s.envT)||0,unit:"℃",icon:"carbon:temperature-celsius"},{key:"envH",title:"湿度",value:((_=t.data)==null?void 0:_.envH)||0,unit:"%",icon:"lets-icons:humidity"},{key:"qy",title:"气压",value:((f=t.data)==null?void 0:f.qy)||0,unit:"hPa",icon:"mdi:car-brake-low-pressure"},{key:"windS",title:"风速",value:((m=t.data)==null?void 0:m.windS)||0,unit:"m/s",icon:"hugeicons:slow-winds"},{key:"windD",title:"风向",value:((g=t.data)==null?void 0:g.windD)||0,unit:"°",icon:"mdi:windsock"},{key:"zfsdCount",title:"总辐射",value:((k=t.data)==null?void 0:k.zfsd)||0,unit:"W/㎡",color:{start:"#ce9ffc",end:"#7367f0"},icon:"material-symbols:clear-day-rounded"}]});return(s,_)=>{const f=$e;return y(),x("div",ct,[(y(!0),x(Z,null,ue(d.value,(m,g)=>(y(),x("div",{class:X(["item",{brBom:[0,1,2].includes(g),brLeft:[0,1,3,4].includes(g)}]),key:m.key},[D(f,{icon:m.icon,class:"iconx"},null,8,["icon"]),e("div",dt,[e("div",it,v(m.title),1),e("div",ut,v(m.value)+v(m.unit),1)])],2))),128))])}}}),_t=M(ft,[["__scopeId","data-v-f0512d22"]]),L=c=>(U("data-v-ee7e91f5"),c=c(),q(),c),mt={class:"dashboard"},pt={class:"stats-table"},vt=L(()=>e("td",{class:"label"},"CPU使用率:",-1)),ht={class:"value",colspan:"2"},wt=L(()=>e("td",{class:"label"},"内存使用率:",-1)),bt={class:"value",colspan:"2"},gt=L(()=>e("td",{class:"label"},"运行状态:",-1)),yt={class:"value",colspan:"2"},$t=L(()=>e("td",{class:"label"},"是否限电:",-1)),St={class:"value",colspan:"2"},xt=L(()=>e("td",{class:"label"},"数据接入:",-1)),kt={class:"value",colspan:"2"},Dt=L(()=>e("td",{class:"label"},"数据上报:",-1)),Lt={class:"value",colspan:"2"},Ct=L(()=>e("td",{class:"label"},"有功功率(MW):",-1)),It={class:"value",colspan:"2"},Tt=L(()=>e("td",{class:"label"},"无功功率(MVar):",-1)),Nt={class:"value",colspan:"2"},Mt=L(()=>e("td",{class:"label"},"更新时间:",-1)),At={class:"value",colspan:"2"},Ot=L(()=>e("td",{class:"label"},"功率因数:",-1)),Wt={class:"value"},Bt=L(()=>e("td",{class:"label"},"日发电量(MWh):",-1)),Ht={class:"value",colspan:"2"},Pt=L(()=>e("td",{class:"label"},"总发电量(MWh):",-1)),Rt={class:"value",colspan:"2"},zt=B({__name:"left-top",props:{data:{type:Object,default:()=>({})}},setup(c){const t=c;return(d,s)=>(y(),x("div",mt,[e("table",pt,[e("tbody",null,[e("tr",null,[vt,e("td",ht,v(t.data.cpu?t.data.cpu+"%":""),1),wt,e("td",bt,v(t.data.mem?t.data.mem+"%":""),1)]),e("tr",null,[gt,e("td",yt,v(t.data.stationP&&t.data.stationP>0&&t.data.stationControlled==0?"并网运行":t.data.stationP&&t.data.stationP>0&&t.data.stationControlled==1?"降额运行":t.data.stationP==0?"待机":""),1),$t,e("td",St,v(t.data.stationControlled==1?"是":"否"),1)]),e("tr",null,[xt,e("td",kt,v(t.data.col=="0"?"🟢":t.data.col=="1"?"🔴":"⚪"),1),Dt,e("td",Lt,v(t.data.trs=="0"?"🟢":t.data.trs=="1"?"🔴":"⚪"),1)]),e("tr",null,[Ct,e("td",It,v(t.data.stationP??"-"),1),Tt,e("td",Nt,v(t.data.stationQ??"-"),1)]),e("tr",null,[Mt,e("td",At,v(t.data.dbtime||"-"),1),Ot,e("td",Wt,v(t.data.stationCOS??"-"),1)]),e("tr",null,[Bt,e("td",Ht,v(t.data.stationDayE??"-"),1),Pt,e("td",Rt,v(t.data.stationTotalE??"-"),1)])])])]))}}),Vt=M(zt,[["__scopeId","data-v-ee7e91f5"]]),Ft=c=>(U("data-v-dc930ac1"),c=c(),q(),c),Et={class:"inner_right"},jt=Ft(()=>e("div",{class:"dibu"},null,-1)),Gt={class:"info"},Jt={class:"alarmName"},Ut={class:"info_bottom"},qt={class:"alarmLevel"},Yt={class:"time"},Qt=5e3,Kt=3,Xt={__name:"left-center",props:{data:{type:Array,default:()=>[]}},setup(c){const t=c,d=[{label:"一般",color:"#0091FF",value:0},{label:"低级",color:"#ffd600",value:1},{label:"中级",color:"#ffab00",value:2},{label:"高级",color:"#ff6d00",value:3},{label:"严重",color:"#dd2c00",value:4}],s=i=>d.find(a=>a.value===i)||{},_=b(!0),f=K(()=>_.value?[...t.data,...t.data]:t.data),m=b(!1),g=b(),k=b();let C=null;const I=()=>{m.value=!0,_.value=!1,clearInterval(C)},u=()=>{m.value=!1,_.value=!0,oe(()=>{o()})},o=()=>{clearInterval(C),C=setInterval(()=>{var O;if(m.value||!_.value)return;const i=g.value,a=k.value;if(!i||!a)return;const r=((O=a.children[0])==null?void 0:O.offsetHeight)||0,A=a.scrollHeight/2,T=i.scrollTop+r*Kt;T>=A?l(T,()=>{i.scrollTop=T-A}):l(T)},Qt)},l=(i,a)=>{const r=g.value,A=800,T=r.scrollTop,O=i-T,G=performance.now(),N=$=>$<.5?2*$*$:-1+(4-2*$)*$,V=$=>{const F=$-G,E=Math.min(F/A,1);r.scrollTop=T+O*N(E),E<1?requestAnimationFrame(V):a&&a()};requestAnimationFrame(V)};return ee(()=>{oe(()=>{o()})}),Se(()=>{clearInterval(C)}),(i,a)=>(y(),x("div",{class:X(["left_boottom scroll-view",{"show-scrollbar":m.value}]),ref_key:"scrollViewRef",ref:g,onMouseenter:I,onMouseleave:u},[e("div",{ref_key:"listRef",ref:k,class:"left_boottom_list"},[(y(!0),x(Z,null,ue(f.value,(r,A)=>(y(),x("div",{class:"left_boottom_item",key:A},[e("div",Et,[jt,e("div",Gt,[e("div",Jt,"告警名称："+v(r.aname),1),e("div",Ut,[e("div",qt,[Q(" 告警等级： "),e("span",{style:re({color:s(r.alevel).color,border:"1px solid "+s(r.alevel).color,padding:"0 5px",borderRadius:"5px"})},v(s(r.alevel).label),5)]),e("div",Yt,"时间："+v(r.dbtime),1)])])])]))),128))],512)],34))}},Zt=M(Xt,[["__scopeId","data-v-dc930ac1"]]),ea=B({name:"LineChart",__name:"power",props:{data:{required:!0},dataModifiers:{}},emits:["update:data"],setup(c){const t=(l,i)=>{const a=l.match(/\d+/g);return a?`rgba(${a[0]}, ${a[1]}, ${a[2]}, ${i})`:""};function d(l,i){return l===0||typeof l=="number"&&!isNaN(l)?l+i:""}const s=["rgb(233, 4, 69)","rgb(0, 150, 136)","rgb(59, 66, 146)","rgb(255, 99, 71)"],_=xe(c,"data"),f=b(null),m=Date.now(),g=new Date(m).setHours(23,59,59,999),{domRef:k,updateOptions:C,updateOptionsAsync:I}=_e(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function(l){return`
      ${l[0].axisValueLabel||""}<br/>
      <span class="round" style="background-color: ${s[0]}"></span> ${l[0].seriesName}: ${d(l[0].value[1]," MW")}<br/>
      <span class="round" style="background-color: ${s[1]}"></span> ${l[1].seriesName}: ${d(l[1].value[1]," MW")}<br/>
      <span class="round" style="background-color: ${s[2]}"></span> ${l[2].seriesName}: ${d(l[2].value[1]," W/m^2")}<br/>
      <span class="round" style="background-color: ${s[3]}"></span> ${l[3].seriesName}: ${d(l[3].value[1]," W/m^2")}<br/>
      `},backgroundColor:"#6a7985",textStyle:{color:"#d3d6dd"}},legend:{data:["实际功率","预测功率","实际辐射","预测辐射"],textStyle:{color:"#d3d6dd"}},grid:{left:"3%",right:"3%",bottom:"0%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:"{HH}:{mm}",color:"#d3d6dd"},max:g+60*1e3,data:[]},yAxis:[{name:"功率MW",type:"value",axisLabel:{formatter:"{value} MW",color:"#d3d6dd"},splitLine:{show:!1,lineStyle:{color:"#757575",width:1}},nameTextStyle:{color:"#d3d6dd"}},{name:"辐射W/m²",type:"value",axisLabel:{formatter:"{value} W/m²",color:"#d3d6dd"},nameTextStyle:{color:"#d3d6dd"},splitLine:{show:!0,lineStyle:{color:"#757575",width:1}}}],series:[{color:s[0],name:"实际功率",type:"line",emphasis:{focus:"series"},yAxisIndex:0,lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new R(0,0,0,1,[{offset:0,color:t(s[0],.3)},{offset:1,color:t(s[0],0)}],!1),shadowColor:t(s[0],.9),shadowBlur:20},data:[],connectNulls:!0},{color:s[1],name:"预测功率",type:"line",yAxisIndex:0,emphasis:{focus:"series"},lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new R(0,0,0,1,[{offset:0,color:t(s[1],.3)},{offset:1,color:t(s[1],0)}],!1),shadowColor:t(s[1],.9),shadowBlur:20},data:[],connectNulls:!0},{color:s[2],name:"实际辐射",type:"line",showSymbol:!1,yAxisIndex:1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new R(0,0,0,1,[{offset:0,color:t(s[2],.3)},{offset:1,color:t(s[2],0)}],!1),shadowColor:t(s[2],.7),shadowBlur:20},data:[],connectNulls:!0},{color:s[3],name:"预测辐射",type:"line",yAxisIndex:1,showSymbol:!1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new R(0,0,0,1,[{offset:0,color:t(s[3],.3)},{offset:1,color:t(s[3],0)}],!1),shadowColor:t(s[3],.7),shadowBlur:20},data:[],connectNulls:!0}]}));async function u(){await new Promise(l=>{setTimeout(l,1e3)}),C(l=>{if(_.value){const i=_.value.map(a=>({dbtime:a.dbtime,prePower:a.prePower,power:a.power,zfsd:a.zfsd,ssrd:a.ssrd}));l.xAxis.data=i.map(a=>a.dbtime),l.series[0].data=i.map(a=>[a.dbtime,a.power]),l.series[1].data=i.map(a=>[a.dbtime,a.prePower]),l.series[2].data=i.map(a=>[a.dbtime,a.zfsd]),l.series[3].data=i.map(a=>[a.dbtime,a.ssrd]),console.log(l.series,"seriesseriesseries")}return l})}fe(()=>_.value,l=>{I(i=>{if(_.value){const a=_.value.map(r=>({dbtime:r.dbtime,prePower:r.prePower,power:r.power,zfsd:r.zfsd,ssrd:r.ssrd}));i.xAxis.data=a.map(r=>r.dbtime),i.series[0].data=a.map(r=>[r.dbtime,r.power]),i.series[1].data=a.map(r=>[r.dbtime,r.prePower]),i.series[2].data=a.map(r=>[r.dbtime,r.zfsd]),i.series[3].data=a.map(r=>[r.dbtime,r.ssrd])}return i})});async function o(){await u()}return ee(()=>{k.value=f.value}),o(),(l,i)=>(y(),x("div",{ref_key:"chartDom",ref:f,class:"chart"},null,512))}}),ta=M(ea,[["__scopeId","data-v-3741cc7e"]]),aa=B({name:"LineChart",__name:"weather-chart",props:{data:{type:Array,default:[]}},setup(c){function t(u,o){return u===0||typeof u=="number"&&!isNaN(u)?u+o:""}const d=c,s=Date.now(),_=new Date(s).setHours(23,59,59,999),{domRef:f,updateOptions:m,showLoading:g,updateOptionsAsync:k}=_e(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(u){return t(u,"°C")},backgroundColor:"#6a7985",textStyle:{color:"#d3d6dd"}},legend:{data:["环境温度","预测温度","组件温度"],textStyle:{color:"#d3d6dd"}},grid:{left:"3%",right:"3%",bottom:"0%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:"{HH}:{mm}",color:"#d3d6dd"},max:_+60*1e3,data:[]},yAxis:{name:"温度(°C)",type:"value",axisLabel:{formatter:"{value} °C",color:"#d3d6dd"},splitLine:{show:!0,lineStyle:{color:"#757575",width:1}},nameTextStyle:{color:"#d3d6dd"}},series:[{color:"#27ae60",name:"环境温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new R(0,0,0,1,[{offset:0,color:"rgba(39, 174, 96,0.4)"},{offset:1,color:"rgba(39, 174, 96,0)"}],!1),shadowColor:"rgba(39, 174, 96,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#c0392b",name:"预测温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new R(0,0,0,1,[{offset:0,color:"rgba(192, 57, 43,0.3)"},{offset:1,color:"rgba(192, 57, 43,0)"}],!1),shadowColor:"rgba(192, 57, 43,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#ffa000",name:"组件温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new R(0,0,0,1,[{offset:0,color:"rgba(255, 160, 0,0.3)"},{offset:1,color:"rgba(255, 160, 0,0)"}],!1),shadowColor:"rgba(255, 160, 0,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0}]}));async function C(){await new Promise(u=>{setTimeout(u,1e3)}),m(u=>(d.data&&(u.xAxis.data=d.data.map(o=>o.dbtime),u.series[0].data=d.data.map(o=>[o.dbtime,o.envT]),u.series[1].data=d.data.map(o=>[o.dbtime,o.tt2]),u.series[2].data=d.data.map(o=>[o.dbtime,o.moduleT])),u))}async function I(){C()}return fe(()=>d.data,()=>{k(u=>(d.data&&(u.xAxis.data=d.data.map(o=>o.dbtime),u.series[0].data=d.data.map(o=>[o.dbtime,o.envT]),u.series[1].data=d.data.map(o=>[o.dbtime,o.tt2]),u.series[2].data=d.data.map(o=>[o.dbtime,o.moduleT])),u))}),I(),(u,o)=>(y(),x("div",{ref_key:"domRef",ref:f,class:"chart"},null,512))}}),sa=M(aa,[["__scopeId","data-v-ec72b241"]]),oa="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='12'%20height='12'%20viewBox='0%200%2012%2012'%3e%3cpath%20fill='%23fff'%20d='M2.5%2012c-.13%200-.25-.05-.35-.14l-2-1.93A.55.55%200%200%201%200%209.57V2.43c0-.13.06-.26.15-.36l2-1.93c.15-.14.36-.18.55-.1c.18.08.3.26.3.46v11c0%20.2-.12.38-.3.46c-.07.03-.13.04-.2.04m7-3.5c-.06%200-.13-.01-.19-.04A.5.5%200%200%201%209%208l-.01-4.06c0-.2.12-.39.31-.46c.19-.08.4-.03.54.11l1.67%201.7c.38.39.38%201.02-.01%201.41L9.85%208.35a.47.47%200%200%201-.35.15'%20/%3e%3cpath%20fill='none'%20stroke='%23fff'%20stroke-linecap='round'%20d='M2.5%202.5H6c.28%200%20.5.22.5.5v1m-4%205.5H6c.28%200%20.5-.22.5-.5V8M11%206H5'%20stroke-width='1'%20/%3e%3c/svg%3e",la={class:"content_wrap"},na={class:"d-flex jc-center title_wrap"},ra=Le('<div class="zuojuxing" data-v-566dfe32></div><div class="youjuxing" data-v-566dfe32></div><div class="guang" data-v-566dfe32></div><div class="d-flex jc-center" data-v-566dfe32><div class="title" data-v-566dfe32><span class="title-text" data-v-566dfe32>光功率预测系统可视化</span></div></div>',4),ca={class:"top_Info"},da={class:"left"},ia={class:"right"},ua={class:"setting_icon"},fa=["src"],_a={class:"index-box"},ma={class:"content_left"},pa={class:"content_right"},va=B({name:"bigscreen",__name:"index",setup(c){const t=ke(),d=De({dateDay:"",dateYear:"",dateWeek:"",timing:null}),s=["周日","周一","周二","周三","周四","周五","周六"];(()=>{d.timing=setInterval(()=>{d.dateDay=le().format("YYYY-MM-DD hh : mm : ss"),d.dateWeek=s[le().day()]},1e3)})();const f=b({}),m=async()=>{const{data:n,error:h}=await Ce();h||Object.assign(f.value,n)},g=async()=>{const{data:n,error:h}=await Ie();h||(f.value.cpu=n.cpu,f.value.mem=n.mem)},k=b(),C=async()=>{const{data:n,error:h}=await Te({_t:new Date().getTime()});k.value=n==null?void 0:n.pname},I=b(),u=async()=>{var p;const{data:n,error:h}=await ze();h||(I.value=n,I.value.length!=0&&(o.value=(p=n[0])==null?void 0:p.id,i()))},o=b(),l=b(),i=async()=>{const{data:n,error:h}=await Ve({devId:o.value});h||(l.value=n)},a=n=>{o.value=n,i(),F()},r=Date.now(),A=new Date(r).setHours(0,0,0,0),T=new Date(r).setHours(23,59,59,999),O=b(),G=async()=>{const{data:n,error:h}=await Fe({startTime:j(1,A),endTime:j(1,T),page:1,limit:100});h||(O.value=JSON.parse(JSON.stringify(n)).list)},N=b(),V=async()=>{const{data:n,error:h}=await Ne({date:j(0,Date.now())});h||(N.value=n,N.value.forEach(p=>(O.value.forEach(w=>{p.dbtime==w.dbtime&&(p.ssrd=w.ssrd)}),p)),$.value.forEach(p=>{const w=N.value.find(H=>H.dbtime===p.dbtime);w?Object.assign(w,p):N.value.push(p)}),N.value=N.value.sort((p,w)=>new Date(p.dbtime).getTime()-new Date(w.dbtime).getTime()))},$=b(),F=async()=>{if(!o.value)return;const{data:n,error:h}=await Ee({id:o.value,startTime:j(0,Date.now())+" 00:00:00",endTime:j(1,Date.now())});console.log("气象实际数据",n),$.value=n,O.value.forEach(p=>{const w=$.value.find(H=>H.dbtime===p.dbtime);w?Object.assign(w,p):$.value.push(p)}),$.value=$.value.sort((p,w)=>new Date(p.dbtime).getTime()-new Date(w.dbtime).getTime())},E=b([]),te=async()=>{const{data:n,error:h}=await Me({page:1,limit:20});h||(E.value=JSON.parse(JSON.stringify(n)).list)},ae=b(null),pe=()=>{var se;(se=ae.value)==null||se.close();const n=new Date().getTime(),h=Ae(),p=Oe(`${h}${n}getchlstatus`),w=ne(p),H=ne("getchlstatus"),W=new We(Be+`/ChannelStatusWebsocket/${H}/${w}/${n}/${h}?token=${He()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});ae.value=W,W.connect(),W.onclose(()=>{}),W.onerror(()=>{}),W.onopen(()=>{}),W.onmessage(Y=>{if(console.log(Y,"通道状态websocket接受数据"),!ve(Y.data))return;const P=JSON.parse(Y.data).dataStatus;P&&(f.value.col=P.col+""=="0"||P.col+""=="1"?P.col+"":"",f.value.trs=P.trs+""=="0"||P.trs+""=="1"?P.trs+"":"")})},ve=n=>{try{return JSON.parse(n),!0}catch{return!1}},he=()=>{var n;(n=window.$dialog)==null||n.info({title:"退出登录",content:"确定要退出登录吗?",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{const{data:h,error:p}=await Pe();p||(t.clearInfo(),window.location.reload())}})},we=b(null),be=b(null),J=b(!1);return ee(async()=>{C(),pe();try{J.value=!0,await u(),await m(),await g(),await G(),await F(),await V(),await te(),J.value=!1}catch{J.value=!1}we.value=setInterval(async()=>{await m(),await G(),await F(),await V(),await te(),C()},1e3*60*1),be.value=setInterval(async()=>{await i(),await g()},1e3*5)}),(n,h)=>{const p=Re,w=rt,H=Je;return y(),x(Z,null,[e("div",la,[e("div",na,[ra,e("div",ca,[e("div",da,[Q(v(k.value)+" ",1),D(p,{filterable:"",placeholder:"请选择气象站",value:o.value,"onUpdate:value":h[0]||(h[0]=W=>o.value=W),options:I.value,"label-field":"sname",size:"tiny","value-field":"id",style:{width:"140px","margin-left":"10px"},onUpdateValue:a},null,8,["value","options"])]),e("div",ia,[Q(v(d.dateYear)+" "+v(d.dateWeek)+" "+v(d.dateDay)+" ",1),e("div",ua,[e("img",{src:S(oa),alt:"",onClick:he},null,8,fa)])])])]),e("div",_a,[e("div",ma,[D(w,{class:"content_left-top",title:"运行状态"},{default:z(()=>[D(Vt,{data:f.value},null,8,["data"])]),_:1}),D(w,{class:"content_left-center",title:"最近告警"},{default:z(()=>[D(Zt,{data:E.value},null,8,["data"])]),_:1}),D(w,{class:"content_left-bottom",title:"气象信息"},{default:z(()=>[D(_t,{data:l.value},null,8,["data"])]),_:1})]),e("div",pa,[D(w,{class:"content_right-top",title:"今日功率"},{default:z(()=>[D(ta,{data:N.value},null,8,["data"])]),_:1}),D(w,{class:"content_right-bottom",title:"今日气象"},{default:z(()=>[D(sa,{data:$.value},null,8,["data"])]),_:1})])])]),J.value?(y(),de(H,{key:0})):ie("",!0)],64)}}}),ga=M(va,[["__scopeId","data-v-566dfe32"]]);export{ga as default};
