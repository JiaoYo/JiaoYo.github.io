import{d as N,n as C,dM as P,a4 as D,s as E,j as y,ae as $,o as k,c as B,w as u,f as g,g as n,aa as R,i as w,a_ as x,S as V,ar as M,P as I,Q as U,R as H,e as L,h as O,K as F,B as G,O as J,ad as Q}from"./index-Dau8rq44.js";import{n as W,a as j}from"./reportForm-B0PwWMBm.js";import{_ as q,a as z,b as K,c as X}from"./file-pdf-Cjf7vO42.js";import{_ as Y}from"./DatePicker-LBkROysW.js";import{a as Z,_ as ee}from"./Grid-CJI5vxn3.js";import"./echarts.vue_vue_type_script_setup_true_lang-D8N_jXLd.js";import"./index-BhRqCdHu.js";import"./installCanvasRenderer-CyOrKSjT.js";import"./install-CX03SWNg.js";import"./TimePicker-D7pUWN0O.js";import"./defineProperty-Cn2l6J40.js";const ae=p=>(I("data-v-d674d4e5"),p=p(),U(),p),le=ae(()=>g("span",{class:"mr-20px"},"报表预览",-1)),te={title:"导出PDF"},ne={title:"导出Word"},oe={title:"导出Excel"},se=N({name:"reportPreview",__name:"reportPreview",props:C({data:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(p){P(d=>({"03cdc49e":w(h)}));const i=D(),_=p,s=E(p,"visible"),c=y(""),b=()=>{var d,o;c.value=((o=(d=_.data)==null?void 0:d.find(r=>r.type=="title"))==null?void 0:o.value)+"报表"+x(1,new Date)};$(s,()=>{s.value&&b()});const f=y(),h=i.themeScheme=="dark"?"#001428":"#fff";return(d,o)=>{const r=q,l=z,a=K,e=X,t=V,v=M;return k(),B(v,{show:s.value,"onUpdate:show":o[3]||(o[3]=m=>s.value=m),preset:"card",class:"w-1000px reportPreview",style:R({"background-color":w(i).themeScheme=="dark"?"#001428":"#fff"})},{header:u(()=>[le,g("span",te,[n(r,{class:"text-32px c-#d63031 cursor-pointer",onClick:o[0]||(o[0]=m=>f.value.toPdf(c.value))})]),g("span",ne,[n(l,{class:"text-32px c-#1e90ff cursor-pointer",onClick:o[1]||(o[1]=m=>f.value.toWord(c.value))})]),g("span",oe,[n(a,{class:"text-32px c-#15703d cursor-pointer",onClick:o[2]||(o[2]=m=>f.value.toExcel(c.value))})])]),default:u(()=>[n(t,{class:"max-h-600px"},{default:u(()=>[n(e,{ref_key:"filePreviewExportRef",ref:f,width:800,data:_.data},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),re=H(se,[["__scopeId","data-v-d674d4e5"]]),ge=N({name:"reportmanagement_reporttemplate",__name:"index",setup(p){const i=y([]),_=y(!1),s=y({startTime:x(0,new Date().getTime()-864e5*3),endTime:x(0,new Date().getTime()),time:[new Date().getTime()-864e5*3,new Date().getTime()]}),c=["提示","低危","中危","高危","致命"],b=["lev0","lev1","lev2","lev3","lev4"];async function f(r,l){s.value.startTime=l?x(0,l[0]):void 0,s.value.endTime=l?x(0,l[1]):void 0}const h=async r=>{const{data:l,error:a}=await j({rtype:r});a||(l.forEach(e=>{e.rtext=JSON.parse(e.rtext)}),i.value=l[0].rtext,console.log(i.value,"reportTemplate.value"))},d=y([]),o=async()=>{await h(0);const{data:r}=await W({startTime:s.value.startTime,endTime:s.value.endTime});if(r){const l=JSON.parse(r);console.log(l,"报表接口返回数据"),i.value.forEach(a=>{if(a.type=="table"&&(a.dataName=="collection"&&(a.value.body=l.collection.map(e=>a.value.tableHeaderValue.map(t=>t=="ctime"?x(1,e[t]):e[t]))),a.dataName=="events"&&(a.value.body=l.events.map(e=>a.value.tableHeaderValue.map(t=>e[t]))),a.dataName=="level"&&(a.value.body=l.level.map(e=>a.value.tableHeaderValue.map(t=>e[t]))),a.dataName=="level1")){if(l.level.length==0)return a.value.body=[];a.value.body=b.map(e=>[e=="lev0"?"提示":e=="lev1"?"低危":e=="lev2"?"中危":e=="lev3"?"高危":"致命",l.level.reduce((t,v)=>t+(Number(v[e])||0),0)])}a.type=="chart"&&a.dataName=="events"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=l.events.map(e=>e.count),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=l.events.map(e=>e.cname):a.value.data.yAxis.data=l.events.map(e=>e.cname)),a.value.chartType=="pie"&&(a.value.data.series[0].data=l.events.map(e=>({value:e.count,name:e.cname}))),a.value.chartType=="line"&&(a.value.data.series[0].data=l.events.map(e=>e.count),a.value.data.xAxis.data=l.events.map(e=>e.cname))),a.dataName=="level"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=l.level.map(e=>e.count),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=l.level.map(e=>e.logname):a.value.data.yAxis.data=l.level.map(e=>e.logname)),a.value.chartType=="pie"&&(a.value.data.series[0].data=l.level.map(e=>({value:e.count,name:e.logname}))),a.value.chartType=="line"&&(a.value.data.series[0].data=l.level.map(e=>e.count),a.value.data.xAxis.data=l.level.map(e=>e.logname))),a.dataName=="level1"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(e=>l.level.reduce((t,v)=>t+(Number(v[e])||0),0)),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=c:a.value.data.yAxis.data=c),a.value.chartType=="pie"&&(a.value.data.series[0].data=[{value:l.level.reduce((e,t)=>e+t.lev0*1,0)==0?null:l.level.reduce((e,t)=>e+t.lev0*1,0),name:"提示"},{value:l.level.reduce((e,t)=>e+t.lev1*1,0)==0?null:l.level.reduce((e,t)=>e+t.lev1*1,0),name:"低危"},{value:l.level.reduce((e,t)=>e+t.lev2*1,0)==0?null:l.level.reduce((e,t)=>e+t.lev2*1,0),name:"中危"},{value:l.level.reduce((e,t)=>e+t.lev3*1,0)==0?null:l.level.reduce((e,t)=>e+t.lev3*1,0),name:"高危"},{value:l.level.reduce((e,t)=>e+t.lev4*1,0)==0?null:l.level.reduce((e,t)=>e+t.lev4*1,0),name:"致命"}]),a.value.chartType=="line"&&(a.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(e=>l.level.reduce((t,v)=>t+(Number(v[e])||0),0)),a.value.data.xAxis.data=c))}),d.value=i.value,console.log(d.value,"reportList.value"),_.value=!0}};return(r,l)=>{const a=Y,e=F,t=G,v=J,m=Q,S=Z,A=ee;return k(),L("div",null,[n(A,{"x-gap":"12",cols:2},{default:u(()=>[n(S,null,{default:u(()=>[n(m,{title:"报表信息"},{default:u(()=>[n(v,{ref:"formRef","label-width":80,"label-placement":"left",model:s.value},{default:u(()=>[n(e,{label:"查询日期",path:"selectTime"},{default:u(()=>[n(a,{value:s.value.time,"onUpdate:value":l[0]||(l[0]=T=>s.value.time=T),type:"daterange",class:"w-100%","onUpdate:formattedValue":f},null,8,["value"])]),_:1}),n(e,{label:" "},{default:u(()=>[n(t,{"attr-type":"button",onClick:o},{default:u(()=>[O(" 查询 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),n(re,{data:d.value,visible:_.value,"onUpdate:visible":l[1]||(l[1]=T=>_.value=T)},null,8,["data","visible"])])}}});export{ge as default};
