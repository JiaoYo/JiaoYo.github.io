import{_ as X}from"./refresh-BeWxBXlv.js";import{d as W,n as Y,a3 as J,p as ee,s as te,D as R,o as A,c as P,w as n,g as a,E as S,i,$ as _,W as G,h as f,t as V,F as ae,J as le,Z as ne,B as x,N as Z,O as se,ad as Q,j as h,r as K,av as H,A as oe,e as re,bo as ie,ai as ue,aj as ce,R as de}from"./index-BcwJAI2q.js";import{m as me,n as pe,o as fe,b as _e}from"./common-BQGs6Sbh.js";import{_ as ge,l as he}from"./lodash-DfU1tBZO.js";import{_ as ve}from"./round-search-A0B-hsZK.js";import{_ as ye}from"./round-refresh-BT4eYGbi.js";import{C as be,a as xe}from"./common-Dv3OZ6cM.js";import{a as we,T as ke}from"./basicconf-CsnXJKh_.js";import{_ as ze}from"./FormItemGridItem-D5iCQy7z.js";import{_ as Ce}from"./Grid-CMuoBycw.js";import{_ as D}from"./Popconfirm-MBwapZUM.js";const Se=W({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Y(["reset","search"],["update:model"]),setup(y,{emit:N}){const w=N,c=J(),{formRef:M,restoreValidation:s}=ee(),r=te(y,"model");function I(){r.value.fuzzy=void 0,w("search")}async function m(){await s(),r.value.fuzzy=null,r.value.status=null,r.value.alevel=null,w("reset")}async function d(){w("search")}const v=ge.debounce(d,1e3,{leading:!0,trailing:!1});return(B,g)=>{const T=le,b=ze,k=ne,O=ye,z=x,p=ve,$=Z,U=Ce,E=se,F=Q,e=R("no-space");return A(),P(F,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(E,{ref_key:"formRef",ref:M,model:r.value,"label-placement":"left","label-width":i(c).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:ae(i(v),["enter"])},{default:n(()=>[a(U,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[a(b,{span:"24 s:12 m:8 l:6",label:"告警名称",path:"fuzzy"},{default:n(()=>[S(a(T,{autofocus:"",value:r.value.fuzzy,"onUpdate:value":g[0]||(g[0]=t=>r.value.fuzzy=t),placeholder:"请输入告警名称",clearable:"",onClear:I},null,8,["value"]),[[e]])]),_:1}),a(b,{span:"24 s:12 m:8 l:6",label:"告警状态",path:"status"},{default:n(()=>[a(k,{filterable:"",clearable:"",placeholder:i(_)("page.manage.alarm.form.status"),value:r.value.status,"onUpdate:value":[g[1]||(g[1]=t=>r.value.status=t),d],options:i(G)(i(be))},null,8,["placeholder","value","options"])]),_:1}),a(b,{span:"24 s:12 m:8 l:6",label:"级别",path:"alevel"},{default:n(()=>[a(k,{filterable:"",clearable:"",placeholder:i(_)("page.manage.alarm.form.status"),value:r.value.alevel,"onUpdate:value":[g[2]||(g[2]=t=>r.value.alevel=t),d],options:i(G)(i(we))},null,8,["placeholder","value","options"])]),_:1}),a(b,{span:"24 s:12 m:8 l:6"},{default:n(()=>[a($,{class:"w-full flex items-center"},{default:n(()=>[a(z,{onClick:m},{icon:n(()=>[a(O,{class:"text-icon"})]),default:n(()=>[f(" "+V(i(_)("common.reset")),1)]),_:1}),a(z,{type:"primary",ghost:"",onClick:i(v)},{icon:n(()=>[a(p,{class:"text-icon"})]),default:n(()=>[f(" "+V(i(_)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width","onKeyup"])]),_:1})}}}),Ne={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function q(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!ue(y)}const Ie=W({name:"platformalarm_systemalarm",__name:"index",setup(y){const N=h(window.innerHeight-360),w=J();h(!1),h();const c=K({pageSize:100,pageId:void 0,status:void 0,fuzzy:void 0}),M=[{type:"selection",align:"center",width:48,fixed:"left"},{title:"",key:"index",width:80,align:"center",render:e=>`${e.index}`},{key:"aname",title:"告警名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"uname",title:"用户",align:"center",width:100,render:()=>"系统"},{key:"status",title:_("page.manage.alarm.status"),align:"center",width:120,render:e=>{(e.status===void 0||e.status===null)&&(e.status=0);const t={0:"error",1:"success"},l=_(xe[e.status]);return a(H,{size:"small",type:t[e.status]},q(l)?l:{default:()=>[l]})}},{key:"dbtime",title:"发生时间",align:"center",width:180},{key:"alevel",title:"事件等级",align:"center",width:120,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},l=_(ke[e.alevel]);let u={color:t[e.alevel],textColor:"#ffffff",borderColor:t[e.alevel]};return a(H,{size:"small",color:u},q(l)?l:{default:()=>[l]})}},{key:"adec",title:"告警描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"operate",title:_("common.operate"),align:"center",width:130,fixed:"right",render:e=>a("div",{class:"flex-center gap-8px"},[e.status==0&&a(D,{onPositiveClick:()=>k(e.id+"")},{default:()=>"确定要确认该告警数据吗？",trigger:()=>S(a(x,{type:"primary",ghost:!0,size:"small"},{default:()=>[f("确认")]}),[[R("no-auth"),"sys.system.alarm.update"]])}),a(D,{onPositiveClick:()=>z(e.id+"")},{default:()=>"确定要删除该告警数据吗？",trigger:()=>S(a(x,{type:"error",ghost:!0,size:"small"},{default:()=>[f("删除")]}),[[R("no-auth"),"sys.system.alarm.delete"]])})])}],s=h([]),r=h(!1),I=h(0),m=h([]),d=async(e=!1)=>{if(!r.value)r.value=!0;else return;r.value=!0;const{data:t,error:l}=await _e(c);l||(I.value=t.length,e?s.value=[...s.value,...t]:s.value=t,s.value=s.value.sort((u,o)=>o.id-u.id).map((u,o)=>(u.index=o+1,u)),r.value=!1)},v=h(!0),B=async()=>{s.value=[],c.pageId=void 0,(t=>Object.keys(t).filter(o=>o!=="limit"&&o!=="_t").some(o=>t[o]!==void 0&&t[o]!==""&&t[o]!==null))(c)?v.value=!1:(v.value=!0,$()),await d(),T()},g=()=>{B(),v.value=!0},T=async()=>{var e,t,l;if(s.value.length<N.value/44&&s.value.length<p.total){if(c.pageId==((e=s.value[s.value.length-1])==null?void 0:e.id))return;c.pageId=((l=(t=s.value)==null?void 0:t[s.value.length-1])==null?void 0:l.id)??void 0,d(!0)}};oe(async()=>{await d(),await $(),T()});const b=()=>{k(m.value.join(","))},k=async e=>{var u,o;const{data:t,error:l}=await me({ids:e});l||(c.pageId=void 0,d(),(u=window.$message)==null||u.destroyAll(),(o=window.$message)==null||o.success("确认成功"),m.value=[])},O=()=>{z(m.value.join(","))},z=async e=>{var u,o;const{data:t,error:l}=await pe({ids:e});l||(c.pageId=void 0,d(),(u=window.$message)==null||u.destroyAll(),(o=window.$message)==null||o.success("删除成功"))},p=K({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:t,page:l,pageSize:u,pageCount:o,itemCount:L}){return`已加载${s.value.length}条`+(s.value.length?v.value?` 共计 ${s.value.length>0?L??0:0} 条`:I.value==c.pageSize?"  预计还有更多":"  没有更多了":"")}});async function $(){const{data:e,error:t}=await fe();t||(p.pageCount=20,p.total=Number(e),p.itemCount=Number(e))}function U(e){var l;Math.abs(e.target.scrollTop+e.target.offsetHeight-e.target.scrollHeight)<=20&&p.total>((l=s.value)==null?void 0:l.length)&&E()}const E=he.debounce(()=>{var e;((e=s.value)==null?void 0:e.length)<p.total&&(c.pageId=s.value[s.value.length-1].id,d(!0))},300),F=()=>{c.pageId=void 0,d()};return(e,t)=>{const l=X,u=Z,o=ce,L=Q,j=R("no-auth");return A(),re("div",Ne,[a(Se,{model:c,"onUpdate:model":t[0]||(t[0]=C=>c=C),onReset:g,onSearch:B},null,8,["model"]),a(L,{title:"系统告警",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(u,null,{default:n(()=>[a(i(D),{onPositiveClick:b},{trigger:n(()=>[S((A(),P(i(x),{size:"small",ghost:"",type:"primary",disabled:m.value.length===0},{default:n(()=>[f(" 批量确认 ")]),_:1},8,["disabled"])),[[j,"sys.system.alarm.update"]])]),default:n(()=>[f(" 确定要确认选中的数据吗？ ")]),_:1}),a(i(D),{onPositiveClick:O},{trigger:n(()=>[S((A(),P(i(x),{size:"small",ghost:"",type:"error",disabled:m.value.length===0},{default:n(()=>[f(" 批量删除 ")]),_:1},8,["disabled"])),[[j,"sys.system.alarm.delete"]])]),default:n(()=>[f(" 确定要删除选中的数据吗？ ")]),_:1}),a(i(x),{size:"small",onClick:F},{icon:n(()=>[a(l,{class:ie(["text-icon",{"animate-spin":r.value}])},null,8,["class"])]),default:n(()=>[f(" "+V(i(_)("common.refresh")),1)]),_:1})]),_:1})]),default:n(()=>[a(o,{columns:M,"checked-row-keys":m.value,"onUpdate:checkedRowKeys":t[1]||(t[1]=C=>m.value=C),data:s.value,size:"small","virtual-scroll":"","flex-height":!i(w).isMobile,loading:r.value,remote:"","row-key":C=>C.id,"max-height":N.value,pagination:p,onScroll:U,class:"sm:h-full","scroll-x":""},null,8,["checked-row-keys","data","flex-height","loading","row-key","max-height","pagination"])]),_:1})])}}}),Le=de(Ie,[["__scopeId","data-v-6d9c3d24"]]);export{Le as default};
