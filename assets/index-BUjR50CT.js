import{_ as Ye}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DdOedQhL.js";import{aL as D,aM as be,aO as ae,aN as pe,ce as ve,cf as et,d as ce,aQ as Pe,b8 as tt,aR as je,a5 as at,aW as $,cg as it,ch as lt,bb as nt,ci as st,C as ot,bc as rt,b as ie,cj as V,aV as dt,a_ as Ce,ck as ke,aX as he,cl as ct,cm as ze,cn as ut,co as pt,n as we,p as Ue,s as Oe,j as L,o as M,c as le,w as c,g as i,i as s,W as $e,b3 as mt,h as H,t as ee,$ as B,F as Me,Z as Ie,B as q,N as Be,O as Fe,ad as Le,r as ye,q as ft,ae as De,G as Y,f as _e,e as ne,J as xe,as as me,aq as gt,aa as Re,cp as bt,cq as fe,aK as vt,b5 as Ve,K as ht,at as yt,an as Ge,ah as _t,ai as xt,b1 as wt,R as $t,a3 as It,cr as St,cs as Ct,E as Ne,D as Te,al as ge,am as kt}from"./index-EnN1oTT8.js";import{u as zt,a as Dt}from"./table-u1jWyaHq.js";import{_ as Rt}from"./round-search-B80VgLvj.js";import{_ as Nt}from"./round-refresh-Njuwup9N.js";import{b as Ke,d as Tt}from"./collection-qf1JPLsF.js";import{_ as At}from"./lodash-DHI4oosI.js";import{_ as Et}from"./FormItemGridItem-BC8wjQ0Z.js";import{_ as Pt}from"./Grid-DsRLBGrV.js";import{n as jt,o as We,p as Ut,q as Ot,r as Mt}from"./events-BRICudH0.js";import{c as Bt,f as Ft,a as Lt}from"./common-x1hGYHl7.js";import{_ as Vt}from"./Cascader-BERseLzf.js";import{h as Ae}from"./permission-xz2KqDYj.js";import{_ as Gt}from"./Popconfirm-UZXYMug3.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DwnBBYAk.js";import"./setting-outlined-CSDIS62u.js";import"./export-Bu3SXEug.js";import"./refresh-nAjTIJ7c.js";import"./round-delete-GXHNMzSj.js";import"./round-plus-oQqT1YS2.js";import"./Upload-B6HtpkLC.js";import"./Progress-CMHgXLqF.js";const Kt=D("steps",`
 width: 100%;
 display: flex;
`,[D("step",`
 position: relative;
 display: flex;
 flex: 1;
 `,[be("disabled","cursor: not-allowed"),be("clickable",`
 cursor: pointer;
 `),ae("&:last-child",[D("step-splitor","display: none;")])]),D("step-splitor",`
 background-color: var(--n-splitor-color);
 margin-top: calc(var(--n-step-header-font-size) / 2);
 height: 1px;
 flex: 1;
 align-self: flex-start;
 margin-left: 12px;
 margin-right: 12px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `),D("step-content","flex: 1;",[D("step-content-header",`
 color: var(--n-header-text-color);
 margin-top: calc(var(--n-indicator-size) / 2 - var(--n-step-header-font-size) / 2);
 line-height: var(--n-step-header-font-size);
 font-size: var(--n-step-header-font-size);
 position: relative;
 display: flex;
 font-weight: var(--n-step-header-font-weight);
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `,[pe("title",`
 white-space: nowrap;
 flex: 0;
 `)]),pe("description",`
 color: var(--n-description-text-color);
 margin-top: 12px;
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `)]),D("step-indicator",`
 background-color: var(--n-indicator-color);
 box-shadow: 0 0 0 1px var(--n-indicator-border-color);
 height: var(--n-indicator-size);
 width: var(--n-indicator-size);
 border-radius: 50%;
 display: flex;
 align-items: center;
 justify-content: center;
 transition:
 background-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 `,[D("step-indicator-slot",`
 position: relative;
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 font-size: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 `,[pe("index",`
 display: inline-block;
 text-align: center;
 position: absolute;
 left: 0;
 top: 0;
 white-space: nowrap;
 font-size: var(--n-indicator-index-font-size);
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ve()]),D("icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ve()]),D("base-icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ve()])])]),be("vertical","flex-direction: column;",[et("show-description",[ae(">",[D("step","padding-bottom: 8px;")])]),ae(">",[D("step","margin-bottom: 16px;",[ae("&:last-child","margin-bottom: 0;"),ae(">",[D("step-indicator",[ae(">",[D("step-splitor",`
 position: absolute;
 bottom: -8px;
 width: 1px;
 margin: 0 !important;
 left: calc(var(--n-indicator-size) / 2);
 height: calc(100% - var(--n-indicator-size));
 `)])]),D("step-content",[pe("description","margin-top: 8px;")])])])])])]);function Wt(l,w){return typeof l!="object"||l===null||Array.isArray(l)?null:(l.props||(l.props={}),l.props.internalIndex=w+1,l)}function qt(l){return l.map((w,g)=>Wt(w,g))}const Ht=Object.assign(Object.assign({},je.props),{current:Number,status:{type:String,default:"process"},size:{type:String,default:"medium"},vertical:Boolean,"onUpdate:current":[Function,Array],onUpdateCurrent:[Function,Array]}),qe=nt("n-steps"),Zt=ce({name:"Steps",props:Ht,setup(l,{slots:w}){const{mergedClsPrefixRef:g,mergedRtlRef:y}=Pe(l),u=tt("Steps",y,g),b=je("Steps","-steps",Kt,st,l,g);return at(qe,{props:l,mergedThemeRef:b,mergedClsPrefixRef:g,stepsSlots:w}),{mergedClsPrefix:g,rtlEnabled:u}},render(){const{mergedClsPrefix:l}=this;return $("div",{class:[`${l}-steps`,this.rtlEnabled&&`${l}-steps--rtl`,this.vertical&&`${l}-steps--vertical`]},qt(it(lt(this))))}}),Jt={status:String,title:String,description:String,disabled:Boolean,internalIndex:{type:Number,default:0}},Qt=ce({name:"Step",props:Jt,setup(l){const w=ot(qe,null);w||rt("step","`n-step` must be placed inside `n-steps`.");const{inlineThemeDisabled:g}=Pe(),{props:y,mergedThemeRef:u,mergedClsPrefixRef:b,stepsSlots:I}=w,S=ie(()=>y.vertical),P=ie(()=>{const{status:f}=l;if(f)return f;{const{internalIndex:h}=l,{current:R}=y;if(R===void 0)return"process";if(h<R)return"finish";if(h===R)return y.status||"process";if(h>R)return"wait"}return"process"}),G=ie(()=>{const{value:f}=P,{size:h}=y,{common:{cubicBezierEaseInOut:R},self:{stepHeaderFontWeight:j,[V("stepHeaderFontSize",h)]:F,[V("indicatorIndexFontSize",h)]:N,[V("indicatorSize",h)]:J,[V("indicatorIconSize",h)]:Q,[V("indicatorTextColor",f)]:K,[V("indicatorBorderColor",f)]:W,[V("headerTextColor",f)]:se,[V("splitorColor",f)]:oe,[V("indicatorColor",f)]:te,[V("descriptionTextColor",f)]:X}}=u.value;return{"--n-bezier":R,"--n-description-text-color":X,"--n-header-text-color":se,"--n-indicator-border-color":W,"--n-indicator-color":te,"--n-indicator-icon-size":Q,"--n-indicator-index-font-size":N,"--n-indicator-size":J,"--n-indicator-text-color":K,"--n-splitor-color":oe,"--n-step-header-font-size":F,"--n-step-header-font-weight":j}}),C=g?dt("step",ie(()=>{const{value:f}=P,{size:h}=y;return`${f[0]}${h[0]}`}),G,y):void 0,t=ie(()=>{if(l.disabled)return;const{onUpdateCurrent:f,"onUpdate:current":h}=y;return f||h?()=>{f&&Ce(f,l.internalIndex),h&&Ce(h,l.internalIndex)}:void 0});return{stepsSlots:I,mergedClsPrefix:b,vertical:S,mergedStatus:P,handleStepClick:t,cssVars:g?void 0:G,themeClass:C==null?void 0:C.themeClass,onRender:C==null?void 0:C.onRender}},render(){const{mergedClsPrefix:l,onRender:w,handleStepClick:g,disabled:y}=this,u=ke(this.$slots.default,b=>{const I=b||this.description;return I?$("div",{class:`${l}-step-content__description`},I):null});return w==null||w(),$("div",{class:[`${l}-step`,y&&`${l}-step--disabled`,!y&&g&&`${l}-step--clickable`,this.themeClass,u&&`${l}-step--show-description`,`${l}-step--${this.mergedStatus}-status`],style:this.cssVars,onClick:g},$("div",{class:`${l}-step-indicator`},$("div",{class:`${l}-step-indicator-slot`},$(ct,null,{default:()=>ke(this.$slots.icon,b=>{const{mergedStatus:I,stepsSlots:S}=this;return I==="finish"||I==="error"?I==="finish"?$(ze,{clsPrefix:l,key:"finish"},{default:()=>he(S["finish-icon"],()=>[$(ut,null)])}):I==="error"?$(ze,{clsPrefix:l,key:"error"},{default:()=>he(S["error-icon"],()=>[$(pt,null)])}):null:b||$("div",{key:this.internalIndex,class:`${l}-step-indicator-slot__index`},this.internalIndex)})})),this.vertical?$("div",{class:`${l}-step-splitor`}):null),$("div",{class:`${l}-step-content`},$("div",{class:`${l}-step-content-header`},$("div",{class:`${l}-step-content-header__title`},he(this.$slots.title,()=>[this.title])),this.vertical?null:$("div",{class:`${l}-step-splitor`})),u))}}),Xt=ce({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:we(["reset","search"],["update:model"]),setup(l,{emit:w}){const g=w,{formRef:y,restoreValidation:u}=Ue(),b=Oe(l,"model");L();const I=async C=>{P()};async function S(){await u(),g("reset")}async function P(){g("search")}const G=At.debounce(P,1e3,{leading:!0,trailing:!1});return(C,t)=>{const f=Ie,h=Et,R=Nt,j=q,F=Rt,N=Be,J=Pt,Q=Fe,K=Le;return M(),le(K,{bordered:!1,size:"small",class:"card-wrapper"},{default:c(()=>[i(Q,{ref_key:"formRef",ref:y,model:b.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Me(s(G),["enter"])},{default:c(()=>[i(J,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:c(()=>[i(h,{span:"24 s:12 m:6",label:"接入方式",path:"itype"},{default:c(()=>[i(f,{value:b.value.itype,"onUpdate:value":[t[0]||(t[0]=W=>b.value.itype=W),I],placeholder:"请选择接入方式",filterable:"",options:s($e)(s(Ke))},null,8,["value","options"])]),_:1}),i(h,{span:"24 s:12 m:8 l:6",label:"状态",path:"ieanble"},{default:c(()=>[i(f,{filterable:"",value:b.value.ieanble,"onUpdate:value":[t[1]||(t[1]=W=>b.value.ieanble=W),P],clearable:"",placeholder:"请选择状态",options:s($e)(s(mt)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),i(h,{span:"24 s:12 m:8 l:6"},{default:c(()=>[i(N,{class:"w-full"},{default:c(()=>[i(j,{onClick:S},{icon:c(()=>[i(R,{class:"text-icon"})]),default:c(()=>[H(" "+ee(s(B)("common.reset")),1)]),_:1}),i(j,{type:"primary",ghost:"",onClick:s(G)},{icon:c(()=>[i(F,{class:"text-icon"})]),default:c(()=>[H(" "+ee(s(B)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Yt={class:"ml-30px h-100%"},ea={style:{width:"100%",border:"1px solid #ccc",padding:"8px","white-space":"pre-wrap","user-select":"none"}},ta="(?<dbtime>[A-Za-z]{3}\\s{1,2}\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{4}[-/]\\d{2}[-/]\\d{2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{1,2}-[A-Za-z]{3}-\\d{4}\\s\\d{2}:\\d{2}:\\d{2}|\\d{2}:\\d{2}:\\d{2}\\s\\d{4}(?:[-/]\\d{2}){2})",aa="(?<etime>[A-Za-z]{3}\\s{1,2}\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{4}[-/]\\d{2}[-/]\\d{2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{1,2}-[A-Za-z]{3}-\\d{4}\\s\\d{2}:\\d{2}:\\d{2}|\\d{2}:\\d{2}:\\d{2}\\s\\d{4}(?:[-/]\\d{2}){2})",ia=ce({name:"OperateDrawer",__name:"operate-drawer",props:we({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:we(["submitted","setItype"],["update:visible"]),setup(l,{emit:w}){const g=l,y=w,u=ye({current:1}),b=Oe(l,"visible"),{formRef:I,validate:S,restoreValidation:P}=Ue(),{defaultRequiredRule:G}=ft(),C=ie(()=>({add:"新增自定义解析",edit:"修改自定义解析"})[g.operateType]),t=ye(f());function f(){return{id:void 0,itype:null,cvalue:"",orilog:"",multi:"",expre:"",ieanble:0,alevel:void 0,isort:0,itext:"",result:"",logcateid:null,logtypeid:null,ectgrid:void 0,etypeid:void 0}}const h={orilog:G,itype:{required:!0,type:"number",trigger:["blur","change"],message:"接入方式"},logtypeid:{required:!0,type:"number",trigger:["blur","change"],message:"请选择日志源设备"},etypeid:{required:!0,type:"number",trigger:["blur","change"],message:"请选择事件"}},R=`Time${bt()}`,j=L([{id:1,value:"(?<priority>.+)",label:"优先级",disabled:!1},{id:2,value:R,label:"日志时间",disabled:!1},{id:100,value:"(?<gsubject>.+)",label:"事件主体",disabled:!1},{id:101,value:"(?<gobject>.+)",label:"事件客体",disabled:!1},{id:102,value:"(?<gdescribe>.+)",label:"事件描述",disabled:!1},{id:103,value:"(?<gresult>.+)",label:"事件结果",disabled:!1},{id:3,value:"(?<hname>.+)",label:"主机名",disabled:!1},{id:4,value:"(?<aname>.+)",label:"应用名称",disabled:!1},{id:5,value:"(?<procid>.+)",label:"PROCID",disabled:!1},{id:6,value:"(?<msgid>.+)",label:"MSGID",disabled:!1},{id:7,value:"(?<adata>{[sS]*?})",label:"结构数据",disabled:!1},{id:8,value:"(?<lcon>.+)",label:"日志内容",disabled:!1}]),F=L([{id:1,value:"(?<eige>.+)",label:"特征值ID",disabled:!1},{id:2,value:"(?<userv>.+)",label:"用户ID",disabled:!1},{id:100,value:"(?<osubject>.+)",label:"事件主体",disabled:!1},{id:101,value:"(?<oobject>.+)",label:"事件客体",disabled:!1},{id:102,value:"(?<odescribe>.+)",label:"事件描述",disabled:!1},{id:103,value:"(?<oresult>.+)",label:"事件结果",disabled:!1},{id:3,value:"(?<target>.+)",label:"目标对象",disabled:!1},{id:4,value:R,label:"日志时间",disabled:!1},{id:5,value:"(?<oaction>.+)",label:"动作",disabled:!1},{id:6,value:"(?<eresult>.+)",label:"事件结果",disabled:!1},{id:7,value:"(?<edesc>.+)",label:"事件描述",disabled:!1},{id:8,value:"(?<originip>.+)",label:"源IP",disabled:!1},{id:9,value:"(?<originaddr>.+)",label:"源地址",disabled:!1},{id:10,value:"(?<originport>.+)",label:"源端口",disabled:!1},{id:11,value:"(?<originasset>.+)",label:"源资产",disabled:!1},{id:12,value:"(?<originmac>.+)",label:"源MAC",disabled:!1},{id:13,value:"(?<originmask>.+)",label:"源掩码",disabled:!1},{id:14,value:"(?<aimip>.+)",label:"目的IP",disabled:!1},{id:15,value:"(?<aimaddr>.+)",label:"目的地址",disabled:!1},{id:16,value:"(?<aimport>.+)",label:"目的端口",disabled:!1},{id:17,value:"(?<aimasset>.+)",label:"目的资产",disabled:!1},{id:18,value:"(?<aimmac>.+)",label:"目的MAC地址",disabled:!1},{id:19,value:"(?<aimmask>.+)",label:"目的掩码",disabled:!1},{id:20,value:"(?<sourceip>.+)",label:"发生源IP",disabled:!1},{id:21,value:"(?<sourcecountry>.+)",label:"源国家",disabled:!1},{id:22,value:"(?<sourcecountrylong>.+)",label:"源国家经度",disabled:!1},{id:23,value:"(?<sourcecountrylati>.+)",label:"源国家纬度",disabled:!1},{id:24,value:"(?<sourceregin>.+)",label:"源区域",disabled:!1},{id:25,value:"(?<sourcereginlong>.+)",label:"源区域经度",disabled:!1},{id:26,value:"(?<sourcereginlati>.+)",label:"源区域维度",disabled:!1},{id:27,value:"(?<aimcountry>.+)",label:"目的国家",disabled:!1},{id:28,value:"(?<aimcountrylong>.+)",label:"目的国家经度",disabled:!1},{id:29,value:"(?<aimcountrylati>.+)",label:"目的国家纬度",disabled:!1},{id:30,value:"(?<aimregin>.+)",label:"目的区域",disabled:!1},{id:31,value:"(?<aimreginlong>.+)",label:"目的区域经度",disabled:!1},{id:32,value:"(?<aimreginlati>.+)",label:"目的区域维度",disabled:!1},{id:33,value:"(?<protocol>.+)",label:"协议",disabled:!1}]),N=L(),J=async()=>{const{data:e,error:a}=await Bt();a||(N.value=e.map(r=>({...r,id:"-"+r.id,type:r.cname})))},Q=(e,a)=>{console.log(a),t.logcateid=a==null?void 0:a.category,t.logtypeid=a==null?void 0:a.id},K=L();async function W(){const{data:e,error:a}=await Ft();a||(K.value=e,await se())}async function se(){const{data:e,error:a}=await Lt();if(!a){let r=K.value.concat(e);K.value=wt(r)}}const oe=(e,a)=>{t.ectgrid=a==null?void 0:a.pid,t.etypeid=a==null?void 0:a.id};async function te(){u.current=1,J(),W(),O.list=[],T.value=new Set([]),Object.assign(t,f()),g.operateType==="edit"&&g.rowData&&Object.assign(t,g.rowData)}function X(){b.value=!1}const T=L(new Set),o=L(null),d=L([]);function A(e){var de,ue;let a=!0;const r=t.orilog,v=window.getSelection();if(!v.rangeCount)return;const p=v.getRangeAt(0),n=p.startContainer,_=p.endContainer;if(v.removeAllRanges(),!o.value.contains(n)||!o.value.contains(_))return;const Z=Array.from(o.value.childNodes),m=Z.indexOf(n.parentNode)-1,z=Z.indexOf(_.parentNode);if(console.log("startIndex",m),console.log("endIndex",z),z-m==0)return!1;for(let E=m;E<z;E++)T.value.has(E)&&(console.log("尝试选择已禁用的字符，操作被阻止"),a=!1);if(a){if(m>=0&&z>=0&&m<=z)for(let E=m;E<z;E++)d.value.push(E);for(let E=m;E<z;E++)T.value.add(E);m>0&&T.value.add(m-1),z<r.length&&T.value.add(z),O.list.push({startIndex:m,endIndex:z,name:r.substring(m,z),multipegroup:null,value:null})}else return(de=window.$message)==null||de.destroyAll(),(ue=window.$message)==null||ue.warning("相邻划词不允许选中。"),!1;console.log("当前选中的文本:",r.substring(m,z)),console.log("已禁用的字符索引:",Array.from(T.value))}async function U(){var e,a;if(console.log(t),g.operateType==="add"){const{data:r,error:v}=await jt([{itype:t.itype,itext:fe(String.raw`${t.expre}`),ieanble:t.ieanble,alevel:t.alevel,isort:t.isort,logcateid:t.logcateid,logtypeid:t.logtypeid,ectgrid:t.ectgrid,etypeid:t.etypeid}]);v||((e=window.$message)==null||e.success(B("common.addSuccess")),X(),y("submitted"),y("setItype",t.itype))}else{const{data:r,error:v}=await We([{id:t.id,itype:t.itype,itext:fe(String.raw`${t.expre}`),ieanble:t.ieanble,alevel:t.alevel,isort:t.isort,logcateid:t.logcateid,logtypeid:t.logtypeid,ectgrid:t.ectgrid,etypeid:t.etypeid}]);v||((a=window.$message)==null||a.success(B("common.updateSuccess")),X(),y("submitted"))}}const re=async()=>{console.log(String.raw`${t.expre}`);const{data:e,error:a}=await Ut({pattern:fe(String.raw`${t.expre}`),originalLog:fe(t.orilog),type:t.itype==0||t.itype==1?0:1});e&&(t.result=(t.itype==0||t.itype==1?[e.lsid&&`设备ID: ${e.lsid}`,e.rdbtime&&`接收时间: ${e.rdbtime}`,e.gsubject&&`事件主体: ${e.gsubject}`,e.gobject&&`事件客体: ${e.gobject}`,e.gdescribe&&`事件描述: ${e.gdescribe}`,e.gresult&&`事件结果: ${e.gresult}`,e.lmid&&`模块ID: ${e.lmid}`,e.leid&&`级别ID: ${e.leid}`,e.ipaddr&&`发生源IP: ${e.ipaddr}`,e.aname&&`应用名称: ${e.aname}`,e.procid&&`PROCID: ${e.procid}`,e.msgid&&`MSGID: ${e.msgid}`,e.dbtime&&`日志时间: ${e.dbtime}`,e.hname&&`主机名称: ${e.hname}`,e.adata&&`结构数据: ${e.adata}`,e.lcon&&`日志内容: ${e.lcon}`,e.ltext&&`日志原文: ${e.ltext}`]:[e.eige&&`特征值ID: ${e.eige}`,e.userv&&`用户ID: ${e.userv}`,e.osubject&&`事件主体: ${e.osubject}`,e.oobject&&`事件客体: ${e.oobject}`,e.odescribe&&`事件描述: ${e.oresult}`,e.oresult&&`事件结果: ${e.oresult}`,e.target&&`目标对象: ${e.target}`,e.etime&&`日志时间: ${e.etime}`,e.oaction&&`动作: ${e.oaction}`,e.eresult&&`事件结果: ${e.eresult}`,e.edesc&&`事件描述: ${e.edesc}`,e.originip&&`源IP: ${e.originip}`,e.originaddr&&`源地址: ${e.originaddr}`,e.originport&&`源端口: ${e.originport}`,e.originasset&&`源资产: ${e.originasset}`,e.originmac&&`源MAC: ${e.originmac}`,e.originmask&&`源掩码: ${e.originmask}`,e.aimip&&`目的IP: ${e.aimip}`,e.aimaddr&&`目的地址: ${e.aimaddr}`,e.aimport&&`目的端口: ${e.aimport}`,e.aimasset&&`目的资产: ${e.aimasset}`,e.aimmac&&`目的MAC地址: ${e.aimmac}`,e.aimmask&&`目的掩码: ${e.aimmask}`,e.sourceip&&`发生源IP: ${e.sourceip}`,e.sourcecountry&&`源国家: ${e.sourcecountry}`,e.sourcecountrylong&&`源国家经度: ${e.sourcecountrylong}`,e.sourcecountrylati&&`源国家纬度: ${e.sourcecountrylati}`,e.sourceregin&&`源区域: ${e.sourceregin}`,e.sourcereginlong&&`源区域经度: ${e.sourcereginlong}`,e.sourcereginlati&&`源区域维度: ${e.sourcereginlati}`,e.aimcountry&&`目的国家: ${e.aimcountry}`,e.aimcountrylong&&`目的国家经度: ${e.aimcountrylong}`,e.aimcountrylati&&`目的国家纬度: ${e.aimcountrylati}`,e.aimregin&&`目的区域: ${e.aimregin}`,e.aimreginlong&&`目的区域经度: ${e.aimreginlong}`,e.aimreginlati&&`目的区域维度: ${e.aimreginlati}`,e.protocol&&`协议: ${e.protocol}`]).filter(Boolean).join(`
`),u.current&&u.current++),console.log(e)};De(b,()=>{b.value&&(d.value=[],te(),P())});const k=L([{title:"字段值",key:"name",width:160,align:"center",ellipsis:{tooltip:!0}},{title:"对应规则",key:"multipegroup",align:"center",width:160,render(e,a){return $(Ie,{size:"small",clearable:!0,valueField:"id",filterable:!0,options:t.itype==0||t.itype==1?j.value:F.value,value:e.multipegroup,"onUpdate:value":r=>{e.multipegroup=r,e.value=null;const v=O.list.map(p=>p.multipegroup);t.itype==0||t.itype==1?j.value.forEach(p=>{v.includes(p.id)?p.disabled=!0:p.disabled=!1}):F.value.forEach(p=>{v.includes(p.id)?p.disabled=!0:p.disabled=!1}),console.log(e.multipegroup)}})}},{key:"operate",title:B("common.operate"),align:"center",width:80,fixed:"right",render(e,a){return $(q,{size:"small",type:"error",ghost:!0,onClick:()=>Ze(e,a)},{default:()=>B("common.delete")})}}]);function He(e,a){return e.filter(r=>!a.includes(r))}function Ze(e,a){console.log(e,a),F.value.forEach(n=>{n.id==e.multipegroup&&(n.disabled=!1)}),j.value.forEach(n=>{n.id==e.multipegroup&&(n.disabled=!1)});let r=[e.startIndex-1,e.endIndex];O.list.splice(a,1);for(let n=e.startIndex;n<e.endIndex;n++)r.push(n);const v=Math.max(...r),p=Math.min(...r);T.value.has(v+1)&&(r=r.filter(n=>n!==v)),T.value.has(p-1)&&(r=r.filter(n=>n!==p)),T.value=new Set(He(Array.from(T.value),r)),d.value=[],O.list.forEach(n=>{for(let _=n.startIndex;_<n.endIndex;_++)d.value.push(_)})}const O=ye({list:[]});function Je(e,a){const r=[...a].sort((p,n)=>n.startIndex-p.startIndex);let v=e;for(const{startIndex:p,endIndex:n,replacement:_}of r){if(p<0||n>=e.length||p>n)throw new Error("Invalid index range");const Z=v.slice(0,p),m=v.slice(n+1);v=Z+_+m}return v}De(()=>t.orilog,()=>{O.list=[],d.value=[],T.value=new Set([]),F.value.forEach(e=>{e.disabled=!1}),j.value.forEach(e=>{e.disabled=!1})});function Qe(e){return e.replace(/(\(\?<[^>]+>[^)]+\))|[-\/\\^$*+?.()|[\]{}]/g,(a,r)=>r||`\\${a}`)}async function Xe(){var e,a,r,v;if(u.current==1)await S(),u.current++,vt(()=>{var p;(p=g.rowData)!=null&&p.id&&(d.value=[],O.list.forEach(n=>{for(let _=n.startIndex;_<n.endIndex;_++)d.value.push(_)}))});else{let p=!0;if(O.list.length>0){for(let n=0;n<O.list.length;n++)if(!O.list[n].multipegroup){p=!1;break}if(p){t.cvalue="",t.multi="";let n={},_=[];t.itype==0||t.itype==1?j.value.forEach(m=>{n[m.id]=m.value}):F.value.forEach(m=>{n[m.id]=m.value}),O.list.forEach((m,z)=>{t.cvalue+=m.name+"，",t.multi+=m.multipegroup+",",_.push({startIndex:m.startIndex,endIndex:m.endIndex-1,replacement:n[m.multipegroup]})}),console.log("finallyTransArr",_),t.cvalue=t.cvalue.substring(0,t.cvalue.length-1),t.multi=t.multi.substring(0,t.multi.length-1);const Z=Je(t.orilog,_);t.expre=Qe(Z).replace(R,t.itype==0||t.itype==1?ta:aa),console.log(t.expre),u.current&&u.current++}else return(e=window.$message)==null||e.destroyAll(),(a=window.$message)==null||a.warning("请补充完整内容。"),!1}else return(r=window.$message)==null||r.destroyAll(),(v=window.$message)==null||v.warning("请添加日志划词。"),!1}}return(e,a)=>{const r=Qt,v=Zt,p=Ve,n=ht,_=Vt,Z=yt,m=Ge,z=Fe,de=Be,ue=_t,E=xt;return M(),le(E,{show:b.value,"onUpdate:show":a[9]||(a[9]=x=>b.value=x),"display-directive":"show",width:1e3,"content-style":{height:"100%"}},{default:c(()=>[i(ue,{title:C.value,"native-scrollbar":!0,closable:"","body-content-style":{height:"100%"}},{footer:c(()=>[i(de,{size:16},{default:c(()=>[i(s(q),{onClick:X},{default:c(()=>[H(ee(s(B)("common.cancel")),1)]),_:1}),u.current===2||u.current===3?(M(),le(s(q),{key:0,onClick:a[8]||(a[8]=x=>u.current--)},{default:c(()=>[H("上一步")]),_:1})):Y("",!0),u.current===1||u.current===2?(M(),le(s(q),{key:1,type:"primary",onClick:Xe},{default:c(()=>[H(ee(u.current===1?"下一步":"生成解析"),1)]),_:1})):Y("",!0),u.current===3?(M(),le(s(q),{key:2,type:"primary",onClick:re},{default:c(()=>[H(ee("验证解析"))]),_:1})):Y("",!0),u.current===4?(M(),le(s(q),{key:3,type:"primary",onClick:U},{default:c(()=>[H(ee(s(B)("common.confirm")),1)]),_:1})):Y("",!0)]),_:1})]),default:c(()=>[i(de,{class:"h-100%",style:{gap:"0 !important"},"item-class":"NSpaceItem"},{default:c(()=>[i(v,{vertical:"",current:u.current,class:"h-400px"},{default:c(()=>[i(r,{title:"基本信息"}),i(r,{title:"日志划词"}),i(r,{title:"生成解析"})]),_:1},8,["current"]),_e("div",Yt,[i(z,{ref_key:"formRef",ref:I,model:t,rules:h,onKeyup:Me(U,["enter"]),style:{height:"100%",display:"flex","flex-direction":"column"}},{default:c(()=>[u.current===1?(M(),ne(me,{key:0},[i(n,{label:"使用状态",path:"ieanble"},{default:c(()=>[i(p,{value:t.ieanble,"onUpdate:value":a[0]||(a[0]=x=>t.ieanble=x),"checked-value":0,"unchecked-value":1},null,8,["value"])]),_:1}),i(n,{label:"接入方式",path:"itype"},{default:c(()=>[i(s(Ie),{value:t.itype,"onUpdate:value":a[1]||(a[1]=x=>t.itype=x),placeholder:"请选择接入方式",filterable:"",clearable:"",options:s($e)(s(Ke))},null,8,["value","options"])]),_:1}),i(n,{label:"日志源设备",path:"logtypeid"},{default:c(()=>[i(_,{value:t.logtypeid,"onUpdate:value":[a[2]||(a[2]=x=>t.logtypeid=x),Q],placeholder:"请选择日志源设备",options:N.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"","show-path":!1},null,8,["value","options"])]),_:1}),i(n,{label:"事件类型",path:"etypeid"},{default:c(()=>[i(_,{value:t.etypeid,"onUpdate:value":[a[3]||(a[3]=x=>t.etypeid=x),oe],clearable:"",placeholder:"请选择事件类型",options:K.value,"show-path":!1,"check-strategy":"child","value-field":"id","label-field":"pname"},null,8,["value","options"])]),_:1}),i(n,{label:"排序",path:"isort"},{default:c(()=>[i(Z,{value:t.isort,"onUpdate:value":a[4]||(a[4]=x=>t.isort=x),placeholder:"请输入排序",style:{width:"100%"}},null,8,["value"])]),_:1}),i(n,{label:"日志原文",path:"orilog"},{default:c(()=>[i(s(xe),{type:"textarea",value:t.orilog,"onUpdate:value":a[5]||(a[5]=x=>t.orilog=x),placeholder:"请输入日志原文",clearable:"",autosize:{minRows:5,maxRows:20},style:{width:"100%",height:"100%"}},null,8,["value"])]),_:1})],64)):Y("",!0),u.current===2?(M(),ne(me,{key:1},[i(n,{label:"日志原文",path:"orilog"},{default:c(()=>[_e("div",ea,[_e("div",{class:"w-100%",ref_key:"editableDiv",ref:o,style:{"user-select":"text"},onMouseup:A},[(M(!0),ne(me,null,gt(t.orilog,(x,Se)=>(M(),ne("span",{key:Se,style:Re({color:d.value.includes(Se)?"#f00":"#000"})},ee(x),5))),128))],544)])]),_:1}),i(n,{label:"划词信息",style:{flex:"1"}},{default:c(()=>[i(m,{columns:k.value,data:O.list,style:Re([{width:"100%"},{height:"100%"}]),"scroll-x":702,"flex-height":""},null,8,["columns","data"])]),_:1})],64)):Y("",!0),u.current===3||u.current===4?(M(),ne(me,{key:2},[i(n,{label:"表达式",path:"expre"},{default:c(()=>[i(s(xe),{type:"textarea",value:t.expre,"onUpdate:value":a[6]||(a[6]=x=>t.expre=x),placeholder:"请输入表达式",style:{width:"100%"},readonly:"",autosize:{minRows:5,maxRows:7}},null,8,["value"])]),_:1}),i(n,{label:"解析结果",path:"result"},{default:c(()=>[i(s(xe),{type:"textarea",value:t.result,"onUpdate:value":a[7]||(a[7]=x=>t.result=x),placeholder:"解析结果",style:{width:"100%",height:"100%"},readonly:"",autosize:{minRows:6,maxRows:20}},null,8,["value"])]),_:1})],64)):Y("",!0)]),_:1},8,["model"])])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),la=$t(ia,[["__scopeId","data-v-3e3abf35"]]),na={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Ee(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!kt(l)}const za=ce({name:"eventalarm_customparsing",__name:"index",setup(l){const w=It();L(),L();const g={dbtime:"日志时间",priority:"优先级",hname:"主机名",aname:"应用名",procid:"进程ID",msgid:"消息ID",adata:"结构数据",lcon:"日志内容",eige:"特征值ID",userv:"用户ID",target:"目标对象",etime:"日志时间",oaction:"动作",eresult:"事件结果",edesc:"事件描述",originip:"源IP",originaddr:"源地址",originport:"源端口",originasset:"源资产",originmac:"源MAC",originmask:"源掩码",aimip:"目的IP",aimaddr:"目的地址",aimport:"目的端口",aimasset:"目的资产",aimmac:"目的MAC地址",aimmask:"目的掩码",sourceip:"发生源IP",sourcecountry:"源国家",sourcecountrylong:"源国家经度",sourcecountrylati:"源国家纬度",sourceregin:"源区域",sourcereginlong:"源区域经度",sourcereginlati:"源区域维度",aimcountry:"目的国家",aimcountrylong:"目的国家经度",aimcountrylati:"目的国家纬度",aimregin:"目的区域",aimreginlong:"目的区域经度",aimreginlati:"目的区域维度",protocol:"协议"},y=(o,d)=>o.replace(/\?<(\w+)>/g,(A,U)=>`?<${d[U]||U}>`),{columns:u,columnChecks:b,data:I,getData:S,loading:P,mobilePagination:G,searchParams:C,resetSearchParams:t}=zt({apiFn:Ot,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,itype:0,ieanble:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"itype",title:"接入方式",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:o=>{const d=Tt;return i("span",null,[H(" "),d[o.itype]])}},{key:"itext",title:"匹配规则",align:"center",render:o=>i("span",null,[H(" "),y(St(Ct(o.itext)),g)])},{key:"isort",title:"排序",align:"center",width:120,render:o=>((o.isort===void 0||o.isort===null)&&(o.isort=0),i("span",null,[o.isort]))},{key:"ieanble",title:"是否启用",align:"center",width:160,render:o=>i(Ve,{value:o.ieanble,"onUpdate:value":[d=>o.ieanble=d,()=>T(o)],checkedValue:0,uncheckedValue:1},null)},{key:"operate",title:B("common.operate"),align:"center",width:160,fixed:"right",render:o=>{let d;return i("div",{class:"flex-center gap-8px"},[Ne(i(q,{type:"info",ghost:!0,size:"small",onClick:()=>se(o.id)},Ee(d=B("common.edit"))?d:{default:()=>[d]}),[[Te("no-auth"),"custorm.parsing.update"]]),i(Gt,{onPositiveClick:()=>oe(o.id)},{default:()=>B("common.confirmDelete"),trigger:()=>{let A;return Ne(i(q,{type:"error",ghost:!0,size:"small"},Ee(A=B("common.delete"))?A:{default:()=>[A]}),[[Te("no-auth"),"custorm.parsing.delete"]])}})])}}]}),{drawerVisible:f,operateType:h,editingData:R,handleAdd:j,handleEdit:F,checkedRowKeys:N,onBatchDeleted:J,onDeleted:Q,closeDrawer:K}=Dt(I,S);async function W(){console.log(N.value),te(N.value,o=>{J()})}function se(o){F(o)}function oe(o){console.log(o),te([o],d=>{Q()})}async function te(o,d){const{data:A,error:U}=await Mt(o);if(!U)d&&d(A);else return!1}async function X(){}async function T(o){var A,U;const d={id:o.id,ieanble:o.ieanble};try{const{data:re,error:k}=await We([d]);if(!k)(A=window.$message)==null||A.success(o.ieanble===0?"启用成功":"停用成功"),S();else throw new Error("更新失败")}catch{o.ieanble=o.ieanble===1?0:1,(U=window.$message)==null||U.error("操作失败，请重试")}}return(o,d)=>{const A=Ye,U=Ge,re=Le;return M(),ne("div",na,[i(Xt,{model:s(C),"onUpdate:model":d[0]||(d[0]=k=>ge(C)?C.value=k:null),onReset:s(t),onSearch:s(S)},null,8,["model","onReset","onSearch"]),i(re,{title:"自定义解析",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":c(()=>[i(A,{columns:s(b),"onUpdate:columns":d[1]||(d[1]=k=>ge(b)?b.value=k:null),"disabled-delete":s(N).length===0,loading:s(P),onAdd:s(j),onDelete:W,onRefresh:s(S),"is-view-export-button":!0,onExportHandler:X,"is-view-add-button":s(Ae)("custorm.parsing.insert"),"is-view-delete-button":s(Ae)("custorm.parsing.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:c(()=>[i(U,{"checked-row-keys":s(N),"onUpdate:checkedRowKeys":d[2]||(d[2]=k=>ge(N)?N.value=k:null),columns:s(u),data:s(I),size:"small","flex-height":!s(w).isMobile,"scroll-x":962,loading:s(P),remote:"","row-key":k=>k.id,pagination:s(G),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),i(la,{visible:s(f),"onUpdate:visible":d[3]||(d[3]=k=>ge(f)?f.value=k:null),"operate-type":s(h),onSetItype:d[4]||(d[4]=k=>{s(C).itype=k,s(S)()}),"row-data":s(R),onSubmitted:s(S)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{za as default};
