import{_ as Oe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CQRJ3Aex.js";import{d as W,dx as Me,j as A,aK as ae,F as re,bl as ue,dy as ce,dz as pe,bi as Z,cd as Ue,ai as ne,cx as ze,r as we,q as oe,s as xe,v as Re,x as Ae,b as $e,y as Ie,b1 as me,b0 as fe,K as Y,o as S,c as V,w as a,g as e,h as g,t as k,i as n,$,L,e as le,ag as _e,U as I,N as Pe,au as je,G as Ee,aT as ve,A as Te,C as ye,X as Le,D as Ce,S as Be,B as G,E as Ne,b3 as Ke,M as Fe,a9 as se,Z as qe,ac as Q,f as he}from"./index-CIkMAdTj.js";import{c as Ve,d as Ge,f as We,e as He,g as Je,h as ge,i as Xe}from"./reportForm-Bw8vshFn.js";import{u as Ze,a as Qe}from"./table-DYjxKyYT.js";import{T as ie,a as De,S as Se}from"./task-YGHtLOYf.js";import{a as Ye,b as et,_ as tt}from"./DataTable-DUhJ-ag2.js";import{_ as at}from"./TimePicker-B-lebnwu.js";import{_ as nt}from"./round-search-DolOrREp.js";import{_ as ot}from"./round-refresh-Cw_OacQi.js";import{_ as lt}from"./FormItemGridItem-B-PuJtjX.js";import{_ as st}from"./Grid-BbZ5ihyN.js";import{h as be}from"./permission-9-vwFfOY.js";import{_ as it}from"./Popconfirm-uRFGs8ok.js";import{_ as rt,a as ut}from"./DescriptionsItem-C2PO5Yrx.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DyTGTkTN.js";import"./setting-outlined-BjNyCKNK.js";import"./round-delete-5y7n-Q4W.js";import"./refresh-CQAxWQOp.js";import"./Upload-D11BssPZ.js";import"./Progress-DCQkG3_f.js";import"./Forward-BV1I61Y9.js";import"./defineProperty-DzO1Gu_f.js";const dt=W({name:"ModalEnvironment",props:Object.assign(Object.assign({},Me),{internalKey:{type:String,required:!0},onInternalAfterLeave:{type:Function,required:!0}}),setup(f){const y=A(!0);function p(){const{onInternalAfterLeave:o,internalKey:m,onAfterLeave:t}=f;o&&o(m),t&&t()}function l(){const{onPositiveClick:o}=f;o?Promise.resolve(o()).then(m=>{m!==!1&&s()}):s()}function h(){const{onNegativeClick:o}=f;o?Promise.resolve(o()).then(m=>{m!==!1&&s()}):s()}function _(){const{onClose:o}=f;o?Promise.resolve(o()).then(m=>{m!==!1&&s()}):s()}function R(o){const{onMaskClick:m,maskClosable:t}=f;m&&(m(o),t&&s())}function T(){const{onEsc:o}=f;o&&o()}function s(){y.value=!1}function b(o){y.value=o}return{show:y,hide:s,handleUpdateShow:b,handleAfterLeave:p,handleCloseClick:_,handleNegativeClick:h,handlePositiveClick:l,handleMaskClick:R,handleEsc:T}},render(){const{handleUpdateShow:f,handleAfterLeave:y,handleMaskClick:p,handleEsc:l,show:h}=this;return ae(re,Object.assign({},this.$props,{show:h,onUpdateShow:f,onMaskClick:p,onEsc:l,onAfterLeave:y,internalAppear:!0,internalModal:!0}))}}),ke=ue("n-modal-provider"),ct=ue("n-modal-api"),pt=ue("n-modal-reactive-list"),mt={to:[String,Object]},ft=W({name:"ModalProvider",props:mt,setup(){const f=ce(64),y=pe(),p=A([]),l={};function h(s={}){const b=ze(),o=we(Object.assign(Object.assign({},s),{key:b,destroy:()=>{var m;(m=l[`n-modal-${b}`])===null||m===void 0||m.hide()}}));return p.value.push(o),o}function _(s){const{value:b}=p;b.splice(b.findIndex(o=>o.key===s),1)}function R(){Object.values(l).forEach(s=>{s==null||s.hide()})}const T={create:h,destroyAll:R};return Z(ct,T),Z(ke,{clickedRef:ce(64),clickedPositionRef:pe()}),Z(pt,p),Z(ke,{clickedRef:f,clickedPositionRef:y}),Object.assign(Object.assign({},T),{modalList:p,modalInstRefs:l,handleAfterLeave:_})},render(){var f,y;return ae(ne,null,[this.modalList.map(p=>{var l;return ae(dt,Ue(p,["destroy"],{to:(l=p.to)!==null&&l!==void 0?l:this.to,ref:h=>{h===null?delete this.modalInstRefs[`n-modal-${p.key}`]:this.modalInstRefs[`n-modal-${p.key}`]=h},internalKey:p.key,onInternalAfterLeave:this.handleAfterLeave}))}),(y=(f=this.$slots).default)===null||y===void 0?void 0:y.call(f)])}}),_t=W({name:"TaskModal",__name:"task_modal",props:oe({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:oe(["submitted"],["update:visible"]),setup(f,{expose:y,emit:p}){const l=f,h=p,_=xe(f,"visible"),{formRef:R,validate:T,restoreValidation:s}=Re(),{defaultRequiredRule:b,patternRules:o}=Ae(),m=$e(()=>({add:"新增任务",edit:"编辑任务"})[l.operateType]),t=we(P());function P(){return{id:void 0,rname:"",rtype:0,ttype:0,starttime:void 0,endtime:void 0,excute:1,stype:0,recipient:"",rdesc:"",tid:void 0}}const j={rname:b,starttime:b,cron:b,rtype:{type:"number",required:!0,trigger:["input","blur"],message:"请选择实例"},ttype:{type:"number",required:!0,trigger:["input","blur"],message:"请选择任务类型"},stype:{type:"number",required:!0,trigger:["input","blur"],message:"请选择发送类型"},recipient:{required:!0,validator:je,trigger:["input","change","blur","password-input"]}};function D(){Object.assign(t,P()),M.value=Ee(),l.operateType==="edit"&&l.rowData&&(l.rowData.starttime=l.rowData.starttime.substring(11,19),Object.assign(t,l.rowData))}function O(){_.value=!1}const M=A(""),H=async()=>{const d=Ke(t.ttype==0?{dayOfWeek:t.excute,time:t.starttime}:null,t.ttype==1?{dayOfMonth:t.excute,time:t.starttime}:null,t.ttype==2?{time:t.starttime}:null),{data:i,error:C}=await We({beanName:"ReportTask",remark:M.value,cronExpression:d,params:JSON.stringify({cron:t.cron})});C||await U()},U=async()=>{const{data:d,error:i}=await He({uuid:M.value});t.tid=d};async function z(){var d,i;if(await T(),l.operateType==="add"&&await H(),t.ttype!==1&&t.ttype!==2&&delete t.excute,l.operateType==="add"){const{data:C,error:w}=await Ve({...t,starttime:ve(1,new Date)});w||((d=window.$message)==null||d.success($("common.addSuccess")),O(),h("submitted"))}else{const{data:C,error:w}=await Ge({...t,starttime:ve(1,new Date)});w||((i=window.$message)==null||i.success($("common.updateSuccess")),O(),h("submitted"))}}return Ie(_,()=>{_.value&&(D(),s())}),y({monthOption:me,weekOption:fe}),(d,i)=>{const C=Te,w=ye,J=et,X=Ye,B=Le,v=at,c=ye,x=Ce,K=Be,N=G,ee=Ne,te=re,F=Y("no-space");return S(),V(te,{show:_.value,"onUpdate:show":i[8]||(i[8]=r=>_.value=r),title:m.value,preset:"card",class:"w-600px"},{footer:a(()=>[e(ee,{justify:"end",size:16},{default:a(()=>[e(N,{onClick:O},{default:a(()=>[g(k(n($)("common.cancel")),1)]),_:1}),e(N,{type:"primary",onClick:z},{default:a(()=>[g(k(n($)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(K,{class:"min-h-480px pr-20px"},{default:a(()=>[e(x,{ref_key:"formRef",ref:R,model:t,rules:j,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:a(()=>[e(w,{label:"任务名称",path:"rname"},{default:a(()=>[L(e(C,{value:t.rname,"onUpdate:value":i[0]||(i[0]=r=>t.rname=r),placeholder:"请输入任务名称",clearable:""},null,8,["value"]),[[F]])]),_:1}),e(w,{label:"实例选择",path:"rtype"},{default:a(()=>[e(X,{value:t.rtype,"onUpdate:value":i[1]||(i[1]=r=>t.rtype=r),name:"radiogroup"},{default:a(()=>[(S(!0),le(ne,null,_e(n(I)(n(ie)),(r,u)=>(S(),V(J,{key:u,value:r.value},{default:a(()=>[g(k(r.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(w,{label:"任务类型",path:"ttype"},{default:a(()=>[e(X,{value:t.ttype,"onUpdate:value":i[2]||(i[2]=r=>t.ttype=r),name:"radiogroup"},{default:a(()=>[(S(!0),le(ne,null,_e(n(I)(n(De)),(r,u)=>(S(),V(J,{key:u,value:r.value},{default:a(()=>[g(k(r.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t.ttype==1||t.ttype==2?(S(),V(w,{key:0,label:t.ttype==1?"每周":t.ttype==2?"每月":"",path:"excute"},{default:a(()=>[e(B,{filterable:"",value:t.excute,"onUpdate:value":i[3]||(i[3]=r=>t.excute=r),placeholder:"请选择",options:t.ttype==2?n(me)():n(fe)(),style:{width:"100%"}},null,8,["value","options"])]),_:1},8,["label"])):Pe("",!0),e(c,{label:"开始时间",path:"starttime"},{default:a(()=>[e(v,{"formatted-value":t.starttime,"onUpdate:formattedValue":i[4]||(i[4]=r=>t.starttime=r),placeholder:"选择开始时间"},null,8,["formatted-value"])]),_:1}),e(w,{label:"收件人",path:"recipient"},{default:a(()=>[L(e(C,{value:t.recipient,"onUpdate:value":i[5]||(i[5]=r=>t.recipient=r),placeholder:"请输入收件人",clearable:""},null,8,["value"]),[[F]])]),_:1}),e(w,{label:"发送类型",path:"stype"},{default:a(()=>[e(B,{filterable:"",value:t.stype,"onUpdate:value":i[6]||(i[6]=r=>t.stype=r),placeholder:"请选择发送类型",options:n(I)(n(Se)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(w,{label:"任务描述",path:"rdesc"},{default:a(()=>[L(e(C,{type:"textarea",value:t.rdesc,"onUpdate:value":i[7]||(i[7]=r=>t.rdesc=r),placeholder:"请输入任务描述",clearable:""},null,8,["value"]),[[F]])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),vt=W({name:"TaskSearch",__name:"task_search",props:{model:{required:!0},modelModifiers:{}},emits:oe(["reset","search"],["update:model"]),setup(f,{emit:y}){const p=y,{formRef:l,restoreValidation:h}=Re(),_=xe(f,"model");function R(){_.value.fuzzy=void 0,p("search")}async function T(){await h(),p("reset")}async function s(){p("search")}return(b,o)=>{const m=Te,t=lt,P=ot,j=G,D=nt,O=Ne,M=st,H=Ce,U=se,z=Y("no-space");return S(),V(U,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(H,{ref_key:"formRef",ref:l,model:_.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Fe(s,["enter"])},{default:a(()=>[e(M,{responsive:"screen","item-responsive":""},{default:a(()=>[e(t,{span:"24 s:12 m:6",label:"任务名称",path:"fuzzy",class:"pr-24px"},{default:a(()=>[L(e(m,{value:_.value.fuzzy,"onUpdate:value":o[0]||(o[0]=d=>_.value.fuzzy=d),placeholder:"请输入任务名称关键字",clearable:"",onClear:R},null,8,["value"]),[[z]])]),_:1}),e(t,{span:"24 m:6",class:"pr-24px"},{default:a(()=>[e(O,{class:"w-full"},{default:a(()=>[e(j,{onClick:T},{icon:a(()=>[e(P,{class:"text-icon"})]),default:a(()=>[g(" "+k(n($)("common.reset")),1)]),_:1}),e(j,{type:"primary",ghost:"",onClick:s},{icon:a(()=>[e(D,{class:"text-icon"})]),default:a(()=>[g(" "+k(n($)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),yt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ht=he("div",{style:{display:"flex","align-items":"center"}},[he("div",null,"报表任务")],-1),Bt=W({name:"reportmanagement_reporttask",__name:"index",setup(f){const y=qe(),{columns:p,columnChecks:l,data:h,getData:_,loading:R,mobilePagination:T,searchParams:s,resetSearchParams:b}=Ze({apiFn:Je,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"rname",title:"任务名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:v=>{var c;return e("div",null,[(c=I(ie).find(x=>x.value===v.rtype))==null?void 0:c.label])}},{key:"starttime",title:"执行时间",align:"center",width:160},{key:"operate",title:$("common.operate"),align:"center",width:160,render:v=>e("div",{class:"flex-center gap-8px"},[e(ft,null,{default:()=>[e(G,{type:"info",ghost:!0,size:"small",onClick:()=>i(v.id)},{default:()=>[g("详情")]})]}),L(e(G,{type:"warning",ghost:!0,size:"small",onClick:()=>w(v.id)},{default:()=>[g("修改")]}),[[Y("no-auth"),"sys.report.task.update"]]),e(it,{onPositiveClick:()=>J(v.id)},{default:()=>"确定要删除改数据吗？",trigger:()=>L(e(G,{type:"error",ghost:!0,size:"small"},{default:()=>[g("删除")]}),[[Y("no-auth"),"sys.report.task.delete"]])})])}]}),{drawerVisible:o,operateType:m,editingData:t,handleAdd:P,handleEdit:j,checkedRowKeys:D,onBatchDeleted:O,onDeleted:M,closeDrawer:H}=Qe(h,_),U=A(),z=A(!1),d=A({id:void 0,rname:"",rtype:0,ttype:0,starttime:void 0,endtime:void 0,excute:0,stype:0,recipient:"",rdesc:"",tid:void 0}),i=async v=>{z.value=!0;const{data:c,error:x}=await ge(v);x||(d.value=c)},C=A();async function w(v){const{data:c,error:x}=await ge(v);x||(C.value=c),j(v)}function J(v){B(v,c=>{M()})}async function X(){B(D.value.join(","),v=>{O()})}async function B(v,c){const{data:x,error:K}=await Xe(v);K||c&&c(x)}return(v,c)=>{const x=Oe,K=tt,N=rt,ee=ut,te=se,F=re,r=se;return S(),le("div",yt,[e(vt,{model:n(s),"onUpdate:model":c[0]||(c[0]=u=>Q(s)?s.value=u:null),onReset:n(b),onSearch:n(_)},null,8,["model","onReset","onSearch"]),e(r,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[ht]),"header-extra":a(()=>[e(x,{columns:n(l),"onUpdate:columns":c[1]||(c[1]=u=>Q(l)?l.value=u:null),"disabled-delete":n(D).length===0,loading:n(R),onAdd:n(P),onRefresh:n(_),"is-view-add-button":n(be)("sys.report.task.insert"),isViewDeleteButton:n(be)("sys.report.task.delete"),onDelete:X},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","isViewDeleteButton"])]),default:a(()=>[e(K,{"checked-row-keys":n(D),"onUpdate:checkedRowKeys":c[2]||(c[2]=u=>Q(D)?D.value=u:null),columns:n(p),data:n(h),size:"small","flex-height":!n(y).isMobile,"scroll-x":962,loading:n(R),remote:"","row-key":u=>u.id,pagination:n(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(_t,{ref_key:"TaskModalRef",ref:U,visible:n(o),"onUpdate:visible":c[3]||(c[3]=u=>Q(o)?o.value=u:null),"operate-type":n(m),"row-data":C.value,onSubmitted:n(_)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(F,{show:z.value,"onUpdate:show":c[4]||(c[4]=u=>z.value=u),preset:"card",class:"w-500px",title:"报表任务详情"},{default:a(()=>[e(te,null,{default:a(()=>[e(ee,{"label-placement":"left",column:1,"label-style":{width:"100px",display:"inline-block",textAlign:"right",marginRight:"10px"}},{default:a(()=>[e(N,{label:"任务名称"},{default:a(()=>[g(k(d.value.rname),1)]),_:1}),e(N,{label:"实例"},{default:a(()=>{var u;return[g(k((u=n(I)(n(ie)).find(E=>E.value===d.value.rtype))==null?void 0:u.label),1)]}),_:1}),e(N,{label:"开始时间"},{default:a(()=>[g(k(d.value.starttime),1)]),_:1}),e(N,{label:"任务类型"},{default:a(()=>{var u,E,de;return[g(k((u=n(I)(n(De)).find(q=>q.value===d.value.ttype))==null?void 0:u.label)+" "+k(d.value.ttype==1?(E=U.value.weekOption().find(q=>q.value==d.value.excute))==null?void 0:E.label:d.value.ttype==2?(de=U.value.monthOption().find(q=>q.value==d.value.excute))==null?void 0:de.label:""),1)]}),_:1}),e(N,{label:"发送类型"},{default:a(()=>{var u;return[g(k((u=n(I)(n(Se)).find(E=>E.value===d.value.stype))==null?void 0:u.label),1)]}),_:1}),e(N,{label:"收件人"},{default:a(()=>[g(k(d.value.recipient),1)]),_:1}),e(N,{label:"描述"},{default:a(()=>[g(k(d.value.rdesc),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})])}}});export{Bt as default};
