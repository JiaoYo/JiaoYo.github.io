import{_ as me}from"./round-add-CcJ-eWvp.js";import{az as q,d as X,aE as J,m as Y,r as ae,n as le,a as fe,aG as Z,bY as se,aC as H,H as V,c as L,o as v,w as n,f as t,a0 as _e,C as ee,v as ie,h as e,x as G,aI as ve,b as T,e as g,t as y,B as S,g as b,s as M,aJ as ge,z as te,$ as O,a1 as ye,aQ as be,O as we,q as K,bg as he,y as F,aU as A,aX as xe,X as ke,A as re,cJ as Ce,U as Se,V as De,bi as je,M as ze,Z as de,aD as Ne,b4 as Ue,aO as $e,aS as Te,i as Le,aT as Q,cO as Pe,aH as Re,aY as Ie}from"./index-CbkGmsUT.js";import{u as Me,a as We}from"./table-CST65CZ1.js";import{_ as Be,a as Oe}from"./text-B1ImycHA.js";import{N as ce}from"./Popconfirm-CfoHIMzd.js";import{_ as Fe}from"./round-search-opoHbQsz.js";import{u as qe}from"./usePageData-CtVI6YRj.js";import{_ as Ee}from"./Grid-CyaoSB-i.js";import{_ as Ge}from"./FormItemGridItem-D8sOQ-r2.js";function Ve(d){return q({url:"/projectWeek/getPage.do",method:"get",params:d})}function Ae(d){return q({url:"/projectWeek/insert.do",method:"post",data:d})}function Ke(d){return q({url:"/projectWeek/update.do",method:"put",data:d})}function He(d){return q({url:"/projectWeek/delete.do",method:"delete",params:{arrIds:d}})}function Je(d){return q({url:"/projectWeekComment/getPage.do",method:"get",params:d})}function Xe(d){return q({url:"/projectWeekComment/insert.do",method:"post",data:d})}function Ye(d){return q({url:"/projectWeekComment/delete.do",method:"delete",params:{arrIds:d}})}const Qe={key:0,class:""},Ze={key:1,class:"flex items-center w-300px"},et=X({name:"OperateDrawer",__name:"operate-drawer",props:J({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(d,{emit:W}){Y();const l=W,D=d,a=ae(k());function k(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",file1:"",file2:""}}const R={content1:{required:!0,message:"请输入",trigger:"blur"}};async function j(){Object.assign(a,k()),D.operateType==="edit"&&D.rowData&&Object.assign(a,D.rowData)}const{formRef:w,validate:B,restoreValidation:U}=le(),h=fe(()=>({add:"新增项目周报",edit:"修改项目周报"})[D.operateType]),f=Z(d,"visible"),N=()=>{f.value=!1},P=se.debounce(async()=>{var m,s;if(await B(),D.operateType==="edit"){const{data:r,error:x}=await Ke([{...a}]);x||((m=window.$message)==null||m.success("修改成功"),l("submitted"),N())}else{const{data:r,error:x}=await Ae([{pid:a.pid,content1:a.content1,content2:a.content2,content3:a.content3,content4:a.content4,content5:a.content5,file1:a.file1,file2:a.file2}]);x||((s=window.$message)==null||s.success("添加成功"),l("submitted"),N())}},1e3,{leading:!0,trailing:!1});H(f,()=>{f.value&&(j(),setTimeout(()=>{const m=document.querySelector(".n-scrollbar-content");m==null||m.scrollTo(0,0)},300),U())});const p=V([]),o=V(0);async function _({file:m},s){const r=await be(m.file,m.name,"",x=>{s=="file2"&&(o.value=x)});r&&(s=="file1"?a.value.file1=r:a.value.file2=r,o.value=0)}async function C(m,s){var r,x,I;return s=="file1"&&!["image/jpeg","image/png","image/jpg","image/x-icon"].includes(m.file.file.type)?((r=window.$message)==null||r.destroyAll(),(x=window.$message)==null||x.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1):m.file.file.size>100*1024*1024?((I=window.$message)==null||I.error("文件大小不能超过100M"),!1):!0}return(m,s)=>{const r=ie,x=ve,I=ge,E=ee,c=_e,i=te,z=ye;return v(),L(z,{show:f.value,"onUpdate:show":s[9]||(s[9]=u=>f.value=u),title:h.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:n(()=>[t(i,{justify:"end"},{default:n(()=>[t(e(S),{size:"small",class:"mt-16px",onClick:N},{default:n(()=>[b(y(e(O)("common.cancel")),1)]),_:1}),t(e(S),{type:"primary",size:"small",class:"mt-16px",onClick:e(P)},{default:n(()=>[b(y(e(O)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:n(()=>[t(c,{style:{height:"70vh","padding-right":"10px"}},{default:n(()=>[t(E,{ref_key:"formRef",ref:w,model:a,rules:R},{default:n(()=>[t(r,{label:"本周完成",path:"content1"},{default:n(()=>[t(e(G),{clearable:"",type:"textarea",rows:3,value:a.content1,"onUpdate:value":s[0]||(s[0]=u=>a.content1=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{default:n(()=>[t(e(G),{clearable:"",type:"textarea",rows:2,value:a.content2,"onUpdate:value":s[1]||(s[1]=u=>a.content2=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"未完成项目",path:"content3"},{default:n(()=>[t(e(G),{clearable:"",type:"textarea",rows:2,value:a.content3,"onUpdate:value":s[2]||(s[2]=u=>a.content3=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"下周计划",path:"content4"},{default:n(()=>[t(e(G),{clearable:"",type:"textarea",rows:2,value:a.content4,"onUpdate:value":s[3]||(s[3]=u=>a.content4=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"需协调与帮助",path:"content5"},{default:n(()=>[t(e(G),{clearable:"",type:"textarea",rows:2,value:a.content5,"onUpdate:value":s[4]||(s[4]=u=>a.content5=u),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"图片:",path:"file1"},{default:n(()=>[t(x,{ref:"uploadRef",action:"#","list-type":"image-card","default-upload":!1,max:1,"file-list":p.value,"onUpdate:fileList":s[5]||(s[5]=u=>p.value=u),"custom-request":u=>_(u,"file1"),onBeforeUpload:s[6]||(s[6]=u=>C(u,"file1"))},null,8,["file-list","custom-request"])]),_:1}),t(r,{label:"附件:",path:"file2"},{default:n(()=>[a.file2?(v(),T("div",Qe,[g("span",null,y(a.file2.split("?")[1]),1),t(e(S),{text:"",type:"error",onClick:s[7]||(s[7]=u=>a.file2="")},{default:n(()=>s[10]||(s[10]=[b("删除")])),_:1,__:[10]})])):(v(),T("div",Ze,[t(x,{ref:"uploadRef",action:"#","show-file-list":!1,"custom-request":u=>_(u,"file2"),onBeforeUpload:s[8]||(s[8]=u=>C(u,"file2"))},{default:n(()=>[t(e(S),{loading:o.value>0&&!a.file2},{default:n(()=>[b(y(o.value>0&&!a.file2?"上传中":"上传文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"]),o.value&&!a.file2?(v(),L(I,{key:0,type:"line",percentage:o.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):M("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),tt={key:1,class:"mt-3 mb-3 text-gray-700 preview-text"},nt={key:0,class:"mt-3 mb-3 text-gray-700 preview-text"},ot={class:"mt-4 border-t pt-3"},at={class:"flex items-start gap-2 mb-3"},lt={class:"ml-2 flex-1"},st={class:"flex items-center"},it={class:"font-medium font-size-16px font-bold"},rt={class:"text-gray-600 mt-1"},dt=X({name:"drawerLog",__name:"drawerLog",props:J({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(d){const W=Y();we();let l=ae({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""});const D=d,a={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},k=V({});async function R(){l={id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""},j.value=[],Object.assign(l,D.rowData),h()}const j=V([]),w=Z(d,"visible");H(w,()=>{w.value?R():(j.value=[],l.id=void 0)}),H(()=>D.rowData,()=>{w.value&&R()});function B(p){p||U()}function U(){w.value=!1}const h=async()=>{const{data:p,error:o}=await Je({page:1,limit:100,pid:l.id});p&&(j.value=p.list)},f=se.debounce(async()=>{var C;const p=k.value[l.id];if(!(p!=null&&p.trim()))return(C=window.$message)==null?void 0:C.warning("请输入评论内容");const{data:o,error:_}=await Xe([{pid:l.id,content:p}]);o&&(k.value[l.id]="",l.num++,h())},1e3,{leading:!0,trailing:!1}),N=async p=>{const{data:o,error:_}=await Ye(p.id);o&&(h(),l.num--,console.log("删除成功"))};async function P(p){if(!p)return;const o=p.split("?")[0],_=p.split("?")[1];try{const m=await(await fetch(o,{mode:"cors"})).blob(),s=URL.createObjectURL(m),r=document.createElement("a");r.href=s,r.download=_,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}catch(C){console.error("下载失败:",C)}}return(p,o)=>{const _=ie,C=xe,m=ee,s=Be,r=Oe,x=he,I=je,E=K("i"),c=K("no-auth");return v(),L(I,{show:w.value,"onUpdate:show":[o[3]||(o[3]=i=>w.value=i),B],"display-directive":"show",width:600,onMaskClick:U,onEsc:U},{default:n(()=>[t(x,{title:e(l).username+"的项目周报","native-scrollbar":!1,closable:""},{default:n(()=>[t(m,{ref:"formRef",model:e(l),"show-feedback":!1},{default:n(()=>[t(_,{label:"本周完成",path:"content1"},{label:n(()=>o[4]||(o[4]=[g("div",{class:"font-size-16px font-bold"},"本周完成",-1)])),default:n(()=>[g("span",{class:A(["preview-text",{textstyle:e(l).content1}])},y(e(l).content1),3)]),_:1}),t(_,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{label:n(()=>o[5]||(o[5]=[g("div",{class:"font-size-16px font-bold"},"本周对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:n(()=>[g("span",{class:A(["preview-text",{textstyle:e(l).content2}])},y(e(l).content2),3)]),_:1}),t(_,{label:"未完成项目",path:"content3"},{label:n(()=>o[6]||(o[6]=[g("div",{class:"font-size-16px font-bold"},"未完成项目",-1)])),default:n(()=>[g("span",{class:A(["preview-text",{textstyle:e(l).content3}])},y(e(l).content3),3)]),_:1}),t(_,{label:"下周计划",path:"content4"},{label:n(()=>o[7]||(o[7]=[g("div",{class:"font-size-16px font-bold"},"下周计划",-1)])),default:n(()=>[g("span",{class:A(["preview-text",{textstyle:e(l).content4}])},y(e(l).content4),3)]),_:1}),t(_,{label:"需协调与帮助",path:"content5"},{label:n(()=>o[8]||(o[8]=[g("div",{class:"font-size-16px font-bold"},"需协调与帮助",-1)])),default:n(()=>[g("span",{class:A(["preview-text",{textstyle:e(l).content5}])},y(e(l).content5),3)]),_:1}),t(_,{label:"图片",path:"content5"},{label:n(()=>o[9]||(o[9]=[g("div",{class:"font-size-16px font-bold"},"图片",-1)])),default:n(()=>{var i;return[e(l).file1?(v(),L(C,{key:0,width:"80",height:"80",src:e(l).file1,class:"rounded-md object-cover"},null,8,["src"])):M("",!0),e(l).file1?(v(),T("div",tt,[b(y((i=e(l).file1)==null?void 0:i.split("?")[1])+" ",1),t(e(S),{text:"",type:"primary",size:"small",onClick:o[0]||(o[0]=z=>P(e(l).file1))},{default:n(()=>o[10]||(o[10]=[b("下载")])),_:1,__:[10]})])):M("",!0)]}),_:1}),t(_,{label:"附件",path:"content5"},{label:n(()=>o[11]||(o[11]=[g("div",{class:"font-size-16px font-bold"},"附件",-1)])),default:n(()=>{var i;return[e(l).file2?(v(),T("div",nt,[b(y((i=e(l).file2)==null?void 0:i.split("?")[1])+" ",1),t(e(S),{text:"",type:"primary",size:"small",onClick:o[1]||(o[1]=z=>P(e(l).file2))},{default:n(()=>o[12]||(o[12]=[b("下载")])),_:1,__:[12]})])):M("",!0)]}),_:1})]),_:1},8,["model"]),F((v(),T("div",null,[b(y(e(l).num)+"评论",1)])),[[E,e(l).num]]),t(ke,{name:"fade"},{default:n(()=>[g("div",ot,[F((v(),T("div",at,[g("div",null,[t(s,{size:"small",src:a.avatar},null,8,["src"])]),t(e(G),{type:"textarea",id:`comment-input-${e(l).id}`,value:k.value[e(l).id],"onUpdate:value":o[2]||(o[2]=i=>k.value[e(l).id]=i),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:re(Ce(e(f),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),t(e(S),{type:"primary",ghost:"",onClick:e(f)},{default:n(()=>o[13]||(o[13]=[b("发送")])),_:1,__:[13]},8,["onClick"])])),[[c,"project:Summary:Comment:insert"]]),(v(!0),T(Se,null,De(j.value,i=>(v(),T("div",{key:i.id,class:"flex mb-3"},[t(s,{size:"small",src:a.avatar},null,8,["src"]),g("div",lt,[g("div",st,[g("span",it,y(i.username),1),t(r,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:n(()=>[b(y(i.dbtime),1)]),_:2},1024),e(W).userInfo.id==i.creater?(v(),L(e(ce),{key:0,onPositiveClick:z=>N(i)},{trigger:n(()=>[F((v(),L(e(S),{quaternary:"",type:"error",size:"small"},{default:n(()=>o[14]||(o[14]=[b(" 删除 ")])),_:1,__:[14]})),[[c,"project:Summary:Comment:delete"]])]),default:n(()=>[o[15]||(o[15]=b(" 确定删除吗？ "))]),_:2,__:[15]},1032,["onPositiveClick"])):M("",!0)]),g("div",rt,y(i.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),ct=ze(dt,[["__scopeId","data-v-40f54485"]]),ut=X({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search","clear"],["update:model"]),setup(d,{emit:W}){const l=W,{formRef:D}=le(),a=Z(d,"model");Y();const{pageData:k,getData:R,nextPage:j}=qe(Ue),w=async h=>{const f=h.currentTarget,N=f.scrollTop;f.scrollTop+f.offsetHeight>=f.scrollHeight&&k.data.length<k.total&&(await j(),await $e(),setTimeout(()=>{f.scrollTop=N}))},B=async h=>{a.value.creater=h,l("search")};R({usertypes:"2,3"});async function U(){l("search")}return(h,f)=>{const N=Ne,P=Ge,p=Fe,o=S,_=te,C=Ee,m=ee,s=de;return v(),L(s,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(m,{ref_key:"formRef",ref:D,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:re(U,["enter"])},{default:n(()=>[t(C,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:n(()=>[t(P,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:n(()=>[t(N,{clearable:"",filterable:"",value:a.value.creater,"onUpdate:value":[f[0]||(f[0]=r=>a.value.creater=r),B],placeholder:"请选择","label-field":"username","value-field":"id",options:e(k).data,onScroll:w},null,8,["value","options"])]),_:1}),t(P,{span:"24  s:12 m:6",class:"pr-24px"},{default:n(()=>[t(_,{class:"w-full"},{default:n(()=>[t(o,{type:"primary",ghost:"",onClick:U},{icon:n(()=>[t(p,{class:"text-icon"})]),default:n(()=>[b(" "+y(e(O)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),pt={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},mt={key:0};function oe(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!Ie(d)}const kt=X({name:"projectmanagement_memberlog",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(d,{emit:W}){const l=Te(),D=Y(),a=d,k=W,{columns:R,data:j,getData:w,loading:B,mobilePagination:U,searchParams:h}=Me({showTotal:!0,immediate:!0,apiFn:Ve,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:c=>t("div",null,[c.username+"的项目周报"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:O("common.operate"),align:"center",width:140,fixed:"right",render:c=>{let i;return t("div",{class:"flex-center gap-8px"},[t(S,{type:"primary",ghost:!0,size:"small",onClick:()=>I(c)},{default:()=>[b("查看详情")]}),D.userInfo.id==c.creater&&F(t(S,{type:"primary",ghost:!0,size:"small",onClick:()=>s(c.id)},oe(i=O("common.edit"))?i:{default:()=>[i]}),[[K("no-auth"),"project:Summary:update"]]),D.userInfo.id==c.creater&&t(ce,{onPositiveClick:()=>m(c.id)},{default:()=>O("common.confirmDelete"),trigger:()=>{let z;return F(t(S,{type:"error",ghost:!0,size:"small"},oe(z=O("common.delete"))?z:{default:()=>[z]}),[[K("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:f,operateType:N,editingData:P,handleAdd:p,handleEdit:o,checkedRowKeys:_,onDeleted:C}=We(j,w);async function m(c){const{data:i,error:z}=await He(c);z||C()}function s(c){o(c)}const r=V(!1),x=V({}),I=c=>{r.value=!0,x.value=c},E=()=>{w()};return H(()=>a.pid,async c=>{c&&(h.pid=c,await w())}),H(()=>j.value,async c=>{c.length>0?k("thereIsData",1):k("thereIsData",0)}),Le(()=>{a.type!="externalLiaison"}),(c,i)=>{const z=te,u=me,ue=Re,pe=de,ne=K("no-auth");return v(),T("div",pt,[a.pid?M("",!0):(v(),L(ut,{key:0,model:e(h),"onUpdate:model":i[0]||(i[0]=$=>Q(h)?h.value=$:null),onReset:E,onSearch:e(w),onClear:i[1]||(i[1]=$=>j.value=[])},null,8,["model","onSearch"])),t(pe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Pe({header:n(()=>[t(z,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:n(()=>[a.pid?M("",!0):(v(),T("div",mt,"项目周报"))]),_:1}),a.pid?F((v(),L(e(S),{key:0,onClick:e(p),size:"small",ghost:"",type:"primary"},{icon:n(()=>[t(u,{class:"text-icon"})]),default:n(()=>[i[5]||(i[5]=b(" "+y("新增")))]),_:1,__:[5]},8,["onClick"])),[[ne,"project:Summary:insert"]]):M("",!0)]),default:n(()=>[t(ue,{"checked-row-keys":e(_),"onUpdate:checkedRowKeys":i[2]||(i[2]=$=>Q(_)?_.value=$:null),columns:e(R),data:e(j),size:"small","flex-height":!e(l).isMobile,loading:e(B),remote:"","row-key":$=>$.id,pagination:e(U),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(et,{visible:e(f),"onUpdate:visible":i[3]||(i[3]=$=>Q(f)?f.value=$:null),onSubmitted:e(w),"operate-type":e(N),pid:a.pid||e(h).pid,"row-data":e(P)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),t(ct,{visible:r.value,"onUpdate:visible":i[4]||(i[4]=$=>r.value=$),"row-data":x.value},null,8,["visible","row-data"])]),_:2},[a.pid?void 0:{name:"header-extra",fn:n(()=>[t(z,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[F((v(),L(e(S),{onClick:e(p),size:"small",ghost:"",type:"primary"},{icon:n(()=>[t(u,{class:"text-icon"})]),default:n(()=>[i[6]||(i[6]=b(" "+y("新增")))]),_:1,__:[6]},8,["onClick"])),[[ne,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{kt as default};
