import{d as j,k as N,b as Q,bP as ue,bQ as pe,ab as R,o as B,e as K,t as w,ag as fe,bR as me,c as J,w as t,g as o,f as O,ae as he,a4 as _e,i as ae,ap as ge,ao as be,a6 as se,af as Y,j as we,_ as X,q as ve,a0 as Z,bS as oe,bT as M,ai as ye,x as xe,aj as Se,r as De,y as Ce,H as ke,az as te,aA as Te,aB as $e,aC as Me,h as b,at as Ne,aw as H,ax as Pe,S as Ae,ak as Ie,P as Oe,R as We,T as Be}from"./index-Dv00cP5-.js";import{_ as ne,a as le}from"./Grid-CAhcp-3N.js";import{u as re,L as E}from"./echarts-B5SXAgHK.js";import{h as Le}from"./permission-CqvCBtyv.js";import{G as ze,h as Ee,a as Ge,b as Ve}from"./metar-CmLV303S.js";import{_ as He,a as Re}from"./DescriptionsItem-BfjZ_-Dr.js";const je="/assets/station-GwqcmkHc.jpeg",Fe=j({name:"CountTo",__name:"count-to",props:{startValue:{default:0},endValue:{default:2021},duration:{default:1500},autoplay:{type:Boolean,default:!0},decimals:{default:0},prefix:{default:""},suffix:{default:""},separator:{default:","},decimal:{default:"."},useEasing:{type:Boolean,default:!0},transition:{default:"linear"}},setup(C){const a=C,k=N(a.startValue),c=Q(()=>a.useEasing?ue[a.transition]:void 0),P=pe(k,{disabled:!1,duration:a.duration,transition:c.value}),f=Q(()=>h(P.value));function h(p){const{decimals:v,decimal:y,separator:S,suffix:n,prefix:e}=a;let l=p.toFixed(v);l=String(l);const s=l.split(".");let i=s[0];const T=s.length>1?y+s[1]:"",W=/(\d+)(\d{3})/;if(S)for(;W.test(i);)i=i.replace(W,`$1${S}$2`);return e+i+T+n}async function A(){await fe(),k.value=a.endValue}return R([()=>a.startValue,()=>a.endValue],()=>{a.autoplay&&A()},{immediate:!0}),(p,v)=>(B(),K("span",null,w(f.value),1))}}),Ue={class:"ml-20px"},qe={class:"text-14px"},Je=j({name:"CardData",__name:"card-data",props:{MeteorologicalData:{type:Object}},setup(C){const a=C,k=Q(()=>{var h,A,p,v,y,S;return[{key:"envT",title:"温度",value:((h=a.MeteorologicalData)==null?void 0:h.envT)||0,unit:"℃",color:{start:"#fdd819",end:"#e80505"},icon:"carbon:temperature-celsius"},{key:"envH",title:"湿度",value:((A=a.MeteorologicalData)==null?void 0:A.envH)||0,unit:"%",color:{start:"#97abff",end:"#123597"},icon:"lets-icons:humidity"},{key:"qy",title:"气压",value:((p=a.MeteorologicalData)==null?void 0:p.qy)||0,unit:"hPa",color:{start:"#70f570",end:"#49c628"},icon:"mdi:car-brake-low-pressure"},{key:"windS",title:"风速",value:((v=a.MeteorologicalData)==null?void 0:v.windS)||0,unit:"m/s",color:{start:"#ffe985",end:"#fa742b"},icon:"hugeicons:slow-winds"},{key:"windD",title:"风向",value:((y=a.MeteorologicalData)==null?void 0:y.windD)||0,unit:"°",color:{start:"#bbd2c5",end:"#536976"},icon:"mdi:windsock"},{key:"zfsdCount",title:"总辐射",value:((S=a.MeteorologicalData)==null?void 0:S.zfsd)||0,unit:"W/㎡",color:{start:"#ce9ffc",end:"#7367f0"},icon:"material-symbols:clear-day-rounded"}]}),[c,P]=me();function f(h){return`linear-gradient(to bottom right, ${h.start}, ${h.end})`}return(h,A)=>{const p=we,v=Fe,y=le,S=ne,n=se;return B(),J(n,{bordered:!1,size:"small",class:"card-wrapper h-100%","content-style":{padding:"20px 12px",display:"flex",flexDirection:"column",justifyContent:"center"}},{default:t(()=>[o(ae(c),null,{default:t(({$slots:e,gradientColor:l})=>[O("div",{class:"rd-8px pl-15px pb-4px pt-8px text-white",style:_e({backgroundImage:l})},[(B(),J(he(e.default)))],4)]),_:1}),o(S,{cols:"s:1 m:1 l:2",responsive:"screen","x-gap":10,"y-gap":12},{default:t(()=>[(B(!0),K(be,null,ge(k.value,(e,l)=>(B(),J(y,{key:e.key,class:Y("animated-fade-up-"+l)},{default:t(()=>[o(ae(P),{"gradient-color":f(e.color),class:"flex-1 flex items-center h-100%",style:{"max-height":"75px !important"}},{default:t(()=>[o(p,{icon:e.icon,class:"text-32px"},null,8,["icon"]),O("div",Ue,[O("h3",qe,w(e.title),1),o(v,{suffix:e.unit,decimals:1,"start-value":1,"end-value":e.value,class:"text-16px text-white dark:text-dark"},null,8,["suffix","end-value"])])]),_:2},1032,["gradient-color"])]),_:2},1032,["class"]))),128))]),_:1})]),_:1})}}}),Qe=X(Je,[["__scopeId","data-v-5da89340"]]),Ke=j({name:"LineChart",__name:"line-chart",props:{data:{required:!0},dataModifiers:{}},emits:["update:data"],setup(C){const a=["rgb(233, 4, 69)","rgb(0, 150, 136)","rgb(59, 66, 146)","rgb(255, 99, 71)"],k=["实际功率","预测功率","实际辐射","预测辐射"],c=ve(C,"data"),P=Z(),f=Date.now(),h=new Date(f).setHours(23,59,59,999),{domRef:A,updateOptions:p,updateOptionsAsync:v}=re(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function(e){var W;const s=(Array.isArray(e)?e:[e]).filter(m=>{var L;return((L=m==null?void 0:m.value)==null?void 0:L[1])!=null&&(m==null?void 0:m.seriesName)});if(s.length===0)return"";let T=`${((W=s[0])==null?void 0:W.axisValueLabel)||""}<br/>`;return s.forEach((m,L)=>{const $=["实际功率","预测功率"].includes(m.seriesName)?" MW":" W/m²";T+=`
          <span class="round" style="background-color: ${a[k.indexOf(m.seriesName)]||"#ccc"}"></span>
          ${m.seriesName}: ${oe(m.value[1],$)}<br/>
        `}),T},backgroundColor:"#6a7985",textStyle:{color:"#d3d6dd"}},legend:{data:["实际功率","预测功率","实际辐射","预测辐射"]},grid:{left:"2%",right:"5%",bottom:"0%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd} {HH}:{mm}"},max:h+60*1e3,data:[]},yAxis:[{name:"功率MW",type:"value",axisLabel:{formatter:"{value} MW"}},{name:"辐射W/m²",type:"value",axisLabel:{formatter:"{value} W/m²"},alignTicks:!0}],series:[{color:a[0],name:"实际功率",type:"line",emphasis:{focus:"series"},yAxisIndex:0,lineStyle:{width:1},smooth:!0,showSymbol:!1,areaStyle:{color:new E(0,0,0,1,[{offset:0,color:M(a[0],.3)},{offset:1,color:M(a[0],0)}],!1),shadowColor:M(a[0],.9),shadowBlur:20},data:[],connectNulls:!0},{color:a[1],name:"预测功率",type:"line",yAxisIndex:0,emphasis:{focus:"series"},lineStyle:{width:1},showSymbol:!1,smooth:!0,areaStyle:{color:new E(0,0,0,1,[{offset:0,color:M(a[1],.3)},{offset:1,color:M(a[1],0)}],!1),shadowColor:M(a[1],.9),shadowBlur:20},data:[],connectNulls:!0},{color:a[2],name:"实际辐射",type:"line",smooth:!0,showSymbol:!1,yAxisIndex:1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new E(0,0,0,1,[{offset:0,color:M(a[2],.3)},{offset:1,color:M(a[2],0)}],!1),shadowColor:M(a[2],.7),shadowBlur:20},data:[],connectNulls:!0},{color:a[3],name:"预测辐射",type:"line",yAxisIndex:1,smooth:!0,showSymbol:!1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new E(0,0,0,1,[{offset:0,color:M(a[3],.3)},{offset:1,color:M(a[3],0)}],!1),shadowColor:M(a[3],.7),shadowBlur:20},data:[],connectNulls:!0}]}));async function y(){await new Promise(e=>{setTimeout(e,1e3)}),p(e=>{if(c.value){const l=c.value.map(s=>({dbtime:s.dbtime,prePower:s.prePower,power:s.power,zfsd:s.zfsd,ssrd:s.ssrd}));e.xAxis.data=l.map(s=>s.dbtime),e.series[0].data=l.map(s=>[s.dbtime,s.power]),e.series[1].data=l.map(s=>[s.dbtime,s.prePower]),e.series[2].data=l.map(s=>[s.dbtime,s.zfsd]),e.series[3].data=l.map(s=>[s.dbtime,s.ssrd])}return e})}R(()=>c.value,e=>{v(l=>{if(c.value){const s=c.value.map(i=>({dbtime:i.dbtime,prePower:i.prePower,power:i.power,zfsd:i.zfsd,ssrd:i.ssrd}));l.xAxis.data=s.map(i=>i.dbtime),l.series[0].data=s.map(i=>[i.dbtime,i.power]),l.series[1].data=s.map(i=>[i.dbtime,i.prePower]),l.series[2].data=s.map(i=>[i.dbtime,i.zfsd]),l.series[3].data=s.map(i=>[i.dbtime,i.ssrd])}return l})});function S(){p((e,l)=>{const s=l();return e.legend.data=s.legend.data,e.series[0].name=s.series[0].name,e.series[1].name=s.series[1].name,e})}async function n(){y()}return R(()=>P.locale,()=>{S()}),n(),(e,l)=>(B(),K("div",{ref_key:"domRef",ref:A,class:"h-100% overflow-hidden"},null,512))}}),Xe=X(Ke,[["__scopeId","data-v-969cbb27"]]),Ye=j({name:"LineChart",__name:"weather-chart",props:{data:{type:Array,default:[]}},setup(C){const a=C,k=Z(),c=Date.now(),P=new Date(c).setHours(23,59,59,999),{domRef:f,updateOptions:h,showLoading:A,updateOptionsAsync:p}=re(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(n){return oe(n,"°C")},backgroundColor:"#6a7985",textStyle:{color:"#fff"}},legend:{data:["环境温度","预测温度","组件温度"]},grid:{left:"2%",right:"5%",bottom:"10%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd} {HH}:{mm}"},max:P+60*1e3,data:[]},yAxis:{name:"温度(°C)",type:"value",axisLabel:{formatter:"{value} °C"}},series:[{color:"#27ae60",name:"环境温度",type:"line",lineStyle:{width:1},smooth:!0,showSymbol:!1,areaStyle:{color:new E(0,0,0,1,[{offset:0,color:"rgba(39, 174, 96,0.4)"},{offset:1,color:"rgba(39, 174, 96,0)"}],!1),shadowColor:"rgba(39, 174, 96,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#c0392b",name:"预测温度",type:"line",lineStyle:{width:1},smooth:!0,showSymbol:!1,areaStyle:{color:new E(0,0,0,1,[{offset:0,color:"rgba(192, 57, 43,0.3)"},{offset:1,color:"rgba(192, 57, 43,0)"}],!1),shadowColor:"rgba(192, 57, 43,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#ffa000",name:"组件温度",type:"line",lineStyle:{width:1},smooth:!0,showSymbol:!1,areaStyle:{color:new E(0,0,0,1,[{offset:0,color:"rgba(255, 160, 0,0.3)"},{offset:1,color:"rgba(255, 160, 0,0)"}],!1),shadowColor:"rgba(255, 160, 0,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0}]}));async function v(){await new Promise(n=>{setTimeout(n,1e3)}),h(n=>(a.data&&(n.xAxis.data=a.data.map(e=>e.dbtime),n.series[0].data=a.data.map(e=>[e.dbtime,e.envT]),n.series[1].data=a.data.map(e=>[e.dbtime,e.tt2]),n.series[2].data=a.data.map(e=>[e.dbtime,e.moduleT])),n))}function y(){h((n,e)=>{const l=e();return n.legend.data=l.legend.data,n.series[0].name=l.series[0].name,n.series[1].name=l.series[1].name,n.series[2].name=l.series[2].name,n})}async function S(){v()}return R(()=>k.locale,()=>{y()}),R(()=>a.data,()=>{p(n=>(a.data&&(n.xAxis.data=a.data.map(e=>e.dbtime),n.series[0].data=a.data.map(e=>[e.dbtime,e.envT]),n.series[1].data=a.data.map(e=>[e.dbtime,e.tt2]),n.series[2].data=a.data.map(e=>[e.dbtime,e.moduleT])),n))}),S(),(n,e)=>(B(),K("div",{ref_key:"domRef",ref:f,style:{height:"260px",overflow:"hidden"}},null,512))}}),Ze=X(Ye,[["__scopeId","data-v-a7f99f3f"]]),ie=C=>(We("data-v-cb2bee1b"),C=C(),Be(),C),ea=ie(()=>O("img",{src:je,alt:"",style:{height:"140px",width:"100%","margin-bottom":"20px"}},null,-1)),aa={class:"flex items-center"},ta=ie(()=>O("div",{class:"w-80px font-size-14px text-right"},"气象站：",-1)),sa=j({name:"home",__name:"index",setup(C){ye();const a=Z(),k=Q(()=>a.isMobile?0:16),c=N({stationP:0}),P=async()=>{const{data:u,error:_}=await Ne();_||(c.value=u)},f=N(),h=N(),A=async()=>{var r;const{data:u,error:_}=await ze();_||(h.value=u,h.value.length!=0&&(p.value=(r=u[0])==null?void 0:r.id,y()))},p=N(),v=N(),y=async()=>{const{data:u,error:_}=await Ee({devId:p.value});_||(v.value=u)},S=u=>{p.value=u,y(),L()},n=Date.now(),e=new Date(n).setHours(0,0,0,0),l=new Date(n).setHours(23,59,59,999),s=N(),i=async()=>{const{data:u,error:_}=await Ge({startTime:H(1,e),endTime:H(1,l),page:1,limit:100});_||(s.value=JSON.parse(JSON.stringify(u)).list)},T=N(),W=async()=>{const{data:u,error:_}=await Pe({date:H(0,Date.now())});_||(T.value=u,T.value.forEach(r=>(s.value.forEach(g=>{r.dbtime==g.dbtime&&(r.ssrd=g.ssrd)}),r)),m.value.forEach(r=>{const g=T.value.find(z=>z.dbtime===r.dbtime);g?Object.assign(g,r):T.value.push(r)}),T.value=T.value.sort((r,g)=>new Date(r.dbtime).getTime()-new Date(g.dbtime).getTime()))},m=N(),L=async()=>{if(!p.value)return;const{data:u,error:_}=await Ve({id:p.value,startTime:H(0,Date.now())+" 00:00:00",endTime:H(1,Date.now())});console.log("气象实际数据",u),m.value=u,s.value.forEach(r=>{const g=m.value.find(z=>z.dbtime===r.dbtime);g?Object.assign(g,r):m.value.push(r)}),m.value=m.value.sort((r,g)=>new Date(r.dbtime).getTime()-new Date(g.dbtime).getTime())},F=N(null);xe(async()=>{ce(),await A(),await P(),await i(),await L(),await W(),F.value=setInterval(async()=>{await y(),await P(),await i(),await L(),await W()},1e3*60*1)}),Se(()=>{F.value&&clearInterval(F.value),U.value&&U.value.close()});const $=De({col:"",trs:""}),U=N(null),ce=()=>{var I,G,q;if((I=U.value)==null||I.close(),!Le("channel:status:websocket")){(G=window.$message)==null||G.destroyAll(),(q=window.$message)==null||q.warning("暂无权限连接websocket");return}const u=new Date().getTime(),_=Ce(),r=ke(`${_}${u}getchlstatus`),g=te(r),z=te("getchlstatus"),D=new Te($e+`/ChannelStatusWebsocket/${z}/${g}/${u}/${_}?token=${Me()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});U.value=D,D.connect(),D.onclose(()=>{}),D.onerror(()=>{}),D.onopen(()=>{}),D.onmessage(V=>{if(console.log(V,"通道状态websocket接受数据"),!de(V.data))return;const d=JSON.parse(V.data).dataStatus;d&&($.col=d.col+""=="0"||d.col+""=="1"?d.col+"":"",$.trs=d.trs+""=="0"||d.trs+""=="1"?d.trs+"":"")})},de=u=>{try{return JSON.parse(u),!0}catch{return!1}};return(u,_)=>{const r=He,g=Re,z=Ae,D=se,I=le,G=ne,q=Ie,V=Oe;return B(),J(V,{vertical:"",size:16,class:"h-100% home","item-style":{height:"100%"}},{default:t(()=>[o(G,{"y-gap":k.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:t(()=>[o(I,{span:"24 s:24 m:24"},{default:t(()=>[o(D,{title:"",bordered:!1,class:"card-wrapper h-100% bg-transparent","content-style":{padding:"0px"}},{default:t(()=>[o(G,{"x-gap":k.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:t(()=>[o(I,{span:"24 s:24 m:6"},{default:t(()=>[o(D,{title:"电场实时数据",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"12px"},"content-style":{padding:"12px",paddingTop:"0px",display:"flex",flexDirection:"column"}},{"header-extra":t(()=>[b(" 运行状态："+w(c.value.stationP&&c.value.stationP>0&&c.value.stationControlled==0?"并网运行":c.value.stationP&&c.value.stationP>0&&c.value.stationControlled==1?"降额运行":c.value.stationP==0?"待机":""),1)]),default:t(()=>[ea,o(z,{trigger:"none"},{default:t(()=>[o(g,{bordered:"",column:1,"label-placement":"left",size:"small",class:"flex-1","content-style":{minWidth:"100px"}},{default:t(()=>[o(r,null,{label:t(()=>[b(" 最后更新时间 ")]),default:t(()=>[b(" "+w(c.value.dbtime||"-"),1)]),_:1}),o(r,null,{label:t(()=>{var d,x;return[b(" 总有功功率"+w((d=f.value)!=null&&d.StationP?` (${(x=f.value)==null?void 0:x.StationP})`:"(MW)"),1)]}),default:t(()=>[b(" "+w(c.value.stationP??"-"),1)]),_:1}),o(r,null,{label:t(()=>{var d,x;return[b(" 总无功功率"+w((d=f.value)!=null&&d.StationQ?` (${(x=f.value)==null?void 0:x.StationQ})`:"(MVar)"),1)]}),default:t(()=>[b(" "+w(c.value.stationQ??"-"),1)]),_:1}),o(r,null,{label:t(()=>{var d,x,ee;return[b(" 总功率因数"+w(((d=f.value)==null?void 0:d.StationCOS)=="-"?"":(x=f.value)!=null&&x.StationCOS?`
                        (${(ee=f.value)==null?void 0:ee.StationCOS})`:""),1)]}),default:t(()=>[b(" "+w(c.value.stationCOS??"-"),1)]),_:1}),o(r,null,{label:t(()=>{var d,x;return[b(" 日发电量"+w((d=f.value)!=null&&d.StationDayE?` (${(x=f.value)==null?void 0:x.StationDayE})`:"(MWh)"),1)]}),default:t(()=>[b(" "+w(c.value.stationDayE??"-"),1)]),_:1}),o(r,null,{label:t(()=>{var d,x;return[b(" 总发电量"+w((d=f.value)!=null&&d.StationTotalE?` (${(x=f.value)==null?void 0:x.StationTotalE})`:"(MWh)"),1)]}),default:t(()=>[b(" "+w(c.value.stationTotalE??"-"),1)]),_:1}),o(r,null,{label:t(()=>[b(" 是否限电 ")]),default:t(()=>[O("span",null,w(c.value.stationControlled==1?"是":"否"),1)]),_:1}),o(r,null,{label:t(()=>[b(" 数据接入状态 ")]),default:t(()=>[O("span",{class:Y({success:$.col=="0",error:$.col=="1",default:$.col!="0"&&$.col!="1"})},null,2)]),_:1}),o(r,null,{label:t(()=>[b(" 数据上报状态 ")]),default:t(()=>[O("span",{class:Y({success:$.trs=="0",error:$.trs=="1",default:$.trs!="0"&&$.trs!="1"})},null,2)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(I,{span:"24 s:24 m:18"},{default:t(()=>[o(D,{title:"今日预测功率",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"10px",paddingTop:"0px"}},{default:t(()=>[o(Xe,{data:T.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1}),o(I,{span:"24 s:24 m:24"},{default:t(()=>[o(D,{title:"",bordered:!0,class:"card-wrapper h-100%","content-style":{padding:"0px"}},{default:t(()=>[o(G,{"x-gap":k.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:t(()=>[o(I,{span:"24 s:24 m:6"},{default:t(()=>[o(D,{title:"气象数据",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"12px",paddingBottom:"0px"},"content-style":{padding:"0px"}},{"header-extra":t(()=>[O("div",aa,[ta,o(q,{filterable:"",placeholder:"请选择气象站",value:p.value,"onUpdate:value":_[0]||(_[0]=d=>p.value=d),options:h.value,"label-field":"sname","value-field":"id",style:{width:"140px"},onUpdateValue:S},null,8,["value","options"])])]),default:t(()=>[o(Qe,{MeteorologicalData:v.value},null,8,["MeteorologicalData"])]),_:1})]),_:1}),o(I,{span:"24 s:24 m:18"},{default:t(()=>[o(D,{title:"今日实时气象",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"0px",paddingTop:"0px"}},{default:t(()=>[o(Ze,{data:m.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1})]),_:1},8,["y-gap"])]),_:1})}}}),da=X(sa,[["__scopeId","data-v-cb2bee1b"]]);export{da as default};
