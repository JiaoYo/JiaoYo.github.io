import{_ as ie}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Cxcfxqjv.js";import{d as K,n as j,p as G,s as W,r as M,j as H,D as E,o as P,c as J,w as a,g as e,E as F,h as I,t as A,i as t,$ as f,F as re,Z,J as Q,B as O,N as X,O as Y,ad as ee,q as ce,b as de,ae as ue,K as pe,af as me,ag as _e,a3 as fe,e as ve,ah as $,ai as he,aj as ge}from"./index-ceBNQZ86.js";import{u as ye,a as be}from"./table-Cwx-mm4V.js";import{_ as we}from"./round-search-BcCfg6Rs.js";import{_ as De}from"./round-refresh-XHI1_HgH.js";import{a as te,c as ae}from"./common-BjAmKpOM.js";import{_ as ke}from"./lodash-mKDvD7pG.js";import{_ as ne}from"./Cascader-W-SqsJyz.js";import{_ as Se}from"./FormItemGridItem-CD-6gtvr.js";import{_ as Ne}from"./Grid-D1BWnhHy.js";import{A as xe,B as Te,C as Ce,D as Le}from"./events-CiWBxrbu.js";import{h as V}from"./permission-DyJpvaaK.js";import{_ as ze}from"./Popconfirm-Bmvw5sKT.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-BDLk7ElL.js";import"./setting-outlined-CNghbagY.js";import"./export-DpVhcvN8.js";import"./refresh-DxuY7wy-.js";import"./round-delete-DvbQsJY0.js";import"./round-plus-3bZN76iw.js";import"./Upload-BUy5bQcQ.js";import"./Progress-wPQ_PjEL.js";const Re=K({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(v,{emit:z}){const d=z,{formRef:g,restoreValidation:_}=G(),c=W(v,"model"),w=M({eventsTypeDataList:[]});async function R(){const{data:S,error:l}=await te();l||(w.eventsTypeDataList=S)}R();const y=H();(async()=>{const{data:S,error:l}=await ae();l||(y.value=S.map(h=>({...h,id:"-"+h.id,type:h.cname})))})();function n(){c.value.fuzzy="",d("search")}async function T(){await _(),d("reset")}async function D(){d("search")}const k=ke.debounce(D,1e3,{leading:!0,trailing:!1});return(S,l)=>{const h=ne,b=Se,C=Z,B=Q,u=De,s=O,p=we,o=X,i=Ne,m=Y,N=ee,L=E("no-space");return P(),J(N,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(m,{ref_key:"formRef",ref:g,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:re(t(k),["enter"])},{default:a(()=>[e(i,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:a(()=>[e(b,{span:"24 s:12 m:8 l:6",label:"日志源设备",path:"lid"},{default:a(()=>[e(h,{value:c.value.lid,"onUpdate:value":[l[0]||(l[0]=r=>c.value.lid=r),D],placeholder:"请选择日志源设备",options:y.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),e(b,{span:"24 s:12 m:8 l:6",label:"事件类型",path:"eid"},{default:a(()=>[e(C,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:c.value.eid,"onUpdate:value":[l[1]||(l[1]=r=>c.value.eid=r),D],"value-field":"id","label-field":"pname",options:w.eventsTypeDataList},null,8,["value","options"])]),_:1}),e(b,{span:"24 s:12 m:8 l:6",label:"特征值",path:"fuzzy"},{default:a(()=>[F(e(B,{clearable:"",value:c.value.fuzzy,"onUpdate:value":l[2]||(l[2]=r=>c.value.fuzzy=r),placeholder:"请输入特征值",onClear:n},null,8,["value"]),[[L]])]),_:1}),e(b,{span:"24 s:12 m:8 l:6"},{default:a(()=>[e(o,{class:"w-full"},{default:a(()=>[e(s,{onClick:T},{icon:a(()=>[e(u,{class:"text-icon"})]),default:a(()=>[I(" "+A(t(f)("common.reset")),1)]),_:1}),e(s,{type:"primary",ghost:"",onClick:t(k)},{icon:a(()=>[e(p,{class:"text-icon"})]),default:a(()=>[I(" "+A(t(f)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Be=K({name:"OperateDrawer",__name:"operate-drawer",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(v,{emit:z}){const d=v,g=z,_=W(v,"visible"),{formRef:c,validate:w,restoreValidation:R}=G(),{defaultRequiredRule:y}=ce(),U=de(()=>({add:"新增事件特征值",edit:"修改事件特征值"})[d.operateType]),n=M(T());function T(){return{ename:"",lid:void 0,eid:void 0}}const D={ename:y,lid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"},eid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"}},k=H();(async()=>{const{data:u,error:s}=await ae();s||(k.value=u.map(p=>({...p,id:"-"+p.id,type:p.cname})))})();const l=M({eventsTypeDataList:[]});async function h(){const{data:u,error:s}=await te();s||(l.eventsTypeDataList=u)}h();function b(){Object.assign(n,T()),d.operateType==="edit"&&d.rowData&&Object.assign(n,d.rowData)}function C(){_.value=!1}async function B(){var u,s;if(await w(),d.operateType==="add"){const{data:p,error:o}=await xe([{ename:n.ename,lid:n.lid,eid:n.eid}]);o||((u=window.$message)==null||u.success(f("common.addSuccess")),C(),g("submitted"))}else{const{data:p,error:o}=await Te([{id:d.rowData.id,ename:n.ename,lid:n.lid,eid:n.eid}]);o||((s=window.$message)==null||s.success(f("common.updateSuccess")),C(),g("submitted"))}}return ue(_,()=>{_.value&&(b(),R())}),(u,s)=>{const p=Q,o=pe,i=ne,m=Z,N=Y,L=O,r=X,oe=me,le=_e,se=E("no-space");return P(),J(le,{show:_.value,"onUpdate:show":s[3]||(s[3]=x=>_.value=x),"display-directive":"show",width:400},{default:a(()=>[e(oe,{title:U.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(r,{size:16},{default:a(()=>[e(L,{onClick:C},{default:a(()=>[I(A(t(f)("common.cancel")),1)]),_:1}),e(L,{type:"primary",onClick:B},{default:a(()=>[I(A(t(f)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(N,{ref_key:"formRef",ref:c,model:n,rules:D},{default:a(()=>[e(o,{label:"特征值",path:"ename"},{default:a(()=>[F(e(p,{value:n.ename,"onUpdate:value":s[0]||(s[0]=x=>n.ename=x),placeholder:"请输入特征值",clearable:""},null,8,["value"]),[[se]])]),_:1}),e(o,{label:"日志源设备",path:"lid"},{default:a(()=>[e(i,{value:n.lid,"onUpdate:value":s[1]||(s[1]=x=>n.lid=x),placeholder:"请选择日志源设备",options:k.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),e(o,{label:"事件类型",path:"eid"},{default:a(()=>[e(m,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:n.eid,"onUpdate:value":s[2]||(s[2]=x=>n.eid=x),"value-field":"id","label-field":"pname",options:l.eventsTypeDataList},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ue={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function q(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!he(v)}const tt=K({name:"eventalarm_eventcharacteristicvalue",__name:"index",setup(v){const z=fe(),{columns:d,columnChecks:g,data:_,getData:c,loading:w,mobilePagination:R,searchParams:y,resetSearchParams:U}=ye({apiFn:Ce,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,lid:null,eid:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"ename",title:"特征值",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname",title:"事件类型",align:"center",minWidth:180,ellipsis:{tooltip:!0}},{key:"dbtime",title:"入库时间",align:"center",width:180},{key:"operate",title:f("common.operate"),align:"center",width:160,fixed:"right",render:o=>{let i;return e("div",{class:"flex-center gap-8px"},[F(e(O,{type:"info",ghost:!0,size:"small",onClick:()=>u(o.id)},q(i=f("common.edit"))?i:{default:()=>[i]}),[[E("no-auth"),"event.eigen.value.update"]]),e(ze,{onPositiveClick:()=>s(o.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let m;return F(e(O,{type:"error",ghost:!0,size:"small"},q(m=f("common.delete"))?m:{default:()=>[m]}),[[E("no-auth"),"event.eigen.value.delete"]])}})])}}]}),{drawerVisible:n,operateType:T,editingData:D,handleAdd:k,handleEdit:S,checkedRowKeys:l,onBatchDeleted:h,onDeleted:b,closeDrawer:C}=be(_,c);async function B(){console.log(l.value),p(l.value,o=>{h()})}function u(o){S(o)}function s(o){console.log(o),p([o],i=>{b()})}async function p(o,i){const{data:m,error:N}=await Le(o);if(!N)i&&i(m);else return!1}return(o,i)=>{const m=ie,N=ge,L=ee;return P(),ve("div",Ue,[e(Re,{model:t(y),"onUpdate:model":i[0]||(i[0]=r=>$(y)?y.value=r:null),onReset:t(U),onSearch:t(c)},null,8,["model","onReset","onSearch"]),e(L,{title:"事件特征值",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(m,{columns:t(g),"onUpdate:columns":i[1]||(i[1]=r=>$(g)?g.value=r:null),"disabled-delete":t(l).length===0,loading:t(w),onAdd:t(k),onDelete:B,onRefresh:t(c),"is-view-add-button":t(V)("event.eigen.value.insert"),"is-view-delete-button":t(V)("event.eigen.value.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:a(()=>[e(N,{"checked-row-keys":t(l),"onUpdate:checkedRowKeys":i[2]||(i[2]=r=>$(l)?l.value=r:null),columns:t(d),data:t(_),size:"small","flex-height":!t(z).isMobile,"scroll-x":962,loading:t(w),remote:"","row-key":r=>r.id,pagination:t(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Be,{visible:t(n),"onUpdate:visible":i[3]||(i[3]=r=>$(n)?n.value=r:null),"operate-type":t(T),"row-data":t(D),onSubmitted:t(c)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{tt as default};
