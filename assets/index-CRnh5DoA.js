import{d as W,q as j,s as le,x as K,o as E,c as q,w as n,g as t,i as y,X as ne,aE as oe,h as w,t as S,$ as v,G as ie,aF as se,a0 as ue,B,O as F,P as re,ad as Q,j as k,ae as ce,r as G,av as H,e as J,ay as de,aj as X,az as pe,S as fe,ar as me,Q as _e,R as ve,f as Y,ai as Z,T as ee,a4 as ge}from"./index-D7mQqpt0.js";import{f as he,a as ye,b as be,c as xe}from"./audit-events-C_MrSpgt.js";import{_ as ke,l as te}from"./lodash-BOEMR3ZM.js";import{T as U}from"./basicconf-Cxugr5e7.js";import{_ as we}from"./round-search-Dx84b4UW.js";import{_ as Te}from"./round-refresh-Cb-JvNfU.js";import{u as De}from"./usePageData-DsxhjksL.js";import{f as Se}from"./system-manage-BzSxbh82.js";import{_ as Ce}from"./FormItemGridItem-CRYgfShT.js";import{_ as Ne}from"./DatePicker-Cb-sWowM.js";import{_ as Ae}from"./Grid-2onT2uBK.js";import{f as ze}from"./events-AJQSVGVR.js";import{_ as Ie,a as Pe}from"./DescriptionsItem-DxSt7xE4.js";import{e as Ve}from"./exportExcel-D6OyA9oJ.js";import"./TimePicker-tRvpBH9e.js";import"./defineProperty-BIyzosjY.js";const $e=W({name:"FormSearch",__name:"form-search",props:j({AuditTypeData:{},AuditPolicyData:{}},{model:{required:!0},modelModifiers:{}}),emits:j(["reset","search"],["update:model"]),setup(d,{emit:A}){const C=d,o=A,{formRef:P,restoreValidation:x}=le(),i=K(d,"model");De(Se);async function T(l,s){l&&l.length>0?(i.value.startTime=l[0],i.value.endTime=l[1]):(i.value.startTime=null,i.value.endTime=null),o("search")}async function L(){await x(),i.value.timeRange=null,i.value.atype=null,i.value.ap=null,i.value.startTime=null,i.value.endTime=null,i.value.elevel=null,se(()=>{o("search")})}async function g(){o("search")}const z=ke.throttle(g,1e3,{trailing:!1});return(l,s)=>{const r=ue,f=Ce,N=Ne,I=Te,h=B,D=we,V=F,$=Ae,u=re,b=Q;return E(),q(b,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(u,{ref_key:"formRef",ref:P,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ie(y(z),["enter"])},{default:n(()=>[t($,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[t(f,{span:"24 s:12 m:8 l:6",label:"事件等级",path:"elevel"},{default:n(()=>[t(r,{filterable:"",clearable:"",value:i.value.elevel,"onUpdate:value":[s[0]||(s[0]=e=>i.value.elevel=e),g],placeholder:"请选择事件等级",options:y(ne)(y(oe))},null,8,["value","options"])]),_:1}),t(f,{span:"24 s:12 m:8 l:6",label:"审计类型",path:"atype"},{default:n(()=>[t(r,{value:i.value.atype,"onUpdate:value":[s[1]||(s[1]=e=>i.value.atype=e),g],placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:C.AuditTypeData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(f,{span:"24 s:12 m:8 l:6",label:"审计策略",path:"ap"},{default:n(()=>[t(r,{value:i.value.ap,"onUpdate:value":[s[2]||(s[2]=e=>i.value.ap=e),g],placeholder:"请选择审计策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:C.AuditPolicyData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(f,{span:"24 s:12 m:12 l:12",label:"产生时间",path:"timeRange"},{default:n(()=>[t(N,{clearable:"",value:i.value.timeRange,"onUpdate:value":s[3]||(s[3]=e=>i.value.timeRange=e),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":T},null,8,["value"])]),_:1}),t(f,{span:"24 s:12 m:12 l:6",label:" "},{default:n(()=>[t(V,{class:"w-full"},{default:n(()=>[t(h,{onClick:L},{icon:n(()=>[t(I,{class:"text-icon"})]),default:n(()=>[w(" "+S(y(v)("common.reset")),1)]),_:1}),t(h,{type:"primary",ghost:"",onClick:y(z)},{icon:n(()=>[t(D,{class:"text-icon"})]),default:n(()=>[w(" "+S(y(v)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),ae=d=>(_e("data-v-2bc113e5"),d=d(),ve(),d),Oe=ae(()=>Y("span",null,"事件信息",-1)),Me=ae(()=>Y("span",null,"事件溯源",-1)),Ee={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"500px"}},Le={key:1,class:"max-h-500px min-h-320px"};function Re(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!Z(d)}const Ge=W({__name:"detailInfo",props:j({detailInfo:{},AuditTypeData:{},AuditPolicyData:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(d){const A=K(d,"detailVisible"),C=d,o=k();ce(()=>A.value,async l=>{l&&(o.value=C.detailInfo,T())});const P=[{title:"",key:"index",width:50,render:(l,s)=>`${s+1}`},{key:"pname1",title:"安全事件名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"安全事件类型",align:"center",width:140},{key:"pname2",title:"安全事件类别",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:l=>{(l.elevel===void 0||l.elevel===null)&&(l.elevel=1);const s={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},r=v(U[l.elevel]);let f={color:s[l.elevel],textColor:"#ffffff",borderColor:s[l.elevel]};return t(H,{size:"small",color:f},Re(r)?r:{default:()=>[r]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:180},{key:"type",title:"发生源设备类型",align:"center",width:160}],x=k(!1);let i=G([]);const T=async l=>{var f;if(!x.value)x.value=!0;else return;const{data:s,error:r}=await ze({pageId:l,auditid:(f=o.value)==null?void 0:f.auditid,limit:20});r||(x.value=!1,l?i=[...i,...s]:i=s)};function L(l){var r;Math.abs(l.target.scrollTop+l.target.offsetHeight-l.target.scrollHeight)<=20&&((r=o.value)==null?void 0:r.eco)>i.length&&g()}const g=te.debounce(()=>{T(i[i.length-1].id)},300),z=G({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:l,endIndex:s,page:r,pageSize:f,pageCount:N,itemCount:I}){var h,D;return`已加载${i.length}条 共${(i.length>((h=o.value)==null?void 0:h.eco)?i.length:(D=o.value)==null?void 0:D.eco)||0}条`}});return(l,s)=>{const r=Ie,f=Pe,N=F,I=de,h=X,D=pe,V=fe,$=me;return E(),q($,{show:A.value,"onUpdate:show":s[0]||(s[0]=u=>A.value=u),title:"事件详情",preset:"card",class:"w-1200px"},{default:n(()=>[t(V,{class:"max-h-600px pr-20px"},{default:n(()=>[t(D,{type:"line",animated:""},{default:n(()=>[t(I,{name:"1"},{tab:n(()=>[Oe]),default:n(()=>[t(N,{vertical:"",size:12},{default:n(()=>[t(f,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:n(()=>[t(r,{label:"审计事件名称"},{default:n(()=>{var u;return[w(S((u=o.value)==null?void 0:u.aename),1)]}),_:1}),t(r,{label:"审计类型"},{default:n(()=>{var u,b;return[w(S(((u=C.AuditTypeData.find(e=>{var a;return e.id===((a=o.value)==null?void 0:a.atype)}))==null?void 0:u.atypename)||((b=o.value)==null?void 0:b.atype)||""),1)]}),_:1}),t(r,{label:"审计策略"},{default:n(()=>{var u,b;return[w(S(((u=C.AuditPolicyData.find(e=>{var a;return e.id===((a=o.value)==null?void 0:a.ap)}))==null?void 0:u.pname)||((b=o.value)==null?void 0:b.ap)||""),1)]}),_:1}),t(r,{label:"事件等级"},{default:n(()=>{var u,b,e,a,c,m,_,p,O,R;return[t(y(H),{size:"small",color:{textColor:"#ffffff",borderColor:((u=o.value)==null?void 0:u.alevel)===0?"#8e9dff":((b=o.value)==null?void 0:b.alevel)===1?"#5da8ff":((e=o.value)==null?void 0:e.alevel)===2?"#fedc69":((a=o.value)==null?void 0:a.alevel)===3?"#ff9874":((c=o.value)==null?void 0:c.alevel)===4?"#ff0000":"#5da8ff",color:((m=o.value)==null?void 0:m.alevel)===0?"#8e9dff":((_=o.value)==null?void 0:_.alevel)===1?"#5da8ff":((p=o.value)==null?void 0:p.alevel)===2?"#fedc69":((O=o.value)==null?void 0:O.alevel)===3?"#ff9874":((R=o.value)==null?void 0:R.alevel)===4?"#ff0000":"#5da8ff"}},{default:n(()=>{var M;return[w(S(y(v)(y(U)[(M=o.value)==null?void 0:M.alevel])),1)]}),_:1},8,["color"])]}),_:1}),t(r,{label:"产生时间"},{default:n(()=>{var u;return[w(S((u=o.value)==null?void 0:u.dbtime),1)]}),_:1}),t(r,{label:"更新时间"},{default:n(()=>{var u;return[w(S((u=o.value)==null?void 0:u.uptime),1)]}),_:1}),t(r,{label:"事件总数"},{default:n(()=>{var u;return[w(S((u=o.value)==null?void 0:u.eco),1)]}),_:1})]),_:1})]),_:1})]),_:1}),t(I,{name:"2"},{tab:n(()=>[Me]),default:n(()=>[y(i).length==0?(E(),J("div",Ee," 暂无安全事件信息 ")):(E(),J("div",Le,[t(h,{columns:P,remote:"",data:y(i),size:"small","scroll-x":762,"row-key":u=>u.id,"virtual-scroll":"",class:"sm:h-full","max-height":400,loading:x.value,pagination:z,onScroll:L},null,8,["data","row-key","loading","pagination"])]))]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ue=ee(Ge,[["__scopeId","data-v-2bc113e5"]]),je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Be(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!Z(d)}const He=W({name:"audit_event",__name:"index",setup(d){const A=k(window.innerHeight-395),C=ge(),o=k(!1),P=k(),x=k([]);(async()=>{const{data:e,error:a}=await he({page:1,limit:1e3});a||(x.value=JSON.parse(JSON.stringify(e)).list)})();const T=k([]);(async()=>{const{data:e,error:a}=await ye({page:1,limit:1e3});a||(T.value=JSON.parse(JSON.stringify(e)).list)})();const g=G({limit:20,pageId:void 0,elevel:void 0,atype:void 0,uid:void 0,suditPolicy:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),z=[{key:"aename",title:v("page.audit.event.eventName"),align:"center",minWidth:160,ellipsis:!0,resizable:!0},{key:"atype",title:v("page.audit.event.type"),align:"center",minWidth:160,render:e=>{var c;const a=(c=x.value.find(m=>m.id===e.atype))==null?void 0:c.atypename;return t("span",null,[a||e.atype])},resizable:!0},{key:"dbtime",title:v("page.audit.event.createTime"),align:"center",width:180,resizable:!0},{key:"uptime",title:v("page.audit.event.updateTime"),align:"center",width:180,resizable:!0},{key:"ap",title:v("page.audit.event.strategy"),align:"center",width:120,render:e=>{var c;const a=(c=T.value.find(m=>m.id===e.ap))==null?void 0:c.pname;return t("span",null,[a||e.ap])},resizable:!0},{key:"alevel",title:v("page.audit.event.eventRanK"),align:"center",width:120,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=0);const a={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},c=v(U[e.alevel]);let m={color:a[e.alevel],textColor:"#ffffff",borderColor:a[e.alevel]};return t(H,{size:"small",color:m},Be(c)?c:{default:()=>[c]})},resizable:!0},{key:"eco",title:v("page.audit.event.eventCount"),align:"center",width:120,resizable:!0},{key:"operate",title:v("common.operate"),align:"center",width:130,fixed:"right",render:e=>t("div",{class:"flex-center gap-8px"},[t(B,{type:"primary",ghost:!0,size:"small",onClick:()=>u(e)},{default:()=>[w("详情")]})])}],l=k([]),s=k(!1),r=k(0),f=async(e=!1)=>{if(!s.value)s.value=!0;else return;s.value=!0;const{data:a,error:c}=await be(g);c||(r.value=a.length,e?l.value=[...l.value,...a]:l.value=a,s.value=!1)};f();const N=k(!0),I=()=>{l.value=[],g.pageId=void 0,(a=>Object.keys(a).filter(_=>_!=="limit"&&_!=="_t").some(_=>a[_]!==void 0&&a[_]!==""&&a[_]!==null))(g)?N.value=!1:(N.value=!0,D()),f()},h=G({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:a,page:c,pageSize:m,pageCount:_,itemCount:p}){return`已加载${l.value.length}条`+(l.value.length?N.value?` 共计 ${l.value.length>0?p??0:0} 条`:r.value==g.limit?"  预计还有更多":"  没有更多了":"")}});async function D(){const{data:e,error:a}=await xe();a||(h.pageCount=20,h.total=Number(e),h.itemCount=Number(e))}D();function V(e){var c;Math.abs(e.target.scrollTop+e.target.offsetHeight-e.target.scrollHeight)<=20&&h.total>((c=l.value)==null?void 0:c.length)&&$()}const $=te.debounce(()=>{var e;((e=l.value)==null?void 0:e.length)<h.total&&(g.pageId=l.value[l.value.length-1].id,f(!0))},300);async function u(e){P.value=e,o.value=!0}async function b(){if(!l.value.length)return;const e=JSON.parse(JSON.stringify(l.value)),a=[];e.forEach(m=>{const _={};z.forEach(p=>{var O;if(m.hasOwnProperty(p.key)){const R=p.key=="alevel"?v(U[m[p.key]]):p.key=="ap"?(O=T.value.find(M=>M.id===M[p.key]))==null?void 0:O.pname:m[p.key];_[p.title]=R}}),a.push(_)}),Ve(a,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50}],"审计事件_"+new Date().getTime())}return(e,a)=>{const c=F,m=X,_=Q;return E(),J("div",je,[t($e,{model:g,"onUpdate:model":a[0]||(a[0]=p=>g=p),onSearch:I,AuditTypeData:x.value,AuditPolicyData:T.value},null,8,["model","AuditTypeData","AuditPolicyData"]),t(_,{title:y(v)("page.audit.event.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[t(c,null,{default:n(()=>[t(y(B),{type:"primary",size:"small",ghost:"",onClick:b,title:"导出已加载"},{default:n(()=>[w("导出已加载")]),_:1})]),_:1})]),default:n(()=>[t(m,{columns:z,data:l.value,size:"small","virtual-scroll":"","flex-height":!y(C).isMobile,loading:s.value,remote:"","row-key":p=>p.id,"max-height":A.value,pagination:h,onScroll:V,class:"sm:h-full","scroll-x":""},null,8,["data","flex-height","loading","row-key","max-height","pagination"]),t(Ue,{"detail-visible":o.value,"onUpdate:detailVisible":a[1]||(a[1]=p=>o.value=p),"detail-info":P.value,AuditTypeData:x.value,AuditPolicyData:T.value},null,8,["detail-visible","detail-info","AuditTypeData","AuditPolicyData"])]),_:1},8,["title"])])}}}),st=ee(He,[["__scopeId","data-v-e74a75c5"]]);export{st as default};
