import{_ as fe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-hmlrjEU9.js";import{d as O,at as F,av as Q,s as te,x as se,a as _e,$ as l,v as oe,aw as ne,y as J,c as X,o as I,w as s,f as e,bh as ge,G as Y,A as le,h as o,D as H,C as Z,az as we,c0 as ye,N as V,B as $,g as C,t as P,bj as ve,c1 as he,c2 as be,c3 as ke,F as Ne,U as re,bL as ee,e as xe,aE as ie,c4 as Se,bW as De,M as Ue,r as L,b as Ce,aO as B,ay as Pe,ax as Re,c5 as Te,c6 as $e,aF as ae,c7 as Me,aU as je}from"./index-g7h47wCD.js";import{u as ze,a as Be}from"./table-B7PoQ1CW.js";import{u as Fe}from"./business-CU5Ajvci.js";import{_ as Oe}from"./round-search-vUwoc4so.js";import{_ as Ie}from"./round-refresh-BGP4Hcqp.js";import{_ as Ve}from"./Grid-Ca5T20R9.js";import{_ as qe}from"./FormItemGridItem-Bm7x-db3.js";import{_ as Ge}from"./Tree-SpRpI2Q_.js";import{N as Ke}from"./Popconfirm-kfz4J5dj.js";const Ae=O({name:"OperateDrawer",__name:"operate-drawer",props:F({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:F(["submitted"],["update:visible"]),setup(g,{emit:k}){const u=g,h=k,f=Q(g,"visible"),{formRef:w,validate:N,restoreValidation:R}=te(),{defaultRequiredRule:_,patternRules:U}=se(),c=_e(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[u.operateType]),t=oe(d());function d(){return{id:void 0,username:"",oripwd:"",password:"",confirmPassword:"",usertype:void 0,superadmin:1,userimage:"",phnum:"",udesc:""}}const p={username:_,oripwd:{..._,...U.password},password:{..._,...U.password},phnum:{..._,...U.mobile}};async function y(){if(Object.assign(t,d()),u.operateType==="edit"&&u.rowData){const{data:x,error:i}=await he(u.rowData.id);i?Object.assign(t,u.rowData):(Object.assign(t,x),t.usertype=t.usertype+"")}}function D(){f.value=!1}async function T(){var x,i;if(await N(),u.operateType==="add"){const{data:S,error:v}=await be(t.username,t.password,t.usertype,t.superadmin,t.phnum,t.udesc);v||((x=window.$message)==null||x.success(l("common.addSuccess")),D(),h("submitted"))}else{const{data:S,error:v}=await ke({id:t.id,usertype:t.usertype,phnum:t.phnum,udesc:t.udesc});v||((i=window.$message)==null||i.success(l("common.updateSuccess")),D(),h("submitted"))}}return ne(f,()=>{f.value&&(y(),R())}),(x,i)=>{const S=Z,v=le,q=we,M=Y,j=$,m=V,G=ge,K=ve,n=J("no-special");return I(),X(K,{show:f.value,"onUpdate:show":i[4]||(i[4]=a=>f.value=a),"display-directive":"show",width:360},{default:s(()=>[e(G,{title:c.value,"native-scrollbar":!1,closable:""},{footer:s(()=>[e(m,{size:16},{default:s(()=>[e(j,{onClick:D},{default:s(()=>[C(P(o(l)("common.cancel")),1)]),_:1}),e(j,{type:"primary",onClick:T},{default:s(()=>[C(P(o(l)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[e(M,{ref_key:"formRef",ref:w,model:t,rules:p},{default:s(()=>[e(v,{label:o(l)("page.manage.user.username"),path:"username"},{default:s(()=>[H(e(S,{value:t.username,"onUpdate:value":i[0]||(i[0]=a=>t.username=a),placeholder:o(l)("page.manage.user.form.username"),readonly:u.operateType==="edit"},null,8,["value","placeholder","readonly"]),[[n]])]),_:1},8,["label"]),e(v,{label:"用户类型",path:"usertype"},{default:s(()=>[e(q,{value:t.usertype,"onUpdate:value":i[1]||(i[1]=a=>t.usertype=a),filterable:"",placeholder:"请选择用户类型",options:o(ye)(o(Fe).slice(1)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{label:"手机号码",path:"phnum"},{default:s(()=>[e(S,{clearable:"",value:t.phnum,"onUpdate:value":i[2]||(i[2]=a=>t.phnum=a),maxlength:11,placeholder:"请输入手机号码"},null,8,["value"])]),_:1}),e(v,{label:"描述",path:"udesc"},{default:s(()=>[e(S,{type:"textarea",clearable:"",value:t.udesc,"onUpdate:value":i[3]||(i[3]=a=>t.udesc=a),placeholder:"请输入描述",autosize:{minRows:3}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ee=O({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:F(["reset","search"],["update:model"]),setup(g,{emit:k}){const u=k,{formRef:h,restoreValidation:f}=te(),w=Q(g,"model");function N(){w.value.username="",u("search")}async function R(){await f(),u("reset")}async function _(){u("search")}return(U,c)=>{const t=Z,d=qe,p=Ie,y=$,D=Oe,T=V,x=Ve,i=Y,S=re;return I(),X(S,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[e(i,{ref_key:"formRef",ref:h,model:w.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ne(_,["enter"])},{default:s(()=>[e(x,{responsive:"screen","item-responsive":""},{default:s(()=>[e(d,{span:"24 s:12 m:6",label:o(l)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:s(()=>[e(t,{clearable:"",value:w.value.username,"onUpdate:value":c[0]||(c[0]=v=>w.value.username=v),valueModifiers:{trim:!0},placeholder:o(l)("page.manage.user.form.username"),onClear:N},null,8,["value","placeholder"])]),_:1},8,["label"]),e(d,{span:"24 s:12 m:6",class:"pr-24px"},{default:s(()=>[e(T,{class:"w-full"},{default:s(()=>[e(y,{onClick:R},{icon:s(()=>[e(p,{class:"text-icon"})]),default:s(()=>[C(" "+P(o(l)("common.reset")),1)]),_:1}),e(y,{type:"primary",ghost:"",onClick:_},{icon:s(()=>[e(D,{class:"text-icon"})]),default:s(()=>[C(" "+P(o(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Le=O({name:"assignRoles",__name:"assign-roles",props:F({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(g){const k=g,u=Q(g,"visible");function h(){u.value=!1}const f=ee([]),w=async()=>{const{error:c,data:t}=await De();if(!c){const d=JSON.parse(JSON.stringify(t));f.value=d.list.map(p=>p)}},N=ee([]),R=async(c,t,d)=>{var p;N.value=[(p=d.node)==null?void 0:p.id]};async function _(){var c,t,d;if(k.rowData.id){const{data:p,error:y}=await Se(k.rowData.id,N.value.join(","));y||((c=window.$message)==null||c.destroyAll(),(d=(t=window.$message)==null?void 0:t.success)==null||d.call(t,l("common.modifySuccess")),h())}}function U(){k.rowData.id&&(w(),N.value=[k.rowData.roleId])}return ne(u,c=>{c&&U()}),(c,t)=>{const d=Ge,p=$,y=V,D=ie;return I(),X(D,{show:u.value,"onUpdate:show":t[0]||(t[0]=T=>u.value=T),preset:"card",class:"w-480px"},{header:s(()=>t[1]||(t[1]=[xe("div",{class:"flex"},"设置用户角色",-1)])),footer:s(()=>[e(y,{justify:"end"},{default:s(()=>[e(p,{size:"small",class:"mt-16px",onClick:h},{default:s(()=>[C(P(o(l)("common.cancel")),1)]),_:1}),e(p,{type:"primary",size:"small",class:"mt-16px",onClick:_},{default:s(()=>[C(P(o(l)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[e(d,{cascade:"","checked-keys":N.value,data:f.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"","label-field":"name","key-field":"id","children-field":"children","onUpdate:checkedKeys":R},null,8,["checked-keys","data"])]),_:1},8,["show"])}}}),We={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!je(g)}const oa=O({name:"manage_user",__name:"index",setup(g){const k=Ue(),{columns:u,columnChecks:h,data:f,getData:w,loading:N,mobilePagination:R,searchParams:_,resetSearchParams:U}=ze({apiFn:$e,apiParams:{page:1,pageSize:50,limit:50,username:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"username",title:l("page.manage.user.username"),align:"center",minWidth:160},{key:"usertype",title:"用户类型",align:"center",width:120,render:n=>{const a=n.usertype===0?"超级管理员":n.usertype===1?"销售":n.usertype===2?"项目负责人":n.usertype===3?"调试工程师":n.usertype===4?"综合管理":"";return n.usertype===0||n.usertype===1||n.usertype,e(ae,{type:"primary"},W(a)?a:{default:()=>[a]})}},{key:"phnum",title:"手机号码",align:"center",width:160},{key:"udesc",title:"描述",align:"center",minWidth:200},{key:"status",title:l("page.manage.user.status"),align:"center",width:180,render:n=>(n.status===null?n.status=0:(n.status===2||n.status===3)&&(n.status=1),e(ae,{type:n.status==0?"success":n.status==1?"error":n.status==2?"warning":"success"},{default:()=>[n.status==0?"正常":n.status==1?"异常":n.status==2?"锁定":"正常"]}))},{key:"createdate",title:l("page.manage.user.createDate"),align:"center",width:180},{key:"operate",title:l("common.operate"),align:"center",width:320,render:n=>{let a;return e("div",{class:"flex-center gap-8px"},[n.superadmin!=0&&H(e($,{type:"primary",ghost:!0,size:"small",onClick:()=>x(n.id)},W(a=l("common.edit"))?a:{default:()=>[a]}),[[J("no-auth"),"sys:user:update"]]),n.superadmin!=0&&e(Ke,{onPositiveClick:()=>T(n.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let b;return H(e($,{type:"error",ghost:!0,size:"small"},W(b=l("common.delete"))?b:{default:()=>[b]}),[[J("no-auth"),"sys:user:delete"]])}})])}}]}),{drawerVisible:c,operateType:t,editingData:d,handleEdit:p,checkedRowKeys:y,onDeleted:D}=Be(f,w);function T(n){i([n],a=>{D()})}function x(n){p(n)}async function i(n,a){const b=await Me(n);console.log("data",b),a&&a(b)}const S=L(!1),{defaultRequiredRule:v,patternRules:q}=se(),M=L(!1),j=L(),m=oe({username:"",password:"",confirmPassword:"",id:null}),G={password:[v,q.password],confirmPassword:[{required:!0,message:l("form.confirmPwd.required")},{asyncValidator:(n,a)=>a.trim()!==""&&a!==m.password?Promise.reject(n.message):Promise.resolve(),message:l("form.confirmPwd.invalid"),trigger:"input"}]},K=async()=>{var b,z;if(!m.id)return;await((b=j.value)==null?void 0:b.validate());const{data:n,error:a}=await Te(m.username,m.id,m.password);a||((z=window.$message)==null||z.success("修改成功"),M.value=!1)};return(n,a)=>{const b=fe,z=V,ue=Pe,ce=re,A=Z,E=le,de=Y,pe=Re,me=ie;return I(),Ce("div",We,[e(Ee,{model:o(_),"onUpdate:model":a[0]||(a[0]=r=>B(_)?_.value=r:null),onReset:o(U),onSearch:o(w)},null,8,["model","onReset","onSearch"]),e(ce,{title:o(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[e(z,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[e(b,{columns:o(h),"onUpdate:columns":a[1]||(a[1]=r=>B(h)?h.value=r:null)},null,8,["columns"])]),_:1})]),default:s(()=>[e(ue,{"checked-row-keys":o(y),"onUpdate:checkedRowKeys":a[2]||(a[2]=r=>B(y)?y.value=r:null),columns:o(u),data:o(f),size:"small","flex-height":!o(k).isMobile,"scroll-x":962,loading:o(N),remote:"","row-key":r=>r.id,pagination:o(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ae,{visible:o(c),"onUpdate:visible":a[3]||(a[3]=r=>B(c)?c.value=r:null),"operate-type":o(t),"row-data":o(d),onSubmitted:o(w)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(Le,{"row-data":o(d),visible:S.value,"onUpdate:visible":a[4]||(a[4]=r=>S.value=r)},null,8,["row-data","visible"])]),_:1},8,["title"]),e(me,{show:M.value,"onUpdate:show":a[9]||(a[9]=r=>M.value=r),title:o(l)("common.updatePassword"),preset:"card",class:"w-620px"},{footer:s(()=>[e(z,{justify:"end",size:16},{default:s(()=>[e(o($),{onClick:a[8]||(a[8]=r=>M.value=!1)},{default:s(()=>[C(P(o(l)("common.cancel")),1)]),_:1}),e(o($),{type:"primary",onClick:K},{default:s(()=>[C(P(o(l)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[e(pe,{class:"max-h-480px pr-20px"},{default:s(()=>[e(de,{ref_key:"formRef",ref:j,model:m,rules:G,"label-placement":"left","label-width":100,"require-mark-placement":"left"},{default:s(()=>[e(E,{label:o(l)("page.manage.user.username"),path:"username"},{default:s(()=>[e(A,{readonly:"",value:m.username,"onUpdate:value":a[5]||(a[5]=r=>m.username=r),placeholder:o(l)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(E,{label:o(l)("page.login.common.password"),path:"password"},{default:s(()=>[e(A,{type:"password","show-password-on":"click",clearable:"",value:m.password,"onUpdate:value":a[6]||(a[6]=r=>m.password=r),placeholder:o(l)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(E,{label:o(l)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:s(()=>[e(A,{type:"password","show-password-on":"click",clearable:"",value:m.confirmPassword,"onUpdate:value":a[7]||(a[7]=r=>m.confirmPassword=r),placeholder:o(l)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])])}}});export{oa as default};
