import{d as j,q as F,v as Y,s as X,o as J,c as Z,w as l,g as t,h as o,t as m,i as h,$ as M,M as Q,an as H,ao as ee,X as le,A as te,B as T,E as K,D as ae,a9 as q,Z as ne,j as D,r as A,bu as z,e as oe,S as se,F as ie,aw as de,ax as re,f as ue,ay as pe}from"./index-BthjjP8Z.js";import{l as ce}from"./lodash-CQfW-IKX.js";import{_ as me}from"./round-search-D0y4Bi99.js";import{_ as fe}from"./round-refresh-7YBMJmxM.js";import{_ as _e}from"./Cascader-BpetLQ8K.js";import{_ as ge}from"./FormItemGridItem-Cf_xNcQf.js";import{_ as ve}from"./DatePicker-BrYVrpW-.js";import{_ as he}from"./Grid-CrjQrgB8.js";import{w as ye,x as be}from"./events-DGJVlmYq.js";import{b as Ie}from"./common-DWrY_MNZ.js";import{e as xe}from"./exportExcel-CZ2AjtLT.js";import{_ as Le}from"./DataTable-DVNKf1bg.js";import{_ as Se,a as Ce}from"./DescriptionsItem-BMrXBvZ-.js";import"./TimePicker-DSpzDHN4.js";import"./defineProperty-DR7dqcYo.js";import"./Forward-B9_DMOnd.js";const Ee={0:"KERN",1:"USER",2:"MAIL",3:"DAEMON",4:"AUTH",5:"SYSYLOG",6:"LPR",7:"NEWS",8:"UUCP",9:"CRON",10:"AUTHPRIV",11:"FTP",12:"RESERVED_12",13:"RESERVED_13",14:"RESERVED_14",15:"RESERVED_15",16:"LOCAL0",17:"LOCAL1",18:"LOCAL2",19:"LOCAL3",20:"LOCAL4",21:"LOCAL5",22:"LOCAL6",23:"LOCAL7"},De={0:"EMERGENCY",1:"ALERT",2:"CRITICAL",3:"ERROR",4:"WARNING",5:"NOTICE",6:"INFO",7:"DEBUG"},B={logModel:Ee,logLevel:De},Ne=j({name:"FormSearch",__name:"form-search",props:F(["LogSourceDeviceList"],{model:{required:!0},modelModifiers:{}}),emits:F(["search"],["update:model"]),setup(x,{emit:O}){const S=f=>Object.entries(f).map(([d,g])=>({label:g,value:d})),P={logLevel:S(B.logLevel),logModel:S(B.logModel)},C=x,y=O,{formRef:n,restoreValidation:c}=Y(),a=X(x,"model");async function E(f,d){f&&f.length>0?(a.value.startTime=f[0],a.value.endTime=f[1]):(a.value.startTime=void 0,a.value.endTime=void 0)}async function p(){await c(),a.value.lsid=null,a.value.leid=null,a.value.lmid=null,a.value.timeRange=null,a.value.startAndEndIp=null,y("search")}async function b(){var f,d,g,_;if(a.value.startAndEndIp&&a.value.startAndEndIp.length>0?(a.value.startIp=a.value.startAndEndIp[0]||null,a.value.endIp=a.value.startAndEndIp[1]||null):(a.value.startIp=void 0,a.value.endIp=void 0),a.value.startIp&&!H(a.value.startIp)||a.value.endIp&&!H(a.value.endIp))return(f=window.$message)==null||f.destroyAll(),(d=window.$message)==null||d.error("请输入正确的IP地址"),!1;if(a.value.startIp&&a.value.endIp&&ee(a.value.startIp,a.value.endIp)>0)return(g=window.$message)==null||g.destroyAll(),(_=window.$message)==null||_.error("起始IP不能大于终止IP"),!1;y("search")}return(f,d)=>{const g=_e,_=ge,k=le,$=ve,U=te,I=fe,N=T,V=me,e=K,i=he,r=ae,L=q;return J(),Z(L,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[t(r,{ref_key:"formRef",ref:n,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Q(b,["enter"])},{default:l(()=>[t(i,{responsive:"screen","item-responsive":""},{default:l(()=>[t(_,{span:"24 s:24 m:8",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:l(()=>[t(g,{value:a.value.lsid,"onUpdate:value":[d[0]||(d[0]=s=>a.value.lsid=s),b],placeholder:"请选择日志源设备",options:C.LogSourceDeviceList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),t(_,{span:"24 s:24 m:8",label:"级别",path:"leid",class:"pr-24px"},{default:l(()=>[t(k,{filterable:"",clearable:"",placeholder:"请选择级别",value:a.value.leid,"onUpdate:value":[d[1]||(d[1]=s=>a.value.leid=s),b],options:P.logLevel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(_,{span:"24 s:24 m:8",label:"日志模块",path:"lmid",class:"pr-24px"},{default:l(()=>[t(k,{filterable:"",clearable:"",placeholder:"请选择日志模块",value:a.value.lmid,"onUpdate:value":[d[2]||(d[2]=s=>a.value.lmid=s),b],options:P.logModel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(_,{span:"24 s:24 m:8",label:"时间",path:"time",class:"pr-24px mt-10px"},{default:l(()=>[t($,{value:a.value.timeRange,"onUpdate:value":d[3]||(d[3]=s=>a.value.timeRange=s),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":E},null,8,["value"])]),_:1}),t(_,{span:"24 s:24 m:8",label:"IP",path:"startAndEndIp",class:"pr-24px mt-10px"},{default:l(()=>[t(U,{pair:"",separator:"-",placeholder:["发生源起始IP","发生源终止IP"],clearable:"",value:a.value.startAndEndIp,"onUpdate:value":d[4]||(d[4]=s=>a.value.startAndEndIp=s)},null,8,["value"])]),_:1}),t(_,{span:"24 m:8",class:"pr-24px mt-10px",label:" "},{default:l(()=>[t(e,{class:"w-full"},{default:l(()=>[t(N,{onClick:p},{icon:l(()=>[t(I,{class:"text-icon"})]),default:l(()=>[o(" "+m(h(M)("common.reset")),1)]),_:1}),t(N,{type:"primary",ghost:"",onClick:b},{icon:l(()=>[t(V,{class:"text-icon"})]),default:l(()=>[o(" "+m(h(M)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ke=x=>(de("data-v-866c4a5f"),x=x(),re(),x),we={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Re=ke(()=>ue("hr",{style:{"border-color":"#ccc","margin-bottom":"20px"}},null,-1)),Ae=j({name:"eventalarm_generallog",__name:"index",setup(x){const O=ne(),S=D([]);(async()=>{const{data:e,error:i}=await Ie();i||(S.value=e.map(r=>({...r,id:"-"+r.id,type:r.cname})))})();const C=D(!1),y=B,n=A({lsid:void 0,lsdn:"",rdbtime:"",lmid:void 0,leid:void 0,ltext:"",aname:"",procid:"",msgid:"",dbtime:"",hname:"",lcon:"",ip:"",lsip:"",priority:"",type:"",version:"",logtype:void 0}),c=A({pageId:void 0,pageSize:100,lsid:void 0,leid:void 0,lmid:void 0,startTime:void 0,endTime:void 0,startIp:void 0,endIp:void 0,_t:new Date().getTime()}),a=A([{title:"",key:"key",width:80,align:"center",render:(e,i)=>`${i+1}`},{key:"type",title:"设备类型",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"hname",title:"主机名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"rdbtime",title:"接收时间",align:"center",width:160,render:e=>z(e.rdbtime)},{key:"lmid",title:"模块",align:"center",width:160,ellipsis:{tooltip:!0},render:e=>((!e.lmid===void 0||e.lmid===null)&&(e.lmid=0),y.logModel[e.lmid])},{key:"leid",title:"级别",align:"center",width:120,ellipsis:{tooltip:!0},render:e=>((e.leid===void 0||e.leid===null)&&(e.leid=0),y.logLevel[e.leid])},{key:"ipaddr",title:"发生源IP",align:"center",width:180},{key:"ltext",title:"日志原文",align:"center",width:320,ellipsis:{tooltip:!0}},{key:"operate",title:M("common.operate"),align:"center",width:120,fixed:"right",render:e=>t("div",{class:"flex-center gap-8px"},[t(T,{type:"info",ghost:!0,size:"small",onClick:()=>f(e)},{default:()=>[o("详情")]})])}]),E=D(!1),p=D([]),b=async(e=!1)=>{if(!E.value)E.value=!0;else return;const{data:i,error:r}=await ye(c);r||(e?p.value=[...p.value,...i]:p.value=i,E.value=!1)};b();function f(e){n.lsid=e.lsid,n.lsdn=e.lsdn,n.rdbtime=e.rdbtime,n.lmid=e.lmid,n.leid=e.leid,n.ltext=e.ltext,n.aname=e.aname,n.procid=e.procid,n.msgid=e.msgid,n.dbtime=e.dbtime,n.hname=e.hname,n.lcon=e.lcon,n.ip=e.ip,n.lsip=e.lsip,n.priority=e.priority,n.type=e.type,n.version=e.version,n.logtype=e.logtype,C.value=!0}const d=D(null),g=D(!0),_=()=>{p.value=[],c.lsid||c.leid||c.lmid||c.startIp||c.endIp||c.startTime||c.endTime?g.value=!1:(g.value=!0,N()),c.pageId=void 0,b()};function k(e){e.target.scrollTop+e.target.offsetHeight==e.target.scrollHeight&&I.total>p.value.length&&$()}const $=ce.debounce(()=>{p.value.length<I.total&&(c.pageId=p.value[p.value.length-1].id,b(!0))},300);function U(e){return e.index}const I=A({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:i,page:r,pageSize:L,pageCount:s,itemCount:u}){return`已加载${p.value.length}条`+(p.value.length?g.value?` 共计 ${p.value.length>0?u??0:0} 条`:p.value.length>=c.limit?"  预计还有更多":"":"")}});async function N(){const{data:e,error:i}=await be({_t:new Date().getTime()});i||(I.pageCount=20,I.total=Number(e),I.itemCount=Number(e))}N();async function V(){const e=JSON.parse(JSON.stringify(p.value)),i=[];e.forEach(r=>{const L={};a.forEach(s=>{var u,w,R;if(r.hasOwnProperty(s.key)){const G=s.key==="lmid"?((u=y.logModel)==null?void 0:u[r[s.key]])??null:s.key==="leid"?((w=y.logLevel)==null?void 0:w[r[s.key]])??null:s.key==="lsid"?(R=S.value.map(v=>v.data).flat(2).find(v=>v.id==r[s.key]))==null?void 0:R.type:r[s.key];L[s.title]=G}}),i.push(L)}),xe(i,500,"general-log"+new Date().getTime())}return(e,i)=>{const r=K,L=Le,s=q,u=Se,w=Ce,R=se,G=ie;return J(),oe("div",we,[t(Ne,{model:c,"onUpdate:model":i[0]||(i[0]=v=>c=v),onSearch:_,LogSourceDeviceList:S.value},null,8,["model","LogSourceDeviceList"]),t(s,{title:"通用日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[t(r,null,{default:l(()=>[t(h(T),{type:"primary",size:"small",ghost:"",onClick:V,title:"导出已加载"},{default:l(()=>[o("导出已加载")]),_:1})]),_:1})]),default:l(()=>[t(L,{ref_key:"tableContainerRef",ref:d,columns:a,data:p.value,size:"small","flex-height":!h(O).isMobile,"scroll-x":a.reduce((v,W)=>v+W.width,0),loading:E.value,remote:"","row-key":U,showTotal:"",pagination:I,class:"sm:h-full",onScroll:k},null,8,["columns","data","flex-height","scroll-x","loading","pagination"])]),_:1}),t(G,{show:C.value,"onUpdate:show":i[2]||(i[2]=v=>C.value=v),title:"日志详情",preset:"card",class:"w-800px"},{footer:l(()=>[t(r,{justify:"end",size:16},{default:l(()=>[t(h(T),{type:"primary",onClick:i[1]||(i[1]=v=>{C.value=!1})},{default:l(()=>[o(m(h(M)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[Re,t(R,{class:"h-480px pr-20px"},{default:l(()=>[t(w,{"label-placement":"left","label-style":{width:"120px"},bordered:"",column:1},{default:l(()=>[t(u,null,{label:l(()=>[o(" 设备类型 ")]),default:l(()=>[o(" "+m(n.type),1)]),_:1}),t(u,null,{label:l(()=>[o(" 接收时间 ")]),default:l(()=>[o(" "+m(h(z)(n.rdbtime)),1)]),_:1}),t(u,null,{label:l(()=>[o(" 模块 ")]),default:l(()=>[o(" "+m(h(y).logModel[n.lmid]),1)]),_:1}),t(u,null,{label:l(()=>[o(" 级别 ")]),default:l(()=>[o(" "+m(h(y).logLevel[n.leid]),1)]),_:1}),t(u,null,{label:l(()=>[o(" 应用名称 ")]),default:l(()=>[o(" "+m(n.aname),1)]),_:1}),t(u,null,{label:l(()=>[o(" PROCID ")]),default:l(()=>[o(" "+m(n.procid),1)]),_:1}),t(u,null,{label:l(()=>[o(" MSGID ")]),default:l(()=>[o(" "+m(n.msgid||"--"),1)]),_:1}),t(u,null,{label:l(()=>[o(" 日志时间 ")]),default:l(()=>[o(" "+m(h(z)(n.dbtime)),1)]),_:1}),t(u,null,{label:l(()=>[o(" 主机名称 ")]),default:l(()=>[o(" "+m(n.hname),1)]),_:1}),t(u,null,{label:l(()=>[o(" 结构数据 ")]),default:l(()=>[o(" -- ")]),_:1}),t(u,null,{label:l(()=>[o(" 日志内容 ")]),default:l(()=>[o(" "+m(n.lcon),1)]),_:1}),t(u,{span:2},{label:l(()=>[o(" 日志原文 ")]),default:l(()=>[o(" "+m(n.logtype?n.ltext:n.ltext+n.lcon),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),We=pe(Ae,[["__scopeId","data-v-866c4a5f"]]);export{We as default};
