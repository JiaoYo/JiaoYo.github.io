import{_ as se}from"./table-column-setting.vue_vue_type_script_setup_true_lang-ByxhZwKB.js";import{_ as re}from"./round-delete-C5ACT_Yd.js";import{_ as ie}from"./round-add-CiHgedV9.js";import{d as O,aE as G,r as ce,n as L,a as ue,aG as Z,aC as de,q as V,c as F,o as T,w as t,f as e,Z as me,C as J,s as pe,y as M,h as n,x as Q,aD as W,N as A,B as k,g as N,t as S,$ as x,a0 as _e,bb as fe,bc as ge,bd as he,H as ve,A as be,Y as X,b2 as K,aS as ye,b as we,aT as R,aH as xe,aU as Ce,e as ke,be as E,bf as Ne,aM as De,aY as Te}from"./index-CwsogUdO.js";import{u as Se,a as ze}from"./table-DmynGf54.js";import{_ as ee}from"./Grid-EBnMWc0y.js";import{_ as te}from"./FormItemGridItem-CAH_tKOz.js";import{_ as Ue}from"./round-search-DFgnPdZ7.js";import{_ as je}from"./round-refresh-D85UEohG.js";import{N as $e}from"./DatePicker-GnHeDnw9.js";import{N as H}from"./Popconfirm-BcfCvBvw.js";const Be=O({name:"OperateDrawer",__name:"operate-drawer",props:G({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:G(["submitted"],["update:visible"]),setup(f,{emit:z}){const g=z,m=f,u=ce(r());function r(){return{id:0,connum:"",edbtime:void 0,execute:void 0}}async function D(){Object.assign(u,r()),m.operateType==="edit"&&m.rowData&&Object.assign(u,m.rowData)}const{formRef:U,validate:v,restoreValidation:b}=L(),j={connum:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},execute:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},edbtime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"}},C=ue(()=>({add:"新增合同变更",edit:"修改合同变更"})[m.operateType]),o=Z(f,"visible");de(o,()=>{o.value&&(D(),setTimeout(()=>{const c=document.querySelector(".n-scrollbar-content");c==null||c.scrollTo(0,0)},300),b())});function i(){o.value=!1}async function p(){var c;await v(),(c=window.$dialog)==null||c.info({title:"提示",content:"提交后即时执行,不可回滚是否继续?",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await y()}})}async function y(){var c,d;if(await v(),m.operateType==="edit"){const{data:w,error:_}=await fe([u]);_||(i(),g("submitted"),(c=window.$message)==null||c.success("修改成功"))}else{const{data:w,error:_}=await ge([{...u}]);_||(i(),g("submitted"),(d=window.$message)==null||d.success("添加成功"))}}return(c,d)=>{const w=te,_=ee,$=J,B=me,P=A,s=_e,a=V("no-space");return T(),F(s,{show:o.value,"onUpdate:show":d[2]||(d[2]=l=>o.value=l),title:C.value,preset:"card",class:"w-600px"},{footer:t(()=>[e(P,{justify:"end",size:16},{default:t(()=>[e(n(k),{onClick:i},{default:t(()=>[N(S(n(x)("common.cancel")),1)]),_:1}),e(n(k),{type:"primary",onClick:p},{default:t(()=>[N(S(n(x)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(B,{class:"pr-20px"},{default:t(()=>[e($,{ref_key:"formRef",ref:U,model:u,rules:j,"label-placement":"left","label-width":120},{default:t(()=>[e(_,{responsive:"screen","item-responsive":""},{default:t(()=>[e(w,{span:"24 m:24",label:"合同编号",path:"connum"},{default:t(()=>[M(e(n(Q),{value:u.connum,"onUpdate:value":d[0]||(d[0]=l=>u.connum=l),placeholder:"请输入"},null,8,["value"]),[[a]])]),_:1}),m.operateType=="edit"?(T(),F(w,{key:0,span:"24 m:24",label:"执行状态",path:"execute"},{default:t(()=>[e(n(W),{filterable:"",options:[{label:"未执行",value:0},{label:"执行成功",value:1},{label:"未执失败",value:2}],clearable:"",value:u.execute,"onUpdate:value":d[1]||(d[1]=l=>u.execute=l)},null,8,["value"])]),_:1})):pe("",!0)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Pe=O({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:G(["reset","search"],["update:model"]),setup(f,{emit:z}){he();const g=z,{formRef:m,restoreValidation:u}=L(),r=Z(f,"model"),D={当日:()=>{const o=new Date().getTime();return[o,o]},本周:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*7,o]},上月:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*30,o]},近一年:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*365,o]},近三年:()=>{const o=new Date().getTime();return[o-24*60*60*1e3*365*3,o]}};function U(){r.value.fuzzy="",g("search")}async function v(){await u(),g("reset")}const b=ve(null);async function j(o,i){i?(r.value.startTime=String(K(0,i[0])),r.value.endTime=String(K(0,i[1]))):(r.value.startTime=null,r.value.endTime=null),g("search")}async function C(){g("search")}return(o,i)=>{const p=Q,y=te,c=W,d=$e,w=je,_=k,$=Ue,B=A,P=ee,s=J,a=X;return T(),F(a,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(s,{ref_key:"formRef",ref:m,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:be(C,["enter"])},{default:t(()=>[e(P,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(y,{span:"24 s:12 m:6",label:"名称",path:"fuzzy"},{default:t(()=>[e(p,{clearable:"",value:r.value.fuzzy,"onUpdate:value":i[0]||(i[0]=l=>r.value.fuzzy=l),placeholder:"请输入名称",onClear:U},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:4",label:"执行状态",path:"execute"},{default:t(()=>[e(c,{clearable:"",filterable:"",value:r.value.execute,"onUpdate:value":[i[1]||(i[1]=l=>r.value.execute=l),C],placeholder:"请选择执行状态",options:[{label:"未执行",value:0},{label:"执行成功",value:1},{label:"未执失败",value:2}]},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:t(()=>[e(d,{value:b.value,"onUpdate:value":i[2]||(i[2]=l=>b.value=l),type:"daterange",clearable:"",class:"w-100%",shortcuts:D,"onUpdate:formattedValue":j},null,8,["value"])]),_:1}),e(y,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(B,{class:"w-full"},{default:t(()=>[e(_,{onClick:v},{icon:t(()=>[e(w,{class:"text-icon"})]),default:t(()=>[N(" "+S(n(x)("common.reset")),1)]),_:1}),e(_,{type:"primary",ghost:"",onClick:C},{icon:t(()=>[e($,{class:"text-icon"})]),default:t(()=>[N(" "+S(n(x)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Me={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Y(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!Te(f)}const Ye=O({name:"manage_contractamendment",__name:"index",setup(f){const z=ye(),{columns:g,columnChecks:m,data:u,getData:r,loading:D,mobilePagination:U,searchParams:v}=Se({showTotal:!0,apiFn:Ne,apiParams:{page:1,pageSize:20,limit:20,execute:void 0,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"connum",title:"合同编号",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"execute",title:"执行状态",align:"center",width:120,render:s=>e(De,{type:s.execute==0?"warning":s.execute==1?"success":"error",round:!0},{default:()=>[s.execute==0?"未执行":s.execute==1?"执行成功":"执行失败"]})},{key:"edbtime",title:"执行时间",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:x("common.operate"),align:"center",width:140,fixed:"right",render:s=>{let a;return e("div",{class:"flex-center gap-8px"},[M(e(k,{type:"primary",ghost:!0,size:"small",onClick:()=>_(s.id)},Y(a=x("common.edit"))?a:{default:()=>[a]}),[[V("no-auth"),"project:Change:Contract:update"]]),e(H,{onPositiveClick:()=>w(s.id)},{default:()=>x("common.confirmDelete"),trigger:()=>{let l;return M(e(k,{type:"error",ghost:!0,size:"small"},Y(l=x("common.delete"))?l:{default:()=>[l]}),[[V("no-auth"),"project:Change:Contract:delete"]])}})])}}]}),{drawerVisible:b,operateType:j,editingData:C,handleAdd:o,handleEdit:i,checkedRowKeys:p,onBatchDeleted:y,onDeleted:c}=ze(u,r);async function d(){console.log(p.value),$(p.value.join(","),s=>{y()})}async function w(s){const{data:a,error:l}=await E(s);l||c()}function _(s){i(s)}async function $(s,a){const{data:l,error:q}=await E(s);if(!q)a&&a(l);else return!1}const B=s=>{r()},P=()=>{r()};return(s,a)=>{const l=A,q=ie,ae=re,ne=se,oe=xe,le=X,I=V("no-auth");return T(),we("div",Me,[e(Pe,{model:n(v),"onUpdate:model":a[0]||(a[0]=h=>R(v)?v.value=h:null),onReset:P,onSearch:n(r)},null,8,["model","onSearch"]),e(le,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(l,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>a[4]||(a[4]=[ke("div",null,"合同变更",-1)])),_:1,__:[4]})]),"header-extra":t(()=>[e(l,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[M((T(),F(n(k),{onClick:n(o),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(q,{class:"text-icon"})]),default:t(()=>[a[5]||(a[5]=N(" "+S("新增")))]),_:1,__:[5]},8,["onClick"])),[[I,"project:Change:Contract:insert"]]),e(n(H),{onPositiveClick:d},{trigger:t(()=>[M((T(),F(n(k),{size:"small",ghost:"",type:"error",disabled:n(p).length==0},{icon:t(()=>[e(ae,{class:Ce(["text-icon",{"animate-spin":n(D)}])},null,8,["class"])]),default:t(()=>[a[6]||(a[6]=N(" "+S("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[I,"project:Change:Contract:delete"]])]),default:t(()=>[a[7]||(a[7]=N(" 确定要删除选中的数据吗？ "))]),_:1,__:[7]}),e(ne,{columns:n(m),"onUpdate:columns":a[1]||(a[1]=h=>R(m)?m.value=h:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(oe,{"checked-row-keys":n(p),"onUpdate:checkedRowKeys":a[2]||(a[2]=h=>R(p)?p.value=h:null),columns:n(g),data:n(u),size:"small","flex-height":!n(z).isMobile,loading:n(D),remote:"","row-key":h=>h.id,pagination:n(U),class:"sm:h-full","onUpdate:filters":B},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Be,{visible:n(b),"onUpdate:visible":a[3]||(a[3]=h=>R(b)?b.value=h:null),onSubmitted:n(r),"operate-type":n(j),"row-data":n(C)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{Ye as default};
