import{_ as Te}from"./table-column-setting.vue_vue_type_script_setup_true_lang-B88JK01T.js";import{_ as ke}from"./round-refresh-BmORLM_E.js";import{o as E,e as pe,f as me,d as Z,n as W,j as R,p as se,r as ne,q as xe,s as Ce,a7 as ae,ac as De,b as Se,$ as M,y as H,c as G,w as t,g as e,h as q,t as B,i as a,z as Q,C as _e,A as Ue,aS as Ae,aT as $e,ag as ee,J as ie,au as Me,aB as ve,L as K,aC as fe,M as de,B as L,al as re,ar as ue,aj as oe,aW as qe,ah as ze,ai as Le,ae as Oe,aU as Ve,aQ as Be,v as Pe,aV as je,ab as X,am as te,an as Re,ao as Ee,ap as Fe,a2 as Ge}from"./index-CQx2Ff8S.js";import{_ as Ke}from"./round-add-BNL-L_pa.js";import{_ as Je}from"./round-search-LdwHnU1M.js";import{u as He,a as Qe}from"./table-DuoXvLRN.js";import{_ as ce}from"./FormItemGridItem-CAzxroJb.js";import{_ as Y,a as We}from"./Grid-Nz05qrRN.js";import{p as Xe}from"./gather-Cw1xDLGe.js";import{_ as Ye}from"./Tree-Dh0Ywqgx.js";import{y as Ze}from"./common-BDhfbtg6.js";import{N as et}from"./Popconfirm-Cyyoenj2.js";import{_ as tt}from"./InputGroupLabel-CjlVVQ7X.js";const lt={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},nt=me("path",{fill:"currentColor",d:"M11 13v3q0 .425.288.713T12 17t.713-.288T13 16v-3h3q.425 0 .713-.288T17 12t-.288-.712T16 11h-3V8q0-.425-.288-.712T12 7t-.712.288T11 8v3H8q-.425 0-.712.288T7 12t.288.713T8 13zm1 9q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1),at=[nt];function ot(C,P){return E(),pe("svg",lt,[...at])}const st={name:"material-symbols-add-circle-outline-rounded",render:ot},it=me("span",null,"批量新增：格式为（转发设备1-10）",-1),dt=Z({__name:"add_model",props:W({operateType:{},rowData:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:W(["submitted"],["update:visible"]),setup(C,{emit:P}){const v=R(!1),D=se(C,"visible"),U=P,c=C,n=ne(A());function A(){return{devName:"转发设备1",chlId:void 0,devCommAddr:"1",devPubAddr:"1",devValid:1,devDesc:"",reserve0:"",reserve1:""}}const s=ne({channelList:[]});async function w(){const{data:g,error:d}=await ue({type:1});d||(s.channelList=g)}async function O(){await w(),c.operateType==="edit"&&c.rowData?Object.assign(n,c.rowData):(Object.assign(n,A()),n.chlId=c.chlId||s.channelList[0].id)}const{formRef:I,validate:p,restoreValidation:r}=xe();Ce(),ae(()=>c.rowData,()=>{O()}),ae(D,()=>{D.value&&(c.operateType==="add"&&De(()=>{setTimeout(()=>{v.value=!0},200)}),O(),r())});const f=()=>{D.value=!1,v.value=!1},N=async()=>{var g;if(await p(),c.operateType==="add"){let d=[],_=n.devName;if(((g=n.devName)==null?void 0:g.indexOf("-"))!=-1){let j=Math.abs(_==null?void 0:_.substring(_.lastIndexOf("-")).replace(/[^0-9]/gi,"")),V=_.split(/-(?![^-]*-)/),o=_.substring(0,_.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],l=o.replace(/[^0]/g,""),i=o,z=V[0],x=z.substring(0,z.length-z.match(/(\d+)[^0-9]*$/)[1].length),J=j-o+1;for(let F=0;F<J;F++){let b=i++,u=JSON.parse(JSON.stringify(n));u.devName=parseInt(o)==0?l.length>0?String(b).length>=l.length?x+b:x+l.substring(0,l.length-String(b).length)+b:x+b:l.length>0?b>=10?x+l.substring(0,l.length-String(b).length+1)+b:x+l.substring(0,l.length)+b:x+b,u.devCommAddr=Number(n.devCommAddr)+F,d.push(u)}}else d=[n];const{data:k,error:$}=await Ae(d);$?console.log("error",$):(console.log("success",k),f(),U("submitted"))}else{const{data:d,error:_}=await $e([n]);_?console.log("error",_):(console.log("success",d),f(),U("submitted"))}},m={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},S={devName:m,chlId:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},devCommAddr:m,devPubAddr:m},h=Se(()=>({add:M("common.add"),edit:M("common.edit")})[c.operateType]);return(g,d)=>{const _=ee,k=ce,$=ie,j=Me,V=ve,o=K,l=fe,i=Y,z=de,x=L,J=K,F=re,b=H("no-space");return E(),G(F,{show:D.value,"onUpdate:show":d[6]||(d[6]=u=>D.value=u),title:h.value,preset:"card",class:"w-30%",onAfterLeave:f},{footer:t(()=>[e(J,{size:16,justify:"center"},{default:t(()=>[e(x,{onClick:f,class:"w-100px"},{default:t(()=>[q(B(a(M)("common.cancel")),1)]),_:1}),e(x,{type:"primary",class:"w-100px",onClick:N},{default:t(()=>[q(B(a(M)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(z,{ref_key:"formRef",ref:I,model:n,rules:S,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:Ue(N,["enter"])},{default:t(()=>[e(i,{responsive:"screen","item-responsive":""},{default:t(()=>[e(k,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(_,{filterable:"",placeholder:"请选择所属通道",value:n.chlId,"onUpdate:value":d[0]||(d[0]=u=>n.chlId=u),"label-field":"chlName","value-field":"id",options:s.channelList},null,8,["value","options"])]),_:1}),e(k,{span:"24 m:24",label:"设备名称",path:"devName"},{default:t(()=>[e(j,{show:v.value,placement:"right-start"},{trigger:t(()=>[Q(e($,{clearable:"",value:n.devName,"onUpdate:value":d[1]||(d[1]=u=>n.devName=u),maxlength:"64",placeholder:"请输入设备名称"},null,8,["value"]),[[b]])]),default:t(()=>[it]),_:1},8,["show"])]),_:1}),e(k,{span:"24 m:24",label:"通讯地址",path:"devCommAddr"},{default:t(()=>[e($,{clearable:"",value:n.devCommAddr,"onUpdate:value":d[2]||(d[2]=u=>n.devCommAddr=u),maxlength:"50",placeholder:"请输入通讯地址"},null,8,["value"])]),_:1}),e(k,{span:"24 m:24",label:"公共地址",path:"devPubAddr"},{default:t(()=>[e($,{clearable:"",value:n.devPubAddr,"onUpdate:value":d[3]||(d[3]=u=>n.devPubAddr=u),placeholder:"请输入公共地址"},null,8,["value"])]),_:1}),c.operateType=="edit"?(E(),G(k,{key:0,span:"24 m:24",label:"设备有效性",path:"devValid"},{default:t(()=>[e(l,{value:n.devValid,"onUpdate:value":d[4]||(d[4]=u=>n.devValid=u),name:"radiogroup"},{default:t(()=>[e(o,null,{default:t(()=>[e(V,{label:"是",value:1}),e(V,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):_e("",!0),e(k,{span:"24 m:24",label:"设备描述",path:"devDesc"},{default:t(()=>[e($,{clearable:"",value:n.devDesc,"onUpdate:value":d[5]||(d[5]=u=>n.devDesc=u),maxlength:"64",placeholder:"请输入设备描述",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),rt=Z({__name:"batch_addModel",props:W({chlList:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:W(["submitted"],["update:visible"]),setup(C,{emit:P}){const v=se(C,"visible"),D=C,U=P,c=R([]),n=async()=>{const{data:p,error:r}=await ue({type:0});r||(c.value=p.map(f=>{var N;return{label:f.chlName,key:f.id+"10000",children:(N=f.devicePojoList)==null?void 0:N.map(m=>({label:m.devName,key:m.id}))}}))};ae(()=>v.value,async p=>{p&&(n(),s.value={devIds:[],chlId:void 0,pre:void 0,valid:1,tagType:void 0,enbleType:!0},s.value.chlId=D.chlId)});const A=R(null),s=R({devIds:[],chlId:void 0,pre:void 0,valid:1,tagType:void 0,enbleType:!0}),w=async()=>{var N,m;const p=[];c.value.forEach(T=>{p.push(T.key)}),p.forEach(T=>{var S,h,g;(S=s.value.devIds)!=null&&S.includes(T)&&((g=s.value.devIds)==null||g.splice((h=s.value.devIds)==null?void 0:h.indexOf(T),1))}),s.value.enbleType&&(s.value.tagType="-1");const{data:r,error:f}=await qe({...s.value,devIds:(N=s.value.devIds)==null?void 0:N.join(",")});f||((m=window.$message)==null||m.success("新增成功"),v.value=!1,U("submitted"))},O={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},I={chlId:O,tagType:O};return(p,r)=>{const f=Ye,N=ze,m=We,T=ee,S=ce,h=ie,g=ve,d=K,_=fe,k=Y,$=de,j=Y,V=L,o=K,l=re;return E(),G(l,{show:v.value,"onUpdate:show":r[7]||(r[7]=i=>v.value=i),title:"批量新增",preset:"card",class:"w-40%"},{footer:t(()=>[e(o,{size:16,justify:"center"},{default:t(()=>[e(V,{onClick:r[6]||(r[6]=i=>v.value=!1),class:"w-100px"},{default:t(()=>[q(B(p.$t("common.cancel")),1)]),_:1}),e(V,{type:"primary",class:"w-100px",onClick:w},{default:t(()=>[q(B(p.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(j,{"x-gap":"12"},{default:t(()=>[e(m,{span:8},{default:t(()=>[e(N,{style:{"max-height":"220px"}},{default:t(()=>[e(f,{"block-line":"",data:c.value,"checked-keys":s.value.devIds,"onUpdate:checkedKeys":r[0]||(r[0]=i=>s.value.devIds=i),"expand-on-click":"","default-expand-all":!0,checkable:"",cascade:""},null,8,["data","checked-keys"])]),_:1})]),_:1}),e(m,{span:16},{default:t(()=>[e($,{ref_key:"formRef",ref:A,"label-width":140,"label-placement":"left",model:s.value,rules:I},{default:t(()=>[e(k,{responsive:"screen","item-responsive":""},{default:t(()=>[e(S,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(T,{filterable:"",placeholder:"请选择所属通道",value:s.value.chlId,"onUpdate:value":r[1]||(r[1]=i=>s.value.chlId=i),"label-field":"chlName","value-field":"id",options:D.chlList},null,8,["value","options"])]),_:1}),e(S,{span:"24 m:24",label:"转发设备前缀",path:"pre"},{default:t(()=>[e(h,{value:s.value.pre,"onUpdate:value":r[2]||(r[2]=i=>s.value.pre=i),style:{width:"100%"},placeholder:"请输入转发设备前缀(可空)"},null,8,["value"])]),_:1}),e(S,{span:"24 m:24",label:"是否匹配测点类型",path:"enbleType"},{default:t(()=>[e(_,{value:s.value.enbleType,"onUpdate:value":r[3]||(r[3]=i=>s.value.enbleType=i),name:"radiogroup"},{default:t(()=>[e(d,null,{default:t(()=>[e(g,{label:"是",value:!0}),e(g,{label:"否",value:!1})]),_:1})]),_:1},8,["value"])]),_:1}),s.value.enbleType==!1?(E(),G(S,{key:0,span:"24 m:24",label:"测点类型",path:"tagType"},{default:t(()=>[e(T,{filterable:"",placeholder:"请选择测点类型",value:s.value.tagType,"onUpdate:value":r[4]||(r[4]=i=>s.value.tagType=i),options:a(oe)(a(Xe))},null,8,["value","options"])]),_:1})):_e("",!0),e(S,{span:"24 m:24",label:"设备有效性",path:"valid"},{default:t(()=>[e(_,{value:s.value.valid,"onUpdate:value":r[5]||(r[5]=i=>s.value.valid=i),name:"radiogroup"},{default:t(()=>[e(d,null,{default:t(()=>[e(g,{label:"是",value:1}),e(g,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1},8,["show"])}}}),ut=Z({__name:"move_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:W(["submitted"],["update:visible"]),setup(C,{emit:P}){const D=Le({0:"采集104tcp",1:"采集104udp"}),U=se(C,"visible"),c=R(null),n=R({targetDevice:void 0,EquipmentMerged:void 0}),A=()=>{},w={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}};return(O,I)=>{const p=ee,r=ce,f=Y,N=de,m=L,T=K,S=re;return E(),G(S,{show:U.value,"onUpdate:show":I[3]||(I[3]=h=>U.value=h),title:"设备移动至通道",preset:"card",class:"w-40%"},{footer:t(()=>[e(T,{size:16,justify:"center"},{default:t(()=>[e(m,{onClick:I[2]||(I[2]=h=>U.value=!1),class:"w-100px"},{default:t(()=>[q(B(O.$t("common.cancel")),1)]),_:1}),e(m,{type:"primary",class:"w-100px",onClick:A},{default:t(()=>[q(B(O.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(N,{ref_key:"formRef",ref:c,"label-width":120,"label-placement":"left",model:n.value,rules:w},{default:t(()=>[e(f,{responsive:"screen","item-responsive":""},{default:t(()=>[e(r,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:t(()=>[e(p,{filterable:"",clearable:"",placeholder:"请选择通道",value:n.value.targetDevice,"onUpdate:value":I[0]||(I[0]=h=>n.value.targetDevice=h),options:a(oe)(a(D))},null,8,["value","options"])]),_:1}),e(r,{span:"24 m:12",label:"待移动设备",path:"EquipmentMerged"},{default:t(()=>[e(p,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.EquipmentMerged,"onUpdate:value":I[1]||(I[1]=h=>n.value.EquipmentMerged=h),options:a(oe)(a(D))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),ct={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function le(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!Re(C)}const kt=Z({name:"configsetting_forwardingservice_forwardingdevicemanagement",__name:"index",setup(C){const P=Oe(),v=ne({channelList:[],chlIdAndNameMap:{}}),{columns:D,columnChecks:U,data:c,getData:n,loading:A,mobilePagination:s,searchParams:w,resetSearchParams:O}=He({apiFn:Ve,apiParams:{page:1,pageSize:20,limit:20,type:1,chlId:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"设备ID",align:"center",width:60},{key:"devName",title:"设备名称",align:"center",width:100},{key:"chlId",title:"所属通道",align:"center",width:140,render:o=>e("span",null,[v.chlIdAndNameMap[o.chlId]])},{key:"devDesc",title:"设备描述",align:"center",width:140,render:o=>e("span",null,[o.devDesc?o.devDesc:"无"])},{key:"devCommAddr",title:"设备通信地址",align:"center",width:140},{key:"devPubAddr",title:"设备公共地址",align:"center",width:140},{key:"devValid",title:"有效性",align:"center",width:140,render:o=>{let l;return e(Be,{type:o.devValid==0?"error":"success"},le(l=M(Ze[o.devValid]))?l:{default:()=>[l]})}},{key:"operate",title:M("common.operate"),align:"center",width:240,fixed:"right",render:o=>{let l;return e("div",{class:"flex-center gap-8px"},[e(L,{type:"primary",ghost:!0,size:"small",onClick:()=>V(o)},{default:()=>["转发测点管理"]}),Q(e(L,{type:"primary",ghost:!0,size:"small",onClick:()=>d(o.id)},le(l=M("common.edit"))?l:{default:()=>[l]}),[[H("no-auth"),"device:update"]]),Q(e(et,{onPositiveClick:()=>g(o.id)},{default:()=>M("common.confirmDelete"),trigger:()=>{let i;return e(L,{type:"error",ghost:!0,size:"small"},le(i=M("common.delete"))?i:{default:()=>[i]})}}),[[H("no-auth"),"device:delete"]])])}}]});async function I(){var i;const{data:o,error:l}=await ue({type:1});if(!l){if(o.length==0)return(i=window.$message)==null?void 0:i.warning("暂无转发通道，请先添加通道");v.channelList=o,o.forEach(x=>{v.chlIdAndNameMap[x.id]=x.chlName});const z=P.currentRoute.value.query.channelId;z&&(w.chlId=Number(z)),n()}}Pe(()=>{I()});const{drawerVisible:p,operateType:r,editingData:f,handleAdd:N,handleEdit:m,checkedRowKeys:T,onBatchDeleted:S,onDeleted:h}=Qe(c,n),g=async o=>{const{data:l,error:i}=await je({ids:o});i||h()},d=o=>{m(o)},_=o=>{w.chlId=o,n()},k=R(!1),$=()=>{k.value=!0},j=R(!1),V=o=>{P.push({path:"/configsetting/forwardingservice/forwardingpointmanagement",query:{channelId:o.chlId,deviceId:o.id}})};return(o,l)=>{const i=tt,z=ee,x=ie,J=Je,F=Ee,b=K,u=Ke,ge=st,he=ke,be=Te,ye=Fe,we=Ge,Ie=H("no-space"),Ne=H("no-auth");return E(),pe("div",ct,[e(we,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(b,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(F,null,{default:t(()=>[e(i,null,{default:t(()=>[q("所属通道")]),_:1}),e(z,{filterable:"",clearable:"",placeholder:"请选择通道",value:a(w).chlId,"onUpdate:value":l[0]||(l[0]=y=>a(w).chlId=y),"label-field":"chlName","value-field":"id",options:v.channelList,onUpdateValue:_},null,8,["value","options"]),e(i,null,{default:t(()=>[q("设备名称")]),_:1}),Q(e(x,{clearable:"",value:a(w).fuzzy,"onUpdate:value":l[1]||(l[1]=y=>a(w).fuzzy=y),placeholder:"请输入设备名称",style:{width:"100%"}},null,8,["value"]),[[Ie]]),e(a(L),{type:"primary",ghost:"",onClick:a(n)},{icon:t(()=>[e(J,{class:X(["text-icon",{"animate-spin":a(A)}])},null,8,["class"])]),default:t(()=>[q(" "+B(a(M)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":t(()=>[e(b,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[Q((E(),G(a(L),{onClick:a(N),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(u,{class:X(["text-icon",{"animate-spin":a(A)}])},null,8,["class"])]),default:t(()=>[q(" "+B(a(M)("common.add")),1)]),_:1},8,["onClick"])),[[Ne,"device:insert"]]),e(a(L),{onClick:$,size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(ge,{class:X(["text-icon",{"animate-spin":a(A)}])},null,8,["class"])]),default:t(()=>[q(" "+B("批量新增"))]),_:1}),e(a(L),{onClick:a(n),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(he,{class:X(["text-icon",{"animate-spin":a(A)}])},null,8,["class"])]),_:1},8,["onClick"]),e(be,{columns:a(U),"onUpdate:columns":l[2]||(l[2]=y=>te(U)?U.value=y:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ye,{"checked-row-keys":a(T),"onUpdate:checkedRowKeys":l[3]||(l[3]=y=>te(T)?T.value=y:null),columns:a(D),data:a(c),size:"small",loading:a(A),remote:"","row-key":y=>y.id,pagination:a(s),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(dt,{visible:a(p),"onUpdate:visible":l[4]||(l[4]=y=>te(p)?p.value=y:null),onSubmitted:a(n),"operate-type":a(r),"row-data":a(f),chlId:a(w).chlId},null,8,["visible","onSubmitted","operate-type","row-data","chlId"]),e(rt,{visible:k.value,"onUpdate:visible":l[5]||(l[5]=y=>k.value=y),chlList:v.channelList,chlId:a(w).chlId,onSubmitted:a(n)},null,8,["visible","chlList","chlId","onSubmitted"]),e(ut,{visible:j.value,"onUpdate:visible":l[6]||(l[6]=y=>j.value=y)},null,8,["visible"])]),_:1})])}}});export{kt as default};
