import{_ as Ne}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DCcFtEoA.js";import{d as X,q as J,s as re,v as ie,x as De,b as Ue,r as te,j as Q,y as le,K,o as k,c as x,w as n,g as a,h as _,t as L,i as o,$ as C,L as B,Z as H,N as O,M as de,az as ce,bd as Se,A as ue,a2 as pe,ao as xe,aq as ze,E as W,ap as Te,D as me,B as Z,F as Ae,ad as fe,a4 as Re,a$ as ne,e as $e,ag as G,ah as Fe,ai as Pe}from"./index-ByfxsQvj.js";import{u as Ve,a as Me}from"./table-Ca-5bYro.js";import{h as Oe,k as je,l as _e,m as qe,n as Be,o as Ee,p as Ie}from"./Collection-KAaQvKYa.js";import{C as Ge,c as ve,d as Ke,e as Le}from"./collection-Cbj-Z2Uh.js";import{r as He}from"./asset-BfC2BO85.js";import{u as We}from"./usePageData-lPm5H_26.js";import{_ as ge}from"./FormItemGridItem-Dtr_7n7z.js";import{_ as Ze}from"./Cascader-CoHr4l42.js";import{_ as be}from"./Grid-B9K_tFX2.js";import{_ as Je}from"./round-search-U_wZ0GRt.js";import{_ as Qe}from"./round-refresh-BRVSTvae.js";import{_ as Xe}from"./lodash-21GmhknM.js";import{_ as Ye}from"./DatePicker-ChOIwL9T.js";import{h as oe}from"./permission-DpUBsxJs.js";import{_ as ea}from"./Popconfirm-Bx1fZnQD.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-frQqLk93.js";import"./setting-outlined-C6sNL0co.js";import"./export-CaaNVRvS.js";import"./refresh-DDT70CE0.js";import"./round-delete-BsuQe4MI.js";import"./round-plus--T3dOesv.js";import"./Upload-BPNrVbAn.js";import"./Progress-B01mUdYA.js";import"./TimePicker-Bw31iYnN.js";import"./defineProperty-D9xlJP3p.js";const aa=X({name:"CollectorModal",__name:"collector_modal",props:J({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(w,{emit:j}){const p=w,N=j,h=re(w,"visible"),{formRef:y,validate:d,restoreValidation:z}=ie(),{createConfirmPwdRule:v,defaultRequiredRule:D,patternRules:E}=De(),q=Ue(()=>({add:"新增采集器",edit:"编辑采集器"})[p.operateType]),l=te(U());function U(){return{id:void 0,cname:"",cencode:0,accmed:1,proser:void 0,caddr:"",logsoudev:void 0,filterpro:void 0,cdesc:"",proper:0,enable:0,ctime:void 0,rev:void 0,port:void 0,uname:void 0,pswd:void 0,fpath:void 0}}const F={cname:D,caddr:[{required:!0,message:"请输入采集器地址",trigger:["blur","input"]},{required:!0,validator:ce,trigger:["blur","input"]}],rev:D,port:{required:!0,trigger:["blur","input"],validator:(t,e,s)=>e?Se(e)?!0:new Error("请输入在0-65535之间的数字"):new Error("请输入端口号")},uname:D,pswd:D,cencode:{type:"number",required:!0,trigger:["blur","change"],message:"请选择编码格式"},accmed:{type:"number",required:!0,trigger:["blur","change"],message:"请选择接入方式"},logsoudev:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源设备"}},{pageData:S,getData:f,nextPage:m}=We(Oe),g=async t=>{const e=t.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&S.data.length<S.total&&m()},b=Q(),P=async()=>{const{data:t,error:e}=await qe();b.value=t.map(s=>({...s,id:"-"+s.id,type:s.cname}))};function I(){P(),f(),Object.assign(l,U()),p.operateType==="edit"&&p.rowData&&(Object.assign(l,p.rowData),A.clickNums=1)}function T(){h.value=!1}const A=te({clickNums:0,isLoading:!1});async function V(){var t,e,s,i,c;if(await d(),p.operateType==="add"){const{data:u,error:R}=await je([l]);if(!R&&((t=window.$message)==null||t.success("采集器添加成功"),T(),N("submitted"),l.proper==0)){const $=await He([{aname:l.cname,aip:l.caddr,tid:36,cid:u}]);$.error&&((e=$.error.response)==null?void 0:e.data.msg)=="数据库中已存在该记录"&&((s=window.$message)==null||s.destroyAll(),(i=window.$message)==null||i.error("资产添加失败,请前往资产管理进行修改"))}}else{const{data:u,error:R}=await _e([l]);R||((c=window.$message)==null||c.success(C("common.updateSuccess")),T(),N("submitted"))}}const M=t=>{Object.assign(l,{logsoudev:void 0,rev:void 0,port:void 0,uname:void 0,pswd:void 0}),t==4&&(l.logsoudev=53),l.port=t==5?22:null};return le(h,()=>{h.value&&(I(),z())}),le(()=>l.caddr,()=>{A.clickNums=0}),(t,e)=>{const s=ue,i=ge,c=pe,u=Ze,R=xe,$=ze,Y=W,ee=Te,he=be,ye=me,ae=Z,we=W,ke=Ae,Ce=K("no-space");return k(),x(ke,{show:h.value,"onUpdate:show":e[13]||(e[13]=r=>h.value=r),title:q.value,preset:"card",class:"w-850px"},{footer:n(()=>[a(we,{size:16,justify:"end"},{default:n(()=>[a(ae,{onClick:T},{default:n(()=>[_(L(o(C)("common.cancel")),1)]),_:1}),a(ae,{type:"primary",onClick:V},{default:n(()=>[_(L(o(C)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(ye,{ref_key:"formRef",ref:y,model:l,rules:F,"label-placement":"left","label-width":120,onKeyup:de(V,["enter"])},{default:n(()=>[a(he,{responsive:"screen","item-responsive":"","x-gap":20},{default:n(()=>[a(i,{span:"24 s:12 m:12",label:"采集器名称",path:"cname"},{default:n(()=>[B(a(s,{value:l.cname,"onUpdate:value":e[0]||(e[0]=r=>l.cname=r),placeholder:"请输入采集器名称",clearable:""},null,8,["value"]),[[Ce]])]),_:1}),a(i,{span:"24 s:12 m:12",label:"编码格式",path:"cencode"},{default:n(()=>[a(c,{value:l.cencode,"onUpdate:value":e[1]||(e[1]=r=>l.cencode=r),placeholder:"请选择编码格式",filterable:"",clearable:"",options:o(H)(o(Ge))},null,8,["value","options"])]),_:1}),a(i,{span:"24 s:12 m:12",label:"接入方式",path:"accmed"},{default:n(()=>[a(c,{value:l.accmed,"onUpdate:value":[e[2]||(e[2]=r=>l.accmed=r),M],placeholder:"请选择接入方式",filterable:"",clearable:"",disabled:t.operateType==="edit",options:o(H)(o(ve))},null,8,["value","disabled","options"])]),_:1}),a(i,{span:"24 s:12 m:12",label:"采集地址",path:"caddr"},{default:n(()=>[a(s,{value:l.caddr,"onUpdate:value":e[3]||(e[3]=r=>l.caddr=r),placeholder:"请输入采集地址",clearable:""},null,8,["value"])]),_:1}),[0,1,7,8].includes(l.accmed)?(k(),x(i,{key:0,span:"24 s:12 m:12",label:"日志源设备",path:"logsoudev"},{default:n(()=>[a(u,{value:l.logsoudev,"onUpdate:value":e[4]||(e[4]=r=>l.logsoudev=r),placeholder:"请选择日志源设备",options:b.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"","show-path":!1},null,8,["value","options"])]),_:1})):O("",!0),a(i,{span:"24 s:12 m:12",label:"过滤策略",path:"filterpro"},{default:n(()=>[a(c,{clearable:"",filterable:"",value:l.filterpro,"onUpdate:value":e[5]||(e[5]=r=>l.filterpro=r),placeholder:"请选择过滤策略",options:o(S).data,"value-field":"id","label-field":"pname","reset-menu-on-options-change":!1,onScroll:g},null,8,["value","options"])]),_:1}),[3,7,8].includes(l.accmed)?(k(),x(i,{key:1,span:"24 s:12 m:12",label:l.accmed==3?"数据库名称":l.accmed==4?"域名":(l.accmed==7,"目录"),path:"rev"},{default:n(()=>[a(s,{value:l.rev,"onUpdate:value":e[6]||(e[6]=r=>l.rev=r),placeholder:"请输入",clearable:""},null,8,["value"])]),_:1},8,["label"])):O("",!0),[3,4,5,7,8].includes(l.accmed)?(k(),x(i,{key:2,span:"24 s:12 m:12",label:"端口",path:"port"},{default:n(()=>[a(R,{value:l.port,"onUpdate:value":e[7]||(e[7]=r=>l.port=r),placeholder:"请输入端口",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1})):O("",!0),[3,4,5,7,8,9].includes(l.accmed)?(k(),x(i,{key:3,span:"24 s:12 m:12",label:"用户名",path:"uname"},{default:n(()=>[a(s,{value:l.uname,"onUpdate:value":e[8]||(e[8]=r=>l.uname=r),placeholder:"请输入用户名",clearable:""},null,8,["value"])]),_:1})):O("",!0),[3,4,5,7,8,9].includes(l.accmed)?(k(),x(i,{key:4,span:"24 s:12 m:12",label:"密码",path:"pswd"},{default:n(()=>[a(s,{type:"password","show-password-on":"click",value:l.pswd,"onUpdate:value":e[9]||(e[9]=r=>l.pswd=r),placeholder:"请输入密码",clearable:""},null,8,["value"])]),_:1})):O("",!0),t.operateType=="add"?(k(),x(i,{key:5,span:"24 s:12 m:12",label:"生成资产",path:"proper"},{default:n(()=>[a(ee,{value:l.proper,"onUpdate:value":e[10]||(e[10]=r=>l.proper=r),name:"radiogroup"},{default:n(()=>[a(Y,null,{default:n(()=>[a($,{value:0},{default:n(()=>[_("是")]),_:1}),a($,{value:1},{default:n(()=>[_("否")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})):O("",!0),a(i,{span:"24 s:12 m:12",label:"是否启用",path:"enable"},{default:n(()=>[a(ee,{value:l.enable,"onUpdate:value":e[11]||(e[11]=r=>l.enable=r),name:"radiogroup",disabled:t.operateType=="edit"},{default:n(()=>[a(Y,null,{default:n(()=>[a($,{value:0},{default:n(()=>[_("是")]),_:1}),a($,{value:1},{default:n(()=>[_("否")]),_:1})]),_:1})]),_:1},8,["value","disabled"])]),_:1}),a(i,{span:"24 s:24 m:24",label:"描述",path:"cdesc"},{default:n(()=>[a(s,{type:"textarea",value:l.cdesc,"onUpdate:value":e[12]||(e[12]=r=>l.cdesc=r),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),ta=X({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search"],["update:model"]),setup(w,{emit:j}){const p=j,{formRef:N,restoreValidation:h}=ie(),y={caddr:[{validator:ce,trigger:["change","input"]}]},d=re(w,"model");Q(!1);const z=Q(null);async function v(f,m){f&&f.length>0?(d.value.startTime=f[0],d.value.endTime=f[1]):(d.value.startTime=void 0,d.value.endTime=void 0),F()}function D(f){d.value.enable=f,p("search")}function E(f){d.value.accmed=f,p("search")}function q(){d.value.fuzzy=void 0,p("search")}function l(){d.value.caddr=void 0,p("search")}async function U(){await h(),z.value=null,p("reset")}async function F(){p("search")}const S=Xe.throttle(F,1e3,{trailing:!1});return(f,m)=>{const g=ue,b=ge,P=pe,I=Ye,T=Qe,A=Z,V=Je,M=W,t=be,e=me,s=fe,i=K("no-space");return k(),x(s,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(e,{ref_key:"formRef",ref:N,model:d.value,"label-placement":"left",rules:y,"label-width":"100px",onKeyup:de(o(S),["enter"]),"show-require-mark":!1},{default:n(()=>[a(t,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[a(b,{span:"24 s:12 m:8 l:6",label:"采集器名称",path:"fuzzy","show-feedback":!1},{default:n(()=>[B(a(g,{clearable:"",value:d.value.fuzzy,"onUpdate:value":m[0]||(m[0]=c=>d.value.fuzzy=c),placeholder:"请输入采集器名称",onClear:q},null,8,["value"]),[[i]])]),_:1}),a(b,{span:"24 s:12 m:8 l:6",label:"采集地址",path:"caddr"},{default:n(()=>[B(a(g,{clearable:"",value:d.value.caddr,"onUpdate:value":m[1]||(m[1]=c=>d.value.caddr=c),onClear:l,placeholder:"请输入采集地址"},null,8,["value"]),[[i]])]),_:1}),a(b,{span:"24 s:12 m:8 l:6",label:"接入方式",path:"accmed","show-feedback":!1},{default:n(()=>[a(P,{clearable:"",filterable:"",value:d.value.accmed,"onUpdate:value":m[2]||(m[2]=c=>d.value.accmed=c),placeholder:"请选择接入方式",options:o(H)(o(ve)),onUpdateValue:E,style:{width:"100%"}},null,8,["value","options"])]),_:1}),a(b,{span:"24 s:12 m:8 l:6",label:"状态",path:"enable","show-feedback":!1},{default:n(()=>[a(P,{clearable:"",filterable:"",value:d.value.enable,"onUpdate:value":m[3]||(m[3]=c=>d.value.enable=c),placeholder:"请选择状态",options:o(H)(o(Ke)),onUpdateValue:D,style:{width:"100%"}},null,8,["value","options"])]),_:1}),a(b,{span:"24 s:16 m:16 l:8",label:"创建时间",path:"enable","show-feedback":!1},{default:n(()=>[a(I,{value:z.value,"onUpdate:value":m[4]||(m[4]=c=>z.value=c),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":v},null,8,["value"])]),_:1}),a(b,{span:"24 s:8 m:8 l:6","show-feedback":!1},{default:n(()=>[a(M,{class:"w-full",align:"center"},{default:n(()=>[a(A,{onClick:U},{icon:n(()=>[a(T,{class:"text-icon"})]),default:n(()=>[_(" "+L(o(C)("common.reset")),1)]),_:1}),a(A,{type:"primary",ghost:"",onClick:o(S)},{icon:n(()=>[a(V,{class:"text-icon"})]),default:n(()=>[_(" "+L(o(C)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),la={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function se(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!Fe(w)}const Ta=X({name:"collectionmanagement_collector",__name:"index",setup(w){const j=Re(),{columns:p,columnChecks:N,data:h,getData:y,loading:d,mobilePagination:z,searchParams:v,resetSearchParams:D}=Ve({apiFn:Be,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,caddr:null,enable:null,accmed:null,startTime:null,endTime:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"cname",title:"采集器名称",align:"center",width:200},{key:"caddr",title:"采集地址",align:"center",width:200},{key:"accmed",title:"接入方式",align:"center",width:160,render:t=>{const e=Le;return a("span",null,[_(" "),e[t.accmed]])}},{key:"pname",title:"过滤策略",align:"center",width:160},{key:"type",title:"日志源设备",align:"center",width:200},{key:"ctime",title:"创建时间",align:"center",width:200},{key:"enable",title:"状态",align:"center",width:160,render:t=>a(W,{justify:"center"},{default:()=>[t.accmed==4?a(ne,{value:t.enable,"onUpdate:value":[e=>t.enable=e,()=>q(t)],checkedValue:0,uncheckedValue:1},{checked:()=>a("span",null,[_("启用")]),unchecked:()=>a("span",null,[_("禁用")])}):a(ne,{value:t.enable,"onUpdate:value":[e=>t.enable=e,()=>l(t)],checkedValue:0,uncheckedValue:1},{checked:()=>a("span",null,[_("启用")]),unchecked:()=>a("span",null,[_("禁用")])})]})},{key:"operate",title:C("common.operate"),align:"center",width:130,fixed:"right",render:t=>{let e;return a("div",{class:"flex-center gap-8px"},[B(a(Z,{type:"primary",ghost:!0,size:"small",onClick:()=>V(t.id)},se(e=C("common.edit"))?e:{default:()=>[e]}),[[K("no-auth"),"sys.collection.mengement.update"]]),a(ea,{onPositiveClick:()=>A(t.id)},{default:()=>C("common.confirmDelete"),trigger:()=>{let s;return B(a(Z,{type:"error",ghost:!0,size:"small"},se(s=C("common.delete"))?s:{default:()=>[s]}),[[K("no-auth"),"sys.collection.mengement.delete"]])}})])}}]}),E=()=>{v.caddr=v.caddr==""?void 0:v.caddr,v.fuzzy=v.fuzzy==""?void 0:v.fuzzy,y()},q=async t=>{var s;const e={id:t.id,enable:t.enable,ip:t.enable==1?t.caddr:void 0};try{const{data:i,error:c}=await Ee(e);c||((s=window.$message)==null||s.success(t.enable==1?"禁用成功":"启用成功"),y())}catch{t.enable=t.enable==1?0:1}},l=async t=>{var e;try{const{data:s,error:i}=await _e([t]);i||((e=window.$message)==null||e.success(t.enable==1?"禁用成功":"启用成功"),y())}catch{t.enable=t.enable==1?0:1}},{drawerVisible:U,operateType:F,editingData:S,handleAdd:f,handleEdit:m,checkedRowKeys:g,onBatchDeleted:b,onDeleted:P,closeDrawer:I}=Me(h,y);async function T(){console.log(g.value),M(g.value.join(","),t=>{b()})}function A(t){M(t,e=>{P()})}function V(t){m(t)}async function M(t,e){const s=await Ie(t,1);console.log("data",s),e&&e(s)}return(t,e)=>{const s=Ne,i=Pe,c=fe;return k(),$e("div",la,[a(ta,{model:o(v),"onUpdate:model":e[0]||(e[0]=u=>G(v)?v.value=u:null),onReset:o(D),onSearch:E},null,8,["model","onReset"]),a(c,{title:"采集器管理",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":n(()=>[a(s,{columns:o(N),"onUpdate:columns":e[1]||(e[1]=u=>G(N)?N.value=u:null),"disabled-delete":o(g).length===0,"is-view-add-button":o(oe)("sys.collection.mengement.insert"),"is-view-delete-button":o(oe)("sys.collection.mengement.delete"),loading:o(d),onAdd:o(f),onDelete:T,onRefresh:o(y)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:n(()=>[a(i,{"checked-row-keys":o(g),"onUpdate:checkedRowKeys":e[2]||(e[2]=u=>G(g)?g.value=u:null),columns:o(p),data:o(h),size:"small","flex-height":!o(j).isMobile,"scroll-x":o(p).reduce((u,R)=>u+R.width,0),loading:o(d),remote:"","row-key":u=>u.id,pagination:o(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),a(aa,{visible:o(U),"onUpdate:visible":e[3]||(e[3]=u=>G(U)?U.value=u:null),"operate-type":o(F),"row-data":o(S),onSubmitted:o(y)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Ta as default};
