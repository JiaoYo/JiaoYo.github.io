import{cD as p,d as A,au as P,v as E,s as F,a as J,av as H,bu as Z,Z as K,c as v,o as _,w as i,f as l,G as Q,z as C,A as W,h as d,aw as X,e as Y,t as w,C as b,N as ee,B as z,g as N,$ as S,ax as te,c6 as ae,a0 as oe}from"./index-BvFB2cuj.js";import{u as re}from"./usePageData-CTXHmZzP.js";import{v as le}from"./v4-FuVw324d.js";function ge(a){return p({url:"/projectDailyReport/getPage.do",method:"get",params:a})}function se(a){return p({url:"/projectDailyReport/insert.do",method:"post",data:a})}function ne(a){return p({url:"/projectDailyReport/getIdByUuid.do",method:"get",params:a})}function ie(a){return p({url:"/projectDailyReport/update.do",method:"put",data:a})}function ye(a){return p({url:"/projectDailyReport/delete.do",method:"delete",params:{arrIds:a}})}function de(a){return p({url:"/projectDaily/insert.do",method:"post",data:a})}function he(a){return p({url:"/projectComment/getPage.do",method:"get",params:a})}function ve(a){return p({url:"/projectComment/insert.do",method:"post",data:a})}function _e(a){return p({url:"/projectComment/delete.do",method:"delete",params:{arrIds:a}})}const we=A({name:"OperateDrawer",__name:"operate-drawer",props:P({operateType:{},rowData:{},pid:{},pname:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:P(["submitted"],["update:visible"]),setup(a,{emit:L}){const D=L,{pageData:u,getData:j,nextPage:U}=re(ae),B=async o=>{const t=o.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&u.data.length<u.total&&(await U(),await oe(),setTimeout(()=>{t.scrollTop=n}))},s=a,e=E(k());function k(){return{id:"",proname:"",notes:"",problem:"",solutions:"",feedback:"",summarize:"",pids:[]}}const R={notes:{required:!0,message:"请输入",trigger:"blur"}};async function M(){if(await j({fuzzy:s.pname,page:1}),Object.assign(e,k()),s.operateType==="add"&&(console.log(s.pid),s.pid&&(u.data.forEach(o=>{o.id==s.pid&&(o.disabled=!0)}),e.pids.push(s.pid))),s.operateType==="edit"&&s.rowData){Object.assign(e,s.rowData);const o=JSON.parse(s.rowData.context);e.proname=o.proname,e.notes=o.notes,e.problem=o.problem,e.solutions=o.solutions,e.feedback=o.feedback,e.summarize=o.summarize}}const{formRef:O,validate:G,restoreValidation:V}=F(),I=()=>{j({page:1})},$=J(()=>({add:"新增项目日报",edit:"修改项目日报"})[s.operateType]),c=H(a,"visible"),y=()=>{c.value=!1},q=Z.debounce(async()=>{var o,t;if(await G(),s.operateType==="edit"){const n=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:g,error:m}=await ie([{context:n,id:e.id}]);m||((o=window.$message)==null||o.success("修改成功"),D("submitted"),y())}else{const n=le(),g=u.data.filter(f=>e.pids.includes(f.id)).map(f=>f.proname);e.proname=g.join(",");const m=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:x,error:r}=await se([{context:m,uuid:n}]);if(!r){const{data:f,error:pe}=await ne({uuid:n});if(e.pids.length>0){let T=e.pids.map(h=>({pid:h}));T.forEach(h=>{h.did=f});const{data:ue,error:ce}=await de(T)}(t=window.$message)==null||t.success("添加成功"),D("submitted"),y()}}},1e3,{leading:!0,trailing:!1});return K(c,()=>{c.value&&(M(),setTimeout(()=>{const o=document.querySelector(".n-scrollbar-content");o==null||o.scrollTo(0,0)},300),V())}),(o,t)=>{const n=W,g=Q,m=ee,x=te;return _(),v(x,{show:c.value,"onUpdate:show":t[6]||(t[6]=r=>c.value=r),title:$.value,preset:"card",class:"w-570px"},{footer:i(()=>[l(m,{justify:"end"},{default:i(()=>[l(d(z),{size:"small",class:"mt-16px",onClick:y},{default:i(()=>[N(w(d(S)("common.cancel")),1)]),_:1}),l(d(z),{type:"primary",size:"small",class:"mt-16px",onClick:d(q)},{default:i(()=>[N(w(d(S)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:i(()=>[l(g,{ref_key:"formRef",ref:O,model:e,rules:R},{default:i(()=>[s.operateType==="add"?(_(),v(n,{key:0,label:"关联项目",path:"pids","label-placement":"left"},{default:i(()=>[l(d(X),{clearable:"",filterable:"",value:e.pids,"onUpdate:value":t[0]||(t[0]=r=>e.pids=r),placeholder:"请选择项目","label-field":"proname",multiple:"","value-field":"id",onClear:I,options:d(u).data,onScroll:B},null,8,["value","options"])]),_:1})):C("",!0),s.operateType==="edit"&&e.proname?(_(),v(n,{key:1,label:"项目名称",path:"proname","label-placement":"left"},{default:i(()=>[Y("span",null,w(e.proname),1)]),_:1})):C("",!0),l(n,{label:"当前工作内容及成果描述：",path:"notes"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",value:e.notes,"onUpdate:value":t[1]||(t[1]=r=>e.notes=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"遇到问题：",path:"problem"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.problem,"onUpdate:value":t[2]||(t[2]=r=>e.problem=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"解决措施：",path:"solutions"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.solutions,"onUpdate:value":t[3]||(t[3]=r=>e.solutions=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"建议意见反馈：",path:"feedback"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.feedback,"onUpdate:value":t[4]||(t[4]=r=>e.feedback=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"（总结）自己对一天工作的感受和体感：",path:"summarize"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.summarize,"onUpdate:value":t[5]||(t[5]=r=>e.summarize=r),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}});export{we as _,he as a,_e as b,ge as c,ye as d,ve as f};
