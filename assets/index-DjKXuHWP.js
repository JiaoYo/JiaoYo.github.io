import{_ as ee,a as ae,b as fe,c as _e,d as ve,e as ge,N as X,f as be}from"./round-search-CAXr2Mba.js";import{u as he,a as xe,_ as ye,b as we,c as ke,N as A}from"./table-BXdkXopy.js";import{d as te,S as Y,U as Ne,m as Ue,l as Ce,n as De,V as Z,W as $e,a as ze,$ as j,c as Te,o as le,w as l,f as a,C as ne,x as oe,X as se,z as ie,B as v,g as m,t as x,h as n,Y as Pe,Z as Ae,a0 as je,r as Se,b as Re,a1 as N,P as Be,a2 as H,a3 as Q,a4 as Fe,a5 as Me,a6 as We,a7 as Oe,a8 as Ie,a9 as y,E as Ee}from"./index-BAR0HjRB.js";const Le=te({__name:"AddModal",props:Y({operateType:{},rowData:{},Pagination:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(S,{emit:R}){const f=Ne(S,"visible"),_=[{label:"高",value:"高"},{label:"中",value:"中"},{label:"低",value:"低"},{label:"恢复",value:"1"}],g=R,i=S,t=Ue(k());function k(){return{objaddr:"",rawdata:"",faultcode:"",signaltype:"",adesc:"",alevel:null,influence:"",cause:"",measure:"",restorationcondition:""}}function C(){Object.assign(t,k()),i.operateType==="edit"&&i.rowData&&Object.assign(t,i.rowData)}const{formRef:B,validate:F,restoreValidation:M}=Ce();De(),Z(()=>i.rowData,()=>{C()}),Z(f,()=>{f.value&&(C(),M())});const c=()=>{f.value=!1},W=async()=>{var o;await F();const b=JSON.parse(JSON.stringify(t));if(b.alevel=b.alevel==1?1:b.alevel,i.operateType==="add"){const{data:p,error:d}=await Ae([b]);if(d)return}else{const{data:p,error:d}=await je([b]);if(d)return}(o=window.$message)==null||o.success(i.operateType==="add"?"添加成功":"修改成功"),c(),g("submitted")},O=$e.debounce(W,1e3,{leading:!0,trailing:!1}),I={faultcode:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]}},E=ze(()=>({add:j("common.add"),edit:j("common.edit")})[i.operateType]);return(b,o)=>{const p=oe,d=ae,L=se,G=ee,V=ne,D=v,q=ie,$=Pe;return le(),Te($,{show:f.value,"onUpdate:show":o[10]||(o[10]=e=>f.value=e),title:E.value,preset:"card",class:"w-60%"},{footer:l(()=>[a(q,{size:16,justify:"center"},{default:l(()=>[a(D,{onClick:c,class:"w-100px"},{default:l(()=>[m(x(n(j)("common.cancel")),1)]),_:1}),a(D,{type:"primary",class:"w-100px",onClick:n(O)},{default:l(()=>[m(x(n(j)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:l(()=>[a(V,{ref_key:"formRef",ref:B,model:t,rules:I,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:l(()=>[a(G,{responsive:"screen","item-responsive":""},{default:l(()=>[a(d,{span:"24 m:12",label:"寄存器地址",path:"objaddr"},{default:l(()=>[a(p,{clearable:"",value:t.objaddr,"onUpdate:value":o[0]||(o[0]=e=>t.objaddr=e),placeholder:"请输入寄存器地址",maxlength:"64"},null,8,["value"])]),_:1}),a(d,{span:"24 m:12",label:"原始数据",path:"rawdata"},{default:l(()=>[a(p,{clearable:"",value:t.rawdata,"onUpdate:value":o[1]||(o[1]=e=>t.rawdata=e),placeholder:"请输入原始数据",maxlength:"64"},null,8,["value"])]),_:1}),a(d,{span:"24 m:12",label:"故障代码",path:"faultcode"},{default:l(()=>[a(p,{clearable:"",value:t.faultcode,"onUpdate:value":o[2]||(o[2]=e=>t.faultcode=e),placeholder:"请输入故障代码",maxlength:"64"},null,8,["value"])]),_:1}),a(d,{span:"24 m:12",label:"信号类型",path:"signaltype"},{default:l(()=>[a(p,{clearable:"",value:t.signaltype,"onUpdate:value":o[3]||(o[3]=e=>t.signaltype=e),placeholder:"请输入信号类型",maxlength:"64"},null,8,["value"])]),_:1}),a(d,{span:"24 m:12",label:"中文描述",path:"adesc"},{default:l(()=>[a(p,{clearable:"",value:t.adesc,"onUpdate:value":o[4]||(o[4]=e=>t.adesc=e),placeholder:"请输入中文描述",maxlength:"64"},null,8,["value"])]),_:1}),a(d,{span:"24 m:12",label:"故障等级",path:"alevel"},{default:l(()=>[a(L,{value:t.alevel,"onUpdate:value":o[5]||(o[5]=e=>t.alevel=e),options:_,placeholder:"请选择故障等级"},null,8,["value"])]),_:1}),a(d,{span:"24 m:12",label:"预警影响",path:"influence"},{default:l(()=>[a(p,{clearable:"",value:t.influence,"onUpdate:value":o[6]||(o[6]=e=>t.influence=e),placeholder:"请输入预警影响",maxlength:"64"},null,8,["value"])]),_:1}),a(d,{span:"24 m:24",label:"故障原因",path:"cause"},{default:l(()=>[a(p,{type:"textarea",clearable:"",value:t.cause,"onUpdate:value":o[7]||(o[7]=e=>t.cause=e),placeholder:"请输入故障原因",maxlength:"64"},null,8,["value"])]),_:1}),a(d,{span:"24 m:24",label:"处理措施",path:"measure"},{default:l(()=>[a(p,{type:"textarea",clearable:"",value:t.measure,"onUpdate:value":o[8]||(o[8]=e=>t.measure=e),placeholder:"请输入处理措施",maxlength:"64"},null,8,["value"])]),_:1}),a(d,{span:"24 m:24",label:"恢复条件",path:"restorationcondition"},{default:l(()=>[a(p,{type:"textarea",clearable:"",value:t.restorationcondition,"onUpdate:value":o[9]||(o[9]=e=>t.restorationcondition=e),placeholder:"请输入恢复条件",maxlength:"64"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ve=te({name:"alarm",__name:"index",setup(S){const{columns:R,data:f,getData:_,loading:g,mobilePagination:i,searchParams:t}=he({apiFn:Ie,apiParams:{page:1,pageSize:20,limit:20,faultcode:void 0,describe:void 0,level:void 0,_t:new Date().getTime()},showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"rawdata",title:"原始数据",align:"center",width:160},{key:"faultcode",title:"故障代码",align:"center",width:160},{key:"signaltype",title:"信号类型",align:"center",width:160},{key:"adesc",title:"中文描述",align:"center",width:160},{key:"alevel",title:"故障等级",align:"center",ellipsis:{tooltip:!0},width:120,render(e){return y(A,{tooltipPlacement:"center",style:{maxWidth:"180px"}},{default:()=>e.alevel==1?"恢复":e.alevel,tooltip:()=>y("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.alevel==1?"恢复":e.alevel)})}},{key:"objaddr",title:"寄存器地址",align:"center",width:120},{key:"influence",title:"预警影响",align:"center",width:200},{key:"cause",title:"故障原因",align:"center",width:200,render(e){return y(A,{tooltipPlacement:"center",style:{maxWidth:"180px"}},{default:()=>e.cause||"",tooltip:()=>y("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.cause||"")})}},{key:"measure",title:"处理措施",align:"center",ellipsis:{tooltip:!0},width:200,render(e){return y(A,{tooltipPlacement:"center",style:{maxWidth:"180px"}},{default:()=>e.measure||"",tooltip:()=>y("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.measure||"")})}},{key:"restorationcondition",title:"恢复条件",align:"center",ellipsis:{tooltip:!0},width:200,render(e){return y(A,{tooltipPlacement:"center",style:{maxWidth:"180px"}},{default:()=>e.restorationcondition||"",tooltip:()=>y("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.restorationcondition||"")})}},{key:"operate",title:"操作",align:"center",width:200,fixed:"right",render:e=>a("div",{class:"flex-center gap-8px"},[a(v,{type:"primary",ghost:!0,size:"small",onClick:()=>p(e.id)},{default:()=>[m("编辑")]}),a(X,{onPositiveClick:()=>d(e.id)},{default:()=>"确定删除吗？",trigger:()=>a(v,{type:"error",ghost:!0,size:"small"},{default:()=>[m("删除")]})})])}]}),{drawerVisible:k,operateType:C,editingData:B,handleAdd:F,handleEdit:M,checkedRowKeys:c,onBatchDeleted:W,onDeleted:O}=xe(f,_),J=[{label:"高",value:"高"},{label:"中",value:"中"},{label:"低",value:"低"},{label:"恢复",value:"1"}],I=()=>{t.describe||(t.describe=void 0),t.faultcode=void 0,_()},E=()=>{t.faultcode||(t.faultcode=void 0),t.describe=void 0,_()},b=e=>{t.level=e,_()},o=Se(),p=e=>{M(e)},d=e=>{Q(e).then(()=>{f.value.length==1&&i.value.page&&i.value.page>1&&(i.value.page=i.value.page==1?1:i.value.page-1,t.page=i.value.page),O()})};async function L(){Q(c.value.join(",")).then(()=>{f.value.length==c.value.length&&i.value.page&&(i.value.page=i.value.page==1?1:i.value.page-1,t.page=i.value.page),W()})}const G=()=>{F()},V=()=>{t.faultcode=null,t.describe=null,t.level=null,_()},D=e=>{const s=e.file.file;Fe(s).then(()=>{var r;(r=window.$message)==null||r.success("导入成功"),_()}).catch(()=>{var r;(r=window.$message)==null||r.error("导入失败，请检查文件内容是否正确")})},q=e=>{var h,z,T,P,U;let r=((h=e.file.file)==null?void 0:h.size)/1024/1024<500;if(!(((z=e.file.file)==null?void 0:z.type)==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||((T=e.file.file)==null?void 0:T.type)==="application/vnd.ms-excel"))return(P=window.$message)==null||P.warning("只能上传xlsx文件"),!1;if(!r)return(U=window.$message)==null||U.warning("不能超过500mb"),!1},$=e=>{const s=new URLSearchParams;c.value.forEach(r=>s.append("ids",r)),Me({url:`${Oe}/kstarAlarm/exports.do`,method:"post",params:{ids:e=="data"?c.value.join(","):void 0},responseType:"blob",headers:{token:We()}}).then(async r=>{if(r.data){const w=window.URL.createObjectURL(new Blob([r.data])),h=document.createElement("a");h.href=w,h.setAttribute("download",(e=="template"?"告警导入模板":new Date().getTime())+".xls"),document.body.appendChild(h),h.click()}})};return(e,s)=>{const r=oe,w=ae,h=fe,z=ye,T=ee,P=ne,U=Be,de=_e,re=ge,ue=ve,K=ke,pe=be,ce=ie,me=we;return le(),Re("div",Ge,[a(U,{bordered:!1,size:"small"},{default:l(()=>[a(P,{ref_key:"formRef",ref:o,model:n(t),"label-placement":"left","show-feedback":!1},{default:l(()=>[a(T,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:l(()=>[a(w,{span:"24 s:24 m:20 l:5",label:"故障代码",path:"faultcode"},{default:l(()=>[a(r,{value:n(t).faultcode,"onUpdate:value":s[0]||(s[0]=u=>n(t).faultcode=u),clearable:"",onClear:I,placeholder:"请输入故障代码"},null,8,["value"])]),_:1}),a(w,{span:"24 s:24 m:20 l:5",label:"描述",path:"describe"},{default:l(()=>[a(r,{value:n(t).describe,"onUpdate:value":s[1]||(s[1]=u=>n(t).describe=u),clearable:"",onClear:E,placeholder:"请输入描述"},null,8,["value"])]),_:1}),a(w,{span:"24 s:24 m:20 l:5",label:"故障等级",path:"level"},{default:l(()=>[a(n(se),{options:J,value:n(t).level,"onUpdate:value":[s[2]||(s[2]=u=>n(t).level=u),b],clearable:"",placeholder:"请选择故障等级"},null,8,["value"])]),_:1}),a(w,{span:"24 s:24 m:20 l:6"},{default:l(()=>[a(n(v),{type:"primary",ghost:"",onClick:s[3]||(s[3]=u=>n(_)()),class:"mx-10px"},{icon:l(()=>[a(h,{class:N(["text-icon",{"animate-spin":n(g)}])},null,8,["class"])]),default:l(()=>[m(" "+x(e.$t("common.search")),1)]),_:1}),a(n(v),{onClick:V},{icon:l(()=>[a(z,{class:N(["text-icon",{"animate-spin":n(g)}])},null,8,["class"])]),default:l(()=>[m(" "+x(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(U,{title:" ",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[a(ce,{justify:"end"},{default:l(()=>[a(n(v),{onClick:G,size:"small",ghost:"",type:"primary"},{icon:l(()=>[a(de,{class:N(["text-icon",{"animate-spin":n(g)}])},null,8,["class"])]),default:l(()=>[m(" "+x(e.$t("common.add")),1)]),_:1}),a(ue,{onChange:D,onBeforeUpload:q,accept:".xls,.xlsx","file-list-style":{display:"none"},style:{width:"inherit!important"}},{default:l(()=>[a(n(v),{size:"small"},{icon:l(()=>[a(re,{class:N(["text-icon",{"animate-spin":n(g)}])},null,8,["class"])]),default:l(()=>[m(" "+x(e.$t("common.import")),1)]),_:1})]),_:1}),a(n(v),{onClick:s[4]||(s[4]=u=>$("template")),size:"small"},{icon:l(()=>[a(K,{class:N(["text-icon",{"animate-spin":n(g)}])},null,8,["class"])]),default:l(()=>[s[8]||(s[8]=m(" 下载模板 "))]),_:1,__:[8]}),a(n(v),{onClick:s[5]||(s[5]=u=>$("data")),size:"small",disabled:!n(c).length},{icon:l(()=>[a(K,{class:N(["text-icon",{"animate-spin":n(g)}])},null,8,["class"])]),default:l(()=>[m(" "+x(e.$t("common.export")),1)]),_:1},8,["disabled"]),a(n(X),{onPositiveClick:L},{trigger:l(()=>[a(n(v),{size:"small",ghost:"",type:"error",disabled:n(c).length===0},{icon:l(()=>[a(pe,{class:"text-icon"})]),default:l(()=>[m(" "+x(e.$t("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:l(()=>[m(" "+x(e.$t("common.confirmDelete")),1)]),_:1})]),_:1})]),default:l(()=>[a(me,{"checked-row-keys":n(c),"onUpdate:checkedRowKeys":s[6]||(s[6]=u=>H(c)?c.value=u:null),columns:n(R),data:n(f),size:"small",loading:n(g),remote:"","row-key":u=>u.id,pagination:n(f).length?n(i):n(i),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1}),a(Le,{visible:n(k),"onUpdate:visible":s[7]||(s[7]=u=>H(k)?k.value=u:null),onSubmitted:n(_),"operate-type":n(C),"row-data":n(B),Pagination:n(i)},null,8,["visible","onSubmitted","operate-type","row-data","Pagination"])])}}}),Xe=Ee(Ve,[["__scopeId","data-v-20ba50e8"]]);export{Xe as default};
