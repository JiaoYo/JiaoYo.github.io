import{_ as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-D4Qfwn7U.js";import{d as H,p as G,q as Q,s as ae,v as me,bZ as oe,ab as W,b as P,$ as r,r as fe,z as K,o as $,c as A,w as l,g as t,h as B,t as L,i as e,C as ne,A as U,aF as _e,b_ as he,b$ as le,c0 as ge,L as se,M as ve,ak as be,Q as re,B as V,P as Z,c1 as ye,c2 as ke,a6 as ie,e as X,ar as ce,a9 as Y,k as J,f as ee,c3 as we,aH as xe,c4 as Ne,b5 as Re,b8 as De,a0 as Ce,c5 as Me,c6 as Se,aI as F,aJ as $e,aL as Te}from"./index-QMZu1NUK.js";import{u as ze,a as Ie}from"./table-DuQzfScj.js";import{_ as de,l as Be}from"./lodash-DiExU-O1.js";import{_ as Le}from"./round-search-CWMHiiR7.js";import{_ as Ue}from"./round-refresh-DpOR-8Qx.js";import{_ as Ve}from"./FormItemGridItem-6rBTfJYi.js";import{_ as Oe}from"./Grid-CleiwL29.js";import{_ as je}from"./Tree-CqBH_pbD.js";import{N as Fe}from"./Popconfirm-W1i5OeHL.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-B7q2LaAj.js";import"./import-DEQt7OlO.js";import"./export-EKEmEA4p.js";import"./refresh-TUVHwbKB.js";import"./round-delete-skBswqYS.js";import"./round-plus-TKIKe_CT.js";import"./Upload-BF_ZvIZv.js";const Ke=H({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:G({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:G(["submitted"],["update:visible"]),setup(h,{emit:b}){const u=h,g=b,y=Q(h,"visible"),{formRef:k,validate:x,restoreValidation:T}=ae(),{defaultRequiredRule:v}=me();oe(),W(()=>u.rowData,()=>{});const N=P(()=>({add:r("page.manage.role.addRole"),edit:r("page.manage.role.editRole")})[u.operateType]),p=fe(R());function R(){return{name:"",remark:"",rtype:0,menuIdList:[]}}const C={name:v};P(()=>{var c;return((c=u.rowData)==null?void 0:c.id)||-1}),P(()=>u.operateType==="add"||u.operateType==="edit");async function z(){if(Object.assign(p,R()),u.operateType==="edit"&&u.rowData){const{data:c,error:i}=await le(u.rowData.id+"");Object.assign(p,c)}}function D(){y.value=!1}async function o(){var n,s;await x();const{data:c,error:i}=await ge(u.operateType==="edit"?(n=u.rowData)==null?void 0:n.id:null,p.name,p.menuIdList,p.remark,p.rtype);i||((s=window.$message)==null||s.success(r("common.updateSuccess")),D(),g("submitted"))}const m=de.debounce(o,1e3,{leading:!0,trailing:!1});return W(y,()=>{y.value&&(z(),T())}),(c,i)=>{const n=se,s=ve,f=be,M=re,a=V,S=Z,O=ye,E=ke,j=K("no-space");return $(),A(E,{show:y.value,"onUpdate:show":i[3]||(i[3]=d=>y.value=d),"display-directive":"show",width:360},{default:l(()=>[t(O,{title:N.value,"native-scrollbar":!1,closable:""},{footer:l(()=>[t(S,{size:16},{default:l(()=>[t(a,{onClick:D},{default:l(()=>[B(L(e(r)("common.cancel")),1)]),_:1}),t(a,{type:"primary",ghost:"",onClick:e(m)},{default:l(()=>[B(L(e(r)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:l(()=>[t(M,{ref_key:"formRef",ref:k,model:p,rules:C,onKeyup:ne(e(m),["enter"])},{default:l(()=>[t(s,{label:e(r)("page.manage.role.name"),path:"name"},{default:l(()=>[U(t(n,{value:p.name,"onUpdate:value":i[0]||(i[0]=d=>p.name=d),placeholder:e(r)("page.manage.role.form.name"),clearable:""},null,8,["value","placeholder"]),[[j]])]),_:1},8,["label"]),t(s,{label:e(r)("page.manage.role.remark"),path:"remark"},{default:l(()=>[U(t(n,{clearable:"",value:p.remark,"onUpdate:value":i[1]||(i[1]=d=>p.remark=d),placeholder:e(r)("page.manage.role.form.remark")},null,8,["value","placeholder"]),[[j]])]),_:1},8,["label"]),t(s,{label:e(r)("page.manage.role.type"),path:"rtype"},{default:l(()=>[t(f,{filterable:"",value:p.rtype,"onUpdate:value":i[2]||(i[2]=d=>p.rtype=d),disabled:u.operateType==="edit",placeholder:e(r)("page.manage.role.form.type"),options:e(_e)(e(he)),style:{width:"100%"}},null,8,["value","disabled","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model","onKeyup"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ae=H({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:G(["reset","search"],["update:model"]),setup(h,{emit:b}){const u=b,g=Q(h,"model"),{formRef:y,restoreValidation:k}=ae();function x(){g.value.name="",u("search")}async function T(){await k(),u("reset")}function v(){u("search")}return(N,p)=>{const R=se,C=Ve,z=Ue,D=V,o=Le,m=Z,c=Oe,i=re,n=ie,s=K("no-space");return $(),A(n,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[t(i,{model:g.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(v,["enter"])},{default:l(()=>[t(c,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:l(()=>[t(C,{span:"24 s:12 m:8 l:6",label:e(r)("page.manage.role.name"),path:"name"},{default:l(()=>[U(t(R,{clearable:"",value:g.value.name,"onUpdate:value":p[0]||(p[0]=f=>g.value.name=f),placeholder:e(r)("page.manage.role.form.name"),onClear:x},null,8,["value","placeholder"]),[[s]])]),_:1},8,["label"]),t(C,{span:"24 s:12 m:8 l:6"},{default:l(()=>[t(m,{class:"w-full"},{default:l(()=>[t(D,{onClick:T},{icon:l(()=>[t(z,{class:"text-icon"})]),default:l(()=>[B(" "+L(e(r)("common.reset")),1)]),_:1}),t(D,{type:"primary",ghost:"",onClick:v},{icon:l(()=>[t(o,{class:"text-icon"})]),default:l(()=>[B(" "+L(e(r)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ee={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Pe=ce('<g transform="rotate(-90 12 12)"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="20" stroke-dashoffset="20" d="M21 3V21"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="20;0"></animate></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M17 12H3.5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.2s" values="15;0"></animate></path><path stroke-dasharray="12" stroke-dashoffset="12" d="M3 12L10 19M3 12L10 5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="12;0"></animate></path></g></g>',1),Ge=[Pe];function He(h,b){return $(),X("svg",Ee,[...Ge])}const qe={name:"line-md-arrow-open-down",render:He},We={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Je=ce('<g transform="rotate(-90 12 12) translate(24 0) scale(-1 1)"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="20" stroke-dashoffset="20" d="M21 3V21"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="20;0"></animate></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M17 12H3.5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.2s" values="15;0"></animate></path><path stroke-dasharray="12" stroke-dashoffset="12" d="M3 12L10 19M3 12L10 5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="12;0"></animate></path></g></g>',1),Qe=[Je];function Ze(h,b){return $(),X("svg",We,[...Qe])}const Xe={name:"line-md-arrow-open-up",render:Ze},Ye={class:"flex"},et=H({name:"MenuAuthModal",__name:"menu-auth-modal",props:G({roleRow:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(h){const b=h,u=Q(h,"visible");function g(){u.value=!1}const y=P(()=>r("common.edit")+r("page.manage.role.menuAuth")),k=Y([]);function x(o,m=0){var f,M;const c=(f=o.find(a=>a.url=="/manage/role"))==null?void 0:f.id,i=(M=o.find(a=>a.url=="/manage/user"))==null?void 0:M.id;let n=[];function s(a){return a.sort((S,O)=>(S.sort||0)-(O.sort||0))}return o.forEach(a=>{if(a.suffix=()=>Re(De,{text:!0,type:a.pid==0&&a.type==0?"warning":a.type==1?"info":"success",size:"small"},{default:()=>a.pid==0&&a.type==0?"目录":a.type==1?"按钮":"菜单"}),(a.pid===c||a.id===c||a.pid===i||a.id===i)&&(a.disabled=!0),a.pid==m){const S=x(o,a.id);S.length>0?a.children=S:a.children=[],n.push(a)}}),s(n)}const T=async()=>{const{error:o,data:m}=await Ne({rtype:b.roleRow.rtype}),c=x(m);if(!o){let i=function(s){for(let f=s.length-1;f>=0;f--)s[f].children&&s[f].children.length>0?i(s[f].children):s[f].children=void 0;return s},n=Be.cloneDeep(c);n=i(n),k.value=n.filter(s=>s.id<=1e4)}},v=J(!0),N=Y([]);async function p(){const{data:o,error:m}=await le(b.roleRow.id+""),c=[];function i(n,s){return!s.includes(n.id)||n.children&&!n.children.every(f=>i(f,s))?(c.push(n.id),!1):!0}k.value.forEach(n=>{i(n,o.menuIdList)}),N.value=o.menuIdList.filter(n=>!c.includes(n))}const R=J(),C=o=>{R.value=o};function z(){var o,m;we({id:b.roleRow.id,name:b.roleRow.name,menuIdList:N.value.concat(R.value).filter(c=>c!==null)}),(m=(o=window.$message)==null?void 0:o.success)==null||m.call(o,r("common.modifySuccess")),g()}function D(){T(),p()}return W(u,o=>{o&&D()}),(o,m)=>{const c=Xe,i=qe,n=je,s=V,f=Z,M=xe;return $(),A(M,{show:u.value,"onUpdate:show":m[2]||(m[2]=a=>u.value=a),preset:"card",class:"w-480px"},{header:l(()=>[ee("div",Ye,[B(L(y.value)+" ",1),ee("div",{class:"ml-10px cursor-pointer",title:"展开/收起",onClick:m[0]||(m[0]=a=>v.value=!v.value)},[v.value?($(),A(i,{key:1,class:"text-icon"})):($(),A(c,{key:0,class:"text-icon"}))])])]),footer:l(()=>[t(f,{justify:"end"},{default:l(()=>[t(s,{size:"small",class:"mt-16px",onClick:g},{default:l(()=>[B(L(e(r)("common.cancel")),1)]),_:1}),t(s,{type:"primary",size:"small",class:"mt-16px",onClick:z},{default:l(()=>[B(L(e(r)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[t(n,{cascade:"","checked-keys":N.value,"onUpdate:checkedKeys":m[1]||(m[1]=a=>N.value=a),data:k.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"",class:"h-60vh","label-field":"name","key-field":"id","children-field":"children","default-expand-all":v.value,onUpdateIndeterminateKeys:C},null,8,["checked-keys","data","default-expand-all"])]),_:1},8,["show"])}}}),tt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function te(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!$e(h)}const bt=H({name:"manage_role",__name:"index",setup(h){const b=Ce(),{columns:u,columnChecks:g,data:y,getData:k,loading:x,mobilePagination:T,searchParams:v,resetSearchParams:N}=ze({apiFn:Me,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,name:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:r("page.manage.role.name"),align:"center",minWidth:120,ellipsis:!0},{key:"remark",title:r("page.manage.role.remark"),minWidth:120,align:"center",ellipsis:!0},{key:"operate",title:r("common.operate"),align:"center",render:d=>{let _;return t("div",{class:"flex-center gap-8px"},[U(t(V,{type:"primary",ghost:!0,size:"small",onClick:()=>O(d.id)},te(_=r("common.edit"))?_:{default:()=>[_]}),[[K("no-auth"),"sys:role:update"]]),U(t(V,{type:"primary",ghost:!0,size:"small",onClick:()=>M(d)},{default:()=>["分配权限"]}),[[K("no-auth"),"sys:role:update"]]),[1,2,3].includes(Number(d.id))?"":t(Fe,{onPositiveClick:()=>S(d.id)},{default:()=>r("common.confirmDelete"),trigger:()=>{let I;return U(t(V,{type:"error",ghost:!0,size:"small"},te(I=r("common.delete"))?I:{default:()=>[I]}),[[K("no-auth"),"sys:role:delete"]])}})])}}]}),{drawerVisible:p,operateType:R,editingData:C,handleAdd:z,handleEdit:D,checkedRowKeys:o,onBatchDeleted:m,onDeleted:c,closeDrawer:i}=Ie(y,k),{bool:n,setTrue:s}=oe(),f=J({id:0,name:"",remark:"",rtype:0,menuIdList:[]});function M(d){s(),f.value=d}async function a(){console.log(o.value),E(o.value,d=>{m()})}function S(d){console.log(d),E([d],_=>{c()})}function O(d){D(d)}async function E(d,_){const{data:I,error:q}=await Se(d);if(!q)_&&_(I);else return!1}const j=de.debounce(k,1e3,{leading:!0,trailing:!1});return(d,_)=>{const I=pe,q=Te,ue=ie;return $(),X("div",tt,[t(Ae,{model:e(v),"onUpdate:model":_[0]||(_[0]=w=>F(v)?v.value=w:null),onReset:e(N),onSearch:e(j)},null,8,["model","onReset","onSearch"]),t(ue,{title:e(r)("page.manage.role.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[t(I,{columns:e(g),"onUpdate:columns":_[1]||(_[1]=w=>F(g)?g.value=w:null),"disabled-delete":e(o).length===0,"is-view-add-button":"","is-view-delete-button":"",loading:e(x),onAdd:e(z),onDelete:a,onRefresh:e(j)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:l(()=>[t(q,{"checked-row-keys":e(o),"onUpdate:checkedRowKeys":_[2]||(_[2]=w=>F(o)?o.value=w:null),columns:e(u),data:e(y),size:"small","flex-height":!e(b).isMobile,"scroll-x":702,loading:e(x),remote:"","row-key":w=>w.id,pagination:e(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Ke,{visible:e(p),"onUpdate:visible":_[3]||(_[3]=w=>F(p)?p.value=w:null),"operate-type":e(R),"row-data":e(C),onSubmitted:e(k)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(et,{visible:e(n),"onUpdate:visible":_[4]||(_[4]=w=>F(n)?n.value=w:null),roleRow:f.value},null,8,["visible","roleRow"])]),_:1},8,["title"])])}}});export{bt as default};
