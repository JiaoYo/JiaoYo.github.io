import{_ as _e}from"./round-add-DC3jKO0K.js";import{d as X,at as ne,q as Y,cq as ge,v as ve,r as P,av as oe,aw as ye,bU as he,y as J,c as z,o as g,w as a,f as n,bc as be,b as B,z as F,G as se,A as we,e as c,t as h,T as Te,D as G,h as r,C as De,F as le,cG as ke,B as N,g as k,aR as xe,aV as Ce,be as Se,s as Ne,i as ie,aZ as m,U as re,az as ze,aC as Pe,N as ue,$ as A,cn as je,aH as ee,cl as Re,M as Ue,aM as W,cH as He,ay as Le,aS as $e}from"./index--GDXRx9n.js";import{f as Me,a as Be,b as Ge,_ as Fe,c as Ie,d as Ve}from"./operate-drawer.vue_vue_type_style_index_0_lang-BlMkzi1b.js";import{u as Ee,a as Ke}from"./table-B_dvW33V.js";import{_ as Ae,a as Oe}from"./text-zWUA8Q-w.js";import{N as de}from"./Popconfirm-qjJSRAua.js";import{_ as qe}from"./round-search-6gH5MaEH.js";import{u as te}from"./usePageData-GADHvGie.js";import{_ as Je}from"./Grid-BGC0jP0v.js";import{_ as Ze}from"./FormItemGridItem-E0R4IJbx.js";import{N as Qe}from"./RadioButton-DeB00DGi.js";import{N as We}from"./DatePicker-BbhJnWX3.js";import"./v4-FuVw324d.js";import"./utils-DG-EDt72.js";const Xe={key:0},Ye={class:"mt-4 border-t pt-3"},et={class:"flex items-start gap-2 mb-3"},tt={class:"ml-2 flex-1"},at={class:"flex items-center"},nt={class:"font-medium font-size-16px font-bold"},ot={class:"text-gray-600 mt-1"},st=X({name:"drawerLog",__name:"drawerLog",props:ne({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(x){const O=Y();ge();const o=ve({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0}),j=x,s={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},v=P({});async function w(){y.value=[],Object.assign(o,j.rowData);const u=JSON.parse(j.rowData.context);o.proname=u.proname,o.notes=u.notes,o.problem=u.problem,o.solutions=u.solutions,o.feedback=u.feedback,o.summarize=u.summarize,o.percent=u.percent,S()}const y=P([]),C=oe(x,"visible");ye(C,()=>{C.value?w():(y.value=[],o.id=void 0)});function I(u){u||b()}function b(){C.value=!1}const S=async()=>{const{data:u,error:l}=await Be({page:1,limit:100,pid:o.id});u&&(y.value=u.list)},H=he.debounce(async()=>{var T;const u=v.value[o.id];if(!(u!=null&&u.trim()))return(T=window.$message)==null?void 0:T.warning("请输入评论内容");const{data:l,error:_}=await Me([{pid:o.id,context:u}]);l&&(v.value[o.id]="",o.num++,S())},1e3,{leading:!0,trailing:!1}),V=async u=>{var T;const{data:l,error:_}=await Ge(u.id);l&&(S(),o.num--,(T=window.$message)==null||T.success("删除成功"))};return(u,l)=>{const _=we,T=se,L=Ae,E=Oe,p=be,$=Se,R=J("no-auth");return g(),z($,{show:C.value,"onUpdate:show":[l[1]||(l[1]=f=>C.value=f),I],"display-directive":"show",width:600,onMaskClick:b,onEsc:b},{default:a(()=>[n(p,{title:o.username+"的项目日报","native-scrollbar":!1,closable:""},{default:a(()=>[n(T,{ref:"formRef",model:o},{default:a(()=>[o.proname?(g(),z(_,{key:0,label:"项目名称",path:"proname","label-placement":"left"},{label:a(()=>l[2]||(l[2]=[c("div",{class:"font-size-16px font-bold"},"项目名称：",-1)])),default:a(()=>[c("span",null,h(o.proname),1)]),_:1})):F("",!0),n(_,{label:"当前工作内容及成果描述",path:"notes"},{label:a(()=>l[3]||(l[3]=[c("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述：",-1)])),default:a(()=>[c("span",null,h(o.notes),1)]),_:1}),n(_,{label:"遇到问题",path:"problem"},{label:a(()=>l[4]||(l[4]=[c("div",{class:"font-size-16px font-bold"},"遇到问题：",-1)])),default:a(()=>[c("span",null,h(o.problem),1)]),_:1}),n(_,{label:"解决措施",path:"solutions"},{label:a(()=>l[5]||(l[5]=[c("div",{class:"font-size-16px font-bold"},"解决措施：",-1)])),default:a(()=>[c("span",null,h(o.solutions),1)]),_:1}),n(_,{label:"建议意见反馈",path:"feedback"},{label:a(()=>l[6]||(l[6]=[c("div",{class:"font-size-16px font-bold"},"建议意见反馈：",-1)])),default:a(()=>[c("span",null,h(o.feedback),1)]),_:1}),n(_,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:a(()=>l[7]||(l[7]=[c("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感：",-1)])),default:a(()=>[c("span",null,h(o.summarize),1)]),_:1})]),_:1},8,["model"]),o.num?(g(),B("div",Xe,h(o.num)+"评论",1)):F("",!0),n(Te,{name:"fade"},{default:a(()=>[c("div",Ye,[G((g(),B("div",et,[c("div",null,[n(L,{size:"small",src:s.avatar},null,8,["src"])]),n(r(De),{type:"textarea",id:`comment-input-${o.id}`,value:v.value[o.id],"onUpdate:value":l[0]||(l[0]=f=>v.value[o.id]=f),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:le(ke(r(H),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),n(r(N),{type:"primary",ghost:"",onClick:r(H)},{default:a(()=>l[8]||(l[8]=[k("发送")])),_:1,__:[8]},8,["onClick"])])),[[R,"project:Comment:insert"]]),(g(!0),B(xe,null,Ce(y.value,f=>(g(),B("div",{key:f.id,class:"flex mb-3"},[n(L,{size:"small",src:s.avatar},null,8,["src"]),c("div",tt,[c("div",at,[c("span",nt,h(f.username),1),n(E,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:a(()=>[k(h(f.dbtime),1)]),_:2},1024),r(O).userInfo.id==f.creater?(g(),z(r(de),{key:0,onPositiveClick:K=>V(f)},{trigger:a(()=>[G((g(),z(r(N),{quaternary:"",type:"error",size:"small"},{default:a(()=>l[9]||(l[9]=[k(" 删除 ")])),_:1,__:[9]})),[[R,"project:Comment:delete"]])]),default:a(()=>[l[10]||(l[10]=k(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):F("",!0)]),c("div",ot,h(f.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),lt=X({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ne(["reset","search","clear","setPname"],["update:model"]),setup(x,{emit:O}){const o=O,{formRef:j}=Ne(),s=oe(x,"model");Y();const v=P([]),{pageData:w,getData:y,nextPage:C}=te(je),I=async i=>{const e=i.currentTarget,t=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&w.data.length<w.total&&(await C(),v.value=w.data,await ee(),setTimeout(()=>{e.scrollTop=t}))},{pageData:b,getData:S,nextPage:H}=te(Re),V=async i=>{const e=i.currentTarget,t=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&b.data.length<b.total&&(await H(),await ee(),setTimeout(()=>{e.scrollTop=t}))},u=async i=>{s.value.creater=i,o("search")},l=async i=>{var e;i&&(s.value.pid=i),o("search"),o("setPname",((e=v.value.find(t=>t.id==i))==null?void 0:e.proname)||"")},_=async i=>{await y({fuzzy:i,page:1}),v.value=w.data},T=async()=>{await y({page:1}),v.value=w.data},L=async()=>{await y(),v.value=w.data,o("search")};S({usertypes:"0,1,2,3,4"});const E={当日:()=>{const i=new Date().getTime();return[i,i]},本周:()=>{const i=new Date().getTime();return[i-24*60*60*1e3*7,i]},上月:()=>{const i=new Date().getTime();return[i-24*60*60*1e3*30,i]}};ie(()=>{L();const i=new Date;if(i.getHours()<18){const e=new Date;e.setDate(i.getDate()-1),e.setHours(0,0,0,0),p.value=[e.getTime(),e.getTime()],s.value.statrtTime=String(m(0,e.getTime()))+" 00:00:00",s.value.endTime=String(m(0,e.getTime()))+" 23:59:59"}else{const e=new Date;e.setHours(0,0,0,0),p.value=[e.getTime(),e.getTime()],s.value.statrtTime=String(m(0,e.getTime()))+" 00:00:00",s.value.endTime=String(m(0,e.getTime()))+" 23:59:59"}});const p=P(null);async function $(i,e){e?(s.value.statrtTime=String(m(0,e[0])),s.value.endTime=String(m(0,e[1]))):(s.value.statrtTime=null,s.value.endTime=null),o("search")}async function R(){o("search")}const f=P("1"),K=async i=>{if(i=="1"){const e=new Date;if(e.getHours()<18){const t=new Date;t.setDate(e.getDate()-1),t.setHours(0,0,0,0),p.value=[t.getTime(),t.getTime()],s.value.statrtTime=m(0,t.getTime())+" 00:00:00",s.value.endTime=m(0,t.getTime())+" 23:59:59"}else{const t=new Date;t.setHours(0,0,0,0),p.value=[t.getTime(),t.getTime()],s.value.statrtTime=m(0,t.getTime())+" 00:00:00",s.value.endTime=m(0,t.getTime())+" 23:59:59"}}else if(i=="2"){const e=new Date().getTime();if(new Date().getHours()<18){const t=e-6912e5,d=e-24*60*60*1e3*1;p.value=[t,d],s.value.statrtTime=m(0,t)+" 00:00:00",s.value.endTime=m(0,d)+" 23:59:59"}else{const t=e,d=e;p.value=[t,d],s.value.statrtTime=m(0,t)+" 00:00:00",s.value.endTime=m(0,d)+" 23:59:59"}}else if(i=="3"){const e=new Date;let t=new Date;t.setMonth(e.getMonth()-1),t.setHours(0,0,0,0);let d=new Date;e.getHours()<18&&d.setDate(e.getDate()-1),d.setHours(23,59,59,999),p.value=[t.getTime(),d.getTime()],s.value.statrtTime=m(0,t.getTime())+" 00:00:00",s.value.endTime=m(0,d.getTime())+" 23:59:59"}o("search")};return(i,e)=>{const t=ze,d=Ze,M=Qe,Z=Pe,Q=We,q=qe,D=N,ce=ue,me=Je,pe=se,fe=re;return g(),z(fe,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[n(pe,{ref_key:"formRef",ref:j,model:s.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:le(R,["enter"])},{default:a(()=>[n(me,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[n(d,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:a(()=>[n(t,{filterable:"",clearable:"",value:s.value.pid,"onUpdate:value":[e[0]||(e[0]=U=>s.value.pid=U),l],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:v.value,onScroll:I,onClear:T,onSearch:_},null,8,["value","options"])]),_:1}),n(d,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:a(()=>[n(Z,{value:f.value,"onUpdate:value":[e[1]||(e[1]=U=>f.value=U),K],size:"small",style:{"margin-right":"10px"}},{default:a(()=>[n(M,{value:"1"},{default:a(()=>e[4]||(e[4]=[k("天")])),_:1,__:[4]}),n(M,{value:"2"},{default:a(()=>e[5]||(e[5]=[k("周")])),_:1,__:[5]}),n(M,{value:"3"},{default:a(()=>e[6]||(e[6]=[k("月")])),_:1,__:[6]})]),_:1},8,["value"]),n(Q,{value:p.value,"onUpdate:value":e[2]||(e[2]=U=>p.value=U),type:"daterange",clearable:"",class:"w-100%",shortcuts:E,"onUpdate:formattedValue":$},null,8,["value"])]),_:1}),n(d,{span:"24 s:12 m:5",label:"用户",path:"creater"},{default:a(()=>[n(t,{clearable:"",filterable:"",value:s.value.creater,"onUpdate:value":[e[3]||(e[3]=U=>s.value.creater=U),u],placeholder:"请选择","label-field":"username","value-field":"id",options:r(b).data,onScroll:V},null,8,["value","options"])]),_:1}),n(d,{span:"24  s:12 m:4",class:"pr-24px"},{default:a(()=>[n(ce,{class:"w-full"},{default:a(()=>[n(D,{type:"primary",ghost:"",onClick:R},{icon:a(()=>[n(q,{class:"text-icon"})]),default:a(()=>[k(" "+h(r(A)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),it={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},rt={key:0};function ae(x){return typeof x=="function"||Object.prototype.toString.call(x)==="[object Object]"&&!$e(x)}const Dt=X({name:"projectmanagement_daylog",__name:"index",props:{pid:{default:void 0},type:{}},emits:["thereIsData"],setup(x,{emit:O}){const o=Ue(),j=Y(),s=x,{columns:v,data:w,getData:y,loading:C,mobilePagination:I,searchParams:b}=Ee({showTotal:!0,immediate:!1,apiFn:Ie,apiParams:{page:1,pageSize:20,limit:20,statrtTime:void 0,endTime:void 0,creater:void 0,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:e=>n("div",null,[e.username+"的项目日报"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:A("common.operate"),align:"center",width:140,fixed:"right",render:e=>{let t;return n("div",{class:"flex-center gap-8px"},[n(N,{type:"primary",ghost:!0,size:"small",onClick:()=>R(e)},{default:()=>[k("查看详情")]}),j.userInfo.id==e.creater&&G(n(N,{type:"primary",ghost:!0,size:"small",onClick:()=>E(e.id)},ae(t=A("common.edit"))?t:{default:()=>[t]}),[[J("no-auth"),"project:DailyReport:update"]]),j.userInfo.id==e.creater&&n(de,{onPositiveClick:()=>L(e.id)},{default:()=>A("common.confirmDelete"),trigger:()=>{let d;return G(n(N,{type:"error",ghost:!0,size:"small"},ae(d=A("common.delete"))?d:{default:()=>[d]}),[[J("no-auth"),"project:DailyReport:delete"]])}})])}}]}),{drawerVisible:S,operateType:H,editingData:V,handleAdd:u,handleEdit:l,checkedRowKeys:_,onDeleted:T}=Ke(w,y);async function L(e){const{data:t,error:d}=await Ve(e);d||T()}function E(e){l(e)}const p=P(!1),$=P({}),R=e=>{p.value=!0,$.value=e},f=()=>{y()},K=P(""),i=e=>{K.value=e};return ie(()=>{s.type!="externalLiaison"}),(e,t)=>{const d=ue,M=_e,Z=Le,Q=re,q=J("no-auth");return g(),B("div",it,[s.pid?F("",!0):(g(),z(lt,{key:0,model:r(b),"onUpdate:model":t[0]||(t[0]=D=>W(b)?b.value=D:null),onReset:f,onSearch:r(y),onSetPname:i},null,8,["model","onSearch"])),n(Q,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},He({header:a(()=>[n(d,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>[s.pid?F("",!0):(g(),B("div",rt,"项目日报"))]),_:1}),s.pid?G((g(),z(r(N),{key:0,onClick:r(u),size:"small",ghost:"",type:"primary"},{icon:a(()=>[n(M,{class:"text-icon"})]),default:a(()=>[t[4]||(t[4]=k(" "+h("新增")))]),_:1,__:[4]},8,["onClick"])),[[q,"project:DailyReport:insert"]]):F("",!0)]),default:a(()=>[n(Z,{"checked-row-keys":r(_),"onUpdate:checkedRowKeys":t[1]||(t[1]=D=>W(_)?_.value=D:null),columns:r(v),data:r(w),size:"small","flex-height":!r(o).isMobile,loading:r(C),remote:"","row-key":D=>D.id,pagination:r(I),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),n(Fe,{visible:r(S),"onUpdate:visible":t[2]||(t[2]=D=>W(S)?S.value=D:null),onSubmitted:r(y),"operate-type":r(H),pname:K.value,pid:s.pid||r(b).pid,"row-data":r(V)},null,8,["visible","onSubmitted","operate-type","pname","pid","row-data"]),n(st,{visible:p.value,"onUpdate:visible":t[3]||(t[3]=D=>p.value=D),"row-data":$.value},null,8,["visible","row-data"])]),_:2},[s.pid?void 0:{name:"header-extra",fn:a(()=>[n(d,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[G((g(),z(r(N),{onClick:r(u),size:"small",ghost:"",type:"primary"},{icon:a(()=>[n(M,{class:"text-icon"})]),default:a(()=>[t[5]||(t[5]=k(" "+h("新增")))]),_:1,__:[5]},8,["onClick"])),[[q,"project:DailyReport:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{Dt as default};
