import{_ as Y}from"./table-column-setting.vue_vue_type_script_setup_true_lang-COtp2Zlc.js";import{_ as Z}from"./refresh-CBxY_HNq.js";import{d as U,n as W,p as ee,s as q,D as I,o as O,c as L,w as i,g as n,E as V,h as S,t as F,i as r,$ as G,F as ae,J as te,B as E,N as M,O as le,ad as Q,dM as ne,a4 as oe,j as f,ae as se,f as z,aa as re,a_ as ie,S as X,ar as ce,P as de,Q as ue,R as pe,a3 as ve,W as me,r as j,e as _e,ah as J,bo as fe,aG as ye,aj as he}from"./index-D91dvCwW.js";import{a as ge,c as xe,d as be,e as K,g as we}from"./reportForm-D78j1efG.js";import{u as ke}from"./table-DYL-PUPy.js";import{_ as Ne}from"./round-search-B8iO44Ig.js";import{_ as Ce}from"./round-refresh-DrzIhE0S.js";import{_ as Se}from"./lodash-BA9eMlFL.js";import{_ as Te}from"./FormItemGridItem-rdHu6UTg.js";import{_ as Pe}from"./Grid-BmPqW9j1.js";import{T as Re}from"./task-DcE3lnVb.js";import{_ as $e,a as ze,b as De,c as Ae}from"./file-pdf-BCScx5ZT.js";import{_ as H}from"./Popconfirm-OzZB1KcQ.js";import"./setting-outlined-Ci-KlEX3.js";import"./echarts.vue_vue_type_script_setup_true_lang-B_If6XuN.js";import"./index-BhRqCdHu.js";import"./installCanvasRenderer-CyOrKSjT.js";import"./install-CX03SWNg.js";const Ee=U({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:W(["reset","search"],["update:model"]),setup(_,{emit:T}){const P=T,{formRef:l,restoreValidation:m}=ee(),u=q(_,"model"),R=()=>{u.value.fuzzy="",y()};async function k(){await m(),P("reset")}async function y(){P("search")}const h=Se.debounce(y,1e3,{leading:!0,trailing:!1});return(N,v)=>{const g=te,a=Te,e=Ce,t=E,d=Ne,$=M,C=Pe,D=le,A=Q,x=I("no-space");return O(),L(A,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[n(D,{ref_key:"formRef",ref:l,model:u.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ae(r(h),["enter"])},{default:i(()=>[n(C,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:i(()=>[n(a,{span:"24 s:12 m:8 l:6",label:"实例名称",path:"alatype"},{default:i(()=>[V(n(g,{autofocus:"",value:u.value.fuzzy,"onUpdate:value":v[0]||(v[0]=s=>u.value.fuzzy=s),placeholder:"请输入实例名称关键字",clearable:"",onClear:R},null,8,["value"]),[[x]])]),_:1}),n(a,{span:"24 s:12 m:8 l:6"},{default:i(()=>[n($,{class:"w-full"},{default:i(()=>[n(t,{onClick:k},{icon:i(()=>[n(e,{class:"text-icon"})]),default:i(()=>[S(" "+F(r(G)("common.reset")),1)]),_:1}),n(t,{type:"primary",ghost:"",onClick:r(h)},{icon:i(()=>[n(d,{class:"text-icon"})]),default:i(()=>[S(" "+F(r(G)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Be=_=>(de("data-v-28c40ede"),_=_(),ue(),_),Ie=Be(()=>z("span",{class:"mr-20px"},"报表预览",-1)),Ve={title:"导出PDF"},Me={title:"导出Word"},Oe={title:"导出Excel"},Ge=U({name:"reportPreview",__name:"reportPreview",props:W({data:{},detaliParams:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(_){ne(a=>({"13c41f40":r(P)}));const T=oe(),P=T.themeScheme=="dark"?"#001428":"#fff",l=_,m=q(_,"visible"),u=f([]),R=async a=>{const{data:e,error:t}=await ge({rtype:a});t||(e.forEach(d=>{d.rtext=JSON.parse(d.rtext)}),u.value=e[0].rtext)},k=["提示","低危","中危","高危","致命"],y=["lev0","lev1","lev2","lev3","lev4"],h=f(),N=f(""),v=async()=>{l.detaliParams.rtype=1,await R(0),u.value.forEach(a=>{if(a.type=="table"&&(a.dataName=="collection"&&(a.value.body=l.data.collection.map(e=>a.value.tableHeaderValue.map(t=>t=="ctime"?ie(1,e[t]):e[t]))),a.dataName=="events"&&(a.value.body=l.data.events.map(e=>a.value.tableHeaderValue.map(t=>e[t]))),a.dataName=="level"&&(a.value.body=l.data.level.map(e=>a.value.tableHeaderValue.map(t=>e[t]))),a.dataName=="level1")){if(l.data.level.length==0)return a.value.body=[];a.value.body=y.map(e=>[e=="lev0"?"提示":e=="lev1"?"低危":e=="lev2"?"中危":e=="lev3"?"高危":"致命",l.data.level.reduce((t,d)=>t+(Number(d[e])||0),0)])}a.type=="chart"&&a.dataName=="events"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=l.data.events.map(e=>e.count),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=l.data.events.map(e=>e.cname):a.value.data.yAxis.data=l.data.events.map(e=>e.cname)),a.value.chartType=="pie"&&(a.value.data.series[0].data=l.data.events.map(e=>({value:e.count,name:e.cname}))),a.value.chartType=="line"&&(a.value.data.series[0].data=l.data.events.map(e=>e.count),a.value.data.xAxis.data=l.data.events.map(e=>e.cname))),a.dataName=="level"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=l.data.level.map(e=>e.count),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=l.data.level.map(e=>e.logname):a.value.data.yAxis.data=l.data.level.map(e=>e.logname)),a.value.chartType=="pie"&&(a.value.data.series[0].data=l.data.level.map(e=>({value:e.count,name:e.logname}))),a.value.chartType=="line"&&(a.value.data.series[0].data=l.data.level.map(e=>e.count),a.value.data.xAxis.data=l.data.level.map(e=>e.logname))),a.dataName=="level1"&&(a.value.chartType=="bar"&&(a.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(e=>l.data.level.reduce((t,d)=>t+(Number(d[e])||0),0)),a.value.data.xAxis.type=="category"?a.value.data.xAxis.data=k:a.value.data.yAxis.data=k),a.value.chartType=="pie"&&(a.value.data.series[0].data=[{value:l.data.level.reduce((e,t)=>e+t.lev0*1,0)==0?null:l.data.level.reduce((e,t)=>e+t.lev0*1,0),name:"提示"},{value:l.data.level.reduce((e,t)=>e+t.lev1*1,0)==0?null:l.data.level.reduce((e,t)=>e+t.lev1*1,0),name:"低危"},{value:l.data.level.reduce((e,t)=>e+t.lev2*1,0)==0?null:l.data.level.reduce((e,t)=>e+t.lev2*1,0),name:"中危"},{value:l.data.level.reduce((e,t)=>e+t.lev3*1,0)==0?null:l.data.level.reduce((e,t)=>e+t.lev3*1,0),name:"高危"},{value:l.data.level.reduce((e,t)=>e+t.lev4*1,0)==0?null:l.data.level.reduce((e,t)=>e+t.lev4*1,0),name:"致命"}]),a.value.chartType=="line"&&(a.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(e=>l.data.level.reduce((t,d)=>t+(Number(d[e])||0),0)),a.value.data.xAxis.data=k))}),h.value=u.value};se(m,()=>{m.value&&v()});const g=f();return(a,e)=>{const t=$e,d=ze,$=De,C=Ae,D=X,A=ce;return O(),L(A,{show:m.value,"onUpdate:show":e[3]||(e[3]=x=>m.value=x),preset:"card",class:"w-1000px reportPreview",style:re({"background-color":r(T).themeScheme=="dark"?"#001428":"#fff"})},{header:i(()=>[Ie,z("span",Ve,[n(t,{class:"text-32px c-#d63031 cursor-pointer",onClick:e[0]||(e[0]=x=>g.value.toPdf(N.value))})]),z("span",Me,[n(d,{class:"text-32px c-#1e90ff cursor-pointer",onClick:e[1]||(e[1]=x=>g.value.toWord(N.value))})]),z("span",Oe,[n($,{class:"text-32px c-#15703d cursor-pointer",onClick:e[2]||(e[2]=x=>g.value.toExcel(N.value))})])]),default:i(()=>[n(D,{class:"max-h-600px"},{default:i(()=>[(O(),L(C,{key:h.value,ref_key:"filePreviewExportRef",ref:g,width:800,data:h.value},null,8,["data"]))]),_:1})]),_:1},8,["show","style"])}}}),Le=pe(Ge,[["__scopeId","data-v-28c40ede"]]),Fe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ue=z("div",{style:{display:"flex","align-items":"center"}},[z("div",null,"报表实例")],-1),ia=U({name:"reportmanagement_reportlist",__name:"index",setup(_){const T=ve(),{columns:P,columnChecks:l,data:m,getData:u,loading:R,mobilePagination:k,searchParams:y,resetSearchParams:h}=ke({apiFn:xe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:s=>!0,renderExpand:s=>n("div",{class:"detailList"},[n(X,{style:"max-height: 360px"},{default:()=>[a.value.length>0?a.value.map((o,c)=>n(M,{justify:"space-between",style:{marginBottom:"8px",padding:"0px 50px 8px 50px",borderBottom:c!==a.value.length-1?"1px dashed #ccc":"none"},key:o.sn},{default:()=>[n("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[o.sn]),n(M,null,{default:()=>[V(n(E,{type:"info",size:"small",ghost:!0,onClick:()=>D(o.sn,s.rtype)},{default:()=>[S("查看")]}),[[I("no-auth"),"sys.report.instance.select"]]),n(H,{onPositiveClick:()=>x(o.sn,s.rtype,s.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>V(n(E,{type:"error",size:"small",ghost:!0},{default:()=>[S("删除")]}),[[I("no-auth"),"sys.report.instance.delete"]])})]})]})):n("div",{style:{textAlign:"center",padding:"10px"}},[S("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:s=>{var o;return n("div",null,[(o=me(Re).find(c=>c.value===s.rtype))==null?void 0:o.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:G("common.operate"),align:"center",width:160,render:s=>n("div",{class:"flex-center gap-8px"},[n(H,{onPositiveClick:()=>A(s.tid,s.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>V(n(E,{type:"primary",ghost:!0,size:"small"},{default:()=>[S("清空")]}),[[I("no-auth"),"sys.report.instance.delete"]])})])}]}),N=f(null),v=f([]),g=async s=>{v.value=[s[s.length-1]],v.value[0]&&(a.value=[],await t());const o=m.value.findIndex(c=>c.tid===s[s.length-1]);setTimeout(()=>{var c;(c=N.value)==null||c.scrollTo({top:o*40,behavior:"smooth"})},500)},a=f([]),e=j({page:1,limit:10}),t=async()=>{const s=JSON.parse(JSON.stringify(m.value)).find(p=>p.tid===v.value[0]),{data:o,error:c}=await we({tid:v.value[0],page:e.page,limit:Number(s.num)||10});c||(a.value=o.list,ye(()=>{const p=document.querySelector(".detailList");if(p){const{height:b}=p.getBoundingClientRect();p.animate([{height:"0px"},{height:`${b}px`}],{duration:300,easing:"linear"})}}))},d=f(!1),$=f({}),C=j({name:"",rtype:0}),D=async(s,o)=>{const{data:c,error:p}=await be({name:s,type:o,tid:v.value[0]});C.name=s,C.rtype=o,p||(d.value=!0,$.value=JSON.parse(c))},A=async(s,o)=>{var b;const{data:c,error:p}=await K({tid:s,type:o});p||((b=window.$message)==null||b.success("清空成功"),a.value=[],u())},x=async(s,o,c)=>{var B;const{data:p,error:b}=await K({fname:s,type:o,tid:c});b||((B=window.$message)==null||B.success("删除成功"),u(),t())};return(s,o)=>{const c=Z,p=Y,b=he,B=Q;return O(),_e("div",Fe,[n(Ee,{model:r(y),"onUpdate:model":o[0]||(o[0]=w=>J(y)?y.value=w:null),onReset:r(h),onSearch:r(u)},null,8,["model","onReset","onSearch"]),n(B,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:i(()=>[Ue]),"header-extra":i(()=>[n(r(M),null,{default:i(()=>[n(r(E),{size:"small",onClick:o[1]||(o[1]=w=>r(u)())},{icon:i(()=>[n(c,{class:fe(["text-icon",{"animate-spin":r(R)}])},null,8,["class"])]),default:i(()=>[S(" "+F(r(G)("common.refresh")),1)]),_:1}),n(p,{columns:r(l),"onUpdate:columns":o[2]||(o[2]=w=>J(l)?l.value=w:null)},null,8,["columns"])]),_:1})]),default:i(()=>[n(b,{ref_key:"tableContainer",ref:N,columns:r(P),data:r(m),size:"small","flex-height":!r(T).isMobile,"scroll-x":962,loading:r(R),remote:"","row-key":w=>w.tid,pagination:r(k),class:"sm:h-full","expanded-row-keys":v.value,"onUpdate:expandedRowKeys":g},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),n(Le,{visible:d.value,"onUpdate:visible":o[3]||(o[3]=w=>d.value=w),data:$.value,detaliParams:C},null,8,["visible","data","detaliParams"])]),_:1})])}}});export{ia as default};
