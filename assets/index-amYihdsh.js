import{_ as Ka}from"./table-column-setting.vue_vue_type_script_setup_true_lang-D-5uH7kQ.js";import{_ as fa}from"./round-delete-BXSVg0cc.js";import{_ as Ha}from"./round-add-B_10irHU.js";import{d as $t,av as St,z as ma,D as et,s as _,A as ga,$ as T,n as r,H as R,aS as wt,B as y,cL as Ya,cB as Xa,cJ as Za,cK as Qt,bg as Wt,ay as ne,a5 as ea,f as a,g as v,d1 as Qa,cD as Wa,d0 as el,aG as ot,c_ as tl,c$ as ta,a as al,at as Bt,au as Dt,aK as va,b as Ct,o as j,aP as aa,bq as ll,w as i,bo as nl,M as ya,L as ha,c as V,G as ce,h as u,bp as dt,e as O,S as sl,da as la,a$ as il,J as ye,ax as zt,t as Z,a4 as ba,N as ol,cZ as _a,cQ as xa,dE as rl,az as na,dp as ka,fd as sa,fe as ul,ff as ia,fg as dl,cz as cl,fh as pl,fi as fl,dt as oa,dl as ra,aE as jt,dF as ml,d7 as gl,d4 as Ca,dq as Sa,ds as vl,cM as yl,cT as hl,dr as bl,dm as _l,dn as xl,dk as kl,du as Cl,bl as Sl,a2 as Ot,aD as ut,W as wa,aJ as wl,Y as Dl,X as zl,i as $l,b1 as Ll,F as xt,aL as kt,cY as Fl,I as rt,aM as Pl,aB as Il,fj as Al,aO as Nl,aA as ua,cC as Ul,_ as jl,aR as Tl}from"./index-9Ko_9_TI.js";import{u as Et,a as El}from"./table-BtCxAkgO.js";import{_ as Bl}from"./round-plus-ozcWEIQ7.js";import{_ as Ol,a as Ml,A as Rl}from"./index-C47jeqCT.js";import{h as Mt,i as Vl,g as Da,p as da,f as Jl}from"./business-BXzaRcWh.js";import{u as ca}from"./usePageData-BWaYhHgw.js";import{h as Tt}from"./permission-BBIMTKq7.js";import{N as Te}from"./Popconfirm-Cg-J5jDB.js";import{N as ql}from"./Cascader-HOtqP2Oc.js";import{_ as za}from"./Grid-C4COR-OK.js";import{_ as $a}from"./FormItemGridItem-BlsYHznD.js";import{_ as La}from"./DatePicker-DdutLwK7.js";import{_ as Gl}from"./round-search-BEVIxLnz.js";import{_ as Kl}from"./round-refresh-bTt_nT21.js";import{l as Hl}from"./lookdebuggingSheetModal-SD4RtMfK.js";import{_ as Yl}from"./RadioButton-BH8aJiOr.js";import"./DescriptionsItem-BE-EQXL2.js";import"./Table-_gSZmIRl.js";const Xl={class:"w-100%"},Zl={class:"flex"},Ql={style:{display:"flex","flex-direction":"column",width:"100%"}},Wl={class:"flex items-center"},en={class:"w-100%"},tn={class:"w-100px"},an={style:{display:"flex","flex-direction":"column"}},ln={style:{display:"flex","flex-direction":"column"}},nn={style:{display:"flex","flex-direction":"column"}},sn={class:"flex-col w-100%"},on=2,rn=$t({name:"OperateDrawer",__name:"operate-drawer",props:St({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:St(["submitted"],["update:visible"]),setup(ee,{emit:se}){const x=ma(),te=se,J=et({contactList:[],debuggedDevieceList:[],fileList:[]}),c=ee,s=et(he());function he(){return{proname:"",dispatchIds:[],contractIds:[],proaddr:"",cpdbtime:null,plantime:null,prosite:"",longitude:120.373885,latitude:30.303899,period:null,dtype:null,dispatch:"",status:1,region:null,provice:null}}const E=_(0),be=_(void 0);async function Fe(){U.value=[{longitude:120.373885,latitude:30.303899,addr:""}],S.value=[],I.value=[],ge.value=[],Object.assign(s,he()),Ua(),Ma(),c.operateType==="edit"&&c.rowData&&(await Promise.all([Va(),_e(),Ve(),q(),at(),_t()]),Object.assign(s,c.rowData),E.value=s.period,be.value=s.status,Yt(s.provice),st(s.provice),Na())}const{formRef:K,restoreValidation:pe}=ga(),Ee={proname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入项目名称"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择项目状态"},contractIds:{type:"array",required:!0,trigger:["blur","change"],message:"请选择合同"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择调试类型"},period:{type:"number",required:!0,trigger:["blur","change"],message:"请输入周期"},prosite:{type:"string",required:!0,trigger:["blur","change","focus"],message:"请选择项目地点"},cpdbtime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择时间"},plantime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择时间"},provice:{type:"number",required:!0,trigger:["blur","change"],message:"请选择省份"},region:{type:"number",required:!0,trigger:["blur","change"],message:"请选择城市"}},z=_([]),H=et({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",pageSizes:[20],prefix:()=>`共 ${z.value.length} 条`,onChange:e=>{H.page=e,q()},onUpdatePageSize:e=>{H.pageSize=e,H.page=1,q()}}),Pe=[{title:"对接方",key:"docker",align:"center",width:150,render(e,t){return e.setStatus?r(R,{value:e.docker,placeholder:"请输入",onUpdateValue(l){z.value[t].docker=l}}):r("div",{},e.docker)}},{title:"姓名",key:"pname",align:"center",width:100,render(e,t){return e.setStatus?r(R,{value:e.pname,placeholder:"请输入姓名",onUpdateValue(l){z.value[t].pname=l}}):r("div",{},e.pname)}},{title:"联系方式",key:"pcontact",align:"center",width:150,render(e,t){return e.setStatus?r(R,{value:e.pcontact,placeholder:"请输入联系方式",onUpdateValue(l){z.value[t].pcontact=l}}):r("div",{},e.pcontact)}},{title:"备注",key:"proposition",align:"center",width:150,render(e,t){return e.setStatus?r(R,{value:e.proposition,placeholder:"请输入备注",onUpdateValue(l){z.value[t].proposition=l}}):r("div",{},e.proposition)}},{title:"操作人",width:100,key:"username",align:"center"},{title:"操作时间",key:"dbtime",width:180,align:"center",render:e=>e.dbtime?wt(1,e.dbtime):""},{key:"operate",title:T("common.operate"),align:"center",width:160,fixed:"right",render(e,t){return r("div",{class:"flex-center gap-8px"},[e.setStatus?[r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>k(e)},{default:()=>"保存"}),r(y,{type:"default",ghost:!0,size:"small",onClick:()=>g(e,t)},{default:()=>"取消"}),r(Te,{onPositiveClick:()=>{c.operateType==="edit"&&e.id?Ya(e.id).then(()=>{var l;z.value.splice(t,1),(l=window.$message)==null||l.success("删除成功")}):z.value.splice(t,1)}},{default:()=>T("common.confirmDelete"),trigger:()=>r(y,{type:"error",ghost:!0,size:"small"},{default:()=>T("common.delete")})})]:r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>$(e)},{default:()=>"编辑"})])}}],q=async()=>{var t;const{data:e}=await Xa({page:H.page,limit:H.pageSize,pid:(t=c.rowData)==null?void 0:t.id});z.value=e==null?void 0:e.list,z.value.forEach(l=>{l.setStatus=!1}),J.contactList=JSON.parse(JSON.stringify(z.value))},$=e=>{var t;if(z.value.some(l=>l.setStatus)){(t=window.$message)==null||t.warning("请先对正在编辑中的数据进行操作");return}e.setStatus=!e.setStatus},g=(e,t)=>{e.setStatus=!e.setStatus,e.id?z.value=JSON.parse(JSON.stringify(J.contactList)):z.value.splice(t,1)},k=async e=>{var t,l,o,d,p;if(!e.pname){(t=window.$message)==null||t.warning("请输入联系人姓名");return}if(!e.pcontact){(l=window.$message)==null||l.warning("请输入联系方式");return}if(c.operateType==="edit")if(e.id){const{data:w,error:C}=await Za([e]);C||((o=window.$message)==null||o.success("修改成功"),q(),e.setStatus=!e.setStatus)}else{const{data:w,error:C}=await Qt([{...e,pid:(d=c.rowData)==null?void 0:d.id}]);C||((p=window.$message)==null||p.success("添加成功"),q(),e.setStatus=!e.setStatus)}else e.setStatus=!e.setStatus};function Ie(){var e;((e=z.value[0])!=null&&e.pname||z.value.length==0)&&z.value.unshift({pname:"",pcontact:"",proposition:"",setStatus:!0})}const M=e=>{var t;s.contractIds=e,P.value=bt.data.filter(l=>e.includes(l.id)).map(l=>({value:l.id,label:l.contractname,isLeaf:!1})),Me((t=P.value[0])==null?void 0:t.id)},P=_([]),_e=async()=>{var l,o;const{data:e,error:t}=await _a({page:1,limit:100,id:(l=c.rowData)==null?void 0:l.id});P.value=e==null?void 0:e.list.map(d=>({value:d.id,label:d.contractname,isLeaf:!1})),Me((o=e==null?void 0:e.list[0])==null?void 0:o.id)},fe=_([]),me=_(),{pageData:Be,getData:Oe}=ca(xa),Me=async e=>{await Oe({pids:e}),me.value=[],fe.value=Array.from(new Set([...fe.value,...Be.data])),me.value=Be.data.map(t=>({label:t.devname,value:t.id}))},tt=async e=>{var t;await Me(e.value),e.children=(t=me.value)==null?void 0:t.map(l=>({label:l.label,value:l.value,isLeaf:!0}))},S=_([]),h=et({page:1,pageSize:20,itemCount:0,showSizePicker:!0,fuzzy:"",pageSizes:[10,20],prefix:()=>`共 ${h.itemCount} 条`,onChange:e=>{h.page=e,Ve()},onUpdatePageSize:e=>{h.pageSize=e,h.page=1,Ve()}}),Re=_(),He=[{title:"绑定合同设备",key:"cid",width:300,align:"center",render(e,t){var l,o;return e.setStatus?r(ql,{style:"width: 270px",value:e.cid,filterable:!0,placeholder:"请选择合同设备",options:P.value,checkStrategy:"child",showPath:!1,remote:!0,renderSuffix:d=>d.option.hidden?null:d.node,renderLabel:d=>d.hidden?null:d.label,onLoad:tt,onUpdateValue(d){var w;S.value[t].cid=Number(d)||0;const p=(w=fe.value)==null?void 0:w.find(C=>C.id==d);e.devname=(p==null?void 0:p.devname)||"",e.devnum=(p==null?void 0:p.devcount)||"",e.notes=(p==null?void 0:p.notes)||"",Re.value=(p==null?void 0:p.devcount)||0,e.etype=(p==null?void 0:p.devtype)||0,e.devmanu=(p==null?void 0:p.devmanu)||"",e.devmodel=(p==null?void 0:p.devmodel)||"",e.devunit=(p==null?void 0:p.devunit)||""}}):r("div",{},e.devname2||((o=(l=me.value)==null?void 0:l.find(d=>d.value==e.cid))==null?void 0:o.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(e,t){return e.setStatus?r(R,{value:e.devname,placeholder:"请输入",onUpdateValue(l){S.value[t].devname=l}}):r("div",{},e.devname)}},{title:"型号",key:"devmodel",width:220,align:"center",render(e,t){return r("div",{},e.devmodel)}},{title:"设备单位",key:"devunit",width:120,align:"center",render(e,t){return r("div",{},e.devunit)}},{title:"数量",key:"devnum",width:100,align:"center",render(e,t){return e.setStatus?r(Wt,{value:e.devnum,placeholder:"请输入",max:Re.value,onUpdateValue(l){S.value[t].devnum=l}}):r("div",{},e.devnum)}},{title:"是否为我司设备",key:"etype",width:260,align:"center",render(e,t){return r("div",{},e.etype==0?"是":"否")}},{title:"设备厂家",key:"devmanu",width:200,align:"center",render(e,t){return r("div",{},e.devmanu)}},{title:"清点状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?r(ne,{value:e.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(l){S.value[t].status=Number(l)||0}}):r("div",{},e.status===0?"未清点":e.status===1?"正常":e.status===2?"增补":e.status===3?"退货":"换货")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(e,t){return r("div",{},e.devmanu)}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(e,t){return e.setStatus?r(R,{value:e.manucontact,placeholder:"请输入",onUpdateValue(l){S.value[t].manucontact=l}}):r("div",{},e.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(e,t){return e.setStatus?r(R,{value:e.manuinfo,placeholder:"请输入",onUpdateValue(l){S.value[t].manuinfo=l}}):r("div",{},e.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(e,t){return e.setStatus&&e.id?r(ne,{value:e.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(l){S.value[t].devstatus=Number(l)||0}}):r("div",{},e.devstatus===0?"设备无异常":e.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(e,t){return e.setStatus?r(R,{value:e.connectionmode,placeholder:"请输入",onUpdateValue(l){S.value[t].connectionmode=l}}):r("div",{},e.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(e,t){return e.setStatus&&e.id?r(ne,{value:e.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(l){S.value[t].install=Number(l)||0}}):r("div",{},e.install===0?"是":"否")}},{title:"备注",key:"notes",width:200,align:"center",render(e,t){return r("div",{},e.notes)}},{title:"文件",key:"re1",width:160,align:"center",render(e,t){return e.setStatus?r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>ct(e,"debuggedDevieceList",t)},{default:()=>"上传文件"}):r(ea,{trigger:"hover"},{trigger:()=>r("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const l=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(o=>o.alias||o.file);return l.length===0?r("div",{style:"padding: 10px; color: #999;"},"暂无文件"):r("div",{style:"padding: 10px;"},[r("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[r("thead",[r("tr",[r("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),r("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),r("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),r("tbody",l.map((o,d)=>{var p;return r("tr",[r("td",{style:"text-align:center; padding: 4px 8px;"},o.alias||"-"),r("td",{style:"text-align:center; padding: 4px 8px;"},((p=o.file)==null?void 0:p.split("?")[1])||"-"),r("td",{style:"text-align:center; padding: 4px 8px;"},r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>pt({url:o.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作信息",key:"dbtime",width:180,align:"center",render(e,t){return r(ea,{trigger:"hover"},{trigger:()=>r("div",{style:"color: #1890ff;cursor: pointer;"},e.dbtime?wt(1,e.dbtime):""),default:()=>r("div",{style:"padding: 10px;"},a("div",null,[a("div",null,[v("操作人："),e.username]),a("div",null,[v("操作时间："),e.dbtime]),a("div",null,[v("清点人："),e.dusername]),a("div",null,[v("清点时间："),e.ddbtime])]))})}},{key:"operate",title:T("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return r("div",{class:"flex-center gap-8px"},[e.setStatus?[r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>ke(e)},{default:()=>"保存"}),r(y,{type:"default",ghost:!0,size:"small",onClick:()=>f(e,t)},{default:()=>"取消"}),Tt("project:Equipment:delete")&&r(Te,{onPositiveClick:async()=>{var l;if(e.id){const{data:o,error:d}=await Qa(e.id);o&&(S.value.splice(t,1),(l=window.$message)==null||l.success("删除成功"))}else S.value.splice(t,1)}},{default:()=>T("common.confirmDelete"),trigger:()=>r(y,{type:"error",ghost:!0,size:"small"},{default:()=>T("common.delete")})})]:Tt("project:Equipment:update")&&r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>n(e)},{default:()=>"编辑"})])}}],ge=_([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]),Ae=_(!1),xe=_(""),Q=_(),ct=(e,t,l)=>{Ae.value=!0,xe.value=t,Q.value=l,e.re1&&(ge.value[0]={name:e.re1,url:e.fl1,file:void 0}),e.re2&&(ge.value[1]={name:e.re2,url:e.fl2,file:void 0}),e.re3&&(ge.value[2]={name:e.re3,url:e.fl3,file:void 0}),e.re4&&(ge.value[3]={name:e.re4,url:e.fl4,file:void 0})},Ye=async()=>{var t,l;let e=!0;if(ge.value.forEach((o,d)=>{var C,A;const p=o.name||"",w=((C=o.url)==null?void 0:C.split("?")[1])||((A=o.file)==null?void 0:A.name);(p&&!w||!p&&w)&&(e=!1)}),!e){(l=(t=window.$message)==null?void 0:t.error)==null||l.call(t,"文件名称和文件地址必须同时存在，不能只填一个");return}S.value[Q.value].fileList=ge.value,e&&(Ae.value=!1,xe.value="",Q.value=void 0)},Ve=async()=>{var t;const{data:e}=await Wa({page:h.page,limit:h.pageSize,fuzzy:h.fuzzy,pid:(t=c.rowData)==null?void 0:t.id});S.value=e.list,J.debuggedDevieceList=JSON.parse(JSON.stringify(S.value))},n=async e=>{var o,d;if(console.log(Be.data,e.cid,"ssssssssssssssss"),S.value.some(p=>p.setStatus)){(o=window.$message)==null||o.warning("请先对正在编辑中的数据进行操作");return}const{data:t,error:l}=await el(e.cid);l||(((d=P.value[P.value.length-1])==null?void 0:d.value)!=t.id&&P.value.push({value:t.id,label:t.devname,disabled:!0,isLeaf:!0,hidden:!0}),Re.value=t.devcount||0),e.setStatus=!e.setStatus},f=(e,t)=>{e.setStatus=!e.setStatus,e.id?S.value=JSON.parse(JSON.stringify(J.debuggedDevieceList)):S.value.splice(t,1)},ke=async e=>{var t,l,o,d,p,w,C,A,Y;if(!e.cid){(t=window.$message)==null||t.warning("请选择合同设备");return}if(!e.devname){(l=window.$message)==null||l.warning("设备名称不能为空");return}if(!e.devmodel){(o=window.$message)==null||o.warning("设备型号不能为空");return}if(!e.devnum){(d=window.$message)==null||d.warning("设备数量不能为空");return}if(e.id){if(((p=e.fileList)==null?void 0:p.length)>0){const W=e.fileList.filter(D=>D.file),re=W.length;for(let D=0;D<re;D++){const F=W[D];F.status="uploading";try{F.url=await ot(F.file.file,F.file.name,""),F.status="done"}catch{F.status="error"}}e.fileList.forEach((D,F)=>{e[`re${F+1}`]=D.name||"",e[`fl${F+1}`]=D.url||""}),delete e.fileList}const{data:we,error:oe}=await tl([e]);oe||((w=window.$message)==null||w.success("修改成功"),Ve(),e.setStatus=!e.setStatus)}else if((C=c.rowData)!=null&&C.id){if(e.fileList.length>0){const W=e.fileList.filter(D=>D.file),re=W.length;for(let D=0;D<re;D++){const F=W[D];F.status="uploading";try{F.url=await ot(F.file.file,F.file.name,""),F.status="done"}catch{F.status="error"}}e.fileList.forEach((D,F)=>{e[`re${F+1}`]=D.name||"",e[`fl${F+1}`]=D.url||""}),delete e.fileList}const{data:we,error:oe}=await ta([{...e,pid:(A=c.rowData)==null?void 0:A.id}]);oe||((Y=window.$message)==null||Y.success("添加成功"),Ve(),e.setStatus=!e.setStatus)}else e.setStatus=!e.setStatus};function Ce(){var e;((e=S.value[0])!=null&&e.devname||S.value.length==0)&&S.value.unshift({status:void 0,devmanu:"",etype:0,devname:"",devmodel:"",devnum:0,notes:"",setStatus:!0})}const ve=()=>{Ae.value=!1},Je=_({}),I=_([]);async function at(){var t;I.value=[];const{data:e}=await rl({page:1,limit:100,pid:(t=c.rowData)==null?void 0:t.id});e.list.forEach(l=>{l.sort==1&&I.value.push({id:l.id,name:l.filename,url:l.file,status:"finished",creator:l.username,dbtime:l.dbtime})}),I.value.reverse(),J.fileList=JSON.parse(JSON.stringify(I.value)),Je.value=JSON.parse(JSON.stringify(e))}const Lt=[{title:"文件名称",key:"file",align:"center",render(e){var o;const t=async({file:d,onFinish:p,onError:w})=>{var C,A;try{e.name=d.name,e.file=d}catch(Y){console.error(Y),(A=(C=window.$message)==null?void 0:C.error)==null||A.call(C,"文件上传出错")}};async function l(d){var p;return d.file.file.size>100*1024*1024?((p=window.$message)==null||p.error("文件大小不能超过100M"),!1):!0}return r("div",{style:"display:flex;justify-content:center;align-items:center;"},[e.file||e.url?r("span",{},[r("span",{},((o=e.file)==null?void 0:o.name)||e.url.split("?")[1]||"")]):r(na,{action:"#",showFileList:!1,customRequest:t,onBeforeUpload:l},{default:()=>r(y,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(e){return e.setStatus?r(R,{value:e.name,clearable:!0,onUpdateValue:t=>{e.name=t}}):r("div",{},e.name)}},{title:"上传人",key:"creator",align:"center",width:80,render(e){return r("div",{},e.creator)}},{title:"上传时间",key:"dbtime",align:"center",width:180,render(e){return r("div",{},e.dbtime?e.dbtime:"")}},{title:"操作",key:"actions",align:"center",width:200,render(e,t){return r(ye,{justify:"center"},[!e.setStatus&&e.id&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{pt(e)}},{default:()=>"下载"}),e.setStatus&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{N(e)}},{default:()=>"保存"}),e.setStatus&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{e.setStatus=!e.setStatus,e.id?I.value=JSON.parse(JSON.stringify(J.fileList)):I.value.splice(t,1)}},{default:()=>"取消"}),!e.setStatus&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{e.setStatus=!e.setStatus}},{default:()=>"编辑"}),Tt("project:File:delete")&&(x.userInfo.usertype==0||x.userInfo.usertype==2)&&e.setStatus&&r(Te,{onPositiveClick:async()=>{var l;if(e.id){const{data:o,error:d}=await _l(e.url),{data:p,error:w}=await xl(e.id);w||((l=window.$message)==null||l.success("删除成功"),at())}else I.value=I.value.filter(o=>o!==e)}},{default:()=>T("common.confirmDelete"),trigger:()=>r(y,{type:"error",ghost:!0,size:"small"},{default:()=>T("common.delete")})})])}}],Ft=[{title:"",key:"",align:"center",render(e,t){return`附件${t+1}`}},{title:"文件名称",key:"filename",align:"center",render(e){var o;const t=async({file:d,onFinish:p,onError:w})=>{var C,A;try{e.name=d.name,e.file=d}catch(Y){console.error(Y),(A=(C=window.$message)==null?void 0:C.error)==null||A.call(C,"文件上传出错")}};async function l(d){var p;return d.file.file.size>100*1024*1024?((p=window.$message)==null||p.error("文件大小不能超过100M"),!1):!0}return r("div",{style:"display:flex;justify-content:center;align-items:center;"},[e.file||e.url?r("span",{},[r("span",{},((o=e.file)==null?void 0:o.name)||e.url.split("?")[1]||""),r("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{e.url="",e.file=null,e.name=""}},"删除")]):r(na,{action:"#",showFileList:!1,customRequest:t,onBeforeUpload:l},{default:()=>r(y,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(e){return r(R,{value:e.name,clearable:!0,onUpdateValue:t=>{e.name=t}})}}];async function pt(e){if(e!=null&&e.url)try{const l=await(await fetch(e.url.split("?")[0],{mode:"cors"})).blob(),o=URL.createObjectURL(l),d=document.createElement("a");d.href=o,d.download=e.url.split("?")[1],d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(o)}catch(t){console.error("下载失败:",t)}}const ft=()=>{I.value.push({id:"",name:"",url:"",status:!1,setStatus:!0})},N=async e=>{var t,l,o,d,p,w,C,A,Y,we,oe,W;if(!e.name){(l=(t=window.$message)==null?void 0:t.warning)==null||l.call(t,"请输入文件别名");return}if(!e.file&&!e.url){(d=(o=window.$message)==null?void 0:o.warning)==null||d.call(o,"请上传文件");return}if((p=c.rowData)!=null&&p.id){e.url=await ot(e.file.file,e.file.name,"");const{data:re,error:D}=await ra([{pid:(w=c.rowData)==null?void 0:w.id,filename:e.name,file:e.url,sort:1}]);if(D)return(C=window.$message)==null?void 0:C.error("保存文件记录失败");(A=window.$message)==null||A.destroyAll(),e.setStatus=!e.setStatus,at(),(Y=window.$message)==null||Y.success("保存成功")}else if(e.id){const{data:re,error:D}=await kl([{id:e.id,filename:e.name}]);if(D)return(we=window.$message)==null?void 0:we.error("保存文件记录失败");(oe=window.$message)==null||oe.destroyAll(),e.setStatus=!e.setStatus,(W=window.$message)==null||W.success("编辑成功")}else e.setStatus=!e.setStatus},qe=al(()=>({add:"新增项目",edit:"修改项目"})[c.operateType]),Xe=Bt(ee,"visible");Dt(Xe,()=>{Xe.value&&(Fe(),setTimeout(()=>{const e=document.querySelector(".n-scrollbar-content");e==null||e.scrollTo(0,0)},300),pe())});function Fa(e){e||Ne()}function Ne(){Xe.value=!1}async function Rt(){var e;(e=window.$dialog)==null||e.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await Pa()}})}async function Pa(){var e,t,l,o,d,p,w,C,A,Y,we,oe,W,re,D,F,m,ue,Qe;if(c.operateType==="edit"){const je=JSON.parse(JSON.stringify(s));E.value==je.period&&delete je.period,be.value==je.status&&delete je.status;const{data:Ga,error:Ut}=await ka([je]);if(!Ut){let De=function(ze,de){const le=ze.filter($e=>!de.includes($e)),We=de.filter($e=>!ze.includes($e));return{toDelete:le,toAdd:We}};if((e=s.dispatchIds)!=null&&e.length&&((t=s.dispatchIds)==null?void 0:t.length)>0){const{toDelete:ze,toAdd:de}=De(Kt.value,s.dispatchIds);if(de.length>0){const le=de.map(b=>({pid:s.id,did:b})),{data:We,error:$e}=await sa(le)}if(ze.length>0){const{data:le,error:We}=await ul(ze.join(","))}}if((l=s.contractIds)!=null&&l.length&&((o=s.contractIds)==null?void 0:o.length)>0){const{toDelete:ze,toAdd:de}=De(Zt.value,s.contractIds);if(de.length>0){const le=de.map(b=>({pid:s.id,did:b})),{data:We,error:$e}=await ia(le)}if(ze.length>0){const{data:le,error:We}=await dl(ze.join(","))}}Ne(),te("submitted"),(d=window.$message)==null||d.success("修改成功")}}else{const je=cl(),{data:Ga,error:Ut}=await pl([{...s,uuid:je}]);if(!Ut){const{data:De,error:ze}=await fl(je);if(De){let de=function(b,X,it){return b.map(G=>({...G,pid:X}))};for(const b of S.value)if(((p=b.fileList)==null?void 0:p.length)>0){const X=b.fileList.filter(G=>G.file),it=X.length;for(let G=0;G<it;G++){const B=X[G];B.status="uploading";try{B.url=await ot(B.file.file,B.file.name,""),B.status="done"}catch{B.status="error"}}b.fileList.forEach((G,B)=>{b[`re${B+1}`]=G.name||"",b[`fl${B+1}`]=G.url||""}),delete b.fileList}if(s.dispatchIds&&s.dispatchIds.length>0){const b=[];(w=s.dispatchIds)==null||w.forEach(G=>{b.push({pid:De,did:G})});const{data:X,error:it}=await sa(b)}if(s.contractIds&&s.contractIds.length>0){const b=[];(C=s.contractIds)==null||C.forEach(async G=>{b.push({proid:De,conid:G})});const{data:X,error:it}=await ia(b)}const le=[];if(z.value.length>0){const b=de(z.value,De);le.push(Qt(b))}if(S.value.length>0){const b=de(S.value,De);le.push(ta(b))}if(U.value.length>0&&le.push(oa(U.value)),(await Promise.allSettled(le)).forEach((b,X)=>{b.status==="fulfilled"?console.log(`第 ${X+1} 个请求成功`,b.value):console.error(`第 ${X+1} 个请求失败`,b.reason)}),!I.value.length){(A=window.$message)==null||A.destroyAll(),(Y=window.$message)==null||Y.success("操作成功"),Ne(),te("submitted");return}if(!I.value.length){(we=window.$message)==null||we.destroyAll(),(oe=window.$message)==null||oe.success("操作成功"),Ne(),te("submitted");return}if(I.value.length==0)return(W=window.$message)==null?void 0:W.warning("请选择文件");let $e=!0;for(let b=0;b<I.value.length;b++){const X=I.value[b];if(!X.file){(re=window.$message)==null||re.warning(`第${b+1}个文件的文件名称不能为空`),$e=!1;break}if(!X.name){(D=window.$message)==null||D.warning(`第${b+1}个文件的文件别名不能为空`),$e=!1;break}}if($e){const b=I.value.length;for(let B=0;B<b;B++){const Le=I.value[B];Le.indexText=`${B+1}/${b}`,Le.progress=0,Le.status="uploading";try{Le.url=await ot(Le.file.file,Le.name,"",vn=>{}),Le.status="done"}catch{Le.status="error"}}const X=I.value.map(B=>({file:B.url,filename:B.name,pid:De,sort:1})),{data:it,error:G}=await ra(X);G&&((F=window.$message)==null||F.error("保存文件记录失败")),(m=window.$message)==null||m.destroyAll(),(ue=window.$message)==null||ue.success("操作成功"),Ne(),te("submitted")}}}Ne(),te("submitted"),(Qe=window.$message)==null||Qe.success("添加成功")}}const Ge=_(!1),Pt=_();let Ue=null,lt=null,mt=null,Ia=null,Vt=null,Se=null;const ae=et({longitude:0,latitude:0});let nt;const gt=_(!1),ie=_(""),vt=_([]);let yt=0;async function Jt(){try{if(window._AMapSecurityConfig={securityJsCode:x.userInfo.sdksecret},!Pt.value)return;Se=await Rl.load({key:x.userInfo.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),Ue=new Se.Map(Pt.value,{zoom:18,center:[L.value>0?U.value[L.value-1].longitude:s.longitude,L.value>0?U.value[L.value-1].latitude:s.latitude],viewMode:"3D",resizeEnable:!0}),lt=new Se.Geocoder,Ia=new Se.PlaceSearch({city:"全国",pageSize:50}),Vt=new Se.AutoComplete({city:"全国"}),ht(Se,{lng:L.value>0?U.value[L.value-1].longitude:s.longitude,lat:L.value>0?U.value[L.value-1].latitude:s.latitude}),Ue.on("click",e=>{const{lng:t,lat:l}=e.lnglat;nt=2,ae.latitude=l,ae.longitude=t,ht(Se,{lng:t,lat:l})}),yt=0,jt(()=>{window.dispatchEvent(new Event("resize"))})}catch(e){console.error("地图加载失败：",e),yt<on?(yt++,console.warn(`地图加载失败，正在第 ${yt} 次重试...`),setTimeout(()=>{Jt()},1500)):console.error("地图加载失败，已达到最大重试次数，停止重试")}}const qt=va.debounce(async e=>{if(!gt.value||!e.trim()){vt.value=[];return}Vt.search(e,(t,l)=>{var o;console.log(l,"result"),t=="complete"&&l.info=="OK"&&((o=l==null?void 0:l.tips)!=null&&o.length)?vt.value=l.tips.map(d=>({label:`${d.name}（${d.district||d.address||"无详细地址"}）`,value:`${d.location.lng}_${d.location.lat}`,raw:d})):vt.value=[]})},300);Dt(ie,e=>{qt(e)});function Aa(e,t){if(console.log(e,t,"option"),!e)return;const[l,o]=e.split("_").map(Number);!l||!o||(Ue.setCenter([l,o]),nt=1,ht(Se,{lng:l,lat:o}),ae.longitude=l,ae.latitude=o)}const L=_(0);function Gt(e){e?L.value=e:L.value=0,Ge.value=!0,gt.value=!1,nt=void 0,jt(async()=>{await Jt(),setTimeout(()=>{gt.value=!0;const t=document.querySelector(".n-auto-complete input");t==null||t.blur(),console.log(s),s.region&&!s.prosite&&!s.prosite&&It(s.region)},500)})}function ht(e,t){mt&&Ue.remove(mt),mt=new e.Marker({position:[t.lng,t.lat],map:Ue}),Ue.add(mt),lt.getAddress(t,async(l,o)=>{l==="complete"&&o.regeocode&&(console.log("result",o),console.log("formattedAddress",o.regeocode.formattedAddress),t.latitude=t.lat,t.longitude=t.lng,nt==1?(s.proaddr=o.regeocode.formattedAddress,s.provice=At(s.proaddr,Ze.value),await st(s.provice),s.region=Nt(s.proaddr,Ke.value)):nt==2?(ie.value=o.regeocode.formattedAddress,s.proaddr=o.regeocode.formattedAddress,s.provice=At(s.proaddr,Ze.value),await st(s.provice),s.region=Nt(s.proaddr,Ke.value)):(ie.value=L.value>0?U.value[L.value-1].addr||o.regeocode.formattedAddress:s.prosite||o.regeocode.formattedAddress,setTimeout(async()=>{s.provice=At(ie.value,Ze.value),await st(s.provice),s.region=Nt(ie.value,Ke.value)},300)))})}const Kt=_([]),Na=async()=>{var l;const{data:e,error:t}=await ml({page:1,limit:100,pid:(l=c.rowData)==null?void 0:l.id});s.dispatchIds=e==null?void 0:e.list.map(o=>o.did),Kt.value=JSON.parse(JSON.stringify(s.dispatchIds))},Ht=_([]),Yt=async e=>{if(!e)return;const{data:t,error:l}=await gl({page:1,limit:100,province:e});Ht.value=t.list},Ze=_([]),Ua=async()=>{const{data:e,error:t}=await Ca();e&&(Ze.value=e)},Xt=e=>{st(e),s.region=null,s.prosite="",s.proaddr="",ie.value="",Yt(e)},It=e=>{var l;const t=(l=Ke.value.find(o=>o.id===e))==null?void 0:l.name;s.region&&s.prosite&&s.proaddr&&!lt?(s.prosite="",s.proaddr=""):ja(t)},Ke=_([]),st=async e=>{var o;if(!e)return(o=window.$message)==null?void 0:o.warning("请先选择省份");const{data:t,error:l}=await Sa({province:e});t&&(Ke.value=t)};function ja(e){!e||!lt||!Ue||lt.getLocation(e,(t,l)=>{var o;if(t==="complete"&&((o=l.geocodes)!=null&&o.length)){const{location:d,formattedAddress:p}=l.geocodes[0],w=d.lng,C=d.lat;Ue.setZoomAndCenter(14,[w,C]),ae.longitude=w,ae.latitude=C,s.latitude=ae.latitude,s.longitude=ae.longitude,ht(Se,{lng:w,lat:C}),s.proaddr=p,s.prosite=p,ie.value=p}})}function At(e,t){let l=null;for(const o of t)if(e.includes(o.name)){l=o.id;break}return l}function Nt(e,t){let l=null;for(const o of t)if(e.includes(o.name)){l=o.id;break}return l}const Ta=async()=>{var e,t,l;if(L.value==0)s.latitude=ae.latitude,s.longitude=ae.longitude,s.prosite=ie.value;else if(U.value[L.value-1].addr=ie.value,U.value[L.value-1].latitude=ae.latitude,U.value[L.value-1].longitude=ae.longitude,c.operateType=="edit"){let o=U.value[L.value-1];if(U.value[L.value-1].id){const{data:d,error:p}=await vl([o]);d&&((e=window.$message)==null||e.success("修改位置成功"),Ge.value=!1,L.value=0,_t())}else{o.pid=(t=c.rowData)==null?void 0:t.id;const{data:d,error:p}=await oa([o]);d&&((l=window.$message)==null||l.success("添加位置成功"),Ge.value=!1,L.value=0,_t())}}Ge.value=!1,L.value=0};function Ea(){Ge.value=!1}const{pageData:bt,getData:Ba,nextPage:Oa}=ca(yl),Ma=async()=>{await Ba({limit:100})},Ra=async e=>{const t=e.currentTarget,l=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&bt.data.length<bt.total&&(await Oa(),await jt(),setTimeout(()=>{t.scrollTop=l}))},Zt=_([]),Va=async()=>{var l;const{data:e,error:t}=await hl({page:1,limit:100,proid:(l=c.rowData)==null?void 0:l.id});s.contractIds=e==null?void 0:e.list.map(o=>o.conid),Zt.value=JSON.parse(JSON.stringify(s.contractIds))},U=_([{longitude:120.373885,latitude:30.303899,addr:""}]),Ja=_([]),_t=async()=>{var l;const{data:e,error:t}=await bl({pid:(l=c.rowData)==null?void 0:l.id,page:1,limit:99});U.value=e.list.length==0?[{longitude:120.373885,latitude:30.303899,addr:""}]:e.list,Ja.value=JSON.parse(JSON.stringify(U.value))},qa=async e=>{var t;if(e.id){const{data:l,error:o}=await Cl(e.id);l&&((t=window.$message)==null||t.success("删除成功"),_t())}else U.value.splice(U.value.indexOf(e),1)};return(e,t)=>{const l=$a,o=La,d=Ol,p=sl,w=Bl,C=fa,A=zt,Y=za,we=ya,oe=nl,W=ll,re=ba,D=ol,F=Ml;return j(),Ct(aa,null,[a(W,{show:Xe.value,"onUpdate:show":[t[16]||(t[16]=m=>Xe.value=m),Fa],"display-directive":"show",width:1100,onMaskClick:t[17]||(t[17]=m=>Xe.value=!0),onEsc:Ne},{default:i(()=>[a(oe,{title:qe.value,"native-scrollbar":!1,closable:""},{footer:i(()=>[a(u(ye),{size:16,justify:"end"},{default:i(()=>[a(u(y),{onClick:Ne},{default:i(()=>[v(Z(u(T)("common.cancel")),1)]),_:1}),a(u(y),{type:"primary",onClick:Rt},{default:i(()=>t[32]||(t[32]=[v(Z("保存"))])),_:1,__:[32]})]),_:1})]),default:i(()=>[a(we,{ref_key:"formRef",ref:K,model:s,rules:Ee,onKeyup:ha(Rt,["enter"])},{default:i(()=>[a(Y,{responsive:"screen","item-responsive":"","x-gap":"15"},{default:i(()=>[a(l,{span:"24 s:12 m:12",label:"项目名称",path:"proname"},{default:i(()=>[a(u(R),{clearable:"",value:s.proname,"onUpdate:value":t[0]||(t[0]=m=>s.proname=m),placeholder:"请输入项目名称"},null,8,["value"])]),_:1}),c.operateType==="add"?(j(),V(l,{key:0,span:"24 s:12 m:12",label:"绑定合同",path:"contractIds"},{default:i(()=>[a(u(ne),{filterable:"",multiple:"",value:s.contractIds,"onUpdate:value":[t[1]||(t[1]=m=>s.contractIds=m),M],placeholder:"请选择合同","label-field":"contractname","value-field":"id",options:u(bt).data,onScroll:Ra},null,8,["value","options"])]),_:1})):ce("",!0),c.operateType==="edit"?(j(),V(l,{key:1,span:"24 s:12 m:12",label:"项目状态",path:"status"},{default:i(()=>[a(u(ne),{filterable:"",value:s.status,"onUpdate:value":t[2]||(t[2]=m=>s.status=m),placeholder:"请选择项目状态",options:u(dt)(u(x).userInfo.usertype==0||u(x).userInfo.usertype==2?u(Mt):u(Vl))},null,8,["value","options"])]),_:1})):ce("",!0),a(l,{span:"24 s:12 m:12",label:"周期（天）",path:"period"},{default:i(()=>[a(u(Wt),{clearable:"",value:s.period,"onUpdate:value":t[3]||(t[3]=m=>s.period=m),style:{width:"100%"},placeholder:"请输入周期"},null,8,["value"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"计划调试时间",path:"plantime"},{default:i(()=>[a(o,{size:"small","formatted-value":s.plantime,"onUpdate:formattedValue":t[4]||(t[4]=m=>s.plantime=m),type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"调试类型",path:"dtype"},{default:i(()=>[a(u(ne),{filterable:"",value:s.dtype,"onUpdate:value":t[5]||(t[5]=m=>s.dtype=m),placeholder:"请选择调试类型",options:u(dt)(u(Da))},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"省份",path:"provice"},{default:i(()=>[a(u(ne),{filterable:"",value:s.provice,"onUpdate:value":[t[6]||(t[6]=m=>s.provice=m),Xt],placeholder:"请选择省份","label-field":"name","value-field":"id",options:Ze.value},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"地区",path:"region"},{default:i(()=>[a(u(ne),{filterable:"",value:s.region,"onUpdate:value":[t[7]||(t[7]=m=>s.region=m),It],placeholder:"请选择地区","label-field":"name","value-field":"id",options:Ke.value},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"项目默认地点",path:"prosite"},{default:i(()=>[O("div",Xl,[O("div",Zl,[a(p,{onClick:t[9]||(t[9]=m=>Gt())},{default:i(()=>[a(u(R),{value:s.prosite,"onUpdate:value":t[8]||(t[8]=m=>s.prosite=m),placeholder:"请选择项目地点"},null,8,["value"]),a(u(y),null,{icon:i(()=>[a(d,{class:"text-icon"})]),_:1})]),_:1})])])]),_:1}),a(l,{span:"24 s:12 m:12",label:"项目详细地址",path:"proaddr"},{default:i(()=>[a(u(R),{type:"textarea",rows:1,clearable:"",value:s.proaddr,"onUpdate:value":t[10]||(t[10]=m=>s.proaddr=m),placeholder:"请输入项目详细地址"},null,8,["value"])]),_:1}),U.value.length?(j(),V(l,{key:2,span:"24 s:12 m:24",label:"",path:""},{default:i(()=>[O("div",Ql,[O("div",Wl,[O("span",{class:"mr-10px",onClick:t[11]||(t[11]=la(()=>{},["stop"]))},"其他地址"),a(u(y),{size:"small",ghost:"",type:"primary",onMousedown:t[12]||(t[12]=la(()=>{},["stop"])),onClick:t[13]||(t[13]=m=>U.value.push({latitude:30.303899,longitude:120.373885,addr:""}))},{icon:i(()=>[a(w,{class:"text-icon"})]),default:i(()=>[t[24]||(t[24]=v(" 添加 "))]),_:1,__:[24]})]),O("div",en,[(j(!0),Ct(aa,null,il(U.value,(m,ue)=>(j(),Ct("div",{class:"flex px-50px items-center mt-10px w-100%",key:m.latitude},[O("span",tn,"项目地址"+Z(ue+1),1),a(p,{onClick:Qe=>Gt(ue+1)},{default:i(()=>[a(u(R),{readonly:"",value:m.addr,"onUpdate:value":Qe=>m.addr=Qe,placeholder:"请选择项目地址"+(ue+1)},null,8,["value","onUpdate:value","placeholder"]),a(u(y),null,{icon:i(()=>[a(d,{class:"text-icon"})]),_:1})]),_:2},1032,["onClick"]),U.value.length>1?(j(),V(u(Te),{key:0,onPositiveClick:Qe=>qa(m)},{trigger:i(()=>[a(u(y),{size:"small",ghost:"",type:"error",class:"ml-10px"},{icon:i(()=>[a(C,{class:"text-icon"})]),default:i(()=>[t[25]||(t[25]=v(" "+Z("删除")))]),_:1,__:[25]})]),default:i(()=>[v(" 确定要删除项目地址"+Z(ue+1)+"吗？ ",1)]),_:2},1032,["onPositiveClick"])):ce("",!0)]))),128))])])]),_:1})):ce("",!0),a(l,{span:"24 s:12 m:12",label:"调度名称",path:"dispatch"},{default:i(()=>[a(u(R),{clearable:"",value:s.dispatch,"onUpdate:value":t[14]||(t[14]=m=>s.dispatch=m),placeholder:"请输入调度名称"},null,8,["value"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"选择调度",path:"dispatchIds"},{default:i(()=>[a(u(ne),{filterable:"",multiple:"",value:s.dispatchIds,"onUpdate:value":t[15]||(t[15]=m=>s.dispatchIds=m),placeholder:"请选择调度","label-field":"dname","value-field":"id",options:Ht.value},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:24",path:"contactList"},{default:i(()=>[O("div",an,[a(u(ye),{align:"center",style:{"margin-bottom":"10px"}},{default:i(()=>[t[27]||(t[27]=O("span",null,"项目联系人",-1)),a(u(y),{size:"small",ghost:"",type:"primary",onClick:Ie},{icon:i(()=>[a(w,{class:"text-icon"})]),default:i(()=>[t[26]||(t[26]=v(" 添加项目联系人 "))]),_:1,__:[26]})]),_:1,__:[27]}),z.value.length>0?(j(),V(A,{key:0,columns:Pe,"paginate-single-page":!1,data:z.value,pagination:H,"max-height":350,"scroll-x":Pe.reduce((m,ue)=>m+ue.width,0)},null,8,["data","pagination","scroll-x"])):ce("",!0)])]),_:1}),a(l,{span:"24 s:12 m:24",path:"debuggedDevieceList"},{default:i(()=>[O("div",ln,[a(u(ye),{align:"center",style:{"margin-bottom":"10px"}},{default:i(()=>[t[29]||(t[29]=O("span",null,"待调试设备",-1)),a(u(y),{size:"small",ghost:"",type:"primary",onClick:Ce},{icon:i(()=>[a(w,{class:"text-icon"})]),default:i(()=>[t[28]||(t[28]=v(" 添加待调试设备 "))]),_:1,__:[28]})]),_:1,__:[29]}),S.value.length>0?(j(),V(A,{key:0,style:{width:"1050px"},columns:He,data:S.value,size:"small","scroll-x":He.reduce((m,ue)=>m+ue.width,0),"row-key":m=>m.id,"max-height":350,pagination:h.pageSize==1?!1:h,remote:"","paginate-single-page":!1},null,8,["data","scroll-x","row-key","pagination"])):ce("",!0)])]),_:1}),a(l,{span:"24 s:12 m:24"},{default:i(()=>[O("div",nn,[a(u(ye),{align:"center",style:{"margin-bottom":"10px"}},{default:i(()=>[t[31]||(t[31]=O("span",null,"图纸",-1)),a(u(y),{size:"small",ghost:"",type:"primary",onClick:ft},{icon:i(()=>[a(w,{class:"text-icon"})]),default:i(()=>[t[30]||(t[30]=v(" 添加图纸 "))]),_:1,__:[30]})]),_:1,__:[31]}),I.value.length>0?(j(),V(A,{key:0,columns:Lt,data:I.value,size:"small","scroll-x":702,"row-key":m=>m.id,"max-height":350},null,8,["data","row-key"])):ce("",!0)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"]),a(re,{show:Ae.value,"onUpdate:show":t[18]||(t[18]=m=>Ae.value=m),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:i(()=>[v(Z(xe.value=="debuggedDevieceList"?"待调试设备":xe.value=="debuggedBusinessList"?"待调试业务":xe.value=="needsList"?"客户需求变更":xe.value=="developBusinessList"?"需要开发":"")+" 文件列表 ",1)]),footer:i(()=>[a(u(ye),{justify:"end"},{default:i(()=>[a(u(y),{size:"small",class:"mt-16px",onClick:ve},{default:i(()=>[v(Z(u(T)("common.cancel")),1)]),_:1}),a(u(y),{type:"primary",size:"small",class:"mt-16px",onClick:Ye},{default:i(()=>[v(Z(u(T)("common.confirm")),1)]),_:1})]),_:1})]),default:i(()=>[a(A,{columns:Ft,"paginate-single-page":!1,data:ge.value,"max-height":350},null,8,["data"])]),_:1},8,["show"]),a(re,{show:Ge.value,"onUpdate:show":t[23]||(t[23]=m=>Ge.value=m),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:i(()=>[a(u(ye),{justify:"end",size:16},{default:i(()=>[a(u(y),{onClick:Ea},{default:i(()=>[v(Z(u(T)("common.cancel")),1)]),_:1}),a(u(y),{type:"primary",onClick:Ta},{default:i(()=>[v(Z(u(T)("common.confirm")),1)]),_:1})]),_:1})]),default:i(()=>[a(u(ye),null,{default:i(()=>[a(D,{label:"省份",path:"provice","label-placement":"left","label-width":"70"},{default:i(()=>[a(u(ne),{filterable:"",value:s.provice,"onUpdate:value":[t[19]||(t[19]=m=>s.provice=m),Xt],placeholder:"请选择省份","label-field":"name","value-field":"id",options:Ze.value},null,8,["value","options"])]),_:1}),a(D,{label:"地区",path:"region","label-placement":"left","label-width":"70"},{default:i(()=>[a(u(ne),{filterable:"",value:s.region,"onUpdate:value":[t[20]||(t[20]=m=>s.region=m),It],placeholder:"请选择地区","label-field":"name","value-field":"id",options:Ke.value},null,8,["value","options"])]),_:1})]),_:1}),gt.value?(j(),V(D,{key:0,label:L.value==0?"项目地址":"项目地址"+L.value,"label-placement":"left"},{default:i(()=>[O("div",sn,[a(F,{value:ie.value,"onUpdate:value":[t[21]||(t[21]=m=>ie.value=m),u(qt)],options:vt.value,style:{"margin-bottom":"7px"},placeholder:"请输入地点关键字",clearable:"",onSelect:Aa},null,8,["value","options","onUpdate:value"]),L.value==0?(j(),V(u(R),{key:0,type:"textarea",rows:2,clearable:"",value:s.proaddr,"onUpdate:value":t[22]||(t[22]=m=>s.proaddr=m),placeholder:"请输入详细地址"},null,8,["value"])):ce("",!0)])]),_:1},8,["label"])):ce("",!0),O("div",{ref_key:"domRef",ref:Pt,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])],64)}}}),un=$t({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:St(["reset","search"],["update:model"]),setup(ee,{emit:se}){Sl();const x=se,{formRef:te,restoreValidation:J}=ga(),c=Bt(ee,"model"),s={当日:()=>{const g=new Date().getTime();return[g,g]},本周:()=>{const g=new Date().getTime();return[g-24*60*60*1e3*7,g]},上月:()=>{const g=new Date().getTime();return[g-24*60*60*1e3*30,g]},近一年:()=>{const g=new Date().getTime();return[g-24*60*60*1e3*365,g]},近三年:()=>{const g=new Date().getTime();return[g-24*60*60*1e3*365*3,g]}};function he(){c.value.fuzzy="",x("search")}const E=_([]);(async()=>{const{data:g,error:k}=await Ca();g&&(E.value=g)})();const Fe=g=>{Ee(g),c.value.regions=null,c.value.region=null,x("search")},K=g=>{var k;c.value.region=g,c.value.regions=(k=c.value.region)==null?void 0:k.join(","),x("search")},pe=_([]),Ee=async g=>{var M;if(!g)return(M=window.$message)==null?void 0:M.warning("请先选择省份");const{data:k,error:Ie}=await Sa({province:g});k&&(pe.value=k)};async function z(g,k){if(!g){c.value.startTime=void 0,c.value.endTime=void 0,x("search");return}c.value.startTime=String(wt(1,k[0])),c.value.endTime=String(wt(1,k[1])),x("search")}async function H(){c.value.startTime=void 0,c.value.endTime=void 0,c.value.startAndTimeRange=null,c.value.fuzzy="",c.value.status=null,c.value.ptype=null,c.value.dtype=null,c.value.region=null,c.value.regions=null,c.value.provice=null,await J(),x("reset")}const Pe=va.debounce(g=>{x("search")},1e3,{leading:!0,trailing:!1}),q=g=>{c.value.fuzzy=g,Pe(g)};async function $(){x("search")}return(g,k)=>{const Ie=R,M=$a,P=ne,_e=La,fe=Kl,me=y,Be=Gl,Oe=ye,Me=za,tt=ya,S=Ot;return j(),V(S,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[a(tt,{ref_key:"formRef",ref:te,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ha($,["enter"])},{default:i(()=>[a(Me,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:i(()=>[a(M,{span:"24 s:12 m:6",label:"项目/客户",path:"fuzzy"},{default:i(()=>[a(Ie,{clearable:"",value:c.value.fuzzy,"onUpdate:value":k[0]||(k[0]=h=>c.value.fuzzy=h),placeholder:"请输入项目名称或客户名称",onClear:he,onInput:q},null,8,["value"])]),_:1}),a(M,{span:"24 s:12 m:6",label:"项目状态",path:"status"},{default:i(()=>[a(P,{clearable:"",filterable:"",value:c.value.status,"onUpdate:value":[k[1]||(k[1]=h=>c.value.status=h),$],placeholder:"请选择项目状态",options:u(dt)(u(Mt)).sort((h,Re)=>h.value-Re.value)},null,8,["value","options"])]),_:1}),a(M,{span:"24 s:12 m:6",label:"进度状态",path:"ptype"},{default:i(()=>[a(P,{clearable:"",filterable:"",value:c.value.ptype,"onUpdate:value":[k[2]||(k[2]=h=>c.value.ptype=h),$],placeholder:"请选择进度状态",options:[{label:"正常",value:0},{label:"已延期",value:1},{label:"作废",value:2}]},null,8,["value"])]),_:1}),a(M,{span:"24 s:12 m:6",label:"调试类型",path:"dtype"},{default:i(()=>[a(P,{clearable:"",filterable:"",value:c.value.dtype,"onUpdate:value":[k[3]||(k[3]=h=>c.value.dtype=h),$],placeholder:"请选择调试类型",options:u(dt)(u(Da))},null,8,["value","options"])]),_:1}),a(M,{span:"24 s:12 m:6",label:"省份",path:"provice"},{default:i(()=>[a(P,{filterable:"",value:c.value.provice,"onUpdate:value":[k[4]||(k[4]=h=>c.value.provice=h),Fe],placeholder:"请选择省份","label-field":"name","value-field":"id",clearable:"",options:E.value},null,8,["value","options"])]),_:1}),a(M,{span:"24 s:12 m:6",label:"地区",path:"region"},{default:i(()=>[a(P,{filterable:"",value:c.value.region,"onUpdate:value":[k[5]||(k[5]=h=>c.value.region=h),K],placeholder:"请选择地区","label-field":"name","value-field":"id",clearable:"",multiple:"",options:pe.value},null,8,["value","options"])]),_:1}),a(M,{span:"24 s:12 m:8",label:"起止时间"},{default:i(()=>[a(_e,{value:c.value.startAndTimeRange,"onUpdate:value":k[6]||(k[6]=h=>c.value.startAndTimeRange=h),type:"datetimerange",clearable:"",shortcuts:s,"onUpdate:formattedValue":z},null,8,["value"])]),_:1}),a(M,{span:"24  s:12 m:4",class:"pr-24px"},{default:i(()=>[a(Oe,{class:"w-full"},{default:i(()=>[a(me,{onClick:H},{icon:i(()=>[a(fe,{class:"text-icon"})]),default:i(()=>[v(" "+Z(u(T)("common.reset")),1)]),_:1}),a(me,{type:"primary",ghost:"",onClick:$},{icon:i(()=>[a(Be,{class:"text-icon"})]),default:i(()=>[v(" "+Z(u(T)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),dn={class:"min-h-500px flex gap-16px"},cn={class:"flex items-center justify-end gap-16px"},pn=$t({__name:"relatedContractLook",props:St({id:{},pname:{}},{visable:{type:Boolean},visableModifiers:{}}),emits:["update:visable"],setup(ee){const se=ee,x=Bt(ee,"visable"),{columns:te,data:J,getData:c,loading:s,mobilePagination:he,searchParams:E}=Et({apiFn:_a,immediate:!1,apiParams:{page:1,pageSize:20,limit:20,id:se.id,_t:new Date().getTime()},columns:()=>[{key:"contractname",title:"合同",width:200,render:$=>a("div",{class:H.pids==$.id?"bg-#f1f1f1 cursor-pointer p-5px":"cursor-pointer p-5px",onClick:()=>Pe($.id)},[a("div",{class:"flex"},[a("div",{class:"w-60px inline-block"},[v("名称：")]),$.contractname]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("编号：")]),v(" "),$.contractnum]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("联系人：")]),$.businesscon]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("联系方式：")]),$.businessinfo]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("注意事项：")]),$.precautions]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("备注：")]),$.notes])])}]}),{columns:be,data:Fe,getData:K,loading:pe,pagination:Ee,mobilePagination:z,searchParams:H}=Et({apiFn:xa,immediate:!1,apiParams:{page:1,pageSize:20,limit:20,pids:se.id,_t:new Date().getTime()},columns:()=>[{key:"devname",title:"设备名称",align:"center",width:200,resizable:!0},{key:"devcount",title:"数量",align:"center",width:60,resizable:!0},{key:"devmodel",title:"规格型号",align:"center",width:200,resizable:!0},{key:"devunit",title:"单位",align:"center",width:100,resizable:!0},{key:"notes",title:"备注",align:"center",width:120,resizable:!0},{key:"devtype",title:"是否为我司设备",align:"center",width:120,render:$=>$.devtype==0?a(ut,{type:"success"},{default:()=>[v("是")]}):a(ut,{type:"info"},{default:()=>[v("否")]}),resizable:!0},{key:"devmanu",title:"设备厂家",align:"center",width:120,resizable:!0},{key:"username",title:"创建人",align:"center",width:100,resizable:!0},{key:"dbtime",title:"创建时间",align:"center",width:180,resizable:!0}]}),Pe=$=>{H.pids=$,K()},q=()=>{x.value=!1};return Dt(()=>x.value,async $=>{var g;$&&(E.id=se.id,Fe.value=[],Ee.itemCount=0,await c(),H.pids=(g=J.value[0])==null?void 0:g.id,H.pids&&K())}),($,g)=>{const k=zt,Ie=Ot,M=ba;return j(),V(M,{show:x.value,"onUpdate:show":g[0]||(g[0]=P=>x.value=P),preset:"card",class:"w-1400px",title:`${se.pname} --- 关联的合同=>设备`},{footer:i(()=>[O("div",cn,[a(u(y),{type:"primary",size:"small",onClick:q},{default:i(()=>g[1]||(g[1]=[v(" 关闭 ")])),_:1,__:[1]})])]),default:i(()=>[O("div",dn,[a(k,{class:"left",columns:u(te),data:u(J),"paginate-single-page":!1,size:"small",remote:"",loading:u(s),pagination:u(he),"row-key":P=>P.id,"max-height":600},null,8,["columns","data","loading","pagination","row-key"]),a(Ie,{bordered:!1,size:"small",class:"w-1100px","content-style":{padding:"0"}},{default:i(()=>[a(k,{style:{width:"100%"},columns:u(be),data:u(Fe),size:"small","max-height":600,loading:u(pe),remote:"","scroll-x":u(be).reduce((P,_e)=>P+(_e.width||100),0),"paginate-single-page":!1,pagination:u(z),"row-key":P=>P.id},null,8,["columns","data","loading","scroll-x","pagination","row-key"])]),_:1})])]),_:1},8,["show","title"])}}}),fn=wa(pn,[["__scopeId","data-v-5fd0b7ea"]]),mn={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function pa(ee){return typeof ee=="function"||Object.prototype.toString.call(ee)==="[object Object]"&&!Tl(ee)}const gn=$t({name:"projectmanagement_projectlist",__name:"index",setup(ee){const se=wl(),x=ma(),te=Dl(),J=zl(),{columns:c,columnChecks:s,data:he,getData:E,loading:be,mobilePagination:Fe,searchParams:K}=Et({showTotal:!0,apiFn:Ul,apiParams:{page:1,pageSize:20,limit:20,status:null,startAndTimeRange:null,startTime:null,endTime:null,creater:void 0,fuzzy:void 0,sort:void 0,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"proname",title:"项目名称",align:"center",width:240,render:n=>a("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[a("div",{class:"cursor-pointer",onClick:()=>He(n)},[n.proname+(n.dispatch?`(${n.dispatch})`:"")]),a(y,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>Ve(n.proname)},{default:()=>[v("复制")]})])},{key:"progess",title:"项目进度",align:"center",width:140,sorter:!0,render:n=>a(ua,{type:"line",showIndicator:!0,percentage:n.progess,"indicator-placement":"inside",processing:!0,color:"#1890ff"},null)},{key:"status",title:"项目状态",align:"center",width:120,defaultFilterOptionValue:null,filterOptions:dt(Mt),filter:!0,filterMultiple:!1,render:n=>{if(n.status===null)return null;const f=T(da[n.status]);return a("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:n.status==-1?"#a27ff9":n.status===0?"#9ca3af":n.status===1?"#3b82f6":n.status===2?"#facc15":"#22c55e",borderRadius:"50%"}},[a("span",{style:{width:"10px",height:"10px",marginRight:"5px",backgroundColor:n.status==-1?"#a27ff9":n.status===0?"#9ca3af":n.status===1?"#3b82f6":n.status===2?"#facc15":"#22c55e",borderRadius:"50%"}},null),a("span",null,[f])])}},{key:"cpdbtime",title:"预计完成日期",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"plantime",title:"计划调试时间",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"period",title:"周期",align:"center",width:100,render:n=>a("div",null,[n.period,v("天")])},{key:"ptype",title:"状态",align:"center",width:80,render:n=>a(ut,{type:n.ptype===0?"success":"error"},{default:()=>[n.ptype===0?"正常":n.ptype===1?"已延期":"作废"]})},{key:"dtype",title:"调试类型",align:"center",width:100,render:n=>{if(n.dtype===null)return null;const f=T(Jl[n.dtype]);return a(ut,{type:n.dtype==0?"warning":n.dtype==1?"success":"info"},pa(f)?f:{default:()=>[f]})}},{key:"debugs",title:"统计数量信息",align:"center",width:160,render(n){const f=(ke,Ce,ve)=>{const Je=ve>0;return r("div",{style:`
                    cursor: ${Je?"pointer":"default"};
                    color: ${Je?"#1890ff":"#999"};
                    font-size:13px;
                  `,onClick:()=>Je&&ge(Ce,n)},`${ke}：${ve}`)};return r("div",{style:"display:flex; flex-direction:column; gap:1px;"},[f("调试任务","business",n.debugs),f("项目总结","projectsummary",n.summarys),f("日报数量","daylog",n.dailys)])}},{key:"businesscon",title:"商务联系人",align:"center",width:200,render(n){return a("div",null,[n.businesscon||"-"])}},{key:"dbtime",title:"创建时间",align:"left",width:200,render(n){return a("div",null,[n.dbtime||"-"])}},{key:"operate",title:T("common.operate"),align:"center",width:320,fixed:"right",render:n=>{let f;return a("div",{class:"flex justify-end gap-8px"},[a("div",{onClick:()=>Me(n),class:"cursor-pointer c-#1890ff mr-10px",title:"工程调试确认单"},[a(jl,{"local-icon":"icon_resLibrary",class:"font-size-24px"},null)]),n.status==-1&&(x.userInfo.usertype==0||x.userInfo.usertype==4||x.userInfo.id==1021||x.userInfo.id==1023)&&a(Te,{onPositiveClick:()=>k(n,0)},{default:()=>"确定核准该项目吗？",trigger:()=>a(y,{color:"#a43cf9",ghost:!0,size:"small"},{default:()=>["核准"]})}),n.status==0&&(x.userInfo.usertype==0||x.userInfo.usertype==2)&&a(Te,{onPositiveClick:()=>k(n,1)},{default:()=>"确定启动该项目吗？",trigger:()=>rt(a(y,{type:"success",ghost:!0,size:"small"},{default:()=>["启动"]}),[[xt("no-auth"),"project:Info:update"]])}),n.status==2&&(x.userInfo.usertype==0||x.userInfo.usertype==2)&&a(Te,{onPositiveClick:()=>k(n,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>rt(a(y,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[xt("no-auth"),"project:Info:update"]])}),a(y,{type:"primary",ghost:!0,size:"small",onClick:()=>He(n)},{default:()=>["详情"]}),a(y,{type:"primary",ghost:!0,size:"small",onClick:()=>Be(n)},{default:()=>["关联合同"]}),rt(a(y,{type:"primary",ghost:!0,size:"small",onClick:()=>M(n.id)},pa(f=T("common.edit"))?f:{default:()=>[f]}),[[xt("no-auth"),"project:Info:update"]])])}}]}),{drawerVisible:pe,operateType:Ee,editingData:z,handleAdd:H,handleEdit:Pe,checkedRowKeys:q,onBatchDeleted:$}=El(he,E);async function g(){console.log(q.value),P(q.value.join(","),n=>{$()})}const k=async(n,f)=>{var ve;const{data:ke,error:Ce}=await ka([{id:n.id,status:f}]);Ce||((ve=window.$message)==null||ve.success("操作成功"),E(),f==3&&window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:n.pid,type:"prj"}})))},Ie=()=>{H(),z.value=void 0};function M(n){Pe(n)}async function P(n,f){const{data:ke,error:Ce}=await Al(n);if(!Ce)f&&f(ke);else return!1}const _e=_(!1),fe=_(0),me=_(""),Be=n=>{_e.value=!0,fe.value=n.id,me.value=n.proname},Oe=_(!1),Me=n=>{Oe.value=!0,fe.value=n.id},tt=n=>{K.status=n.status,E()},S=n=>{console.log(n),n.columnKey=="progess"&&(K.sort=n.order=="ascend"?0:n.order=="descend"?1:void 0,E())},h=_(1),Re=n=>{h.value=n,n==0?E():Ye()},He=n=>{te.push("/projectmanagement/orderdetail?prjId="+n.id+"&pname="+n.proname),x.setProjectInfo({pid:n.id,pname:n.proname})},ge=(n,f)=>{te.push(`/projectmanagement/${n}?prjId=`+f.id+"&pname="+f.proname),x.setProjectInfo({pid:f.id,pname:f.proname})},Ae=()=>{E()};$l(()=>{x.userInfo.usertype==1&&(h.value=0),J.query.pname?(h.value=0,K.fuzzy=J.query.pname,K.status=2,Ae(),E()):Ye()}),Dt(()=>J.query.pname,n=>{n&&!J.query.prjId&&(K.fuzzy=n,h.value=0,E())});const xe=[{key:"proname",width:320,title(){return a("div",{class:"font-size-16px font-bold"},[v("近期项目")])},ellipsis:{tooltip:!0},render:n=>{if(n.status===null)return null;const f=T(da[n.status]);return a("div",null,[a(Nl,{placement:"top",trigger:"hover"},{trigger:()=>a("div",{class:"cursor-pointer text-ellipsis overflow-hidden whitespace-nowrap font-bold",onClick:()=>He(n),style:"max-width: 300px;"},[n.proname||"-"]),default:()=>n.proname||"-"}),a("div",{style:"display:flex; gap:3px; line-height:1.4;"},[a("div",{class:" flex"},[a("span",{style:"color:#666"},[v("进度：")]),a(ua,{type:"line",style:"width: 100px;",showIndicator:!0,percentage:n.progess,"indicator-placement":"inside",processing:!0,color:n.progess==100?"#22C55E":"#1890ff"},null)]),a("div",{class:" flex ml-8px"},[a("span",{style:"color:#666 flex"},[v("状态：")]),a("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:n.status===0?"#9ca3af":n.status===1?"#3B82F6":n.status===2?"#f1c40f":"#2ecc71",borderRadius:"50%"}},[a("span",{style:{width:"10px",height:"10px",marginRight:"5px",backgroundColor:n.status===0?"#9ca3af":n.status===1?"#3B82F6":n.status===2?"#f1c40f":"#2ecc71",borderRadius:"50%"}},null),a("span",null,[f])])])])])}},{key:"businesscon",title:"商务联系人",align:"center",width:100},{title:"最后打卡人",key:"clockinusername",align:"center",width:100},{title:"最后打卡时间",key:"lastclockintime",align:"center",width:180},{key:"clockincounts",title:"打卡信息",align:"left",width:200,render(n){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("打卡人数：")]),a("span",{style:"font-weight:500"},[n.clockincounts!=null?n.clockincounts+"人":"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("打卡人：")]),a("span",{style:" font-weight:500"},[n.clockinusers||"-"])])])}},{key:"debugname",title:"调试任务信息",align:"left",width:260,render(n){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("任务名称：")]),a("span",{style:"font-weight:500"},[n.debugname||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("状态：")]),a(ut,{size:"small",color:{color:n.debugstatus==-1?"rgba(251, 146, 60, 0.15)":n.debugstatus==0?"rgba(156, 163, 175, 0.15)":n.debugstatus==1?"rgba(59, 130, 246, 0.15)":n.debugstatus==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:n.debugstatus==-1?"#FB923C":n.debugstatus==0?"#9CA3AF":n.debugstatus==1?"#3B82F6":n.debugstatus==2?"#FACC15":"#10B981",borderColor:n.debugstatus==-1?"#FB923C":n.debugstatus==0?"#9CA3AF":n.debugstatus==1?"#3B82F6":n.debugstatus==2?"#FACC15":"#10B981"}},{default:()=>[n.debugstatus==-1?"申请中":n.debugstatus==0?"待调试":n.debugstatus==1?"开始调试":n.debugstatus==2?"待审核":"审核完成"]})])])}},{key:"username",title:"调试信息",align:"left",width:230,render(n){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("时间：")]),a("span",{style:" font-weight:500"},[n.dbdbtime||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("调试人：")]),a("span",{style:"font-weight:500"},[n.username||"-"])])])}},{title:"任务审核时间",key:"ckdbtime",width:180}],Q=et({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${Q.itemCount} 条`,onChange:n=>{Q.page=n,Ye()},onUpdatePageSize:n=>{Q.pageSize=n,Q.page=1,Ye()}}),ct=_([]),Ye=async()=>{const{data:n,error:f}=await Ll({page:Q.page,limit:Q.pageSize});f||(ct.value=n.list,Q.itemCount=n.total)},Ve=async n=>{var f;n&&(await navigator.clipboard.writeText(n),(f=window.$message)==null||f.success("已复制"))};return(n,f)=>{const ke=Yl,Ce=Il,ve=ye,Je=Ha,I=fa,at=Ka,Lt=zt,Ft=zt,pt=Ot,ft=xt("no-auth");return j(),Ct("div",mn,[h.value==0?(j(),V(un,{key:0,model:u(K),"onUpdate:model":f[0]||(f[0]=N=>kt(K)?K.value=N:null),onReset:Ae,onSearch:u(E)},null,8,["model","onSearch"])):ce("",!0),a(pt,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Fl({header:i(()=>[a(ve,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:i(()=>[f[7]||(f[7]=O("div",null,"项目列表",-1)),u(x).userInfo.usertype!==1?(j(),V(Ce,{key:0,size:"small",value:h.value,"onUpdate:value":[f[1]||(f[1]=N=>h.value=N),Re],name:"radiobuttongroup1"},{default:i(()=>[a(ke,{value:0,label:"默认"}),a(ke,{value:1,label:"近期项目"})]),_:1},8,["value"])):ce("",!0)]),_:1,__:[7]})]),default:i(()=>[h.value==0?(j(),V(Lt,{key:0,"checked-row-keys":u(q),"onUpdate:checkedRowKeys":f[3]||(f[3]=N=>kt(q)?q.value=N:null),columns:u(c),data:u(he),size:"small","flex-height":!u(se).isMobile,"scroll-x":u(c).reduce((N,qe)=>N+((qe==null?void 0:qe.width)||100),0),loading:u(be),remote:"","row-key":N=>N.id,"onUpdate:sorter":S,pagination:u(Fe),class:"sm:h-full","onUpdate:filters":tt},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"])):(j(),V(Ft,{key:1,ref:"tableContainer",class:"sm:h-full",remote:"",pagination:Q.pageSize==1?!1:Q,"scroll-x":xe.reduce((N,qe)=>N+(qe.width||100),0),columns:xe,data:ct.value,bordered:!1,"flex-height":!u(se).isMobile},null,8,["pagination","scroll-x","data","flex-height"])),a(rn,{visible:u(pe),"onUpdate:visible":f[4]||(f[4]=N=>kt(pe)?pe.value=N:null),onSubmitted:u(E),"operate-type":u(Ee),"row-data":u(z)},null,8,["visible","onSubmitted","operate-type","row-data"]),a(fn,{visable:_e.value,"onUpdate:visable":f[5]||(f[5]=N=>_e.value=N),id:fe.value,pname:me.value},null,8,["visable","id","pname"])]),_:2},[h.value==0?{name:"header-extra",fn:i(()=>[a(ve,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:i(()=>[rt((j(),V(u(y),{onClick:Ie,size:"small",ghost:"",type:"primary"},{icon:i(()=>[a(Je,{class:"text-icon"})]),default:i(()=>[f[8]||(f[8]=v(" "+Z("新增项目")))]),_:1,__:[8]})),[[ft,"project:Info:insert"]]),a(u(Te),{onPositiveClick:g},{trigger:i(()=>[rt((j(),V(u(y),{size:"small",ghost:"",type:"error",disabled:u(q).length==0},{icon:i(()=>[a(I,{class:Pl(["text-icon",{"animate-spin":u(be)}])},null,8,["class"])]),default:i(()=>[f[9]||(f[9]=v(" "+Z("批量删除")))]),_:1,__:[9]},8,["disabled"])),[[ft,"project:Info:delete"]])]),default:i(()=>[f[10]||(f[10]=v(" 确定要删除选中的合同吗？ "))]),_:1,__:[10]}),a(at,{columns:u(s),"onUpdate:columns":f[2]||(f[2]=N=>kt(s)?s.value=N:null),ctype:2},null,8,["columns"])]),_:1})]),key:"0"}:void 0]),1024),a(Hl,{visible:Oe.value,"onUpdate:visible":f[6]||(f[6]=N=>Oe.value=N),pid:fe.value},null,8,["visible","pid"])])}}}),En=wa(gn,[["__scopeId","data-v-46584af6"]]);export{En as default};
