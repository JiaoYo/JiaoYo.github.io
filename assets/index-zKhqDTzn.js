import{_ as ie}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DJiaUSHq.js";import{_ as ce}from"./round-delete-D08RP9Mo.js";import{_ as pe}from"./round-add-DPd766ea.js";import{d as K,aq as H,s as ue,r as Y,q as Z,a as de,ar as ee,a1 as me,c as G,o as q,w as o,f as e,b5 as fe,F as te,h as n,at as ae,A as O,N as A,B as j,g as D,t as z,$ as b,b6 as _e,E as ge,U as oe,L as he,i as ve,x as E,b as ye,az as R,av as be,C as V,bl as we,e as Ce,aC as xe}from"./index-CjT2nEe4.js";import{f as ne,g as ke,h as Ne,i as Q,j as je}from"./project-BTyWqk-e.js";import{u as De,a as Se}from"./table-CmDri__w.js";import{u as le}from"./usePageData-BkSU1bIm.js";import{_ as se}from"./Grid-lBZ8TlOT.js";import{_ as re}from"./FormItemGridItem-DGSFrPax.js";import{_ as ze}from"./round-search-CwHFW5K-.js";import{_ as Te}from"./round-refresh-Cg8BjYbD.js";import{N as W}from"./Popconfirm-DM29CaI7.js";const Pe=K({name:"OperateDrawer",__name:"operate-drawer",props:H({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(v,{emit:T}){const y=T,u=v,l=ue(r());function r(){return{pid:void 0,id:"",pname:"",pcontact:"",proposition:""}}const c=Y([]),{pageData:d,getData:w,nextPage:C}=le(ne),P=async s=>{const a=s.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&d.data.length<d.total&&(C(),c.value=d.data)},U=async()=>{var s,a;await w(),c.value=d.data,l.pid=(a=(s=c.value)==null?void 0:s[0])==null?void 0:a.id},L=async s=>{l.pid=s};async function B(){U(),Object.assign(l,r()),u.operateType==="edit"&&u.rowData&&Object.assign(l,u.rowData)}const{formRef:g,validate:S,restoreValidation:m}=Z(),p={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},pname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},proposition:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},pcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},F=de(()=>({add:"新增联系人",edit:"修改联系人"})[u.operateType]),f=ee(v,"visible");me(f,()=>{f.value&&(B(),setTimeout(()=>{const s=document.querySelector(".n-scrollbar-content");s==null||s.scrollTo(0,0)},300),m())});function x(){f.value=!1}async function $(){var s,a;if(await S(),u.operateType==="edit"){const{data:t,error:i}=await ke([l]);i||(x(),y("submitted"),(s=window.$message)==null||s.success("修改成功"))}else{const{data:t,error:i}=await Ne([{...l}]);i||(x(),y("submitted"),(a=window.$message)==null||a.success("添加成功"))}}return(s,a)=>{const t=re,i=se,k=te,M=fe,N=A,I=_e;return q(),G(I,{show:f.value,"onUpdate:show":a[4]||(a[4]=_=>f.value=_),title:F.value,preset:"card",class:"w-500px"},{footer:o(()=>[e(N,{justify:"end",size:16},{default:o(()=>[e(n(j),{onClick:x},{default:o(()=>[D(z(n(b)("common.cancel")),1)]),_:1}),e(n(j),{type:"primary",onClick:$},{default:o(()=>[D(z(n(b)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(M,{class:"pr-20px"},{default:o(()=>[e(k,{ref_key:"formRef",ref:g,model:l,rules:p,"label-placement":"left","label-width":120},{default:o(()=>[e(i,{responsive:"screen","item-responsive":""},{default:o(()=>[e(t,{span:"24 m:24",label:"项目列表",path:"pid"},{default:o(()=>[e(n(ae),{clearable:"",filterable:"",value:l.pid,"onUpdate:value":[a[0]||(a[0]=_=>l.pid=_),L],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:c.value,onScroll:P},null,8,["value","options"])]),_:1}),e(t,{span:"24 m:24",label:"姓名",path:"pname"},{default:o(()=>[e(n(O),{value:l.pname,"onUpdate:value":a[1]||(a[1]=_=>l.pname=_),placeholder:"请输入"},null,8,["value"])]),_:1}),e(t,{span:"24 m:24",label:"联系方式",path:"pcontact"},{default:o(()=>[e(n(O),{value:l.pcontact,"onUpdate:value":a[2]||(a[2]=_=>l.pcontact=_),placeholder:"请输入"},null,8,["value"])]),_:1}),e(t,{span:"24 m:24",label:"备注",path:"proposition"},{default:o(()=>[e(n(O),{value:l.proposition,"onUpdate:value":a[3]||(a[3]=_=>l.proposition=_),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ue=K({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:H(["reset","search","clear"],["update:model"]),setup(v,{emit:T}){const y=T,{formRef:u,restoreValidation:l}=Z(),r=ee(v,"model"),c=Y([]),{pageData:d,getData:w,nextPage:C}=le(ne),P=async m=>{const p=m.currentTarget;p.scrollTop+p.offsetHeight>=p.scrollHeight&&d.data.length<d.total&&(C(),c.value=d.data)},U=async m=>{r.value.pid=m};(async()=>{var m;await w(),c.value=d.data,r.value.pid=(m=c.value[0])==null?void 0:m.id,y("search")})();async function B(){await l(),r.value.fuzzy="",y("reset")}const g=()=>{r.value.fuzzy="",y("search")};async function S(){y("search")}return(m,p)=>{const F=ae,f=re,x=O,$=Te,s=j,a=ze,t=A,i=se,k=te,M=oe;return q(),G(M,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[e(k,{ref_key:"formRef",ref:u,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ge(S,["enter"])},{default:o(()=>[e(i,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[e(f,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:o(()=>[e(F,{filterable:"",value:r.value.pid,"onUpdate:value":[p[0]||(p[0]=N=>r.value.pid=N),U],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:c.value,onScroll:P},null,8,["value","options"])]),_:1}),e(f,{span:"24 s:12 m:6",label:"姓名",path:"fuzzy"},{default:o(()=>[e(x,{value:r.value.fuzzy,"onUpdate:value":p[1]||(p[1]=N=>r.value.fuzzy=N),placeholder:"请输入",clearable:"",onClear:g},null,8,["value"])]),_:1}),e(f,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[e(t,{class:"w-full"},{default:o(()=>[e(s,{onClick:B},{icon:o(()=>[e($,{class:"text-icon"})]),default:o(()=>[D(" "+z(n(b)("common.reset")),1)]),_:1}),e(s,{type:"primary",ghost:"",onClick:S},{icon:o(()=>[e(a,{class:"text-icon"})]),default:o(()=>[D(" "+z(n(b)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function X(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!xe(v)}const Ke=K({name:"projectmanagement_contact",__name:"index",setup(v){const T=he(),{columns:y,columnChecks:u,data:l,getData:r,loading:c,mobilePagination:d,searchParams:w}=De({showTotal:!0,immediate:!1,apiFn:je,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"pname",title:"姓名",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pcontact",title:"联系方式",align:"center",width:120},{key:"proposition",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:b("common.operate"),align:"center",width:140,fixed:"right",render:a=>{let t;return e("div",{class:"flex-center gap-8px"},[V(e(j,{type:"primary",ghost:!0,size:"small",onClick:()=>f(a.id)},X(t=b("common.edit"))?t:{default:()=>[t]}),[[E("no-auth"),"project:Contact:update"]]),e(W,{onPositiveClick:()=>F(a.id)},{default:()=>b("common.confirmDelete"),trigger:()=>{let i;return V(e(j,{type:"error",ghost:!0,size:"small"},X(i=b("common.delete"))?i:{default:()=>[i]}),[[E("no-auth"),"project:Contact:delete"]])}})])}}]}),{drawerVisible:C,operateType:P,editingData:U,handleAdd:L,handleEdit:B,checkedRowKeys:g,onBatchDeleted:S,onDeleted:m}=Se(l,r);ve(async()=>{});async function p(){console.log(g.value),x(g.value.join(","),a=>{S()})}async function F(a){const{data:t,error:i}=await Q(a);i||m()}function f(a){B(a)}async function x(a,t){const{data:i,error:k}=await Q(a);if(!k)t&&t(i);else return!1}const $=a=>{r()},s=()=>{r()};return(a,t)=>{const i=A,k=pe,M=ce,N=ie,I=be,_=oe,J=E("no-auth");return q(),ye("div",Be,[e(Ue,{model:n(w),"onUpdate:model":t[0]||(t[0]=h=>R(w)?w.value=h:null),onReset:s,onSearch:n(r),onClear:t[1]||(t[1]=h=>l.value=[])},null,8,["model","onSearch"]),e(_,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[e(i,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>t[5]||(t[5]=[Ce("div",null,"项目联系人",-1)])),_:1,__:[5]})]),"header-extra":o(()=>[e(i,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[V((q(),G(n(j),{onClick:n(L),size:"small",ghost:"",type:"primary"},{icon:o(()=>[e(k,{class:"text-icon"})]),default:o(()=>[t[6]||(t[6]=D(" "+z("新增")))]),_:1,__:[6]},8,["onClick"])),[[J,"project:Contact:insert"]]),e(n(W),{onPositiveClick:p},{trigger:o(()=>[V((q(),G(n(j),{size:"small",ghost:"",type:"error",disabled:n(g).length==0},{icon:o(()=>[e(M,{class:we(["text-icon",{"animate-spin":n(c)}])},null,8,["class"])]),default:o(()=>[t[7]||(t[7]=D(" "+z("批量删除")))]),_:1,__:[7]},8,["disabled"])),[[J,"project:Contact:delete"]])]),default:o(()=>[t[8]||(t[8]=D(" 确定要删除选中的联系人吗？ "))]),_:1,__:[8]}),e(N,{columns:n(u),"onUpdate:columns":t[2]||(t[2]=h=>R(u)?u.value=h:null)},null,8,["columns"])]),_:1})]),default:o(()=>[e(I,{"checked-row-keys":n(g),"onUpdate:checkedRowKeys":t[3]||(t[3]=h=>R(g)?g.value=h:null),columns:n(y),data:n(l),size:"small","flex-height":!n(T).isMobile,loading:n(c),remote:"","row-key":h=>h.id,pagination:n(d),class:"sm:h-full","onUpdate:filters":$},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Pe,{visible:n(C),"onUpdate:visible":t[4]||(t[4]=h=>R(C)?C.value=h:null),onSubmitted:n(r),"operate-type":n(P),"row-data":n(U)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{Ke as default};
