import{_ as ne}from"./round-add-D3WUtpeV.js";import{d as G,as as Q,p as O,c3 as se,s as le,r as U,at as W,a1 as ie,cl as re,x as K,c as C,o as p,w as e,f as o,au as de,b as T,y as B,F as X,z as ce,e as r,t as f,T as ue,C as R,h as s,A as pe,E as Y,cm as me,B as D,g as z,a5 as fe,a4 as _e,ay as ge,q as ve,U as Z,av as ye,N as ee,$ as M,ad as be,L as he,i as we,aB as A,cn as ke,ax as xe,aE as De}from"./index-GKZr6R-C.js";import{f as Ce,a as ze,b as Ne,_ as je,c as Se,d as Pe}from"./operate-drawer.vue_vue_type_style_index_0_lang-DwgcssLo.js";import{u as Le,a as $e}from"./table-VcDsA4zD.js";import{_ as Te}from"./Avatar-CC3_onkV.js";import{_ as Re}from"./text-DThrPT5n.js";import{N as te}from"./Popconfirm-C9ev1_yH.js";import{_ as Be}from"./round-search-DYdIbIbe.js";import{u as Fe}from"./usePageData-CFaE5rQl.js";import{_ as Ie}from"./Grid-C-96xXAi.js";import{_ as Me}from"./FormItemGridItem-Dlimnbl-.js";import"./v4-FuVw324d.js";const Ue={key:0},Ee={class:"mt-4 border-t pt-3"},Ve={class:"flex items-start gap-2 mb-3"},Ke={class:"ml-2 flex-1"},Ae={class:"flex items-center"},Ge={class:"font-medium font-size-16px font-bold"},Oe={class:"text-gray-600 mt-1"},qe=G({name:"drawerLog",__name:"drawerLog",props:Q({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(y){const E=O();se();const a=le({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0}),N=y,c={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},_=U({});async function g(){m.value=[],Object.assign(a,N.rowData);const n=JSON.parse(N.rowData.context);a.proname=n.proname,a.notes=n.notes,a.problem=n.problem,a.solutions=n.solutions,a.feedback=n.feedback,a.summarize=n.summarize,a.percent=n.percent,w()}const m=U([]),h=W(y,"visible");ie(h,()=>{h.value?g():(m.value=[],a.id=void 0)});function F(n){n||b()}function b(){h.value=!1}const w=async()=>{const{data:n,error:t}=await ze({page:1,limit:100,pid:a.id});n&&(m.value=n.list)},P=re.debounce(async()=>{var v;const n=_.value[a.id];if(!(n!=null&&n.trim()))return(v=window.$message)==null?void 0:v.warning("请输入评论内容");const{data:t,error:l}=await Ce([{pid:a.id,context:n}]);t&&(_.value[a.id]="",a.num++,w())},1e3,{leading:!0,trailing:!1}),V=async n=>{var v;const{data:t,error:l}=await Ne(n.id);t&&(w(),a.num--,(v=window.$message)==null||v.success("删除成功"))};return(n,t)=>{const l=ce,v=X,j=Te,I=Re,S=de,L=ge,$=K("no-auth");return p(),C(L,{show:h.value,"onUpdate:show":[t[1]||(t[1]=u=>h.value=u),F],"display-directive":"show",width:600,onMaskClick:b,onEsc:b},{default:e(()=>[o(S,{title:a.username+"的项目日报","native-scrollbar":!1,closable:""},{default:e(()=>[o(v,{ref:"formRef",model:a},{default:e(()=>[a.proname?(p(),C(l,{key:0,label:"项目名称",path:"proname","label-placement":"left"},{label:e(()=>t[2]||(t[2]=[r("div",{class:"font-size-16px font-bold"},"项目名称：",-1)])),default:e(()=>[r("span",null,f(a.proname),1)]),_:1})):B("",!0),o(l,{label:"当前工作内容及成果描述",path:"notes"},{label:e(()=>t[3]||(t[3]=[r("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述：",-1)])),default:e(()=>[r("span",null,f(a.notes),1)]),_:1}),o(l,{label:"遇到问题",path:"problem"},{label:e(()=>t[4]||(t[4]=[r("div",{class:"font-size-16px font-bold"},"遇到问题：",-1)])),default:e(()=>[r("span",null,f(a.problem),1)]),_:1}),o(l,{label:"解决措施",path:"solutions"},{label:e(()=>t[5]||(t[5]=[r("div",{class:"font-size-16px font-bold"},"解决措施：",-1)])),default:e(()=>[r("span",null,f(a.solutions),1)]),_:1}),o(l,{label:"建议意见反馈",path:"feedback"},{label:e(()=>t[6]||(t[6]=[r("div",{class:"font-size-16px font-bold"},"建议意见反馈：",-1)])),default:e(()=>[r("span",null,f(a.feedback),1)]),_:1}),o(l,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:e(()=>t[7]||(t[7]=[r("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感：",-1)])),default:e(()=>[r("span",null,f(a.summarize),1)]),_:1})]),_:1},8,["model"]),a.num?(p(),T("div",Ue,f(a.num)+"评论",1)):B("",!0),o(ue,{name:"fade"},{default:e(()=>[r("div",Ee,[R((p(),T("div",Ve,[r("div",null,[o(j,{size:"small",src:c.avatar},null,8,["src"])]),o(s(pe),{type:"textarea",id:`comment-input-${a.id}`,value:_.value[a.id],"onUpdate:value":t[0]||(t[0]=u=>_.value[a.id]=u),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:Y(me(s(P),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),o(s(D),{type:"primary",ghost:"",onClick:s(P)},{default:e(()=>t[8]||(t[8]=[z("发送")])),_:1,__:[8]},8,["onClick"])])),[[$,"project:Comment:insert"]]),(p(!0),T(fe,null,_e(m.value,u=>(p(),T("div",{key:u.id,class:"flex mb-3"},[o(j,{size:"small",src:c.avatar},null,8,["src"]),r("div",Ke,[r("div",Ae,[r("span",Ge,f(u.username),1),o(I,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:e(()=>[z(f(u.dbtime),1)]),_:2},1024),s(E).userInfo.id==u.creater?(p(),C(s(te),{key:0,onPositiveClick:d=>V(u)},{trigger:e(()=>[R((p(),C(s(D),{quaternary:"",type:"error",size:"small"},{default:e(()=>t[9]||(t[9]=[z(" 删除 ")])),_:1,__:[9]})),[[$,"project:Comment:delete"]])]),default:e(()=>[t[10]||(t[10]=z(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):B("",!0)]),r("div",Oe,f(u.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),He=G({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["reset","search","clear"],["update:model"]),setup(y,{emit:E}){const a=E,{formRef:N}=ve(),c=W(y,"model");O();const _=U([]),{pageData:g,getData:m,nextPage:h}=Fe(be),F=async t=>{const l=t.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&g.data.length<g.total&&(h(),_.value=g.data)},b=async t=>{t&&(c.value.pid=t),a("search")},w=async t=>{await m({fuzzy:t}),_.value=g.data},P=async()=>{await m(),_.value=g.data};(async()=>{await m(),_.value=g.data,a("search")})();async function n(){a("search")}return(t,l)=>{const v=ye,j=Me,I=Be,S=D,L=ee,$=Ie,u=X,d=Z;return p(),C(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:e(()=>[o(u,{ref_key:"formRef",ref:N,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Y(n,["enter"])},{default:e(()=>[o($,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:e(()=>[o(j,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:e(()=>[o(v,{filterable:"",clearable:"",value:c.value.pid,"onUpdate:value":[l[0]||(l[0]=i=>c.value.pid=i),b],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:_.value,onScroll:F,onClear:P,onSearch:w},null,8,["value","options"])]),_:1}),o(j,{span:"24  s:12 m:6",class:"pr-24px"},{default:e(()=>[o(L,{class:"w-full"},{default:e(()=>[o(S,{type:"primary",ghost:"",onClick:n},{icon:e(()=>[o(I,{class:"text-icon"})]),default:e(()=>[z(" "+f(s(M)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Qe={key:0};function J(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!De(y)}const rt=G({name:"projectmanagement_daylog",__name:"index",props:{pid:{default:void 0},type:{}},emits:["thereIsData"],setup(y,{emit:E}){const a=he(),N=O(),c=y,{columns:_,data:g,getData:m,loading:h,mobilePagination:F,searchParams:b}=Le({showTotal:!0,immediate:!1,apiFn:Se,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:d=>o("div",null,[d.username+"的项目日报"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:M("common.operate"),align:"center",width:140,fixed:"right",render:d=>{let i;return o("div",{class:"flex-center gap-8px"},[o(D,{type:"primary",ghost:!0,size:"small",onClick:()=>$(d)},{default:()=>[z("查看详情")]}),N.userInfo.id==d.creater&&R(o(D,{type:"primary",ghost:!0,size:"small",onClick:()=>I(d.id)},J(i=M("common.edit"))?i:{default:()=>[i]}),[[K("no-auth"),"project:DailyReport:update"]]),N.userInfo.id==d.creater&&o(te,{onPositiveClick:()=>j(d.id)},{default:()=>M("common.confirmDelete"),trigger:()=>{let x;return R(o(D,{type:"error",ghost:!0,size:"small"},J(x=M("common.delete"))?x:{default:()=>[x]}),[[K("no-auth"),"project:DailyReport:delete"]])}})])}}]}),{drawerVisible:w,operateType:P,editingData:V,handleAdd:n,handleEdit:t,checkedRowKeys:l,onDeleted:v}=$e(g,m);async function j(d){const{data:i,error:x}=await Pe(d);x||v()}function I(d){t(d)}const S=U(!1),L=U({}),$=d=>{S.value=!0,L.value=d},u=()=>{m()};return we(()=>{c.type!="externalLiaison"}),(d,i)=>{const x=ee,q=ne,ae=xe,oe=Z,H=K("no-auth");return p(),T("div",Je,[c.pid?B("",!0):(p(),C(He,{key:0,model:s(b),"onUpdate:model":i[0]||(i[0]=k=>A(b)?b.value=k:null),onReset:u,onSearch:s(m)},null,8,["model","onSearch"])),o(oe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},ke({header:e(()=>[o(x,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:e(()=>[c.pid?B("",!0):(p(),T("div",Qe,"项目日报"))]),_:1}),c.pid?R((p(),C(s(D),{key:0,onClick:s(n),size:"small",ghost:"",type:"primary"},{icon:e(()=>[o(q,{class:"text-icon"})]),default:e(()=>[i[4]||(i[4]=z(" "+f("新增")))]),_:1,__:[4]},8,["onClick"])),[[H,"project:DailyReport:insert"]]):B("",!0)]),default:e(()=>[o(ae,{"checked-row-keys":s(l),"onUpdate:checkedRowKeys":i[1]||(i[1]=k=>A(l)?l.value=k:null),columns:s(_),data:s(g),size:"small","flex-height":!s(a).isMobile,loading:s(h),remote:"","row-key":k=>k.id,pagination:s(F),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),o(je,{visible:s(w),"onUpdate:visible":i[2]||(i[2]=k=>A(w)?w.value=k:null),onSubmitted:s(m),"operate-type":s(P),pid:c.pid||s(b).pid,"row-data":s(V)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),o(qe,{visible:S.value,"onUpdate:visible":i[3]||(i[3]=k=>S.value=k),"row-data":L.value},null,8,["visible","row-data"])]),_:2},[c.pid?void 0:{name:"header-extra",fn:e(()=>[o(x,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:e(()=>[R((p(),C(s(D),{onClick:s(n),size:"small",ghost:"",type:"primary"},{icon:e(()=>[o(q,{class:"text-icon"})]),default:e(()=>[i[5]||(i[5]=z(" "+f("新增")))]),_:1,__:[5]},8,["onClick"])),[[H,"project:DailyReport:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{rt as default};
