import{_ as Xe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Bv9tlAlp.js";import{_ as Ye}from"./round-delete-B_8F17d_.js";import{_ as Ze}from"./round-add-DT_ryrzO.js";import{_ as et}from"./correct-BgRHRbIB.js";import{d as ke,av as _e,z as Se,D as tt,s as z,aJ as he,A as qe,a as at,ax as Te,at as lt,cU as $e,cV as nt,c as p,o as d,w as l,f as a,a3 as ot,M as Pe,G as w,h as o,au as re,H as N,bf as st,aB as rt,aC as it,g as f,b as ie,e as R,t as U,az as ut,B as T,aA as dt,J as xe,$ as O,a4 as ct,cx as Be,aE as be,cL as pt,cW as mt,aG as ft,cX as vt,L as gt,a2 as Fe,aI as yt,i as _t,F as ge,aK as me,ay as ht,I as se,aL as bt,cY as ze,cy as wt,n as J,aQ as kt}from"./index-BHYK3A_G.js";import{u as xt,a as Ct}from"./table-B6LlmD7Q.js";import{h as Ue}from"./permission-BBP7PMT_.js";import{u as we}from"./usePageData-BU1qqIQs.js";import{N as Dt}from"./Cascader-xi9pWh20.js";import{_ as Le}from"./Grid-B2A8-T_X.js";import{_ as Ie}from"./FormItemGridItem-C5bXUl4-.js";import{_ as zt}from"./round-search-Cl9yVEe0.js";import{_ as Ut}from"./round-refresh-DtTh3Oti.js";import{N as ye}from"./Popconfirm-CZ_7v-Ns.js";const Nt={key:0,style:{"margin-left":"20px"}},St={key:0,style:{"margin-left":"20px"}},qt={key:0,style:{"margin-left":"20px"}},Tt={key:0,style:{"margin-left":"20px"}},$t=ke({name:"OperateDrawer",__name:"operate-drawer",props:_e({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:_e(["submitted"],["update:visible"]),setup(F,{emit:Z}){const S=Z,G=Se(),g=F,t=tt($());function $(){return{pid:void 0,cid:void 0,contractId:void 0,id:"",devname:"",devmodel:"",devunit:"",devnum:0,notes:"",etype:0,devmanu:"",status:0,manucontact:"",manuinfo:"",devstatus:1,install:1,connectionmode:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const y=z([]),{pageData:_,getData:C,nextPage:V}=we(Be),ee=async n=>{const e=n.currentTarget,i=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&_.data.length<_.total&&(await V(),y.value=_.data,await be(),setTimeout(()=>{e.scrollTop=i}))},te=he.debounce(async n=>{await C({fuzzy:n,page:1}),y.value=_.data},300),H=z(!1),L=z(!1),q=n=>{if(t.pid=null,H.value=!0,L.value=!1,!n){Q();return}te(n)},ae=async()=>{H.value&&!L.value&&(await C({page:1}),y.value=_.data,H.value=!1)},Q=async()=>{await C({page:1}),y.value=_.data},W=async()=>{var n,e;await C({fuzzy:G.userInfo.pname,page:1}),t.pid=g.pid?g.pid:(n=_.data[0])==null?void 0:n.id,y.value=_.data,await u(),t.contractId=(e=r.value[0])==null?void 0:e.id,m()},X=z([]),j=z(),{pageData:A,getData:Y,nextPage:v}=we(pt),m=async(n=t.contractId)=>{await Y({pids:n}),j.value=[],X.value=Array.from(new Set([...X.value,...A.data])),j.value=A.data.map(e=>({label:e.devname,value:e.id}))},P=async n=>{var e;t.pid=n,await u(),t.contractId=(e=r.value[0])==null?void 0:e.id,await m(),L.value=!0,t.cid=null},r=z([]),u=async()=>{var i;const{data:n,error:e}=await mt({id:t.pid,limit:100,page:1});if((n==null?void 0:n.list.length)==0)return(i=window.$message)==null?void 0:i.warning("该项目没有绑定合同,暂不可添加设备");r.value=n==null?void 0:n.list.map(b=>({value:b.id,label:b.contractname,isLeaf:!1}))},h=z(),B=async n=>{t.cid=n;const e=X.value.find(i=>i.id==n);t.devname=e==null?void 0:e.devname,t.devnum=e==null?void 0:e.devcount,h.value=e==null?void 0:e.devcount,t.etype=e==null?void 0:e.devtype,t.devmanu=e==null?void 0:e.devmanu,t.notes=e==null?void 0:e.notes,t.devmodel=((e==null?void 0:e.devmodel.length)>64?e==null?void 0:e.devname:e==null?void 0:e.devmodel)||"",t.devunit=e==null?void 0:e.devunit},c=z(0),k=z("");async function M({file:n},e){c.value=0,k.value=e;const i=await ft(n.file,n.name,"",b=>{c.value=b});i&&(t[e]=i,c.value=0)}async function le(){var n;if(await W(),Object.assign(t,$()),g.operateType==="add"&&(t.pid=g.pid),g.operateType==="edit"&&g.rowData){Object.assign(t,g.rowData),h.value=(n=A.data.find(b=>b.id==t.cid))==null?void 0:n.devcount;const{data:e,error:i}=await vt(t.cid);i||r.value.push({value:e.id,label:e.devname,disabled:!0,isLeaf:!0,hidden:!0})}}const{formRef:ne,validate:I,restoreValidation:D}=qe(),K={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},contractId:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},cid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devmodel:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devnum:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},devunit:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},manucontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},manuinfo:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devstatus:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},connectionmode:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},install:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},devmanu:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},Ee=async n=>{var e;await m(n.value),n.children=(e=j.value)==null?void 0:e.map(i=>({label:i.label,value:i.value,isLeaf:!0}))},Re=at(()=>({add:"新增设备",edit:"修改设备"})[g.operateType]),oe=Te(F,"visible"),je=async n=>{if(n){await be();const e=document.querySelector(".n-cascader-menu");e&&(e.removeEventListener("scroll",Ce),e.addEventListener("scroll",Ce))}},fe=z(!1),Ae=z(!0),Ce=async n=>{const e=n.target;e.scrollHeight-e.scrollTop-e.clientHeight<10&&!fe.value&&Ae.value&&(fe.value=!0,v(),j.value=A.data.map(b=>({label:b.devname,value:b.id})),fe.value=!1)};lt(oe,()=>{oe.value&&(le(),setTimeout(()=>{const n=document.querySelector(".n-scrollbar-content");n==null||n.scrollTo(0,0)},300),D())});async function ue(n){if(n)try{const i=await(await fetch(n==null?void 0:n.split("?")[0],{mode:"cors"})).blob(),b=URL.createObjectURL(i),E=document.createElement("a");E.href=b,E.download=n==null?void 0:n.split("?")[1],E.style.display="none",document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(b)}catch(e){console.error("下载失败:",e)}}function ve(){oe.value=!1}const Me=he.debounce(async()=>{await Oe()},1e3,{leading:!0,trailing:!1});async function Oe(){var n,e;if(await I(),g.operateType==="edit"){const{data:i,error:b}=await $e([t]);b||(ve(),S("submitted"),(n=window.$message)==null||n.success("修改成功"))}else{const{data:i,error:b}=await nt([{...t}]);b||(ve(),S("submitted"),(e=window.$message)==null||e.success("添加成功"))}}async function de(n){var e;return n.file.file.size>100*1024*1024?((e=window.$message)==null||e.error("文件大小不能超过100M"),!1):!0}const Ge=n=>n.hidden?null:n.label,Ve=n=>n.option.hidden?null:n.node;return(n,e)=>{const i=Ie,b=Dt,E=it,He=rt,ce=ut,pe=dt,De=Le,Ke=Pe,Je=ot,Qe=xe,We=ct;return d(),p(We,{show:oe.value,"onUpdate:show":e[27]||(e[27]=s=>oe.value=s),title:Re.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:l(()=>[a(Qe,{justify:"end",size:16},{default:l(()=>[a(o(T),{onClick:ve},{default:l(()=>[f(U(o(O)("common.cancel")),1)]),_:1}),a(o(T),{type:"primary",onClick:o(Me)},{default:l(()=>[f(U(o(O)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:l(()=>[a(Je,{class:"pr-20px"},{default:l(()=>[a(Ke,{ref_key:"formRef",ref:ne,model:t,rules:K,"label-placement":"left","label-width":120},{default:l(()=>[a(De,{responsive:"screen","item-responsive":""},{default:l(()=>[a(i,{span:"24 m:12",label:"项目列表",path:"pid"},{default:l(()=>[a(o(re),{clearable:"",filterable:"",value:t.pid,"onUpdate:value":[e[0]||(e[0]=s=>t.pid=s),P],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:Q,onSearch:q,onBlur:ae,options:y.value,onScroll:ee},null,8,["value","options"])]),_:1}),a(i,{span:"24 m:12",label:"绑定合同设备",path:"cid"},{default:l(()=>[a(b,{value:t.cid,"onUpdate:value":[e[1]||(e[1]=s=>t.cid=s),B],placeholder:"请选择合同设备",options:r.value,"render-label":Ge,"render-suffix":Ve,"check-strategy":"child","show-path":!1,labelKey:"label",remote:"","on-load":Ee,"onUpdate:show":je},null,8,["value","options"])]),_:1}),t.cid?(d(),p(i,{key:0,span:"24 m:12",label:"设备名称",path:"devname"},{default:l(()=>[a(o(N),{value:t.devname,"onUpdate:value":e[2]||(e[2]=s=>t.devname=s),clearable:"",placeholder:"请输入"},null,8,["value"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:1,span:"24 m:12",label:"数量",path:"devnum"},{default:l(()=>[a(o(st),{value:t.devnum,"onUpdate:value":e[3]||(e[3]=s=>t.devnum=s),placeholder:"请输入",max:h.value,style:{width:"100%"}},null,8,["value","max"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:2,span:"24 m:12",label:"设备单位",path:"devunit"},{default:l(()=>[a(o(N),{value:t.devunit,"onUpdate:value":e[4]||(e[4]=s=>t.devunit=s),placeholder:"请输入",readonly:""},null,8,["value"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:3,span:"24 m:12",label:"型号",path:"devmodel"},{default:l(()=>[a(o(N),{value:t.devmodel,"onUpdate:value":e[5]||(e[5]=s=>t.devmodel=s),placeholder:"请输入",readonly:""},null,8,["value"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:4,span:"24 m:12",label:"是否为我司设备",path:"etype"},{default:l(()=>[a(He,{value:t.etype,"onUpdate:value":e[6]||(e[6]=s=>t.etype=s),name:"radiogroup",disabled:""},{default:l(()=>[a(E,{value:0},{default:l(()=>e[28]||(e[28]=[f("是")])),_:1,__:[28]}),a(E,{value:1},{default:l(()=>e[29]||(e[29]=[f("否")])),_:1,__:[29]})]),_:1},8,["value"])]),_:1})):w("",!0),g.operateType=="edit"?(d(),p(i,{key:5,span:"24 m:12",label:"清点状态",path:"status"},{default:l(()=>[a(o(re),{clearable:"",value:t.status,"onUpdate:value":e[7]||(e[7]=s=>t.status=s),placeholder:"请选择",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}]},null,8,["value"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:6,span:"24 m:12",label:"设备状态",path:"devstatus"},{default:l(()=>[a(o(re),{clearable:"",value:t.devstatus,"onUpdate:value":e[8]||(e[8]=s=>t.devstatus=s),placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}]},null,8,["value"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:7,span:"24 m:12",label:"设备厂家",path:"devmanu"},{default:l(()=>[a(o(N),{value:t.devmanu,"onUpdate:value":e[9]||(e[9]=s=>t.devmanu=s),placeholder:"请输入"},null,8,["value"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:8,span:"24 m:12",label:"厂家联系人",path:"manucontact"},{default:l(()=>[a(o(N),{value:t.manucontact,"onUpdate:value":e[10]||(e[10]=s=>t.manucontact=s),placeholder:"请输入"},null,8,["value"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:9,span:"24 m:12",label:"厂家联系方式",path:"manuinfo"},{default:l(()=>[a(o(N),{value:t.manuinfo,"onUpdate:value":e[11]||(e[11]=s=>t.manuinfo=s),placeholder:"请输入"},null,8,["value"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:10,span:"24 m:12",label:"接线方式",path:"connectionmode"},{default:l(()=>[a(o(N),{value:t.connectionmode,"onUpdate:value":e[12]||(e[12]=s=>t.connectionmode=s),placeholder:"请输入"},null,8,["value"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:11,span:"24 m:12",label:"是否安装就位",path:"install"},{default:l(()=>[a(o(re),{value:t.install,"onUpdate:value":e[13]||(e[13]=s=>t.install=s),placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}]},null,8,["value"])]),_:1})):w("",!0),t.cid?(d(),p(i,{key:12,span:"24 m:12",label:"备注",path:"notes"},{default:l(()=>[a(o(N),{value:t.notes,"onUpdate:value":e[14]||(e[14]=s=>t.notes=s),placeholder:"请输入"},null,8,["value"])]),_:1})):w("",!0),a(i,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:l(()=>[a(De,{responsive:"screen","item-responsive":""},{default:l(()=>[a(i,{span:"24 m:12",label:"附件1",path:"notes"},{default:l(()=>[a(o(N),{value:t.re1,"onUpdate:value":e[15]||(e[15]=s=>t.re1=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var s;return[t.fl1?(d(),ie("span",Nt,[f(U((s=t.fl1)==null?void 0:s.split("?")[1])+" ",1),R("span",{class:"cursor-pointer c-#c92a2a",onClick:e[16]||(e[16]=x=>t.fl1="")},"删除"),R("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[17]||(e[17]=x=>ue(t.fl1))},"下载")])):(d(),p(ce,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":x=>M(x,"fl1"),"show-file-list":!1,onBeforeUpload:de},{default:l(()=>[a(o(T),{loading:c.value>0&&!t.fl1&&k.value=="fl1",size:"small",ghost:"",type:"primary"},{default:l(()=>[f(U(c.value>0&&!t.fl1&&k.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),c.value&&!t.fl1&&k.value=="fl1"?(d(),p(pe,{key:2,type:"line",percentage:c.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):w("",!0)]}),_:1})]),_:1})]),_:1}),a(i,{span:"24 m:12",label:"附件2",path:"notes"},{default:l(()=>[a(o(N),{value:t.re2,"onUpdate:value":e[18]||(e[18]=s=>t.re2=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var s;return[t.fl2?(d(),ie("span",St,[f(U((s=t.fl2)==null?void 0:s.split("?")[1])+" ",1),R("span",{class:"cursor-pointer c-#c92a2a",onClick:e[19]||(e[19]=x=>t.fl2="")},"删除"),R("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[20]||(e[20]=x=>ue(t.fl2))},"下载")])):(d(),p(ce,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":x=>M(x,"fl2"),"show-file-list":!1,onBeforeUpload:de},{default:l(()=>[a(o(T),{loading:c.value>0&&!t.fl2&&k.value=="fl2",size:"small",ghost:"",type:"primary"},{default:l(()=>[f(U(c.value>0&&!t.fl2&&k.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),c.value&&!t.fl2&&k.value=="fl2"?(d(),p(pe,{key:2,type:"line",percentage:c.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):w("",!0)]}),_:1}),a(i,{span:"24 m:12",label:"附件3",path:"notes"},{default:l(()=>[a(o(N),{value:t.re3,"onUpdate:value":e[21]||(e[21]=s=>t.re3=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var s;return[t.fl3?(d(),ie("span",qt,[f(U((s=t.fl3)==null?void 0:s.split("?")[1])+" ",1),R("span",{class:"cursor-pointer c-#c92a2a",onClick:e[22]||(e[22]=x=>t.fl3="")},"删除"),R("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[23]||(e[23]=x=>ue(t.fl3))},"下载")])):(d(),p(ce,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":x=>M(x,"fl3"),"show-file-list":!1,onBeforeUpload:de},{default:l(()=>[a(o(T),{loading:c.value>0&&!t.fl3&&k.value=="fl3",size:"small",ghost:"",type:"primary"},{default:l(()=>[f(U(c.value>0&&!t.fl3&&k.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),c.value&&!t.fl3&&k.value=="fl3"?(d(),p(pe,{key:2,type:"line",percentage:c.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):w("",!0)]}),_:1}),a(i,{span:"24 m:12",label:"附件4",path:"notes"},{default:l(()=>[a(o(N),{value:t.re4,"onUpdate:value":e[24]||(e[24]=s=>t.re4=s),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var s;return[t.fl4?(d(),ie("span",Tt,[f(U((s=t.fl4)==null?void 0:s.split("?")[1])+" ",1),R("span",{class:"cursor-pointer c-#c92a2a",onClick:e[25]||(e[25]=x=>t.fl4="")},"删除"),R("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[26]||(e[26]=x=>ue(t.fl4))},"下载")])):(d(),p(ce,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":x=>M(x,"fl4"),"show-file-list":!1,onBeforeUpload:de},{default:l(()=>[a(o(T),{loading:c.value>0&&!t.fl4&&k.value=="fl4",size:"small",ghost:"",type:"primary"},{default:l(()=>[f(U(c.value>0&&!t.fl4&&k.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),c.value&&!t.fl4&&k.value=="fl4"?(d(),p(pe,{key:2,type:"line",percentage:c.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):w("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Pt=ke({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:_e(["reset","search","clear"],["update:model"]),setup(F,{emit:Z}){const S=Z,{formRef:G,restoreValidation:g}=qe(),t=Te(F,"model"),$=Se(),y=z([]),{pageData:_,getData:C,nextPage:V}=we(Be),ee=async v=>{const m=v.currentTarget,P=m.scrollTop;m.scrollTop+m.offsetHeight>=m.scrollHeight&&_.data.length<_.total&&(await V(),y.value=_.data,await be(),setTimeout(()=>{m.scrollTop=P}))},te=async v=>{var m;q.value=!0,v?(t.value.pid=v,S("search"),$.setProjectInfo({pname:(m=y.value.find(P=>P.id==v))==null?void 0:m.proname,pid:v})):S("clear")},H=he.debounce(async v=>{await C({fuzzy:v,page:1}),y.value=_.data},300),L=z(!1),q=z(!1),ae=v=>{if(t.value.pid=null,L.value=!0,q.value=!1,!v){W();return}H(v)},Q=async()=>{L.value&&!q.value&&(await C({page:1}),y.value=_.data,L.value=!1)},W=async()=>{await C({page:1}),y.value=_.data};(async()=>{var v,m;await C({fuzzy:$.userInfo.pname}),y.value=_.data,t.value.pid=$.userInfo.pid?$.userInfo.pid:(v=y.value[0])==null?void 0:v.id,t.value.pid&&($.setProjectInfo({pid:t.value.pid,pname:(m=y.value.find(P=>P.id==t.value.pid))==null?void 0:m.proname}),S("search"))})();async function j(){await g(),t.value.fuzzy="",S("reset")}const A=()=>{t.value.fuzzy="",S("search")};async function Y(){var v,m;t.value.pid?S("search"):((v=window.$message)==null||v.destroyAll(),(m=window.$message)==null||m.warning("请选择项目"))}return(v,m)=>{const P=re,r=Ie,u=N,h=Ut,B=T,c=zt,k=xe,M=Le,le=Pe,ne=Fe;return d(),p(ne,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[a(le,{ref_key:"formRef",ref:G,model:t.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:gt(Y,["enter"])},{default:l(()=>[a(M,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[a(r,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:l(()=>[a(P,{filterable:"",clearable:"",value:t.value.pid,"onUpdate:value":[m[0]||(m[0]=I=>t.value.pid=I),te],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:y.value,onScroll:ee,onClear:W,onSearch:ae,onBlur:Q},null,8,["value","options"])]),_:1}),a(r,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:l(()=>[a(u,{value:t.value.fuzzy,"onUpdate:value":m[1]||(m[1]=I=>t.value.fuzzy=I),placeholder:"请输入",clearable:"",onClear:A},null,8,["value"])]),_:1}),a(r,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[a(k,{class:"w-full"},{default:l(()=>[a(B,{onClick:j},{icon:l(()=>[a(h,{class:"text-icon"})]),default:l(()=>[f(" "+U(o(O)("common.reset")),1)]),_:1}),a(B,{type:"primary",ghost:"",onClick:Y},{icon:l(()=>[a(c,{class:"text-icon"})]),default:l(()=>[f(" "+U(o(O)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Bt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Ne(F){return typeof F=="function"||Object.prototype.toString.call(F)==="[object Object]"&&!kt(F)}const Qt=ke({name:"projectmanagement_device",__name:"index",setup(F){const Z=yt(),{columns:S,columnChecks:G,data:g,getData:t,loading:$,pagination:y,mobilePagination:_,searchParams:C}=xt({showTotal:!0,immediate:!1,apiFn:wt,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"devname",title:"设备名称",align:"center",width:180},{key:"devmodel",title:"型号",align:"center",width:160},{key:"devnum",title:"数量",align:"center",width:80},{key:"devunit",title:"设备单位",align:"center",width:100},{key:"etype",title:"是否为我司设备",align:"center",width:120,render(r){return J("div",{},r.etype==0?"是":"否")}},{key:"devmanu",title:"设备厂家",align:"center",width:100},{key:"status",title:"清点状态",align:"center",width:100,render(r){return J("div",{},r.status==0?"未清点":r.status==1?"正常":r.status==2?"增补":r.status==3?"退货":"换货")}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(r,u){return J("div",{},r.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(r,u){return J("div",{},r.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(r,u){return J("div",{},r.devstatus===0?"设备无异常":r.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(r,u){return J("div",{},r.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(r,u){return J("div",{},r.install===0?"是":"否")}},{key:"notes",title:"备注",align:"center",width:120},{key:"dusername",title:"清点信息",align:"left",width:200,render(r){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[f("清点人：")]),a("span",{style:"font-weight:500"},[r.dusername||"-"])]),a("div",null,[a("span",{style:"color:#666"},[f("时间：")]),a("span",{style:" font-weight:500"},[r.ddbtime||"-"])])])}},{key:"username",title:"创建信息",align:"left",width:200,render(r){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[f("创建人：")]),a("span",{style:"font-weight:500"},[r.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[f("时间：")]),a("span",{style:" font-weight:500"},[r.dbtime||"-"])])])}},{key:"operate",title:O("common.operate"),align:"center",width:Ue("project:Equipment:update")||Ue("project:Equipment:delete")?140:0,fixed:"right",render:r=>{let u;return a("div",{class:"flex-center gap-8px"},[se(a(T,{type:"primary",ghost:!0,size:"small",onClick:()=>j(r.id)},Ne(u=O("common.edit"))?u:{default:()=>[u]}),[[ge("no-auth"),"project:Equipment:update"]]),a(ye,{onPositiveClick:()=>X(r.id)},{default:()=>O("common.confirmDelete"),trigger:()=>{let h;return se(a(T,{type:"error",ghost:!0,size:"small"},Ne(h=O("common.delete"))?h:{default:()=>[h]}),[[ge("no-auth"),"project:Equipment:delete"]])}})])}}]}),{drawerVisible:V,operateType:ee,editingData:te,handleAdd:H,handleEdit:L,checkedRowKeys:q,onBatchDeleted:ae,onDeleted:Q}=Ct(g,t);_t(async()=>{});async function W(){console.log(q.value),A(q.value.join(","),r=>{ae()})}async function X(r){const{data:u,error:h}=await ze(r);h||Q()}function j(r){L(r)}async function A(r,u){const{data:h,error:B}=await ze(r);if(!B)u&&u(h);else return!1}const Y=()=>{g.value=[],y.itemCount=0},v=r=>{t()},m=()=>{t()},P=async()=>{var B;const r=g.value.map(c=>c.status==0?{id:c.id,status:1}:null).filter(c=>c!==null),{data:u,error:h}=await $e(r);h||((B=window.$message)==null||B.success("清点成功"),t())};return(r,u)=>{const h=xe,B=et,c=Ze,k=Ye,M=Xe,le=ht,ne=Fe,I=ge("no-auth");return d(),ie("div",Bt,[a(Pt,{model:o(C),"onUpdate:model":u[0]||(u[0]=D=>me(C)?C.value=D:null),onReset:m,onSearch:o(t),onClear:Y},null,8,["model","onSearch"]),a(ne,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[a(h,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>u[4]||(u[4]=[R("div",null,"待调试设备",-1)])),_:1,__:[4]})]),"header-extra":l(()=>[a(h,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>{var D;return[(D=o(g))!=null&&D.some(K=>K.status===0)?(d(),p(o(ye),{key:0,onPositiveClick:P},{trigger:l(()=>[se((d(),p(o(T),{size:"small",ghost:"",type:"primary"},{default:l(()=>[a(B,{class:"text-icon"}),u[5]||(u[5]=f(" 一键清点设备 "))]),_:1,__:[5]})),[[I,"project:Equipment:update"]])]),default:l(()=>[u[6]||(u[6]=f(" 确定要清点当前列表中未清点的设备吗？ "))]),_:1,__:[6]})):w("",!0),se((d(),p(o(T),{onClick:o(H),size:"small",ghost:"",type:"primary"},{icon:l(()=>[a(c,{class:"text-icon"})]),default:l(()=>[u[7]||(u[7]=f(" "+U("新增")))]),_:1,__:[7]},8,["onClick"])),[[I,"project:Equipment:insert"]]),a(o(ye),{onPositiveClick:W},{trigger:l(()=>[se((d(),p(o(T),{size:"small",ghost:"",type:"error",disabled:o(q).length==0},{icon:l(()=>[a(k,{class:bt(["text-icon",{"animate-spin":o($)}])},null,8,["class"])]),default:l(()=>[u[8]||(u[8]=f(" "+U("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[I,"project:Equipment:delete"]])]),default:l(()=>[u[9]||(u[9]=f(" 确定要删除选中的设备吗？ "))]),_:1,__:[9]}),a(M,{columns:o(G),"onUpdate:columns":u[1]||(u[1]=K=>me(G)?G.value=K:null)},null,8,["columns"])]}),_:1})]),default:l(()=>[a(le,{"checked-row-keys":o(q),"onUpdate:checkedRowKeys":u[2]||(u[2]=D=>me(q)?q.value=D:null),columns:o(S),data:o(g),size:"small","flex-height":!o(Z).isMobile,loading:o($),remote:"","row-key":D=>D.id,"scroll-x":o(S).reduce((D,K)=>D+(K.width||100),0),pagination:o(_),class:"sm:h-full","onUpdate:filters":v},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","scroll-x","pagination"]),a($t,{visible:o(V),"onUpdate:visible":u[3]||(u[3]=D=>me(V)?V.value=D:null),onSubmitted:o(t),pid:o(C).pid,"operate-type":o(ee),"row-data":o(te)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{Qt as default};
