import{_ as J}from"./refresh-CC9wQokF.js";import{d as q,q as X,a5 as Q,s as Z,x as ee,F as D,o as A,c as F,w as n,g as l,G as C,i as o,$ as g,Y as E,h as _,t as G,H as te,L as ae,a1 as le,B as x,P as W,Q as ne,af as Y,j as h,r as H,ax as K,D as se,e as oe,bn as re,ak as ie,al as ce,U as ue}from"./index-uWl0lIER.js";import{l as de,m as me,n as pe,o as fe}from"./common-CHTsvAd3.js";import{_ as _e,l as ge}from"./lodash-CX70KSBg.js";import{_ as he}from"./round-search-DfAfcfoj.js";import{_ as ve}from"./round-refresh-BwkPlWDE.js";import{C as ye,a as be}from"./common-CJCD7ubo.js";import{a as xe,T as ke}from"./basicconf-9tFEKmK9.js";import{_ as we}from"./FormItemGridItem-Cb7akj-q.js";import{_ as Ce}from"./Grid-BA1XrY0C.js";import{_ as $}from"./Popconfirm-BWtR0oNy.js";const ze=q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:X(["reset","search"],["update:model"]),setup(y,{emit:z}){const k=z,c=Q(),{formRef:M,restoreValidation:s}=Z(),i=ee(y,"model");function S(){i.value.fuzzy=void 0,k("search")}async function p(){await s(),k("reset")}async function d(){k("search")}const b=_e.throttle(d,1e3,{trailing:!1});return(O,f)=>{const R=ae,v=we,N=le,I=ve,m=x,T=he,U=W,B=Ce,L=ne,e=Y,t=D("no-space");return A(),F(e,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[l(L,{ref_key:"formRef",ref:M,model:i.value,"label-placement":"left","label-width":o(c).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:te(o(b),["enter"])},{default:n(()=>[l(B,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[l(v,{span:"24 s:12 m:8 l:6",label:"告警名称",path:"fuzzy"},{default:n(()=>[C(l(R,{autofocus:"",value:i.value.fuzzy,"onUpdate:value":f[0]||(f[0]=a=>i.value.fuzzy=a),placeholder:"请输入告警名称",clearable:"",onClear:S},null,8,["value"]),[[t]])]),_:1}),l(v,{span:"24 s:12 m:8 l:6",label:"告警状态",path:"status"},{default:n(()=>[l(N,{filterable:"",clearable:"",placeholder:o(g)("page.manage.alarm.form.status"),value:i.value.status,"onUpdate:value":[f[1]||(f[1]=a=>i.value.status=a),d],options:o(E)(o(ye))},null,8,["placeholder","value","options"])]),_:1}),l(v,{span:"24 s:12 m:8 l:6",label:"级别",path:"alevel"},{default:n(()=>[l(N,{filterable:"",clearable:"",placeholder:o(g)("page.manage.alarm.form.status"),value:i.value.alevel,"onUpdate:value":[f[2]||(f[2]=a=>i.value.alevel=a),d],options:o(E)(o(xe))},null,8,["placeholder","value","options"])]),_:1}),l(v,{span:"24 s:12 m:8 l:6"},{default:n(()=>[l(U,{class:"w-full flex items-center"},{default:n(()=>[l(m,{onClick:p},{icon:n(()=>[l(I,{class:"text-icon"})]),default:n(()=>[_(" "+G(o(g)("common.reset")),1)]),_:1}),l(m,{type:"primary",ghost:"",onClick:o(b)},{icon:n(()=>[l(T,{class:"text-icon"})]),default:n(()=>[_(" "+G(o(g)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width","onKeyup"])]),_:1})}}}),Se={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function j(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!ie(y)}const Ne=q({name:"platformalarm_systemalarm",__name:"index",setup(y){const z=h(window.innerHeight-360),k=Q();h(!1),h();const c=H({pageSize:100,pageId:void 0,status:void 0,fuzzy:void 0}),M=[{type:"selection",align:"center",width:48,fixed:"left"},{title:"",key:"index",width:80,align:"center",render:e=>`${e.index}`},{key:"aname",title:"告警名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"uname",title:"用户",align:"center",width:100,render:()=>"系统"},{key:"status",title:g("page.manage.alarm.status"),align:"center",width:120,render:e=>{(e.status===void 0||e.status===null)&&(e.status=0);const t={0:"error",1:"success"},a=g(be[e.status]);return l(K,{size:"small",type:t[e.status]},j(a)?a:{default:()=>[a]})}},{key:"dbtime",title:"发生时间",align:"center",width:180},{key:"alevel",title:"事件等级",align:"center",width:120,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},a=g(ke[e.alevel]);let u={color:t[e.alevel],textColor:"#ffffff",borderColor:t[e.alevel]};return l(K,{size:"small",color:u},j(a)?a:{default:()=>[a]})}},{key:"adec",title:"告警描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"operate",title:g("common.operate"),align:"center",width:130,fixed:"right",render:e=>l("div",{class:"flex-center gap-8px"},[e.status==0&&l($,{onPositiveClick:()=>v(e.id+"")},{default:()=>"确定要确认该告警数据吗？",trigger:()=>C(l(x,{type:"primary",ghost:!0,size:"small"},{default:()=>[_("确认")]}),[[D("no-auth"),"sys.system.alarm.update"]])}),l($,{onPositiveClick:()=>I(e.id+"")},{default:()=>"确定要删除该告警数据吗？",trigger:()=>C(l(x,{type:"error",ghost:!0,size:"small"},{default:()=>[_("删除")]}),[[D("no-auth"),"sys.system.alarm.delete"]])})])}],s=h([]),i=h(!1),S=h(0),p=h([]),d=async(e=!1)=>{if(!i.value)i.value=!0;else return;i.value=!0;const{data:t,error:a}=await fe(c);a||(S.value=t.length,e?s.value=[...s.value,...t]:s.value=t,s.value=s.value.map((u,r)=>(u.index=r+1,u)),i.value=!1)},b=h(!0),O=async()=>{s.value=[],c.pageId=void 0,(t=>Object.keys(t).filter(r=>r!=="limit"&&r!=="_t").some(r=>t[r]!==void 0&&t[r]!==""&&t[r]!==null))(c)?b.value=!1:(b.value=!0,T()),await d(),f()},f=async()=>{var e,t,a;if(s.value.length<z.value/44&&s.value.length<m.total){if(c.pageId==((e=s.value[s.value.length-1])==null?void 0:e.id))return;c.pageId=((a=(t=s.value)==null?void 0:t[s.value.length-1])==null?void 0:a.id)??void 0,d(!0)}};se(async()=>{await d(),await T(),f()});const R=()=>{v(p.value.join(","))},v=async e=>{var u,r;const{data:t,error:a}=await de({ids:e});a||(c.pageId=void 0,d(),(u=window.$message)==null||u.destroyAll(),(r=window.$message)==null||r.success("确认成功"),p.value=[])},N=()=>{I(p.value.join(","))},I=async e=>{var u,r;const{data:t,error:a}=await me({ids:e});a||(c.pageId=void 0,d(),(u=window.$message)==null||u.destroyAll(),(r=window.$message)==null||r.success("删除成功"))},m=H({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:t,page:a,pageSize:u,pageCount:r,itemCount:P}){return`已加载${s.value.length}条`+(s.value.length?b.value?` 共计 ${s.value.length>0?P??0:0} 条`:S.value==c.pageSize?"  预计还有更多":"  没有更多了":"")}});async function T(){const{data:e,error:t}=await pe();t||(m.pageCount=20,m.total=Number(e),m.itemCount=Number(e))}function U(e){var a;Math.abs(e.target.scrollTop+e.target.offsetHeight-e.target.scrollHeight)<=20&&m.total>((a=s.value)==null?void 0:a.length)&&B()}const B=ge.debounce(()=>{var e;((e=s.value)==null?void 0:e.length)<m.total&&(c.pageId=s.value[s.value.length-1].id,d(!0))},300),L=()=>{c.pageId=void 0,d()};return(e,t)=>{const a=J,u=W,r=ce,P=Y,V=D("no-auth");return A(),oe("div",Se,[l(ze,{model:c,"onUpdate:model":t[0]||(t[0]=w=>c=w),onSearch:O},null,8,["model"]),l(P,{title:"系统告警",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[l(u,null,{default:n(()=>[l(o($),{onPositiveClick:R},{trigger:n(()=>[C((A(),F(o(x),{size:"small",ghost:"",type:"primary",disabled:p.value.length===0},{default:n(()=>[_(" 批量确认 ")]),_:1},8,["disabled"])),[[V,"sys.system.alarm.update"]])]),default:n(()=>[_(" 确定要确认选中的数据吗？ ")]),_:1}),l(o($),{onPositiveClick:N},{trigger:n(()=>[C((A(),F(o(x),{size:"small",ghost:"",type:"error",disabled:p.value.length===0},{default:n(()=>[_(" 批量删除 ")]),_:1},8,["disabled"])),[[V,"sys.system.alarm.delete"]])]),default:n(()=>[_(" 确定要删除选中的数据吗？ ")]),_:1}),l(o(x),{size:"small",onClick:L},{icon:n(()=>[l(a,{class:re(["text-icon",{"animate-spin":i.value}])},null,8,["class"])]),default:n(()=>[_(" "+G(o(g)("common.refresh")),1)]),_:1})]),_:1})]),default:n(()=>[l(r,{columns:M,"checked-row-keys":p.value,"onUpdate:checkedRowKeys":t[1]||(t[1]=w=>p.value=w),data:s.value,size:"small","virtual-scroll":"","flex-height":!o(k).isMobile,loading:i.value,remote:"","row-key":w=>w.id,"max-height":z.value,pagination:m,onScroll:U,class:"sm:h-full","scroll-x":""},null,8,["checked-row-keys","data","flex-height","loading","row-key","max-height","pagination"])]),_:1})])}}}),Fe=ue(Ne,[["__scopeId","data-v-ab56b928"]]);export{Fe as default};
