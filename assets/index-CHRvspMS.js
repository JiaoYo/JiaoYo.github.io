import{_ as se}from"./refresh-av0Mcmzj.js";import{l as ie}from"./lodash-CYudMFH4.js";import{d as q,q as re,a4 as W,j as y,v as ce,s as ue,K as M,o as C,c as A,w as o,g as l,L as P,i,$ as p,Z as B,h as D,t as U,f as pe,e as j,am as me,N as de,M as fe,aA as _e,A as ge,a2 as ve,B as N,E as Z,D as he,ad as J,r as E,aq as F,br as ye,ah as xe,V as be}from"./index-7Q9xZuwa.js";import{f as ke,a as Te,b as Ce,c as De}from"./alarm-DEeg0M5u.js";import{_ as Se,a as we}from"./arrow-open-up-BX6Tp5j_.js";import{_ as Ae}from"./round-search-BQOA9W6m.js";import{_ as Ne}from"./round-refresh-DJiiF7wv.js";import{u as G}from"./usePageData-PYHx9xl8.js";import{C as ze,a as Le}from"./common-CMSF9tsk.js";import{f as $e}from"./audit-events-DYnXkmR2.js";import{a as Re,T as Ve}from"./basicconf-C0vqpl2m.js";import{_ as He}from"./FormItemGridItem-DYTXkfwP.js";import{_ as Ie}from"./DatePicker-CNtih3Cp.js";import{_ as Me}from"./Grid-CRtcNhSF.js";import{_ as K}from"./Popconfirm-BEMrdOuM.js";import{_ as Pe}from"./DataTable-n3fP4Loy.js";import"./TimePicker-BYx0IEL9.js";import"./defineProperty-B4q_dn_D.js";import"./Forward-BzUEeUAa.js";const Ue=q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:re(["reset","search"],["update:model"]),setup(x,{emit:z}){const b=z,m=W(),k=y(!1),{formRef:r,restoreValidation:d}=ce(),n=ue(x,"model"),{pageData:f,getData:S,nextPage:L}=G($e),_=async t=>{const a=t.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&f.data.length<f.total&&L()};S();const{pageData:T,getData:$,nextPage:R}=G(ke),v=async t=>{const a=t.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&T.data.length<T.total&&R()};$();async function V(t,a){t?(n.value.startTime=t[0],n.value.endTime=t[1]):(n.value.startTime=null,n.value.endTime=null),b("search")}function H(){n.value.fuzzy=void 0,b("search")}async function w(){await d(),n.value.timeRange=null,n.value.atype=null,n.value.alevel=null,n.value.alatype=null,n.value.apolicy=null,n.value.startTime=null,n.value.endTime=null,_e(()=>{b("search")})}async function e(){b("search")}return(t,a)=>{const u=ge,s=He,g=ve,I=Ne,h=N,Q=Ae,X=Se,Y=we,ee=Z,ae=Ie,te=Me,le=he,ne=J,oe=M("no-space");return C(),A(ne,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[l(le,{ref_key:"formRef",ref:r,model:n.value,"label-placement":"left","label-width":i(m).locale=="en-US"?120:80,"show-feedback":!1,onKeyup:fe(e,["enter"])},{default:o(()=>[l(te,{responsive:"screen","item-responsive":""},{default:o(()=>[l(s,{span:"24 s:12 m:6",label:"审计名称",path:"fuzzy",class:"pr-24px"},{default:o(()=>[P(l(u,{autofocus:"",value:n.value.fuzzy,"onUpdate:value":a[0]||(a[0]=c=>n.value.fuzzy=c),placeholder:"请输入审计名称",clearable:"",onClear:H},null,8,["value"]),[[oe]])]),_:1}),l(s,{span:"24 s:12 m:6",label:i(p)("page.manage.alarm.level"),path:"alevel",class:"pr-24px"},{default:o(()=>[l(g,{filterable:"",clearable:"",placeholder:i(p)("page.manage.alarm.form.level"),value:n.value.alevel,"onUpdate:value":[a[1]||(a[1]=c=>n.value.alevel=c),e],options:i(B)(i(Re))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),l(s,{span:"24 s:12 m:6",label:"告警状态",path:"alatype",class:"pr-24px"},{default:o(()=>[l(g,{filterable:"",clearable:"",placeholder:i(p)("page.manage.alarm.form.status"),value:n.value.alatype,"onUpdate:value":[a[2]||(a[2]=c=>n.value.alatype=c),e],options:i(B)(i(ze))},null,8,["placeholder","value","options"])]),_:1}),l(s,{span:"24 s:12 m:6",class:"pr-24px"},{default:o(()=>[l(ee,{class:"w-full flex items-center"},{default:o(()=>[l(h,{onClick:w},{icon:o(()=>[l(I,{class:"text-icon"})]),default:o(()=>[D(" "+U(i(p)("common.reset")),1)]),_:1}),l(h,{type:"primary",ghost:"",onClick:e},{icon:o(()=>[l(Q,{class:"text-icon"})]),default:o(()=>[D(" "+U(i(p)("common.search")),1)]),_:1}),pe("div",{class:"cursor-pointer",title:"精准查询",onClick:a[3]||(a[3]=c=>k.value=!k.value)},[k.value?(C(),A(X,{key:0,class:"text-icon"})):(C(),A(Y,{key:1,class:"text-icon"}))])]),_:1})]),_:1}),k.value?(C(),j(me,{key:0},[l(s,{span:"24 s:12 m:6",label:"审计类型",path:"atype",class:"pr-24px mt-20px"},{default:o(()=>[l(g,{value:n.value.atype,"onUpdate:value":[a[4]||(a[4]=c=>n.value.atype=c),e],placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:i(f).data,"reset-menu-on-options-change":!1,onScroll:_},null,8,["value","options"])]),_:1}),l(s,{span:"24 s:12 m:6",label:"告警策略",path:"apolicy",class:"pr-24px mt-20px"},{default:o(()=>[l(g,{value:n.value.apolicy,"onUpdate:value":[a[5]||(a[5]=c=>n.value.apolicy=c),e],placeholder:"请选择告警策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:i(T).data,"reset-menu-on-options-change":!1,onScroll:v},null,8,["value","options"])]),_:1}),l(s,{span:"24 s:24 m:8",label:"时间",path:"timeRange",class:"pr-24px mt-20px"},{default:o(()=>[l(ae,{clearable:"",value:n.value.timeRange,"onUpdate:value":a[6]||(a[6]=c=>n.value.timeRange=c),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":V},null,8,["value"])]),_:1})],64)):de("",!0)]),_:1})]),_:1},8,["model","label-width"])]),_:1})}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function O(x){return typeof x=="function"||Object.prototype.toString.call(x)==="[object Object]"&&!xe(x)}const Ee=q({name:"platformalarm_alarm",__name:"index",setup(x){const z=W(),b=y(window.innerHeight-395),m=E({limit:20,alatype:void 0,aname:void 0,pageId:void 0,alevel:void 0,atype:void 0,apolicy:void 0,startTime:void 0,endTime:void 0,_t:new Date().getTime()}),k=[{type:"selection",align:"center",width:48,fixed:"left"},{key:"aname",title:"审计名称",align:"center",minWidth:120,ellipsis:!0},{key:"alevel",title:"事件级别",align:"center",width:100,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=0);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},a=p(Ve[e.alevel]);let u={color:t[e.alevel],textColor:"#ffffff",borderColor:t[e.alevel]};return l(F,{size:"small",color:u},O(a)?a:{default:()=>[a]})}},{key:"pname",title:"审计类型",align:"center",minWidth:120},{key:"pname1",title:"告警策略",align:"center",minWidth:120},{key:"etol",title:"事件总数",align:"center",width:120},{key:"grtime",title:"产生时间",align:"center",width:160},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"alatype",title:p("page.manage.alarm.status"),align:"center",minWidth:120,render:e=>{e.alatype!==1&&(e.alatype=0);const t={0:"error",1:"success"},a=p(Le[e==null?void 0:e.alatype]);return l(F,{size:"small",type:t[e==null?void 0:e.alatype]},O(a)?a:{default:()=>[a]})}},{key:"operate",title:p("common.operate"),align:"center",width:130,fixed:"right",render:e=>e.alatype===0&&l("div",{class:"flex-center gap-8px"},[l(K,{onPositiveClick:()=>w([e.id])},{default:()=>"确定要确认改数据吗？",trigger:()=>P(l(N,{type:"error",ghost:!0,size:"small"},{default:()=>[D("确认")]}),[[M("no-auth"),"audit.alarm.update"]])})])}],r=y([]),d=y(!1),n=y(0),f=async(e=!1)=>{if(!d.value)d.value=!0;else return;d.value=!0;const{data:t,error:a}=await Ce(m);a||(n.value=t.length,e?r.value=[...r.value,...t]:r.value=t,d.value=!1)};f();const S=y(!0),L=()=>{r.value=[],m.pageId=void 0,(t=>Object.keys(t).filter(s=>s!=="limit"&&s!=="_t").some(s=>t[s]!==void 0&&t[s]!==""&&t[s]!==null))(m)?S.value=!1:(S.value=!0,T()),f()},_=E({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:t,page:a,pageSize:u,pageCount:s,itemCount:g}){return`已加载${r.value.length}条`+(r.value.length?S.value?` 共计 ${r.value.length>0?g??0:0} 条`:n.value==m.limit?"  预计还有更多":"  没有更多了":"")}});async function T(){const{data:e,error:t}=await De();t||(_.pageCount=20,_.total=Number(e),_.itemCount=Number(e))}T();function $(e){var t;e.target.scrollTop+e.target.offsetHeight==e.target.scrollHeight&&_.total>((t=r.value)==null?void 0:t.length)&&R()}const R=ie.debounce(()=>{var e;((e=r.value)==null?void 0:e.length)<_.total&&(m.pageId=r.value[r.value.length-1].id,f(!0))},300),v=y([]),V=e=>{v.value=e},H=()=>{w(v.value),v.value=[]},w=async e=>{var t,a;await Te(e),r.value.forEach(u=>{e.includes(u.id)&&(u.alatype=1)}),(t=window.$message)==null||t.destroyAll(),(a=window.$message)==null||a.success("确认成功")};return(e,t)=>{const a=se,u=Z,s=Pe,g=J,I=M("no-auth");return C(),j("div",Be,[l(Ue,{model:m,"onUpdate:model":t[0]||(t[0]=h=>m=h),onSearch:L},null,8,["model"]),l(g,{title:"审计告警",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[l(u,null,{default:o(()=>[l(i(K),{onPositiveClick:H},{trigger:o(()=>[P((C(),A(i(N),{size:"small",ghost:"",type:"primary",disabled:v.value.length==0},{default:o(()=>[D(" 批量确认 ")]),_:1},8,["disabled"])),[[I,"audit.alarm.update"]])]),default:o(()=>[D(" 确定要确认选中的数据吗？ ")]),_:1}),l(i(N),{size:"small",onClick:t[1]||(t[1]=h=>f())},{icon:o(()=>[l(a,{class:ye(["text-icon",{"animate-spin":d.value}])},null,8,["class"])]),default:o(()=>[D(" "+U(i(p)("common.refresh")),1)]),_:1})]),_:1})]),default:o(()=>[l(s,{columns:k,"checked-row-keys":v.value,data:r.value,onUpdateCheckedRowKeys:V,size:"small","flex-height":!i(z).isMobile,"scroll-x":702,loading:d.value,remote:"","row-key":h=>h.id,pagination:_,class:"sm:h-full",onScroll:$,"max-height":b.value,"virtual-scroll":""},null,8,["checked-row-keys","data","flex-height","loading","row-key","pagination","max-height"])]),_:1})])}}}),ia=be(Ee,[["__scopeId","data-v-d110596f"]]);export{ia as default};
