import{_ as Y,a as H,b as de,c as ce,d as re,e as pe,N as A,f as me}from"./round-search-CUHf7BKH.js";import{u as ue,a as _e,_ as fe,b as ge,c as ve}from"./table-BfdERIEp.js";import{d as Q,S as q,U as he,m as be,l as we,n as ye,V as J,W as xe,a as ke,$ as P,c as Ne,o as X,w as a,f as e,C as Z,x as ee,z as ae,B as _,g as c,t as v,h as t,Y as De,ah as Ce,ai as $e,r as ze,b as Te,a1 as x,P as Ue,a2 as K,aj as W,ak as Me,a5 as Pe,a6 as Re,a7 as Se,al as Be,E as je}from"./index-DtW-iSHU.js";const Fe=Q({__name:"AddModal",props:q({operateType:{},rowData:{},Pagination:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["submitted"],["update:visible"]),setup(R,{emit:S}){const r=he(R,"visible"),h=S,s=R,l=be(m());function m(){return{sn:"",datamodel:"",edgemodel:""}}function w(){Object.assign(l,m()),s.operateType==="edit"&&s.rowData&&Object.assign(l,s.rowData)}const{formRef:B,validate:j,restoreValidation:F}=we();ye(),J(()=>s.rowData,()=>{w()}),J(r,()=>{r.value&&(w(),F())});const C=()=>{r.value=!1},p=async()=>{var d;await j();const y=JSON.parse(JSON.stringify(l));if(s.operateType==="add"){const{data:b,error:f}=await Ce([y]);if(f)return}else{const{data:b,error:f}=await $e([y]);if(f)return}(d=window.$message)==null||d.success(s.operateType==="add"?"添加成功":"修改成功"),C(),h("submitted")},I=xe.debounce(p,1e3,{leading:!0,trailing:!1}),k={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},O={sn:k,datamodel:k,edgemodel:k},E=ke(()=>({add:P("common.add"),edit:P("common.edit")})[s.operateType]);return(y,d)=>{const b=ee,f=H,G=Y,L=Z,$=_,z=ae,o=De;return X(),Ne(o,{show:r.value,"onUpdate:show":d[3]||(d[3]=n=>r.value=n),title:E.value,preset:"card",class:"w-30%"},{footer:a(()=>[e(z,{size:16,justify:"center"},{default:a(()=>[e($,{onClick:C,class:"w-100px"},{default:a(()=>[c(v(t(P)("common.cancel")),1)]),_:1}),e($,{type:"primary",class:"w-100px",onClick:t(I)},{default:a(()=>[c(v(t(P)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:a(()=>[e(L,{ref_key:"formRef",ref:B,model:l,rules:O,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:a(()=>[e(G,{responsive:"screen","item-responsive":""},{default:a(()=>[e(f,{span:"24 m:24",label:"网关编号",path:"sn"},{default:a(()=>[e(b,{clearable:"",value:l.sn,"onUpdate:value":d[0]||(d[0]=n=>l.sn=n),placeholder:"请输入网关编号",maxlength:"64"},null,8,["value"])]),_:1}),e(f,{span:"24 m:24",label:"数据物模型",path:"datamodel"},{default:a(()=>[e(b,{clearable:"",value:l.datamodel,"onUpdate:value":d[1]||(d[1]=n=>l.datamodel=n),placeholder:"请输入数据物模型",precision:3,style:{width:"100%"}},null,8,["value"])]),_:1}),e(f,{span:"24 m:24",label:"数能物模型",path:"edgemodel"},{default:a(()=>[e(b,{clearable:"",value:l.edgemodel,"onUpdate:value":d[2]||(d[2]=n=>l.edgemodel=n),maxlength:"16",placeholder:"请输入数能物模型"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ie={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Oe=Q({name:"model",__name:"index",setup(R){const{columns:S,data:r,getData:h,loading:s,mobilePagination:l,searchParams:m}=ue({apiFn:Be,apiParams:{page:1,pageSize:20,limit:20,sn:void 0,_t:new Date().getTime()},showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"sn",title:"网关编号",align:"center"},{key:"datamodel",title:"数据物模型",align:"center"},{key:"edgemodel",title:"数能物模型",align:"center"},{key:"operate",title:"操作",align:"center",render:o=>e("div",{class:"flex-center gap-8px"},[e(_,{type:"primary",ghost:!0,size:"small",onClick:()=>y(o.id)},{default:()=>[c("编辑")]}),e(A,{onPositiveClick:()=>d(o.id)},{default:()=>"确定删除吗？",trigger:()=>e(_,{type:"error",ghost:!0,size:"small"},{default:()=>[c("删除")]})})])}]}),{drawerVisible:w,operateType:B,editingData:j,handleAdd:F,handleEdit:C,checkedRowKeys:p,onBatchDeleted:I,onDeleted:k}=_e(r,h),O=()=>{m.sn=void 0,h()},E=ze(),y=o=>{C(o)},d=o=>{W(o).then(()=>{r.value.length==1&&l.value.page&&l.value.page>1&&(l.value.page=l.value.page==1?1:l.value.page-1,m.page=l.value.page),k()})};async function b(){W(p.value.join(",")).then(()=>{r.value.length==p.value.length&&l.value.page&&(l.value.page=l.value.page==1?1:l.value.page-1,m.page=l.value.page),I()})}const f=()=>{F()},G=()=>{m.sn=null,h()},L=o=>{const n=o.file.file;Me(n).then(()=>{var i;(i=window.$message)==null||i.success("导入成功"),h()}).catch(()=>{var i;(i=window.$message)==null||i.error("导入失败，请检查文件内容是否正确")})},$=o=>{var g,T,U,M,D;let i=((g=o.file.file)==null?void 0:g.size)/1024/1024<500;if(!(((T=o.file.file)==null?void 0:T.type)==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||((U=o.file.file)==null?void 0:U.type)==="application/vnd.ms-excel"))return(M=window.$message)==null||M.warning("只能上传xlsx文件"),!1;if(!i)return(D=window.$message)==null||D.warning("不能超过500mb"),!1},z=o=>{const n=new URLSearchParams;p.value.forEach(i=>n.append("ids",i)),Pe({url:`${Se}/dataModel/exports.do`,method:"post",params:{ids:o=="data"?p.value.join(","):void 0},responseType:"blob",headers:{token:Re()}}).then(async i=>{if(i.data){const N=window.URL.createObjectURL(new Blob([i.data])),g=document.createElement("a");g.href=N,g.setAttribute("download",(o=="template"?"物模型模板":new Date().getTime())+".xls"),document.body.appendChild(g),g.click()}})};return(o,n)=>{const i=ee,N=H,g=de,T=fe,U=Y,M=Z,D=Ue,te=ce,ne=pe,oe=re,V=ve,le=me,se=ae,ie=ge;return X(),Te("div",Ie,[e(D,{bordered:!1,size:"small"},{default:a(()=>[e(M,{ref_key:"formRef",ref:E,model:t(m),"label-placement":"left","show-feedback":!1},{default:a(()=>[e(U,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:a(()=>[e(N,{span:"24 s:24 m:20 l:5",label:"网关编号",path:"sn"},{default:a(()=>[e(i,{value:t(m).sn,"onUpdate:value":n[0]||(n[0]=u=>t(m).sn=u),clearable:"",onClear:O,placeholder:"请输入"},null,8,["value"])]),_:1}),e(N,{span:"24 s:24 m:20 l:10"},{default:a(()=>[e(t(_),{type:"primary",ghost:"",onClick:n[1]||(n[1]=u=>t(h)()),class:"mx-10px"},{icon:a(()=>[e(g,{class:x(["text-icon",{"animate-spin":t(s)}])},null,8,["class"])]),default:a(()=>[c(" "+v(o.$t("common.search")),1)]),_:1}),e(t(_),{onClick:G},{icon:a(()=>[e(T,{class:x(["text-icon",{"animate-spin":t(s)}])},null,8,["class"])]),default:a(()=>[c(" "+v(o.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(D,{title:" ",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(se,{justify:"end"},{default:a(()=>[e(t(_),{onClick:f,size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(te,{class:x(["text-icon",{"animate-spin":t(s)}])},null,8,["class"])]),default:a(()=>[c(" "+v(o.$t("common.add")),1)]),_:1}),e(oe,{onChange:L,onBeforeUpload:$,accept:".xls","file-list-style":{display:"none"},style:{width:"inherit!important",margin:"0 10px"}},{default:a(()=>[e(t(_),{size:"small"},{icon:a(()=>[e(ne,{class:x(["text-icon",{"animate-spin":t(s)}])},null,8,["class"])]),default:a(()=>[c(" "+v(o.$t("common.import")),1)]),_:1})]),_:1}),e(t(_),{onClick:n[2]||(n[2]=u=>z("template")),size:"small"},{icon:a(()=>[e(V,{class:x(["text-icon",{"animate-spin":t(s)}])},null,8,["class"])]),default:a(()=>[n[6]||(n[6]=c(" 下载模板 "))]),_:1,__:[6]}),e(t(_),{onClick:n[3]||(n[3]=u=>z("data")),size:"small",disabled:!t(p).length},{icon:a(()=>[e(V,{class:x(["text-icon",{"animate-spin":t(s)}])},null,8,["class"])]),default:a(()=>[c(" "+v(o.$t("common.export")),1)]),_:1},8,["disabled"]),e(t(A),{onPositiveClick:b},{trigger:a(()=>[e(t(_),{size:"small",ghost:"",type:"error",disabled:t(p).length===0},{icon:a(()=>[e(le,{class:"text-icon"})]),default:a(()=>[c(" "+v(o.$t("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:a(()=>[c(" "+v(o.$t("common.confirmDelete")),1)]),_:1})]),_:1})]),default:a(()=>[e(ie,{"checked-row-keys":t(p),"onUpdate:checkedRowKeys":n[4]||(n[4]=u=>K(p)?p.value=u:null),columns:t(S),data:t(r),size:"small",loading:t(s),remote:"","row-key":u=>u.id,pagination:t(r).length?t(l):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1}),e(Fe,{visible:t(w),"onUpdate:visible":n[5]||(n[5]=u=>K(w)?w.value=u:null),onSubmitted:t(h),"operate-type":t(B),"row-data":t(j),Pagination:t(l)},null,8,["visible","onSubmitted","operate-type","row-data","Pagination"])])}}}),Ve=je(Oe,[["__scopeId","data-v-ae783e16"]]);export{Ve as default};
