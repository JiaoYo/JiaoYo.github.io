import{_ as Ye}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CXkTJ5no.js";import{aH as R,aI as he,aK as ne,aJ as pe,bz as ye,bA as et,d as ue,aM as Pe,b4 as tt,aN as Ue,a5 as at,aS as $,bB as lt,bC as it,b7 as nt,bD as st,C as ot,b8 as rt,b as se,bE as V,aR as dt,aW as ke,bF as ze,aT as _e,bG as ct,bH as De,bI as ut,bJ as pt,n as Se,p as je,s as Me,j as G,o as j,c as te,w as c,g as l,i as n,W as be,a$ as mt,h as Z,t as ae,$ as A,F as Oe,Z as ve,B as q,N as Le,O as Be,ad as Fe,r as xe,q as ft,ae as Re,G as J,f as we,e as oe,J as $e,ao as me,am as gt,aa as Te,bK as vt,bL as fe,aG as bt,b1 as Ge,K as ht,ap as yt,aj as Ve,af as _t,ag as xt,aZ as wt,R as $t,a3 as It,bM as St,bN as Ct,av as kt,E as Ne,D as Ae,ah as ge,ai as zt}from"./index-C2yjy6ET.js";import{u as Dt,a as Rt}from"./table-C3dDT37M.js";import{_ as Tt}from"./round-search-DKnEAg06.js";import{_ as Nt}from"./round-refresh-B_9x0-9r.js";import{c as Ke,e as At}from"./collection-BwWHCVBU.js";import{_ as Et}from"./lodash-BDJtdoKT.js";import{_ as Pt}from"./FormItemGridItem-D08VIasa.js";import{_ as Ut}from"./Grid-Bh27Z1XD.js";import{a as jt,T as Mt}from"./basicconf-Xdu5ATRV.js";import{n as Ot,o as We,p as Lt,q as Bt,r as Ft}from"./events-m9ZCxD5Z.js";import{c as Gt,f as Vt,a as Kt}from"./common-DEDBr2it.js";import{_ as Wt}from"./Cascader-BcheMy4u.js";import{h as Ee}from"./permission-vGvE18xg.js";import{_ as Ht}from"./Popconfirm-CG_tLyUK.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-UoWbwzfQ.js";import"./setting-outlined-Dq1C1xTv.js";import"./export-C2bvR2dJ.js";import"./refresh-DVSHILZA.js";import"./round-delete-CWeZGOYy.js";import"./round-plus-CKoomudY.js";import"./Upload-uPSwd0N6.js";import"./Progress-DgvqElPM.js";const qt=R("steps",`
 width: 100%;
 display: flex;
`,[R("step",`
 position: relative;
 display: flex;
 flex: 1;
 `,[he("disabled","cursor: not-allowed"),he("clickable",`
 cursor: pointer;
 `),ne("&:last-child",[R("step-splitor","display: none;")])]),R("step-splitor",`
 background-color: var(--n-splitor-color);
 margin-top: calc(var(--n-step-header-font-size) / 2);
 height: 1px;
 flex: 1;
 align-self: flex-start;
 margin-left: 12px;
 margin-right: 12px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `),R("step-content","flex: 1;",[R("step-content-header",`
 color: var(--n-header-text-color);
 margin-top: calc(var(--n-indicator-size) / 2 - var(--n-step-header-font-size) / 2);
 line-height: var(--n-step-header-font-size);
 font-size: var(--n-step-header-font-size);
 position: relative;
 display: flex;
 font-weight: var(--n-step-header-font-weight);
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `,[pe("title",`
 white-space: nowrap;
 flex: 0;
 `)]),pe("description",`
 color: var(--n-description-text-color);
 margin-top: 12px;
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `)]),R("step-indicator",`
 background-color: var(--n-indicator-color);
 box-shadow: 0 0 0 1px var(--n-indicator-border-color);
 height: var(--n-indicator-size);
 width: var(--n-indicator-size);
 border-radius: 50%;
 display: flex;
 align-items: center;
 justify-content: center;
 transition:
 background-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 `,[R("step-indicator-slot",`
 position: relative;
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 font-size: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 `,[pe("index",`
 display: inline-block;
 text-align: center;
 position: absolute;
 left: 0;
 top: 0;
 white-space: nowrap;
 font-size: var(--n-indicator-index-font-size);
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ye()]),R("icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ye()]),R("base-icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[ye()])])]),he("vertical","flex-direction: column;",[et("show-description",[ne(">",[R("step","padding-bottom: 8px;")])]),ne(">",[R("step","margin-bottom: 16px;",[ne("&:last-child","margin-bottom: 0;"),ne(">",[R("step-indicator",[ne(">",[R("step-splitor",`
 position: absolute;
 bottom: -8px;
 width: 1px;
 margin: 0 !important;
 left: calc(var(--n-indicator-size) / 2);
 height: calc(100% - var(--n-indicator-size));
 `)])]),R("step-content",[pe("description","margin-top: 8px;")])])])])])]);function Zt(i,w){return typeof i!="object"||i===null||Array.isArray(i)?null:(i.props||(i.props={}),i.props.internalIndex=w+1,i)}function Jt(i){return i.map((w,g)=>Zt(w,g))}const Qt=Object.assign(Object.assign({},Ue.props),{current:Number,status:{type:String,default:"process"},size:{type:String,default:"medium"},vertical:Boolean,"onUpdate:current":[Function,Array],onUpdateCurrent:[Function,Array]}),He=nt("n-steps"),Xt=ue({name:"Steps",props:Qt,setup(i,{slots:w}){const{mergedClsPrefixRef:g,mergedRtlRef:x}=Pe(i),u=tt("Steps",x,g),v=Ue("Steps","-steps",qt,st,i,g);return at(He,{props:i,mergedThemeRef:v,mergedClsPrefixRef:g,stepsSlots:w}),{mergedClsPrefix:g,rtlEnabled:u}},render(){const{mergedClsPrefix:i}=this;return $("div",{class:[`${i}-steps`,this.rtlEnabled&&`${i}-steps--rtl`,this.vertical&&`${i}-steps--vertical`]},Jt(lt(it(this))))}}),Yt={status:String,title:String,description:String,disabled:Boolean,internalIndex:{type:Number,default:0}},ea=ue({name:"Step",props:Yt,setup(i){const w=ot(He,null);w||rt("step","`n-step` must be placed inside `n-steps`.");const{inlineThemeDisabled:g}=Pe(),{props:x,mergedThemeRef:u,mergedClsPrefixRef:v,stepsSlots:C}=w,k=se(()=>x.vertical),M=se(()=>{const{status:m}=i;if(m)return m;{const{internalIndex:b}=i,{current:T}=x;if(T===void 0)return"process";if(b<T)return"finish";if(b===T)return x.status||"process";if(b>T)return"wait"}return"process"}),K=se(()=>{const{value:m}=M,{size:b}=x,{common:{cubicBezierEaseInOut:T},self:{stepHeaderFontWeight:O,[V("stepHeaderFontSize",b)]:B,[V("indicatorIndexFontSize",b)]:E,[V("indicatorSize",b)]:Q,[V("indicatorIconSize",b)]:X,[V("indicatorTextColor",m)]:W,[V("indicatorBorderColor",m)]:H,[V("headerTextColor",m)]:re,[V("splitorColor",m)]:de,[V("indicatorColor",m)]:le,[V("descriptionTextColor",m)]:Y}}=u.value;return{"--n-bezier":T,"--n-description-text-color":Y,"--n-header-text-color":re,"--n-indicator-border-color":H,"--n-indicator-color":le,"--n-indicator-icon-size":X,"--n-indicator-index-font-size":E,"--n-indicator-size":Q,"--n-indicator-text-color":W,"--n-splitor-color":de,"--n-step-header-font-size":B,"--n-step-header-font-weight":O}}),z=g?dt("step",se(()=>{const{value:m}=M,{size:b}=x;return`${m[0]}${b[0]}`}),K,x):void 0,t=se(()=>{if(i.disabled)return;const{onUpdateCurrent:m,"onUpdate:current":b}=x;return m||b?()=>{m&&ke(m,i.internalIndex),b&&ke(b,i.internalIndex)}:void 0});return{stepsSlots:C,mergedClsPrefix:v,vertical:k,mergedStatus:M,handleStepClick:t,cssVars:g?void 0:K,themeClass:z==null?void 0:z.themeClass,onRender:z==null?void 0:z.onRender}},render(){const{mergedClsPrefix:i,onRender:w,handleStepClick:g,disabled:x}=this,u=ze(this.$slots.default,v=>{const C=v||this.description;return C?$("div",{class:`${i}-step-content__description`},C):null});return w==null||w(),$("div",{class:[`${i}-step`,x&&`${i}-step--disabled`,!x&&g&&`${i}-step--clickable`,this.themeClass,u&&`${i}-step--show-description`,`${i}-step--${this.mergedStatus}-status`],style:this.cssVars,onClick:g},$("div",{class:`${i}-step-indicator`},$("div",{class:`${i}-step-indicator-slot`},$(ct,null,{default:()=>ze(this.$slots.icon,v=>{const{mergedStatus:C,stepsSlots:k}=this;return C==="finish"||C==="error"?C==="finish"?$(De,{clsPrefix:i,key:"finish"},{default:()=>_e(k["finish-icon"],()=>[$(ut,null)])}):C==="error"?$(De,{clsPrefix:i,key:"error"},{default:()=>_e(k["error-icon"],()=>[$(pt,null)])}):null:v||$("div",{key:this.internalIndex,class:`${i}-step-indicator-slot__index`},this.internalIndex)})})),this.vertical?$("div",{class:`${i}-step-splitor`}):null),$("div",{class:`${i}-step-content`},$("div",{class:`${i}-step-content-header`},$("div",{class:`${i}-step-content-header__title`},_e(this.$slots.title,()=>[this.title])),this.vertical?null:$("div",{class:`${i}-step-splitor`})),u))}}),ta=ue({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Se(["reset","search"],["update:model"]),setup(i,{emit:w}){const g=w,{formRef:x,restoreValidation:u}=je(),v=Me(i,"model");G();const C=async z=>{M()};async function k(){await u(),g("reset")}async function M(){g("search")}const K=Et.debounce(M,1e3,{leading:!0,trailing:!1});return(z,t)=>{const m=ve,b=Pt,T=Nt,O=q,B=Tt,E=Le,Q=Ut,X=Be,W=Fe;return j(),te(W,{bordered:!1,size:"small",class:"card-wrapper"},{default:c(()=>[l(X,{ref_key:"formRef",ref:x,model:v.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Oe(n(K),["enter"])},{default:c(()=>[l(Q,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:c(()=>[l(b,{span:"24 s:12 m:6",label:"接入方式",path:"itype"},{default:c(()=>[l(m,{value:v.value.itype,"onUpdate:value":[t[0]||(t[0]=H=>v.value.itype=H),C],placeholder:"请选择接入方式",filterable:"",options:n(be)(n(Ke))},null,8,["value","options"])]),_:1}),l(b,{span:"24 s:12 m:8 l:6",label:"状态",path:"ieanble"},{default:c(()=>[l(m,{filterable:"",value:v.value.ieanble,"onUpdate:value":[t[1]||(t[1]=H=>v.value.ieanble=H),M],clearable:"",placeholder:"请选择状态",options:n(be)(n(mt)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),l(b,{span:"24 s:12 m:8 l:6"},{default:c(()=>[l(E,{class:"w-full"},{default:c(()=>[l(O,{onClick:k},{icon:c(()=>[l(T,{class:"text-icon"})]),default:c(()=>[Z(" "+ae(n(A)("common.reset")),1)]),_:1}),l(O,{type:"primary",ghost:"",onClick:n(K)},{icon:c(()=>[l(B,{class:"text-icon"})]),default:c(()=>[Z(" "+ae(n(A)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),aa={class:"ml-30px h-100%"},la={style:{width:"100%",border:"1px solid #ccc",padding:"8px","white-space":"pre-wrap","user-select":"none"}},ia="(?<dbtime>[A-Za-z]{3}\\s{1,2}\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{4}[-/]\\d{2}[-/]\\d{2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{1,2}-[A-Za-z]{3}-\\d{4}\\s\\d{2}:\\d{2}:\\d{2}|\\d{2}:\\d{2}:\\d{2}\\s\\d{4}(?:[-/]\\d{2}){2})",na="(?<etime>[A-Za-z]{3}\\s{1,2}\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{4}[-/]\\d{2}[-/]\\d{2}\\s\\d{2}:\\d{2}:\\d{2}|\\d{1,2}-[A-Za-z]{3}-\\d{4}\\s\\d{2}:\\d{2}:\\d{2}|\\d{2}:\\d{2}:\\d{2}\\s\\d{4}(?:[-/]\\d{2}){2})",sa=ue({name:"OperateDrawer",__name:"operate-drawer",props:Se({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Se(["submitted","setItype"],["update:visible"]),setup(i,{emit:w}){const g=i,x=w,u=xe({current:1}),v=Me(i,"visible"),{formRef:C,validate:k,restoreValidation:M}=je(),{defaultRequiredRule:K}=ft(),z=se(()=>({add:"新增自定义解析",edit:"修改自定义解析"})[g.operateType]),t=xe(m());function m(){return{id:void 0,itype:null,cvalue:"",orilog:"",multi:"",expre:"",ieanble:0,alevel:void 0,isort:0,itext:"",result:"",logcateid:null,logtypeid:null,ectgrid:void 0,etypeid:void 0}}const b={orilog:K,itype:{required:!0,type:"number",trigger:["blur","change"],message:"接入方式"},logtypeid:{required:!0,type:"number",trigger:["blur","change"],message:"请选择日志源设备"},etypeid:{required:!0,type:"number",trigger:["blur","change"],message:"请选择事件"}},T=`Time${vt()}`,O=G([{id:1,value:"(?<priority>.+)",label:"优先级",disabled:!1},{id:2,value:T,label:"日志时间",disabled:!1},{id:100,value:"(?<gsubject>.+)",label:"事件主体",disabled:!1},{id:101,value:"(?<gdescribe>.+)",label:"事件描述",disabled:!1},{id:102,value:"(?<gresult>.+)",label:"事件结果",disabled:!1},{id:3,value:"(?<hname>.+)",label:"主机名",disabled:!1},{id:4,value:"(?<aname>.+)",label:"应用名称",disabled:!1},{id:5,value:"(?<procid>.+)",label:"PROCID",disabled:!1},{id:6,value:"(?<msgid>.+)",label:"MSGID",disabled:!1},{id:7,value:"(?<adata>{[sS]*?})",label:"结构数据",disabled:!1},{id:8,value:"(?<lcon>.+)",label:"日志内容",disabled:!1}]),B=G([{id:1,value:"(?<eige>.+)",label:"特征值ID",disabled:!1},{id:2,value:"(?<userv>.+)",label:"用户ID",disabled:!1},{id:100,value:"(?<osubject>.+)",label:"事件主体",disabled:!1},{id:101,value:"(?<odescribe>.+)",label:"事件描述",disabled:!1},{id:102,value:"(?<oresult>.+)",label:"事件结果",disabled:!1},{id:3,value:"(?<target>.+)",label:"目标对象",disabled:!1},{id:4,value:T,label:"日志时间",disabled:!1},{id:5,value:"(?<oaction>.+)",label:"动作",disabled:!1},{id:6,value:"(?<eresult>.+)",label:"事件结果",disabled:!1},{id:7,value:"(?<edesc>.+)",label:"事件描述",disabled:!1},{id:8,value:"(?<originip>.+)",label:"源IP",disabled:!1},{id:9,value:"(?<originaddr>.+)",label:"源地址",disabled:!1},{id:10,value:"(?<originport>.+)",label:"源端口",disabled:!1},{id:11,value:"(?<originasset>.+)",label:"源资产",disabled:!1},{id:12,value:"(?<originmac>.+)",label:"源MAC",disabled:!1},{id:13,value:"(?<originmask>.+)",label:"源掩码",disabled:!1},{id:14,value:"(?<aimip>.+)",label:"目的IP",disabled:!1},{id:15,value:"(?<aimaddr>.+)",label:"目的地址",disabled:!1},{id:16,value:"(?<aimport>.+)",label:"目的端口",disabled:!1},{id:17,value:"(?<aimasset>.+)",label:"目的资产",disabled:!1},{id:18,value:"(?<aimmac>.+)",label:"目的MAC地址",disabled:!1},{id:19,value:"(?<aimmask>.+)",label:"目的掩码",disabled:!1},{id:20,value:"(?<sourceip>.+)",label:"发生源IP",disabled:!1},{id:21,value:"(?<sourcecountry>.+)",label:"源国家",disabled:!1},{id:22,value:"(?<sourcecountrylong>.+)",label:"源国家经度",disabled:!1},{id:23,value:"(?<sourcecountrylati>.+)",label:"源国家纬度",disabled:!1},{id:24,value:"(?<sourceregin>.+)",label:"源区域",disabled:!1},{id:25,value:"(?<sourcereginlong>.+)",label:"源区域经度",disabled:!1},{id:26,value:"(?<sourcereginlati>.+)",label:"源区域维度",disabled:!1},{id:27,value:"(?<aimcountry>.+)",label:"目的国家",disabled:!1},{id:28,value:"(?<aimcountrylong>.+)",label:"目的国家经度",disabled:!1},{id:29,value:"(?<aimcountrylati>.+)",label:"目的国家纬度",disabled:!1},{id:30,value:"(?<aimregin>.+)",label:"目的区域",disabled:!1},{id:31,value:"(?<aimreginlong>.+)",label:"目的区域经度",disabled:!1},{id:32,value:"(?<aimreginlati>.+)",label:"目的区域维度",disabled:!1},{id:33,value:"(?<protocol>.+)",label:"协议",disabled:!1}]),E=G(),Q=async()=>{const{data:e,error:a}=await Gt();a||(E.value=e.map(r=>({...r,id:"-"+r.id,type:r.cname})))},X=(e,a)=>{console.log(a),t.logcateid=a==null?void 0:a.category,t.logtypeid=a==null?void 0:a.id},W=G();async function H(){const{data:e,error:a}=await Vt();a||(W.value=e,await re())}async function re(){const{data:e,error:a}=await Kt();if(!a){let r=W.value.concat(e);W.value=wt(r)}}const de=(e,a)=>{t.ectgrid=a==null?void 0:a.pid,t.etypeid=a==null?void 0:a.id};async function le(){u.current=1,Q(),H(),L.list=[],P.value=new Set([]),Object.assign(t,m()),g.operateType==="edit"&&g.rowData&&Object.assign(t,g.rowData)}function Y(){v.value=!1}const P=G(new Set),s=G(null),d=G([]);function I(e){var ee,ie;let a=!0;const r=t.orilog,h=window.getSelection();if(!h.rangeCount)return;const f=h.getRangeAt(0),o=f.startContainer,_=f.endContainer;if(h.removeAllRanges(),!s.value.contains(o)||!s.value.contains(_))return;const F=Array.from(s.value.childNodes),p=F.indexOf(o.parentNode)-1,S=F.indexOf(_.parentNode);if(console.log("startIndex",p),console.log("endIndex",S),S-p==0)return!1;for(let U=p;U<S;U++)P.value.has(U)&&(console.log("尝试选择已禁用的字符，操作被阻止"),a=!1);if(a){if(p>=0&&S>=0&&p<=S)for(let U=p;U<S;U++)d.value.push(U);for(let U=p;U<S;U++)P.value.add(U);p>0&&P.value.add(p-1),S<r.length&&P.value.add(S),L.list.push({startIndex:p,endIndex:S,name:r.substring(p,S),multipegroup:null,value:null})}else return(ee=window.$message)==null||ee.destroyAll(),(ie=window.$message)==null||ie.warning("相邻划词不允许选中。"),!1;console.log("当前选中的文本:",r.substring(p,S)),console.log("已禁用的字符索引:",Array.from(P.value))}async function N(){var e,a;if(console.log(t),g.operateType==="add"){const{data:r,error:h}=await Ot([{itype:t.itype,itext:fe(String.raw`${t.expre}`),ieanble:t.ieanble,alevel:t.alevel,isort:t.isort,logcateid:t.logcateid,logtypeid:t.logtypeid,ectgrid:t.ectgrid,etypeid:t.etypeid}]);h||((e=window.$message)==null||e.success(A("common.addSuccess")),Y(),x("submitted"),x("setItype",t.itype))}else{const{data:r,error:h}=await We([{id:t.id,itype:t.itype,itext:fe(String.raw`${t.expre}`),ieanble:t.ieanble,alevel:t.alevel,isort:t.isort,logcateid:t.logcateid,logtypeid:t.logtypeid,ectgrid:t.ectgrid,etypeid:t.etypeid}]);h||((a=window.$message)==null||a.success(A("common.updateSuccess")),Y(),x("submitted"))}}const ce=async()=>{console.log(String.raw`${t.expre}`);const{data:e,error:a}=await Lt({pattern:fe(String.raw`${t.expre}`),originalLog:fe(t.orilog),type:t.itype==0||t.itype==1?0:1});e&&(t.result=(t.itype==0||t.itype==1?[e.lsid&&`设备ID: ${e.lsid}`,e.rdbtime&&`接收时间: ${e.rdbtime}`,e.gsubject&&`事件主体: ${e.gsubject}`,e.gdescribe&&`事件描述: ${e.gdescribe}`,e.gresult&&`事件结果: ${e.gresult}`,e.lmid&&`模块ID: ${e.lmid}`,e.leid&&`级别ID: ${e.leid}`,e.ipaddr&&`发生源IP: ${e.ipaddr}`,e.aname&&`应用名称: ${e.aname}`,e.procid&&`PROCID: ${e.procid}`,e.msgid&&`MSGID: ${e.msgid}`,e.dbtime&&`日志时间: ${e.dbtime}`,e.hname&&`主机名称: ${e.hname}`,e.adata&&`结构数据: ${e.adata}`,e.lcon&&`日志内容: ${e.lcon}`,e.ltext&&`日志原文: ${e.ltext}`]:[e.eige&&`特征值ID: ${e.eige}`,e.userv&&`用户ID: ${e.userv}`,e.osubject&&`事件主体: ${e.osubject}`,e.odescribe&&`事件描述: ${e.oresult}`,e.oresult&&`事件结果: ${e.oresult}`,e.target&&`目标对象: ${e.target}`,e.etime&&`日志时间: ${e.etime}`,e.oaction&&`动作: ${e.oaction}`,e.eresult&&`事件结果: ${e.eresult}`,e.edesc&&`事件描述: ${e.edesc}`,e.originip&&`源IP: ${e.originip}`,e.originaddr&&`源地址: ${e.originaddr}`,e.originport&&`源端口: ${e.originport}`,e.originasset&&`源资产: ${e.originasset}`,e.originmac&&`源MAC: ${e.originmac}`,e.originmask&&`源掩码: ${e.originmask}`,e.aimip&&`目的IP: ${e.aimip}`,e.aimaddr&&`目的地址: ${e.aimaddr}`,e.aimport&&`目的端口: ${e.aimport}`,e.aimasset&&`目的资产: ${e.aimasset}`,e.aimmac&&`目的MAC地址: ${e.aimmac}`,e.aimmask&&`目的掩码: ${e.aimmask}`,e.sourceip&&`发生源IP: ${e.sourceip}`,e.sourcecountry&&`源国家: ${e.sourcecountry}`,e.sourcecountrylong&&`源国家经度: ${e.sourcecountrylong}`,e.sourcecountrylati&&`源国家纬度: ${e.sourcecountrylati}`,e.sourceregin&&`源区域: ${e.sourceregin}`,e.sourcereginlong&&`源区域经度: ${e.sourcereginlong}`,e.sourcereginlati&&`源区域维度: ${e.sourcereginlati}`,e.aimcountry&&`目的国家: ${e.aimcountry}`,e.aimcountrylong&&`目的国家经度: ${e.aimcountrylong}`,e.aimcountrylati&&`目的国家纬度: ${e.aimcountrylati}`,e.aimregin&&`目的区域: ${e.aimregin}`,e.aimreginlong&&`目的区域经度: ${e.aimreginlong}`,e.aimreginlati&&`目的区域维度: ${e.aimreginlati}`,e.protocol&&`协议: ${e.protocol}`]).filter(Boolean).join(`
`),u.current&&u.current++),console.log(e)};Re(v,()=>{v.value&&(d.value=[],le(),M())});const D=G([{title:"字段值",key:"name",width:160,align:"center",ellipsis:{tooltip:!0}},{title:"对应规则",key:"multipegroup",align:"center",width:160,render(e,a){return $(ve,{size:"small",clearable:!0,valueField:"id",filterable:!0,options:t.itype==0||t.itype==1?O.value:B.value,value:e.multipegroup,"onUpdate:value":r=>{e.multipegroup=r,e.value=null;const h=L.list.map(f=>f.multipegroup);t.itype==0||t.itype==1?O.value.forEach(f=>{h.includes(f.id)?f.disabled=!0:f.disabled=!1}):B.value.forEach(f=>{h.includes(f.id)?f.disabled=!0:f.disabled=!1}),console.log(e.multipegroup)}})}},{key:"operate",title:A("common.operate"),align:"center",width:80,fixed:"right",render(e,a){return $(q,{size:"small",type:"error",ghost:!0,onClick:()=>Ze(e,a)},{default:()=>A("common.delete")})}}]);function qe(e,a){return e.filter(r=>!a.includes(r))}function Ze(e,a){console.log(e,a),B.value.forEach(o=>{o.id==e.multipegroup&&(o.disabled=!1)}),O.value.forEach(o=>{o.id==e.multipegroup&&(o.disabled=!1)});let r=[e.startIndex-1,e.endIndex];L.list.splice(a,1);for(let o=e.startIndex;o<e.endIndex;o++)r.push(o);const h=Math.max(...r),f=Math.min(...r);P.value.has(h+1)&&(r=r.filter(o=>o!==h)),P.value.has(f-1)&&(r=r.filter(o=>o!==f)),P.value=new Set(qe(Array.from(P.value),r)),d.value=[],L.list.forEach(o=>{for(let _=o.startIndex;_<o.endIndex;_++)d.value.push(_)})}const L=xe({list:[]});function Je(e,a){let r=e.split(""),h=0;for(const{startIndex:f,endIndex:o,replacement:_}of a){const F=f+h,p=o+h;if(F<0||p>=r.length||F>p)throw new Error("Invalid index range");const S=p-F+1,ee=r.slice(0,F).join(""),ie=r.slice(p+1).join("");r=(ee+_+ie).split(""),h+=_.length-S}return r.join("")}Re(()=>t.orilog,()=>{L.list=[],d.value=[],P.value=new Set([]),B.value.forEach(e=>{e.disabled=!1}),O.value.forEach(e=>{e.disabled=!1})});function Qe(e){return e.replace(/(\(\?<[^>]+>[^)]+\))|[-\/\\^$*+?.()|[\]{}]/g,(a,r)=>r||`\\${a}`)}async function Xe(){var e,a,r,h;if(u.current==1)await k(),u.current++,bt(()=>{var f;(f=g.rowData)!=null&&f.id&&(d.value=[],L.list.forEach(o=>{for(let _=o.startIndex;_<o.endIndex;_++)d.value.push(_)}))});else{let f=!0;if(L.list.length>0){for(let o=0;o<L.list.length;o++)if(!L.list[o].multipegroup){f=!1;break}if(f){t.cvalue="",t.multi="";let o={},_=[];t.itype==0||t.itype==1?O.value.forEach(p=>{o[p.id]=p.value}):B.value.forEach(p=>{o[p.id]=p.value}),L.list.forEach((p,S)=>{t.cvalue+=p.name+"，",t.multi+=p.multipegroup+",",_.push({startIndex:p.startIndex,endIndex:p.endIndex-1,replacement:o[p.multipegroup]})}),console.log("finallyTransArr",_),t.cvalue=t.cvalue.substring(0,t.cvalue.length-1),t.multi=t.multi.substring(0,t.multi.length-1);const F=Je(t.orilog,_);t.expre=Qe(F).replace(T,t.itype==0||t.itype==1?ia:na),console.log(t.expre),u.current&&u.current++}else return(e=window.$message)==null||e.destroyAll(),(a=window.$message)==null||a.warning("请补充完整内容。"),!1}else return(r=window.$message)==null||r.destroyAll(),(h=window.$message)==null||h.warning("请添加日志划词。"),!1}}return(e,a)=>{const r=ea,h=Xt,f=Ge,o=ht,_=Wt,F=yt,p=Ve,S=Be,ee=Le,ie=_t,U=xt;return j(),te(U,{show:v.value,"onUpdate:show":a[10]||(a[10]=y=>v.value=y),"display-directive":"show",width:1e3,"content-style":{height:"100%"}},{default:c(()=>[l(ie,{title:z.value,"native-scrollbar":!0,closable:"","body-content-style":{height:"100%"}},{footer:c(()=>[l(ee,{size:16},{default:c(()=>[l(n(q),{onClick:Y},{default:c(()=>[Z(ae(n(A)("common.cancel")),1)]),_:1}),u.current===2||u.current===3?(j(),te(n(q),{key:0,onClick:a[9]||(a[9]=y=>u.current--)},{default:c(()=>[Z("上一步")]),_:1})):J("",!0),u.current===1||u.current===2?(j(),te(n(q),{key:1,type:"primary",onClick:Xe},{default:c(()=>[Z(ae(u.current===1?"下一步":"生成解析"),1)]),_:1})):J("",!0),u.current===3?(j(),te(n(q),{key:2,type:"primary",onClick:ce},{default:c(()=>[Z(ae("验证解析"))]),_:1})):J("",!0),u.current===4?(j(),te(n(q),{key:3,type:"primary",onClick:N},{default:c(()=>[Z(ae(n(A)("common.confirm")),1)]),_:1})):J("",!0)]),_:1})]),default:c(()=>[l(ee,{class:"h-100%",style:{gap:"0 !important"},"item-class":"NSpaceItem"},{default:c(()=>[l(h,{vertical:"",current:u.current,class:"h-400px"},{default:c(()=>[l(r,{title:"基本信息"}),l(r,{title:"日志划词"}),l(r,{title:"生成解析"})]),_:1},8,["current"]),we("div",aa,[l(S,{ref_key:"formRef",ref:C,model:t,rules:b,onKeyup:Oe(N,["enter"]),style:{height:"100%",display:"flex","flex-direction":"column"}},{default:c(()=>[u.current===1?(j(),oe(me,{key:0},[l(o,{label:"使用状态",path:"ieanble"},{default:c(()=>[l(f,{value:t.ieanble,"onUpdate:value":a[0]||(a[0]=y=>t.ieanble=y),"checked-value":0,"unchecked-value":1},null,8,["value"])]),_:1}),l(o,{label:"接入方式",path:"itype"},{default:c(()=>[l(n(ve),{value:t.itype,"onUpdate:value":a[1]||(a[1]=y=>t.itype=y),placeholder:"请选择接入方式",filterable:"",clearable:"",options:n(be)(n(Ke))},null,8,["value","options"])]),_:1}),l(o,{label:"日志源设备",path:"logtypeid"},{default:c(()=>[l(_,{value:t.logtypeid,"onUpdate:value":[a[2]||(a[2]=y=>t.logtypeid=y),X],placeholder:"请选择日志源设备",options:E.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"","show-path":!1},null,8,["value","options"])]),_:1}),[0,1].includes(t.itype)?J("",!0):(j(),te(o,{key:0,label:"事件",path:"etypeid"},{default:c(()=>[l(_,{value:t.etypeid,"onUpdate:value":[a[3]||(a[3]=y=>t.etypeid=y),de],clearable:"",placeholder:"请选择事件",options:W.value,"show-path":!1,"check-strategy":"child","value-field":"id","label-field":"pname"},null,8,["value","options"])]),_:1})),l(o,{label:"告警级别",path:"alevel"},{default:c(()=>[l(n(ve),{filterable:"",clearable:"",placeholder:n(A)("page.manage.alarm.form.level"),value:t.alevel,"onUpdate:value":a[4]||(a[4]=y=>t.alevel=y),options:n(be)(n(jt))},null,8,["placeholder","value","options"])]),_:1}),l(o,{label:"排序",path:"isort"},{default:c(()=>[l(F,{value:t.isort,"onUpdate:value":a[5]||(a[5]=y=>t.isort=y),placeholder:"请输入排序",style:{width:"100%"}},null,8,["value"])]),_:1}),l(o,{label:"日志原文",path:"orilog"},{default:c(()=>[l(n($e),{type:"textarea",value:t.orilog,"onUpdate:value":a[6]||(a[6]=y=>t.orilog=y),placeholder:"请输入日志原文",clearable:"",autosize:{minRows:5,maxRows:20},style:{width:"100%",height:"100%"}},null,8,["value"])]),_:1})],64)):J("",!0),u.current===2?(j(),oe(me,{key:1},[l(o,{label:"日志原文",path:"orilog"},{default:c(()=>[we("div",la,[we("div",{class:"w-100%",ref_key:"editableDiv",ref:s,style:{"user-select":"text"},onMouseup:I},[(j(!0),oe(me,null,gt(t.orilog,(y,Ce)=>(j(),oe("span",{key:Ce,style:Te({color:d.value.includes(Ce)?"#f00":"#000"})},ae(y),5))),128))],544)])]),_:1}),l(o,{label:"划词信息",style:{flex:"1"}},{default:c(()=>[l(p,{columns:D.value,data:L.list,style:Te([{width:"100%"},{height:"100%"}]),"scroll-x":702,"flex-height":""},null,8,["columns","data"])]),_:1})],64)):J("",!0),u.current===3||u.current===4?(j(),oe(me,{key:2},[l(o,{label:"表达式",path:"expre"},{default:c(()=>[l(n($e),{type:"textarea",value:t.expre,"onUpdate:value":a[7]||(a[7]=y=>t.expre=y),placeholder:"请输入表达式",style:{width:"100%"},readonly:"",autosize:{minRows:5,maxRows:7}},null,8,["value"])]),_:1}),l(o,{label:"解析结果",path:"result"},{default:c(()=>[l(n($e),{type:"textarea",value:t.result,"onUpdate:value":a[8]||(a[8]=y=>t.result=y),placeholder:"解析结果",style:{width:"100%",height:"100%"},readonly:"",autosize:{minRows:6,maxRows:20}},null,8,["value"])]),_:1})],64)):J("",!0)]),_:1},8,["model"])])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),oa=$t(sa,[["__scopeId","data-v-2880193c"]]),ra={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Ie(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!zt(i)}const Na=ue({name:"eventalarm_customparsing",__name:"index",setup(i){const w=It();G(),G();const g={dbtime:"日志时间",priority:"优先级",hname:"主机名",aname:"应用名",procid:"进程ID",msgid:"消息ID",adata:"结构数据",lcon:"日志内容",eige:"特征值ID",userv:"用户ID",target:"目标对象",etime:"日志时间",oaction:"动作",eresult:"事件结果",edesc:"事件描述",originip:"源IP",originaddr:"源地址",originport:"源端口",originasset:"源资产",originmac:"源MAC",originmask:"源掩码",aimip:"目的IP",aimaddr:"目的地址",aimport:"目的端口",aimasset:"目的资产",aimmac:"目的MAC地址",aimmask:"目的掩码",sourceip:"发生源IP",sourcecountry:"源国家",sourcecountrylong:"源国家经度",sourcecountrylati:"源国家纬度",sourceregin:"源区域",sourcereginlong:"源区域经度",sourcereginlati:"源区域维度",aimcountry:"目的国家",aimcountrylong:"目的国家经度",aimcountrylati:"目的国家纬度",aimregin:"目的区域",aimreginlong:"目的区域经度",aimreginlati:"目的区域维度",protocol:"协议"},x=(s,d)=>s.replace(/\?<(\w+)>/g,(I,N)=>`?<${d[N]||N}>`),{columns:u,columnChecks:v,data:C,getData:k,loading:M,mobilePagination:K,searchParams:z,resetSearchParams:t}=Dt({apiFn:Bt,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,itype:0,ieanble:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"itype",title:"采集器",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:s=>{const d=At;return l("span",null,[Z(" "),d[s.itype]])}},{key:"itext",title:"匹配规则",align:"center",render:s=>l("span",null,[Z(" "),x(St(Ct(s.itext)),g)])},{key:"isort",title:"排序",align:"center",width:120,render:s=>((s.isort===void 0||s.isort===null)&&(s.isort=0),l("span",null,[s.isort]))},{key:"alevel",title:"告警级别",align:"center",width:120,render:s=>{(s.alevel===void 0||s.alevel===null)&&(s.alevel=0);const d={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},I=A(Mt[s.alevel]);let N={color:d[s.alevel],textColor:"#ffffff",borderColor:d[s.alevel]};return l(kt,{size:"small",color:N},Ie(I)?I:{default:()=>[I]})},resizable:!0},{key:"ieanble",title:"是否启用",align:"center",width:160,render:s=>l(Ge,{value:s.ieanble,"onUpdate:value":[d=>s.ieanble=d,()=>P(s)],checkedValue:0,uncheckedValue:1},null)},{key:"operate",title:A("common.operate"),align:"center",width:160,fixed:"right",render:s=>{let d;return l("div",{class:"flex-center gap-8px"},[Ne(l(q,{type:"info",ghost:!0,size:"small",onClick:()=>re(s.id)},Ie(d=A("common.edit"))?d:{default:()=>[d]}),[[Ae("no-auth"),"custorm.parsing.update"]]),l(Ht,{onPositiveClick:()=>de(s.id)},{default:()=>A("common.confirmDelete"),trigger:()=>{let I;return Ne(l(q,{type:"error",ghost:!0,size:"small"},Ie(I=A("common.delete"))?I:{default:()=>[I]}),[[Ae("no-auth"),"custorm.parsing.delete"]])}})])}}]}),{drawerVisible:m,operateType:b,editingData:T,handleAdd:O,handleEdit:B,checkedRowKeys:E,onBatchDeleted:Q,onDeleted:X,closeDrawer:W}=Rt(C,k);async function H(){console.log(E.value),le(E.value,s=>{Q()})}function re(s){B(s)}function de(s){console.log(s),le([s],d=>{X()})}async function le(s,d){const{data:I,error:N}=await Ft(s);if(!N)d&&d(I);else return!1}async function Y(){}async function P(s){var I,N;const d={id:s.id,ieanble:s.ieanble};try{const{data:ce,error:D}=await We([d]);if(!D)(I=window.$message)==null||I.success(s.ieanble===0?"启用成功":"停用成功"),k();else throw new Error("更新失败")}catch{s.ieanble=s.ieanble===1?0:1,(N=window.$message)==null||N.error("操作失败，请重试")}}return(s,d)=>{const I=Ye,N=Ve,ce=Fe;return j(),oe("div",ra,[l(ta,{model:n(z),"onUpdate:model":d[0]||(d[0]=D=>ge(z)?z.value=D:null),onReset:n(t),onSearch:n(k)},null,8,["model","onReset","onSearch"]),l(ce,{title:"自定义解析",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":c(()=>[l(I,{columns:n(v),"onUpdate:columns":d[1]||(d[1]=D=>ge(v)?v.value=D:null),"disabled-delete":n(E).length===0,loading:n(M),onAdd:n(O),onDelete:H,onRefresh:n(k),"is-view-export-button":!0,onExportHandler:Y,"is-view-add-button":n(Ee)("custorm.parsing.insert"),"is-view-delete-button":n(Ee)("custorm.parsing.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:c(()=>[l(N,{"checked-row-keys":n(E),"onUpdate:checkedRowKeys":d[2]||(d[2]=D=>ge(E)?E.value=D:null),columns:n(u),data:n(C),size:"small","flex-height":!n(w).isMobile,"scroll-x":962,loading:n(M),remote:"","row-key":D=>D.id,pagination:n(K),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),l(oa,{visible:n(m),"onUpdate:visible":d[3]||(d[3]=D=>ge(m)?m.value=D:null),"operate-type":n(b),onSetItype:d[4]||(d[4]=D=>{n(z).itype=D,n(k)()}),"row-data":n(T),onSubmitted:n(k)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Na as default};
