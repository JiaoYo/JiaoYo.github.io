import{_ as ot}from"./table-column-setting.vue_vue_type_script_setup_true_lang-D-WWUWev.js";import{_ as ut}from"./round-delete-BJCk8P86.js";import{_ as rt}from"./round-add-CL2Vba1y.js";import{d as Ae,av as Ue,z as Ne,D as it,s as $,aJ as Le,A as Ee,a as dt,ax as Me,at as He,c as F,o as m,w as t,f as e,a3 as pt,M as Oe,G as T,h as u,au as se,H as V,b as N,g as r,e as k,t as f,az as ct,B as S,aA as ft,J as Pe,$ as Z,a4 as Ve,aS as mt,aE as pe,cw as gt,cu as vt,cx as Ge,cy as yt,cz as $e,aG as bt,cA as Je,cB as _t,Y as Ke,X as We,L as ht,a2 as Qe,aI as kt,i as wt,F as Y,aK as xe,ay as Dt,I as O,aL as Ct,aB as xt,aD as ie,cC as Ie,cD as Tt,n as qe,aQ as Ft}from"./index-BTeMkgsf.js";import{u as St,a as zt}from"./table-nKGzp9nE.js";import{u as ce}from"./usePageData-BtaN_wXr.js";import{_ as Xe}from"./Grid-D1GO_CFb.js";import{_ as Ye}from"./FormItemGridItem-DlZX07SE.js";import{_ as jt}from"./DatePicker-ABP-mfiZ.js";import{_ as Bt}from"./round-search-D_VWcob1.js";import{_ as qt}from"./round-refresh-BDZcKrQw.js";import{_ as Ut,a as At}from"./DescriptionsItem-sEZ5gGpV.js";import{N as de}from"./Popconfirm-BVBTnPX5.js";import{_ as Nt}from"./RadioButton-DjWiQ3TF.js";const Pt={key:0,style:{"margin-left":"20px"}},$t={key:0,style:{"margin-left":"20px"}},It={key:0,style:{"margin-left":"20px"}},Rt={key:0,style:{"margin-left":"20px"}},Lt=Ae({name:"OperateDrawer",__name:"operate-drawer",props:Ue({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Ue(["submitted"],["update:visible"]),setup(M,{emit:fe}){const z=fe,w=Ne(),v=M,l=it(G());function G(){return{pid:void 0,id:"",debugname:"",docker:void 0,dockcharge:"",dockcontact:"",status:0,notes:"",debugresult:0,dtype:void 0,starttime:null,endtime:null,dbcreater:void 0,startAndTimeRange:void 0,eqmid:void 0,re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const{pageData:H,getData:g,nextPage:P}=ce(mt),I=async()=>{await g({usertypes:"2,3"})},J=async o=>{const a=o.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&H.data.length<H.total&&(await P(),await pe(),setTimeout(()=>{a.scrollTop=d}))},{pageData:y,getData:ee,nextPage:me}=ce(gt),ge=async o=>{const a=o.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&y.data.length<y.total&&(await me(),y.data=y.data.map(x=>({...x,value:x.docker+"&id="+x.id})),await pe(),setTimeout(()=>{a.scrollTop=d}))},te=async()=>{await ee({pid:l.pid}),y.data=y.data.map(o=>({...o,value:o.docker+"&id="+o.id}))},ae=async o=>{var a;if(l.docker=o,l.docker){const[d,x]=(a=l.docker)==null?void 0:a.split("&id="),h=y.data.find(X=>X.docker==d&&X.id==x);h?(l.dockcharge=h.pname,l.dockcontact=h.pcontact):(l.dockcharge="",l.dockcontact="")}},{pageData:j,getData:ve,nextPage:oe}=ce(vt),ye=async o=>{const a=o.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&j.data.length<j.total&&(await oe(),await pe(),setTimeout(()=>{a.scrollTop=d}))},be=async()=>{await ve()},R=$([]),{pageData:U,getData:K,nextPage:ue}=ce(Ge),b=async o=>{const a=o.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&U.data.length<U.total&&(await ue(),R.value=U.data,await pe(),setTimeout(()=>{a.scrollTop=d}))},D=async()=>{await K({fuzzy:w.userInfo.pname,page:1}),R.value=U.data},L=Le.debounce(async o=>{await K({fuzzy:o,page:1}),R.value=U.data},300),E=$(!1),le=$(!1),_e=o=>{if(l.pid=null,E.value=!0,le.value=!1,!o){W();return}L(o)},p=async()=>{E.value&&!le.value&&(await K({page:1}),R.value=U.data,E.value=!1)},W=async()=>{await K({page:1}),R.value=U.data},he=async o=>{l.pid=o,le.value=!0,Q()},{pageData:s,getData:n,nextPage:B}=ce(yt),A=async o=>{const a=o.currentTarget,d=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&j.data.length<j.total&&(await B(),await pe(),setTimeout(()=>{a.scrollTop=d}))},Q=async()=>{await n({pid:l.pid})},ke=$(void 0);async function Te(){D(),be(),I(),Object.assign(l,G()),v.operateType==="add"&&(l.pid=v.pid?v.pid:void 0),v.operateType==="edit"&&v.rowData&&(Object.assign(l,v.rowData),ke.value=l.status,v.rowData.starttime&&v.rowData.endtime?l.startAndTimeRange=[$e(v.rowData.starttime),$e(v.rowData.endtime)]:l.startAndTimeRange=null),te(),l.pid&&Q()}const{formRef:Fe,validate:we,restoreValidation:Se}=Ee(),C={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},eqmid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dbcreater:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"},debugname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcharge:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"}},ze=dt(()=>({add:"新增待调试业务",edit:"修改待调试业务"})[v.operateType]),ne=Me(M,"visible");He(ne,()=>{ne.value&&(Te(),setTimeout(()=>{const o=document.querySelector(".n-scrollbar-content");o==null||o.scrollTo(0,0)},300),Se())});const _=$(0),c=$("");async function re({file:o},a){_.value=0,c.value=a;const d=await bt(o.file,o.name,"",x=>{_.value=x});d&&(l[a]=d,_.value=0)}function je(){ne.value=!1}async function De(o){if(o)try{const d=await(await fetch(o==null?void 0:o.split("?")[0],{mode:"cors"})).blob(),x=URL.createObjectURL(d),h=document.createElement("a");h.href=x,h.download=o==null?void 0:o.split("?")[1],h.style.display="none",document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(x)}catch(a){console.error("下载失败:",a)}}async function Ze(){var o;await we(),(o=window.$dialog)==null||o.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await et()}})}async function et(){var o,a,d,x;if(await we(),v.operateType==="edit"){const h=JSON.parse(JSON.stringify(l));ke.value==h.status&&delete h.status,h.docker=(o=h.docker)==null?void 0:o.split("&id=")[0];const{data:X,error:Be}=await Je([h]);Be||(je(),z("submitted"),(a=window.$message)==null||a.success("修改成功"))}else{const{data:h,error:X}=await _t([{...l,docker:(d=l.docker)==null?void 0:d.split("&id=")[0]}]);X||(je(),z("submitted"),(x=window.$message)==null||x.success("添加成功"))}}async function Ce(o){var a;return o.file.file.size>100*1024*1024?((a=window.$message)==null||a.error("文件大小不能超过100M"),!1):!0}const tt=o=>{var a;l.debugname=(a=j.data.find(d=>d.id==o))==null?void 0:a.tname,l.dtype=o};async function at(o,a){l.startAndTimeRange=o,l.starttime=o==null?void 0:o[0],l.endtime=o==null?void 0:o[1]}return(o,a)=>{const d=Ye,x=ct,h=ft,X=Xe,Be=Oe,lt=pt,nt=Pe,st=Ve;return m(),F(st,{show:ne.value,"onUpdate:show":a[23]||(a[23]=i=>ne.value=i),title:ze.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:t(()=>[e(nt,{justify:"end",size:16},{default:t(()=>[e(u(S),{onClick:je},{default:t(()=>[r(f(u(Z)("common.cancel")),1)]),_:1}),e(u(S),{type:"primary",onClick:Ze},{default:t(()=>[r(f(u(Z)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(lt,{class:"pr-20px"},{default:t(()=>[e(Be,{ref_key:"formRef",ref:Fe,model:l,rules:C,"label-placement":"left","label-width":120},{default:t(()=>[e(X,{responsive:"screen","item-responsive":""},{default:t(()=>[e(d,{span:"24 m:12",label:"项目列表",path:"pid"},{default:t(()=>[e(u(se),{filterable:"",clearable:"",value:l.pid,"onUpdate:value":[a[0]||(a[0]=i=>l.pid=i),he],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:W,onSearch:_e,onBlur:p,options:R.value,onScroll:b},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"权重",path:"dtype"},{default:t(()=>[e(u(se),{filterable:"",value:l.dtype,"onUpdate:value":[a[1]||(a[1]=i=>l.dtype=i),tt],tag:"",placeholder:"请选择权重","label-field":"tname","value-field":"id",options:u(j).data,onScroll:ye},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"业务名称",path:"debugname"},{default:t(()=>[e(u(V),{value:l.debugname,"onUpdate:value":a[2]||(a[2]=i=>l.debugname=i),placeholder:"请输入"},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"调试人",path:"dbcreater"},{default:t(()=>[e(u(se),{filterable:"",value:l.dbcreater,"onUpdate:value":a[3]||(a[3]=i=>l.dbcreater=i),placeholder:"请选择调试人","label-field":"username","value-field":"id",options:u(H).data,onScroll:J},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"待调试设备",path:"eqmid"},{default:t(()=>[e(u(se),{filterable:"",clearable:"",value:l.eqmid,"onUpdate:value":a[4]||(a[4]=i=>l.eqmid=i),placeholder:"请选择待调试设备","label-field":"devname","value-field":"id",options:u(s).data,onScroll:A},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"对接方",path:"docker"},{default:t(()=>[e(u(se),{filterable:"",value:l.docker,"onUpdate:value":[a[5]||(a[5]=i=>l.docker=i),ae],clearable:"",tag:"",placeholder:"请选择或输入对接方","label-field":"docker","value-field":"value",options:u(y).data,onScroll:ge},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"对接方负责人",path:"dockcharge"},{default:t(()=>[e(u(V),{value:l.dockcharge,"onUpdate:value":a[6]||(a[6]=i=>l.dockcharge=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"联系方式",path:"dockcontact"},{default:t(()=>[e(u(V),{value:l.dockcontact,"onUpdate:value":a[7]||(a[7]=i=>l.dockcontact=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),v.operateType=="edit"?(m(),F(d,{key:0,span:"24 m:12",label:"状态",path:"status"},{default:t(()=>[e(u(se),{clearable:"",value:l.status,"onUpdate:value":a[8]||(a[8]=i=>l.status=i),placeholder:"请选择",options:u(w).userInfo.usertype==0||u(w).userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}]},null,8,["value","options"])]),_:1})):T("",!0),e(d,{span:"24 m:24",label:"起止时间",path:"startAndTimeRange"},{default:t(()=>[e(u(jt),{clearable:"",value:l.startAndTimeRange,"onUpdate:value":a[9]||(a[9]=i=>l.startAndTimeRange=i),type:"daterange","value-format":"yyyy-MM-dd",style:{width:"100%"},"onUpdate:formattedValue":at},null,8,["value"])]),_:1}),e(d,{span:"24 m:24",label:"备注",path:"notes"},{default:t(()=>[e(u(V),{value:l.notes,"onUpdate:value":a[10]||(a[10]=i=>l.notes=i),placeholder:"请输入"},null,8,["value"])]),_:1}),e(d,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:t(()=>[e(X,{responsive:"screen","item-responsive":""},{default:t(()=>[e(d,{span:"24 m:12",label:"附件1",path:"notes"},{default:t(()=>[e(u(V),{value:l.re1,"onUpdate:value":a[11]||(a[11]=i=>l.re1=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl1?(m(),N("span",Pt,[r(f((i=l.fl1)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:a[12]||(a[12]=q=>l.fl1="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[13]||(a[13]=q=>De(l.fl1))},"下载")])):(m(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":q=>re(q,"fl1"),"show-file-list":!1,onBeforeUpload:Ce},{default:t(()=>[e(u(S),{loading:_.value>0&&!l.fl1&&c.value=="fl1",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(f(_.value>0&&!l.fl1&&c.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),_.value&&!l.fl1&&c.value=="fl1"?(m(),F(h,{key:2,type:"line",percentage:_.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1})]),_:1})]),_:1}),e(d,{span:"24 m:12",label:"附件2",path:"notes"},{default:t(()=>[e(u(V),{value:l.re2,"onUpdate:value":a[14]||(a[14]=i=>l.re2=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl2?(m(),N("span",$t,[r(f((i=l.fl2)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:a[15]||(a[15]=q=>l.fl2="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[16]||(a[16]=q=>De(l.fl2))},"下载")])):(m(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":q=>re(q,"fl2"),"show-file-list":!1,onBeforeUpload:Ce},{default:t(()=>[e(u(S),{loading:_.value>0&&!l.fl2&&c.value=="fl2",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(f(_.value>0&&!l.fl2&&c.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),_.value&&!l.fl2&&c.value=="fl2"?(m(),F(h,{key:2,type:"line",percentage:_.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1}),e(d,{span:"24 m:12",label:"附件3",path:"notes"},{default:t(()=>[e(u(V),{value:l.re3,"onUpdate:value":a[17]||(a[17]=i=>l.re3=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl3?(m(),N("span",It,[r(f((i=l.fl3)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:a[18]||(a[18]=q=>l.fl3="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[19]||(a[19]=q=>De(l.fl3))},"下载")])):(m(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":q=>re(q,"fl3"),"show-file-list":!1,onBeforeUpload:Ce},{default:t(()=>[e(u(S),{loading:_.value>0&&!l.fl3&&c.value=="fl3",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(f(_.value>0&&!l.fl3&&c.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),_.value&&!l.fl3&&c.value=="fl3"?(m(),F(h,{key:2,type:"line",percentage:_.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1}),e(d,{span:"24 m:12",label:"附件4",path:"notes"},{default:t(()=>[e(u(V),{value:l.re4,"onUpdate:value":a[20]||(a[20]=i=>l.re4=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"",path:"notes"},{default:t(()=>{var i;return[l.fl4?(m(),N("span",Rt,[r(f((i=l.fl4)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:a[21]||(a[21]=q=>l.fl4="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[22]||(a[22]=q=>De(l.fl4))},"下载")])):(m(),F(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":q=>re(q,"fl4"),"show-file-list":!1,onBeforeUpload:Ce},{default:t(()=>[e(u(S),{loading:_.value>0&&!l.fl4&&c.value=="fl4",size:"small",ghost:"",type:"primary"},{default:t(()=>[r(f(_.value>0&&!l.fl4&&c.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),_.value&&!l.fl4&&c.value=="fl4"?(m(),F(h,{key:2,type:"line",percentage:_.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):T("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Et=Ae({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Ue(["reset","search","search1","clear"],["update:model"]),setup(M,{emit:fe}){const z=Ke(),w=We(),v=fe,l=Ne(),{formRef:G,restoreValidation:H}=Ee(),g=Me(M,"model"),P=$([]),{pageData:I,getData:J,nextPage:y}=ce(Ge),ee=async b=>{const D=b.currentTarget,L=D.scrollTop;D.scrollTop+D.offsetHeight>=D.scrollHeight&&I.data.length<I.total&&(await y(),P.value=I.data,await pe(),setTimeout(()=>{D.scrollTop=L}))},me=async b=>{var D;ae.value=!0,b?(g.value.pid=b,v("search1"),l.setProjectInfo({pname:(D=P.value.find(L=>L.id==b))==null?void 0:D.proname,pid:b})):v("clear")},ge=Le.debounce(async b=>{await J({fuzzy:b,page:1}),P.value=I.data},300),te=$(!1),ae=$(!1),j=b=>{if(g.value.pid=null,te.value=!0,ae.value=!1,!b){oe();return}ge(b)},ve=async()=>{te.value&&!ae.value&&(await J({page:1}),P.value=I.data,te.value=!1)},oe=async()=>{await J({page:1}),P.value=I.data,v("search1")},ye=async b=>{g.value.status=b,v("search1")},be=async()=>{g.value.status=null},R=async()=>{await J({fuzzy:w.query.pname?w.query.pname:""}),P.value=I.data,g.value.pid=w.query.prjId?Number(w.query.prjId):void 0,g.value.fuzzy=w.query.debugname?w.query.debugname:"",l.setProjectInfo({pid:g.value.pid,pname:w.query.pname?w.query.pname:""}),v("search"),setTimeout(()=>{z.replace({path:w.path,query:{}})},10)};R();async function U(){await H(),g.value.fuzzy="",g.value.pid=null,g.value.status=null,v("reset")}const K=()=>{g.value.fuzzy="",v("search")};async function ue(){v("search")}return He(()=>w.query,b=>{b.pname&&R()}),(b,D)=>{const L=se,E=Ye,le=V,_e=qt,p=S,W=Bt,he=Pe,s=Xe,n=Oe,B=Qe;return m(),F(B,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(n,{ref_key:"formRef",ref:G,model:g.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ht(ue,["enter"])},{default:t(()=>[e(s,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(E,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:t(()=>[e(L,{filterable:"",clearable:"",value:g.value.pid,"onUpdate:value":[D[0]||(D[0]=A=>g.value.pid=A),me],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:oe,onSearch:j,onBlur:ve,options:P.value,onScroll:ee},null,8,["value","options"])]),_:1}),e(E,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:t(()=>[e(L,{clearable:"",filterable:"",value:g.value.status,"onUpdate:value":[D[1]||(D[1]=A=>g.value.status=A),ye],placeholder:"请选择状态",onClear:be,options:[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]},null,8,["value"])]),_:1}),e(E,{span:"24 s:12 m:6",label:"业务名称",path:"fuzzy"},{default:t(()=>[e(le,{value:g.value.fuzzy,"onUpdate:value":D[2]||(D[2]=A=>g.value.fuzzy=A),placeholder:"请输入",clearable:"",onClear:K},null,8,["value"])]),_:1}),e(E,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(he,{class:"w-full"},{default:t(()=>[e(p,{onClick:U},{icon:t(()=>[e(_e,{class:"text-icon"})]),default:t(()=>[r(" "+f(u(Z)("common.reset")),1)]),_:1}),e(p,{type:"primary",ghost:"",onClick:ue},{icon:t(()=>[e(W,{class:"text-icon"})]),default:t(()=>[r(" "+f(u(Z)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Mt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ht={key:0},Ot={key:1},Vt={key:0},Gt={key:1},Jt={key:0},Kt={key:1},Wt={key:0},Qt={key:1};function Re(M){return typeof M=="function"||Object.prototype.toString.call(M)==="[object Object]"&&!Ft(M)}const pa=Ae({name:"projectmanagement_business",__name:"index",setup(M){const fe=kt(),z=Ne(),w=We(),v=Ke(),{columns:l,columnChecks:G,data:H,getData:g,loading:P,pagination:I,mobilePagination:J,searchParams:y}=St({showTotal:!0,immediate:!1,apiFn:Tt,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",status:null,dbcreater:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"debugname",title:"业务名称",align:"center",width:160},{key:"proname",title:"所属项目",align:"center",width:160,render(s){return e("span",{class:"cursor-pointer",onClick:()=>ye(s)},[s.proname])}},{key:"status",title:"状态",align:"center",width:100,render(s){return e(ie,{color:{color:s.status==-1?"rgba(251, 146, 60, 0.15)":s.status==0?"rgba(156, 163, 175, 0.15)":s.status==1?"rgba(59, 130, 246, 0.15)":s.status==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:s.status==-1?"#FB923C":s.status==0?"#9CA3AF":s.status==1?"#3B82F6":s.status==2?"#FACC15":"#10B981",borderColor:s.status==-1?"#FB923C":s.status==0?"#9CA3AF":s.status==1?"#3B82F6":s.status==2?"#FACC15":"#10B981"}},{default:()=>[s.status==-1?"申请中":s.status==0?"待调试":s.status==1?"开始调试":s.status==2?"待审核":"审核完成"]})}},{key:"eqmname",title:"调试设备",align:"center",width:150},{key:"docker",title:"对接信息",align:"left",width:200,render:s=>e("div",{style:"line-height: 1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("对接方：")]),e("span",{style:"font-weight:500"},[s.docker||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("负责人：")]),e("span",{style:"font-weight:500"},[s.dockcharge||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("联系方式：")]),e("span",{style:"font-weight:500"},[s.dockcontact||"-"])])])},{key:"dbusername",title:"调试信息",align:"left",width:200,render(s){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("调试人：")]),e("span",{style:"font-weight:500"},[s.dbusername||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("工时：")]),e("span",{style:"color:#1890ff; font-weight:500"},[s.duration||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("开始：")]),e("span",null,[s.dbdbtime||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("结束：")]),e("span",null,[s.dedbtime||"-"])])])}},{key:"ckusername",title:"审核信息",align:"left",width:200,render(s){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("审核人：")]),e("span",{style:"font-weight:500"},[s.ckusername||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("时间：")]),e("span",{style:" font-weight:500"},[s.ckdbtime||"-"])])])}},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(s){return e("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[e("div",null,[e("span",{style:"color:#666"},[r("创建人：")]),e("span",{style:"font-weight:500"},[s.username||"-"])]),e("div",null,[e("span",{style:"color:#666"},[r("时间：")]),e("span",{style:" font-weight:500"},[s.dbtime||"-"])])])}},{key:"operate",title:Z("common.operate"),align:"center",width:280,fixed:"right",render:s=>{let n;return e("div",{class:"flex-center gap-8px"},[s.status==-1&&(z.userInfo.usertype==0||z.userInfo.usertype==2)&&e(de,{onPositiveClick:()=>U(s,0)},{default:()=>"确定通过申请吗？",trigger:()=>O(e(S,{type:"warning",ghost:!0,size:"small"},{default:()=>["通过申请"]}),[[Y("no-auth"),"project:Debug:update"]])}),s.status==0&&s.dbcreater==z.userInfo.id&&e(de,{onPositiveClick:()=>U(s,1)},{default:()=>"确定开始调试吗？",trigger:()=>O(e(S,{type:"success",ghost:!0,size:"small"},{default:()=>["开始"]}),[[Y("no-auth"),"project:Debug:update"]])}),s.status==1&&s.dbcreater==z.userInfo.id&&e(de,{onPositiveClick:()=>U(s,2)},{default:()=>qe("div",[qe("div","确定完成调试？"),qe("div",{style:{color:"#d03050",fontWeight:"500",marginTop:"6px"}},"请确认资料已提交，否则将拒绝审核！")]),trigger:()=>O(e(S,{type:"success",ghost:!0,size:"small"},{default:()=>["完成"]}),[[Y("no-auth"),"project:Debug:update"]])}),s.status==2&&(z.userInfo.usertype==0||z.userInfo.usertype==2)&&e(de,{onPositiveClick:()=>U(s,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>O(e(S,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[Y("no-auth"),"project:Debug:update"]])}),O(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>he(s)},{default:()=>[r("详情")]}),[[Y("no-auth"),"project:Debug:select"]]),O(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>K(s.id)},Re(n=Z("common.edit"))?n:{default:()=>[n]}),[[Y("no-auth"),"project:Debug:update"]]),e(de,{onPositiveClick:()=>R(s.id)},{default:()=>Z("common.confirmDelete"),trigger:()=>{let B;return O(e(S,{type:"error",ghost:!0,size:"small"},Re(B=Z("common.delete"))?B:{default:()=>[B]}),[[Y("no-auth"),"project:Debug:delete"]])}})])}}]}),{drawerVisible:ee,operateType:me,editingData:ge,handleAdd:te,handleEdit:ae,checkedRowKeys:j,onBatchDeleted:ve,onDeleted:oe}=zt(H,g);wt(async()=>{});const ye=s=>{z.setProjectInfo({pid:s.pid,pname:s.proname}),v.push("/projectmanagement/orderdetail?prjId="+s.pid+`&pname=${s.proname}&IsScroll=1`)};async function be(){console.log(j.value),ue(j.value.join(","),s=>{ve()})}async function R(s){const{data:n,error:B}=await Ie(s,y.pid);B||oe()}const U=async(s,n)=>{var Q;const{data:B,error:A}=await Je([{id:s.id,status:n,pid:s.pid}]);A||((Q=window.$message)==null||Q.success("操作成功"),g(),n==3?window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:s.pid,type:"debug"}})):(n==1||n==2)&&window.dispatchEvent(new CustomEvent("refreshTodo")))};function K(s){ae(s)}async function ue(s,n){const{data:B,error:A}=await Ie(s,y.pid);if(!A)n&&n(B);else return!1}const b=$(-1),D=s=>{s>0?(b.value=s,y.dbcreater=JSON.parse(JSON.stringify(s)),g()):(y.dbcreater=void 0,b.value=-1,g())},L=s=>{g()},E=()=>{if(console.log(w.query.prjId,"route.query.prjId"),w.query.debug){y.status=Number(w.query.debug),y.dbcreater=z.userInfo.id,D(z.userInfo.id);return}w.query.types=="2"&&(y.status=2),w.query.types=="-1"&&(y.status=-1),g()},le=()=>{g()},_e=()=>{H.value=[],I.itemCount=0},p=$(null),W=$(!1),he=s=>{p.value=s,W.value=!0};return(s,n)=>{const B=Nt,A=xt,Q=Pe,ke=rt,Te=ut,Fe=ot,we=Dt,Se=Qe,C=At,ze=Ut,ne=Ve,_=Y("no-auth");return m(),N("div",Mt,[e(Et,{model:u(y),"onUpdate:model":n[0]||(n[0]=c=>xe(y)?y.value=c:null),onReset:le,onSearch:E,onSearch1:u(g),onClear:_e},null,8,["model","onSearch1"]),e(Se,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(Q,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[n[6]||(n[6]=k("div",null,"待调试业务",-1)),e(A,{size:"small",value:b.value,"onUpdate:value":[n[1]||(n[1]=c=>b.value=c),D],name:"radiobuttongroup1"},{default:t(()=>[e(B,{value:-1,label:"默认"}),e(B,{value:u(z).userInfo.id,label:"我的调试"},null,8,["value"])]),_:1},8,["value"])]),_:1,__:[6]})]),"header-extra":t(()=>[e(Q,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[O((m(),F(u(S),{onClick:u(te),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(ke,{class:"text-icon"})]),default:t(()=>[n[7]||(n[7]=r(" "+f("新增")))]),_:1,__:[7]},8,["onClick"])),[[_,"project:Debug:insert"]]),e(u(de),{onPositiveClick:be},{trigger:t(()=>[O((m(),F(u(S),{size:"small",ghost:"",type:"error",disabled:u(j).length==0},{icon:t(()=>[e(Te,{class:Ct(["text-icon",{"animate-spin":u(P)}])},null,8,["class"])]),default:t(()=>[n[8]||(n[8]=r(" "+f("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[_,"project:Debug:delete"]])]),default:t(()=>[n[9]||(n[9]=r(" 确定要删除选中的吗？ "))]),_:1,__:[9]}),e(Fe,{columns:u(G),"onUpdate:columns":n[2]||(n[2]=c=>xe(G)?G.value=c:null),ctype:3},null,8,["columns"])]),_:1})]),default:t(()=>[e(we,{"checked-row-keys":u(j),"onUpdate:checkedRowKeys":n[3]||(n[3]=c=>xe(j)?j.value=c:null),columns:u(l),data:u(H),size:"small","flex-height":!u(fe).isMobile,loading:u(P),remote:"","row-key":c=>c.id,"scroll-x":u(l).reduce((c,re)=>c+(re.width||100),0),pagination:u(J),class:"sm:h-full","onUpdate:filters":L},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","scroll-x","pagination"]),e(Lt,{visible:u(ee),"onUpdate:visible":n[4]||(n[4]=c=>xe(ee)?ee.value=c:null),onSubmitted:u(g),"operate-type":u(me),pid:u(y).pid,"row-data":u(ge)},null,8,["visible","onSubmitted","operate-type","pid","row-data"])]),_:1}),e(ne,{show:W.value,"onUpdate:show":n[5]||(n[5]=c=>W.value=c),title:"查看详情",preset:"card",class:"w-1200px"},{default:t(()=>[e(ze,{bordered:"","label-placement":"left","label-align":"center",columns:2,"label-style":{width:"160px"}},{default:t(()=>[e(C,null,{label:t(()=>n[10]||(n[10]=[r(" 权重 ")])),default:t(()=>[k("span",null,f(p.value.tname),1)]),_:1}),e(C,null,{label:t(()=>n[11]||(n[11]=[r(" 业务名称 ")])),default:t(()=>[k("span",null,f(p.value.debugname),1)]),_:1}),e(C,null,{label:t(()=>n[12]||(n[12]=[r(" 计划起止时间 ")])),default:t(()=>[k("span",null,f(p.value.starttime)+"--"+f(p.value.endtime),1)]),_:1}),e(C,null,{label:t(()=>n[13]||(n[13]=[r(" 对接方 ")])),default:t(()=>[k("span",null,f(p.value.docker.split("&id=")[0]),1)]),_:1}),e(C,null,{label:t(()=>n[14]||(n[14]=[r(" 对接方负责人 ")])),default:t(()=>[k("span",null,f(p.value.dockcharge),1)]),_:1}),e(C,null,{label:t(()=>n[15]||(n[15]=[r(" 联系方式 ")])),default:t(()=>[k("span",null,f(p.value.dockcontact),1)]),_:1}),e(C,null,{label:t(()=>n[16]||(n[16]=[r(" 状态 ")])),default:t(()=>[p.value.status==-1?(m(),F(u(ie),{key:0,type:"default"},{default:t(()=>n[17]||(n[17]=[r("申请中")])),_:1,__:[17]})):T("",!0),p.value.status==0?(m(),F(u(ie),{key:1,type:"default"},{default:t(()=>n[18]||(n[18]=[r("未调试")])),_:1,__:[18]})):T("",!0),p.value.status==1?(m(),F(u(ie),{key:2,type:"info"},{default:t(()=>n[19]||(n[19]=[r("开始调试")])),_:1,__:[19]})):T("",!0),p.value.status==2?(m(),F(u(ie),{key:3,type:"success"},{default:t(()=>n[20]||(n[20]=[r("待审核")])),_:1,__:[20]})):T("",!0),p.value.status==3?(m(),F(u(ie),{key:4,type:"success"},{default:t(()=>n[21]||(n[21]=[r("审核完成")])),_:1,__:[21]})):T("",!0)]),_:1}),e(C,null,{label:t(()=>n[22]||(n[22]=[r(" 备注 ")])),default:t(()=>[k("span",null,f(p.value.notes),1)]),_:1}),e(C,null,{label:t(()=>n[23]||(n[23]=[r(" 调试人 ")])),default:t(()=>[k("span",null,f(p.value.dbusername),1)]),_:1}),e(C,null,{label:t(()=>n[24]||(n[24]=[r(" 调试开始时间 ")])),default:t(()=>[k("span",null,f(p.value.dbdbtime),1)]),_:1}),e(C,null,{label:t(()=>n[25]||(n[25]=[r(" 调试结束时间 ")])),default:t(()=>[k("span",null,f(p.value.dedbtime),1)]),_:1}),e(C,null,{label:t(()=>n[26]||(n[26]=[r(" 调试工时 ")])),default:t(()=>[k("span",null,f(p.value.duration),1)]),_:1}),e(C,null,{label:t(()=>n[27]||(n[27]=[r(" 审核人 ")])),default:t(()=>[k("span",null,f(p.value.ckusername),1)]),_:1}),e(C,null,{label:t(()=>n[28]||(n[28]=[r(" 审核时间 ")])),default:t(()=>[k("span",null,f(p.value.ckdbtime),1)]),_:1}),e(C,null,{label:t(()=>n[29]||(n[29]=[r(" 附件1 ")])),default:t(()=>{var c;return[p.value.re1?(m(),N("span",Ht,"文件别名"+f(p.value.re1),1)):T("",!0),p.value.fl1?(m(),N("span",Ot,f((c=p.value.fl1)==null?void 0:c.split("?")[1]),1)):T("",!0)]}),_:1}),e(C,null,{label:t(()=>n[30]||(n[30]=[r(" 附件2 ")])),default:t(()=>{var c;return[p.value.re2?(m(),N("span",Vt,"文件别名"+f(p.value.re2),1)):T("",!0),p.value.fl2?(m(),N("span",Gt,f((c=p.value.fl2)==null?void 0:c.split("?")[1]),1)):T("",!0)]}),_:1}),e(C,null,{label:t(()=>n[31]||(n[31]=[r(" 附件3 ")])),default:t(()=>{var c;return[p.value.re3?(m(),N("span",Jt,"文件别名"+f(p.value.re3),1)):T("",!0),p.value.fl3?(m(),N("span",Kt,f((c=p.value.fl3)==null?void 0:c.split("?")[1]),1)):T("",!0)]}),_:1}),e(C,null,{label:t(()=>n[32]||(n[32]=[r(" 附件4 ")])),default:t(()=>{var c;return[p.value.re4?(m(),N("span",Wt,"文件别名"+f(p.value.re4),1)):T("",!0),p.value.fl4?(m(),N("span",Qt,f((c=p.value.fl4)==null?void 0:c.split("?")[1]),1)):T("",!0)]}),_:1})]),_:1})]),_:1},8,["show"])])}}});export{pa as default};
