import{_ as ne}from"./round-add-CnBYTu1X.js";import{d as G,aq as Y,p as O,bY as se,s as le,r as E,ar as Q,a1 as ie,c0 as re,x as K,c as S,o as v,w as e,f as a,as as de,b as T,y as U,F as W,z as ce,e as r,t as f,T as pe,C as R,h as s,A as ue,E as X,c1 as me,B as D,g as z,a5 as fe,a4 as _e,aw as ve,q as ge,U as Z,at as be,N as ee,$ as M,L as he,i as ye,az as A,c2 as we,av as xe,aC as ke}from"./index-BrSW3Qk_.js";import{f as Ce,a as De,b as ze,_ as je,c as Ne,d as Se}from"./operate-drawer.vue_vue_type_style_index_0_lang-DYawH1mt.js";import{u as Pe,a as Le}from"./table-BgZMMP2L.js";import{_ as $e}from"./Avatar-9xoS9jCj.js";import{_ as Ie}from"./text-DMKQaler.js";import{N as te}from"./Popconfirm-BS6m75G8.js";import{_ as Te}from"./round-search-Bt589pab.js";import{u as Re}from"./usePageData-DxOb3kll.js";import{f as Be}from"./project-ClKCYf-S.js";import{_ as Fe}from"./Grid-CF6VHH9t.js";import{_ as Me}from"./FormItemGridItem-CtEU2lvz.js";import"./v4-FuVw324d.js";import"./utils-BNOftVEY.js";const Ue={key:0},Ee={class:"mt-4 border-t pt-3"},Ve={class:"flex items-start gap-2 mb-3"},Ke={class:"ml-2 flex-1"},Ae={class:"flex items-center"},Ge={class:"font-medium font-size-16px font-bold"},Oe={class:"text-gray-600 mt-1"},qe=G({name:"drawerLog",__name:"drawerLog",props:Y({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(h){const V=O();se();const t=le({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0}),j=h,c={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},g=E({});async function _(){p.value=[],Object.assign(t,j.rowData);const l=JSON.parse(j.rowData.context);t.proname=l.proname,t.notes=l.notes,t.problem=l.problem,t.solutions=l.solutions,t.feedback=l.feedback,t.summarize=l.summarize,t.percent=l.percent,k()}const p=E([]),b=Q(h,"visible");ie(b,()=>{b.value?_():(p.value=[],t.id=void 0)});function B(l){l||y()}function y(){b.value=!1}const k=async()=>{const{data:l,error:o}=await De({page:1,limit:100,pid:t.id});l&&(p.value=l.list)},P=re.debounce(async()=>{var i;const l=g.value[t.id];if(!(l!=null&&l.trim()))return(i=window.$message)==null?void 0:i.warning("请输入评论内容");const{data:o,error:n}=await Ce([{pid:t.id,context:l}]);o&&(g.value[t.id]="",t.num++,k())},1e3,{leading:!0,trailing:!1}),F=async l=>{var i;const{data:o,error:n}=await ze(l.id);o&&(k(),t.num--,(i=window.$message)==null||i.success("删除成功"))};return(l,o)=>{const n=ce,i=W,w=$e,L=Ie,N=de,$=ve,I=K("no-auth");return v(),S($,{show:b.value,"onUpdate:show":[o[1]||(o[1]=m=>b.value=m),B],"display-directive":"show",width:600,onMaskClick:y,onEsc:y},{default:e(()=>[a(N,{title:t.username+"的项目日报","native-scrollbar":!1,closable:""},{default:e(()=>[a(i,{ref:"formRef",model:t},{default:e(()=>[a(n,{label:"项目名称",path:"proname","label-placement":"left"},{label:e(()=>o[2]||(o[2]=[r("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:e(()=>[r("span",null,f(t.proname),1)]),_:1}),a(n,{label:"当前项目进度百分比",path:"percent","label-placement":"left"},{label:e(()=>o[3]||(o[3]=[r("div",{class:"font-size-16px font-bold"},"当前项目进度百分比",-1)])),default:e(()=>[r("span",null,f(t.percent?t.percent+"%":""),1)]),_:1}),a(n,{label:"当前工作内容及成果描述",path:"notes"},{label:e(()=>o[4]||(o[4]=[r("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述",-1)])),default:e(()=>[r("span",null,f(t.notes),1)]),_:1}),a(n,{label:"遇到问题",path:"problem"},{label:e(()=>o[5]||(o[5]=[r("div",{class:"font-size-16px font-bold"},"遇到问题",-1)])),default:e(()=>[r("span",null,f(t.problem),1)]),_:1}),a(n,{label:"解决措施",path:"solutions"},{label:e(()=>o[6]||(o[6]=[r("div",{class:"font-size-16px font-bold"},"解决措施",-1)])),default:e(()=>[r("span",null,f(t.solutions),1)]),_:1}),a(n,{label:"建议意见反馈",path:"feedback"},{label:e(()=>o[7]||(o[7]=[r("div",{class:"font-size-16px font-bold"},"建议意见反馈",-1)])),default:e(()=>[r("span",null,f(t.feedback),1)]),_:1}),a(n,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:e(()=>o[8]||(o[8]=[r("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感",-1)])),default:e(()=>[r("span",null,f(t.summarize),1)]),_:1})]),_:1},8,["model"]),t.num?(v(),T("div",Ue,f(t.num)+"评论",1)):U("",!0),a(pe,{name:"fade"},{default:e(()=>[r("div",Ee,[R((v(),T("div",Ve,[r("div",null,[a(w,{size:"small",src:c.avatar},null,8,["src"])]),a(s(ue),{type:"textarea",id:`comment-input-${t.id}`,value:g.value[t.id],"onUpdate:value":o[0]||(o[0]=m=>g.value[t.id]=m),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:X(me(s(P),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),a(s(D),{type:"primary",ghost:"",onClick:s(P)},{default:e(()=>o[9]||(o[9]=[z("发送")])),_:1,__:[9]},8,["onClick"])])),[[I,"project:Comment:insert"]]),(v(!0),T(fe,null,_e(p.value,m=>(v(),T("div",{key:m.id,class:"flex mb-3"},[a(w,{size:"small",src:c.avatar},null,8,["src"]),r("div",Ke,[r("div",Ae,[r("span",Ge,f(m.username),1),a(L,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:e(()=>[z(f(m.dbtime),1)]),_:2},1024),s(V).userInfo.id==m.creater?(v(),S(s(te),{key:0,onPositiveClick:u=>F(m)},{trigger:e(()=>[R((v(),S(s(D),{quaternary:"",type:"error",size:"small"},{default:e(()=>o[10]||(o[10]=[z(" 删除 ")])),_:1,__:[10]})),[[I,"project:Comment:delete"]])]),default:e(()=>[o[11]||(o[11]=z(" 确定删除吗？ "))]),_:2,__:[11]},1032,["onPositiveClick"])):U("",!0)]),r("div",Oe,f(m.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),He=G({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Y(["reset","search","clear"],["update:model"]),setup(h,{emit:V}){const t=V,{formRef:j}=ge(),c=Q(h,"model"),g=O(),_=E([]),{pageData:p,getData:b,nextPage:B}=Re(Be),y=async n=>{const i=n.currentTarget;i.scrollTop+i.offsetHeight>=i.scrollHeight&&p.data.length<p.total&&(B(),_.value=p.data)},k=async n=>{var i;n?(c.value.pid=n,t("search"),g.setProjectInfo({pname:(i=_.value.find(w=>w.id==n))==null?void 0:i.proname,pid:n})):t("search")},P=async n=>{await b({fuzzy:n}),_.value=p.data},F=async()=>{await b(),_.value=p.data};(async()=>{var n,i;await b({fuzzy:g.userInfo.pname}),_.value=p.data,c.value.pid=g.userInfo.pid?g.userInfo.pid:(n=_.value[0])==null?void 0:n.id,g.setProjectInfo({pid:c.value.pid,pname:(i=_.value.find(w=>w.id==c.value.pid))==null?void 0:i.proname}),t("search")})();async function o(){t("search")}return(n,i)=>{const w=be,L=Me,N=Te,$=D,I=ee,m=Fe,u=W,d=Z;return v(),S(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:e(()=>[a(u,{ref_key:"formRef",ref:j,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:X(o,["enter"])},{default:e(()=>[a(m,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:e(()=>[a(L,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:e(()=>[a(w,{filterable:"",clearable:"",value:c.value.pid,"onUpdate:value":[i[0]||(i[0]=x=>c.value.pid=x),k],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:_.value,onScroll:y,onClear:F,onSearch:P},null,8,["value","options"])]),_:1}),a(L,{span:"24  s:12 m:6",class:"pr-24px"},{default:e(()=>[a(I,{class:"w-full"},{default:e(()=>[a($,{type:"primary",ghost:"",onClick:o},{icon:e(()=>[a(N,{class:"text-icon"})]),default:e(()=>[z(" "+f(s(M)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ye={key:0};function J(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!ke(h)}const ct=G({name:"projectmanagement_daylog",__name:"index",props:{pid:{default:void 0},type:{}},emits:["thereIsData"],setup(h,{emit:V}){const t=he(),j=O(),c=h,{columns:g,data:_,getData:p,loading:b,mobilePagination:B,searchParams:y}=Pe({showTotal:!0,immediate:!1,apiFn:Ne,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:u=>a("div",null,[u.username+"的项目日报"])},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:M("common.operate"),align:"center",width:140,fixed:"right",render:u=>{let d;return a("div",{class:"flex-center gap-8px"},[a(D,{type:"primary",ghost:!0,size:"small",onClick:()=>I(u)},{default:()=>[z("查看详情")]}),j.userInfo.id==u.creater&&R(a(D,{type:"primary",ghost:!0,size:"small",onClick:()=>L(u.id)},J(d=M("common.edit"))?d:{default:()=>[d]}),[[K("no-auth"),"project:DailyReport:update"]]),j.userInfo.id==u.creater&&a(te,{onPositiveClick:()=>w(u.id)},{default:()=>M("common.confirmDelete"),trigger:()=>{let x;return R(a(D,{type:"error",ghost:!0,size:"small"},J(x=M("common.delete"))?x:{default:()=>[x]}),[[K("no-auth"),"project:DailyReport:delete"]])}})])}}]}),{drawerVisible:k,operateType:P,editingData:F,handleAdd:l,handleEdit:o,checkedRowKeys:n,onDeleted:i}=Le(_,p);async function w(u){const{data:d,error:x}=await Se(u);x||i()}function L(u){o(u)}const N=E(!1),$=E({}),I=u=>{N.value=!0,$.value=u},m=()=>{p()};return ye(()=>{c.type!="externalLiaison"&&p()}),(u,d)=>{const x=ee,q=ne,ae=xe,oe=Z,H=K("no-auth");return v(),T("div",Je,[c.pid?U("",!0):(v(),S(He,{key:0,model:s(y),"onUpdate:model":d[0]||(d[0]=C=>A(y)?y.value=C:null),onReset:m,onSearch:s(p)},null,8,["model","onSearch"])),a(oe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},we({header:e(()=>[a(x,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:e(()=>[c.pid?U("",!0):(v(),T("div",Ye,"项目日报"))]),_:1}),c.pid?R((v(),S(s(D),{key:0,onClick:s(l),size:"small",ghost:"",type:"primary"},{icon:e(()=>[a(q,{class:"text-icon"})]),default:e(()=>[d[4]||(d[4]=z(" "+f("新增")))]),_:1,__:[4]},8,["onClick"])),[[H,"project:DailyReport:insert"]]):U("",!0)]),default:e(()=>[a(ae,{"checked-row-keys":s(n),"onUpdate:checkedRowKeys":d[1]||(d[1]=C=>A(n)?n.value=C:null),columns:s(g),data:s(_),size:"small","flex-height":!s(t).isMobile,loading:s(b),remote:"","row-key":C=>C.id,pagination:s(B),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(je,{visible:s(k),"onUpdate:visible":d[2]||(d[2]=C=>A(k)?k.value=C:null),onSubmitted:s(p),"operate-type":s(P),pid:c.pid||s(y).pid,"row-data":s(F)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),a(qe,{visible:N.value,"onUpdate:visible":d[3]||(d[3]=C=>N.value=C),"row-data":$.value},null,8,["visible","row-data"])]),_:2},[c.pid?void 0:{name:"header-extra",fn:e(()=>[a(x,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:e(()=>[R((v(),S(s(D),{onClick:s(l),size:"small",ghost:"",type:"primary"},{icon:e(()=>[a(q,{class:"text-icon"})]),default:e(()=>[d[5]||(d[5]=z(" "+f("新增")))]),_:1,__:[5]},8,["onClick"])),[[H,"project:DailyReport:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{ct as default};
