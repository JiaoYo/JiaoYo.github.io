import{_ as ze}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CQRJ3Aex.js";import{d as ne,q as ae,s as _e,v as ye,x as $e,j as ee,b as Ae,$ as s,r as Pe,y as Oe,K as Q,o as k,c as P,w as n,g as t,h as x,t as L,i as l,L as G,e as le,ag as ue,U as W,aQ as Ve,ai as pe,f as oe,aR as Me,N as te,av as je,aS as Be,aT as de,A as ge,C as Fe,E as ve,X as be,aj as Ie,D as he,B as X,aa as Ee,ab as Ge,aU as He,M as Ke,a9 as we,Z as qe,am as me,ar as We,aV as Qe,ac as K,ad as Xe}from"./index-CIkMAdTj.js";import{f as Ze,m as Je,n as Ye,a as et,o as tt}from"./audit-events-CEe69SfR.js";import{u as at,a as lt}from"./table-DYjxKyYT.js";import{u as ce}from"./usePageData-BiqXe7A3.js";import{a as nt}from"./events-BVjbNb-8.js";import{f as ot,a as st}from"./common-u2yfVf0Y.js";import{_ as it}from"./TimePicker-B-lebnwu.js";import{b as rt,a as ut,_ as pt}from"./DataTable-DUhJ-ag2.js";import{_ as dt}from"./Cascader-Bbw2Uyx7.js";import{_ as mt}from"./DatePicker-DlsA-kkR.js";import{_ as ct}from"./round-search-DolOrREp.js";import{_ as ft}from"./round-refresh-Cw_OacQi.js";import{_ as _t}from"./FormItemGridItem-B-PuJtjX.js";import{_ as yt}from"./Grid-BbZ5ihyN.js";import{h as fe}from"./permission-9-vwFfOY.js";import{T as gt}from"./basicconf-DOftfP2Y.js";import{_ as vt}from"./Popconfirm-uRFGs8ok.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DyTGTkTN.js";import"./setting-outlined-BjNyCKNK.js";import"./round-delete-5y7n-Q4W.js";import"./refresh-CQAxWQOp.js";import"./Upload-D11BssPZ.js";import"./Progress-DCQkG3_f.js";import"./defineProperty-DzO1Gu_f.js";import"./Forward-BV1I61Y9.js";const bt={class:"w-100%"},ht=oe("span",null,"至",-1),wt=oe("span",null,"至",-1),Dt=ne({name:"OperateDrawer",__name:"operate-drawer",props:ae({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ae(["submitted"],["update:visible"]),setup(N,{emit:M}){const p=N,S=M,h=_e(N,"visible"),{formRef:y,validate:O,restoreValidation:j}=ye(),{defaultRequiredRule:v}=$e(),B=ee([]),w=Ae(()=>({add:s("page.audit.strategy.addTitle"),edit:s("page.audit.strategy.editTitle")})[p.operateType]),e=Pe(T());function T(){return{pname:"",aetype:0,psort:0,pcontent:null,efftime:0,starttime:null,endtime:null,aename:"",alevel:0,atype:null,pdesc:"",forsys:"",status:0,ptype:1,weekstart:void 0,weekend:void 0}}const F={pname:v,starttime:v,endtime:v,atype:{type:"number",required:!0,trigger:"change",message:"请选择审计类型"}},V=()=>["星期一","星期二","星期三","星期四","星期五","星期六","星期天"].map((a,f)=>({label:a,value:f+1}));async function b(){await H(),await E(),await d(),Object.assign(e,T()),p.operateType==="edit"&&p.rowData&&(p.rowData.pcontent=p.rowData.pcontent?p.rowData.pcontent.split(",").map(Number):[],p.rowData.starttime=p.rowData.starttime?p.rowData.starttime:void 0,p.rowData.endtime=p.rowData.endtime?p.rowData.endtime:void 0,p.rowData.forsys=p.rowData.forsys?p.rowData.forsys.split(",").map(Number):[],Object.assign(e,p.rowData),c.value=[e.starttime,e.endtime])}function R(){h.value=!1}const U=ee([]);async function H(){const{data:u,error:a}=await ot();a||(U.value=u,u.forEach(f=>{B.value.push(f.id)}),await I())}async function I(){const{data:u,error:a}=await st();if(!a){let f=U.value.concat(u);U.value=Be(f)}}const{pageData:z,getData:E,nextPage:C}=ce(Ze),i=async u=>{const a=u.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&z.data.length<z.total&&C()},{pageData:r,getData:d,nextPage:$}=ce(nt),Z=async u=>{const a=u.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&r.data.length<r.total&&$()},c=ee(null);async function De(u,a){e.starttime=de(1,a[0]),e.endtime=de(1,a[1])}async function ke(u,a){console.log(e.pcontent)}async function xe(){var a,f,m,g;await O();let u=[];if(e.pcontent&&e.pcontent.length>0&&(u=e.pcontent.filter(_=>!B.value.includes(_))),p.operateType==="add"){const{data:_,error:D}=await Je([{pname:e.pname,aetype:e.aetype,psort:e.psort,pcontent:u.length>0?u.join(","):"",efftime:e.efftime,starttime:e.starttime,endtime:e.endtime,aename:e.aename,alevel:e.alevel,atype:e.atype,pdesc:e.pdesc,forsys:e.forsys.length>0?(a=e.forsys)==null?void 0:a.join(","):"",status:e.status,ptype:e.ptype,weekstart:e.weekstart,weekend:e.weekend}]);D||((f=window.$message)==null||f.success(s("common.addSuccess")),R(),S("submitted"))}else{const{data:_,error:D}=await Ye([{id:p.rowData.id,pname:e.pname,aetype:e.aetype,psort:e.psort,pcontent:u.length>0?u.join(","):"",efftime:e.efftime,starttime:e.starttime,endtime:e.endtime,aename:e.aename,alevel:e.alevel,atype:e.atype,pdesc:e.pdesc,forsys:e.forsys.length>0?(m=e.forsys)==null?void 0:m.join(","):"",status:e.status,ptype:e.ptype,weekstart:e.weekstart,weekend:e.weekend}]);D||((g=window.$message)==null||g.success(s("common.updateSuccess")),R(),S("submitted"))}}Oe(h,()=>{h.value&&(b(),j())});const Ne=u=>{var g;function a(_){const[D,J,A]=_.split(":").map(Number);return D*3600+J*60+A}const f=a(e.starttime),m=a(u);if(f>m)return e.endtime=null,(g=window.$message)==null?void 0:g.warning("开始时间不能大于结束时间，请您重新选择")},Se=u=>(e.weekstart&&e.weekstart>u.value&&(u.disabled=!0),u.label);return(u,a)=>{const f=ge,m=Fe,g=rt,_=ve,D=ut,J=dt,A=be,se=it,Te=mt,Ue=Ie,Ce=he,ie=X,Le=Ee,Re=Ge,re=Q("no-space");return k(),P(Re,{show:h.value,"onUpdate:show":a[18]||(a[18]=o=>h.value=o),"display-directive":"show",width:560},{default:n(()=>[t(Le,{title:w.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[t(_,{size:16},{default:n(()=>[t(ie,{onClick:R},{default:n(()=>[x(L(l(s)("common.cancel")),1)]),_:1}),t(ie,{type:"primary",onClick:xe},{default:n(()=>[x(L(l(s)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[t(Ce,{ref_key:"formRef",ref:y,model:e,rules:F},{default:n(()=>[t(m,{label:l(s)("page.audit.strategy.name"),path:"pname"},{default:n(()=>[G(t(f,{clearable:"",value:e.pname,"onUpdate:value":a[0]||(a[0]=o=>e.pname=o),placeholder:l(s)("page.audit.strategy.form.name")},null,8,["value","placeholder"]),[[re]])]),_:1},8,["label"]),t(m,{label:l(s)("page.audit.strategy.eventType"),path:"aetype"},{default:n(()=>[t(D,{value:e.aetype,"onUpdate:value":a[1]||(a[1]=o=>e.aetype=o)},{default:n(()=>[t(_,null,{default:n(()=>[(k(!0),le(pe,null,ue(l(W)(l(Ve)),(o,Y)=>(k(),P(g,{value:o.value,key:Y},{default:n(()=>[x(L(o.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(m,{label:"事件",path:"pcontent"},{default:n(()=>[t(J,{value:e.pcontent,"onUpdate:value":[a[2]||(a[2]=o=>e.pcontent=o),ke],multiple:"",clearable:"",placeholder:"请选择事件","max-tag-count":1,options:U.value,"show-path":!1,filterable:"","value-field":"id","label-field":"pname"},null,8,["value","options"])]),_:1}),t(m,{label:l(s)("page.audit.strategy.efftime"),path:"efftime"},{default:n(()=>[oe("div",bt,[t(D,{value:e.efftime,"onUpdate:value":[a[3]||(a[3]=o=>e.efftime=o),a[4]||(a[4]=o=>{e.starttime=null,e.endtime=null,c.value=null})]},{default:n(()=>[t(_,null,{default:n(()=>[(k(!0),le(pe,null,ue(l(W)(l(Me)),(o,Y)=>(k(),P(g,{value:o.value,key:Y},{default:n(()=>[x(L(o.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"]),e.efftime===1?(k(),P(_,{key:0,align:"center",justify:"space-between",class:"mt-15px"},{default:n(()=>[t(A,{filterable:"",value:e.weekstart,"onUpdate:value":a[5]||(a[5]=o=>e.weekstart=o),placeholder:"请选择星期",options:V(),style:{width:"230px"}},null,8,["value","options"]),ht,t(A,{filterable:"",value:e.weekend,"onUpdate:value":a[6]||(a[6]=o=>e.weekend=o),placeholder:"请选择星期",options:V(),"render-label":Se,style:{width:"230px"}},null,8,["value","options"])]),_:1})):te("",!0),e.efftime===0||e.efftime===1?(k(),P(_,{key:1,align:"center",justify:"space-between",class:"mt-15px"},{default:n(()=>[t(se,{"formatted-value":e.starttime,"onUpdate:formattedValue":a[7]||(a[7]=o=>e.starttime=o),type:"time",format:"HH:mm:ss",clearable:"",style:{width:"230px"}},null,8,["formatted-value"]),wt,t(se,{"formatted-value":e.endtime,"onUpdate:formattedValue":[a[8]||(a[8]=o=>e.endtime=o),Ne],type:"time",format:"HH:mm:ss",clearable:"",style:{width:"230px"}},null,8,["formatted-value"])]),_:1})):te("",!0),e.efftime===2?(k(),P(_,{key:2,align:"center",class:"mt-15px w-100%","item-style":{width:"100%"}},{default:n(()=>[t(Te,{"formatted-value":c.value,"onUpdate:formattedValue":[a[9]||(a[9]=o=>c.value=o),De],type:"datetimerange","date-format":"yyyy-MM-dd hh:mm:ss",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})):te("",!0)])]),_:1},8,["label"]),t(m,{label:l(s)("page.audit.strategy.eventname"),path:"aename"},{default:n(()=>[G(t(f,{value:e.aename,"onUpdate:value":a[10]||(a[10]=o=>e.aename=o),placeholder:l(s)("page.audit.strategy.form.eventname")},null,8,["value","placeholder"]),[[re]])]),_:1},8,["label"]),t(m,{label:l(s)("page.audit.strategy.eventLevel"),path:"alevel"},{default:n(()=>[t(A,{filterable:"",value:e.alevel,"onUpdate:value":a[11]||(a[11]=o=>e.alevel=o),placeholder:"请选择审计事件级别",options:l(W)(l(je)),style:{width:"100%"}},null,8,["value","options"])]),_:1},8,["label"]),t(m,{label:l(s)("page.audit.strategy.type"),path:"atype"},{default:n(()=>[t(A,{value:e.atype,"onUpdate:value":a[12]||(a[12]=o=>e.atype=o),placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:l(z).data,"reset-menu-on-options-change":!1,onScroll:i},null,8,["value","options"])]),_:1},8,["label"]),t(m,{label:"转发策略",path:"forsys"},{default:n(()=>[t(A,{value:e.forsys,"onUpdate:value":a[13]||(a[13]=o=>e.forsys=o),multiple:"",placeholder:"请选择转发策略",clearable:"",filterable:"","label-field":"ipaddr","value-field":"id",options:l(r).data,"reset-menu-on-options-change":!1,onScroll:Z},null,8,["value","options"])]),_:1}),t(m,{label:l(s)("page.audit.strategy.describe"),path:"pdesc"},{default:n(()=>[t(f,{value:e.pdesc,"onUpdate:value":a[14]||(a[14]=o=>e.pdesc=o),placeholder:l(s)("page.audit.strategy.form.describe"),type:"textarea"},null,8,["value","placeholder"])]),_:1},8,["label"]),t(m,{label:l(s)("page.audit.strategy.status"),path:"status"},{default:n(()=>[t(D,{value:e.status,"onUpdate:value":a[15]||(a[15]=o=>e.status=o)},{default:n(()=>[t(_,null,{default:n(()=>[t(g,{value:0},{default:n(()=>[x("开启")]),_:1}),t(g,{value:1},{default:n(()=>[x("禁用")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(m,{label:l(s)("page.audit.strategy.form.built"),path:"ptype"},{default:n(()=>[t(D,{value:e.ptype,"onUpdate:value":a[16]||(a[16]=o=>e.ptype=o)},{default:n(()=>[t(_,null,{default:n(()=>[t(g,{value:0},{default:n(()=>[x(L(l(s)("common.yesOrNo.yes")),1)]),_:1}),t(g,{value:1},{default:n(()=>[x(L(l(s)("common.yesOrNo.no")),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(m,{label:l(s)("page.audit.type.sort"),path:"psort"},{default:n(()=>[t(Ue,{min:0,value:e.psort,"onUpdate:value":a[17]||(a[17]=o=>e.psort=o),placeholder:l(s)("page.audit.strategy.form.sort"),style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),kt=ne({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ae(["reset","search"],["update:model"]),setup(N,{emit:M}){const p=M,{formRef:S,restoreValidation:h}=ye(),y=_e(N,"model");function O(){y.value.fuzzy="",p("search")}async function j(){await h(),p("reset")}async function v(){p("search")}return(B,w)=>{const e=ge,T=_t,F=be,V=ft,b=X,R=ct,U=ve,H=yt,I=he,z=we,E=Q("no-space");return k(),P(z,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(I,{ref_key:"formRef",ref:S,model:y.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ke(v,["enter"])},{default:n(()=>[t(H,{responsive:"screen","item-responsive":""},{default:n(()=>[t(T,{span:"24 s:12 m:6",label:l(s)("page.audit.strategy.name"),path:"fuzzy",class:"pr-24px"},{default:n(()=>[G(t(e,{clearable:"",value:y.value.fuzzy,"onUpdate:value":w[0]||(w[0]=C=>y.value.fuzzy=C),placeholder:l(s)("page.audit.strategy.form.name"),onClear:O},null,8,["value","placeholder"]),[[E]])]),_:1},8,["label"]),t(T,{span:"24 s:12 m:6",label:"使用状态",path:"status",class:"pr-24px"},{default:n(()=>[t(F,{filterable:"",clearable:"",value:y.value.status,"onUpdate:value":[w[1]||(w[1]=C=>y.value.status=C),v],placeholder:"请选择使用状态",options:l(W)(l(He))},null,8,["value","options"])]),_:1}),t(T,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[t(U,{class:"w-full"},{default:n(()=>[t(b,{onClick:j},{icon:n(()=>[t(V,{class:"text-icon"})]),default:n(()=>[x(" "+L(l(s)("common.reset")),1)]),_:1}),t(b,{type:"primary",ghost:"",onClick:v},{icon:n(()=>[t(R,{class:"text-icon"})]),default:n(()=>[x(" "+L(l(s)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),xt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function q(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!Xe(N)}const Zt=ne({name:"audit_strategy",__name:"index",setup(N){const M=qe(),{columns:p,columnChecks:S,data:h,getData:y,loading:O,mobilePagination:j,searchParams:v,resetSearchParams:B}=at({apiFn:et,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,status:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"pname",title:s("page.audit.strategy.name"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"alevel",title:s("page.audit.strategy.eventLevel"),align:"center",minWidth:180,render:i=>{(i.alevel===void 0||i.alevel===null)&&(i.alevel=0);const r={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},d=s(gt[i.alevel]);let $={color:r[i.alevel],textColor:"#ffffff",borderColor:r[i.alevel]};return t(me,{size:"small",color:$},q(d)?d:{default:()=>[d]})}},{key:"pdesc",title:s("page.audit.strategy.describe"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"ptype",title:s("page.audit.strategy.built"),align:"center",width:120,render:i=>{const r={0:"primary",1:"error"},d=s(We[i.ptype]);return t(me,{type:r[i.ptype]},q(d)?d:{default:()=>[d]})}},{key:"status",title:s("page.audit.strategy.status"),align:"center",width:120,render:i=>t(Qe,{disabled:!0,value:i.status,checkedValue:0,uncheckedValue:1},null)},{key:"operate",title:s("common.operate"),align:"center",width:130,render:i=>{let r;return i.ptype!=0?t("div",{class:"flex-center gap-8px"},[G(t(X,{type:"primary",ghost:!0,size:"small",onClick:()=>E(i.id)},q(r=s("common.edit"))?r:{default:()=>[r]}),[[Q("no-auth"),"sys.audit.policy.update"]]),t(vt,{onPositiveClick:()=>z(i.id)},{default:()=>s("common.confirmDelete"),trigger:()=>{let d;return G(t(X,{type:"error",ghost:!0,size:"small"},q(d=s("common.delete"))?d:{default:()=>[d]}),[[Q("no-auth"),"sys.audit.policy.delete"]])}})]):null}}]}),{drawerVisible:w,operateType:e,editingData:T,handleAdd:F,handleEdit:V,checkedRowKeys:b,onBatchDeleted:R,onDeleted:U,closeDrawer:H}=lt(h,y);async function I(){console.log(b.value),C(b.value,i=>{R()})}function z(i){console.log(i),C([i],r=>{U()})}function E(i){V(i)}async function C(i,r){const{data:d,error:$}=await tt(i);if(!$)r&&r(d);else return!1}return(i,r)=>{const d=ze,$=pt,Z=we;return k(),le("div",xt,[t(kt,{model:l(v),"onUpdate:model":r[0]||(r[0]=c=>K(v)?v.value=c:null),onReset:l(B),onSearch:l(y)},null,8,["model","onReset","onSearch"]),t(Z,{title:l(s)("page.audit.strategy.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[t(d,{columns:l(S),"onUpdate:columns":r[1]||(r[1]=c=>K(S)?S.value=c:null),"disabled-delete":l(b).length===0,loading:l(O),onAdd:l(F),onDelete:I,onRefresh:l(y),"is-view-add-button":l(fe)("sys.audit.policy.insert"),"is-view-delete-button":l(fe)("sys.audit.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:n(()=>[t($,{"checked-row-keys":l(b),"onUpdate:checkedRowKeys":r[2]||(r[2]=c=>K(b)?b.value=c:null),columns:l(p),data:l(h),size:"small","flex-height":!l(M).isMobile,"scroll-x":962,loading:l(O),remote:"","row-key":c=>c.id,pagination:l(j),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Dt,{visible:l(w),"onUpdate:visible":r[3]||(r[3]=c=>K(w)?w.value=c:null),"operate-type":l(e),"row-data":l(T),onSubmitted:l(y)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{Zt as default};
