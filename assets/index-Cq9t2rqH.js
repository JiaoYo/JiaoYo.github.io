import{_ as Re}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DInf_94l.js";import{az as re,aA as de,aB as Me,aC as Le,aD as je,d as oe,aE as Ge,aF as ze,b as Z,j as X,aG as Oe,aH as Ee,aI as Be,aJ as Fe,aK as Y,aL as Ie,aM as fe,aN as ge,aO as ve,aP as he,q as ue,s as we,v as Se,x as Ve,$ as d,r as De,y as He,o as W,c as J,w as s,g as t,h as F,t as ne,i as o,U as We,av as qe,X as Ke,C as xe,A as me,D as Te,B,E as Q,aa as Je,ab as Xe,K as ce,L as pe,M as Ye,a9 as Ce,Z as Ze,am as Qe,e as et,ac as ee,f as _e,N as tt,ad as at,F as nt,ay as ot}from"./index-D4ngyqj9.js";import{f as ke}from"./system-manage-CgvJLL8n.js";import{d as Ne,f as Ue,e as it,g as lt,h as st,i as rt,j as dt,k as ut,l as ct}from"./audit-events-Bj3RDD_j.js";import{u as ae}from"./usePageData-C8tvUOsP.js";import{u as pt,a as mt}from"./table-B-O-KQBR.js";import{_ as ft}from"./round-search-afmjBCkU.js";import{_ as gt}from"./round-refresh-DGUmO54G.js";import{_ as vt}from"./FormItemGridItem-tGN8LyML.js";import{_ as ht}from"./Grid-3ti0RnUO.js";import{T as _t}from"./collection-S10aAcxA.js";import{h as ye}from"./permission-Ble3lU0D.js";import{_ as yt}from"./Tree-BZVxx32V.js";import{_ as be}from"./Popconfirm-DsZjOQOD.js";import{_ as bt}from"./DataTable-Bkf-sC_U.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-QeSS3CPK.js";import"./setting-outlined-DuD7pXau.js";import"./round-delete-DNpSdI2L.js";import"./refresh-CahwNtd4.js";import"./Upload-B89re_JK.js";import"./Progress-Q6s-Jzjc.js";import"./Forward-Bpby_coU.js";const zt=re("split",`
 display: flex;
 width: 100%;
 height: 100%;
`,[de("horizontal",`
 flex-direction: row;
 `),de("vertical",`
 flex-direction: column;
 `),re("split-pane-1",`
 overflow: hidden;
 `),re("split-pane-2",`
 overflow: hidden;
 flex: 1;
 `),Me("resize-trigger",`
 background-color: var(--n-resize-trigger-color);
 transition: background-color .3s var(--n-bezier);
 `,[de("hover",`
 background-color: var(--n-resize-trigger-color-hover);
 `),Le("&:hover",`
 background-color: var(--n-resize-trigger-color-hover);
 `)])]),wt=n=>{const{primaryColorHover:y,borderColor:u}=n;return{resizableTriggerColorHover:y,resizableTriggerColor:u}},St={name:"Split",common:je,self:wt},Dt=Object.assign(Object.assign({},ze.props),{direction:{type:String,default:"horizontal"},resizeTriggerSize:{type:Number,default:3},disabled:Boolean,defaultSize:{type:[String,Number],default:.5},"onUpdate:size":[Function,Array],onUpdateSize:[Function,Array],size:[String,Number],min:{type:[String,Number],default:0},max:{type:[String,Number],default:1},pane1Class:String,pane1Style:[Object,String],pane2Class:String,pane2Style:[Object,String],onDragStart:Function,onDragMove:Function,onDragEnd:Function,watchProps:Array}),xt=oe({name:"Split",props:Dt,setup(n){var y;const{mergedClsPrefixRef:u,inlineThemeDisabled:m}=Ge(n),_=ze("Split","-split",zt,St,n,u),x=Z(()=>{const{common:{cubicBezierEaseInOut:r},self:{resizableTriggerColor:p,resizableTriggerColorHover:z}}=_.value;return{"--n-bezier":r,"--n-resize-trigger-color":p,"--n-resize-trigger-color-hover":z}}),P=X(null),C=X(!1),j=Oe(n,"size"),i=X(n.defaultSize);!((y=n.watchProps)===null||y===void 0)&&y.includes("defaultSize")&&Ee(()=>i.value=n.defaultSize);const k=r=>{const p=n["onUpdate:size"];n.onUpdateSize&&ve(n.onUpdateSize,r),p&&ve(p,r),i.value=r},I=Be(j,i),A=Z(()=>{const r=I.value;if(typeof r=="string")return{flex:`0 0 ${r}`};if(typeof r=="number"){const p=r*100;return{flex:`0 0 calc(${p}% - ${n.resizeTriggerSize*p/100}px)`}}}),G=Z(()=>n.direction==="horizontal"?{width:`${n.resizeTriggerSize}px`,height:"100%"}:{width:"100%",height:`${n.resizeTriggerSize}px`}),$=Z(()=>{const r=n.direction==="horizontal";return{width:r?`${n.resizeTriggerSize}px`:"",height:r?"":`${n.resizeTriggerSize}px`,cursor:n.direction==="horizontal"?"col-resize":"row-resize"}});let R=0;const q=r=>{r.preventDefault(),C.value=!0,n.onDragStart&&n.onDragStart(r);const p="mousemove",z="mouseup",w=S=>{T(S),n.onDragMove&&n.onDragMove(S)},O=()=>{he(p,document,w),he(z,document,O),C.value=!1,n.onDragEnd&&n.onDragEnd(r),document.body.style.cursor=""};document.body.style.cursor=$.value.cursor,fe(p,document,w),fe(z,document,O);const E=P.value;if(E){const S=E.getBoundingClientRect();n.direction==="horizontal"?R=r.clientX-S.left:R=S.top-r.clientY}T(r)},T=r=>{var p,z;const w=(z=(p=P.value)===null||p===void 0?void 0:p.parentElement)===null||z===void 0?void 0:z.getBoundingClientRect();if(!w)return;const{direction:O}=n,E=w.width-n.resizeTriggerSize,S=w.height-n.resizeTriggerSize,V=O==="horizontal"?E:S,g=O==="horizontal"?r.clientX-w.left-R:r.clientY-w.top+R,{min:l,max:N}=n,U=typeof l=="string"?ge(l):l*V,D=typeof N=="string"?ge(N):N*V;let f=g;f=Math.max(f,U),f=Math.min(f,D,V),typeof I.value=="string"?k(`${f}px`):k(f/V)},b=m?Fe("split",void 0,x,n):void 0;return{themeClass:b==null?void 0:b.themeClass,onRender:b==null?void 0:b.onRender,cssVars:m?void 0:x,resizeTriggerElRef:P,isDragging:C,mergedClsPrefix:u,resizeTriggerWrapperStyle:$,resizeTriggerStyle:G,handleMouseDown:q,firstPaneStyle:A}},render(){var n,y,u,m,_;return(n=this.onRender)===null||n===void 0||n.call(this),Y("div",{class:[`${this.mergedClsPrefix}-split`,`${this.mergedClsPrefix}-split--${this.direction}`,this.themeClass],style:this.cssVars},Y("div",{class:[`${this.mergedClsPrefix}-split-pane-1`,this.pane1Class],style:[this.firstPaneStyle,this.pane1Style]},(u=(y=this.$slots)[1])===null||u===void 0?void 0:u.call(y)),!this.disabled&&Y("div",{ref:"resizeTriggerElRef",class:`${this.mergedClsPrefix}-split__resize-trigger-wrapper`,style:this.resizeTriggerWrapperStyle,onMousedown:this.handleMouseDown},Ie(this.$slots["resize-trigger"],()=>[Y("div",{style:this.resizeTriggerStyle,class:[`${this.mergedClsPrefix}-split__resize-trigger`,this.isDragging&&`${this.mergedClsPrefix}-split__resize-trigger--hover`]})])),Y("div",{class:[`${this.mergedClsPrefix}-split-pane-2`,this.pane2Class],style:this.pane2Style},(_=(m=this.$slots)[2])===null||_===void 0?void 0:_.call(m)))}}),Tt=oe({name:"UserOperateDrawer",__name:"user-operate-drawer",props:ue({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ue(["submitted"],["update:visible"]),setup(n,{emit:y}){const u=n,m=y,_=we(n,"visible"),{formRef:x,validate:P,restoreValidation:C}=Se();Ve();const j=Z(()=>({add:d("page.audit.person.addPersonTitle"),edit:d("page.audit.person.editPersonTitle")})[u.operateType]),i=De(k());function k(){return{agid:void 0,uid:void 0,elevel:void 0,aetype:void 0,aedesc:""}}const I={agid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择审计组"},uid:{required:!0,trigger:["blur","change"],message:"请选择用户"},elevel:{type:"array",required:!0,trigger:["blur","change"],message:"请选择事件级别"},aetype:{type:"array",required:!0,trigger:["blur","change"],message:"审计事件类型"}};async function A(){var g,l;await R(),await r(),await O(),Object.assign(i,k()),u.operateType==="edit"&&u.rowData?(Object.assign(i,u.rowData),i.elevel=(g=i.elevel)==null?void 0:g.split(",").map(Number),i.aetype=(l=i.aetype)==null?void 0:l.split(",").map(Number)):(i.uid=void 0,i.agid=void 0,i.elevel=void 0,i.aetype=void 0)}function G(){_.value=!1}const{pageData:$,getData:R,nextPage:q}=ae(Ne),T=async g=>{const l=g.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&$.data.length<$.total&&q()},{pageData:b,getData:r,nextPage:p}=ae(ke),z=async g=>{const l=g.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&b.data.length<b.total&&p()},{pageData:w,getData:O,nextPage:E}=ae(Ue),S=async g=>{const l=g.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&w.data.length<w.total&&E()};async function V(){var g,l,N,U,D,f;if(await P(),u.operateType==="add"){const{data:M,error:K}=await it([{agid:i.agid,uid:i.uid,elevel:(g=i.elevel)==null?void 0:g.join(","),aetype:(l=i.aetype)==null?void 0:l.join(","),aedesc:i.aedesc}]);K||((N=window.$message)==null||N.success(d("common.addSuccess")),G(),m("submitted"))}else{const{data:M,error:K}=await lt([{id:u.rowData.id,agid:i.agid,uid:i.uid,elevel:(U=i.elevel)==null?void 0:U.join(","),aetype:(D=i.aetype)==null?void 0:D.join(","),aedesc:i.aedesc}]);K||((f=window.$message)==null||f.success(d("common.updateSuccess")),G(),m("submitted"))}}return He(_,()=>{_.value&&(A(),C())}),(g,l)=>{const N=Ke,U=xe,D=me,f=Te,M=B,K=Q,ie=Je,le=Xe;return W(),J(le,{show:_.value,"onUpdate:show":l[5]||(l[5]=e=>_.value=e),"display-directive":"show",width:360},{default:s(()=>[t(ie,{title:j.value,"native-scrollbar":!1,closable:""},{footer:s(()=>[t(K,{size:16},{default:s(()=>[t(M,{onClick:G},{default:s(()=>[F(ne(o(d)("common.cancel")),1)]),_:1}),t(M,{type:"primary",onClick:V},{default:s(()=>[F(ne(o(d)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[t(f,{ref_key:"formRef",ref:x,model:i,rules:I},{default:s(()=>[t(U,{label:o(d)("page.audit.person.agid"),path:"agid"},{default:s(()=>[(W(),J(N,{value:i.agid,"onUpdate:value":l[0]||(l[0]=e=>i.agid=e),placeholder:o(d)("page.audit.person.form.agid"),clearable:"",filterable:"","value-field":"id","label-field":"atname",options:o($).data,key:u.operateType,"reset-menu-on-options-change":!1,onScroll:T},null,8,["value","placeholder","options"]))]),_:1},8,["label"]),t(U,{label:o(d)("page.audit.person.uid"),path:"uid"},{default:s(()=>[(W(),J(N,{value:i.uid,"onUpdate:value":l[1]||(l[1]=e=>i.uid=e),placeholder:"请选择用户",clearable:"",filterable:"","value-field":"id",key:u.operateType,"label-field":"username",options:o(b).data,"reset-menu-on-options-change":!1,onScroll:z},null,8,["value","options"]))]),_:1},8,["label"]),t(U,{label:o(d)("page.audit.person.elevel"),path:"elevel"},{default:s(()=>[(W(),J(N,{clearable:"",filterable:"",multiple:"","max-tag-count":2,value:i.elevel,"onUpdate:value":l[2]||(l[2]=e=>i.elevel=e),key:u.operateType,placeholder:o(d)("page.audit.person.form.elevel"),options:o(We)(o(qe)),style:{width:"100%"}},null,8,["value","placeholder","options"]))]),_:1},8,["label"]),t(U,{label:o(d)("page.audit.person.aetype"),path:"aetype"},{default:s(()=>[(W(),J(N,{value:i.aetype,"onUpdate:value":l[3]||(l[3]=e=>i.aetype=e),placeholder:"请选择审计类型",clearable:"",filterable:"",multiple:"","max-tag-count":2,"value-field":"id","label-field":"atypename",options:o(w).data,key:u.operateType,"reset-menu-on-options-change":!1,onScroll:S},null,8,["value","options"]))]),_:1},8,["label"]),t(U,{label:o(d)("page.audit.person.describe"),path:"aedesc"},{default:s(()=>[t(D,{clearable:"",value:i.aedesc,"onUpdate:value":l[4]||(l[4]=e=>i.aedesc=e),placeholder:o(d)("page.audit.person.form.describe"),type:"textarea"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ct=oe({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ue(["reset","search"],["update:model"]),setup(n,{emit:y}){const u=y,{formRef:m,restoreValidation:_}=Se(),x=we(n,"model");function P(){x.value.fuzzy=void 0,u("search")}async function C(){await _(),u("reset")}async function j(){u("search")}return(i,k)=>{const I=me,A=vt,G=gt,$=B,R=ft,q=Q,T=ht,b=Te,r=Ce,p=ce("no-space");return W(),J(r,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[t(b,{ref_key:"formRef",ref:m,model:x.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ye(j,["enter"])},{default:s(()=>[t(T,{responsive:"screen","item-responsive":""},{default:s(()=>[t(A,{span:"24 s:12 m:6",label:"账户名",path:"fuzzy",class:"pr-24px"},{default:s(()=>[pe(t(I,{clearable:"",value:x.value.fuzzy,"onUpdate:value":k[0]||(k[0]=z=>x.value.fuzzy=z),placeholder:"请输入账户名",onClear:P},null,8,["value"]),[[p]])]),_:1}),t(A,{span:"24 m:12",class:"pr-24px"},{default:s(()=>[t(q,{class:"w-full"},{default:s(()=>[t($,{onClick:C},{icon:s(()=>[t(G,{class:"text-icon"})]),default:s(()=>[F(" "+ne(o(d)("common.reset")),1)]),_:1}),t($,{type:"primary",ghost:"",onClick:j},{icon:s(()=>[t(R,{class:"text-icon"})]),default:s(()=>[F(" "+ne(o(d)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),kt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Nt={class:"h-100% flex items-center flex-col justify-center"},Ut={class:"flex flex-col gap-8px"};function te(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!at(n)}const $t=oe({name:"audit_person",__name:"index",setup(n){const y=Ze(),u=X(""),m=De({treeData:[],userData:[],treeSelecteedKeys:[],treeOptionVisible:!1,treeOptionTitle:""}),{columns:_,columnChecks:x,data:P,getData:C,loading:j,mobilePagination:i,searchParams:k,resetSearchParams:I}=pt({apiFn:st,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,status:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"agid",title:d("page.audit.person.agid"),align:"center",minWidth:160,ellipsis:{tooltip:!0},render:e=>{var a;return t("span",null,[(a=m.treeData.find(c=>c.id===e.agid))==null?void 0:a.atname])}},{key:"uid",title:d("page.audit.person.uid"),align:"center",minWidth:160,render:e=>{var a;return t("span",null,[((a=m.userData.find(c=>c.id===e.uid))==null?void 0:a.username)||e.uid])}},{key:"elevel",title:d("page.audit.person.elevel"),align:"center",minWidth:160,render:e=>{let a;const c=e.elevel.split(",").map(Number),v={0:"default",1:"success",2:"info",3:"warning",4:"error"};return t(Q,{justify:"center"},te(a=c.map(H=>{const L=d(_t[H]);return t(Qe,{type:v[H]},te(L)?L:{default:()=>[L]})}))?a:{default:()=>[a]})}},{key:"aetype",title:d("page.audit.person.aetype"),align:"center",minWidth:160,render:e=>{const a=e.aetype.split(",").map(Number);return t("span",null,[a.map((c,v)=>{var L;const H=(L=g.data.find(se=>se.id===c))==null?void 0:L.atypename;return H?`${H}${v!==a.length-1?"，":""}`:""})])}},{key:"aedesc",title:d("page.audit.person.describe"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"operate",title:d("common.operate"),align:"center",width:130,render:e=>{let a;return t("div",{class:"flex-center gap-8px"},[pe(t(B,{type:"primary",ghost:!0,size:"small",onClick:()=>O(e.id)},te(a=d("common.edit"))?a:{default:()=>[a]}),[[ce("no-auth"),"audit.person.edit"]]),t(be,{onPositiveClick:()=>w(e.id)},{default:()=>d("common.confirmDelete"),trigger:()=>{let c;return pe(t(B,{type:"error",ghost:!0,size:"small"},te(c=d("common.delete"))?c:{default:()=>[c]}),[[ce("no-auth"),"audit.person.del"]])}})])}}]}),{drawerVisible:A,operateType:G,editingData:$,handleAdd:R,handleEdit:q,checkedRowKeys:T,onBatchDeleted:b,onDeleted:r,closeDrawer:p}=mt(P,C);async function z(){console.log(T.value),E(T.value,e=>{b()})}function w(e){console.log(e),E([e],a=>{r()})}function O(e){q(e)}async function E(e,a){const{data:c,error:v}=await rt(e);if(!v)a&&a(c);else return!1}async function S(){const{data:e,error:a}=await Ne({page:1,limit:1e3});a||(m.treeData=e.list||[],m.treeData.forEach(c=>{c.auditUserPojos.forEach(v=>{v.atname=v.uid})}))}const V=async()=>{const{data:e,error:a}=await ke({page:1,limit:1e3});a||(m.userData=JSON.parse(JSON.stringify(e)).list||[])},{pageData:g,getData:l,nextPage:N}=ae(Ue);V(),l(),S();const U=({option:e})=>(console.log(e,"option"),e!=null&&e.hasOwnProperty("auditUserPojos")?t(Q,{itemClass:"operate"},{default:()=>[t(B,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>{ie(e)}},{default:()=>[F("编辑")]}),t(be,{onPositiveClick:()=>le(e.id)},{default:()=>d("common.confirmDelete"),trigger:()=>t(B,{text:!0,type:"error",ghost:!0,size:"small",onClick:()=>{}},{default:()=>[F("删除")]})})]}):""),D=X(!1),f=X(""),M=X(),K=async()=>{var c,v;if(M.value){const{data:H,error:L}=await dt([{atname:f.value,id:M.value}]);L||(S(),D.value=!1,(c=window.$message)==null||c.success("修改成功"));return}const{data:e,error:a}=await ut([{atname:f.value}]);a||(S(),D.value=!1,(v=window.$message)==null||v.success("添加成功"))},ie=e=>{f.value=e.atname,M.value=e.id,D.value=!0},le=async e=>{var v;const{data:a,error:c}=await ct([e]);c||(S(),(v=window.$message)==null||v.success("删除成功"))};return(e,a)=>{const c=Re,v=yt,H=bt,L=xt,se=Ce,$e=me,Pe=xe,Ae=nt;return W(),et("div",kt,[t(Ct,{model:o(k),"onUpdate:model":a[0]||(a[0]=h=>ee(k)?k.value=h:null),onReset:o(I),onSearch:o(C)},null,8,["model","onReset","onSearch"]),t(se,{title:o(d)("page.audit.person.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[t(c,{columns:o(x),"onUpdate:columns":a[1]||(a[1]=h=>ee(x)?x.value=h:null),"disabled-delete":o(T).length===0,loading:o(j),onAdd:o(R),onDelete:z,onRefresh:o(C),"is-view-delete-button":o(ye)("audit.person.del"),"is-view-add-button":o(ye)("audit.person.add")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-delete-button","is-view-add-button"])]),default:s(()=>[t(L,{direction:"horizontal",class:"sm:h-full","default-size":.1,max:.15,min:.1,"resize-trigger-size":6},{1:s(()=>[_e("div",Nt,[m.treeData.length>0?(W(),J(v,{key:0,ref:"treeInstRef","show-irrelevant-nodes":!1,pattern:u.value,"block-line":"",data:m.treeData,"label-field":"atname","key-field":"id","children-field":"auditUserPojos1","virtual-scroll":"",class:"sm:h-full","render-suffix":U},null,8,["pattern","data"])):tt("",!0),t(o(B),{class:"w-90%",type:"info",ghost:"",onClick:a[2]||(a[2]=h=>D.value=!0)},{default:s(()=>[F("添加")]),_:1})])]),2:s(()=>[t(H,{"checked-row-keys":o(T),"onUpdate:checkedRowKeys":a[3]||(a[3]=h=>ee(T)?T.value=h:null),columns:o(_),data:o(P),size:"small","flex-height":!o(y).isMobile,"scroll-x":962,loading:o(j),remote:"","row-key":h=>h.id,pagination:o(i),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1}),t(Tt,{visible:o(A),"onUpdate:visible":a[4]||(a[4]=h=>ee(A)?A.value=h:null),"operate-type":o(G),"row-data":o($),onSubmitted:o(C)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"]),t(Ae,{show:D.value,"onUpdate:show":a[7]||(a[7]=h=>D.value=h),title:M.value?"编辑审计组":"添加审计组",preset:"card",class:"w-400px",onAfterLeave:a[8]||(a[8]=h=>M.value=null)},{default:s(()=>[_e("div",Ut,[t(Pe,{label:"审核组名称","label-placement":"left",rule:{required:!0,trigger:"blur",validator(){if(!f.value)return new Error("请输入审核组名称")}}},{default:s(()=>[t($e,{value:f.value,"onUpdate:value":a[5]||(a[5]=h=>f.value=h),placeholder:"请输入",clearable:""},null,8,["value"])]),_:1},8,["rule"])])]),footer:s(()=>[t(o(Q),{justify:"end"},{default:s(()=>[t(o(B),{onClick:a[6]||(a[6]=h=>D.value=!1)},{default:s(()=>[F("取消")]),_:1}),t(o(B),{type:"primary",onClick:K},{default:s(()=>[F("确定")]),_:1})]),_:1})]),_:1},8,["show","title"])])}}}),ea=ot($t,[["__scopeId","data-v-2a3cdb2b"]]);export{ea as default};
