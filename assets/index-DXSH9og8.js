import{_ as W}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C4VRQsxL.js";import{d as E,q as M,j as G,s as H,v as X,x as Z,b as J,r as Q,y as Y,o as F,c as ee,w as l,g as t,h as $,t as j,i as a,$ as _,e as K,ai as te,N as oe,X as ae,C as ne,A as le,aj as ie,D as se,B as I,E as re,aa as de,ab as pe,Z as ue,L as O,K as A,ac as B,ad as ce,a9 as me}from"./index-CsSYpLym.js";import{z as fe,A as _e,a as ye,B as ve}from"./events-jF9iLWL-.js";import{u as ge,a as we}from"./table-DCxpav6d.js";import{h as V}from"./permission-CTF5Ee2q.js";import{_ as be}from"./Popconfirm-DEvmG-Lq.js";import{_ as he}from"./DataTable-aZh4mZz2.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DA9Hc1O-.js";import"./setting-outlined-D6k74DJG.js";import"./round-delete-CGs2xQbQ.js";import"./refresh-C8V4ZZfl.js";import"./round-plus-BCWcqFXE.js";import"./Upload-Dto-1aHs.js";import"./Progress-6NqKhq42.js";import"./Forward-C9tKHKQU.js";const De=E({name:"OperateDrawer",__name:"operate-drawer",props:M({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:M(["submitted"],["update:visible"]),setup(y,{emit:S}){const c=y,v=G([{label:"syslog",value:0},{label:"SNMP Trap",value:1}]),g=S,p=H(y,"visible"),{formRef:N,validate:P,restoreValidation:z}=X(),{defaultRequiredRule:L,formRules:w}=Z(),C=J(()=>({add:"新增转发策略",edit:"编辑转发策略"})[c.operateType]),e=Q(x());function x(){return{ftype:1,community:"",etpnode:"",oidnode:"",ipaddr:"",fport:void 0,fdesc:""}}const T={ipaddr:w.ip,fport:{type:"number",required:!0,trigger:["blur","change"],message:"请输入端口号"}};function m(){Object.assign(e,x()),c.operateType==="edit"&&c.rowData&&Object.assign(e,c.rowData)}function b(){p.value=!1}async function U(){var h,o;if(await P(),c.operateType==="add"){const{data:D,error:r}=await fe([{ftype:e.ftype,community:e.community,etpnode:e.etpnode,oidnode:e.oidnode,ipaddr:e.ipaddr,fport:e.fport,fdesc:e.fdesc}]);r||((h=window.$message)==null||h.success(_("common.addSuccess")),b(),g("submitted"))}else{const{data:D,error:r}=await _e([{id:c.rowData.id,ftype:e.ftype,community:e.community,etpnode:e.etpnode,oidnode:e.oidnode,ipaddr:e.ipaddr,fport:e.fport,fdesc:e.fdesc}]);r||((o=window.$message)==null||o.success(_("common.updateSuccess")),b(),g("submitted"))}}return Y(p,()=>{p.value&&(m(),z())}),(h,o)=>{const D=ae,r=ne,f=le,i=ie,n=se,d=I,k=re,R=de,u=pe;return F(),ee(u,{show:p.value,"onUpdate:show":o[7]||(o[7]=s=>p.value=s),"display-directive":"show",width:360},{default:l(()=>[t(R,{title:C.value,"native-scrollbar":!1,closable:""},{footer:l(()=>[t(k,{size:16},{default:l(()=>[t(d,{onClick:b},{default:l(()=>[$(j(a(_)("common.cancel")),1)]),_:1}),t(d,{type:"primary",onClick:U},{default:l(()=>[$(j(a(_)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[t(n,{ref_key:"formRef",ref:N,model:e,rules:T},{default:l(()=>[t(r,{label:"转发方式",path:"ftype"},{default:l(()=>[t(D,{filterable:"",value:e.ftype,"onUpdate:value":o[0]||(o[0]=s=>e.ftype=s),placeholder:"请选择转发方式",options:v.value,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e.ftype==1?(F(),K(te,{key:0},[t(r,{label:"Community",path:"community"},{default:l(()=>[t(f,{value:e.community,"onUpdate:value":o[1]||(o[1]=s=>e.community=s),placeholder:"请输入community",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"企业节点号",path:"etpnode"},{default:l(()=>[t(f,{value:e.etpnode,"onUpdate:value":o[2]||(o[2]=s=>e.etpnode=s),placeholder:"请输入企业节点号",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"oid节点号",path:"oidnode"},{default:l(()=>[t(f,{value:e.oidnode,"onUpdate:value":o[3]||(o[3]=s=>e.oidnode=s),placeholder:"请输入oid节点号",clearable:""},null,8,["value"])]),_:1})],64)):oe("",!0),t(r,{label:"其它服务器IP",path:"ipaddr"},{default:l(()=>[t(f,{value:e.ipaddr,"onUpdate:value":o[4]||(o[4]=s=>e.ipaddr=s),placeholder:"请输入其它服务器IP",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"端口号",path:"fport"},{default:l(()=>[t(i,{min:0,max:65535,value:e.fport,"onUpdate:value":o[5]||(o[5]=s=>e.fport=s),placeholder:"请输入端口号",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{label:"描述",path:"fdesc"},{default:l(()=>[t(f,{type:"textarea",value:e.fdesc,"onUpdate:value":o[6]||(o[6]=s=>e.fdesc=s),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function q(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!ce(y)}const Oe=E({name:"manage_forwardserver",__name:"index",setup(y){const S=ue(),{columns:c,columnChecks:v,data:g,getData:p,loading:N,mobilePagination:P,searchParams:z,resetSearchParams:L}=ge({apiFn:ye,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"ftype",title:"转发方式",align:"center",width:160,render:i=>i.ftype==0?"syslog":"SNMP Trap"},{key:"community",title:"Community",align:"center",width:160},{key:"etpnode",title:"企业节点号",align:"center",minWidth:180},{key:"oidnode",title:"oid节点号",align:"center",minWidth:220},{key:"ipaddr",title:"其它服务器IP",align:"center",width:200},{key:"fport",title:"端口号",align:"center",width:140},{key:"fdesc",title:"用户描述",align:"center",minWidth:180,ellipsis:{tooltip:!0}},{key:"operate",title:_("common.operate"),align:"center",render:i=>{let n;return t("div",{class:"flex-center gap-8px"},[O(t(I,{type:"primary",ghost:!0,size:"small",onClick:()=>r(i.id)},q(n=_("common.edit"))?n:{default:()=>[n]}),[[A("no-auth"),"sys.forward.policy.update"]]),t(be,{onPositiveClick:()=>D(i.id)},{default:()=>_("common.confirmDelete"),trigger:()=>{let d;return O(t(I,{type:"error",ghost:!0,size:"small"},q(d=_("common.delete"))?d:{default:()=>[d]}),[[A("no-auth"),"sys.forward.policy.delete"]])}})])}}]}),{drawerVisible:w,operateType:C,editingData:e,handleAdd:x,handleEdit:T,checkedRowKeys:m,onBatchDeleted:b,onDeleted:U,closeDrawer:h}=we(g,p);async function o(){console.log(m.value),f(m.value,i=>{b()})}function D(i){console.log(i),f([i],n=>{U()})}function r(i){T(i)}async function f(i,n){const{data:d,error:k}=await ve(i);if(!k)n&&n(d);else return!1}return(i,n)=>{const d=W,k=he,R=me;return F(),K("div",ke,[t(R,{title:"转发策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[t(d,{columns:a(v),"onUpdate:columns":n[0]||(n[0]=u=>B(v)?v.value=u:null),"disabled-delete":a(m).length===0,loading:a(N),onAdd:a(x),onDelete:o,onRefresh:a(p),"is-view-add-button":a(V)("sys.forward.policy.insert"),"is-view-delete-button":a(V)("sys.forward.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:l(()=>[t(k,{"checked-row-keys":a(m),"onUpdate:checkedRowKeys":n[1]||(n[1]=u=>B(m)?m.value=u:null),columns:a(c),data:a(g),size:"small","flex-height":!a(S).isMobile,"scroll-x":962,loading:a(N),remote:"","row-key":u=>u.id,pagination:a(P),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(De,{visible:a(w),"onUpdate:visible":n[2]||(n[2]=u=>B(w)?w.value=u:null),"operate-type":a(C),"row-data":a(e),onSubmitted:a(p)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Oe as default};
