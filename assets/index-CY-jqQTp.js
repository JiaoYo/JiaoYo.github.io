import{d as j,q as F,v as q,s as Q,o as J,c as X,w as l,g as t,h as o,t as m,i as h,$ as M,M as Z,au as ee,am as H,an as le,W as te,A as ae,B as T,E as K,D as ne,a8 as W,Y as oe,j as D,r as A,bu as z,e as se,S as ie,F as de,av as re,aw as ue,f as pe,ax as ce}from"./index-Cu8e7n-j.js";import{l as me}from"./lodash-Cjsf6VoW.js";import{_ as fe}from"./round-search-DCwGKqmp.js";import{_ as _e}from"./round-refresh-DVENiE1-.js";import{_ as ge}from"./Cascader-B3eBFwho.js";import{_ as ve}from"./FormItemGridItem-BH8iEJpM.js";import{_ as he}from"./DatePicker-DM5RegJu.js";import{_ as ye}from"./Grid-B0WHzPHc.js";import{w as be,x as Ie}from"./events-Bd7RZR0R.js";import{b as xe}from"./common-CpC_KlxH.js";import{e as Le}from"./exportExcel-CZ2AjtLT.js";import{_ as Se}from"./DataTable-BHuQVdtu.js";import{_ as Ce,a as Ee}from"./DescriptionsItem-ChZ7RtOt.js";import"./TimePicker--3zyzJR1.js";import"./defineProperty-Bttct8Qw.js";import"./Forward-DKoTpHF6.js";const De={0:"KERN",1:"USER",2:"MAIL",3:"DAEMON",4:"AUTH",5:"SYSYLOG",6:"LPR",7:"NEWS",8:"UUCP",9:"CRON",10:"AUTHPRIV",11:"FTP",12:"RESERVED_12",13:"RESERVED_13",14:"RESERVED_14",15:"RESERVED_15",16:"LOCAL0",17:"LOCAL1",18:"LOCAL2",19:"LOCAL3",20:"LOCAL4",21:"LOCAL5",22:"LOCAL6",23:"LOCAL7"},Ne={0:"EMERGENCY",1:"ALERT",2:"CRITICAL",3:"ERROR",4:"WARNING",5:"NOTICE",6:"INFO",7:"DEBUG"},B={logModel:De,logLevel:Ne},ke=j({name:"FormSearch",__name:"form-search",props:F(["LogSourceDeviceList"],{model:{required:!0},modelModifiers:{}}),emits:F(["search"],["update:model"]),setup(x,{emit:O}){const S=f=>Object.entries(f).map(([r,g])=>({label:g,value:r})),P={logLevel:S(B.logLevel),logModel:S(B.logModel)},C=x,y=O,{formRef:n,restoreValidation:c}=q(),a=Q(x,"model");async function E(f,r){f&&f.length>0?(a.value.startTime=f[0],a.value.endTime=f[1]):(a.value.startTime=void 0,a.value.endTime=void 0)}async function d(){await c(),a.value.lsid=null,a.value.leid=null,a.value.lmid=null,a.value.timeRange=null,a.value.startAndEndIp=null,ee(()=>{y("search")})}async function b(){var f,r,g,_;if(a.value.startAndEndIp&&a.value.startAndEndIp.length>0?(a.value.startIp=a.value.startAndEndIp[0]||null,a.value.endIp=a.value.startAndEndIp[1]||null):(a.value.startIp=void 0,a.value.endIp=void 0),a.value.startIp&&!H(a.value.startIp)||a.value.endIp&&!H(a.value.endIp))return(f=window.$message)==null||f.destroyAll(),(r=window.$message)==null||r.error("请输入正确的IP地址"),!1;if(a.value.startIp&&a.value.endIp&&le(a.value.startIp,a.value.endIp)>0)return(g=window.$message)==null||g.destroyAll(),(_=window.$message)==null||_.error("起始IP不能大于终止IP"),!1;y("search")}return(f,r)=>{const g=ge,_=ve,k=te,$=he,U=ae,I=_e,N=T,V=fe,e=K,i=ye,u=ne,L=W;return J(),X(L,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[t(u,{ref_key:"formRef",ref:n,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Z(b,["enter"])},{default:l(()=>[t(i,{responsive:"screen","item-responsive":""},{default:l(()=>[t(_,{span:"24 s:24 m:8",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:l(()=>[t(g,{value:a.value.lsid,"onUpdate:value":[r[0]||(r[0]=s=>a.value.lsid=s),b],placeholder:"请选择日志源设备",options:C.LogSourceDeviceList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),t(_,{span:"24 s:24 m:8",label:"级别",path:"leid",class:"pr-24px"},{default:l(()=>[t(k,{filterable:"",clearable:"",placeholder:"请选择级别",value:a.value.leid,"onUpdate:value":[r[1]||(r[1]=s=>a.value.leid=s),b],options:P.logLevel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(_,{span:"24 s:24 m:8",label:"日志模块",path:"lmid",class:"pr-24px"},{default:l(()=>[t(k,{filterable:"",clearable:"",placeholder:"请选择日志模块",value:a.value.lmid,"onUpdate:value":[r[2]||(r[2]=s=>a.value.lmid=s),b],options:P.logModel,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(_,{span:"24 s:24 m:8",label:"时间",path:"time",class:"pr-24px mt-10px"},{default:l(()=>[t($,{value:a.value.timeRange,"onUpdate:value":r[3]||(r[3]=s=>a.value.timeRange=s),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":E},null,8,["value"])]),_:1}),t(_,{span:"24 s:24 m:8",label:"IP",path:"startAndEndIp",class:"pr-24px mt-10px"},{default:l(()=>[t(U,{pair:"",separator:"-",placeholder:["发生源起始IP","发生源终止IP"],clearable:"",value:a.value.startAndEndIp,"onUpdate:value":r[4]||(r[4]=s=>a.value.startAndEndIp=s)},null,8,["value"])]),_:1}),t(_,{span:"24 m:8",class:"pr-24px mt-10px",label:" "},{default:l(()=>[t(e,{class:"w-full"},{default:l(()=>[t(N,{onClick:d},{icon:l(()=>[t(I,{class:"text-icon"})]),default:l(()=>[o(" "+m(h(M)("common.reset")),1)]),_:1}),t(N,{type:"primary",ghost:"",onClick:b},{icon:l(()=>[t(V,{class:"text-icon"})]),default:l(()=>[o(" "+m(h(M)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),we=x=>(re("data-v-c82c95d8"),x=x(),ue(),x),Re={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ae=we(()=>pe("hr",{style:{"border-color":"#ccc","margin-bottom":"20px"}},null,-1)),Te=j({name:"eventalarm_generallog",__name:"index",setup(x){const O=oe(),S=D([]);(async()=>{const{data:e,error:i}=await xe();i||(S.value=e.map(u=>({...u,id:"-"+u.id,type:u.cname})))})();const C=D(!1),y=B,n=A({lsid:void 0,lsdn:"",rdbtime:"",lmid:void 0,leid:void 0,ltext:"",aname:"",procid:"",msgid:"",dbtime:"",hname:"",lcon:"",ip:"",lsip:"",priority:"",type:"",version:"",logtype:void 0}),c=A({pageId:void 0,pageSize:100,lsid:void 0,leid:void 0,lmid:void 0,startTime:void 0,endTime:void 0,startIp:void 0,endIp:void 0,_t:new Date().getTime()}),a=A([{title:"",key:"key",width:80,align:"center",render:(e,i)=>`${i+1}`},{key:"type",title:"设备类型",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"hname",title:"主机名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"rdbtime",title:"接收时间",align:"center",width:160,render:e=>z(e.rdbtime)},{key:"lmid",title:"模块",align:"center",width:160,ellipsis:{tooltip:!0},render:e=>((!e.lmid===void 0||e.lmid===null)&&(e.lmid=0),y.logModel[e.lmid])},{key:"leid",title:"级别",align:"center",width:120,ellipsis:{tooltip:!0},render:e=>((e.leid===void 0||e.leid===null)&&(e.leid=0),y.logLevel[e.leid])},{key:"ipaddr",title:"发生源IP",align:"center",width:180},{key:"ltext",title:"日志原文",align:"center",width:320,ellipsis:{tooltip:!0}},{key:"operate",title:M("common.operate"),align:"center",width:120,fixed:"right",render:e=>t("div",{class:"flex-center gap-8px"},[t(T,{type:"info",ghost:!0,size:"small",onClick:()=>f(e)},{default:()=>[o("详情")]})])}]),E=D(!1),d=D([]),b=async(e=!1)=>{if(!E.value)E.value=!0;else return;const{data:i,error:u}=await be(c);u||(e?d.value=[...d.value,...i]:d.value=i,E.value=!1)};b();function f(e){n.lsid=e.lsid,n.lsdn=e.lsdn,n.rdbtime=e.rdbtime,n.lmid=e.lmid,n.leid=e.leid,n.ltext=e.ltext,n.aname=e.aname,n.procid=e.procid,n.msgid=e.msgid,n.dbtime=e.dbtime,n.hname=e.hname,n.lcon=e.lcon,n.ip=e.ip,n.lsip=e.lsip,n.priority=e.priority,n.type=e.type,n.version=e.version,n.logtype=e.logtype,C.value=!0}const r=D(null),g=D(!0),_=()=>{d.value=[],c.lsid||c.leid||c.lmid||c.startIp||c.endIp||c.startTime||c.endTime?g.value=!1:(g.value=!0,N()),c.pageId=void 0,b()};function k(e){e.target.scrollTop+e.target.offsetHeight==e.target.scrollHeight&&I.total>d.value.length&&$()}const $=me.debounce(()=>{if(d.value.length<I.total){if(c.pageId==d.value[d.value.length-1].id)return;c.pageId=d.value[d.value.length-1].id,b(!0)}},300);function U(e){return e.index}const I=A({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:i,page:u,pageSize:L,pageCount:s,itemCount:p}){return`已加载${d.value.length}条`+(d.value.length?g.value?` 共计 ${d.value.length>0?p??0:0} 条`:d.value.length>=c.limit?"  预计还有更多":"":"")}});async function N(){const{data:e,error:i}=await Ie({_t:new Date().getTime()});i||(I.pageCount=20,I.total=Number(e),I.itemCount=Number(e))}N();async function V(){if(!d.value.length)return;const e=JSON.parse(JSON.stringify(d.value)),i=[];e.forEach(u=>{const L={};a.forEach(s=>{var p,w,R;if(u.hasOwnProperty(s.key)){const G=s.key==="lmid"?((p=y.logModel)==null?void 0:p[u[s.key]])??null:s.key==="leid"?((w=y.logLevel)==null?void 0:w[u[s.key]])??null:s.key==="lsid"?(R=S.value.map(v=>v.data).flat(2).find(v=>v.id==u[s.key]))==null?void 0:R.type:u[s.key];L[s.title]=G}}),i.push(L)}),Le(i,500,"general-log"+new Date().getTime())}return(e,i)=>{const u=K,L=Se,s=W,p=Ce,w=Ee,R=ie,G=de;return J(),se("div",Re,[t(ke,{model:c,"onUpdate:model":i[0]||(i[0]=v=>c=v),onSearch:_,LogSourceDeviceList:S.value},null,8,["model","LogSourceDeviceList"]),t(s,{title:"通用日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[t(u,null,{default:l(()=>[t(h(T),{type:"primary",size:"small",ghost:"",onClick:V,title:"导出已加载"},{default:l(()=>[o("导出已加载")]),_:1})]),_:1})]),default:l(()=>[t(L,{ref_key:"tableContainerRef",ref:r,columns:a,data:d.value,size:"small","flex-height":!h(O).isMobile,"scroll-x":a.reduce((v,Y)=>v+Y.width,0),loading:E.value,remote:"","row-key":U,showTotal:"",pagination:I,class:"sm:h-full",onScroll:k},null,8,["columns","data","flex-height","scroll-x","loading","pagination"])]),_:1}),t(G,{show:C.value,"onUpdate:show":i[2]||(i[2]=v=>C.value=v),title:"日志详情",preset:"card",class:"w-800px"},{footer:l(()=>[t(u,{justify:"end",size:16},{default:l(()=>[t(h(T),{type:"primary",onClick:i[1]||(i[1]=v=>{C.value=!1})},{default:l(()=>[o(m(h(M)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[Ae,t(R,{class:"h-480px pr-20px"},{default:l(()=>[t(w,{"label-placement":"left","label-style":{width:"120px"},bordered:"",column:1},{default:l(()=>[t(p,null,{label:l(()=>[o(" 设备类型 ")]),default:l(()=>[o(" "+m(n.type),1)]),_:1}),t(p,null,{label:l(()=>[o(" 接收时间 ")]),default:l(()=>[o(" "+m(h(z)(n.rdbtime)),1)]),_:1}),t(p,null,{label:l(()=>[o(" 模块 ")]),default:l(()=>[o(" "+m(h(y).logModel[n.lmid]),1)]),_:1}),t(p,null,{label:l(()=>[o(" 级别 ")]),default:l(()=>[o(" "+m(h(y).logLevel[n.leid]),1)]),_:1}),t(p,null,{label:l(()=>[o(" 应用名称 ")]),default:l(()=>[o(" "+m(n.aname),1)]),_:1}),t(p,null,{label:l(()=>[o(" PROCID ")]),default:l(()=>[o(" "+m(n.procid),1)]),_:1}),t(p,null,{label:l(()=>[o(" MSGID ")]),default:l(()=>[o(" "+m(n.msgid||"--"),1)]),_:1}),t(p,null,{label:l(()=>[o(" 日志时间 ")]),default:l(()=>[o(" "+m(h(z)(n.dbtime)),1)]),_:1}),t(p,null,{label:l(()=>[o(" 主机名称 ")]),default:l(()=>[o(" "+m(n.hname),1)]),_:1}),t(p,null,{label:l(()=>[o(" 结构数据 ")]),default:l(()=>[o(" -- ")]),_:1}),t(p,null,{label:l(()=>[o(" 日志内容 ")]),default:l(()=>[o(" "+m(n.lcon),1)]),_:1}),t(p,{span:2},{label:l(()=>[o(" 日志原文 ")]),default:l(()=>[o(" "+m(n.logtype?n.ltext:n.ltext+n.lcon),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),qe=ce(Te,[["__scopeId","data-v-c82c95d8"]]);export{qe as default};
