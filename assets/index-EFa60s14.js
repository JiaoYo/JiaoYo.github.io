import{l as X}from"./lodash-CYudMFH4.js";import{d as W,q,j as m,v as Y,s as ee,o as K,c as ae,w as i,g as l,i as I,$ as b,Z as te,h as U,t as F,M as le,aA as ne,ar as D,as as H,a2 as oe,A as re,B,E as Z,D as ie,ad as Q,a4 as se,r as j,aq as ue,J as de,e as pe,ah as ce,aU as ve,V as me}from"./index-7Q9xZuwa.js";import{_ as ge}from"./round-search-BQOA9W6m.js";import{_ as fe}from"./round-refresh-DJiiF7wv.js";import{u as he}from"./usePageData-PYHx9xl8.js";import{a as Ie,T as J}from"./basicconf-C0vqpl2m.js";import{f as _e}from"./system-manage--O3CHZ2D.js";import{_ as ye}from"./DatePicker-CNtih3Cp.js";import{_ as we}from"./Cascader-B05gdiL9.js";import{_ as Se}from"./FormItemGridItem-DYTXkfwP.js";import{_ as Ae}from"./Grid-CRtcNhSF.js";import{_ as xe}from"./originlogInfo.vue_vue_type_script_setup_true_lang-DxNl3a_S.js";import{e as be}from"./exportExcel-D6OyA9oJ.js";import{z as Oe,t as Ee}from"./events-C20QxbUR.js";import{b as De,f as Le,a as ke}from"./common-DPaMBBEl.js";import{_ as Ce}from"./DataTable-n3fP4Loy.js";import"./TimePicker-BYx0IEL9.js";import"./defineProperty-B4q_dn_D.js";import"./Forward-BzUEeUAa.js";import"./DescriptionsItem-DfMvCpt5.js";import"./CollapseItem-C4YR5A1V.js";const Te=W({name:"FormSearch",__name:"form-search",props:q(["eventsTypeDataList","LogSourceDeviceList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:q(["search"],["update:model"]),setup(_,{emit:V}){const S=_,g=V;m(0);const{formRef:T,restoreValidation:R}=Y(),e=ee(_,"model"),{pageData:L,getData:M,nextPage:z}=he(_e),k=async p=>{const o=p.currentTarget;o.scrollTop+o.offsetHeight>=o.scrollHeight&&L.data.length<L.total&&z()};M();async function P(){await R(),e.value.etypeid=null,e.value.elevel=null,e.value.rtime=null,e.value.user=null,e.value.logodid=null,e.value.target=null,e.value.startAndEndOriginIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.expression=null,e.value.startOriginIp=null,e.value.endOriginIp=null,e.value.startAimOriginIp=null,e.value.endAimOriginIp=null,e.value.startSourceIp=null,e.value.endSourceIp=null,ne(()=>{g("search")})}const $=p=>{e.value.elevel=p,c()},A=(p,o)=>{e.value.rtime=o,c()},d=p=>{e.value.logodid=p,c()},C=()=>{e.value.startAndEndOriginIp=null,c()},r=()=>{e.value.startAndEndSourceIp=null,c()},N=()=>{e.value.startAndEndAimSourceIp=null,c()};async function c(){var p,o,y,s,w,O,h,E,x,a,t,u;if(e.value.startAndEndOriginIp&&e.value.startAndEndOriginIp.length>0?(e.value.startOriginIp=e.value.startAndEndOriginIp[0]||null,e.value.endOriginIp=e.value.startAndEndOriginIp[1]||null):(e.value.startOriginIp=null,e.value.endOriginIp=null),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimOriginIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimOriginIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimOriginIp=null,e.value.endAimOriginIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=null,e.value.endSourceIp=null),e.value.startOriginIp&&!D(e.value.startOriginIp)||e.value.endOriginIp&&!D(e.value.endOriginIp))return(p=window.$message)==null||p.destroyAll(),(o=window.$message)==null||o.error("请输入正确的IP地址"),!1;if(e.value.startOriginIp&&e.value.endOriginIp&&H(e.value.startOriginIp,e.value.endOriginIp)>0)return(y=window.$message)==null||y.destroyAll(),(s=window.$message)==null||s.error("起始IP不能大于终止IP"),!1;if(e.value.startAimOriginIp&&!D(e.value.startAimOriginIp)||e.value.endAimOriginIp&&!D(e.value.endAimOriginIp))return(w=window.$message)==null||w.destroyAll(),(O=window.$message)==null||O.error("请输入正确的IP地址"),!1;if(e.value.startAimOriginIp&&e.value.endAimOriginIp&&H(e.value.startAimOriginIp,e.value.endAimOriginIp)>0)return(h=window.$message)==null||h.destroyAll(),(E=window.$message)==null||E.error("起始IP不能大于终止IP"),!1;if(e.value.startSourceIp&&!D(e.value.startSourceIp)||e.value.endSourceIp&&!D(e.value.endSourceIp))return(x=window.$message)==null||x.destroyAll(),(a=window.$message)==null||a.error("请输入正确的IP地址"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&H(e.value.startSourceIp,e.value.endSourceIp)>0)return(t=window.$message)==null||t.destroyAll(),(u=window.$message)==null||u.error("起始IP不能大于终止IP"),!1;g("search")}return(p,o)=>{const y=we,s=Se,w=oe,O=ye,h=re,E=fe,x=B,a=ge,t=Z,u=Ae,f=ie,v=Q;return K(),ae(v,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[l(f,{ref_key:"formRef",ref:T,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:le(c,["enter"])},{default:i(()=>[l(u,{responsive:"screen","item-responsive":""},{default:i(()=>[l(s,{span:"24 s:24 m:6",label:"事件类型",path:"etypeid",class:"pr-24px"},{default:i(()=>[l(y,{value:e.value.etypeid,"onUpdate:value":[o[0]||(o[0]=n=>e.value.etypeid=n),d],clearable:"",placeholder:"请选择事件","max-tag-count":1,options:S.eventsTypeDataList,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),l(s,{span:"24 s:24 m:6",label:I(b)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:i(()=>[l(w,{filterable:"",clearable:"",placeholder:I(b)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[o[1]||(o[1]=n=>e.value.elevel=n),$],"reset-menu-on-options-change":!1,options:I(te)(I(Ie))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),l(s,{span:"24 s:24 m:6",label:"接收时间",path:"rtime",class:"pr-24px"},{default:i(()=>[l(O,{placeholder:"请选择接收时间","formatted-value":e.value.rtime,"onUpdate:formattedValue":o[2]||(o[2]=n=>e.value.rtime=n),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:"",style:{width:"100%"},"onUpdate:value":A},null,8,["formatted-value"])]),_:1}),l(s,{span:"24 s:24 m:6",label:"用户",path:"user",class:"pr-24px"},{default:i(()=>[l(w,{value:e.value.user,"onUpdate:value":o[3]||(o[3]=n=>e.value.user=n),placeholder:"请选择用户",clearable:"",filterable:"","value-field":"id","label-field":"username",options:I(L).data,"reset-menu-on-options-change":!1,onScroll:k},null,8,["value","options"])]),_:1}),l(s,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndOriginIp",class:"pr-24px mt-10px"},{default:i(()=>[l(h,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndOriginIp,"onUpdate:value":o[4]||(o[4]=n=>e.value.startAndEndOriginIp=n),onClear:C},null,8,["value"])]),_:1}),l(s,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px mt-10px"},{default:i(()=>[l(h,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":o[5]||(o[5]=n=>e.value.startAndEndAimSourceIp=n),onClear:N},null,8,["value"])]),_:1}),l(s,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSourceIp",class:"pr-24px mt-10px"},{default:i(()=>[l(h,{pair:"",separator:"-",disabled:S.logsoudev,placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":o[6]||(o[6]=n=>e.value.startAndEndSourceIp=n),onClear:r},null,8,["disabled","value"])]),_:1}),l(s,{span:"24 s:24 m:6",label:"日志源设备",path:"logodid",class:"pr-24px mt-10px"},{default:i(()=>[l(y,{disabled:S.logsoudev,value:e.value.logodid,"onUpdate:value":[o[7]||(o[7]=n=>e.value.logodid=n),c],placeholder:"请选择日志源设备",options:S.LogSourceDeviceList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["disabled","value","options"])]),_:1}),l(s,{span:"24 s:24 m:6",label:"目标对象",path:"target",class:"pr-24px mt-10px"},{default:i(()=>[l(h,{placeholder:"请输入目标对象",value:e.value.target,"onUpdate:value":o[8]||(o[8]=n=>e.value.target=n),clearable:""},null,8,["value"])]),_:1}),l(s,{span:"24 m:8",class:"pr-24px mt-10px"},{default:i(()=>[l(t,{class:"w-full"},{default:i(()=>[l(x,{onClick:P},{icon:i(()=>[l(E,{class:"text-icon"})]),default:i(()=>[U(" "+F(I(b)("common.reset")),1)]),_:1}),l(x,{type:"primary",ghost:"",onClick:c},{icon:i(()=>[l(a,{class:"text-icon"})]),default:i(()=>[U(" "+F(I(b)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Pe={class:"min-h-500px flex-col-stretch overflow-hidden lt-sm:overflow-auto"};function $e(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!ce(_)}const Ne=W({name:"eventalarm_originlog",__name:"index",props:{logsoudev:{},aip:{}},setup(_){const V=se(),S=m(window.innerHeight-395),g=_,T=m([]);(async()=>{const{data:a,error:t}=await De();t||(T.value=a.map(u=>({...u,id:"+"+u.id,type:u.cname})))})();const e=m([]),L=m([]);async function M(){const{data:a,error:t}=await Le();t||(e.value=a,await z())}async function z(){const{data:a,error:t}=await ke();if(!t){L.value=a;let u=e.value.concat(a);e.value=ve(u)}}M();const k=m(!1),P=m(),$=m(),A=m(!1),d=j({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),C=[{title:"",key:"key",width:80,render:(a,t)=>`${t+1}`},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"elevel",title:"事件等级",align:"center",width:120,render:a=>{(a.elevel===void 0||a.elevel===null)&&(a.elevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},u=b(J[a.elevel]);let f={color:t[a.elevel],textColor:"#ffffff",borderColor:t[a.elevel]};return l(ue,{size:"small",color:f},$e(u)?u:{default:()=>[u]})}},{key:"cname",title:"设备类别",align:"center",width:180},{key:"type",title:"设备类型",align:"center",width:180},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"sourceip",title:"发生源IP",align:"center",width:180},{key:"prifinallog",title:"日志原文",align:"center",width:240,ellipsis:{tooltip:!0}},{key:"operate",title:b("common.operate"),align:"center",width:100,fixed:"right",render:a=>l("div",{class:"flex-center gap-8px"},[l(B,{type:"info",ghost:!0,size:"small",onClick:()=>O(a)},{default:()=>[U("详情")]})])}],r=m([]),N=m(0),c=async(a=!1)=>{if(!A.value)A.value=!0;else return;A.value=!0,g.logsoudev&&g.aip&&(p.value=!1,d.logodid=g.logsoudev,d.startAndEndSourceIp=[g.aip,g.aip],d.startSourceIp=g.aip,d.endSourceIp=g.aip);const{data:t,error:u}=await Ee(d);u||(N.value=t.length,a?r.value=[...r.value,...t]:r.value=t,A.value=!1)},p=m(!0),o=async()=>{r.value=[],d.pageId=void 0,(t=>Object.keys(t).filter(v=>v!=="limit"&&v!=="_t").some(v=>t[v]!==void 0&&t[v]!==""&&t[v]!==null))(d)?p.value=!1:(p.value=!0,w()),d.pageId=void 0,await c(),y()},y=async()=>{var a,t;if(r.value.length<S.value/44&&r.value.length<s.total){if(d.pageId==r.value[r.value.length-1].id)return;d.pageId=((t=(a=r.value)==null?void 0:a[r.value.length-1])==null?void 0:t.id)??void 0,c(!0)}};de(async()=>{await c(),await w(),y()});const s=j({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:t,page:u,pageSize:f,pageCount:v,itemCount:n}){return`已加载${r.value.length}条`+(r.value.length?p.value?` 共计 ${r.value.length>0?n??0:0} 条`:N.value==d.limit?"  预计还有更多":"  没有更多了":"")}});async function w(){const{data:a,error:t}=await Oe();t||(s.pageCount=20,s.total=Number(a),s.itemCount=Number(a))}const O=a=>{P.value=a.id,$.value=a,k.value=!0};function h(a){Math.abs(a.target.scrollTop+a.target.offsetHeight-a.target.scrollHeight)<=20&&s.total>r.value.length&&E()}const E=X.debounce(()=>{var a;if(((a=r.value)==null?void 0:a.length)<s.total){if(d.pageId==r.value[r.value.length-1].id)return;d.pageId=r.value[r.value.length-1].id,c(!0)}},300);async function x(){if(!r.value.length)return;const a=JSON.parse(JSON.stringify(r.value)),t=[];a.forEach(f=>{const v={};C.forEach(n=>{if(f.hasOwnProperty(n.key)){const G=n.key=="elevel"?b(J[f[n.key]]):f[n.key];v[n.title]=G}}),t.push(v)}),be(t,500,[{wpx:120},{wpx:120},{wpx:80},{wpx:100},{wpx:100},{wpx:120},{wpx:100},{wpx:500}],"原始日志_"+new Date().getTime())}return(a,t)=>{const u=Z,f=Ce,v=Q;return K(),pe("div",Pe,[l(Te,{model:d,"onUpdate:model":t[0]||(t[0]=n=>d=n),onSearch:o,eventsTypeDataList:e.value,LogSourceDeviceList:T.value,class:"mb-16px",logsoudev:g.logsoudev},null,8,["model","eventsTypeDataList","LogSourceDeviceList","logsoudev"]),l(v,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":i(()=>[l(u,null,{default:i(()=>[l(I(B),{type:"primary",size:"small",ghost:"",onClick:x,title:"导出已加载"},{default:i(()=>[U("导出已加载")]),_:1})]),_:1})]),default:i(()=>[l(f,{columns:C,data:r.value,size:"small","flex-height":!I(V).isMobile,loading:A.value,remote:"","row-key":n=>n.id,"virtual-scroll":"","scroll-x":C.reduce((n,G)=>n+G.width,0),pagination:s,class:"sm:h-full",onScroll:h,"max-height":S.value},null,8,["data","flex-height","loading","row-key","scroll-x","pagination","max-height"])]),_:1}),l(xe,{detailVisible:k.value,"onUpdate:detailVisible":t[1]||(t[1]=n=>k.value=n),detailId:P.value,detailInfo:$.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),la=me(Ne,[["__scopeId","data-v-845762af"]]);export{la as default};
