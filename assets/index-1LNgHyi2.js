import{_ as te}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CoKhvjWF.js";import{d as I,n as V,s as G,p as H,q as oe,b as ne,r as ae,ae as le,D as F,o as L,c as J,w as n,g as e,h as M,t as O,i as t,$ as f,F as W,E as P,J as Z,K as se,Z as ie,O as Q,B as K,N as X,ah as re,ai as ce,ad as Y,a3 as pe,j as ue,A as de,e as me,al as j,am as _e,an as fe}from"./index-CPo--K2z.js";import{u as ye,a as ge}from"./table-LW222zAQ.js";import{e as he,g as ve,h as be,i as we,j as De}from"./Collection-Bij_3atz.js";import{_ as ke}from"./round-search-C9foa4Fb.js";import{_ as Ne}from"./round-refresh-OSot4Wia.js";import{_ as Ce}from"./lodash-Btl-Lpgv.js";import{_ as Se}from"./FormItemGridItem-D7sgA0LY.js";import{_ as xe}from"./Grid-BKcUr_na.js";import{h as q}from"./permission-9qOQaUIE.js";import{_ as ze}from"./Popconfirm-B2uCCKAi.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Bz40TOlU.js";import"./setting-outlined-Dge4M2aI.js";import"./export-062aMd-k.js";import"./refresh-DUUol91f.js";import"./round-delete-BusdVuEw.js";import"./round-plus-CdXc2KSH.js";import"./Upload-t9zrUxE_.js";import"./Progress-DPO-N_MM.js";const Te=I({name:"OperateDrawer",__name:"operate-drawer",props:V({operateType:{},rowData:{},tTypeList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(y,{emit:x}){const i=y,g=x,_=G(y,"visible"),{formRef:u,validate:D,restoreValidation:z}=H(),{createConfirmPwdRule:k,defaultRequiredRule:N,patternRules:T}=oe(),C=ne(()=>({add:"新增策略",edit:"编辑策略"})[i.operateType]),a=ae(v());function v(){return{id:void 0,pname:"",etype:[],cdesc:""}}const R={pname:N,etype:{type:"array",required:!0,trigger:["blur","change"],message:"请选择事件类型"}};function d(){Object.assign(a,v()),i.operateType==="edit"&&i.rowData&&(Object.assign(a,i.rowData),a.etype&&(a.etype=a.etype.split(",").map(Number)))}function b(){_.value=!1}async function S(){var w,l;if(await D(),a.etype&&(a.etype=a.etype.join(",")),i.operateType==="add"){const{data:h,error:m}=await he([a]);m||((w=window.$message)==null||w.success(f("common.addSuccess")),b(),g("submitted"))}else{const{data:h,error:m}=await ve([a]);m||((l=window.$message)==null||l.success(f("common.updateSuccess")),b(),g("submitted"))}}return le(_,()=>{_.value&&(d(),z())}),(w,l)=>{const h=Z,m=se,$=ie,A=Q,U=K,s=X,o=re,r=ce,B=F("no-space");return L(),J(r,{show:_.value,"onUpdate:show":l[3]||(l[3]=c=>_.value=c),"display-directive":"show",width:360},{default:n(()=>[e(o,{title:C.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(s,{size:16},{default:n(()=>[e(U,{onClick:b},{default:n(()=>[M(O(t(f)("common.cancel")),1)]),_:1}),e(U,{type:"primary",onClick:S},{default:n(()=>[M(O(t(f)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(A,{ref_key:"formRef",ref:u,model:a,rules:R,onKeyup:W(S,["enter"])},{default:n(()=>[e(m,{label:"策略名称",path:"pname"},{default:n(()=>[P(e(h,{value:a.pname,"onUpdate:value":l[0]||(l[0]=c=>a.pname=c),placeholder:"请输入策略名称",clearable:""},null,8,["value"]),[[B]])]),_:1}),e(m,{label:"事件类型",path:"etype"},{default:n(()=>[e($,{value:a.etype,"onUpdate:value":l[1]||(l[1]=c=>a.etype=c),multiple:"",placeholder:"请选择日志级别","value-field":"id","label-field":"pname",options:i.tTypeList},null,8,["value","options"])]),_:1}),e(m,{label:"描述",path:"cdesc"},{default:n(()=>[e(h,{type:"textarea",value:a.cdesc,"onUpdate:value":l[2]||(l[2]=c=>a.cdesc=c),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Re=I({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:V(["reset","search"],["update:model"]),setup(y,{emit:x}){const i=x,{formRef:g,restoreValidation:_}=H(),u=G(y,"model");function D(){u.value.fuzzy="",i("search")}async function z(){await _(),i("reset")}async function k(){i("search")}const N=Ce.debounce(k,1e3,{leading:!0,trailing:!1});return(T,C)=>{const a=Z,v=Se,R=Ne,d=K,b=ke,S=X,w=xe,l=Q,h=Y,m=F("no-space");return L(),J(h,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(l,{ref_key:"formRef",ref:g,model:u.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:W(t(N),["enter"])},{default:n(()=>[e(w,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[e(v,{span:"24 s:12 m:8 l:6",label:"策略名称",path:"fuzzy"},{default:n(()=>[P(e(a,{clearable:"",value:u.value.fuzzy,"onUpdate:value":C[0]||(C[0]=$=>u.value.fuzzy=$),placeholder:"请输入策略名称",onClear:D},null,8,["value"]),[[m]])]),_:1}),e(v,{span:"24 s:12 m:8 l:6"},{default:n(()=>[e(S,{class:"w-full"},{default:n(()=>[e(d,{onClick:z},{icon:n(()=>[e(R,{class:"text-icon"})]),default:n(()=>[M(" "+O(t(f)("common.reset")),1)]),_:1}),e(d,{type:"primary",ghost:"",onClick:t(N)},{icon:n(()=>[e(b,{class:"text-icon"})]),default:n(()=>[M(" "+O(t(f)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),$e={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function E(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!_e(y)}const Qe=I({name:"collectionmanagement_collectionpolicy",__name:"index",setup(y){const x=pe(),{columns:i,columnChecks:g,data:_,getData:u,loading:D,mobilePagination:z,searchParams:k,resetSearchParams:N}=ye({apiFn:be,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"pname",title:"策略名称",align:"center",width:140},{key:"etype",title:"事件类型",align:"center",render:s=>{const o=s.etype.split(",").map(Number);return e("span",null,[o.map((r,B)=>{var p;const c=(p=l.value.find(ee=>ee.id===r))==null?void 0:p.pname;return c?`${c}${B!==o.length-1?"，":""}`:""})])},ellipsis:{tooltip:!0,tooltipPlacement:"top"}},{key:"cdesc",title:"描述",align:"center",minWidth:200},{key:"operate",title:f("common.operate"),align:"center",width:130,render:s=>{let o;return e("div",{class:"flex-center gap-8px"},[P(e(K,{type:"primary",ghost:!0,size:"small",onClick:()=>A(s.id)},E(o=f("common.edit"))?o:{default:()=>[o]}),[[F("no-auth"),"sys.collection.policy.update"]]),e(ze,{onPositiveClick:()=>$(s.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let r;return P(e(K,{type:"error",ghost:!0,size:"small"},E(r=f("common.delete"))?r:{default:()=>[r]}),[[F("no-auth"),"sys.collection.policy.delete"]])}})])}}]}),{drawerVisible:T,operateType:C,editingData:a,handleAdd:v,handleEdit:R,checkedRowKeys:d,onBatchDeleted:b,onDeleted:S,closeDrawer:w}=ge(_,u),l=ue([]),h=async()=>{const{data:s,error:o}=await De();l.value=s};async function m(){console.log(d.value),U(d.value.join(","),s=>{b()})}function $(s){console.log(s),U(s,o=>{S()})}function A(s){R(s)}async function U(s,o){const r=await we(s);console.log("data",r),o&&o(r)}return de(()=>{h()}),(s,o)=>{const r=te,B=fe,c=Y;return L(),me("div",$e,[e(Re,{model:t(k),"onUpdate:model":o[0]||(o[0]=p=>j(k)?k.value=p:null),onReset:t(N),onSearch:t(u)},null,8,["model","onReset","onSearch"]),e(c,{title:"采集过滤策略",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":n(()=>[e(r,{columns:t(g),"onUpdate:columns":o[1]||(o[1]=p=>j(g)?g.value=p:null),"disabled-delete":t(d).length===0,"is-view-add-button":t(q)("sys.collection.policy.insert"),"is-view-delete-button":t(q)("sys.collection.policy.delete"),loading:t(D),onAdd:t(v),onDelete:m,onRefresh:t(u)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:n(()=>[e(B,{"checked-row-keys":t(d),"onUpdate:checkedRowKeys":o[2]||(o[2]=p=>j(d)?d.value=p:null),columns:t(i),data:t(_),size:"small","flex-height":!t(x).isMobile,"scroll-x":962,loading:t(D),remote:"","row-key":p=>p.id,pagination:t(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Te,{visible:t(T),"onUpdate:visible":o[3]||(o[3]=p=>j(T)?T.value=p:null),"operate-type":t(C),"row-data":t(a),tTypeList:l.value,onSubmitted:t(u)},null,8,["visible","operate-type","row-data","tTypeList","onSubmitted"])]),_:1})])}}});export{Qe as default};
