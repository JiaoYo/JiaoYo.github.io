import{j as E,b as N,k as ae,m as ne,d as T,n as K,p as W,u as re,a as G,q as A,r as V,s as H,v as ie,x as D,y as ce,o as g,c as R,w as _,g as l,z as X,i as m,$ as w,A as F,f as b,C as q,h as $,t as P,D as le,E as de,F as M,G as ue,H as U,I as pe,J as z,K as me,L as J,M as Q,N as fe,B as Y,O as Z,P as ee,Q as _e,R as ge,S as B,T as we,U as he,V as ve,W as ye,X as ke,Y as xe,Z as Ce,a0 as be,a1 as Pe,e as k,a2 as Se,a3 as Le,a4 as I,a5 as Ne}from"./index-D23JlNHY.js";function Ee(h){const p=E(0),v=N(()=>Math.ceil(p.value/60)),x=N(()=>p.value>0),{pause:s,resume:t}=ae(()=>{p.value>0?p.value-=1:s()},{immediate:!1});function a(o=h){p.value=60*o,t()}function i(){p.value=0,s()}return ne(()=>{s()}),{count:v,isCounting:x,start:a,stop:i}}const Re=h=>(_e("data-v-64d0266c"),h=h(),ge(),h),Ue={class:"w-full flex-y-center gap-16px"},ze=["src"],$e={class:"flex-y-center justify-between updatePsd"},Me=Re(()=>b("div",{style:{display:"flex","justify-content":"right","align-items":"center"}},null,-1)),Ie=T({name:"PwdLogin",__name:"pwd-login",props:{status:{type:String,required:!0},statusModifiers:{}},emits:K(["getUsername"],["update:status"]),setup(h,{emit:u}){const p=W(h,"status"),v=re();G();const{formRef:x,validate:s}=A(),t=V({username:"",captcha:"",password:""}),a=V({uuid:"",captchaSrc:"",captchaEnable:0,checked:!1});async function i(){const{data:e,error:r}=await le();r||(a.captchaEnable=e,a.captchaEnable==1&&o())}async function o(){a.uuid=D(),a.captchaSrc=de+"/captcha?uuid="+a.uuid;const e=D(),r=Date.now().toString(),C=M(`${e}${r}`);ue.get(a.captchaSrc,{headers:{"X-Nonce":e,"X-Timestamp":r,"X-Signature":C},responseType:"blob"}).then(S=>{const j=URL.createObjectURL(S.data);a.captchaSrc=j}).catch(S=>{console.error("Error:",S)})}const c=N(()=>{const{formRules:e}=H();return{username:e.username,captcha:e.captcha,password:e.password1}});async function n(){var r;await s(),a.checked?d(t.username,M(t.password),a.checked):y();const e=await v.login(t.username,t.password,t.captcha.trim(),a.uuid);console.log(e),((r=e==null?void 0:e.data)==null?void 0:r.login)===0?setTimeout(()=>{const C=new CustomEvent("myCustomEvent");document.dispatchEvent(C),U("power-PsdLogin",t.username)},1e3):pe("power-PsdLogin"),e=="fail"&&a.captchaEnable==1&&(t.captcha="",o())}function d(e,r,C){U("power-prediction_user",e),U("power-prediction_pwd",r),U("power-prediction_check",String(C))}function f(){t.username=z("power-prediction_user")||"";const e=z("power-prediction_pwd")||"";t.password=me(e).substring(16),p.value=="pwd-login1"&&(t.password=""),a.checked=z("power-prediction_check")?z("power-prediction_check")=="true":!1}function y(){d("","",!1)}return E(!1),ie(()=>{a.uuid=D(),f(),i()}),(e,r)=>{const C=J,S=Q,j=fe,oe=Y,te=Z,se=ee,O=ce("no-space");return g(),R(se,{ref_key:"formRef",ref:x,model:t,rules:c.value,size:"large","show-label":!1},{default:_(()=>[l(S,{path:"userName"},{default:_(()=>[X(l(C,{autofocus:"",value:t.username,"onUpdate:value":r[0]||(r[0]=L=>t.username=L),placeholder:m(w)("page.login.common.userNamePlaceholder"),onKeyup:F(n,["enter"])},null,8,["value","placeholder"]),[[O]])]),_:1}),l(S,{path:"password"},{default:_(()=>[X(l(C,{value:t.password,"onUpdate:value":r[1]||(r[1]=L=>t.password=L),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:m(w)("page.login.common.passwordPlaceholder"),onKeyup:F(n,["enter"])},null,8,["value","placeholder"]),[[O]])]),_:1}),a.captchaEnable==1?(g(),R(S,{key:0,path:"captcha"},{default:_(()=>[b("div",Ue,[l(C,{value:t.captcha,"onUpdate:value":r[2]||(r[2]=L=>t.captcha=L),placeholder:"请输入验证码",onKeyup:F(n,["enter"])},null,8,["value"]),b("img",{src:a.captchaSrc,alt:"captcha",style:{height:"40px"},onClick:o},null,8,ze)])]),_:1})):q("",!0),l(te,{vertical:"",size:8},{default:_(()=>[b("div",$e,[l(j,{checked:a.checked,"onUpdate:checked":r[3]||(r[3]=L=>a.checked=L)},{default:_(()=>[$(P(m(w)("page.login.pwdLogin.rememberMe")),1)]),_:1},8,["checked"])]),l(oe,{type:"primary",size:"large",ghost:"",round:"",block:"",loading:m(v).loginLoading,onClick:n},{default:_(()=>[$(P(m(w)("common.confirm")),1)]),_:1},8,["loading"]),Me]),_:1})]),_:1},8,["model","rules"])}}}),je=B(Ie,[["__scopeId","data-v-64d0266c"]]);function De(){const{loading:h,startLoading:u,endLoading:p}=we(),{count:v,start:x,stop:s,isCounting:t}=Ee(60),a=N(()=>{let c=w("page.login.codeLogin.getCode");const n=w("page.login.codeLogin.reGetCode",{time:v.value});return h.value&&(c=""),t.value&&(c=n),c});function i(c){var n,d,f,y;return c.trim()===""?((d=(n=window.$message)==null?void 0:n.error)==null||d.call(n,w("form.mobile.required")),!1):ve.test(c)?!0:((y=(f=window.$message)==null?void 0:f.error)==null||y.call(f,w("form.mobile.invalid")),!1)}async function o(c,n){!i(c)||h.value||(u(),await new Promise(f=>{he(c,n).then(y=>{var e,r;console.log("response",y),y.error||(setTimeout(f,500),(r=(e=window.$message)==null?void 0:e.success)==null||r.call(e,w("page.login.codeLogin.sendCodeSuccess")),x(),p())}).catch(y=>{var e,r;return console.log("error",y),(r=(e=window.$message)==null?void 0:e.error)==null||r.call(e,w("page.login.codeLogin.sendCodeFailed")),!1})}))}return{label:a,start:x,stop:s,isCounting:t,loading:h,getCaptcha:o}}const Fe=T({name:"ResetPwd",__name:"reset-pwd",props:K({username:{type:String,required:!0}},{status:{type:String,required:!0},statusModifiers:{}}),emits:["update:status"],setup(h){const u=W(h,"status"),p=h;G();const{formRef:v,validate:x}=A();De();const s=V({username:p.username||"",oripwd:"",code:"",password:"",confirmPassword:""}),t=N(()=>{const{formRules:i,createConfirmPwdRule:o,defaultRequiredRule:c}=H();return{username:i.username,oripwd:i.password,password:[{...c},{asyncValidator:(n,d)=>d==""||d==null?Promise.resolve():ye(d)?s.username&&d.toLocaleLowerCase().includes(s.username.toLocaleLowerCase())?Promise.reject("密码禁止与用户名相同或包含用户名(不区分大小写)"):s.password==s.oripwd?Promise.reject("新密码不能与旧密码相同"):Promise.resolve():Promise.reject("密码应符合：大、小写字母、数字、特殊字符的三种或以上的组合"),trigger:["blur","input"]}],code:i.code,confirmPassword:o(s.password)}});async function a(){var d,f;await x();const i=await M(s.oripwd),o=await M(s.password),{data:c,error:n}=await ke(s.username,i,o);console.log("data",c),n?(f=window.$message)==null||f.error("修改失败"):((d=window.$message)==null||d.success("修改成功"),u.value="pwd-login1")}return(i,o)=>{const c=J,n=Q,d=Y,f=Z,y=ee;return g(),R(y,{ref_key:"formRef",ref:v,model:s,rules:t.value,size:"large","show-label":!1},{default:_(()=>[l(n,{path:"username"},{default:_(()=>[l(c,{value:s.username,"onUpdate:value":o[0]||(o[0]=e=>s.username=e),placeholder:m(w)("page.login.common.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1}),l(n,{path:"oripwd"},{default:_(()=>[l(c,{value:s.oripwd,"onUpdate:value":o[1]||(o[1]=e=>s.oripwd=e),type:"password","show-password-on":"click",placeholder:"请输入原密码"},null,8,["value"])]),_:1}),l(n,{path:"password"},{default:_(()=>[l(c,{value:s.password,"onUpdate:value":o[2]||(o[2]=e=>s.password=e),type:"password","show-password-on":"click",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),l(n,{path:"confirmPassword"},{default:_(()=>[l(c,{value:s.confirmPassword,"onUpdate:value":o[3]||(o[3]=e=>s.confirmPassword=e),type:"password","show-password-on":"click",placeholder:m(w)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1}),l(f,{vertical:"",size:18,class:"w-full"},{default:_(()=>[l(d,{type:"primary",size:"large",ghost:"",round:"",block:"",onClick:a},{default:_(()=>[$(P(m(w)("common.confirm")),1)]),_:1}),l(d,{size:"large",ghost:"",round:"",block:"",onClick:o[4]||(o[4]=e=>u.value="pwd-login"),class:"c-#fff"},{default:_(()=>[$(P(m(w)("page.login.common.back")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),Ve=B(Fe,[["__scopeId","data-v-5c916aca"]]),qe={class:"w-400px lt-sm:w-300px"},Te={class:"flex-y-center justify-center"},Be={key:0,src:I,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},Oe={key:1,src:I,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},Xe={key:2,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},Ke={key:3,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},We={class:"pt-24px"},Ge={class:"pt-16px"},Ae={class:"flex justify-center items-center",style:{position:"fixed",top:"20px",right:"20px","z-index":"999"}},He={key:0,src:I,alt:"Linkqi",class:"w-100px pr-10px"},Je={key:1,src:I,alt:"Linkqi",class:"w-100px pr-10px"},Qe={key:2,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},Ye={key:3,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},Ze={key:0,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},eo={key:1,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},oo=T({name:"login",__name:"index",props:{module:{}},setup(h){xe();const u=Ce(),p=E("pwd-login");N(()=>u.darkMode?be(u.themeColor,600):u.themeColor);const v=E(""),x=i=>{v.value=i},s=N(()=>{const i="#ffffff",o=u.darkMode?.5:.2;return Pe(i,u.themeColor,o)}),t=E();return(async()=>{fetch("/version.json").then(i=>i.json()).then(i=>{t.value=i}).catch(i=>{console.error("Error fetching version.json:",i)})})(),(i,o)=>{var n,d;const c=Ne;return g(),k("div",{class:"relative size-full flex-center overflow-hidden login",style:Le({backgroundColor:s.value})},[l(c,{bordered:!1,class:"relative z-4 w-auto rd-12px loginClass","content-style":{padding:"24px 36px"}},{default:_(()=>[b("div",qe,[b("header",Te,[m(u).darkMode?(g(),k("img",Oe)):(g(),k("img",Be)),m(u).darkMode?(g(),k("h3",Xe,P(m(w)("system.title")),1)):(g(),k("h3",Ke,P(m(w)("system.title")),1))]),b("main",We,[b("div",Ge,[l(Se,{name:m(u).page.animateMode,mode:"out-in",appear:""},{default:_(()=>[p.value=="pwd-login"||p.value=="pwd-login1"?(g(),R(je,{key:0,status:p.value,"onUpdate:status":o[0]||(o[0]=f=>p.value=f),onGetUsername:x},null,8,["status"])):(g(),R(Ve,{key:1,status:p.value,"onUpdate:status":o[1]||(o[1]=f=>p.value=f),username:v.value},null,8,["status","username"]))]),_:1},8,["name"])])])])]),_:1}),b("div",Ae,[m(u).darkMode?(g(),k("img",Je)):(g(),k("img",He)),m(u).darkMode?(g(),k("span",Qe,P(((n=t.value)==null?void 0:n.ver)||"V1.1.6"),1)):(g(),k("span",Ye,P(((d=t.value)==null?void 0:d.ver)||"V1.1.6"),1))]),m(u).darkMode?q("",!0):(g(),k("div",Ze," Copyright (c) 2025 · 杭州领祺科技有限公司")),m(u).darkMode?(g(),k("div",eo," Copyright (c) 2025 · 杭州领祺科技有限公司")):q("",!0)],4)}}}),so=B(oo,[["__scopeId","data-v-3d33f339"]]);export{so as default};
