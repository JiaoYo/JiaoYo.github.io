import{_ as te}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Dgfnf-eW.js";import{_ as ae}from"./round-delete-BrswDG8L.js";import{_ as ne}from"./round-add-RcSbrCJq.js";import{d as Y,p as J,q as oe,r as le,aw as P,s as se,ab as Q,k as ie,aF as re,b as de,$ as u,o as T,c as q,w as t,g as e,h as b,t as U,i as o,f as ue,eN as me,eO as ce,L as pe,O as _e,aU as fe,P as A,aV as ge,Q as ve,B as y,aJ as be,eP as he,A as C,z as F,eQ as E,e as we,af as K,aN as R,aO as ye,aT as ke,a6 as Ne}from"./index-Dv00cP5-.js";import{u as xe,a as De}from"./table-C1NDxmVn.js";import{_ as Se}from"./lodash-DP-SmS9v.js";import{_ as Ce}from"./FormItemGridItem-DXFV07tz.js";import{_ as Pe}from"./Cascader-Chi81t4W.js";import{_ as Te}from"./DatePicker-B5jWMUXy.js";import{_ as Ue}from"./Grid-CAhcp-3N.js";import{N as X}from"./Popconfirm-BcvgG2Nh.js";const $e=ue("span",null,"匹配前缀",-1),Oe=Y({__name:"weather_model",props:J({operateType:{},rowData:{},Pagination:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(f,{emit:$}){const c=oe(f,"visible"),k=$,m=f,a=le(h());function h(){return{sname:"",model:"",manu:"",dbtime:P(0,new Date),isupload:0,devid:void 0,stortime:0,pre:0,prename:`气象站_QX${m.Pagination.itemCount+1}`}}function O(){Object.assign(a,h()),m.operateType==="edit"&&m.rowData&&(Object.assign(a,m.rowData),a.dbtime=P(0,a.dbtime))}const{formRef:W,validate:w,restoreValidation:j}=se();Q(()=>m.rowData,()=>{O()}),Q(c,()=>{c.value&&(z(),O(),j())});const N=ie(),z=async()=>{const{data:d,error:l}=await re({type:0});function s(n){return n.map(i=>{var g;return{label:i.chlName,value:i.chlName,children:(g=i.devicePojoList)!=null&&g.length?i.devicePojoList.map(v=>({label:v.devName,value:v.id})):[]}})}N.value=s(d)},x=()=>{c.value=!1},_=async()=>{var l;await w();const d=JSON.parse(JSON.stringify(a));if(d.dbtime=P(1,d.dbtime),d.isbind==0&&(d.devid=null),m.operateType==="add"){const{data:s,error:n}=await me([d]);if(n)return}else{const{data:s,error:n}=await ce([d]);if(n)return}(l=window.$message)==null||l.success(m.operateType==="add"?"添加成功":"修改成功"),x(),k("submitted")},G=Se.debounce(_,1e3,{leading:!0,trailing:!1}),B={sname:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},devid:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]}},M=de(()=>({add:u("common.add"),edit:u("common.edit")})[m.operateType]);return(d,l)=>{const s=pe,n=Ce,i=Pe,g=_e,v=Te,D=fe,V=A,L=ge,S=Ue,p=ve,I=y,Z=A,ee=be;return T(),q(ee,{show:c.value,"onUpdate:show":l[8]||(l[8]=r=>c.value=r),title:M.value,preset:"card",class:"w-50%"},{footer:t(()=>[e(Z,{size:16,justify:"center"},{default:t(()=>[e(I,{onClick:x,class:"w-100px"},{default:t(()=>[b(U(o(u)("common.cancel")),1)]),_:1}),e(I,{type:"primary",class:"w-100px",onClick:o(G)},{default:t(()=>[b(U(o(u)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(p,{ref_key:"formRef",ref:W,model:a,rules:B,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:t(()=>[e(S,{responsive:"screen","item-responsive":""},{default:t(()=>[e(n,{span:"24 m:12",label:"名称",path:"sname"},{default:t(()=>[e(s,{clearable:"",value:a.sname,"onUpdate:value":l[0]||(l[0]=r=>a.sname=r),placeholder:"请输入",maxlength:"64"},null,8,["value"])]),_:1}),e(n,{span:"24 m:12",label:"型号",path:"model"},{default:t(()=>[e(s,{clearable:"",value:a.model,"onUpdate:value":l[1]||(l[1]=r=>a.model=r),placeholder:"请输入",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1}),e(n,{span:"24 m:12",label:"绑定设备",path:"devid"},{default:t(()=>[e(i,{value:a.devid,"onUpdate:value":l[2]||(l[2]=r=>a.devid=r),placeholder:"请选择协议名称","expand-trigger":"click",options:N.value,"check-strategy":"child","show-path":!1},null,8,["value","options"])]),_:1}),e(n,{span:"24 m:12"},{label:t(()=>[e(g,{checked:a.pre,"onUpdate:checked":l[3]||(l[3]=r=>a.pre=r),"checked-value":0,"unchecked-value":1,class:"mr-5px"},null,8,["checked"]),$e]),default:t(()=>[e(s,{clearable:"",value:a.prename,"onUpdate:value":l[4]||(l[4]=r=>a.prename=r),disabled:a.pre==1,placeholder:"请输入匹配前缀"},null,8,["value","disabled"])]),_:1}),e(n,{span:"24 m:12",label:"生产商",path:"manu"},{default:t(()=>[e(s,{clearable:"",value:a.manu,"onUpdate:value":l[5]||(l[5]=r=>a.manu=r),placeholder:"请输入",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1}),e(n,{span:"24 m:12",label:"安装时间",path:"dbtime"},{default:t(()=>[e(v,{"formatted-value":a.dbtime,"onUpdate:formattedValue":l[6]||(l[6]=r=>a.dbtime=r),"value-format":"yyyy-MM-dd",type:"date",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),e(n,{span:"24 m:12",label:"是否上报",path:"isupload"},{default:t(()=>[e(L,{value:a.isupload,"onUpdate:value":l[7]||(l[7]=r=>a.isupload=r),name:"radiogroup"},{default:t(()=>[e(V,null,{default:t(()=>[e(D,{label:o(u)("common.yesOrNo.yes"),value:0},null,8,["label"]),e(D,{label:o(u)("common.yesOrNo.no"),value:1},null,8,["label"])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function H(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!ye(f)}const Ie=Y({name:"stationmanagement_weatherstationsetup",__name:"index",setup(f){const{columns:$,columnChecks:c,data:k,getData:m,loading:a,mobilePagination:h,searchParams:O,resetSearchParams:W}=xe({apiFn:he,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"sname",title:"名称",align:"center",width:140},{key:"model",title:"型号",align:"center",width:100},{key:"devName",title:"设备名称",align:"center",width:100},{key:"manu",title:"生产商",align:"center",width:140},{key:"dbtime",title:"安装时间",align:"center",width:140,render:s=>e("span",null,[P(0,s.dbtime)])},{key:"isupload",title:"是否上传",align:"center",width:100,render:s=>e("span",null,[s.isupload==0?"是":"否"])},{key:"operate",title:u("common.operate"),align:"center",width:200,fixed:"right",render:s=>{let n;return e("div",{class:"flex-center gap-8px"},[C(e(y,{type:"primary",ghost:!0,size:"small",onClick:()=>l(s.id)},H(n=u("common.edit"))?n:{default:()=>[n]}),[[F("no-auth"),"weatherStation:update"]]),C(e(X,{onPositiveClick:()=>d(s.id)},{default:()=>u("common.confirmDelete"),trigger:()=>{let i;return e(y,{type:"error",ghost:!0,size:"small"},H(i=u("common.delete"))?i:{default:()=>[i]})}}),[[F("no-auth"),"weatherStation:delete"]])])}}]}),{drawerVisible:w,operateType:j,editingData:N,handleAdd:z,handleEdit:x,checkedRowKeys:_,onBatchDeleted:G,onDeleted:B}=De(k,m),M=async()=>{const s=_.value.join(","),{data:n,error:i}=await E({ids:s});i||(_.value=[])},d=async s=>{const{data:n,error:i}=await E({ids:s});i||B()},l=s=>{x(s)};return(s,n)=>{const i=A,g=ne,v=ae,D=te,V=ke,L=Ne,S=F("no-auth");return T(),we("div",je,[e(L,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(i,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[b(" 气象站设置 ")]),_:1})]),"header-extra":t(()=>[e(i,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[C((T(),q(o(y),{onClick:o(z),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(g,{class:K(["text-icon",{"animate-spin":o(a)}])},null,8,["class"])]),default:t(()=>[b(" "+U(o(u)("common.add")),1)]),_:1},8,["onClick"])),[[S,"weatherStation:insert"]]),C((T(),q(o(X),{onPositiveClick:M},{trigger:t(()=>[e(o(y),{size:"small",ghost:"",type:"error",disabled:o(_).length==0},{icon:t(()=>[e(v,{class:K(["text-icon",{"animate-spin":o(a)}])},null,8,["class"])]),default:t(()=>[b(" "+U(o(u)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:t(()=>[b(" 确认删除选中的项吗？ ")]),_:1})),[[S,"weatherStation:delete"]]),e(D,{columns:o(c),"onUpdate:columns":n[0]||(n[0]=p=>R(c)?c.value=p:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(V,{"checked-row-keys":o(_),"onUpdate:checkedRowKeys":n[1]||(n[1]=p=>R(_)?_.value=p:null),columns:o($),data:o(k),size:"small",loading:o(a),remote:"","row-key":p=>p.id,pagination:o(h),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Oe,{visible:o(w),"onUpdate:visible":n[2]||(n[2]=p=>R(w)?w.value=p:null),onSubmitted:o(m),"operate-type":o(j),"row-data":o(N),Pagination:o(h)},null,8,["visible","onSubmitted","operate-type","row-data","Pagination"])]),_:1})])}}});export{Ie as default};
