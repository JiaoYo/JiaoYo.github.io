import{d as E,m as J,H as N,i as L,r as W,n as H,p as Q,b as P,o as g,f as a,w as s,h as e,T as X,W as T,C,A as U,N as i,y as Z,c as Y,e as y,aX as ee,f7 as ae,aI as le,t as f,aM as se,g as v,$ as r,v as h,B as $,Z as oe,a0 as te,a1 as ne,f8 as re,aQ as ue,f9 as de,fa as ie,F as pe,fb as ce,M as me}from"./index-ByRkKuMU.js";const fe={class:"profile-wrapper"},we={key:0,class:"relative inline-block group"},_e={class:"relative inline-block group",style:{width:"100px",height:"100px"}},ge={class:"font-size-16px"},ye={key:1,class:"c-#a19f9d"},ve=E({name:"userinfo",__name:"index",setup(he){const b=J(),o=N({id:"",username:"",nickname:"",phnum:"",userimage:"",usertype:""}),I=async()=>{const{data:d,error:l}=await re();l||Object.assign(o.value,d)};L(()=>{I()});async function A(d){var c,m,w;const l=d.file.file.size/1024/1024<100;return["image/jpeg","image/png","image/jpg","image/x-icon"].includes(d.file.file.type)?l?!0:((w=window.$message)==null||w.error("文件大小不能超过100M"),!1):((c=window.$message)==null||c.destroyAll(),(m=window.$message)==null||m.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1)}async function q({file:d}){var u,p,c;const l=await ue(d.file,d.name,"");if(l){Object.prototype.hasOwnProperty.call(l,"result")?(u=window.$message)==null||u.destroyAll():console.log("文件上传成功");const{data:m,error:w}=await de({id:o.value.id,image:l});w||((p=window.$message)==null||p.destroyAll(),(c=window.$message)==null||c.success("头像修改成功"),b.setUserImage(l),I())}}const k=N(!1),_=N({pwd:""}),M=async()=>{var u;const{data:d,error:l}=await ie({pwd:pe(_.value.pwd)});l||(R(),(u=window.$message)==null||u.success("解绑成功"))},F=()=>{k.value=!0,_.value.pwd=""},R=()=>{k.value=!1},t=W(z());function z(){return{username:b.userInfo.username,pwd:"",newPwd:"",comfirmPassword:""}}const{formRef:S,validate:G}=H(),{createConfirmPwdRule:K,defaultRequiredRule:j,patternRules:O}=Q(),B={pwd:j,newPwd:{...j,...O.password}};async function x(){var u,p;await G();const{data:d,error:l}=await ce(t.username,t.pwd,t.newPwd,b.userInfo.id);l||((u=window.$message)==null||u.destroyAll(),(p=window.$message)==null||p.success("密码修改成功, 即将返回登录页"),setTimeout(()=>{b.resetStore()},1e3))}return(d,l)=>{const u=ee,p=ae,c=le,m=Z,w=se,V=te,D=ne;return g(),P("div",fe,[a(e(oe),{class:"card"},{default:s(()=>[a(e(X),{type:"line",animated:""},{default:s(()=>[a(e(T),{name:"profile",tab:"个人中心"},{default:s(()=>[a(e(C),{model:o.value,"label-placement":"left",style:{width:"400px"},"label-width":100,"require-mark-placement":"left",onKeyup:U(x,["enter"])},{default:s(()=>[a(e(i),{label:"头像",path:"username"},{default:s(()=>[a(m,{justify:"center"},{default:s(()=>[o.value.userimage?(g(),P("div",we,[y("div",_e,[a(u,{width:"100",height:"100","preview-disabled":"",src:o.value.userimage,class:"rounded-md object-cover"},null,8,["src"]),y("div",{class:"absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-pointer rounded-md",onClick:l[0]||(l[0]=n=>o.value.userimage="")},[a(p,{class:"font-size-40px c-#fff"})])])])):(g(),Y(c,{key:1,style:{width:"100px",height:"100px"},ref:"uploadRef",action:"#","list-type":"image-card",onBeforeUpload:A,"custom-request":q},null,512))]),_:1})]),_:1}),a(e(i),{label:"用户名称：",path:"username"},{default:s(()=>[y("div",ge,f(o.value.username),1)]),_:1}),a(e(i),{label:"用户类型：",path:"usertype"},{default:s(()=>[a(w,{type:"info"},{default:s(()=>[v(f(o.value.usertype==0?"超级管理员":o.value.usertype==1?"销售":o.value.usertype==2?"项目负责人":o.value.usertype==3?"调试工程师":o.value.usertype==4?"综合管理":o.value.usertype==5?"研发工程师":o.value.usertype==6?"生产工程师":""),1)]),_:1})]),_:1}),a(e(i),{label:"联系方式：",path:"phnum"},{default:s(()=>[y("div",null,f(o.value.phnum),1)]),_:1}),a(e(i),{label:"微信昵称：",path:"nickname"},{default:s(()=>[y("div",null,[v(f(o.value.nickname)+" ",1),o.value.nickname?(g(),P("span",{key:0,class:"ml-20px cursor-pointer c-red",onClick:F},"解绑")):(g(),P("span",ye,"未绑定"))])]),_:1})]),_:1},8,["model"])]),_:1}),a(e(T),{name:"password",tab:"修改密码"},{default:s(()=>[a(e(C),{ref_key:"formRef",ref:S,model:t,rules:B,"label-placement":"left",style:{width:"400px"},"label-width":100,"require-mark-placement":"left",onKeyup:U(x,["enter"])},{default:s(()=>[a(e(i),{label:e(r)("page.manage.user.username"),path:"username"},{default:s(()=>[a(e(h),{readonly:"",value:t.username,"onUpdate:value":l[1]||(l[1]=n=>t.username=n),placeholder:e(r)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(i),{label:e(r)("page.login.common.oldPassword"),path:"pwd"},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:t.pwd,"onUpdate:value":l[2]||(l[2]=n=>t.pwd=n),placeholder:e(r)("page.login.common.oldPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(i),{label:e(r)("page.login.common.password"),path:"newPwd"},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:t.newPwd,"onUpdate:value":l[3]||(l[3]=n=>t.newPwd=n),placeholder:e(r)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(i),{label:e(r)("page.login.common.confirmPassword"),path:"comfirmPassword",rule:e(K)(t.newPwd)},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:t.comfirmPassword,"onUpdate:value":l[4]||(l[4]=n=>t.comfirmPassword=n),placeholder:e(r)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rule"]),a(m,{justify:"center",size:16},{default:s(()=>[a(e($),{type:"primary",onClick:x},{default:s(()=>[v(f(e(r)("common.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),a(D,{show:k.value,"onUpdate:show":l[6]||(l[6]=n=>k.value=n),title:"解绑微信",preset:"card",class:"w-500px"},{footer:s(()=>[a(m,{justify:"end",size:16},{default:s(()=>[a(e($),{onClick:R},{default:s(()=>[v(f(e(r)("common.cancel")),1)]),_:1}),a(e($),{type:"primary",onClick:M},{default:s(()=>[v(f(e(r)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(V,null,{default:s(()=>[a(e(C),{ref_key:"formRef",ref:S,model:_.value,rules:B,"label-placement":"left","require-mark-placement":"left",onKeyup:U(M,["enter"])},{default:s(()=>[a(e(i),{label:e(r)("page.login.common.password"),path:"pwd"},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:_.value.pwd,"onUpdate:value":l[5]||(l[5]=n=>_.value.pwd=n),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}}),ke=me(ve,[["__scopeId","data-v-3f9592e7"]]);export{ke as default};
