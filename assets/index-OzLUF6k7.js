import{_ as ce}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CZS90eyC.js";import{_ as de}from"./round-delete-BUe9s3DM.js";import{_ as fe}from"./round-add-DYiCOkQk.js";import{d as Z,aB as H,C as me,A as ae,a as ve,aD as ne,az as _e,aP as ge,cX as ye,cY as he,s as Y,c as k,o as m,w as l,f as e,a8 as be,L as oe,h as n,G as T,aA as se,b as A,F as G,g as v,e as $,t as y,aF as we,B as x,aG as ke,I as J,$ as F,a9 as xe,aM as Ce,bf as De,K as Ne,a7 as ie,aO as Ue,E as X,aQ as I,aE as ze,H as K,aR as $e,cZ as Se,c_ as ee,c$ as Le,aV as Re}from"./index-CF5MLTcW.js";import{u as je,a as qe}from"./table-CjO67JuQ.js";import{_ as re}from"./Grid-C1MGDjD6.js";import{_ as pe}from"./FormItemGridItem-zqSggTEs.js";import{_ as Be}from"./round-search-ZJkui7sH.js";import{_ as Te}from"./round-refresh-BsyOm5rL.js";import{N as te}from"./Popconfirm-DN_sr8cS.js";const Fe={key:0,style:{"margin-left":"20px"}},Pe={key:0,style:{"margin-left":"20px"}},Me={key:0,style:{"margin-left":"20px"}},Oe={key:0,style:{"margin-left":"20px"}},Ve=Z({name:"OperateDrawer",__name:"operate-drawer",props:H({operateType:{},rowData:{},provinceList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(C,{emit:O}){const S=O,b=C,t=me(L());function L(){return{id:"",dname:"",dcon:"",province:null,region:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}async function _(){Object.assign(t,L()),b.operateType==="edit"&&b.rowData&&Object.assign(t,b.rowData)}const{formRef:D,validate:P,restoreValidation:V}=ae(),N={dname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},province:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dcon:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},region:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},M=ve(()=>({add:"新增调度",edit:"修改调度"})[b.operateType]),g=ne(C,"visible");_e(g,()=>{g.value&&(_(),setTimeout(()=>{const i=document.querySelector(".n-scrollbar-content");i==null||i.scrollTo(0,0)},300),V())});function R(){g.value=!1}const j=ge.debounce(async()=>{var i,a;if(await P(),b.operateType==="edit"){const{data:r,error:c}=await ye([t]);c||(R(),S("submitted"),(i=window.$message)==null||i.success("修改成功"))}else{const{data:r,error:c}=await he([{...t}]);c||(R(),S("submitted"),(a=window.$message)==null||a.success("添加成功"))}},1e3,{leading:!0,trailing:!0}),p=Y(0),u=Y("");async function U({file:i},a){p.value=0,u.value=a;const r=await Ce(i.file,i.name,"",c=>{p.value=c});r&&(t[a]=r,p.value=0)}async function q(i){var a;return i.file.file.size>100*1024*1024?((a=window.$message)==null||a.error("文件大小不能超过100M"),!1):!0}async function B(i){if(i)try{const r=await(await fetch(i==null?void 0:i.split("?")[0],{mode:"cors"})).blob(),c=URL.createObjectURL(r),h=document.createElement("a");h.href=c,h.download=i==null?void 0:i.split("?")[1],h.style.display="none",document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(c)}catch(a){console.error("下载失败:",a)}}return(i,a)=>{const r=pe,c=we,h=ke,d=re,s=oe,w=be,E=J,Q=xe;return m(),k(Q,{show:g.value,"onUpdate:show":a[16]||(a[16]=o=>g.value=o),title:M.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:l(()=>[e(E,{justify:"end",size:16},{default:l(()=>[e(n(x),{onClick:R},{default:l(()=>[v(y(n(F)("common.cancel")),1)]),_:1}),e(n(x),{type:"primary",onClick:n(j)},{default:l(()=>[v(y(n(F)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:l(()=>[e(w,{class:"pr-20px"},{default:l(()=>[e(s,{ref_key:"formRef",ref:D,model:t,rules:N,"label-placement":"left","label-width":120},{default:l(()=>[e(d,{responsive:"screen","item-responsive":""},{default:l(()=>[e(r,{span:"24 m:12",label:"主站名称",path:"dname"},{default:l(()=>[e(n(T),{value:t.dname,"onUpdate:value":a[0]||(a[0]=o=>t.dname=o),placeholder:"请输入"},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"主站联系方式",path:"dcon"},{default:l(()=>[e(n(T),{value:t.dcon,"onUpdate:value":a[1]||(a[1]=o=>t.dcon=o),placeholder:"请输入"},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"省份",path:"province"},{default:l(()=>[e(n(se),{filterable:"",options:b.provinceList,clearable:"",value:t.province,"onUpdate:value":a[2]||(a[2]=o=>t.province=o),"value-field":"id","label-field":"name"},null,8,["options","value"])]),_:1}),e(r,{span:"24 m:12",label:"地区",path:"region"},{default:l(()=>[e(n(T),{value:t.region,"onUpdate:value":a[3]||(a[3]=o=>t.region=o),placeholder:"请输入"},null,8,["value"])]),_:1}),e(r,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:l(()=>[e(d,{responsive:"screen","item-responsive":""},{default:l(()=>[e(r,{span:"24 m:12",label:"附件1",path:"notes"},{default:l(()=>[e(n(T),{value:t.re1,"onUpdate:value":a[4]||(a[4]=o=>t.re1=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[t.fl1?(m(),A("span",Fe,[v(y((o=t.fl1)==null?void 0:o.split("?")[1])+" ",1),$("span",{class:"cursor-pointer c-#c92a2a",onClick:a[5]||(a[5]=f=>t.fl1="")},"删除"),$("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[6]||(a[6]=f=>B(t.fl1))},"下载")])):(m(),k(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":f=>U(f,"fl1"),"show-file-list":!1,onBeforeUpload:q},{default:l(()=>[e(n(x),{loading:p.value>0&&!t.fl1&&u.value=="fl1",size:"small",ghost:"",type:"primary"},{default:l(()=>[v(y(p.value>0&&!t.fl1&&u.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!t.fl1&&u.value=="fl1"?(m(),k(h,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):G("",!0)]}),_:1})]),_:1})]),_:1}),e(r,{span:"24 m:12",label:"附件2",path:"notes"},{default:l(()=>[e(n(T),{value:t.re2,"onUpdate:value":a[7]||(a[7]=o=>t.re2=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[t.fl2?(m(),A("span",Pe,[v(y((o=t.fl2)==null?void 0:o.split("?")[1])+" ",1),$("span",{class:"cursor-pointer c-#c92a2a",onClick:a[8]||(a[8]=f=>t.fl2="")},"删除"),$("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[9]||(a[9]=f=>B(t.fl2))},"下载")])):(m(),k(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":f=>U(f,"fl2"),"show-file-list":!1,onBeforeUpload:q},{default:l(()=>[e(n(x),{loading:p.value>0&&!t.fl2&&u.value=="fl2",size:"small",ghost:"",type:"primary"},{default:l(()=>[v(y(p.value>0&&!t.fl2&&u.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!t.fl2&&u.value=="fl2"?(m(),k(h,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):G("",!0)]}),_:1}),e(r,{span:"24 m:12",label:"附件3",path:"notes"},{default:l(()=>[e(n(T),{value:t.re3,"onUpdate:value":a[10]||(a[10]=o=>t.re3=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[t.fl3?(m(),A("span",Me,[v(y((o=t.fl3)==null?void 0:o.split("?")[1])+" ",1),$("span",{class:"cursor-pointer c-#c92a2a",onClick:a[11]||(a[11]=f=>t.fl3="")},"删除"),$("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[12]||(a[12]=f=>B(t.fl3))},"下载")])):(m(),k(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":f=>U(f,"fl3"),"show-file-list":!1,onBeforeUpload:q},{default:l(()=>[e(n(x),{loading:p.value>0&&!t.fl3&&u.value=="fl3",size:"small",ghost:"",type:"primary"},{default:l(()=>[v(y(p.value>0&&!t.fl3&&u.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!t.fl3&&u.value=="fl3"?(m(),k(h,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):G("",!0)]}),_:1}),e(r,{span:"24 m:12",label:"附件4",path:"notes"},{default:l(()=>[e(n(T),{value:t.re4,"onUpdate:value":a[13]||(a[13]=o=>t.re4=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[t.fl4?(m(),A("span",Oe,[v(y((o=t.fl4)==null?void 0:o.split("?")[1])+" ",1),$("span",{class:"cursor-pointer c-#c92a2a",onClick:a[14]||(a[14]=f=>t.fl4="")},"删除"),$("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[15]||(a[15]=f=>B(t.fl4))},"下载")])):(m(),k(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":f=>U(f,"fl4"),"show-file-list":!1,onBeforeUpload:q},{default:l(()=>[e(n(x),{loading:p.value>0&&!t.fl4&&u.value=="fl4",size:"small",ghost:"",type:"primary"},{default:l(()=>[v(y(p.value>0&&!t.fl4&&u.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!t.fl4&&u.value=="fl4"?(m(),k(h,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):G("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ee=Z({name:"FormSearch",__name:"form-search",props:H({provinceList:{}},{model:{required:!0},modelModifiers:{}}),emits:H(["reset","search"],["update:model"]),setup(C,{emit:O}){const S=C;De();const b=O,{formRef:t,restoreValidation:L}=ae(),_=ne(C,"model");function D(){_.value.fuzzy="",b("search")}const P=()=>{_.value.region="",b("search")};async function V(){await L(),b("reset")}async function N(){b("search")}return(M,g)=>{const R=T,j=pe,p=se,u=Te,U=x,q=Be,B=J,i=re,a=oe,r=ie;return m(),k(r,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[e(a,{ref_key:"formRef",ref:t,model:_.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ne(N,["enter"])},{default:l(()=>[e(i,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[e(j,{span:"24 s:12 m:6",label:"调度名称",path:"fuzzy"},{default:l(()=>[e(R,{clearable:"",value:_.value.fuzzy,"onUpdate:value":g[0]||(g[0]=c=>_.value.fuzzy=c),placeholder:"请输入调度名称",onClear:D},null,8,["value"])]),_:1}),e(j,{span:"24 s:12 m:4",label:"省份",path:"province"},{default:l(()=>[e(p,{clearable:"",filterable:"",value:_.value.province,"onUpdate:value":[g[1]||(g[1]=c=>_.value.province=c),N],placeholder:"请选择省份","label-field":"name","value-field":"id",options:S.provinceList},null,8,["value","options"])]),_:1}),e(j,{span:"24 s:12 m:6",label:"地区",path:"region"},{default:l(()=>[e(R,{clearable:"",value:_.value.region,"onUpdate:value":g[2]||(g[2]=c=>_.value.region=c),placeholder:"请输入地区",onClear:P},null,8,["value"])]),_:1}),e(j,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[e(B,{class:"w-full"},{default:l(()=>[e(U,{onClick:V},{icon:l(()=>[e(u,{class:"text-icon"})]),default:l(()=>[v(" "+y(n(F)("common.reset")),1)]),_:1}),e(U,{type:"primary",ghost:"",onClick:N},{icon:l(()=>[e(q,{class:"text-icon"})]),default:l(()=>[v(" "+y(n(F)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ae={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function le(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!Re(C)}const et=Z({name:"projectmanagement_dispatch",__name:"index",setup(C){const O=Ue(),S=Y([]);(async()=>{const{data:d}=await Se();d&&(S.value=d)})();const{columns:t,columnChecks:L,data:_,getData:D,loading:P,mobilePagination:V,searchParams:N}=je({showTotal:!0,apiFn:Le,apiParams:{page:1,pageSize:20,limit:20,province:void 0,region:"",fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"dname",title:"主站名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"dcon",title:"主站联系方式",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"provinceName",title:"省份",align:"center",width:120},{key:"region",title:"地区",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:F("common.operate"),align:"center",width:140,fixed:"right",render:d=>{let s;return e("div",{class:"flex-center gap-8px"},[K(e(x,{type:"primary",ghost:!0,size:"small",onClick:()=>a(d.id)},le(s=F("common.edit"))?s:{default:()=>[s]}),[[X("no-auth"),"project:Dispatch:update"]]),e(te,{onPositiveClick:()=>i(d.id)},{default:()=>F("common.confirmDelete"),trigger:()=>{let w;return K(e(x,{type:"error",ghost:!0,size:"small"},le(w=F("common.delete"))?w:{default:()=>[w]}),[[X("no-auth"),"project:Dispatch:delete"]])}})])}}]}),{drawerVisible:M,operateType:g,editingData:R,handleAdd:j,handleEdit:p,checkedRowKeys:u,onBatchDeleted:U,onDeleted:q}=qe(_,D);async function B(){console.log(u.value),r(u.value.join(","),d=>{U()})}async function i(d){const{data:s,error:w}=await ee(d);w||q()}function a(d){p(d)}async function r(d,s){const{data:w,error:E}=await ee(d);if(!E)s&&s(w);else return!1}const c=d=>{D()},h=()=>{D()};return(d,s)=>{const w=J,E=fe,Q=de,o=ce,f=ze,ue=ie,W=X("no-auth");return m(),A("div",Ae,[e(Ee,{model:n(N),"onUpdate:model":s[0]||(s[0]=z=>I(N)?N.value=z:null),onReset:h,onSearch:n(D),provinceList:S.value},null,8,["model","onSearch","provinceList"]),e(ue,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[e(w,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>s[4]||(s[4]=[$("div",null,"主站联系人",-1)])),_:1,__:[4]})]),"header-extra":l(()=>[e(w,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[K((m(),k(n(x),{onClick:n(j),size:"small",ghost:"",type:"primary"},{icon:l(()=>[e(E,{class:"text-icon"})]),default:l(()=>[s[5]||(s[5]=v(" "+y("新增")))]),_:1,__:[5]},8,["onClick"])),[[W,"project:Dispatch:insert"]]),e(n(te),{onPositiveClick:B},{trigger:l(()=>[K((m(),k(n(x),{size:"small",ghost:"",type:"error",disabled:n(u).length==0},{icon:l(()=>[e(Q,{class:$e(["text-icon",{"animate-spin":n(P)}])},null,8,["class"])]),default:l(()=>[s[6]||(s[6]=v(" "+y("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[W,"project:Dispatch:delete"]])]),default:l(()=>[s[7]||(s[7]=v(" 确定要删除选中的调度吗？ "))]),_:1,__:[7]}),e(o,{columns:n(L),"onUpdate:columns":s[1]||(s[1]=z=>I(L)?L.value=z:null)},null,8,["columns"])]),_:1})]),default:l(()=>[e(f,{"checked-row-keys":n(u),"onUpdate:checkedRowKeys":s[2]||(s[2]=z=>I(u)?u.value=z:null),columns:n(t),data:n(_),size:"small","flex-height":!n(O).isMobile,loading:n(P),remote:"","row-key":z=>z.id,pagination:n(V),class:"sm:h-full","onUpdate:filters":c},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ve,{visible:n(M),"onUpdate:visible":s[3]||(s[3]=z=>I(M)?M.value=z:null),onSubmitted:n(D),"operate-type":n(g),provinceList:S.value,"row-data":n(R)},null,8,["visible","onSubmitted","operate-type","provinceList","row-data"])]),_:1})])}}});export{et as default};
