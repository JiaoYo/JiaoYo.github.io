import{_ as Rl}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DqFf_x_E.js";import{_ as Gl}from"./round-delete-BLvHsSV0.js";import{_ as ql}from"./round-search-DuF6crdJ.js";import{d as ze,s as x,z as Ol,D as J,aL as fe,i as Hl,b as Ml,o as F,f as t,w as a,M as Jl,h as n,c as S,G as A,aM as R,H as Z,J as Kl,B as g,g as d,t as T,a2 as Wl,aD as Ql,aO as Ve,e as Ne,aC as Xl,aF as Yl,$ as L,a4 as Zl,N as et,aI as lt,aH as tt,aE as at,aG as ee,aU as Pe,aK as Re,n as _,_ as m,I as D,aA as Ge,aS as qe,F as U,aT as Oe,aJ as _e,aR as nt,aV as st,W as it}from"./index-BhODWnwk.js";import{l as rt,g as be,d as ut,e as dt,i as ot,m as ct,j as pt,n as ft}from"./aftersale-CiUFWEO5.js";import{u as mt,a as vt}from"./table-Djtp3DGd.js";import{h as He}from"./permission-Du15zcP4.js";import{u as Ce}from"./usePageData-BRSC0p7p.js";import{_ as yt}from"./Grid-CX2M5k7E.js";import{_ as gt}from"./FormItemGridItem-BHKuIZBQ.js";import{_ as ht}from"./DatePicker-DnLwdS0O.js";import{N as xt}from"./Popconfirm-DaOtvNXy.js";const zt={class:"gap-16px overflow-auto lt-sm:overflow-auto"};function _t(le){return typeof le=="function"||Object.prototype.toString.call(le)==="[object Object]"&&!st(le)}const bt=ze({name:"aftersales_aftersalesdevice",__name:"index",setup(le){const me=x(!1),te=x(0),ke=x([]),ae=Ol(),ve=J([{label:"质保维修返回",value:0},{label:"整体置换返回",value:1},{label:"报废",value:2},{label:"付费维修返回",value:3},{label:"原件返回",value:4},{label:"其他",value:9}]),Me={当日:()=>{const e=new Date().getTime();return[e,e]},本周:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*7,e]},上月:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*30,e]},近一年:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*365,e]},近三年:()=>{const e=new Date().getTime();return[e-24*60*60*1e3*365*3,e]}},G=x([]),{pageData:E,getData:ne,nextPage:Je}=Ce(ot),Ke=async e=>{const l=e.currentTarget,r=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&E.data.length<E.total&&(await Je(),G.value=E.data,await ee(),setTimeout(()=>{l.scrollTop=r}))},We=async()=>{await ne({page:1,limit:100,_t:new Date().getTime()}),G.value=E.data},K=x([]),{pageData:q,getData:ye,nextPage:Qe}=Ce(ct),Xe=async()=>{await ye(),K.value=q.data.map(e=>({label:e,value:e}))},Ye=async e=>{const l=e.currentTarget,r=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&q.data.length<q.total&&(await Qe(),await ee(),K.value=q.data.map(o=>({label:o,value:o})),setTimeout(()=>{l.scrollTop=r}))},Ze=fe.debounce(async e=>{await ye({fuzzy:e,page:1}),K.value=q.data.map(l=>({label:l,value:l}))},300),el=e=>{if(c.gws=null,O.value=!0,se.value=!1,!e){we();return}Ze(e)},we=()=>{c.gws=null,h()},ll=fe.debounce(e=>{var l;c.gws1=e||void 0,c.gws=(l=c.gws1)==null?void 0:l.join(","),h()},300),tl=async()=>{O.value&&!se.value&&(await ye({page:1}),K.value=q.data.map(e=>({label:e,value:e})),O.value=!1)},al=fe.debounce(async e=>{await ne({fuzzy:e,page:1}),G.value=E.data},300),O=x(!1),se=x(!1),nl=e=>{if(c.cid=null,O.value=!0,se.value=!1,!e){Fe();return}al(e)},sl=async()=>{O.value&&!se.value&&(await ne({page:1}),G.value=E.data,O.value=!1)},Fe=async()=>{await ne({page:1}),G.value=E.data},il=async e=>{c.cid=e,h()};async function rl(e,l){if(!e){c.startTime=void 0,c.endTime=void 0,h();return}c.startTime=String(Pe(1,l[0])),c.endTime=String(Pe(1,l[1])),h()}const ul=()=>{c.sn=null,h()},dl=fe.debounce(e=>{c.sn=e||void 0,h()},300);Hl(async()=>{ae.userInfo.usertype!==7&&await We(),await h(),await Xe()});const B=ze({props:{value:[String,Number],onUpdateValue:Function},setup(e){const l=x(!1),r=x(null),o=x(String(e.value)),y=()=>{o.value=String(e.value??""),l.value=!0,ee(()=>{var i;return(i=r.value)==null?void 0:i.focus()})},p=()=>{var i;(o.value!==void 0||o.value!==null||o.value!=="")&&o.value!=e.value&&((i=e.onUpdateValue)==null||i.call(e,o.value)),l.value=!1};return()=>_("div",{style:"min-height:30px;cursor:pointer;min-width:60px",class:"flex items-center justify-center whitespace-break-spaces",onClick:y},l.value?_(Z,{ref:r,value:o.value,type:"textarea",rows:2,onUpdateValue:i=>o.value=i,onBlur:p}):e.value||"--")}}),Le=ze({props:{value:[String,Number],options:{type:Array,required:!0},onUpdateValue:Function},setup(e){const l=x(!1),r=x(null),o=x(e.value),y=()=>{o.value=e.value,l.value=!0,ee(()=>{var i,v;(v=(i=r.value)==null?void 0:i.focus)==null||v.call(i)})},p=i=>{var v;o.value=i,(i!==void 0||i!==null)&&i!==e.value&&((v=e.onUpdateValue)==null||v.call(e,i)),l.value=!1};return()=>{var i,v;return _("div",{style:"height:100%;cursor:pointer;width:100%",class:"flex items-center justify-center",onClick:y},l.value?_(R,{ref:r,value:o.value,options:e.options,size:"small",style:"width:150px","onUpdate:value":p,placeholder:"请选择",onBlur:()=>l.value=!1}):(v=(i=e.options)==null?void 0:i.find(b=>b.value==e.value))!=null&&v.label?t(nt,{type:"info"},{default:()=>{var b,j;return[(j=(b=e.options)==null?void 0:b.find($=>$.value==e.value))==null?void 0:j.label]}}):"--")}}}),H=x(!1),z=J({id:[],type:"",password:""});async function ol(e){z.id=[e],z.type="deleteComp",z.password="",H.value=!0}async function cl(){z.id=Q.value,z.type="deleteComp",z.password="",H.value=!0}function pl(){H.value=!1,z.id=[],z.type="",z.password=""}async function fl(){var r,o;if(!z.password){(r=window.$message)==null||r.destroyAll(),(o=window.$message)==null||o.error("请输入密码");return}const{data:e,error:l}=await rt(z.id,z.password);l||(H.value=!1,z.id=[],z.type="",z.password="",Bl(),c.page=1,h())}const k=async(e,l,r)=>{var p;const{data:o,error:y}=await be([{id:e.id,[r]:l}]);y||((p=window.$message)==null||p.success("设置成功"),h())},ie=x(!1),f=J({id:0,type:"",value:"",accessory:"",raccessory:""});function re(e,l,r){f.id=e,r=="rdetails"?(f.value=l.rdetails,f.raccessory=l.raccessory):r=="details"?(f.value=l.details,f.accessory=l.accessory):f.value=l,f.type=r,ie.value=!0}const ml=e=>{window.open(e,"_blank")};function De(){ie.value=!1,f.id=0,f.value="",f.type=""}async function vl(){var v,b,j,$,P,C,oe;if(!f.value){(v=window.$message)==null||v.destroyAll(),(b=window.$message)==null||b.error("请选择类型");return}if(f.value==1&&f.type=="details"&&!f.accessory){(j=window.$message)==null||j.destroyAll(),($=window.$message)==null||$.error("请输入配件详情");return}if(f.value==1&&f.type=="rdetails"&&!f.raccessory){(P=window.$message)==null||P.destroyAll(),(C=window.$message)==null||C.error("请输入配件详情");return}const{id:e,value:l,type:r,accessory:o,raccessory:y}=f,{data:p,error:i}=await be([{id:e,[r]:l,accessory:r=="details"&&l==1?o:void 0,raccessory:r=="rdetails"&&l==1?y:void 0}]);i||(De(),(oe=window.$message)==null||oe.success("设置成功"),h())}const{pageData:V,getData:N,nextPage:yl}=Ce(pt),Ue=async e=>{const l=e.currentTarget,r=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&V.data.length<V.total&&(await yl(),await ee(),setTimeout(()=>{l.scrollTop=r}))};N();const Se=async()=>{await N({page:1}),Be()},gl=async e=>{if(!e){Se();return}hl.value=e,await N({fuzzy:e,page:1}),Be()},W=J(new Map),hl=x("");function Be(){const e=[];V.data.forEach(l=>{W.has(l.id)||e.push(l)}),W.forEach(l=>{e.push(l)}),V.data=e}const je=e=>{V.data.forEach(l=>{e.includes(l.id)&&W.set(l.id,l)}),Array.from(W.keys()).forEach(l=>{e.includes(l)||W.delete(l)})},xl=e=>{c.reid=e,h()},zl=async()=>{await N({page:1}),c.reid=null,h()},_l=e=>{if(!e){N({page:1});return}N({fuzzy:e,page:1})},bl=e=>{c.conc=e,h()},Cl=async()=>{c.conc=null,h()},kl=async()=>{c.pending=null,h()},wl=e=>{c.pending=e==1?1:void 0,h()},Fl=e=>{c.conc=e.conc,c.page=1,h()},ue=x(!1),w=J({id:0,reidList:[],copyList:[]}),Ll=async e=>{await N(),ue.value=!0,w.id=e.id,w.reidList=e.list.map(l=>l.reid),w.copyList=JSON.parse(JSON.stringify(e.list)),je(w.reidList)},Te=()=>{ue.value=!1,w.id=0,w.reidList=[]},de=x(!1),Dl=async()=>{var e;if(!de.value)try{const l=w.reidList||[],r=w.copyList.map(p=>p.reid)||[],o=l.filter(p=>!r.includes(p)),y=r.filter(p=>!l.includes(p)).map(p=>{var i;return(i=w.copyList.find(v=>v.reid===p))==null?void 0:i.id}).filter(Boolean);if(de.value=!0,o.length>0){const{data:p,error:i}=await ut(o.map(v=>({afid:w.id,reid:v})))}if(y.length>0){const{data:p,error:i}=await dt({arrIds:y.join(",")})}(e=window.$message)==null||e.success("设置成功"),Te(),h()}catch{}finally{de.value=!1}},{columns:$e,columnChecks:ge,data:Ae,getData:h,loading:Ul,mobilePagination:Sl,searchParams:c}=mt({showTotal:!0,immediate:!1,apiFn:ft,apiParams:{page:1,pageSize:20,limit:20,cid:null,gws:void 0,gws1:[],sn:null,reid:null,conc:null,pending:null,dbtime:null,startAndTimeRange:null,startTime:null,endTime:null,_t:new Date().getTime()},columns:()=>ae.userInfo.usertype!=7?[{type:"selection",align:"center",width:48,fixed:"left",resizable:!0},{title:"网关编号",key:"sn",align:"center",width:180,fixed:"left",resizable:!0},{title:"网关型号",align:"center",key:"model",width:120,resizable:!0},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("是否推送厂家")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"manu",width:200,resizable:!0,render(e){return e.id&&_(Le,{value:e.manu??null,options:[{value:0,label:"否"},{value:1,label:"是"}],onUpdateValue(l){k(e,l,"manu")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("寄回类型")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"details",width:200,resizable:!0,render:e=>t("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[e.details==0||e.details==1?t(Ge,null,[t("div",{class:"w-full",title:`${e.details}`},[t("div",null,[d("类型："),e.details==0?"裸机":"包含配件"]),e.details==1&&t("div",null,[d("配件详情："),e.accessory])]),t(qe,{trigger:"hover",placement:"right"},{trigger:()=>D(t(g,{text:!0,type:"primary",onClick:()=>re(e.id,e,"details")},{default:()=>[t(m,{"local-icon":"edit",class:"font-size-26px ml-5px c-#000"},null)]}),[[U("no-auth"),"aftermarket:update:permission.do"]]),default:()=>L("common.update")})]):e.id&&D(t(g,{text:!0,type:"primary",size:"small",onClick:()=>re(e.id,"","details")},{default:()=>[d("填写")]}),[[U("no-auth"),"aftermarket:update:permission.do"]])])},{key:"devre1",title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("现场照片")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",width:300,resizable:!0,render:e=>t("div",{class:"flex items-center justify-center gap-4px"},[e.devre1||e.devre2||e.devre3?t(Oe,{value:e.devre1&&e.devre2&&e.devre3?3:e.devre1&&e.devre2?2:void 0,color:"#1890ff"},{default:()=>[t("div",{style:{cursor:"pointer"},onClick:()=>he([e.devre1,e.devre2,e.devre3].filter(l=>l),0)},[t(_e,{width:70,src:e.devre1||e.devre2||e.devre3,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)])]}):null,e.id&&t("div",null,[!e.devre1&&!e.devre2&&!e.devre3&&e.id&&D(t(g,{text:!0,size:"small",type:"primary",onClick:()=>I(e,"sceneImg")},{default:()=>[t(m,{"local-icon":"upload",class:"font-size-26px ml-5px c-#000"},null)]}),[[U("no-auth"),"aftermarket:update:permission.do"]]),(e.devre1||e.devre2||e.devre3)&&D(t(g,{text:!0,size:"small",type:"primary",onClick:()=>I(e,"sceneImg"),style:{marginLeft:"5px"}},{default:()=>[t(m,{"local-icon":"edit",class:"font-size-26px ml-5px c-#000"},null)]}),[[U("no-auth"),"aftermarket:update:permission.do"]])])])},{key:"devre4",title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("现场视频")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",width:300,resizable:!0,render:e=>t("div",{class:"flex items-center justify-center gap-4px"},[e.devre4?t("video",{src:e.devre4,style:{height:"70px",width:"100%",cursor:"pointer",objectFit:"cover"},onClick:()=>ml(e.devre4)},null):null,t("div",null,[!e.devre4&&e.id&&D(t(g,{text:!0,size:"small",type:"primary",onClick:()=>I(e,"video")},{default:()=>[t(m,{"local-icon":"upload",class:"font-size-26px ml-5px c-#000"},null)]}),[[U("no-auth"),"aftermarket:update:permission.do"]]),e.devre4&&D(t(g,{text:!0,size:"small",type:"primary",onClick:()=>I(e,"video"),style:{marginLeft:"5px"}},{default:()=>[t(m,{"local-icon":"edit",class:"font-size-26px ml-5px c-#000"},null)]}),[[U("no-auth"),"aftermarket:update:permission.do"]])])])},{key:"devre5",title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("分析照片")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",width:300,resizable:!0,render:e=>t("div",{class:"flex items-center justify-center gap-4px"},[e.devre5||e.devre6||e.devre7?t(Oe,{value:e.devre5&&e.devre6&&e.devre7?3:e.devre5&&e.devre6?2:void 0,color:"#1890ff"},{default:()=>[t("div",{style:{cursor:"pointer"},onClick:()=>he([e.devre5,e.devre6,e.devre7].filter(l=>l),0)},[t(_e,{width:70,src:e.devre5||e.devre6||e.devre7,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)])]}):null,t("div",null,[!e.devre5&&!e.devre6&&!e.devre7&&e.id&&D(t(g,{size:"small",text:!0,type:"primary",onClick:()=>I(e,"analyze")},{default:()=>[t(m,{"local-icon":"upload",class:"font-size-26px ml-5px c-#000"},null)]}),[[U("no-auth"),"aftermarket:update:permission.do"]]),(e.devre5||e.devre6||e.devre7)&&D(t(g,{size:"small",text:!0,type:"primary",onClick:()=>I(e,"analyze"),style:{marginLeft:"5px"}},{default:()=>[t(m,{"local-icon":"edit",class:"font-size-26px ml-5px c-#000"},null)]}),[[U("no-auth"),"aftermarket:update:permission.do"]])])])},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("网关二维码")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"qrcode",width:300,resizable:!0,ellipsis:{tooltip:!0},render:e=>t("div",{class:"flex items-center justify-center gap-4px"},[e.qrcode?t("div",{style:{cursor:"pointer"},onClick:()=>he([e.qrcode].filter(l=>l),0)},[t(_e,{width:70,src:e.qrcode,previewDisabled:!0,style:{maxHeight:"70px",cursor:"pointer"}},null)]):null,t("div",null,[!e.qrcode&&e.id&&D(t(g,{size:"small",text:!0,type:"primary",onClick:()=>I(e,"qrcode")},{default:()=>[t(m,{"local-icon":"upload",class:"font-size-26px ml-5px c-#000"},null)]}),[[U("no-auth"),"aftermarket:update:permission.do"]]),e.qrcode&&D(t(g,{size:"small",text:!0,type:"primary",onClick:()=>I(e,"qrcode"),style:{marginLeft:"5px"}},{default:()=>[t(m,{"local-icon":"edit",class:"font-size-26px ml-5px c-#000"},null)]}),[[U("no-auth"),"aftermarket:update:permission.do"]])])])},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("故障现象")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"fault",width:200,resizable:!0,render(e){return e.id&&_(B,{value:e.fault||"",onUpdateValue(l){k(e,l,"fault")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("售后原因")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"list",width:200,resizable:!0,render:e=>{var l,r;return t("div",{class:"flex items-center justify-center"},[t("div",{class:"text-left"},[((l=e.list)==null?void 0:l.length)&&e.list.map((o,y)=>o.rs).join("、")]),e.id&&t("div",{onClick:()=>Ll(e)},[t(m,{"local-icon":"setup",class:"font-size-20px ml-5px",style:{cursor:"pointer",color:((r=e.list)==null?void 0:r.length)>0?"#1890ff":""}},null)])])}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("诊断结论")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),width:200,resizable:!0,key:"diagnosis",render(e){return e.id&&_(B,{value:e.diagnosis||"",onUpdateValue(l){k(e,l,"diagnosis")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("临时处理")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"tphand",width:200,resizable:!0,render(e){return e.id&&_(B,{value:e.tphand||"",onUpdateValue(l){k(e,l,"tphand")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("长期改善")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"impv",width:200,resizable:!0,render(e){return e.id&&_(B,{value:e.impv||"",onUpdateValue(l){k(e,l,"impv")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("处理结论")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"conc",width:200,resizable:!0,defaultFilterOptionValue:null,filterOptions:ve,filter:!0,filterMultiple:!1,render(e){return e.id&&_(Le,{value:e.conc??null,options:ve,onUpdateValue(l){k(e,l,"conc")}})}},{title:"处理时长",key:"duration",width:120,resizable:!0,align:"center",render:e=>e.duration&&e.id?t("div",null,[e.conc!==null&&e.conc!==void 0?"总耗时":"已历时",d(" "),e.duration?e.duration+" 天":"--"]):""},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("备注")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"devnotes",width:200,resizable:!0,render(e){return e.id&&_(B,{value:e.devnotes||"",onUpdateValue(l){k(e,l,"devnotes")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("发货信息")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"returnnum",width:200,resizable:!0,render(e){return e.id&&_(B,{value:e.returnnum||"",onUpdateValue(l){k(e,l,"returnnum")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("发货网关编号")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"rsn",width:200,resizable:!0,render(e){return e.id&&_(B,{value:e.rsn||"",onUpdateValue(l){k(e,l,"rsn")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("发货网关型号")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"rmodel",width:200,resizable:!0,render(e){return e.id&&_(B,{value:e.rmodel||"",onUpdateValue(l){k(e,l,"rmodel")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("发货寄件类型")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),key:"rdetails",align:"center",width:200,resizable:!0,render:e=>t("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[e.rdetails==0||e.rdetails==1?t(Ge,null,[t("div",{class:"w-full",title:`${e.rdetails}`},[t("div",null,[d("类型："),e.rdetails==0?"裸机":"包含配件"]),e.rdetails==1&&t("div",null,[d("配件详情："),e.raccessory])]),t(qe,{trigger:"hover",placement:"right"},{trigger:()=>D(t(g,{text:!0,type:"primary",onClick:()=>re(e.id,e,"rdetails")},{default:()=>[t("span",{class:"akar-icons--edit"},null),t(m,{"local-icon":"edit",class:"font-size-26px ml-5px c-#000"},null)]}),[[U("no-auth"),"aftermarket:update:permission.do"]]),default:()=>L("common.update")})]):e.id&&D(t(g,{text:!0,type:"primary",size:"small",onClick:()=>re(e.id,"","rdetails")},{default:()=>[d("填写")]}),[[U("no-auth"),"aftermarket:update:permission.do"]])])},{title:"发货时间",key:"rdbtime",align:"center",width:180,resizable:!0,render:e=>t("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[t("div",{class:"w-full",title:`${e.rdbtime}`},[e.rdbtime])])},{title:"发货人",key:"rcusername",align:"center",width:100,resizable:!0,render:e=>t("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around"}},[t("div",{class:"w-full",title:`${e.rcusername}`},[e.rcusername])])},{key:"operate",title:L("common.operate"),align:"center",width:120,fixed:"right",render:e=>t("div",{class:"flex-center gap-8px"},[t(xt,{onPositiveClick:()=>ol(e.id)},{default:()=>L("common.confirmDelete"),trigger:()=>{let l;return D(t(g,{type:"error",ghost:!0,size:"small"},_t(l=L("common.delete"))?l:{default:()=>[l]}),[[U("no-auth"),"aftermarket:delete:permission.do"]])}})])}]:[{type:"selection",align:"center",width:48,fixed:"left",resizable:!0},{title:"网关编号",key:"sn",align:"center",width:180,fixed:"left",resizable:!0},{title:"网关型号",align:"center",key:"model",width:120,resizable:!0},{title:"售后原因",align:"center",key:"list",width:200,resizable:!0,render:e=>{var l;return t("div",{class:"flex items-center justify-center"},[t("div",{class:"text-left"},[((l=e.list)==null?void 0:l.length)&&e.list.map((r,o)=>r.rs).join("、")])])}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("诊断结论")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",width:200,resizable:!0,key:"diagnosis",ellipsis:{tooltip:!0},render(e){return e.id&&_(B,{value:e.diagnosis||"",onUpdateValue(l){k(e,l,"diagnosis")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("临时处理")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"tphand",width:200,resizable:!0,ellipsis:{tooltip:!0},render(e){return e.id&&_(B,{value:e.tphand||"",onUpdateValue(l){k(e,l,"tphand")}})}},{title:()=>t("div",{class:"flex items-center justify-center"},[t("div",null,[d("长期改善")]),t(m,{"local-icon":"edit",class:"font-size-16px ml-5px"},null)]),align:"center",key:"impv",width:200,resizable:!0,ellipsis:{tooltip:!0},render(e){return e.id&&_(B,{value:e.impv||"",onUpdateValue(l){k(e,l,"impv")}})}}]}),{checkedRowKeys:Q,onDeleted:Bl}=vt(Ae,h),he=(e,l=0)=>{ke.value=e,te.value=l,me.value=!0},jl=e=>{te.value=e},X=x(!1),s=J({id:0,type:"",analyzeFileList:[]});function I(e,l){console.log(e,s,"row"),s.analyzeFileList=[],s.id=e.id,s.type=l,l==="qrcode"?e.qrcode&&s.analyzeFileList.push({id:"0",name:"0",url:e.qrcode,status:"finished"}):l==="sceneImg"?(e.devre1&&s.analyzeFileList.push({id:"0",name:"0",url:e.devre1,status:"finished"}),e.devre2&&s.analyzeFileList.push({id:"1",name:"1",url:e.devre2,status:"finished"}),e.devre3&&s.analyzeFileList.push({id:"2",name:"2",url:e.devre3,status:"finished"})):l==="video"?e.devre4&&s.analyzeFileList.push({id:"0",name:e.devre4.split("?")[1],url:e.devre4,status:"finished"}):(e.devre5&&s.analyzeFileList.push({id:"0",name:"0",url:e.devre5,status:"finished"}),e.devre6&&s.analyzeFileList.push({id:"1",name:"1",url:e.devre6,status:"finished"}),e.devre7&&s.analyzeFileList.push({id:"2",name:"2",url:e.devre7,status:"finished"})),X.value=!0}function Ie(e){var y,p,i,v;const l=["image/jpeg","image/png","image/jpg","image/x-icon"];console.log("data.file.file",e.file.file);const r=l.includes(e.file.file.type),o=e.file.file.size/1024/1024<100;return r||((y=window.$message)==null||y.destroyAll(),(p=window.$message)==null||p.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片")),o||((i=window.$message)==null||i.destroyAll(),(v=window.$message)==null||v.error("上传图片大小不能超过 100MB")),r&&o}const Y=x(0);async function xe(e){var y,p;Y.value=0;const{file:l,onFinish:r,onError:o}=e;if(!l.file)return r({...l});try{const i=await Re(l.file,l.name,"aftermarket/image",v=>{Y.value=v});i&&(l.url=i,r({...l,url:i}),(y=window.$message)==null||y.destroyAll(),(p=window.$message)==null||p.success("上传成功"),Y.value=0)}catch(i){o(i)}}function Tl(){X.value=!1,s.analyzeFileList=[]}function $l(e){return new Promise((l,r)=>{xe({file:e,onFinish:()=>l(!0),onError:o=>r(o)})})}async function Al(){var i,v,b,j,$,P;console.log(s,"uploadImgForm");let e=[{id:s.id}];const l=s.analyzeFileList;if(await Promise.all([...l.map(C=>$l(C))]),l.some(C=>C.url&&C.url.startsWith("blob:"))){(i=window.$message)==null||i.destroyAll(),(v=window.$message)==null||v.warning("还有文件正在上传或上传失败，请稍后提交");return}if(l.some(C=>!C.url||C.url.trim()==="")){(b=window.$message)==null||b.destroyAll(),(j=window.$message)==null||j.warning("存在上传失败的文件，请重新上传");return}s.type==="qrcode"?s.analyzeFileList.length==0?e[0].qrcode="":e[0].qrcode=s.analyzeFileList[0].url:s.type==="video"?s.analyzeFileList.length==0?e[0].devre4="":e[0].devre4=s.analyzeFileList[0].url:s.type==="sceneImg"?(s.analyzeFileList.length==0&&(e[0].devre1="",e[0].devre2="",e[0].devre3=""),s.analyzeFileList.length==1&&(e[0].devre1=s.analyzeFileList[0].url,e[0].devre2="",e[0].devre3=""),s.analyzeFileList.length==2&&(e[0].devre1=s.analyzeFileList[0].url,e[0].devre2=s.analyzeFileList[1].url,e[0].devre3=""),s.analyzeFileList.length==3&&(e[0].devre1=s.analyzeFileList[0].url,e[0].devre2=s.analyzeFileList[1].url,e[0].devre3=s.analyzeFileList[2].url)):(s.analyzeFileList.length==0&&(e[0].devre5="",e[0].devre6="",e[0].devre7=""),s.analyzeFileList.length==1&&(e[0].devre5=s.analyzeFileList[0].url,e[0].devre6="",e[0].devre7=""),s.analyzeFileList.length==2&&(e[0].devre5=s.analyzeFileList[0].url,e[0].devre6=s.analyzeFileList[1].url,e[0].devre7=""),s.analyzeFileList.length==3&&(e[0].devre5=s.analyzeFileList[0].url,e[0].devre6=s.analyzeFileList[1].url,e[0].devre7=s.analyzeFileList[2].url));const{data:y,error:p}=await be(e);p||(($=window.$message)==null||$.destroyAll(),(P=window.$message)==null||P.success(y.msg||"操作成功"),h(),X.value=!1,s.id=0,s.analyzeFileList=[])}function Il(e){var y,p,i,v;const r=["video/mp4","video/avi","video/mov","video/mpeg"].includes(e.file.file.type),o=e.file.file.size/1024/1024<100;return r||((y=window.$message)==null||y.destroyAll(),(p=window.$message)==null||p.error("格式错误，请上传视频！")),o||((i=window.$message)==null||i.destroyAll(),(v=window.$message)==null||v.error("上传视频大小不能超过 100MB！")),r&&o}async function El(e){const{file:l,onFinish:r,onError:o}=e;new FormData().append("multipartFile",l.file);try{const p=await Re(l.file,l.name,"aftermarket/image/",i=>{});p&&(r({...l,url:p}),s.analyzeFileList[0].url=p)}catch(p){o(p)}}const Vl=x(window.innerHeight-390);return(e,l)=>{const r=gt,o=ht,y=ql,p=Gl,i=Kl,v=yt,b=Jl,j=Wl,$=Rl,P=Ql,C=Xl,oe=Yl,ce=Zl,pe=tt,Ee=lt,M=et,Nl=at;return F(),Ml("div",zt,[t(j,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[t(b,{ref:"formRef",model:n(c),"label-placement":"left","label-width":100,"show-feedback":!1},{default:a(()=>[t(v,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[n(ae).userInfo.usertype!==7?(F(),S(r,{key:0,span:"24 s:12 m:6",label:"公司名称",path:"cid"},{default:a(()=>[t(n(R),{filterable:"",clearable:"",value:n(c).cid,"onUpdate:value":[l[0]||(l[0]=u=>n(c).cid=u),il],placeholder:"请选择公司名称","label-field":"comp","value-field":"id",onClear:Fe,onSearch:nl,onBlur:sl,options:G.value,onScroll:Ke},null,8,["value","options"])]),_:1})):A("",!0),t(r,{span:"24 s:12 m:6",label:"网关编号",path:"sn"},{default:a(()=>[t(n(Z),{clearable:"",value:n(c).sn,"onUpdate:value":[l[1]||(l[1]=u=>n(c).sn=u),n(dl)],onClear:ul,placeholder:"请输入网关编号"},null,8,["value","onUpdate:value"])]),_:1}),t(r,{span:"24 s:12 m:6",label:"网关型号",path:"gws"},{default:a(()=>[t(n(R),{clearable:"",filterable:"",multiple:"",value:n(c).gws1,"onUpdate:value":[l[2]||(l[2]=u=>n(c).gws1=u),n(ll)],placeholder:"请选择网关型号","label-field":"label","value-field":"value",options:K.value,onSearch:el,onBlur:tl,onScroll:Ye,onClear:we},null,8,["value","options","onUpdate:value"])]),_:1}),t(r,{span:"24 s:12 m:6",label:"售后原因",path:"reid"},{default:a(()=>[t(n(R),{value:n(c).reid,"onUpdate:value":[l[3]||(l[3]=u=>n(c).reid=u),xl],clearable:"",filterable:"","label-field":"rs","value-field":"id",options:n(V).data,onScroll:Ue,onClear:zl,onSearch:_l,placeholder:"请选择售后原因"},null,8,["value","options"])]),_:1}),n(ae).userInfo.usertype!==7?(F(),S(r,{key:1,span:"24 s:12 m:6",label:"处理结论",path:"conc"},{default:a(()=>[t(n(R),{value:n(c).conc,"onUpdate:value":[l[4]||(l[4]=u=>n(c).conc=u),bl],clearable:"",options:ve,onClear:Cl,placeholder:"请选择处理结论"},null,8,["value","options"])]),_:1})):A("",!0),t(r,{span:"24 s:12 m:4",label:"待厂家处理",path:"pending"},{default:a(()=>[t(n(R),{value:n(c).pending,"onUpdate:value":[l[5]||(l[5]=u=>n(c).pending=u),wl],clearable:"",options:[{label:"待处理",value:1},{label:"全部",value:0}],onClear:kl,placeholder:"请选择"},null,8,["value"])]),_:1}),t(r,{span:"24 s:12 m:8",label:"起止时间"},{default:a(()=>[t(o,{value:n(c).startAndTimeRange,"onUpdate:value":l[6]||(l[6]=u=>n(c).startAndTimeRange=u),type:"datetimerange",clearable:"",shortcuts:Me,"onUpdate:formattedValue":rl},null,8,["value"])]),_:1}),t(r,{span:"24 s:12 m:5"},{default:a(()=>[t(i,{class:"w-full"},{default:a(()=>[n(He)("aftermarket:select:permission.do")?(F(),S(n(g),{key:0,ghost:"",onClick:n(h)},{icon:a(()=>[t(y,{class:"text-icon"})]),default:a(()=>[l[24]||(l[24]=d(" "+T("查询")))]),_:1,__:[24]},8,["onClick"])):A("",!0),n(He)("aftermarket:delete:permission.do")?(F(),S(n(g),{key:1,type:"error",disabled:n(Q).length===0,onClick:cl},{icon:a(()=>[t(p,{class:"text-icon"})]),default:a(()=>[l[25]||(l[25]=d(" "+T("批量删除")))]),_:1,__:[25]},8,["disabled"])):A("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(j,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t(i,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>l[26]||(l[26]=[Ne("div",null,"售后设备",-1)])),_:1,__:[26]})]),"header-extra":a(()=>[t(i,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[t($,{columns:n(ge),"onUpdate:columns":l[7]||(l[7]=u=>Ve(ge)?ge.value=u:null),ctype:4},null,8,["columns"])]),_:1})]),default:a(()=>[t(P,{"checked-row-keys":n(Q),"onUpdate:checkedRowKeys":l[8]||(l[8]=u=>Ve(Q)?Q.value=u:null),columns:n($e),data:n(Ae),size:"small",loading:n(Ul),remote:"","max-height":Vl.value,"scroll-x":n($e).reduce((u,Pl)=>u+(Pl.width||100),0),"row-key":u=>u.id,pagination:n(Sl),class:"sm:h-full",striped:"","onUpdate:filters":Fl},null,8,["checked-row-keys","columns","data","loading","max-height","scroll-x","row-key","pagination"])]),_:1}),t(ce,{show:X.value,"onUpdate:show":l[12]||(l[12]=u=>X.value=u),title:s.type==="qrcode"?"二维码上传":s.type==="sceneImg"?"现场照片上传":s.type==="video"?"现场视频上传":"分析照片上传",preset:"card",class:"w-800px"},{footer:a(()=>[t(i,{justify:"end"},{default:a(()=>[t(n(g),{size:"small",class:"mt-16px",onClick:Tl},{default:a(()=>[d(T(n(L)("common.cancel")),1)]),_:1}),t(n(g),{type:"primary",size:"small",class:"mt-16px",onClick:Al},{default:a(()=>[d(T(n(L)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[s.type==="qrcode"?(F(),S(C,{key:0,multiple:"",max:1,"file-list":s.analyzeFileList,"onUpdate:fileList":l[9]||(l[9]=u=>s.analyzeFileList=u),"list-type":"image-card","default-upload":!1,onBeforeUpload:Ie,"custom-request":xe},{default:a(()=>l[27]||(l[27]=[d(" 点击上传 ")])),_:1,__:[27]},8,["file-list"])):s.type==="video"?(F(),S(C,{key:1,"file-list":s.analyzeFileList,"onUpdate:fileList":l[10]||(l[10]=u=>s.analyzeFileList=u),"default-upload":!1,onBeforeUpload:Il,max:1,"custom-request":El},{default:a(()=>[t(n(g),{type:"primary"},{default:a(()=>l[28]||(l[28]=[d(" 上传视频 ")])),_:1,__:[28]})]),_:1},8,["file-list"])):(F(),S(C,{key:2,multiple:"",max:3,"file-list":s.analyzeFileList,"onUpdate:fileList":l[11]||(l[11]=u=>s.analyzeFileList=u),"list-type":"image-card",onBeforeUpload:Ie,"default-upload":!1,"custom-request":xe},{default:a(()=>l[29]||(l[29]=[d(" 点击上传 ")])),_:1,__:[29]},8,["file-list"])),Ne("div",null,[Y.value?(F(),S(oe,{key:0,type:"line",percentage:Y.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):A("",!0)])]),_:1},8,["show","title"]),t(ce,{show:ie.value,"onUpdate:show":l[17]||(l[17]=u=>ie.value=u),title:f.type=="rdetails"?"设备发货网关寄回类型":f.type=="details"?"寄回类型":"",preset:"card",class:"w-600px"},{footer:a(()=>[t(i,{justify:"end"},{default:a(()=>[t(n(g),{size:"small",class:"mt-16px",onClick:De},{default:a(()=>[d(T(n(L)("common.cancel")),1)]),_:1}),t(n(g),{type:"primary",size:"small",class:"mt-16px",onClick:vl},{default:a(()=>[d(T(n(L)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[f.type==="details"?(F(),S(b,{key:0,ref:"formRef",model:f,"label-placement":"left"},{default:a(()=>[t(M,{label:"设备寄回类型",path:"value"},{default:a(()=>[t(Ee,{value:f.value,"onUpdate:value":l[13]||(l[13]=u=>f.value=u),name:"radiogroup"},{default:a(()=>[t(i,null,{default:a(()=>[t(pe,{value:0},{default:a(()=>l[30]||(l[30]=[d("仅裸机")])),_:1,__:[30]}),t(pe,{value:1},{default:a(()=>l[31]||(l[31]=[d("含配件")])),_:1,__:[31]})]),_:1})]),_:1},8,["value"])]),_:1}),f.value==1?(F(),S(M,{key:0,label:"配件详情",path:"accessory"},{default:a(()=>[t(n(Z),{value:f.accessory,"onUpdate:value":l[14]||(l[14]=u=>f.accessory=u),placeholder:"请输入配件详情",clearable:""},null,8,["value"])]),_:1})):A("",!0)]),_:1},8,["model"])):A("",!0),f.type==="rdetails"?(F(),S(b,{key:1,ref:"formRef",model:f,"label-placement":"left"},{default:a(()=>[t(M,{label:"设备发货网关寄回类型",path:"value"},{default:a(()=>[t(Ee,{value:f.value,"onUpdate:value":l[15]||(l[15]=u=>f.value=u),name:"radiogroup"},{default:a(()=>[t(i,null,{default:a(()=>[t(pe,{value:0},{default:a(()=>l[32]||(l[32]=[d("仅裸机")])),_:1,__:[32]}),t(pe,{value:1},{default:a(()=>l[33]||(l[33]=[d("含配件")])),_:1,__:[33]})]),_:1})]),_:1},8,["value"])]),_:1}),f.value==1?(F(),S(M,{key:0,label:"发货配件详情",path:"raccessory"},{default:a(()=>[t(n(Z),{value:f.raccessory,"onUpdate:value":l[16]||(l[16]=u=>f.raccessory=u),placeholder:"请输入发货配件详情",clearable:""},null,8,["value"])]),_:1})):A("",!0)]),_:1},8,["model"])):A("",!0)]),_:1},8,["show","title"]),t(ce,{show:H.value,"onUpdate:show":l[19]||(l[19]=u=>H.value=u),title:"二次确认",preset:"card",class:"w-600px"},{footer:a(()=>[t(i,{justify:"end"},{default:a(()=>[t(n(g),{size:"small",class:"mt-16px",onClick:pl},{default:a(()=>[d(T(n(L)("common.cancel")),1)]),_:1}),t(n(g),{type:"primary",size:"small",class:"mt-16px",onClick:fl},{default:a(()=>[d(T(n(L)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(b,{ref:"formRef",model:z,"label-placement":"left"},{default:a(()=>[t(M,{label:"密码",path:"password",required:""},{default:a(()=>[t(n(Z),{type:"password","show-password-on":"mousedown",value:z.password,"onUpdate:value":l[18]||(l[18]=u=>z.password=u),placeholder:"请输入密码",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),t(ce,{show:ue.value,"onUpdate:show":l[21]||(l[21]=u=>ue.value=u),title:"设置售后原因",preset:"card",class:"w-600px"},{footer:a(()=>[t(i,{justify:"end"},{default:a(()=>[t(n(g),{size:"small",class:"mt-16px",onClick:Te},{default:a(()=>[d(T(n(L)("common.cancel")),1)]),_:1}),t(n(g),{type:"primary",size:"small",class:"mt-16px",loading:de.value,onClick:Dl},{default:a(()=>[d(T(n(L)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:a(()=>[t(b,{ref:"formRef",model:w,"label-placement":"left"},{default:a(()=>[t(M,{label:"售后原因",path:"value",required:""},{default:a(()=>[t(n(R),{value:w.reidList,"onUpdate:value":[l[20]||(l[20]=u=>w.reidList=u),je],multiple:"",clearable:"",filterable:"","label-field":"rs","value-field":"id",options:n(V).data,onScroll:Ue,onClear:Se,onSearch:gl,placeholder:"请选择售后原因"},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),t(Nl,{show:me.value,"onUpdate:show":l[22]||(l[22]=u=>me.value=u),current:te.value,"onUpdate:current":[l[23]||(l[23]=u=>te.value=u),jl],"src-list":ke.value},null,8,["show","current","src-list"])])}}}),At=it(bt,[["__scopeId","data-v-a2eaf438"]]);export{At as default};
