import{_ as Q}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Db4-USgA.js";import{_ as X}from"./refresh-wIPyYUe8.js";import{d as F,q as K,v as Y,s as q,L as E,o as O,c as J,w as n,g as e,M as B,h as y,t as V,i as o,$ as T,N as Z,A as ee,B as R,E as I,D as te,aa as W,j as x,y as ae,f as k,S as H,F as ne,az as oe,aA as se,aw as le,a0 as ie,V as re,r as pe,aV as ce,e as ue,ad as U,bs as de,ay as _e}from"./index-hw7QOW1T.js";import{a as me,b as fe,c as G,d as ve}from"./reportForm-dJP0aGpo.js";import{u as ge}from"./table-BKuYvkWU.js";import{_ as he}from"./round-search-Wdn6cQPo.js";import{_ as ye}from"./round-refresh-CTnCderg.js";import{_ as xe}from"./FormItemGridItem-BJtyHf3C.js";import{_ as we}from"./Grid-Cw6tbggG.js";import{T as be}from"./task-BJm1fbC1.js";import{f as ke,a as $e,_ as Ce,b as Se,c as Ne,d as Re}from"./templateDataFilter-D0cIayj3.js";import{_ as j}from"./Popconfirm-BEEFAPPE.js";import{_ as ze}from"./DataTable-qeqEjtEf.js";import"./setting-outlined-6-9KjY3w.js";import"./index-BS8KoN7o.js";import"./installCanvasRenderer-iCPGNWhM.js";import"./Forward-iJK0D6Xc.js";const De=F({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search"],["update:model"]),setup(d,{emit:_}){const m=_,{formRef:f,restoreValidation:w}=Y(),s=q(d,"model"),$=()=>{s.value.fuzzy="",v()};async function l(){await w(),m("reset")}async function v(){m("search")}return(z,p)=>{const C=ee,g=xe,S=ye,u=R,N=he,b=I,D=we,A=te,L=W,M=E("no-space");return O(),J(L,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(A,{ref_key:"formRef",ref:f,model:s.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Z(v,["enter"])},{default:n(()=>[e(D,{responsive:"screen","item-responsive":""},{default:n(()=>[e(g,{span:"24 s:12 m:6",label:"实例名称",path:"alatype",class:"pr-24px"},{default:n(()=>[B(e(C,{autofocus:"",value:s.value.fuzzy,"onUpdate:value":p[0]||(p[0]=a=>s.value.fuzzy=a),placeholder:"请输入实例名称关键字",clearable:"",onClear:$},null,8,["value"]),[[M]])]),_:1}),e(g,{span:"24 m:6",class:"pr-24px"},{default:n(()=>[e(b,{class:"w-full"},{default:n(()=>[e(u,{onClick:l},{icon:n(()=>[e(S,{class:"text-icon"})]),default:n(()=>[y(" "+V(o(T)("common.reset")),1)]),_:1}),e(u,{type:"primary",ghost:"",onClick:v},{icon:n(()=>[e(N,{class:"text-icon"})]),default:n(()=>[y(" "+V(o(T)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Pe=d=>(oe("data-v-699ae61e"),d=d(),se(),d),Ee=Pe(()=>k("span",{class:"mr-20px"},"报表预览",-1)),Be={title:"导出PDF"},Ie={title:"导出Word"},Te={title:"导出Excel"},Ae=F({name:"reportPreview",__name:"reportPreview",props:K({data:{},rtype:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(d){const _=d,m=q(d,"visible"),f=x(),w=()=>{_.rtype==0?f.value=ke(_.data,void 0):_.rtype==1&&(f.value=$e(_.data,_.data.time))};ae(m,()=>{m.value&&w()});const s=x();return($,l)=>{const v=Ce,z=Se,p=Ne,C=Re,g=H,S=ne;return O(),J(S,{show:m.value,"onUpdate:show":l[3]||(l[3]=u=>m.value=u),preset:"card",class:"w-1000px"},{header:n(()=>[Ee,k("span",Be,[e(v,{class:"text-32px c-#d63031 cursor-pointer",onClick:l[0]||(l[0]=u=>s.value.toPdf("test"))})]),k("span",Ie,[e(z,{class:"text-32px c-#1e90ff cursor-pointer",onClick:l[1]||(l[1]=u=>s.value.toWord("test"))})]),k("span",Te,[e(p,{class:"text-32px c-#15703d cursor-pointer",onClick:l[2]||(l[2]=u=>s.value.toExcel("test"))})])]),default:n(()=>[e(g,{class:"max-h-600px"},{default:n(()=>[e(C,{ref_key:"filePreviewExportRef",ref:s,width:800,data:f.value},null,8,["data"])]),_:1})]),_:1},8,["show"])}}}),Le=le(Ae,[["__scopeId","data-v-699ae61e"]]),Me={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ve=k("div",{style:{display:"flex","align-items":"center"}},[k("div",null,"报表实例")],-1),nt=F({name:"reportmanagement_reportlist",__name:"index",setup(d){const _=ie(),{columns:m,columnChecks:f,data:w,getData:s,loading:$,mobilePagination:l,searchParams:v,resetSearchParams:z}=ge({apiFn:me,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:a=>!0,renderExpand:a=>e("div",{class:"detailList"},[e(H,{style:"max-height: 320px"},{default:()=>[g.value.length>0?g.value.map((t,i)=>e(I,{justify:"space-between",style:{marginBottom:"5px",padding:"0px 50px 5px 50px",borderBottom:i!==g.value.length-1?"1px dashed #ccc":"none"},key:t.sn},{default:()=>[e("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[t.sn]),e(I,null,{default:()=>[B(e(R,{type:"info",size:"small",ghost:!0,onClick:()=>A(t.sn,a.rtype)},{default:()=>[y("查看")]}),[[E("no-auth"),"sys.report.instance.select"]]),e(j,{onPositiveClick:()=>M(t.sn,a.rtype,a.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>B(e(R,{type:"error",size:"small",ghost:!0},{default:()=>[y("删除")]}),[[E("no-auth"),"sys.report.instance.delete"]])})]})]})):e("div",{style:{textAlign:"center",padding:"10px"}},[y("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:a=>{var t;return e("div",null,[(t=re(be).find(i=>i.value===a.rtype))==null?void 0:t.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:T("common.operate"),align:"center",width:160,render:a=>e("div",{class:"flex-center gap-8px"},[e(j,{onPositiveClick:()=>L(a.tid,a.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>B(e(R,{type:"primary",ghost:!0,size:"small"},{default:()=>[y("清空")]}),[[E("no-auth"),"sys.report.instance.delete"]])})])}]}),p=x([]),C=a=>{p.value=[a[a.length-1]],p.value[0]&&u()},g=x([]),S=pe({page:1,limit:10}),u=async()=>{const a=JSON.parse(JSON.stringify(w.value)).find(r=>r.tid===p.value[0]),{data:t,error:i}=await ve({tid:p.value[0],page:S.page,limit:Number(a.num)||10});i||(g.value=t.list,_e(()=>{const r=document.querySelector(".detailList");if(r){const{height:c}=r.getBoundingClientRect();r.animate([{height:"0px"},{height:`${c}px`}],{duration:300,easing:"linear"})}}))},N=x(!1),b=x({}),D=x(0),A=async(a,t)=>{const{data:i,error:r}=await fe({name:a,type:t,tid:p.value[0]});D.value=t,r||(N.value=!0,b.value=JSON.parse(i),b.value.baseInfo=b.value.baseInfo.map(c=>({...c,dbtime:ce(1,c.dbtime)})))},L=async(a,t)=>{var c;const{data:i,error:r}=await G({tid:a,type:t});r||((c=window.$message)==null||c.success("清空成功"),s())},M=async(a,t,i)=>{var P;const{data:r,error:c}=await G({fname:a,type:t,tid:i});c||((P=window.$message)==null||P.success("删除成功"),s(),u())};return(a,t)=>{const i=X,r=Q,c=ze,P=W;return O(),ue("div",Me,[e(De,{model:o(v),"onUpdate:model":t[0]||(t[0]=h=>U(v)?v.value=h:null),onReset:o(z),onSearch:o(s)},null,8,["model","onReset","onSearch"]),e(P,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[Ve]),"header-extra":n(()=>[e(o(I),null,{default:n(()=>[e(o(R),{size:"small",onClick:t[1]||(t[1]=h=>o(s)())},{icon:n(()=>[e(i,{class:de(["text-icon",{"animate-spin":o($)}])},null,8,["class"])]),default:n(()=>[y(" "+V(o(T)("common.refresh")),1)]),_:1}),e(r,{columns:o(f),"onUpdate:columns":t[2]||(t[2]=h=>U(f)?f.value=h:null)},null,8,["columns"])]),_:1})]),default:n(()=>[e(c,{columns:o(m),data:o(w),size:"small","flex-height":!o(_).isMobile,"scroll-x":962,loading:o($),remote:"","row-key":h=>h.tid,pagination:o(l),class:"sm:h-full","expanded-row-keys":p.value,"onUpdate:expandedRowKeys":C},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),e(Le,{visible:N.value,"onUpdate:visible":t[3]||(t[3]=h=>N.value=h),data:b.value,rtype:D.value},null,8,["visible","data","rtype"])]),_:1})])}}});export{nt as default};
