import{l as W}from"./lodash-3yLO-712.js";import{d as q,q as M,j as g,v as Y,s as Q,o as F,c as X,w as i,g as l,i as f,$ as A,V as Z,h as N,t as H,N as ee,ax as ae,ao as k,ap as V,Y as te,A as le,B as z,E as j,D as ne,aa as J,a0 as oe,r as B,an as re,e as ie,ae as se,aT as ue,av as de}from"./index-CXJ7AQei.js";import{_ as pe}from"./round-search-Dcl_LlCU.js";import{_ as ce}from"./round-refresh-ChJ-oMzM.js";import{u as ve}from"./usePageData-Bzg7vwI1.js";import{a as me,T as R}from"./basicconf-C_UMvv8C.js";import{f as ge}from"./system-manage-Cs9PpbHU.js";import{_ as fe}from"./DatePicker-BbEdDwnV.js";import{_ as _e}from"./Cascader-DbqhP5gb.js";import{_ as Ie}from"./FormItemGridItem-BdFekX4I.js";import{_ as he}from"./Grid-cHbn5tWF.js";import{_ as ye}from"./originlogInfo.vue_vue_type_script_setup_true_lang-Cx4XS0Hp.js";import{e as Se}from"./exportExcel-CZ2AjtLT.js";import{q as Ae,y as we}from"./events-VNBaX_i2.js";import{b as be,f as xe,a as Oe}from"./common-BSJJxQ1c.js";import{_ as Ee}from"./DataTable-ByDnShuV.js";import"./TimePicker-Dt0Efvi5.js";import"./defineProperty-DOQzHvPs.js";import"./Forward-lIzUVZHl.js";import"./DescriptionsItem-BWJG-4vE.js";import"./CollapseItem-CSPYba6r.js";const ke=q({name:"FormSearch",__name:"form-search",props:M(["eventsTypeDataList","LogSourceDeviceList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:M(["search"],["update:model"]),setup(_,{emit:C}){const h=_,D=C;g(0);const{formRef:G,restoreValidation:w}=Y(),e=Q(_,"model"),{pageData:L,getData:U,nextPage:T}=ve(ge),P=async u=>{const o=u.currentTarget;o.scrollTop+o.offsetHeight>=o.scrollHeight&&L.data.length<L.total&&T()};U();async function $(){await w(),e.value.etypeid=null,e.value.elevel=null,e.value.rtime=null,e.value.user=null,e.value.logodid=null,e.value.target=null,e.value.startAndEndOriginIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.expression=null,e.value.startOriginIp=null,e.value.endOriginIp=null,e.value.startAimOriginIp=null,e.value.endAimOriginIp=null,e.value.startSourceIp=null,e.value.endSourceIp=null,ae(()=>{D("search")})}async function v(){var u,o,r,s,m,b,p,y,S,x,O,E;if(e.value.startAndEndOriginIp&&e.value.startAndEndOriginIp.length>0?(e.value.startOriginIp=e.value.startAndEndOriginIp[0]||null,e.value.endOriginIp=e.value.startAndEndOriginIp[1]||null):(e.value.startOriginIp=null,e.value.endOriginIp=null),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimOriginIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimOriginIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimOriginIp=null,e.value.endAimOriginIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=null,e.value.endSourceIp=null),e.value.startOriginIp&&!k(e.value.startOriginIp)||e.value.endOriginIp&&!k(e.value.endOriginIp))return(u=window.$message)==null||u.destroyAll(),(o=window.$message)==null||o.error("请输入正确的IP地址"),!1;if(e.value.startOriginIp&&e.value.endOriginIp&&V(e.value.startOriginIp,e.value.endOriginIp)>0)return(r=window.$message)==null||r.destroyAll(),(s=window.$message)==null||s.error("起始IP不能大于终止IP"),!1;if(e.value.startAimOriginIp&&!k(e.value.startAimOriginIp)||e.value.endAimOriginIp&&!k(e.value.endAimOriginIp))return(m=window.$message)==null||m.destroyAll(),(b=window.$message)==null||b.error("请输入正确的IP地址"),!1;if(e.value.startAimOriginIp&&e.value.endAimOriginIp&&V(e.value.startAimOriginIp,e.value.endAimOriginIp)>0)return(p=window.$message)==null||p.destroyAll(),(y=window.$message)==null||y.error("起始IP不能大于终止IP"),!1;if(e.value.startSourceIp&&!k(e.value.startSourceIp)||e.value.endSourceIp&&!k(e.value.endSourceIp))return(S=window.$message)==null||S.destroyAll(),(x=window.$message)==null||x.error("请输入正确的IP地址"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&V(e.value.startSourceIp,e.value.endSourceIp)>0)return(O=window.$message)==null||O.destroyAll(),(E=window.$message)==null||E.error("起始IP不能大于终止IP"),!1;D("search")}return(u,o)=>{const r=_e,s=Ie,m=te,b=fe,p=le,y=ce,S=z,x=pe,O=j,E=he,a=ne,n=J;return F(),X(n,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[l(a,{ref_key:"formRef",ref:G,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ee(v,["enter"])},{default:i(()=>[l(E,{responsive:"screen","item-responsive":""},{default:i(()=>[l(s,{span:"24 s:24 m:6",label:"事件类型",path:"etypeid",class:"pr-24px"},{default:i(()=>[l(r,{value:e.value.etypeid,"onUpdate:value":o[0]||(o[0]=t=>e.value.etypeid=t),clearable:"",placeholder:"请选择事件","max-tag-count":1,options:h.eventsTypeDataList,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),l(s,{span:"24 s:24 m:6",label:f(A)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:i(()=>[l(m,{filterable:"",clearable:"",placeholder:f(A)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[o[1]||(o[1]=t=>e.value.elevel=t),v],"reset-menu-on-options-change":!1,options:f(Z)(f(me))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),l(s,{span:"24 s:24 m:6",label:"接收时间",path:"rtime",class:"pr-24px"},{default:i(()=>[l(b,{placeholder:"请选择接收时间","formatted-value":e.value.rtime,"onUpdate:formattedValue":o[2]||(o[2]=t=>e.value.rtime=t),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:"",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),l(s,{span:"24 s:24 m:6",label:"用户",path:"user",class:"pr-24px"},{default:i(()=>[l(m,{value:e.value.user,"onUpdate:value":o[3]||(o[3]=t=>e.value.user=t),placeholder:"请选择用户",clearable:"",filterable:"","value-field":"id","label-field":"username",options:f(L).data,"reset-menu-on-options-change":!1,onScroll:P},null,8,["value","options"])]),_:1}),l(s,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndOriginIp",class:"pr-24px mt-10px"},{default:i(()=>[l(p,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndOriginIp,"onUpdate:value":o[4]||(o[4]=t=>e.value.startAndEndOriginIp=t)},null,8,["value"])]),_:1}),l(s,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px mt-10px"},{default:i(()=>[l(p,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":o[5]||(o[5]=t=>e.value.startAndEndAimSourceIp=t)},null,8,["value"])]),_:1}),l(s,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSourceIp",class:"pr-24px mt-10px"},{default:i(()=>[l(p,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":o[6]||(o[6]=t=>e.value.startAndEndSourceIp=t)},null,8,["value"])]),_:1}),l(s,{span:"24 s:24 m:6",label:"日志源设备",path:"logodid",class:"pr-24px mt-10px"},{default:i(()=>[l(r,{disabled:h.logsoudev,value:e.value.logodid,"onUpdate:value":[o[7]||(o[7]=t=>e.value.logodid=t),v],placeholder:"请选择日志源设备",options:h.LogSourceDeviceList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["disabled","value","options"])]),_:1}),l(s,{span:"24 s:24 m:6",label:"目标对象",path:"target",class:"pr-24px mt-10px"},{default:i(()=>[l(p,{placeholder:"请输入目标对象",value:e.value.target,"onUpdate:value":o[8]||(o[8]=t=>e.value.target=t),clearable:""},null,8,["value"])]),_:1}),l(s,{span:"24 m:8",class:"pr-24px mt-10px"},{default:i(()=>[l(O,{class:"w-full"},{default:i(()=>[l(S,{onClick:$},{icon:i(()=>[l(y,{class:"text-icon"})]),default:i(()=>[N(" "+H(f(A)("common.reset")),1)]),_:1}),l(S,{type:"primary",ghost:"",onClick:v},{icon:i(()=>[l(x,{class:"text-icon"})]),default:i(()=>[N(" "+H(f(A)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),De={class:"min-h-500px flex-col-stretch overflow-hidden lt-sm:overflow-auto"};function Le(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!se(_)}const Te=q({name:"eventalarm_originlog",__name:"index",props:{logsoudev:{}},setup(_){const C=oe(),h=_,D=g([]);(async()=>{const{data:a,error:n}=await be();n||(D.value=a.map(t=>({...t,id:"+"+t.id,type:t.cname})))})();const w=g([]),e=g([]);async function L(){const{data:a,error:n}=await xe();n||(w.value=a,await U())}async function U(){const{data:a,error:n}=await Oe();if(!n){e.value=a;let t=w.value.concat(a);w.value=ue(t)}}L();const T=g(!1),P=g(),$=g(),v=g(!1),u=B({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),o=[{title:"",key:"key",width:80,render:(a,n)=>`${n+1}`},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"elevel",title:"事件等级",align:"center",width:120,render:a=>{(a.elevel===void 0||a.elevel===null)&&(a.elevel=1);const n={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},t=A(R[a.elevel]);let I={color:n[a.elevel],textColor:"#ffffff",borderColor:n[a.elevel]};return l(re,{size:"small",color:I},Le(t)?t:{default:()=>[t]})}},{key:"cname",title:"设备类别",align:"center",width:180},{key:"type",title:"设备类型",align:"center",width:180},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"sourceip",title:"发生源IP",align:"center",width:180},{key:"prifinallog",title:"日志原文",align:"center",width:240,ellipsis:{tooltip:!0}},{key:"operate",title:A("common.operate"),align:"center",width:100,fixed:"right",render:a=>l("div",{class:"flex-center gap-8px"},[l(z,{type:"info",ghost:!0,size:"small",onClick:()=>S(a)},{default:()=>[N("详情")]})])}],r=g([]),s=async(a=!1)=>{if(!v.value)v.value=!0;else return;v.value=!0,h.logsoudev&&(m.value=!1,u.logodid=h.logsoudev);const{data:n,error:t}=await Ae(u);t||(a?r.value=[...r.value,...n]:r.value=n,v.value=!1)},m=g(!0),b=()=>{r.value=[],u.pageId=void 0,(n=>Object.keys(n).filter(d=>d!=="limit"&&d!=="_t").some(d=>n[d]!==void 0&&n[d]!==""&&n[d]!==null))(u)?m.value=!1:(m.value=!0,y()),s()};s();const p=B({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:n,page:t,pageSize:I,pageCount:d,itemCount:c}){return`已加载${r.value.length}条`+(r.value.length?m.value?` 共计 ${r.value.length>0?c??0:0} 条`:r.value.length>=u.limit?"  预计还有更多":"":"")}});async function y(){const{data:a,error:n}=await we();n||(p.pageCount=20,p.total=Number(a),p.itemCount=Number(a))}y();const S=a=>{P.value=a.id,$.value=a,T.value=!0};function x(a){var n;console.log(a.target.scrollTop,a.target.offsetHeight,a.target.scrollHeight),a.target.scrollTop+a.target.offsetHeight==a.target.scrollHeight&&p.total>((n=r.value)==null?void 0:n.length)&&O()}const O=W.debounce(()=>{var a;if(((a=r.value)==null?void 0:a.length)<p.total){if(u.pageId==r.value[r.value.length-1].id)return;u.pageId=r.value[r.value.length-1].id,s(!0)}},300);async function E(){if(!r.value.length)return;const a=JSON.parse(JSON.stringify(r.value)),n=[];a.forEach(t=>{const I={};o.forEach(d=>{if(t.hasOwnProperty(d.key)){const c=d.key=="elevel"?A(R[t[d.key]]):t[d.key];I[d.title]=c}}),n.push(I)}),Se(n,500,"origin-log"+new Date().getTime())}return(a,n)=>{const t=j,I=Ee,d=J;return F(),ie("div",De,[l(ke,{model:u,"onUpdate:model":n[0]||(n[0]=c=>u=c),onSearch:b,eventsTypeDataList:w.value,LogSourceDeviceList:D.value,class:"mb-16px",logsoudev:h.logsoudev},null,8,["model","eventsTypeDataList","LogSourceDeviceList","logsoudev"]),l(d,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":i(()=>[l(t,null,{default:i(()=>[l(f(z),{type:"primary",size:"small",ghost:"",onClick:E,title:"导出已加载"},{default:i(()=>[N("导出已加载")]),_:1})]),_:1})]),default:i(()=>[l(I,{columns:o,data:r.value,size:"small","flex-height":!f(C).isMobile,loading:v.value,remote:"","row-key":c=>c.id,"virtual-scroll":"","scroll-x":o.reduce((c,K)=>c+K.width,0),pagination:p,class:"sm:h-full",onScroll:x,"max-height":500},null,8,["data","flex-height","loading","row-key","scroll-x","pagination"])]),_:1}),l(ye,{detailVisible:T.value,"onUpdate:detailVisible":n[1]||(n[1]=c=>T.value=c),detailId:P.value,detailInfo:$.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),Ze=de(Te,[["__scopeId","data-v-03fc3a26"]]);export{Ze as default};
