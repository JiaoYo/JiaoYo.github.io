import{_ as at}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BL3fEdXs.js";import{_ as nt}from"./round-delete-BJUCXHh8.js";import{_ as lt}from"./round-add-9JBusyZ3.js";import{_ as ot}from"./correct-WBv1ddoj.js";import{d as Se,ay as Ce,z as Le,D as st,s as C,aL as Be,A as Ie,a as rt,aw as Ee,ax as it,c as v,o as d,w as l,f as a,a3 as ut,b as pe,G as x,M as je,h as r,aM as me,H as L,bh as dt,aI as ct,aH as pt,g as k,aA as mt,b0 as vt,e as ve,t as B,aF as ft,J as ze,B as R,$ as G,a4 as gt,cE as Re,aG as De,cS as _t,c$ as yt,aK as ht,d0 as Ae,d1 as bt,d2 as wt,aC as kt,L as xt,a2 as Me,aN as Ct,i as Dt,F as ke,aO as _e,aD as Nt,I as ce,aP as St,d3 as Fe,cF as zt,n as W,aV as Tt}from"./index-DTejdFLI.js";import{u as Ut,a as $t}from"./table-5sK02S3E.js";import{h as Pe}from"./permission-BeExe-IG.js";import{u as Ne}from"./usePageData-BjjY6agq.js";import{_ as Oe}from"./Grid-U7VbogCl.js";import{_ as Ge}from"./FormItemGridItem-OdWiLkIi.js";import{N as Ft}from"./Cascader-BG1xQJyc.js";import{_ as Pt}from"./round-search-CcVdI1HR.js";import{_ as qt}from"./round-refresh-CFg-lT0v.js";import{N as xe}from"./Popconfirm-BmNh5CYH.js";const Lt={key:0,style:{"margin-left":"20px"}},Bt=["onClick"],It=["onClick"],Et={key:0},jt={style:{display:"flex","justify-content":"space-between"}},Rt=Se({name:"OperateDrawer",__name:"operate-drawer",props:Ce({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Ce(["submitted"],["update:visible"]),setup(I,{emit:ae}){const z=ae,V=Le(),y=I,t=st($());function $(){return{pid:void 0,cid:void 0,contractId:void 0,id:"",devname:"",devmodel:"",devunit:"",devnum:0,notes:"",etype:0,devmanu:"",status:0,manucontact:"",manuinfo:"",devstatus:1,install:1,connectionmode:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const h=C([]),{pageData:b,getData:N,nextPage:H}=Ne(Re),ne=async n=>{const e=n.currentTarget,u=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&b.data.length<b.total&&(await H(),h.value=b.data,await De(),setTimeout(()=>{e.scrollTop=u}))},le=Be.debounce(async n=>{await N({fuzzy:n,page:1}),h.value=b.data},300),K=C(!1),E=C(!1),T=n=>{if(t.pid=null,K.value=!0,E.value=!1,!n){X();return}le(n)},oe=async()=>{K.value&&!E.value&&(await N({page:1}),h.value=b.data,K.value=!1)},X=async()=>{await N({page:1}),h.value=b.data},Y=async()=>{var n,e;await N({fuzzy:V.userInfo.pname,page:1}),t.pid=y.pid?y.pid:(n=b.data[0])==null?void 0:n.id,h.value=b.data,await i(),t.contractId=(e=o.value[0])==null?void 0:e.id,c()},Z=C([]),A=C(),{pageData:M,getData:ee,nextPage:p}=Ne(_t),c=async(n=t.contractId)=>{await ee({pids:n}),A.value=[],Z.value=Array.from(new Set([...Z.value,...M.data])),A.value=M.data.map(e=>({label:e.devname,value:e.id}))},F=async n=>{var e;t.pid=n,await i(),t.contractId=(e=o.value[0])==null?void 0:e.id,await c(),E.value=!0,t.cid=null},o=C([]),i=async()=>{var u;const{data:n,error:e}=await yt({id:t.pid,limit:100,page:1});if((n==null?void 0:n.list.length)==0)return(u=window.$message)==null?void 0:u.warning("该项目没有绑定合同,暂不可添加设备");o.value=n==null?void 0:n.list.map(f=>({value:f.id,label:f.contractname,isLeaf:!1}))},w=C(),P=async n=>{t.cid=n;const e=Z.value.find(u=>u.id==n);t.devname=e==null?void 0:e.devname,t.devnum=e==null?void 0:e.devcount,w.value=e==null?void 0:e.devcount,t.etype=e==null?void 0:e.devtype,t.devmanu=e==null?void 0:e.devmanu,t.notes=e==null?void 0:e.notes,t.devmodel=((e==null?void 0:e.devmodel.length)>64?e==null?void 0:e.devname:e==null?void 0:e.devmodel)||"",t.devunit=e==null?void 0:e.devunit},U=C(!1),q=C(0),_=C([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]);async function se({file:n},e){_.value[e].file=n,_.value[e].name=n.name}const O=C(!1);async function j(){var n,e,u,f;if(!O.value)try{await Ve(),O.value=!0;let D=!0;if(_.value.forEach((g,m)=>{var s,te;const ie=`re${m+1}`,be=`fl${m+1}`,ue=g.name||"",de=((s=g.url)==null?void 0:s.split("?")[1])||((te=g.file)==null?void 0:te.name);(ue&&!de||!ue&&de)&&(D=!1),g.status==="done"&&(t[ie]=ue,t[be]=de)}),!D){(e=(n=window.$message)==null?void 0:n.error)==null||e.call(n,"文件名称和文件地址必须同时存在，不能只填一个");return}U.value=!0;const Q=_.value.filter(g=>g.file),fe=Q.length;for(let g=0;g<fe;g++){q.value=g;const m=Q[g];m.indexText=`${g+1}/${fe}`,m.progress=0,m.status="uploading";try{m.url=await ht(m.file.file,m.file.name,"",ie=>{m.progress=ie}),m.progress=100,m.status="done"}catch{m.status="error"}}if(_.value.forEach((g,m)=>{t[`re${m+1}`]=g.name||"",t[`fl${m+1}`]=g.url||""}),U.value=!1,y.operateType==="edit"){const{data:g,error:m}=await Ae([t]);m||(he(),z("submitted"),(u=window.$message)==null||u.success("修改成功"))}else{const{data:g,error:m}=await bt([{...t}]);m||(he(),z("submitted"),(f=window.$message)==null||f.success("添加成功"))}}catch{}finally{O.value=!1}}async function S(){var n;if(await Y(),_.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}],Object.assign(t,$()),y.operateType==="add"&&(t.pid=y.pid),y.operateType==="edit"&&y.rowData){Object.assign(t,y.rowData),_.value=[];for(let f=1;f<=4;f++){const D=t[`re${f}`],Q=t[`fl${f}`];_.value.push({name:D||"",url:Q||"",status:Q?"finished":"pending"})}w.value=(n=M.data.find(f=>f.id==t.cid))==null?void 0:n.devcount;const{data:e,error:u}=await wt(t.cid);u||o.value.push({value:e.id,label:e.devname,disabled:!0,isLeaf:!0,hidden:!0})}}const{formRef:J,validate:Ve,restoreValidation:He}=Ie(),Ke={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},contractId:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},cid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devmodel:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devnum:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},devunit:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},manucontact:{type:"string",required:!1,trigger:["blur","change"],message:"请输入"},manuinfo:{type:"string",required:!1,trigger:["blur","change"],message:"请输入"},devstatus:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},connectionmode:{type:"string",required:!1,trigger:["blur","change"],message:"请输入"},install:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},devmanu:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},Je=async n=>{var e;await c(n.value),n.children=(e=A.value)==null?void 0:e.map(u=>({label:u.label,value:u.value,isLeaf:!0}))},Qe=rt(()=>({add:"新增设备",edit:"修改设备"})[y.operateType]),re=Ee(I,"visible"),We=async n=>{if(n){await De();const e=document.querySelector(".n-cascader-menu");e&&(e.removeEventListener("scroll",Te),e.addEventListener("scroll",Te))}},ye=C(!1),Xe=C(!0),Te=async n=>{const e=n.target;e.scrollHeight-e.scrollTop-e.clientHeight<10&&!ye.value&&Xe.value&&(ye.value=!0,p(),A.value=M.data.map(f=>({label:f.devname,value:f.id})),ye.value=!1)};it(re,()=>{re.value&&(S(),setTimeout(()=>{const n=document.querySelector(".n-scrollbar-content");n==null||n.scrollTo(0,0)},300),He())});async function Ye(n){if(n)try{const u=await(await fetch(n==null?void 0:n.split("?")[0],{mode:"cors"})).blob(),f=URL.createObjectURL(u),D=document.createElement("a");D.href=f,D.download=n==null?void 0:n.split("?")[1],D.style.display="none",document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(f)}catch(e){console.error("下载失败:",e)}}function he(){re.value=!1}async function Ze(n){return!0}const et=n=>n.hidden?null:n.label,tt=n=>n.option.hidden?null:n.node;return(n,e)=>{const u=Ge,f=Ft,D=pt,Q=ct,fe=kt,g=Oe,m=je,ie=ft,be=ut,ue=ze,de=gt;return d(),v(de,{show:re.value,"onUpdate:show":e[15]||(e[15]=s=>re.value=s),title:Qe.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:l(()=>[a(ue,{justify:"end",size:16},{default:l(()=>[a(r(R),{onClick:he},{default:l(()=>[k(B(r(G)("common.cancel")),1)]),_:1}),a(r(R),{type:"primary",onClick:j,loading:O.value},{default:l(()=>[k(B(r(G)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:l(()=>[a(be,{class:"pr-20px"},{default:l(()=>[a(m,{ref_key:"formRef",ref:J,model:t,rules:Ke,"label-placement":"left","label-width":120},{default:l(()=>[a(g,{responsive:"screen","item-responsive":""},{default:l(()=>[a(u,{span:"24 m:12",label:"项目列表",path:"pid"},{default:l(()=>[a(r(me),{clearable:"",filterable:"",value:t.pid,"onUpdate:value":[e[0]||(e[0]=s=>t.pid=s),F],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:X,onSearch:T,onBlur:oe,options:h.value,onScroll:ne},null,8,["value","options"])]),_:1}),a(u,{span:"24 m:12",label:"绑定合同设备",path:"cid"},{default:l(()=>[a(f,{value:t.cid,"onUpdate:value":[e[1]||(e[1]=s=>t.cid=s),P],placeholder:"请选择合同设备",options:o.value,"render-label":et,"render-suffix":tt,"check-strategy":"child","show-path":!1,labelKey:"label",remote:"","on-load":Je,"onUpdate:show":We},null,8,["value","options"])]),_:1}),t.cid?(d(),v(u,{key:0,span:"24 m:12",label:"设备名称",path:"devname"},{default:l(()=>[a(r(L),{value:t.devname,"onUpdate:value":e[2]||(e[2]=s=>t.devname=s),clearable:"",placeholder:"请输入"},null,8,["value"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:1,span:"24 m:12",label:"数量",path:"devnum"},{default:l(()=>[a(r(dt),{value:t.devnum,"onUpdate:value":e[3]||(e[3]=s=>t.devnum=s),placeholder:"请输入",max:w.value,style:{width:"100%"}},null,8,["value","max"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:2,span:"24 m:12",label:"设备单位",path:"devunit"},{default:l(()=>[a(r(L),{value:t.devunit,"onUpdate:value":e[4]||(e[4]=s=>t.devunit=s),placeholder:"请输入",readonly:""},null,8,["value"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:3,span:"24 m:12",label:"型号",path:"devmodel"},{default:l(()=>[a(r(L),{value:t.devmodel,"onUpdate:value":e[5]||(e[5]=s=>t.devmodel=s),placeholder:"请输入",readonly:""},null,8,["value"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:4,span:"24 m:12",label:"是否为我司设备",path:"etype"},{default:l(()=>[a(Q,{value:t.etype,"onUpdate:value":e[6]||(e[6]=s=>t.etype=s),name:"radiogroup",disabled:""},{default:l(()=>[a(D,{value:0},{default:l(()=>e[16]||(e[16]=[k("是")])),_:1,__:[16]}),a(D,{value:1},{default:l(()=>e[17]||(e[17]=[k("否")])),_:1,__:[17]})]),_:1},8,["value"])]),_:1})):x("",!0),y.operateType=="edit"?(d(),v(u,{key:5,span:"24 m:12",label:"清点状态",path:"status"},{default:l(()=>[a(r(me),{clearable:"",value:t.status,"onUpdate:value":e[7]||(e[7]=s=>t.status=s),placeholder:"请选择",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}]},null,8,["value"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:6,span:"24 m:12",label:"设备状态",path:"devstatus"},{default:l(()=>[a(r(me),{clearable:"",value:t.devstatus,"onUpdate:value":e[8]||(e[8]=s=>t.devstatus=s),placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}]},null,8,["value"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:7,span:"24 m:12",label:"设备厂家",path:"devmanu"},{default:l(()=>[a(r(L),{value:t.devmanu,"onUpdate:value":e[9]||(e[9]=s=>t.devmanu=s),placeholder:"请输入"},null,8,["value"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:8,span:"24 m:12",label:"厂家联系人",path:"manucontact"},{default:l(()=>[a(r(L),{value:t.manucontact,"onUpdate:value":e[10]||(e[10]=s=>t.manucontact=s),placeholder:"请输入"},null,8,["value"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:9,span:"24 m:12",label:"厂家联系方式",path:"manuinfo"},{default:l(()=>[a(r(L),{value:t.manuinfo,"onUpdate:value":e[11]||(e[11]=s=>t.manuinfo=s),placeholder:"请输入"},null,8,["value"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:10,span:"24 m:12",label:"接线方式",path:"connectionmode"},{default:l(()=>[a(r(L),{value:t.connectionmode,"onUpdate:value":e[12]||(e[12]=s=>t.connectionmode=s),placeholder:"请输入"},null,8,["value"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:11,span:"24 m:12",label:"是否安装就位",path:"install"},{default:l(()=>[a(r(me),{value:t.install,"onUpdate:value":e[13]||(e[13]=s=>t.install=s),placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}]},null,8,["value"])]),_:1})):x("",!0),t.cid?(d(),v(u,{key:12,span:"24 m:12",label:"备注",path:"notes"},{default:l(()=>[a(r(L),{value:t.notes,"onUpdate:value":e[14]||(e[14]=s=>t.notes=s),placeholder:"请输入"},null,8,["value"])]),_:1})):x("",!0),(d(!0),pe(mt,null,vt(_.value,(s,te)=>(d(),v(u,{span:"24 m:24",label:"",path:"notes","show-feedback":!1,key:te},{default:l(()=>[a(g,{responsive:"screen","item-responsive":""},{default:l(()=>[a(u,{span:"24 m:12",label:`附件${te+1}`,path:"notes"},{default:l(()=>[a(r(L),{value:s.name,"onUpdate:value":ge=>s.name=ge,placeholder:"请输入",style:{width:"250px"}},null,8,["value","onUpdate:value"])]),_:2},1032,["label"]),a(u,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var ge,Ue,$e;return[(ge=s.url)!=null&&ge.split("?")[1]||(Ue=s.file)!=null&&Ue.name?(d(),pe("span",Lt,[k(B((($e=s.url)==null?void 0:$e.split("?")[1])||s.file.name)+" ",1),ve("span",{class:"cursor-pointer c-#c92a2a",onClick:we=>{s.url="",s.file=void 0,s.name=""}},"删除",8,Bt),s.url?(d(),pe("span",{key:0,class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:we=>Ye(s.url)},"下载",8,It)):x("",!0)])):(d(),v(fe,{key:1,style:{width:"auto","margin-left":"20px"},ref_for:!0,ref:"uploadRef",action:"#","custom-request":we=>se(we,te),"show-file-list":!1,onBeforeUpload:Ze},{default:l(()=>[a(r(R),{size:"small",ghost:"",type:"primary"},{default:l(()=>e[18]||(e[18]=[k(B("选择文件"))])),_:1,__:[18]})]),_:2},1032,["custom-request"]))]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["model"]),_.value[q.value]&&U.value?(d(),pe("div",Et,[ve("div",jt,[ve("span",null,B(_.value[q.value].filename||_.value[q.value].name),1),ve("span",null,B(_.value[q.value].indexText),1)]),a(ie,{percentage:_.value[q.value].progress,status:_.value[q.value].status==="error"?"error":"success","show-indicator":""},null,8,["percentage","status"])])):x("",!0)]),_:1})]),_:1},8,["show","title"])}}}),At=Se({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Ce(["reset","search","clear"],["update:model"]),setup(I,{emit:ae}){const z=ae,{formRef:V,restoreValidation:y}=Ie(),t=Ee(I,"model"),$=Le(),h=C([]),{pageData:b,getData:N,nextPage:H}=Ne(Re),ne=async p=>{const c=p.currentTarget,F=c.scrollTop;c.scrollTop+c.offsetHeight>=c.scrollHeight&&b.data.length<b.total&&(await H(),h.value=b.data,await De(),setTimeout(()=>{c.scrollTop=F}))},le=async p=>{var c;T.value=!0,p?(t.value.pid=p,z("search"),$.setProjectInfo({pname:(c=h.value.find(F=>F.id==p))==null?void 0:c.proname,pid:p})):z("clear")},K=Be.debounce(async p=>{await N({fuzzy:p,page:1}),h.value=b.data},300),E=C(!1),T=C(!1),oe=p=>{if(t.value.pid=null,E.value=!0,T.value=!1,!p){Y();return}K(p)},X=async()=>{E.value&&!T.value&&(await N({page:1}),h.value=b.data,E.value=!1)},Y=async()=>{await N({page:1}),h.value=b.data};(async()=>{var p,c;await N({fuzzy:$.userInfo.pname}),h.value=b.data,t.value.pid=$.userInfo.pid?$.userInfo.pid:(p=h.value[0])==null?void 0:p.id,t.value.pid&&($.setProjectInfo({pid:t.value.pid,pname:(c=h.value.find(F=>F.id==t.value.pid))==null?void 0:c.proname}),z("search"))})();async function A(){await y(),t.value.fuzzy="",z("reset")}const M=()=>{t.value.fuzzy="",z("search")};async function ee(){var p,c;t.value.pid?z("search"):((p=window.$message)==null||p.destroyAll(),(c=window.$message)==null||c.warning("请选择项目"))}return(p,c)=>{const F=me,o=Ge,i=L,w=qt,P=R,U=Pt,q=ze,_=Oe,se=je,O=Me;return d(),v(O,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[a(se,{ref_key:"formRef",ref:V,model:t.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:xt(ee,["enter"])},{default:l(()=>[a(_,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[a(o,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:l(()=>[a(F,{filterable:"",clearable:"",value:t.value.pid,"onUpdate:value":[c[0]||(c[0]=j=>t.value.pid=j),le],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:h.value,onScroll:ne,onClear:Y,onSearch:oe,onBlur:X},null,8,["value","options"])]),_:1}),a(o,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:l(()=>[a(i,{value:t.value.fuzzy,"onUpdate:value":c[1]||(c[1]=j=>t.value.fuzzy=j),placeholder:"请输入",clearable:"",onClear:M},null,8,["value"])]),_:1}),a(o,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[a(q,{class:"w-full"},{default:l(()=>[a(P,{onClick:A},{icon:l(()=>[a(w,{class:"text-icon"})]),default:l(()=>[k(" "+B(r(G)("common.reset")),1)]),_:1}),a(P,{type:"primary",ghost:"",onClick:ee},{icon:l(()=>[a(U,{class:"text-icon"})]),default:l(()=>[k(" "+B(r(G)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Mt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function qe(I){return typeof I=="function"||Object.prototype.toString.call(I)==="[object Object]"&&!Tt(I)}const na=Se({name:"projectmanagement_device",__name:"index",setup(I){const ae=Ct(),{columns:z,columnChecks:V,data:y,getData:t,loading:$,pagination:h,mobilePagination:b,searchParams:N}=Ut({showTotal:!0,immediate:!1,apiFn:zt,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"devname",title:"设备名称",align:"center",width:180},{key:"devmodel",title:"型号",align:"center",width:160},{key:"devnum",title:"数量",align:"center",width:80},{key:"devunit",title:"设备单位",align:"center",width:100},{key:"etype",title:"是否为我司设备",align:"center",width:120,render(o){return W("div",{},o.etype==0?"是":"否")}},{key:"devmanu",title:"设备厂家",align:"center",width:100},{key:"status",title:"清点状态",align:"center",width:100,render(o){return W("div",{},o.status==0?"未清点":o.status==1?"正常":o.status==2?"增补":o.status==3?"退货":"换货")}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(o,i){return W("div",{},o.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(o,i){return W("div",{},o.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(o,i){return W("div",{},o.devstatus===0?"设备无异常":o.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(o,i){return W("div",{},o.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(o,i){return W("div",{},o.install===0?"是":"否")}},{key:"notes",title:"备注",align:"center",width:120},{key:"dusername",title:"清点信息",align:"left",width:200,render(o){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[k("清点人：")]),a("span",{style:"font-weight:500"},[o.dusername||"-"])]),a("div",null,[a("span",{style:"color:#666"},[k("时间：")]),a("span",{style:" font-weight:500"},[o.ddbtime||"-"])])])}},{key:"username",title:"创建信息",align:"left",width:200,render(o){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[k("创建人：")]),a("span",{style:"font-weight:500"},[o.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[k("时间：")]),a("span",{style:" font-weight:500"},[o.dbtime||"-"])])])}},{key:"operate",title:G("common.operate"),align:"center",width:Pe("project:Equipment:update")||Pe("project:Equipment:delete")?140:0,fixed:"right",render:o=>{let i;return a("div",{class:"flex-center gap-8px"},[ce(a(R,{type:"primary",ghost:!0,size:"small",onClick:()=>A(o.id)},qe(i=G("common.edit"))?i:{default:()=>[i]}),[[ke("no-auth"),"project:Equipment:update"]]),a(xe,{onPositiveClick:()=>Z(o.id)},{default:()=>G("common.confirmDelete"),trigger:()=>{let w;return ce(a(R,{type:"error",ghost:!0,size:"small"},qe(w=G("common.delete"))?w:{default:()=>[w]}),[[ke("no-auth"),"project:Equipment:delete"]])}})])}}]}),{drawerVisible:H,operateType:ne,editingData:le,handleAdd:K,handleEdit:E,checkedRowKeys:T,onBatchDeleted:oe,onDeleted:X}=$t(y,t);Dt(async()=>{});async function Y(){console.log(T.value),M(T.value.join(","),o=>{oe()})}async function Z(o){const{data:i,error:w}=await Fe(o);w||X()}function A(o){E(o)}async function M(o,i){const{data:w,error:P}=await Fe(o);if(!P)i&&i(w);else return!1}const ee=()=>{y.value=[],h.itemCount=0},p=o=>{t()},c=()=>{t()},F=async()=>{var P;const o=y.value.map(U=>U.status==0?{id:U.id,status:1}:null).filter(U=>U!==null),{data:i,error:w}=await Ae(o);w||((P=window.$message)==null||P.success("清点成功"),t())};return(o,i)=>{const w=ze,P=ot,U=lt,q=nt,_=at,se=Nt,O=Me,j=ke("no-auth");return d(),pe("div",Mt,[a(At,{model:r(N),"onUpdate:model":i[0]||(i[0]=S=>_e(N)?N.value=S:null),onReset:c,onSearch:r(t),onClear:ee},null,8,["model","onSearch"]),a(O,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[a(w,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>i[4]||(i[4]=[ve("div",null,"待调试设备",-1)])),_:1,__:[4]})]),"header-extra":l(()=>[a(w,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>{var S;return[(S=r(y))!=null&&S.some(J=>J.status===0)?(d(),v(r(xe),{key:0,onPositiveClick:F},{trigger:l(()=>[ce((d(),v(r(R),{size:"small",ghost:"",type:"primary"},{default:l(()=>[a(P,{class:"text-icon"}),i[5]||(i[5]=k(" 一键清点设备 "))]),_:1,__:[5]})),[[j,"project:Equipment:update"]])]),default:l(()=>[i[6]||(i[6]=k(" 确定要清点当前列表中未清点的设备吗？ "))]),_:1,__:[6]})):x("",!0),ce((d(),v(r(R),{onClick:r(K),size:"small",ghost:"",type:"primary"},{icon:l(()=>[a(U,{class:"text-icon"})]),default:l(()=>[i[7]||(i[7]=k(" "+B("新增")))]),_:1,__:[7]},8,["onClick"])),[[j,"project:Equipment:insert"]]),a(r(xe),{onPositiveClick:Y},{trigger:l(()=>[ce((d(),v(r(R),{size:"small",ghost:"",type:"error",disabled:r(T).length==0},{icon:l(()=>[a(q,{class:St(["text-icon",{"animate-spin":r($)}])},null,8,["class"])]),default:l(()=>[i[8]||(i[8]=k(" "+B("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[j,"project:Equipment:delete"]])]),default:l(()=>[i[9]||(i[9]=k(" 确定要删除选中的设备吗？ "))]),_:1,__:[9]}),a(_,{columns:r(V),"onUpdate:columns":i[1]||(i[1]=J=>_e(V)?V.value=J:null),ctype:7},null,8,["columns"])]}),_:1})]),default:l(()=>[a(se,{"checked-row-keys":r(T),"onUpdate:checkedRowKeys":i[2]||(i[2]=S=>_e(T)?T.value=S:null),columns:r(z),data:r(y),size:"small","flex-height":!r(ae).isMobile,loading:r($),remote:"","row-key":S=>S.id,"scroll-x":r(z).reduce((S,J)=>S+(J.width||100),0),pagination:r(b),class:"sm:h-full","onUpdate:filters":p},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","scroll-x","pagination"]),a(Rt,{visible:r(H),"onUpdate:visible":i[3]||(i[3]=S=>_e(H)?H.value=S:null),onSubmitted:r(t),pid:r(N).pid,"operate-type":r(ne),"row-data":r(le)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{na as default};
