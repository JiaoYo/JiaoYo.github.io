import{_ as pe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DI0LtGm8.js";import{_ as ce}from"./round-delete-C_4zLiR5.js";import{_ as me}from"./round-add-C4K5T801.js";import{d as X,aq as Q,s as fe,r as W,q as ae,a as _e,ar as le,a1 as ge,c as z,o as c,w as a,f as t,b5 as ve,F as oe,h as o,at as ne,A as h,b as V,g as p,e as G,t as k,B as w,N as Y,$ as S,b6 as ye,E as he,U as se,L as we,i as be,x as J,az as A,av as ke,C as H,bl as xe,aC as De}from"./index-L-fc37A6.js";import{f as re,a as Ne,D as Ce,E as ze,F as Z,G as Se}from"./project-COisCmqy.js";import{u as je,a as Ue}from"./table-D8utkW2F.js";import{u as ie}from"./usePageData-CcrWi0A-.js";import{_ as ue}from"./Grid-BXk3mt7Q.js";import{_ as de}from"./FormItemGridItem-s7MwQACu.js";import{N as Te}from"./Upload-QqP-xHe3.js";import{_ as qe}from"./round-search-CZXNsD-X.js";import{_ as Pe}from"./round-refresh-Bnhuq11H.js";import{N as ee}from"./Popconfirm-BzF4QpZe.js";import"./Progress-EddtyCRs.js";import"./utils-BKZAihyB.js";const $e={key:0},Fe={key:0},Re={key:0},Be={key:0},Me=X({name:"OperateDrawer",__name:"operate-drawer",props:Q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(x,{emit:F}){const D=F,_=x,l=fe(u());W();function u(){return{pid:void 0,id:"",affectedbusiness:"",devname:"",apidocument:"",uid:void 0,period:"",notes:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const m=W([]),{pageData:g,getData:N,nextPage:j}=ie(re),R=async s=>{const e=s.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&g.data.length<g.total&&(j(),m.value=g.data)},B=async()=>{var s;await N(),m.value=g.data,l.pid=(s=m.value[0])==null?void 0:s.id},O=async s=>{l.pid=s};async function M(){B(),Object.assign(l,u()),_.operateType==="edit"&&_.rowData&&Object.assign(l,_.rowData)}const{formRef:b,validate:P,restoreValidation:v}=ae(),f={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},affectedbusiness:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},apidocument:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},period:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},uid:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},L=_e(()=>({add:"新增需要开发",edit:"修改需要开发"})[_.operateType]),y=le(x,"visible");ge(y,()=>{y.value&&(M(),setTimeout(()=>{const s=document.querySelector(".n-scrollbar-content");s==null||s.scrollTo(0,0)},300),v())});async function C({file:s},e){let r=new FormData;r.append("multipartFile",s.file);const{data:d,error:T}=await Ne(r);T||(l[e]=d)}function U(){y.value=!1}async function $(){var s,e;if(await P(),_.operateType==="edit"){const{data:r,error:d}=await Ce([l]);d||(U(),D("submitted"),(s=window.$message)==null||s.success("修改成功"))}else{const{data:r,error:d}=await ze([{...l}]);d||(U(),D("submitted"),(e=window.$message)==null||e.success("添加成功"))}}return(s,e)=>{const r=de,d=Te,T=ue,q=oe,I=ve,K=Y,E=ye;return c(),z(E,{show:y.value,"onUpdate:show":e[15]||(e[15]=n=>y.value=n),title:L.value,preset:"card",class:"w-800px"},{footer:a(()=>[t(K,{justify:"end",size:16},{default:a(()=>[t(o(w),{onClick:U},{default:a(()=>[p(k(o(S)("common.cancel")),1)]),_:1}),t(o(w),{type:"primary",onClick:$},{default:a(()=>[p(k(o(S)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(I,{class:"pr-20px"},{default:a(()=>[t(q,{ref_key:"formRef",ref:b,model:l,rules:f,"label-placement":"left","label-width":120},{default:a(()=>[t(T,{responsive:"screen","item-responsive":""},{default:a(()=>[t(r,{span:"24 m:12",label:"项目列表",path:"pid"},{default:a(()=>[t(o(ne),{clearable:"",filterable:"",value:l.pid,"onUpdate:value":[e[0]||(e[0]=n=>l.pid=n),O],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:m.value,onScroll:R},null,8,["value","options"])]),_:1}),t(r,{span:"24 m:12",label:"影响的业务",path:"affectedbusiness"},{default:a(()=>[t(o(h),{value:l.affectedbusiness,"onUpdate:value":e[1]||(e[1]=n=>l.affectedbusiness=n),placeholder:"请输入"},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"设备名称",path:"devname"},{default:a(()=>[t(o(h),{value:l.devname,"onUpdate:value":e[2]||(e[2]=n=>l.devname=n),placeholder:"请输入"},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"接口文档",path:"apidocument"},{default:a(()=>[t(o(h),{value:l.apidocument,"onUpdate:value":e[3]||(e[3]=n=>l.apidocument=n),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"研发对接人",path:"uid"},{default:a(()=>[t(o(h),{value:l.uid,"onUpdate:value":e[4]||(e[4]=n=>l.uid=n),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"研发周期",path:"period"},{default:a(()=>[t(o(h),{value:l.period,"onUpdate:value":e[5]||(e[5]=n=>l.period=n),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{span:"24 m:12",label:"备注",path:"notes"},{default:a(()=>[t(o(h),{value:l.notes,"onUpdate:value":e[6]||(e[6]=n=>l.notes=n),placeholder:"请输入"},null,8,["value"])]),_:1}),t(r,{span:"24 m:24",label:"附件1",path:"notes"},{default:a(()=>{var n;return[t(o(h),{value:l.re1,"onUpdate:value":e[7]||(e[7]=i=>l.re1=i),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),l.fl1?(c(),V("span",$e,[p(k((n=l.fl1)==null?void 0:n.split("?")[1])+" ",1),G("span",{class:"cursor-pointer c-#c92a2a",onClick:e[8]||(e[8]=i=>l.fl1="")},"删除")])):(c(),z(d,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":i=>C(i,"fl1"),"show-file-list":!1},{default:a(()=>[t(o(w),{size:"small",ghost:"",type:"primary"},{default:a(()=>e[16]||(e[16]=[p("选择文件")])),_:1,__:[16]})]),_:1},8,["custom-request"]))]}),_:1}),t(r,{span:"24 m:24",label:"附件2",path:"notes"},{default:a(()=>{var n;return[t(o(h),{value:l.re2,"onUpdate:value":e[9]||(e[9]=i=>l.re2=i),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),l.fl2?(c(),V("span",Fe,[p(k((n=l.fl2)==null?void 0:n.split("?")[1])+" ",1),G("span",{class:"cursor-pointer c-#c92a2a",onClick:e[10]||(e[10]=i=>l.fl2="")},"删除")])):(c(),z(d,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":i=>C(i,"fl2"),"show-file-list":!1},{default:a(()=>[t(o(w),{size:"small",ghost:"",type:"primary"},{default:a(()=>e[17]||(e[17]=[p("选择文件")])),_:1,__:[17]})]),_:1},8,["custom-request"]))]}),_:1}),t(r,{span:"24 m:24",label:"附件3",path:"notes"},{default:a(()=>{var n;return[t(o(h),{value:l.re3,"onUpdate:value":e[11]||(e[11]=i=>l.re3=i),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),l.fl3?(c(),V("span",Re,[p(k((n=l.fl3)==null?void 0:n.split("?")[1])+" ",1),G("span",{class:"cursor-pointer c-#c92a2a",onClick:e[12]||(e[12]=i=>l.fl3="")},"删除")])):(c(),z(d,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":i=>C(i,"fl3"),"show-file-list":!1},{default:a(()=>[t(o(w),{size:"small",ghost:"",type:"primary"},{default:a(()=>e[18]||(e[18]=[p("选择文件")])),_:1,__:[18]})]),_:1},8,["custom-request"]))]}),_:1}),t(r,{span:"24 m:24",label:"附件4",path:"notes"},{default:a(()=>{var n;return[t(o(h),{value:l.re4,"onUpdate:value":e[13]||(e[13]=i=>l.re4=i),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),l.fl4?(c(),V("span",Be,[p(k((n=l.fl4)==null?void 0:n.split("?")[1])+" ",1),G("span",{class:"cursor-pointer c-#c92a2a",onClick:e[14]||(e[14]=i=>l.fl4="")},"删除")])):(c(),z(d,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":i=>C(i,"fl4"),"show-file-list":!1},{default:a(()=>[t(o(w),{size:"small",ghost:"",type:"primary"},{default:a(()=>e[19]||(e[19]=[p("选择文件")])),_:1,__:[19]})]),_:1},8,["custom-request"]))]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Le=X({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["reset","search","clear"],["update:model"]),setup(x,{emit:F}){const D=F,{formRef:_,restoreValidation:l}=ae(),u=le(x,"model"),m=W([]),{pageData:g,getData:N,nextPage:j}=ie(re),R=async v=>{const f=v.currentTarget;f.scrollTop+f.offsetHeight>=f.scrollHeight&&g.data.length<g.total&&(j(),m.value=g.data)},B=async v=>{u.value.pid=v};(async()=>{var v;await N(),m.value=g.data,u.value.pid=(v=m.value[0])==null?void 0:v.id,D("search")})();async function M(){await l(),u.value.fuzzy="",D("reset")}const b=()=>{u.value.fuzzy="",D("search")};async function P(){D("search")}return(v,f)=>{const L=ne,y=de,C=h,U=Pe,$=w,s=qe,e=Y,r=ue,d=oe,T=se;return c(),z(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[t(d,{ref_key:"formRef",ref:_,model:u.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:he(P,["enter"])},{default:a(()=>[t(r,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[t(y,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:a(()=>[t(L,{filterable:"",value:u.value.pid,"onUpdate:value":[f[0]||(f[0]=q=>u.value.pid=q),B],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:m.value,onScroll:R},null,8,["value","options"])]),_:1}),t(y,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:a(()=>[t(C,{value:u.value.fuzzy,"onUpdate:value":f[1]||(f[1]=q=>u.value.fuzzy=q),clearable:"",placeholder:"请输入",onClear:b},null,8,["value"])]),_:1}),t(y,{span:"24  s:12 m:6",class:"pr-24px"},{default:a(()=>[t(e,{class:"w-full"},{default:a(()=>[t($,{onClick:M},{icon:a(()=>[t(U,{class:"text-icon"})]),default:a(()=>[p(" "+k(o(S)("common.reset")),1)]),_:1}),t($,{type:"primary",ghost:"",onClick:P},{icon:a(()=>[t(s,{class:"text-icon"})]),default:a(()=>[p(" "+k(o(S)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ve={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function te(x){return typeof x=="function"||Object.prototype.toString.call(x)==="[object Object]"&&!De(x)}const at=X({name:"projectmanagement_need",__name:"index",setup(x){const F=we(),{columns:D,columnChecks:_,data:l,getData:u,loading:m,mobilePagination:g,searchParams:N}=je({showTotal:!0,immediate:!1,apiFn:Se,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"affectedbusiness",title:"影响的业务",align:"center",width:120},{key:"devname",title:"设备名称",align:"center",width:120},{key:"apidocument",title:"接口文档",align:"center",width:120},{key:"uid",title:"研发对接人",align:"center",width:120},{key:"period",title:"研发周期",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"操作人",align:"center",width:120},{key:"dbtime",title:"操作时间",align:"center",width:120},{key:"operate",title:S("common.operate"),align:"center",width:140,fixed:"right",render:s=>{let e;return t("div",{class:"flex-center gap-8px"},[H(t(w,{type:"primary",ghost:!0,size:"small",onClick:()=>y(s.id)},te(e=S("common.edit"))?e:{default:()=>[e]}),[[J("no-auth"),"project:Development:update"]]),t(ee,{onPositiveClick:()=>L(s.id)},{default:()=>S("common.confirmDelete"),trigger:()=>{let r;return H(t(w,{type:"error",ghost:!0,size:"small"},te(r=S("common.delete"))?r:{default:()=>[r]}),[[J("no-auth"),"project:Development:delete"]])}})])}}]}),{drawerVisible:j,operateType:R,editingData:B,handleAdd:O,handleEdit:M,checkedRowKeys:b,onBatchDeleted:P,onDeleted:v}=Ue(l,u);be(async()=>{});async function f(){console.log(b.value),C(b.value.join(","),s=>{P()})}async function L(s){const{data:e,error:r}=await Z(s,N.pid);r||v()}function y(s){M(s)}async function C(s,e){const{data:r,error:d}=await Z(s,N.pid);if(!d)e&&e(r);else return!1}const U=s=>{u()},$=()=>{u()};return(s,e)=>{const r=Y,d=me,T=ce,q=pe,I=ke,K=se,E=J("no-auth");return c(),V("div",Ve,[t(Le,{model:o(N),"onUpdate:model":e[0]||(e[0]=n=>A(N)?N.value=n:null),onReset:$,onSearch:o(u),onClear:e[1]||(e[1]=n=>l.value=[])},null,8,["model","onSearch"]),t(K,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t(r,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>e[5]||(e[5]=[G("div",null,"需要开发",-1)])),_:1,__:[5]})]),"header-extra":a(()=>[t(r,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[H((c(),z(o(w),{onClick:o(O),size:"small",ghost:"",type:"primary"},{icon:a(()=>[t(d,{class:"text-icon"})]),default:a(()=>[e[6]||(e[6]=p(" "+k("新增")))]),_:1,__:[6]},8,["onClick"])),[[E,"project:Development:insert"]]),t(o(ee),{onPositiveClick:f},{trigger:a(()=>[H((c(),z(o(w),{size:"small",ghost:"",type:"error",disabled:o(b).length==0},{icon:a(()=>[t(T,{class:xe(["text-icon",{"animate-spin":o(m)}])},null,8,["class"])]),default:a(()=>[e[7]||(e[7]=p(" "+k("批量删除")))]),_:1,__:[7]},8,["disabled"])),[[E,"project:Development:delete"]])]),default:a(()=>[e[8]||(e[8]=p(" 确定要删除选中的吗？ "))]),_:1,__:[8]}),t(q,{columns:o(_),"onUpdate:columns":e[2]||(e[2]=n=>A(_)?_.value=n:null)},null,8,["columns"])]),_:1})]),default:a(()=>[t(I,{"checked-row-keys":o(b),"onUpdate:checkedRowKeys":e[3]||(e[3]=n=>A(b)?b.value=n:null),columns:o(D),data:o(l),size:"small","flex-height":!o(F).isMobile,loading:o(m),remote:"","row-key":n=>n.id,pagination:o(g),class:"sm:h-full","onUpdate:filters":U},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Me,{visible:o(j),"onUpdate:visible":e[4]||(e[4]=n=>A(j)?j.value=n:null),onSubmitted:o(u),"operate-type":o(R),"row-data":o(B)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{at as default};
