import{d as K,aE as V,m as G,ar as ae,r as J,n as oe,a as se,aG as X,bY as Y,eh as le,ei as re,aC as Q,c as P,o as b,w as t,f as l,C as W,s as Z,v as ee,h as e,aD as ie,x as h,z as ce,B as L,g as w,t as p,$ as A,a1 as de,cs as ue,aO as pe,O as me,H as R,ej as fe,q as H,bg as ve,y as O,e as i,aU as x,b as B,X as _e,A as be,cJ as ge,U as we,V as ye,bi as xe,ek as he,el as Ce,M as De}from"./index-CbkGmsUT.js";import{u as ke}from"./usePageData-CtVI6YRj.js";import{_ as ze,a as je}from"./text-B1ImycHA.js";import{N as Se}from"./Popconfirm-CfoHIMzd.js";const Fe=K({name:"OperateDrawer",__name:"operate-drawer",props:V({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(C,{emit:q}){G();const a=q,D=ae("pname"),u=C,o=J(N());function N(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null}}const y={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施",trigger:"blur"}},{pageData:m,getData:k,nextPage:z}=ke(ue),j=async n=>{const r=n.currentTarget,v=r.scrollTop;r.scrollTop+r.offsetHeight>=r.scrollHeight&&m.data.length<m.total&&(await z(),await pe(),setTimeout(()=>{r.scrollTop=v}))},U=async n=>{n?o.pid=n:o.value.pid=null},I=async()=>{var n;if(await k({fuzzy:D==null?void 0:D.value,page:1}),m.data.length==0)return(n=window.$message)==null?void 0:n.warning("没有项目")},c=async n=>{await k({fuzzy:n,page:1})},s=()=>{k({page:1})};async function f(){Object.assign(o,N()),await I(),u.pid&&(m.data.forEach(n=>{n.id==u.pid&&(n.disabled=!0)}),o.pid=u.pid),u.operateType==="edit"&&u.rowData&&Object.assign(o,u.rowData)}const{formRef:_,validate:M,restoreValidation:E}=oe(),F=se(()=>({add:"新增项目总结",edit:"修改项目总结"})[u.operateType]),g=X(C,"visible"),S=()=>{g.value=!1},$=Y.debounce(async()=>{var n,r;if(await M(),u.operateType==="edit"){const{data:v,error:T}=await le([{...o}]);T||((n=window.$message)==null||n.success("修改成功"),a("submitted"),S())}else{const{data:v,error:T}=await re([{pid:o.pid,content1:o.content1,content2:o.content2,content3:o.content3,content4:o.content4,content5:o.content5}]);T||((r=window.$message)==null||r.success("添加成功"),a("submitted"),S())}},1e3,{leading:!0,trailing:!1});return Q(g,()=>{g.value&&(f(),setTimeout(()=>{const n=document.querySelector(".n-scrollbar-content");n==null||n.scrollTo(0,0)},300),E())}),(n,r)=>{const v=ee,T=W,te=ce,ne=de;return b(),P(ne,{show:g.value,"onUpdate:show":r[6]||(r[6]=d=>g.value=d),title:F.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:t(()=>[l(te,{justify:"end"},{default:t(()=>[l(e(L),{size:"small",class:"mt-16px",onClick:S},{default:t(()=>[w(p(e(A)("common.cancel")),1)]),_:1}),l(e(L),{type:"primary",size:"small",class:"mt-16px",onClick:e($)},{default:t(()=>[w(p(e(A)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[l(T,{ref_key:"formRef",ref:_,model:o,rules:y},{default:t(()=>[u.operateType==="add"?(b(),P(v,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:t(()=>[l(e(ie),{clearable:"",filterable:"",value:o.pid,"onUpdate:value":[r[0]||(r[0]=d=>o.pid=d),U],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:s,onSearch:c,options:e(m).data,onScroll:j},null,8,["value","options"])]),_:1})):Z("",!0),l(v,{label:"前期准备阶段描述",path:"content1"},{default:t(()=>[l(e(h),{clearable:"",type:"textarea",value:o.content1,"onUpdate:value":r[1]||(r[1]=d=>o.content1=d),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),l(v,{label:"遇到问题及对项目的影响",path:"content2"},{default:t(()=>[l(e(h),{clearable:"",type:"textarea",value:o.content2,"onUpdate:value":r[2]||(r[2]=d=>o.content2=d),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),l(v,{label:"经验教训与改进方案或措施",path:"content3"},{default:t(()=>[l(e(h),{clearable:"",type:"textarea",value:o.content3,"onUpdate:value":r[3]||(r[3]=d=>o.content3=d),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),l(v,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:t(()=>[l(e(h),{clearable:"",type:"textarea",value:o.content4,"onUpdate:value":r[4]||(r[4]=d=>o.content4=d),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),l(v,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:t(()=>[l(e(h),{clearable:"",type:"textarea",value:o.content5,"onUpdate:value":r[5]||(r[5]=d=>o.content5=d),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Te={class:"mt-4 border-t pt-3"},Pe={class:"flex items-start gap-2 mb-3"},Ne={class:"ml-2 flex-1"},Ue={class:"flex items-center"},Me={class:"font-medium font-size-16px font-bold"},$e={class:"text-gray-600 mt-1"},Be=K({name:"drawerLog",__name:"drawerLog",props:V({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(C){const q=G();me();let a=J({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""});const D=C,u={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},o=R({});async function N(){y.value=[],a={id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""},Object.assign(a,D.rowData),j()}const y=R([]),m=X(C,"visible");Q(m,()=>{m.value?N():(y.value=[],a.id=void 0)});function k(c){c||z()}function z(){m.value=!1}const j=async()=>{const{data:c,error:s}=await he({page:1,limit:100,pid:a.id});c&&(y.value=c.list)},U=Y.debounce(async()=>{var _;const c=o.value[a.id];if(!(c!=null&&c.trim()))return(_=window.$message)==null?void 0:_.warning("请输入评论内容");const{data:s,error:f}=await fe([{pid:a.id,content:c}]);s&&(o.value[a.id]="",a.num++,j())},1e3,{leading:!0,trailing:!1}),I=async c=>{var _;const{data:s,error:f}=await Ce(c.id);s&&(j(),a.num--,(_=window.$message)==null||_.success("删除成功"))};return(c,s)=>{const f=ee,_=W,M=ze,E=je,F=ve,g=xe,S=H("i"),$=H("no-auth");return b(),P(g,{show:m.value,"onUpdate:show":[s[1]||(s[1]=n=>m.value=n),k],"display-directive":"show",width:600,onMaskClick:z,onEsc:z},{default:t(()=>[l(F,{title:e(a).username+"的项目总结","native-scrollbar":!1,closable:""},{default:t(()=>[l(_,{ref:"formRef",model:e(a),"show-feedback":!1},{default:t(()=>[l(f,{label:"",path:"contractname"},{label:t(()=>s[2]||(s[2]=[i("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(a).proname}])},p(e(a).proname),3)]),_:1}),l(f,{label:"前期准备阶段描述",path:"content1"},{label:t(()=>s[3]||(s[3]=[i("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(a).content1}])},p(e(a).content1),3)]),_:1}),l(f,{label:"遇到问题及对项目的影响",path:"content2"},{label:t(()=>s[4]||(s[4]=[i("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(a).content2}])},p(e(a).content2),3)]),_:1}),l(f,{label:"经验教训与改进方案或措施",path:"content3"},{label:t(()=>s[5]||(s[5]=[i("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(a).content3}])},p(e(a).content3),3)]),_:1}),l(f,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:t(()=>s[6]||(s[6]=[i("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(a).content4}])},p(e(a).content4),3)]),_:1}),l(f,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:t(()=>s[7]||(s[7]=[i("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:t(()=>[i("span",{class:x(["preview-text",{textstyle:e(a).content5}])},p(e(a).content5),3)]),_:1})]),_:1},8,["model"]),O((b(),B("div",null,[w(p(e(a).num)+"评论",1)])),[[S,e(a).num]]),l(_e,{name:"fade"},{default:t(()=>[i("div",Te,[O((b(),B("div",Pe,[i("div",null,[l(M,{size:"small",src:u.avatar},null,8,["src"])]),l(e(h),{type:"textarea",id:`comment-input-${e(a).id}`,value:o.value[e(a).id],"onUpdate:value":s[0]||(s[0]=n=>o.value[e(a).id]=n),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:be(ge(e(U),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),l(e(L),{type:"primary",ghost:"",onClick:e(U)},{default:t(()=>s[8]||(s[8]=[w("发送")])),_:1,__:[8]},8,["onClick"])])),[[$,"project:Summary:Comment:insert"]]),(b(!0),B(we,null,ye(y.value,n=>(b(),B("div",{key:n.id,class:"flex mb-3"},[l(M,{size:"small",src:u.avatar},null,8,["src"]),i("div",Ne,[i("div",Ue,[i("span",Me,p(n.username),1),l(E,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:t(()=>[w(p(n.dbtime),1)]),_:2},1024),e(q).userInfo.id==n.creater?(b(),P(e(Se),{key:0,onPositiveClick:r=>I(n)},{trigger:t(()=>[O((b(),P(e(L),{quaternary:"",type:"error",size:"small"},{default:t(()=>s[9]||(s[9]=[w(" 删除 ")])),_:1,__:[9]})),[[$,"project:Summary:Comment:delete"]])]),default:t(()=>[s[10]||(s[10]=w(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):Z("",!0)]),i("div",$e,p(n.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Oe=De(Be,[["__scopeId","data-v-4f3f349b"]]);export{Fe as _,Oe as d};
