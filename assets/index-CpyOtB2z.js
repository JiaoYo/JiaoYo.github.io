import{_ as ln}from"./correct-QUrKoeks.js";import{_ as Gl,a as Wl,V as an,b as nn,c as sn,d as on,e as rn,f as dn,g as un}from"./index-ihzZ-7bZ.js";import{_ as va}from"./round-plus-BvG-_T3N.js";import{_ as cn}from"./round-search-DuF6crdJ.js";import{R as kt,b as x,o as u,e as g,d as Nt,z as Ot,s as b,ax as Vt,i as Kl,aL as Ql,F as ct,aA as Je,f as a,I as Be,c as I,w as s,g as m,h as p,B as _,a3 as pn,bO as fn,b0 as It,ek as gn,a2 as Yl,G as C,t as j,aP as Pt,a7 as xt,J as Oe,b4 as ya,H as ie,L as ha,da as wt,aG as yt,W as Sl,aD as lt,a4 as il,M as ba,N as wl,aF as kl,aC as sl,$ as X,aE as mn,el as vn,n as l,aK as $t,em as yn,en as hn,eo as bn,aN as _a,c$ as Xl,ay as Cl,A as _n,a as xn,aw as xa,aM as Ee,aR as Zl,K as Ml,a5 as _t,aU as it,cA as ka,cD as Rl,b8 as Ca,cF as Jl,cI as La,bh as Sa,cS as wa,d1 as $a,D as st,aQ as kn,ep as da,eq as Cn,er as Ln,es as Sn,S as wn,aW as $n,et as Dn,eu as zn,ev as jn,ew as Un,ex as Bn,X as Fn,Y as Pn,cN as In,cL as Nn,cM as Tn,ey as At,d3 as En,d2 as An,d0 as ua,cJ as Vn,cK as On,cG as ca,cH as pa,dd as qn,de as Mn,db as Rn,dc as Jn,dh as Hn,di as Gn,df as Wn,dg as Kn,ez as Qn,eA as Yn,dQ as Xn,eB as Zn,dR as es,bp as ts,br as ls,eC as as,aS as ns,eD as ss,eE as is,cE as os,aV as rs}from"./index-BhODWnwk.js";import{u as pt}from"./usePageData-BRSC0p7p.js";import{f as Da,b as ds,_ as za,c as us,a as ja,e as cs,d as ps}from"./drawerLog-4sAIP4-o.js";import{N as We}from"./Popconfirm-DaOtvNXy.js";import{_ as fa,a as fs}from"./text-DYBwWc4C.js";import{h as Ve}from"./permission-Du15zcP4.js";import{u as gs}from"./table-Djtp3DGd.js";import{_ as Ll}from"./DatePicker-DnLwdS0O.js";import{N as Hl}from"./Cascader-CoFSEbFj.js";import{_ as ms}from"./round-delete-BLvHsSV0.js";import{a as vs,_ as ys,A as hs}from"./index-DMzvmI9x.js";import{p as ga,f as ma}from"./business-B0WQevjL.js";import{_ as bs,a as _s}from"./DescriptionsItem-_uZn7wzd.js";import{_ as Ua,a as xs}from"./Grid-CX2M5k7E.js";import{_ as ks,d as Cs}from"./drawerLog-CsD2n-a-.js";import{l as Ls}from"./lookdebuggingSheetModal-Lqp6Vurf.js";import{f as Ss}from"./mojicb-Cbze1U4M.js";import{_ as ws}from"./FormItemGridItem-BHKuIZBQ.js";import{N as $s}from"./Table-Cdm8PI4O.js";const Ds={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function zs(_e,F){return u(),x("svg",Ds,F[0]||(F[0]=[g("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H5.2L4 17.2V4h16zm-3-5h-2V9h2m-4 2h-2V9h2m-4 2H7V9h2"},null,-1)]))}const js=kt({name:"mdi-message-processing-outline",render:zs}),Us={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Bs(_e,F){return u(),x("svg",Us,F[0]||(F[0]=[g("path",{fill:"currentColor",d:"m12 10.8l-4.6 4.6L6 14l6-6l6 6l-1.4 1.4z"},null,-1)]))}const Fs=kt({name:"material-symbols-keyboard-arrow-up",render:Bs}),Ps={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Is(_e,F){return u(),x("svg",Ps,F[0]||(F[0]=[g("path",{fill:"currentColor",d:"M12 14.975q-.2 0-.375-.062T11.3 14.7l-4.6-4.6q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l3.9 3.9l3.9-3.9q.275-.275.7-.275t.7.275t.275.7t-.275.7l-4.6 4.6q-.15.15-.325.213t-.375.062"},null,-1)]))}const Ns=kt({name:"material-symbols-keyboard-arrow-down-rounded",render:Is}),Ts={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Es(_e,F){return u(),x("svg",Ts,F[0]||(F[0]=[g("path",{fill:"currentColor",d:"M3 21v-4.25L16.2 3.575q.3-.275.663-.425t.762-.15t.775.15t.65.45L20.425 5q.3.275.438.65T21 6.4q0 .4-.137.763t-.438.662L7.25 21zM17.6 7.8L19 6.4L17.6 5l-1.4 1.4z"},null,-1)]))}const As=kt({name:"material-symbols-edit",render:Es}),Vs={class:"flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto h-100%"},Os={style:{display:"flex","flex-direction":"column","justify-content":"space-between",gap:"16px",height:"100%"}},qs={key:1},Ms={class:"flex items-center justify-between"},Rs={class:"flex items-center"},Js={class:"font-size-16px font-bold"},Hs={class:"font-size-12px c-#868e96"},Gs={key:0},Ws={class:"font-size-12px c-#a19f9d my-5px"},Ks={key:1,class:"mt-1 flex items-center justify-between gap-3 text-sm text-gray-500"},Qs=["onClick"],Ys={key:0,class:"mt-4 border-t pt-3"},Xs={class:"flex items-start gap-2 mb-3"},Zs={class:"ml-2 flex-1"},ei={class:"flex justify-between items-center"},ti={class:"font-medium mr-20px"},li={class:"text-gray-600 mt-1"},ai={style:{display:"flex","justify-content":"flex-end"}},ni=Nt({__name:"dayLog",props:{pid:{},pname:{}},setup(_e){const F=Ot(),fe=_e,oe=b([]);Vt(()=>fe.pid,V=>{V&&De()});const S=b({page:1,limit:10,total:0}),De=async()=>{const{data:V,error:w}=await Da({pid:fe.pid,page:S.value.page,limit:S.value.limit});V&&(S.value.total=V.total,oe.value=V.list.map(re=>(re.showCommentSection=!1,re.showAll=!1,re)))},ne=V=>{S.value.page=V,De()},r=V=>{S.value.limit=V,De()};Kl(()=>{De()});const H=b("add"),ce=b({}),Ne=b(!1),qe=()=>{Ne.value=!0,H.value="add"},pe=V=>{Ne.value=!0,H.value="edit",ce.value=V},Me=async V=>{var xe;const{data:w,error:re}=await ja(V.id);w&&((xe=window.$message)==null||xe.success("删除成功"),oe.value.length===1&&S.value.page>1&&S.value.page--,De())},Ce=V=>{oe.value.forEach(w=>{w.id!==V.id&&(w.showAll=!1)}),V.showAll=!V.showAll};async function Fe(V,w=8,re=30){var Se;await yt();for(let ke=0;ke<w;ke++){const he=document.querySelector(`#${V} textarea`);if(he&&typeof he.focus=="function"){he.focus();const K=he.value;if(K&&he.setSelectionRange){const Z=K.length;he.setSelectionRange(Z,Z)}return!0}await new Promise(K=>setTimeout(K,re))}const xe=document.getElementById(V);return xe&&(xe.tabIndex=-1,(Se=xe.focus)==null||Se.call(xe)),!1}const Ke=async V=>{oe.value.forEach(w=>{w.id!==V.id&&(w.showCommentSection=!1)}),V.showCommentSection=!V.showCommentSection,V.showCommentSection&&await Fe(`comment-input-${V.id}`),we(V)},we=async V=>{const{data:w,error:re}=await us({page:1,limit:100,pid:V.id});w&&(V.comments=w.list)},Le=b({}),le=Ql.debounce(async V=>{var Se;const w=Le.value[V.id];if(!(w!=null&&w.trim()))return(Se=window.$message)==null?void 0:Se.warning("请输入评论内容");const{data:re,error:xe}=await ds([{pid:V.id,context:w}]);re&&(we(V),V.num++,Le.value[V.id]="")},1e3,{leading:!0,trailing:!1}),ze=async(V,w)=>{var Se;const{data:re,error:xe}=await cs(V.id);re&&(we(w),w.num--,(Se=window.$message)==null||Se.success("删除成功"))};return(V,w)=>{const re=As,xe=Ns,Se=Fs,ke=js,he=We,K=Oe,Z=gn,Ze=ct("no-auth");return u(),x(Je,null,[g("div",Vs,[Be((u(),I(p(_),{type:"primary",onClick:qe},{icon:s(()=>[a(re)]),default:s(()=>[w[3]||(w[3]=m(" 写日报"))]),_:1,__:[3]})),[[Ze,"project:DailyReport:insert"]]),g("div",Os,[a(p(pn),{style:{height:"calc(100vh - 181px)"}},{default:s(()=>[oe.value.length?(u(),x("div",qs,[(u(!0),x(Je,null,It(oe.value,N=>(u(),I(p(Yl),{key:N.id,class:"mb-4",title:"",size:"small"},{default:s(()=>[g("div",Ms,[g("div",Rs,[N.showAll?(u(),I(xe,{key:0,class:"font-size-20px mr-10px cursor-pointer",onClick:O=>Ce(N)},null,8,["onClick"])):(u(),I(Se,{key:1,class:"font-size-20px mr-10px cursor-pointer",onClick:O=>Ce(N)},null,8,["onClick"])),g("span",Js,j(N.username)+"的日报",1)]),g("span",Hs,j(N.dbtime),1)]),N.showAll?(u(),x("div",Gs,[w[4]||(w[4]=g("div",{class:"font-size-14px font-bold"},"项目名称",-1)),g("div",{class:Pt(["preview-text",{textstyle:JSON.parse(N.context).proname}])},j(JSON.parse(N.context).proname),3),w[5]||(w[5]=g("div",{class:"font-size-14px font-bold"},"当前工作内容及成果描述",-1)),g("div",{class:Pt(["preview-text",{textstyle:JSON.parse(N.context).notes}])},j(JSON.parse(N.context).notes),3),w[6]||(w[6]=g("div",{class:"font-size-14px font-bold"},"遇到问题",-1)),g("div",{class:Pt(["preview-text",{textstyle:JSON.parse(N.context).problem}])},j(JSON.parse(N.context).problem),3),w[7]||(w[7]=g("div",{class:"font-size-14px font-bold"},"解决措施",-1)),g("div",{class:Pt(["preview-text",{textstyle:JSON.parse(N.context).solutions}])},j(JSON.parse(N.context).solutions),3),w[8]||(w[8]=g("div",{class:"font-size-14px font-bold"},"建议意见反馈",-1)),g("div",{class:Pt(["preview-text",{textstyle:JSON.parse(N.context).feedback}])},j(JSON.parse(N.context).feedback),3),w[9]||(w[9]=g("div",{class:"font-size-14px font-bold"},"（总结）自己对一天工作的感受和体感",-1)),g("div",{class:Pt(["preview-text",{textstyle:JSON.parse(N.context).summarize}])},j(JSON.parse(N.context).summarize),3)])):C("",!0),g("div",Ws,"字符数："+j(N.charctras),1),N.showAll?(u(),x("div",Ks,[g("span",{class:"cursor-pointer hover:text-blue-500",style:xt({color:N.showCommentSection?"#1890ff":""}),onClick:O=>Ke(N)},[a(ke,{class:"font-size-18px"}),m(j(N.num==0?"":N.num),1)],12,Qs),p(F).userInfo.id==N.creater?(u(),I(K,{key:0},{default:s(()=>[a(p(_),{quaternary:"",type:"info",size:"small",onClick:O=>pe(N)},{default:s(()=>w[10]||(w[10]=[m(" 编辑 ")])),_:2,__:[10]},1032,["onClick"]),a(he,{onPositiveClick:O=>Me(N)},{trigger:s(()=>[a(p(_),{quaternary:"",type:"error",size:"small"},{default:s(()=>w[11]||(w[11]=[m(" 删除 ")])),_:1,__:[11]})]),default:s(()=>[w[12]||(w[12]=m(" 确定删除吗？ "))]),_:2,__:[12]},1032,["onPositiveClick"])]),_:2},1024)):C("",!0)])):C("",!0),a(ya,{name:"fade"},{default:s(()=>[N.showCommentSection?(u(),x("div",Ys,[g("div",Xs,[g("div",null,[a(p(fa),{size:"small",src:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"})]),a(p(ie),{type:"textarea",id:`comment-input-${N.id}`,value:Le.value[N.id],"onUpdate:value":O=>Le.value[N.id]=O,placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ha(wt(O=>p(le)(N),["exact","prevent"]),["enter"])},null,8,["id","value","onUpdate:value","onKeydown"]),a(p(_),{type:"primary",ghost:"",onClick:O=>p(le)(N)},{default:s(()=>w[13]||(w[13]=[m("发送")])),_:2,__:[13]},1032,["onClick"])]),(u(!0),x(Je,null,It(N.comments,O=>(u(),x("div",{key:O.id,class:"flex mb-3"},[a(p(fa),{size:"small",src:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"}),g("div",Zs,[g("div",ei,[g("div",null,[g("span",ti,j(O.username),1),a(p(fs),{depth:"3",style:{"font-size":"12px"}},{default:s(()=>[m(j(O.dbtime),1)]),_:2},1024),p(F).userInfo.id==O.creater?(u(),I(he,{key:0,onPositiveClick:ve=>ze(O,N)},{trigger:s(()=>[a(p(_),{quaternary:"",type:"error",size:"small"},{default:s(()=>w[14]||(w[14]=[m(" 删除 ")])),_:1,__:[14]})]),default:s(()=>[w[15]||(w[15]=m(" 确定删除吗？ "))]),_:2,__:[15]},1032,["onPositiveClick"])):C("",!0),g("div",li,j(O.context),1)])])])]))),128))])):C("",!0)]),_:2},1024)]),_:2},1024))),128))])):(u(),I(p(fn),{key:0,description:"暂无日志"}))]),_:1}),g("div",ai,[a(Z,{page:S.value.page,"onUpdate:page":[w[0]||(w[0]=N=>S.value.page=N),ne],"page-size":S.value.limit,"onUpdate:pageSize":[w[1]||(w[1]=N=>S.value.limit=N),r],"item-count":S.value.total,"show-size-picker":"","page-sizes":[10,20,50],prefix:()=>`共 ${S.value.total} 条记录`},null,8,["page","page-size","item-count","prefix"])])])]),a(za,{visible:Ne.value,"onUpdate:visible":w[2]||(w[2]=N=>Ne.value=N),onSubmitted:De,"operate-type":H.value,pname:fe.pname,pid:fe.pid,"row-data":ce.value},null,8,["visible","operate-type","pname","pid","row-data"])],64)}}}),si=Sl(ni,[["__scopeId","data-v-3f32dd5a"]]),ii={class:"flex items-center justify-between"},oi={class:"flex items-center"},ri={style:{margin:"10px 0","font-weight":"bolder",width:"140px"}},di={key:0,class:"font-size-12px c-#ffa502 ml-10px"},ui={key:0},ci={style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},pi={key:0},fi={style:{display:"flex","justify-content":"space-between"}},gi={key:0,class:"preview-content"},mi=["src"],vi={key:4},yi=["src"],hi={key:5,class:"txt-preview"},bi=Nt({__name:"fileList",props:{pid:{},data:{},fileType:{},typename:{}},emits:["getData"],setup(_e,{emit:F}){const fe=_e,oe=Ot(),S=F,De=[{title:"文件别名",key:"name",align:"center",width:200,ellipsis:{tooltip:!0}},{title:"文件名称",key:"filename",align:"center",width:200,ellipsis:{tooltip:!0}},{title:"上传人",key:"creator",align:"center",width:100},{title:"上传时间",key:"dbtime",align:"center",width:200},{title:"操作",key:"actions",align:"center",width:180,render(h,v){return l(Oe,{justify:"center"},[l(_,{type:"info",size:"small",ghost:!0,onClick:()=>{Se(h)}},{default:()=>"查看"}),l(_,{type:"info",size:"small",ghost:!0,onClick:()=>{Ce(h)}},{default:()=>"下载"}),Ve("project:File:update")&&l(_,{type:"info",size:"small",ghost:!0,onClick:()=>{Z(h)}},{default:()=>"编辑"}),Ve("project:File:delete")&&(oe.userInfo.usertype==0||oe.userInfo.usertype==2)&&l(We,{onPositiveClick:async()=>{var G;if(h.id){const{data:Q,error:d}=await hn(h.url),{data:y,error:k}=await bn(h.id);k||((G=window.$message)==null||G.success("删除成功"),S("getData"))}}},{default:()=>X("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>X("common.delete")})})])}}];async function ne(h){return!0}const r=b(!1),H=b(null),ce=b({fileName:"",file:null,id:void 0}),Ne={fileName:[{required:!0,message:"请输入文件别名",trigger:["blur","change"]}]},qe=b(0),pe=()=>{ve.value=[],r.value=!0,qe.value=0,ce.value.id=void 0,ce.value.fileName="",ce.value.file=null},Me=async()=>{var h,v,G,Q;try{if(await((h=H.value)==null?void 0:h.validate()),ce.value.id){const{data:d,error:y}=await vn([{id:ce.value.id,filename:ce.value.fileName}]);if(y)return(v=window.$message)==null?void 0:v.error("保存文件记录失败");(G=window.$message)==null||G.destroyAll(),(Q=window.$message)==null||Q.success("编辑成功"),S("getData"),K.value=!1;return}}catch{K.value=!1}};async function Ce(h){if(h!=null&&h.url)try{const G=await(await fetch(h.url,{mode:"cors"})).blob(),Q=URL.createObjectURL(G),d=document.createElement("a");d.href=Q,d.download=h.filename,d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(Q)}catch(v){console.error("下载失败:",v)}}const Fe=()=>{console.log("渲染完成")},Ke=h=>{console.log(h,"渲染失败")},we=b(!1),Le=b(""),le=b([]),ze=b(""),V=b("预览文件"),w=b(!1),re=b(0),xe=b(""),Se=async h=>{var G,Q;if(!(h!=null&&h.url))return;const v=(G=h.filename.split(".").pop())==null?void 0:G.toLowerCase();if(Le.value=h.url,V.value=h.filename,["xls","xlsx"].includes(v))ze.value="xls";else if(["doc","docx"].includes(v))ze.value="doc";else if(["pdf"].includes(v))ze.value="pdf";else if(["png","jpg","jpeg","gif","bmp"].includes(v)){ze.value="img",le.value=fe.data.map(y=>{var k;return["png","jpg","jpeg","gif","bmp"].includes((k=y.filename.split(".").pop())==null?void 0:k.toLowerCase())?y.url:""}).filter(y=>y!=="");const d=le.value.findIndex(y=>y===h.url);re.value=d,w.value=!0;return}else if(["mp4","webm"].includes(v))ze.value="mp4";else if(["txt","json"].includes(v)){ze.value="txt";const d=await fetch(Le.value);xe.value=await d.text()}else{(Q=window.$message)==null||Q.warning("暂不支持该文件类型预览");return}we.value=!0},ke=b(45),he=()=>{ke.value==45?ke.value=350:ke.value=45},K=b(!1);function Z(h){ce.value.id=h.id,ce.value.fileName=h.name,K.value=!0}const Ze=()=>{K.value=!1};function N(h){return h.replace(/\.[^/.]+$/,"")}const O=[{title:"文件名称",key:"filename",align:"center",render(h){if(!h.name){const v=async({file:Q,onFinish:d,onError:y})=>{var k,E;try{h.status=!0;const R=await $t(Q.file,Q.name,"",ee=>{h.progress=ee});R&&(h.url=R,h.name=Q.name,h.status=!1)}catch(R){console.error(R),(E=(k=window.$message)==null?void 0:k.error)==null||E.call(k,"文件上传出错"),h.status=!1}};async function G(Q){return!0}return l("div",{style:"display: flex; justify-content: center; align-items: center;"},[l(sl,{action:"#",showFileList:!1,customRequest:v,onBeforeUpload:G},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:h.status},{default:()=>"上传文件"})}),h.progress?l(kl,{type:"line",percentage:h.progress,indicatorPlacement:"inside",processing:!0}):null])}return l("div",{},h.name)}},{title:"文件别名",key:"filename",align:"center",render(h){return l(ie,{value:h.filename??N(h.name)??"",onUpdateValue:v=>{h.filename=v}})}},{title:"操作",key:"actions",align:"center",width:100,render(h){return l(Oe,{justify:"center"},[l(_,{type:"error",size:"small",ghost:!0,onClick:()=>{ve.value=ve.value.filter(v=>v!==h)}},{default:()=>"删除"})])}}],ve=b([]),He=b(0),c=b(!1),L=async()=>{var v,G,Q,d,y,k;if(ve.value.length==0)return(v=window.$message)==null?void 0:v.warning("请选择文件");let h=!0;for(let E=0;E<ve.value.length;E++){const R=ve.value[E];if(!R.name){(G=window.$message)==null||G.warning(`第${E+1}个文件的文件名称不能为空`),h=!1;break}if(!R.filename){(Q=window.$message)==null||Q.warning(`第${E+1}个文件的文件别名不能为空`),h=!1;break}}if(h){c.value=!0;const E=ve.value.length;for(let W=0;W<E;W++){He.value=W;const q=ve.value[W];q.indexText=`${W+1}/${E}`,q.progress=0,q.status="uploading";try{q.url=await $t(q.file,q.name,"",je=>{q.progress=je}),q.progress=100,q.status="done"}catch{q.status="error"}}const R=ve.value.map(W=>({file:W.url,filename:W.filename,pid:fe.pid,sort:fe.fileType})),{data:ee,error:J}=await yn(R);if(J)return(d=window.$message)==null?void 0:d.error("保存文件记录失败");S("getData"),(y=window.$message)==null||y.destroyAll(),(k=window.$message)==null||k.success("上传成功"),r.value=!1,c.value=!1}},T=()=>{r.value=!1};function P(h){h.fileList.forEach(v=>{v.filename||(v.filename=N(v.name))}),ve.value=h.fileList}return(h,v)=>{const G=va,Q=Gl,d=Wl,y=wl,k=ba,E=il,R=mn,ee=ct("no-auth");return u(),x(Je,null,[g("div",ii,[g("div",oi,[g("h2",ri,j(fe.typename),1),Be((u(),I(p(_),{size:"small",ghost:"",type:"primary",onClick:pe},{icon:s(()=>[a(G,{class:"text-icon"})]),default:s(()=>[m(" 新增"+j(fe.typename),1)]),_:1})),[[ee,"project:File:insert"]]),fe.fileType==4?(u(),x("span",di,"照片数不少于6张")):C("",!0)]),fe.data.length>0?(u(),x("div",ui,"共"+j(fe.data.length)+"条",1)):C("",!0)]),fe.data.length>0?(u(),I(p(lt),{key:0,columns:De,data:fe.data,size:"small","scroll-x":702,"row-key":J=>J.id,"max-height":ke.value},null,8,["data","row-key","max-height"])):C("",!0),g("div",ci,[ke.value==45&&fe.data.length>1?(u(),x("span",{key:0,onClick:he},[v[7]||(v[7]=m(" 更多 ")),a(Q,{class:"font-size-20px"})])):C("",!0),ke.value==350&&fe.data.length>1?(u(),x("span",{key:1,onClick:he},[v[8]||(v[8]=m(" 收起 ")),a(d,{class:"font-size-20px"})])):C("",!0)]),a(E,{show:K.value,"onUpdate:show":v[1]||(v[1]=J=>K.value=J),title:(ce.value.id?"编辑":"新增")+fe.typename,preset:"card",class:"w-700px"},{default:s(()=>[a(k,{ref_key:"formRef",ref:H,model:ce.value,rules:Ne,"label-width":"auto",style:{width:"100%"}},{default:s(()=>[a(y,{label:"文件别名",path:"fileName"},{default:s(()=>[a(p(ie),{value:ce.value.fileName,"onUpdate:value":v[0]||(v[0]=J=>ce.value.fileName=J),placeholder:"请输入"},null,8,["value"])]),_:1}),qe.value?(u(),I(p(kl),{key:0,type:"line",percentage:qe.value,color:qe.value==100?"#18a058":"#2080f0","indicator-placement":"inside",processing:""},null,8,["percentage","color"])):C("",!0),a(y,null,{default:s(()=>[a(p(Oe),{justify:"center",style:{width:"100%"}},{default:s(()=>[a(p(_),{type:"primary",onClick:Me},{default:s(()=>v[9]||(v[9]=[m(j("确认"))])),_:1,__:[9]}),a(p(_),{onClick:Ze},{default:s(()=>v[10]||(v[10]=[m("取消")])),_:1,__:[10]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),a(E,{show:r.value,"onUpdate:show":v[3]||(v[3]=J=>r.value=J),title:(ce.value.id?"编辑":"新增")+fe.typename,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:s(()=>[a(p(Oe),{justify:"end"},{default:s(()=>[a(p(_),{size:"small",class:"mt-16px",onClick:T},{default:s(()=>[m(j(p(X)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",size:"small",class:"mt-16px",onClick:L},{default:s(()=>[m(j(p(X)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(p(sl),{ref:"uploadRef",action:void 0,class:"mb-10px","file-list":ve.value,"onUpdate:fileList":v[2]||(v[2]=J=>ve.value=J),onBeforeUpload:ne,multiple:!0,onChange:P,"show-file-list":!1},{default:s(()=>[a(p(_),{size:"small",ghost:"",type:"primary"},{default:s(()=>v[11]||(v[11]=[m("选择文件")])),_:1,__:[11]})]),_:1},8,["file-list"]),a(p(lt),{columns:O,"paginate-single-page":!1,data:ve.value,"max-height":350},null,8,["data"]),ve.value[He.value]&&c.value?(u(),x("div",pi,[g("div",fi,[g("span",null,j(ve.value[He.value].filename||ve.value[He.value].name),1),g("span",null,j(ve.value[He.value].indexText),1)]),a(p(kl),{percentage:ve.value[He.value].progress,status:ve.value[He.value].status==="error"?"error":"success","show-indicator":""},null,8,["percentage","status"])])):C("",!0)]),_:1},8,["show","title"]),a(E,{show:we.value,"onUpdate:show":v[4]||(v[4]=J=>we.value=J),title:V.value,preset:"card",style:{width:"80%"}},{default:s(()=>[ze.value==="img"?(u(),x("div",gi,[g("img",{src:Le.value,alt:"预览图片",style:{"max-width":"100%",height:"80vh"}},null,8,mi)])):C("",!0),ze.value.includes("xls")?(u(),I(p(an),{key:1,options:{xls:!0,minColLength:0,minRowLength:0,widthOffset:20,heightOffset:5},src:Le.value,style:{height:"80vh"},onRendered:Fe,onError:Ke},null,8,["src"])):C("",!0),ze.value.includes("doc")?(u(),I(p(nn),{key:2,src:Le.value,style:{height:"80vh"},onRendered:Fe,onError:Ke},null,8,["src"])):C("",!0),ze.value.includes("pdf")?(u(),I(p(sn),{key:3,src:Le.value,style:{height:"80vh"},onRendered:Fe,onError:Ke},null,8,["src"])):C("",!0),ze.value.includes("mp4")?(u(),x("div",vi,[g("video",{src:Le.value,controls:"",style:{width:"100%",height:"80vh"}},null,8,yi)])):C("",!0),ze.value.includes("txt")?(u(),x("div",hi,[g("pre",null,j(xe.value),1)])):C("",!0)]),_:1},8,["show","title"]),a(R,{show:w.value,"onUpdate:show":v[5]||(v[5]=J=>w.value=J),"src-list":le.value,current:re.value,"onUpdate:current":v[6]||(v[6]=J=>re.value=J)},null,8,["show","src-list","current"])],64)}}}),Ft=Sl(bi,[["__scopeId","data-v-10bb918f"]]),_i={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},xi=Nt({__name:"contractList",props:{id:{}},setup(_e){const F=_e,fe=_a(),{columns:oe,data:S,getData:De,loading:ne,mobilePagination:r,searchParams:H}=gs({showTotal:!0,apiFn:Xl,apiParams:{page:1,pageSize:20,limit:20,id:void 0,_t:new Date().getTime()},immediate:!1,columns:()=>[{key:"contractname",title:"合同名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"contractnum",title:"合同编号",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"businesscon",title:"商务负责人",align:"center",width:100,ellipsis:{tooltip:!0}},{key:"businessinfo",title:"商务联系方式",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"precautions",title:"注意事项",align:"center",width:100},{key:"username",title:"创建者",align:"center",width:100,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0}]});return Kl(async()=>{H.id=F.id,F.id&&De()}),(ce,Ne)=>{const qe=Oe,pe=lt,Me=Yl;return u(),x("div",_i,[a(Me,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:s(()=>[a(qe,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:s(()=>Ne[0]||(Ne[0]=[g("div",null,"关联合同列表",-1)])),_:1,__:[0]})]),default:s(()=>[a(pe,{columns:p(oe),data:p(S),size:"small","flex-height":!p(fe).isMobile,"scroll-x":p(oe).reduce((Ce,Fe)=>Ce+(Fe.width||100),0),loading:p(ne),remote:"","row-key":Ce=>Ce.id,pagination:p(r),class:"h-400px"},null,8,["columns","data","flex-height","scroll-x","loading","row-key","pagination"])]),_:1})])}}}),ki=Nt({name:"businessModal",__name:"businessModal",props:Cl({pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Cl(["submitted"],["update:visible"]),setup(_e,{emit:F}){const fe=F,oe=Ot(),S=_e;async function De(){ce(),Ke(),ze(),ke(),Z.value=[],K.value=!0,he.value=!0,O.value=[]}_n();const ne=xn(()=>"新增待调试业务"),r=xa(_e,"visible");Vt(r,()=>{r.value&&De()});const{pageData:H,getData:ce,nextPage:Ne}=pt(ka),qe=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&H.data.length<H.total&&Ne()},{pageData:pe,getData:Me,nextPage:Ce}=pt(Rl),Fe=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&pe.data.length<pe.total&&(Ce(),pe.data=pe.data.map(k=>({...k,value:k.docker+"&id="+k.id})))},Ke=async()=>{await Me({pid:S.pid}),pe.data=pe.data.map(d=>({...d,value:d.docker+"&id="+d.id}))},{pageData:we,getData:Le,nextPage:le}=pt(Ca),ze=async()=>{await Le({usertypes:"2,3"})},V=async d=>{const y=d.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight&&we.data.length<we.total&&le()},{pageData:w,getData:re,nextPage:xe}=pt(Jl),Se=async d=>{const y=d.currentTarget,k=y.scrollTop;y.scrollTop+y.offsetHeight>=y.scrollHeight&&H.data.length<H.total&&(await xe(),await yt(),setTimeout(()=>{y.scrollTop=k}))},ke=async()=>{await re({pid:S.pid})},he=b(!0),K=b(!0),Z=b([]),Ze=[{title:"权重",key:"dtype",width:180,align:"center",render(d,y){return d.setStatus?l(Ee,{value:d.dtype,filterable:!0,placeholder:"请选择权重",options:H.data,labelField:"tname",valueField:"id",onUpdateValue(k){var E;Z.value[y].dtype=Number(k)||0,Z.value[y].debugname=((E=H.data.find(R=>R.id==k))==null?void 0:E.tname)||""},onScroll(k){qe(k)}}):l("div",{},d.tname)}},{title:"业务名称",key:"debugname",width:180,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.debugname,placeholder:"请输入业务名称",onUpdateValue(k){Z.value[y].debugname=k}}):l("div",{},d.debugname)}},{title:"状态",key:"status",width:120,align:"center",render(d,y){return d.setStatus&&d.id?l(Ee,{value:d.status,filterable:!0,placeholder:"请选择状态",options:oe.userInfo.usertype==0||oe.userInfo.usertype==2?[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}],onUpdateValue(k){Z.value[y].status=Number(k)||0}}):l(Zl,{type:d.status==0?"info":d.status==1||d.status==2?"warning":"success"},d.status==0?"待调试":d.status==1?"开始调试":d.status==2?"待审核":"审核完成")}},{key:"eqmname",title:"调试设备",align:"center",width:150,render(d,y){return l(Ee,{value:d.eqmid,placeholder:"请选择调试设备",options:w.data,onscroll:Se,labelField:"devname",valueField:"id",clearable:!0,filterable:!0,onUpdateValue(k){Z.value[y].eqmid=k}})}},{key:"docker",width:140,align:"center",title:()=>l("div",{style:"display:flex;align-items:center;justify-content:center;gap:6px;"},[l("span",null,"对接方"),l(Ml,{size:"small",checked:he.value,label:"联动",style:"margin-left: 10px;font-size: 12px;",onUpdateChecked:d=>{he.value=d}})]),render(d,y){var k;return d.setStatus?l(Ee,{value:d.docker,placeholder:"请输入或选择对接方",options:pe.data,onscroll:Fe,labelField:"docker",valueField:"value",clearable:!0,filterable:!0,tag:!0,onClear(){d.dockcharge="",d.dockcontact=""},onUpdateValue(E){var R;if(he.value)Z.value.forEach((ee,J)=>{var Pe;ee.docker=E;const[W,q]=(Pe=d.docker)==null?void 0:Pe.split("&id="),je=pe.data.find(D=>D.docker===W&&D.id===Number(q));je?(ee.dockcharge=je.pname,ee.dockcontact=je.pcontact):(ee.dockcharge="",ee.dockcontact="")});else{Z.value[y].docker=E;const[ee,J]=(R=d.docker)==null?void 0:R.split("&id="),W=pe.data.find(q=>q.docker===ee&&q.id===Number(J));W?(d.dockcharge=W.pname,d.dockcontact=W.pcontact):(d.dockcharge="",d.dockcontact="")}}}):l("div",{},(k=d.docker)==null?void 0:k.split("&id=")[0])}},{title:"对接方负责人",key:"dockcharge",width:100,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.dockcharge,placeholder:"请输入对接方负责人",onUpdateValue(k){Z.value[y].dockcharge=k}}):l("div",{},d.dockcharge)}},{title:"联系方式",key:"dockcontact",width:120,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.dockcontact,placeholder:"请输入联系方式",onUpdateValue(k){Z.value[y].dockcontact=k}}):l("div",{},d.dockcontact)}},{key:"dbcreater",width:140,align:"center",title:()=>l("div",{style:"display:flex;align-items:center;justify-content:center;gap:6px;"},[l("span",null,"调试人"),l(Ml,{size:"small",checked:K.value,label:"联动",style:"margin-left: 10px;font-size: 12px;",onUpdateChecked:d=>{K.value=d}})]),render(d,y){return d.setStatus?l(Ee,{value:d.dbcreater,filterable:!0,placeholder:"请选择调试人",options:we.data,labelField:"username",valueField:"id",onUpdateValue(k){K.value?Z.value.forEach((E,R)=>{E.dbcreater=k||0}):Z.value[y].dbcreater=k||0},onScroll(k){V(k)}}):l("div",{},d.dbusername)}},{title:"文件",key:"re1",width:100,align:"center",render(d,y){return d.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>P(d,y)},{default:()=>"上传文件"}):l(_t,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const k=[{alias:d.re1,file:d.fl1},{alias:d.re2,file:d.fl2},{alias:d.re3,file:d.fl3},{alias:d.re4,file:d.fl4}].filter(E=>E.alias||E.file);return k.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件")])]),l("tbody",k.map(E=>{var R;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},E.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((R=E.file)==null?void 0:R.split("?")[1])||"-")])}))])])}})}},{title:"备注",key:"notes",width:200,align:"center",render(d,y){return d.setStatus?l(ie,{value:d.notes,placeholder:"请输入备注",onUpdateValue(k){Z.value[y].notes=k}}):l("div",{},d.notes)}},{title:"计划开始时间",key:"starttime",width:200,align:"center",render(d,y){return d.setStatus?l(Ll,{type:"date",clearable:!0,value:d.starttime,valueFormat:"yyyy-MM-dd",placeholder:"请选择",onUpdateValue(k){Z.value[y].starttime=k}}):l("div",it(0,d.starttime))}},{title:"计划结束时间",key:"endtime",width:200,align:"center",render:(d,y)=>d.setStatus?l(Ll,{type:"date",clearable:!0,valueFormat:"yyyy-MM-dd",value:d.endtime,placeholder:"请选择",onUpdateValue(k){Z.value[y].endtime=k}}):it(0,d.endtime)},{key:"operate",title:X("common.operate"),align:"center",width:120,fixed:"right",render(d,y){return l("div",{class:"flex-center gap-8px"},[l(We,{onPositiveClick:()=>{Z.value.splice(y,1),O.value.splice(y,1)}},{default:()=>X("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>X("common.delete")})})])}}];function N(){r.value=!1}const O=b([]),ve=d=>{Z.value=[],d.forEach(y=>{var k;Z.value.push({debugname:(k=H.data.find(E=>E.id==y))==null?void 0:k.tname,docker:void 0,dockcharge:"",dockcontact:"",debugresult:0,status:0,notes:"",dbcreater:void 0,dtype:y,setStatus:!0,pid:S.pid,starttime:null,endtime:null})})},He=b(!1);async function c(){var k,E,R,ee,J,W,q,je;const d=["dtype","debugname","docker","dbcreater"];if(Z.value.find(Pe=>d.some(D=>!Pe[D]||Pe[D].toString().trim()===""))){(E=(k=window.$message)==null?void 0:k.error)==null||E.call(k,"请完整填写所有必填项（权重、业务名称、对接方、调试人）");return}He.value=!0;try{const Pe=[];for(const $ of Z.value){if(!Array.isArray($.fileList)||$.fileList.length===0)continue;const M=$.fileList.filter(ge=>ge.file&&typeof ge.file=="object"),ae=M.length;for(let ge=0;ge<ae;ge++){const Y=M[ge];Y.indexText=`${ge+1}/${ae}`,Y.progress=0,Y.status="uploading";try{Y.url=await $t(Y.file.file||Y.file,Y.file.name||Y.name,""),Y.progress=100,Y.status="done"}catch{Y.status="error",Pe.push(Y)}}$.fileList.forEach((ge,Y)=>{const Ie=`re${Y+1}`,Ge=`fl${Y+1}`;ge.status==="done"?($[Ie]=ge.name||"",$[Ge]=ge.url||""):($[Ie]="",$[Ge]="")}),delete $.fileList}if(Pe.length){(ee=(R=window.$message)==null?void 0:R.warning)==null||ee.call(R,`有 ${Pe.length} 个文件上传失败，可重新提交重试`);return}const D=Z.value.map($=>{var M;return{...$,starttime:it(0,$.starttime),endtime:it(0,$.endtime),docker:(M=$.docker)==null?void 0:M.split("&id=")[0]}}),{error:o}=await La(D);o||((W=(J=window.$message)==null?void 0:J.success)==null||W.call(J,"添加成功"),N(),fe("submitted"))}catch(Pe){console.error(Pe),(je=(q=window.$message)==null?void 0:q.error)==null||je.call(q,"提交失败，请稍后重试")}finally{He.value=!1}}const L=b(!1),T=b(),P=(d,y)=>{L.value=!0,T.value=y,d.fileList&&d.fileList.length>0?v.value=d.fileList:v.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]},h=[{title:"",key:"",align:"center",width:80,render(d,y){return`附件${y+1}`}},{title:"文件名称",key:"filename",align:"center",render(d){var E;const y=async({file:R,onFinish:ee,onError:J})=>{var W,q;try{d.name=R.name,d.file=R}catch(je){console.error(je),(q=(W=window.$message)==null?void 0:W.error)==null||q.call(W,"文件上传出错")}};async function k(R){return!0}return l("div",{style:"display:flex;justify-content:center;align-items:center;"},[d.file||d.url?l("span",{},[l("span",{},((E=d.file)==null?void 0:E.name)||d.url.split("?")[1]||""),l("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{d.url="",d.file=null}},"删除")]):l(sl,{action:"#",showFileList:!1,customRequest:y,onBeforeUpload:k},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:d.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(d){return l(ie,{value:d.name,clearable:!0,onUpdateValue:y=>{d.name=y}})}}],v=b([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]),G=async()=>{var y,k;let d=!0;if(v.value.forEach((E,R)=>{var W,q;const ee=E.name||"",J=((W=E.url)==null?void 0:W.split("?")[1])||((q=E.file)==null?void 0:q.name);(ee&&!J||!ee&&J)&&(d=!1)}),!d){(k=(y=window.$message)==null?void 0:y.error)==null||k.call(y,"文件名称和文件地址必须同时存在，不能只填一个");return}Z.value[T.value].fileList=v.value,d&&(L.value=!1,T.value=void 0)},Q=()=>{L.value=!1};return(d,y)=>{const k=wl,E=lt,R=il,ee=ct("loading");return u(),x(Je,null,[a(R,{show:r.value,"onUpdate:show":y[1]||(y[1]=J=>r.value=J),title:ne.value,preset:"card",class:"w-80%","mask-closable":!1,draggable:!0},{footer:s(()=>[a(p(Oe),{justify:"end",size:16},{default:s(()=>[a(p(_),{onClick:N},{default:s(()=>[m(j(p(X)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",onClick:c},{default:s(()=>[m(j(p(X)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(k,{label:"权重","label-placement":"left"},{default:s(()=>[a(p(Ee),{filterable:"",multiple:"",value:O.value,"onUpdate:value":[y[0]||(y[0]=J=>O.value=J),ve],tag:"",style:{width:"300px"},placeholder:"请选择权重","label-field":"tname","value-field":"id",options:p(H).data,onScroll:qe},null,8,["value","options"])]),_:1}),Be(a(E,{style:{width:"100%"},columns:Ze,data:Z.value,size:"small","row-key":J=>J.id,striped:"","scroll-x":Ze.reduce((J,W)=>J+W.width,0),"max-height":350},null,8,["data","row-key","scroll-x"]),[[ee,He.value]])]),_:1},8,["show","title"]),a(R,{show:L.value,"onUpdate:show":y[2]||(y[2]=J=>L.value=J),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:s(()=>y[3]||(y[3]=[m(" 待调试业务文件列表 ")])),footer:s(()=>[a(p(Oe),{justify:"end"},{default:s(()=>[a(p(_),{size:"small",class:"mt-16px",onClick:Q},{default:s(()=>[m(j(p(X)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",size:"small",class:"mt-16px",onClick:G},{default:s(()=>[m(j(p(X)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(E,{columns:h,"paginate-single-page":!1,data:v.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])],64)}}}),Ci=Nt({name:"deviceModal",__name:"deviceModal",props:Cl({pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Cl(["submitted"],["update:visible"]),setup(_e,{emit:F}){const fe=F;Ot();const oe=_e;async function S(){r(),Le.value=[],le.value=[]}const De=xa(_e,"visible");Vt(De,()=>{De.value&&S()});const ne=b([]),r=async()=>{var T,P;const{data:c,error:L}=await Xl({page:1,limit:100,id:oe.pid});if(c){if(ne.value=c==null?void 0:c.list.map(h=>({value:h.id,label:h.contractname,isLeaf:!1})),ne.value.length==0)return(T=window.$message)==null?void 0:T.error("该项目没有绑定合同！");Me((P=c==null?void 0:c.list[0])==null?void 0:P.id)}},H=b([]),ce=b(),{pageData:Ne,getData:qe,nextPage:pe}=pt(wa),Me=async c=>{await qe({pids:c}),ce.value=[],H.value=Array.from(new Set([...H.value,...Ne.data])),ce.value=Ne.data.map(L=>({label:L.devname,value:L.id}))},Ce=async c=>{var L;await Me(c.value),c.children=(L=ce.value)==null?void 0:L.map(T=>({label:T.label,value:T.value,isLeaf:!0})),await yt(),setTimeout(()=>{const T=document.querySelectorAll(".n-cascader-submenu-wrapper .n-scrollbar");console.log(T[1]),T[1]&&(T[1].removeEventListener("scroll",he),T[1].addEventListener("scroll",he))},2e3)};function Fe(c,L){const T=c.filter(h=>!L.includes(h)),P=L.filter(h=>!c.includes(h));return{toDelete:T,toAdd:P}}const Ke=b([]),we=async c=>{const{toDelete:L,toAdd:T}=Fe(Ke.value,c);L.forEach(P=>{const h=le.value.findIndex(v=>v.cid==P);h!=-1&&le.value.splice(h,1)}),T.forEach(async P=>{var h,v,G,Q,d,y,k,E,R,ee,J,W,q,je,Pe,D;le.value.push({devname:((v=(h=H.value)==null?void 0:h.find(o=>o.id==P))==null?void 0:v.devname)||"",devmodel:((Q=(G=H.value)==null?void 0:G.find(o=>o.id==P))==null?void 0:Q.devmodel)||"",devnum:((y=(d=H.value)==null?void 0:d.find(o=>o.id==P))==null?void 0:y.devcount)||0,devmanu:((E=(k=H.value)==null?void 0:k.find(o=>o.id==P))==null?void 0:E.devmanu)||"",etype:((ee=(R=H.value)==null?void 0:R.find(o=>o.id==P))==null?void 0:ee.etype)||0,status:0,devunit:((W=(J=H.value)==null?void 0:J.find(o=>o.id==P))==null?void 0:W.devunit)||"",notes:((je=(q=H.value)==null?void 0:q.find(o=>o.id==P))==null?void 0:je.notes)||"",setStatus:!0,cid:P,pid:oe.pid,devnumber:((D=(Pe=H.value)==null?void 0:Pe.find(o=>o.id==P))==null?void 0:D.devcount)||0})}),Ke.value=c},Le=b([]),le=b([]),ze=[{title:"绑定合同设备",key:"cid",width:300,align:"center",render(c,L){var T,P;return c.setStatus?l(Hl,{style:"width: 270px",value:c.cid,filterable:!0,placeholder:"请选择合同设备",options:ne.value,checkStrategy:"child",showPath:!1,remote:!0,onLoad:Ce,onUpdateValue(h){var G;le.value[L].cid=Number(h)||0;const v=(G=H.value)==null?void 0:G.find(Q=>Q.id==h);c.devname=(v==null?void 0:v.devname)||"",c.devnum=(v==null?void 0:v.devcount)||"",c.notes=(v==null?void 0:v.notes)||"",c.devnumber=(v==null?void 0:v.devcount)||0,c.etype=(v==null?void 0:v.devtype)||0,c.devmanu=(v==null?void 0:v.devmanu)||"",c.devmodel=((v==null?void 0:v.devmodel.length)>64?v==null?void 0:v.devname:v==null?void 0:v.devmodel)||"",c.devunit=(v==null?void 0:v.devunit)||""}}):l("div",{},c.devname2||((P=(T=ce.value)==null?void 0:T.find(h=>h.value==c.cid))==null?void 0:P.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(c,L){return c.setStatus?l(ie,{value:c.devname,placeholder:"请输入",onUpdateValue(T){le.value[L].devname=T}}):l("div",{},c.devname)}},{title:"型号",key:"devmodel",width:220,align:"center",render(c,L){return l("div",{},c.devmodel)}},{title:"设备单位",key:"devunit",width:120,align:"center",render(c,L){return l("div",{},c.devunit)}},{title:"数量",key:"devnum",width:100,align:"center",render(c,L){return c.setStatus?l(Sa,{value:c.devnum,placeholder:"请输入",max:c.devnumber,onUpdateValue(T){le.value[L].devnum=T}}):l("div",{},c.devnum)}},{title:"是否为我司设备",key:"etype",width:260,align:"center",render(c,L){return l("div",{},c.etype==0?"是":"否")}},{title:"设备厂家",key:"devmanu",width:200,align:"center",render(c,L){return l("div",{},c.devmanu)}},{title:"清点状态",key:"status",width:120,align:"center",render(c,L){return c.setStatus&&c.id?l(Ee,{value:c.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(T){le.value.debuggedDevieceList[L].status=Number(T)||0}}):l("div",{},c.status===0?"未清点":c.status===1?"正常":c.status===2?"增补":c.status===3?"退货":"换货")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(c,L){return l("div",{},c.devmanu)}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(c,L){return c.setStatus?l(ie,{value:c.manucontact,placeholder:"请输入",onUpdateValue(T){le.value[L].manucontact=T}}):l("div",{},c.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(c,L){return c.setStatus?l(ie,{value:c.manuinfo,placeholder:"请输入",onUpdateValue(T){le.value[L].manuinfo=T}}):l("div",{},c.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(c,L){return c.setStatus&&c.id?l(Ee,{value:c.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(T){le.value[L].devstatus=Number(T)||0}}):l("div",{},c.devstatus===0?"设备无异常":c.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(c,L){return c.setStatus?l(ie,{value:c.connectionmode,placeholder:"请输入",onUpdateValue(T){le.value[L].connectionmode=T}}):l("div",{},c.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(c,L){return c.setStatus&&c.id?l(Ee,{value:c.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(T){le.value[L].install=Number(T)||0}}):l("div",{},c.install===0?"是":"否")}},{title:"备注",key:"notes",width:200,align:"center",render(c,L){return l("div",{},c.notes)}},{title:"文件",key:"re1",width:160,align:"center",render(c,L){return c.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ze(c,L)},{default:()=>"上传文件"}):l(_t,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const T=[{alias:c.re1,file:c.fl1},{alias:c.re2,file:c.fl2},{alias:c.re3,file:c.fl3},{alias:c.re4,file:c.fl4}].filter(P=>P.alias||P.file);return T.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件")])]),l("tbody",T.map(P=>{var h;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},P.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((h=P.file)==null?void 0:h.split("?")[1])||"-")])}))])])}})}},{title:"操作信息",key:"dbtime",width:180,align:"center",render(c,L){return l(_t,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},c.dbtime?it(1,c.dbtime):""),default:()=>l("div",{style:"padding: 10px;"},a("div",null,[a("div",null,[m("操作人："),c.username]),a("div",null,[m("操作时间："),c.dbtime]),a("div",null,[m("清点人："),c.dusername]),a("div",null,[m("清点时间："),c.ddbtime])]))})}},{key:"operate",title:X("common.operate"),align:"center",width:180,fixed:"right",render(c,L){return l("div",{class:"flex-center gap-8px"},[l(We,{onPositiveClick:()=>{c.id||(le.value.splice(L,1),Le.value.splice(L,1))}},{default:()=>X("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>X("common.delete")})})])}}];function V(){De.value=!1}const w=b(!1);async function re(){var T,P,h,v,G,Q,d,y;const c=["cid","devname","devnum"];if(le.value.find(k=>c.some(E=>!k[E]||k[E].toString().trim()===""))){(P=(T=window.$message)==null?void 0:T.error)==null||P.call(T,"请完整填写所有必填项（合同设备、设备名称、数量）");return}if(!w.value){w.value=!0;try{const k=[];for(const R of le.value){if(!Array.isArray(R.fileList)||R.fileList.length===0)continue;const ee=R.fileList.filter(W=>W.file&&typeof W.file=="object"),J=ee.length;for(let W=0;W<J;W++){const q=ee[W];q.indexText=`${W+1}/${J}`,q.progress=0,q.status="uploading";try{q.url=await $t(q.file.file||q.file,q.file.name||q.name,""),q.progress=100,q.status="done"}catch{q.status="error",k.push(q)}}R.fileList.forEach((W,q)=>{const je=`re${q+1}`,Pe=`fl${q+1}`;W.status==="done"?(R[je]=W.name||"",R[Pe]=W.url||""):(R[je]="",R[Pe]="")}),delete R.fileList}if(k.length){(v=(h=window.$message)==null?void 0:h.warning)==null||v.call(h,`有 ${k.length} 个文件上传失败，请重新提交`);return}const{error:E}=await $a(le.value);E||((Q=(G=window.$message)==null?void 0:G.success)==null||Q.call(G,"添加成功"),V(),fe("submitted"))}catch(k){console.error(k),(y=(d=window.$message)==null?void 0:d.error)==null||y.call(d,"提交失败，请稍后再试")}finally{w.value=!1}}}const xe=async c=>{},Se=b(!1),ke=b(!0),he=async c=>{console.log(c);const L=c.target;L.scrollHeight-L.scrollTop-L.clientHeight<10&&!Se.value&&ke.value&&(Se.value=!0,pe(),ce.value=Ne.data.map(P=>({label:P.devname,value:P.id})),Se.value=!1)},K=b(!1),Z=b(),Ze=(c,L)=>{K.value=!0,Z.value=L,c.fileList&&c.fileList.length>0?O.value=c.fileList:O.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]},N=[{title:"",key:"",align:"center",width:80,render(c,L){return`附件${L+1}`}},{title:"文件名称",key:"filename",align:"center",render(c){var P;const L=async({file:h,onFinish:v,onError:G})=>{var Q,d;try{c.name=h.name,c.file=h}catch(y){console.error(y),(d=(Q=window.$message)==null?void 0:Q.error)==null||d.call(Q,"文件上传出错")}};async function T(h){return!0}return l("div",{style:"display:flex;justify-content:center;align-items:center;"},[c.file||c.url?l("span",{},[l("span",{},((P=c.file)==null?void 0:P.name)||c.url.split("?")[1]||""),l("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{c.url="",c.file=null}},"删除")]):l(sl,{action:"#",showFileList:!1,customRequest:L,onBeforeUpload:T},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:c.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(c){return l(ie,{value:c.name,clearable:!0,onUpdateValue:L=>{c.name=L}})}}],O=b([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]),ve=async()=>{var L,T;let c=!0;if(O.value.forEach((P,h)=>{var Q,d;const v=P.name||"",G=((Q=P.url)==null?void 0:Q.split("?")[1])||((d=P.file)==null?void 0:d.name);(v&&!G||!v&&G)&&(c=!1)}),!c){(T=(L=window.$message)==null?void 0:L.error)==null||T.call(L,"文件名称和文件地址必须同时存在，不能只填一个");return}le.value[Z.value].fileList=O.value,c&&(K.value=!1,Z.value=void 0)},He=()=>{K.value=!1};return(c,L)=>{const T=wl,P=lt,h=il,v=ct("loading");return u(),x(Je,null,[a(h,{show:De.value,"onUpdate:show":L[1]||(L[1]=G=>De.value=G),title:"新增待调试设备",preset:"card",class:"w-80%","mask-closable":!1,draggable:!0},{footer:s(()=>[a(p(Oe),{justify:"end",size:16},{default:s(()=>[a(p(_),{onClick:V},{default:s(()=>[m(j(p(X)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",onClick:re},{default:s(()=>[m(j(p(X)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(T,{label:"合同设备","label-placement":"left"},{default:s(()=>[a(p(Hl),{value:Le.value,"onUpdate:value":[L[0]||(L[0]=G=>Le.value=G),we],placeholder:"请选择合同设备",options:ne.value,"check-strategy":"child","show-path":!1,labelKey:"label",remote:"",multiple:"",style:{width:"300px"},"on-load":Ce,"onUpdate:show":xe},null,8,["value","options"])]),_:1}),Be(a(P,{style:{width:"100%"},columns:ze,data:le.value,size:"small","row-key":G=>G.id,striped:"","scroll-x":ze.reduce((G,Q)=>G+Q.width,0),"max-height":350},null,8,["data","row-key","scroll-x"]),[[v,w.value]])]),_:1},8,["show"]),a(h,{show:K.value,"onUpdate:show":L[2]||(L[2]=G=>K.value=G),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:s(()=>L[3]||(L[3]=[m(" 待调试设备文件列表 ")])),footer:s(()=>[a(p(Oe),{justify:"end"},{default:s(()=>[a(p(_),{size:"small",class:"mt-16px",onClick:He},{default:s(()=>[m(j(p(X)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",size:"small",class:"mt-16px",onClick:ve},{default:s(()=>[m(j(p(X)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(P,{columns:N,"paginate-single-page":!1,data:O.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])],64)}}}),Li={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Si(_e,F){return u(),x("svg",Li,F[0]||(F[0]=[g("path",{fill:"currentColor",d:"M11 13H5v-2h6V5h2v6h6v2h-6v6h-2z"},null,-1)]))}const wi=kt({name:"material-symbols-add",render:Si}),$i={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Di(_e,F){return u(),x("svg",$i,F[0]||(F[0]=[g("path",{fill:"currentColor",d:"M10.825 22q-.675 0-1.162-.45t-.588-1.1L8.85 18.8q-.325-.125-.612-.3t-.563-.375l-1.55.65q-.625.275-1.25.05t-.975-.8l-1.175-2.05q-.35-.575-.2-1.225t.675-1.075l1.325-1Q4.5 12.5 4.5 12.337v-.675q0-.162.025-.337l-1.325-1Q2.675 9.9 2.525 9.25t.2-1.225L3.9 5.975q.35-.575.975-.8t1.25.05l1.55.65q.275-.2.575-.375t.6-.3l.225-1.65q.1-.65.588-1.1T10.825 2h2.35q.675 0 1.163.45t.587 1.1l.225 1.65q.325.125.613.3t.562.375l1.55-.65q.625-.275 1.25-.05t.975.8l1.175 2.05q.35.575.2 1.225t-.675 1.075l-1.325 1q.025.175.025.338v.674q0 .163-.05.338l1.325 1q.525.425.675 1.075t-.2 1.225l-1.2 2.05q-.35.575-.975.8t-1.25-.05l-1.5-.65q-.275.2-.575.375t-.6.3l-.225 1.65q-.1.65-.587 1.1t-1.163.45zm1.225-6.5q1.45 0 2.475-1.025T15.55 12t-1.025-2.475T12.05 8.5q-1.475 0-2.488 1.025T8.55 12t1.013 2.475T12.05 15.5"},null,-1)]))}const zi=kt({name:"material-symbols-settings-rounded",render:Di}),ji={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ui(_e,F){return u(),x("svg",ji,F[0]||(F[0]=[g("path",{fill:"currentColor",d:"m10.6 16.6l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const Bi=kt({name:"material-symbols-check-circle-outline",render:Ui}),Fi={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Pi(_e,F){return u(),x("svg",Fi,F[0]||(F[0]=[g("path",{fill:"currentColor",d:"M8 16h2V8H8zm4 0l6-4l-6-4zm0 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const Ii=kt({name:"material-symbols-not-started-outline",render:Pi}),Ni={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ti(_e,F){return u(),x("svg",Ni,F[0]||(F[0]=[g("path",{fill:"currentColor",d:"M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.2 0 .375.038t.35.112L17.875 5H5v14h14v-6.65l2-2V19q0 .825-.587 1.413T19 21zm6.525-4l-5.65-5.65l1.4-1.4l4.25 4.25L20.7 5.025L22.125 6.4z"},null,-1)]))}const Ei=kt({name:"material-symbols-select-check-box",render:Ti}),Ai={class:"w-500px whitespace-normal"},Vi={style:{display:"flex",alignItems:"center",justifyContent:"space-between",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Oi={key:1,style:{display:"none"}},qi={key:1,style:{display:"none"}},Mi={key:1,style:{display:"none"}},Ri={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Ji={style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Hi={class:"flex items-center"},Gi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Wi={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Ki={class:"flex items-center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},Qi={style:{display:"flex","align-items":"center",width:"100%",gap:"8px"}},Yi={style:{"font-weight":"500",color:"#333","margin-bottom":"4px"}},Xi={style:{"font-size":"13px",color:"#666"}},Zi={class:"flex items-center",style:{position:"absolute",top:"50%",transform:"translateY(-50%)"}},eo={style:{display:"flex","align-items":"center",width:"100%",gap:"8px"}},to={style:{"font-weight":"500",color:"#333"}},lo={style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},ao={class:"flex-col w-100%"},no={class:"w-100px"},so=2,io=Nt({__name:"prjDetail",props:{prjDetailInfo:{},pid:{},userList:{}},emits:["searchDetail"],setup(_e,{expose:F,emit:fe}){const oe=Ot(),S=_e,De=fe,ne=b(!1),r=st({}),H=async(D,o)=>{var ae;const{data:$,error:M}=await da([{id:D.id,status:o}]);M||((ae=window.$message)==null||ae.success("操作成功"),De("searchDetail"))},ce=b([]),Ne=async()=>{const{data:D,error:o}=await $n();D&&(ce.value=D)},qe=D=>{Ce(D),r.region=void 0,r.prosite="",r.proaddr="",ke.value=""},pe=D=>{var $;const o=($=Me.value.find(M=>M.id===D))==null?void 0:$.name;He(o)},Me=b([]),Ce=async D=>{var M;if(!D)return(M=window.$message)==null?void 0:M.warning("请先选择省份");const{data:o,error:$}=await Cn({province:D});o&&(Me.value=o)};Vt(()=>S.prjDetailInfo,async D=>{Object.assign(r,D),console.log(r)},{immediate:!0,deep:!0});const Fe=b(!1),Ke=b();let we=null,Le=null,le=null,ze=null,V=null,w=null;const re=st({longitude:0,latitude:0});let xe;const Se=b(!1),ke=b(""),he=b([]);let K=0;async function Z(){try{if(window._AMapSecurityConfig={securityJsCode:oe.userInfo.sdksecret},!Ke.value)return;w=await hs.load({key:oe.userInfo.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),we=new w.Map(Ke.value,{zoom:18,center:[O.value>0?P.value[O.value-1].longitude:r.longitude,O.value>0?P.value[O.value-1].latitude:r.latitude],viewMode:"3D",resizeEnable:!0}),Le=new w.Geocoder,ze=new w.PlaceSearch({city:"全国",pageSize:50}),V=new w.AutoComplete({city:"全国"}),c(w,{lng:O.value>0?P.value[O.value-1].longitude:r.longitude,lat:O.value>0?P.value[O.value-1].latitude:r.latitude}),we.on("click",D=>{const{lng:o,lat:$}=D.lnglat;xe=2,re.latitude=$,re.longitude=o,c(w,{lng:o,lat:$})}),K=0,yt(()=>{window.dispatchEvent(new Event("resize"))})}catch(D){console.error("地图加载失败：",D),K<so?(K++,console.warn(`地图加载失败，正在第 ${K} 次重试...`),setTimeout(()=>{Z()},1500)):console.error("地图加载失败，已达到最大重试次数，停止重试")}}const Ze=Ql.debounce(async D=>{if(!D.trim()){he.value=[];return}V.search(D,(o,$)=>{var M;console.log($,"result"),o=="complete"&&$.info=="OK"&&((M=$==null?void 0:$.tips)!=null&&M.length)?he.value=$.tips.map(ae=>({label:`${ae.name}（${ae.district||ae.address||"无详细地址"}）`,value:`${ae.location.lng}_${ae.location.lat}`,raw:ae})):he.value=[]})},300);Vt(ke,D=>{Ze(D)});function N(D,o){if(console.log(D,o,"option"),!D)return;const[$,M]=D.split("_").map(Number);!$||!M||(we.setCenter([$,M]),xe=1,c(w,{lng:$,lat:M}),re.longitude=$,re.latitude=M)}const O=b(0);async function ve(D){D?O.value=D:O.value=0,await Ne(),Fe.value=!0,Se.value=!1,xe=void 0,r.proaddr=S.prjDetailInfo.proaddr,r.prosite=S.prjDetailInfo.prosite,r.provice=S.prjDetailInfo.provice,r.region=S.prjDetailInfo.region,r.provice&&Ce(r.provice),yt(async()=>{await Z(),setTimeout(()=>{Se.value=!0;const o=document.querySelector(".n-auto-complete input");o==null||o.blur()},500)})}function He(D){!D||!Le||!we||Le.getLocation(D,(o,$)=>{var M;if(o==="complete"&&((M=$.geocodes)!=null&&M.length)){const{location:ae,formattedAddress:ge}=$.geocodes[0],Y=ae.lng,Ie=ae.lat;we.setZoomAndCenter(14,[Y,Ie]),re.longitude=Y,re.latitude=Ie,c(w,{lng:Y,lat:Ie}),r.proaddr=ge,r.prosite=ge,ke.value=ge}})}function c(D,o){le&&we.remove(le),le=new D.Marker({position:[o.lng,o.lat],map:we}),we.add(le),Le.getAddress(o,async($,M)=>{$==="complete"&&M.regeocode&&(console.log("result",M),console.log("formattedAddress",M.regeocode.formattedAddress),o.latitude=o.lat,o.longitude=o.lng,xe==1?(r.proaddr=M.regeocode.formattedAddress,r.provice=k(r.proaddr,ce.value),await Ce(r.provice),r.region=E(r.proaddr,Me.value)):xe==2?(ke.value=M.regeocode.formattedAddress,r.proaddr=M.regeocode.formattedAddress,r.provice=k(r.proaddr,ce.value),await Ce(r.provice),r.region=E(r.proaddr,Me.value)):ke.value=O.value>0?P.value[O.value-1].addr||M.regeocode.formattedAddress:r.prosite||M.regeocode.formattedAddress)})}function L(){Fe.value=!1}const T=async()=>{var D,o,$,M;if(O.value==0){r.latitude=re.latitude,r.longitude=re.longitude,r.prosite=ke.value,Fe.value=!1;const{data:ae,error:ge}=await da([{prosite:r.prosite,latitude:r.latitude,longitude:r.longitude,proaddr:r.proaddr,provice:r.provice,region:r.region,id:r.id}]);ae&&((D=window.$message)==null||D.success("修改位置成功"),De("searchDetail"))}else{P.value[O.value-1].addr=ke.value,P.value[O.value-1].latitude=re.latitude,P.value[O.value-1].longitude=re.longitude;let ae=P.value[O.value-1];if(P.value[O.value-1].id){const{data:ge,error:Y}=await Dn([ae]);ge&&((o=window.$message)==null||o.success("修改位置成功"),Fe.value=!1,O.value=0,Q())}else{ae.pid=($=S.prjDetailInfo)==null?void 0:$.id;const{data:ge,error:Y}=await zn([ae]);ge&&((M=window.$message)==null||M.success("添加位置成功"),Fe.value=!1,O.value=0,Q())}}},P=b([{latitude:30.303899,longitude:120.373885,addr:""}]),h=b([]),v=b(!1),G=()=>{v.value=!0,Q()},Q=async()=>{var $,M;if(!(($=S.prjDetailInfo)!=null&&$.id))return;const{data:D,error:o}=await Ln({pid:(M=S.prjDetailInfo)==null?void 0:M.id,page:1,limit:100});D&&(D.list.length>0?(P.value=D.list,h.value=JSON.parse(JSON.stringify(D.list))):P.value=[{longitude:120.373885,latitude:30.303899,addr:""}])},d=()=>{v.value=!1},y=async D=>{var o;if(D.id){const{data:$,error:M}=await jn(D.id);$&&((o=window.$message)==null||o.success("删除成功"),Q())}else P.value.splice(P.value.indexOf(D),1)};function k(D,o){let $=null;for(const M of o)if(D.includes(M.name)){$=M.id;break}return $}function E(D,o){let $=null;for(const M of o)if(D.includes(M.name)){$=M.id;break}return $}const R=b([]),ee=b([]),J=b([]),W=async()=>{const{data:D,error:o}=await Sn({pid:S.pid,page:1,limit:100});D&&(R.value=D.list,ee.value=D.list.map($=>$.participant),J.value=JSON.parse(JSON.stringify(D.list.map($=>$.participant))))};Vt(()=>S.pid,async()=>{S.pid&&W()});const q=b(!1),je=()=>{q.value=!0},Pe=async()=>{var ae,ge,Y;const D=ee.value||[],o=J.value||[],$=D.filter(Ie=>!o.includes(Ie)),M=o.filter(Ie=>!D.includes(Ie));if($.length===0&&M.length===0){(ae=window.$message)==null||ae.info("未做任何修改"),q.value=!1;return}try{if($.length>0){const{data:Ie,error:Ge}=await Un($.map(Ct=>({pid:S.pid,participant:Ct})));if(Ge)return}if(M.length>0){const Ie=R.value.filter(ot=>M.includes(ot.participant)).map(ot=>ot.id).join(","),{data:Ge,error:Ct}=await Bn(Ie);if(Ct)return}(ge=window.$message)==null||ge.success("设置成功"),q.value=!1,await W()}catch(Ie){console.error(Ie),(Y=window.$message)==null||Y.error("设置失败，请重试")}};return F({getProjectUserList:W}),(D,o)=>{const $=_s,M=Ei,ae=_,ge=We,Y=Ii,Ie=Bi,Ge=kl,Ct=Zl,ot=zi,$l=bs,Dl=Gl,qt=Wl,ol=Ee,Mt=wl,Ue=Oe,rl=vs,ft=ie,Rt=il,zl=wi,jl=ys,Ul=wn,Bl=ms,Ae=Ml,dl=xs,ht=Ua,Fl=kn,ul=ct("no-auth");return u(),x(Je,null,[a($l,{bordered:"","label-placement":"left","label-align":"center",columns:4,"label-style":{width:"130px"}},{default:s(()=>[a($,null,{label:s(()=>o[23]||(o[23]=[m(" 项目名称 ")])),default:s(()=>{var z;return[g("div",Ai,j((z=S.prjDetailInfo)==null?void 0:z.proname),1)]}),_:1}),a($,{"content-style":{position:"relative",width:"220px"}},{label:s(()=>o[24]||(o[24]=[m(" 项目状态 ")])),default:s(()=>{var z,Re,f,Jt,et,Tt,Lt,cl,pl,Dt,fl;return[g("div",Vi,[((z=S.prjDetailInfo)==null?void 0:z.status)!==void 0?(u(),x("div",{key:0,style:xt({display:"flex",alignItems:"center",justifyContent:"center",marginRight:"20px",color:((Re=S.prjDetailInfo)==null?void 0:Re.status)==-1?"#a43cf9":((f=S.prjDetailInfo)==null?void 0:f.status)===0?"#9ca3af":((Jt=S.prjDetailInfo)==null?void 0:Jt.status)===1?"#3498db":((et=S.prjDetailInfo)==null?void 0:et.status)===2?"#facc15":"#22c55e",borderRadius:"50%"})},[g("span",{style:xt({width:"10px",height:"10px",marginRight:"5px",backgroundColor:((Tt=S.prjDetailInfo)==null?void 0:Tt.status)==-1?"#a43cf9":((Lt=S.prjDetailInfo)==null?void 0:Lt.status)===0?"#9ca3af":((cl=S.prjDetailInfo)==null?void 0:cl.status)===1?"#3498db":((pl=S.prjDetailInfo)==null?void 0:pl.status)===2?"#facc15":"#22c55e",borderRadius:"50%"})},null,4),g("span",null,j(p(ga)[(Dt=S.prjDetailInfo)==null?void 0:Dt.status]?D.$t(p(ga)[(fl=S.prjDetailInfo)==null?void 0:fl.status]):""),1)],4)):C("",!0),a(ge,{onPositiveClick:o[0]||(o[0]=Qe=>H(S.prjDetailInfo,0))},{trigger:s(()=>{var Qe;return[(p(oe).userInfo.usertype==0||p(oe).userInfo.usertype==4||p(oe).userInfo.id==1021||p(oe).userInfo.id==1023)&&((Qe=S.prjDetailInfo)==null?void 0:Qe.status)==-1?(u(),I(ae,{key:0,size:"small",ghost:"",color:"#a43cf9"},{icon:s(()=>[a(M,{class:"text-icon"})]),default:s(()=>[o[25]||(o[25]=m(" 核准 "))]),_:1,__:[25]})):(u(),x("span",Oi))]}),default:s(()=>[o[26]||(o[26]=m(" 确定核准该项目吗？ "))]),_:1,__:[26]}),a(ge,{onPositiveClick:o[1]||(o[1]=Qe=>H(S.prjDetailInfo,1))},{trigger:s(()=>{var Qe;return[(p(oe).userInfo.usertype==0||p(oe).userInfo.usertype==2)&&((Qe=S.prjDetailInfo)==null?void 0:Qe.status)==0?Be((u(),I(ae,{key:0,size:"small",ghost:"",type:"success"},{icon:s(()=>[a(Y,{class:"text-icon"})]),default:s(()=>[o[27]||(o[27]=m(" 启动 "))]),_:1,__:[27]})),[[ul,"project:Info:update"]]):(u(),x("span",qi))]}),default:s(()=>[o[28]||(o[28]=m(" 确定启动该项目吗？ "))]),_:1,__:[28]}),a(ge,{onPositiveClick:o[2]||(o[2]=Qe=>H(S.prjDetailInfo,3))},{trigger:s(()=>{var Qe;return[(p(oe).userInfo.usertype==0||p(oe).userInfo.usertype==2)&&((Qe=S.prjDetailInfo)==null?void 0:Qe.status)==2?Be((u(),I(ae,{key:0,size:"small",ghost:"",type:"warning"},{icon:s(()=>[a(Ie,{class:"text-icon"})]),default:s(()=>[o[29]||(o[29]=m(" "+j("审核")))]),_:1,__:[29]})),[[ul,"project:Info:update"]]):(u(),x("span",Mi))]}),default:s(()=>[o[30]||(o[30]=m(" 是否确认执行审核操作？ "))]),_:1,__:[30]})])]}),_:1}),a($,{"content-style":{position:"relative",width:"200px"}},{label:s(()=>o[31]||(o[31]=[m(" 项目进度 ")])),default:s(()=>{var z;return[g("div",Ri,[a(Ge,{type:"line",percentage:(z=S.prjDetailInfo)==null?void 0:z.progess,"indicator-placement":"inside","show-indicator":"",processing:"",style:{width:"140px"},color:"#1890ff"},null,8,["percentage"])])]}),_:1}),a($,{"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[32]||(o[32]=[m(" 调试类型 ")])),default:s(()=>[g("div",Ji,[a(Ct,{size:"small",type:"info"},{default:s(()=>{var z,Re;return[m(j(p(ma)[(z=S.prjDetailInfo)==null?void 0:z.dtype]?D.$t(p(ma)[(Re=S.prjDetailInfo)==null?void 0:Re.dtype]):""),1)]}),_:1})])]),_:1}),ne.value?(u(),I($,{key:0},{label:s(()=>o[33]||(o[33]=[m(" 预计完成日期 ")])),default:s(()=>{var z;return[g("div",Hi,j((z=S.prjDetailInfo)==null?void 0:z.cpdbtime),1)]}),_:1})):C("",!0),ne.value?(u(),I($,{key:1,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[34]||(o[34]=[m(" 进度状态 ")])),default:s(()=>[g("div",Gi,[a(Ct,{size:"small",type:S.prjDetailInfo.ptype==0?"success":"warning"},{default:s(()=>[m(j(S.prjDetailInfo.ptype==0?"正常":"已延期"),1)]),_:1},8,["type"])])]),_:1})):C("",!0),ne.value?(u(),I($,{key:2,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[35]||(o[35]=[m(" 周期 ")])),default:s(()=>{var z,Re;return[g("div",Wi,[g("span",null,j((z=S.prjDetailInfo)!=null&&z.period?((Re=S.prjDetailInfo)==null?void 0:Re.period)+"天":""),1)])]}),_:1})):C("",!0),ne.value?(u(),I($,{key:3,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[36]||(o[36]=[m(" 调度名称 ")])),default:s(()=>{var z;return[g("div",Ki,[g("span",null,j((z=S.prjDetailInfo)==null?void 0:z.dispatch),1)])]}),_:1})):C("",!0),ne.value?(u(),I($,{key:4,span:3},{label:s(()=>o[37]||(o[37]=[m(" 项目默认地址 ")])),default:s(()=>{var z,Re;return[g("div",Qi,[g("div",null,[g("div",Yi,j(((z=S.prjDetailInfo)==null?void 0:z.prosite)||"—"),1),g("div",Xi,[o[38]||(o[38]=g("b",{style:{color:"#888"}},"详细地址：",-1)),m(j(((Re=S.prjDetailInfo)==null?void 0:Re.proaddr)||"暂无"),1)])]),a(ot,{class:"font-size-20px cursor-pointer",style:{color:"#1890ff","flex-shrink":"0","margin-top":"2px",transition:"transform 0.2s ease"},onClick:o[3]||(o[3]=f=>ve()),onMouseenter:o[4]||(o[4]=f=>f.target.style.transform="rotate(90deg)"),onMouseleave:o[5]||(o[5]=f=>f.target.style.transform="rotate(0deg)")}),g("div",{class:"cursor-pointer c-#1890ff ml-50px flex items-center",onClick:G},[o[39]||(o[39]=m(" 其他地址 ")),a(ot,{class:"font-size-20px",style:{color:"#1890ff","flex-shrink":"0",transition:"transform 0.2s ease"},onMouseenter:o[6]||(o[6]=f=>f.target.style.transform="rotate(90deg)"),onMouseleave:o[7]||(o[7]=f=>f.target.style.transform="rotate(0deg)")})])])]}),_:1})):C("",!0),ne.value?(u(),I($,{key:5,"content-style":{position:"relative",width:"180px"}},{label:s(()=>o[40]||(o[40]=[m(" 开始时间 ")])),default:s(()=>{var z;return[g("div",Zi,[g("span",null,j((z=S.prjDetailInfo)==null?void 0:z.sdbtime),1)])]}),_:1})):C("",!0),ne.value?(u(),I($,{key:6},{label:s(()=>o[41]||(o[41]=[m(" 计划调试时间 ")])),default:s(()=>{var z;return[m(" "+j((z=S.prjDetailInfo)==null?void 0:z.plantime),1)]}),_:1})):C("",!0),ne.value?(u(),I($,{key:7},{label:s(()=>o[42]||(o[42]=[m(" 验收人 ")])),default:s(()=>{var z;return[m(" "+j((z=S.prjDetailInfo)==null?void 0:z.ckusername),1)]}),_:1})):C("",!0),ne.value?(u(),I($,{key:8},{label:s(()=>o[43]||(o[43]=[m(" 验收时间 ")])),default:s(()=>{var z;return[m(" "+j((z=S.prjDetailInfo)==null?void 0:z.ckdbtime),1)]}),_:1})):C("",!0),ne.value?(u(),I($,{key:9},{label:s(()=>o[44]||(o[44]=[m(" 商务联系人 ")])),default:s(()=>{var z;return[m(" "+j((z=S.prjDetailInfo)==null?void 0:z.businesscon),1)]}),_:1})):C("",!0),p(Ve)("project:Participant:select")?(u(),I($,{key:10,span:4},{label:s(()=>o[45]||(o[45]=[m(" 项目参与人 ")])),default:s(()=>[g("div",eo,[g("div",null,[g("div",to,j(R.value.map(z=>z.prtcname).filter(Boolean).join("、")),1)]),p(Ve)("project:Participant:insert")||p(Ve)("project:Participant:delete")?(u(),I(ot,{key:0,class:"font-size-22px cursor-pointer",style:xt([{"flex-shrink":"0","margin-top":"2px",transition:"transform 0.2s ease"},{color:R.value.length>0?"#1890ff":""}]),onClick:o[8]||(o[8]=z=>je()),onMouseenter:o[9]||(o[9]=z=>z.target.style.transform="rotate(90deg)"),onMouseleave:o[10]||(o[10]=z=>z.target.style.transform="rotate(0deg)")},null,8,["style"])):C("",!0)])]),_:1})):C("",!0)]),_:1}),g("div",{style:xt([{background:"#409eff",position:"absolute",width:"5px",top:"-20px",left:"38px"},{height:ne.value?"115%":"145%"}])},null,4),g("div",lo,[ne.value?(u(),x("span",{key:1,onClick:o[12]||(o[12]=z=>ne.value=!1)},[o[47]||(o[47]=m(" 收起 ")),a(qt,{class:"font-size-20px"})])):(u(),x("span",{key:0,onClick:o[11]||(o[11]=z=>ne.value=!0)},[o[46]||(o[46]=m(" 更多 ")),a(Dl,{class:"font-size-20px"})]))]),a(Rt,{show:Fe.value,"onUpdate:show":o[17]||(o[17]=z=>Fe.value=z),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:s(()=>[a(Ue,{justify:"end",size:16},{default:s(()=>[a(ae,{onClick:L},{default:s(()=>[m(j(D.$t("common.cancel")),1)]),_:1}),[0,2,4].includes(p(oe).userInfo.usertype)?(u(),I(ae,{key:0,type:"primary",onClick:T},{default:s(()=>[m(j(D.$t("common.confirm")),1)]),_:1})):C("",!0)]),_:1})]),default:s(()=>[a(Ue,null,{default:s(()=>[a(Mt,{label:"省份",path:"provice","label-placement":"left","label-width":"70"},{default:s(()=>[a(ol,{filterable:"",value:r.provice,"onUpdate:value":[o[13]||(o[13]=z=>r.provice=z),qe],placeholder:"请选择省份","label-field":"name","value-field":"id",options:ce.value},null,8,["value","options"])]),_:1}),a(Mt,{label:"地区",path:"region","label-placement":"left","label-width":"70"},{default:s(()=>[a(ol,{filterable:"",value:r.region,"onUpdate:value":[o[14]||(o[14]=z=>r.region=z),pe],placeholder:"请选择地区","label-field":"name","value-field":"id",options:Me.value},null,8,["value","options"])]),_:1})]),_:1}),Se.value?(u(),I(Mt,{key:0,label:O.value==0?"项目地址":"项目地址"+O.value,"label-placement":"left"},{default:s(()=>[g("div",ao,[a(rl,{value:ke.value,"onUpdate:value":[o[15]||(o[15]=z=>ke.value=z),p(Ze)],options:he.value,style:{"margin-bottom":"7px"},placeholder:"请输入地点关键字",clearable:"",onSelect:N},null,8,["value","options","onUpdate:value"]),O.value==0?(u(),I(ft,{key:0,type:"textarea",rows:2,clearable:"",value:r.proaddr,"onUpdate:value":o[16]||(o[16]=z=>r.proaddr=z),placeholder:"请输入详细地址"},null,8,["value"])):C("",!0)])]),_:1},8,["label"])):C("",!0),g("div",{ref_key:"domRef",ref:Ke,class:"h-full w-full",style:{width:"100%",height:"500px","margin-bottom":"10px"}},null,512)]),_:1},8,["show"]),a(Rt,{show:v.value,"onUpdate:show":o[19]||(o[19]=z=>v.value=z),title:"其他地址",preset:"card",class:"w-800px"},{footer:s(()=>[a(Ue,{justify:"end",size:16},{default:s(()=>[a(ae,{type:"primary",ghost:"",onClick:d},{default:s(()=>o[50]||(o[50]=[m("关闭")])),_:1,__:[50]})]),_:1})]),default:s(()=>[[0,2,4].includes(p(oe).userInfo.usertype)?(u(),I(ae,{key:0,type:"primary",size:"small",ghost:"",onClick:o[18]||(o[18]=z=>P.value.push({latitude:30.303899,longitude:120.373885,addr:""}))},{icon:s(()=>[a(zl,{class:"text-icon"})]),default:s(()=>[o[48]||(o[48]=m(" "+j("添加地址")))]),_:1,__:[48]})):C("",!0),(u(!0),x(Je,null,It(P.value,(z,Re)=>(u(),x("div",{class:"flex items-center mt-10px",key:z.latitude},[g("span",no,"项目地址"+j(Re+1),1),a(Ul,{onClick:f=>ve(Re+1)},{default:s(()=>[a(ft,{readonly:"",value:z.addr,"onUpdate:value":f=>z.addr=f,placeholder:"请选择项目地点"+(Re+1)},null,8,["value","onUpdate:value","placeholder"]),a(ae,null,{icon:s(()=>[a(jl,{class:"text-icon"})]),_:1})]),_:2},1032,["onClick"]),a(ge,{onPositiveClick:f=>y(z)},{trigger:s(()=>[[0,2,4].includes(p(oe).userInfo.usertype)?(u(),I(ae,{key:0,size:"small",ghost:"",type:"error",class:"ml-10px"},{icon:s(()=>[a(Bl,{class:"text-icon"})]),default:s(()=>[o[49]||(o[49]=m(" "+j("删除")))]),_:1,__:[49]})):C("",!0)]),default:s(()=>[m(" 确定要删除项目地址"+j(Re+1)+"吗？ ",1)]),_:2},1032,["onPositiveClick"])]))),128))]),_:1},8,["show"]),a(Rt,{show:q.value,"onUpdate:show":o[22]||(o[22]=z=>q.value=z),title:"项目参与人设置",preset:"card",class:"w-700px"},{footer:s(()=>[a(Ue,{justify:"end",size:16},{default:s(()=>[a(ae,{onClick:o[21]||(o[21]=z=>{q.value=!1})},{default:s(()=>[m(j(D.$t("common.cancel")),1)]),_:1}),[0,2].includes(p(oe).userInfo.usertype)?(u(),I(ae,{key:0,type:"primary",onClick:Pe},{default:s(()=>[m(j(D.$t("common.confirm")),1)]),_:1})):C("",!0)]),_:1})]),default:s(()=>[a(Fl,{value:ee.value,"onUpdate:value":o[20]||(o[20]=z=>ee.value=z)},{default:s(()=>[a(ht,{"y-gap":8,cols:5},{default:s(()=>[(u(!0),x(Je,null,It(S.userList,z=>(u(),I(dl,{key:z.id},{default:s(()=>[a(Ae,{size:"large",value:z.id,label:z.username},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["show"])],64)}}}),oo=Sl(io,[["__scopeId","data-v-85111c02"]]),ro={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},uo={class:"timeline-wrapper"},co={class:"timeline-layout"},po={class:"timeline"},fo=["id"],go={class:"timeline-icon"},mo=["onClick"],vo={class:"flex justify-between"},yo=["onClick"],ho={style:{"font-weight":"500",color:"#1890ff","margin-right":"15px"}},bo={key:0},_o={class:"w-200px inline-block"},xo=["onClick"],ko={key:1},Co={class:"w-200px inline-block"},Lo=["onClick"],So={key:2},wo={class:"w-200px inline-block"},$o=["onClick"],Do={key:3},zo={class:"w-200px inline-block"},jo=["onClick"],Uo={key:1},Bo={class:"timeline-rows"},Fo={key:0,class:"timeline-content",style:{"padding-left":"80px",position:"relative"}},Po={class:"timeline-icon"},Io=["onClick"],No=["onClick"],To=["id"],Eo={style:{display:"flex","align-items":"center",gap:"10px"}},Ao={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Vo={style:{display:"flex","align-items":"center",gap:"10px"}},Oo={class:"pos-absolute left-140px flex gap-x-10px"},qo={key:0},Mo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Ro={key:0,style:{height:"20px"}},Jo={style:{display:"flex","align-items":"center",gap:"10px"}},Ho={key:0},Go={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Wo={style:{display:"flex","align-items":"center",gap:"10px"}},Ko={key:0},Qo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Yo={style:{display:"flex","align-items":"center",gap:"10px"}},Xo={key:0},Zo={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},er={key:0,style:{height:"20px"}},tr={key:0,style:{height:"20px"}},lr={key:0,class:"flex items-center justify-between"},ar={key:0},nr={class:"flex items-center justify-between"},sr={key:0},ir={class:"flex items-center justify-end"};function xl(_e){return typeof _e=="function"||Object.prototype.toString.call(_e)==="[object Object]"&&!rs(_e)}const or=Nt({name:"projectmanagement_orderdetail",__name:"index",setup(_e){const F=Ot(),fe=_a(),oe=b(""),S=Fn(),De=Pn(),ne=st({debuggedBusinessList:[],developBusinessList:[],needsList:[]}),r=st({pid:void 0});let H=st([{id:"phase1",title:"基本信息",show:!0,tables:[]},{id:"phase2",title:"实施信息",show:!0,tables:[]},{id:"phase3",title:"验收信息",show:!0,tables:[]},{id:"phase4",title:"项目总结",show:F.userInfo.usertype!=1,tables:[1]},{id:"phase5",title:"项目日报",show:F.userInfo.usertype!=1,tables:[1]}]);const ce=b(null),Ne=async e=>{var n;if(!e)return;f.value.projectDetail={};const{data:t}=await as(e);Object.assign(f.value.projectDetail,t),(n=ce.value)==null||n[0].getProjectUserList()},qe=()=>{pe.pageSize==1?pe.pageSize=20:pe.pageSize=1,Ce(r.pid)},pe=st({page:1,pageSize:1,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${pe.itemCount} 条`,onChange:e=>{pe.page=e,Ce(r.pid)},onUpdatePageSize:e=>{pe.pageSize=e,pe.page=1,Ce(r.pid)}}),Me=[{title:"对接方",key:"docker",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.docker,placeholder:"请输入",onUpdateValue(n){f.value.contactList[t].docker=n}}):l("div",{},e.docker)}},{title:"姓名",key:"pname",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.pname,placeholder:"请输入",onUpdateValue(n){f.value.contactList[t].pname=n}}):l("div",{},e.pname)}},{title:"联系方式",key:"pcontact",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.pcontact,placeholder:"请输入",onUpdateValue(n){f.value.contactList[t].pcontact=n}}):l("div",{},e.pcontact)}},{title:"备注",key:"proposition",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.proposition,placeholder:"请输入",onUpdateValue(n){f.value.contactList[t].proposition=n}}):l("div",{},e.proposition)}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?it(1,e.dbtime):""},{key:"operate",title:X("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[Ve("project:Contact:insert")&&l(_,{type:"primary",ghost:!0,size:"small",loading:e.saving,disabled:e.saving,onClick:()=>we(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>Ke(e,t)},{default:()=>"取消"}),Ve("project:Contact:delete")&&l(We,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:U}=await In(e.id);i&&(f.value.contactList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),Ce(r.pid),Ye())}else f.value.contactList.splice(t,1)}},{default:()=>X("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>X("common.delete")})})]:Ve("project:Contact:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Fe(e)},{default:()=>"编辑"})])}}],Ce=async e=>{if(!e)return;const{data:t}=await Rl({page:pe.page,limit:pe.pageSize,pid:e});f.value.contactList=t==null?void 0:t.list,pe.itemCount=t==null?void 0:t.total,f.value.contactList.forEach(n=>{n.setStatus=!1}),ne.contactList=JSON.parse(JSON.stringify(f.value.contactList))},Fe=e=>{f.value.contactList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},Ke=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value.contactList=JSON.parse(JSON.stringify(ne.contactList)):f.value.contactList.splice(t,1)},we=async e=>{var t,n,i,U,B;if(!e.saving){if(!e.docker){(t=window.$message)==null||t.warning("请输入对接方");return}if(!e.pname){(n=window.$message)==null||n.warning("请输入联系人姓名");return}if(!e.pcontact){(i=window.$message)==null||i.warning("请输入联系方式");return}e.saving=!0;try{if(e.id){const{error:de}=await Nn([e]);de||((U=window.$message)==null||U.success("修改成功"),Ce(r.pid),e.setStatus=!e.setStatus)}else{const{error:de}=await Tn([{...e,pid:r.pid}]);de||((B=window.$message)==null||B.success("添加成功"),Ce(r.pid),e.setStatus=!e.setStatus,Ye())}je()}finally{e.saving=!1}}};function Le(){var e;bl.value.includes("1")||bl.value.push("1"),((e=f.value.contactList[0])!=null&&e.pname||f.value.contactList.length==0)&&f.value.contactList.unshift({pname:"",pcontact:"",proposition:"",setStatus:!0})}const le=b([]),ze=async()=>{var n;const{data:e,error:t}=await Xl({page:1,limit:100,id:r.pid});le.value=e==null?void 0:e.list.map(i=>({value:i.id,label:i.contractname,isLeaf:!1})),Se((n=e==null?void 0:e.list[0])==null?void 0:n.id)},V=b([]),w=b(),{pageData:re,getData:xe}=pt(wa),Se=async e=>{await xe({pids:e}),w.value=[],V.value=Array.from(new Set([...V.value,...re.data])),w.value=re.data.map(t=>({label:t.devname,value:t.id}))},ke=async e=>{var t;await Se(e.value),e.children=(t=w.value)==null?void 0:t.map(n=>({label:n.label,value:n.value,isLeaf:!0}))},he=()=>{K.pageSize==1?K.pageSize=20:K.pageSize=1,N(r.pid)},K=st({page:1,pageSize:1,itemCount:0,showSizePicker:!0,fuzzy:"",pageSizes:[10,20],prefix:()=>`共 ${K.itemCount} 条`,onChange:e=>{K.page=e,N(r.pid)},onUpdatePageSize:e=>{K.pageSize=e,K.page=1,N(r.pid)}}),Z=b(),Ze=[{title:"绑定合同设备",key:"cid",width:220,align:"center",render(e,t){var n,i;return e.setStatus?l(Hl,{style:"width: 200px",value:e.cid,filterable:!0,placeholder:"请选择合同设备",options:le.value,checkStrategy:"child",showPath:!1,remote:!0,renderSuffix:U=>U.option.hidden?null:U.node,renderLabel:U=>U.hidden?null:U.label,onLoad:ke,onUpdateValue(U){var de;f.value.debuggedDevieceList[t].cid=Number(U)||0;const B=(de=V.value)==null?void 0:de.find(ye=>ye.id==U);e.devname=(B==null?void 0:B.devname)||"",e.devnum=(B==null?void 0:B.devcount)||"",e.notes=(B==null?void 0:B.notes)||"",Z.value=(B==null?void 0:B.devcount)||0,e.etype=(B==null?void 0:B.devtype)||0,e.devmanu=(B==null?void 0:B.devmanu)||"",e.devmodel=((B==null?void 0:B.devmodel.length)>64?B==null?void 0:B.devname:B==null?void 0:B.devmodel)||"",e.devunit=(B==null?void 0:B.devunit)||""}}):l("div",{},e.devname2||((i=(n=w.value)==null?void 0:n.find(U=>U.value==e.cid))==null?void 0:i.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.devname,placeholder:"请输入",onUpdateValue(n){f.value.debuggedDevieceList[t].devname=n}}):l("div",{},e.devname)}},{key:"devmodel",title:"设备信息",align:"center",width:180,render(e){return a("div",{style:"display:flex;align-items:flex-start;flex-direction:column; gap:3px; line-height:1.4;"},[a(At,{tooltip:!0,style:"max-width:160px;"},{default:()=>a("span",null,[a("span",null,[m("型号：")]),a("span",{style:"font-weight:500"},[e.devmodel||"-"])])}),a("div",null,[a("span",null,[m("单位：")]),a("span",null,[e.devunit||"-"])])])}},{title:"数量",key:"devnum",width:100,align:"center",render(e,t){return e.setStatus?l(Sa,{value:e.devnum,placeholder:"请输入",max:Z.value,onUpdateValue(n){f.value.debuggedDevieceList[t].devnum=n}}):l("div",{},e.devnum)}},{title:"设备信息",key:"deviceInfo",width:160,align:"center",render(e){return a("div",{style:"display:flex;align-items:flex-start;flex-direction:column;gap:3px;line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[m("是否为我司设备：")]),a("span",{style:"font-weight:500"},[e.etype==0?"是":"否"])]),a("div",null,[a("span",{style:"color:#666"},[m("厂家：")]),a("span",null,[e.devmanu||"-"])])])}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.manucontact,placeholder:"请输入",onUpdateValue(n){f.value.debuggedDevieceList[t].manucontact=n}}):l("div",{},e.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.manuinfo,placeholder:"请输入",onUpdateValue(n){f.value.debuggedDevieceList[t].manuinfo=n}}):l("div",{},e.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Ee,{value:e.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(n){f.value.debuggedDevieceList[t].devstatus=Number(n)||0}}):l("div",{},e.devstatus===0?"设备无异常":e.devstatus===1?"异常":"未知")}},{title:"清点状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Ee,{value:e.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(n){f.value.debuggedDevieceList[t].status=Number(n)||0}}):l("div",{},e.status===0?"未清点":e.status===1?"正常":e.status===2?"增补":e.status===3?"退货":"换货")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.connectionmode,placeholder:"请输入",onUpdateValue(n){f.value.debuggedDevieceList[t].connectionmode=n}}):l("div",{},e.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Ee,{value:e.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(n){f.value.debuggedDevieceList[t].install=Number(n)||0}}):l("div",{},e.install===0?"是":"否")}},{title:"文件",key:"re1",width:100,align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>vl(e,"debuggedDevieceList",t)},{default:()=>"上传文件"}):l(_t,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,U)=>{var B;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((B=i.file)==null?void 0:B.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>yl({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"备注",key:"notes",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入",onUpdateValue(n){f.value.debuggedDevieceList[t].notes=n}}):l("div",{},e.notes)}},{key:"dusername",title:"清点信息",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:flex-start;  flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[m("清点人：")]),a("span",{style:"font-weight:500"},[e.dusername||"-"])]),a("div",null,[a("span",{style:"color:#666"},[m("时间：")]),a("span",null,[e.ddbtime||"-"])])])}},{key:"dbtime",title:"创建信息",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:flex-start;  flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[m("创建人：")]),a("span",{style:"font-weight:500"},[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[m("时间：")]),a("span",null,[e.dbtime||"-"])])])}},{key:"operate",title:X("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[l(_,{type:"primary",ghost:!0,size:"small",disabled:e.saving,loading:e.saving,onClick:()=>He(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>ve(e,t)},{default:()=>"取消"}),Ve("project:Equipment:delete")&&l(We,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:U}=await En(e.id);i&&(f.value.debuggedDevieceList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),N(r.pid),Ye())}else f.value.debuggedDevieceList.splice(t,1)}},{default:()=>X("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>X("common.delete")})})]:Ve("project:Equipment:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>O(e)},{default:()=>"编辑"})])}}],N=async e=>{if(!e)return;const{data:t}=await Jl({page:K.page,limit:K.pageSize,fuzzy:K.fuzzy,pid:e});f.value.debuggedDevieceList=t.list,K.itemCount=t.total,f.value.debuggedDevieceList.forEach(n=>{n.setStatus=!1}),ne.debuggedDevieceList=JSON.parse(JSON.stringify(f.value.debuggedDevieceList))},O=async e=>{var i;console.log(re.data,e.cid,"ssssssssssssssss"),f.value.debuggedDevieceList.forEach(U=>{U.setStatus=!1});const{data:t,error:n}=await An(e.cid);n||(((i=le.value[le.value.length-1])==null?void 0:i.value)!=t.id&&le.value.push({value:t.id,label:t.devname,disabled:!0,isLeaf:!0,hidden:!0}),Z.value=t.devcount||0),e.setStatus=!e.setStatus},ve=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value.debuggedDevieceList=JSON.parse(JSON.stringify(ne.debuggedDevieceList)):f.value.debuggedDevieceList.splice(t,1)},He=async e=>{var t,n,i,U,B,de,ye;if(!e.saving){if(!e.cid){(t=window.$message)==null||t.warning("请选择合同设备");return}if(!e.devname){(n=window.$message)==null||n.warning("设备名称不能为空");return}if(!e.devmodel){(i=window.$message)==null||i.warning("设备型号不能为空");return}if(!e.devnum){(U=window.$message)==null||U.warning("设备数量不能为空");return}e.saving=!0;try{if(((B=e.fileList)==null?void 0:B.length)>0){const be=e.fileList.filter(se=>se.file),ue=be.length;for(let se=0;se<ue;se++){const me=be[se];me.indexText=`${se+1}/${ue}`,me.progress=0,me.status="uploading";try{me.url=await $t(me.file.file,me.file.name,""),me.progress=100,me.status="done"}catch{me.status="error"}}e.fileList.forEach((se,me)=>{e[`re${me+1}`]=se.name||"",e[`fl${me+1}`]=se.url||""}),delete e.fileList}if(e.id){const{data:be,error:ue}=await ua([e]);ue||((de=window.$message)==null||de.success("修改成功"),N(r.pid),e.setStatus=!e.setStatus)}else{const{data:be,error:ue}=await $a([{...e,pid:r.pid}]);ue||((ye=window.$message)==null||ye.success("添加成功"),N(r.pid),e.setStatus=!e.setStatus,Ye())}}finally{e.saving=!1}}},c=async()=>{var i;const e=f.value.debuggedDevieceList.map(U=>U.status==0?{id:U.id,status:1}:null).filter(U=>U!==null),{data:t,error:n}=await ua(e);n||((i=window.$message)==null||i.success("清点成功"),N(r.pid))},L=b(!1);function T(){L.value=!0}const{pageData:P,getData:h,nextPage:v}=pt(Ca),G=async()=>{await h({usertypes:"2,3"})},Q=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&P.data.length<P.total&&(await v(),await yt(),setTimeout(()=>{t.scrollTop=n}))};G();const{pageData:d,getData:y,nextPage:k}=pt(ka),E=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&d.data.length<d.total&&(await k(),await yt(),setTimeout(()=>{t.scrollTop=n}))};(async()=>{await y(),d.data=d.data.map(e=>(e.name=`${e.weight}  `+e.tname,e))})();const{pageData:ee,getData:J,nextPage:W}=pt(Rl),q=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&ee.data.length<ee.total&&(await W(),ee.data=ee.data.map(i=>({...i,value:i.docker+"&id="+i.id})),await yt(),setTimeout(()=>{t.scrollTop=n}))},je=async()=>{await J({pid:r.pid}),ee.data=ee.data.map(e=>({...e,value:e.docker+"&id="+e.id}))},{pageData:Pe,getData:D,nextPage:o}=pt(Jl),$=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&d.data.length<d.total&&(await o(),await yt(),setTimeout(()=>{t.scrollTop=n}))},M=async()=>{await D({pid:r.pid})},ae=b(),ge=[{title:"权重",key:"dtype",width:180,align:"center",render(e,t){return e.setStatus?l(Ee,{value:e.dtype,filterable:!0,placeholder:"请选择权重",options:d.data,labelField:"tname",valueField:"id",onUpdateValue(n){var i;f.value.debuggedBusinessList[t].dtype=Number(n)||0,f.value.debuggedBusinessList[t].debugname=((i=d.data.find(U=>U.id==n))==null?void 0:i.tname)||""},onScroll(n){E(n)}}):l("div",{},e.tname)}},{title:"业务名称",key:"debugname",width:180,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.debugname,placeholder:"请输入业务名称",onUpdateValue(n){f.value.debuggedBusinessList[t].debugname=n}}):l("div",{},e.debugname)}},{title:"状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?l(Ee,{value:e.status,filterable:!0,placeholder:"请选择状态",options:F.userInfo.usertype==0||F.userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}],onUpdateValue(n){f.value.debuggedBusinessList[t].status=Number(n)||0}}):l(Zl,{color:{color:e.status==-1?"rgba(251, 146, 60, 0.15)":e.status==0?"rgba(156, 163, 175,0.15)":e.status==1?"rgba(59, 130, 246,0.15)":e.status==2?"rgba(250, 204, 21,0.15)":"rgba(16, 185, 129,0.15)",textColor:e.status==-1?"#FB923C":e.status==0?"#9ca3af":e.status==1?"#3B82F6":e.status==2?"#FACC15":"#10B981",borderColor:e.status==-1?"#FB923C":e.status==0?"#9ca3af":e.status==1?"#3B82F6":e.status==2?"#FACC15":"#10B981"}},e.status==-1?"申请中":e.status==0?"待调试":e.status==1?"开始调试":e.status==2?"待审核":"审核完成")}},{key:"eqmname",title:"调试设备",align:"center",width:150,render(e,t){return e.setStatus?l(Ee,{value:e.eqmid,placeholder:"请选择调试设备",options:Pe.data,onscroll:$,labelField:"devname",valueField:"id",clearable:!0,filterable:!0,onUpdateValue(n){f.value.debuggedBusinessList[t].eqmid=n}}):l("div",{},e.eqmname)}},{title:"对接方",key:"docker",width:120,align:"center",render(e,t){var n;return e.setStatus?l(Ee,{value:e.docker,placeholder:"请输入或选择对接方",options:ee.data,onscroll:q,labelField:"docker",valueField:"value",clearable:!0,filterable:!0,tag:!0,onClear(){e.dockcharge="",e.dockcontact=""},onUpdateValue(i){var ye;f.value.debuggedBusinessList[t].docker=i;const[U,B]=(ye=e.docker)==null?void 0:ye.split("&id="),de=ee.data.find(be=>be.docker===U&&be.id===Number(B));de?(e.dockcharge=de.pname,e.dockcontact=de.pcontact):(e.dockcharge="",e.dockcontact="")}}):l("div",{},(n=e.docker)==null?void 0:n.split("&id=")[0])}},{title:"对接方负责人",key:"dockcharge",width:100,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.dockcharge,placeholder:"请输入对接方负责人",onUpdateValue(n){f.value.debuggedBusinessList[t].dockcharge=n}}):l("div",{},e.dockcharge)}},{title:"联系方式",key:"dockcontact",width:140,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.dockcontact,placeholder:"请输入联系方式",onUpdateValue(n){f.value.debuggedBusinessList[t].dockcontact=n}}):l("div",{},e.dockcontact)}},{title:"调试人",key:"dbcreater",width:120,align:"center",render(e,t){return e.setStatus?l(Ee,{value:e.dbcreater,filterable:!0,placeholder:"请选择调试人",options:P.data,labelField:"username",valueField:"id",onUpdateValue(n){f.value.debuggedBusinessList[t].dbcreater=n||0},onScroll(n){Q(n)}}):l("div",{},e.dbusername)}},{key:"duration",title:"调试信息",align:"center",width:200,render(e){return a("div",{style:"display:flex; align-items:flex-start; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[m("工时：")]),a("span",{style:"color:#1890ff; font-weight:500"},[e.duration||"-"])]),a("div",null,[a("span",{style:"color:#666"},[m("开始：")]),a("span",null,[e.dbdbtime||"-"])]),a("div",null,[a("span",{style:"color:#666"},[m("结束：")]),a("span",null,[e.dedbtime||"-"])])])}},{title:"文件",key:"re1",width:80,align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>vl(e,"debuggedBusinessList",t)},{default:()=>"上传文件"}):l(_t,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,U)=>{var B;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((B=i.file)==null?void 0:B.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>yl({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"备注",key:"notes",width:120,align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入备注",onUpdateValue(n){f.value.debuggedBusinessList[t].notes=n}}):l("div",{},e.notes)}},{key:"username",title:"创建信息",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:flex-start; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[m("创建人：")]),a("span",null,[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[m("时间：")]),a("span",null,[e.dbtime||"-"])])])}},{key:"ckusername",title:"审核信息",align:"center",width:200,render(e){return a("div",{style:"display:flex; align-items:flex-start; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[m("审核人：")]),a("span",null,[e.ckusername||"-"])]),a("div",null,[a("span",{style:"color:#666"},[m("时间：")]),a("span",null,[e.ckdbtime||"-"])])])}},{title:"计划开始时间",key:"starttime",width:120,align:"center",render(e,t){return e.setStatus?l(Ll,{type:"date",clearable:!0,value:e.starttime,valueFormat:"yyyy-MM-dd",placeholder:"请选择",onUpdateValue(n){f.value.debuggedBusinessList[t].starttime=n}}):l("div",e.starttime?it(0,e.starttime):"")}},{title:"计划结束时间",key:"endtime",width:120,align:"center",render:(e,t)=>e.setStatus?l(Ll,{type:"date",clearable:!0,valueFormat:"yyyy-MM-dd",value:e.endtime,placeholder:"请选择",onUpdateValue(n){f.value.debuggedBusinessList[t].endtime=n}}):e.endtime?it(0,e.endtime):""},{key:"operate",title:X("common.operate"),align:"center",width:280,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[!e.setStatus&&e.status==0&&e.dbcreater==F.userInfo.id&&l(We,{onPositiveClick:()=>{ot(e,1)}},{default:()=>"确定开始调试吗？",trigger:()=>l(_,{type:"success",ghost:!0,size:"small"},{default:()=>"开始"})}),!e.setStatus&&e.status==1&&e.dbcreater==F.userInfo.id&&l(We,{onPositiveClick:()=>{ot(e,2)}},{default:()=>l("div",[l("div","确定完成调试？"),l("div",{style:{color:"#d03050",fontWeight:"500",marginTop:"6px"}},"请确认资料已提交，否则将拒绝审核！")]),trigger:()=>l(_,{type:"success",ghost:!0,size:"small"},{default:()=>"完成"})}),!e.setStatus&&e.status==2&&(F.userInfo.usertype==0||F.userInfo.usertype==2)&&l(We,{onPositiveClick:()=>{ot(e,3)}},{default:()=>"是否确认执行审核操作？",trigger:()=>l(_,{type:"warning",ghost:!0,size:"small"},{default:()=>"审核"})}),e.setStatus?[Ve("project:Debug:insert")&&l(We,{onPositiveClick:()=>{Dl(e)}},{default:()=>"是否确认保存？",trigger:()=>l(_,{type:"info",ghost:!0,size:"small"},{default:()=>"保存"})}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>$l(e,t)},{default:()=>"取消"}),Ve("project:Debug:delete")&&l(We,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:U}=await Vn(e.id,r.pid);i&&(f.value.debuggedBusinessList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),Ge(r.pid),Ye())}else f.value.debuggedBusinessList.splice(t,1)}},{default:()=>X("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>X("common.delete")})})]:Ve("project:Debug:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ct(e)},{default:()=>"编辑"})])}}],Y=st({page:1,pageSize:1,showSizePicker:!0,itemCount:0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${Y.itemCount} 条`,onChange:e=>{Y.page=e,Ge(r.pid)},onUpdatePageSize:e=>{Y.pageSize=e,Y.page=1,Ge(r.pid)}}),Ie=()=>{Y.pageSize==1?Y.pageSize=20:Y.pageSize=1,Ge(r.pid)},Ge=async e=>{if(!e)return;const{data:t}=await On({page:Y.page,limit:Y.pageSize,fuzzy:Y.fuzzy,creater:Y.creater,pid:e});f.value.debuggedBusinessList=t.list,Y.itemCount=t.total,f.value.debuggedBusinessList.forEach(n=>{n.setStatus=!1}),ne.debuggedBusinessList=JSON.parse(JSON.stringify(f.value.debuggedBusinessList))},Ct=e=>{e.starttime=ca(e.starttime),e.endtime=ca(e.endtime),ae.value=e.status,f.value.debuggedBusinessList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},ot=async(e,t)=>{var U;const{data:n,error:i}=await pa([{id:e.id,status:t,pid:e.pid}]);i||((U=window.$message)==null||U.success("操作成功"),Ge(r.pid),t==3&&window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:e.pid,type:"debug"}})))},$l=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value.debuggedBusinessList=JSON.parse(JSON.stringify(ne.debuggedBusinessList)):f.value.debuggedBusinessList.splice(t,1)},Dl=async e=>{var t,n,i,U,B,de,ye,be,ue,se,me;if(!e.saving){if(!e.dtype){(t=window.$message)==null||t.warning("请选择权重");return}if(!e.debugname){(n=window.$message)==null||n.warning("请输入业务名称");return}if(!e.docker){(i=window.$message)==null||i.warning("请选择或输入对接方");return}if(!e.dockcharge){(U=window.$message)==null||U.warning("请输入对接方负责人");return}if(!e.dockcontact){(B=window.$message)==null||B.warning("请输入对接方联系方式");return}if(!e.dbcreater){(de=window.$message)==null||de.warning("请选择调试人");return}e.saving=!0;try{const $e=it(0,e.starttime),_l=it(0,e.endtime);if(((ye=e.fileList)==null?void 0:ye.length)>0){const at=e.fileList.filter(nt=>nt.file),Ut=at.length;for(let nt=0;nt<Ut;nt++){const tt=at[nt];tt.indexText=`${nt+1}/${Ut}`,tt.progress=0,tt.status="uploading";try{tt.url=await $t(tt.file.file,tt.file.name,""),tt.progress=100,tt.status="done"}catch{tt.status="error"}}e.fileList.forEach((nt,tt)=>{e[`re${tt+1}`]=nt.name||"",e[`fl${tt+1}`]=nt.url||""}),delete e.fileList}if(e.id){const at=JSON.parse(JSON.stringify(e));ae.value==at.status&&delete at.status,at.docker=(be=at.docker)==null?void 0:be.split("&id=")[0];const{data:Ut,error:nt}=await pa([{...at,starttime:$e,endtime:_l}]);nt||((ue=window.$message)==null||ue.success("修改成功"),Ge(r.pid),e.setStatus=!e.setStatus)}else{e.docker=(se=e.docker)==null?void 0:se.split("&id=")[0];const{data:at,error:Ut}=await La([{...e,starttime:$e,endtime:_l,pid:r.pid}]);Ut||((me=window.$message)==null||me.success("添加成功"),Ge(r.pid),e.setStatus=!e.setStatus,Ye())}}finally{e.saving=!1}}},qt=b(!1);function ol(){qt.value=!0}const Mt=[{title:"影响的业务",key:"affectedbusiness",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.affectedbusiness,placeholder:"请输入影响的业务",onUpdateValue(n){f.value.developBusinessList[t].affectedbusiness=n}}):l("div",{},e.affectedbusiness)}},{title:"设备名称",key:"devname",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.devname,placeholder:"请输入设备名称",onUpdateValue(n){f.value.developBusinessList[t].devname=n}}):l("div",{},e.devname)}},{title:"接口文档",key:"apidocument",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.apidocument,placeholder:"请输入接口文档",onUpdateValue(n){f.value.developBusinessList[t].apidocument=n}}):l("div",{},e.apidocument)}},{title:"研发对接人",key:"uid",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.uid,placeholder:"请输入研发对接人",onUpdateValue(n){f.value.developBusinessList[t].uid=n}}):l("div",{},e.uid)}},{title:"研发周期",key:"period",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.period,placeholder:"请输入文件上传路径",onUpdateValue(n){f.value.developBusinessList[t].period=n}}):l("div",{},e.period)}},{title:"备注",key:"notes",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入备注",onUpdateValue(n){f.value.developBusinessList[t].notes=n}}):l("div",{},e.notes)}},{title:"文件",key:"re1",align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>vl(e,"developBusinessList",t)},{default:()=>"上传文件"}):l(_t,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,U)=>{var B;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((B=i.file)==null?void 0:B.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>yl({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?it(1,e.dbtime):""},{key:"operate",title:X("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[Ve("project:Development:insert")&&l(_,{type:"primary",ghost:!0,size:"small",loading:e.saving,disabled:e.saving,onClick:()=>jl(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>zl(e,t)},{default:()=>"取消"}),Ve("project:Development:delete")&&l(We,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:U}=await qn(e.id,r.pid);i&&(f.value.developBusinessList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),ft(r.pid),Ye())}else f.value.developBusinessList.splice(t,1)}},{default:()=>X("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>X("common.delete")})})]:Ve("project:Development:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Rt(e)},{default:()=>"编辑"})])}}],Ue=st({page:1,pageSize:1,itemCount:0,showSizePicker:!0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${Ue.itemCount} 条`,onChange:e=>{Ue.page=e,ft(r.pid)},onUpdatePageSize:e=>{Ue.pageSize=e,Ue.page=1,ft(r.pid)}}),rl=()=>{Ue.pageSize==1?Ue.pageSize=20:Ue.pageSize=1,ft(r.pid)},ft=async e=>{if(!e)return;const{data:t}=await Mn({page:Ue.page,limit:Ue.pageSize,fuzzy:Ue.fuzzy,creater:Ue.creater,pid:e});f.value.developBusinessList=t.list,Ue.itemCount=t.total,f.value.developBusinessList.forEach(n=>{n.setStatus=!1}),ne.developBusinessList=JSON.parse(JSON.stringify(f.value.developBusinessList))},Rt=e=>{f.value.developBusinessList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},zl=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value.developBusinessList=JSON.parse(JSON.stringify(ne.developBusinessList)):f.value.developBusinessList.splice(t,1)},jl=async e=>{var t,n,i,U,B,de,ye,be;if(!e.saving){if(!e.affectedbusiness){(t=window.$message)==null||t.warning("请输入影响的业务");return}if(!e.devname){(n=window.$message)==null||n.warning("请输入设备名称");return}if(!e.apidocument){(i=window.$message)==null||i.warning("请输入接口文档");return}if(!e.uid){(U=window.$message)==null||U.warning("请输入研发对接人");return}if(!e.period){(B=window.$message)==null||B.warning("请输入研发周期");return}e.saving=!0;try{if(((de=e.fileList)==null?void 0:de.length)>0){const ue=e.fileList.filter(me=>me.file),se=ue.length;for(let me=0;me<se;me++){const $e=ue[me];$e.indexText=`${me+1}/${se}`,$e.progress=0,$e.status="uploading";try{$e.url=await $t($e.file.file,$e.file.name,""),$e.progress=100,$e.status="done"}catch{$e.status="error"}}e.fileList.forEach((me,$e)=>{e[`re${$e+1}`]=me.name||"",e[`fl${$e+1}`]=me.url||""}),delete e.fileList}if(e.id){const{data:ue,error:se}=await Rn([e]);se||((ye=window.$message)==null||ye.success("修改成功"),ft(r.pid),e.setStatus=!e.setStatus)}else{const{data:ue,error:se}=await Jn([{...e,pid:r.pid}]);se||((be=window.$message)==null||be.success("添加成功"),ft(r.pid),e.setStatus=!e.setStatus,Ye())}}finally{e.saving=!1}}};function Ul(){var e;Et.value.includes("2")||Et.value.push("2"),((e=f.value.developBusinessList[0])!=null&&e.id||f.value.developBusinessList.length==0)&&f.value.developBusinessList.unshift({affectedbusiness:"",devname:"",apidocument:"",uid:"",period:void 0,notes:"",setStatus:!0})}const Bl=[{title:"需求内容",key:"reqcontent",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.reqcontent,placeholder:"请输入需求内容",onUpdateValue(n){f.value.needsList[t].reqcontent=n}}):l("div",{},e.reqcontent)}},{title:"客户联系人",key:"customer",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.customer,placeholder:"请输入客户联系人",onUpdateValue(n){f.value.needsList[t].customer=n}}):l("div",{},e.customer)}},{title:"联系方式",key:"cstcontact",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.cstcontact,placeholder:"请输入联系方式",onUpdateValue(n){f.value.needsList[t].cstcontact=n}}):l("div",{},e.cstcontact)}},{title:"结果",key:"cstresult",align:"center",render(e,t){return e.setStatus?l(Ee,{value:e.cstresult,filterable:!0,placeholder:"请选择结果",options:[{label:"成功",value:1},{label:"失败",value:0}],onUpdateValue(n){f.value.needsList[t].cstresult=Number(n)||0}}):l("div",{},e.cstresult==1?"成功":"失败")}},{title:"备注",key:"notes",align:"center",render(e,t){return e.setStatus?l(ie,{value:e.notes,placeholder:"请输入备注",onUpdateValue(n){f.value.needsList[t].notes=n}}):l("div",{},e.notes)}},{title:"文件",key:"re1",align:"center",render(e,t){return e.setStatus?l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>vl(e,"needsList",t)},{default:()=>"上传文件"}):l(_t,{trigger:"hover"},{trigger:()=>l("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const n=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return n.length===0?l("div",{style:"padding: 10px; color: #999;"},"暂无文件"):l("div",{style:"padding: 10px;"},[l("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[l("thead",[l("tr",[l("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),l("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),l("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),l("tbody",n.map((i,U)=>{var B;return l("tr",[l("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},((B=i.file)==null?void 0:B.split("?")[1])||"-"),l("td",{style:"text-align:center; padding: 4px 8px;"},l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>yl({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?it(1,e.dbtime):""},{key:"operate",title:X("common.operate"),align:"center",minWidth:120,fixed:"right",render(e,t){return l("div",{class:"flex-center gap-8px"},[e.setStatus?[Ve("project:Customer:insert")&&l(_,{type:"primary",ghost:!0,size:"small",loading:e.saving,disabled:e.saving,onClick:()=>z(e)},{default:()=>"保存"}),l(_,{type:"default",ghost:!0,size:"small",onClick:()=>ul(e,t)},{default:()=>"取消"}),Ve("project:Customer:delete")&&l(We,{onPositiveClick:async()=>{var n;if(e.id){const{data:i,error:U}=await Hn(e.id,r.pid);i&&(f.value.needsList.splice(t,1),(n=window.$message)==null||n.success("删除成功"),ht(r.pid),Ye())}else f.value.needsList.splice(t,1)}},{default:()=>X("common.confirmDelete"),trigger:()=>l(_,{type:"error",ghost:!0,size:"small"},{default:()=>X("common.delete")})})]:Ve("project:Customer:update")&&l(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Fl(e)},{default:()=>"编辑"})])}}],Ae=st({page:1,pageSize:1,showSizePicker:!0,itemCount:0,fuzzy:"",creater:"",pageSizes:[10,20],prefix:()=>`共 ${Ae.itemCount} 条`,onChange:e=>{Ae.page=e,ht(r.pid)},onUpdatePageSize:e=>{Ae.pageSize=e,Ae.page=1,ht(r.pid)}}),dl=()=>{Ae.pageSize==1?Ae.pageSize=20:Ae.pageSize=1,ht(r.pid)},ht=async e=>{if(!e)return;const{data:t}=await Gn({page:Ae.page,limit:Ae.pageSize,fuzzy:Ae.fuzzy,creater:Ae.creater,pid:e});f.value.needsList=t.list,Ae.itemCount=t.total,f.value.needsList.forEach(n=>{n.setStatus=!1}),ne.needsList=JSON.parse(JSON.stringify(f.value.needsList))},Fl=e=>{f.value.needsList.forEach(t=>{t.setStatus=!1}),e.cstresult=e.cstresult&&e.cstresult*1,e.setStatus=!e.setStatus},ul=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value.needsList=JSON.parse(JSON.stringify(ne.needsList)):f.value.needsList.splice(t,1)},z=async e=>{var t,n,i,U,B,de;if(!e.saving){if(!e.reqcontent){(t=window.$message)==null||t.error("需求内容不能为空");return}if(!e.customer){(n=window.$message)==null||n.error("客户联系人不能为空");return}if(!e.cstcontact){(i=window.$message)==null||i.error("联系方式不能为空");return}e.saving=!0;try{if(((U=e.fileList)==null?void 0:U.length)>0){const ye=e.fileList.filter(ue=>ue.file),be=ye.length;for(let ue=0;ue<be;ue++){const se=ye[ue];se.indexText=`${ue+1}/${be}`,se.progress=0,se.status="uploading";try{se.url=await $t(se.file.file,se.file.name,""),se.progress=100,se.status="done"}catch{se.status="error"}}e.fileList.forEach((ue,se)=>{e[`re${se+1}`]=ue.name||"",e[`fl${se+1}`]=ue.url||""}),delete e.fileList}if(e.id){const{data:ye,error:be}=await Wn([e]);be||((B=window.$message)==null||B.success("修改成功"),ht(r.pid),e.setStatus=!e.setStatus)}else{const{data:ye,error:be}=await Kn([{...e,pid:r.pid}]);be||((de=window.$message)==null||de.success("添加成功"),ht(r.pid),e.setStatus=!e.setStatus,Ye())}}finally{e.saving=!1}}};function Re(){var e;Et.value.includes("3")||Et.value.push("3"),((e=f.value.needsList[0])!=null&&e.id||f.value.needsList.length==0)&&f.value.needsList.unshift({reqcontent:"",customer:"",cstcontact:"",cstresult:0,notes:"",setStatus:!0})}const f=b({projectDetail:{},contactList:[],prjCycleList:[],fileList:[],DebuggingEngineerList:[],debuggedDevieceList:[],debuggedBusinessList:[],developBusinessList:[],needsList:[]}),Jt=[{key:"kk",title:" ",align:"center",width:120,render:e=>a("div",null,[e.username+"的项目总结"])},{key:"charctras",title:"字符数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:X("common.operate"),align:"center",width:140,fixed:"right",render:e=>{let t;return a("div",{class:"flex-center gap-8px"},[a(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ba(e)},{default:()=>[m("查看详情")]}),F.userInfo.id==e.creater&&Be(a(_,{type:"primary",ghost:!0,size:"small",onClick:()=>fl(e)},xl(t=X("common.edit"))?t:{default:()=>[t]}),[[ct("no-auth"),"project:Summary:update"]]),F.userInfo.id==e.creater&&a(We,{onPositiveClick:()=>pl(e.id)},{default:()=>X("common.confirmDelete"),trigger:()=>{let n;return Be(a(_,{type:"error",ghost:!0,size:"small"},xl(n=X("common.delete"))?n:{default:()=>[n]}),[[ct("no-auth"),"project:Summary:delete"]])}})])}}],et=st({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${et.itemCount} 条`,onChange:e=>{et.page=e,Lt(r.pid)},onUpdatePageSize:e=>{et.pageSize=e,et.page=1,Lt(r.pid)}}),Tt=b([]),Lt=async e=>{const{data:t,error:n}=await Qn({page:et.page,limit:et.pageSize,pid:e});n||(Tt.value=t.list,et.itemCount=t.total,Ye())},cl=()=>{rt.value=void 0,Dt.value=!0};async function pl(e){var i;const{data:t,error:n}=await Yn(e);n||((i=window.$message)==null||i.success("删除成功"),Lt(r.pid))}const Dt=b(!1);function fl(e){rt.value=e,Dt.value=!0}const Qe=b(!1),rt=b({}),Ba=e=>{Qe.value=!0,rt.value=e},ea=[{key:"notes",title:"今日工作内容",align:"center",width:300,render(e){return l(At,{tooltipPlacement:"center",lineClamp:3,style:{minWidth:"280px"}},{default:()=>e.notes||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.notes||"")})}},{key:"problem",title:"遇到问题",align:"center",width:120,render(e){return l(At,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.problem||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.problem||"")})}},{key:"solutions",title:"解决措施",align:"center",width:120,render(e){return l(At,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.solutions||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.solutions||"")})}},{key:"feedback",title:"建议意见反馈",align:"center",width:120,render(e){return l(At,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.feedback||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.feedback||"")})}},{key:"summarize",title:"总结",align:"center",width:120,render(e){return l(At,{tooltipPlacement:"center",lineClamp:3,style:{maxWidth:"120px"}},{default:()=>e.summarize||"",tooltip:()=>l("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.summarize||"")})}},{key:"username",title:"创建信息",align:"left",width:200,render(e){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[m("创建人：")]),a("span",null,[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[m("创建时间：")]),a("span",null,[e.dbtime||"-"])])])}},{key:"operate",title:X("common.operate"),align:"center",width:100,fixed:"right",render:e=>{let t;return a("div",{class:"flex-center gap-8px"},[F.userInfo.id==e.creater&&Be(a(_,{type:"primary",ghost:!0,size:"small",onClick:()=>Ia(e)},xl(t=X("common.edit"))?t:{default:()=>[t]}),[[ct("no-auth"),"project:Summary:update"]]),F.userInfo.id==e.creater&&a(We,{onPositiveClick:()=>Pa(e.id)},{default:()=>X("common.confirmDelete"),trigger:()=>{let n;return Be(a(_,{type:"error",ghost:!0,size:"small"},xl(n=X("common.delete"))?n:{default:()=>[n]}),[[ct("no-auth"),"project:Summary:delete"]])}})])}}],gt=st({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${gt.itemCount} 条`,onChange:e=>{gt.page=e,Ht(r.pid)},onUpdatePageSize:e=>{gt.pageSize=e,gt.page=1,Ht(r.pid)}}),Pl=b([]),Ht=async e=>{const{data:t,error:n}=await Da({page:gt.page,limit:gt.pageSize,pid:e});n||(Pl.value=t.list.map(i=>{const U=JSON.parse(i.context);return i.notes=U.notes,i.problem=U.problem,i.solutions=U.solutions,i.feedback=U.feedback,i.summarize=U.summarize,i}),gt.itemCount=t.total,Ye())},Fa=()=>{rt.value=void 0,gl.value=!0};async function Pa(e){var i;const{data:t,error:n}=await ja(e);n||((i=window.$message)==null||i.success("删除成功"),Ht(r.pid))}const gl=b(!1);function Ia(e){rt.value=e,gl.value=!0}const ta=b(!1);function la(){Wt()}const Il=b(!1),Na=async e=>{if(!e){f.value={projectDetail:{},contactList:[],debuggedBusinessList:[],fileList:[],debuggedDevieceList:[],DebuggingEngineerList:[],developBusinessList:[],needsList:[]};return}Il.value=!0;try{const t=await Promise.allSettled([Ne(e),St(e),M(),Ce(e),Ge(e),N(e),Ta(),ft(e),ht(e),Lt(e),Ht(e)]);Ye(),t.forEach((n,i)=>{n.status==="fulfilled"?console.log(`任务 ${i} 成功:`,n):console.warn(`任务 ${i} 失败:`,n.reason)})}catch(t){console.error("意料之外的错误:",t)}finally{Il.value=!1}},Gt=b(),aa=[{key:"cusname",title:"客户名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"token",title:"气象信息Token",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[a("span",null,[e.token||"-"]),a(ns,{trigger:"hover"},{trigger:()=>a(_,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>na(e.token)},{default:()=>[m("复制")]}),default:()=>"复制 token"})])}},{key:"passward",title:"气象信息Passward",align:"center",width:200,render(e){return a("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[a("span",null,[e.passward||"-"]),a(_,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>na(e.passward)},{default:()=>[m("复制")]})])}},{key:"longitude",title:"经度",align:"center",width:120},{key:"latitude",title:"维度",align:"center",width:120},{key:"pro",title:"墨迹合同项目名称",align:"center",width:140},{key:"expiare",title:"过期时间",align:"center",width:180},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建信息",align:"left",width:200,render(e){return a("div",{style:"display:flex; flex-direction:column; font-size:13px; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[m("创建人：")]),a("span",{style:"font-weight:500"},[e.username||"-"])]),a("div",null,[a("span",{style:"color:#666"},[m("时间：")]),a("span",{style:" font-weight:500"},[e.dbtime||"-"])])])}}],Ta=async()=>{const{data:e,error:t}=await Ss({page:1,limit:99,pid:r.pid});Gt.value=e.list,Gt.value.length>0&&F.userInfo.usertype!=1&&(H[5]={id:"phase6",title:"气象信息",show:!0,tables:[{id:1,name:"气象信息",type:1}]})},na=async e=>{var t;e&&(await navigator.clipboard.writeText(e),(t=window.$message)==null||t.success("已复制"))},Ye=()=>{H[0].tables=[{id:1,name:"项目联系人",type:f.value.contactList.length>0?1:0},{id:2,name:"待调试设备",type:f.value.debuggedDevieceList.length>0?1:0},{id:3,name:"图纸",type:f.value.fileList.length>0?1:0}],H[1].tables=[{id:1,name:"待调试业务",type:f.value.debuggedBusinessList.length>0?1:0},{id:2,name:"需要开发",type:f.value.developBusinessList.length>0?1:0},{id:3,name:"需求变更",type:f.value.needsList.length>0?1:0},{id:4,name:"文件",type:Kt.value.length>0||Qt.value.length>0||Yt.value.length>0||Xt.value.length>0||Zt.value.length>0?1:0}],H[2].tables=[{id:1,name:"项目验收",type:el.value.length>0?1:0}],H[3].tables=[{id:1,name:"项目总结",type:Tt.value.length>0?1:0}],H[4].tables=[{id:1,name:"项目日报",type:Pl.value.length>0?1:0}]};async function Wt(){F.userInfo.usertype==1&&(H[3]=null,H[4]=null,H=H.filter(e=>e!==null)),r.pid&&(await Na(r.pid),ze(),je(),Ye(),setTimeout(()=>{De.replace({path:S.path,query:{}})},100))}const Ea=()=>{const e=document.getElementById("__SCROLL_EL_ID__");e==null||e.scrollTo({top:0,behavior:"smooth"})},sa=e=>{H[e].show=!H[e].show},Nl=e=>{const t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth",block:"start"}),oe.value=e)},Tl=()=>{const e=[];H.forEach(i=>{i.tables.forEach((U,B)=>e.push(`${i.id}-${B}`))});const t=window.scrollY;let n="";for(const i of e){const U=document.getElementById(i);U&&U.offsetTop-100<=t&&(n=i)}oe.value=n},Kt=b([]),Qt=b([]),Yt=b([]),Xt=b([]),Zt=b([]),el=b([]),ia=b({});async function St(e){const{data:t,error:n}=await ss({limit:100,page:1,pid:e});n||(f.value.fileList=[],Kt.value=[],Qt.value=[],Yt.value=[],Xt.value=[],Zt.value=[],el.value=[],ia.value=t,console.log("data",ia.value),t.list.forEach(i=>{i.sort==1&&f.value.fileList.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==2&&Kt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==3&&Qt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==4&&Yt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==5&&Xt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==6&&Zt.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime}),i.sort==7&&el.value.push({id:i.id,name:i.filename,url:i.file.split("?")[0],filename:i.file.split("?")[1],status:"finished",creator:i.username,dbtime:i.dbtime})}),f.value.fileList.reverse(),Kt.value.reverse(),Qt.value.reverse(),Yt.value.reverse(),Xt.value.reverse(),Zt.value.reverse(),el.value.reverse(),Ye())}const Aa=e=>{const t=e.target,n=document.getElementById("__SCROLL_EL_ID__"),i=document.getElementById("scrollToTop");!n||!i||(t.scrollTop>(n.clientHeight||0)+500?i.classList.add("show"):i.classList.remove("show"))},dt=b([]),{pageData:zt,getData:ml,nextPage:Va}=pt(os),Oa=async e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&zt.data.length<zt.total&&(await Va(),dt.value=zt.data,await yt(),setTimeout(()=>{t.scrollTop=n}))},qa=Ql.debounce(async e=>{await ml({fuzzy:e,page:1}),dt.value=zt.data},300),El=b(!1),Al=b(!1),Ma=e=>{if(r.pid=null,El.value=!0,Al.value=!1,!e){oa();return}qa(e)},Ra=async()=>{El.value&&!Al.value&&(await ml({page:1}),dt.value=zt.data,El.value=!1,await Wt())},oa=async()=>{await ml({page:1}),dt.value=zt.data,await Wt()},Ja=async e=>{var t;Al.value=!0,e&&(r.pid=e,F.setProjectInfo({pid:e,pname:(t=dt.value.find(n=>n.id==r.pid))==null?void 0:t.proname}),await Wt())},Ha=async()=>{var e;await ml({fuzzy:S.query.pname?S.query.pname:F.userInfo.pname||void 0}),dt.value=zt.data,r.pid=(S.query.prjId?Number(S.query.prjId):F.userInfo.pid?Number(F.userInfo.pid):Number((e=dt.value[0])==null?void 0:e.id))||void 0,F.setProjectInfo({pid:r.pid,pname:F.userInfo.pname})},tl=b(!1),jt=b(""),Vl=b(),vl=(e,t,n)=>{bt.value=[{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}],tl.value=!0,jt.value=t,Vl.value=n,e.re1&&(bt.value[0]={name:e.re1,url:e.fl1,file:void 0}),e.re2&&(bt.value[1]={name:e.re2,url:e.fl2,file:void 0}),e.re3&&(bt.value[2]={name:e.re3,url:e.fl3,file:void 0}),e.re4&&(bt.value[3]={name:e.re4,url:e.fl4,file:void 0}),console.log(bt.value)},Ga=[{title:"",key:"",align:"center",render(e,t){return`附件${t+1}`}},{title:"文件名称",key:"filename",align:"center",render(e){var i;const t=async({file:U,onFinish:B,onError:de})=>{var ye,be;try{e.name=U.name,e.file=U}catch(ue){console.error(ue),(be=(ye=window.$message)==null?void 0:ye.error)==null||be.call(ye,"文件上传出错")}};async function n(U){return!0}return l("div",{style:"display:flex;justify-content:center;align-items:center;"},[e.file||e.url?l("span",{},[l("span",{},((i=e.file)==null?void 0:i.name)||e.url.split("?")[1]||""),l("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{e.url="",e.file=null,e.name=""}},"删除")]):l(sl,{action:"#",showFileList:!1,customRequest:t,onBeforeUpload:n},{default:()=>l(_,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(e){return l(ie,{value:e.name,clearable:!0,onUpdateValue:t=>{e.name=t}})}}],bt=b([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",rl:"",file:void 0}]);async function yl(e){if(e!=null&&e.url)try{const n=await(await fetch(e.url.split("?")[0],{mode:"cors"})).blob(),i=URL.createObjectURL(n),U=document.createElement("a");U.href=i,U.download=e.url.split("?")[1],U.style.display="none",document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(i)}catch(t){console.error("下载失败:",t)}}const Wa=async()=>{var t,n;let e=!0;if(bt.value.forEach((i,U)=>{var ye,be;const B=i.name||"",de=((ye=i.url)==null?void 0:ye.split("?")[1])||((be=i.file)==null?void 0:be.name);(B&&!de||!B&&de)&&(e=!1)}),!e){(n=(t=window.$message)==null?void 0:t.error)==null||n.call(t,"文件名称和文件地址必须同时存在，不能只填一个");return}f.value[jt.value][Vl.value].fileList=bt.value,e&&(tl.value=!1,jt.value="",Vl.value=void 0)},Ka=()=>{tl.value=!1},ra=b(!1),Ol=b([]),Qa=async()=>{var n;if(!r.pid)return(n=window.$message)==null?void 0:n.warning("请选择项目");const{data:e,error:t}=await is({page:1,limit:100,pid:r.pid});Ol.value=(e==null?void 0:e.list)||[]},Ya=e=>{e&&navigator.clipboard.writeText(e).then(()=>{var t;(t=window.$message)==null||t.success("已复制到剪贴板")}).catch(()=>{var t;(t=window.$message)==null||t.error("复制失败，请手动复制")})};Kl(async()=>{await Ha(),Wt(),S.query.IsScroll&&setTimeout(()=>{Nl("phase2-0")},800),window.addEventListener("scroll",Tl);const e=document.getElementById("__SCROLL_EL_ID__");e&&e.addEventListener("scroll",Aa)}),Xn(()=>{window.removeEventListener("scroll",Tl);const e=document.getElementById("__SCROLL_EL_ID__");e&&e.removeEventListener("scroll",Tl)});async function hl(e){if(!e)return;const t=e.split("?")[0],n=e.split("?")[1];try{const U=await(await fetch(t,{mode:"cors"})).blob(),B=URL.createObjectURL(U),de=document.createElement("a");de.href=B,de.download=n,de.style.display="none",document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(B)}catch(i){console.error("下载失败:",i)}}const bl=b(["1","2","3"]),Xa=e=>{bl.value=e},Et=b(["1","2","3","4"]),Za=e=>{Et.value=e},ql=b(!1),en=()=>{var e;r.pid?ql.value=!0:(e=window.$message)==null||e.warning("请选择项目")};return(e,t)=>{const n=on,i=ws,U=cn,B=Ua,de=ba,ye=Yl,be=rn,ue=va,se=Gl,me=Wl,$e=un,_l=ln,at=dn,Ut=il,nt=ts,tt=ls,mt=ct("no-auth"),tn=ct("loading");return u(),x("div",ro,[g("div",{id:"scrollToTop",onClick:Ea,title:"回到顶部"},[a(n,{class:"font-size-30px"})]),a(ye,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[a(de,{ref:"formRef",model:r,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ha(la,["enter"])},{default:s(()=>[a(B,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[a(i,{span:"24 s:12 m:8",label:"所属项目",path:"pid"},{default:s(()=>[a(p(Ee),{filterable:"",clearable:"",value:r.pid,"onUpdate:value":[t[0]||(t[0]=Te=>r.pid=Te),Ja],placeholder:"请选择所属项目","label-field":"proname","value-field":"id",onClear:oa,onSearch:Ma,onBlur:Ra,options:p(Zn)(dt.value),onScroll:Oa},null,8,["value","options"])]),_:1}),a(i,{span:"24  s:12 m:8",class:"pr-24px"},{default:s(()=>[a(p(Oe),{class:"w-full"},{default:s(()=>[a(p(_),{type:"primary",ghost:"",onClick:la},{icon:s(()=>[a(U,{class:"text-icon"})]),default:s(()=>[m(" "+j(p(X)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(ye,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper overflow-auto pb-40px content","content-style":{padding:"20px 10px 5px 0"}},{default:s(()=>[Be((u(),x("div",uo,[g("div",co,[g("div",po,[(u(!0),x(Je,null,It(p(H),(Te,Xe)=>(u(),x("div",{key:Te.id,class:"timeline-phase"},[g("div",{class:"timeline-row",id:"phase"+(Xe+1)},[g("div",go,[t[22]||(t[22]=g("div",{class:"vertical-line"},null,-1)),g("div",{class:"flashing-icon",onClick:te=>sa(Xe)},null,8,mo)]),g("div",vo,[g("div",{class:"phase-title",onClick:te=>sa(Xe)},j(Te.title),9,yo),a(p(Oe),null,{default:s(()=>[Xe===0?(u(),I(p(_),{key:0,onClick:en,ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:s(()=>t[23]||(t[23]=[m("工程调试确认单")])),_:1,__:[23]})):C("",!0),Xe===0?(u(),I(p(_t),{key:1,trigger:"click",placement:"left-start",width:1e3},{trigger:s(()=>[Be((u(),I(p(_),{ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:s(()=>t[24]||(t[24]=[m("查询关联合同")])),_:1,__:[24]})),[[mt,"project:Contract:select"]])]),default:s(()=>[a(xi,{id:r.pid},null,8,["id"])]),_:1})):C("",!0),Xe===0?(u(),I(p(_t),{key:2,trigger:"click",placement:"left-start"},{trigger:s(()=>[Be((u(),I(p(_),{onClick:Qa,ghost:"",type:"primary",style:{"margin-bottom":"5px"}},{default:s(()=>t[25]||(t[25]=[m("查询项目调度")])),_:1,__:[25]})),[[mt,"project:Dispatch:select"]])]),default:s(()=>[Ol.value.length>0?(u(),I(p($s),{key:0,bordered:!1,"single-line":!1},{default:s(()=>[t[35]||(t[35]=g("thead",null,[g("tr",null,[g("th",null,"调度名称"),g("th",null,"调度联系方式"),g("th",null,"相关文件")])],-1)),g("tbody",null,[(u(!0),x(Je,null,It(Ol.value,te=>{var vt,ll,al,nl;return u(),x("tr",{key:te.id},[g("td",null,j(te.dname),1),g("td",null,[g("span",ho,j(te.dcon),1),a(p(_),{size:"tiny",type:"primary",ghost:"",onClick:Bt=>Ya(te.dcon)},{default:s(()=>t[26]||(t[26]=[m(" 复制 ")])),_:2,__:[26]},1032,["onClick"])]),g("td",null,[te.re1&&te.fl1?(u(),x("div",bo,[g("span",_o,"文件别名："+j(te.re1),1),t[27]||(t[27]=g("span",{class:"ml-10px"},"文件名称:",-1)),t[28]||(t[28]=m()),g("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Bt=>hl(te.fl1)},j((vt=te.fl1)==null?void 0:vt.split("?")[1]),9,xo)])):C("",!0),te.re2&&te.fl2?(u(),x("div",ko,[g("span",Co,"文件别名："+j(te.re2),1),t[29]||(t[29]=g("span",{class:"ml-10px"},"文件名称:",-1)),t[30]||(t[30]=m()),g("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Bt=>hl(te.fl1)},j((ll=te.fl2)==null?void 0:ll.split("?")[1]),9,Lo)])):C("",!0),te.re3&&te.fl3?(u(),x("div",So,[g("span",wo,"文件别名："+j(te.re3),1),t[31]||(t[31]=g("span",{class:"ml-10px"},"文件名称:",-1)),t[32]||(t[32]=m()),g("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Bt=>hl(te.fl1)},j((al=te.fl3)==null?void 0:al.split("?")[1]),9,$o)])):C("",!0),te.re4&&te.fl4?(u(),x("div",Do,[g("span",zo,"文件别名："+j(te.re4),1),t[33]||(t[33]=g("span",{class:"ml-10px"},"文件名称:",-1)),t[34]||(t[34]=m()),g("span",{class:"c-#1890ff text-decoration-underline cursor-pointer",onClick:Bt=>hl(te.fl1)},j((nl=te.fl4)==null?void 0:nl.split("?")[1]),9,jo)])):C("",!0)])])}),128))])]),_:2,__:[35]},1024)):(u(),x("div",Uo,"暂无调度"))]),_:2},1024)):C("",!0)]),_:2},1024)])],8,fo),a(ya,{name:"fade"},{default:s(()=>[Be(g("div",Bo,[Xe===0?(u(),x("div",Fo,[a(oo,{pid:r.pid,onSearchDetail:t[1]||(t[1]=te=>Ne(r.pid)),ref_for:!0,ref_key:"detailRef",ref:ce,userList:p(P).data,prjDetailInfo:f.value.projectDetail},null,8,["pid","userList","prjDetailInfo"])])):C("",!0),(u(!0),x(Je,null,It(Te.tables,(te,vt)=>{var ll,al,nl,Bt;return u(),x("div",{key:`${Te.id}-${vt}`,class:"timeline-row"},[g("div",Po,[t[36]||(t[36]=g("div",{class:"vertical-line"},null,-1)),te.type==1?(u(),x("div",{key:0,class:Pt(["icon",{active:oe.value===`${Te.id}-${vt}`}]),style:{"font-size":"20px",border:"3px solid #409eff",color:"#409eff"},onClick:A=>Nl(`${Te.id}-${vt}`)},[a(be)],10,Io)):(u(),x("div",{key:1,class:"icon",style:{"font-size":"20px",border:"3px solid #ccc",color:"#ccc"},onClick:A=>Nl(`${Te.id}-${vt}`)}," 一 ",8,No))]),g("div",{class:"actProgress",style:xt({background:te.type==1?"#409eff":"#ccc"})},null,4),g("div",{class:"timeline-content",id:`${Te.id}-${vt}`},[Xe===0?(u(),x(Je,{key:0},[a(at,{"expanded-names":bl.value,"onUpdate:expandedNames":Xa,"trigger-areas":["arrow"]},{default:s(()=>[te.id==1?(u(),I($e,{key:0,name:"1"},{header:s(()=>[a(p(Oe),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[g("div",Eo,[t[38]||(t[38]=g("span",null,"项目联系人",-1)),Be((u(),I(p(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:wt(Le,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[37]||(t[37]=m(" 添加项目联系人 "))]),_:1,__:[37]})),[[mt,"project:Contact:insert"]])])]),_:1})]),default:s(()=>[f.value.contactList.length>0?(u(),I(p(lt),{key:0,columns:Me,data:f.value.contactList,size:"small","scroll-x":702,"row-key":A=>A.id,"paginate-single-page":!1,"max-height":350,pagination:pe.pageSize==1?!1:pe,remote:""},null,8,["data","row-key","pagination"])):C("",!0),pe.itemCount>1?(u(),x("div",Ao,[f.value.contactList.length==1?(u(),x("span",{key:0,onClick:qe},[t[39]||(t[39]=m("更多")),a(se,{class:"font-size-20px"})])):(u(),x("span",{key:1,onClick:qe},[t[40]||(t[40]=m("收起")),a(me,{class:"font-size-20px"})]))])):C("",!0)]),_:1})):C("",!0),te.id==2?(u(),I($e,{key:1,title:"待调试设备",name:"2"},{header:s(()=>[a(p(Oe),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>{var A;return[g("div",Vo,[t[44]||(t[44]=g("span",null,"待调试设备",-1)),g("div",Oo,[Be((u(),I(p(_),{size:"small",ghost:"",type:"primary",onClick:wt(T,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[41]||(t[41]=m(" 添加待调试设备 "))]),_:1,__:[41]})),[[mt,"project:Equipment:insert"]]),(A=f.value.debuggedDevieceList)!=null&&A.some(ut=>ut.status===0)?(u(),I(p(We),{key:0,onPositiveClick:c},{trigger:s(()=>[Be((u(),I(p(_),{size:"small",ghost:"",type:"primary"},{default:s(()=>[a(_l,{class:"text-icon"}),t[42]||(t[42]=m(" 一键清点设备 "))]),_:1,__:[42]})),[[mt,"project:Equipment:update"]])]),default:s(()=>[t[43]||(t[43]=m(" 确定要清点当前列表中未清点的设备吗？ "))]),_:1,__:[43]})):C("",!0)])]),K.itemCount>0?(u(),x("div",qo,"共"+j(K.itemCount)+"条",1)):C("",!0)]}),_:2},1024)]),default:s(()=>[a(Ci,{onSubmitted:t[2]||(t[2]=A=>N(r.pid)),visible:L.value,"onUpdate:visible":t[3]||(t[3]=A=>L.value=A),pid:r.pid},null,8,["visible","pid"]),f.value.debuggedDevieceList.length>0?(u(),I(p(lt),{key:0,style:xt({width:p(fe).siderCollapse?"calc(100vw - 219px)":"calc(100vw - 352px)"}),columns:Ze,data:f.value.debuggedDevieceList,size:"small","scroll-x":Ze.reduce((A,ut)=>A+ut.width,0),"row-key":A=>A.id,"max-height":350,pagination:K.pageSize==1?!1:K,remote:"","paginate-single-page":!1},null,8,["style","data","scroll-x","row-key","pagination"])):C("",!0),K.itemCount>1?(u(),x("div",Mo,[f.value.debuggedDevieceList.length==1?(u(),x("span",{key:0,onClick:he},[t[45]||(t[45]=m("更多")),a(se,{class:"font-size-20px"})])):(u(),x("span",{key:1,onClick:he},[t[46]||(t[46]=m("收起")),a(me,{class:"font-size-20px"})]))])):C("",!0)]),_:2},1024)):C("",!0),te.id==3?(u(),I($e,{key:2,title:"图纸",name:"3"},{default:s(()=>[a(Ft,{data:f.value.fileList,pid:r.pid,onGetData:t[4]||(t[4]=A=>St(r.pid)),typename:"图纸",fileType:1},null,8,["data","pid"])]),_:1})):C("",!0)]),_:2},1032,["expanded-names"]),te==4?(u(),x("div",Ro)):C("",!0)],64)):C("",!0),Xe===1?(u(),x(Je,{key:1},[a(at,{"expanded-names":Et.value,"onUpdate:expandedNames":Za,"trigger-areas":["arrow"]},{default:s(()=>[te.id==1?(u(),I($e,{key:0,title:"待调试业务",name:"1"},{header:s(()=>[a(p(Oe),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[g("div",Jo,[t[48]||(t[48]=g("span",null,[m("待调试业务 "),g("span",{class:"c-#f0a020 font-bold"},"※")],-1)),Be((u(),I(p(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:wt(ol,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[47]||(t[47]=m(" 添加待调试业务 "))]),_:1,__:[47]})),[[mt,"project:Debug:insert"]])]),Y.itemCount>0?(u(),x("div",Ho,"共"+j(Y.itemCount)+"条",1)):C("",!0)]),_:1})]),default:s(()=>[a(ki,{onSubmitted:t[5]||(t[5]=A=>Ge(r.pid)),visible:qt.value,"onUpdate:visible":t[6]||(t[6]=A=>qt.value=A),pid:r.pid},null,8,["visible","pid"]),f.value.debuggedBusinessList.length>0?(u(),I(p(lt),{key:0,style:xt({width:p(fe).siderCollapse?"calc(100vw - 219px)":"calc(100vw - 352px)"}),columns:ge,data:f.value.debuggedBusinessList,size:"small","row-key":A=>A.id,striped:"","scroll-x":ge.reduce((A,ut)=>A+ut.width,0),"paginate-single-page":!1,pagination:Y.pageSize==1?!1:Y,remote:"","max-height":350},null,8,["style","data","row-key","scroll-x","pagination"])):C("",!0),Y.itemCount>1?(u(),x("div",Go,[f.value.debuggedBusinessList.length==1?(u(),x("span",{key:0,onClick:Ie},[t[49]||(t[49]=m(" 更多 ")),a(se,{class:"font-size-20px"})])):(u(),x("span",{key:1,onClick:Ie},[t[50]||(t[50]=m(" 收起 ")),a(me,{class:"font-size-20px"})]))])):C("",!0)]),_:1})):C("",!0),te.id===2&&p(F).userInfo.usertype!==1?(u(),I($e,{key:1,title:"需要开发",name:"2"},{header:s(()=>[a(p(Oe),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[g("div",Wo,[t[52]||(t[52]=g("span",null,"需要开发",-1)),Be((u(),I(p(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:wt(Ul,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[51]||(t[51]=m(" 添加需要开发 "))]),_:1,__:[51]})),[[mt,"project:Development:insert"]])]),Ue.itemCount>0?(u(),x("div",Ko,"共"+j(Ue.itemCount)+"条",1)):C("",!0)]),_:1})]),default:s(()=>[f.value.developBusinessList.length>0?(u(),I(p(lt),{key:0,columns:Mt,data:f.value.developBusinessList,size:"small","scroll-x":702,"row-key":A=>A.id,pagination:Ue.pageSize==1?!1:Ue,remote:"","paginate-single-page":!1,"max-height":350},null,8,["data","row-key","pagination"])):C("",!0),Ue.itemCount>1?(u(),x("div",Qo,[f.value.developBusinessList.length==1?(u(),x("span",{key:0,onClick:rl},[t[53]||(t[53]=m(" 更多 ")),a(se,{class:"font-size-20px"})])):(u(),x("span",{key:1,onClick:rl},[t[54]||(t[54]=m(" 收起 ")),a(me,{class:"font-size-20px"})]))])):C("",!0)]),_:1})):C("",!0),te.id===3&&p(F).userInfo.usertype!==1?(u(),I($e,{key:2,title:"客户需求变更",name:"3"},{header:s(()=>[a(p(Oe),{align:"center",justify:"space-between",style:{width:"100%"}},{default:s(()=>[g("div",Yo,[t[56]||(t[56]=g("span",null,"客户需求变更",-1)),Be((u(),I(p(_),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:wt(Re,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[55]||(t[55]=m(" 添加客户需求变更 "))]),_:1,__:[55]})),[[mt,"project:Customer:insert"]])]),Ae.itemCount>0?(u(),x("div",Xo,"共"+j(Ae.itemCount)+"条",1)):C("",!0)]),_:1})]),default:s(()=>[f.value.needsList.length>0?(u(),I(p(lt),{key:0,columns:Bl,data:f.value.needsList,size:"small","scroll-x":702,"row-key":A=>A.id,pagination:Ae.pageSize==1?!1:Ae,remote:"","paginate-single-page":!1,"max-height":350},null,8,["data","row-key","pagination"])):C("",!0),Ae.itemCount>1?(u(),x("div",Zo,[f.value.needsList.length==1?(u(),x("span",{key:0,onClick:dl},[t[57]||(t[57]=m(" 更多 ")),a(se,{class:"font-size-20px"})])):(u(),x("span",{key:1,onClick:dl},[t[58]||(t[58]=m(" 收起 ")),a(me,{class:"font-size-20px"})]))])):C("",!0)]),_:1})):C("",!0),te.id===4?(u(),I($e,{key:3,title:"文件",name:"4"},{default:s(()=>[a(Ft,{data:Kt.value,pid:r.pid,onGetData:t[7]||(t[7]=A=>St(r.pid)),typename:"项目文件",fileType:2},null,8,["data","pid"]),p(F).userInfo.usertype!==1?(u(),I(Ft,{key:0,data:Qt.value,pid:r.pid,onGetData:t[8]||(t[8]=A=>St(r.pid)),typename:"工程文件压缩包",fileType:3},null,8,["data","pid"])):C("",!0),p(F).userInfo.usertype!==1?(u(),I(Ft,{key:1,data:Yt.value,pid:r.pid,onGetData:t[9]||(t[9]=A=>St(r.pid)),typename:"项目现场照片",fileType:4},null,8,["data","pid"])):C("",!0),p(F).userInfo.usertype!==1?(u(),I(Ft,{key:2,data:Xt.value,pid:r.pid,onGetData:t[10]||(t[10]=A=>St(r.pid)),typename:"网络通讯简图",fileType:5},null,8,["data","pid"])):C("",!0),p(F).userInfo.usertype!==1?(u(),I(Ft,{key:3,data:Zt.value,pid:r.pid,onGetData:t[11]||(t[11]=A=>St(r.pid)),typename:"组态画面工程备份",fileType:6},null,8,["data","pid"])):C("",!0)]),_:1})):C("",!0)]),_:2},1032,["expanded-names"]),vt===4?(u(),x("div",er)):C("",!0)],64)):C("",!0),Xe===2?(u(),x(Je,{key:2},[a(at,{"default-expanded-names":["1"],"trigger-areas":["arrow"]},{default:s(()=>[te.id===1?(u(),I($e,{key:0,title:"验收文件",name:"1"},{default:s(()=>[a(Ft,{data:el.value,pid:r.pid,onGetData:t[12]||(t[12]=A=>St(r.pid)),typename:"验收确认单拍照",fileType:7},null,8,["data","pid"])]),_:1})):C("",!0)]),_:2},1024),vt===0?(u(),x("div",tr)):C("",!0)],64)):C("",!0),Xe===3?(u(),x(Je,{key:3},[te.id===1?(u(),x("div",lr,[Be((u(),I(p(_),{size:"small",ghost:"",type:"primary",class:"w-160px",onClick:wt(cl,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[59]||(t[59]=m(" 添加项目总结 "))]),_:1,__:[59]})),[[mt,"project:Customer:insert"]]),et.itemCount>0?(u(),x("div",ar,"共"+j(et.itemCount)+"条",1)):C("",!0)])):C("",!0),a(p(lt),{"max-height":250,remote:"",pagination:et.pageSize==1?!1:et,"scroll-x":Jt.reduce((A,ut)=>A+(ut.width||100),0),columns:Jt,data:Tt.value,bordered:!1,"row-key":A=>A.id,"paginate-single-page":!1},null,8,["pagination","scroll-x","data","row-key"]),a(ks,{visible:Dt.value,"onUpdate:visible":t[13]||(t[13]=A=>Dt.value=A),onSubmitted:t[14]||(t[14]=A=>Lt(r.pid)),"operate-type":(ll=rt.value)!=null&&ll.id?"edit":"add",pid:r.pid,showtype:"detail",pname:(al=dt.value.find(A=>A.id==r.pid))==null?void 0:al.proname,"row-data":rt.value},null,8,["visible","operate-type","pid","pname","row-data"]),a(Cs,{visible:Qe.value,"onUpdate:visible":t[15]||(t[15]=A=>Qe.value=A),showtype:"detail","row-data":rt.value},null,8,["visible","row-data"])],64)):C("",!0),Xe===4?(u(),x(Je,{key:4},[g("div",nr,[Be((u(),I(p(_),{size:"small",ghost:"",type:"primary",class:"w-160px",onClick:wt(Fa,["stop"])},{icon:s(()=>[a(ue,{class:"text-icon"})]),default:s(()=>[t[60]||(t[60]=m(" 添加项目日报 "))]),_:1,__:[60]})),[[mt,"project:Customer:insert"]]),gt.itemCount>0?(u(),x("div",sr,"共"+j(gt.itemCount)+"条",1)):C("",!0)]),a(p(lt),{"max-height":350,remote:"",pagination:gt,"scroll-x":ea.reduce((A,ut)=>A+(ut.width||100),0),columns:ea,data:Pl.value,bordered:!1,"row-key":A=>A.id,"paginate-single-page":!1},null,8,["pagination","scroll-x","data","row-key"]),a(za,{visible:gl.value,"onUpdate:visible":t[16]||(t[16]=A=>gl.value=A),onSubmitted:t[17]||(t[17]=A=>Ht(r.pid)),"operate-type":(nl=rt.value)!=null&&nl.id?"edit":"add",pid:r.pid,pname:(Bt=dt.value.find(A=>A.id==r.pid))==null?void 0:Bt.proname,showtype:"detail","row-data":rt.value},null,8,["visible","operate-type","pid","pname","row-data"]),a(ps,{visible:ta.value,"onUpdate:visible":t[18]||(t[18]=A=>ta.value=A),showtype:"detail","row-data":rt.value},null,8,["visible","row-data"])],64)):C("",!0),Xe===5?(u(),x(Je,{key:5},[g("div",ir,[g("div",null,"共"+j(Gt.value.length)+"条",1)]),a(p(lt),{"max-height":150,style:xt({height:Gt.value.length==1?"100px":"160px"}),remote:"","scroll-x":aa.reduce((A,ut)=>A+(ut.width||100),0),columns:aa,data:Gt.value,bordered:!1,"row-key":A=>A.id,"paginate-single-page":!1,"flex-height":!p(fe).isMobile},null,8,["style","scroll-x","data","row-key","flex-height"])],64)):C("",!0)],8,To)])}),128))],512),[[es,Te.show]])]),_:2},1024)]))),128))])])])),[[tn,Il.value]])]),_:1}),a(Ut,{show:tl.value,"onUpdate:show":t[19]||(t[19]=Te=>tl.value=Te),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:s(()=>[m(j(jt.value=="debuggedDevieceList"?"待调试设备":jt.value=="debuggedBusinessList"?"待调试业务":jt.value=="needsList"?"客户需求变更":jt.value=="developBusinessList"?"需要开发":"")+" 文件列表 ",1)]),footer:s(()=>[a(p(Oe),{justify:"end"},{default:s(()=>[a(p(_),{size:"small",class:"mt-16px",onClick:Ka},{default:s(()=>[m(j(p(X)("common.cancel")),1)]),_:1}),a(p(_),{type:"primary",size:"small",class:"mt-16px",onClick:Wa},{default:s(()=>[m(j(p(X)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(p(lt),{columns:Ga,"paginate-single-page":!1,data:bt.value,"max-height":350},null,8,["data"])]),_:1},8,["show"]),a(tt,{show:ra.value,"onUpdate:show":t[20]||(t[20]=Te=>ra.value=Te),"display-directive":"show",width:700},{default:s(()=>[a(nt,{title:"日报","native-scrollbar":!1,closable:""},{default:s(()=>{var Te;return[a(si,{type:"detail",pid:r.pid,pname:((Te=dt.value.find(Xe=>Xe.id==r.pid))==null?void 0:Te.proname)||"",style:{height:"100%"}},null,8,["pid","pname"])]}),_:1})]),_:1},8,["show"]),a(Ls,{visible:ql.value,"onUpdate:visible":t[21]||(t[21]=Te=>ql.value=Te),pid:r.pid},null,8,["visible","pid"])])}}}),Ur=Sl(or,[["__scopeId","data-v-a0c81413"]]);export{Ur as default};
