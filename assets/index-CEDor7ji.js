import{_ as X}from"./table-header-operation.vue_vue_type_script_setup_true_lang-4mH7t7DH.js";import{d as K,n as G,p as j,s as L,D as E,o as O,c as q,w as a,g as e,E as F,h as R,t as B,i as t,$ as k,F as Y,aw as Z,ax as ue,J as H,B as M,N as W,O as J,ad as V,q as pe,b as me,r as _e,ae as fe,K as he,Z as ge,af as ve,ag as we,a3 as ee,e as te,ah as P,ai as ye,aj as ae,ay as be,az as De}from"./index-DsBlqHIZ.js";import{e as ke,g as Ie,h as xe,i as Ne,j as ze,k as Se,l as Te,m as Ce}from"./asset-c7m9OWJL.js";import{u as ne,a as oe}from"./table-DoWm6cq9.js";import{_ as se}from"./round-search-WKsxqVLg.js";import{_ as le}from"./round-refresh-Ck-gzDyX.js";import{_ as Ae}from"./lodash-BKkYyAYu.js";import{_ as re}from"./FormItemGridItem-C6y586sw.js";import{_ as ie}from"./Grid-Bcvow_UB.js";import{u as $e}from"./usePageData-Bmr32KWA.js";import{h as Q}from"./permission-BKTszXWx.js";import{_ as Pe}from"./Popconfirm-DTkkE6RO.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-dfkZU5GV.js";import"./setting-outlined-CkrxQSXE.js";import"./export-BC516o7C.js";import"./refresh-Du5xXcaX.js";import"./round-delete-BRpZB05_.js";import"./round-plus-Bg1tBdfz.js";import"./Upload-jAXnFyaa.js";import"./Progress-DHMZv2sT.js";const Re=K({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:G(["reset","search"],["update:model"]),setup(v,{emit:N}){const d=N,{formRef:u,restoreValidation:m}=j(),n=L(v,"model");async function w(){await m(),n.value.startAndEndIp=null,d("reset")}async function y(){var I,o,g,f;if(n.value.startAndEndIp&&n.value.startAndEndIp.length>0?(n.value.startIp=n.value.startAndEndIp[0]||null,n.value.endIp=n.value.startAndEndIp[1]||null):(n.value.startIp=null,n.value.endIp=null),n.value.startIp&&!Z(n.value.startIp)||n.value.endIp&&!Z(n.value.endIp))return(I=window.$message)==null||I.destroyAll(),(o=window.$message)==null||o.error("请输入正确的IP地址"),!1;if(n.value.startIp&&n.value.endIp&&ue(n.value.startIp,n.value.endIp)>0)return(g=window.$message)==null||g.destroyAll(),(f=window.$message)==null||f.error("起始资产IP不能大于终止资产IP"),!1;d("search")}const _=Ae.debounce(y,1e3,{leading:!0,trailing:!1});return(I,o)=>{const g=H,f=re,z=le,D=M,i=se,S=W,C=ie,$=J,T=V,h=E("no-space");return O(),q(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e($,{model:n.value,"label-placement":"left","label-width":80,"show-feedback":!1,onKeyup:Y(t(_),["enter"])},{default:a(()=>[e(C,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:a(()=>[e(f,{span:"24 s:12 m:8 l:6",label:"操作系统",path:"aname"},{default:a(()=>[F(e(g,{clearable:"",value:n.value.fuzzy,"onUpdate:value":o[0]||(o[0]=s=>n.value.fuzzy=s),placeholder:"请输入操作系统",onClear:w},null,8,["value"]),[[h]])]),_:1}),e(f,{span:"24 s:12 m:10 l:8",label:"起止IP",path:"startAndEndIp"},{default:a(()=>[e(g,{pair:"",separator:"-",placeholder:["起始资产IP","终止资产IP"],clearable:"",onClear:o[1]||(o[1]=s=>{n.value.startAndEndIp="",y()}),value:n.value.startAndEndIp,"onUpdate:value":o[2]||(o[2]=s=>n.value.startAndEndIp=s)},null,8,["value"])]),_:1}),e(f,{span:"24 s:12 m:6 l:6"},{default:a(()=>[e(S,{class:"w-full"},{default:a(()=>[e(D,{onClick:w},{icon:a(()=>[e(z,{class:"text-icon"})]),default:a(()=>[R(" "+B(t(k)("common.reset")),1)]),_:1}),e(D,{type:"primary",ghost:"",onClick:t(_)},{icon:a(()=>[e(i,{class:"text-icon"})]),default:a(()=>[R(" "+B(t(k)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Be=K({name:"DiscovertaskFormSearch",__name:"discovertask-form-search",props:{model:{required:!0},modelModifiers:{}},emits:G(["reset","search"],["update:model"]),setup(v,{emit:N}){const d=N,u=L(v,"model"),{formRef:m,restoreValidation:n}=j();async function w(){await n(),d("reset")}async function y(){d("search")}const _=()=>{u.value.fuzzy="",y()};return(I,o)=>{const g=H,f=re,z=le,D=M,i=se,S=W,C=ie,$=J,T=V,h=E("no-space");return O(),q(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e($,{model:u.value,"label-placement":"left","label-width":80,"show-feedback":!1,onKeyup:Y(y,["enter"])},{default:a(()=>[e(C,{responsive:"screen","item-responsive":""},{default:a(()=>[e(f,{span:"24 s:12 m:6",label:"任务名称",path:"fuzzy",class:"pr-24px"},{default:a(()=>[F(e(g,{clearable:"",value:u.value.fuzzy,"onUpdate:value":o[0]||(o[0]=s=>u.value.fuzzy=s),placeholder:"请输入任务名称",onClear:_},null,8,["value"]),[[h]])]),_:1}),e(f,{span:"24 s:12 m:6"},{default:a(()=>[e(S,{class:"w-full"},{default:a(()=>[e(D,{onClick:w},{icon:a(()=>[e(z,{class:"text-icon"})]),default:a(()=>[R(" "+B(t(k)("common.reset")),1)]),_:1}),e(D,{type:"primary",ghost:"",onClick:y},{icon:a(()=>[e(i,{class:"text-icon"})]),default:a(()=>[R(" "+B(t(k)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ue=K({name:"OperateDrawer",__name:"operate-drawer",props:G({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:G(["submitted"],["update:visible"]),setup(v,{emit:N}){const d=v,u=N,m=L(v,"visible"),{formRef:n,validate:w,restoreValidation:y}=j(),{defaultRequiredRule:_}=pe(),I=me(()=>({add:"添加发现任务",edit:"编辑发现任务"})[d.operateType]),o=_e(g());function g(){return{tname:"",nid:void 0}}const f={tname:_,nid:{type:"number",trigger:["blur","change"],required:!0,message:"请选择网段"}};async function z(){await S(),Object.assign(o,g()),d.operateType==="edit"&&d.rowData&&Object.assign(o,d.rowData)}function D(){m.value=!1}const{pageData:i,getData:S,nextPage:C}=$e(ke),$=async h=>{const s=h.currentTarget;s.scrollTop+s.offsetHeight>=s.scrollHeight&&i.data.length<i.total&&C()};async function T(){var h,s;if(await w(),d.operateType==="add"){const{data:p,error:l}=await Ie([{tname:o.tname,nid:o.nid}]);l||((h=window.$message)==null||h.success(k("common.addSuccess")),D(),u("submitted"))}else{const{data:p,error:l}=await xe([{id:d.rowData.id,tname:o.tname,nid:o.nid}]);l||((s=window.$message)==null||s.success(k("common.updateSuccess")),D(),u("submitted"))}}return fe(m,()=>{m.value&&(z(),y())}),(h,s)=>{const p=H,l=he,r=ge,x=J,b=M,A=W,c=ve,ce=we,de=E("no-space");return O(),q(ce,{show:m.value,"onUpdate:show":s[2]||(s[2]=U=>m.value=U),"display-directive":"show",width:450},{default:a(()=>[e(c,{title:I.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(A,{size:16},{default:a(()=>[e(b,{onClick:D},{default:a(()=>[R(B(t(k)("common.cancel")),1)]),_:1}),e(b,{type:"primary",onClick:T},{default:a(()=>[R(B(t(k)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(x,{ref_key:"formRef",ref:n,model:o,rules:f},{default:a(()=>[e(l,{label:"任务名称",path:"tname"},{default:a(()=>[F(e(p,{value:o.tname,"onUpdate:value":s[0]||(s[0]=U=>o.tname=U),placeholder:"请输入任务名称",clearable:""},null,8,["value"]),[[de]])]),_:1}),e(l,{label:"网段",path:"nid"},{default:a(()=>[e(r,{value:o.nid,"onUpdate:value":s[1]||(s[1]=U=>o.nid=U),placeholder:"请选择网段",clearable:"",filterable:"","value-field":"id","label-field":"nname",options:t(i).data,"reset-menu-on-options-change":!1,onScroll:$},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}});function Ee(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!ye(v)}const Fe=K({name:"DiscoverTask",__name:"discover-task",setup(v){const N=ee(),{columns:d,columnChecks:u,data:m,getData:n,loading:w,pagination:y,searchParams:_,resetSearchParams:I}=ne({apiFn:Ne,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"tname",title:"任务名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"nid",title:"网段",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:l=>l.startip+"~"+l.endip},{key:"status",title:"状态",align:"center",width:120},{key:"operate",title:k("common.operate"),align:"center",width:160,render:l=>e("div",{class:"flex-center gap-8px"},[F(e(M,{type:"primary",ghost:!0,size:"small",onClick:()=>T(l)},{default:()=>[R("立即发现")]}),[[E("no-auth"),"sys.excute.task.select"]]),e(Pe,{onPositiveClick:()=>s(l.id)},{default:()=>k("common.confirmDelete"),trigger:()=>{let r;return F(e(M,{type:"error",ghost:!0,size:"small"},Ee(r=k("common.delete"))?r:{default:()=>[r]}),[[E("no-auth"),"sys.discovering.task.delete"]])}})])}]}),{drawerVisible:o,operateType:g,editingData:f,handleAdd:z,handleEdit:D,checkedRowKeys:i,onBatchDeleted:S,onDeleted:C,closeDrawer:$}=oe(m,n);async function T(l){var b,A;console.log(l);const{data:r,error:x}=await ze(l);x||((b=window.$message)==null||b.destroyAll(),(A=window.$message)==null||A.success("已操作立即发现"))}async function h(){console.log(i.value),p(i.value,l=>{S()})}function s(l){console.log(l),p([l],r=>{C()})}async function p(l,r){const{data:x,error:b}=await Se(l);if(!b)r&&r(x);else return!1}return(l,r)=>{const x=X,b=ae,A=V;return O(),te("section",null,[e(Be,{model:t(_),"onUpdate:model":r[0]||(r[0]=c=>P(_)?_.value=c:null),onReset:t(I),onSearch:t(n)},null,8,["model","onReset","onSearch"]),e(A,{title:"发现任务",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(x,{columns:t(u),"onUpdate:columns":r[1]||(r[1]=c=>P(u)?u.value=c:null),"disabled-delete":t(i).length===0,loading:t(w),onAdd:t(z),onDelete:h,onRefresh:t(n),"is-view-add-button":t(Q)("sys.discovering.task.insert"),"is-view-delete-button":t(Q)("sys.discovering.task.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:a(()=>[e(b,{"checked-row-keys":t(i),"onUpdate:checkedRowKeys":r[2]||(r[2]=c=>P(i)?i.value=c:null),columns:t(d),data:t(m),size:"small","flex-height":!t(N).isMobile,"scroll-x":702,loading:t(w),remote:"","row-key":c=>c.id,pagination:t(y),class:"sm:h-640px"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ue,{visible:t(o),"onUpdate:visible":r[3]||(r[3]=c=>P(o)?o.value=c:null),"operate-type":t(g),"row-data":t(f),onSubmitted:t(n)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}}),Me={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},lt=K({name:"assetmanagement_assetdiscovery",__name:"index",setup(v){const N=ee(),{columns:d,columnChecks:u,data:m,getData:n,loading:w,pagination:y,searchParams:_,resetSearchParams:I}=ne({apiFn:Te,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,startIp:null,endIp:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"opersys",title:"操作系统",align:"center",minWidth:160},{key:"assetip",title:"资产IP",align:"center"}]}),{drawerVisible:o,operateType:g,editingData:f,handleAdd:z,handleEdit:D,checkedRowKeys:i,onBatchDeleted:S,onDeleted:C,closeDrawer:$}=oe(m,n);async function T(){console.log(i.value),h(i.value,s=>{S()})}async function h(s,p){const{data:l,error:r}=await Ce(s);if(!r)p&&p(l);else return!1}return(s,p)=>{const l=X,r=ae,x=V,b=be,A=De;return O(),te("div",Me,[e(x,{size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:a(()=>[e(A,{type:"card",animated:"",style:{"background-color":"white"}},{default:a(()=>[e(b,{name:"chap1",tab:"资产发现"},{default:a(()=>[e(Re,{model:t(_),"onUpdate:model":p[0]||(p[0]=c=>P(_)?_.value=c:null),onReset:t(I),onSearch:t(n)},null,8,["model","onReset","onSearch"]),e(x,{title:"资产发现",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(l,{columns:t(u),"onUpdate:columns":p[1]||(p[1]=c=>P(u)?u.value=c:null),"disabled-delete":t(i).length===0,loading:t(w),onAdd:t(z),onDelete:T,onRefresh:t(n)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:a(()=>[e(r,{"checked-row-keys":t(i),"onUpdate:checkedRowKeys":p[2]||(p[2]=c=>P(i)?i.value=c:null),columns:t(d),data:t(m),size:"small","flex-height":!t(N).isMobile,"scroll-x":702,loading:t(w),remote:"","row-key":c=>c.id,pagination:t(y),class:"sm:h-640px"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1})]),_:1}),e(b,{name:"chap2",tab:"发现任务"},{default:a(()=>[e(Fe)]),_:1})]),_:1})]),_:1})])}}});export{lt as default};
