import{m as R,a as L,n as re,q as le,d as T,s as K,v as W,u as ie,j as G,x as H,r as B,y as J,z as ce,A as j,C as ue,o as h,c as M,w as i,g as a,D as X,f as g,$ as y,E as F,e as o,F as D,h as E,G as de,t as S,H as pe,I as me,J as fe,K as _e,L as ge,M as he,N as Q,O as Y,S as we,P as ve,Q as ye,B as Z,R as ee,T as te,p as xe,i as ke,_ as V,U as Ce,V as be,W as Pe,X as Se,Y as q,Z as $e,a0 as Ne,a1 as Le,a2 as Re,a3 as Ue,b,a4 as Ee,a5 as Me,a6 as z,a7 as ze}from"./index-vQQ96wkD.js";function Ie(v){const p=R(0),P=L(()=>Math.ceil(p.value/60)),C=L(()=>p.value>0),{pause:s,resume:k}=re(()=>{p.value>0?p.value-=1:s()},{immediate:!1});function l(t=v){p.value=60*t,k()}function e(){p.value=0,s()}return le(()=>{s()}),{count:P,isCounting:C,start:l,stop:e}}const w=v=>(xe("data-v-7355e46a"),v=v(),ke(),v),je={class:"w-full flex-y-center gap-16px"},Fe=["src"],qe={class:"flex-y-center justify-between updatePsd"},Be={class:"agreement-container"},De=w(()=>o("h2",null,"用户协议",-1)),Te={class:"agreement-content"},Ve=w(()=>o("h3",null,"1. 协议的接受",-1)),Oe=w(()=>o("p",null,"在登录之前，您必须阅读并同意本协议的全部内容。点击“同意”按钮，即表示您已详细阅读并理解本协议，并同意受其约束。",-1)),Ae=w(()=>o("h3",null,"2. 用户信息的使用",-1)),Xe=w(()=>o("p",null,"您同意并授权本系统在合法合规的前提下，使用您的用户信息以提供相关服务，包括但不限于：",-1)),Ke=w(()=>o("ul",null,[o("li",null,"查询个人账户信息；"),o("li",null,"修改个人资料，如联系方式、密码等；"),o("li",null,"保障账户安全，防止未经授权的访问或篡改。")],-1)),We=w(()=>o("h3",null,"3. 用户责任",-1)),Ge=w(()=>o("p",null,"您保证所提供的所有信息真实、准确、完整，并对您的账户安全负全部责任。",-1)),He=w(()=>o("p",null,"不得冒用他人身份或提供虚假信息，否则系统有权拒绝提供服务，并依法追究责任。",-1)),Je=w(()=>o("h3",null,"4. 隐私保护",-1)),Qe=w(()=>o("p",null,"我们承诺严格保护您的个人隐私，不会泄露或滥用您的个人信息，除非法律法规另有规定或获得您的明确授权。",-1)),Ye=w(()=>o("h3",null,"5. 协议变更",-1)),Ze=w(()=>o("p",null,"本协议可能会不定期更新，更新后的协议一旦发布即自动生效。如果您继续使用本系统的查询和修改功能，即视为接受新的协议内容。",-1)),et=w(()=>o("h3",null,"6. 其他",-1)),tt=w(()=>o("p",null,"如对本协议有任何疑问，您可联系系统管理员获取进一步解释。",-1)),ot=w(()=>o("div",{style:{display:"flex","justify-content":"right","align-items":"center"}},null,-1)),st=T({name:"PwdLogin",__name:"pwd-login",props:{status:{type:String,required:!0},statusModifiers:{}},emits:K(["getUsername"],["update:status"]),setup(v,{emit:c}){const p=W(v,"status"),P=c,C=ie();G();const{formRef:s,validate:k}=H(),l=B({username:"",captcha:"",password:""}),e=B({uuid:"",captchaSrc:"",captchaEnable:0,checked:!1}),t=R(!1);async function r(){const{data:m,error:_}=await pe();_||(e.captchaEnable=m,e.captchaEnable==1&&n())}async function n(){e.uuid=j(),e.captchaSrc=me+"/captcha?uuid="+e.uuid;const m=j(),_=Date.now().toString(),U=fe(`${m}${_}`);_e.get(e.captchaSrc,{headers:{"X-Nonce":m,"X-Timestamp":_,"X-Signature":U},responseType:"blob"}).then($=>{const I=URL.createObjectURL($.data);e.captchaSrc=I}).catch($=>{console.error("Error:",$)})}const f=L(()=>{const{formRules:m}=J();return{username:m.username,captcha:m.captcha,password:m.password1}});async function u(){var _;if(!t.value)return(_=window.$message)==null?void 0:_.warning("请先同意协议");await k(),ge(l.username+"power_isokAgreement","true");const m=await C.login(l.username,l.password,l.captcha.trim(),e.uuid);console.log(m),m=="fail"&&e.captchaEnable==1&&(l.captcha="",n())}const x=m=>{t.value=he(l.username+"power_isokAgreement")=="true"||!1},d=()=>{p.value="resetPwd",P("getUsername",l.username)};return R(!1),ce(()=>{e.uuid=j(),r()}),(m,_)=>{const U=Q,$=Y,I=we,oe=ve,se=ye,O=Z,ae=ee,ne=te,A=ue("no-space");return h(),M(ne,{ref_key:"formRef",ref:s,model:l,rules:f.value,size:"large","show-label":!1},{default:i(()=>[a($,{path:"userName"},{default:i(()=>[X(a(U,{autofocus:"",value:l.username,"onUpdate:value":_[0]||(_[0]=N=>l.username=N),placeholder:g(y)("page.login.common.userNamePlaceholder"),onBlur:x,onKeyup:F(u,["enter"])},null,8,["value","placeholder"]),[[A]])]),_:1}),a($,{path:"password"},{default:i(()=>[X(a(U,{value:l.password,"onUpdate:value":_[1]||(_[1]=N=>l.password=N),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:g(y)("page.login.common.passwordPlaceholder"),onKeyup:F(u,["enter"])},null,8,["value","placeholder"]),[[A]])]),_:1}),e.captchaEnable==1?(h(),M($,{key:0,path:"captcha"},{default:i(()=>[o("div",je,[a(U,{value:l.captcha,"onUpdate:value":_[2]||(_[2]=N=>l.captcha=N),placeholder:"请输入验证码",onKeyup:F(u,["enter"])},null,8,["value"]),o("img",{src:e.captchaSrc,alt:"captcha",style:{height:"40px"},onClick:n},null,8,Fe)])]),_:1})):D("",!0),a(ae,{vertical:"",size:8},{default:i(()=>[o("div",qe,[a(se,{checked:t.value,"onUpdate:checked":_[4]||(_[4]=N=>t.value=N)},{default:i(()=>[E("我已阅读并同意 "),a(oe,{style:{"background-color":"#fff",color:"#1f2225"},trigger:"click","content-style":{padding:0}},{trigger:i(()=>[o("span",{class:"c-#1890ff",onClick:_[3]||(_[3]=de(()=>{},["stop"]))},"用户协议")]),default:i(()=>[o("div",Be,[De,o("div",Te,[a(I,{style:{"max-height":"320px",width:"520px"},"content-style":{padding:"0 0 30px 0"}},{default:i(()=>[Ve,Oe,Ae,Xe,Ke,We,Ge,He,Je,Qe,Ye,Ze,et,tt]),_:1})])])]),_:1})]),_:1},8,["checked"]),a(O,{quaternary:"",onClick:d},{default:i(()=>[E(S("修改密码"))]),_:1})]),a(O,{type:"primary",size:"large",ghost:"",round:"",block:"",loading:g(C).loginLoading,disabled:!t.value,onClick:u},{default:i(()=>[E(S(g(y)("common.confirm")),1)]),_:1},8,["loading","disabled"]),ot]),_:1})]),_:1},8,["model","rules"])}}}),at=V(st,[["__scopeId","data-v-7355e46a"]]);function nt(){const{loading:v,startLoading:c,endLoading:p}=Ce(),{count:P,start:C,stop:s,isCounting:k}=Ie(60),l=L(()=>{let r=y("page.login.codeLogin.getCode");const n=y("page.login.codeLogin.reGetCode",{time:P.value});return v.value&&(r=""),k.value&&(r=n),r});function e(r){var n,f,u,x;return r.trim()===""?((f=(n=window.$message)==null?void 0:n.error)==null||f.call(n,y("form.mobile.required")),!1):Pe.test(r)?!0:((x=(u=window.$message)==null?void 0:u.error)==null||x.call(u,y("form.mobile.invalid")),!1)}async function t(r,n){!e(r)||v.value||(c(),await new Promise(u=>{be(r,n).then(x=>{var d,m;console.log("response",x),x.error||(setTimeout(u,500),(m=(d=window.$message)==null?void 0:d.success)==null||m.call(d,y("page.login.codeLogin.sendCodeSuccess")),C(),p())}).catch(x=>{var d,m;return console.log("error",x),(m=(d=window.$message)==null?void 0:d.error)==null||m.call(d,y("page.login.codeLogin.sendCodeFailed")),!1})}))}return{label:l,start:C,stop:s,isCounting:k,loading:v,getCaptcha:t}}const rt=T({name:"ResetPwd",__name:"reset-pwd",props:K({username:{type:String,required:!0}},{status:{type:String,required:!0},statusModifiers:{}}),emits:["update:status"],setup(v){const c=W(v,"status"),p=v;G();const{formRef:P,validate:C}=H();nt();const s=B({username:p.username||"",oripwd:"",code:"",password:"",confirmPassword:""}),k=L(()=>{const{formRules:e,createConfirmPwdRule:t,defaultRequiredRule:r}=J();return{username:e.username,oripwd:e.password1,password:[{...r},{asyncValidator:(n,f)=>f==""||f==null?Promise.resolve():Se(f)?s.username&&f.toLocaleLowerCase().includes(s.username.toLocaleLowerCase())?Promise.reject("密码禁止与用户名相同或包含用户名(不区分大小写)"):s.password==s.oripwd?Promise.reject("新密码不能与旧密码相同"):Promise.resolve():Promise.reject("密码应符合：大、小写字母、数字、特殊字符的8-18位组合"),trigger:["blur","input"]}],code:e.code,confirmPassword:t(s.password)}});async function l(){var u,x;await C();const e=q(s.oripwd),t=q(s.password),r=q(s.username),{data:n,error:f}=await $e(r,e,t);console.log("data",n),f?(x=window.$message)==null||x.error("修改失败"):((u=window.$message)==null||u.success("修改成功"),c.value="pwd-login1")}return(e,t)=>{const r=Q,n=Y,f=Z,u=ee,x=te;return h(),M(x,{ref_key:"formRef",ref:P,model:s,rules:k.value,size:"large","show-label":!1},{default:i(()=>[a(n,{path:"username"},{default:i(()=>[a(r,{value:s.username,"onUpdate:value":t[0]||(t[0]=d=>s.username=d),placeholder:g(y)("page.login.common.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1}),a(n,{path:"oripwd"},{default:i(()=>[a(r,{value:s.oripwd,"onUpdate:value":t[1]||(t[1]=d=>s.oripwd=d),type:"password","show-password-on":"click",placeholder:"请输入原密码"},null,8,["value"])]),_:1}),a(n,{path:"password"},{default:i(()=>[a(r,{value:s.password,"onUpdate:value":t[2]||(t[2]=d=>s.password=d),type:"password","show-password-on":"click",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),a(n,{path:"confirmPassword"},{default:i(()=>[a(r,{value:s.confirmPassword,"onUpdate:value":t[3]||(t[3]=d=>s.confirmPassword=d),type:"password","show-password-on":"click",placeholder:g(y)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1}),a(u,{vertical:"",size:18,class:"w-full"},{default:i(()=>[a(f,{type:"primary",size:"large",ghost:"",round:"",block:"",onClick:l},{default:i(()=>[E(S(g(y)("common.confirm")),1)]),_:1}),a(f,{size:"large",ghost:"",round:"",block:"",onClick:t[4]||(t[4]=d=>c.value="pwd-login"),class:"c-#fff"},{default:i(()=>[E(S(g(y)("page.login.common.back")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),lt=V(rt,[["__scopeId","data-v-74e31eee"]]),it={class:"w-400px lt-sm:w-300px"},ct={class:"flex-y-center justify-center"},ut={key:0,src:z,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},dt={key:1,src:z,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},pt={key:2,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},mt={key:3,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},ft={class:"pt-24px"},_t={class:"pt-16px"},gt={class:"flex justify-center items-center",style:{position:"fixed",top:"20px",right:"20px","z-index":"999"}},ht={key:0,src:z,alt:"Linkqi",class:"w-100px pr-10px"},wt={key:1,src:z,alt:"Linkqi",class:"w-100px pr-10px"},vt={key:2,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},yt={key:3,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},xt={key:0,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},kt={key:1,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},Ct=T({name:"login",__name:"index",props:{module:{}},setup(v){Ne();const c=Le(),p=R("pwd-login");L(()=>c.darkMode?Re(c.themeColor,600):c.themeColor);const P=R(""),C=e=>{P.value=e},s=L(()=>{const e="#ffffff",t=c.darkMode?.5:.2;return Ue(e,c.themeColor,t)}),k=R();return(async()=>{fetch("/version.json").then(e=>e.json()).then(e=>{k.value=e}).catch(e=>{console.error("Error fetching version.json:",e)})})(),(e,t)=>{var n,f;const r=ze;return h(),b("div",{class:"relative size-full flex-center overflow-hidden login",style:Me({backgroundColor:s.value})},[a(r,{bordered:!1,class:"relative z-4 w-auto rd-12px loginClass","content-style":{padding:"24px 36px"}},{default:i(()=>[o("div",it,[o("header",ct,[g(c).darkMode?(h(),b("img",dt)):(h(),b("img",ut)),g(c).darkMode?(h(),b("h3",pt,S(g(y)("system.title")),1)):(h(),b("h3",mt,S(g(y)("system.title")),1))]),o("main",ft,[o("div",_t,[a(Ee,{name:g(c).page.animateMode,mode:"out-in",appear:""},{default:i(()=>[p.value=="pwd-login"||p.value=="pwd-login1"?(h(),M(at,{key:0,status:p.value,"onUpdate:status":t[0]||(t[0]=u=>p.value=u),onGetUsername:C},null,8,["status"])):(h(),M(lt,{key:1,status:p.value,"onUpdate:status":t[1]||(t[1]=u=>p.value=u),username:P.value},null,8,["status","username"]))]),_:1},8,["name"])])])])]),_:1}),o("div",gt,[g(c).darkMode?(h(),b("img",wt)):(h(),b("img",ht)),g(c).darkMode?(h(),b("span",vt,S(((n=k.value)==null?void 0:n.ver)||""),1)):(h(),b("span",yt,S(((f=k.value)==null?void 0:f.ver)||""),1))]),g(c).darkMode?D("",!0):(h(),b("div",xt," Copyright (c) 2025 · 杭州领祺科技有限公司")),g(c).darkMode?(h(),b("div",kt," Copyright (c) 2025 · 杭州领祺科技有限公司")):D("",!0)],4)}}}),Pt=V(Ct,[["__scopeId","data-v-aa3703d2"]]);export{Pt as default};
