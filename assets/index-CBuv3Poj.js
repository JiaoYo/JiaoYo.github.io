import{_ as ke}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DTyciG8n.js";import{_ as xe}from"./round-refresh-Ce8bIByR.js";import{o as E,e as ve,f as _e,d as te,p as Y,k as j,q as re,r as oe,s as Ce,v as De,ab as se,ag as Se,b as Ue,$ as A,z as W,c as K,w as t,g as e,h as M,t as B,i as n,A as X,D as fe,C as $e,b9 as Ae,ba as Me,ak as le,L as de,aI as qe,aU as ge,P as J,aV as he,Q as ue,B as L,aJ as ce,aF as pe,aE as ie,be as ze,S as Le,aK as Oe,ai as Pe,bb as Ve,b7 as Be,x as Re,bc as je,af as Z,aN as ae,aO as Ee,aS as Fe,aT as Ge,a6 as Ke}from"./index-00pZtPBt.js";import{_ as Je}from"./round-add-BJVAZVna.js";import{_ as He}from"./round-search-Cgm8cfgb.js";import{u as Qe,a as We}from"./table-BUcbG8zn.js";import{_ as me}from"./FormItemGridItem-CHgxRxLI.js";import{_ as ee,a as Xe}from"./Grid-DZYnaI-Y.js";import{p as Ye}from"./gather-BDoQC_Yg.js";import{_ as Ze}from"./Tree-BVQlHJCa.js";import{y as et}from"./common-BHxhCnia.js";import{N as tt}from"./Popconfirm-B352hAvh.js";import{_ as lt}from"./InputGroupLabel-C7hqUUah.js";const at={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},nt=_e("path",{fill:"currentColor",d:"M11 13v3q0 .425.288.713T12 17t.713-.288T13 16v-3h3q.425 0 .713-.288T17 12t-.288-.712T16 11h-3V8q0-.425-.288-.712T12 7t-.712.288T11 8v3H8q-.425 0-.712.288T7 12t.288.713T8 13zm1 9q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1),ot=[nt];function st(T,R){return E(),ve("svg",at,[...ot])}const it={name:"material-symbols-add-circle-outline-rounded",render:st},rt=_e("span",null,"批量新增：格式为（转发设备1-10）",-1),dt=te({__name:"add_model",props:Y({operateType:{},rowData:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(T,{emit:R}){const g=j(!1),k=re(T,"visible"),C=R,m=T,a=oe(D());function D(){return{devName:"转发设备1",chlId:void 0,devCommAddr:"1",devPubAddr:"1",devValid:1,devDesc:"",reserve0:"",reserve1:""}}const o=oe({channelList:[]});async function I(){const{data:f,error:s}=await pe({type:1});s||(o.channelList=f)}async function O(){await I(),m.operateType==="edit"&&m.rowData?Object.assign(a,m.rowData):(Object.assign(a,D()),a.chlId=m.chlId||o.channelList[0].id)}const{formRef:N,validate:v,restoreValidation:r}=Ce();De(),se(()=>m.rowData,()=>{O()}),se(k,()=>{k.value&&(m.operateType==="add"&&Se(()=>{setTimeout(()=>{g.value=!0},200)}),O(),r())});const h=()=>{k.value=!1,g.value=!1},x=async()=>{var f,s,P;if(await v(),m.operateType==="add"){let p=[],u=a.devName;if(((f=a.devName)==null?void 0:f.indexOf("-"))!=-1){let G=Math.abs(u==null?void 0:u.substring(u.lastIndexOf("-")).replace(/[^0-9]/gi,"")),i=u.split(/-(?![^-]*-)/),l=u.substring(0,u.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],c=l.replace(/[^0]/g,""),V=l,q=i[0],z=q.substring(0,q.length-q.match(/(\d+)[^0-9]*$/)[1].length),H=G-l+1;for(let d=0;d<H;d++){let U=V++,Q=JSON.parse(JSON.stringify(a));Q.devName=parseInt(l)==0?c.length>0?String(U).length>=c.length?z+U:z+c.substring(0,c.length-String(U).length)+U:z+U:c.length>0?U>=10?z+c.substring(0,c.length-String(U).length+1)+U:z+c.substring(0,c.length)+U:z+U,Q.devCommAddr=Number(a.devCommAddr)+d,p.push(Q)}}else p=[a];if(p.length>1e3){(s=window.$message)==null||s.destroyAll(),(P=window.$message)==null||P.warning("批量添加最多仅支持1000条");return}const{data:F,error:$}=await Ae(p);$?console.log("error",$):(console.log("success",F),h(),C("submitted"))}else{const{data:p,error:u}=await Me([a]);u?console.log("error",u):(console.log("success",p),h(),C("submitted"))}},_={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},b={devName:_,chlId:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},devCommAddr:_,devPubAddr:_},y=Ue(()=>({add:A("common.add"),edit:A("common.edit")})[m.operateType]);return(f,s)=>{const P=le,p=me,u=de,F=qe,$=ge,G=J,i=he,l=ee,c=ue,V=L,q=J,z=ce,H=W("no-space");return E(),K(z,{show:k.value,"onUpdate:show":s[8]||(s[8]=d=>k.value=d),title:y.value,preset:"card",class:"w-30%",onAfterLeave:h},{footer:t(()=>[e(q,{size:16,justify:"center"},{default:t(()=>[e(V,{onClick:h,class:"w-100px"},{default:t(()=>[M(B(n(A)("common.cancel")),1)]),_:1}),e(V,{type:"primary",class:"w-100px",onClick:x},{default:t(()=>[M(B(n(A)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(c,{ref_key:"formRef",ref:N,model:a,rules:b,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:$e(x,["enter"])},{default:t(()=>[e(l,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(P,{filterable:"",placeholder:"请选择所属通道",value:a.chlId,"onUpdate:value":s[0]||(s[0]=d=>a.chlId=d),"label-field":"chlName","value-field":"id",options:o.channelList},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:24",label:"设备名称",path:"devName"},{default:t(()=>[e(F,{show:g.value,placement:"right-start"},{trigger:t(()=>[X(e(u,{clearable:"",value:a.devName,"onUpdate:value":s[1]||(s[1]=d=>a.devName=d),maxlength:"64",placeholder:"请输入设备名称"},null,8,["value"]),[[H]])]),default:t(()=>[rt]),_:1},8,["show"])]),_:1}),e(p,{span:"24 m:24",label:"通讯地址",path:"devCommAddr"},{default:t(()=>[e(u,{clearable:"",value:a.devCommAddr,"onUpdate:value":s[2]||(s[2]=d=>a.devCommAddr=d),maxlength:"50",placeholder:"请输入通讯地址"},null,8,["value"])]),_:1}),e(p,{span:"24 m:24",label:"公共地址",path:"devPubAddr"},{default:t(()=>[e(u,{clearable:"",value:a.devPubAddr,"onUpdate:value":s[3]||(s[3]=d=>a.devPubAddr=d),placeholder:"请输入公共地址"},null,8,["value"])]),_:1}),e(p,{span:"24 m:24",label:"保留0",path:"reserve0"},{default:t(()=>[e(u,{clearable:"",value:a.reserve0,"onUpdate:value":s[4]||(s[4]=d=>a.reserve0=d),placeholder:"(可空)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(p,{span:"24 m:24",label:"保留1",path:"reserve1"},{default:t(()=>[e(u,{clearable:"",value:a.reserve1,"onUpdate:value":s[5]||(s[5]=d=>a.reserve1=d),placeholder:"(可空)",style:{width:"100%"}},null,8,["value"])]),_:1}),m.operateType=="edit"?(E(),K(p,{key:0,span:"24 m:24",label:"设备有效性",path:"devValid"},{default:t(()=>[e(i,{value:a.devValid,"onUpdate:value":s[6]||(s[6]=d=>a.devValid=d),name:"radiogroup"},{default:t(()=>[e(G,null,{default:t(()=>[e($,{label:"是",value:1}),e($,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):fe("",!0),e(p,{span:"24 m:24",label:"设备描述",path:"devDesc"},{default:t(()=>[e(u,{clearable:"",value:a.devDesc,"onUpdate:value":s[7]||(s[7]=d=>a.devDesc=d),maxlength:"64",placeholder:"请输入设备描述",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),ut=te({__name:"batch_addModel",props:Y({chlList:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(T,{emit:R}){const g=re(T,"visible"),k=T,C=R,m=j([]),a=async()=>{const{data:v,error:r}=await pe({type:0});r||(m.value=v.map(h=>{var x;return{label:h.chlName,key:h.id+"10000",children:(x=h.devicePojoList)==null?void 0:x.map(_=>({label:_.devName,key:_.id}))}}))};se(()=>g.value,async v=>{v&&(a(),o.value={devIds:[],chlId:void 0,pre:void 0,valid:1,tagType:void 0,enbleType:!0},o.value.chlId=k.chlId)});const D=j(null),o=j({devIds:[],chlId:void 0,pre:"",valid:1,tagType:void 0,enbleType:!0}),I=async()=>{var _,S;const v=[];m.value.forEach(b=>{v.push(b.key)}),v.forEach(b=>{var y,f,s;(y=o.value.devIds)!=null&&y.includes(b)&&((s=o.value.devIds)==null||s.splice((f=o.value.devIds)==null?void 0:f.indexOf(b),1))}),o.value.enbleType&&(o.value.tagType="-1"),console.log(o.value);const r={pre:o.value.pre||"",chlId:o.value.chlId,devIds:(_=o.value.devIds)==null?void 0:_.join(","),valid:o.value.valid,tagType:o.value.tagType,enbleType:o.value.enbleType?1:0},{data:h,error:x}=await ze(r);x||((S=window.$message)==null||S.success("新增成功"),g.value=!1,C("submitted"))},O={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},N={chlId:O,tagType:O};return(v,r)=>{const h=Ze,x=Le,_=Xe,S=le,b=me,y=de,f=ge,s=J,P=he,p=ee,u=ue,F=ee,$=L,G=J,i=ce;return E(),K(i,{show:g.value,"onUpdate:show":r[7]||(r[7]=l=>g.value=l),title:"批量新增",preset:"card",class:"w-40%"},{footer:t(()=>[e(G,{size:16,justify:"center"},{default:t(()=>[e($,{onClick:r[6]||(r[6]=l=>g.value=!1),class:"w-100px"},{default:t(()=>[M(B(v.$t("common.cancel")),1)]),_:1}),e($,{type:"primary",class:"w-100px",onClick:I},{default:t(()=>[M(B(v.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(F,{"x-gap":"12"},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(x,{style:{"max-height":"220px"}},{default:t(()=>[e(h,{"block-line":"",data:m.value,"checked-keys":o.value.devIds,"onUpdate:checkedKeys":r[0]||(r[0]=l=>o.value.devIds=l),"expand-on-click":"","default-expand-all":!0,checkable:"",cascade:""},null,8,["data","checked-keys"])]),_:1})]),_:1}),e(_,{span:16},{default:t(()=>[e(u,{ref_key:"formRef",ref:D,"label-width":140,"label-placement":"left",model:o.value,rules:N},{default:t(()=>[e(p,{responsive:"screen","item-responsive":""},{default:t(()=>[e(b,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(S,{filterable:"",placeholder:"请选择所属通道",value:o.value.chlId,"onUpdate:value":r[1]||(r[1]=l=>o.value.chlId=l),"label-field":"chlName","value-field":"id",options:k.chlList},null,8,["value","options"])]),_:1}),e(b,{span:"24 m:24",label:"转发设备前缀",path:"pre"},{default:t(()=>[e(y,{value:o.value.pre,"onUpdate:value":r[2]||(r[2]=l=>o.value.pre=l),style:{width:"100%"},placeholder:"请输入转发设备前缀(可空)"},null,8,["value"])]),_:1}),e(b,{span:"24 m:24",label:"是否匹配测点类型",path:"enbleType"},{default:t(()=>[e(P,{value:o.value.enbleType,"onUpdate:value":r[3]||(r[3]=l=>o.value.enbleType=l),name:"radiogroup"},{default:t(()=>[e(s,null,{default:t(()=>[e(f,{label:"是",value:!0}),e(f,{label:"否",value:!1})]),_:1})]),_:1},8,["value"])]),_:1}),o.value.enbleType==!1?(E(),K(b,{key:0,span:"24 m:24",label:"测点类型",path:"tagType"},{default:t(()=>[e(S,{filterable:"",placeholder:"请选择测点类型",value:o.value.tagType,"onUpdate:value":r[4]||(r[4]=l=>o.value.tagType=l),options:n(ie)(n(Ye))},null,8,["value","options"])]),_:1})):fe("",!0),e(b,{span:"24 m:24",label:"设备有效性",path:"valid"},{default:t(()=>[e(P,{value:o.value.valid,"onUpdate:value":r[5]||(r[5]=l=>o.value.valid=l),name:"radiogroup"},{default:t(()=>[e(s,null,{default:t(()=>[e(f,{label:"是",value:1}),e(f,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1},8,["show"])}}}),ct=te({__name:"move_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:Y(["submitted"],["update:visible"]),setup(T,{emit:R}){const k=Oe({0:"采集104tcp",1:"采集104udp"}),C=re(T,"visible"),m=j(null),a=j({targetDevice:void 0,EquipmentMerged:void 0}),D=()=>{},I={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}};return(O,N)=>{const v=le,r=me,h=ee,x=ue,_=L,S=J,b=ce;return E(),K(b,{show:C.value,"onUpdate:show":N[3]||(N[3]=y=>C.value=y),title:"设备移动至通道",preset:"card",class:"w-40%"},{footer:t(()=>[e(S,{size:16,justify:"center"},{default:t(()=>[e(_,{onClick:N[2]||(N[2]=y=>C.value=!1),class:"w-100px"},{default:t(()=>[M(B(O.$t("common.cancel")),1)]),_:1}),e(_,{type:"primary",class:"w-100px",onClick:D},{default:t(()=>[M(B(O.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(x,{ref_key:"formRef",ref:m,"label-width":120,"label-placement":"left",model:a.value,rules:I},{default:t(()=>[e(h,{responsive:"screen","item-responsive":""},{default:t(()=>[e(r,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:t(()=>[e(v,{filterable:"",clearable:"",placeholder:"请选择通道",value:a.value.targetDevice,"onUpdate:value":N[0]||(N[0]=y=>a.value.targetDevice=y),options:n(ie)(n(k))},null,8,["value","options"])]),_:1}),e(r,{span:"24 m:12",label:"待移动设备",path:"EquipmentMerged"},{default:t(()=>[e(v,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:a.value.EquipmentMerged,"onUpdate:value":N[1]||(N[1]=y=>a.value.EquipmentMerged=y),options:n(ie)(n(k))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),pt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ne(T){return typeof T=="function"||Object.prototype.toString.call(T)==="[object Object]"&&!Ee(T)}const xt=te({name:"configsetting_forwardingservice_forwardingdevicemanagement",__name:"index",setup(T){const R=Pe(),g=oe({channelList:[],chlIdAndNameMap:{}}),{columns:k,columnChecks:C,data:m,getData:a,loading:D,mobilePagination:o,searchParams:I,resetSearchParams:O}=Qe({apiFn:Ve,apiParams:{page:1,pageSize:20,limit:20,type:1,chlId:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"设备ID",align:"center",width:60},{key:"devName",title:"设备名称",align:"center",width:100},{key:"chlId",title:"所属通道",align:"center",width:140,render:i=>e("span",null,[g.chlIdAndNameMap[i.chlId]])},{key:"devDesc",title:"设备描述",align:"center",width:140,render:i=>e("span",null,[i.devDesc?i.devDesc:"无"])},{key:"devCommAddr",title:"设备通信地址",align:"center",width:140},{key:"devPubAddr",title:"设备公共地址",align:"center",width:140},{key:"devValid",title:"有效性",align:"center",width:140,render:i=>{let l;return e(Be,{type:i.devValid==0?"error":"success"},ne(l=A(et[i.devValid]))?l:{default:()=>[l]})}},{key:"operate",title:A("common.operate"),align:"center",width:240,fixed:"right",render:i=>{let l;return e("div",{class:"flex-center gap-8px"},[e(L,{type:"primary",ghost:!0,size:"small",onClick:()=>G(i)},{default:()=>["转发测点管理"]}),X(e(L,{type:"primary",ghost:!0,size:"small",onClick:()=>P(i.id)},ne(l=A("common.edit"))?l:{default:()=>[l]}),[[W("no-auth"),"device:update"]]),X(e(tt,{onPositiveClick:()=>s(i.id)},{default:()=>A("common.confirmDelete"),trigger:()=>{let c;return e(L,{type:"error",ghost:!0,size:"small"},ne(c=A("common.delete"))?c:{default:()=>[c]})}}),[[W("no-auth"),"device:delete"]])])}}]});async function N(){var c;const{data:i,error:l}=await pe({type:1});if(!l){if(i.length==0)return(c=window.$message)==null?void 0:c.warning("暂无转发通道，请先添加通道");g.channelList=i,i.forEach(q=>{g.chlIdAndNameMap[q.id]=q.chlName});const V=R.currentRoute.value.query.channelId;V&&(I.chlId=Number(V)),a()}}Re(()=>{N()});const{drawerVisible:v,operateType:r,editingData:h,handleAdd:x,handleEdit:_,checkedRowKeys:S,onBatchDeleted:b,onDeleted:y}=We(m,a),f=()=>{a()},s=async i=>{const{data:l,error:c}=await je({ids:i});c||y()},P=i=>{_(i)},p=i=>{I.chlId=i,a()},u=j(!1),F=()=>{u.value=!0},$=j(!1),G=i=>{R.push({path:"/configsetting/forwardingservice/forwardingpointmanagement",query:{channelId:i.chlId,deviceId:i.id}})};return(i,l)=>{const c=lt,V=le,q=de,z=He,H=Fe,d=J,U=Je,Q=it,be=xe,ye=ke,we=Ge,Ie=Ke,Ne=W("no-space"),Te=W("no-auth");return E(),ve("div",pt,[e(Ie,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(d,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(H,null,{default:t(()=>[e(c,null,{default:t(()=>[M("所属通道")]),_:1}),e(V,{filterable:"",clearable:"",placeholder:"请选择通道",value:n(I).chlId,"onUpdate:value":l[0]||(l[0]=w=>n(I).chlId=w),"label-field":"chlName","value-field":"id",options:g.channelList,onUpdateValue:p},null,8,["value","options"]),e(c,null,{default:t(()=>[M("设备名称")]),_:1}),X(e(q,{clearable:"",value:n(I).fuzzy,"onUpdate:value":l[1]||(l[1]=w=>n(I).fuzzy=w),placeholder:"请输入设备名称",style:{width:"100%"}},null,8,["value"]),[[Ne]]),e(n(L),{type:"primary",ghost:"",onClick:f},{icon:t(()=>[e(z,{class:Z(["text-icon",{"animate-spin":n(D)}])},null,8,["class"])]),default:t(()=>[M(" "+B(n(A)("common.search")),1)]),_:1})]),_:1})]),_:1})]),"header-extra":t(()=>[e(d,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[X((E(),K(n(L),{onClick:n(x),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(U,{class:Z(["text-icon",{"animate-spin":n(D)}])},null,8,["class"])]),default:t(()=>[M(" "+B(n(A)("common.add")),1)]),_:1},8,["onClick"])),[[Te,"device:insert"]]),e(n(L),{onClick:F,size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(Q,{class:Z(["text-icon",{"animate-spin":n(D)}])},null,8,["class"])]),default:t(()=>[M(" "+B("批量新增"))]),_:1}),e(n(L),{onClick:f,size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(be,{class:Z(["text-icon",{"animate-spin":n(D)}])},null,8,["class"])]),_:1}),e(ye,{columns:n(C),"onUpdate:columns":l[2]||(l[2]=w=>ae(C)?C.value=w:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(we,{"checked-row-keys":n(S),"onUpdate:checkedRowKeys":l[3]||(l[3]=w=>ae(S)?S.value=w:null),columns:n(k),data:n(m),size:"small",loading:n(D),remote:"","row-key":w=>w.id,pagination:n(o),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(dt,{visible:n(v),"onUpdate:visible":l[4]||(l[4]=w=>ae(v)?v.value=w:null),onSubmitted:n(a),"operate-type":n(r),"row-data":n(h),chlId:n(I).chlId},null,8,["visible","onSubmitted","operate-type","row-data","chlId"]),e(ut,{visible:u.value,"onUpdate:visible":l[5]||(l[5]=w=>u.value=w),chlList:g.channelList,chlId:n(I).chlId,onSubmitted:n(a)},null,8,["visible","chlList","chlId","onSubmitted"]),e(ct,{visible:$.value,"onUpdate:visible":l[6]||(l[6]=w=>$.value=w)},null,8,["visible"])]),_:1})])}}});export{xt as default};
