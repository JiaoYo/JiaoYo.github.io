import{_ as Ha}from"./table-column-setting.vue_vue_type_script_setup_true_lang-C1xlHjp4.js";import{_ as ma}from"./round-delete-DlIoPaUp.js";import{_ as Xa}from"./round-add-DKf3GUZ5.js";import{d as Lt,ay as wt,z as ga,D as et,s as b,A as va,$ as E,n as r,H as q,aU as Dt,B as y,cO as Wa,cE as Ya,cM as Za,cN as ea,bi as ta,aM as ue,a5 as aa,f as a,g as v,d4 as Qa,cG as el,d3 as tl,aK as ot,d1 as al,d2 as la,a as ll,aw as Mt,ax as zt,aL as ha,b as Ct,o as T,aA as na,bs as nl,w as o,bq as sl,M as ya,L as ba,c as J,G as ve,h as u,br as dt,e as M,S as il,db as sa,b1 as ol,J as xe,aD as $t,t as Q,a4 as _a,N as rl,d0 as xa,cT as ka,eG as ul,aC as ia,es as Ca,fh as oa,fi as dl,fj as ra,fk as cl,cC as pl,fl,fm as ml,ex as ua,ep as da,aG as St,eH as gl,d8 as vl,aX as Sa,et as wa,ew as hl,cP as yl,cW as bl,eu as _l,eq as xl,er as kl,eo as Cl,ey as Sl,bn as wl,a2 as Rt,b9 as Dl,aR as ut,W as Da,aN as zl,Y as $l,X as Ll,i as Pl,b3 as Fl,F as xt,aO as kt,c$ as Al,I as rt,aP as Il,aI as Nl,fn as Ul,aS as jl,aF as ca,cF as Tl,_ as El,aV as Ol}from"./index-CMHgEXMh.js";import{u as Ot,a as Bl}from"./table-CJiCbcco.js";import{_ as Ml}from"./round-plus-Bm-6LVuU.js";import{_ as Rl,a as Vl,A as ql}from"./index-DrXHwIJW.js";import{h as Vt,i as Jl,g as za,p as pa,f as Gl}from"./business-Cyu7TTwY.js";import{u as Bt}from"./usePageData-Dn3H-SiY.js";import{h as Et}from"./permission-BKFCtFdB.js";import{N as Oe}from"./Popconfirm-B5UVwpKW.js";import{N as Kl}from"./Cascader-Dur7OiRu.js";import{_ as $a}from"./Grid-C5178DSn.js";import{_ as La}from"./FormItemGridItem-Dqi8bF12.js";import{_ as Pa}from"./DatePicker-BXJxaIxz.js";import{_ as Hl}from"./round-search-C1L9tT6c.js";import{_ as Xl}from"./round-refresh-CcRANCic.js";import{l as Wl}from"./lookdebuggingSheetModal-ssg6A9dX.js";import{_ as Yl}from"./RadioButton-V32cT3aM.js";import"./DescriptionsItem-DkzOVNm8.js";import"./Table-xSzXXY9c.js";const Zl={class:"w-100%"},Ql={class:"flex"},en={style:{display:"flex","flex-direction":"column",width:"100%"}},tn={class:"flex items-center"},an={class:"w-100%"},ln={class:"w-100px"},nn={style:{display:"flex","flex-direction":"column"}},sn={style:{display:"flex","flex-direction":"column"}},on={style:{display:"flex","flex-direction":"column"}},rn={class:"flex-col w-100%"},un=2,dn=Lt({name:"OperateDrawer",__name:"operate-drawer",props:wt({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:wt(["submitted"],["update:visible"]),setup(ae,{emit:de}){const x=ga(),le=de,G=et({contactList:[],debuggedDevieceList:[],fileList:[]}),d=ae,s=et(ke());function ke(){return{proname:"",dispatchIds:[],contractIds:[],proaddr:"",cpdbtime:null,plantime:null,prosite:"",longitude:120.373885,latitude:30.303899,period:null,dtype:null,dispatch:"",status:1,region:null,provice:null}}const R=b(0),he=b(void 0);async function Ae(){A.value=[{longitude:120.373885,latitude:30.303899,addr:""}],C.value=[],F.value=[],ie.value=[],Object.assign(s,ke()),ja(),Ra(),d.operateType==="edit"&&d.rowData&&(await Promise.all([qa(),g(),qe(),V(),at(),_t()]),Object.assign(s,d.rowData),R.value=s.period,he.value=s.status,Yt(s.provice),st(s.provice),Ua())}const{formRef:H,restoreValidation:Ce}=va(),Ie={proname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入项目名称"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择项目状态"},contractIds:{type:"array",required:!0,trigger:["blur","change"],message:"请选择合同"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择调试类型"},period:{type:"number",required:!0,trigger:["blur","change"],message:"请输入周期"},prosite:{type:"string",required:!0,trigger:["blur","change","focus"],message:"请选择项目地点"},cpdbtime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择时间"},plantime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择时间"},provice:{type:"number",required:!0,trigger:["blur","change"],message:"请选择省份"},region:{type:"number",required:!0,trigger:["blur","change"],message:"请选择城市"}},z=b([]),X=et({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",pageSizes:[20],prefix:()=>`共 ${z.value.length} 条`,onChange:e=>{X.page=e,V()},onUpdatePageSize:e=>{X.pageSize=e,X.page=1,V()}}),Ne=[{title:"对接方",key:"docker",align:"center",width:150,render(e,t){return e.setStatus?r(q,{value:e.docker,placeholder:"请输入",onUpdateValue(l){z.value[t].docker=l}}):r("div",{},e.docker)}},{title:"姓名",key:"pname",align:"center",width:100,render(e,t){return e.setStatus?r(q,{value:e.pname,placeholder:"请输入姓名",onUpdateValue(l){z.value[t].pname=l}}):r("div",{},e.pname)}},{title:"联系方式",key:"pcontact",align:"center",width:150,render(e,t){return e.setStatus?r(q,{value:e.pcontact,placeholder:"请输入联系方式",onUpdateValue(l){z.value[t].pcontact=l}}):r("div",{},e.pcontact)}},{title:"备注",key:"proposition",align:"center",width:150,render(e,t){return e.setStatus?r(q,{value:e.proposition,placeholder:"请输入备注",onUpdateValue(l){z.value[t].proposition=l}}):r("div",{},e.proposition)}},{title:"操作人",width:100,key:"username",align:"center"},{title:"操作时间",key:"dbtime",width:180,align:"center",render:e=>e.dbtime?Dt(1,e.dbtime):""},{key:"operate",title:E("common.operate"),align:"center",width:160,fixed:"right",render(e,t){return r("div",{class:"flex-center gap-8px"},[e.setStatus?[r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>ye(e)},{default:()=>"保存"}),r(y,{type:"default",ghost:!0,size:"small",onClick:()=>ee(e,t)},{default:()=>"取消"}),r(Oe,{onPositiveClick:()=>{d.operateType==="edit"&&e.id?Wa(e.id).then(()=>{var l;z.value.splice(t,1),(l=window.$message)==null||l.success("删除成功")}):z.value.splice(t,1)}},{default:()=>E("common.confirmDelete"),trigger:()=>r(y,{type:"error",ghost:!0,size:"small"},{default:()=>E("common.delete")})})]:r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>N(e)},{default:()=>"编辑"})])}}],V=async()=>{var t;const{data:e}=await Ya({page:X.page,limit:X.pageSize,pid:(t=d.rowData)==null?void 0:t.id});z.value=e==null?void 0:e.list,z.value.forEach(l=>{l.setStatus=!1}),G.contactList=JSON.parse(JSON.stringify(z.value))},N=e=>{var t;if(z.value.some(l=>l.setStatus)){(t=window.$message)==null||t.warning("请先对正在编辑中的数据进行操作");return}e.setStatus=!e.setStatus},ee=(e,t)=>{e.setStatus=!e.setStatus,e.id?z.value=JSON.parse(JSON.stringify(G.contactList)):z.value.splice(t,1)},ye=async e=>{var t,l,i,c,f;if(!e.pname){(t=window.$message)==null||t.warning("请输入联系人姓名");return}if(!e.pcontact){(l=window.$message)==null||l.warning("请输入联系方式");return}if(d.operateType==="edit")if(e.id){const{data:S,error:k}=await Za([e]);k||((i=window.$message)==null||i.success("修改成功"),V(),e.setStatus=!e.setStatus)}else{const{data:S,error:k}=await ea([{...e,pid:(c=d.rowData)==null?void 0:c.id}]);k||((f=window.$message)==null||f.success("添加成功"),V(),e.setStatus=!e.setStatus)}else e.setStatus=!e.setStatus};function Be(){var e;((e=z.value[0])!=null&&e.pname||z.value.length==0)&&z.value.unshift({pname:"",pcontact:"",proposition:"",setStatus:!0})}const Me=e=>{var t;s.contractIds=e,P.value=bt.data.filter(l=>e.includes(l.id)).map(l=>({value:l.id,label:l.contractname,isLeaf:!1})),Re((t=P.value[0])==null?void 0:t.id)},P=b([]),g=async()=>{var l,i;const{data:e,error:t}=await xa({page:1,limit:100,id:(l=d.rowData)==null?void 0:l.id});P.value=e==null?void 0:e.list.map(c=>({value:c.id,label:c.contractname,isLeaf:!1})),Re((i=e==null?void 0:e.list[0])==null?void 0:i.id)},h=b([]),ne=b(),{pageData:O,getData:se}=Bt(ka),Re=async e=>{await se({pids:e}),ne.value=[],h.value=Array.from(new Set([...h.value,...O.data])),ne.value=O.data.map(t=>({label:t.devname,value:t.id}))},tt=async e=>{var t;await Re(e.value),e.children=(t=ne.value)==null?void 0:t.map(l=>({label:l.label,value:l.value,isLeaf:!0}))},C=b([]),U=et({page:1,pageSize:20,itemCount:0,showSizePicker:!0,fuzzy:"",pageSizes:[10,20],prefix:()=>`共 ${U.itemCount} 条`,onChange:e=>{U.page=e,qe()},onUpdatePageSize:e=>{U.pageSize=e,U.page=1,qe()}}),Ve=b(),Ue=[{title:"绑定合同设备",key:"cid",width:300,align:"center",render(e,t){var l,i;return e.setStatus?r(Kl,{style:"width: 270px",value:e.cid,filterable:!0,placeholder:"请选择合同设备",options:P.value,checkStrategy:"child",showPath:!1,remote:!0,renderSuffix:c=>c.option.hidden?null:c.node,renderLabel:c=>c.hidden?null:c.label,onLoad:tt,onUpdateValue(c){var S;C.value[t].cid=Number(c)||0;const f=(S=h.value)==null?void 0:S.find(k=>k.id==c);e.devname=(f==null?void 0:f.devname)||"",e.devnum=(f==null?void 0:f.devcount)||"",e.notes=(f==null?void 0:f.notes)||"",Ve.value=(f==null?void 0:f.devcount)||0,e.etype=(f==null?void 0:f.devtype)||0,e.devmanu=(f==null?void 0:f.devmanu)||"",e.devmodel=(f==null?void 0:f.devmodel)||"",e.devunit=(f==null?void 0:f.devunit)||""}}):r("div",{},e.devname2||((i=(l=ne.value)==null?void 0:l.find(c=>c.value==e.cid))==null?void 0:i.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(e,t){return e.setStatus?r(q,{value:e.devname,placeholder:"请输入",onUpdateValue(l){C.value[t].devname=l}}):r("div",{},e.devname)}},{title:"型号",key:"devmodel",width:220,align:"center",render(e,t){return r("div",{},e.devmodel)}},{title:"设备单位",key:"devunit",width:120,align:"center",render(e,t){return r("div",{},e.devunit)}},{title:"数量",key:"devnum",width:100,align:"center",render(e,t){return e.setStatus?r(ta,{value:e.devnum,placeholder:"请输入",max:Ve.value,onUpdateValue(l){C.value[t].devnum=l}}):r("div",{},e.devnum)}},{title:"是否为我司设备",key:"etype",width:260,align:"center",render(e,t){return r("div",{},e.etype==0?"是":"否")}},{title:"设备厂家",key:"devmanu",width:200,align:"center",render(e,t){return r("div",{},e.devmanu)}},{title:"清点状态",key:"status",width:120,align:"center",render(e,t){return e.setStatus&&e.id?r(ue,{value:e.status,filterable:!0,placeholder:"请选择状态",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(l){C.value[t].status=Number(l)||0}}):r("div",{},e.status===0?"未清点":e.status===1?"正常":e.status===2?"增补":e.status===3?"退货":"换货")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(e,t){return r("div",{},e.devmanu)}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(e,t){return e.setStatus?r(q,{value:e.manucontact,placeholder:"请输入",onUpdateValue(l){C.value[t].manucontact=l}}):r("div",{},e.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(e,t){return e.setStatus?r(q,{value:e.manuinfo,placeholder:"请输入",onUpdateValue(l){C.value[t].manuinfo=l}}):r("div",{},e.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(e,t){return e.setStatus&&e.id?r(ue,{value:e.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(l){C.value[t].devstatus=Number(l)||0}}):r("div",{},e.devstatus===0?"设备无异常":e.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(e,t){return e.setStatus?r(q,{value:e.connectionmode,placeholder:"请输入",onUpdateValue(l){C.value[t].connectionmode=l}}):r("div",{},e.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(e,t){return e.setStatus&&e.id?r(ue,{value:e.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(l){C.value[t].install=Number(l)||0}}):r("div",{},e.install===0?"是":"否")}},{title:"备注",key:"notes",width:200,align:"center",render(e,t){return r("div",{},e.notes)}},{title:"文件",key:"re1",width:160,align:"center",render(e,t){return e.setStatus?r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>ct(e,"debuggedDevieceList",t)},{default:()=>"上传文件"}):r(aa,{trigger:"hover"},{trigger:()=>r("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const l=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(i=>i.alias||i.file);return l.length===0?r("div",{style:"padding: 10px; color: #999;"},"暂无文件"):r("div",{style:"padding: 10px;"},[r("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[r("thead",[r("tr",[r("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),r("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),r("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),r("tbody",l.map((i,c)=>{var f;return r("tr",[r("td",{style:"text-align:center; padding: 4px 8px;"},i.alias||"-"),r("td",{style:"text-align:center; padding: 4px 8px;"},((f=i.file)==null?void 0:f.split("?")[1])||"-"),r("td",{style:"text-align:center; padding: 4px 8px;"},r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>pt({url:i.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作信息",key:"dbtime",width:180,align:"center",render(e,t){return r(aa,{trigger:"hover"},{trigger:()=>r("div",{style:"color: #1890ff;cursor: pointer;"},e.dbtime?Dt(1,e.dbtime):""),default:()=>r("div",{style:"padding: 10px;"},a("div",null,[a("div",null,[v("操作人："),e.username]),a("div",null,[v("操作时间："),e.dbtime]),a("div",null,[v("清点人："),e.dusername]),a("div",null,[v("清点时间："),e.ddbtime])]))})}},{key:"operate",title:E("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return r("div",{class:"flex-center gap-8px"},[e.setStatus?[r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>Se(e)},{default:()=>"保存"}),r(y,{type:"default",ghost:!0,size:"small",onClick:()=>p(e,t)},{default:()=>"取消"}),Et("project:Equipment:delete")&&r(Oe,{onPositiveClick:async()=>{var l;if(e.id){const{data:i,error:c}=await Qa(e.id);i&&(C.value.splice(t,1),(l=window.$message)==null||l.success("删除成功"))}else C.value.splice(t,1)}},{default:()=>E("common.confirmDelete"),trigger:()=>r(y,{type:"error",ghost:!0,size:"small"},{default:()=>E("common.delete")})})]:Et("project:Equipment:update")&&r(y,{type:"primary",ghost:!0,size:"small",onClick:()=>n(e)},{default:()=>"编辑"})])}}],ie=b([{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0},{name:"",url:"",file:void 0}]),be=b(!1),D=b(""),W=b(),ct=(e,t,l)=>{be.value=!0,D.value=t,W.value=l,e.re1&&(ie.value[0]={name:e.re1,url:e.fl1,file:void 0}),e.re2&&(ie.value[1]={name:e.re2,url:e.fl2,file:void 0}),e.re3&&(ie.value[2]={name:e.re3,url:e.fl3,file:void 0}),e.re4&&(ie.value[3]={name:e.re4,url:e.fl4,file:void 0})},Xe=async()=>{var t,l;let e=!0;if(ie.value.forEach((i,c)=>{var k,I;const f=i.name||"",S=((k=i.url)==null?void 0:k.split("?")[1])||((I=i.file)==null?void 0:I.name);(f&&!S||!f&&S)&&(e=!1)}),!e){(l=(t=window.$message)==null?void 0:t.error)==null||l.call(t,"文件名称和文件地址必须同时存在，不能只填一个");return}C.value[W.value].fileList=ie.value,e&&(be.value=!1,D.value="",W.value=void 0)},qe=async()=>{var t;const{data:e}=await el({page:U.page,limit:U.pageSize,fuzzy:U.fuzzy,pid:(t=d.rowData)==null?void 0:t.id});C.value=e.list,G.debuggedDevieceList=JSON.parse(JSON.stringify(C.value))},n=async e=>{var i,c;if(console.log(O.data,e.cid,"ssssssssssssssss"),C.value.some(f=>f.setStatus)){(i=window.$message)==null||i.warning("请先对正在编辑中的数据进行操作");return}const{data:t,error:l}=await tl(e.cid);l||(((c=P.value[P.value.length-1])==null?void 0:c.value)!=t.id&&P.value.push({value:t.id,label:t.devname,disabled:!0,isLeaf:!0,hidden:!0}),Ve.value=t.devcount||0),e.setStatus=!e.setStatus},p=(e,t)=>{e.setStatus=!e.setStatus,e.id?C.value=JSON.parse(JSON.stringify(G.debuggedDevieceList)):C.value.splice(t,1)},Se=async e=>{var t,l,i,c,f,S,k,I,Y;if(!e.cid){(t=window.$message)==null||t.warning("请选择合同设备");return}if(!e.devname){(l=window.$message)==null||l.warning("设备名称不能为空");return}if(!e.devmodel){(i=window.$message)==null||i.warning("设备型号不能为空");return}if(!e.devnum){(c=window.$message)==null||c.warning("设备数量不能为空");return}if(e.id){if(((f=e.fileList)==null?void 0:f.length)>0){const te=e.fileList.filter(w=>w.file),fe=te.length;for(let w=0;w<fe;w++){const L=te[w];L.status="uploading";try{L.url=await ot(L.file.file,L.file.name,""),L.status="done"}catch{L.status="error"}}e.fileList.forEach((w,L)=>{e[`re${L+1}`]=w.name||"",e[`fl${L+1}`]=w.url||""}),delete e.fileList}const{data:ze,error:pe}=await al([e]);pe||((S=window.$message)==null||S.success("修改成功"),qe(),e.setStatus=!e.setStatus)}else if((k=d.rowData)!=null&&k.id){if(e.fileList.length>0){const te=e.fileList.filter(w=>w.file),fe=te.length;for(let w=0;w<fe;w++){const L=te[w];L.status="uploading";try{L.url=await ot(L.file.file,L.file.name,""),L.status="done"}catch{L.status="error"}}e.fileList.forEach((w,L)=>{e[`re${L+1}`]=w.name||"",e[`fl${L+1}`]=w.url||""}),delete e.fileList}const{data:ze,error:pe}=await la([{...e,pid:(I=d.rowData)==null?void 0:I.id}]);pe||((Y=window.$message)==null||Y.success("添加成功"),qe(),e.setStatus=!e.setStatus)}else e.setStatus=!e.setStatus};function we(){var e;((e=C.value[0])!=null&&e.devname||C.value.length==0)&&C.value.unshift({status:void 0,devmanu:"",etype:0,devname:"",devmodel:"",devnum:0,notes:"",setStatus:!0})}const _e=()=>{be.value=!1},Je=b({}),F=b([]);async function at(){var t;F.value=[];const{data:e}=await ul({page:1,limit:100,pid:(t=d.rowData)==null?void 0:t.id});e.list.forEach(l=>{l.sort==1&&F.value.push({id:l.id,name:l.filename,url:l.file,status:"finished",creator:l.username,dbtime:l.dbtime})}),F.value.reverse(),G.fileList=JSON.parse(JSON.stringify(F.value)),Je.value=JSON.parse(JSON.stringify(e))}const Pt=[{title:"文件名称",key:"file",align:"center",render(e){var i;const t=async({file:c,onFinish:f,onError:S})=>{var k,I;try{e.name=c.name,e.file=c}catch(Y){console.error(Y),(I=(k=window.$message)==null?void 0:k.error)==null||I.call(k,"文件上传出错")}};async function l(c){return!0}return r("div",{style:"display:flex;justify-content:center;align-items:center;"},[e.file||e.url?r("span",{},[r("span",{},((i=e.file)==null?void 0:i.name)||e.url.split("?")[1]||"")]):r(ia,{action:"#",showFileList:!1,customRequest:t,onBeforeUpload:l},{default:()=>r(y,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(e){return e.setStatus?r(q,{value:e.name,clearable:!0,onUpdateValue:t=>{e.name=t}}):r("div",{},e.name)}},{title:"上传人",key:"creator",align:"center",width:80,render(e){return r("div",{},e.creator)}},{title:"上传时间",key:"dbtime",align:"center",width:180,render(e){return r("div",{},e.dbtime?e.dbtime:"")}},{title:"操作",key:"actions",align:"center",width:200,render(e,t){return r(xe,{justify:"center"},[!e.setStatus&&e.id&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{pt(e)}},{default:()=>"下载"}),e.setStatus&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{j(e)}},{default:()=>"保存"}),e.setStatus&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{e.setStatus=!e.setStatus,e.id?F.value=JSON.parse(JSON.stringify(G.fileList)):F.value.splice(t,1)}},{default:()=>"取消"}),!e.setStatus&&r(y,{type:"info",size:"small",ghost:!0,onClick:()=>{e.setStatus=!e.setStatus}},{default:()=>"编辑"}),Et("project:File:delete")&&(x.userInfo.usertype==0||x.userInfo.usertype==2)&&e.setStatus&&r(Oe,{onPositiveClick:async()=>{var l;if(e.id){const{data:i,error:c}=await xl(e.url),{data:f,error:S}=await kl(e.id);S||((l=window.$message)==null||l.success("删除成功"),at())}else F.value=F.value.filter(i=>i!==e)}},{default:()=>E("common.confirmDelete"),trigger:()=>r(y,{type:"error",ghost:!0,size:"small"},{default:()=>E("common.delete")})})])}}],Ft=[{title:"",key:"",align:"center",render(e,t){return`附件${t+1}`}},{title:"文件名称",key:"filename",align:"center",render(e){var i;const t=async({file:c,onFinish:f,onError:S})=>{var k,I;try{e.name=c.name,e.file=c}catch(Y){console.error(Y),(I=(k=window.$message)==null?void 0:k.error)==null||I.call(k,"文件上传出错")}};async function l(c){return!0}return r("div",{style:"display:flex;justify-content:center;align-items:center;"},[e.file||e.url?r("span",{},[r("span",{},((i=e.file)==null?void 0:i.name)||e.url.split("?")[1]||""),r("span",{style:"color:red;cursor:pointer;font-size:12px;margin-left:8px;",onClick:()=>{e.url="",e.file=null,e.name=""}},"删除")]):r(ia,{action:"#",showFileList:!1,customRequest:t,onBeforeUpload:l},{default:()=>r(y,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})})])}},{title:"文件别名",key:"name",align:"center",render(e){return r(q,{value:e.name,clearable:!0,onUpdateValue:t=>{e.name=t}})}}];async function pt(e){if(e!=null&&e.url)try{const l=await(await fetch(e.url.split("?")[0],{mode:"cors"})).blob(),i=URL.createObjectURL(l),c=document.createElement("a");c.href=i,c.download=e.url.split("?")[1],c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(i)}catch(t){console.error("下载失败:",t)}}const ft=()=>{F.value.push({id:"",name:"",url:"",status:!1,setStatus:!0})},j=async e=>{var t,l,i,c,f,S,k,I,Y,ze,pe,te;if(!e.name){(l=(t=window.$message)==null?void 0:t.warning)==null||l.call(t,"请输入文件别名");return}if(!e.file&&!e.url){(c=(i=window.$message)==null?void 0:i.warning)==null||c.call(i,"请上传文件");return}if((f=d.rowData)!=null&&f.id){e.url=await ot(e.file.file,e.file.name,"");const{data:fe,error:w}=await da([{pid:(S=d.rowData)==null?void 0:S.id,filename:e.name,file:e.url,sort:1}]);if(w)return(k=window.$message)==null?void 0:k.error("保存文件记录失败");(I=window.$message)==null||I.destroyAll(),e.setStatus=!e.setStatus,at(),(Y=window.$message)==null||Y.success("保存成功")}else if(e.id){const{data:fe,error:w}=await Cl([{id:e.id,filename:e.name}]);if(w)return(ze=window.$message)==null?void 0:ze.error("保存文件记录失败");(pe=window.$message)==null||pe.destroyAll(),e.setStatus=!e.setStatus,(te=window.$message)==null||te.success("编辑成功")}else e.setStatus=!e.setStatus},Ge=ll(()=>({add:"新增项目",edit:"修改项目"})[d.operateType]),We=Mt(ae,"visible");zt(We,()=>{We.value&&(Ae(),setTimeout(()=>{const e=document.querySelector(".n-scrollbar-content");e==null||e.scrollTo(0,0)},300),Ce())});function Fa(e){e||je()}function je(){We.value=!1}async function qt(){var e;(e=window.$dialog)==null||e.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await Aa()}})}async function Aa(){var e,t,l,i,c,f,S,k,I,Y,ze,pe,te,fe,w,L,m,me,Ze;if(d.operateType==="edit"){const Ee=JSON.parse(JSON.stringify(s));R.value==Ee.period&&delete Ee.period,he.value==Ee.status&&delete Ee.status;const{data:Ka,error:Tt}=await Ca([Ee]);if(!Tt){let $e=function(Le,ge){const re=Le.filter(Pe=>!ge.includes(Pe)),Qe=ge.filter(Pe=>!Le.includes(Pe));return{toDelete:re,toAdd:Qe}};if((e=s.dispatchIds)!=null&&e.length&&((t=s.dispatchIds)==null?void 0:t.length)>0){const{toDelete:Le,toAdd:ge}=$e(Xt.value,s.dispatchIds);if(ge.length>0){const re=ge.map(_=>({pid:s.id,did:_})),{data:Qe,error:Pe}=await oa(re)}if(Le.length>0){const{data:re,error:Qe}=await dl(Le.join(","))}}if((l=s.contractIds)!=null&&l.length&&((i=s.contractIds)==null?void 0:i.length)>0){const{toDelete:Le,toAdd:ge}=$e(Qt.value,s.contractIds);if(ge.length>0){const re=ge.map(_=>({pid:s.id,did:_})),{data:Qe,error:Pe}=await ra(re)}if(Le.length>0){const{data:re,error:Qe}=await cl(Le.join(","))}}je(),le("submitted"),(c=window.$message)==null||c.success("修改成功")}}else{const Ee=pl(),{data:Ka,error:Tt}=await fl([{...s,uuid:Ee}]);if(!Tt){const{data:$e,error:Le}=await ml(Ee);if($e){let ge=function(_,Z,it){return _.map(K=>({...K,pid:Z}))};for(const _ of C.value)if(((f=_.fileList)==null?void 0:f.length)>0){const Z=_.fileList.filter(K=>K.file),it=Z.length;for(let K=0;K<it;K++){const B=Z[K];B.status="uploading";try{B.url=await ot(B.file.file,B.file.name,""),B.status="done"}catch{B.status="error"}}_.fileList.forEach((K,B)=>{_[`re${B+1}`]=K.name||"",_[`fl${B+1}`]=K.url||""}),delete _.fileList}if(s.dispatchIds&&s.dispatchIds.length>0){const _=[];(S=s.dispatchIds)==null||S.forEach(K=>{_.push({pid:$e,did:K})});const{data:Z,error:it}=await oa(_)}if(s.contractIds&&s.contractIds.length>0){const _=[];(k=s.contractIds)==null||k.forEach(async K=>{_.push({proid:$e,conid:K})});const{data:Z,error:it}=await ra(_)}const re=[];if(z.value.length>0){const _=ge(z.value,$e);re.push(ea(_))}if(C.value.length>0){const _=ge(C.value,$e);re.push(la(_))}if(A.value.length>0&&re.push(ua(A.value)),(await Promise.allSettled(re)).forEach((_,Z)=>{_.status==="fulfilled"?console.log(`第 ${Z+1} 个请求成功`,_.value):console.error(`第 ${Z+1} 个请求失败`,_.reason)}),!F.value.length){(I=window.$message)==null||I.destroyAll(),(Y=window.$message)==null||Y.success("操作成功"),je(),le("submitted");return}if(!F.value.length){(ze=window.$message)==null||ze.destroyAll(),(pe=window.$message)==null||pe.success("操作成功"),je(),le("submitted");return}if(F.value.length==0)return(te=window.$message)==null?void 0:te.warning("请选择文件");let Pe=!0;for(let _=0;_<F.value.length;_++){const Z=F.value[_];if(!Z.file){(fe=window.$message)==null||fe.warning(`第${_+1}个文件的文件名称不能为空`),Pe=!1;break}if(!Z.name){(w=window.$message)==null||w.warning(`第${_+1}个文件的文件别名不能为空`),Pe=!1;break}}if(Pe){const _=F.value.length;for(let B=0;B<_;B++){const Fe=F.value[B];Fe.indexText=`${B+1}/${_}`,Fe.progress=0,Fe.status="uploading";try{Fe.url=await ot(Fe.file.file,Fe.name,"",yn=>{}),Fe.status="done"}catch{Fe.status="error"}}const Z=F.value.map(B=>({file:B.url,filename:B.name,pid:$e,sort:1})),{data:it,error:K}=await da(Z);K&&((L=window.$message)==null||L.error("保存文件记录失败")),(m=window.$message)==null||m.destroyAll(),(me=window.$message)==null||me.success("操作成功"),je(),le("submitted")}}}je(),le("submitted"),(Ze=window.$message)==null||Ze.success("添加成功")}}const Ke=b(!1),At=b();let Te=null,lt=null,mt=null,Ia=null,Jt=null,De=null;const oe=et({longitude:0,latitude:0});let nt;const gt=b(!1),ce=b(""),vt=b([]);let ht=0;async function Gt(){try{if(window._AMapSecurityConfig={securityJsCode:x.userInfo.sdksecret},!At.value)return;De=await ql.load({key:x.userInfo.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),Te=new De.Map(At.value,{zoom:18,center:[$.value>0?A.value[$.value-1].longitude:s.longitude,$.value>0?A.value[$.value-1].latitude:s.latitude],viewMode:"3D",resizeEnable:!0}),lt=new De.Geocoder,Ia=new De.PlaceSearch({city:"全国",pageSize:50}),Jt=new De.AutoComplete({city:"全国"}),yt(De,{lng:$.value>0?A.value[$.value-1].longitude:s.longitude,lat:$.value>0?A.value[$.value-1].latitude:s.latitude}),Te.on("click",e=>{const{lng:t,lat:l}=e.lnglat;nt=2,oe.latitude=l,oe.longitude=t,yt(De,{lng:t,lat:l})}),ht=0,St(()=>{window.dispatchEvent(new Event("resize"))})}catch(e){console.error("地图加载失败：",e),ht<un?(ht++,console.warn(`地图加载失败，正在第 ${ht} 次重试...`),setTimeout(()=>{Gt()},1500)):console.error("地图加载失败，已达到最大重试次数，停止重试")}}const Kt=ha.debounce(async e=>{if(!gt.value||!e.trim()){vt.value=[];return}Jt.search(e,(t,l)=>{var i;console.log(l,"result"),t=="complete"&&l.info=="OK"&&((i=l==null?void 0:l.tips)!=null&&i.length)?vt.value=l.tips.map(c=>({label:`${c.name}（${c.district||c.address||"无详细地址"}）`,value:`${c.location.lng}_${c.location.lat}`,raw:c})):vt.value=[]})},300);zt(ce,e=>{Kt(e)});function Na(e,t){if(console.log(e,t,"option"),!e)return;const[l,i]=e.split("_").map(Number);!l||!i||(Te.setCenter([l,i]),nt=1,yt(De,{lng:l,lat:i}),oe.longitude=l,oe.latitude=i)}const $=b(0);function Ht(e){e?$.value=e:$.value=0,Ke.value=!0,gt.value=!1,nt=void 0,St(async()=>{await Gt(),setTimeout(()=>{gt.value=!0;const t=document.querySelector(".n-auto-complete input");t==null||t.blur(),console.log(s),s.region&&!s.prosite&&!s.prosite&&Nt(s.region)},500)})}const It=b({lng:0,lat:0});function yt(e,t){mt&&Te.remove(mt),mt=new e.Marker({position:[t.lng,t.lat],map:Te}),Te.add(mt),lt.getAddress(t,async(l,i)=>{l==="complete"&&i.regeocode&&(console.log("result",i),console.log("formattedAddress",i.regeocode.formattedAddress),t.latitude=t.lat,t.longitude=t.lng,It.value=t,nt==1?(s.proaddr=i.regeocode.formattedAddress,s.provice=Ut(s.proaddr,Ye.value),await st(s.provice),s.region=jt(s.proaddr,He.value)):nt==2?(ce.value=i.regeocode.formattedAddress,s.proaddr=i.regeocode.formattedAddress,s.provice=Ut(s.proaddr,Ye.value),await st(s.provice),s.region=jt(s.proaddr,He.value)):(ce.value=$.value>0?A.value[$.value-1].addr||i.regeocode.formattedAddress:s.prosite||i.regeocode.formattedAddress,s.proaddr=$.value>0?A.value[$.value-1].addr||i.regeocode.formattedAddress:s.proaddr||i.regeocode.formattedAddress,s.provice=Ut(ce.value,Ye.value)||s.provice,s.provice&&(await st(s.provice),s.region=jt(ce.value,He.value))))})}const Xt=b([]),Ua=async()=>{var l;const{data:e,error:t}=await gl({page:1,limit:100,pid:(l=d.rowData)==null?void 0:l.id});s.dispatchIds=e==null?void 0:e.list.map(i=>i.did),Xt.value=JSON.parse(JSON.stringify(s.dispatchIds))},Wt=b([]),Yt=async e=>{if(!e)return;const{data:t,error:l}=await vl({page:1,limit:100,province:e});Wt.value=t.list},Ye=b([]),ja=async()=>{const{data:e,error:t}=await Sa();e&&(Ye.value=e)},Zt=e=>{st(e),s.region=null,s.prosite="",s.proaddr="",ce.value="",Yt(e)},Nt=e=>{var l;const t=(l=He.value.find(i=>i.id===e))==null?void 0:l.name;s.region&&s.prosite&&s.proaddr&&!lt?(s.prosite="",s.proaddr=""):Ta(t)},He=b([]),st=async e=>{var i;if(!e)return(i=window.$message)==null?void 0:i.warning("请先选择省份");const{data:t,error:l}=await wa({province:e});t&&(He.value=t)};function Ta(e){!e||!lt||!Te||lt.getLocation(e,(t,l)=>{var i;if(t==="complete"&&((i=l.geocodes)!=null&&i.length)){const{location:c,formattedAddress:f}=l.geocodes[0],S=c.lng,k=c.lat;Te.setZoomAndCenter(14,[S,k]),oe.longitude=S,oe.latitude=k,s.latitude=oe.latitude,s.longitude=oe.longitude,yt(De,{lng:S,lat:k}),s.proaddr=f,s.prosite=f,ce.value=f}})}function Ut(e,t){let l=null;for(const i of t)if(e.includes(i.name)){l=i.id;break}return l}function jt(e,t){let l=null;for(const i of t)if(e.includes(i.name)){l=i.id;break}return l}const Ea=async()=>{var e,t,l;if($.value==0)s.latitude=oe.latitude||It.value.lat,s.longitude=oe.longitude||It.value.lng,s.prosite=ce.value;else if(A.value[$.value-1].addr=ce.value,A.value[$.value-1].latitude=oe.latitude,A.value[$.value-1].longitude=oe.longitude,d.operateType=="edit"){let i=A.value[$.value-1];if(A.value[$.value-1].id){const{data:c,error:f}=await hl([i]);c&&((e=window.$message)==null||e.success("修改位置成功"),Ke.value=!1,$.value=0,_t())}else{i.pid=(t=d.rowData)==null?void 0:t.id;const{data:c,error:f}=await ua([i]);c&&((l=window.$message)==null||l.success("添加位置成功"),Ke.value=!1,$.value=0,_t())}}Ke.value=!1,$.value=0};function Oa(){Ke.value=!1}const{pageData:bt,getData:Ba,nextPage:Ma}=Bt(yl),Ra=async()=>{await Ba({limit:100})},Va=async e=>{const t=e.currentTarget,l=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&bt.data.length<bt.total&&(await Ma(),await St(),setTimeout(()=>{t.scrollTop=l}))},Qt=b([]),qa=async()=>{var l;const{data:e,error:t}=await bl({page:1,limit:100,proid:(l=d.rowData)==null?void 0:l.id});s.contractIds=e==null?void 0:e.list.map(i=>i.conid),Qt.value=JSON.parse(JSON.stringify(s.contractIds))},A=b([{longitude:120.373885,latitude:30.303899,addr:""}]),Ja=b([]),_t=async()=>{var l;const{data:e,error:t}=await _l({pid:(l=d.rowData)==null?void 0:l.id,page:1,limit:99});A.value=e.list.length==0?[{longitude:120.373885,latitude:30.303899,addr:""}]:e.list,Ja.value=JSON.parse(JSON.stringify(A.value))},Ga=async e=>{var t;if(e.id){const{data:l,error:i}=await Sl(e.id);l&&((t=window.$message)==null||t.success("删除成功"),_t())}else A.value.splice(A.value.indexOf(e),1)};return(e,t)=>{const l=La,i=Pa,c=Rl,f=il,S=Ml,k=ma,I=$t,Y=$a,ze=ya,pe=sl,te=nl,fe=_a,w=rl,L=Vl;return T(),Ct(na,null,[a(te,{show:We.value,"onUpdate:show":[t[16]||(t[16]=m=>We.value=m),Fa],"display-directive":"show",width:1100,onMaskClick:t[17]||(t[17]=m=>We.value=!0),onEsc:je},{default:o(()=>[a(pe,{title:Ge.value,"native-scrollbar":!1,closable:""},{footer:o(()=>[a(u(xe),{size:16,justify:"end"},{default:o(()=>[a(u(y),{onClick:je},{default:o(()=>[v(Q(u(E)("common.cancel")),1)]),_:1}),a(u(y),{type:"primary",onClick:qt},{default:o(()=>t[32]||(t[32]=[v(Q("保存"))])),_:1,__:[32]})]),_:1})]),default:o(()=>[a(ze,{ref_key:"formRef",ref:H,model:s,rules:Ie,onKeyup:ba(qt,["enter"])},{default:o(()=>[a(Y,{responsive:"screen","item-responsive":"","x-gap":"15"},{default:o(()=>[a(l,{span:"24 s:12 m:12",label:"项目名称",path:"proname"},{default:o(()=>[a(u(q),{clearable:"",value:s.proname,"onUpdate:value":t[0]||(t[0]=m=>s.proname=m),placeholder:"请输入项目名称"},null,8,["value"])]),_:1}),d.operateType==="add"?(T(),J(l,{key:0,span:"24 s:12 m:12",label:"绑定合同",path:"contractIds"},{default:o(()=>[a(u(ue),{filterable:"",multiple:"",value:s.contractIds,"onUpdate:value":[t[1]||(t[1]=m=>s.contractIds=m),Me],placeholder:"请选择合同","label-field":"contractname","value-field":"id",options:u(bt).data,onScroll:Va},null,8,["value","options"])]),_:1})):ve("",!0),d.operateType==="edit"?(T(),J(l,{key:1,span:"24 s:12 m:12",label:"项目状态",path:"status"},{default:o(()=>[a(u(ue),{filterable:"",value:s.status,"onUpdate:value":t[2]||(t[2]=m=>s.status=m),placeholder:"请选择项目状态",options:u(dt)(u(x).userInfo.usertype==0||u(x).userInfo.usertype==2?u(Vt):u(Jl))},null,8,["value","options"])]),_:1})):ve("",!0),a(l,{span:"24 s:12 m:12",label:"周期（天）",path:"period"},{default:o(()=>[a(u(ta),{clearable:"",value:s.period,"onUpdate:value":t[3]||(t[3]=m=>s.period=m),style:{width:"100%"},placeholder:"请输入周期"},null,8,["value"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"计划调试时间",path:"plantime"},{default:o(()=>[a(i,{size:"small","formatted-value":s.plantime,"onUpdate:formattedValue":t[4]||(t[4]=m=>s.plantime=m),type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"调试类型",path:"dtype"},{default:o(()=>[a(u(ue),{filterable:"",value:s.dtype,"onUpdate:value":t[5]||(t[5]=m=>s.dtype=m),placeholder:"请选择调试类型",options:u(dt)(u(za))},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"省份",path:"provice"},{default:o(()=>[a(u(ue),{filterable:"",value:s.provice,"onUpdate:value":[t[6]||(t[6]=m=>s.provice=m),Zt],placeholder:"请选择省份","label-field":"name","value-field":"id",options:Ye.value},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"地区",path:"region"},{default:o(()=>[a(u(ue),{filterable:"",value:s.region,"onUpdate:value":[t[7]||(t[7]=m=>s.region=m),Nt],placeholder:"请选择地区","label-field":"name","value-field":"id",options:He.value},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"项目默认地点",path:"prosite"},{default:o(()=>[M("div",Zl,[M("div",Ql,[a(f,{onClick:t[9]||(t[9]=m=>Ht())},{default:o(()=>[a(u(q),{value:s.prosite,"onUpdate:value":t[8]||(t[8]=m=>s.prosite=m),placeholder:"请选择项目地点"},null,8,["value"]),a(u(y),null,{icon:o(()=>[a(c,{class:"text-icon"})]),_:1})]),_:1})])])]),_:1}),a(l,{span:"24 s:12 m:12",label:"项目详细地址",path:"proaddr"},{default:o(()=>[a(u(q),{type:"textarea",rows:1,clearable:"",value:s.proaddr,"onUpdate:value":t[10]||(t[10]=m=>s.proaddr=m),placeholder:"请输入项目详细地址"},null,8,["value"])]),_:1}),A.value.length?(T(),J(l,{key:2,span:"24 s:12 m:24",label:"",path:""},{default:o(()=>[M("div",en,[M("div",tn,[M("span",{class:"mr-10px",onClick:t[11]||(t[11]=sa(()=>{},["stop"]))},"其他地址"),a(u(y),{size:"small",ghost:"",type:"primary",onMousedown:t[12]||(t[12]=sa(()=>{},["stop"])),onClick:t[13]||(t[13]=m=>A.value.push({latitude:30.303899,longitude:120.373885,addr:""}))},{icon:o(()=>[a(S,{class:"text-icon"})]),default:o(()=>[t[24]||(t[24]=v(" 添加 "))]),_:1,__:[24]})]),M("div",an,[(T(!0),Ct(na,null,ol(A.value,(m,me)=>(T(),Ct("div",{class:"flex px-50px items-center mt-10px w-100%",key:m.latitude},[M("span",ln,"项目地址"+Q(me+1),1),a(f,{onClick:Ze=>Ht(me+1)},{default:o(()=>[a(u(q),{readonly:"",value:m.addr,"onUpdate:value":Ze=>m.addr=Ze,placeholder:"请选择项目地址"+(me+1)},null,8,["value","onUpdate:value","placeholder"]),a(u(y),null,{icon:o(()=>[a(c,{class:"text-icon"})]),_:1})]),_:2},1032,["onClick"]),A.value.length>1?(T(),J(u(Oe),{key:0,onPositiveClick:Ze=>Ga(m)},{trigger:o(()=>[a(u(y),{size:"small",ghost:"",type:"error",class:"ml-10px"},{icon:o(()=>[a(k,{class:"text-icon"})]),default:o(()=>[t[25]||(t[25]=v(" "+Q("删除")))]),_:1,__:[25]})]),default:o(()=>[v(" 确定要删除项目地址"+Q(me+1)+"吗？ ",1)]),_:2},1032,["onPositiveClick"])):ve("",!0)]))),128))])])]),_:1})):ve("",!0),a(l,{span:"24 s:12 m:12",label:"调度名称",path:"dispatch"},{default:o(()=>[a(u(q),{clearable:"",value:s.dispatch,"onUpdate:value":t[14]||(t[14]=m=>s.dispatch=m),placeholder:"请输入调度名称"},null,8,["value"])]),_:1}),a(l,{span:"24 s:12 m:12",label:"选择调度",path:"dispatchIds"},{default:o(()=>[a(u(ue),{filterable:"",multiple:"",value:s.dispatchIds,"onUpdate:value":t[15]||(t[15]=m=>s.dispatchIds=m),placeholder:"请选择调度","label-field":"dname","value-field":"id",options:Wt.value},null,8,["value","options"])]),_:1}),a(l,{span:"24 s:12 m:24",path:"contactList"},{default:o(()=>[M("div",nn,[a(u(xe),{align:"center",style:{"margin-bottom":"10px"}},{default:o(()=>[t[27]||(t[27]=M("span",null,"项目联系人",-1)),a(u(y),{size:"small",ghost:"",type:"primary",onClick:Be},{icon:o(()=>[a(S,{class:"text-icon"})]),default:o(()=>[t[26]||(t[26]=v(" 添加项目联系人 "))]),_:1,__:[26]})]),_:1,__:[27]}),z.value.length>0?(T(),J(I,{key:0,columns:Ne,"paginate-single-page":!1,data:z.value,pagination:X,"max-height":350,"scroll-x":Ne.reduce((m,me)=>m+me.width,0)},null,8,["data","pagination","scroll-x"])):ve("",!0)])]),_:1}),a(l,{span:"24 s:12 m:24",path:"debuggedDevieceList"},{default:o(()=>[M("div",sn,[a(u(xe),{align:"center",style:{"margin-bottom":"10px"}},{default:o(()=>[t[29]||(t[29]=M("span",null,"待调试设备",-1)),a(u(y),{size:"small",ghost:"",type:"primary",onClick:we},{icon:o(()=>[a(S,{class:"text-icon"})]),default:o(()=>[t[28]||(t[28]=v(" 添加待调试设备 "))]),_:1,__:[28]})]),_:1,__:[29]}),C.value.length>0?(T(),J(I,{key:0,style:{width:"1050px"},columns:Ue,data:C.value,size:"small","scroll-x":Ue.reduce((m,me)=>m+me.width,0),"row-key":m=>m.id,"max-height":350,pagination:U.pageSize==1?!1:U,remote:"","paginate-single-page":!1},null,8,["data","scroll-x","row-key","pagination"])):ve("",!0)])]),_:1}),a(l,{span:"24 s:12 m:24"},{default:o(()=>[M("div",on,[a(u(xe),{align:"center",style:{"margin-bottom":"10px"}},{default:o(()=>[t[31]||(t[31]=M("span",null,"图纸",-1)),a(u(y),{size:"small",ghost:"",type:"primary",onClick:ft},{icon:o(()=>[a(S,{class:"text-icon"})]),default:o(()=>[t[30]||(t[30]=v(" 添加图纸 "))]),_:1,__:[30]})]),_:1,__:[31]}),F.value.length>0?(T(),J(I,{key:0,columns:Pt,data:F.value,size:"small","scroll-x":702,"row-key":m=>m.id,"max-height":350},null,8,["data","row-key"])):ve("",!0)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"]),a(fe,{show:be.value,"onUpdate:show":t[18]||(t[18]=m=>be.value=m),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:o(()=>[v(Q(D.value=="debuggedDevieceList"?"待调试设备":D.value=="debuggedBusinessList"?"待调试业务":D.value=="needsList"?"客户需求变更":D.value=="developBusinessList"?"需要开发":"")+" 文件列表 ",1)]),footer:o(()=>[a(u(xe),{justify:"end"},{default:o(()=>[a(u(y),{size:"small",class:"mt-16px",onClick:_e},{default:o(()=>[v(Q(u(E)("common.cancel")),1)]),_:1}),a(u(y),{type:"primary",size:"small",class:"mt-16px",onClick:Xe},{default:o(()=>[v(Q(u(E)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(I,{columns:Ft,"paginate-single-page":!1,data:ie.value,"max-height":350},null,8,["data"])]),_:1},8,["show"]),a(fe,{show:Ke.value,"onUpdate:show":t[23]||(t[23]=m=>Ke.value=m),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:o(()=>[a(u(xe),{justify:"end",size:16},{default:o(()=>[a(u(y),{onClick:Oa},{default:o(()=>[v(Q(u(E)("common.cancel")),1)]),_:1}),a(u(y),{type:"primary",onClick:Ea},{default:o(()=>[v(Q(u(E)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(u(xe),null,{default:o(()=>[a(w,{label:"省份",path:"provice","label-placement":"left","label-width":"70"},{default:o(()=>[a(u(ue),{filterable:"",value:s.provice,"onUpdate:value":[t[19]||(t[19]=m=>s.provice=m),Zt],placeholder:"请选择省份","label-field":"name","value-field":"id",options:Ye.value},null,8,["value","options"])]),_:1}),a(w,{label:"地区",path:"region","label-placement":"left","label-width":"70"},{default:o(()=>[a(u(ue),{filterable:"",value:s.region,"onUpdate:value":[t[20]||(t[20]=m=>s.region=m),Nt],placeholder:"请选择地区","label-field":"name","value-field":"id",options:He.value},null,8,["value","options"])]),_:1})]),_:1}),gt.value?(T(),J(w,{key:0,label:$.value==0?"项目地址":"项目地址"+$.value,"label-placement":"left"},{default:o(()=>[M("div",rn,[a(L,{value:ce.value,"onUpdate:value":[t[21]||(t[21]=m=>ce.value=m),u(Kt)],options:vt.value,style:{"margin-bottom":"7px"},placeholder:"请输入地点关键字",clearable:"",onSelect:Na},null,8,["value","options","onUpdate:value"]),$.value==0?(T(),J(u(q),{key:0,type:"textarea",rows:2,clearable:"",value:s.proaddr,"onUpdate:value":t[22]||(t[22]=m=>s.proaddr=m),placeholder:"请输入详细地址"},null,8,["value"])):ve("",!0)])]),_:1},8,["label"])):ve("",!0),M("div",{ref_key:"domRef",ref:At,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])],64)}}}),cn=Lt({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:wt(["reset","search"],["update:model"]),setup(ae,{emit:de}){wl();const x=de,{formRef:le,restoreValidation:G}=va(),d=Mt(ae,"model"),{pageData:s,getData:ke,nextPage:R}=Bt(Dl),he=async g=>{const h=g.currentTarget,ne=h.scrollTop;h.scrollTop+h.offsetHeight>=h.scrollHeight&&s.data.length<s.total&&(await R(),await St(),setTimeout(()=>{h.scrollTop=ne}))};ke({usertypes:"2,3"});const Ae=async g=>{d.value.participant=g,x("search")},H={当日:()=>{const g=new Date().getTime();return[g,g]},本周:()=>{const g=new Date().getTime();return[g-24*60*60*1e3*7,g]},上月:()=>{const g=new Date().getTime();return[g-24*60*60*1e3*30,g]},近一年:()=>{const g=new Date().getTime();return[g-24*60*60*1e3*365,g]},近三年:()=>{const g=new Date().getTime();return[g-24*60*60*1e3*365*3,g]}};function Ce(){d.value.fuzzy="",x("search")}const Ie=b([]);(async()=>{const{data:g,error:h}=await Sa();g&&(Ie.value=g)})();const X=g=>{N(g),d.value.regions=null,d.value.region=null,x("search")},Ne=g=>{var h;d.value.region=g,d.value.regions=(h=d.value.region)==null?void 0:h.join(","),x("search")},V=b([]),N=async g=>{var O;if(!g)return(O=window.$message)==null?void 0:O.warning("请先选择省份");const{data:h,error:ne}=await wa({province:g});h&&(V.value=h)};async function ee(g,h){if(!g){d.value.startTime=void 0,d.value.endTime=void 0,x("search");return}d.value.startTime=String(Dt(1,h[0])),d.value.endTime=String(Dt(1,h[1])),x("search")}async function ye(){d.value.startTime=void 0,d.value.endTime=void 0,d.value.startAndTimeRange=null,d.value.fuzzy="",d.value.status=null,d.value.ptype=null,d.value.dtype=null,d.value.region=null,d.value.regions=null,d.value.provice=null,await G(),x("reset")}const Be=ha.debounce(g=>{x("search")},1e3,{leading:!0,trailing:!1}),Me=g=>{d.value.fuzzy=g,Be(g)};async function P(){x("search")}return(g,h)=>{const ne=q,O=La,se=ue,Re=Pa,tt=Xl,C=y,U=Hl,Ve=xe,Ue=$a,ie=ya,be=Rt;return T(),J(be,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[a(ie,{ref_key:"formRef",ref:le,model:d.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ba(P,["enter"])},{default:o(()=>[a(Ue,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[a(O,{span:"24 s:12 m:6",label:"项目/客户",path:"fuzzy"},{default:o(()=>[a(ne,{clearable:"",value:d.value.fuzzy,"onUpdate:value":h[0]||(h[0]=D=>d.value.fuzzy=D),placeholder:"请输入项目名称或客户名称",onClear:Ce,onInput:Me},null,8,["value"])]),_:1}),a(O,{span:"24 s:12 m:6",label:"项目状态",path:"status"},{default:o(()=>[a(se,{clearable:"",filterable:"",value:d.value.status,"onUpdate:value":[h[1]||(h[1]=D=>d.value.status=D),P],placeholder:"请选择项目状态",options:u(dt)(u(Vt)).sort((D,W)=>D.value-W.value)},null,8,["value","options"])]),_:1}),a(O,{span:"24 s:12 m:6",label:"进度状态",path:"ptype"},{default:o(()=>[a(se,{clearable:"",filterable:"",value:d.value.ptype,"onUpdate:value":[h[2]||(h[2]=D=>d.value.ptype=D),P],placeholder:"请选择进度状态",options:[{label:"正常",value:0},{label:"已延期",value:1},{label:"作废",value:2}]},null,8,["value"])]),_:1}),a(O,{span:"24 s:12 m:6",label:"调试类型",path:"dtype"},{default:o(()=>[a(se,{clearable:"",filterable:"",value:d.value.dtype,"onUpdate:value":[h[3]||(h[3]=D=>d.value.dtype=D),P],placeholder:"请选择调试类型",options:u(dt)(u(za))},null,8,["value","options"])]),_:1}),a(O,{span:"24 s:12 m:3",label:"省份",path:"provice","label-width":"60"},{default:o(()=>[a(se,{filterable:"",value:d.value.provice,"onUpdate:value":[h[4]||(h[4]=D=>d.value.provice=D),X],placeholder:"请选择省份","label-field":"name","value-field":"id",clearable:"",options:Ie.value},null,8,["value","options"])]),_:1}),a(O,{span:"24 s:12 m:3",label:"地区",path:"region","label-width":"60"},{default:o(()=>[a(se,{filterable:"",value:d.value.region,"onUpdate:value":[h[5]||(h[5]=D=>d.value.region=D),Ne],placeholder:"请选择地区","label-field":"name","value-field":"id",clearable:"",multiple:"",options:V.value},null,8,["value","options"])]),_:1}),a(O,{span:"24 s:12 m:6",label:"参与人",path:"participant"},{default:o(()=>[a(se,{clearable:"",filterable:"",value:d.value.participant,"onUpdate:value":[h[6]||(h[6]=D=>d.value.participant=D),Ae],placeholder:"请选择","label-field":"username","value-field":"id",options:u(s).data,onScroll:he},null,8,["value","options"])]),_:1}),a(O,{span:"24 s:12 m:8",label:"起止时间"},{default:o(()=>[a(Re,{value:d.value.startAndTimeRange,"onUpdate:value":h[7]||(h[7]=D=>d.value.startAndTimeRange=D),type:"datetimerange",clearable:"",shortcuts:H,"onUpdate:formattedValue":ee},null,8,["value"])]),_:1}),a(O,{span:"24  s:12 m:4",class:"pr-24px"},{default:o(()=>[a(Ve,{class:"w-full"},{default:o(()=>[a(C,{onClick:ye},{icon:o(()=>[a(tt,{class:"text-icon"})]),default:o(()=>[v(" "+Q(u(E)("common.reset")),1)]),_:1}),a(C,{type:"primary",ghost:"",onClick:P},{icon:o(()=>[a(U,{class:"text-icon"})]),default:o(()=>[v(" "+Q(u(E)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),pn={class:"min-h-500px flex gap-16px"},fn={class:"flex items-center justify-end gap-16px"},mn=Lt({__name:"relatedContractLook",props:wt({id:{},pname:{}},{visable:{type:Boolean},visableModifiers:{}}),emits:["update:visable"],setup(ae){const de=ae,x=Mt(ae,"visable"),{columns:le,data:G,getData:d,loading:s,mobilePagination:ke,searchParams:R}=Ot({apiFn:xa,immediate:!1,apiParams:{page:1,pageSize:20,limit:20,id:de.id,_t:new Date().getTime()},columns:()=>[{key:"contractname",title:"合同",width:200,render:N=>a("div",{class:X.pids==N.id?"bg-#f1f1f1 cursor-pointer p-5px":"cursor-pointer p-5px",onClick:()=>Ne(N.id)},[a("div",{class:"flex"},[a("div",{class:"w-60px inline-block"},[v("名称：")]),N.contractname]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("编号：")]),v(" "),N.contractnum]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("联系人：")]),N.businesscon]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("联系方式：")]),N.businessinfo]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("注意事项：")]),N.precautions]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("备注：")]),N.notes])])}]}),{columns:he,data:Ae,getData:H,loading:Ce,pagination:Ie,mobilePagination:z,searchParams:X}=Ot({apiFn:ka,immediate:!1,apiParams:{page:1,pageSize:20,limit:20,pids:de.id,_t:new Date().getTime()},columns:()=>[{key:"devname",title:"设备名称",align:"center",width:200,resizable:!0},{key:"devcount",title:"数量",align:"center",width:60,resizable:!0},{key:"devmodel",title:"规格型号",align:"center",width:200,resizable:!0},{key:"devunit",title:"单位",align:"center",width:100,resizable:!0},{key:"notes",title:"备注",align:"center",width:120,resizable:!0},{key:"devtype",title:"是否为我司设备",align:"center",width:120,render:N=>N.devtype==0?a(ut,{type:"success"},{default:()=>[v("是")]}):a(ut,{type:"info"},{default:()=>[v("否")]}),resizable:!0},{key:"devmanu",title:"设备厂家",align:"center",width:120,resizable:!0},{key:"username",title:"创建人",align:"center",width:100,resizable:!0},{key:"dbtime",title:"创建时间",align:"center",width:180,resizable:!0}]}),Ne=N=>{X.pids=N,H()},V=()=>{x.value=!1};return zt(()=>x.value,async N=>{var ee;N&&(R.id=de.id,Ae.value=[],Ie.itemCount=0,await d(),X.pids=(ee=G.value[0])==null?void 0:ee.id,X.pids&&H())}),(N,ee)=>{const ye=$t,Be=Rt,Me=_a;return T(),J(Me,{show:x.value,"onUpdate:show":ee[0]||(ee[0]=P=>x.value=P),preset:"card",class:"w-1400px",title:`${de.pname} --- 关联的合同=>设备`},{footer:o(()=>[M("div",fn,[a(u(y),{type:"primary",size:"small",onClick:V},{default:o(()=>ee[1]||(ee[1]=[v(" 关闭 ")])),_:1,__:[1]})])]),default:o(()=>[M("div",pn,[a(ye,{class:"left",columns:u(le),data:u(G),"paginate-single-page":!1,size:"small",remote:"",loading:u(s),pagination:u(ke),"row-key":P=>P.id,"max-height":600},null,8,["columns","data","loading","pagination","row-key"]),a(Be,{bordered:!1,size:"small",class:"w-1100px","content-style":{padding:"0"}},{default:o(()=>[a(ye,{style:{width:"100%"},columns:u(he),data:u(Ae),size:"small","max-height":600,loading:u(Ce),remote:"","scroll-x":u(he).reduce((P,g)=>P+(g.width||100),0),"paginate-single-page":!1,pagination:u(z),"row-key":P=>P.id},null,8,["columns","data","loading","scroll-x","pagination","row-key"])]),_:1})])]),_:1},8,["show","title"])}}}),gn=Da(mn,[["__scopeId","data-v-5fd0b7ea"]]),vn={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function fa(ae){return typeof ae=="function"||Object.prototype.toString.call(ae)==="[object Object]"&&!Ol(ae)}const hn=Lt({name:"projectmanagement_projectlist",__name:"index",setup(ae){const de=zl(),x=ga(),le=$l(),G=Ll(),{columns:d,columnChecks:s,data:ke,getData:R,loading:he,mobilePagination:Ae,searchParams:H}=Ot({showTotal:!0,apiFn:Tl,apiParams:{page:1,pageSize:20,limit:20,status:null,startAndTimeRange:null,startTime:null,endTime:null,creater:void 0,fuzzy:void 0,sort:void 0,participant:void 0,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"proname",title:"项目名称",align:"center",width:240,render:n=>a("div",{style:"display:flex;align-items:center;gap:8px;justify-content:center;"},[a("div",{class:"cursor-pointer",onClick:()=>Ue(n)},[n.proname+(n.dispatch?`(${n.dispatch})`:"")]),a(y,{size:"tiny",tertiary:!0,type:"primary",onClick:()=>qe(n.proname)},{default:()=>[v("复制")]})])},{key:"progess",title:"项目进度",align:"center",width:140,sorter:!0,render:n=>a(ca,{type:"line",showIndicator:!0,percentage:n.progess,"indicator-placement":"inside",processing:!0,color:"#1890ff"},null)},{key:"status",title:"项目状态",align:"center",width:120,defaultFilterOptionValue:null,filterOptions:dt(Vt),filter:!0,filterMultiple:!1,render:n=>{if(n.status===null)return null;const p=E(pa[n.status]);return a("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:n.status==-1?"#a27ff9":n.status===0?"#9ca3af":n.status===1?"#3b82f6":n.status===2?"#facc15":"#22c55e",borderRadius:"50%"}},[a("span",{style:{width:"10px",height:"10px",marginRight:"5px",backgroundColor:n.status==-1?"#a27ff9":n.status===0?"#9ca3af":n.status===1?"#3b82f6":n.status===2?"#facc15":"#22c55e",borderRadius:"50%"}},null),a("span",null,[p])])}},{key:"cpdbtime",title:"预计完成日期",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"plantime",title:"计划调试时间",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"period",title:"周期",align:"center",width:100,render:n=>a("div",null,[n.period,v("天")])},{key:"ptype",title:"状态",align:"center",width:80,render:n=>a(ut,{type:n.ptype===0?"success":"error"},{default:()=>[n.ptype===0?"正常":n.ptype===1?"已延期":"作废"]})},{key:"dtype",title:"调试类型",align:"center",width:100,render:n=>{if(n.dtype===null)return null;const p=E(Gl[n.dtype]);return a(ut,{type:n.dtype==0?"warning":n.dtype==1?"success":"info"},fa(p)?p:{default:()=>[p]})}},{key:"debugs",title:"统计数量信息",align:"center",width:160,render(n){const p=(Se,we,_e)=>{const Je=_e>0;return r("div",{style:`
                    cursor: ${Je?"pointer":"default"};
                    color: ${Je?"#1890ff":"#999"};
                    font-size:13px;
                  `,onClick:()=>Je&&ie(we,n)},`${Se}：${_e}`)};return r("div",{style:"display:flex; flex-direction:column; gap:1px;"},[p("调试任务","business",n.debugs),p("项目总结","projectsummary",n.summarys),p("日报数量","daylog",n.dailys)])}},{key:"businesscon",title:"商务联系人",align:"center",width:200,render(n){return a("div",null,[n.businesscon||"-"])}},{key:"dbtime",title:"创建时间",align:"left",width:200,render(n){return a("div",null,[n.dbtime||"-"])}},{key:"operate",title:E("common.operate"),align:"center",width:320,fixed:"right",render:n=>{let p;return a("div",{class:"flex justify-end gap-8px"},[a("div",{onClick:()=>Re(n),class:"cursor-pointer c-#1890ff mr-10px",title:"工程调试确认单"},[a(El,{"local-icon":"icon_resLibrary",class:"font-size-24px"},null)]),n.status==-1&&(x.userInfo.usertype==0||x.userInfo.usertype==4||x.userInfo.id==1021||x.userInfo.id==1023)&&a(Oe,{onPositiveClick:()=>ye(n,0)},{default:()=>"确定核准该项目吗？",trigger:()=>a(y,{color:"#a43cf9",ghost:!0,size:"small"},{default:()=>["核准"]})}),n.status==0&&(x.userInfo.usertype==0||x.userInfo.usertype==2)&&a(Oe,{onPositiveClick:()=>ye(n,1)},{default:()=>"确定启动该项目吗？",trigger:()=>rt(a(y,{type:"success",ghost:!0,size:"small"},{default:()=>["启动"]}),[[xt("no-auth"),"project:Info:update"]])}),n.status==2&&(x.userInfo.usertype==0||x.userInfo.usertype==2)&&a(Oe,{onPositiveClick:()=>ye(n,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>rt(a(y,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[xt("no-auth"),"project:Info:update"]])}),a(y,{type:"primary",ghost:!0,size:"small",onClick:()=>Ue(n)},{default:()=>["详情"]}),a(y,{type:"primary",ghost:!0,size:"small",onClick:()=>O(n)},{default:()=>["关联合同"]}),rt(a(y,{type:"primary",ghost:!0,size:"small",onClick:()=>Me(n.id)},fa(p=E("common.edit"))?p:{default:()=>[p]}),[[xt("no-auth"),"project:Info:update"]])])}}]}),{drawerVisible:Ce,operateType:Ie,editingData:z,handleAdd:X,handleEdit:Ne,checkedRowKeys:V,onBatchDeleted:N}=Bl(ke,R);async function ee(){console.log(V.value),P(V.value.join(","),n=>{N()})}const ye=async(n,p)=>{var _e;const{data:Se,error:we}=await Ca([{id:n.id,status:p}]);we||((_e=window.$message)==null||_e.success("操作成功"),R(),p==3&&window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:n.pid,type:"prj"}})))},Be=()=>{X(),z.value=void 0};function Me(n){Ne(n)}async function P(n,p){const{data:Se,error:we}=await Ul(n);if(!we)p&&p(Se);else return!1}const g=b(!1),h=b(0),ne=b(""),O=n=>{g.value=!0,h.value=n.id,ne.value=n.proname},se=b(!1),Re=n=>{se.value=!0,h.value=n.id},tt=n=>{H.status=n.status,R()},C=n=>{console.log(n),n.columnKey=="progess"&&(H.sort=n.order=="ascend"?0:n.order=="descend"?1:void 0,R())},U=b(1),Ve=n=>{U.value=n,n==0?R():Xe()},Ue=n=>{le.push("/projectmanagement/orderdetail?prjId="+n.id+"&pname="+n.proname),x.setProjectInfo({pid:n.id,pname:n.proname})},ie=(n,p)=>{le.push(`/projectmanagement/${n}?prjId=`+p.id+"&pname="+p.proname),x.setProjectInfo({pid:p.id,pname:p.proname})},be=()=>{R()};Pl(()=>{x.userInfo.usertype==1&&(U.value=0),G.query.pname?(U.value=0,H.fuzzy=G.query.pname,H.status=2,be(),R()):Xe()}),zt(()=>G.query.pname,n=>{n&&!G.query.prjId&&(H.fuzzy=n,U.value=0,R())});const D=[{key:"proname",width:320,title(){return a("div",{class:"font-size-16px font-bold"},[v("近期项目")])},ellipsis:{tooltip:!0},render:n=>{if(n.status===null)return null;const p=E(pa[n.status]);return a("div",null,[a(jl,{placement:"top",trigger:"hover"},{trigger:()=>a("div",{class:"cursor-pointer text-ellipsis overflow-hidden whitespace-nowrap font-bold",onClick:()=>Ue(n),style:"max-width: 300px;"},[n.proname||"-"]),default:()=>n.proname||"-"}),a("div",{style:"display:flex; gap:3px; line-height:1.4;"},[a("div",{class:" flex"},[a("span",{style:"color:#666"},[v("进度：")]),a(ca,{type:"line",style:"width: 100px;",showIndicator:!0,percentage:n.progess,"indicator-placement":"inside",processing:!0,color:n.progess==100?"#22C55E":"#1890ff"},null)]),a("div",{class:" flex ml-8px"},[a("span",{style:"color:#666 flex"},[v("状态：")]),a("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:n.status===0?"#9ca3af":n.status===1?"#3B82F6":n.status===2?"#f1c40f":"#2ecc71",borderRadius:"50%"}},[a("span",{style:{width:"10px",height:"10px",marginRight:"5px",backgroundColor:n.status===0?"#9ca3af":n.status===1?"#3B82F6":n.status===2?"#f1c40f":"#2ecc71",borderRadius:"50%"}},null),a("span",null,[p])])])])])}},{key:"businesscon",title:"商务联系人",align:"center",width:100},{title:"最后打卡人",key:"clockinusername",align:"center",width:100},{title:"最后打卡时间",key:"lastclockintime",align:"center",width:180},{key:"clockincounts",title:"打卡信息",align:"left",width:200,render(n){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("打卡人数：")]),a("span",{style:"font-weight:500"},[n.clockincounts!=null?n.clockincounts+"人":"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("打卡人：")]),a("span",{style:" font-weight:500"},[n.clockinusers||"-"])])])}},{key:"debugname",title:"调试任务信息",align:"left",width:260,render(n){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("任务名称：")]),a("span",{style:"font-weight:500"},[n.debugname||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("状态：")]),a(ut,{size:"small",color:{color:n.debugstatus==-1?"rgba(251, 146, 60, 0.15)":n.debugstatus==0?"rgba(156, 163, 175, 0.15)":n.debugstatus==1?"rgba(59, 130, 246, 0.15)":n.debugstatus==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:n.debugstatus==-1?"#FB923C":n.debugstatus==0?"#9CA3AF":n.debugstatus==1?"#3B82F6":n.debugstatus==2?"#FACC15":"#10B981",borderColor:n.debugstatus==-1?"#FB923C":n.debugstatus==0?"#9CA3AF":n.debugstatus==1?"#3B82F6":n.debugstatus==2?"#FACC15":"#10B981"}},{default:()=>[n.debugstatus==-1?"申请中":n.debugstatus==0?"待调试":n.debugstatus==1?"开始调试":n.debugstatus==2?"待审核":"审核完成"]})])])}},{key:"username",title:"调试信息",align:"left",width:230,render(n){return a("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[a("div",null,[a("span",{style:"color:#666"},[v("时间：")]),a("span",{style:" font-weight:500"},[n.dbdbtime||"-"])]),a("div",null,[a("span",{style:"color:#666"},[v("调试人：")]),a("span",{style:"font-weight:500"},[n.username||"-"])])])}},{title:"任务审核时间",key:"ckdbtime",width:180}],W=et({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20,50,100],prefix:()=>`共 ${W.itemCount} 条`,onChange:n=>{W.page=n,Xe()},onUpdatePageSize:n=>{W.pageSize=n,W.page=1,Xe()}}),ct=b([]),Xe=async()=>{const{data:n,error:p}=await Fl({page:W.page,limit:W.pageSize});p||(ct.value=n.list,W.itemCount=n.total)},qe=async n=>{var p;n&&(await navigator.clipboard.writeText(n),(p=window.$message)==null||p.success("已复制"))};return(n,p)=>{const Se=Yl,we=Nl,_e=xe,Je=Xa,F=ma,at=Ha,Pt=$t,Ft=$t,pt=Rt,ft=xt("no-auth");return T(),Ct("div",vn,[U.value==0?(T(),J(cn,{key:0,model:u(H),"onUpdate:model":p[0]||(p[0]=j=>kt(H)?H.value=j:null),onReset:be,onSearch:u(R)},null,8,["model","onSearch"])):ve("",!0),a(pt,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Al({header:o(()=>[a(_e,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>[p[7]||(p[7]=M("div",null,"项目列表",-1)),u(x).userInfo.usertype!==1?(T(),J(we,{key:0,size:"small",value:U.value,"onUpdate:value":[p[1]||(p[1]=j=>U.value=j),Ve],name:"radiobuttongroup1"},{default:o(()=>[a(Se,{value:0,label:"默认"}),a(Se,{value:1,label:"近期项目"})]),_:1},8,["value"])):ve("",!0)]),_:1,__:[7]})]),default:o(()=>[U.value==0?(T(),J(Pt,{key:0,"checked-row-keys":u(V),"onUpdate:checkedRowKeys":p[3]||(p[3]=j=>kt(V)?V.value=j:null),columns:u(d),data:u(ke),size:"small","flex-height":!u(de).isMobile,"scroll-x":u(d).reduce((j,Ge)=>j+((Ge==null?void 0:Ge.width)||100),0),loading:u(he),remote:"","row-key":j=>j.id,"onUpdate:sorter":C,pagination:u(Ae),class:"sm:h-full","onUpdate:filters":tt},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"])):(T(),J(Ft,{key:1,ref:"tableContainer",class:"sm:h-full",remote:"",pagination:W.pageSize==1?!1:W,"scroll-x":D.reduce((j,Ge)=>j+(Ge.width||100),0),columns:D,data:ct.value,bordered:!1,"flex-height":!u(de).isMobile},null,8,["pagination","scroll-x","data","flex-height"])),a(dn,{visible:u(Ce),"onUpdate:visible":p[4]||(p[4]=j=>kt(Ce)?Ce.value=j:null),onSubmitted:u(R),"operate-type":u(Ie),"row-data":u(z)},null,8,["visible","onSubmitted","operate-type","row-data"]),a(gn,{visable:g.value,"onUpdate:visable":p[5]||(p[5]=j=>g.value=j),id:h.value,pname:ne.value},null,8,["visable","id","pname"])]),_:2},[U.value==0?{name:"header-extra",fn:o(()=>[a(_e,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[rt((T(),J(u(y),{onClick:Be,size:"small",ghost:"",type:"primary"},{icon:o(()=>[a(Je,{class:"text-icon"})]),default:o(()=>[p[8]||(p[8]=v(" "+Q("新增项目")))]),_:1,__:[8]})),[[ft,"project:Info:insert"]]),a(u(Oe),{onPositiveClick:ee},{trigger:o(()=>[rt((T(),J(u(y),{size:"small",ghost:"",type:"error",disabled:u(V).length==0},{icon:o(()=>[a(F,{class:Il(["text-icon",{"animate-spin":u(he)}])},null,8,["class"])]),default:o(()=>[p[9]||(p[9]=v(" "+Q("批量删除")))]),_:1,__:[9]},8,["disabled"])),[[ft,"project:Info:delete"]])]),default:o(()=>[p[10]||(p[10]=v(" 确定要删除选中的合同吗？ "))]),_:1,__:[10]}),a(at,{columns:u(s),"onUpdate:columns":p[2]||(p[2]=j=>kt(s)?s.value=j:null),ctype:2},null,8,["columns"])]),_:1})]),key:"0"}:void 0]),1024),a(Wl,{visible:se.value,"onUpdate:visible":p[6]||(p[6]=j=>se.value=j),pid:h.value},null,8,["visible","pid"])])}}}),Bn=Da(hn,[["__scopeId","data-v-cf21ebe0"]]);export{Bn as default};
