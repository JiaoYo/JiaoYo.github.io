import{d as F,k as M,b as Q,bP as de,bQ as ue,ab as j,o as B,e as K,t as g,ag as pe,bR as fe,c as J,w as t,g as o,f as I,ae as me,a4 as _e,i as ee,ap as ge,ao as he,a6 as te,af as ve,j as we,_ as X,q as be,a0 as Y,bS as se,bT as $,ai as ye,x as xe,aj as Se,r as De,y as Ce,H as ke,az as ae,aA as Te,aB as $e,aC as Me,h as w,at as Ne,aw as R,ax as Pe,S as Ae,ak as Ie,P as Oe,R as We,T as Be}from"./index-BNQCbnTn.js";import{_ as oe,a as ne}from"./Grid-De6oOoO-.js";import{u as le,L as z}from"./echarts-C0Qbz3VR.js";import{h as Le}from"./permission-BBVT8aIF.js";import{G as ze,h as Ee,a as Ge,b as Ve}from"./metar-TmYfHM-E.js";import{_ as He,a as Re}from"./DescriptionsItem-C3T1MOnf.js";const je="/assets/station-GwqcmkHc.jpeg",Fe=F({name:"CountTo",__name:"count-to",props:{startValue:{default:0},endValue:{default:2021},duration:{default:1500},autoplay:{type:Boolean,default:!0},decimals:{default:0},prefix:{default:""},suffix:{default:""},separator:{default:","},decimal:{default:"."},useEasing:{type:Boolean,default:!0},transition:{default:"linear"}},setup(C){const a=C,k=M(a.startValue),c=Q(()=>a.useEasing?de[a.transition]:void 0),N=ue(k,{disabled:!1,duration:a.duration,transition:c.value}),f=Q(()=>_(N.value));function _(p){const{decimals:b,decimal:y,separator:S,suffix:n,prefix:e}=a;let l=p.toFixed(b);l=String(l);const s=l.split(".");let i=s[0];const T=s.length>1?y+s[1]:"",O=/(\d+)(\d{3})/;if(S)for(;O.test(i);)i=i.replace(O,`$1${S}$2`);return e+i+T+n}async function P(){await pe(),k.value=a.endValue}return j([()=>a.startValue,()=>a.endValue],()=>{a.autoplay&&P()},{immediate:!0}),(p,b)=>(B(),K("span",null,g(f.value),1))}}),Ue={class:"ml-20px"},qe={class:"text-14px"},Je=F({name:"CardData",__name:"card-data",props:{MeteorologicalData:{type:Object}},setup(C){const a=C,k=Q(()=>{var _,P,p,b,y,S;return[{key:"envT",title:"温度",value:((_=a.MeteorologicalData)==null?void 0:_.envT)||0,unit:"℃",color:{start:"#fdd819",end:"#e80505"},icon:"carbon:temperature-celsius"},{key:"envH",title:"湿度",value:((P=a.MeteorologicalData)==null?void 0:P.envH)||0,unit:"%",color:{start:"#97abff",end:"#123597"},icon:"lets-icons:humidity"},{key:"qy",title:"气压",value:((p=a.MeteorologicalData)==null?void 0:p.qy)||0,unit:"hPa",color:{start:"#70f570",end:"#49c628"},icon:"mdi:car-brake-low-pressure"},{key:"windS",title:"风速",value:((b=a.MeteorologicalData)==null?void 0:b.windS)||0,unit:"m/s",color:{start:"#ffe985",end:"#fa742b"},icon:"hugeicons:slow-winds"},{key:"windD",title:"风向",value:((y=a.MeteorologicalData)==null?void 0:y.windD)||0,unit:"°",color:{start:"#bbd2c5",end:"#536976"},icon:"mdi:windsock"},{key:"zfsdCount",title:"总辐射",value:((S=a.MeteorologicalData)==null?void 0:S.zfsd)||0,unit:"W/㎡",color:{start:"#ce9ffc",end:"#7367f0"},icon:"material-symbols:clear-day-rounded"}]}),[c,N]=fe();function f(_){return`linear-gradient(to bottom right, ${_.start}, ${_.end})`}return(_,P)=>{const p=we,b=Fe,y=ne,S=oe,n=te;return B(),J(n,{bordered:!1,size:"small",class:"card-wrapper h-100%","content-style":{padding:"20px 12px",display:"flex",flexDirection:"column",justifyContent:"center"}},{default:t(()=>[o(ee(c),null,{default:t(({$slots:e,gradientColor:l})=>[I("div",{class:"rd-8px pl-15px pb-4px pt-8px text-white",style:_e({backgroundImage:l})},[(B(),J(me(e.default)))],4)]),_:1}),o(S,{cols:"s:1 m:1 l:2",responsive:"screen","x-gap":10,"y-gap":12},{default:t(()=>[(B(!0),K(he,null,ge(k.value,(e,l)=>(B(),J(y,{key:e.key,class:ve("animated-fade-up-"+l)},{default:t(()=>[o(ee(N),{"gradient-color":f(e.color),class:"flex-1 flex items-center h-100%",style:{"max-height":"75px !important"}},{default:t(()=>[o(p,{icon:e.icon,class:"text-32px"},null,8,["icon"]),I("div",Ue,[I("h3",qe,g(e.title),1),o(b,{suffix:e.unit,decimals:1,"start-value":1,"end-value":e.value,class:"text-16px text-white dark:text-dark"},null,8,["suffix","end-value"])])]),_:2},1032,["gradient-color"])]),_:2},1032,["class"]))),128))]),_:1})]),_:1})}}}),Qe=X(Je,[["__scopeId","data-v-5da89340"]]),Ke=F({name:"LineChart",__name:"line-chart",props:{data:{required:!0},dataModifiers:{}},emits:["update:data"],setup(C){const a=["rgb(233, 4, 69)","rgb(0, 150, 136)","rgb(59, 66, 146)","rgb(255, 99, 71)"],k=["实际功率","预测功率","实际辐射","预测辐射"],c=be(C,"data"),N=Y(),f=Date.now(),_=new Date(f).setHours(23,59,59,999),{domRef:P,updateOptions:p,updateOptionsAsync:b}=le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function(e){var O;const s=(Array.isArray(e)?e:[e]).filter(m=>{var W;return((W=m==null?void 0:m.value)==null?void 0:W[1])!=null&&(m==null?void 0:m.seriesName)});if(s.length===0)return"";let T=`${((O=s[0])==null?void 0:O.axisValueLabel)||""}<br/>`;return s.forEach((m,W)=>{const V=W<2?" MW":" W/m²";T+=`
          <span class="round" style="background-color: ${a[k.indexOf(m.seriesName)]||"#ccc"}"></span>
          ${m.seriesName}: ${se(m.value[1],V)}<br/>
        `}),T},backgroundColor:"#6a7985",textStyle:{color:"#d3d6dd"}},legend:{data:["实际功率","预测功率","实际辐射","预测辐射"]},grid:{left:"2%",right:"5%",bottom:"0%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd} {HH}:{mm}"},max:_+60*1e3,data:[]},yAxis:[{name:"功率MW",type:"value",axisLabel:{formatter:"{value} MW"}},{name:"辐射W/m²",type:"value",axisLabel:{formatter:"{value} W/m²"},alignTicks:!0}],series:[{color:a[0],name:"实际功率",type:"line",emphasis:{focus:"series"},yAxisIndex:0,lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new z(0,0,0,1,[{offset:0,color:$(a[0],.3)},{offset:1,color:$(a[0],0)}],!1),shadowColor:$(a[0],.9),shadowBlur:20},data:[],connectNulls:!0},{color:a[1],name:"预测功率",type:"line",yAxisIndex:0,emphasis:{focus:"series"},lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new z(0,0,0,1,[{offset:0,color:$(a[1],.3)},{offset:1,color:$(a[1],0)}],!1),shadowColor:$(a[1],.9),shadowBlur:20},data:[],connectNulls:!0},{color:a[2],name:"实际辐射",type:"line",showSymbol:!1,yAxisIndex:1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new z(0,0,0,1,[{offset:0,color:$(a[2],.3)},{offset:1,color:$(a[2],0)}],!1),shadowColor:$(a[2],.7),shadowBlur:20},data:[],connectNulls:!0},{color:a[3],name:"预测辐射",type:"line",yAxisIndex:1,showSymbol:!1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new z(0,0,0,1,[{offset:0,color:$(a[3],.3)},{offset:1,color:$(a[3],0)}],!1),shadowColor:$(a[3],.7),shadowBlur:20},data:[],connectNulls:!0}]}));async function y(){await new Promise(e=>{setTimeout(e,1e3)}),p(e=>{if(c.value){const l=c.value.map(s=>({dbtime:s.dbtime,prePower:s.prePower,power:s.power,zfsd:s.zfsd,ssrd:s.ssrd}));e.xAxis.data=l.map(s=>s.dbtime),e.series[0].data=l.map(s=>[s.dbtime,s.power]),e.series[1].data=l.map(s=>[s.dbtime,s.prePower]),e.series[2].data=l.map(s=>[s.dbtime,s.zfsd]),e.series[3].data=l.map(s=>[s.dbtime,s.ssrd])}return e})}j(()=>c.value,e=>{b(l=>{if(c.value){const s=c.value.map(i=>({dbtime:i.dbtime,prePower:i.prePower,power:i.power,zfsd:i.zfsd,ssrd:i.ssrd}));l.xAxis.data=s.map(i=>i.dbtime),l.series[0].data=s.map(i=>[i.dbtime,i.power]),l.series[1].data=s.map(i=>[i.dbtime,i.prePower]),l.series[2].data=s.map(i=>[i.dbtime,i.zfsd]),l.series[3].data=s.map(i=>[i.dbtime,i.ssrd])}return l})});function S(){p((e,l)=>{const s=l();return e.legend.data=s.legend.data,e.series[0].name=s.series[0].name,e.series[1].name=s.series[1].name,e})}async function n(){y()}return j(()=>N.locale,()=>{S()}),n(),(e,l)=>(B(),K("div",{ref_key:"domRef",ref:P,class:"h-100% overflow-hidden"},null,512))}}),Xe=X(Ke,[["__scopeId","data-v-12a9edea"]]),Ye=F({name:"LineChart",__name:"weather-chart",props:{data:{type:Array,default:[]}},setup(C){const a=C,k=Y(),c=Date.now(),N=new Date(c).setHours(23,59,59,999),{domRef:f,updateOptions:_,showLoading:P,updateOptionsAsync:p}=le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(n){return se(n,"°C")},backgroundColor:"#6a7985",textStyle:{color:"#fff"}},legend:{data:["环境温度","预测温度","组件温度"]},grid:{left:"2%",right:"5%",bottom:"10%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd} {HH}:{mm}"},max:N+60*1e3,data:[]},yAxis:{name:"温度(°C)",type:"value",axisLabel:{formatter:"{value} °C"}},series:[{color:"#27ae60",name:"环境温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new z(0,0,0,1,[{offset:0,color:"rgba(39, 174, 96,0.4)"},{offset:1,color:"rgba(39, 174, 96,0)"}],!1),shadowColor:"rgba(39, 174, 96,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#c0392b",name:"预测温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new z(0,0,0,1,[{offset:0,color:"rgba(192, 57, 43,0.3)"},{offset:1,color:"rgba(192, 57, 43,0)"}],!1),shadowColor:"rgba(192, 57, 43,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#ffa000",name:"组件温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new z(0,0,0,1,[{offset:0,color:"rgba(255, 160, 0,0.3)"},{offset:1,color:"rgba(255, 160, 0,0)"}],!1),shadowColor:"rgba(255, 160, 0,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0}]}));async function b(){await new Promise(n=>{setTimeout(n,1e3)}),_(n=>(a.data&&(n.xAxis.data=a.data.map(e=>e.dbtime),n.series[0].data=a.data.map(e=>[e.dbtime,e.envT]),n.series[1].data=a.data.map(e=>[e.dbtime,e.tt2]),n.series[2].data=a.data.map(e=>[e.dbtime,e.moduleT])),n))}function y(){_((n,e)=>{const l=e();return n.legend.data=l.legend.data,n.series[0].name=l.series[0].name,n.series[1].name=l.series[1].name,n.series[2].name=l.series[2].name,n})}async function S(){b()}return j(()=>k.locale,()=>{y()}),j(()=>a.data,()=>{p(n=>(a.data&&(n.xAxis.data=a.data.map(e=>e.dbtime),n.series[0].data=a.data.map(e=>[e.dbtime,e.envT]),n.series[1].data=a.data.map(e=>[e.dbtime,e.tt2]),n.series[2].data=a.data.map(e=>[e.dbtime,e.moduleT])),n))}),S(),(n,e)=>(B(),K("div",{ref_key:"domRef",ref:f,style:{height:"260px",overflow:"hidden"}},null,512))}}),Ze=X(Ye,[["__scopeId","data-v-27d01d4a"]]),re=C=>(We("data-v-efbc86dd"),C=C(),Be(),C),ea=re(()=>I("img",{src:je,alt:"",style:{height:"140px",width:"100%","margin-bottom":"20px"}},null,-1)),aa={class:"flex items-center"},ta=re(()=>I("div",{class:"w-80px font-size-14px text-right"},"气象站：",-1)),sa=F({name:"home",__name:"index",setup(C){ye();const a=Y(),k=Q(()=>a.isMobile?0:16),c=M({stationP:0}),N=async()=>{const{data:u,error:h}=await Ne();h||(c.value=u)},f=M(),_=M(),P=async()=>{var r;const{data:u,error:h}=await ze();h||(_.value=u,_.value.length!=0&&(p.value=(r=u[0])==null?void 0:r.id,y()))},p=M(),b=M(),y=async()=>{const{data:u,error:h}=await Ee({devId:p.value});h||(b.value=u)},S=u=>{p.value=u,y(),W()},n=Date.now(),e=new Date(n).setHours(0,0,0,0),l=new Date(n).setHours(23,59,59,999),s=M(),i=async()=>{const{data:u,error:h}=await Ge({startTime:R(1,e),endTime:R(1,l),page:1,limit:100});h||(s.value=JSON.parse(JSON.stringify(u)).list)},T=M(),O=async()=>{const{data:u,error:h}=await Pe({date:R(0,Date.now())});h||(T.value=u,T.value.forEach(r=>(s.value.forEach(v=>{r.dbtime==v.dbtime&&(r.ssrd=v.ssrd)}),r)),m.value.forEach(r=>{const v=T.value.find(L=>L.dbtime===r.dbtime);v?Object.assign(v,r):T.value.push(r)}),T.value=T.value.sort((r,v)=>new Date(r.dbtime).getTime()-new Date(v.dbtime).getTime()))},m=M(),W=async()=>{if(!p.value)return;const{data:u,error:h}=await Ve({id:p.value,startTime:R(0,Date.now())+" 00:00:00",endTime:R(1,Date.now())});console.log("气象实际数据",u),m.value=u,s.value.forEach(r=>{const v=m.value.find(L=>L.dbtime===r.dbtime);v?Object.assign(v,r):m.value.push(r)}),m.value=m.value.sort((r,v)=>new Date(r.dbtime).getTime()-new Date(v.dbtime).getTime())},V=M(null);xe(async()=>{ie(),await P(),await N(),await i(),await W(),await O(),V.value=setInterval(async()=>{await y(),await N(),await i(),await W(),await O()},1e3*60*1)}),Se(()=>{V.value&&clearInterval(V.value),U.value&&U.value.close()});const E=De({col:"",trs:""}),U=M(null),ie=()=>{var A,G,q;if((A=U.value)==null||A.close(),!Le("channel:status:websocket")){(G=window.$message)==null||G.destroyAll(),(q=window.$message)==null||q.warning("暂无权限连接websocket");return}const u=new Date().getTime(),h=Ce(),r=ke(`${h}${u}getchlstatus`),v=ae(r),L=ae("getchlstatus"),D=new Te($e+`/ChannelStatusWebsocket/${L}/${v}/${u}/${h}?token=${Me()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});U.value=D,D.connect(),D.onclose(()=>{}),D.onerror(()=>{}),D.onopen(()=>{}),D.onmessage(H=>{if(console.log(H,"通道状态websocket接受数据"),!ce(H.data))return;const d=JSON.parse(H.data).dataStatus;d&&(E.col=d.col+""=="0"||d.col+""=="1"?d.col+"":"",E.trs=d.trs+""=="0"||d.trs+""=="1"?d.trs+"":"")})},ce=u=>{try{return JSON.parse(u),!0}catch{return!1}};return(u,h)=>{const r=He,v=Re,L=Ae,D=te,A=ne,G=oe,q=Ie,H=Oe;return B(),J(H,{vertical:"",size:16,class:"h-100% home","item-style":{height:"100%"}},{default:t(()=>[o(G,{"y-gap":k.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:t(()=>[o(A,{span:"24 s:24 m:24"},{default:t(()=>[o(D,{title:"",bordered:!1,class:"card-wrapper h-100% bg-transparent","content-style":{padding:"0px"}},{default:t(()=>[o(G,{"x-gap":k.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:t(()=>[o(A,{span:"24 s:24 m:6"},{default:t(()=>[o(D,{title:"电场实时数据",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"12px"},"content-style":{padding:"12px",paddingTop:"0px",display:"flex",flexDirection:"column"}},{"header-extra":t(()=>[w(" 运行状态："+g(c.value.stationP&&c.value.stationP>0&&c.value.stationControlled==0?"并网运行":c.value.stationP&&c.value.stationP>0&&c.value.stationControlled==1?"降额运行":c.value.stationP==0?"待机":""),1)]),default:t(()=>[ea,o(L,{trigger:"none"},{default:t(()=>[o(v,{bordered:"",column:1,"label-placement":"left",size:"small",class:"flex-1","content-style":{minWidth:"100px"}},{default:t(()=>[o(r,null,{label:t(()=>[w(" 最后更新时间 ")]),default:t(()=>[w(" "+g(c.value.dbtime||"-"),1)]),_:1}),o(r,null,{label:t(()=>{var d,x;return[w(" 总有功功率"+g((d=f.value)!=null&&d.StationP?` (${(x=f.value)==null?void 0:x.StationP})`:"(MW)"),1)]}),default:t(()=>[w(" "+g(c.value.stationP??"-"),1)]),_:1}),o(r,null,{label:t(()=>{var d,x;return[w(" 总无功功率"+g((d=f.value)!=null&&d.StationQ?` (${(x=f.value)==null?void 0:x.StationQ})`:"(MVar)"),1)]}),default:t(()=>[w(" "+g(c.value.stationQ??"-"),1)]),_:1}),o(r,null,{label:t(()=>{var d,x,Z;return[w(" 总功率因数"+g(((d=f.value)==null?void 0:d.StationCOS)=="-"?"":(x=f.value)!=null&&x.StationCOS?`
                        (${(Z=f.value)==null?void 0:Z.StationCOS})`:""),1)]}),default:t(()=>[w(" "+g(c.value.stationCOS??"-"),1)]),_:1}),o(r,null,{label:t(()=>{var d,x;return[w(" 日发电量"+g((d=f.value)!=null&&d.StationDayE?` (${(x=f.value)==null?void 0:x.StationDayE})`:"(MWh)"),1)]}),default:t(()=>[w(" "+g(c.value.stationDayE??"-"),1)]),_:1}),o(r,null,{label:t(()=>{var d,x;return[w(" 总发电量"+g((d=f.value)!=null&&d.StationTotalE?` (${(x=f.value)==null?void 0:x.StationTotalE})`:"(MWh)"),1)]}),default:t(()=>[w(" "+g(c.value.stationTotalE??"-"),1)]),_:1}),o(r,null,{label:t(()=>[w(" 是否限电 ")]),default:t(()=>[I("span",null,g(c.value.stationControlled==1?"是":"否"),1)]),_:1}),o(r,null,{label:t(()=>[w(" 数据接入状态 ")]),default:t(()=>[I("span",null,g(E.col=="0"?"🟢":E.col=="1"?"🔴":"⚪"),1)]),_:1}),o(r,null,{label:t(()=>[w(" 数据上报状态 ")]),default:t(()=>[I("span",null,g(E.trs=="0"?"🟢":E.trs=="1"?"🔴":"⚪"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(A,{span:"24 s:24 m:18"},{default:t(()=>[o(D,{title:"今日预测功率",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"10px",paddingTop:"0px"}},{default:t(()=>[o(Xe,{data:T.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1}),o(A,{span:"24 s:24 m:24"},{default:t(()=>[o(D,{title:"",bordered:!0,class:"card-wrapper h-100%","content-style":{padding:"0px"}},{default:t(()=>[o(G,{"x-gap":k.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:t(()=>[o(A,{span:"24 s:24 m:6"},{default:t(()=>[o(D,{title:"气象数据",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"12px",paddingBottom:"0px"},"content-style":{padding:"0px"}},{"header-extra":t(()=>[I("div",aa,[ta,o(q,{filterable:"",placeholder:"请选择气象站",value:p.value,"onUpdate:value":h[0]||(h[0]=d=>p.value=d),options:_.value,"label-field":"sname","value-field":"id",style:{width:"140px"},onUpdateValue:S},null,8,["value","options"])])]),default:t(()=>[o(Qe,{MeteorologicalData:b.value},null,8,["MeteorologicalData"])]),_:1})]),_:1}),o(A,{span:"24 s:24 m:18"},{default:t(()=>[o(D,{title:"今日实时气象",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"0px",paddingTop:"0px"}},{default:t(()=>[o(Ze,{data:m.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1})]),_:1},8,["y-gap"])]),_:1})}}}),da=X(sa,[["__scopeId","data-v-efbc86dd"]]);export{da as default};
