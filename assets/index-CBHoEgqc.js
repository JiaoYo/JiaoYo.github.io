import{_ as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BifTwrmi.js";import{d as Q,q as E,x as Y,s as Z,v as me,b as fe,r as _e,ag as ge,F as I,o as J,c as ee,w as n,g as e,h as H,t as F,i as o,$ as f,H as te,G as O,L as ae,M as he,a1 as oe,Q as ne,B as G,P as le,ah as ye,ai as ve,D as be,af as se,a5 as we,aC as Se,ax as De,j as W,e as xe,aj as j,ak as Ce,al as ke,S as Te,at as Ne,U as Me}from"./index-CMYYrBkk.js";import{u as ze,a as Ue}from"./table-BuckZeDa.js";import{r as re,s as ce,t as Re,u as Pe,v as Le,w as $e}from"./Collection-CvwyU13V.js";import{u as K}from"./usePageData-CMg88TkU.js";import{_ as Ae}from"./round-search-ClFi9Zus.js";import{_ as Be}from"./round-refresh-Dpbi0W29.js";import{_ as He}from"./lodash-CI5YquUK.js";import{_ as Fe}from"./FormItemGridItem-BOTHt4p0.js";import{_ as Ve}from"./Grid-CzH0335I.js";import{h as X}from"./permission-BAmJvwl4.js";import{_ as je}from"./Popconfirm-DWdKhYPV.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-S8f8P1LL.js";import"./setting-outlined-CSeh-oYh.js";import"./export-CDi1O_5Z.js";import"./refresh-Cy0vs_-o.js";import"./round-delete-wYUGKRY1.js";import"./round-plus-BDiwrNS9.js";import"./Upload-DRQmq4gc.js";import"./Progress-vsCufhmZ.js";const Ie=Q({name:"OperateDrawer",__name:"operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(_,{emit:U}){const u=_,b=U,g=Y(_,"visible"),{formRef:s,validate:C,restoreValidation:R}=Z(),{createConfirmPwdRule:k,defaultRequiredRule:P,patternRules:T}=me(),N=fe(()=>({add:"新增日志源设备",edit:"编辑日志源设备"})[u.operateType]),r=_e(M());function M(){return{id:void 0,manu:null,category:null,type:"",sysparam:void 0,ldesc:""}}const L={type:P,category:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源类别"},manu:{type:"number",required:!0,trigger:["blur","change"],message:"请选择厂商"}},{pageData:p,getData:x,nextPage:$}=K(re),V=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&p.data.length<p.total&&$()},{pageData:w,getData:d,nextPage:c}=K(ce),A=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&w.data.length<w.total&&c()};function S(){x(),d(),Object.assign(r,M()),u.operateType==="edit"&&u.rowData&&Object.assign(r,u.rowData)}function h(){g.value=!1}async function l(){var a,t;if(await C(),u.operateType==="add"){const{data:D,error:m}=await Re([r]);m||((a=window.$message)==null||a.success(f("common.addSuccess")),h(),b("submitted"))}else{const{data:D,error:m}=await Pe([r]);m||((t=window.$message)==null||t.success(f("common.updateSuccess")),h(),b("submitted"))}}return ge(g,()=>{g.value&&(S(),R())}),(a,t)=>{const D=ae,m=he,z=oe,B=ne,i=G,y=le,ie=ye,ue=ve,de=I("no-space");return J(),ee(ue,{show:g.value,"onUpdate:show":t[4]||(t[4]=v=>g.value=v),"display-directive":"show",width:360},{default:n(()=>[e(ie,{title:N.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(y,{size:16},{default:n(()=>[e(i,{onClick:h},{default:n(()=>[H(F(o(f)("common.cancel")),1)]),_:1}),e(i,{type:"primary",onClick:l},{default:n(()=>[H(F(o(f)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(B,{ref_key:"formRef",ref:s,model:r,rules:L,onKeyup:te(l,["entep"])},{default:n(()=>[e(m,{label:"日志源类型",path:"type"},{default:n(()=>[O(e(D,{clearable:"",value:r.type,"onUpdate:value":t[0]||(t[0]=v=>r.type=v),placeholder:"请输入日志源类型"},null,8,["value"]),[[de]])]),_:1}),e(m,{label:"日志源类别",path:"category"},{default:n(()=>[e(z,{clearable:"",filterable:"",value:r.category,"onUpdate:value":t[1]||(t[1]=v=>r.category=v),placeholder:"请选择日志源类别",options:o(p).data,"reset-menu-on-options-change":!1,onScroll:V,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"厂商",path:"manu"},{default:n(()=>[e(z,{clearable:"",filterable:"",value:r.manu,"onUpdate:value":t[2]||(t[2]=v=>r.manu=v),placeholder:"请选择厂商",options:o(w).data,"value-field":"id","label-field":"mname",onScroll:A,"reset-menu-on-options-change":!1,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"描述",path:"ldesc"},{default:n(()=>[e(D,{type:"textarea",value:r.ldesc,"onUpdate:value":t[3]||(t[3]=v=>r.ldesc=v),placeholder:"请输入备注",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Oe=Q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(_,{emit:U}){const u=U,{formRef:b,restoreValidation:g}=Z(),s=Y(_,"model");function C(d){s.value.category=d,u("search")}function R(d){s.value.manu=d,u("search")}function k(){s.value.fuzzy="",u("search")}async function P(){s.value.fuzzy=null,s.value.category=null,s.value.manu=null,u("search")}async function T(){u("search")}const N=He.throttle(T,1e3,{trailing:!1}),{pageData:r,getData:M,nextPage:L}=K(re),p=async d=>{const c=d.currentTarget;c.scrollTop+c.offsetHeight>=c.scrollHeight&&r.data.length<r.total&&L()},{pageData:x,getData:$,nextPage:V}=K(ce),w=async d=>{const c=d.currentTarget;c.scrollTop+c.offsetHeight>=c.scrollHeight&&x.data.length<x.total&&V()};return be(()=>{M(),$()}),(d,c)=>{const A=ae,S=Fe,h=oe,l=Be,a=G,t=Ae,D=le,m=Ve,z=ne,B=se,i=I("no-space");return J(),ee(B,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(z,{ref_key:"formRef",ref:b,model:s.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(o(N),["enter"])},{default:n(()=>[e(m,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[e(S,{span:"24 s:12 m:8 l:6",label:"日志源类型",path:"fuzzy"},{default:n(()=>[O(e(A,{clearable:"",value:s.value.fuzzy,"onUpdate:value":c[0]||(c[0]=y=>s.value.fuzzy=y),placeholder:"请输入日志源类型关键字",onClear:k},null,8,["value"]),[[i]])]),_:1}),e(S,{span:"24 s:12 m:8 l:6",label:"厂商",path:"manu"},{default:n(()=>[e(h,{clearable:"",filterable:"",value:s.value.manu,"onUpdate:value":c[1]||(c[1]=y=>s.value.manu=y),placeholder:"请选择厂商",options:o(x).data,"value-field":"id","label-field":"mname",onScroll:w,onUpdateValue:R,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(S,{span:"24 s:12 m:8 l:6",label:"日志源类别",path:"category"},{default:n(()=>[e(h,{clearable:"",filterable:"",value:s.value.category,"onUpdate:value":c[2]||(c[2]=y=>s.value.category=y),placeholder:"请选择日志源类别",options:o(r).data,onScroll:p,onUpdateValue:C,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(S,{span:"24  s:12 m:8 l:6"},{default:n(()=>[e(D,{class:"w-full"},{default:n(()=>[e(a,{onClick:P},{icon:n(()=>[e(l,{class:"text-icon"})]),default:n(()=>[H(" "+F(o(f)("common.reset")),1)]),_:1}),e(a,{type:"primary",ghost:"",onClick:o(N)},{icon:n(()=>[e(t,{class:"text-icon"})]),default:n(()=>[H(" "+F(o(f)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Ge={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function q(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!Ce(_)}const Ke=Q({name:"collectionmanagement_logsource",__name:"index",setup(_){const U=we(),{columns:u,columnChecks:b,data:g,getData:s,loading:C,mobilePagination:R,searchParams:k,resetSearchParams:P}=ze({apiFn:Le,apiParams:{page:1,pageSize:20,limit:20,fuzzy:void 0,category:void 0,manu:void 0,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48,disabled(l){return l.sysparam!==1}},{key:"mname",title:"厂商",align:"center",width:240},{key:"cname",title:"日志源类别",align:"center",width:240},{key:"type",title:"日志源类型",align:"center",width:240},{key:"ldesc",title:"描述",align:"center",width:500,render:l=>e("span",{class:"text-ellipsis",onClick:()=>{w.value=l.ldesc,d.value=!0},style:{display:"block",width:"100%"}},[l.ldesc])},{key:"sysparam",title:"系统内置",align:"center",width:120,render:l=>{const a={0:"success",1:"info"},t=f(Se[l.sysparam]);return e(De,{size:"small",type:a[l.sysparam]},q(t)?t:{default:()=>[t]})}},{key:"operate",title:f("common.operate"),align:"center",width:130,render:l=>{let a;return l.sysparam==1&&e("div",{class:"flex-center gap-8px"},[O(e(G,{type:"primary",ghost:!0,size:"small",onClick:()=>S(l.id)},q(a=f("common.edit"))?a:{default:()=>[a]}),[[I("no-auth"),"sys.log.source.device.update"]]),e(je,{onPositiveClick:()=>A(l.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let t;return O(e(G,{type:"error",ghost:!0,size:"small"},q(t=f("common.delete"))?t:{default:()=>[t]}),[[I("no-auth"),"sys.log.source.device.delete"]])}})])}}]}),{drawerVisible:T,operateType:N,editingData:r,handleAdd:M,handleEdit:L,checkedRowKeys:p,onBatchDeleted:x,onDeleted:$,closeDrawer:V}=Ue(g,s),w=W(""),d=W(!1);async function c(){console.log(p.value),h(p.value.join(","),l=>{x()})}function A(l){console.log(l),h(l,a=>{$()})}function S(l){L(l)}async function h(l,a){const t=await $e(l);a&&a(t)}return(l,a)=>{const t=pe,D=ke,m=Te,z=Ne,B=se;return J(),xe("div",Ge,[e(Oe,{model:o(k),"onUpdate:model":a[0]||(a[0]=i=>j(k)?k.value=i:null),onReset:o(P),onSearch:o(s)},null,8,["model","onReset","onSearch"]),e(B,{title:"日志源设备",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":n(()=>[e(t,{columns:o(b),"onUpdate:columns":a[1]||(a[1]=i=>j(b)?b.value=i:null),"disabled-delete":o(p).length===0,"is-view-add-button":o(X)("sys.log.source.device.insert"),"is-view-delete-button":o(X)("sys.log.source.device.delete"),loading:o(C),onAdd:o(M),onDelete:c,onRefresh:o(s)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:n(()=>[e(D,{"checked-row-keys":o(p),"onUpdate:checkedRowKeys":a[2]||(a[2]=i=>j(p)?p.value=i:null),columns:o(u),data:o(g),size:"small","flex-height":!o(U).isMobile,"scroll-x":o(u).reduce((i,y)=>i+y.width,0),loading:o(C),remote:"","row-key":i=>i.id,pagination:o(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(Ie,{visible:o(T),"onUpdate:visible":a[3]||(a[3]=i=>j(T)?T.value=i:null),"operate-type":o(N),"row-data":o(r),onSubmitted:o(s)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(z,{show:d.value,"onUpdate:show":a[4]||(a[4]=i=>d.value=i),title:"描述",preset:"card",class:"w-600px"},{default:n(()=>[e(m,{style:{"max-height":"300px"}},{default:n(()=>[H(F(w.value),1)]),_:1})]),_:1},8,["show"])]),_:1})])}}}),pt=Me(Ke,[["__scopeId","data-v-dd0c97f3"]]);export{pt as default};
