import{_ as pe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-D1o13Poa.js";import{_ as me}from"./round-delete-Qxi4-YfP.js";import{_ as fe}from"./round-add-DIQX2VHZ.js";import{d as Y,aq as Q,s as _e,r as X,q as oe,a as ge,ar as le,a1 as he,c as j,o as m,w as l,f as t,b5 as ve,F as ne,h as n,at as se,A as D,b as O,g as d,e as V,t as C,B as y,N as Z,$ as T,b6 as ye,E as we,U as re,L as be,i as ke,x as W,az as K,av as Ce,C as A,bl as xe,W as Ne,aC as De}from"./index-MLngovgS.js";import{f as ie,a as je,H as Se,I as qe,J as ee,K as Pe}from"./project-B7XGT2Pj.js";import{u as Te,a as Ue}from"./table-DY0a9Bsw.js";import{u as ue}from"./usePageData-B8j6jfcp.js";import{_ as ce}from"./Grid-DRltn4al.js";import{_ as de}from"./FormItemGridItem-BNj96i67.js";import{N as ze}from"./Upload-ByRK6-y2.js";import{_ as $e}from"./round-search-DcOVZFj4.js";import{N as te}from"./Popconfirm-CbE2CvCd.js";import"./Progress-B8OPWamn.js";import"./utils-DBMXlWXq.js";const Re={key:0},Fe={key:0},Be={key:0},Me={key:0},Le=Y({name:"OperateDrawer",__name:"operate-drawer",props:Q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(b,{emit:$}){const S=$,h=b,a=_e(w()),p=X();function w(){return{pid:void 0,id:"",reqcontent:"",customer:"",cstcontact:"",notes:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const x=X([]),{pageData:f,getData:q,nextPage:R}=ue(ie),G=async o=>{const e=o.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&f.data.length<f.total&&(R(),x.value=f.data)},U=async()=>{var o;await q(),x.value=f.data,a.pid=(o=x.value[0])==null?void 0:o.id},v=async o=>{a.pid=o};async function c(){U(),Object.assign(a,w()),h.operateType==="edit"&&h.rowData&&Object.assign(a,h.rowData)}const{formRef:F,validate:z,restoreValidation:B}=oe(),M={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},reqcontent:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},customer:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},cstcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},L=ge(()=>({add:"新增需求变更",edit:"修改需求变更"})[h.operateType]),k=le(b,"visible");he(k,()=>{k.value&&(c(),setTimeout(()=>{const o=document.querySelector(".n-scrollbar-content");o==null||o.scrollTo(0,0)},300),B())});async function N({file:o},e){let u=new FormData;u.append("multipartFile",o.file);const{data:_,error:I}=await je(u);I||(a[e]=_)}function P(){k.value=!1}async function i(){var o,e;if(await z(),h.operateType==="edit"){const{data:u,error:_}=await Se([a]);_||(P(),S("submitted"),(o=window.$message)==null||o.success("修改成功"))}else{const{data:u,error:_}=await qe([{...a}]);_||(P(),S("submitted"),(e=window.$message)==null||e.success("添加成功"))}}return(o,e)=>{const u=de,_=ze,I=ce,E=ne,J=ve,H=Z,g=ye;return m(),j(g,{show:k.value,"onUpdate:show":e[13]||(e[13]=s=>k.value=s),title:L.value,preset:"card",class:"w-800px"},{footer:l(()=>[t(H,{justify:"end",size:16},{default:l(()=>[t(n(y),{onClick:P},{default:l(()=>[d(C(n(T)("common.cancel")),1)]),_:1}),t(n(y),{type:"primary",onClick:i},{default:l(()=>[d(C(n(T)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[t(J,{class:"pr-20px"},{default:l(()=>[t(E,{ref_key:"formRef",ref:F,model:a,rules:M,"label-placement":"left","label-width":120},{default:l(()=>[t(I,{responsive:"screen","item-responsive":""},{default:l(()=>[t(u,{span:"24 m:12",label:"项目列表",path:"PrjId"},{default:l(()=>[t(n(se),{clearable:"",filterable:"",value:p.value,"onUpdate:value":[e[0]||(e[0]=s=>p.value=s),v],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:x.value,onScroll:G},null,8,["value","options"])]),_:1}),t(u,{span:"24 m:12",label:"需求内容",path:"reqcontent"},{default:l(()=>[t(n(D),{value:a.reqcontent,"onUpdate:value":e[1]||(e[1]=s=>a.reqcontent=s),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"客户联系人",path:"customer"},{default:l(()=>[t(n(D),{value:a.customer,"onUpdate:value":e[2]||(e[2]=s=>a.customer=s),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"联系方式",path:"cstcontact"},{default:l(()=>[t(n(D),{value:a.cstcontact,"onUpdate:value":e[3]||(e[3]=s=>a.cstcontact=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"备注",path:"notes"},{default:l(()=>[t(n(D),{value:a.notes,"onUpdate:value":e[4]||(e[4]=s=>a.notes=s),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{span:"24 m:24",label:"附件1",path:"notes"},{default:l(()=>{var s;return[t(n(D),{value:a.re1,"onUpdate:value":e[5]||(e[5]=r=>a.re1=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),a.fl1?(m(),O("span",Re,[d(C((s=a.fl1)==null?void 0:s.split("?")[1])+" ",1),V("span",{class:"cursor-pointer c-#c92a2a",onClick:e[6]||(e[6]=r=>a.fl1="")},"删除")])):(m(),j(_,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>N(r,"fl1"),"show-file-list":!1},{default:l(()=>[t(n(y),{size:"small",ghost:"",type:"primary"},{default:l(()=>e[14]||(e[14]=[d("选择文件")])),_:1,__:[14]})]),_:1},8,["custom-request"]))]}),_:1}),t(u,{span:"24 m:24",label:"附件2",path:"notes"},{default:l(()=>{var s;return[t(n(D),{value:a.re2,"onUpdate:value":e[7]||(e[7]=r=>a.re2=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),a.fl2?(m(),O("span",Fe,[d(C((s=a.fl2)==null?void 0:s.split("?")[1])+" ",1),V("span",{class:"cursor-pointer c-#c92a2a",onClick:e[8]||(e[8]=r=>a.fl2="")},"删除")])):(m(),j(_,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>N(r,"fl2"),"show-file-list":!1},{default:l(()=>[t(n(y),{size:"small",ghost:"",type:"primary"},{default:l(()=>e[15]||(e[15]=[d("选择文件")])),_:1,__:[15]})]),_:1},8,["custom-request"]))]}),_:1}),t(u,{span:"24 m:24",label:"附件3",path:"notes"},{default:l(()=>{var s;return[t(n(D),{value:a.re3,"onUpdate:value":e[9]||(e[9]=r=>a.re3=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),a.fl3?(m(),O("span",Be,[d(C((s=a.fl3)==null?void 0:s.split("?")[1])+" ",1),V("span",{class:"cursor-pointer c-#c92a2a",onClick:e[10]||(e[10]=r=>a.fl3="")},"删除")])):(m(),j(_,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>N(r,"fl3"),"show-file-list":!1},{default:l(()=>[t(n(y),{size:"small",ghost:"",type:"primary"},{default:l(()=>e[16]||(e[16]=[d("选择文件")])),_:1,__:[16]})]),_:1},8,["custom-request"]))]}),_:1}),t(u,{span:"24 m:24",label:"附件4",path:"notes"},{default:l(()=>{var s;return[t(n(D),{value:a.re4,"onUpdate:value":e[11]||(e[11]=r=>a.re4=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),a.fl4?(m(),O("span",Me,[d(C((s=a.fl4)==null?void 0:s.split("?")[1])+" ",1),V("span",{class:"cursor-pointer c-#c92a2a",onClick:e[12]||(e[12]=r=>a.fl4="")},"删除")])):(m(),j(_,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>N(r,"fl4"),"show-file-list":!1},{default:l(()=>[t(n(y),{size:"small",ghost:"",type:"primary"},{default:l(()=>e[17]||(e[17]=[d("选择文件")])),_:1,__:[17]})]),_:1},8,["custom-request"]))]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ie=Y({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["reset","search","clear"],["update:model"]),setup(b,{emit:$}){const S=$,{formRef:h}=oe(),a=le(b,"model"),p=X([]),{pageData:w,getData:x,nextPage:f}=ue(ie),q=async v=>{const c=v.currentTarget;c.scrollTop+c.offsetHeight>=c.scrollHeight&&w.data.length<w.total&&(f(),p.value=w.data)},R=async v=>{a.value.pid=v};(async()=>{var v;await x(),p.value=w.data,a.value.pid=(v=p.value[0])==null?void 0:v.id,S("search")})();async function U(){S("search")}return(v,c)=>{const F=se,z=de,B=$e,M=y,L=Z,k=ce,N=ne,P=re;return m(),j(P,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[t(N,{ref_key:"formRef",ref:h,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:we(U,["enter"])},{default:l(()=>[t(k,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[t(z,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:l(()=>[t(F,{filterable:"",value:a.value.pid,"onUpdate:value":[c[0]||(c[0]=i=>a.value.pid=i),R],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:p.value,onScroll:q},null,8,["value","options"])]),_:1}),t(z,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[t(L,{class:"w-full"},{default:l(()=>[t(M,{type:"primary",ghost:"",onClick:U},{icon:l(()=>[t(B,{class:"text-icon"})]),default:l(()=>[d(" "+C(n(T)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ae(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!De(b)}const at=Y({name:"projectmanagement_needchange",__name:"index",setup(b){const $=be(),{columns:S,columnChecks:h,data:a,getData:p,loading:w,mobilePagination:x,searchParams:f}=Te({showTotal:!0,immediate:!1,apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"reqcontent",title:"需求内容",align:"center",width:120},{key:"customer",title:"客户联系人",align:"center",width:120},{key:"cstcontact",title:"联系方式",align:"center",width:120},{key:"cstresult",title:"结果",align:"center",width:120,render(i){return Ne("div",{},i.cstresult==0?"失败":i.cstresult==1?"成功":"")}},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"操作人",align:"center",width:120},{key:"dbtime",title:"操作时间",align:"center",width:120},{key:"operate",title:T("common.operate"),align:"center",width:140,fixed:"right",render:i=>{let o;return t("div",{class:"flex-center gap-8px"},[A(t(y,{type:"primary",ghost:!0,size:"small",onClick:()=>L(i.id)},ae(o=T("common.edit"))?o:{default:()=>[o]}),[[W("no-auth"),"project:Customer:update"]]),t(te,{onPositiveClick:()=>M(i.id)},{default:()=>T("common.confirmDelete"),trigger:()=>{let e;return A(t(y,{type:"error",ghost:!0,size:"small"},ae(e=T("common.delete"))?e:{default:()=>[e]}),[[W("no-auth"),"project:Customer:delete"]])}})])}}]}),{drawerVisible:q,operateType:R,editingData:G,handleAdd:U,handleEdit:v,checkedRowKeys:c,onBatchDeleted:F,onDeleted:z}=Ue(a,p);ke(async()=>{});async function B(){console.log(c.value),k(c.value.join(","),i=>{F()})}async function M(i){const{data:o,error:e}=await ee(i,f.pid);e||z()}function L(i){v(i)}async function k(i,o){const{data:e,error:u}=await ee(i,f.pid);if(!u)o&&o(e);else return!1}const N=i=>{p()},P=()=>{p()};return(i,o)=>{const e=Z,u=fe,_=me,I=pe,E=Ce,J=re,H=W("no-auth");return m(),O("div",Oe,[t(Ie,{model:n(f),"onUpdate:model":o[0]||(o[0]=g=>K(f)?f.value=g:null),onReset:P,onSearch:n(p),onClear:o[1]||(o[1]=g=>a.value=[])},null,8,["model","onSearch"]),t(J,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[t(e,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>o[5]||(o[5]=[V("div",null,"需求变更",-1)])),_:1,__:[5]})]),"header-extra":l(()=>[t(e,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[A((m(),j(n(y),{onClick:n(U),size:"small",ghost:"",type:"primary"},{icon:l(()=>[t(u,{class:"text-icon"})]),default:l(()=>[o[6]||(o[6]=d(" "+C("新增")))]),_:1,__:[6]},8,["onClick"])),[[H,"project:Customer:insert"]]),t(n(te),{onPositiveClick:B},{trigger:l(()=>[A((m(),j(n(y),{size:"small",ghost:"",type:"error",disabled:n(c).length==0},{icon:l(()=>[t(_,{class:xe(["text-icon",{"animate-spin":n(w)}])},null,8,["class"])]),default:l(()=>[o[7]||(o[7]=d(" "+C("批量删除")))]),_:1,__:[7]},8,["disabled"])),[[H,"project:Customer:delete"]])]),default:l(()=>[o[8]||(o[8]=d(" 确定要删除选中的吗？ "))]),_:1,__:[8]}),t(I,{columns:n(h),"onUpdate:columns":o[2]||(o[2]=g=>K(h)?h.value=g:null)},null,8,["columns"])]),_:1})]),default:l(()=>[t(E,{"checked-row-keys":n(c),"onUpdate:checkedRowKeys":o[3]||(o[3]=g=>K(c)?c.value=g:null),columns:n(S),data:n(a),size:"small","flex-height":!n($).isMobile,loading:n(w),remote:"","row-key":g=>g.id,pagination:n(x),class:"sm:h-full","onUpdate:filters":N},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Le,{visible:n(q),"onUpdate:visible":o[4]||(o[4]=g=>K(q)?q.value=g:null),onSubmitted:n(p),"operate-type":n(R),"row-data":n(G)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{at as default};
