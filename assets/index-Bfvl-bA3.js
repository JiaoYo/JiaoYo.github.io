import{l as Y}from"./lodash-sX-Sa5u6.js";import{d as j,q as B,j as c,v as Q,s as X,o as W,c as Z,w as r,g as n,i as I,$ as x,V as ee,h as $,t as R,N as te,ax as ae,ao as E,ap as G,Y as le,A as ne,B as H,E as J,D as oe,aa as K,a0 as re,r as q,an as ie,e as se,ae as ue,aT as de,av as pe}from"./index-De3doW-I.js";import{_ as ce}from"./round-search-BHO9ozyz.js";import{_ as ve}from"./round-refresh-BgXv8fQK.js";import{u as me}from"./usePageData-tfok3vlS.js";import{a as ge,T as F}from"./basicconf-Crhw7fs0.js";import{f as fe}from"./system-manage-BBrldkrh.js";import{_ as _e}from"./DatePicker-ChN_fI5y.js";import{_ as Ie}from"./Cascader-B2NxMOaT.js";import{_ as he}from"./FormItemGridItem-D9ymTlC3.js";import{_ as ye}from"./Grid--J-WRE4U.js";import{_ as we}from"./originlogInfo.vue_vue_type_script_setup_true_lang-leRhphta.js";import{e as xe}from"./exportExcel-D6OyA9oJ.js";import{q as Se,y as Ae}from"./events--9amn4qa.js";import{b as be,f as Oe,a as Ee}from"./common-DdklHT9N.js";import{_ as ke}from"./DataTable-igK3_np4.js";import"./TimePicker-BCIqeSpW.js";import"./defineProperty-BKbvjvoe.js";import"./Forward-CYpjZEFa.js";import"./DescriptionsItem-D9QmtLnC.js";import"./CollapseItem-CQgzNYiw.js";const De=j({name:"FormSearch",__name:"form-search",props:B(["eventsTypeDataList","LogSourceDeviceList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:B(["search"],["update:model"]),setup(h,{emit:N}){const k=h,S=N;c(0);const{formRef:T,restoreValidation:M}=Q(),e=X(h,"model"),{pageData:D,getData:C,nextPage:U}=me(fe),L=async d=>{const l=d.currentTarget;l.scrollTop+l.offsetHeight>=l.scrollHeight&&D.data.length<D.total&&U()};C();async function P(){await M(),e.value.etypeid=null,e.value.elevel=null,e.value.rtime=null,e.value.user=null,e.value.logodid=null,e.value.target=null,e.value.startAndEndOriginIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.expression=null,e.value.startOriginIp=null,e.value.endOriginIp=null,e.value.startAimOriginIp=null,e.value.endAimOriginIp=null,e.value.startSourceIp=null,e.value.endSourceIp=null,ae(()=>{S("search")})}async function w(){var d,l,v,o,m,g,f,p,y,A,b,O;if(e.value.startAndEndOriginIp&&e.value.startAndEndOriginIp.length>0?(e.value.startOriginIp=e.value.startAndEndOriginIp[0]||null,e.value.endOriginIp=e.value.startAndEndOriginIp[1]||null):(e.value.startOriginIp=null,e.value.endOriginIp=null),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimOriginIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimOriginIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimOriginIp=null,e.value.endAimOriginIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=null,e.value.endSourceIp=null),e.value.startOriginIp&&!E(e.value.startOriginIp)||e.value.endOriginIp&&!E(e.value.endOriginIp))return(d=window.$message)==null||d.destroyAll(),(l=window.$message)==null||l.error("请输入正确的IP地址"),!1;if(e.value.startOriginIp&&e.value.endOriginIp&&G(e.value.startOriginIp,e.value.endOriginIp)>0)return(v=window.$message)==null||v.destroyAll(),(o=window.$message)==null||o.error("起始IP不能大于终止IP"),!1;if(e.value.startAimOriginIp&&!E(e.value.startAimOriginIp)||e.value.endAimOriginIp&&!E(e.value.endAimOriginIp))return(m=window.$message)==null||m.destroyAll(),(g=window.$message)==null||g.error("请输入正确的IP地址"),!1;if(e.value.startAimOriginIp&&e.value.endAimOriginIp&&G(e.value.startAimOriginIp,e.value.endAimOriginIp)>0)return(f=window.$message)==null||f.destroyAll(),(p=window.$message)==null||p.error("起始IP不能大于终止IP"),!1;if(e.value.startSourceIp&&!E(e.value.startSourceIp)||e.value.endSourceIp&&!E(e.value.endSourceIp))return(y=window.$message)==null||y.destroyAll(),(A=window.$message)==null||A.error("请输入正确的IP地址"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&G(e.value.startSourceIp,e.value.endSourceIp)>0)return(b=window.$message)==null||b.destroyAll(),(O=window.$message)==null||O.error("起始IP不能大于终止IP"),!1;S("search")}return(d,l)=>{const v=Ie,o=he,m=le,g=_e,f=ne,p=ve,y=H,A=ce,b=J,O=ye,V=oe,a=K;return W(),Z(a,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[n(V,{ref_key:"formRef",ref:T,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(w,["enter"])},{default:r(()=>[n(O,{responsive:"screen","item-responsive":""},{default:r(()=>[n(o,{span:"24 s:24 m:6",label:"事件类型",path:"etypeid",class:"pr-24px"},{default:r(()=>[n(v,{value:e.value.etypeid,"onUpdate:value":l[0]||(l[0]=t=>e.value.etypeid=t),clearable:"",placeholder:"请选择事件","max-tag-count":1,options:k.eventsTypeDataList,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),n(o,{span:"24 s:24 m:6",label:I(x)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:r(()=>[n(m,{filterable:"",clearable:"",placeholder:I(x)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[l[1]||(l[1]=t=>e.value.elevel=t),w],"reset-menu-on-options-change":!1,options:I(ee)(I(ge))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),n(o,{span:"24 s:24 m:6",label:"接收时间",path:"rtime",class:"pr-24px"},{default:r(()=>[n(g,{placeholder:"请选择接收时间","formatted-value":e.value.rtime,"onUpdate:formattedValue":l[2]||(l[2]=t=>e.value.rtime=t),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:"",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),n(o,{span:"24 s:24 m:6",label:"用户",path:"user",class:"pr-24px"},{default:r(()=>[n(m,{value:e.value.user,"onUpdate:value":l[3]||(l[3]=t=>e.value.user=t),placeholder:"请选择用户",clearable:"",filterable:"","value-field":"id","label-field":"username",options:I(D).data,"reset-menu-on-options-change":!1,onScroll:L},null,8,["value","options"])]),_:1}),n(o,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndOriginIp",class:"pr-24px mt-10px"},{default:r(()=>[n(f,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndOriginIp,"onUpdate:value":l[4]||(l[4]=t=>e.value.startAndEndOriginIp=t)},null,8,["value"])]),_:1}),n(o,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px mt-10px"},{default:r(()=>[n(f,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":l[5]||(l[5]=t=>e.value.startAndEndAimSourceIp=t)},null,8,["value"])]),_:1}),n(o,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSourceIp",class:"pr-24px mt-10px"},{default:r(()=>[n(f,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":l[6]||(l[6]=t=>e.value.startAndEndSourceIp=t)},null,8,["value"])]),_:1}),n(o,{span:"24 s:24 m:6",label:"日志源设备",path:"logodid",class:"pr-24px mt-10px"},{default:r(()=>[n(v,{disabled:k.logsoudev,value:e.value.logodid,"onUpdate:value":[l[7]||(l[7]=t=>e.value.logodid=t),w],placeholder:"请选择日志源设备",options:k.LogSourceDeviceList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["disabled","value","options"])]),_:1}),n(o,{span:"24 s:24 m:6",label:"目标对象",path:"target",class:"pr-24px mt-10px"},{default:r(()=>[n(f,{placeholder:"请输入目标对象",value:e.value.target,"onUpdate:value":l[8]||(l[8]=t=>e.value.target=t),clearable:""},null,8,["value"])]),_:1}),n(o,{span:"24 m:8",class:"pr-24px mt-10px"},{default:r(()=>[n(b,{class:"w-full"},{default:r(()=>[n(y,{onClick:P},{icon:r(()=>[n(p,{class:"text-icon"})]),default:r(()=>[$(" "+R(I(x)("common.reset")),1)]),_:1}),n(y,{type:"primary",ghost:"",onClick:w},{icon:r(()=>[n(A,{class:"text-icon"})]),default:r(()=>[$(" "+R(I(x)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Le={class:"min-h-500px flex-col-stretch overflow-hidden lt-sm:overflow-auto"};function Te(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!ue(h)}const Pe=j({name:"eventalarm_originlog",__name:"index",props:{logsoudev:{}},setup(h){const N=re(),k=c(window.innerHeight-395),S=h,T=c([]);(async()=>{const{data:a,error:t}=await be();t||(T.value=a.map(i=>({...i,id:"+"+i.id,type:i.cname})))})();const e=c([]),D=c([]);async function C(){const{data:a,error:t}=await Oe();t||(e.value=a,await U())}async function U(){const{data:a,error:t}=await Ee();if(!t){D.value=a;let i=e.value.concat(a);e.value=de(i)}}C();const L=c(!1),P=c(),w=c(),d=c(!1),l=q({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),v=[{title:"",key:"key",width:80,render:(a,t)=>`${t+1}`},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"elevel",title:"事件等级",align:"center",width:120,render:a=>{(a.elevel===void 0||a.elevel===null)&&(a.elevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},i=x(F[a.elevel]);let _={color:t[a.elevel],textColor:"#ffffff",borderColor:t[a.elevel]};return n(ie,{size:"small",color:_},Te(i)?i:{default:()=>[i]})}},{key:"cname",title:"设备类别",align:"center",width:180},{key:"type",title:"设备类型",align:"center",width:180},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"sourceip",title:"发生源IP",align:"center",width:180},{key:"prifinallog",title:"日志原文",align:"center",width:240,ellipsis:{tooltip:!0}},{key:"operate",title:x("common.operate"),align:"center",width:100,fixed:"right",render:a=>n("div",{class:"flex-center gap-8px"},[n(H,{type:"info",ghost:!0,size:"small",onClick:()=>A(a)},{default:()=>[$("详情")]})])}],o=c([]),m=async(a=!1)=>{if(!d.value)d.value=!0;else return;d.value=!0,S.logsoudev&&(g.value=!1,l.logodid=S.logsoudev);const{data:t,error:i}=await Se(l);i||(a?o.value=[...o.value,...t]:o.value=t,d.value=!1)},g=c(!0),f=()=>{o.value=[],l.pageId=void 0,(t=>Object.keys(t).filter(u=>u!=="limit"&&u!=="_t").some(u=>t[u]!==void 0&&t[u]!==""&&t[u]!==null))(l)?g.value=!1:(g.value=!0,y()),m()};m();const p=q({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:t,page:i,pageSize:_,pageCount:u,itemCount:s}){return`已加载${o.value.length}条`+(o.value.length?g.value?` 共计 ${o.value.length>0?s??0:0} 条`:o.value.length>=l.limit?"  预计还有更多":"":"")}});async function y(){const{data:a,error:t}=await Ae();t||(p.pageCount=20,p.total=Number(a),p.itemCount=Number(a))}y();const A=a=>{P.value=a.id,w.value=a,L.value=!0};function b(a){var t;console.log(a.target.scrollTop,a.target.offsetHeight,a.target.scrollHeight),a.target.scrollTop+a.target.offsetHeight==a.target.scrollHeight&&p.total>((t=o.value)==null?void 0:t.length)&&O()}const O=Y.debounce(()=>{var a;if(((a=o.value)==null?void 0:a.length)<p.total){if(l.pageId==o.value[o.value.length-1].id)return;l.pageId=o.value[o.value.length-1].id,m(!0)}},300);async function V(){if(!o.value.length)return;const a=JSON.parse(JSON.stringify(o.value)),t=[];a.forEach(_=>{const u={};v.forEach(s=>{if(_.hasOwnProperty(s.key)){const z=s.key=="elevel"?x(F[_[s.key]]):_[s.key];u[s.title]=z}}),t.push(u)}),xe(t,500,[{wpx:120},{wpx:120},{wpx:80},{wpx:100},{wpx:100},{wpx:120},{wpx:100},{wpx:500}],"原始日志_"+new Date().getTime())}return(a,t)=>{const i=J,_=ke,u=K;return W(),se("div",Le,[n(De,{model:l,"onUpdate:model":t[0]||(t[0]=s=>l=s),onSearch:f,eventsTypeDataList:e.value,LogSourceDeviceList:T.value,class:"mb-16px",logsoudev:S.logsoudev},null,8,["model","eventsTypeDataList","LogSourceDeviceList","logsoudev"]),n(u,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":r(()=>[n(i,null,{default:r(()=>[n(I(H),{type:"primary",size:"small",ghost:"",onClick:V,title:"导出已加载"},{default:r(()=>[$("导出已加载")]),_:1})]),_:1})]),default:r(()=>[n(_,{columns:v,data:o.value,size:"small","flex-height":!I(N).isMobile,loading:d.value,remote:"","row-key":s=>s.id,"virtual-scroll":"","scroll-x":v.reduce((s,z)=>s+z.width,0),pagination:p,class:"sm:h-full",onScroll:b,"max-height":k.value},null,8,["data","flex-height","loading","row-key","scroll-x","pagination","max-height"])]),_:1}),n(we,{detailVisible:L.value,"onUpdate:detailVisible":t[1]||(t[1]=s=>L.value=s),detailId:P.value,detailInfo:w.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),et=pe(Pe,[["__scopeId","data-v-d9bf23d7"]]);export{et as default};
