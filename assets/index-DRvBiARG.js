import{_ as Ke}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Dg__PXp0.js";import{_ as We}from"./round-delete-CojfW_rY.js";import{_ as Ye}from"./round-add-CcJ-eWvp.js";import{d as Se,aE as De,m as ze,r as Qe,H as J,n as Pe,a as Ze,aG as Ie,aC as $e,c as S,o as m,w as a,f as t,a0 as Xe,C as Re,s as D,h as o,aD as se,x as M,b as I,g as p,e as k,t as c,aI as et,B as j,aJ as tt,z as je,$ as K,a1 as Be,b4 as at,aO as ye,cr as lt,cp as nt,cs as Ae,ct as Ue,aQ as st,cu as Fe,cv as ot,P as Le,O as Oe,bY as rt,A as ut,Z as Me,aS as it,i as dt,q as G,aT as he,aH as pt,y as O,aU as ct,aK as ft,aM as le,cw as Ne,cx as mt,aY as gt}from"./index-CbkGmsUT.js";import{u as vt,a as bt}from"./table-CST65CZ1.js";import{u as _e}from"./usePageData-CtVI6YRj.js";import{_ as Ee}from"./Grid-CyaoSB-i.js";import{_ as He}from"./FormItemGridItem-D8sOQ-r2.js";import{_ as yt}from"./DatePicker-DuNimOXS.js";import{_ as _t}from"./round-search-opoHbQsz.js";import{_ as ht}from"./round-refresh-BzOWd9gI.js";import{_ as kt,a as wt}from"./DescriptionsItem-BeQALYEQ.js";import{N as ne}from"./Popconfirm-CfoHIMzd.js";import{N as Ct}from"./RadioButton-CUo6Xoh2.js";const Tt={key:0,style:{"margin-left":"20px"}},xt={key:0,style:{"margin-left":"20px"}},Dt={key:0,style:{"margin-left":"20px"}},St={key:0,style:{"margin-left":"20px"}},zt=Se({name:"OperateDrawer",__name:"operate-drawer",props:De({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:De(["submitted"],["update:visible"]),setup(A,{emit:oe}){const U=oe,T=ze(),b=A,l=Qe(E());function E(){return{pid:void 0,id:"",debugname:"",docker:void 0,dockcharge:"",dockcontact:"",status:0,notes:"",debugresult:0,dtype:void 0,starttime:null,endtime:null,dbcreater:void 0,startAndTimeRange:void 0,re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const{pageData:F,getData:f,nextPage:q}=_e(at),B=async()=>{await f({usertypes:"2,3"})},W=async r=>{const e=r.currentTarget,u=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&F.data.length<F.total&&(await q(),await ye(),setTimeout(()=>{e.scrollTop=u}))},{pageData:y,getData:Y,nextPage:re}=_e(lt),ue=async r=>{const e=r.currentTarget,u=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&y.data.length<y.total&&(await re(),y.data=y.data.map(x=>({...x,value:x.docker+"&id="+x.id})),await ye(),setTimeout(()=>{e.scrollTop=u}))},ie=async()=>{await Y({pid:l.pid}),y.data=y.data.map(r=>({...r,value:r.docker+"&id="+r.id}))},Q=async r=>{var e;if(l.docker=r,l.docker){const[u,x]=(e=l.docker)==null?void 0:e.split("&id="),w=y.data.find(V=>V.docker==u&&V.id==x);w?(l.dockcharge=w.pname,l.dockcontact=w.pcontact):(l.dockcharge="",l.dockcontact="")}},{pageData:P,getData:de,nextPage:Z}=_e(nt),pe=async r=>{const e=r.currentTarget,u=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&P.data.length<P.total&&(await Z(),await ye(),setTimeout(()=>{e.scrollTop=u}))},ce=async()=>{await de()},L=J([]),{pageData:g,getData:_,nextPage:$}=_e(Ae),R=async r=>{const e=r.currentTarget,u=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&g.data.length<g.total&&(await $(),L.value=g.data,await ye(),setTimeout(()=>{e.scrollTop=u}))},X=async()=>{await _({fuzzy:T.userInfo.pname,page:1}),L.value=g.data},fe=async()=>{await _({page:1}),L.value=g.data},ee=async r=>{l.pid=r},me=J(void 0);async function ge(){X(),ce(),B(),Object.assign(l,E()),b.operateType==="add"&&(l.pid=Number(b.pid)),b.operateType==="edit"&&b.rowData&&(Object.assign(l,b.rowData),me.value=l.status,b.rowData.starttime&&b.rowData.endtime?l.startAndTimeRange=[Ue(b.rowData.starttime),Ue(b.rowData.endtime)]:l.startAndTimeRange=null),ie()}const{formRef:d,validate:H,restoreValidation:ve}=Pe(),s={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dbcreater:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"},debugname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcharge:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"}},n=Ze(()=>({add:"新增待调试业务",edit:"修改待调试业务"})[b.operateType]),z=Ie(A,"visible");$e(z,()=>{z.value&&(ge(),setTimeout(()=>{const r=document.querySelector(".n-scrollbar-content");r==null||r.scrollTo(0,0)},300),ve())});const v=J(0),C=J("");async function te({file:r},e){v.value=0,C.value=e;const u=await st(r.file,r.name,"",x=>{v.value=x});u&&(l[e]=u,v.value=0)}function be(){z.value=!1}async function ae(r){if(r)try{const u=await(await fetch(r==null?void 0:r.split("?")[0],{mode:"cors"})).blob(),x=URL.createObjectURL(u),w=document.createElement("a");w.href=x,w.download=r==null?void 0:r.split("?")[1],w.style.display="none",document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(x)}catch(e){console.error("下载失败:",e)}}async function ke(){var r;await H(),(r=window.$dialog)==null||r.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await we()}})}async function we(){var r,e,u,x;if(await H(),b.operateType==="edit"){const w=JSON.parse(JSON.stringify(l));w.docker=(r=w.docker)==null?void 0:r.split("&id=")[0];const{data:V,error:xe}=await Fe([w]);xe||(be(),U("submitted"),(e=window.$message)==null||e.success("修改成功"))}else{const{data:w,error:V}=await ot([{...l,docker:(u=l.docker)==null?void 0:u.split("&id=")[0]}]);V||(be(),U("submitted"),(x=window.$message)==null||x.success("添加成功"))}}async function h(r){var e;return r.file.file.size>100*1024*1024?((e=window.$message)==null||e.error("文件大小不能超过100M"),!1):!0}const Ce=r=>{var e;l.debugname=(e=P.data.find(u=>u.id==r))==null?void 0:e.tname,l.dtype=r};async function Te(r,e){l.startAndTimeRange=r,l.starttime=r==null?void 0:r[0],l.endtime=r==null?void 0:r[1]}return(r,e)=>{const u=He,x=et,w=tt,V=Ee,xe=Re,Ve=Xe,Ge=je,Je=Be;return m(),S(Je,{show:z.value,"onUpdate:show":e[22]||(e[22]=i=>z.value=i),title:n.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:a(()=>[t(Ge,{justify:"end",size:16},{default:a(()=>[t(o(j),{onClick:be},{default:a(()=>[p(c(o(K)("common.cancel")),1)]),_:1}),t(o(j),{type:"primary",onClick:ke},{default:a(()=>[p(c(o(K)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(Ve,{class:"pr-20px"},{default:a(()=>[t(xe,{ref_key:"formRef",ref:d,model:l,rules:s,"label-placement":"left","label-width":120},{default:a(()=>[t(V,{responsive:"screen","item-responsive":""},{default:a(()=>[t(u,{span:"24 m:12",label:"项目列表",path:"pid"},{default:a(()=>[t(o(se),{filterable:"",clearable:"",value:l.pid,"onUpdate:value":[e[0]||(e[0]=i=>l.pid=i),ee],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:fe,options:L.value,onScroll:R},null,8,["value","options"])]),_:1}),t(u,{span:"24 m:12",label:"权重",path:"dtype"},{default:a(()=>[t(o(se),{filterable:"",value:l.dtype,"onUpdate:value":[e[1]||(e[1]=i=>l.dtype=i),Ce],tag:"",placeholder:"请选择权重","label-field":"tname","value-field":"id",options:o(P).data,onScroll:pe},null,8,["value","options"])]),_:1}),t(u,{span:"24 m:12",label:"业务名称",path:"debugname"},{default:a(()=>[t(o(M),{value:l.debugname,"onUpdate:value":e[2]||(e[2]=i=>l.debugname=i),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"调试人",path:"dbcreater"},{default:a(()=>[t(o(se),{filterable:"",value:l.dbcreater,"onUpdate:value":e[3]||(e[3]=i=>l.dbcreater=i),placeholder:"请选择调试人","label-field":"username","value-field":"id",options:o(F).data,onScroll:W},null,8,["value","options"])]),_:1}),t(u,{span:"24 m:24",label:"起止时间",path:"startAndTimeRange"},{default:a(()=>[t(o(yt),{clearable:"",value:l.startAndTimeRange,"onUpdate:value":e[4]||(e[4]=i=>l.startAndTimeRange=i),type:"daterange","value-format":"yyyy-MM-dd",style:{width:"100%"},"onUpdate:formattedValue":Te},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"对接方",path:"docker"},{default:a(()=>[t(o(se),{filterable:"",value:l.docker,"onUpdate:value":[e[5]||(e[5]=i=>l.docker=i),Q],clearable:"",tag:"",placeholder:"请选择或输入对接方","label-field":"docker","value-field":"value",options:o(y).data,onScroll:ue},null,8,["value","options"])]),_:1}),t(u,{span:"24 m:12",label:"对接方负责人",path:"dockcharge"},{default:a(()=>[t(o(M),{value:l.dockcharge,"onUpdate:value":e[6]||(e[6]=i=>l.dockcharge=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"联系方式",path:"dockcontact"},{default:a(()=>[t(o(M),{value:l.dockcontact,"onUpdate:value":e[7]||(e[7]=i=>l.dockcontact=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),b.operateType=="edit"?(m(),S(u,{key:0,span:"24 m:12",label:"状态",path:"status"},{default:a(()=>[t(o(se),{clearable:"",value:l.status,"onUpdate:value":e[8]||(e[8]=i=>l.status=i),placeholder:"请选择",options:o(T).userInfo.usertype==0||o(T).userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}]},null,8,["value","options"])]),_:1})):D("",!0),t(u,{span:"24 m:12",label:"备注",path:"notes"},{default:a(()=>[t(o(M),{value:l.notes,"onUpdate:value":e[9]||(e[9]=i=>l.notes=i),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:a(()=>[t(V,{responsive:"screen","item-responsive":""},{default:a(()=>[t(u,{span:"24 m:12",label:"附件1",path:"notes"},{default:a(()=>[t(o(M),{value:l.re1,"onUpdate:value":e[10]||(e[10]=i=>l.re1=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:a(()=>{var i;return[l.fl1?(m(),I("span",Tt,[p(c((i=l.fl1)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:e[11]||(e[11]=N=>l.fl1="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[12]||(e[12]=N=>ae(l.fl1))},"下载")])):(m(),S(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":N=>te(N,"fl1"),"show-file-list":!1,onBeforeUpload:h},{default:a(()=>[t(o(j),{loading:v.value>0&&!l.fl1&&C.value=="fl1",size:"small",ghost:"",type:"primary"},{default:a(()=>[p(c(v.value>0&&!l.fl1&&C.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),v.value&&!l.fl1&&C.value=="fl1"?(m(),S(w,{key:2,type:"line",percentage:v.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):D("",!0)]}),_:1})]),_:1})]),_:1}),t(u,{span:"24 m:12",label:"附件2",path:"notes"},{default:a(()=>[t(o(M),{value:l.re2,"onUpdate:value":e[13]||(e[13]=i=>l.re2=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:a(()=>{var i;return[l.fl2?(m(),I("span",xt,[p(c((i=l.fl2)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:e[14]||(e[14]=N=>l.fl2="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[15]||(e[15]=N=>ae(l.fl2))},"下载")])):(m(),S(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":N=>te(N,"fl2"),"show-file-list":!1,onBeforeUpload:h},{default:a(()=>[t(o(j),{loading:v.value>0&&!l.fl2&&C.value=="fl2",size:"small",ghost:"",type:"primary"},{default:a(()=>[p(c(v.value>0&&!l.fl2&&C.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),v.value&&!l.fl2&&C.value=="fl2"?(m(),S(w,{key:2,type:"line",percentage:v.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):D("",!0)]}),_:1}),t(u,{span:"24 m:12",label:"附件3",path:"notes"},{default:a(()=>[t(o(M),{value:l.re3,"onUpdate:value":e[16]||(e[16]=i=>l.re3=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:a(()=>{var i;return[l.fl3?(m(),I("span",Dt,[p(c((i=l.fl3)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:e[17]||(e[17]=N=>l.fl3="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[18]||(e[18]=N=>ae(l.fl3))},"下载")])):(m(),S(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":N=>te(N,"fl3"),"show-file-list":!1,onBeforeUpload:h},{default:a(()=>[t(o(j),{loading:v.value>0&&!l.fl3&&C.value=="fl3",size:"small",ghost:"",type:"primary"},{default:a(()=>[p(c(v.value>0&&!l.fl3&&C.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),v.value&&!l.fl3&&C.value=="fl3"?(m(),S(w,{key:2,type:"line",percentage:v.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):D("",!0)]}),_:1}),t(u,{span:"24 m:12",label:"附件4",path:"notes"},{default:a(()=>[t(o(M),{value:l.re4,"onUpdate:value":e[19]||(e[19]=i=>l.re4=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:a(()=>{var i;return[l.fl4?(m(),I("span",St,[p(c((i=l.fl4)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:e[20]||(e[20]=N=>l.fl4="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[21]||(e[21]=N=>ae(l.fl4))},"下载")])):(m(),S(x,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":N=>te(N,"fl4"),"show-file-list":!1,onBeforeUpload:h},{default:a(()=>[t(o(j),{loading:v.value>0&&!l.fl4&&C.value=="fl4",size:"small",ghost:"",type:"primary"},{default:a(()=>[p(c(v.value>0&&!l.fl4&&C.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),v.value&&!l.fl4&&C.value=="fl4"?(m(),S(w,{key:2,type:"line",percentage:v.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):D("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),jt=Se({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:De(["reset","search","search1","clear"],["update:model"]),setup(A,{emit:oe}){const U=Le(),T=Oe(),b=oe,l=ze(),{formRef:E,restoreValidation:F}=Pe(),f=Ie(A,"model"),q=J([]),{pageData:B,getData:W,nextPage:y}=_e(Ae),Y=async g=>{const _=g.currentTarget,$=_.scrollTop;_.scrollTop+_.offsetHeight>=_.scrollHeight&&B.data.length<B.total&&(await y(),q.value=B.data,await ye(),setTimeout(()=>{_.scrollTop=$}))},re=async g=>{var _;g?(f.value.pid=g,b("search1"),l.setProjectInfo({pname:(_=q.value.find($=>$.id==g))==null?void 0:_.proname,pid:g})):b("clear")},ue=rt.debounce(async g=>{await W({fuzzy:g,page:1}),q.value=B.data},300),ie=g=>{if(!g){f.value.pid=null,Q();return}ue(g)},Q=async()=>{await W({page:1}),q.value=B.data,b("search1")},P=async g=>{f.value.status=g,b("search1")},de=async()=>{f.value.status=null},Z=async()=>{var g,_;await W({fuzzy:T.query.pname?T.query.pname:l.userInfo.pname}),q.value=B.data,f.value.pid=T.query.prjId?Number(T.query.prjId):l.userInfo.pid?l.userInfo.pid:(g=q.value[0])==null?void 0:g.id,f.value.fuzzy=T.query.debugname?T.query.debugname:"",l.setProjectInfo({pid:f.value.pid,pname:(_=q.value.find($=>$.id==f.value.pid))==null?void 0:_.proname}),b("search"),setTimeout(()=>{U.replace({path:T.path,query:{}})},1e3)};Z();async function pe(){await F(),f.value.fuzzy="",f.value.pid=null,f.value.status=null,b("reset")}const ce=()=>{f.value.fuzzy="",b("search")};async function L(){b("search")}return $e(()=>T.query,g=>{g.pname&&Z()}),(g,_)=>{const $=se,R=He,X=M,fe=ht,ee=j,me=_t,ge=je,d=Ee,H=Re,ve=Me;return m(),S(ve,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[t(H,{ref_key:"formRef",ref:E,model:f.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ut(L,["enter"])},{default:a(()=>[t(d,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[t(R,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:a(()=>[t($,{filterable:"",clearable:"",value:f.value.pid,"onUpdate:value":[_[0]||(_[0]=s=>f.value.pid=s),re],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:Q,onSearch:ie,options:q.value,onScroll:Y},null,8,["value","options"])]),_:1}),t(R,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:a(()=>[t($,{clearable:"",filterable:"",value:f.value.status,"onUpdate:value":[_[1]||(_[1]=s=>f.value.status=s),P],placeholder:"请选择状态",onClear:de,options:[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]},null,8,["value"])]),_:1}),t(R,{span:"24 s:12 m:6",label:"业务名称",path:"fuzzy"},{default:a(()=>[t(X,{value:f.value.fuzzy,"onUpdate:value":_[2]||(_[2]=s=>f.value.fuzzy=s),placeholder:"请输入",clearable:"",onClear:ce},null,8,["value"])]),_:1}),t(R,{span:"24  s:12 m:6",class:"pr-24px"},{default:a(()=>[t(ge,{class:"w-full"},{default:a(()=>[t(ee,{onClick:pe},{icon:a(()=>[t(fe,{class:"text-icon"})]),default:a(()=>[p(" "+c(o(K)("common.reset")),1)]),_:1}),t(ee,{type:"primary",ghost:"",onClick:L},{icon:a(()=>[t(me,{class:"text-icon"})]),default:a(()=>[p(" "+c(o(K)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ut={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Nt={key:0},qt={key:1},Pt={key:0},It={key:1},$t={key:0},Rt={key:1},Bt={key:0},At={key:1};function qe(A){return typeof A=="function"||Object.prototype.toString.call(A)==="[object Object]"&&!gt(A)}const Xt=Se({name:"projectmanagement_business",__name:"index",setup(A){const oe=it(),U=ze(),T=Oe(),b=Le(),{columns:l,columnChecks:E,data:F,getData:f,loading:q,pagination:B,mobilePagination:W,searchParams:y}=vt({showTotal:!0,immediate:!1,apiFn:mt,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",status:null,dbcreater:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"debugname",title:"业务名称",align:"center",width:180},{key:"proname",title:"所属项目",align:"center",width:180,render(s){return t("span",{class:"cursor-pointer",onClick:()=>pe(s)},[s.proname])}},{key:"docker",title:"对接方",align:"center",width:120,render:s=>t("span",null,[s.docker])},{key:"dockcharge",title:"对接方负责人",align:"center",width:120},{key:"dockcontact",title:"联系方式",align:"center",width:120},{key:"status",title:"状态",align:"center",width:120,render(s){return t(le,{color:{color:s.status==-1?"rgba(251, 146, 60, 0.15)":s.status==0?"rgba(156, 163, 175, 0.15)":s.status==1?"rgba(59, 130, 246, 0.15)":s.status==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:s.status==-1?"#FB923C":s.status==0?"#9CA3AF":s.status==1?"#3B82F6":s.status==2?"#FACC15":"#10B981",borderColor:s.status==-1?"#FB923C":s.status==0?"#9CA3AF":s.status==1?"#3B82F6":s.status==2?"#FACC15":"#10B981"}},{default:()=>[s.status==-1?"申请中":s.status==0?"待调试":s.status==1?"开始调试":s.status==2?"待审核":"审核完成"]})}},{key:"dbusername",title:"调试人",align:"center",width:120},{key:"duration",title:"调试工时",align:"center",width:180},{key:"notes",title:"备注",align:"center",width:120},{key:"ckusername",title:"审核人",align:"center",width:120},{key:"ckdbtime",title:"审核时间",align:"center",width:180},{key:"dbdbtime",title:"调试开始时间",align:"center",width:180},{key:"dedbtime",title:"调试结束时间",align:"center",width:180},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:180},{key:"operate",title:K("common.operate"),align:"center",width:280,fixed:"right",render:s=>{let n;return t("div",{class:"flex-center gap-8px"},[s.status==-1&&(U.userInfo.usertype==0||U.userInfo.usertype==2)&&t(ne,{onPositiveClick:()=>g(s,0)},{default:()=>"确定通过申请吗？",trigger:()=>O(t(j,{type:"warning",ghost:!0,size:"small"},{default:()=>["通过申请"]}),[[G("no-auth"),"project:Debug:update"]])}),s.status==0&&s.dbcreater==U.userInfo.id&&t(ne,{onPositiveClick:()=>g(s,1)},{default:()=>"确定开始调试吗？",trigger:()=>O(t(j,{type:"success",ghost:!0,size:"small"},{default:()=>["开始"]}),[[G("no-auth"),"project:Debug:update"]])}),s.status==1&&s.dbcreater==U.userInfo.id&&t(ne,{onPositiveClick:()=>g(s,2)},{default:()=>"确定完成调试？",trigger:()=>O(t(j,{type:"success",ghost:!0,size:"small"},{default:()=>["完成"]}),[[G("no-auth"),"project:Debug:update"]])}),s.status==2&&(U.userInfo.usertype==0||U.userInfo.usertype==2)&&t(ne,{onPositiveClick:()=>g(s,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>O(t(j,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[G("no-auth"),"project:Debug:update"]])}),O(t(j,{type:"primary",ghost:!0,size:"small",onClick:()=>ve(s)},{default:()=>[p("详情")]}),[[G("no-auth"),"project:Debug:select"]]),O(t(j,{type:"primary",ghost:!0,size:"small",onClick:()=>_(s.id)},qe(n=K("common.edit"))?n:{default:()=>[n]}),[[G("no-auth"),"project:Debug:update"]]),t(ne,{onPositiveClick:()=>L(s.id)},{default:()=>K("common.confirmDelete"),trigger:()=>{let z;return O(t(j,{type:"error",ghost:!0,size:"small"},qe(z=K("common.delete"))?z:{default:()=>[z]}),[[G("no-auth"),"project:Debug:delete"]])}})])}}]}),{drawerVisible:Y,operateType:re,editingData:ue,handleAdd:ie,handleEdit:Q,checkedRowKeys:P,onBatchDeleted:de,onDeleted:Z}=bt(F,f);dt(async()=>{});const pe=s=>{U.setProjectInfo({pid:s.pid,pname:s.proname}),b.push("/projectmanagement/orderdetail?prjId="+s.pid+`&pname=${s.proname}&IsScroll=1`)};async function ce(){console.log(P.value),$(P.value.join(","),s=>{de()})}async function L(s){const{data:n,error:z}=await Ne(s,y.pid);z||Z()}const g=async(s,n)=>{var C;const{data:z,error:v}=await Fe([{id:s.id,status:n,pid:s.pid}]);v||((C=window.$message)==null||C.success("操作成功"),f(),n==3?window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:s.pid,type:"debug"}})):(n==1||n==2)&&window.dispatchEvent(new CustomEvent("refreshTodo")))};function _(s){Q(s)}async function $(s,n){const{data:z,error:v}=await Ne(s,y.pid);if(!v)n&&n(z);else return!1}const R=J(-1),X=s=>{s>0?(R.value=s,y.dbcreater=JSON.parse(JSON.stringify(s)),f()):(y.dbcreater=void 0,R.value=-1,f())},fe=s=>{f()},ee=()=>{if(console.log(T.query.prjId,"route.query.prjId"),T.query.debug){y.status=Number(T.query.debug),y.dbcreater=U.userInfo.id,X(U.userInfo.id);return}T.query.types=="2"&&(y.status=2),T.query.types=="-1"&&(y.status=-1),f()},me=()=>{f()},ge=()=>{F.value=[],B.itemCount=0},d=J(null),H=J(!1),ve=s=>{d.value=s,H.value=!0};return(s,n)=>{const z=Ct,v=ft,C=je,te=Ye,be=We,ae=Ke,ke=pt,we=Me,h=wt,Ce=kt,Te=Be,r=G("no-auth");return m(),I("div",Ut,[t(jt,{model:o(y),"onUpdate:model":n[0]||(n[0]=e=>he(y)?y.value=e:null),onReset:me,onSearch:ee,onSearch1:o(f),onClear:ge},null,8,["model","onSearch1"]),t(we,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t(C,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>[n[6]||(n[6]=k("div",null,"待调试业务",-1)),t(v,{size:"small",value:R.value,"onUpdate:value":[n[1]||(n[1]=e=>R.value=e),X],name:"radiobuttongroup1"},{default:a(()=>[t(z,{value:-1,label:"默认"}),t(z,{value:o(U).userInfo.id,label:"我的调试"},null,8,["value"])]),_:1},8,["value"])]),_:1,__:[6]})]),"header-extra":a(()=>[t(C,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[O((m(),S(o(j),{onClick:o(ie),size:"small",ghost:"",type:"primary"},{icon:a(()=>[t(te,{class:"text-icon"})]),default:a(()=>[n[7]||(n[7]=p(" "+c("新增")))]),_:1,__:[7]},8,["onClick"])),[[r,"project:Debug:insert"]]),t(o(ne),{onPositiveClick:ce},{trigger:a(()=>[O((m(),S(o(j),{size:"small",ghost:"",type:"error",disabled:o(P).length==0},{icon:a(()=>[t(be,{class:ct(["text-icon",{"animate-spin":o(q)}])},null,8,["class"])]),default:a(()=>[n[8]||(n[8]=p(" "+c("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[r,"project:Debug:delete"]])]),default:a(()=>[n[9]||(n[9]=p(" 确定要删除选中的吗？ "))]),_:1,__:[9]}),t(ae,{columns:o(E),"onUpdate:columns":n[2]||(n[2]=e=>he(E)?E.value=e:null)},null,8,["columns"])]),_:1})]),default:a(()=>[t(ke,{"checked-row-keys":o(P),"onUpdate:checkedRowKeys":n[3]||(n[3]=e=>he(P)?P.value=e:null),columns:o(l),data:o(F),size:"small","flex-height":!o(oe).isMobile,loading:o(q),remote:"","row-key":e=>e.id,"scroll-x":o(l).reduce((e,u)=>e+(u.width||100),0),pagination:o(W),class:"sm:h-full","onUpdate:filters":fe},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","scroll-x","pagination"]),t(zt,{visible:o(Y),"onUpdate:visible":n[4]||(n[4]=e=>he(Y)?Y.value=e:null),onSubmitted:o(f),"operate-type":o(re),pid:o(y).pid,"row-data":o(ue)},null,8,["visible","onSubmitted","operate-type","pid","row-data"])]),_:1}),t(Te,{show:H.value,"onUpdate:show":n[5]||(n[5]=e=>H.value=e),title:"查看详情",preset:"card",class:"w-1200px"},{default:a(()=>[t(Ce,{bordered:"","label-placement":"left","label-align":"center",columns:2,"label-style":{width:"160px"}},{default:a(()=>[t(h,null,{label:a(()=>n[10]||(n[10]=[p(" 权重 ")])),default:a(()=>[k("span",null,c(d.value.tname),1)]),_:1}),t(h,null,{label:a(()=>n[11]||(n[11]=[p(" 业务名称 ")])),default:a(()=>[k("span",null,c(d.value.debugname),1)]),_:1}),t(h,null,{label:a(()=>n[12]||(n[12]=[p(" 计划起止时间 ")])),default:a(()=>[k("span",null,c(d.value.starttime)+"--"+c(d.value.endtime),1)]),_:1}),t(h,null,{label:a(()=>n[13]||(n[13]=[p(" 对接方 ")])),default:a(()=>[k("span",null,c(d.value.docker.split("&id=")[0]),1)]),_:1}),t(h,null,{label:a(()=>n[14]||(n[14]=[p(" 对接方负责人 ")])),default:a(()=>[k("span",null,c(d.value.dockcharge),1)]),_:1}),t(h,null,{label:a(()=>n[15]||(n[15]=[p(" 联系方式 ")])),default:a(()=>[k("span",null,c(d.value.dockcontact),1)]),_:1}),t(h,null,{label:a(()=>n[16]||(n[16]=[p(" 状态 ")])),default:a(()=>[d.value.status==-1?(m(),S(o(le),{key:0,type:"default"},{default:a(()=>n[17]||(n[17]=[p("申请中")])),_:1,__:[17]})):D("",!0),d.value.status==0?(m(),S(o(le),{key:1,type:"default"},{default:a(()=>n[18]||(n[18]=[p("未调试")])),_:1,__:[18]})):D("",!0),d.value.status==1?(m(),S(o(le),{key:2,type:"info"},{default:a(()=>n[19]||(n[19]=[p("开始调试")])),_:1,__:[19]})):D("",!0),d.value.status==2?(m(),S(o(le),{key:3,type:"success"},{default:a(()=>n[20]||(n[20]=[p("待审核")])),_:1,__:[20]})):D("",!0),d.value.status==3?(m(),S(o(le),{key:4,type:"success"},{default:a(()=>n[21]||(n[21]=[p("审核完成")])),_:1,__:[21]})):D("",!0)]),_:1}),t(h,null,{label:a(()=>n[22]||(n[22]=[p(" 备注 ")])),default:a(()=>[k("span",null,c(d.value.notes),1)]),_:1}),t(h,null,{label:a(()=>n[23]||(n[23]=[p(" 调试人 ")])),default:a(()=>[k("span",null,c(d.value.dbusername),1)]),_:1}),t(h,null,{label:a(()=>n[24]||(n[24]=[p(" 调试开始时间 ")])),default:a(()=>[k("span",null,c(d.value.dbdbtime),1)]),_:1}),t(h,null,{label:a(()=>n[25]||(n[25]=[p(" 调试结束时间 ")])),default:a(()=>[k("span",null,c(d.value.dedbtime),1)]),_:1}),t(h,null,{label:a(()=>n[26]||(n[26]=[p(" 调试工时 ")])),default:a(()=>[k("span",null,c(d.value.duration),1)]),_:1}),t(h,null,{label:a(()=>n[27]||(n[27]=[p(" 审核人 ")])),default:a(()=>[k("span",null,c(d.value.ckusername),1)]),_:1}),t(h,null,{label:a(()=>n[28]||(n[28]=[p(" 审核时间 ")])),default:a(()=>[k("span",null,c(d.value.ckdbtime),1)]),_:1}),t(h,null,{label:a(()=>n[29]||(n[29]=[p(" 附件1 ")])),default:a(()=>{var e;return[d.value.re1?(m(),I("span",Nt,"文件别名"+c(d.value.re1),1)):D("",!0),d.value.fl1?(m(),I("span",qt,c((e=d.value.fl1)==null?void 0:e.split("?")[1]),1)):D("",!0)]}),_:1}),t(h,null,{label:a(()=>n[30]||(n[30]=[p(" 附件2 ")])),default:a(()=>{var e;return[d.value.re2?(m(),I("span",Pt,"文件别名"+c(d.value.re2),1)):D("",!0),d.value.fl2?(m(),I("span",It,c((e=d.value.fl2)==null?void 0:e.split("?")[1]),1)):D("",!0)]}),_:1}),t(h,null,{label:a(()=>n[31]||(n[31]=[p(" 附件3 ")])),default:a(()=>{var e;return[d.value.re3?(m(),I("span",$t,"文件别名"+c(d.value.re3),1)):D("",!0),d.value.fl3?(m(),I("span",Rt,c((e=d.value.fl3)==null?void 0:e.split("?")[1]),1)):D("",!0)]}),_:1}),t(h,null,{label:a(()=>n[32]||(n[32]=[p(" 附件4 ")])),default:a(()=>{var e;return[d.value.re4?(m(),I("span",Bt,"文件别名"+c(d.value.re4),1)):D("",!0),d.value.fl4?(m(),I("span",At,c((e=d.value.fl4)==null?void 0:e.split("?")[1]),1)):D("",!0)]}),_:1})]),_:1})]),_:1},8,["show"])])}}});export{Xt as default};
