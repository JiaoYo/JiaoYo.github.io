import{_ as Z}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DdpxrVbZ.js";import{_ as ee}from"./refresh-DGnxzbIJ.js";import{d as U,m as W,n as ae,q as Q,C as I,o as O,c as G,w as i,g as l,D as V,h as P,t as K,i as r,$ as L,E as te,I as le,B as E,M,N as ne,ac as X,cI as oe,a3 as se,j as h,aw as re,f as D,a9 as ie,al as F,S as Y,ak as ce,O as ue,P as de,Q as pe,a2 as ve,V as me,r as j,e as _e,aB as J,aK as fe,aM as ye,at as he}from"./index-DLQv0xE2.js";import{a as ge,c as xe,d as be,e as q,g as we}from"./reportForm-xxvjNrTv.js";import{u as ke}from"./table-Dfen2niS.js";import{_ as Ne,a as Ce,b as Se}from"./lodash-DOLyDuOK.js";import{_ as Pe}from"./round-refresh-Cl_pKSM5.js";import{_ as Te}from"./Grid-AjTJLB13.js";import{T as $e}from"./task-m7Q_ih11.js";import{_ as Re,a as De,b as ze,c as Ae}from"./file-pdf-BV9u2wCn.js";import{N as H}from"./Popconfirm-G8CimJZQ.js";import"./echarts.vue_vue_type_script_setup_true_lang-BQ7hFWvN.js";import"./installCanvasRenderer-C5I8hfFY.js";import"./install-Bh99ifQ7.js";const Ee=U({name:"ReportSearch",__name:"report-search",props:{model:{required:!0},modelModifiers:{}},emits:W(["reset","search"],["update:model"]),setup(y,{emit:T}){const $=T,{formRef:o,restoreValidation:f}=ae(),v=Q(y,"model"),R=()=>{v.value.fuzzy="",g()};async function S(){await f(),$("reset")}async function g(){$("search")}const x=Ne.debounce(g,1e3,{leading:!0,trailing:!1});return(b,_)=>{const w=le,p=Ce,c=Pe,t=E,a=Se,e=M,u=Te,z=ne,A=X,k=I("no-space");return O(),G(A,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[l(z,{ref_key:"formRef",ref:o,model:v.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(r(x),["enter"])},{default:i(()=>[l(u,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:i(()=>[l(p,{span:"24 s:12 m:8 l:6",label:"实例名称",path:"alatype"},{default:i(()=>[V(l(w,{autofocus:"",value:v.value.fuzzy,"onUpdate:value":_[0]||(_[0]=s=>v.value.fuzzy=s),placeholder:"请输入实例名称关键字",clearable:"",onClear:R},null,8,["value"]),[[k]])]),_:1}),l(p,{span:"24 s:12 m:8 l:6"},{default:i(()=>[l(e,{class:"w-full"},{default:i(()=>[l(t,{onClick:S},{icon:i(()=>[l(c,{class:"text-icon"})]),default:i(()=>[P(" "+K(r(L)("common.reset")),1)]),_:1}),l(t,{type:"primary",ghost:"",onClick:r(x)},{icon:i(()=>[l(a,{class:"text-icon"})]),default:i(()=>[P(" "+K(r(L)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Be=y=>(ue("data-v-8b41cd07"),y=y(),de(),y),Ie=Be(()=>D("span",{class:"mr-20px"},"报表预览",-1)),Ve={title:"导出PDF"},Me={title:"导出Word"},Oe={title:"导出Excel"},Le=U({name:"reportPreview",__name:"reportPreview",props:W({data:{},detaliParams:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(y){oe(p=>({"9c0be284":r($)}));const T=se(),$=T.themeScheme=="dark"?"#001428":"#fff",o=y,f=Q(y,"visible"),v=h([]),R=async p=>{const{data:c,error:t}=await ge({rtype:p});t||(c.forEach(a=>{a.rtext=JSON.parse(a.rtext)}),v.value=c[0].rtext)},S=["提示","低危","中危","高危","致命"],g=["lev0","lev1","lev2","lev3","lev4"],x=h(),b=h(""),_=async()=>{var p,c;o.detaliParams.rtype=1,await R(0),b.value=((c=(p=v.value)==null?void 0:p.find(t=>t.type=="title"))==null?void 0:c.value)+"报表"+F(1,new Date),v.value.forEach(t=>{if(t.type=="table"){if(t.dataName=="collection"&&(t.value.body=o.data.collection.map(a=>t.value.tableHeaderValue.map(e=>e=="ctime"?F(1,a[e]):a[e]))),t.dataName=="events"){const a=o.data.events.filter(e=>e.cname);t.value.body=a.map(e=>t.value.tableHeaderValue.map(u=>e[u]))}if(t.dataName=="level"){const a=o.data.level.filter(e=>e.logname);t.value.body=a.map(e=>t.value.tableHeaderValue.map(u=>e[u]))}if(t.dataName=="level1"){if(o.data.level.length==0)return t.value.body=[];t.value.body=g.map(a=>[a=="lev0"?"提示":a=="lev1"?"低危":a=="lev2"?"中危":a=="lev3"?"高危":"致命",o.data.level.reduce((e,u)=>e+(Number(u[a])||0),0)])}}if(t.type=="chart"&&t.dataName=="events"){const a=o.data.events.filter(e=>e.cname);t.value.chartType=="bar"&&(t.value.data.series[0].data=a.map(e=>e.count),t.value.data.xAxis.type=="category"?t.value.data.xAxis.data=a.map(e=>e.cname):t.value.data.yAxis.data=a.map(e=>e.cname)),t.value.chartType=="pie"&&(t.value.data.series[0].data=a.map(e=>({value:e.count,name:e.cname}))),t.value.chartType=="line"&&(t.value.data.series[0].data=a.map(e=>e.count),t.value.data.xAxis.data=a.map(e=>e.cname))}if(t.dataName=="level"){const a=o.data.level.filter(e=>e.logname);t.value.chartType=="bar"&&(t.value.data.series[0].data=a.map(e=>e.count),t.value.data.xAxis.type=="category"?t.value.data.xAxis.data=a.map(e=>e.logname):t.value.data.yAxis.data=a.map(e=>e.logname)),t.value.chartType=="pie"&&(t.value.data.series[0].data=a.map(e=>({value:e.count,name:e.logname}))),t.value.chartType=="line"&&(t.value.data.series[0].data=a.map(e=>e.count),t.value.data.xAxis.data=a.map(e=>e.logname))}t.dataName=="level1"&&(t.value.chartType=="bar"&&(t.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(a=>o.data.level.reduce((e,u)=>e+(Number(u[a])||0),0)),t.value.data.xAxis.type=="category"?t.value.data.xAxis.data=S:t.value.data.yAxis.data=S),t.value.chartType=="pie"&&(t.value.data.series[0].data=[{value:o.data.level.reduce((a,e)=>a+e.lev0*1,0)==0?null:o.data.level.reduce((a,e)=>a+e.lev0*1,0),name:"提示"},{value:o.data.level.reduce((a,e)=>a+e.lev1*1,0)==0?null:o.data.level.reduce((a,e)=>a+e.lev1*1,0),name:"低危"},{value:o.data.level.reduce((a,e)=>a+e.lev2*1,0)==0?null:o.data.level.reduce((a,e)=>a+e.lev2*1,0),name:"中危"},{value:o.data.level.reduce((a,e)=>a+e.lev3*1,0)==0?null:o.data.level.reduce((a,e)=>a+e.lev3*1,0),name:"高危"},{value:o.data.level.reduce((a,e)=>a+e.lev4*1,0)==0?null:o.data.level.reduce((a,e)=>a+e.lev4*1,0),name:"致命"}]),t.value.chartType=="line"&&(t.value.data.series[0].data=["lev0","lev1","lev2","lev3","lev4"].map(a=>o.data.level.reduce((e,u)=>e+(Number(u[a])||0),0)),t.value.data.xAxis.data=S))}),x.value=v.value};re(f,()=>{f.value&&_()});const w=h();return(p,c)=>{const t=Re,a=De,e=ze,u=Ae,z=Y,A=ce;return O(),G(A,{show:f.value,"onUpdate:show":c[3]||(c[3]=k=>f.value=k),preset:"card",class:"w-1000px reportPreview",style:ie({"background-color":r(T).themeScheme=="dark"?"#001428":"#fff"})},{header:i(()=>[Ie,D("span",Ve,[l(t,{class:"text-32px c-#d63031 cursor-pointer",onClick:c[0]||(c[0]=k=>w.value.toPdf(b.value))})]),D("span",Me,[l(a,{class:"text-32px c-#1e90ff cursor-pointer",onClick:c[1]||(c[1]=k=>w.value.toWord(b.value))})]),D("span",Oe,[l(e,{class:"text-32px c-#15703d cursor-pointer",onClick:c[2]||(c[2]=k=>w.value.toExcel(b.value))})])]),default:i(()=>[l(z,{class:"max-h-600px"},{default:i(()=>[(O(),G(u,{key:x.value,ref_key:"filePreviewExportRef",ref:w,width:800,data:x.value},null,8,["data"]))]),_:1})]),_:1},8,["show","style"])}}}),Ge=pe(Le,[["__scopeId","data-v-8b41cd07"]]),Ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ue=D("div",{style:{display:"flex","align-items":"center"}},[D("div",null,"报表实例")],-1),na=U({name:"reportmanagement_reportlist",__name:"index",setup(y){const T=ve(),{columns:$,columnChecks:o,data:f,getData:v,loading:R,mobilePagination:S,searchParams:g,resetSearchParams:x}=ke({apiFn:xe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"expand",width:50,expandable:s=>!0,renderExpand:s=>l("div",{class:"detailList"},[l(Y,{style:"max-height: 360px"},{default:()=>[p.value.length>0?p.value.map((n,d)=>l(M,{justify:"space-between",style:{marginBottom:"8px",padding:"0px 50px 8px 50px",borderBottom:d!==p.value.length-1?"1px dashed #ccc":"none"},key:n.sn},{default:()=>[l("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}},[n.sn]),l(M,null,{default:()=>[V(l(E,{type:"info",size:"small",ghost:!0,onClick:()=>z(n.sn,s.rtype)},{default:()=>[P("查看")]}),[[I("no-auth"),"sys.report.instance.select"]]),l(H,{onPositiveClick:()=>k(n.sn,s.rtype,s.tid)},{default:()=>"确定要删除该数据吗？",trigger:()=>V(l(E,{type:"error",size:"small",ghost:!0},{default:()=>[P("删除")]}),[[I("no-auth"),"sys.report.instance.delete"]])})]})]})):l("div",{style:{textAlign:"center",padding:"10px"}},[P("暂无数据")])]})])},{key:"rname",title:"实例名称",align:"center",width:160},{key:"rtype",title:"实例类型",align:"center",width:160,render:s=>{var n;return l("div",null,[(n=me($e).find(d=>d.value===s.rtype))==null?void 0:n.label])}},{key:"num",title:"实例数量",align:"center",width:160},{key:"operate",title:L("common.operate"),align:"center",width:160,render:s=>l("div",{class:"flex-center gap-8px"},[l(H,{onPositiveClick:()=>A(s.tid,s.rtype)},{default:()=>"确定要清空该数据吗？",trigger:()=>V(l(E,{type:"primary",ghost:!0,size:"small"},{default:()=>[P("清空")]}),[[I("no-auth"),"sys.report.instance.delete"]])})])}]}),b=h(null),_=h([]),w=async s=>{_.value=[s[s.length-1]],_.value[0]&&(p.value=[],await t());const n=f.value.findIndex(d=>d.tid===s[s.length-1]);setTimeout(()=>{var d;(d=b.value)==null||d.scrollTo({top:n*40,behavior:"smooth"})},500)},p=h([]),c=j({page:1,limit:10}),t=async()=>{const s=JSON.parse(JSON.stringify(f.value)).find(m=>m.tid===_.value[0]),{data:n,error:d}=await we({tid:_.value[0],page:c.page,limit:Number(s.num)||10});d||(p.value=n.list,ye(()=>{const m=document.querySelector(".detailList");if(m){const{height:N}=m.getBoundingClientRect();m.animate([{height:"0px"},{height:`${N}px`}],{duration:300,easing:"linear"})}}))},a=h(!1),e=h({}),u=j({name:"",rtype:0}),z=async(s,n)=>{const{data:d,error:m}=await be({name:s,type:n,tid:_.value[0]});u.name=s,u.rtype=n,m||(a.value=!0,e.value=JSON.parse(d))},A=async(s,n)=>{var N;const{data:d,error:m}=await q({tid:s,type:n});m||((N=window.$message)==null||N.success("清空成功"),p.value=[],v())},k=async(s,n,d)=>{var B;const{data:m,error:N}=await q({fname:s,type:n,tid:d});N||((B=window.$message)==null||B.success("删除成功"),v(),t())};return(s,n)=>{const d=ee,m=Z,N=he,B=X;return O(),_e("div",Ke,[l(Ee,{model:r(g),"onUpdate:model":n[0]||(n[0]=C=>J(g)?g.value=C:null),onReset:r(x),onSearch:r(v)},null,8,["model","onReset","onSearch"]),l(B,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:i(()=>[Ue]),"header-extra":i(()=>[l(r(M),null,{default:i(()=>[l(r(E),{size:"small",onClick:n[1]||(n[1]=C=>r(v)())},{icon:i(()=>[l(d,{class:fe(["text-icon",{"animate-spin":r(R)}])},null,8,["class"])]),default:i(()=>[P(" "+K(r(L)("common.refresh")),1)]),_:1}),l(m,{columns:r(o),"onUpdate:columns":n[2]||(n[2]=C=>J(o)?o.value=C:null)},null,8,["columns"])]),_:1})]),default:i(()=>[l(N,{ref_key:"tableContainer",ref:b,columns:r($),data:r(f),size:"small","flex-height":!r(T).isMobile,"scroll-x":962,loading:r(R),remote:"","row-key":C=>C.tid,pagination:r(S),class:"sm:h-full","expanded-row-keys":_.value,"onUpdate:expandedRowKeys":w},null,8,["columns","data","flex-height","loading","row-key","pagination","expanded-row-keys"]),l(Ge,{visible:a.value,"onUpdate:visible":n[3]||(n[3]=C=>a.value=C),data:e.value,detaliParams:u},null,8,["visible","data","detaliParams"])]),_:1})])}}});export{na as default};
