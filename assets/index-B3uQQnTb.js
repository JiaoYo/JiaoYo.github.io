import{_ as ft}from"./table-column-setting.vue_vue_type_script_setup_true_lang-1xkiS0kT.js";import{_ as bt}from"./export-Dh2VIFyh.js";import{_ as vt}from"./round-delete-D4nIF9VA.js";import{_ as yt}from"./round-add-CYQ1ae4I.js";import{_ as ht}from"./round-search-s7SA5XFz.js";import{d as dt,p as ot,q as gt,r as St,s as wt,v as Dt,ab as lt,b as Ot,$ as c,o as H,c as et,w as a,g as t,h as f,t as j,i as s,ei as kt,ej as Ct,b1 as xt,aU as jt,P as W,aV as Ut,Q as pt,B as D,aJ as Et,k as it,x as Nt,ek as Tt,aw as Q,N as Mt,A as V,z as Y,el as st,e as $t,af as Z,aN as tt,aO as Pt,em as Ft,aT as Bt,a6 as qt,_ as It}from"./index-l6uRvD6G.js";import{u as zt,a as Qt}from"./table-B2r-0quL.js";import{M as Vt}from"./shield-question-outline-rounded-BjYFXdZL.js";import{e as Ht}from"./exportExcel-Bv4G4H50.js";import{_ as ct}from"./DatePicker-DnMg5Hoe.js";import{_ as mt}from"./FormItemGridItem-Bv-LD8wi.js";import{_ as _t}from"./Grid-CIemVqmw.js";import{_ as Wt}from"./lodash-Bh616pQ3.js";import{N as rt}from"./Popconfirm-lVd5wiwm.js";const Rt=dt({__name:"siteModel",props:ot({operateType:{},rowData:{},unitObj:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ot(["submitted"],["update:visible"]),setup(h,{emit:u}){const g=gt(h,"visible"),U=u,l=h,n=St(O());function O(){return{dbtime:void 0,stationP:void 0,stationQ:void 0,stationS:void 0,stationCOS:void 0,stationU:void 0,stationI:void 0,stationFreq:void 0,stationDayE:void 0,stationTotalE:void 0,stationControlled:0}}function S(){Object.assign(n,O()),l.operateType==="edit"&&l.rowData&&(Object.assign(n,l.rowData),n.dbtime=n.dbtime.replace(/:00$/,""))}const{formRef:R,validate:x,restoreValidation:at}=wt();Dt(),lt(()=>l.rowData,()=>{S()}),lt(g,()=>{g.value&&(S(),at())});const k=()=>{g.value=!1},A=async()=>{var i;await x();const w=JSON.parse(JSON.stringify(n));if(w.dbtime=w.dbtime+":00",l.operateType==="add"){const{data:C,error:p}=await kt([w]);if(p)return}else{const{data:C,error:p}=await Ct([w]);if(p)return}(i=window.$message)==null||i.success(l.operateType==="add"?"添加成功":"修改成功"),k(),U("submitted")},G={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},E={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},J={dbtime:G,ratpower:E,devid:E},y=Ot(()=>({add:c("common.add"),edit:c("common.edit")})[l.operateType]);return(w,i)=>{const C=ct,p=mt,_=xt,N=jt,K=W,T=Ut,L=_t,X=pt,M=D,e=W,o=Et;return H(),et(o,{show:g.value,"onUpdate:show":i[11]||(i[11]=r=>g.value=r),title:y.value,preset:"card",class:"w-50%"},{footer:a(()=>[t(e,{size:16,justify:"center"},{default:a(()=>[t(M,{onClick:k,class:"w-100px"},{default:a(()=>[f(j(s(c)("common.cancel")),1)]),_:1}),t(M,{type:"primary",class:"w-100px",onClick:A},{default:a(()=>[f(j(s(c)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(X,{ref_key:"formRef",ref:R,model:n,rules:J,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:a(()=>[t(L,{responsive:"screen","item-responsive":""},{default:a(()=>{var r,b,m,$,P,F,B,q,I,z;return[t(p,{span:"24 m:12",label:"数据更新时间",path:"dbtime"},{default:a(()=>[t(C,{"formatted-value":n.dbtime,"onUpdate:formattedValue":i[0]||(i[0]=d=>n.dbtime=d),"value-format":"yyyy-MM-dd HH:mm",type:"datetime",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),t(p,{span:"24 m:12",label:"总有功功率"+((r=l.unitObj)!=null&&r.StationP?"("+l.unitObj.StationP+")":"(MW)"),path:"stationP"},{default:a(()=>[t(_,{clearable:"",value:n.stationP,"onUpdate:value":i[1]||(i[1]=d=>n.stationP=d),placeholder:"请输入",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总无功功率"+((b=l.unitObj)!=null&&b.StationQ?"("+l.unitObj.StationQ+")":"(MVar)"),path:"stationQ"},{default:a(()=>[t(_,{clearable:"",value:n.stationQ,"onUpdate:value":i[2]||(i[2]=d=>n.stationQ=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总视在功率"+((m=l.unitObj)!=null&&m.StationS?"("+l.unitObj.StationS+")":"(MW)"),path:"stationS"},{default:a(()=>[t(_,{clearable:"",value:n.stationS,"onUpdate:value":i[3]||(i[3]=d=>n.stationS=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总功率因数"+((($=l.unitObj)==null?void 0:$.StationCOS)=="-"?"":(P=l.unitObj)!=null&&P.StationCOS?"("+l.unitObj.StationCOS+")":""),path:"stationCOS"},{default:a(()=>[t(_,{clearable:"",value:n.stationCOS,"onUpdate:value":i[4]||(i[4]=d=>n.stationCOS=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总电压"+((F=l.unitObj)!=null&&F.StationU?"("+l.unitObj.StationU+")":"(V)"),path:"stationU"},{default:a(()=>[t(_,{clearable:"",value:n.stationU,"onUpdate:value":i[5]||(i[5]=d=>n.stationU=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总电流"+((B=l.unitObj)!=null&&B.StationI?"("+l.unitObj.StationI+")":"(A)"),path:"stationI"},{default:a(()=>[t(_,{clearable:"",value:n.stationI,"onUpdate:value":i[6]||(i[6]=d=>n.stationI=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"频率"+((q=l.unitObj)!=null&&q.StationFreq?"("+l.unitObj.StationFreq+")":"(Hz)"),path:"stationFreq"},{default:a(()=>[t(_,{clearable:"",value:n.stationFreq,"onUpdate:value":i[7]||(i[7]=d=>n.stationFreq=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"日发电量"+((I=l.unitObj)!=null&&I.StationDayE?"("+l.unitObj.StationDayE+")":"(MWh)"),path:"stationDayE"},{default:a(()=>[t(_,{clearable:"",value:n.stationDayE,"onUpdate:value":i[8]||(i[8]=d=>n.stationDayE=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"总发电量"+((z=l.unitObj)!=null&&z.StationTotalE?"("+l.unitObj.StationTotalE+")":"(MWh)"),path:"stationTotalE"},{default:a(()=>[t(_,{clearable:"",value:n.stationTotalE,"onUpdate:value":i[9]||(i[9]=d=>n.stationTotalE=d),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),t(p,{span:"24 m:12",label:"是否限电",path:"stationControlled"},{default:a(()=>[t(T,{value:n.stationControlled,"onUpdate:value":i[10]||(i[10]=d=>n.stationControlled=d),name:"radiogroup"},{default:a(()=>[t(K,null,{default:a(()=>[t(N,{label:s(c)("common.yesOrNo.yes"),value:1},null,8,["label"]),t(N,{label:s(c)("common.yesOrNo.no"),value:0},null,8,["label"])]),_:1})]),_:1},8,["value"])]),_:1})]}),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),At={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ut(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Pt(h)}const Gt=dt({name:"realtimequery_sitehistoryquery",__name:"index",setup(h){const u=it(),g=async()=>{const{data:e,error:o}=await Ft();o||(u.value=e)};Nt(()=>{g(),l.value.forEach(e=>{typeof e.title=="function"&&(e.title=e.title().children[0])})});const{columns:U,columnChecks:l,data:n,getData:O,loading:S,mobilePagination:R,searchParams:x,resetSearchParams:at}=zt({apiFn:Tt,apiParams:{page:1,limit:20,pageSize:20,startTime:Q(1,Date.now()-864e5*3)||null,endTime:Q(1,Date.now())||null,_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",width:50,disabled:e=>e.mtype==1},{key:"dbtime",title:()=>t("span",null,["更新时间",t(Mt,{trigger:"hover",placement:"top","content-style":"padding: 5px;"},{default:()=>t("span",null,[f("表格中有标识 "),t("span",{class:"c-#ff6f00"},[f("※")]),f(" 的为人工补录数据")]),trigger:()=>t(Vt,{class:"text-xl cursor-pointer c-#7a7b78"},null)})]),align:"center",width:200,render(e){return t("span",{style:{color:e.mtype==0?"#ff6f00":""}},[t("span",null,[e.mtype==0?"※":""]),f(" "),e.dbtime])}},{key:"stationP",title:()=>{var e;return t("span",null,[`总有功功率${(e=u.value)!=null&&e.StationP?"("+u.value.StationP+")":"(MW)"}`])},align:"center",width:120},{key:"stationQ",title:()=>{var e;return t("span",null,[`总无功功率${(e=u.value)!=null&&e.StationQ?"("+u.value.StationQ+")":"(MW)"}`])},align:"center",width:140},{key:"stationS",title:()=>{var e;return t("span",null,[`总视在功率${(e=u.value)!=null&&e.StationS?"("+u.value.StationS+")":"(MW)"}`])},align:"center",width:140},{key:"stationCOS",title:()=>{var e,o;return t("span",null,[`总功率因数${((e=u.value)==null?void 0:e.StationCOS)=="-"?"":(o=u.value)!=null&&o.StationCOS?"("+u.value.StationCOS+")":""}`])},align:"center",width:100},{key:"stationU",title:()=>{var e,o;return t("span",null,[`总电压${(e=u.value)!=null&&e.StationU?"("+((o=u.value)==null?void 0:o.StationU)+")":"(V)"}`])},align:"center",width:100},{key:"stationI",title:()=>{var e,o;return t("span",null,[`总电流${(e=u.value)!=null&&e.StationI?"("+((o=u.value)==null?void 0:o.StationI)+")":"(A)"}`])},align:"center",width:100},{key:"stationFreq",title:()=>{var e;return t("span",null,[`频率${(e=u.value)!=null&&e.StationFreq?"("+u.value.StationFreq+")":"(Hz)"}`])},align:"center",width:100},{key:"stationDayE",title:()=>{var e;return t("span",null,[`日发电量${(e=u.value)!=null&&e.StationDayE?"("+u.value.StationDayE+")":"(MWh)"}`])},align:"center",width:120},{key:"stationTotalE",title:()=>{var e;return t("span",null,[`总发电量${(e=u.value)!=null&&e.StationTotalE?"("+u.value.StationTotalE+")":"(MWh)"}`])},align:"center",width:140},{key:"stationControlled",title:"是否限电",align:"center",width:140,render:e=>t("span",null,[e.stationControlled?e.stationControlled==1?"是":"否":""])},{key:"operate",title:c("common.operate"),align:"center",width:200,fixed:"right",render:e=>{let o;return t("div",{class:"flex-center gap-8px"},[e.mtype==0?t(W,null,{default:()=>[V(t(D,{type:"primary",ghost:!0,size:"small",onClick:()=>K(e.id)},ut(o=c("common.edit"))?o:{default:()=>[o]}),[[Y("no-auth"),"station:his:update"]]),V(t(rt,{onPositiveClick:()=>N(e.id)},{default:()=>c("common.confirmDelete"),trigger:()=>{let r;return t(D,{type:"error",ghost:!0,size:"small"},ut(r=c("common.delete"))?r:{default:()=>[r]})}}),[[Y("no-auth"),"station:his:delete"]])]}):""])}}]}),{drawerVisible:k,operateType:A,editingData:G,handleAdd:E,handleEdit:J,checkedRowKeys:y,onBatchDeleted:w,onDeleted:i}=Qt(n,O),C=()=>{O()},p=Wt.debounce(C,1e3,{leading:!0,trailing:!1}),_=async()=>{const e=y.value.join(","),{data:o,error:r}=await st({ids:e});r||(i(),y.value=[])},N=async e=>{const{data:o,error:r}=await st({ids:e});r||i()},K=e=>{J(e)},T=it([Date.now()-864e5*3,Date.now()]);async function L(e,o){x.startTime=Q(1,o[0]),x.endTime=Q(1,o[1]),O()}const X=()=>{const e={};U.value.forEach(r=>{r.key!="index"&&r.key!="operate"&&r.type!=="selection"&&(e[r.key]=typeof r.title=="string"?r.title:r.title().children[0])});const o=[];n.value.forEach(r=>{const b=JSON.parse(JSON.stringify(e));for(const m in b)r.hasOwnProperty(m)?m=="stationControlled"?b[m]=r[m]==1?"是":"否":b[m]=r[m]:b[m]="";o.push(b)}),Ht(o,e,"站点历史数据")},M={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()]};return(e,o)=>{const r=ct,b=ht,m=mt,$=_t,P=pt,F=yt,B=vt,q=bt,I=ft,z=Bt,d=qt,nt=Y("no-auth");return H(),$t("div",At,[t(d,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t(P,{ref:"formRef",model:s(x),"label-placement":"left","show-feedback":!1},{default:a(()=>[t($,{"y-gap":16,responsive:"screen","item-responsive":""},{default:a(()=>[t(m,{span:"24 s:18 m:18",label:"起止时间",path:"startTime"},{default:a(()=>[t(r,{value:T.value,"onUpdate:value":o[0]||(o[0]=v=>T.value=v),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":L,shortcuts:M,"default-time":["00:00:00","23:59:59"]},null,8,["value"]),t(s(D),{type:"primary",ghost:"",onClick:s(p),class:"ml-20px"},{icon:a(()=>[t(b,{class:Z(["text-icon",{"animate-spin":s(S)}])},null,8,["class"])]),default:a(()=>[f(" "+j(s(c)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model"])]),"header-extra":a(()=>[t(s(W),{justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[V((H(),et(s(D),{onClick:s(E),size:"small",ghost:"",type:"primary"},{icon:a(()=>[t(F,{class:Z(["text-icon",{"animate-spin":s(S)}])},null,8,["class"])]),default:a(()=>[f(" "+j(s(c)("common.add")),1)]),_:1},8,["onClick"])),[[nt,"station:his:insert"]]),V((H(),et(s(rt),{onPositiveClick:_},{trigger:a(()=>[t(s(D),{size:"small",ghost:"",type:"error",disabled:s(y).length==0},{icon:a(()=>[t(B,{class:Z(["text-icon",{"animate-spin":s(S)}])},null,8,["class"])]),default:a(()=>[f(" "+j(s(c)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:a(()=>[f(" 确认删除选中的项吗？ ")]),_:1})),[[nt,"station:his:delete"]]),t(s(D),{onClick:X,size:"small"},{icon:a(()=>[t(q,{class:"text-icon"})]),default:a(()=>[f(" 导出当前页 ")]),_:1}),t(I,{columns:s(l),"onUpdate:columns":o[1]||(o[1]=v=>tt(l)?l.value=v:null)},null,8,["columns"])]),_:1})]),default:a(()=>[t(z,{"checked-row-keys":s(y),"onUpdate:checkedRowKeys":o[2]||(o[2]=v=>tt(y)?y.value=v:null),columns:s(U),data:s(n),size:"small",loading:s(S),remote:"","row-key":v=>v.id,pagination:s(n).length?s(R):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1}),t(Rt,{visible:s(k),"onUpdate:visible":o[3]||(o[3]=v=>tt(k)?k.value=v:null),onSubmitted:C,"operate-type":s(A),"row-data":s(G),unitObj:u.value},null,8,["visible","operate-type","row-data","unitObj"])])}}}),re=It(Gt,[["__scopeId","data-v-b7ae27f0"]]);export{re as default};
