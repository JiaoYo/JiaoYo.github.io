import{_ as Je}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Dhg0eR-W.js";import{_ as Ke}from"./round-delete-Dcb1LZzL.js";import{_ as We}from"./round-add-Dz0el9GS.js";import{d as xe,at as De,q as Se,v as Qe,r as J,s as Ue,a as Xe,av as Pe,aw as qe,c as S,o as f,w as a,f as t,ax as Ye,G as Ie,z as x,h as r,az as ne,C as M,b as R,g as p,e as k,t as c,aA as Ze,B as j,aB as et,N as Ne,$ as K,aE as Re,b4 as tt,aH as ye,cq as at,cp as lt,cr as $e,aJ as nt,cs as Be,ct as st,a_ as Fe,aN as Ae,F as ot,U as Le,M as rt,i as ut,y as G,aO as he,ay as it,D as L,aP as dt,aC as pt,aF as be,cu as je,cv as ct,aU as ft}from"./index-y_CfkRcC.js";import{u as mt,a as gt}from"./table-a5v64lUL.js";import{u as _e}from"./usePageData-Bc0LzTXb.js";import{_ as Me}from"./Grid-Ds6V98x7.js";import{_ as Oe}from"./FormItemGridItem-B1TTqIMk.js";import{N as vt}from"./DatePicker-Bu8vMptQ.js";import{_ as bt}from"./round-search-D3YN4W0D.js";import{_ as yt}from"./round-refresh-DKHPTPf0.js";import{_ as _t,a as ht}from"./DescriptionsItem-wLYZ76DO.js";import{N as le}from"./Popconfirm-dwqbpujW.js";import{N as kt}from"./RadioButton-r44F7e_q.js";const wt={key:0,style:{"margin-left":"20px"}},Ct={key:0,style:{"margin-left":"20px"}},Tt={key:0,style:{"margin-left":"20px"}},Dt={key:0,style:{"margin-left":"20px"}},xt=xe({name:"OperateDrawer",__name:"operate-drawer",props:De({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:De(["submitted"],["update:visible"]),setup(B,{emit:se}){const z=se,N=Se(),b=B,l=Qe(O());function O(){return{pid:void 0,id:"",debugname:"",docker:void 0,dockcharge:"",dockcontact:"",status:0,notes:"",debugresult:0,dtype:void 0,starttime:null,endtime:null,dbcreater:void 0,startAndTimeRange:void 0,re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const{pageData:F,getData:m,nextPage:P}=_e(tt),$=async()=>{await m({usertypes:"2,3"})},W=async o=>{const e=o.currentTarget,u=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&F.data.length<F.total&&(await P(),await ye(),setTimeout(()=>{e.scrollTop=u}))},{pageData:y,getData:Q,nextPage:oe}=_e(at),re=async o=>{const e=o.currentTarget,u=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&y.data.length<y.total&&(await oe(),y.data=y.data.map(C=>({...C,value:C.docker+"&id="+C.id})),await ye(),setTimeout(()=>{e.scrollTop=u}))},ue=async()=>{await Q({pid:l.pid}),y.data=y.data.map(o=>({...o,value:o.docker+"&id="+o.id}))},ie=async o=>{var e;if(l.docker=o,l.docker){const[u,C]=(e=l.docker)==null?void 0:e.split("&id="),D=y.data.find(ve=>ve.docker==u&&ve.id==C);D?(l.dockcharge=D.pname,l.dockcontact=D.pcontact):(l.dockcharge="",l.dockcontact="")}},{pageData:q,getData:X,nextPage:de}=_e(lt),pe=async o=>{const e=o.currentTarget,u=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&q.data.length<q.total&&(await de(),await ye(),setTimeout(()=>{e.scrollTop=u}))},Y=async()=>{await X()},_=J([]),{pageData:g,getData:I,nextPage:H}=_e($e),V=async o=>{const e=o.currentTarget,u=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&g.data.length<g.total&&(await H(),_.value=g.data,await ye(),setTimeout(()=>{e.scrollTop=u}))},Z=async()=>{await I({fuzzy:N.userInfo.pname,page:1}),_.value=g.data},ee=async()=>{await I({page:1}),_.value=g.data},ce=async o=>{l.pid=o},fe=J(void 0);async function me(){var o;Z(),Y(),$(),Object.assign(l,O()),b.operateType==="add"&&(l.pid=Number(b.pid)),b.operateType==="edit"&&b.rowData&&(Object.assign(l,b.rowData),fe.value=l.status,l.docker=(o=l.docker)==null?void 0:o.split("&id=")[0],b.rowData.starttime&&b.rowData.endtime?l.startAndTimeRange=[b.rowData.starttime,b.rowData.endtime]:l.startAndTimeRange=null),ue()}const{formRef:d,validate:E,restoreValidation:A}=Ue(),s={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dbcreater:{type:"string",required:!0,trigger:["blur","change"],message:"请选择"},debugname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcharge:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},dockcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"}},n=Xe(()=>({add:"新增待调试业务",edit:"修改待调试业务"})[b.operateType]),T=Pe(B,"visible");qe(T,()=>{T.value&&(me(),setTimeout(()=>{const o=document.querySelector(".n-scrollbar-content");o==null||o.scrollTo(0,0)},300),A())});const v=J(0),w=J("");async function te({file:o},e){v.value=0,w.value=e;const u=await nt(o.file,o.name,"",C=>{v.value=C});u&&(l[e]=u,v.value=0)}function ge(){T.value=!1}async function ae(o){if(o)try{const u=await(await fetch(o==null?void 0:o.split("?")[0],{mode:"cors"})).blob(),C=URL.createObjectURL(u),D=document.createElement("a");D.href=C,D.download=o==null?void 0:o.split("?")[1],D.style.display="none",document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(C)}catch(e){console.error("下载失败:",e)}}async function ke(){var o;await E(),(o=window.$dialog)==null||o.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await we()}})}async function we(){var o,e;if(await E(),b.operateType==="edit"){const u=JSON.parse(JSON.stringify(l)),{data:C,error:D}=await Be([u]);D||(ge(),z("submitted"),(o=window.$message)==null||o.success("修改成功"))}else{const{data:u,error:C}=await st([{...l}]);C||(ge(),z("submitted"),(e=window.$message)==null||e.success("添加成功"))}}async function h(o){var e;return o.file.file.size>100*1024*1024?((e=window.$message)==null||e.error("文件大小不能超过100M"),!1):!0}const Ce=o=>{var e;l.debugname=(e=q.data.find(u=>u.id==o))==null?void 0:e.tname,l.dtype=o};async function Te(o,e){l.startAndTimeRange=o,l.starttime=o==null?void 0:o[0],l.endtime=o==null?void 0:o[1]}return(o,e)=>{const u=Oe,C=Ze,D=et,ve=Me,He=Ie,Ve=Ye,Ee=Ne,Ge=Re;return f(),S(Ge,{show:T.value,"onUpdate:show":e[22]||(e[22]=i=>T.value=i),title:n.value,preset:"card",class:"w-800px"},{footer:a(()=>[t(Ee,{justify:"end",size:16},{default:a(()=>[t(r(j),{onClick:ge},{default:a(()=>[p(c(r(K)("common.cancel")),1)]),_:1}),t(r(j),{type:"primary",onClick:ke},{default:a(()=>[p(c(r(K)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[t(Ve,{class:"pr-20px"},{default:a(()=>[t(He,{ref_key:"formRef",ref:d,model:l,rules:s,"label-placement":"left","label-width":120},{default:a(()=>[t(ve,{responsive:"screen","item-responsive":""},{default:a(()=>[t(u,{span:"24 m:12",label:"项目列表",path:"pid"},{default:a(()=>[t(r(ne),{filterable:"",clearable:"",value:l.pid,"onUpdate:value":[e[0]||(e[0]=i=>l.pid=i),ce],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:ee,options:_.value,onScroll:V},null,8,["value","options"])]),_:1}),t(u,{span:"24 m:12",label:"权重",path:"dtype"},{default:a(()=>[t(r(ne),{filterable:"",value:l.dtype,"onUpdate:value":[e[1]||(e[1]=i=>l.dtype=i),Ce],tag:"",placeholder:"请选择权重","label-field":"tname","value-field":"id",options:r(q).data,onScroll:pe},null,8,["value","options"])]),_:1}),t(u,{span:"24 m:12",label:"业务名称",path:"debugname"},{default:a(()=>[t(r(M),{value:l.debugname,"onUpdate:value":e[2]||(e[2]=i=>l.debugname=i),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"调试人",path:"dbcreater"},{default:a(()=>[t(r(ne),{filterable:"",value:l.dbcreater,"onUpdate:value":e[3]||(e[3]=i=>l.dbcreater=i),placeholder:"请选择调试人","label-field":"username","value-field":"id",options:r(F).data,onScroll:W},null,8,["value","options"])]),_:1}),t(u,{span:"24 m:24",label:"起止时间",path:"startAndTimeRange"},{default:a(()=>[t(r(vt),{clearable:"",value:l.startAndTimeRange,"onUpdate:value":e[4]||(e[4]=i=>l.startAndTimeRange=i),type:"daterange","value-format":"yyyy-MM-dd",style:{width:"100%"},"onUpdate:formattedValue":Te},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"对接方",path:"docker"},{default:a(()=>[t(r(ne),{filterable:"",value:l.docker,"onUpdate:value":[e[5]||(e[5]=i=>l.docker=i),ie],clearable:"",tag:"",placeholder:"请选择或输入对接方","label-field":"docker","value-field":"value",options:r(y).data,onScroll:re},null,8,["value","options"])]),_:1}),t(u,{span:"24 m:12",label:"对接方负责人",path:"dockcharge"},{default:a(()=>[t(r(M),{value:l.dockcharge,"onUpdate:value":e[6]||(e[6]=i=>l.dockcharge=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"联系方式",path:"dockcontact"},{default:a(()=>[t(r(M),{value:l.dockcontact,"onUpdate:value":e[7]||(e[7]=i=>l.dockcontact=i),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),b.operateType=="edit"?(f(),S(u,{key:0,span:"24 m:12",label:"状态",path:"status"},{default:a(()=>[t(r(ne),{clearable:"",value:l.status,"onUpdate:value":e[8]||(e[8]=i=>l.status=i),placeholder:"请选择",options:r(N).userInfo.usertype==0||r(N).userInfo.usertype==2?[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]:[{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2}]},null,8,["value","options"])]),_:1})):x("",!0),t(u,{span:"24 m:12",label:"备注",path:"notes"},{default:a(()=>[t(r(M),{value:l.notes,"onUpdate:value":e[9]||(e[9]=i=>l.notes=i),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:a(()=>[t(ve,{responsive:"screen","item-responsive":""},{default:a(()=>[t(u,{span:"24 m:12",label:"附件1",path:"notes"},{default:a(()=>[t(r(M),{value:l.re1,"onUpdate:value":e[10]||(e[10]=i=>l.re1=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:a(()=>{var i;return[l.fl1?(f(),R("span",wt,[p(c((i=l.fl1)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:e[11]||(e[11]=U=>l.fl1="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[12]||(e[12]=U=>ae(l.fl1))},"下载")])):(f(),S(C,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":U=>te(U,"fl1"),"show-file-list":!1,onBeforeUpload:h},{default:a(()=>[t(r(j),{loading:v.value>0&&!l.fl1&&w.value=="fl1",size:"small",ghost:"",type:"primary"},{default:a(()=>[p(c(v.value>0&&!l.fl1&&w.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),v.value&&!l.fl1&&w.value=="fl1"?(f(),S(D,{key:2,type:"line",percentage:v.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):x("",!0)]}),_:1})]),_:1})]),_:1}),t(u,{span:"24 m:12",label:"附件2",path:"notes"},{default:a(()=>[t(r(M),{value:l.re2,"onUpdate:value":e[13]||(e[13]=i=>l.re2=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:a(()=>{var i;return[l.fl2?(f(),R("span",Ct,[p(c((i=l.fl2)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:e[14]||(e[14]=U=>l.fl2="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[15]||(e[15]=U=>ae(l.fl2))},"下载")])):(f(),S(C,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":U=>te(U,"fl2"),"show-file-list":!1,onBeforeUpload:h},{default:a(()=>[t(r(j),{loading:v.value>0&&!l.fl2&&w.value=="fl2",size:"small",ghost:"",type:"primary"},{default:a(()=>[p(c(v.value>0&&!l.fl2&&w.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),v.value&&!l.fl2&&w.value=="fl2"?(f(),S(D,{key:2,type:"line",percentage:v.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):x("",!0)]}),_:1}),t(u,{span:"24 m:12",label:"附件3",path:"notes"},{default:a(()=>[t(r(M),{value:l.re3,"onUpdate:value":e[16]||(e[16]=i=>l.re3=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:a(()=>{var i;return[l.fl3?(f(),R("span",Tt,[p(c((i=l.fl3)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:e[17]||(e[17]=U=>l.fl3="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[18]||(e[18]=U=>ae(l.fl3))},"下载")])):(f(),S(C,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":U=>te(U,"fl3"),"show-file-list":!1,onBeforeUpload:h},{default:a(()=>[t(r(j),{loading:v.value>0&&!l.fl3&&w.value=="fl3",size:"small",ghost:"",type:"primary"},{default:a(()=>[p(c(v.value>0&&!l.fl3&&w.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),v.value&&!l.fl3&&w.value=="fl3"?(f(),S(D,{key:2,type:"line",percentage:v.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):x("",!0)]}),_:1}),t(u,{span:"24 m:12",label:"附件4",path:"notes"},{default:a(()=>[t(r(M),{value:l.re4,"onUpdate:value":e[19]||(e[19]=i=>l.re4=i),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{span:"24 m:12",label:"",path:"notes"},{default:a(()=>{var i;return[l.fl4?(f(),R("span",Dt,[p(c((i=l.fl2)==null?void 0:i.split("?")[1])+" ",1),k("span",{class:"cursor-pointer c-#c92a2a",onClick:e[20]||(e[20]=U=>l.fl4="")},"删除"),k("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[21]||(e[21]=U=>ae(l.fl4))},"下载")])):(f(),S(C,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":U=>te(U,"fl4"),"show-file-list":!1,onBeforeUpload:h},{default:a(()=>[t(r(j),{loading:v.value>0&&!l.fl4&&w.value=="fl4",size:"small",ghost:"",type:"primary"},{default:a(()=>[p(c(v.value>0&&!l.fl4&&w.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),v.value&&!l.fl4&&w.value=="fl4"?(f(),S(D,{key:2,type:"line",percentage:v.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):x("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),St=xe({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:De(["reset","search","search1","clear"],["update:model"]),setup(B,{emit:se}){const z=Fe(),N=Ae(),b=se,l=Se(),{formRef:O,restoreValidation:F}=Ue(),m=Pe(B,"model"),P=J([]),{pageData:$,getData:W,nextPage:y}=_e($e),Q=async _=>{const g=_.currentTarget,I=g.scrollTop;g.scrollTop+g.offsetHeight>=g.scrollHeight&&$.data.length<$.total&&(await y(),P.value=$.data,await ye(),setTimeout(()=>{g.scrollTop=I}))},oe=async _=>{var g;_?(m.value.pid=_,b("search1"),l.setProjectInfo({pname:(g=P.value.find(I=>I.id==_))==null?void 0:g.proname,pid:_})):b("clear")},re=async _=>{await W({fuzzy:_,page:1}),P.value=$.data},ue=async()=>{await W({page:1}),P.value=$.data,b("search1")},ie=async _=>{m.value.status=_,b("search1")},q=async()=>{m.value.status=null},X=async()=>{var _,g;await W({fuzzy:N.query.pname?N.query.pname:l.userInfo.pname}),P.value=$.data,m.value.pid=N.query.prjId?Number(N.query.prjId):l.userInfo.pid?l.userInfo.pid:(_=P.value[0])==null?void 0:_.id,l.setProjectInfo({pid:m.value.pid,pname:(g=P.value.find(I=>I.id==m.value.pid))==null?void 0:g.proname}),b("search"),setTimeout(()=>{z.replace({path:N.path,query:{}})},1e3)};X();async function de(){await F(),m.value.fuzzy="",m.value.pid=null,m.value.status=null,b("reset")}const pe=()=>{m.value.fuzzy="",b("search")};async function Y(){b("search")}return qe(()=>N.query,_=>{_.pname&&X()}),(_,g)=>{const I=ne,H=Oe,V=M,Z=yt,ee=j,ce=bt,fe=Ne,me=Me,d=Ie,E=Le;return f(),S(E,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[t(d,{ref_key:"formRef",ref:O,model:m.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ot(Y,["enter"])},{default:a(()=>[t(me,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[t(H,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:a(()=>[t(I,{filterable:"",clearable:"",value:m.value.pid,"onUpdate:value":[g[0]||(g[0]=A=>m.value.pid=A),oe],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:ue,onSearch:re,options:P.value,onScroll:Q},null,8,["value","options"])]),_:1}),t(H,{span:"24 s:12 m:6",label:"状态",path:"status"},{default:a(()=>[t(I,{clearable:"",filterable:"",value:m.value.status,"onUpdate:value":[g[1]||(g[1]=A=>m.value.status=A),ie],placeholder:"请选择状态",onClear:q,options:[{label:"申请中",value:-1},{label:"待调试",value:0},{label:"开始调试",value:1},{label:"待审核",value:2},{label:"审核完成",value:3}]},null,8,["value"])]),_:1}),t(H,{span:"24 s:12 m:6",label:"业务名称",path:"fuzzy"},{default:a(()=>[t(V,{value:m.value.fuzzy,"onUpdate:value":g[2]||(g[2]=A=>m.value.fuzzy=A),placeholder:"请输入",clearable:"",onClear:pe},null,8,["value"])]),_:1}),t(H,{span:"24  s:12 m:6",class:"pr-24px"},{default:a(()=>[t(fe,{class:"w-full"},{default:a(()=>[t(ee,{onClick:de},{icon:a(()=>[t(Z,{class:"text-icon"})]),default:a(()=>[p(" "+c(r(K)("common.reset")),1)]),_:1}),t(ee,{type:"primary",ghost:"",onClick:Y},{icon:a(()=>[t(ce,{class:"text-icon"})]),default:a(()=>[p(" "+c(r(K)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Nt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},jt={key:0},zt={key:1},Ut={key:0},Pt={key:1},qt={key:0},It={key:1},Rt={key:0},$t={key:1};function ze(B){return typeof B=="function"||Object.prototype.toString.call(B)==="[object Object]"&&!ft(B)}const Xt=xe({name:"projectmanagement_business",__name:"index",setup(B){const se=rt(),z=Se(),N=Ae(),b=Fe(),{columns:l,columnChecks:O,data:F,getData:m,loading:P,pagination:$,mobilePagination:W,searchParams:y}=mt({showTotal:!0,immediate:!1,apiFn:ct,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",status:null,dbcreater:void 0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"debugname",title:"业务名称",align:"center",width:180},{key:"proname",title:"所属项目",align:"center",width:180,render(s){return t("span",{class:"cursor-pointer",onClick:()=>pe(s)},[s.proname])}},{key:"docker",title:"对接方",align:"center",width:120,render:s=>{var n;return t("span",null,[(n=s.docker)==null?void 0:n.split("&id=")[0]])}},{key:"dockcharge",title:"对接方负责人",align:"center",width:120},{key:"dockcontact",title:"联系方式",align:"center",width:120},{key:"status",title:"状态",align:"center",width:120,render(s){return t(be,{color:{color:s.status==-1?"rgba(251, 146, 60, 0.15)":s.status==0?"rgba(156, 163, 175, 0.15)":s.status==1?"rgba(59, 130, 246, 0.15)":s.status==2?"rgba(250, 204, 21, 0.15)":"rgba(16, 185, 129, 0.15)",textColor:s.status==-1?"#FB923C":s.status==0?"#9CA3AF":s.status==1?"#3B82F6":s.status==2?"#FACC15":"#10B981",borderColor:s.status==-1?"#FB923C":s.status==0?"#9CA3AF":s.status==1?"#3B82F6":s.status==2?"#FACC15":"#10B981"}},{default:()=>[s.status==-1?"申请中":s.status==0?"待调试":s.status==1?"开始调试":s.status==2?"待审核":"审核完成"]})}},{key:"dbusername",title:"调试人",align:"center",width:120},{key:"duration",title:"调试工时",align:"center",width:180},{key:"notes",title:"备注",align:"center",width:120},{key:"ckusername",title:"审核人",align:"center",width:120},{key:"ckdbtime",title:"审核时间",align:"center",width:180},{key:"dbdbtime",title:"调试开始时间",align:"center",width:180},{key:"dedbtime",title:"调试结束时间",align:"center",width:180},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:180},{key:"operate",title:K("common.operate"),align:"center",width:280,fixed:"right",render:s=>{let n;return t("div",{class:"flex-center gap-8px"},[s.status==-1&&(z.userInfo.usertype==0||z.userInfo.usertype==2)&&t(le,{onPositiveClick:()=>g(s,0)},{default:()=>"确定通过申请吗？",trigger:()=>L(t(j,{type:"warning",ghost:!0,size:"small"},{default:()=>["通过申请"]}),[[G("no-auth"),"project:Debug:update"]])}),s.status==0&&s.dbcreater==z.userInfo.id&&t(le,{onPositiveClick:()=>g(s,1)},{default:()=>"确定开始调试吗？",trigger:()=>L(t(j,{type:"success",ghost:!0,size:"small"},{default:()=>["开始"]}),[[G("no-auth"),"project:Debug:update"]])}),s.status==1&&s.dbcreater==z.userInfo.id&&t(le,{onPositiveClick:()=>g(s,2)},{default:()=>"确定完成调试？",trigger:()=>L(t(j,{type:"success",ghost:!0,size:"small"},{default:()=>["完成"]}),[[G("no-auth"),"project:Debug:update"]])}),s.status==2&&(z.userInfo.usertype==0||z.userInfo.usertype==2)&&t(le,{onPositiveClick:()=>g(s,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>L(t(j,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[G("no-auth"),"project:Debug:update"]])}),L(t(j,{type:"primary",ghost:!0,size:"small",onClick:()=>A(s)},{default:()=>[p("详情")]}),[[G("no-auth"),"project:Debug:select"]]),L(t(j,{type:"primary",ghost:!0,size:"small",onClick:()=>I(s.id)},ze(n=K("common.edit"))?n:{default:()=>[n]}),[[G("no-auth"),"project:Debug:update"]]),t(le,{onPositiveClick:()=>_(s.id)},{default:()=>K("common.confirmDelete"),trigger:()=>{let T;return L(t(j,{type:"error",ghost:!0,size:"small"},ze(T=K("common.delete"))?T:{default:()=>[T]}),[[G("no-auth"),"project:Debug:delete"]])}})])}}]}),{drawerVisible:Q,operateType:oe,editingData:re,handleAdd:ue,handleEdit:ie,checkedRowKeys:q,onBatchDeleted:X,onDeleted:de}=gt(F,m);ut(async()=>{});const pe=s=>{z.setProjectInfo({pid:s.pid,pname:s.proname}),b.push("/projectmanagement/orderdetail?prjId="+s.pid+`&pname=${s.proname}&IsScroll=1`)};async function Y(){console.log(q.value),H(q.value.join(","),s=>{X()})}async function _(s){const{data:n,error:T}=await je(s,y.pid);T||de()}const g=async(s,n)=>{var w;const{data:T,error:v}=await Be([{id:s.id,status:n,pid:s.pid}]);v||((w=window.$message)==null||w.success("操作成功"),m(),n==3?new CustomEvent("clearReview",{detail:{id:s.pid,type:"debug"}}):(n==1||n==2)&&window.dispatchEvent(new CustomEvent("refreshTodo")))};function I(s){ie(s)}async function H(s,n){const{data:T,error:v}=await je(s,y.pid);if(!v)n&&n(T);else return!1}const V=J(-1),Z=s=>{s>0?(V.value=s,y.dbcreater=JSON.parse(JSON.stringify(s)),m()):(y.dbcreater=void 0,V.value=-1,m())},ee=s=>{m()},ce=()=>{if(console.log(N.query.prjId,"route.query.prjId"),N.query.debug){y.status=Number(N.query.debug),y.dbcreater=z.userInfo.id,Z(z.userInfo.id);return}N.query.types=="2"&&(y.status=2),N.query.types=="-1"&&(y.status=-1),m()},fe=()=>{m()},me=()=>{F.value=[],$.itemCount=0},d=J(null),E=J(!1),A=s=>{d.value=s,E.value=!0};return(s,n)=>{const T=kt,v=pt,w=Ne,te=We,ge=Ke,ae=Je,ke=it,we=Le,h=ht,Ce=_t,Te=Re,o=G("no-auth");return f(),R("div",Nt,[t(St,{model:r(y),"onUpdate:model":n[0]||(n[0]=e=>he(y)?y.value=e:null),onReset:fe,onSearch:ce,onSearch1:r(m),onClear:me},null,8,["model","onSearch1"]),t(we,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[t(w,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>[n[6]||(n[6]=k("div",null,"待调试业务",-1)),t(v,{size:"small",value:V.value,"onUpdate:value":[n[1]||(n[1]=e=>V.value=e),Z],name:"radiobuttongroup1"},{default:a(()=>[t(T,{value:-1,label:"默认"}),t(T,{value:r(z).userInfo.id,label:"我的调试"},null,8,["value"])]),_:1},8,["value"])]),_:1,__:[6]})]),"header-extra":a(()=>[t(w,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[L((f(),S(r(j),{onClick:r(ue),size:"small",ghost:"",type:"primary"},{icon:a(()=>[t(te,{class:"text-icon"})]),default:a(()=>[n[7]||(n[7]=p(" "+c("新增")))]),_:1,__:[7]},8,["onClick"])),[[o,"project:Debug:insert"]]),t(r(le),{onPositiveClick:Y},{trigger:a(()=>[L((f(),S(r(j),{size:"small",ghost:"",type:"error",disabled:r(q).length==0},{icon:a(()=>[t(ge,{class:dt(["text-icon",{"animate-spin":r(P)}])},null,8,["class"])]),default:a(()=>[n[8]||(n[8]=p(" "+c("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[o,"project:Debug:delete"]])]),default:a(()=>[n[9]||(n[9]=p(" 确定要删除选中的吗？ "))]),_:1,__:[9]}),t(ae,{columns:r(O),"onUpdate:columns":n[2]||(n[2]=e=>he(O)?O.value=e:null)},null,8,["columns"])]),_:1})]),default:a(()=>[t(ke,{"checked-row-keys":r(q),"onUpdate:checkedRowKeys":n[3]||(n[3]=e=>he(q)?q.value=e:null),columns:r(l),data:r(F),size:"small","flex-height":!r(se).isMobile,loading:r(P),remote:"","row-key":e=>e.id,"scroll-x":r(l).reduce((e,u)=>e+(u.width||100),0),pagination:r(W),class:"sm:h-full","onUpdate:filters":ee},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","scroll-x","pagination"]),t(xt,{visible:r(Q),"onUpdate:visible":n[4]||(n[4]=e=>he(Q)?Q.value=e:null),onSubmitted:r(m),"operate-type":r(oe),pid:r(y).pid,"row-data":r(re)},null,8,["visible","onSubmitted","operate-type","pid","row-data"])]),_:1}),t(Te,{show:E.value,"onUpdate:show":n[5]||(n[5]=e=>E.value=e),title:"查看详情",preset:"card",class:"w-1200px"},{default:a(()=>[t(Ce,{bordered:"","label-placement":"left","label-align":"center",columns:2,"label-style":{width:"160px"}},{default:a(()=>[t(h,null,{label:a(()=>n[10]||(n[10]=[p(" 权重 ")])),default:a(()=>[k("span",null,c(d.value.tname),1)]),_:1}),t(h,null,{label:a(()=>n[11]||(n[11]=[p(" 业务名称 ")])),default:a(()=>[k("span",null,c(d.value.debugname),1)]),_:1}),t(h,null,{label:a(()=>n[12]||(n[12]=[p(" 计划起止时间 ")])),default:a(()=>[k("span",null,c(d.value.starttime)+"--"+c(d.value.endtime),1)]),_:1}),t(h,null,{label:a(()=>n[13]||(n[13]=[p(" 对接方 ")])),default:a(()=>[k("span",null,c(d.value.docker.split("&id=")[0]),1)]),_:1}),t(h,null,{label:a(()=>n[14]||(n[14]=[p(" 对接方负责人 ")])),default:a(()=>[k("span",null,c(d.value.dockcharge),1)]),_:1}),t(h,null,{label:a(()=>n[15]||(n[15]=[p(" 联系方式 ")])),default:a(()=>[k("span",null,c(d.value.dockcontact),1)]),_:1}),t(h,null,{label:a(()=>n[16]||(n[16]=[p(" 状态 ")])),default:a(()=>[d.value.status==0?(f(),S(r(be),{key:0,type:"default"},{default:a(()=>n[17]||(n[17]=[p("未调试")])),_:1,__:[17]})):x("",!0),d.value.status==1?(f(),S(r(be),{key:1,type:"info"},{default:a(()=>n[18]||(n[18]=[p("开始调试")])),_:1,__:[18]})):x("",!0),d.value.status==2?(f(),S(r(be),{key:2,type:"success"},{default:a(()=>n[19]||(n[19]=[p("待审核")])),_:1,__:[19]})):x("",!0),d.value.status==3?(f(),S(r(be),{key:3,type:"success"},{default:a(()=>n[20]||(n[20]=[p("审核完成")])),_:1,__:[20]})):x("",!0)]),_:1}),t(h,null,{label:a(()=>n[21]||(n[21]=[p(" 备注 ")])),default:a(()=>[k("span",null,c(d.value.notes),1)]),_:1}),t(h,null,{label:a(()=>n[22]||(n[22]=[p(" 调试人 ")])),default:a(()=>[k("span",null,c(d.value.dbusername),1)]),_:1}),t(h,null,{label:a(()=>n[23]||(n[23]=[p(" 调试开始时间 ")])),default:a(()=>[k("span",null,c(d.value.dbdbtime),1)]),_:1}),t(h,null,{label:a(()=>n[24]||(n[24]=[p(" 调试结束时间 ")])),default:a(()=>[k("span",null,c(d.value.dedbtime),1)]),_:1}),t(h,null,{label:a(()=>n[25]||(n[25]=[p(" 调试工时 ")])),default:a(()=>[k("span",null,c(d.value.duration),1)]),_:1}),t(h,null,{label:a(()=>n[26]||(n[26]=[p(" 审核人 ")])),default:a(()=>[k("span",null,c(d.value.ckusername),1)]),_:1}),t(h,null,{label:a(()=>n[27]||(n[27]=[p(" 审核时间 ")])),default:a(()=>[k("span",null,c(d.value.ckdbtime),1)]),_:1}),t(h,null,{label:a(()=>n[28]||(n[28]=[p(" 附件1 ")])),default:a(()=>{var e;return[d.value.re1?(f(),R("span",jt,"文件别名"+c(d.value.re1),1)):x("",!0),d.value.fl1?(f(),R("span",zt,c((e=d.value.fl1)==null?void 0:e.split("?")[1]),1)):x("",!0)]}),_:1}),t(h,null,{label:a(()=>n[29]||(n[29]=[p(" 附件2 ")])),default:a(()=>{var e;return[d.value.re2?(f(),R("span",Ut,"文件别名"+c(d.value.re2),1)):x("",!0),d.value.fl2?(f(),R("span",Pt,c((e=d.value.fl2)==null?void 0:e.split("?")[1]),1)):x("",!0)]}),_:1}),t(h,null,{label:a(()=>n[30]||(n[30]=[p(" 附件3 ")])),default:a(()=>{var e;return[d.value.re3?(f(),R("span",qt,"文件别名"+c(d.value.re3),1)):x("",!0),d.value.fl3?(f(),R("span",It,c((e=d.value.fl3)==null?void 0:e.split("?")[1]),1)):x("",!0)]}),_:1}),t(h,null,{label:a(()=>n[31]||(n[31]=[p(" 附件4 ")])),default:a(()=>{var e;return[d.value.re4?(f(),R("span",Rt,"文件别名"+c(d.value.re4),1)):x("",!0),d.value.fl4?(f(),R("span",$t,c((e=d.value.fl4)==null?void 0:e.split("?")[1]),1)):x("",!0)]}),_:1})]),_:1})]),_:1},8,["show"])])}}});export{Xt as default};
