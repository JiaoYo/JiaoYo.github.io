import{d as R,q as M,v as le,s as q,o as P,c as J,w as i,g as t,i as y,U as ne,av as ie,h as b,t as S,$ as m,M as oe,X as se,B as K,E as W,D as ue,a9 as X,j as T,y as re,r as $,am as L,e as O,ap as de,aq as ce,S as pe,F as fe,aw as me,ax as _e,f as Z,ad as Q,ay as Y,Z as ve}from"./index-D4ngyqj9.js";import{f as ge,a as ye,b as he,c as be}from"./audit-events-Bj3RDD_j.js";import{l as ee}from"./lodash-ClqXgtjw.js";import{T as E}from"./basicconf-WyoYeKK_.js";import{_ as xe}from"./round-search-afmjBCkU.js";import{_ as De}from"./round-refresh-DGUmO54G.js";import{u as Se}from"./usePageData-C8tvUOsP.js";import{f as Te}from"./system-manage-CgvJLL8n.js";import{_ as ke}from"./DatePicker-B7b2SSSF.js";import{_ as we}from"./FormItemGridItem-tGN8LyML.js";import{_ as Ce}from"./Grid-3ti0RnUO.js";import{f as Ae}from"./events-BF-GCmFQ.js";import{_ as Ne,a as ze}from"./DescriptionsItem-uGXbnIzO.js";import{_ as te}from"./DataTable-Bkf-sC_U.js";import"./TimePicker-C4_2UWv_.js";import"./defineProperty-Dw3Ai0tz.js";import"./Forward-Bpby_coU.js";const Ie=R({name:"FormSearch",__name:"form-search",props:M({AuditTypeData:{},AuditPolicyData:{}},{model:{required:!0},modelModifiers:{}}),emits:M(["reset","search"],["update:model"]),setup(p,{emit:A}){const h=p,o=A,{formRef:k,restoreValidation:N}=le(),s=q(p,"model");Se(Te);async function z(d,l){d&&d.length>0?(s.value.startTime=d[0],s.value.endTime=d[1]):(s.value.startTime=null,s.value.endTime=null)}async function _(){await N(),s.value.timeRange=null,o("reset")}async function x(){o("search")}return(d,l)=>{const c=se,u=we,v=ke,g=De,D=K,w=xe,C=W,I=Ce,a=ue,e=X;return P(),J(e,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[t(a,{ref_key:"formRef",ref:k,model:s.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:oe(x,["enter"])},{default:i(()=>[t(I,{responsive:"screen","item-responsive":""},{default:i(()=>[t(u,{span:"24 s:12 m:6",label:"事件等级",path:"elevel",class:"pr-24px"},{default:i(()=>[t(c,{filterable:"",clearable:"",value:s.value.elevel,"onUpdate:value":[l[0]||(l[0]=n=>s.value.elevel=n),x],placeholder:"请选择事件等级",options:y(ne)(y(ie))},null,8,["value","options"])]),_:1}),t(u,{span:"24 s:12 m:6",label:"审计类型",path:"atype",class:"pr-24px"},{default:i(()=>[t(c,{value:s.value.atype,"onUpdate:value":[l[1]||(l[1]=n=>s.value.atype=n),x],placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:h.AuditTypeData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(u,{span:"24 s:12 m:6",label:"审计策略",path:"ap",class:"pr-24px"},{default:i(()=>[t(c,{value:s.value.ap,"onUpdate:value":[l[2]||(l[2]=n=>s.value.ap=n),x],placeholder:"请选择审计策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:h.AuditPolicyData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),t(u,{span:"24 s:12 m:8",label:"产生时间",path:"timeRange",class:"pr-24px mt-20px"},{default:i(()=>[t(v,{clearable:"",value:s.value.timeRange,"onUpdate:value":l[3]||(l[3]=n=>s.value.timeRange=n),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":z},null,8,["value"])]),_:1}),t(u,{span:"24 s:12 m:6",class:"pr-24px mt-20px"},{default:i(()=>[t(C,{class:"w-full"},{default:i(()=>[t(D,{onClick:_},{icon:i(()=>[t(g,{class:"text-icon"})]),default:i(()=>[b(" "+S(y(m)("common.reset")),1)]),_:1}),t(D,{type:"primary",ghost:"",onClick:x},{icon:i(()=>[t(w,{class:"text-icon"})]),default:i(()=>[b(" "+S(y(m)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ae=p=>(me("data-v-58b1791d"),p=p(),_e(),p),Pe=ae(()=>Z("span",null,"事件信息",-1)),Ve=ae(()=>Z("span",null,"事件溯源",-1)),$e={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"500px"}},Me={key:1,class:"max-h-500px min-h-320px"};function Le(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!Q(p)}const Oe=R({__name:"detailInfo",props:M({detailInfo:{},AuditTypeData:{},AuditPolicyData:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(p){const A=q(p,"detailVisible"),h=p,o=T();re(()=>A.value,async l=>{l&&(o.value=h.detailInfo,z())});const k=[{title:"",key:"index",width:50,render:(l,c)=>`${c+1}`},{key:"ename",title:"安全事件名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"安全事件类型",align:"center",width:140},{key:"pname2",title:"安全事件类别",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:l=>{(l.elevel===void 0||l.elevel===null)&&(l.elevel=1);const c={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},u=m(E[l.elevel]);let v={color:c[l.elevel],textColor:"#ffffff",borderColor:c[l.elevel]};return t(L,{size:"small",color:v},Le(u)?u:{default:()=>[u]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:180},{key:"type",title:"发生源设备类型",align:"center",width:160}],N=T(!1);let s=$([]);const z=async l=>{var v;if(!N.value)N.value=!0;else return;const{data:c,error:u}=await Ae({pageId:l,auditid:(v=o.value)==null?void 0:v.auditid,limit:20});u||(N.value=!1,s=[...s,...c])};function _(l){var c;l.target.scrollTop+l.target.offsetHeight==l.target.scrollHeight&&((c=o.value)==null?void 0:c.eco)>s.length&&x()}const x=ee.debounce(()=>{z(s[s.length-1].id)},300),d=$({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:l,endIndex:c,page:u,pageSize:v,pageCount:g,itemCount:D}){var w,C;return`已加载${s.length}条 共${(s.length>((w=o.value)==null?void 0:w.eco)?s.length:(C=o.value)==null?void 0:C.eco)||0}条`}});return(l,c)=>{const u=Ne,v=ze,g=W,D=de,w=te,C=ce,I=pe,a=fe;return P(),J(a,{show:A.value,"onUpdate:show":c[0]||(c[0]=e=>A.value=e),title:"事件详情",preset:"card",class:"w-1200px"},{default:i(()=>[t(I,{class:"max-h-600px pr-20px"},{default:i(()=>[t(C,{type:"line",animated:""},{default:i(()=>[t(D,{name:"1"},{tab:i(()=>[Pe]),default:i(()=>[t(g,{vertical:"",size:12},{default:i(()=>[t(v,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:i(()=>[t(u,{label:"审计事件名称"},{default:i(()=>{var e;return[b(S((e=o.value)==null?void 0:e.aename),1)]}),_:1}),t(u,{label:"审计类型"},{default:i(()=>{var e,n;return[b(S(((e=h.AuditTypeData.find(f=>{var r;return f.id===((r=o.value)==null?void 0:r.atype)}))==null?void 0:e.atypename)||((n=o.value)==null?void 0:n.atype)||""),1)]}),_:1}),t(u,{label:"审计策略"},{default:i(()=>{var e,n;return[b(S(((e=h.AuditPolicyData.find(f=>{var r;return f.id===((r=o.value)==null?void 0:r.ap)}))==null?void 0:e.pname)||((n=o.value)==null?void 0:n.ap)||""),1)]}),_:1}),t(u,{label:"事件等级"},{default:i(()=>{var e,n,f,r,V,U,B,G,j,H;return[t(y(L),{size:"small",color:{textColor:"#ffffff",borderColor:((e=o.value)==null?void 0:e.alevel)===0?"#8e9dff":((n=o.value)==null?void 0:n.alevel)===1?"#5da8ff":((f=o.value)==null?void 0:f.alevel)===2?"#fedc69":((r=o.value)==null?void 0:r.alevel)===3?"#ff9874":((V=o.value)==null?void 0:V.alevel)===4?"#ff0000":"#5da8ff",color:((U=o.value)==null?void 0:U.alevel)===0?"#8e9dff":((B=o.value)==null?void 0:B.alevel)===1?"#5da8ff":((G=o.value)==null?void 0:G.alevel)===2?"#fedc69":((j=o.value)==null?void 0:j.alevel)===3?"#ff9874":((H=o.value)==null?void 0:H.alevel)===4?"#ff0000":"#5da8ff"}},{default:i(()=>{var F;return[b(S(y(m)(y(E)[(F=o.value)==null?void 0:F.alevel])),1)]}),_:1},8,["color"])]}),_:1}),t(u,{label:"产生时间"},{default:i(()=>{var e;return[b(S((e=o.value)==null?void 0:e.dbtime),1)]}),_:1}),t(u,{label:"更新时间"},{default:i(()=>{var e;return[b(S((e=o.value)==null?void 0:e.uptime),1)]}),_:1}),t(u,{label:"事件总数"},{default:i(()=>{var e;return[b(S((e=o.value)==null?void 0:e.eco),1)]}),_:1})]),_:1})]),_:1})]),_:1}),t(D,{name:"2"},{tab:i(()=>[Ve]),default:i(()=>[y(s).length==0?(P(),O("div",$e," 暂无安全事件信息 ")):(P(),O("div",Me,[t(w,{columns:k,data:y(s),size:"small","scroll-x":762,"row-key":e=>e.id,"virtual-scroll":"",class:"sm:h-full","max-height":400,loading:N.value,pagination:d,onScroll:_},null,8,["data","row-key","loading","pagination"])]))]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ee=Y(Oe,[["__scopeId","data-v-58b1791d"]]),Re={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Ue(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!Q(p)}const Be=R({name:"audit_event",__name:"index",setup(p){const A=ve(),h=T(!1),o=T(),k=T([]);(async()=>{const{data:a,error:e}=await ge({page:1,limit:1e3});e||(k.value=JSON.parse(JSON.stringify(a)).list)})();const s=T([]);(async()=>{const{data:a,error:e}=await ye({page:1,limit:1e3});e||(s.value=JSON.parse(JSON.stringify(a)).list)})();const _=$({limit:20,pageId:void 0,elevel:void 0,atype:void 0,uid:void 0,suditPolicy:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),x=[{key:"aename",title:m("page.audit.event.eventName"),align:"center",minWidth:160,ellipsis:!0,resizable:!0},{key:"atype",title:m("page.audit.event.type"),align:"center",minWidth:160,render:a=>{var n;const e=(n=k.value.find(f=>f.id===a.atype))==null?void 0:n.atypename;return t("span",null,[e||a.atype])},resizable:!0},{key:"dbtime",title:m("page.audit.event.createTime"),align:"center",width:180,resizable:!0},{key:"uptime",title:m("page.audit.event.updateTime"),align:"center",width:180,resizable:!0},{key:"ap",title:m("page.audit.event.strategy"),align:"center",width:120,render:a=>{var n;const e=(n=s.value.find(f=>f.id===a.ap))==null?void 0:n.pname;return t("span",null,[e||a.ap])},resizable:!0},{key:"alevel",title:m("page.audit.event.eventRanK"),align:"center",width:120,render:a=>{(a.alevel===void 0||a.alevel===null)&&(a.alevel=0);const e={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},n=m(E[a.alevel]);let f={color:e[a.alevel],textColor:"#ffffff",borderColor:e[a.alevel]};return t(L,{size:"small",color:f},Ue(n)?n:{default:()=>[n]})},resizable:!0},{key:"eco",title:m("page.audit.event.eventCount"),align:"center",width:120,resizable:!0},{key:"operate",title:m("common.operate"),align:"center",width:130,fixed:"right",render:a=>t("div",{class:"flex-center gap-8px"},[t(K,{type:"primary",ghost:!0,size:"small",onClick:()=>I(a)},{default:()=>[b("详情")]})])}],d=T([]),l=T(!1),c=async(a=!1)=>{if(!l.value)l.value=!0;else return;l.value=!0;const{data:e,error:n}=await he(_);n||(a?d.value=[...d.value,...e]:d.value=e,l.value=!1)};c();const u=T(!0),v=()=>{d.value=[],_.pageId=void 0,(e=>Object.keys(e).filter(r=>r!=="limit"&&r!=="_t").some(r=>e[r]!==void 0&&e[r]!==""&&e[r]!==null))(_)?u.value=!1:(u.value=!0,D()),c()},g=$({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:e,page:n,pageSize:f,pageCount:r,itemCount:V}){return`已加载${d.value.length}条`+(d.value.length?u.value?` 共计 ${d.value.length>0?V??0:0} 条`:d.value.length>=_.limit?"  预计还有更多":"":"")}});async function D(){const{data:a,error:e}=await be();e||(g.pageCount=20,g.total=Number(a),g.itemCount=Number(a))}D();function w(a){var e;a.target.scrollTop+a.target.offsetHeight==a.target.scrollHeight&&g.total>((e=d.value)==null?void 0:e.length)&&C()}const C=ee.debounce(()=>{var a;((a=d.value)==null?void 0:a.length)<g.total&&(_.pageId=d.value[d.value.length-1].id,c(!0))},300);async function I(a){o.value=a,h.value=!0}return(a,e)=>{const n=te,f=X;return P(),O("div",Re,[t(Ie,{model:_,"onUpdate:model":e[0]||(e[0]=r=>_=r),onSearch:v,AuditTypeData:k.value,AuditPolicyData:s.value},null,8,["model","AuditTypeData","AuditPolicyData"]),t(f,{title:y(m)("page.audit.event.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":i(()=>[]),default:i(()=>[t(n,{columns:x,data:d.value,size:"small","flex-height":!y(A).isMobile,loading:l.value,remote:"","row-key":r=>r.id,pagination:g,onScroll:w,class:"sm:h-full","scroll-x":""},null,8,["data","flex-height","loading","row-key","pagination"]),t(Ee,{"detail-visible":h.value,"onUpdate:detailVisible":e[1]||(e[1]=r=>h.value=r),"detail-info":o.value,AuditTypeData:k.value,AuditPolicyData:s.value},null,8,["detail-visible","detail-info","AuditTypeData","AuditPolicyData"])]),_:1},8,["title"])])}}}),it=Y(Be,[["__scopeId","data-v-01c91391"]]);export{it as default};
