import{_ as Ae}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DblglBez.js";import{d as ae,q as ee,s as ue,v as pe,x as Re,b as Pe,r as oe,j as me,y as se,K as W,o as k,c as A,w as l,g as e,h as f,t as Y,i as s,$ as C,L as Z,Z as J,N as F,M as fe,aw as ve,bj as Te,A as _e,a2 as ge,an as $e,E as Q,D as be,B as X,F as ze,ad as he,a4 as Fe,aY as re,e as Ve,ag as H,ah as je}from"./index-7Q9xZuwa.js";import{u as Oe,a as qe}from"./table-G6_8Abm0.js";import{a as Be,h as Me,k as Ee,l as ye,m as Ge,n as Ie,o as Ke,p as Le}from"./Collection-Dqv_ioR6.js";import{C as He,c as we,d as We,e as Ye}from"./collection-D2hTOeKU.js";import{r as Ze}from"./asset-BpzDQjbF.js";import{u as ie}from"./usePageData-PYHx9xl8.js";import{_ as ke}from"./FormItemGridItem-DYTXkfwP.js";import{_ as Je}from"./Cascader-B05gdiL9.js";import{b as Qe,a as Xe,_ as ea}from"./DataTable-n3fP4Loy.js";import{_ as Ce}from"./Grid-CRtcNhSF.js";import{_ as aa}from"./round-search-BQOA9W6m.js";import{_ as ta}from"./round-refresh-DJiiF7wv.js";import{h as de}from"./permission-BYoerBbx.js";import{_ as la}from"./Popconfirm-BEMrdOuM.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-D8fMBsYv.js";import"./setting-outlined-V9qGIWHT.js";import"./export-oh2-I3ZA.js";import"./refresh-av0Mcmzj.js";import"./round-delete-BZFRn3Yp.js";import"./round-plus-Cy8c1zzO.js";import"./Upload-CwzIyBrH.js";import"./Progress-DAZ1S5w7.js";import"./Forward-BzUEeUAa.js";const na=ae({name:"CollectorModal",__name:"collector_modal",props:ee({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ee(["submitted"],["update:visible"]),setup(h,{emit:V}){const p=h,S=V,g=ue(h,"visible"),{formRef:b,validate:d,restoreValidation:j}=pe(),{createConfirmPwdRule:T,defaultRequiredRule:x,patternRules:I}=Re(),O=Pe(()=>({add:"新增采集器",edit:"编辑采集器"})[p.operateType]),a=oe(y());function y(){return{id:void 0,cname:"",cencode:0,accmed:1,proser:void 0,caddr:"",logsoudev:void 0,filterpro:void 0,cdesc:"",proper:0,enable:0,rev:void 0,port:void 0,uname:void 0,pswd:void 0,fpath:void 0}}const v={cname:x,caddr:[{required:!0,message:"请输入采集器地址",trigger:["blur","input"]},{required:!0,validator:ve,trigger:["blur","input"]}],rev:x,port:{required:!0,trigger:["blur","input"],validator:(r,t,m)=>t?Te(t)?!0:new Error("请输入在0-65535之间的数字"):new Error("请输入端口号")},uname:x,pswd:x,cencode:{type:"number",required:!0,trigger:["blur","change"],message:"请选择编码格式"},accmed:{type:"number",required:!0,trigger:["blur","change"],message:"请选择接入方式"},logsoudev:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源设备"}},{pageData:D,getData:w,nextPage:_}=ie(Be),q=async r=>{const t=r.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&D.data.length<D.total&&_()},{pageData:N,getData:K,nextPage:B}=ie(Me),M=async r=>{const t=r.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&N.data.length<N.total&&B()},$=me(),z=async()=>{const{data:r,error:t}=await Ge();$.value=r.map(m=>({...m,id:"-"+m.id,type:m.cname}))};function o(){w(),z(),K(),Object.assign(a,y()),p.operateType==="edit"&&p.rowData&&(Object.assign(a,p.rowData),u.clickNums=1)}function n(){g.value=!1}const u=oe({clickNums:0,isLoading:!1});async function U(){var r,t,m,c,R;if(await d(),p.operateType==="add"){const{data:L,error:G}=await Ee([a]);if(!G&&((r=window.$message)==null||r.success("采集器添加成功"),n(),S("submitted"),a.proper==0)){const P=await Ze([{aname:a.cname,aip:a.caddr,tid:36,cid:L}]);P.error&&((t=P.error.response)==null?void 0:t.data.msg)=="数据库中已存在该记录"&&((m=window.$message)==null||m.destroyAll(),(c=window.$message)==null||c.error("资产添加失败,请前往资产管理进行修改"))}}else{const{data:L,error:G}=await ye([a]);G||((R=window.$message)==null||R.success(C("common.updateSuccess")),n(),S("submitted"))}}const E=r=>{Object.assign(a,{logsoudev:void 0,rev:void 0,port:void 0,uname:void 0,pswd:void 0}),r==4&&(a.logsoudev=53),a.port=r==5?22:null};return se(g,()=>{g.value&&(o(),j())}),se(()=>a.caddr,()=>{u.clickNums=0}),(r,t)=>{const m=_e,c=ke,R=ge,L=Je,G=$e,P=Qe,te=Q,le=Xe,Se=Ce,xe=be,ne=X,De=Q,Ne=ze,Ue=W("no-space");return k(),A(Ne,{show:g.value,"onUpdate:show":t[14]||(t[14]=i=>g.value=i),title:O.value,preset:"card",class:"w-850px"},{footer:l(()=>[e(De,{size:16,justify:"end"},{default:l(()=>[e(ne,{onClick:n},{default:l(()=>[f(Y(s(C)("common.cancel")),1)]),_:1}),e(ne,{type:"primary",onClick:U},{default:l(()=>[f(Y(s(C)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(xe,{ref_key:"formRef",ref:b,model:a,rules:v,"label-placement":"left","label-width":120,onKeyup:fe(U,["enter"])},{default:l(()=>[e(Se,{responsive:"screen","item-responsive":"","x-gap":20},{default:l(()=>[e(c,{span:"24 s:12 m:12",label:"采集器名称",path:"cname"},{default:l(()=>[Z(e(m,{value:a.cname,"onUpdate:value":t[0]||(t[0]=i=>a.cname=i),placeholder:"请输入采集器名称",clearable:""},null,8,["value"]),[[Ue]])]),_:1}),e(c,{span:"24 s:12 m:12",label:"编码格式",path:"cencode"},{default:l(()=>[e(R,{value:a.cencode,"onUpdate:value":t[1]||(t[1]=i=>a.cencode=i),placeholder:"请选择编码格式",filterable:"",clearable:"",options:s(J)(s(He))},null,8,["value","options"])]),_:1}),e(c,{span:"24 s:12 m:12",label:"接入方式",path:"accmed"},{default:l(()=>[e(R,{value:a.accmed,"onUpdate:value":[t[2]||(t[2]=i=>a.accmed=i),E],placeholder:"请选择接入方式",filterable:"",clearable:"",disabled:r.operateType==="edit",options:s(J)(s(we))},null,8,["value","disabled","options"])]),_:1}),e(c,{span:"24 s:12 m:12",label:"代理服务器",path:"proser"},{default:l(()=>[e(R,{value:a.proser,"onUpdate:value":t[3]||(t[3]=i=>a.proser=i),placeholder:"请选择代理服务器",clearable:"",filterable:"","value-field":"id","label-field":"pip",options:s(D).data,"reset-menu-on-options-change":!1,onScroll:q},null,8,["value","options"])]),_:1}),e(c,{span:"24 s:12 m:12",label:"采集地址",path:"caddr"},{default:l(()=>[e(m,{value:a.caddr,"onUpdate:value":t[4]||(t[4]=i=>a.caddr=i),placeholder:"请输入采集地址",clearable:""},null,8,["value"])]),_:1}),[0,1,4,5,7,8].includes(a.accmed)?(k(),A(c,{key:0,span:"24 s:12 m:12",label:"日志源设备",path:"logsoudev"},{default:l(()=>[e(L,{value:a.logsoudev,"onUpdate:value":t[5]||(t[5]=i=>a.logsoudev=i),placeholder:"请选择日志源设备",options:$.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"","show-path":!1},null,8,["value","options"])]),_:1})):F("",!0),e(c,{span:"24 s:12 m:12",label:"过滤策略",path:"filterpro"},{default:l(()=>[e(R,{clearable:"",filterable:"",value:a.filterpro,"onUpdate:value":t[6]||(t[6]=i=>a.filterpro=i),placeholder:"请选择过滤策略",options:s(N).data,"value-field":"id","label-field":"pname","reset-menu-on-options-change":!1,onScroll:M},null,8,["value","options"])]),_:1}),[3,7,8].includes(a.accmed)?(k(),A(c,{key:1,span:"24 s:12 m:12",label:a.accmed==3?"数据库名称":a.accmed==4?"域名":(a.accmed==7,"目录"),path:"rev"},{default:l(()=>[e(m,{value:a.rev,"onUpdate:value":t[7]||(t[7]=i=>a.rev=i),placeholder:"请输入",clearable:""},null,8,["value"])]),_:1},8,["label"])):F("",!0),[3,4,5,7,8].includes(a.accmed)?(k(),A(c,{key:2,span:"24 s:12 m:12",label:"端口",path:"port"},{default:l(()=>[e(G,{value:a.port,"onUpdate:value":t[8]||(t[8]=i=>a.port=i),placeholder:"请输入端口",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1})):F("",!0),[3,4,5,7,8,9].includes(a.accmed)?(k(),A(c,{key:3,span:"24 s:12 m:12",label:"用户名",path:"uname"},{default:l(()=>[e(m,{value:a.uname,"onUpdate:value":t[9]||(t[9]=i=>a.uname=i),placeholder:"请输入用户名",clearable:""},null,8,["value"])]),_:1})):F("",!0),[3,4,5,7,8,9].includes(a.accmed)?(k(),A(c,{key:4,span:"24 s:12 m:12",label:"密码",path:"pswd"},{default:l(()=>[e(m,{type:"password","show-password-on":"click",value:a.pswd,"onUpdate:value":t[10]||(t[10]=i=>a.pswd=i),placeholder:"请输入密码",clearable:""},null,8,["value"])]),_:1})):F("",!0),r.operateType=="add"?(k(),A(c,{key:5,span:"24 s:12 m:12",label:"生成资产",path:"proper"},{default:l(()=>[e(le,{value:a.proper,"onUpdate:value":t[11]||(t[11]=i=>a.proper=i),name:"radiogroup"},{default:l(()=>[e(te,null,{default:l(()=>[e(P,{value:0},{default:l(()=>[f("是")]),_:1}),e(P,{value:1},{default:l(()=>[f("否")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})):F("",!0),e(c,{span:"24 s:12 m:12",label:"是否启用",path:"enable"},{default:l(()=>[e(le,{value:a.enable,"onUpdate:value":t[12]||(t[12]=i=>a.enable=i),name:"radiogroup",disabled:r.operateType=="edit"},{default:l(()=>[e(te,null,{default:l(()=>[e(P,{value:0},{default:l(()=>[f("是")]),_:1}),e(P,{value:1},{default:l(()=>[f("否")]),_:1})]),_:1})]),_:1},8,["value","disabled"])]),_:1}),e(c,{span:"24 s:24 m:24",label:"描述",path:"cdesc"},{default:l(()=>[e(m,{type:"textarea",value:a.cdesc,"onUpdate:value":t[13]||(t[13]=i=>a.cdesc=i),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),oa=ae({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ee(["reset","search"],["update:model"]),setup(h,{emit:V}){const p=V,{formRef:S,restoreValidation:g}=pe(),b={caddr:[{validator:ve,trigger:["change","input"]}]},d=ue(h,"model");me(!1);function j(y){d.value.enable=y,p("search")}function T(y){d.value.accmed=y,p("search")}function x(){d.value.fuzzy=void 0,p("search")}function I(){d.value.caddr=void 0,p("search")}async function O(){await g(),p("reset")}async function a(){p("search")}return(y,v)=>{const D=_e,w=ke,_=ge,q=ta,N=X,K=aa,B=Q,M=Ce,$=be,z=he,o=W("no-space");return k(),A(z,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[e($,{ref_key:"formRef",ref:S,model:d.value,"label-placement":"left",rules:b,"label-width":"100px",onKeyup:fe(a,["enter"]),"show-require-mark":!1},{default:l(()=>[e(M,{responsive:"screen","item-responsive":""},{default:l(()=>[e(w,{span:"24 s:12 m:5",label:"采集器名称",path:"fuzzy"},{default:l(()=>[Z(e(D,{clearable:"",value:d.value.fuzzy,"onUpdate:value":v[0]||(v[0]=n=>d.value.fuzzy=n),placeholder:"请输入采集器名称",onClear:x},null,8,["value"]),[[o]])]),_:1}),e(w,{span:"24 s:12 m:5",label:"采集地址",path:"caddr"},{default:l(()=>[e(D,{clearable:"",value:d.value.caddr,"onUpdate:value":v[1]||(v[1]=n=>d.value.caddr=n),onClear:I,placeholder:"请输入采集地址"},null,8,["value"])]),_:1}),e(w,{span:"24 s:12 m:4",label:"接入方式",path:"accmed"},{default:l(()=>[e(_,{clearable:"",filterable:"",value:d.value.accmed,"onUpdate:value":v[2]||(v[2]=n=>d.value.accmed=n),placeholder:"请选择接入方式",options:s(J)(s(we)),onUpdateValue:T,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(w,{span:"24 s:12 m:4",label:"状态",path:"enable"},{default:l(()=>[e(_,{clearable:"",filterable:"",value:d.value.enable,"onUpdate:value":v[3]||(v[3]=n=>d.value.enable=n),placeholder:"请选择状态",options:s(J)(s(We)),onUpdateValue:j,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(w,{span:"24 s:12 m:4",class:"ml-20px"},{default:l(()=>[e(B,{class:"w-full",align:"center"},{default:l(()=>[e(N,{onClick:O},{icon:l(()=>[e(q,{class:"text-icon"})]),default:l(()=>[f(" "+Y(s(C)("common.reset")),1)]),_:1}),e(N,{type:"primary",ghost:"",onClick:a},{icon:l(()=>[e(K,{class:"text-icon"})]),default:l(()=>[f(" "+Y(s(C)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),sa={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function ce(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!je(h)}const Pa=ae({name:"collectionmanagement_collector",__name:"index",setup(h){const V=Fe(),{columns:p,columnChecks:S,data:g,getData:b,loading:d,mobilePagination:j,searchParams:T,resetSearchParams:x}=Oe({apiFn:Ie,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,caddr:null,enable:null,accmed:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"cname",title:"采集器名称",align:"center",width:200},{key:"caddr",title:"采集地址",align:"center",width:200},{key:"accmed",title:"接入方式",align:"center",width:160,render:o=>{const n=Ye;return e("span",null,[f(" "),n[o.accmed]])}},{key:"pname",title:"过滤策略",align:"center",width:200},{key:"pip",title:"代理服务器",align:"center",width:200},{key:"type",title:"日志源设备",align:"center",width:200},{key:"enable",title:"状态",align:"center",width:160,render:o=>e(Q,{justify:"center"},{default:()=>[o.accmed==4?e(re,{value:o.enable,"onUpdate:value":[n=>o.enable=n,()=>I(o)],checkedValue:0,uncheckedValue:1},{checked:()=>e("span",null,[f("启用")]),unchecked:()=>e("span",null,[f("禁用")])}):e(re,{value:o.enable,"onUpdate:value":[n=>o.enable=n,()=>O(o)],checkedValue:0,uncheckedValue:1},{checked:()=>e("span",null,[f("启用")]),unchecked:()=>e("span",null,[f("禁用")])})]})},{key:"operate",title:C("common.operate"),align:"center",width:130,fixed:"right",render:o=>{let n;return e("div",{class:"flex-center gap-8px"},[Z(e(X,{type:"primary",ghost:!0,size:"small",onClick:()=>$(o.id)},ce(n=C("common.edit"))?n:{default:()=>[n]}),[[W("no-auth"),"sys.collection.mengement.update"]]),e(la,{onPositiveClick:()=>M(o.id)},{default:()=>C("common.confirmDelete"),trigger:()=>{let u;return Z(e(X,{type:"error",ghost:!0,size:"small"},ce(u=C("common.delete"))?u:{default:()=>[u]}),[[W("no-auth"),"sys.collection.mengement.delete"]])}})])}}]}),I=async o=>{var u;const n={id:o.id,enable:o.enable,ip:o.enable==1?o.caddr:void 0};try{const{data:U,error:E}=await Ke(n);E||((u=window.$message)==null||u.success(o.enable==1?"禁用成功":"启用成功"),b())}catch{o.enable=o.enable==1?0:1}},O=async o=>{var n;try{const{data:u,error:U}=await ye([o]);U||((n=window.$message)==null||n.success(o.enable==1?"禁用成功":"启用成功"),b())}catch{o.enable=o.enable==1?0:1}},{drawerVisible:a,operateType:y,editingData:v,handleAdd:D,handleEdit:w,checkedRowKeys:_,onBatchDeleted:q,onDeleted:N,closeDrawer:K}=qe(g,b);async function B(){console.log(_.value),z(_.value.join(","),o=>{q()})}function M(o){z(o,n=>{N()})}function $(o){w(o)}async function z(o,n){const u=await Le(o,1);console.log("data",u),n&&n(u)}return(o,n)=>{const u=Ae,U=ea,E=he;return k(),Ve("div",sa,[e(oa,{model:s(T),"onUpdate:model":n[0]||(n[0]=r=>H(T)?T.value=r:null),onReset:s(x),onSearch:s(b)},null,8,["model","onReset","onSearch"]),e(E,{title:"采集器管理",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":l(()=>[e(u,{columns:s(S),"onUpdate:columns":n[1]||(n[1]=r=>H(S)?S.value=r:null),"disabled-delete":s(_).length===0,"is-view-add-button":s(de)("sys.collection.mengement.insert"),"is-view-delete-button":s(de)("sys.collection.mengement.delete"),loading:s(d),onAdd:s(D),onDelete:B,onRefresh:s(b)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:l(()=>[e(U,{"checked-row-keys":s(_),"onUpdate:checkedRowKeys":n[2]||(n[2]=r=>H(_)?_.value=r:null),columns:s(p),data:s(g),size:"small","flex-height":!s(V).isMobile,"scroll-x":s(p).reduce((r,t)=>r+t.width,0),loading:s(d),remote:"","row-key":r=>r.id,pagination:s(j),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(na,{visible:s(a),"onUpdate:visible":n[3]||(n[3]=r=>H(a)?a.value=r:null),"operate-type":s(y),"row-data":s(v),onSubmitted:s(b)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Pa as default};
