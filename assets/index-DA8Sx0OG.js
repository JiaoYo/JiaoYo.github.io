import{_ as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DLg6uYMj.js";import{d as G,m as P,q as J,n as te,p as me,c4 as ae,b as K,$ as s,r as fe,aw as oe,C as F,o as T,c as A,w as r,g as t,h as I,t as U,i as e,E as ne,D as L,V as _e,W as he,c5 as se,c6 as ge,I as le,J as ve,Y as ye,N as re,B as V,M as Y,aC as be,aD as ke,ac as ie,e as Q,aO as ce,c7 as X,j as W,f as Z,c8 as we,ak as Ne,c9 as xe,a$ as Re,au as de,a2 as De,ca as Ce,cb as Me,cc as $e,aB as E,aF as Se,at as Te}from"./index-DLQv0xE2.js";import{u as ze,a as Be}from"./table-Dfen2niS.js";import{_ as Ie,a as Ue,b as Le,l as Ve}from"./lodash-DOLyDuOK.js";import{_ as Oe}from"./round-refresh-Cl_pKSM5.js";import{_ as je}from"./Grid-AjTJLB13.js";import{_ as Ee}from"./Tree-BbHVN8aq.js";import{h as ee}from"./permission-DwBWMKzt.js";import{N as Fe}from"./Popconfirm-G8CimJZQ.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DdpxrVbZ.js";import"./export-By3IY4tw.js";import"./refresh-DGnxzbIJ.js";import"./round-plus-FQcTm0xK.js";import"./Upload-BXVBIdnZ.js";import"./Progress-dtt87LR8.js";const Ae=G({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:P({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:P(["submitted"],["update:visible"]),setup(h,{emit:y}){const u=h,g=y,k=J(h,"visible"),{formRef:b,validate:C,restoreValidation:z}=te(),{defaultRequiredRule:v}=me();ae();const R=K(()=>({add:s("page.manage.role.addRole"),edit:s("page.manage.role.editRole")})[u.operateType]),p=fe(D());function D(){return{name:"",remark:"",rtype:0,menuIdList:[]}}const B={name:v};K(()=>{var c;return((c=u.rowData)==null?void 0:c.id)||-1}),K(()=>u.operateType==="add"||u.operateType==="edit");async function M(){if(Object.assign(p,D()),u.operateType==="edit"&&u.rowData){const{data:c,error:i}=await se(u.rowData.id+"");Object.assign(p,c)}}function $(){k.value=!1}async function a(){var _,n,d;await C();const{data:c,error:i}=await ge(u.operateType==="edit"?(_=u.rowData)==null?void 0:_.id:null,p.name,p.menuIdList,p.remark,p.rtype);i||((n=window.$message)==null||n.destroyAll(),(d=window.$message)==null||d.success(u.operateType==="edit"?s("common.modifySuccess"):s("common.addSuccess")),$(),g("submitted"))}return oe(k,()=>{k.value&&(M(),z())}),(c,i)=>{const _=le,n=ve,d=ye,m=re,w=V,o=Y,S=be,O=ke,j=F("no-space");return T(),A(O,{show:k.value,"onUpdate:show":i[3]||(i[3]=l=>k.value=l),"display-directive":"show",width:360},{default:r(()=>[t(S,{title:R.value,"native-scrollbar":!1,closable:""},{footer:r(()=>[t(o,{size:16},{default:r(()=>[t(w,{onClick:$},{default:r(()=>[I(U(e(s)("common.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:a},{default:r(()=>[I(U(e(s)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(m,{ref_key:"formRef",ref:b,model:p,rules:B,onKeyup:ne(a,["enter"])},{default:r(()=>[t(n,{label:e(s)("page.manage.role.name"),path:"name"},{default:r(()=>[L(t(_,{value:p.name,"onUpdate:value":i[0]||(i[0]=l=>p.name=l),placeholder:e(s)("page.manage.role.form.name"),clearable:""},null,8,["value","placeholder"]),[[j]])]),_:1},8,["label"]),t(n,{label:e(s)("page.manage.role.remark"),path:"remark"},{default:r(()=>[L(t(_,{clearable:"",value:p.remark,"onUpdate:value":i[1]||(i[1]=l=>p.remark=l),placeholder:e(s)("page.manage.role.form.remark")},null,8,["value","placeholder"]),[[j]])]),_:1},8,["label"]),t(n,{label:e(s)("page.manage.role.type"),path:"rtype"},{default:r(()=>[t(d,{filterable:"",value:p.rtype,"onUpdate:value":i[2]||(i[2]=l=>p.rtype=l),disabled:u.operateType==="edit",placeholder:e(s)("page.manage.role.form.type"),options:e(_e)(e(he)),style:{width:"100%"}},null,8,["value","disabled","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ke=G({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:P(["reset","search"],["update:model"]),setup(h,{emit:y}){const u=y,g=J(h,"model"),{formRef:k,restoreValidation:b}=te();function C(){g.value.name="",u("search")}async function z(){await b(),u("reset")}function v(){u("search")}const R=Ie.debounce(v,1e3,{leading:!0,trailing:!1});return(p,D)=>{const B=le,M=Ue,$=Oe,a=V,c=Le,i=Y,_=je,n=re,d=ie,m=F("no-space");return T(),A(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[t(n,{model:g.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(v,["enter"])},{default:r(()=>[t(_,{responsive:"screen","item-responsive":"","y-gap":12},{default:r(()=>[t(M,{span:"24 s:12 m:8 l:6",label:e(s)("page.manage.role.name"),path:"name"},{default:r(()=>[L(t(B,{clearable:"",value:g.value.name,"onUpdate:value":D[0]||(D[0]=w=>g.value.name=w),placeholder:e(s)("page.manage.role.form.name"),onClear:C},null,8,["value","placeholder"]),[[m]])]),_:1},8,["label"]),t(M,{span:"24 s:12 m:8 l:6"},{default:r(()=>[t(i,{class:"w-full ml-20px"},{default:r(()=>[t(a,{onClick:z},{icon:r(()=>[t($,{class:"text-icon"})]),default:r(()=>[I(" "+U(e(s)("common.reset")),1)]),_:1}),t(a,{type:"primary",ghost:"",onClick:e(R)},{icon:r(()=>[t(c,{class:"text-icon"})]),default:r(()=>[I(" "+U(e(s)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Pe={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Ge=ce('<g transform="rotate(-90 12 12)"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="20" stroke-dashoffset="20" d="M21 3V21"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="20;0"></animate></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M17 12H3.5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.2s" values="15;0"></animate></path><path stroke-dasharray="12" stroke-dashoffset="12" d="M3 12L10 19M3 12L10 5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="12;0"></animate></path></g></g>',1),qe=[Ge];function He(h,y){return T(),Q("svg",Pe,[...qe])}const We={name:"line-md-arrow-open-down",render:He},Je={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Ye=ce('<g transform="rotate(-90 12 12) translate(24 0) scale(-1 1)"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="20" stroke-dashoffset="20" d="M21 3V21"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="20;0"></animate></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M17 12H3.5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.2s" values="15;0"></animate></path><path stroke-dasharray="12" stroke-dashoffset="12" d="M3 12L10 19M3 12L10 5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="12;0"></animate></path></g></g>',1),Qe=[Ye];function Xe(h,y){return T(),Q("svg",Je,[...Qe])}const Ze={name:"line-md-arrow-open-up",render:Xe},et={class:"flex"},tt=G({name:"MenuAuthModal",__name:"menu-auth-modal",props:P({roleRow:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(h){const y=h,u=J(h,"visible");function g(){u.value=!1}const k=K(()=>s("common.edit")+s("page.manage.role.menuAuth")),b=X([]);function C(a,c=0){var m,w;const i=(m=a.find(o=>o.url=="/manage/role"))==null?void 0:m.id,_=(w=a.find(o=>o.url=="/manage/user"))==null?void 0:w.id;let n=[];function d(o){return o.sort((S,O)=>(S.sort||0)-(O.sort||0))}return a.forEach(o=>{if(o.suffix=()=>Re(de,{text:!0,type:o.pid==0&&o.type==0?"warning":o.type==1?"info":"success",size:"small"},{default:()=>o.pid==0&&o.type==0?"目录":o.type==1?"按钮":"菜单"}),(o.pid==i||o.id==i||o.pid==_||o.id==_)&&(o.disabled=!0),o.pid==c){const S=C(a,o.id);S.length>0?o.children=S:o.children=[],n.push(o)}}),d(n)}const z=async()=>{const{error:a,data:c}=await xe({rtype:y.roleRow.rtype}),i=C(c);if(!a){let _=function(d){for(let m=d.length-1;m>=0;m--)d[m].children&&d[m].children.length>0?_(d[m].children):d[m].children=void 0;return d},n=Ve.cloneDeep(i);n=_(n),b.value=n.filter(d=>d.id<=1e4)}},v=W(!0),R=X([]);async function p(){const{data:a,error:c}=await se(y.roleRow.id+""),i=[];function _(n,d){return!d.includes(n.id)||n.children&&!n.children.every(m=>_(m,d))?(i.push(n.id),!1):!0}b.value.forEach(n=>{_(n,a.menuIdList)}),R.value=a.menuIdList.filter(n=>!i.includes(n))}const D=W(),B=a=>{D.value=a};function M(){var a,c;we({id:y.roleRow.id,name:y.roleRow.name,menuIdList:R.value.concat(D.value).filter(i=>i!==null)}),(c=(a=window.$message)==null?void 0:a.success)==null||c.call(a,s("common.modifySuccess")),g()}function $(){z(),p()}return oe(u,a=>{a&&$()}),(a,c)=>{const i=Ze,_=We,n=Ee,d=V,m=Y,w=Ne;return T(),A(w,{show:u.value,"onUpdate:show":c[2]||(c[2]=o=>u.value=o),preset:"card",class:"w-480px"},{header:r(()=>[Z("div",et,[I(U(k.value)+" ",1),Z("div",{class:"ml-10px cursor-pointer",title:"展开/收起",onClick:c[0]||(c[0]=o=>v.value=!v.value)},[v.value?(T(),A(_,{key:1,class:"text-icon"})):(T(),A(i,{key:0,class:"text-icon"}))])])]),footer:r(()=>[t(m,{justify:"end"},{default:r(()=>[t(d,{size:"small",class:"mt-16px",onClick:g},{default:r(()=>[I(U(e(s)("common.cancel")),1)]),_:1}),t(d,{type:"primary",size:"small",class:"mt-16px",onClick:M},{default:r(()=>[I(U(e(s)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(n,{cascade:"","checked-keys":R.value,"onUpdate:checkedKeys":c[1]||(c[1]=o=>R.value=o),data:b.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"",class:"h-60vh","label-field":"name","key-field":"id","children-field":"children","default-expand-all":v.value,onUpdateIndeterminateKeys:B},null,8,["checked-keys","data","default-expand-all"])]),_:1},8,["show"])}}}),at={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function H(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Se(h)}const vt=G({name:"manage_role",__name:"index",setup(h){const y=De(),{columns:u,columnChecks:g,data:k,getData:b,loading:C,mobilePagination:z,searchParams:v,resetSearchParams:R}=ze({apiFn:Ce,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,name:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:s("page.manage.role.name"),align:"center",minWidth:120,ellipsis:!0},{key:"remark",title:s("page.manage.role.remark"),minWidth:120,align:"center",ellipsis:!0},{key:"rtype",title:s("page.manage.role.type"),width:140,align:"center",render:l=>{l.rtype===void 0&&(l.rtype=0);const f={0:"primary",1:"primary",2:"primary",3:"primary"},N=s(Me[l.rtype]);return t(de,{type:f[l.rtype]},H(N)?N:{default:()=>[N]})}},{key:"operate",title:s("common.operate"),align:"center",render:l=>{let f;return t("div",{class:"flex-center gap-8px"},[L(t(V,{type:"primary",ghost:!0,size:"small",onClick:()=>O(l.id)},H(f=s("common.edit"))?f:{default:()=>[f]}),[[F("no-auth"),"sys:role:update"]]),L(t(V,{type:"primary",ghost:!0,size:"small",onClick:()=>w(l)},{default:()=>["分配权限"]}),[[F("no-auth"),"sys:role:update"]]),[1,2,3].includes(Number(l.id))?"":t(Fe,{onPositiveClick:()=>S(l.id)},{default:()=>s("common.confirmDelete"),trigger:()=>{let N;return L(t(V,{type:"error",ghost:!0,size:"small"},H(N=s("common.delete"))?N:{default:()=>[N]}),[[F("no-auth"),"sys:role:delete"]])}})])}}]}),{drawerVisible:p,operateType:D,editingData:B,handleAdd:M,handleEdit:$,checkedRowKeys:a,onBatchDeleted:c,onDeleted:i,closeDrawer:_}=Be(k,b),{bool:n,setTrue:d}=ae(),m=W({id:0,name:"",remark:"",rtype:0,menuIdList:[]});function w(l){d(),m.value=l}async function o(){console.log(a.value),j(a.value,l=>{c()})}function S(l){console.log(l),j([l],f=>{i()})}function O(l){$(l)}async function j(l,f){const{data:N,error:q}=await $e(l);if(!q)f&&f(N);else return!1}return(l,f)=>{const N=pe,q=Te,ue=ie;return T(),Q("div",at,[t(Ke,{model:e(v),"onUpdate:model":f[0]||(f[0]=x=>E(v)?v.value=x:null),onReset:e(R),onSearch:e(b)},null,8,["model","onReset","onSearch"]),t(ue,{title:e(s)("page.manage.role.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":r(()=>[t(N,{columns:e(g),"onUpdate:columns":f[1]||(f[1]=x=>E(g)?g.value=x:null),"disabled-delete":e(a).length===0,"is-view-add-button":e(ee)("sys:role:save"),"is-view-delete-button":e(ee)("sys:role:delete"),loading:e(C),onAdd:e(M),onDelete:o,onRefresh:e(b)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:r(()=>[t(q,{"checked-row-keys":e(a),"onUpdate:checkedRowKeys":f[2]||(f[2]=x=>E(a)?a.value=x:null),columns:e(u),data:e(k),size:"small","flex-height":!e(y).isMobile,"scroll-x":702,loading:e(C),remote:"","row-key":x=>x.id,pagination:e(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Ae,{visible:e(p),"onUpdate:visible":f[3]||(f[3]=x=>E(p)?p.value=x:null),"operate-type":e(D),"row-data":e(B),onSubmitted:e(b)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(tt,{visible:e(n),"onUpdate:visible":f[4]||(f[4]=x=>E(n)?n.value=x:null),roleRow:m.value},null,8,["visible","roleRow"])]),_:1},8,["title"])])}}});export{vt as default};
