import{_ as ie}from"./round-add-CmnuyzV1.js";import{d as te,aG as ce,W as ue,X as de,A as pe,au as me,aI as fe,z as ae,s as b,bZ as _e,c as I,o as y,a7 as oe,w as s,f as a,L as he,K as ge,aF as ve,h as n,I as ne,B as w,g as B,t as Z,$ as T,cu as ye,aP as Q,b5 as we,aT as be,aE as W,i as ke,E as V,b as X,F as A,aU as O,cR as Se,H as z,aJ as xe,dQ as je,dR as Te,aZ as De,ap as Ce}from"./index-CYktWG4g.js";import{u as Ne,a as Pe}from"./table-5HkGqXjJ.js";import{_ as ze,d as Ie}from"./drawerLog-BEOTWyG-.js";import{_ as Be}from"./round-search-DE64LlxI.js";import{u as Y}from"./usePageData-B3dmJo7x.js";import{_ as Re}from"./Grid-yccwcNrM.js";import{_ as Ue}from"./FormItemGridItem-CEINFz71.js";import{N as Le}from"./Popconfirm-CztqIDpP.js";import"./text-DOrZBLOM.js";const Fe=te({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ce(["reset","search","clear"],["update:model"]),setup(_,{emit:R}){const h=ue(),U=de(),p=R,{formRef:m}=pe(),L=me("pname"),r=fe(_,"model"),F=ae(),l=b([]),{pageData:i,getData:v,nextPage:E}=Y(ye),g=async e=>{const t=e.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&i.data.length<i.total&&(await E(),l.value=i.data,await Q(),setTimeout(()=>{t.scrollTop=c}))},{pageData:f,getData:q,nextPage:$}=Y(we),D=async e=>{const t=e.currentTarget,c=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&f.data.length<f.total&&(await $(),l.value=f.data,await Q(),setTimeout(()=>{t.scrollTop=c}))},G=async e=>{r.value.creater=e,p("search")},k=async e=>{var t,c;x.value=!0,e?(r.value.pid=e,p("search"),F.setProjectInfo({pname:(t=l.value.find(d=>d.id==e))==null?void 0:t.proname,pid:e}),L.value=(c=l.value.find(d=>d.id==e))==null?void 0:c.proname):p("search")},H=_e.debounce(async e=>{await v({fuzzy:e,page:1}),l.value=i.data},300),S=b(!1),x=b(!1),j=e=>{if(r.value.pid=null,S.value=!0,x.value=!1,!e){N();return}H(e)},C=async()=>{S.value&&!x.value&&(await v({page:1}),l.value=i.data,S.value=!1)},N=async()=>{await v({page:1}),l.value=i.data};(async()=>{await v(),l.value=i.data,r.value.pid=h.query.prjId?Number(h.query.prjId):void 0,r.value.fuzzy=h.query.pname?h.query.pname:"",p("search"),setTimeout(()=>{U.replace({path:h.path,query:{}})},10)})(),q({usertypes:"2,3"});async function o(){p("search")}return(e,t)=>{const c=ve,d=Ue,K=Be,P=w,u=ne,se=Re,le=he,re=oe;return y(),I(re,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[a(le,{ref_key:"formRef",ref:m,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ge(o,["enter"])},{default:s(()=>[a(se,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:s(()=>[a(d,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:s(()=>[a(c,{filterable:"",clearable:"",value:r.value.pid,"onUpdate:value":[t[0]||(t[0]=M=>r.value.pid=M),k],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:l.value,onScroll:g,onClear:N,onSearch:j,onBlur:C},null,8,["value","options"])]),_:1}),a(d,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:s(()=>[a(c,{clearable:"",filterable:"",value:r.value.creater,"onUpdate:value":[t[1]||(t[1]=M=>r.value.creater=M),G],placeholder:"请选择","label-field":"username","value-field":"id",options:n(f).data,onScroll:D},null,8,["value","options"])]),_:1}),a(d,{span:"24  s:12 m:6",class:"pr-24px"},{default:s(()=>[a(u,{class:"w-full"},{default:s(()=>[a(P,{type:"primary",ghost:"",onClick:o},{icon:s(()=>[a(K,{class:"text-icon"})]),default:s(()=>[B(" "+Z(n(T)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ee={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},qe={key:0};function ee(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!De(_)}const Qe=te({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0}},emits:["thereIsData"],setup(_,{expose:R,emit:h}){const U=be(),p=ae(),m=_,L=b("");Ce("pname",L);const r=h,{columns:F,data:l,getData:i,loading:v,mobilePagination:E,searchParams:g}=Ne({showTotal:!0,immediate:!1,apiFn:je,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:o=>a("div",null,[o.username+"的项目总结"])},{key:"charctras",title:"字符数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:T("common.operate"),align:"center",width:140,fixed:"right",render:o=>{let e;return a("div",{class:"flex-center gap-8px"},[a(w,{type:"primary",ghost:!0,size:"small",onClick:()=>N(o)},{default:()=>[B("查看详情")]}),p.userInfo.id==o.creater&&z(a(w,{type:"primary",ghost:!0,size:"small",onClick:()=>x(o.id)},ee(e=T("common.edit"))?e:{default:()=>[e]}),[[V("no-auth"),"project:Summary:update"]]),p.userInfo.id==o.creater&&a(Le,{onPositiveClick:()=>S(o.id)},{default:()=>T("common.confirmDelete"),trigger:()=>{let t;return z(a(w,{type:"error",ghost:!0,size:"small"},ee(t=T("common.delete"))?t:{default:()=>[t]}),[[V("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:f,operateType:q,editingData:$,handleAdd:D,handleEdit:G,checkedRowKeys:k,onDeleted:H}=Pe(l,i);async function S(o){const{data:e,error:t}=await Te(o);t||H()}function x(o){G(o)}const j=b(!1),C=b({}),N=o=>{j.value=!0,C.value=o},J=()=>{i()};return W(()=>m.pid,async o=>{o&&(g.pid=o)}),W(()=>l.value,async o=>{o.length>0?r("thereIsData",1):r("thereIsData",0)}),ke(()=>{}),R({getData:i}),(o,e)=>{const t=ne,c=ie,d=xe,K=oe,P=V("no-auth");return y(),X("div",Ee,[m.pid?A("",!0):(y(),I(Fe,{key:0,model:n(g),"onUpdate:model":e[0]||(e[0]=u=>O(g)?g.value=u:null),onReset:J,onSearch:n(i),onClear:e[1]||(e[1]=u=>l.value=[])},null,8,["model","onSearch"])),a(K,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Se({header:s(()=>[a(t,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:s(()=>[m.pid?A("",!0):(y(),X("div",qe,"项目总结"))]),_:1}),m.pid?z((y(),I(n(w),{key:0,onClick:n(D),size:"small",ghost:"",type:"primary"},{icon:s(()=>[a(c,{class:"text-icon"})]),default:s(()=>[e[5]||(e[5]=B(" "+Z("新增")))]),_:1,__:[5]},8,["onClick"])),[[P,"project:Summary:insert"]]):A("",!0)]),default:s(()=>[a(d,{"checked-row-keys":n(k),"onUpdate:checkedRowKeys":e[2]||(e[2]=u=>O(k)?k.value=u:null),columns:n(F),data:n(l),size:"small","flex-height":!n(U).isMobile,loading:n(v),remote:"","row-key":u=>u.id,pagination:n(E),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(ze,{visible:n(f),"onUpdate:visible":e[3]||(e[3]=u=>O(f)?f.value=u:null),onSubmitted:n(i),"operate-type":n(q),pid:m.pid||n(g).pid,"row-data":n($)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),a(Ie,{visible:j.value,"onUpdate:visible":e[4]||(e[4]=u=>j.value=u),"row-data":C.value},null,8,["visible","row-data"])]),_:2},[m.pid?void 0:{name:"header-extra",fn:s(()=>[a(t,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:s(()=>[z((y(),I(n(w),{onClick:n(D),size:"small",ghost:"",type:"primary"},{icon:s(()=>[a(c,{class:"text-icon"})]),default:s(()=>[e[6]||(e[6]=B(" "+Z("新增")))]),_:1,__:[6]},8,["onClick"])),[[P,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{Qe as default};
