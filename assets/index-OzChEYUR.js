import{_ as le,l as te}from"./lodash-Bb5Mhbdd.js";import{d as Q,n as F,j as m,p as ae,s as ne,o as X,c as oe,w as s,g as n,i as S,h as D,t as J,$ as L,F as ie,aG as re,aw as C,ax as R,Z as se,J as ue,B as H,N as Y,O as de,ad as ee,a3 as pe,r as K,av as B,A as ce,e as ve,ai as me,aZ as fe,aj as ge,R as Ie}from"./index-CAHy1rbE.js";import{_ as he}from"./round-search-CJzRk-ol.js";import{_ as _e}from"./round-refresh-Vt3hK0Ql.js";import{a as ye,S as we,t as W}from"./alarm-UiJj9cxi.js";import{_ as Ae}from"./DatePicker-BeW3vjvL.js";import{_ as Se}from"./Cascader-Dm-I59zI.js";import{_ as be}from"./FormItemGridItem-DHm-WNFb.js";import{_ as Oe}from"./Grid-BeeM7t-L.js";import{_ as xe}from"./originlogInfo.vue_vue_type_script_setup_true_lang-DVwQ1bkN.js";import{e as Ee}from"./exportExcel-D6OyA9oJ.js";import{w as ke,u as Ce}from"./events-BV0CETks.js";import{n as Te}from"./Collection-Wnwvjk6s.js";import{f as Le,a as Pe}from"./common-R_gsKHi_.js";import{T as q}from"./basicconf-CJ7gvgsI.js";import"./TimePicker-D8ULkgw8.js";import"./defineProperty-CIwHjFWx.js";import"./collection-Ba51FyFv.js";import"./DescriptionsItem-BnzyTMSr.js";import"./CollapseItem-B3ShhCod.js";const $e=Q({name:"FormSearch",__name:"form-search",props:F(["eventsTypeDataList","collectorList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:F(["search"],["update:model"]),setup(I,{emit:M}){const h=I,f=M;m(0);const{formRef:P,restoreValidation:j}=ae(),e=ne(I,"model");async function z(){await j(),e.value.etypeid=null,e.value.elevel=null,e.value.rtime=null,e.value.user=null,e.value.logodid=null,e.value.target=null,e.value.startAndEndOriginIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.expression=null,e.value.startOriginIp=null,e.value.endOriginIp=null,e.value.startAimOriginIp=null,e.value.endAimOriginIp=null,e.value.startSourceIp=null,e.value.endSourceIp=null,re(()=>{f("search")})}const U=o=>{e.value.elevel=o,i()},V=(o,r)=>{e.value.rtime=r,i()},T=o=>{e.value.logodid=o,i()},$=()=>{e.value.startAndEndOriginIp=null,i()},N=()=>{e.value.startAndEndSourceIp=null,i()},_=()=>{e.value.startAndEndAimSourceIp=null,i()};async function i(){var o,r,g,d,O,y,v,w,A,x,E,k;if(e.value.startAndEndOriginIp&&e.value.startAndEndOriginIp.length>0?(e.value.startOriginIp=e.value.startAndEndOriginIp[0]||null,e.value.endOriginIp=e.value.startAndEndOriginIp[1]||null):(e.value.startOriginIp=null,e.value.endOriginIp=null),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimOriginIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimOriginIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimOriginIp=null,e.value.endAimOriginIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=null,e.value.endSourceIp=null),e.value.startOriginIp&&!C(e.value.startOriginIp)||e.value.endOriginIp&&!C(e.value.endOriginIp))return(o=window.$message)==null||o.destroyAll(),(r=window.$message)==null||r.error("请输入正确的IP地址"),!1;if(e.value.startOriginIp&&e.value.endOriginIp&&R(e.value.startOriginIp,e.value.endOriginIp)>0)return(g=window.$message)==null||g.destroyAll(),(d=window.$message)==null||d.error("起始IP不能大于终止IP"),!1;if(e.value.startAimOriginIp&&!C(e.value.startAimOriginIp)||e.value.endAimOriginIp&&!C(e.value.endAimOriginIp))return(O=window.$message)==null||O.destroyAll(),(y=window.$message)==null||y.error("请输入正确的IP地址"),!1;if(e.value.startAimOriginIp&&e.value.endAimOriginIp&&R(e.value.startAimOriginIp,e.value.endAimOriginIp)>0)return(v=window.$message)==null||v.destroyAll(),(w=window.$message)==null||w.error("起始IP不能大于终止IP"),!1;if(e.value.startSourceIp&&!C(e.value.startSourceIp)||e.value.endSourceIp&&!C(e.value.endSourceIp))return(A=window.$message)==null||A.destroyAll(),(x=window.$message)==null||x.error("请输入正确的IP地址"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&R(e.value.startSourceIp,e.value.endSourceIp)>0)return(E=window.$message)==null||E.destroyAll(),(k=window.$message)==null||k.error("起始IP不能大于终止IP"),!1;f("search")}const b=le.debounce(i,1e3,{leading:!0,trailing:!1});return(o,r)=>{const g=Se,d=be,O=se,y=Ae,v=ue,w=_e,A=H,x=he,E=Y,k=Oe,l=de,t=ee;return X(),oe(t,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[n(l,{ref_key:"formRef",ref:P,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ie(S(b),["enter"])},{default:s(()=>[n(k,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:s(()=>[n(d,{span:"24 s:24 m:8 l:6",label:"采集器",path:"logodid"},{default:s(()=>[n(g,{disabled:h.logsoudev,value:e.value.logodid,"onUpdate:value":[r[0]||(r[0]=a=>e.value.logodid=a),i],placeholder:"请选择采集器",options:h.collectorList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["disabled","value","options"])]),_:1}),n(d,{span:"24 s:24 m:8 l:6",label:"事件类型",path:"etypeid"},{default:s(()=>[n(g,{value:e.value.etypeid,"onUpdate:value":[r[1]||(r[1]=a=>e.value.etypeid=a),T],clearable:"",placeholder:"请选择事件","max-tag-count":1,options:h.eventsTypeDataList,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),n(d,{span:"24 s:24 m:8 l:6",label:"安全级别",path:"leid"},{default:s(()=>[n(O,{filterable:"",clearable:"",placeholder:"请选择安全级别",value:e.value.elevel,"onUpdate:value":[r[2]||(r[2]=a=>e.value.elevel=a),U],options:S(ye),"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),n(d,{span:"24 s:24 m:8 l:6",label:"接收时间",path:"rtime"},{default:s(()=>[n(y,{placeholder:"请选择接收时间","formatted-value":e.value.rtime,"onUpdate:formattedValue":r[3]||(r[3]=a=>e.value.rtime=a),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:"",style:{width:"100%"},"onUpdate:value":V},null,8,["formatted-value"])]),_:1}),n(d,{span:"24 s:24 m:10 l:8",label:"源IP",path:"startAndEndOriginIp"},{default:s(()=>[n(v,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndOriginIp,"onUpdate:value":r[4]||(r[4]=a=>e.value.startAndEndOriginIp=a),onClear:$},null,8,["value"])]),_:1}),n(d,{span:"24 s:24 m:10 l:8",label:"目的IP",path:"startAndEndAimSourceIp"},{default:s(()=>[n(v,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":r[5]||(r[5]=a=>e.value.startAndEndAimSourceIp=a),onClear:_},null,8,["value"])]),_:1}),n(d,{span:"24 s:24 m:10 l:8",label:"发生源IP",path:"startAndEndSourceIp"},{default:s(()=>[n(v,{pair:"",separator:"-",disabled:h.logsoudev,placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":r[6]||(r[6]=a=>e.value.startAndEndSourceIp=a),onClear:N},null,8,["disabled","value"])]),_:1}),n(d,{span:"24 s:24 m:8 l:6",label:"目标对象",path:"target"},{default:s(()=>[n(v,{placeholder:"请输入目标对象",value:e.value.target,"onUpdate:value":r[7]||(r[7]=a=>e.value.target=a),clearable:""},null,8,["value"])]),_:1}),n(d,{span:"24 s:24 m:8 l:6"},{default:s(()=>[n(E,{class:"w-full"},{default:s(()=>[n(A,{onClick:z},{icon:s(()=>[n(w,{class:"text-icon"})]),default:s(()=>[D(" "+J(S(L)("common.reset")),1)]),_:1}),n(A,{type:"primary",ghost:"",onClick:S(b)},{icon:s(()=>[n(x,{class:"text-icon"})]),default:s(()=>[D(" "+J(S(L)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Ne={class:"min-h-500px flex-col-stretch overflow-hidden lt-sm:overflow-auto"};function Z(I){return typeof I=="function"||Object.prototype.toString.call(I)==="[object Object]"&&!me(I)}const De=Q({name:"eventalarm_originlog",__name:"index",props:{logsoudev:{},aip:{}},setup(I){const M=pe(),h=m(window.innerHeight-395),f=I,P=m([]);(async()=>{const{data:l,error:t}=await Te({page:1,limit:1e3,_t:new Date().getTime()});if(t)console.error("获取采集器列表失败:",t);else{const a=l;P.value=a.list.map(u=>({...u,id:u.id,type:u.cname}))}})();const e=m([]),z=m([]);async function U(){const{data:l,error:t}=await Le();t||(e.value=l,await V())}async function V(){const{data:l,error:t}=await Pe();if(!t){z.value=l;let a=e.value.concat(l);e.value=fe(a)}}U();const T=m(!1),$=m(),N=m(),_=m(!1),i=K({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),b=[{title:"序号",key:"index",width:80,align:"center",render:l=>`${l.index}`},{key:"type",title:"采集器名称",align:"center",width:180},{key:"osubject",title:"事件主体",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"odescribe",title:"事件描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"oresult",title:"事件结果",align:"center",width:180,ellipsis:{tooltip:!0},render:l=>{var t,a;return n(B,{size:"small",type:(t=l.oresult)!=null&&t.includes("成功")?"success":(a=l.oresult)!=null&&a.includes("失败")?"error":"warning"},{default:()=>[l.oresult]})}},{key:"level",title:"安全级别",align:"center",width:140,render:l=>{const t=we[l.level];let a={color:W[l.level],textColor:"#ffffff",borderColor:W[l.level]};return n(B,{size:"small",color:a},Z(t)?t:{default:()=>[t]})}},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"elevel",title:"事件等级",align:"center",width:120,render:l=>{(l.elevel===void 0||l.elevel===null)&&(l.elevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},a=L(q[l.elevel]);let u={color:t[l.elevel],textColor:"#ffffff",borderColor:t[l.elevel]};return n(B,{size:"small",color:u},Z(a)?a:{default:()=>[a]})}},{key:"etime",title:"日志时间",align:"center",width:160},{key:"operate",title:L("common.operate"),align:"center",width:100,fixed:"right",render:l=>n("div",{class:"flex-center gap-8px"},[n(H,{type:"info",ghost:!0,size:"small",onClick:()=>A(l)},{default:()=>[D("详情")]})])}],o=m([]),r=m(0),g=async(l=!1)=>{if(!_.value)_.value=!0;else return;_.value=!0,f.logsoudev&&f.aip&&(d.value=!1,i.logodid=f.logsoudev,i.startAndEndSourceIp=[f.aip,f.aip],i.startSourceIp=f.aip,i.endSourceIp=f.aip);const{data:t,error:a}=await Ce(i);a||(r.value=t.length,l?o.value=[...o.value,...t]:o.value=t,o.value=o.value.sort((u,p)=>p.id-u.id).map((u,p)=>(u.index=p+1,u)),_.value=!1)},d=m(!0),O=async()=>{o.value=[],i.pageId=void 0,(t=>Object.keys(t).filter(p=>p!=="limit"&&p!=="_t").some(p=>t[p]!==void 0&&t[p]!==""&&t[p]!==null))(i)?d.value=!1:(d.value=!0,w()),i.pageId=void 0,await g(),y()},y=async()=>{var l,t,a;if(o.value.length<h.value/44&&o.value.length<v.total){if(i.pageId==((l=o.value[o.value.length-1])==null?void 0:l.id))return;i.pageId=((a=(t=o.value)==null?void 0:t[o.value.length-1])==null?void 0:a.id)??void 0,g(!0)}};ce(async()=>{await g(),await w(),y()});const v=K({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:l,endIndex:t,page:a,pageSize:u,pageCount:p,itemCount:c}){return`已加载${o.value.length}条`+(o.value.length?d.value?` 共计 ${o.value.length>0?c??0:0} 条`:r.value==i.limit?"  预计还有更多":"  没有更多了":"")}});async function w(){const{data:l,error:t}=await ke();t||(v.pageCount=20,v.total=Number(l),v.itemCount=Number(l))}const A=l=>{$.value=l.id,N.value=l,T.value=!0};function x(l){Math.abs(l.target.scrollTop+l.target.offsetHeight-l.target.scrollHeight)<=20&&v.total>o.value.length&&E()}const E=te.debounce(()=>{var l;if(((l=o.value)==null?void 0:l.length)<v.total){if(i.pageId==o.value[o.value.length-1].id)return;i.pageId=o.value[o.value.length-1].id,g(!0)}},300);async function k(){if(!o.value.length)return;const l=JSON.parse(JSON.stringify(o.value));console.log(l);const t=[];l.forEach(u=>{const p={};b.forEach(c=>{if(u.hasOwnProperty(c.key)){const G=c.key=="elevel"?u[c.key]!=null?L(q[u[c.key]]):"":u[c.key];p[c.title]=G}}),t.push(p)}),Ee(t,500,[{wpx:120},{wpx:120},{wpx:80},{wpx:100},{wpx:100},{wpx:120},{wpx:100},{wpx:100},{wpx:500}],"原始日志_"+new Date().getTime())}return(l,t)=>{const a=Y,u=ge,p=ee;return X(),ve("div",Ne,[n($e,{model:i,"onUpdate:model":t[0]||(t[0]=c=>i=c),onSearch:O,eventsTypeDataList:e.value,collectorList:P.value,class:"mb-16px",logsoudev:f.logsoudev},null,8,["model","eventsTypeDataList","collectorList","logsoudev"]),n(p,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[n(a,null,{default:s(()=>[n(S(H),{type:"primary",size:"small",ghost:"",onClick:k,title:"导出已加载"},{default:s(()=>[D("导出已加载")]),_:1})]),_:1})]),default:s(()=>[n(u,{columns:b,data:o.value,size:"small","flex-height":!S(M).isMobile,loading:_.value,remote:"","row-key":c=>c.id,"virtual-scroll":"","scroll-x":b.reduce((c,G)=>c+G.width,0),pagination:v,class:"sm:h-full",onScroll:x,"max-height":h.value},null,8,["data","flex-height","loading","row-key","scroll-x","pagination","max-height"])]),_:1}),n(xe,{detailVisible:T.value,"onUpdate:detailVisible":t[1]||(t[1]=c=>T.value=c),detailId:$.value,detailInfo:N.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),tl=Ie(De,[["__scopeId","data-v-c1b96bb9"]]);export{tl as default};
