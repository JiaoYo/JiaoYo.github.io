import{_ as mt}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BZQqvBYi.js";import{_ as ft}from"./round-refresh--7nDZKFa.js";import{_ as gt}from"./export-BxrGs5wU.js";import{_ as vt}from"./round-delete-CUFrmR4u.js";import{aM as je,o as V,e as Ne,f as Ce,d as Ae,p as fe,r as Ie,q as Ve,s as Oe,v as ht,ab as Be,b as st,$ as N,aR as dt,g as e,z as ke,w as a,h as w,t as j,i as l,aF as Q,A as te,aI as Fe,ao as Ee,aN as Ue,aT as Le,ak as $e,L as ge,B as M,aK as qe,aG as Ge,Q as Je,P as Re,aH as Xe,aL as He,bf as bt,k as xe,aE as tt,c as le,D as Pe,a0 as _t,ai as yt,x as wt,C as Tt,af as pe,aJ as kt,y as Ft,H as It,I as Lt,G as Nt,aC as Dt,a6 as Pt}from"./index-L7fRKv8Z.js";import{_ as Ct}from"./round-add-VnWaaWMf.js";import{_ as Ut}from"./round-search-CmXFf55K.js";import{u as We,a as Qe}from"./table-Ds3NGQ7z.js";import{p as me,d as rt,a as xt,b as lt,c as at}from"./gather-7T5AUHLA.js";import{_ as Ye}from"./FormItemGridItem-D19u3I64.js";import{_ as Ze}from"./Grid-Co-VuAj-.js";import{N as nt}from"./Popconfirm-BcdzTihM.js";import{_ as jt}from"./InputGroupLabel-CdKC5az8.js";function At(I){return je({url:"/transTag/selectPage.do",method:"get",params:I})}function ct(I){return je({url:"/transTag/insert.do",method:"post",data:I})}function Me(I){return je({url:"/transTag/update.do",method:"post",data:I})}function ot(I){return je({url:"/transTag/delete.do",method:"get",params:I})}const $t={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Rt=Ce("path",{fill:"currentColor",d:"M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36M20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83l3.75 3.75z"},null,-1),St=[Rt];function zt(I,Y){return V(),Ne("svg",$t,[...St])}const Kt={name:"ic-round-edit",render:zt},Mt=Ae({__name:"add_model",props:fe({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:fe(["submitted"],["update:visible"]),setup(I,{emit:Y}){const n=Ie({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:{},dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),h=Ve(I,"visible"),O=Y,R=I,t=Ie(q());function q(){return{chlId:void 0,devId:void 0,tagDevId:"",tagName:"",tagId:void 0,tagDesc:"",tagUnit:"",tagType:1,tagK:1,objAddr:"0",collectType:1,dataType:4,dataFormat:0}}async function y(){var b;const{data:r,error:i}=await bt({page:1,limit:1e4,type:1});i||(n.deveicelList=r.list.map(d=>({...d,label:d.devName,value:d.id+"_"+d.chlId})),R.operateType==="add"&&n.deveicelList.length>0&&!t.tagDevId&&(t.tagDevId=(b=n.deveicelList[0])==null?void 0:b.value,t.devId=Number(t.tagDevId.split("_")[0]),t.chlId=Number(t.tagDevId.split("_")[1]),t.collectType=void 0),D())}async function D(){const{data:r,error:i}=await Le({chlId:t.chlId});i||(n.functionList=JSON.parse(r).data,t.collectType=n.functionList[0].FuncCode)}function S(){Object.assign(t,q()),y(),R.operateType==="edit"&&R.rowData&&(Object.assign(t,R.rowData),T(R.rowData))}const{formRef:Z,validate:_,restoreValidation:ae}=Oe();ht(),Be(h,()=>{h.value&&(S(),ae())});const A=()=>{h.value=!1};function T(r,i){console.log(r),r==0||r==1||r==2||r==3||r==4||r==7?n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:r==5||r==6||r==8||r==9||r==10||r==12||r==13?n.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],n.collectionPointForm.dataFormatList.find(b=>b.value===t.dataFormat)||(t.dataFormat=n.collectionPointForm.dataFormatList[0].value)}const z=async()=>{var r,i;if(await _(),console.log(t),R.operateType==="add"){const{data:b,error:d}=await ct([t]);d||(A(),(r=window.$message)==null||r.success("添加成功"),O("submitted"))}else{const{data:b,error:d}=await Me([t]);d||(A(),(i=window.$message)==null||i.success("编辑成功"),O("submitted"))}},$={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},P={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},x={devId:P,tagName:$,tagDesc:$,tagK:P,objAddr:$,collectType:P,dataType:P,dataFormat:P},X=st(()=>({add:N("common.add"),edit:N("common.edit")})[R.operateType]),{columns:H,columnChecks:se,data:W,getData:K,loading:F,mobilePagination:ve,searchParams:m,resetSearchParams:Se}=We({apiFn:dt,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",multiple:!1,align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140},{key:"devId",title:"所属设备",align:"center",width:140,render:r=>{var i;return e("span",null,[((i=n.collectionPointForm.deveicelList.find(b=>b.id===r.devId))==null?void 0:i.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),de=()=>{K()},{drawerVisible:ze,operateType:v,editingData:g,handleAdd:k,handleEdit:B,checkedRowKeys:L,onBatchDeleted:he,onDeleted:ee}=Qe(W,K);async function ne(){const{data:r,error:i}=await Ue();i||(console.log("data",r),r.length>0&&(n.collectionPointForm.channelList=r.filter(b=>b.chlType!==1).map(b=>({label:b.chlName,value:b.id,devicePojoList:b.devicePojoList||[]}))))}ne();const re=r=>{var b;m.chlid=r,m.devId=null;let i=(b=n.collectionPointForm.channelList.find(d=>d.value==r))==null?void 0:b.devicePojoList;n.collectionPointForm.deveicelList=i,oe(),K()};function be(){var r,i;if(n.collectionPointForm.channelList.length>0)if(m.chlid)n.collectionPointForm.visible=!0;else{let b=n.collectionPointForm.channelList[0];m.chlid=b.value,n.collectionPointForm.deveicelList=b.devicePojoList,oe(),L.value=[t.tagId],n.collectionPointForm.checkedRows.tagName=t.tagName,n.collectionPointForm.checkedRows.id=t.tagId}else return(r=window.$message)==null||r.destroyAll(),(i=window.$message)==null||i.warning("暂无通道，请您先创建通道在进行查询"),!1}async function oe(){const{data:r,error:i}=await Le({chlId:m.chlid});i||(n.collectionPointForm.functionList=JSON.parse(r).data,n.collectionPointForm.visible=!0,K())}function _e(){n.collectionPointForm.visible=!1}function C(r,i,b){console.log(i),n.collectionPointForm.checkedRows=i[0]}function ye(){var r,i;if(L.value.length===0)return(r=window.$message)==null||r.destroyAll(),(i=window.$message)==null||i.warning("请您先选择采集点"),!1;t.tagName=n.collectionPointForm.checkedRows.tagName,t.tagId=n.collectionPointForm.checkedRows.id,t.tagDesc||(t.tagDesc=n.collectionPointForm.checkedRows.tagDesc),n.collectionPointForm.visible=!1}return(r,i)=>{const b=$e,d=Ye,De=ge,Ke=M,s=qe,o=Ge,c=ge,u=Ze,E=Je,U=M,G=Re,J=Xe,ce=He,ue=ke("no-space");return V(),Ne(Ee,null,[e(J,{show:h.value,"onUpdate:show":i[9]||(i[9]=p=>h.value=p),title:X.value,preset:"card",class:"w-50%"},{footer:a(()=>[e(G,{size:16,justify:"center"},{default:a(()=>[e(U,{onClick:A,class:"w-100px"},{default:a(()=>[w(j(l(N)("common.cancel")),1)]),_:1}),e(U,{type:"primary",class:"w-100px",onClick:z},{default:a(()=>[w(j(l(N)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(E,{ref_key:"formRef",ref:Z,model:t,rules:x,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(u,{responsive:"screen","item-responsive":""},{default:a(()=>[e(d,{span:"24 m:12",label:"所属设备",path:"belongingChannel"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择所属设备",value:t.devId,"onUpdate:value":i[0]||(i[0]=p=>t.devId=p),"value-field":"id",options:n.deveicelList},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:a(()=>[e(s,null,{default:a(()=>[e(De,{value:t.tagName,"onUpdate:value":i[1]||(i[1]=p=>t.tagName=p),style:{width:"80%"},readonly:""},null,8,["value"]),e(Ke,{type:"primary",ghost:"",onClick:be},{default:a(()=>[w("请选择")]),_:1})]),_:1})]),_:1}),e(d,{span:"24 m:12",label:"测点类型",path:"tagType"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择测点类型",value:t.tagType,"onUpdate:value":i[2]||(i[2]=p=>t.tagType=p),options:l(Q)(l(me))},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:a(()=>[e(o,{clearable:"",value:t.tagK,"onUpdate:value":i[3]||(i[3]=p=>t.tagK=p),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择转发功能码",value:t.collectType,"onUpdate:value":i[4]||(i[4]=p=>t.collectType=p),options:n.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:a(()=>[e(c,{clearable:"",value:t.objAddr,"onUpdate:value":i[5]||(i[5]=p=>t.objAddr=p),placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(d,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择数据类型",value:t.dataType,"onUpdate:value":[i[6]||(i[6]=p=>t.dataType=p),T],options:l(Q)(l(rt))},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择数据格式",value:t.dataFormat,"onUpdate:value":i[7]||(i[7]=p=>t.dataFormat=p),options:n.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:a(()=>[e(c,{clearable:"",value:t.tagUnit,"onUpdate:value":i[8]||(i[8]=p=>t.tagUnit=p),placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(J,{show:n.collectionPointForm.visible,"onUpdate:show":i[16]||(i[16]=p=>n.collectionPointForm.visible=p),title:"选择采集点",preset:"card",class:"w-60%"},{footer:a(()=>[e(G,{size:16,justify:"end"},{default:a(()=>[e(U,{onClick:_e},{default:a(()=>[w(j(l(N)("common.cancel")),1)]),_:1}),e(U,{type:"primary",onClick:ye},{default:a(()=>[w(j(l(N)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(E,{model:n.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(u,{responsive:"screen","item-responsive":""},{default:a(()=>[e(d,{span:"24 m:12",label:"所属通道"},{default:a(()=>[e(b,{filterable:"",placeholder:"请选择所属通道",value:l(m).chlid,"onUpdate:value":i[10]||(i[10]=p=>l(m).chlid=p),options:n.collectionPointForm.channelList,onUpdateValue:re},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"所属设备"},{default:a(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择所属设备",value:l(m).devId,"onUpdate:value":i[11]||(i[11]=p=>l(m).devId=p),"label-field":"devName","value-field":"id",options:n.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"测点类型"},{default:a(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:l(m).tagType,"onUpdate:value":i[12]||(i[12]=p=>l(m).tagType=p),options:l(Q)(l(me))},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"测点功能码"},{default:a(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:l(m).collectType,"onUpdate:value":i[13]||(i[13]=p=>l(m).collectType=p),options:n.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"测点名称"},{default:a(()=>[te(e(c,{clearable:"",value:l(m).fuzzy,"onUpdate:value":i[14]||(i[14]=p=>l(m).fuzzy=p),placeholder:"请输入测点名称"},null,8,["value"]),[[ue]])]),_:1}),e(d,{span:"24 m:12",label:" "},{default:a(()=>[e(U,{onClick:de},{default:a(()=>[w(j(l(N)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(ce,{"checked-row-keys":l(L),"onUpdate:checkedRowKeys":[i[15]||(i[15]=p=>Fe(L)?L.value=p:null),C],columns:l(H),data:l(W),size:"small","max-height":500,loading:l(F),remote:"","row-key":p=>p.id,pagination:l(ve)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1},8,["show"])],64)}}}),Vt=Ce("span",null,[w("物模型标识"),Ce("br"),w("(测点描述)")],-1),Ot={class:"flex"},Bt=Ae({__name:"add_multipe_model",props:fe(["devId","chlid"],{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:fe(["submitted"],["update:visible"]),setup(I,{emit:Y}){const n=Ie({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:[],dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),h=Ve(I,"visible"),O=I,R=Y,t=Ie(q());function q(){return{chlId:void 0,devId:void 0,tagDevId:void 0,tagName:"",tagNames:"",tagId:"",tagDesc:"",tagDescs:"",tagUnit:"",tagType:0,tagK:1,objAddr:"0",collectType:void 0,dataType:4,dataFormat:0}}async function y(){var c,u;const{data:s,error:o}=await Ue({type:1});if(!o){const E=[];s.forEach(U=>{U.devicePojoList&&U.devicePojoList.length>0&&U.devicePojoList.forEach(G=>{E.push({label:`${U.chlName}__${G.devName}`,value:`${G.id}_${U.id}`})})}),n.deveicelList=E,n.deveicelList.length>0&&(t.tagDevId=O.devId&&O.chlid?O.devId+"_"+O.chlid:n.deveicelList[0].value,t.devId=Number((c=t.tagDevId)==null?void 0:c.split("_")[0]),t.chlId=Number((u=t.tagDevId)==null?void 0:u.split("_")[1]),t.collectType=void 0,D())}}async function D(){const{data:s,error:o}=await Le({chlId:t.chlId});o||(n.functionList=JSON.parse(s).data,t.collectType=n.functionList[0].FuncCode)}function S(){Object.assign(t,q()),y(),n.collectionPointForm.checkedRows=[],C.value=[]}const{formRef:Z,validate:_,restoreValidation:ae}=Oe();Be(h,()=>{h.value&&(S(),ae())});const A=()=>{h.value=!1};function T(s,o){console.log(s),s==0||s==1||s==2||s==3||s==4||s==7?n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:s==5||s==6||s==8||s==9||s==10||s==12||s==13?n.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],n.collectionPointForm.dataFormatList.find(c=>c.value===t.dataFormat)||(t.dataFormat=n.collectionPointForm.dataFormatList[0].value)}const z=async()=>{var G,J,ce;await _();let s=t.tagNames.split(","),o=(G=t.tagDescs)==null?void 0:G.split(","),c=(J=t.tagId)==null?void 0:J.split(","),u=[];delete t.tagNames,delete t.tagDescs,delete t.tagId,s.forEach((ue,p)=>{var we,Te;let ie={...t,tagName:ue,tagDesc:t.tagDesc?t.tagDesc:o[p],tagId:Number(c[p]),objAddr:t.objAddr?+t.objAddr+p:p+"",devId:Number((we=t.tagDevId)==null?void 0:we.split("_")[0]),chlId:Number((Te=t.tagDevId)==null?void 0:Te.split("_")[1])};u.push(ie)});const{data:E,error:U}=await ct(u);U||(A(),(ce=window.$message)==null||ce.success("添加成功"),R("submitted"))},$={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},P={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},x={tagDevId:$,tagName:$,tagDesc:[{trigger:["input","blur"],validator:(s,o)=>!/\$/.test(o),message:"不能含有非法字符"},{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]}],tagK:P,objAddr:$,collectType:P,dataType:P,dataFormat:P},X=st(()=>({add:"批量新增",edit:N("common.edit")}).add),{columns:H,columnChecks:se,data:W,getData:K,loading:F,mobilePagination:ve,searchParams:m,resetSearchParams:Se}=We({apiFn:dt,apiParams:{page:1,pageSize:200,limit:200,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140,render:s=>{var o;return e("span",null,[((o=me.find(c=>c.value===s.tagType))==null?void 0:o.label)||""])}},{key:"belongingEquipment",title:"所属设备",align:"center",width:140,render:s=>{var o;return e("span",null,[((o=n.collectionPointForm.deveicelList.find(c=>c.id===s.devId))==null?void 0:o.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),de=()=>{K()},{drawerVisible:ze,operateType:v,editingData:g,handleAdd:k,handleEdit:B,checkedRowKeys:L,onBatchDeleted:he,onDeleted:ee}=Qe(W,K);async function ne(){const{data:s,error:o}=await Ue();o||(console.log("data",s),s.length>0&&(n.collectionPointForm.channelList=s.filter(c=>c.chlType!==1).map(c=>({label:c.chlName,value:c.id,devicePojoList:c.devicePojoList||[]}))))}const re=s=>{var c;m.chlid=s,m.devId=null;let o=(c=n.collectionPointForm.channelList.find(u=>u.value==s))==null?void 0:c.devicePojoList;n.collectionPointForm.deveicelList=o,oe(),K()};ne();function be(){var s,o;if(L.value=C.value.map(c=>c.id),n.collectionPointForm.channelList.length>0)if(m.chlid)n.collectionPointForm.visible=!0;else{let c=n.collectionPointForm.channelList[0];m.chlid=c.value,n.collectionPointForm.deveicelList=c.devicePojoList,oe()}else return(s=window.$message)==null||s.destroyAll(),(o=window.$message)==null||o.warning("暂无通道，请您先创建通道在进行查询"),!1}async function oe(){const{data:s,error:o}=await Le({chlId:m.chlid});o||(n.collectionPointForm.functionList=JSON.parse(s).data,n.collectionPointForm.visible=!0,K())}function _e(){n.collectionPointForm.visible=!1}const C=xe([]),ye=[{title(){return e("div",{class:"flex"},[e("span",{class:"flex-1"},[`已选${C.value.length}个`]),e("span",{class:"c-red cursor-pointer",onClick:b},[w("清空")])])},align:"center",render:s=>{var o;return e("span",null,[s.tagName,w("--"),(o=n.collectionPointForm.channelList.find(c=>c.value==s.chlId))==null?void 0:o.label])}}];function r(s,o,c){console.log(o),o=o.filter(u=>u!=null),m.devId&&(C.value=C.value.filter(u=>u.devId!=m.devId||u.page!=m.page)),m.chlid&&(C.value=C.value.filter(u=>u.chlId!=m.chlid||u.page!=m.page)),C.value.push(...o.filter(u=>u!=null)),C.value=[...new Set(C.value)],C.value.forEach(u=>{u.page=u.page?u.page:m.page})}function i(){var s,o,c,u,E;if(n.collectionPointForm.checkedRows=L.value,t.tagNames="",t.tagDescs="",t.tagId="",L.value.length===0)return(s=window.$message)==null||s.destroyAll(),(o=window.$message)==null||o.warning("请您先选择采集点"),!1;C.value.forEach(U=>{t.tagNames+=U.tagName+",",t.tagDescs+=U.tagDesc+",",t.tagId+=U.id+","}),t.tagName=C.value[0].tagName,t.tagNames=(c=t.tagNames)==null?void 0:c.substring(0,t.tagNames.length-1),t.tagDescs=(u=t.tagDescs)==null?void 0:u.substring(0,t.tagDescs.length-1),t.tagId=(E=t.tagId)==null?void 0:E.substring(0,t.tagId.length-1),n.collectionPointForm.visible=!1}const b=()=>{C.value=[],L.value=[]},d=()=>{L.value=[]},De=()=>({style:{height:"40px"}}),Ke=s=>{m.devId=s,de()};return(s,o)=>{const c=$e,u=Ye,E=ge,U=M,G=qe,J=ge,ce=Ge,ue=Ze,p=Je,ie=M,we=Re,Te=Xe,et=He,ut=ke("no-space");return V(),Ne(Ee,null,[e(Te,{show:h.value,"onUpdate:show":o[10]||(o[10]=f=>h.value=f),title:X.value,preset:"card",class:"w-50%"},{footer:a(()=>[e(we,{size:16,justify:"center"},{default:a(()=>[e(ie,{onClick:A,class:"w-100px"},{default:a(()=>[w(j(l(N)("common.cancel")),1)]),_:1}),e(ie,{type:"primary",class:"w-100px",onClick:z},{default:a(()=>[w(j(l(N)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(p,{ref_key:"formRef",ref:Z,model:t,rules:x,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(ue,{responsive:"screen","item-responsive":""},{default:a(()=>[e(u,{span:"24 m:12",label:"所属设备",path:"tagDevId"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择所属设备",value:t.tagDevId,"onUpdate:value":o[0]||(o[0]=f=>t.tagDevId=f),options:n.deveicelList},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:a(()=>[e(G,{style:{width:"100%"}},{default:a(()=>[e(E,{value:t.tagName,"onUpdate:value":o[1]||(o[1]=f=>t.tagName=f),readonly:""},null,8,["value"]),e(U,{type:"primary",ghost:"",onClick:be},{default:a(()=>[w(j(n.collectionPointForm.checkedRows.length>1?`+${n.collectionPointForm.checkedRows.length}`:"请选择"),1)]),_:1})]),_:1})]),_:1}),e(u,{span:"24 m:12",label:"物模型标识(测点描述)",path:"tagDesc"},{label:a(()=>[Vt]),default:a(()=>[e(J,{clearable:"",value:t.tagDesc,"onUpdate:value":o[2]||(o[2]=f=>t.tagDesc=f),placeholder:"请输入物模型标识(测点描述)"},null,8,["value"])]),_:1}),e(u,{span:"24 m:12",label:"测点类型",path:"dataType"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择测点类型",value:t.tagType,"onUpdate:value":o[3]||(o[3]=f=>t.tagType=f),options:l(Q)(l(me))},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:a(()=>[e(ce,{clearable:"",value:t.tagK,"onUpdate:value":o[4]||(o[4]=f=>t.tagK=f),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(u,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择转发功能码",value:t.collectType,"onUpdate:value":o[5]||(o[5]=f=>t.collectType=f),options:n.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:a(()=>[e(J,{clearable:"",value:t.objAddr,"onUpdate:value":o[6]||(o[6]=f=>t.objAddr=f),maxlength:"128",placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(u,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择数据类型",value:t.dataType,"onUpdate:value":[o[7]||(o[7]=f=>t.dataType=f),T],options:l(Q)(l(rt))},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择数据格式",value:t.dataFormat,"onUpdate:value":o[8]||(o[8]=f=>t.dataFormat=f),options:n.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:a(()=>[e(J,{clearable:"",value:t.tagUnit,"onUpdate:value":o[9]||(o[9]=f=>t.tagUnit=f),maxlength:"12",placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(Te,{show:n.collectionPointForm.visible,"onUpdate:show":o[17]||(o[17]=f=>n.collectionPointForm.visible=f),title:"选择采集点",preset:"card",class:"w-65%",onAfterLeave:d},{footer:a(()=>[e(we,{size:16,justify:"end"},{default:a(()=>[e(ie,{onClick:_e},{default:a(()=>[w(j(l(N)("common.cancel")),1)]),_:1}),e(ie,{type:"primary",onClick:i},{default:a(()=>[w(j(l(N)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(p,{model:n.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(ue,{responsive:"screen","item-responsive":""},{default:a(()=>[e(u,{span:"24 m:12",label:"所属通道"},{default:a(()=>[e(c,{filterable:"",placeholder:"请选择所属通道",value:l(m).chlid,"onUpdate:value":o[11]||(o[11]=f=>l(m).chlid=f),options:n.collectionPointForm.channelList,onUpdateValue:re},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"所属设备"},{default:a(()=>[e(c,{filterable:"",clearable:"",placeholder:"请选择所属设备","label-field":"devName","value-field":"id",value:l(m).devId,"onUpdate:value":[o[12]||(o[12]=f=>l(m).devId=f),Ke],options:n.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点类型"},{default:a(()=>[e(c,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:l(m).tagType,"onUpdate:value":o[13]||(o[13]=f=>l(m).tagType=f),options:l(Q)(l(me))},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点功能码"},{default:a(()=>[e(c,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:l(m).collectType,"onUpdate:value":o[14]||(o[14]=f=>l(m).collectType=f),options:n.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点名称"},{default:a(()=>[te(e(J,{clearable:"",value:l(m).fuzzy,"onUpdate:value":o[15]||(o[15]=f=>l(m).fuzzy=f),placeholder:"请输入测点名称"},null,8,["value"]),[[ut]])]),_:1}),e(u,{span:"24 m:12",label:" "},{default:a(()=>[e(ie,{onClick:de},{default:a(()=>[w(j(l(N)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),Ce("div",Ot,[e(et,{"checked-row-keys":l(L),"onUpdate:checkedRowKeys":[o[16]||(o[16]=f=>Fe(L)?L.value=f:null),r],columns:l(H),data:l(W),size:"small","max-height":400,loading:l(F),remote:"","row-key":f=>f.id,pagination:l(ve),class:"flex-1 w-80%","row-props":De,"scroll-x":l(H).reduce((f,pt)=>f+pt.width,0)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination","scroll-x"]),e(et,{columns:ye,data:C.value,size:"small","max-height":440,loading:l(F),remote:"","row-key":f=>f.id,class:"w-20% ml-10px","row-props":De},null,8,["data","loading","row-key"])])]),_:1},8,["show"])],64)}}}),Et=Ae({__name:"batchEdit_model",props:fe({checkedRowKeys:{type:Array,default:[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:fe(["submitted"],["update:visible"]),setup(I,{emit:Y}){const n=I,h=Ve(I,"visible");Be(()=>h.value,A=>{y.value={editType:0,editMode:0,startV:"0",step:"1",tagK:0}});const O=Y,{formRef:R,validate:t,restoreValidation:q}=Oe(),y=xe({editType:0,editMode:0,startV:"0",step:"1",tagK:0}),D=async()=>{var A,T;if(await t(),y.value.editType==0){console.log(n.checkedRowKeys);let z=[];n.checkedRowKeys.forEach((x,X)=>{z.push({id:x,objAddr:+y.value.startV+X*+y.value.step+""})});const{data:$,error:P}=await Me(z);P||(h.value=!1,(A=window.$message)==null||A.success("批量修改成功"),O("submitted"))}else if(y.value.editType==1){let z=[];n.checkedRowKeys.forEach((x,X)=>{z.push({id:x,tagK:y.value.tagK})});const{data:$,error:P}=await Me(z);P||(h.value=!1,(T=window.$message)==null||T.success("批量修改成功"),O("submitted"))}},S={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},Z={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},_={editType:S,editMode:S,startV:Z,step:Z},ae=xe(!1);return(A,T)=>{const z=$e,$=Ye,P=ge,x=Ge,X=Ze,H=Je,se=M,W=Re,K=Xe;return V(),Ne(Ee,null,[e(K,{show:h.value,"onUpdate:show":T[6]||(T[6]=F=>h.value=F),title:"批量修改",preset:"card",class:"w-40%"},{footer:a(()=>[e(W,{size:16,justify:"center"},{default:a(()=>[e(se,{onClick:T[5]||(T[5]=F=>h.value=!1),class:"w-100px"},{default:a(()=>[w(j(A.$t("common.cancel")),1)]),_:1}),e(se,{type:"primary",class:"w-100px",onClick:D},{default:a(()=>[w(j(A.$t("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(H,{ref_key:"formRef",ref:R,"label-width":120,"label-placement":"left",model:y.value,rules:_},{default:a(()=>[e(X,{responsive:"screen","item-responsive":""},{default:a(()=>[e($,{span:"24 m:12",label:"修改类型",path:"editType"},{default:a(()=>[e(z,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editType,"onUpdate:value":T[0]||(T[0]=F=>y.value.editType=F),options:l(Q)(l(tt)({0:"寄存器地址",1:"系数K"}))},null,8,["value","options"])]),_:1}),y.value.editType==0?(V(),le($,{key:0,span:"24 m:12",label:"修改步长",path:"editMode"},{default:a(()=>[e(z,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editMode,"onUpdate:value":T[1]||(T[1]=F=>y.value.editMode=F),options:l(Q)(l(tt)({0:"步长"}))},null,8,["value","options"])]),_:1})):Pe("",!0),y.value.editType==0?(V(),le($,{key:1,span:"24 m:12",label:"起始值",path:"startV"},{default:a(()=>[e(P,{clearable:"",value:y.value.startV,"onUpdate:value":T[2]||(T[2]=F=>y.value.startV=F),placeholder:"请输入起始值"},null,8,["value"])]),_:1})):Pe("",!0),y.value.editType==0?(V(),le($,{key:2,span:"24 m:12",label:"步长",path:"step"},{default:a(()=>[e(P,{clearable:"",value:y.value.step,"onUpdate:value":T[3]||(T[3]=F=>y.value.step=F),placeholder:"请输入步长"},null,8,["value"])]),_:1})):Pe("",!0),y.value.editType==1?(V(),le($,{key:3,span:"24 m:12",label:"修改的值",path:"step"},{default:a(()=>[e(x,{clearable:"",value:y.value.tagK,"onUpdate:value":T[4]||(T[4]=F=>y.value.tagK=F),placeholder:"请输入修改的值"},null,8,["value"])]),_:1})):Pe("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(K,{show:ae.value,"onUpdate:show":T[7]||(T[7]=F=>ae.value=F),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),qt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function it(I){return typeof I=="function"||Object.prototype.toString.call(I)==="[object Object]"&&!kt(I)}const ol=Ae({name:"configsetting_forwardingservice_forwardingpointmanagement",__name:"index",setup(I){const Y=_t(),n=yt(),h=Ie({channelList:[],channelAndDevObj:{},deveicelList:[],transFunctionOptions:[],addMultipeModelVisible:!1});async function O(){var k;const{data:v,error:g}=await Ue({type:1});if(!g){if(v==0)return(k=window.$message)==null?void 0:k.warning("暂无转发通道，请先添加通道");h.channelList=v||[],h.channelList.forEach(L=>{h.channelAndDevObj[L.id]=L.devicePojoList||[]}),_.chlid=_.chlid||h.channelList[0].id,h.deveicelList=h.channelAndDevObj[_.chlid]||[];const B=n.currentRoute.value.query.deviceId;_.devId=Number(B)*1||h.deveicelList[0].id,R(),D()}}async function R(){const{data:v,error:g}=await Le({chlId:_.chlid});g||(h.transFunctionOptions=JSON.parse(v).data)}const{columns:t,columnChecks:q,data:y,getData:D,loading:S,mobilePagination:Z,searchParams:_,resetSearchParams:ae}=We({apiFn:At,apiParams:{page:1,pageSize:200,limit:200,chlid:null,devId:null,tagType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"测点ID",align:"center",width:80},{key:"tagName",title:"测点名称",align:"center",minWidth:100},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",minWidth:140},{key:"tagType",title:"测点类型",align:"center",width:140,render:v=>e("span",null,[xt[v.tagType]||""])},{key:"devName",title:"所属设备",align:"center",width:140,render:v=>{var g,k;return e("span",null,[((k=(g=h.deveicelList)==null?void 0:g.find(B=>B.id===v.devId))==null?void 0:k.devName)||""])}},{key:"collectname",title:"转发功能码",align:"center",width:140,render:v=>{var g;return e("span",null,[(g=v.collectname)==null?void 0:g.replace(/\(.*?\)/g,"")])}},{key:"dataType",title:"数据类型",align:"center",width:140,render:v=>e("span",null,[v.dataType?lt[Number(v.dataType)]:lt[0]])},{key:"dataFormat",title:"数据格式",align:"center",width:140,render:v=>e("span",null,[v.dataType?at[Number(v.dataFormat)]:at[0]])},{key:"tagK",title:"系数K",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140},{key:"operate",title:N("common.operate"),align:"center",width:140,fixed:"right",render:v=>{let g;return e("div",{class:"flex-center gap-8px"},[te(e(M,{type:"primary",ghost:!0,size:"small",onClick:()=>W(v.id)},it(g=N("common.edit"))?g:{default:()=>[g]}),[[ke("no-auth"),"transTag:update"]]),te(e(nt,{onPositiveClick:()=>se(v.id)},{default:()=>N("common.confirmDelete"),trigger:()=>{let k;return e(M,{type:"error",ghost:!0,size:"small"},it(k=N("common.delete"))?k:{default:()=>[k]})}}),[[ke("no-auth"),"transTag:delete"]])])}}]});wt(()=>{const v=n.currentRoute.value.query.channelId;_.chlid=Number(v)*1||null,O()});const{drawerVisible:A,operateType:T,editingData:z,handleAdd:$,handleEdit:P,checkedRowKeys:x,onBatchDeleted:X,onDeleted:H}=Qe(y,D),se=async v=>{const{data:g,error:k}=await ot({ids:v});k||H()},W=v=>{P(v)},K=v=>{v===""&&D()},F=xe(!1),ve=()=>{F.value=!0};function m(v,g){var k;v&&(_.chlid=Number(v),_.devId=null,_.collectType=void 0,h.deveicelList=h.channelAndDevObj[v],_.devId=h.deveicelList[0].id,(!h.deveicelList||h.deveicelList.length==0)&&((k=window.$message)==null||k.warning("该通道下无设备! 请选择其他通道")),R(),D())}function Se(){h.addMultipeModelVisible=!0}const de=async()=>{const v=x.value.join(","),{data:g,error:k}=await ot({ids:v});k||H(),x.value=[]},ze=()=>{var B;if(!_.devId){(B=window.$message)==null||B.warning("请选择导出设备");return}const v=Ft(),g=Date.now().toString(),k=It(`${v}${g}${"devId="+_.devId}`);Lt({url:`${Nt}/transTag/exports.do`,method:"post",params:{devId:_.devId},responseType:"blob",headers:{token:Dt(),"X-Nonce":v,"X-Timestamp":g,"X-Signature":k}}).then(async L=>{if(L.data){const he=window.URL.createObjectURL(new Blob([L.data])),ee=document.createElement("a");ee.href=he,ee.setAttribute("download",new Date().getTime()+".xls"),document.body.appendChild(ee),ee.click()}})};return(v,g)=>{const k=jt,B=$e,L=ge,he=Ut,ee=qe,ne=Re,re=Pt,be=Ct,oe=Kt,_e=vt,C=gt,ye=ft,r=mt,i=He,b=ke("no-auth");return V(),Ne("div",qt,[e(re,{bordered:!1,size:"small"},{default:a(()=>[e(ne,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:a(()=>[e(ee,null,{default:a(()=>[e(k,null,{default:a(()=>[w("所属通道")]),_:1}),e(B,{filterable:"",placeholder:"请选择通道",value:l(_).chlid,"onUpdate:value":g[0]||(g[0]=d=>l(_).chlid=d),"label-field":"chlName","value-field":"id",options:h.channelList,onUpdateValue:m},null,8,["value","options"]),e(k,null,{default:a(()=>[w("所属设备")]),_:1}),e(B,{filterable:"",clearable:"",placeholder:"请选择设备",value:l(_).devId,"onUpdate:value":[g[1]||(g[1]=d=>l(_).devId=d),l(D)],"label-field":"devName","value-field":"id",options:h.deveicelList},null,8,["value","options","onUpdate:value"]),e(k,null,{default:a(()=>[w("测点类型")]),_:1}),e(B,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:l(_).tagType,"onUpdate:value":[g[2]||(g[2]=d=>l(_).tagType=d),l(D)],style:{width:"80%"},options:l(Q)(l(me))},null,8,["value","options","onUpdate:value"]),e(L,{clearable:"",value:l(_).fuzzy,"onUpdate:value":[g[3]||(g[3]=d=>l(_).fuzzy=d),K],placeholder:"请输入测点名称或描述",style:{width:"100%"},onKeyup:Tt(l(D),["enter"])},null,8,["value","onKeyup"]),e(l(M),{type:"primary",ghost:"",onClick:l(D)},{icon:a(()=>[e(he,{class:pe(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),default:a(()=>[w(" "+j(l(N)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(re,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[e(ne,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"})]),"header-extra":a(()=>[e(ne,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[te((V(),le(l(M),{onClick:Se,size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(be,{class:pe(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),default:a(()=>[w(" "+j("批量新增"))]),_:1})),[[b,"transTag:insert"]]),te((V(),le(l(M),{onClick:ve,size:"small",ghost:"",type:"primary",disabled:!l(x).length},{icon:a(()=>[e(oe,{class:pe(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),default:a(()=>[w(" "+j("批量修改"))]),_:1},8,["disabled"])),[[b,"transTag:update"]]),te((V(),le(l(nt),{onPositiveClick:de},{trigger:a(()=>[e(l(M),{size:"small",ghost:"",type:"error",disabled:l(x).length==0},{icon:a(()=>[e(_e,{class:pe(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),default:a(()=>[w(" "+j(l(N)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:a(()=>[w(" 确认删除选中的项吗？ ")]),_:1})),[[b,"transTag:delete"]]),te((V(),le(l(M),{onClick:ze,size:"small"},{icon:a(()=>[e(C,{class:pe(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),default:a(()=>[w(" "+j(l(N)("common.export")),1)]),_:1})),[[b,"transTag:export"]]),e(l(M),{onClick:l(D),size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(ye,{class:pe(["text-icon",{"animate-spin":l(S)}])},null,8,["class"])]),_:1},8,["onClick"]),e(r,{columns:l(q),"onUpdate:columns":g[4]||(g[4]=d=>Fe(q)?q.value=d:null)},null,8,["columns"])]),_:1})]),default:a(()=>[e(i,{"checked-row-keys":l(x),"onUpdate:checkedRowKeys":g[5]||(g[5]=d=>Fe(x)?x.value=d:null),columns:l(t),data:l(y),size:"small",class:"sm:h-full","flex-height":!l(Y).isMobile,loading:l(S),remote:"","row-key":d=>d.id,pagination:l(Z)},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Mt,{visible:l(A),"onUpdate:visible":g[6]||(g[6]=d=>Fe(A)?A.value=d:null),onSubmitted:l(D),"operate-type":l(T),"row-data":l(z)},null,8,["visible","onSubmitted","operate-type","row-data"]),e(Bt,{visible:h.addMultipeModelVisible,"onUpdate:visible":g[7]||(g[7]=d=>h.addMultipeModelVisible=d),devId:l(_).devId,chlid:l(_).chlid,onSubmitted:l(D)},null,8,["visible","devId","chlid","onSubmitted"]),e(Et,{visible:F.value,"onUpdate:visible":g[8]||(g[8]=d=>F.value=d),onSubmitted:l(D),checkedRowKeys:l(x)},null,8,["visible","onSubmitted","checkedRowKeys"])]),_:1})])}}});export{ol as default};
