import{_ as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BHdjnJGE.js";import{d as Y,q as E,s as X,v as Z,x as me,b as fe,r as _e,y as ge,L as j,o as J,c as ee,w as n,g as e,h as B,t as F,i as o,$ as f,N as te,M as I,A as ae,C as he,Y as oe,D as ne,B as O,E as le,ab as ye,ac as ve,K as be,aa as se,a0 as we,as as Se,an as xe,j as Q,e as De,ad as V,ae as Ce,S as ke,F as Ne,aw as Te}from"./index-hw7QOW1T.js";import{u as Me,a as ze}from"./table-BKuYvkWU.js";import{q as re,r as ce,s as Re,t as Ue,u as Le,v as Pe}from"./Collection-Dc1E4hVt.js";import{u as q}from"./usePageData-VFJfU8Fa.js";import{_ as Ae}from"./round-search-Wdn6cQPo.js";import{_ as $e}from"./round-refresh-CTnCderg.js";import{_ as Be}from"./FormItemGridItem-BJtyHf3C.js";import{_ as Fe}from"./Grid-Cw6tbggG.js";import{h as W}from"./permission-BgxCDMSi.js";import{_ as He}from"./Popconfirm-BEEFAPPE.js";import{_ as Ve}from"./DataTable-qeqEjtEf.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Db4-USgA.js";import"./setting-outlined-6-9KjY3w.js";import"./round-delete-BKIC0WVe.js";import"./refresh-wIPyYUe8.js";import"./round-plus-DF4zpV2C.js";import"./Upload-BGvaNzBI.js";import"./Progress-76kDcVby.js";import"./Forward-iJK0D6Xc.js";const je=Y({name:"OperateDrawer",__name:"operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(_,{emit:M}){const d=_,y=M,g=X(_,"visible"),{formRef:r,validate:D,restoreValidation:z}=Z(),{createConfirmPwdRule:C,defaultRequiredRule:R,patternRules:S}=me(),x=fe(()=>({add:"新增日志源设备",edit:"编辑日志源设备"})[d.operateType]),i=_e(k());function k(){return{id:void 0,manu:null,category:null,type:"",sysparam:void 0,ldesc:""}}const U={type:R,category:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源类别"},manu:{type:"number",required:!0,trigger:["blur","change"],message:"请选择厂商"}},{pageData:p,getData:L,nextPage:P}=q(re),H=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&p.data.length<p.total&&P()},{pageData:u,getData:c,nextPage:A}=q(ce),v=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&u.data.length<u.total&&A()};function N(){L(),c(),Object.assign(i,k()),d.operateType==="edit"&&d.rowData&&Object.assign(i,d.rowData)}function b(){g.value=!1}async function l(){var a,t;if(await D(),d.operateType==="add"){const{data:w,error:m}=await Re([i]);m||((a=window.$message)==null||a.success(f("common.addSuccess")),b(),y("submitted"))}else{const{data:w,error:m}=await Ue([i]);m||((t=window.$message)==null||t.success(f("common.updateSuccess")),b(),y("submitted"))}}return ge(g,()=>{g.value&&(N(),z())}),(a,t)=>{const w=ae,m=he,T=oe,$=ne,s=O,K=le,ie=ye,ue=ve,de=j("no-space");return J(),ee(ue,{show:g.value,"onUpdate:show":t[4]||(t[4]=h=>g.value=h),"display-directive":"show",width:360},{default:n(()=>[e(ie,{title:x.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(K,{size:16},{default:n(()=>[e(s,{onClick:b},{default:n(()=>[B(F(o(f)("common.cancel")),1)]),_:1}),e(s,{type:"primary",onClick:l},{default:n(()=>[B(F(o(f)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e($,{ref_key:"formRef",ref:r,model:i,rules:U,onKeyup:te(l,["entep"])},{default:n(()=>[e(m,{label:"日志源类型",path:"type"},{default:n(()=>[I(e(w,{clearable:"",value:i.type,"onUpdate:value":t[0]||(t[0]=h=>i.type=h),placeholder:"请输入日志源类型"},null,8,["value"]),[[de]])]),_:1}),e(m,{label:"日志源类别",path:"category"},{default:n(()=>[e(T,{clearable:"",filterable:"",value:i.category,"onUpdate:value":t[1]||(t[1]=h=>i.category=h),placeholder:"请选择日志源类别",options:o(p).data,"reset-menu-on-options-change":!1,onScroll:H,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"厂商",path:"manu"},{default:n(()=>[e(T,{clearable:"",filterable:"",value:i.manu,"onUpdate:value":t[2]||(t[2]=h=>i.manu=h),placeholder:"请选择厂商",options:o(u).data,"value-field":"id","label-field":"mname",onScroll:v,"reset-menu-on-options-change":!1,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"描述",path:"ldesc"},{default:n(()=>[e(w,{type:"textarea",value:i.ldesc,"onUpdate:value":t[3]||(t[3]=h=>i.ldesc=h),placeholder:"请输入备注",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ie=Y({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(_,{emit:M}){const d=M,{formRef:y,restoreValidation:g}=Z(),r=X(_,"model");function D(u){r.value.category=u,d("search")}function z(u){r.value.manu=u,d("search")}function C(){r.value.fuzzy="",d("search")}async function R(){r.value.fuzzy=null,r.value.category=null,r.value.manu=null,d("search")}async function S(){d("search")}const{pageData:x,getData:i,nextPage:k}=q(re),U=async u=>{const c=u.currentTarget;c.scrollTop+c.offsetHeight>=c.scrollHeight&&x.data.length<x.total&&k()},{pageData:p,getData:L,nextPage:P}=q(ce),H=async u=>{const c=u.currentTarget;c.scrollTop+c.offsetHeight>=c.scrollHeight&&p.data.length<p.total&&P()};return be(()=>{i(),L()}),(u,c)=>{const A=ae,v=Be,N=oe,b=$e,l=O,a=Ae,t=le,w=Fe,m=ne,T=se,$=j("no-space");return J(),ee(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(m,{ref_key:"formRef",ref:y,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(S,["enter"])},{default:n(()=>[e(w,{responsive:"screen","item-responsive":""},{default:n(()=>[e(v,{span:"24 s:12 m:6",label:"日志源类型",path:"fuzzy",class:"pr-24px"},{default:n(()=>[I(e(A,{clearable:"",value:r.value.fuzzy,"onUpdate:value":c[0]||(c[0]=s=>r.value.fuzzy=s),placeholder:"请输入日志源类型关键字",onClear:C},null,8,["value"]),[[$]])]),_:1}),e(v,{span:"24 s:12 m:6",label:"厂商",path:"manu",class:"pr-24px"},{default:n(()=>[e(N,{clearable:"",filterable:"",value:r.value.manu,"onUpdate:value":c[1]||(c[1]=s=>r.value.manu=s),placeholder:"请选择厂商",options:o(p).data,"value-field":"id","label-field":"mname",onScroll:H,onUpdateValue:z,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"日志源类别",path:"category",class:"pr-24px"},{default:n(()=>[e(N,{clearable:"",filterable:"",value:r.value.category,"onUpdate:value":c[2]||(c[2]=s=>r.value.category=s),placeholder:"请选择日志源类别",options:o(x).data,onScroll:U,onUpdateValue:D,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(v,{span:"24  s:12 m:6",class:"pr-24px"},{default:n(()=>[e(t,{class:"w-full"},{default:n(()=>[e(l,{onClick:R},{icon:n(()=>[e(b,{class:"text-icon"})]),default:n(()=>[B(" "+F(o(f)("common.reset")),1)]),_:1}),e(l,{type:"primary",ghost:"",onClick:S},{icon:n(()=>[e(a,{class:"text-icon"})]),default:n(()=>[B(" "+F(o(f)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function G(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!Ce(_)}const qe=Y({name:"collectionmanagement_logsource",__name:"index",setup(_){const M=we(),{columns:d,columnChecks:y,data:g,getData:r,loading:D,mobilePagination:z,searchParams:C,resetSearchParams:R}=Me({apiFn:Le,apiParams:{page:1,pageSize:20,limit:20,fuzzy:void 0,category:void 0,manu:void 0,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48,disabled(l){return l.sysparam!==1}},{key:"mname",title:"厂商",align:"center",width:240},{key:"cname",title:"日志源类别",align:"center",width:240},{key:"type",title:"日志源类型",align:"center",width:240},{key:"ldesc",title:"描述",align:"center",width:500,render:l=>e("span",{class:"text-ellipsis",onClick:()=>{u.value=l.ldesc,c.value=!0},style:{display:"block",width:"100%"}},[l.ldesc])},{key:"sysparam",title:"系统内置",align:"center",width:120,render:l=>{const a={0:"success",1:"info"},t=f(Se[l.sysparam]);return e(xe,{size:"small",type:a[l.sysparam]},G(t)?t:{default:()=>[t]})}},{key:"operate",title:f("common.operate"),align:"center",width:130,render:l=>{let a;return l.sysparam==1&&e("div",{class:"flex-center gap-8px"},[I(e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>N(l.id)},G(a=f("common.edit"))?a:{default:()=>[a]}),[[j("no-auth"),"sys.log.source.device.update"]]),e(He,{onPositiveClick:()=>v(l.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let t;return I(e(O,{type:"error",ghost:!0,size:"small"},G(t=f("common.delete"))?t:{default:()=>[t]}),[[j("no-auth"),"sys.log.source.device.delete"]])}})])}}]}),{drawerVisible:S,operateType:x,editingData:i,handleAdd:k,handleEdit:U,checkedRowKeys:p,onBatchDeleted:L,onDeleted:P,closeDrawer:H}=ze(g,r),u=Q(""),c=Q(!1);async function A(){console.log(p.value),b(p.value.join(","),l=>{L()})}function v(l){console.log(l),b(l,a=>{P()})}function N(l){U(l)}async function b(l,a){const t=await Pe(l);a&&a(t)}return(l,a)=>{const t=pe,w=Ve,m=ke,T=Ne,$=se;return J(),De("div",Oe,[e(Ie,{model:o(C),"onUpdate:model":a[0]||(a[0]=s=>V(C)?C.value=s:null),onReset:o(R),onSearch:o(r)},null,8,["model","onReset","onSearch"]),e($,{title:"日志源设备",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":n(()=>[e(t,{columns:o(y),"onUpdate:columns":a[1]||(a[1]=s=>V(y)?y.value=s:null),"disabled-delete":o(p).length===0,"is-view-add-button":o(W)("sys.log.source.device.insert"),"is-view-delete-button":o(W)("sys.log.source.device.delete"),loading:o(D),onAdd:o(k),onDelete:A,onRefresh:o(r)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:n(()=>[e(w,{"checked-row-keys":o(p),"onUpdate:checkedRowKeys":a[2]||(a[2]=s=>V(p)?p.value=s:null),columns:o(d),data:o(g),size:"small","flex-height":!o(M).isMobile,"scroll-x":o(d).reduce((s,K)=>s+K.width,0),loading:o(D),remote:"","row-key":s=>s.id,pagination:o(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(je,{visible:o(S),"onUpdate:visible":a[3]||(a[3]=s=>V(S)?S.value=s:null),"operate-type":o(x),"row-data":o(i),onSubmitted:o(r)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(T,{show:c.value,"onUpdate:show":a[4]||(a[4]=s=>c.value=s),title:"描述",preset:"card",class:"w-600px"},{default:n(()=>[e(m,{style:{"max-height":"300px"}},{default:n(()=>[B(F(u.value),1)]),_:1})]),_:1},8,["show"])]),_:1})])}}}),dt=Te(qe,[["__scopeId","data-v-dd0c97f3"]]);export{dt as default};
