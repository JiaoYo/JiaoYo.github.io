import{_ as Se}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CDCEHG5B.js";import{d as ne,n as te,s as ue,p as pe,q as me,b as xe,r as le,j as G,ax as ie,D as Q,o as oe,c as fe,w as a,g as e,h as k,t as I,i as l,$ as w,E,W as V,F as _e,ap as ve,aj as Ue,J as se,Z as ge,af as Re,as as Te,N as K,at as ze,O as re,B,al as be,ad as he,a3 as Pe,ae as Ae,e as $e,aC as Z,aG as qe,a1 as Fe,au as je,K as Oe,S as Me}from"./index-FKKSWlZs.js";import{u as Ve,a as Be}from"./table-CSyR0TzJ.js";import{b as Ge,e as Ie,g as ye,h as Ee,i as Ke,j as Le,k as He}from"./Collection-XH-szaJG.js";import{C as we,N as We,D as Je,b as Ze,c as Qe}from"./collection-CsKz3kSl.js";import{u as Xe}from"./usePageData-3o8T-Seq.js";import{a as ke,_ as Ye,b as ea}from"./lodash-YkbCJgJ0.js";import{_ as Ce}from"./Grid-DmN9YdMU.js";import{_ as aa}from"./round-refresh-BFeEk6QU.js";import{_ as ta}from"./DatePicker-DAj2bCmA.js";import{h as de}from"./permission-CIZuorC2.js";import{N as la}from"./Popconfirm-DxRR0mKc.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-BETkHMFo.js";import"./export-DQRIj4KV.js";import"./refresh-49c21s-F.js";import"./round-plus-B53Iz6E2.js";import"./Upload-Dw_AZ3VX.js";import"./Progress-BOvJ-dqS.js";import"./TimePicker-DNg11j_w.js";import"./defineProperty-D0K2S1pz.js";const na=ne({name:"CollectorModal",__name:"collector_modal",props:te({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:te(["submitted"],["update:visible"]),setup(C,{emit:L}){const _=C,z=L,N=ue(C,"visible"),{formRef:P,validate:d,restoreValidation:S}=pe(),{createConfirmPwdRule:U,defaultRequiredRule:A,patternRules:H}=me(),b=xe(()=>({add:"新增采集器",edit:"编辑采集器"})[_.operateType]),n=le(R());function R(){return{id:void 0,cname:"",accmed:1,caddr:"",filterpro:void 0,cdesc:"",enable:0,ctime:void 0,port:void 0,network:void 0,dtype:void 0,dver:void 0,dataide:void 0}}const $={cname:A,caddr:[{required:!0,message:"请输入采集器地址",trigger:["blur","input"]},{required:!0,validator:ve,trigger:["blur","input"]}],port:{required:!0,trigger:["blur","input"],validator:(u,t,c)=>t?Ue(t)?!0:new Error("请输入在0-65535之间的数字"):new Error("请输入端口号")},accmed:{type:"number",required:!0,trigger:["blur","change"],message:"请选择接入方式"},network:{type:"number",required:!0,trigger:["blur","change"],message:"请选择网口"},filterpro:{type:"number",required:!0,trigger:["blur","change"],message:"请选择过滤策略"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择数据库类型"},dver:{type:"number",required:!0,trigger:["blur","change"],message:"请选择数据库版本"},dataide:{type:"number",required:!0,trigger:["blur","change"],message:"请选择数据库标识"}},{pageData:h,getData:v,nextPage:m}=Xe(Ge),q=async u=>{const t=u.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&h.data.length<h.total&&m()},D=G(),y=async()=>{const{data:u,error:t}=await Ee();D.value=u.map(c=>({...c,id:"-"+c.id,type:c.cname}))};function O(){y(),v(),Object.assign(n,R()),_.operateType==="edit"&&_.rowData&&(console.log("props.rowData",_.rowData),Object.assign(n,_.rowData),F.clickNums=1)}function T(){N.value=!1}const F=le({clickNums:0,isLoading:!1});async function j(){var u,t;if(await d(),_.operateType==="add"){const{data:c,error:s}=await Ie([{...n}]);s||((u=window.$message)==null||u.success("采集器添加成功"),T(),z("submitted"))}else{const{data:c,error:s}=await ye([{...n}]);s||((t=window.$message)==null||t.success(w("common.updateSuccess")),T(),z("submitted"))}}const M=u=>{Object.assign(n,{logsoudev:void 0,rev:void 0,port:void 0,uname:void 0,pswd:void 0})};return ie(N,()=>{N.value&&(O(),S())}),ie(()=>n.caddr,()=>{F.clickNums=0}),(u,t)=>{const c=se,s=ke,p=ge,X=Re,W=Te,r=K,o=ze,g=Ce,x=re,J=B,Y=K,ee=be,ae=Q("no-space");return oe(),fe(ee,{show:N.value,"onUpdate:show":t[11]||(t[11]=i=>N.value=i),title:b.value,preset:"card",class:"w-850px"},{footer:a(()=>[e(Y,{size:16,justify:"end"},{default:a(()=>[e(J,{onClick:T},{default:a(()=>[k(I(l(w)("common.cancel")),1)]),_:1}),e(J,{type:"primary",onClick:j},{default:a(()=>[k(I(l(w)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(x,{ref_key:"formRef",ref:P,model:n,rules:$,"label-placement":"left","label-width":120,onKeyup:_e(j,["enter"])},{default:a(()=>[e(g,{responsive:"screen","item-responsive":"","x-gap":20},{default:a(()=>[e(s,{span:"24 s:12 m:12",label:"采集器名称",path:"cname"},{default:a(()=>[E(e(c,{value:n.cname,"onUpdate:value":t[0]||(t[0]=i=>n.cname=i),placeholder:"请输入采集器名称",clearable:""},null,8,["value"]),[[ae]])]),_:1}),e(s,{span:"24 s:12 m:12",label:"接入方式",path:"accmed"},{default:a(()=>[e(p,{value:n.accmed,"onUpdate:value":[t[1]||(t[1]=i=>n.accmed=i),M],placeholder:"请选择接入方式",filterable:"",clearable:"",disabled:u.operateType==="edit",options:l(V)(l(we))},null,8,["value","disabled","options"])]),_:1}),e(s,{span:"24 s:12 m:12",label:"采集地址",path:"caddr"},{default:a(()=>[e(c,{value:n.caddr,"onUpdate:value":t[2]||(t[2]=i=>n.caddr=i),placeholder:"请输入采集地址",clearable:""},null,8,["value"])]),_:1}),e(s,{span:"24 s:12 m:12",label:"过滤策略",path:"filterpro"},{default:a(()=>[e(p,{clearable:"",filterable:"",value:n.filterpro,"onUpdate:value":t[3]||(t[3]=i=>n.filterpro=i),placeholder:"请选择过滤策略",options:l(h).data,"value-field":"id","label-field":"pname","reset-menu-on-options-change":!1,onScroll:q},null,8,["value","options"])]),_:1}),e(s,{span:"24 s:12 m:12",label:"端口",path:"port"},{default:a(()=>[e(X,{value:n.port,"onUpdate:value":t[4]||(t[4]=i=>n.port=i),placeholder:"请输入端口",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),e(s,{span:"24 s:12 m:12",label:"网口",path:n.accmed==0?"network":""},{default:a(()=>[e(p,{value:n.network,"onUpdate:value":t[5]||(t[5]=i=>n.network=i),placeholder:"请选择网口",filterable:"",clearable:"",disabled:u.operateType==="edit",options:l(V)(l(We))},null,8,["value","disabled","options"])]),_:1},8,["path"]),e(s,{span:"24 s:12 m:12",label:"数据库类型",path:"dtype"},{default:a(()=>[e(p,{value:n.dtype,"onUpdate:value":t[6]||(t[6]=i=>n.dtype=i),placeholder:"请选择数据库类型",filterable:"",clearable:"",disabled:u.operateType==="edit",options:l(V)(l(Je))},null,8,["value","disabled","options"])]),_:1}),e(s,{span:"24 s:12 m:12",label:"数据库版本 ",path:"dver"},{default:a(()=>[e(c,{value:n.dver,"onUpdate:value":t[7]||(t[7]=i=>n.dver=i),placeholder:"请输入数据库版本",clearable:""},null,8,["value"])]),_:1}),e(s,{span:"24 s:12 m:12",label:"数据库标识 ",path:"dataide"},{default:a(()=>[e(c,{value:n.dataide,"onUpdate:value":t[8]||(t[8]=i=>n.dataide=i),placeholder:"请输入数据库标识",clearable:""},null,8,["value"])]),_:1}),e(s,{span:"24 s:12 m:12",label:"是否启用",path:"enable"},{default:a(()=>[e(o,{value:n.enable,"onUpdate:value":t[9]||(t[9]=i=>n.enable=i),name:"radiogroup",disabled:u.operateType=="edit"},{default:a(()=>[e(r,null,{default:a(()=>[e(W,{value:0},{default:a(()=>[k("是")]),_:1}),e(W,{value:1},{default:a(()=>[k("否")]),_:1})]),_:1})]),_:1},8,["value","disabled"])]),_:1}),e(s,{span:"24 s:24 m:24",label:"描述",path:"cdesc"},{default:a(()=>[e(c,{type:"textarea",value:n.cdesc,"onUpdate:value":t[10]||(t[10]=i=>n.cdesc=i),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),oa=ne({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:te(["reset","search"],["update:model"]),setup(C,{emit:L}){const _=L,{formRef:z,restoreValidation:N}=pe(),P={caddr:[{validator:ve,trigger:["change","input"]}]},d=ue(C,"model");G(!1);const S=G(null);async function U(v,m){v&&v.length>0?(d.value.startTime=v[0],d.value.endTime=v[1]):(d.value.startTime=void 0,d.value.endTime=void 0),$()}function A(v){d.value.enable=v,_("search")}function H(v){d.value.accmed=v,_("search")}function b(){d.value.fuzzy=void 0,_("search")}function n(){d.value.caddr=void 0,_("search")}async function R(){await N(),S.value=null,_("reset")}async function $(){_("search")}const h=Ye.debounce($,1e3,{leading:!0,trailing:!1});return(v,m)=>{const q=se,D=ke,y=ge,O=ta,T=aa,F=B,j=ea,M=K,u=Ce,t=re,c=he,s=Q("no-space");return oe(),fe(c,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(t,{ref_key:"formRef",ref:z,model:d.value,"label-placement":"left",rules:P,"label-width":"100px",onKeyup:_e(l(h),["enter"]),"show-require-mark":!1},{default:a(()=>[e(u,{responsive:"screen","item-responsive":"","x-gap":12},{default:a(()=>[e(D,{span:"24 s:12 m:8 l:6",label:"采集器名称",path:"fuzzy","show-feedback":!1},{default:a(()=>[E(e(q,{clearable:"",value:d.value.fuzzy,"onUpdate:value":m[0]||(m[0]=p=>d.value.fuzzy=p),placeholder:"请输入采集器名称",onClear:b},null,8,["value"]),[[s]])]),_:1}),e(D,{span:"24 s:12 m:8 l:6",label:"采集地址",path:"caddr"},{default:a(()=>[E(e(q,{clearable:"",value:d.value.caddr,"onUpdate:value":m[1]||(m[1]=p=>d.value.caddr=p),onClear:n,placeholder:"请输入采集地址"},null,8,["value"]),[[s]])]),_:1}),e(D,{span:"24 s:12 m:8 l:6",label:"接入方式",path:"accmed","show-feedback":!1},{default:a(()=>[e(y,{clearable:"",filterable:"",value:d.value.accmed,"onUpdate:value":m[2]||(m[2]=p=>d.value.accmed=p),placeholder:"请选择接入方式",options:l(V)(l(we)),onUpdateValue:H,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(D,{span:"24 s:12 m:8 l:6",label:"状态",path:"enable","show-feedback":!1},{default:a(()=>[e(y,{clearable:"",filterable:"",value:d.value.enable,"onUpdate:value":m[3]||(m[3]=p=>d.value.enable=p),placeholder:"请选择状态",options:l(V)(l(Ze)),onUpdateValue:A,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(D,{span:"24 s:16 m:16 l:8",label:"创建时间",path:"enable","show-feedback":!1},{default:a(()=>[e(O,{value:S.value,"onUpdate:value":m[4]||(m[4]=p=>S.value=p),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":U},null,8,["value"])]),_:1}),e(D,{span:"24 s:8 m:8 l:6","show-feedback":!1},{default:a(()=>[e(M,{class:"w-full",align:"center"},{default:a(()=>[e(F,{onClick:R},{icon:a(()=>[e(T,{class:"text-icon"})]),default:a(()=>[k(" "+I(l(w)("common.reset")),1)]),_:1}),e(F,{type:"primary",ghost:"",onClick:l(h)},{icon:a(()=>[e(j,{class:"text-icon"})]),default:a(()=>[k(" "+I(l(w)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),sa={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function ce(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!qe(C)}const xa=ne({name:"collectionmanagement_collector",__name:"index",setup(C){const{createConfirmPwdRule:L,defaultRequiredRule:_,patternRules:z}=me(),N=Pe(),{columns:P,columnChecks:d,data:S,getData:U,loading:A,mobilePagination:H,searchParams:b,resetSearchParams:n}=Ve({apiFn:Ke,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,caddr:null,enable:null,accmed:null,startTime:null,endTime:null,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"cname",title:"采集器名称",align:"center",width:200},{key:"caddr",title:"采集地址",align:"center",width:200},{key:"accmed",title:"接入方式",align:"center",width:160,render:r=>{const o=Qe;return e("span",null,[k(" "),o[r.accmed]])}},{key:"filterpro",title:"过滤策略",align:"center",width:160},{key:"port",title:"端口",align:"center",width:100},{key:"dtype",title:"数据库类型",align:"center",width:140},{key:"ctime",title:"创建时间",align:"center",width:200},{key:"enable",title:"状态",align:"center",width:160,render:r=>e(K,{justify:"center"},{default:()=>[e(Ae,{value:r.enable,"onUpdate:value":[o=>r.enable=o,()=>$(r)],checkedValue:0,uncheckedValue:1},{checked:()=>e("span",null,[k("启用")]),unchecked:()=>e("span",null,[k("禁用")])})]})},{key:"operate",title:w("common.operate"),align:"center",width:130,fixed:"right",render:r=>{let o;return e("div",{class:"flex-center gap-8px"},[E(e(B,{type:"primary",ghost:!0,size:"small",onClick:()=>u(r.id)},ce(o=w("common.edit"))?o:{default:()=>[o]}),[[Q("no-auth"),"sys.collection.mengement.update"]]),e(la,{onPositiveClick:()=>M(r.id)},{default:()=>w("common.confirmDelete"),trigger:()=>{let g;return E(e(B,{type:"error",ghost:!0,size:"small"},ce(g=w("common.delete"))?g:{default:()=>[g]}),[[Q("no-auth"),"sys.collection.mengement.delete"]])}})])}}]}),R=()=>{b.caddr=b.caddr==""?void 0:b.caddr,b.fuzzy=b.fuzzy==""?void 0:b.fuzzy,U()},$=async r=>{var o;try{const{data:g,error:x}=await ye([r]);x||((o=window.$message)==null||o.success(r.enable==1?"禁用成功":"启用成功"),U())}catch{r.enable=r.enable==1?0:1}},{drawerVisible:h,operateType:v,editingData:m,handleAdd:q,handleEdit:D,checkedRowKeys:y,onBatchDeleted:O,onDeleted:T,closeDrawer:F}=Be(S,U);async function j(){console.log(y.value),t(y.value.join(","),r=>{O()})}function M(r){t(r,o=>{T()})}function u(r){v.value="edit",s.id=r,c.value=!0}async function t(r,o){const g=await Le(r,1);console.log("data",g),o&&o(g)}const c=G(!1),s=le({id:void 0,pwd:""}),p=G(null),X={pwd:[{required:!0,message:"请输入密码",trigger:"blur"},z.passwordL]},W=async()=>{var x;await((x=p.value)==null?void 0:x.validate());const r=Fe(s.pwd),{data:o,error:g}=await He(s.id,r);g||(m.value=o,c.value=!1,h.value=!0,s.pwd="")};return(r,o)=>{const g=Se,x=je,J=he,Y=se,ee=Oe,ae=re,i=Me,Ne=be;return oe(),$e("div",sa,[e(oa,{model:l(b),"onUpdate:model":o[0]||(o[0]=f=>Z(b)?b.value=f:null),onReset:l(n),onSearch:R},null,8,["model","onReset"]),e(J,{title:"采集器管理",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":a(()=>[e(g,{columns:l(d),"onUpdate:columns":o[1]||(o[1]=f=>Z(d)?d.value=f:null),"disabled-delete":l(y).length===0,"is-view-add-button":l(de)("sys.collection.mengement.insert"),"is-view-delete-button":l(de)("sys.collection.mengement.delete"),loading:l(A),onAdd:l(q),onDelete:j,onRefresh:R},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd"])]),default:a(()=>[e(x,{"checked-row-keys":l(y),"onUpdate:checkedRowKeys":o[2]||(o[2]=f=>Z(y)?y.value=f:null),columns:l(P),data:l(S),size:"small","flex-height":!l(N).isMobile,"scroll-x":l(P).reduce((f,De)=>f+De.width,0),loading:l(A),remote:"","row-key":f=>f.id,pagination:l(H),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(na,{visible:l(h),"onUpdate:visible":o[3]||(o[3]=f=>Z(h)?h.value=f:null),"operate-type":l(v),"row-data":l(m),onSubmitted:l(U)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1}),e(Ne,{show:c.value,"onUpdate:show":o[5]||(o[5]=f=>c.value=f),title:"编辑采集器信息",preset:"card",class:"w-420px"},{footer:a(()=>[e(l(K),{justify:"end",size:16},{default:a(()=>[e(l(B),{type:"primary",onClick:W},{default:a(()=>[k(I(l(w)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(i,{class:"max-h-480px pr-20px"},{default:a(()=>[e(ae,{ref_key:"checkformRef",ref:p,model:s,"label-placement":"left",rules:X,"label-width":80,"require-mark-placement":"left"},{default:a(()=>[e(ee,{label:l(w)("page.login.common.password"),path:"pwd"},{default:a(()=>[e(Y,{type:"password","show-password-on":"click",clearable:"",value:s.pwd,"onUpdate:value":o[4]||(o[4]=f=>s.pwd=f),placeholder:"请输入当前登录账号密码"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}});export{xa as default};
