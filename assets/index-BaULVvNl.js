import{_ as Ie}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DblglBez.js";import{d as Y,q as se,v as me,s as oe,K as ae,o as Q,c as q,w as d,g as t,L as W,h as w,t as te,i as c,$ as C,M as Ue,A as ne,B as x,E as G,D as fe,ad as ve,r as ue,j as be,J as ge,f as ie,aM as ee,a2 as U,an as le,Z as he,ar as ye,bx as _e,bj as we,S as re,V as de,x as Pe,b as Le,y as Ne,aA as $e,C as Re,aY as xe,F as Fe,a4 as Ve,aq as ce,av as ze,e as Me,ag as Z,ah as Be}from"./index-7Q9xZuwa.js";import{u as Oe,a as Ge}from"./table-G6_8Abm0.js";import{_ as Qe}from"./round-search-BQOA9W6m.js";import{_ as He}from"./round-refresh-DJiiF7wv.js";import{_ as qe}from"./FormItemGridItem-DYTXkfwP.js";import{_ as Je}from"./Grid-CRtcNhSF.js";import{u as J}from"./usePageData-PYHx9xl8.js";import{a as je,T as Ke}from"./basicconf-C0vqpl2m.js";import{j as We,g as Ye,a as Ze,k as Xe,l as De,h as el,e as ll}from"./events-C20QxbUR.js";import{q as Ee,u as Se}from"./Collection-Dqv_ioR6.js";import{f as ke,a as Ce}from"./common-DPaMBBEl.js";import{_ as K}from"./Popconfirm-BEMrdOuM.js";import{_ as Te}from"./Tree-Dp6lOJnC.js";import{h as pe}from"./permission-BYoerBbx.js";import{_ as al}from"./DataTable-n3fP4Loy.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-D8fMBsYv.js";import"./setting-outlined-V9qGIWHT.js";import"./export-oh2-I3ZA.js";import"./refresh-av0Mcmzj.js";import"./round-delete-BZFRn3Yp.js";import"./round-plus-Cy8c1zzO.js";import"./Upload-CwzIyBrH.js";import"./Progress-DAZ1S5w7.js";import"./Forward-BzUEeUAa.js";const tl=Y({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:se(["reset","search"],["update:model"]),setup(j,{emit:p}){const e=p,{formRef:E,restoreValidation:h}=me(),g=oe(j,"model");function S(){g.value.fuzzy=void 0,e("search")}async function $(){await h(),e("reset")}async function D(){e("search")}return(R,o)=>{const P=ne,L=qe,F=He,k=x,y=Qe,V=G,z=Je,B=fe,T=ve,M=ae("no-space");return Q(),q(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:d(()=>[t(B,{ref_key:"formRef",ref:E,model:g.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ue(D,["enter"])},{default:d(()=>[t(z,{responsive:"screen","item-responsive":""},{default:d(()=>[t(L,{span:"24 s:12 m:6",label:"策略名称",path:"fuzzy",class:"pr-24px"},{default:d(()=>[W(t(P,{clearable:"",value:g.value.fuzzy,"onUpdate:value":o[0]||(o[0]=s=>g.value.fuzzy=s),placeholder:"请输入策略名称",onClear:S},null,8,["value"]),[[M]])]),_:1}),t(L,{span:"24 m:4",class:"pr-24px"},{default:d(()=>[t(V,{class:"w-full"},{default:d(()=>[t(k,{onClick:$},{icon:d(()=>[t(F,{class:"text-icon"})]),default:d(()=>[w(" "+te(c(C)("common.reset")),1)]),_:1}),t(k,{type:"primary",ghost:"",onClick:D},{icon:d(()=>[t(y,{class:"text-icon"})]),default:d(()=>[w(" "+te(c(C)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ol=Y({name:"ConditionTree",__name:"conditionTree",props:{data:{default:[]},dataModifiers:{}},emits:["update:data"],setup(j){const p=oe(j,"data"),e=ue({showValueDom:1,obj:{colume:void 0,option:void 0,value:void 0},options1:[{value:"addr0",label:"发生源IP 数字",type:"long"},{value:"addr1",label:"源IP 数字",type:"long"},{value:"addr2",label:"目的IP 数字 ",type:"long"},{value:"ip0",label:"发生源IP",type:"string"},{value:"ip1",label:"源IP",type:"string"},{value:"ip2",label:"目的IP",type:"string"},{value:"port1",label:"源端口",type:"int"},{value:"port2",label:"目的端口",type:"int"},{value:"mac1",label:"源MAC地址",type:"string"},{value:"mac2",label:"目的MAC",type:"string"},{value:"category",label:"发生源设备类别",type:"int"},{value:"device",label:"发生源设备类型",type:"int"},{value:"kind",label:"事件类别",type:"int"},{value:"type",label:"事件类型",type:"int"},{value:"level",label:"事件等级",type:"int"},{value:"proType",label:"日志来源协议",type:"string"},{value:"protocol",label:"协议",type:"string"},{value:"code",label:"关键字",type:"string"}],options2:[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],options3:[]});function E({option:s}){return t("div",{style:{display:"flex",alignItems:"center"}},[t("div",{class:"flex-center  mr-30px",style:{gap:"8px 20px"}},[s.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>R("||或",s)},{default:()=>[w("||或")]}),s.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>R("&&与",s)},{default:()=>[w("&&与")]}),s.children&&t(K,{onPositiveClick:()=>o(s),showIcon:!1,show:s.isShow,onNegativeClick:()=>s.isShow=!1,onUpdateShow:i=>{e.obj={colume:void 0,option:void 0,value:void 0},e.showValueDom=1}},{default:ee(t(G,null,{default:()=>[t(U,{options:e.options1,value:e.obj.colume,"onUpdate:value":i=>$(i),placeholder:"请选择",style:{width:"180px"}},null),t(U,{options:e.options2,value:e.obj.option,"onUpdate:value":i=>e.obj.option=i,placeholder:"请选择",style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="category"||e.obj.colume=="device")&&t(U,{clearable:!0,options:e.options3,key:e.obj.colume,value:e.obj.value,placeholder:"请选择",labelField:e.obj.colume=="category"?"cname":e.obj.colume=="device"?"type":"",valueField:"id",onScroll:i=>M(i),"onUpdate:value":i=>e.obj.value=i,style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="kind"||e.obj.colume=="type"||e.obj.colume=="level")&&t(U,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,"onUpdate:value":i=>e.obj.value=i,style:{width:"180px"},placeholder:"请选择"},null),e.showValueDom==1&&t(ne,{clearable:!0,value:e.obj.value,"onUpdate:value":i=>e.obj.value=i},null),e.showValueDom==0&&t(le,{clearable:!0,value:e.obj.value,"onUpdate:value":i=>e.obj.value=i},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>s.isShow=!0},{default:()=>[w("配置")]})}),t(x,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>P(s)},{default:()=>[w("删除")]})])])}const h=be(1),g=()=>(h.value++,h.value),S=()=>{const s=i=>{let b=-1/0;const _=l=>{for(const a of l)a.id>b&&(b=a.id),a.children&&_(a.children)};return _(i),b};h.value=s(p.value)};ge(()=>{setTimeout(()=>{p.value.length>0&&S()},500)});const $=async s=>{const i=["addr0","addr1","addr2"],b=["ip0","ip1","ip2","mac1","mac2","port1","port2","proType","protocol","code"];i.includes(s)?e.showValueDom=0:b.includes(s)?e.showValueDom=1:e.showValueDom=2,s=="category"?(await F(),e.options3=L.data):s=="device"?(await V(),e.options3=y.data):s=="kind"?B():s=="type"?T():s=="level"&&(e.options3=he(je)),["ip0","ip1","ip2","mac1","mac2","proType","protocol","code"].includes(s)?e.options2=[{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"},{label:"匹配",value:"MATCH"}]:e.options2=[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],e.obj.option=e.options2[0].value,e.obj.colume=s,e.obj.value=void 0},D=s=>{p.value.length>0||(p.value.push({label:s,id:1,isShow:!1,children:[]}),h.value=1)},R=(s,i)=>{i.children.push({label:s,id:g(),children:[],isShow:!1})},o=s=>{var a,n,u,v,r,N,A;if(!e.obj.colume)return(a=window.$message)==null?void 0:a.warning("选择的信息项不能为空");if(e.obj.value==null)return(n=window.$message)==null?void 0:n.warning("条件值不能为空");const i=["ip0","ip1","ip2"],b=["mac1","mac2"],_=["port1","port2"];if(i.includes(e.obj.colume)&&!ye(e.obj.value))return(u=window.$message)==null?void 0:u.warning("请输入正确的IP地址");if(b.includes(e.obj.colume)&&!_e(e.obj.value))return(v=window.$message)==null?void 0:v.warning("请输入正确的MAC地址");if(_.includes(e.obj.colume)&&!we(e.obj.value))return(r=window.$message)==null?void 0:r.warning("请输入正确的端口号");let l=e.obj.value;if(e.showValueDom==2)if(e.obj.colume=="category"||e.obj.colume=="device"){const m=e.options3.find(I=>I.id==e.obj.value);l=e.obj.colume=="category"?m==null?void 0:m.cname:m==null?void 0:m.type}else{const m=e.options3.find(I=>I.value==e.obj.value);l=m==null?void 0:m.label}s.children.push({colume:e.obj.colume,option:e.obj.option,value:e.obj.value,id:g(),label:`${(N=e.options1.find(m=>m.value==e.obj.colume))==null?void 0:N.label} ${(A=e.options2.find(m=>m.value==e.obj.option))==null?void 0:A.label} ${l} `,flag:!1}),e.obj={colume:void 0,option:void 0,value:void 0},e.showValueDom=1,s.isShow=!1},P=s=>{console.log(s,"row");function i(b,_){return b.reduce((l,a)=>(a.id===_||(a.children&&(a.children=i(a.children,_)),l.push(a)),l),[])}p.value=i(p.value,s.id)},{pageData:L,getData:F,nextPage:k}=J(Ee),{pageData:y,getData:V,nextPage:z}=J(Se),B=async()=>{const{data:s,error:i}=await ke();console.log(s),e.options3=s.map(b=>({label:b.pname,value:b.id}))},T=async()=>{const{data:s,error:i}=await Ce();console.log(s),e.options3=s.map(b=>({label:b.pname,value:b.id}))},M=async s=>{const i=s.currentTarget;i.scrollTop+i.offsetHeight>=i.scrollHeight&&(e.obj.colume=="category"&&k(),e.obj.colume=="device"&&z())};return(s,i)=>{const b=Te,_=re;return Q(),q(_,{class:"h-220px",style:{border:"1px solid #dcdcdc","border-radius":"6px"}},{default:d(()=>[t(c(G),{justify:"end",class:"p-5px"},{default:d(()=>[ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:i[0]||(i[0]=l=>D("||或"))},"||或"),ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:i[1]||(i[1]=l=>D("&&与"))},"&&与")]),_:1}),(Q(),q(b,{"block-line":"",data:p.value,"default-expand-all":"",selectable:!1,"render-suffix":E,key:h.value,"key-field":"id"},null,8,["data"]))]),_:1})}}}),nl=de(ol,[["__scopeId","data-v-8027c5a8"]]),sl=Y({name:"RelationRuleTree",__name:"relationRuleTree",props:{data:{default:[]},dataModifiers:{}},emits:["update:data"],setup(j){const p=oe(j,"data"),e=ue({showValueDom:1,obj:{colume:void 0,option:void 0,value:void 0,duration:60,times:2,columns:[],ishappen:1},options1:[{value:"addr0",label:"发生源IP 数字",type:"long"},{value:"addr1",label:"源IP 数字",type:"long"},{value:"addr2",label:"目的IP 数字 ",type:"long"},{value:"ip0",label:"发生源IP",type:"string"},{value:"ip1",label:"源IP",type:"string"},{value:"ip2",label:"目的IP",type:"string"},{value:"port1",label:"源端口",type:"int"},{value:"port2",label:"目的端口",type:"int"},{value:"mac1",label:"源MAC地址",type:"string"},{value:"mac2",label:"目的MAC",type:"string"},{value:"category",label:"发生源设备类别",type:"int"},{value:"device",label:"发生源设备类型",type:"int"},{value:"kind",label:"事件类别",type:"int"},{value:"type",label:"事件类型",type:"int"},{value:"level",label:"事件等级",type:"int"},{value:"proType",label:"日志来源协议",type:"string"},{value:"protocol",label:"协议",type:"string"},{value:"code",label:"关键字",type:"string"}],options2:[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],options3:[]});function E({option:l}){return t("div",{style:{display:"flex",alignItems:"center"}},[t("span",{style:{minWidth:"50px"}},[l.label]),t("div",{class:"flex-center mx-30px",style:{gap:"8px 20px"}},[l.children&&!l.logic&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>o("||或",l)},{default:()=>[w("||或")]}),l.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>o("&&与",l)},{default:()=>[w("&&与")]}),l.children&&!l.logic&&!l.times&&!l.duration&&t(K,{onPositiveClick:()=>P(l),showIcon:!1,show:l.isShow,onNegativeClick:()=>l.isShow=!1},{default:ee(t(G,null,{default:()=>[t(U,{options:e.options1,value:e.obj.colume,"onUpdate:value":a=>D(a),placeholder:"请选择",style:{width:"180px"}},null),t(U,{options:e.options2,value:e.obj.option,"onUpdate:value":a=>e.obj.option=a,placeholder:"请选择",style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="category"||e.obj.colume=="device")&&t(U,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,labelField:e.obj.colume=="category"?"cname":e.obj.colume=="device"?"type":"",placeholder:"请选择",onScroll:a=>_(a),valueField:"id","onUpdate:value":a=>e.obj.value=a,style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="kind"||e.obj.colume=="type"||e.obj.colume=="level")&&t(U,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,"onUpdate:value":a=>e.obj.value=a,style:{width:"180px"},placeholder:"请选择"},null),e.showValueDom==1&&t(ne,{clearable:!0,value:e.obj.value,"onUpdate:value":a=>e.obj.value=a},null),e.showValueDom==0&&t(le,{clearable:!0,value:e.obj.value,"onUpdate:value":a=>e.obj.value=a},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>l.isShow=!0},{default:()=>[w("配置")]})}),l.children&&l.times&&l.duration&&t(K,{onPositiveClick:()=>L(l),showIcon:!1},{default:ee(t(G,null,{default:()=>[t(le,{style:{width:"140px"},clearable:!0,value:e.obj.duration,"onUpdate:value":a=>e.obj.duration=a},null),t(le,{style:{width:"140px"},clearable:!0,value:e.obj.times,"onUpdate:value":a=>e.obj.times=a},null),t(U,{clearable:!0,options:e.options1,value:e.obj.columns,multiple:!0,"onUpdate:value":a=>e.obj.columns=a,placeholder:"请选择",style:{width:"180px"}},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>{e.obj.columns=l.columns,e.obj.duration=l.duration,e.obj.times=l.times}},{default:()=>[w("配置")]})}),l.children&&l.logic&&t(K,{onPositiveClick:()=>h(l),showIcon:!1},{default:ee(t(G,null,{default:()=>[t(U,{clearable:!0,options:[{label:"发生",value:1},{label:"不发生",value:0}],value:e.obj.ishappen,"onUpdate:value":a=>e.obj.ishappen=a,placeholder:"请选择",style:{width:"180px"}},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>e.obj.ishappen=l.ishappen},{default:()=>[w("配置")]})}),!l.logic&&t(x,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>F(l)},{default:()=>[w("删除")]})]),l.duration&&l.times&&t("span",null,["在"+l.duration+"秒内，发生"+l.times+"次   归并字段："+k(l.columns)])])}const h=l=>{const a=/状态(\d+)/g;let n;const u=[];for(;(n=a.exec(l.label))!==null;)u.push(n[1]);l.ishappen=e.obj.ishappen,l.label=`状态${u[0]}之后${e.obj.ishappen?"发生":"不发生"}状态${u[1]}`},g=be(1),S=()=>g.value+=1,$=()=>{const l=a=>{let n=-1/0;const u=v=>{for(const r of v)r.id>n&&(n=r.id),r.children&&u(r.children)};return u(a),n};g.value=l(p.value)};ge(()=>{setTimeout(()=>{p.value.length>0&&$()},500)});const D=async l=>{const a=["addr0","addr1","addr2"],n=["ip0","ip1","ip2","mac1","mac2","port1","port2","proType","protocol","code"];a.includes(l)?e.showValueDom=0:n.includes(l)?e.showValueDom=1:e.showValueDom=2,l=="category"?(await z(),e.options3=V.data):l=="device"?(await M(),e.options3=T.data):l=="kind"?i():l=="type"?b():l=="level"&&(e.options3=[]),["ip0","ip1","ip2","mac1","mac2","proType","protocol","code"].includes(l)?e.options2=[{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"},{label:"匹配",value:"MATCH"}]:e.options2=[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],e.obj.option=e.options2[0].value,e.obj.colume=l,e.obj.value=void 0},R=()=>{if(p.value.length==0){p.value.push({label:"状态1",id:1,children:[],duration:60,times:2,columns:[]});return}const l=(p.value.length-1)/2+1;p.value.push({label:`状态${l}之后发生状态${l+1}`,id:S(),ishappen:1,logic:"and",children:[]});const a=p.value[p.value.length-1].id;p.value.push({label:`状态${l+1}`,id:S(),subId:a,children:[],duration:60,times:2,columns:[]})},o=(l,a)=>{a.children.push({label:l,id:S(),children:[],isShow:!1})},P=l=>{var r,N,A,m,I,H,O;if(!e.obj.colume)return(r=window.$message)==null?void 0:r.warning("选择的信息项不能为空");if(e.obj.value==null)return(N=window.$message)==null?void 0:N.warning("条件值不能为空");const a=["ip0","ip1","ip2"],n=["mac1","mac2"],u=["port1","port2"];if(a.includes(e.obj.colume)&&!ye(e.obj.value))return(A=window.$message)==null?void 0:A.warning("请输入正确的IP地址");if(n.includes(e.obj.colume)&&!_e(e.obj.value))return(m=window.$message)==null?void 0:m.warning("请输入正确的MAC地址");if(u.includes(e.obj.colume)&&!we(e.obj.value))return(I=window.$message)==null?void 0:I.warning("请输入正确的端口号");let v=e.obj.value;if(e.showValueDom==2){const f=e.options3.find(Ae=>Ae.value==e.obj.value);v=f==null?void 0:f.label}l.children.push({colume:e.obj.colume,option:e.obj.option,value:e.obj.value,id:S(),label:`${(H=e.options1.find(f=>f.value==e.obj.colume))==null?void 0:H.label} ${(O=e.options2.find(f=>f.value==e.obj.option))==null?void 0:O.label} ${v} `,flag:!1}),y(),l.isShow=!1},L=l=>{l.duration=e.obj.duration,l.times=e.obj.times,l.columns=e.obj.columns},F=l=>{function a(n,u){return n.reduce((v,r)=>(u.includes(r.id)||(r.children&&(r.children=a(r.children,u)),v.push(r)),v),[])}l.subId?p.value=a(p.value,[l.id,l.subId]):p.value=a(p.value,[l.id])},k=l=>{let a="";return l.forEach((n,u)=>{var v;a+=`${(v=e.options1.find(r=>r.value==n))==null?void 0:v.label}${u==l.length-1?"":"、"}`}),a},y=()=>{e.obj={colume:void 0,option:void 0,value:void 0,duration:60,times:2,ishappen:1,columns:[]}},{pageData:V,getData:z,nextPage:B}=J(Ee),{pageData:T,getData:M,nextPage:s}=J(Se),i=async()=>{const{data:l,error:a}=await ke();console.log(l),e.options3=l.map(n=>({label:n.pname,value:n.id}))},b=async()=>{const{data:l,error:a}=await Ce();console.log(l),e.options3=l.map(n=>({label:n.pname,value:n.id}))},_=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&(e.obj.colume=="category"&&B(),e.obj.colume=="device"&&s())};return(l,a)=>{const n=Te,u=re;return Q(),q(u,{class:"h-220px",style:{border:"1px solid #dcdcdc","border-radius":"6px"}},{default:d(()=>[t(c(G),{justify:"end",class:"p-5px"},{default:d(()=>[ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:R},"㊉ 新增关联状态")]),_:1}),(Q(),q(n,{"block-line":"",data:p.value,"default-expand-all":"",selectable:!1,"render-label":E,"key-field":"id",key:g.value},null,8,["data"]))]),_:1})}}}),il=de(sl,[["__scopeId","data-v-0bdad4b6"]]),ul=Y({name:"OperateDrawer",__name:"operate-drawer",props:se({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:se(["submitted"],["update:visible"]),setup(j,{emit:p}){const e=j,E=p,h=oe(j,"visible"),{formRef:g,validate:S,restoreValidation:$}=me(),{defaultRequiredRule:D}=Pe(),R=Le(()=>({add:"新增关联策略",edit:"修改关联策略"})[e.operateType]),o=ue(P());function P(){return{aname:"",adesc:"",acond:[],arules:[],eid:null,elevel:null,fid:null,etext:"",syspara:1,dbtime:"",status:1}}const L={aname:D,eid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"}};async function F(){var l;if(await V(),await M(),Object.assign(o,P()),e.operateType==="edit"&&e.rowData){const{data:a,error:n}=await We(e.rowData.id);n||(Object.assign(o,a),o.fid=(l=o.fid)==null?void 0:l.split(","),o.acond=a.acond.replace(/&amp;/g,"&"),o.arules=a.arules.replace(/&amp;/g,"&"),o.acond=JSON.parse(o.acond),o.arules=JSON.parse(o.arules))}}function k(){h.value=!1}const{pageData:y,getData:V,nextPage:z}=J(Ye),B=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&y.data.length<y.total&&z()},{pageData:T,getData:M,nextPage:s}=J(Ze),i=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&T.data.length<T.total&&s()},b=l=>l.ipaddr+":"+l.fport+" ("+(l.ftype==0?"syslog":"SNMP Trap")+")";function _(){var l;console.log(o.acond),console.log(o.arules),(l=g.value)==null||l.validate(async a=>{var n,u,v,r,N;if(a){const A=a[0][0].field,m=(n=g.value)==null?void 0:n.$el.querySelectorAll(".n-form-item");if(!m)return;const I=Array.from(m).find(H=>{var O;return((O=H.__vueParentComponent)==null?void 0:O.props.path)===A});I&&$e(()=>{I.scrollIntoView({behavior:"smooth",block:"center"})})}else if(e.operateType==="add"){const{data:A,error:m}=await Xe([{acond:JSON.stringify(o.acond),adesc:o.adesc,aname:o.aname,arules:JSON.stringify(o.arules),dbtime:o.dbtime,eid:o.eid,elevel:o.elevel,fid:(u=o.fid)==null?void 0:u.join(","),etext:o.etext,syspara:o.syspara,status:o.status}]);m||((v=window.$message)==null||v.success(C("common.addSuccess")),k(),E("submitted"))}else{const{data:A,error:m}=await De([{id:e.rowData.id,acond:JSON.stringify(o.acond),adesc:o.adesc,aname:o.aname,arules:JSON.stringify(o.arules),dbtime:o.dbtime,eid:o.eid,elevel:o.elevel,fid:(r=o.fid)==null?void 0:r.join(","),etext:o.etext,syspara:o.syspara,status:o.status}]);m||((N=window.$message)==null||N.success(C("common.updateSuccess")),k(),E("submitted"))}})}return Ne(h,()=>{h.value&&(F(),$())}),(l,a)=>{const n=ne,u=Re,v=U,r=xe,N=fe,A=re,m=x,I=G,H=Fe,O=ae("no-space");return Q(),q(H,{show:h.value,"onUpdate:show":a[9]||(a[9]=f=>h.value=f),title:R.value,preset:"card",class:"w-800px"},{footer:d(()=>[t(I,{size:16,justify:"center"},{default:d(()=>[t(m,{onClick:k},{default:d(()=>[w(te(c(C)("common.cancel")),1)]),_:1}),t(m,{type:"primary",onClick:_},{default:d(()=>[w(te(c(C)("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[t(A,{class:"max-h-480px pr-20px"},{default:d(()=>[t(N,{ref_key:"formRef",ref:g,model:o,rules:L,"label-placement":"top","label-width":"120"},{default:d(()=>[t(u,{label:"策略名称",path:"aname"},{default:d(()=>[W(t(n,{value:o.aname,"onUpdate:value":a[0]||(a[0]=f=>o.aname=f),clearable:"",placeholder:"请输入策略名称"},null,8,["value"]),[[O]])]),_:1}),t(u,{label:"策略描述",path:"adesc"},{default:d(()=>[W(t(n,{type:"textarea",value:o.adesc,"onUpdate:value":a[1]||(a[1]=f=>o.adesc=f),placeholder:"请输入策略描述",clearable:""},null,8,["value"]),[[O]])]),_:1}),t(u,{label:"条件",path:"acond"},{default:d(()=>[t(nl,{data:o.acond,"onUpdate:data":a[2]||(a[2]=f=>o.acond=f)},null,8,["data"])]),_:1}),t(u,{label:"关联规则",path:"arules"},{default:d(()=>[t(il,{data:o.arules,"onUpdate:data":a[3]||(a[3]=f=>o.arules=f)},null,8,["data"])]),_:1}),t(u,{label:"事件名称",path:"eid"},{default:d(()=>[t(v,{value:o.eid,"onUpdate:value":a[4]||(a[4]=f=>o.eid=f),placeholder:"请选择事件名称",clearable:"",filterable:"","value-field":"id","label-field":"ename",options:c(y).data,"reset-menu-on-options-change":!1,onScroll:B},null,8,["value","options"])]),_:1}),t(u,{label:"事件等级",path:"elevel"},{default:d(()=>[t(v,{filterable:"",value:o.elevel,"onUpdate:value":a[5]||(a[5]=f=>o.elevel=f),placeholder:"请选择事件等级",options:c(he)(c(je)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),t(u,{label:"转发外系统",path:"fid"},{default:d(()=>[t(v,{multiple:"","max-tag-count":1,value:o.fid,"onUpdate:value":a[6]||(a[6]=f=>o.fid=f),placeholder:"请选择转发外系统",clearable:"",filterable:"","render-label":b,"value-field":"id","label-field":"ipaddr",options:c(T).data,"reset-menu-on-options-change":!1,onScroll:i},null,8,["value","options"])]),_:1}),t(u,{label:"事件文本",path:"etext"},{default:d(()=>[t(n,{type:"textarea",value:o.etext,"onUpdate:value":a[7]||(a[7]=f=>o.etext=f),placeholder:"请输入事件文本",clearable:""},null,8,["value"])]),_:1}),t(u,{label:"使用状态",path:"maxagg"},{default:d(()=>[t(r,{value:o.status,"onUpdate:value":a[8]||(a[8]=f=>o.status=f),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),rl=de(ul,[["__scopeId","data-v-55bc42e7"]]),dl={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function X(j){return typeof j=="function"||Object.prototype.toString.call(j)==="[object Object]"&&!Be(j)}const $l=Y({name:"eventalarm_associatedeventspolicy",__name:"index",setup(j){const p=Ve(),{columns:e,columnChecks:E,data:h,getData:g,loading:S,mobilePagination:$,searchParams:D,resetSearchParams:R}=Oe({apiFn:el,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"aname",title:"策略名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"adesc",title:"策略描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",minWidth:120,render:l=>{(l.elevel===void 0||l.elevel===null)&&(l.elevel=1);const a={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},n=C(Ke[l.elevel]);let u={color:a[l.elevel],textColor:"#ffffff",borderColor:a[l.elevel]};return t(ce,{size:"small",color:u},X(n)?n:{default:()=>[n]})}},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"status",title:"使用状态",align:"center",width:160,render:l=>t(xe,{value:l.status,"onUpdate:value":[a=>l.status=a,()=>_(l)],checkedValue:1,uncheckedValue:0},null)},{key:"syspara",title:"系统内置",align:"center",width:240,render:l=>{l.sysparam==null&&(l.sysparam=0);const a={0:"success",1:"info"},n=C(ze[l.sysparam]);return t(ce,{size:"small",type:a[l.sysparam]},X(n)?n:{default:()=>[n]})}},{key:"operate",title:C("common.operate"),align:"center",width:160,fixed:"right",render:l=>{let a;return l.syspara!=0?t("div",{class:"flex-center gap-8px"},[W(t(x,{type:"primary",ghost:!0,size:"small",onClick:()=>M(l.id)},X(a=C("common.edit"))?a:{default:()=>[a]}),[[ae("no-auth"),"assocition.policy.update"]]),t(K,{onPositiveClick:()=>s(l.id)},{default:()=>C("common.confirmDelete"),trigger:()=>{let n;return W(t(x,{type:"error",ghost:!0,size:"small"},X(n=C("common.delete"))?n:{default:()=>[n]}),[[ae("no-auth"),"assocition.policy.delete"]])}})]):null}}]}),{drawerVisible:o,operateType:P,editingData:L,handleAdd:F,handleEdit:k,checkedRowKeys:y,onBatchDeleted:V,onDeleted:z,closeDrawer:B}=Ge(h,g);async function T(){console.log(y.value),i(y.value,l=>{V()})}function M(l){k(l)}function s(l){console.log(l),i([l],a=>{z()})}async function i(l,a){const{data:n,error:u}=await ll(l);if(!u)a&&a(n);else return!1}async function b(){}async function _(l){var n,u;const a={id:l.id,status:l.status};try{const{data:v,error:r}=await De([a]);if(!r)(n=window.$message)==null||n.success(l.status===1?"使用成功":"停用成功"),g();else throw new Error("更新失败")}catch{l.status=l.status===1?0:1,(u=window.$message)==null||u.error("操作失败，请重试")}}return(l,a)=>{const n=Ie,u=al,v=ve;return Q(),Me("div",dl,[t(tl,{model:c(D),"onUpdate:model":a[0]||(a[0]=r=>Z(D)?D.value=r:null),onReset:c(R),onSearch:c(g)},null,8,["model","onReset","onSearch"]),t(v,{title:"关联策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":d(()=>[t(n,{columns:c(E),"onUpdate:columns":a[1]||(a[1]=r=>Z(E)?E.value=r:null),"disabled-delete":c(y).length===0,loading:c(S),onAdd:c(F),onDelete:T,onRefresh:c(g),"is-view-export-button":!0,onExportHandler:b,"is-view-add-button":c(pe)("assocition.policy.insert"),"is-view-delete-button":c(pe)("assocition.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:d(()=>[t(u,{"checked-row-keys":c(y),"onUpdate:checkedRowKeys":a[2]||(a[2]=r=>Z(y)?y.value=r:null),columns:c(e),data:c(h),size:"small","flex-height":!c(p).isMobile,"scroll-x":962,loading:c(S),remote:"","row-key":r=>r.id,pagination:c($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(rl,{visible:c(o),"onUpdate:visible":a[3]||(a[3]=r=>Z(o)?o.value=r:null),"operate-type":c(P),"row-data":c(L),onSubmitted:c(g)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{$l as default};
