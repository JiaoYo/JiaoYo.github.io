import{_ as Q}from"./table-header-operation.vue_vue_type_script_setup_true_lang-sZrXAUWR.js";import{d as G,q as O,v as L,s as j,K as E,o as K,c as q,w as a,g as e,L as F,h as R,t as B,i as t,$ as D,M as Y,an as Z,ao as ue,A as H,B as M,E as W,D as X,a9 as V,x as pe,b as me,r as _e,y as fe,C as he,X as ve,aa as ge,ab as we,Z as ee,e as te,ac as P,ad as ye,ap as be,aq as De}from"./index-BthjjP8Z.js";import{e as ke,g as Ie,h as xe,i as Ne,j as ze,k as Se,l as Te,m as Ce}from"./asset-QixH9YQO.js";import{u as ae,a as ne}from"./table-DgUtF0JO.js";import{_ as oe}from"./round-search-D0y4Bi99.js";import{_ as se}from"./round-refresh-7YBMJmxM.js";import{_ as le}from"./FormItemGridItem-Cf_xNcQf.js";import{_ as re}from"./Grid-CrjQrgB8.js";import{u as Ae}from"./usePageData-DsxRw8IA.js";import{h as J}from"./permission-DgnWzPLf.js";import{_ as $e}from"./Popconfirm-DUBjdYuJ.js";import{_ as ie}from"./DataTable-DVNKf1bg.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-P1qKwD6q.js";import"./setting-outlined-CB-n0fXZ.js";import"./round-delete-imzaxX0A.js";import"./refresh-516o5uee.js";import"./Upload-CXW3Rb5a.js";import"./Progress-CegqNBwu.js";import"./Forward-B9_DMOnd.js";const Pe=G({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:O(["reset","search"],["update:model"]),setup(w,{emit:N}){const u=N,{formRef:p,restoreValidation:h}=L(),n=j(w,"model");async function y(){await h(),n.value.startAndEndIp=null,u("reset")}async function g(){var f,m,s,v;if(n.value.startAndEndIp&&n.value.startAndEndIp.length>0?(n.value.startIp=n.value.startAndEndIp[0]||null,n.value.endIp=n.value.startAndEndIp[1]||null):(n.value.startIp=null,n.value.endIp=null),n.value.startIp&&!Z(n.value.startIp)||n.value.endIp&&!Z(n.value.endIp))return(f=window.$message)==null||f.destroyAll(),(m=window.$message)==null||m.error("请输入正确的IP地址"),!1;if(n.value.startIp&&n.value.endIp&&ue(n.value.startIp,n.value.endIp)>0)return(s=window.$message)==null||s.destroyAll(),(v=window.$message)==null||v.error("起始资产IP不能大于终止资产IP"),!1;u("search")}return(f,m)=>{const s=H,v=le,z=se,k=M,I=oe,r=W,S=re,C=X,$=V,T=E("no-space");return K(),q($,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(C,{model:n.value,"label-placement":"left","label-width":80,"show-feedback":!1,onKeyup:Y(g,["enter"])},{default:a(()=>[e(S,{responsive:"screen","item-responsive":""},{default:a(()=>[e(v,{span:"24 s:12 m:6",label:"操作系统",path:"aname",class:"pr-24px"},{default:a(()=>[F(e(s,{clearable:"",value:n.value.fuzzy,"onUpdate:value":m[0]||(m[0]=d=>n.value.fuzzy=d),placeholder:"请输入操作系统",onClear:y},null,8,["value"]),[[T]])]),_:1}),e(v,{span:"24 s:12 m:8",label:"起止IP",path:"startAndEndIp",class:"pr-24px"},{default:a(()=>[e(s,{pair:"",separator:"-",placeholder:["起始资产IP","终止资产IP"],clearable:"",onClear:m[1]||(m[1]=d=>{n.value.startAndEndIp="",g()}),value:n.value.startAndEndIp,"onUpdate:value":m[2]||(m[2]=d=>n.value.startAndEndIp=d)},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:6"},{default:a(()=>[e(r,{class:"w-full"},{default:a(()=>[e(k,{onClick:y},{icon:a(()=>[e(z,{class:"text-icon"})]),default:a(()=>[R(" "+B(t(D)("common.reset")),1)]),_:1}),e(k,{type:"primary",ghost:"",onClick:g},{icon:a(()=>[e(I,{class:"text-icon"})]),default:a(()=>[R(" "+B(t(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Re=G({name:"DiscovertaskFormSearch",__name:"discovertask-form-search",props:{model:{required:!0},modelModifiers:{}},emits:O(["reset","search"],["update:model"]),setup(w,{emit:N}){const u=N,p=j(w,"model"),{formRef:h,restoreValidation:n}=L();async function y(){await n(),u("reset")}async function g(){u("search")}const f=()=>{p.value.fuzzy="",g()};return(m,s)=>{const v=H,z=le,k=se,I=M,r=oe,S=W,C=re,$=X,T=V,d=E("no-space");return K(),q(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e($,{model:p.value,"label-placement":"left","label-width":80,"show-feedback":!1,onKeyup:Y(g,["enter"])},{default:a(()=>[e(C,{responsive:"screen","item-responsive":""},{default:a(()=>[e(z,{span:"24 s:12 m:6",label:"任务名称",path:"fuzzy",class:"pr-24px"},{default:a(()=>[F(e(v,{clearable:"",value:p.value.fuzzy,"onUpdate:value":s[0]||(s[0]=i=>p.value.fuzzy=i),placeholder:"请输入任务名称",onClear:f},null,8,["value"]),[[d]])]),_:1}),e(z,{span:"24 s:12 m:6"},{default:a(()=>[e(S,{class:"w-full"},{default:a(()=>[e(I,{onClick:y},{icon:a(()=>[e(k,{class:"text-icon"})]),default:a(()=>[R(" "+B(t(D)("common.reset")),1)]),_:1}),e(I,{type:"primary",ghost:"",onClick:g},{icon:a(()=>[e(r,{class:"text-icon"})]),default:a(()=>[R(" "+B(t(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Be=G({name:"OperateDrawer",__name:"operate-drawer",props:O({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:O(["submitted"],["update:visible"]),setup(w,{emit:N}){const u=w,p=N,h=j(w,"visible"),{formRef:n,validate:y,restoreValidation:g}=L(),{defaultRequiredRule:f}=pe(),m=me(()=>({add:"添加发现任务",edit:"编辑发现任务"})[u.operateType]),s=_e(v());function v(){return{tname:"",nid:void 0}}const z={tname:f,nid:{type:"number",trigger:["blur","change"],required:!0,message:"请选择网段"}};async function k(){await S(),Object.assign(s,v()),u.operateType==="edit"&&u.rowData&&Object.assign(s,u.rowData)}function I(){h.value=!1}const{pageData:r,getData:S,nextPage:C}=Ae(ke),$=async d=>{const i=d.currentTarget;i.scrollTop+i.offsetHeight>=i.scrollHeight&&r.data.length<r.total&&C()};async function T(){var d,i;if(await y(),u.operateType==="add"){const{data:_,error:o}=await Ie([{tname:s.tname,nid:s.nid}]);o||((d=window.$message)==null||d.success(D("common.addSuccess")),I(),p("submitted"))}else{const{data:_,error:o}=await xe([{id:u.rowData.id,tname:s.tname,nid:s.nid}]);o||((i=window.$message)==null||i.success(D("common.updateSuccess")),I(),p("submitted"))}}return fe(h,()=>{h.value&&(k(),g())}),(d,i)=>{const _=H,o=he,l=ve,x=X,b=M,A=W,c=ge,ce=we,de=E("no-space");return K(),q(ce,{show:h.value,"onUpdate:show":i[2]||(i[2]=U=>h.value=U),"display-directive":"show",width:450},{default:a(()=>[e(c,{title:m.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(A,{size:16},{default:a(()=>[e(b,{onClick:I},{default:a(()=>[R(B(t(D)("common.cancel")),1)]),_:1}),e(b,{type:"primary",onClick:T},{default:a(()=>[R(B(t(D)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(x,{ref_key:"formRef",ref:n,model:s,rules:z},{default:a(()=>[e(o,{label:"任务名称",path:"tname"},{default:a(()=>[F(e(_,{value:s.tname,"onUpdate:value":i[0]||(i[0]=U=>s.tname=U),placeholder:"请输入任务名称",clearable:""},null,8,["value"]),[[de]])]),_:1}),e(o,{label:"网段",path:"nid"},{default:a(()=>[e(l,{value:s.nid,"onUpdate:value":i[1]||(i[1]=U=>s.nid=U),placeholder:"请选择网段",clearable:"",filterable:"","value-field":"id","label-field":"nname",options:t(r).data,"reset-menu-on-options-change":!1,onScroll:$},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}});function Ue(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!ye(w)}const Ee=G({name:"DiscoverTask",__name:"discover-task",setup(w){const N=ee(),{columns:u,columnChecks:p,data:h,getData:n,loading:y,pagination:g,searchParams:f,resetSearchParams:m}=ae({apiFn:Ne,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"tname",title:"任务名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"nid",title:"网段",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:o=>o.startip+"~"+o.endip},{key:"status",title:"状态",align:"center",width:120},{key:"operate",title:D("common.operate"),align:"center",width:160,render:o=>e("div",{class:"flex-center gap-8px"},[F(e(M,{type:"primary",ghost:!0,size:"small",onClick:()=>T(o)},{default:()=>[R("立即发现")]}),[[E("no-auth"),"sys.excute.task.select"]]),e($e,{onPositiveClick:()=>i(o.id)},{default:()=>D("common.confirmDelete"),trigger:()=>{let l;return F(e(M,{type:"error",ghost:!0,size:"small"},Ue(l=D("common.delete"))?l:{default:()=>[l]}),[[E("no-auth"),"sys.discovering.task.delete"]])}})])}]}),{drawerVisible:s,operateType:v,editingData:z,handleAdd:k,handleEdit:I,checkedRowKeys:r,onBatchDeleted:S,onDeleted:C,closeDrawer:$}=ne(h,n);async function T(o){var b,A;console.log(o);const{data:l,error:x}=await ze(o);x||((b=window.$message)==null||b.destroyAll(),(A=window.$message)==null||A.success("已操作立即发现"))}async function d(){console.log(r.value),_(r.value,o=>{S()})}function i(o){console.log(o),_([o],l=>{C()})}async function _(o,l){const{data:x,error:b}=await Se(o);if(!b)l&&l(x);else return!1}return(o,l)=>{const x=Q,b=ie,A=V;return K(),te("section",null,[e(Re,{model:t(f),"onUpdate:model":l[0]||(l[0]=c=>P(f)?f.value=c:null),onReset:t(m),onSearch:t(n)},null,8,["model","onReset","onSearch"]),e(A,{title:"发现任务",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(x,{columns:t(p),"onUpdate:columns":l[1]||(l[1]=c=>P(p)?p.value=c:null),"disabled-delete":t(r).length===0,loading:t(y),onAdd:t(k),onDelete:d,onRefresh:t(n),"is-view-add-button":t(J)("sys.discovering.task.insert"),"is-view-delete-button":t(J)("sys.discovering.task.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:a(()=>[e(b,{"checked-row-keys":t(r),"onUpdate:checkedRowKeys":l[2]||(l[2]=c=>P(r)?r.value=c:null),columns:t(u),data:t(h),size:"small","flex-height":!t(N).isMobile,"scroll-x":702,loading:t(y),remote:"","row-key":c=>c.id,pagination:t(g),class:"sm:h-640px"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Be,{visible:t(s),"onUpdate:visible":l[3]||(l[3]=c=>P(s)?s.value=c:null),"operate-type":t(v),"row-data":t(z),onSubmitted:t(n)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}}),Fe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ot=G({name:"assetmanagement_assetdiscovery",__name:"index",setup(w){const N=ee(),{columns:u,columnChecks:p,data:h,getData:n,loading:y,pagination:g,searchParams:f,resetSearchParams:m}=ae({apiFn:Te,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,startIp:null,endIp:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"opersys",title:"操作系统",align:"center",minWidth:160},{key:"assetip",title:"资产IP",align:"center"}]}),{drawerVisible:s,operateType:v,editingData:z,handleAdd:k,handleEdit:I,checkedRowKeys:r,onBatchDeleted:S,onDeleted:C,closeDrawer:$}=ne(h,n);async function T(){console.log(r.value),d(r.value,i=>{S()})}async function d(i,_){const{data:o,error:l}=await Ce(i);if(!l)_&&_(o);else return!1}return(i,_)=>{const o=Q,l=ie,x=V,b=be,A=De;return K(),te("div",Fe,[e(x,{size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:a(()=>[e(A,{type:"card",animated:"",style:{"background-color":"white"}},{default:a(()=>[e(b,{name:"chap1",tab:"资产发现"},{default:a(()=>[e(Pe,{model:t(f),"onUpdate:model":_[0]||(_[0]=c=>P(f)?f.value=c:null),onReset:t(m),onSearch:t(n)},null,8,["model","onReset","onSearch"]),e(x,{title:"资产发现",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(o,{columns:t(p),"onUpdate:columns":_[1]||(_[1]=c=>P(p)?p.value=c:null),"disabled-delete":t(r).length===0,loading:t(y),onAdd:t(k),onDelete:T,onRefresh:t(n)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:a(()=>[e(l,{"checked-row-keys":t(r),"onUpdate:checkedRowKeys":_[2]||(_[2]=c=>P(r)?r.value=c:null),columns:t(u),data:t(h),size:"small","flex-height":!t(N).isMobile,"scroll-x":702,loading:t(y),remote:"","row-key":c=>c.id,pagination:t(g),class:"sm:h-640px"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1})]),_:1}),e(b,{name:"chap2",tab:"发现任务"},{default:a(()=>[e(Ee)]),_:1})]),_:1})]),_:1})])}}});export{ot as default};
