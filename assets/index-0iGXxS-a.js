import{_ as ie}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Dnuy8dQT.js";import{d as A,n as K,s as J,p as Z,q as re,b as se,r as pe,ae as ce,D as F,o as q,c as Q,w as i,g as t,h as L,t as M,i as o,$ as v,F as X,E as V,W as Y,aw as z,ax as W,J as ee,K as ue,Z as te,O as oe,B as E,N as G,af as de,ag as me,ad as le,a3 as fe,av as _e,j as ve,A as ye,e as ge,ah as B,ai as he,aj as be}from"./index-DLUsNmq1.js";import{u as we,a as ke}from"./table-kOPqmHnN.js";import{e as Ne,g as Pe,h as De,i as Ie,j as Se}from"./Collection-DqYLk_jq.js";import{b as ae,T as Ce}from"./collection-Dq208Za7.js";import{_ as xe}from"./round-search-BbPxbkp0.js";import{_ as Te}from"./round-refresh-D6qtE-EZ.js";import{_ as Re}from"./lodash-JCyYSLuI.js";import{_ as ze}from"./FormItemGridItem-Dc2T-Nkg.js";import{_ as Ue}from"./Grid-CI2uRap6.js";import{h as H}from"./permission-CrnQp84P.js";import{_ as $e}from"./Popconfirm-0vjcOevX.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-PX6Pf2Kf.js";import"./setting-outlined-CRasYckM.js";import"./export-DBNKcknr.js";import"./refresh-uQDw2HUN.js";import"./round-delete-CwtAgONf.js";import"./round-plus-CUJdFlyE.js";import"./Upload-DIoh3FfB.js";import"./Progress-Bg9KdPyK.js";const je=A({name:"OperateDrawer",__name:"operate-drawer",props:K({operateType:{},rowData:{},tTypeList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(h,{emit:U}){const d=h,k=U,y=J(h,"visible"),{formRef:p,validate:C,restoreValidation:$}=Z(),{createConfirmPwdRule:x,defaultRequiredRule:j,patternRules:P}=re(),T=se(()=>({add:"新增策略",edit:"编辑策略"})[d.operateType]),e=pe(R());function R(){return{id:void 0,pname:"",llevel:[],etype:[],oriip:"",aimip:"",cdesc:""}}const f={pname:j,oriip:{type:"string",required:!1,validator:(b,l)=>!z(l[0])||!z(l[1])?new Error("请输入正确的IP"):!0,trigger:["input"]},aimip:{type:"string",required:!1,validator:(b,l)=>!z(l[0])||!z(l[1])?new Error("请输入正确的IP"):!0,trigger:["input"]}};function g(){Object.assign(e,R()),d.operateType==="edit"&&d.rowData&&(Object.assign(e,d.rowData),e.oriip&&(e.oriip=e.oriip.split("-")),e.aimip&&(e.aimip=e.aimip.split("-")),e.etype&&(e.etype=e.etype.split(",").map(Number)),e.llevel&&(e.llevel=e.llevel.split(",").map(Number)))}function D(){y.value=!1}async function I(){var l,_,m,w,N;const b=(c,a)=>!z(a[0])||!z(a[1])?new Error("请输入正确的IP"):!0;if(f.oriip.validator=(c,a)=>!0,f.aimip.validator=(c,a)=>!0,await C().finally(()=>{f.oriip.validator=b,f.aimip.validator=b}),(e.llevel.length===0||!e.llevel)&&(e.etype.length===0||!e.etype)&&(!e.oriip[0]||!e.oriip[1])&&(!e.aimip[0]||!e.aimip[1]))return(l=window.$message)==null?void 0:l.error("日志级别、事件类型、源IP、目的IP至少填写一个");if(e.oriip&&W(e.oriip[0],e.oriip[1])!=-1)return(_=window.$message)==null?void 0:_.error("源起始IP不能大于源结束IP");if(e.aimip&&W(e.aimip[0],e.aimip[1])!=-1)return(m=window.$message)==null?void 0:m.error("目的起始IP不能大于目的结束IP");if(e.oriip&&(e.oriip=e.oriip.join("-")),e.aimip&&(e.aimip=e.aimip.join("-")),e.llevel&&(e.llevel=e.llevel.join(",")),e.etype&&(e.etype=e.etype.join(",")),d.operateType==="add"){const{data:c,error:a}=await Ne([e]);a||((w=window.$message)==null||w.success(v("common.addSuccess")),D(),k("submitted"))}else{const{data:c,error:a}=await Pe([e]);a||((N=window.$message)==null||N.success(v("common.updateSuccess")),D(),k("submitted"))}}return ce(y,()=>{y.value&&(g(),$())}),(b,l)=>{const _=ee,m=ue,w=te,N=oe,c=E,a=G,n=de,u=me,S=F("no-space");return q(),Q(u,{show:y.value,"onUpdate:show":l[6]||(l[6]=r=>y.value=r),"display-directive":"show",width:360},{default:i(()=>[t(n,{title:T.value,"native-scrollbar":!1,closable:""},{footer:i(()=>[t(a,{size:16},{default:i(()=>[t(c,{onClick:D},{default:i(()=>[L(M(o(v)("common.cancel")),1)]),_:1}),t(c,{type:"primary",onClick:I},{default:i(()=>[L(M(o(v)("common.confirm")),1)]),_:1})]),_:1})]),default:i(()=>[t(N,{ref_key:"formRef",ref:p,model:e,rules:f,onKeyup:X(I,["enter"])},{default:i(()=>[t(m,{label:"策略名称",path:"pname"},{default:i(()=>[V(t(_,{value:e.pname,"onUpdate:value":l[0]||(l[0]=r=>e.pname=r),placeholder:"请输入策略名称",clearable:""},null,8,["value"]),[[S]])]),_:1}),t(m,{label:"日志级别",path:"llevel"},{default:i(()=>[t(w,{value:e.llevel,"onUpdate:value":l[1]||(l[1]=r=>e.llevel=r),multiple:"",placeholder:"请选择日志级别",options:o(Y)(o(ae))},null,8,["value","options"])]),_:1}),t(m,{label:"事件类型",path:"etype"},{default:i(()=>[t(w,{value:e.etype,"onUpdate:value":l[2]||(l[2]=r=>e.etype=r),multiple:"",placeholder:"请选择日志级别","value-field":"id","label-field":"pname",options:d.tTypeList},null,8,["value","options"])]),_:1}),t(m,{label:"源IP",path:"oriip"},{default:i(()=>[t(_,{pair:"",separator:"-",value:e.oriip,"onUpdate:value":l[3]||(l[3]=r=>e.oriip=r),placeholder:["源起始IP","源终止IP"],clearable:""},null,8,["value"])]),_:1}),t(m,{label:"目的IP",path:"aimip"},{default:i(()=>[t(_,{pair:"",separator:"-",value:e.aimip,"onUpdate:value":l[4]||(l[4]=r=>e.aimip=r),placeholder:["目的起始IP","目的终止IP"],clearable:""},null,8,["value"])]),_:1}),t(m,{label:"描述",path:"cdesc"},{default:i(()=>[t(_,{type:"textarea",value:e.cdesc,"onUpdate:value":l[5]||(l[5]=r=>e.cdesc=r),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Be=A({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search"],["update:model"]),setup(h,{emit:U}){const d=U,{formRef:k,restoreValidation:y}=Z(),p=J(h,"model");function C(){p.value.fuzzy="",d("search")}async function $(){await y(),d("reset")}async function x(){d("search")}function j(T){p.value.llevel=T,d("search")}const P=Re.debounce(x,1e3,{leading:!0,trailing:!1});return(T,e)=>{const R=ee,f=ze,g=te,D=Te,I=E,b=xe,l=G,_=Ue,m=oe,w=le,N=F("no-space");return q(),Q(w,{bordered:!1,size:"small",class:"card-wrapper"},{default:i(()=>[t(m,{ref_key:"formRef",ref:k,model:p.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:X(o(P),["enter"])},{default:i(()=>[t(_,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:i(()=>[t(f,{span:"24 s:12 m:8 l:6",label:"策略名称",path:"fuzzy"},{default:i(()=>[V(t(R,{clearable:"",value:p.value.fuzzy,"onUpdate:value":e[0]||(e[0]=c=>p.value.fuzzy=c),placeholder:"请输入策略名称",onClear:C},null,8,["value"]),[[N]])]),_:1}),t(f,{span:"24 s:12 m:8 l:6",label:"日志级别",path:"llevel"},{default:i(()=>[t(g,{clearable:"",filterable:"",value:p.value.llevel,"onUpdate:value":e[1]||(e[1]=c=>p.value.llevel=c),placeholder:"请选择日志级别",options:o(Y)(o(ae)),onUpdateValue:j,style:{width:"100%"}},null,8,["value","options"])]),_:1}),t(f,{span:"24 s:12 m:8 l:6"},{default:i(()=>[t(l,{class:"w-full"},{default:i(()=>[t(I,{onClick:$},{icon:i(()=>[t(D,{class:"text-icon"})]),default:i(()=>[L(" "+M(o(v)("common.reset")),1)]),_:1}),t(I,{type:"primary",ghost:"",onClick:o(P)},{icon:i(()=>[t(b,{class:"text-icon"})]),default:i(()=>[L(" "+M(o(v)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function O(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!he(h)}const at=A({name:"collectionmanagement_collectionpolicy",__name:"index",setup(h){const U=fe(),{columns:d,columnChecks:k,data:y,getData:p,loading:C,mobilePagination:$,searchParams:x,resetSearchParams:j}=we({apiFn:De,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,llevel:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"pname",title:"策略名称",align:"center",width:140},{key:"llevel",title:"日志级别",align:"center",width:300,render:a=>{let n;const u=a.llevel.split(",").map(Number),S={0:"default",1:"success",2:"info",3:"warning",4:"error"};return t(G,{justify:"center"},O(n=u.map(r=>{const s=v(Ce[r]);return t(_e,{type:S[r]},O(s)?s:{default:()=>[s]})}))?n:{default:()=>[n]})}},{key:"etype",title:"事件类型",align:"center",render:a=>{const n=a.etype.split(",").map(Number);return t("span",null,[n.map((u,S)=>{var s;const r=(s=l.value.find(ne=>ne.id===u))==null?void 0:s.pname;return r?`${r}${S!==n.length-1?"，":""}`:""})])},ellipsis:{tooltip:!0,tooltipPlacement:"top"}},{key:"oriip",title:"源IP",align:"center"},{key:"aimip",title:"目的IP",align:"center"},{key:"cdesc",title:"描述",align:"center",minWidth:200},{key:"operate",title:v("common.operate"),align:"center",width:130,render:a=>{let n;return t("div",{class:"flex-center gap-8px"},[V(t(E,{type:"primary",ghost:!0,size:"small",onClick:()=>N(a.id)},O(n=v("common.edit"))?n:{default:()=>[n]}),[[F("no-auth"),"sys.collection.policy.update"]]),t($e,{onPositiveClick:()=>w(a.id)},{default:()=>v("common.confirmDelete"),trigger:()=>{let u;return V(t(E,{type:"error",ghost:!0,size:"small"},O(u=v("common.delete"))?u:{default:()=>[u]}),[[F("no-auth"),"sys.collection.policy.delete"]])}})])}}]}),{drawerVisible:P,operateType:T,editingData:e,handleAdd:R,handleEdit:f,checkedRowKeys:g,onBatchDeleted:D,onDeleted:I,closeDrawer:b}=ke(y,p),l=ve([]),_=async()=>{const{data:a,error:n}=await Se();l.value=a};async function m(){console.log(g.value),c(g.value.join(","),a=>{D()})}function w(a){console.log(a),c(a,n=>{I()})}function N(a){f(a)}async function c(a,n){const u=await Ie(a);console.log("data",u),n&&n(u)}return ye(()=>{_()}),(a,n)=>{const u=ie,S=be,r=le;return q(),ge("div",Oe,[t(Be,{model:o(x),"onUpdate:model":n[0]||(n[0]=s=>B(x)?x.value=s:null),onReset:o(j),onSearch:o(p)},null,8,["model","onReset","onSearch"]),t(r,{title:"采集过滤策略",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":i(()=>[t(u,{columns:o(k),"onUpdate:columns":n[1]||(n[1]=s=>B(k)?k.value=s:null),"disabled-delete":o(g).length===0,"is-view-add-button":o(H)("sys.collection.policy.insert"),"is-view-delete-button":o(H)("sys.collection.policy.delete"),loading:o(C),onAdd:o(R),onDelete:m,onRefresh:o(p)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:i(()=>[t(S,{"checked-row-keys":o(g),"onUpdate:checkedRowKeys":n[2]||(n[2]=s=>B(g)?g.value=s:null),columns:o(d),data:o(y),size:"small","flex-height":!o(U).isMobile,"scroll-x":962,loading:o(C),remote:"","row-key":s=>s.id,pagination:o($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(je,{visible:o(P),"onUpdate:visible":n[3]||(n[3]=s=>B(P)?P.value=s:null),"operate-type":o(T),"row-data":o(e),tTypeList:l.value,onSubmitted:o(p)},null,8,["visible","operate-type","row-data","tTypeList","onSubmitted"])]),_:1})])}}});export{at as default};
