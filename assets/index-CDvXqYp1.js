import{_ as ke}from"./table-column-setting.vue_vue_type_script_setup_true_lang-0I1cGMY_.js";import{_ as Te}from"./round-refresh-BqeaLr1n.js";import{o as F,e as _e,f as ve,d as te,p as Y,k as E,q as de,r as oe,s as xe,v as Ce,ab as se,ag as De,b as Se,$ as U,z as W,c as J,w as t,g as e,h as M,t as B,i as n,A as X,D as fe,C as $e,b9 as Ae,ba as Ue,ak as le,L as re,aP as Me,aV as ge,P as H,aW as he,Q as ue,B as L,aG as ce,aM as pe,aE as ie,bd as qe,S as ze,aD as Le,ai as Oe,bb as Pe,b7 as Ve,x as Be,bc as Re,af as Z,aH as ne,aI as je,aJ as Ee,aK as Fe,a6 as Ge}from"./index-BkKwuL7t.js";import{_ as Ke}from"./round-add-CC7NxleU.js";import{_ as Je}from"./round-search-eyiTE7Vx.js";import{u as He,a as Qe}from"./table-CNRI1lB6.js";import{_ as me}from"./FormItemGridItem-vCUVG551.js";import{_ as ee,a as We}from"./Grid-asJdx__I.js";import{p as Xe}from"./gather-lTgTFkcK.js";import{_ as Ye}from"./Tree-CX1HUYyS.js";import{y as Ze}from"./common-BQ-7CSlq.js";import{N as et}from"./Popconfirm-MYk6mt1U.js";import{_ as tt}from"./InputGroupLabel-BLGdvcQx.js";const lt={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},nt=ve("path",{fill:"currentColor",d:"M11 13v3q0 .425.288.713T12 17t.713-.288T13 16v-3h3q.425 0 .713-.288T17 12t-.288-.712T16 11h-3V8q0-.425-.288-.712T12 7t-.712.288T11 8v3H8q-.425 0-.712.288T7 12t.288.713T8 13zm1 9q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1),at=[nt];function ot(x,R){return F(),_e("svg",lt,[...at])}const st={name:"material-symbols-add-circle-outline-rounded",render:ot},it=ve("span",null,"批量新增：格式为（转发设备1-10）",-1),dt=te({__name:"add_model",props:Y({operateType:{},rowData:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(x,{emit:R}){const f=E(!1),C=de(x,"visible"),S=R,m=x,l=oe($());function $(){return{devName:"转发设备1",chlId:void 0,devCommAddr:"1",devPubAddr:"1",devValid:1,devDesc:"",reserve0:"",reserve1:""}}const i=oe({channelList:[]});async function I(){const{data:h,error:r}=await pe({type:1});r||(i.channelList=h)}async function O(){await I(),m.operateType==="edit"&&m.rowData?Object.assign(l,m.rowData):(Object.assign(l,$()),l.chlId=m.chlId||i.channelList[0].id)}const{formRef:N,validate:_,restoreValidation:d}=xe();Ce(),se(()=>m.rowData,()=>{O()}),se(C,()=>{C.value&&(m.operateType==="add"&&De(()=>{setTimeout(()=>{f.value=!0},200)}),O(),d())});const g=()=>{C.value=!1,f.value=!1},k=async()=>{var h,r,P;if(await _(),m.operateType==="add"){let u=[],c=l.devName;if(((h=l.devName)==null?void 0:h.indexOf("-"))!=-1){let o=Math.abs(c==null?void 0:c.substring(c.lastIndexOf("-")).replace(/[^0-9]/gi,"")),s=c.split(/-(?![^-]*-)/),a=c.substring(0,c.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],b=a.replace(/[^0]/g,""),V=a,G=s[0],z=G.substring(0,G.length-G.match(/(\d+)[^0-9]*$/)[1].length),K=o-a+1;for(let p=0;p<K;p++){let A=V++,Q=JSON.parse(JSON.stringify(l));Q.devName=parseInt(a)==0?b.length>0?String(A).length>=b.length?z+A:z+b.substring(0,b.length-String(A).length)+A:z+A:b.length>0?A>=10?z+b.substring(0,b.length-String(A).length+1)+A:z+b.substring(0,b.length)+A:z+A,Q.devCommAddr=Number(l.devCommAddr)+p,u.push(Q)}}else u=[l];if(u.length>1e3){(r=window.$message)==null||r.destroyAll(),(P=window.$message)==null||P.warning("批量添加最多仅支持1000条");return}const{data:j,error:q}=await Ae(u);q?console.log("error",q):(console.log("success",j),g(),S("submitted"))}else{const{data:u,error:c}=await Ue([l]);c?console.log("error",c):(console.log("success",u),g(),S("submitted"))}},v={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},D={devName:v,chlId:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},devCommAddr:v,devPubAddr:v},y=Se(()=>({add:U("common.add"),edit:U("common.edit")})[m.operateType]);return(h,r)=>{const P=le,u=me,c=re,j=Me,q=ge,o=H,s=he,a=ee,b=ue,V=L,G=H,z=ce,K=W("no-space");return F(),J(z,{show:C.value,"onUpdate:show":r[6]||(r[6]=p=>C.value=p),title:y.value,preset:"card",class:"w-30%",onAfterLeave:g},{footer:t(()=>[e(G,{size:16,justify:"center"},{default:t(()=>[e(V,{onClick:g,class:"w-100px"},{default:t(()=>[M(B(n(U)("common.cancel")),1)]),_:1}),e(V,{type:"primary",class:"w-100px",onClick:k},{default:t(()=>[M(B(n(U)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(b,{ref_key:"formRef",ref:N,model:l,rules:D,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:$e(k,["enter"])},{default:t(()=>[e(a,{responsive:"screen","item-responsive":""},{default:t(()=>[e(u,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(P,{filterable:"",placeholder:"请选择所属通道",value:l.chlId,"onUpdate:value":r[0]||(r[0]=p=>l.chlId=p),"label-field":"chlName","value-field":"id",options:i.channelList},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:24",label:"设备名称",path:"devName"},{default:t(()=>[e(j,{show:f.value,placement:"right-start"},{trigger:t(()=>[X(e(c,{clearable:"",value:l.devName,"onUpdate:value":r[1]||(r[1]=p=>l.devName=p),maxlength:"64",placeholder:"请输入设备名称"},null,8,["value"]),[[K]])]),default:t(()=>[it]),_:1},8,["show"])]),_:1}),e(u,{span:"24 m:24",label:"通讯地址",path:"devCommAddr"},{default:t(()=>[e(c,{clearable:"",value:l.devCommAddr,"onUpdate:value":r[2]||(r[2]=p=>l.devCommAddr=p),maxlength:"50",placeholder:"请输入通讯地址"},null,8,["value"])]),_:1}),e(u,{span:"24 m:24",label:"公共地址",path:"devPubAddr"},{default:t(()=>[e(c,{clearable:"",value:l.devPubAddr,"onUpdate:value":r[3]||(r[3]=p=>l.devPubAddr=p),placeholder:"请输入公共地址"},null,8,["value"])]),_:1}),m.operateType=="edit"?(F(),J(u,{key:0,span:"24 m:24",label:"设备有效性",path:"devValid"},{default:t(()=>[e(s,{value:l.devValid,"onUpdate:value":r[4]||(r[4]=p=>l.devValid=p),name:"radiogroup"},{default:t(()=>[e(o,null,{default:t(()=>[e(q,{label:"是",value:1}),e(q,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):fe("",!0),e(u,{span:"24 m:24",label:"设备描述",path:"devDesc"},{default:t(()=>[e(c,{clearable:"",value:l.devDesc,"onUpdate:value":r[5]||(r[5]=p=>l.devDesc=p),maxlength:"64",placeholder:"请输入设备描述",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),rt=te({__name:"batch_addModel",props:Y({chlList:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(x,{emit:R}){const f=de(x,"visible"),C=x,S=R,m=E([]),l=async()=>{const{data:_,error:d}=await pe({type:0});d||(m.value=_.map(g=>{var k;return{label:g.chlName,key:g.id+"10000",children:(k=g.devicePojoList)==null?void 0:k.map(v=>({label:v.devName,key:v.id}))}}))};se(()=>f.value,async _=>{_&&(l(),i.value={devIds:[],chlId:void 0,pre:void 0,valid:1,tagType:void 0,enbleType:!0},i.value.chlId=C.chlId)});const $=E(null),i=E({devIds:[],chlId:void 0,pre:void 0,valid:1,tagType:void 0,enbleType:!0}),I=async()=>{var k,v;const _=[];m.value.forEach(T=>{_.push(T.key)}),_.forEach(T=>{var D,y,h;(D=i.value.devIds)!=null&&D.includes(T)&&((h=i.value.devIds)==null||h.splice((y=i.value.devIds)==null?void 0:y.indexOf(T),1))}),i.value.enbleType&&(i.value.tagType="-1");const{data:d,error:g}=await qe({...i.value,devIds:(k=i.value.devIds)==null?void 0:k.join(",")});g||((v=window.$message)==null||v.success("新增成功"),f.value=!1,S("submitted"))},O={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},N={chlId:O,tagType:O};return(_,d)=>{const g=Ye,k=ze,v=We,T=le,D=me,y=re,h=ge,r=H,P=he,u=ee,c=ue,j=ee,q=L,o=H,s=ce;return F(),J(s,{show:f.value,"onUpdate:show":d[7]||(d[7]=a=>f.value=a),title:"批量新增",preset:"card",class:"w-40%"},{footer:t(()=>[e(o,{size:16,justify:"center"},{default:t(()=>[e(q,{onClick:d[6]||(d[6]=a=>f.value=!1),class:"w-100px"},{default:t(()=>[M(B(_.$t("common.cancel")),1)]),_:1}),e(q,{type:"primary",class:"w-100px",onClick:I},{default:t(()=>[M(B(_.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(j,{"x-gap":"12"},{default:t(()=>[e(v,{span:8},{default:t(()=>[e(k,{style:{"max-height":"220px"}},{default:t(()=>[e(g,{"block-line":"",data:m.value,"checked-keys":i.value.devIds,"onUpdate:checkedKeys":d[0]||(d[0]=a=>i.value.devIds=a),"expand-on-click":"","default-expand-all":!0,checkable:"",cascade:""},null,8,["data","checked-keys"])]),_:1})]),_:1}),e(v,{span:16},{default:t(()=>[e(c,{ref_key:"formRef",ref:$,"label-width":140,"label-placement":"left",model:i.value,rules:N},{default:t(()=>[e(u,{responsive:"screen","item-responsive":""},{default:t(()=>[e(D,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(T,{filterable:"",placeholder:"请选择所属通道",value:i.value.chlId,"onUpdate:value":d[1]||(d[1]=a=>i.value.chlId=a),"label-field":"chlName","value-field":"id",options:C.chlList},null,8,["value","options"])]),_:1}),e(D,{span:"24 m:24",label:"转发设备前缀",path:"pre"},{default:t(()=>[e(y,{value:i.value.pre,"onUpdate:value":d[2]||(d[2]=a=>i.value.pre=a),style:{width:"100%"},placeholder:"请输入转发设备前缀(可空)"},null,8,["value"])]),_:1}),e(D,{span:"24 m:24",label:"是否匹配测点类型",path:"enbleType"},{default:t(()=>[e(P,{value:i.value.enbleType,"onUpdate:value":d[3]||(d[3]=a=>i.value.enbleType=a),name:"radiogroup"},{default:t(()=>[e(r,null,{default:t(()=>[e(h,{label:"是",value:!0}),e(h,{label:"否",value:!1})]),_:1})]),_:1},8,["value"])]),_:1}),i.value.enbleType==!1?(F(),J(D,{key:0,span:"24 m:24",label:"测点类型",path:"tagType"},{default:t(()=>[e(T,{filterable:"",placeholder:"请选择测点类型",value:i.value.tagType,"onUpdate:value":d[4]||(d[4]=a=>i.value.tagType=a),options:n(ie)(n(Xe))},null,8,["value","options"])]),_:1})):fe("",!0),e(D,{span:"24 m:24",label:"设备有效性",path:"valid"},{default:t(()=>[e(P,{value:i.value.valid,"onUpdate:value":d[5]||(d[5]=a=>i.value.valid=a),name:"radiogroup"},{default:t(()=>[e(r,null,{default:t(()=>[e(h,{label:"是",value:1}),e(h,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1},8,["show"])}}}),ut=te({__name:"move_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:Y(["submitted"],["update:visible"]),setup(x,{emit:R}){const C=Le({0:"采集104tcp",1:"采集104udp"}),S=de(x,"visible"),m=E(null),l=E({targetDevice:void 0,EquipmentMerged:void 0}),$=()=>{},I={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}};return(O,N)=>{const _=le,d=me,g=ee,k=ue,v=L,T=H,D=ce;return F(),J(D,{show:S.value,"onUpdate:show":N[3]||(N[3]=y=>S.value=y),title:"设备移动至通道",preset:"card",class:"w-40%"},{footer:t(()=>[e(T,{size:16,justify:"center"},{default:t(()=>[e(v,{onClick:N[2]||(N[2]=y=>S.value=!1),class:"w-100px"},{default:t(()=>[M(B(O.$t("common.cancel")),1)]),_:1}),e(v,{type:"primary",class:"w-100px",onClick:$},{default:t(()=>[M(B(O.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(k,{ref_key:"formRef",ref:m,"label-width":120,"label-placement":"left",model:l.value,rules:I},{default:t(()=>[e(g,{responsive:"screen","item-responsive":""},{default:t(()=>[e(d,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:t(()=>[e(_,{filterable:"",clearable:"",placeholder:"请选择通道",value:l.value.targetDevice,"onUpdate:value":N[0]||(N[0]=y=>l.value.targetDevice=y),options:n(ie)(n(C))},null,8,["value","options"])]),_:1}),e(d,{span:"24 m:12",label:"待移动设备",path:"EquipmentMerged"},{default:t(()=>[e(_,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:l.value.EquipmentMerged,"onUpdate:value":N[1]||(N[1]=y=>l.value.EquipmentMerged=y),options:n(ie)(n(C))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),ct={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ae(x){return typeof x=="function"||Object.prototype.toString.call(x)==="[object Object]"&&!je(x)}const Tt=te({name:"configsetting_forwardingservice_forwardingdevicemanagement",__name:"index",setup(x){const R=Oe(),f=oe({channelList:[],chlIdAndNameMap:{}}),{columns:C,columnChecks:S,data:m,getData:l,loading:$,mobilePagination:i,searchParams:I,resetSearchParams:O}=He({apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,type:1,chlId:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"设备ID",align:"center",width:60},{key:"devName",title:"设备名称",align:"center",width:100},{key:"chlId",title:"所属通道",align:"center",width:140,render:o=>e("span",null,[f.chlIdAndNameMap[o.chlId]])},{key:"devDesc",title:"设备描述",align:"center",width:140,render:o=>e("span",null,[o.devDesc?o.devDesc:"无"])},{key:"devCommAddr",title:"设备通信地址",align:"center",width:140},{key:"devPubAddr",title:"设备公共地址",align:"center",width:140},{key:"devValid",title:"有效性",align:"center",width:140,render:o=>{let s;return e(Ve,{type:o.devValid==0?"error":"success"},ae(s=U(Ze[o.devValid]))?s:{default:()=>[s]})}},{key:"operate",title:U("common.operate"),align:"center",width:240,fixed:"right",render:o=>{let s;return e("div",{class:"flex-center gap-8px"},[e(L,{type:"primary",ghost:!0,size:"small",onClick:()=>q(o)},{default:()=>["转发测点管理"]}),X(e(L,{type:"primary",ghost:!0,size:"small",onClick:()=>r(o.id)},ae(s=U("common.edit"))?s:{default:()=>[s]}),[[W("no-auth"),"device:update"]]),X(e(et,{onPositiveClick:()=>h(o.id)},{default:()=>U("common.confirmDelete"),trigger:()=>{let a;return e(L,{type:"error",ghost:!0,size:"small"},ae(a=U("common.delete"))?a:{default:()=>[a]})}}),[[W("no-auth"),"device:delete"]])])}}]});async function N(){var a;const{data:o,error:s}=await pe({type:1});if(!s){if(o.length==0)return(a=window.$message)==null?void 0:a.warning("暂无转发通道，请先添加通道");f.channelList=o,o.forEach(V=>{f.chlIdAndNameMap[V.id]=V.chlName});const b=R.currentRoute.value.query.channelId;b&&(I.chlId=Number(b)),l()}}Be(()=>{N()});const{drawerVisible:_,operateType:d,editingData:g,handleAdd:k,handleEdit:v,checkedRowKeys:T,onBatchDeleted:D,onDeleted:y}=Qe(m,l),h=async o=>{const{data:s,error:a}=await Re({ids:o});a||y()},r=o=>{v(o)},P=o=>{I.chlId=o,l()},u=E(!1),c=()=>{u.value=!0},j=E(!1),q=o=>{R.push({path:"/configsetting/forwardingservice/forwardingpointmanagement",query:{channelId:o.chlId,deviceId:o.id}})};return(o,s)=>{const a=tt,b=le,V=re,G=Je,z=Ee,K=H,p=Ke,A=st,Q=Te,be=ke,ye=Fe,we=Ge,Ie=W("no-space"),Ne=W("no-auth");return F(),_e("div",ct,[e(we,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(K,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(z,null,{default:t(()=>[e(a,null,{default:t(()=>[M("所属通道")]),_:1}),e(b,{filterable:"",clearable:"",placeholder:"请选择通道",value:n(I).chlId,"onUpdate:value":s[0]||(s[0]=w=>n(I).chlId=w),"label-field":"chlName","value-field":"id",options:f.channelList,onUpdateValue:P},null,8,["value","options"]),e(a,null,{default:t(()=>[M("设备名称")]),_:1}),X(e(V,{clearable:"",value:n(I).fuzzy,"onUpdate:value":s[1]||(s[1]=w=>n(I).fuzzy=w),placeholder:"请输入设备名称",style:{width:"100%"}},null,8,["value"]),[[Ie]]),e(n(L),{type:"primary",ghost:"",onClick:n(l)},{icon:t(()=>[e(G,{class:Z(["text-icon",{"animate-spin":n($)}])},null,8,["class"])]),default:t(()=>[M(" "+B(n(U)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":t(()=>[e(K,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[X((F(),J(n(L),{onClick:n(k),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(p,{class:Z(["text-icon",{"animate-spin":n($)}])},null,8,["class"])]),default:t(()=>[M(" "+B(n(U)("common.add")),1)]),_:1},8,["onClick"])),[[Ne,"device:insert"]]),e(n(L),{onClick:c,size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(A,{class:Z(["text-icon",{"animate-spin":n($)}])},null,8,["class"])]),default:t(()=>[M(" "+B("批量新增"))]),_:1}),e(n(L),{onClick:n(l),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(Q,{class:Z(["text-icon",{"animate-spin":n($)}])},null,8,["class"])]),_:1},8,["onClick"]),e(be,{columns:n(S),"onUpdate:columns":s[2]||(s[2]=w=>ne(S)?S.value=w:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ye,{"checked-row-keys":n(T),"onUpdate:checkedRowKeys":s[3]||(s[3]=w=>ne(T)?T.value=w:null),columns:n(C),data:n(m),size:"small",loading:n($),remote:"","row-key":w=>w.id,pagination:n(i),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(dt,{visible:n(_),"onUpdate:visible":s[4]||(s[4]=w=>ne(_)?_.value=w:null),onSubmitted:n(l),"operate-type":n(d),"row-data":n(g),chlId:n(I).chlId},null,8,["visible","onSubmitted","operate-type","row-data","chlId"]),e(rt,{visible:u.value,"onUpdate:visible":s[5]||(s[5]=w=>u.value=w),chlList:f.channelList,chlId:n(I).chlId,onSubmitted:n(l)},null,8,["visible","chlList","chlId","onSubmitted"]),e(ut,{visible:j.value,"onUpdate:visible":s[6]||(s[6]=w=>j.value=w)},null,8,["visible"])]),_:1})])}}});export{Tt as default};
