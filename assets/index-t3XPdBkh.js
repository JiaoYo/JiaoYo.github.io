import{l as K}from"./lodash-Cjsf6VoW.js";import{d as R,q as G,j as v,v as W,s as Y,o as q,c as Q,w as o,g as l,i as _,$ as A,T as X,h as $,t as M,M as Z,au as ee,am as E,an as V,W as te,A as ae,B as z,E as F,D as le,a8 as j,Y as ne,r as H,al as re,e as oe,ac as ie,aR as se,ax as ue}from"./index-Cu8e7n-j.js";import{_ as pe}from"./round-search-DCwGKqmp.js";import{_ as de}from"./round-refresh-DVENiE1-.js";import{u as ce}from"./usePageData-CRP3Lbqe.js";import{a as me,T as B}from"./basicconf-Cos83wNH.js";import{f as ve}from"./system-manage-CYCMPLB6.js";import{_ as fe}from"./Cascader-B3eBFwho.js";import{_ as ge}from"./FormItemGridItem-BH8iEJpM.js";import{_ as _e}from"./DatePicker-DM5RegJu.js";import{_ as Ie}from"./Grid-B0WHzPHc.js";import{_ as he}from"./originlogInfo.vue_vue_type_script_setup_true_lang-CEP7Ql80.js";import{e as ye}from"./exportExcel-CZ2AjtLT.js";import{q as Se,y as Ae}from"./events-Bd7RZR0R.js";import{b as we,f as xe,a as be}from"./common-CpC_KlxH.js";import{_ as Oe}from"./DataTable-BHuQVdtu.js";import"./TimePicker--3zyzJR1.js";import"./defineProperty-Bttct8Qw.js";import"./Forward-DKoTpHF6.js";import"./CollapseItem-CxgN0Ygj.js";import"./DescriptionsItem-ChZ7RtOt.js";const Ee=R({name:"FormSearch",__name:"form-search",props:G(["eventsTypeDataList","LogSourceDeviceList"],{model:{required:!0},modelModifiers:{}}),emits:G(["search"],["update:model"]),setup(I,{emit:C}){const k=I,N=C;v(0);const{formRef:w,restoreValidation:U}=W(),e=Y(I,"model"),{pageData:D,getData:L,nextPage:T}=ce(ve),P=async f=>{const a=f.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&D.data.length<D.total&&T()};L();async function h(){await U(),e.value.etypeid=null,e.value.elevel=null,e.value.rtime=null,e.value.user=null,e.value.logodid=null,e.value.target=null,e.value.startAndEndOriginIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.expression=null,e.value.startOriginIp=null,e.value.endOriginIp=null,e.value.startAimOriginIp=null,e.value.endAimOriginIp=null,e.value.startSourceIp=null,e.value.endSourceIp=null,ee(()=>{N("search")})}async function p(){var f,a,g,s,y,d,m,x,S,b,O,t;if(e.value.startAndEndOriginIp&&e.value.startAndEndOriginIp.length>0?(e.value.startOriginIp=e.value.startAndEndOriginIp[0]||null,e.value.endOriginIp=e.value.startAndEndOriginIp[1]||null):(e.value.startOriginIp=null,e.value.endOriginIp=null),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimOriginIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimOriginIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimOriginIp=null,e.value.endAimOriginIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=null,e.value.endSourceIp=null),e.value.startOriginIp&&!E(e.value.startOriginIp)||e.value.endOriginIp&&!E(e.value.endOriginIp))return(f=window.$message)==null||f.destroyAll(),(a=window.$message)==null||a.error("请输入正确的IP地址"),!1;if(e.value.startOriginIp&&e.value.endOriginIp&&V(e.value.startOriginIp,e.value.endOriginIp)>0)return(g=window.$message)==null||g.destroyAll(),(s=window.$message)==null||s.error("起始IP不能大于终止IP"),!1;if(e.value.startAimOriginIp&&!E(e.value.startAimOriginIp)||e.value.endAimOriginIp&&!E(e.value.endAimOriginIp))return(y=window.$message)==null||y.destroyAll(),(d=window.$message)==null||d.error("请输入正确的IP地址"),!1;if(e.value.startAimOriginIp&&e.value.endAimOriginIp&&V(e.value.startAimOriginIp,e.value.endAimOriginIp)>0)return(m=window.$message)==null||m.destroyAll(),(x=window.$message)==null||x.error("起始IP不能大于终止IP"),!1;if(e.value.startSourceIp&&!E(e.value.startSourceIp)||e.value.endSourceIp&&!E(e.value.endSourceIp))return(S=window.$message)==null||S.destroyAll(),(b=window.$message)==null||b.error("请输入正确的IP地址"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&V(e.value.startSourceIp,e.value.endSourceIp)>0)return(O=window.$message)==null||O.destroyAll(),(t=window.$message)==null||t.error("起始IP不能大于终止IP"),!1;N("search")}return(f,a)=>{const g=fe,s=ge,y=te,d=_e,m=ae,x=de,S=z,b=pe,O=F,t=Ie,n=le,i=j;return q(),Q(i,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[l(n,{ref_key:"formRef",ref:w,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Z(p,["enter"])},{default:o(()=>[l(t,{responsive:"screen","item-responsive":""},{default:o(()=>[l(s,{span:"24 s:24 m:6",label:"事件类型",path:"etypeid",class:"pr-24px"},{default:o(()=>[l(g,{value:e.value.etypeid,"onUpdate:value":a[0]||(a[0]=r=>e.value.etypeid=r),clearable:"",placeholder:"请选择事件","max-tag-count":1,options:k.eventsTypeDataList,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),l(s,{span:"24 s:24 m:6",label:_(A)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:o(()=>[l(y,{filterable:"",clearable:"",placeholder:_(A)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[a[1]||(a[1]=r=>e.value.elevel=r),p],"reset-menu-on-options-change":!1,options:_(X)(_(me))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),l(s,{span:"24 s:24 m:6",label:"接收时间",path:"rtime",class:"pr-24px"},{default:o(()=>[l(d,{placeholder:"请选择接收时间","formatted-value":e.value.rtime,"onUpdate:formattedValue":a[2]||(a[2]=r=>e.value.rtime=r),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:"",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),l(s,{span:"24 s:24 m:6",label:"用户",path:"user",class:"pr-24px"},{default:o(()=>[l(y,{value:e.value.user,"onUpdate:value":a[3]||(a[3]=r=>e.value.user=r),placeholder:"请选择用户",clearable:"",filterable:"","value-field":"id","label-field":"username",options:_(D).data,"reset-menu-on-options-change":!1,onScroll:P},null,8,["value","options"])]),_:1}),l(s,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndOriginIp",class:"pr-24px mt-10px"},{default:o(()=>[l(m,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndOriginIp,"onUpdate:value":a[4]||(a[4]=r=>e.value.startAndEndOriginIp=r)},null,8,["value"])]),_:1}),l(s,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px mt-10px"},{default:o(()=>[l(m,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":a[5]||(a[5]=r=>e.value.startAndEndAimSourceIp=r)},null,8,["value"])]),_:1}),l(s,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSourceIp",class:"pr-24px mt-10px"},{default:o(()=>[l(m,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":a[6]||(a[6]=r=>e.value.startAndEndSourceIp=r)},null,8,["value"])]),_:1}),l(s,{span:"24 s:24 m:6",label:"日志源设备",path:"logodid",class:"pr-24px mt-10px"},{default:o(()=>[l(g,{value:e.value.logodid,"onUpdate:value":[a[7]||(a[7]=r=>e.value.logodid=r),p],placeholder:"请选择日志源设备",options:k.LogSourceDeviceList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),l(s,{span:"24 s:24 m:6",label:"目标对象",path:"target",class:"pr-24px mt-10px"},{default:o(()=>[l(m,{placeholder:"请输入目标对象",value:e.value.target,"onUpdate:value":a[8]||(a[8]=r=>e.value.target=r),clearable:""},null,8,["value"])]),_:1}),l(s,{span:"24 m:8",class:"pr-24px mt-10px"},{default:o(()=>[l(O,{class:"w-full"},{default:o(()=>[l(S,{onClick:h},{icon:o(()=>[l(x,{class:"text-icon"})]),default:o(()=>[$(" "+M(_(A)("common.reset")),1)]),_:1}),l(S,{type:"primary",ghost:"",onClick:p},{icon:o(()=>[l(b,{class:"text-icon"})]),default:o(()=>[$(" "+M(_(A)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ke={class:"min-h-500px flex-col-stretch overflow-hidden lt-sm:overflow-auto"};function De(I){return typeof I=="function"||Object.prototype.toString.call(I)==="[object Object]"&&!ie(I)}const Le=R({name:"eventalarm_originlog",__name:"index",setup(I){const C=ne(),k=v([]);(async()=>{const{data:t,error:n}=await we();n||(k.value=t.map(i=>({...i,id:"+"+i.id,type:i.cname})))})();const w=v([]),U=v([]);async function e(){const{data:t,error:n}=await xe();n||(w.value=t,await D())}async function D(){const{data:t,error:n}=await be();if(!n){U.value=t;let i=w.value.concat(t);w.value=se(i)}}e();const L=v(!1),T=v(),P=v(),h=v(!1),p=H({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),f=[{title:"",key:"key",width:80,render:(t,n)=>`${n+1}`},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"elevel",title:"事件等级",align:"center",width:120,render:t=>{(t.elevel===void 0||t.elevel===null)&&(t.elevel=1);const n={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},i=A(B[t.elevel]);let r={color:n[t.elevel],textColor:"#ffffff",borderColor:n[t.elevel]};return l(re,{size:"small",color:r},De(i)?i:{default:()=>[i]})}},{key:"cname",title:"设备类别",align:"center",width:180},{key:"type",title:"设备类型",align:"center",width:180},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"sourceip",title:"发生源IP",align:"center",width:180},{key:"prifinallog",title:"日志原文",align:"center",width:240,ellipsis:{tooltip:!0}},{key:"operate",title:A("common.operate"),align:"center",width:100,fixed:"right",render:t=>l("div",{class:"flex-center gap-8px"},[l(z,{type:"info",ghost:!0,size:"small",onClick:()=>x(t)},{default:()=>[$("详情")]})])}],a=v([]),g=async(t=!1)=>{if(!h.value)h.value=!0;else return;h.value=!0;const{data:n,error:i}=await Se(p);i||(t?a.value=[...a.value,...n]:a.value=n,h.value=!1)};g();const s=v(!0),y=()=>{a.value=[],p.pageId=void 0,(n=>Object.keys(n).filter(u=>u!=="limit"&&u!=="_t").some(u=>n[u]!==void 0&&n[u]!==""&&n[u]!==null))(p)?s.value=!1:(s.value=!0,m()),g()},d=H({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:t,endIndex:n,page:i,pageSize:r,pageCount:u,itemCount:c}){return`已加载${a.value.length}条`+(a.value.length?s.value?` 共计 ${a.value.length>0?c??0:0} 条`:a.value.length>=p.limit?"  预计还有更多":"":"")}});async function m(){const{data:t,error:n}=await Ae();n||(d.pageCount=20,d.total=Number(t),d.itemCount=Number(t))}m();const x=t=>{T.value=t.id,P.value=t,L.value=!0};function S(t){var n;console.log(t.target.scrollTop,t.target.offsetHeight,t.target.scrollHeight),t.target.scrollTop+t.target.offsetHeight==t.target.scrollHeight&&d.total>((n=a.value)==null?void 0:n.length)&&b()}const b=K.debounce(()=>{var t;if(((t=a.value)==null?void 0:t.length)<d.total){if(p.pageId==a.value[a.value.length-1].id)return;p.pageId=a.value[a.value.length-1].id,g(!0)}},300);async function O(){if(!a.value.length)return;const t=JSON.parse(JSON.stringify(a.value)),n=[];t.forEach(i=>{const r={};f.forEach(u=>{if(i.hasOwnProperty(u.key)){const c=u.key=="elevel"?A(B[i[u.key]]):i[u.key];r[u.title]=c}}),n.push(r)}),ye(n,500,"origin-log"+new Date().getTime())}return(t,n)=>{const i=F,r=Oe,u=j;return q(),oe("div",ke,[l(Ee,{model:p,"onUpdate:model":n[0]||(n[0]=c=>p=c),onSearch:y,eventsTypeDataList:w.value,LogSourceDeviceList:k.value,class:"mb-16px"},null,8,["model","eventsTypeDataList","LogSourceDeviceList"]),l(u,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[l(i,null,{default:o(()=>[l(_(z),{type:"primary",size:"small",ghost:"",onClick:O,title:"导出已加载"},{default:o(()=>[$("导出已加载")]),_:1})]),_:1})]),default:o(()=>[l(r,{columns:f,data:a.value,size:"small","flex-height":!_(C).isMobile,loading:h.value,remote:"","row-key":c=>c.id,"virtual-scroll":"","scroll-x":f.reduce((c,J)=>c+J.width,0),pagination:d,class:"sm:h-full",onScroll:S,"max-height":500},null,8,["data","flex-height","loading","row-key","scroll-x","pagination"])]),_:1}),l(he,{detailVisible:L.value,"onUpdate:detailVisible":n[1]||(n[1]=c=>L.value=c),detailId:T.value,detailInfo:P.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),Xe=ue(Le,[["__scopeId","data-v-a24a8794"]]);export{Xe as default};
