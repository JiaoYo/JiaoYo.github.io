import{_ as Te}from"./round-search-BEVIxLnz.js";import{d as de,Z as be,s as j,a as ne,au as pe,i as ve,dA as we,b as I,o as M,e as r,G as N,f as c,B as ke,w as O,g as x,aP as fe,a$ as ye,t as E,da as Ce,aM as Fe,a7 as Me,aF as _e,W as ue,av as $e,at as De,c as Z,aD as oe,aB as me,K as Ee,a3 as xe,bN as Se,a4 as je,fk as Ae,aJ as Oe,cW as he,aS as re,fl as ze,fm as Pe,aQ as Be,h as U,ax as Ne,J as Ie,N as Re,ay as Ue,$ as Ve,a2 as Le,fn as We,aE as qe,aT as Ze,aR as He}from"./index-9Ko_9_TI.js";import{u as Je}from"./usePageData-BWaYhHgw.js";import{_ as ie}from"./RadioButton-BH8aJiOr.js";import{_ as ce}from"./DatePicker-DdutLwK7.js";const Ke={class:"map-wrapper",style:{height:"100%",position:"relative"}},Ge={class:"map-legend"},Xe={class:"legend-header"},Ye={class:"legend-actions"},Qe={class:"legend-list"},et=["onClick","onContextmenu"],tt={key:0,class:"visibility-icon"},at={key:1,class:"solo-icon"},st={class:"legend-name"},nt={class:"visibility-toggle"},lt={key:0,class:"solo-notice"},ot=de({__name:"historyMap",props:{trackData:{}},setup(H){const X=be(),s=j(null);let n=null;const J=H,V=j([]),_=["#FF6B9D","#6BCF7F","#4A90E2","#FFD166","#7B68EE","#00D4AA","#FF8C42","#BA68C8","#4ECDC4","#FFA726","#42B883","#FF5252","#536DFE","#00E5FF","#69F0AE","#FF4081","#18FFFF","#B388FF","#76FF03","#FF9100","#EA80FC","#84FFFF","#CCFF90","#FF9E80","#80D8FF","#FFFF8D","#A7FFEB","#FF80AB","#8C9EFF","#B9F6CA"],b=j({}),P=j(""),L=ne(()=>{const t={};return Object.keys(V.value).forEach((o,d)=>{t[o]=_[d%_.length],b.value[o]===void 0&&(b.value[o]=!0)}),t});function Y(t){if(P.value){Q(t);return}b.value[t]=!b.value[t],w()}function Q(t){P.value===t?W():(P.value=t,Object.keys(b.value).forEach(e=>{b.value[e]=e===t}),w())}function W(){P.value="",Object.keys(b.value).forEach(t=>{b.value[t]=!0}),w()}function D(){Object.keys(b.value).forEach(t=>{b.value[t]=!b.value[t]}),P.value="",w()}function u(){Object.keys(b.value).forEach(t=>{b.value[t]=!0}),P.value="",w()}function A(){Object.keys(b.value).forEach(t=>{b.value[t]=!1}),P.value="",w()}const z=ne(()=>{const t=[];return Object.values(V.value).forEach(e=>{t.push(...e)}),t.sort((e,o)=>new Date(e.dbtime).getTime()-new Date(o.dbtime).getTime())}),K=ne(()=>{if(z.value.length===0)return[120.370086,30.305716];const t=z.value.map(m=>m.longitude),e=z.value.map(m=>m.latitude),o=(Math.min(...t)+Math.max(...t))/2,d=(Math.min(...e)+Math.max(...e))/2;return console.log(o,d),[o,d]});async function y(){const t="/map-sdk.json",{data:e}=await _e.get(`${t}?_t=${Date.now()}`);return e}function g(t){return new Promise((e,o)=>{if(window.AMap)return e(window.AMap);const d=document.createElement("script");d.src=`https://webapi.amap.com/maps?v=2.0&key=${t}&plugin=AMap.PolylineEditor`,d.defer=!0,d.onload=()=>window.AMap?e(window.AMap):o(new Error("AMapåŠ è½½å¤±è´¥")),d.onerror=()=>o(new Error("AMapè„šæœ¬åŠ è½½é”™è¯¯")),document.head.appendChild(d)})}const h=j({});function $(t,e){const o=e.lng-t.lng,d=e.lat-t.lat;return(Math.atan2(-d,o)*180/Math.PI-90+360)%360-175}function T(t,e,o,d){const m=document.createElement("div");return m.style.cssText=`
    width: 12px;
    height: 18px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 18px solid ${d};
    transform: translate(-50%, -50%) rotate(${o}deg);
    transform-origin: center center;
  `,new t.Marker({position:[e.lng,e.lat],content:m,offset:new t.Pixel(0,0)})}function a(t,e,o,d,m){const l=document.createElement("div");return l.className="custom-marker",l.style.transform="translate(calc(-50% + 4px),-120%)",l.innerHTML=`
    <div class="avatar-wrapper" style="border-color: ${d};box-shadow: 0 0 5px ${d}, 0 0 6px ${d};">
      <img src="${m||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"}" class="marker-avatar" />
    </div>
    <div class="marker-name" style="color: ${d};">${o}</div>
  `,new t.Marker({position:[e.lng,e.lat],content:l})}function C(){s.value&&s.value.clearMap(),h.value={}}function w(){!window.AMap||!s.value||Object.keys(h.value).forEach(t=>{const e=b.value[t];(h.value[t]||[]).forEach(d=>{e?d.show():d.hide()})})}function ee(t){if(!s.value)return;C();const e={};Object.entries(V.value).forEach(([d,m])=>{e[d]=m.map(l=>({lng:l.longitude,lat:l.latitude,address:l.address,dbtime:l.dbtime,proname:l.proname||"æœªæŒ‡å®šé¡¹ç›®",duration:l.duration||0,userimage:l.userimage,longitude:l.longitude,latitude:l.latitude}))}),Object.keys(e).forEach(d=>{const m=e[d],l=L.value[d];if(m.length===0)return;const F=[];if(m.length>1){const k=new t.Polyline({path:m.map(B=>[B.lng,B.lat]),strokeColor:l,strokeWeight:4,strokeOpacity:.7,strokeStyle:"solid",lineJoin:"round",lineCap:"round",isOutline:!0,outlineColor:"#FFFFFF",borderWeight:2});k.setMap(s.value),F.push(k)}m.forEach((k,B)=>{const R=new t.Marker({position:[k.longitude,k.latitude],content:'<div class="marker-dot"></div>',anchor:"center",offset:new t.Pixel(0,0)});R.setMap(s.value),F.push(R);const i=a(t,k,d,l,m[0].userimage);i.setMap(s.value),F.push(i),i.on("click",()=>{const q=`
          <div style="min-width:220px; background:#fff; padding:12px 14px; font-size:13px; color:#333; line-height:1.6">
            <div style="font-weight:bold; color:${l}; font-size:15px; margin-bottom:6px; border-bottom:1px solid #f0f0f0; padding-bottom:4px">
              ${d}
            </div>
            <div><b style="color:#555">åœ°ç‚¹ï¼š</b>${k.address}</div>
            <div><b style="color:#555">æ—¶é—´ï¼š</b>${k.dbtime}</div>
            <div><b style="color:#555">é¡¹ç›®ï¼š</b>${k.proname}</div>
            <div><b style="color:#555">ç»çº¬åº¦ï¼š</b><span style="font-size:12px;color:#666">${k.longitude}, ${k.latitude}</span></div>

          </div>
          <div style="margin-top:8px; text-align:right; font-size:12px; color:#999">ç¬¬ ${B+1} ä¸ªæ‰“å¡ç‚¹</div>
        `;n.setContent(q),n.setOffset(new t.Pixel(4,-60)),n.open(s.value,i.getPosition())}),i.on("dblclick",()=>{n.open(s.value,i.getPosition()),s.value.setCenter(i.getPosition()),s.value.setZoom(14)})});for(let k=1;k<m.length;k++){const B=m[k-1],R=m[k];if(ae(B,R))continue;const i={lng:(B.lng+R.lng)/2,lat:(B.lat+R.lat)/2},q=$(B,R),v=T(t,i,q,l);v.isArrow=!0,v.setMap(s.value),F.push(v)}Object.keys(e).length==1&&s.value.setFitView(F,!1,[60,60,60,60]),h.value[d]=F});const o=()=>{const m=s.value.getZoom()>=7,l=te(h.value,b.value);Object.values(l).forEach(F=>{F==null||F.forEach(k=>{k.isArrow&&(m?k.show():k.hide())})})};s.value.on("zoomend",o),o(),Object.keys(h.value).forEach(d=>{(h.value[d]||[]).forEach(l=>{l.isArrow||(b.value[d]?l.show():l.hide())})})}function te(t,e){const o={};for(const d in t)e[d]&&(o[d]=t[d]);return o}function ae(t,e,o=1e-7){return Math.abs(t.lng-e.lng)<o&&Math.abs(t.lat-e.lat)<o}async function se(){try{const t=await y(),e=await g(t.AMAP_SDK_KEY);s.value=new e.Map("amap-container",{viewMode:"2D",center:K.value,zoom:5,features:["bg","point"]}),X.themeScheme==="dark"&&s.value.setMapStyle("amap://styles/dark"),e.plugin(["AMap.Scale","AMap.ToolBar"],()=>{s.value.addControl(new e.Scale),s.value.addControl(new e.ToolBar)}),s.value.on("zoomend",()=>{const d=s.value.getZoom()>=12,m=te(h.value,b.value);Object.values(m).forEach(l=>{l.forEach(F=>{F.isArrow&&(d?F.show():F.hide())})})}),n=new e.InfoWindow({anchor:"bottom-center",closeWhenClickMap:!0}),ee(e)}catch(t){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",t)}}return pe(()=>J.trackData??[],t=>{console.log(t,"så¤„ç†æ•°æ®æˆ–æ¸²æŸ“å†…å®¹"),V.value=t,window.AMap&&s.value&&ee(window.AMap)},{immediate:!0,deep:!0}),ve(()=>{se()}),we(()=>{s.value&&s.value.destroy()}),(t,e)=>{const o=ke;return M(),I("div",Ke,[e[4]||(e[4]=r("div",{id:"amap-container",style:{width:"100%",height:"100%","border-radius":"8px"}},null,-1)),r("div",Ge,[r("div",Xe,[e[3]||(e[3]=r("div",{class:"legend-title"},"äººå‘˜è½¨è¿¹",-1)),r("div",Ye,[c(o,{type:"primary",onClick:u},{default:O(()=>e[0]||(e[0]=[x("å…¨æ˜¾")])),_:1,__:[0]}),c(o,{type:"primary",onClick:A},{default:O(()=>e[1]||(e[1]=[x("å…¨éš")])),_:1,__:[1]}),c(o,{type:"primary",onClick:D},{default:O(()=>e[2]||(e[2]=[x("åé€‰")])),_:1,__:[2]})])]),r("div",Qe,[(M(!0),I(fe,null,ye(L.value,(d,m)=>(M(),I("div",{key:m,class:Fe(["legend-item",{"legend-item-hidden":!b.value[m],"legend-item-solo":P.value===m}]),onClick:l=>Y(m),onContextmenu:Ce(l=>Q(m),["prevent"])},[r("div",{class:"legend-color",style:Me({backgroundColor:d})},[b.value[m]?N("",!0):(M(),I("span",tt,"ğŸ‘ï¸â€ğŸ—¨ï¸")),P.value===m?(M(),I("span",at,"â­")):N("",!0)],4),r("span",st,E(m),1),r("span",nt,E(b.value[m]?"éšè—":"æ˜¾ç¤º"),1)],42,et))),128))]),P.value?(M(),I("div",lt,[x(" ä»…æ˜¾ç¤º: "+E(P.value)+" ",1),r("button",{class:"cancel-solo-btn",onClick:W},"å–æ¶ˆ")])):N("",!0)])])}}}),rt=ue(ot,[["__scopeId","data-v-3d111cdc"]]),it={class:"map-wrapper",style:{height:"100%",position:"relative"}},dt=de({__name:"map",props:{trackData:{},username:{},projectName:{}},setup(H){const X=be(),s=j(null);let n=null;const J=H,V=[{id:25,pid:10,longitude:120.367925,latitude:30.300161,address:"æµ™æ±Ÿçœæ­å·å¸‚é’±å¡˜åŒºç™½æ¨è¡—é“ç•™å­¦ç”Ÿåˆ›ä¸š",dbtime:"2025-10-28 22:38:57",username:"auditor",daytime:"2025-10-28"},{id:25,pid:10,ctype:2,longitude:120.373554,latitude:30.288942,address:"ä¸‰èŠ±-é“è·¯åœè½¦ä½",dbtime:"2025-10-28 22:38:57",username:"auditor",daytime:"2025-10-28"}],_=j(J.trackData??V),b=["#FFA726","#6BCF7F"],P=ne(()=>{if(_.value.length===0)return[120.370086,30.305716];const y=_.value.map(h=>h.longitude),g=_.value.map(h=>h.latitude);return[(Math.min(...y)+Math.max(...y))/2,(Math.min(...g)+Math.max(...g))/2]});async function L(){const y="/map-sdk.json",{data:g}=await _e.get(`${y}?_t=${Date.now()}`);return g}function Y(y){return new Promise((g,h)=>{if(window.AMap)return g(window.AMap);const $=document.createElement("script");$.src=`https://webapi.amap.com/maps?v=2.0&key=${y}&plugin=AMap.PolylineEditor`,$.defer=!0,$.onload=()=>window.AMap?g(window.AMap):h(new Error("AMapåŠ è½½å¤±è´¥")),$.onerror=()=>h(new Error("AMapè„šæœ¬åŠ è½½é”™è¯¯")),document.head.appendChild($)})}const Q=j({});function W(y,g,h,$,T){const a=document.createElement("div");return a.className="custom-marker",a.style.transform="translate(calc(-50% + 4px), -110%)",a.innerHTML=`
    <div class="avatar-wrapper" style="border-color: ${$}; box-shadow: 0 0 10px ${$}, 0 0 20px ${$};">
      <img src="${T||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"}" class="marker-avatar" />
    </div>
    <div class="marker-name" style="color: ${$};">${h}</div>
  `,new y.Marker({position:[g.lng,g.lat],content:a})}function D(y,g){const h=document.createElement("div");return h.className="custom-marker",h.style.transform="translateX(-50%)",h.innerHTML='<div class="marker-dot"></div>',new y.Marker({position:[g.lng,g.lat],content:h})}function u(){s.value&&s.value.clearMap(),Q.value={}}function A(y){u();const g=_.value.map(a=>({lng:a.longitude,lat:a.latitude,address:a.address,dbtime:a.dbtime,proname:a.proname||"æœªæŒ‡å®šé¡¹ç›®",duration:a.duration||0,distanse:a.distanse.toFixed(2)||0,userimage:a.userimage,status:a.status,ctype:a.ctype||1})),h=b[0],$=[];if(g.length>1){const a=new y.Polyline({path:g.map(C=>[C.lng,C.lat]),strokeColor:h,strokeWeight:3,strokeOpacity:.7,strokeStyle:"solid",lineJoin:"round",lineCap:"round",isOutline:!0,outlineColor:"#FFFFFF",borderWeight:2});a.setMap(s.value),$.push(a)}g.forEach(a=>{let C;a.ctype!=2?(C=W(y,a,J.username,h,g[0].userimage),new y.Marker({position:[a.lng,a.lat],content:'<div class="marker-dot"></div>',anchor:"center"}).setMap(s.value)):C=D(y,a),C.setMap(s.value),$.push(C),C.on("click",()=>{n.open(s.value,C.getPosition());const w=`
        <div style="min-width:220px; background:#fff; padding:12px 14px; font-size:13px;">
          <div style="font-weight:bold; color:${h}; font-size:15px; margin-bottom:6px;">
            ${J.username}
          </div>
          <div><b>åœ°ç‚¹ï¼š</b>${a.address}</div>
          <div><b>æ—¶é—´ï¼š</b>${a.dbtime}</div>
          <div><b>é¡¹ç›®ï¼š</b>${J.projectName||"æœªæŒ‡å®šé¡¹ç›®"}</div>
          <div><b>ç±»å‹ï¼š</b>${a.ctype==0&&(a.status==0||a.status==1)?"ä¸Šç­æ‰“å¡":a.status==2?"å‡ºå‘":a.ctype==1&&(a.status==0||a.status==1)?"ä¸‹ç­æ‰“å¡":a.status==3?"åˆ°è¾¾":"ç³»ç»Ÿä¸ŠæŠ¥"}</div>
          <div><b>ç»çº¬åº¦ï¼š</b>${a.lng}, ${a.lat}</div>
          ${a.status==2||a.status==3?`<div><b>è¯¯å·®ï¼š</b>${a.distanse||0}ç±³</div>`:`<div><b>æ‰“å¡è¯¯å·®ï¼š</b>${a.distanse||0}ç±³</div>`}
          ${a.duration?`<div><b>å·¥æ—¶ï¼š</b>${a.duration} å°æ—¶</div>`:""}
        </div>
      `;n.setContent(w),a.ctype!=2?n.setOffset(new y.Pixel(4,-60)):n.setOffset(new y.Pixel(0,0))})});for(let a=1;a<g.length;a++){const C=g[a-1],w=g[a];if(Math.abs(C.lng-w.lng)<1e-7&&Math.abs(C.lat-w.lat)<1e-7)continue;const ee={lng:(C.lng+w.lng)/2,lat:(C.lat+w.lat)/2},te=Math.atan2(-(w.lat-C.lat),w.lng-C.lng)*180/Math.PI-90,ae=z(y,ee,te,"#1890ff");ae.setMap(s.value),$.push(ae)}s.value.setFitView($,!1,[60,60,60,60]),Q.value.single=$;const T=_.value[0]?{address:_.value[0].caddress,lng:_.value[0].clongitude,lat:_.value[0].clatitude}:null;if(T&&T.lng&&T.lat){const a=new y.Marker({position:[T.lng,T.lat],offset:new y.Pixel(-13,-30),icon:new y.Icon({size:new y.Size(26,30),imageSize:new y.Size(26,30),image:"https://cdn-icons-png.flaticon.com/512/684/684908.png"})}),C=new y.InfoWindow({isCustom:!1,anchor:"bottom-center",offset:new y.Pixel(0,-30),content:`
        <div style="font-size:14px; white-space:nowrap;">
          ğŸ“ é¡¹ç›®ä½ç½®ï¼š${T.address}
        </div>
      `});a.on("click",()=>{const w=a.getPosition();setTimeout(()=>{C.open(s.value,w)},0)}),s.value.add(a),g.forEach(w=>{if(w.ctype===0||w.ctype===1){const ee=new y.Polyline({path:[[w.lng,w.lat],[T.lng,T.lat]],strokeColor:w.status==1?"#FF4500":"#00BCD4",strokeOpacity:1,strokeWeight:3,strokeStyle:"dashed",showDir:!0});ee.setMap(s.value),$.push(ee);const te=(w.lng+T.lng)/2,ae=(w.lat+T.lat)/2,se=new y.Marker({position:[te,ae],content:`<div style="white-space: pre;padding:2px 4px; background:#fff; border:1px solid ${w.status==1?"#FF4500":"#00BCD4"}; border-radius:3px; font-size:12px;">${w.distanse} m</div>`,offset:new y.Pixel(0,-10)});se.setMap(s.value),$.push(se)}})}}function z(y,g,h,$){const T=document.createElement("div");T.style.cssText=`
    position: relative; width:60px; height:24px; display:flex; align-items:center;
    transform: translate(-50%, -50%) rotate(${h+90}deg); transform-origin:center center;
  `;for(let C=0;C<3;C++){const w=document.createElement("div");w.style.cssText=`
      position:absolute;width:0;height:0;
      border-top:8px solid transparent; border-bottom:8px solid transparent;
      border-left:12px solid ${$};
      opacity:${.3+C*.2};
      left:${C*8}px;
      animation: arrowFlow 1.5s infinite; animation-delay:${C*.2}s;
    `,T.appendChild(w)}const a=document.createElement("style");return a.textContent=`
    @keyframes arrowFlow {
      0%{opacity:0.3; transform:translateX(0px) scale(1);}
      50%{opacity:1; transform:translateX(4px) scale(1.1);}
      100%{opacity:0.3; transform:translateX(0px) scale(1);}
    }
  `,document.head.appendChild(a),new y.Marker({position:[g.lng,g.lat],content:T,offset:new y.Pixel(0,0)})}async function K(){try{const y=await L(),g=await Y(y.AMAP_SDK_KEY);s.value=new g.Map("amap-container",{viewMode:"2D",zoom:15,center:P.value,features:["bg","point"]}),X.themeScheme==="dark"&&s.value.setMapStyle("amap://styles/dark"),g.plugin(["AMap.Scale","AMap.ToolBar"],()=>{s.value.addControl(new g.Scale),s.value.addControl(new g.ToolBar)}),n=new g.InfoWindow({anchor:"bottom-center",closeWhenClickMap:!0}),A(g)}catch(y){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",y)}}return ve(()=>{_.value=J.trackData??V,K()}),we(()=>{s.value&&s.value.destroy()}),(y,g)=>(M(),I("div",it,g[0]||(g[0]=[r("div",{id:"amap-container",style:{width:"100%",height:"100%","border-radius":"8px"}},null,-1)])))}}),ut=ue(dt,[["__scopeId","data-v-0931ee16"]]),ct={class:"p-1 border-b border-gray-100 last:border-b-0 font-size-16px"},mt={class:"flex mb-3 items-center"},pt={class:"flex-col justify-center items-center mr-20px"},vt=["src"],ft={class:"font-bold mt-10px text-[#000] calendarName"},yt={class:"flex mb-1"},gt={class:"c-#4169e1 font-bold"},ht={class:"flex mb-1"},bt={class:"c-#4169e1 font-bold"},wt={class:"flex mb-1"},kt={class:"mr-20px"},_t={class:"c-#4169e1 font-bold"},xt={class:"c-#4169e1 font-bold"},Tt={class:"flex mb-1"},Ct={class:"c-#4169e1 font-bold"},Ft={key:0,class:"mx-20px flex items-center"},Mt={key:1,class:"mx-20px flex items-center"},$t={class:"flex items-center"},Dt={class:"flex mb-1 items-center"},Et={key:0},St={key:0},jt={class:"fontC"},At={class:"fontC"},Ot={class:"fontC"},zt={class:"fontC"},Pt={key:1},Bt={class:"fontC"},Nt={class:"fontC"},It={class:"fontC"},Rt=de({__name:"calendarModal",props:$e({lookdetail:{},creater:{},dayRecords:{}},{dialogVisible:{type:Boolean,default:!1},dialogVisibleModifiers:{}}),emits:["update:dialogVisible"],setup(H){const X=De(H,"dialogVisible"),s=H,n=j({pid:0,address:"",startTime:void 0,endTime:void 0,duration:0,status:0,dailyReport:0,username:"",daytime:"",projectName:"",userImage:"",ctype:0});function J(){const{dayRecords:D,lookdetail:u}=s,A=D.findIndex(z=>z.time===u.endTime||z.time===u.startTime);return A>0?D[A-1].endTime||D[A-1].startTime:null}function V(){const{dayRecords:D,lookdetail:u}=s,A=D.findIndex(z=>z.time===u.startTime||z.time===u.endTime);return A<D.length-1?D[A+1].startTime||D[A+1].endTime:null}const _=j([]),b=j([]),P=async()=>{var A;const{data:D,error:u}=await Ae({startTime:s.lookdetail.startTime?s.lookdetail.startTime:J()||s.lookdetail.daytime+" 00:00:00",endTime:s.lookdetail.endTime?s.lookdetail.endTime:V()||s.lookdetail.daytime+" 23:59:59",pid:s.lookdetail.pid,creater:s.creater});D&&(b.value=D.filter(z=>{const K=n.value.status;return(K===2||K===3?[2,3]:[0,1]).includes(z.status)}),_.value=b.value.filter(z=>z.ctype!==2),n.value.address=(A=D[0])==null?void 0:A.caddress)},L=j(!1),Y=D=>{L.value=D,D?_.value=b.value:_.value=b.value.filter(u=>u.ctype!==2)};pe(()=>X.value,async D=>{D&&(Object.assign(n.value,s.lookdetail),W.value="table",_.value=[],L.value=!1,P())});const Q=()=>{X.value=!1,setTimeout(()=>{n.value={pid:0,address:"",startTime:void 0,endTime:void 0,duration:0,status:0,dailyReport:0,username:"",daytime:"",projectName:"",userImage:"",ctype:0}},200)},W=j("table");return(D,u)=>{const A=oe,z=oe,K=ie,y=me,g=Ee,h=Se,$=xe,T=je;return M(),Z(T,{show:X.value,"onUpdate:show":u[2]||(u[2]=a=>X.value=a),class:"w-1000px",preset:"card",onClose:Q,"modal-animation-name":"el-fade"},{header:O(()=>u[3]||(u[3]=[x(" è¯¦æƒ… ")])),default:O(()=>[r("div",ct,[r("div",mt,[r("div",pt,[r("img",{class:"w-60px h-60px rounded-full shadow-sm",src:n.value.userImage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png"},null,8,vt),r("div",ft,E(n.value.username),1)]),r("div",null,[r("div",yt,[u[4]||(u[4]=r("span",{class:"mr-2"}," ğŸ—ï¸ é¡¹ç›®åç§°ï¼š ",-1)),r("span",gt,E(n.value.projectName||"æš‚æ— é¡¹ç›®"),1)]),r("div",ht,[u[5]||(u[5]=r("span",{style:{"white-space":"nowrap"}},"ğŸ“ é¡¹ç›®åœ°å€ï¼š",-1)),r("span",bt,E(n.value.address),1)]),r("div",wt,[r("div",kt,[r("span",null,"ğŸ“… "+E(n.value.status==2||n.value.status==3?"å‡ºå‘":"ä¸Šç­")+"æ‰“å¡æ—¶é—´ï¼š",1),r("span",_t,E(n.value.startTime||"æ— "),1)]),r("div",null,[r("span",null,"ğŸ“… "+E(n.value.status==2||n.value.status==3?"åˆ°è¾¾":"ä¸‹ç­")+"æ‰“å¡æ—¶é—´ï¼š",1),r("span",xt,E(n.value.endTime||"æ— "),1)])]),r("div",Tt,[r("div",null,[u[6]||(u[6]=r("span",null,"â³ å·¥æ—¶ï¼š",-1)),r("span",Ct,E(n.value.duration||0)+"å°æ—¶",1)]),n.value.status==0||n.value.status==1?(M(),I("div",Ft,[u[10]||(u[10]=r("span",null,"ğŸ”” æ‰“å¡çŠ¶æ€ï¼š",-1)),r("span",null,[n.value.status==1?(M(),Z(A,{key:0,type:"error",size:"small"},{default:O(()=>u[7]||(u[7]=[r("span",{class:"mr-1"},null,-1),x("å¼‚å¸¸ ")])),_:1,__:[7]})):N("",!0),n.value.status==0?(M(),Z(A,{key:1,type:"success",size:"small"},{default:O(()=>u[8]||(u[8]=[r("span",{class:"mr-1"},null,-1),x("æ­£å¸¸ ")])),_:1,__:[8]})):N("",!0),_.value.some(a=>a.status==2||a.status==3)?(M(),Z(A,{key:2,class:"ml-1",color:{color:"#a43cf9",textColor:"#fff",borderColor:"#a43cf9"},size:"small"},{default:O(()=>u[9]||(u[9]=[r("span",null,null,-1),x("è¡Œç¨‹ ")])),_:1,__:[9]})):N("",!0)])])):N("",!0),n.value.status==2||n.value.status==3?(M(),I("div",Mt,[c(A,{color:{color:"#a43cf9",textColor:"#fff",borderColor:"#a43cf9"},size:"small"},{default:O(()=>u[11]||(u[11]=[x(" è¡Œç¨‹ ")])),_:1,__:[11]})])):N("",!0),r("div",$t,[u[12]||(u[12]=r("span",null,"ğŸ“ æ—¥æŠ¥ï¼š",-1)),r("span",null,[c(z,{size:"small",type:n.value.dailyReport==1?"success":"error"},{default:O(()=>[x(E(n.value.dailyReport==1?"å·²æäº¤":"æœªæäº¤"),1)]),_:1},8,["type"])])])])])]),r("div",Dt,[u[13]||(u[13]=r("div",{class:"mr-15px"},"å†å²è½¨è¿¹",-1)),c(y,{size:"small",value:W.value,"onUpdate:value":u[0]||(u[0]=a=>W.value=a),name:"radiobuttongroup1"},{default:O(()=>[c(K,{value:"table",label:"è¡¨æ ¼"}),c(K,{value:"map",label:"åœ°å›¾"})]),_:1},8,["value"]),c(g,{checked:L.value,"onUpdate:checked":u[1]||(u[1]=a=>L.value=a),onChange:Y,label:"æ˜¾ç¤ºè¯¦ç»†è½¨è¿¹",size:"small",class:"ml-20px"},null,8,["checked"])]),W.value=="table"?(M(),I("div",Et,[c($,{style:{height:"600px"},trigger:"hover"},{default:O(()=>[(M(!0),I(fe,null,ye(_.value,a=>(M(),I("div",{class:"tableItem",key:a.id},[a.status==0||a.status==1?(M(),I("div",St,[r("div",null,[u[14]||(u[14]=x("æ‰“å¡ç±»å‹ï¼š")),r("span",jt,E(a.ctype==0?"ä¸Šç­æ‰“å¡":a.ctype==1?"ä¸‹ç­æ‰“å¡":"ç³»ç»Ÿä¸ŠæŠ¥"),1)]),r("div",null,[u[15]||(u[15]=x("æ‰“å¡çŠ¶æ€ï¼š")),c(A,{type:a.status==1?"error":"success"},{default:O(()=>[r("div",null,E(a.status==0?"æ­£å¸¸":"å¼‚å¸¸"),1)]),_:2},1032,["type"])]),r("div",null,[u[16]||(u[16]=x("åœ°å€ï¼š ")),r("span",At,E(a.address),1)]),r("div",null,[u[17]||(u[17]=x("æ‰“å¡æ—¶é—´ï¼š")),r("span",Ot,E(a.dbtime),1)]),r("div",null,[u[18]||(u[18]=x("æ‰“å¡è¯¯å·®å€¼ï¼š")),r("span",zt,E(a.distanse?a.distanse.toFixed(2)+"ç±³":"æ— "),1)])])):N("",!0),a.status==2||a.status==3?(M(),I("div",Pt,[r("div",null,[u[19]||(u[19]=x("ç±»å‹ï¼š")),c(A,{type:"info"},{default:O(()=>[r("div",null,E(a.status==2?"å‡ºå‘":"åˆ°è¾¾"),1)]),_:2},1024)]),r("div",null,[x(E(a.status==2?"å‡ºå‘":"åˆ°è¾¾")+"åœ°å€ï¼š ",1),r("span",Bt,E(a.address),1)]),r("div",null,[x(E(a.status==2?"å‡ºå‘":"åˆ°è¾¾")+"æ—¶é—´ï¼š",1),r("span",Nt,E(a.dbtime),1)]),r("div",null,[x(E(a.status==2?"å‡ºå‘":"åˆ°è¾¾")+"è¯¯å·®å€¼ï¼š",1),r("span",It,E(a.distanse?a.distanse.toFixed(2)+"ç±³":"æ— "),1)])])):N("",!0)]))),128)),_.value.length==0?(M(),Z(h,{key:0,description:"æš‚æ— æ•°æ®"})):N("",!0)]),_:1})])):N("",!0),W.value=="map"?(M(),Z(ut,{key:L.value,trackData:_.value,projectName:n.value.projectName,username:s.lookdetail.username,class:"map"},null,8,["trackData","projectName","username"])):N("",!0)])]),_:1},8,["show"])}}}),Ut=ue(Rt,[["__scopeId","data-v-fb64850f"]]),Vt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Lt(H){return typeof H=="function"||Object.prototype.toString.call(H)==="[object Object]"&&!He(H)}const Wt=de({name:"reportmanagement_calendar",__name:"index",setup(H){const X=Oe(),s=j("week"),n=j({dayTime:String(re(0,null)),monthTime:String(re(3,null)),weekTime:he(),startTime:null,endTime:null,dates:null,creater:null}),J=j([{label:"æ—¥",value:"day"},{label:"å‘¨",value:"week"},{label:"æœˆ",value:"month"}]),V=j("table"),_=j({}),b=j({}),P=ne(()=>Object.keys(_.value||{}).map(t=>{var e,o;return{key:t,name:t,userimage:(o=(e=_.value[t])==null?void 0:e[0])==null?void 0:o.userimage}})),L=ne(()=>{const t=[{title:"ç”¨æˆ·å",key:"name",width:120,align:"center",fixed:"left",render(o){return c("div",{class:"text-blue-600 flex-col items-center font-medium"},[c(Be,{width:"60",height:"60","preview-disabled":!0,src:o.userimage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png",class:"rounded-md object-cover"},null),c("span",null,[o.name])])}}];let e=[];switch(s.value){case"week":n.value.startTime&&n.value.endTime&&(e=Pe(n.value.startTime,n.value.endTime).map(d=>Y(d)));break;case"month":n.value.monthTime&&(e=ze(n.value.monthTime).map(d=>Y(d)));break;case"day":default:n.value.dayTime&&(e=[Y(n.value.dayTime)]);break}return[...t,...e]}),Y=t=>({title:Q(t),key:t,width:340,align:"center",render:e=>W(e.name,t)}),Q=t=>{const e=re(0,new Date),o=new Date(t),d=o.getMonth()+1,m=o.getDate(),l=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][o.getDay()];return c("div",{class:"py-8px",style:"background-color:"+(t==e&&s.value!="day"?"rgba(24, 144, 255,.15)":"")},[`${d}/${m} å‘¨${l}`])},W=(t,e)=>{let o;const d=re(0,new Date),m=_.value[t]||[];console.log(m,"userRecords");const l=m.filter(i=>i.daytime===e);if(console.log(l,"dayRecords"),l.length===0)return c("div",{class:"text-gray-400 text-sm"},[x("æ— è®°å½•")]);const F=l.every(i=>i.dailyReport==1),k=l.some(i=>i.status==1),B=l.some(i=>i.status==0||i.status==1),R=l.some(i=>i.status==2||i.status==3);return c("div",{class:"text-left space-y-1 bg py-8px",style:"background-color:"+(e==d&&s.value!="day"?"rgba(24, 144, 255,.15)":"")},[c("div",{class:"flex justify-between px-8px"},[c("div",null,[x("æ‰“å¡çŠ¶æ€ï¼š"),B&&c(oe,{size:"small",type:k?"error":"success"},{default:()=>[k?"å¼‚å¸¸":"æ­£å¸¸"]}),R&&c(oe,{size:"small",color:{color:"#a43cf9",textColor:"#fff",borderColor:"#a43cf9"},class:"ml-3px"},{default:()=>[x("è¡Œç¨‹")]})]),c(oe,{size:"small",type:F?"success":"error"},{default:()=>[F?"æ—¥æŠ¥å·²æäº¤":"æ—¥æŠ¥æœªæäº¤"]})]),c(xe,{style:"max-height: 250px;",trigger:"none"},Lt(o=l.map((i,q)=>c("div",{key:q,class:"tableItem p-1 border-b border-gray-100 last:border-b-0",onClick:()=>K(i,t,l)},[c("div",{class:"flex justify-between items-center"},[c("div",null,[x("è°ƒè¯•äººï¼š"),c("span",null,[i==null?void 0:i.username])]),c("div",null,[x("å·¥æ—¶ï¼š"),c("span",null,[(i==null?void 0:i.duration)||0,x("å°æ—¶")])])]),c("div",null,[x("é¡¹ç›®åç§°ï¼š "),c("span",null,[(i==null?void 0:i.projectName)||"æš‚æ— é¡¹ç›®"]),x(" ")]),c("div",null,[i.status==2||i.status==3?"å‡ºå‘åœ°å€ï¼š":"ä¸Šç­æ‰“å¡åœ°å€ï¼š",x(" "),c("span",null,[i.nowaddress?i.nowaddress:"æ— "])]),c("div",null,[i.status==2||i.status==3?"å‡ºå‘æ—¶é—´ï¼š":"ä¸Šç­æ‰“å¡æ—¶é—´ï¼š",c("span",null,[i.startTime?i.startTime:"æ— "])]),c("div",null,[i.status==2||i.status==3?"å‡ºå‘æ‰“å¡è¯¯å·®å€¼ï¼š":"ä¸Šç­æ‰“å¡è¯¯å·®å€¼ï¼š",c("span",null,[i.nowdistanse?i.nowdistanse.toFixed(2)+"ç±³":"æ— "])]),c("div",null,[i.status==2||i.status==3?"åˆ°è¾¾åœ°å€ï¼š":"ä¸‹ç­æ‰“å¡åœ°å€ï¼š",c("span",null,[i.nextaddress?i.nextaddress:"æ— "])]),c("div",null,[i.status==2||i.status==3?"åˆ°è¾¾æ—¶é—´ï¼š":"ä¸‹ç­æ‰“å¡æ—¶é—´ï¼š",c("span",null,[i.endTime||"æ— "])]),c("div",null,[i.status==2||i.status==3?"åˆ°è¾¾æ‰“å¡è¯¯å·®å€¼ï¼š":"ä¸‹ç­æ‰“å¡è¯¯å·®å€¼ï¼š",c("span",null,[i.nextdistanse?i.nextdistanse.toFixed(2)+"ç±³":"æ— "])])])))?o:{default:()=>[o]})])},D=j(!1),u=j(),A=j([]),z=j(),K=async(t,e,o)=>{z.value=t,o.value=o,console.log(o.value,"dayRecords.value"),u.value=a.data.find(d=>d.username==e).id,D.value=!0},y=t=>{const e=t.match(/^(\d{4})-(\d{1,2})å‘¨$/);if(!e)return null;const o=Number(e[1]),d=Number(e[2]),m=new Date(o,0,1+(d-1)*7),l=m.getDay(),F=new Date(m);l<=4?F.setDate(m.getDate()-m.getDay()+1):F.setDate(m.getDate()+8-m.getDay());const k=new Date(F);k.setDate(F.getDate()+6);const B=R=>{const i=R.getFullYear(),q=String(R.getMonth()+1).padStart(2,"0"),v=String(R.getDate()).padStart(2,"0");return`${i}-${q}-${v}`};return{start:B(F),end:B(k)}},g=t=>{_.value={},s.value=t,$()},h=t=>{$(t),T()},$=t=>{switch(s.value){case"week":if(t){const e=y(t);e&&(n.value.startTime=e.start,n.value.endTime=e.end)}break;case"month":n.value.dates=t||n.value.monthTime;break;case"day":default:n.value.dates=t||n.value.dayTime;break}},T=async()=>{var t;try{const e={};n.value.creater&&(e.creater=n.value.creater),s.value==="week"?(e.startTime=n.value.startTime+" 00:00:00",e.endTime=n.value.endTime+" 23:59:59"):s.value==="month"?e.dates=n.value.monthTime:e.dates=n.value.dayTime;const{data:o,error:d}=await We(e);if(!d){if(JSON.stringify(o)=="{}")return _.value={},b.value={},(t=window.$message)==null?void 0:t.warning("æ— æ•°æ®");_.value=se(o),console.log(_.value,"userData.value"),b.value=o}}catch(e){console.error("æœç´¢è€ƒå‹¤æŠ¥è¡¨å¤±è´¥:",e)}},{pageData:a,getData:C,nextPage:w}=Je(Ze),ee=async t=>{const e=t.currentTarget,o=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&a.data.length<a.total&&(await w(),await qe(),setTimeout(()=>{e.scrollTop=o}))},te=j(1),ae=async t=>{n.value.creater=t,t||setTimeout(()=>{te.value++},500),T()};pe([s],()=>{if(s.value=="week"&&n.value.weekTime){const t=y(n.value.weekTime);t&&(n.value.startTime=t.start,n.value.endTime=t.end),T()}else(s.value=="month"&&n.value.monthTime||s.value=="day"&&n.value.dayTime)&&T()},{immediate:!0}),ve(()=>{n.value.weekTime=he(),C({usertypes:"2,3"}),T()});const se=t=>{const e={};for(const o in t){const d=t[o],m=new Map;d.forEach(v=>{const S=`${v.pid}_${v.ctype}_${v.status}_${v.dbtime}_${v.daytime}`;m.has(S)||m.set(S,v)});const F=Array.from(m.values()).sort((v,S)=>v.daytime===S.daytime?v.dbtime.localeCompare(S.dbtime):v.daytime.localeCompare(S.daytime)),k=[],B=F.filter(v=>v.status===0||v.status===1),R=F.filter(v=>v.status===2||v.status===3),i={};B.forEach(v=>{i[v.pid]||(i[v.pid]=[]),i[v.pid].push(v)}),Object.values(i).forEach(v=>{v.sort((S,f)=>S.daytime===f.daytime?S.dbtime.localeCompare(f.dbtime):S.daytime.localeCompare(f.daytime));for(let S=0;S<v.length;S++){const f=v[S],p=v[S+1];f.ctype===0&&p&&p.ctype===1&&f.daytime===p.daytime?(k.push({nowaddress:f.address,nextaddress:p.address,startTime:f.dbtime,endTime:p.dbtime,status:p.status===1||f.status===1?1:p.status,duration:p.duration||0,dailyReport:p.dailyReport,username:f.username,daytime:f.daytime,projectName:f.proname,userImage:f.userimage,ctype:p.ctype,pid:f.pid,nowdistanse:f.distanse,nextdistanse:p.distanse}),S++):k.push({nowaddress:f.ctype===0?f.address:"",nextaddress:f.ctype===1?f.address:"",startTime:f.ctype===0?f.dbtime:"",endTime:f.ctype===1?f.dbtime:"",duration:f.duration||0,status:f.status,dailyReport:f.dailyReport,username:f.username,daytime:f.daytime,projectName:f.proname,userImage:f.userimage,ctype:f.ctype,pid:f.pid,nowdistanse:f.ctype===0?f.distanse:"",nextdistanse:f.ctype===1?f.distanse:""})}});const q={};R.forEach(v=>{q[v.pid]||(q[v.pid]=[]),q[v.pid].push(v)}),Object.values(q).forEach(v=>{v.sort((f,p)=>f.dbtime.localeCompare(p.dbtime));const S=new Set;for(let f=0;f<v.length;f++){if(S.has(f))continue;const p=v[f];let ge=!1;for(let le=f+1;le<v.length;le++){if(S.has(le))continue;const G=v[le];if(p.status===2&&G.status===3){k.push({nowaddress:p.status===2?p.address:G.address,nextaddress:p.status===3?p.address:G.address,startTime:p.status===2?p.dbtime:G.dbtime,endTime:p.status===3?p.dbtime:G.dbtime,status:p.status,nextStatus:G.status,duration:G.duration||0,dailyReport:G.dailyReport,username:p.username,daytime:p.daytime,projectName:p.proname,userImage:p.userimage,pid:p.pid,ctype:G.ctype,nowdistanse:p.status===2?p.distanse:G.distanse,nextdistanse:p.status===3?p.distanse:G.distanse}),S.add(f),S.add(le),ge=!0;break}}ge||k.push({nowaddress:p.status===2?p.address:"",nextaddress:p.status===3?p.address:"",startTime:p.status===2?p.dbtime:"",endTime:p.status===3?p.dbtime:"",duration:p.duration||0,status:p.status,dailyReport:p.dailyReport,username:p.username,daytime:p.daytime,projectName:p.proname,userImage:p.userimage,pid:p.pid,nowdistanse:p.status===2?p.distanse:"",nextdistanse:p.status===3?p.distanse:""})}}),e[o]=k.sort((v,S)=>(v.startTime||v.endTime).localeCompare(S.startTime||S.endTime))}return e};return(t,e)=>{const o=Ue,d=Re,m=Te;return M(),I("div",Vt,[c(U(Le),{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper h-full"},{header:O(()=>[c(U(Ie),{align:"center"},{default:O(()=>[e[7]||(e[7]=r("div",{class:"font-semibold"},"è€ƒå‹¤æŠ¥è¡¨",-1)),c(d,{label:"ç”¨æˆ·",path:"creater","label-placement":"left","show-feedback":!1},{default:O(()=>[c(o,{clearable:"",filterable:"",value:n.value.creater,"onUpdate:value":[e[0]||(e[0]=l=>n.value.creater=l),ae],placeholder:"è¯·é€‰æ‹©","label-field":"username",size:"small","value-field":"id",options:U(a).data,onScroll:ee},null,8,["value","options"])]),_:1}),c(U(me),{value:s.value,"onUpdate:value":[e[1]||(e[1]=l=>s.value=l),g],size:"small"},{default:O(()=>[(M(!0),I(fe,null,ye(J.value,l=>(M(),Z(U(ie),{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["value"]),s.value==="day"?(M(),Z(U(ce),{key:0,size:"small","formatted-value":n.value.dayTime,"onUpdate:formattedValue":[e[2]||(e[2]=l=>n.value.dayTime=l),h],type:"date","value-format":"yyyy-MM-dd",style:{width:"140px"}},null,8,["formatted-value"])):N("",!0),s.value==="week"?(M(),Z(U(ce),{key:1,size:"small","formatted-value":n.value.weekTime,"onUpdate:formattedValue":[e[3]||(e[3]=l=>n.value.weekTime=l),h],type:"week",style:{width:"140px"}},null,8,["formatted-value"])):N("",!0),s.value==="month"?(M(),Z(U(ce),{key:2,size:"small","formatted-value":n.value.monthTime,"onUpdate:formattedValue":[e[4]||(e[4]=l=>n.value.monthTime=l),h],type:"month","value-format":"yyyy-MM",style:{width:"140px"}},null,8,["formatted-value"])):N("",!0),c(U(ke),{type:"primary",onClick:T,size:"small",class:"w-full sm:w-auto"},{icon:O(()=>[c(m,{class:"text-icon"})]),default:O(()=>[x(" "+E(U(Ve)("common.search")),1)]),_:1}),c(U(me),{size:"small",value:V.value,"onUpdate:value":e[5]||(e[5]=l=>V.value=l),name:"radiobuttongroup1"},{default:O(()=>[c(U(ie),{value:"table",label:"è¡¨æ ¼"}),c(U(ie),{value:"map",label:"å†å²è½¨è¿¹"})]),_:1},8,["value"])]),_:1,__:[7]})]),default:O(()=>[c(Ut,{"dialog-visible":D.value,"onUpdate:dialogVisible":e[6]||(e[6]=l=>D.value=l),lookdetail:z.value,creater:u.value,dayRecords:A.value},null,8,["dialog-visible","lookdetail","creater","dayRecords"]),V.value=="table"?(M(),Z(U(Ne),{key:0,"bottom-bordered":"",bordered:"",columns:L.value,data:P.value,size:"small","flex-height":!U(X).isMobile,"scroll-x":L.value.reduce((l,F)=>l+F.width,0),remote:"","row-key":l=>l.key,class:"h-full",striped:""},null,8,["columns","data","flex-height","scroll-x","row-key"])):(M(),Z(rt,{trackData:b.value,key:te.value},null,8,["trackData"]))]),_:1})])}}}),Gt=ue(Wt,[["__scopeId","data-v-1fda3b87"]]);export{Gt as default};
