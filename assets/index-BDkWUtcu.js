import{a as Q,_ as W}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Bbt3vQ34.js";import{o as l,e as _,f as k,d as J,a3 as X,g as n,av as Y,j as m,A as ee,D as te,w as a,t as C,G as M,E as V,c as w,H as ae,h as y,i as s,B as z,ah as oe,K as ne,N as se,O as le,ad as ie,aj as ce,P as re,Q as ue,R as de}from"./index-DCJMGCjU.js";import{D as _e,E as pe,F as me,G as he}from"./basic-config-Dm40MOce.js";import{u as fe}from"./table-BbJ_mIRf.js";import{_ as ge}from"./Progress-CyaFrR92.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-BAHRKZjE.js";import"./setting-outlined-DW7BnljB.js";import"./export-Ci30NtKq.js";import"./refresh-BmcUVo7m.js";import"./round-delete-BENxW-Td.js";import"./round-plus-Bqusqz5E.js";import"./Popconfirm-hoFMQo4c.js";const ve={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},we=k("path",{fill:"currentColor",d:"M16 18v2H8v-2zM11 7.99V16h2V7.99h3L12 4L8 7.99z"},null,-1),ye=[we];function ke(c,f){return l(),_("svg",ve,[...ye])}const be={name:"ic-twotone-upgrade",render:ke},xe={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},$e=k("path",{fill:"currentColor",d:"M11 17h2v-4.2l1.6 1.6L16 13l-4-4l-4 4l1.4 1.4l1.6-1.6V17Zm-9 3V4h8l2 2h10v14H2Zm2-2h16V8h-8.825l-2-2H4v12Zm0 0V6v12Z"},null,-1),Ce=[$e];function Ve(c,f){return l(),_("svg",xe,[...Ce])}const ze={name:"material-symbols-drive-folder-upload-outline-sharp",render:Ve},Ne={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},De=k("path",{fill:"currentColor",d:"m12 13.4l-2.917 2.925q-.277.275-.704.275t-.704-.275q-.275-.275-.275-.7t.275-.7L10.6 12L7.675 9.108Q7.4 8.831 7.4 8.404t.275-.704q.275-.275.7-.275t.7.275L12 10.625L14.892 7.7q.277-.275.704-.275t.704.275q.3.3.3.713t-.3.687L13.375 12l2.925 2.917q.275.277.275.704t-.275.704q-.3.3-.712.3t-.688-.3z"},null,-1),Re=[De];function qe(c,f){return l(),_("svg",Ne,[...Re])}const Be={name:"material-symbols-close-small-rounded",render:qe},Le=c=>(re("data-v-6a620413"),c=c(),ue(),c),Me={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Pe={key:0,class:"version"},Se={key:0,style:{width:"300px"}},Fe=Le(()=>k("div",null,"升级记录",-1)),Ie=J({name:"basicconfig_upgrade-management",__name:"index",setup(c){const f=X(),{columns:P,columnChecks:b,data:S,getData:F,loading:N,mobilePagination:I,searchParams:Te,resetSearchParams:Ue}=fe({apiFn:_e,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"dbtime",title:"升级时间",align:"center"},{key:"upgradecon",title:"升级内容",align:"center"},{key:"prever",title:"升级前版本",align:"center"},{key:"version",title:"升级后版本",align:"center"},{key:"status",title:"状态",align:"center",render:e=>(e.status===null&&(e.status=0),n(Y,{type:{0:"error",1:"success"}[e.status]},{default:()=>[e.status==1?"成功":"失败"]}))}]}),g=m(""),D=async()=>{const{data:e,error:o}=await pe();o||(typeof e=="object"?g.value=e.data:g.value=e)},T=async()=>{var t;const{data:e,error:o}=await me({uid:u.value[0]});o||(t=window.$message)==null||t.success(e)},i=m(""),p=m(null),U=({file:e,data:o,headers:t,withCredentials:d,action:v,onFinish:q,onError:B,onProgress:x})=>{console.log(e),p.value=e.file,i.value=e.name},R=m(0),r=m(!1),H=e=>{r.value=!0,R.value=e},u=m([]),E=(e,o,t)=>{var d;t.action==="check"?u.value=[(d=t.row)==null?void 0:d.uid]:u.value=[]},G=async()=>{var e,o;if(!i.value.endsWith(".tar.gz"))return(e=window.$message)==null?void 0:e.error("请上传tar.gz文件");try{const t=new FormData;t.append("fname",i.value),t.append("fi",p.value);const{data:d,error:v}=await he(t,H);if(v)return;(o=window.$message)==null||o.success(d),r.value=!1,i.value="",p.value=null,D()}catch(t){console.error(t),r.value=!1,i.value="",p.value=null}finally{r.value=!1,i.value="",p.value=null}},K=e=>{e.stopPropagation(),i.value="",p.value=null};return ee(()=>{D()}),(e,o)=>{const t=ne,d=Be,v=ze,q=Q,B=be,x=se,Z=ge,j=le,L=ie,A=W,O=ce,$=te("no-auth");return l(),_("div",Me,[n(L,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[n(j,{ref:"formRef",inline:"","label-placement":"left","label-width":100,"show-feedback":!1},{default:a(()=>[n(t,null,{default:a(()=>[g.value?(l(),_("span",Pe,"当前版本号："+C(g.value),1)):M("",!0)]),_:1}),V((l(),w(t,{label:"升级包选择",path:"fi"},{default:a(()=>[n(q,{action:"","custom-request":U,"show-file-list":!1,accept:".gz"},{default:a(()=>[i.value?(l(),_("div",{key:0,onClick:o[0]||(o[0]=ae(()=>{},["stop"]))},[y(C(i.value)+" ",1),n(d,{class:"font-size-30px cursor-pointer",onClick:K})])):(l(),w(s(z),{key:1},{icon:a(()=>[n(v,{class:"text-icon"})]),default:a(()=>[y(" 上传文件")]),_:1}))]),_:1})]),_:1})),[[$,"sys.upgrade.upload"]]),n(t,null,{default:a(()=>[n(x,{class:"w-full"},{default:a(()=>[V((l(),w(s(z),{onClick:G,loading:r.value,disabled:!i.value,type:"primary",ghost:""},{icon:a(()=>[n(B,{class:"text-icon"})]),default:a(()=>[y(" "+C(r.value?"正在升级中":"升级"),1)]),_:1},8,["loading","disabled"])),[[$,"sys.upgrade.upload"]]),V((l(),w(s(z),{onClick:T,type:"primary",ghost:"",disabled:u.value.length==0},{default:a(()=>[y(" 回退版本 ")]),_:1},8,["disabled"])),[[$,"sys.upgrade.fallback.version"]])]),_:1})]),_:1}),n(t,null,{default:a(()=>[r.value?(l(),_("div",Se,[n(Z,{"indicator-placement":"inside",type:"line",percentage:R.value},null,8,["percentage"])])):M("",!0)]),_:1})]),_:1},512)]),_:1}),n(L,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[n(x,{align:"center"},{default:a(()=>[Fe]),_:1})]),"header-extra":a(()=>[n(A,{columns:s(b),"onUpdate:columns":o[1]||(o[1]=h=>oe(b)?b.value=h:null),"disabled-delete":u.value.length===0,loading:s(N),onRefresh:s(F)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:a(()=>[n(O,{"checked-row-keys":u.value,"onUpdate:checkedRowKeys":o[2]||(o[2]=h=>u.value=h),columns:s(P),data:s(S),size:"small","flex-height":!s(f).isMobile,"scroll-x":962,loading:s(N),remote:"","row-key":h=>h.uid,pagination:s(I),class:"sm:h-full",onUpdateCheckedRowKeys:E},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1})])}}}),Ye=de(Ie,[["__scopeId","data-v-6a620413"]]);export{Ye as default};
