import{Q as _e,p as fe,_ as ge,a as we}from"./pako.esm-hk4lqFZP.js";import{_ as he}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CM2xdBkx.js";import{_ as ye}from"./round-search-DMPrjItM.js";import{d as Q,ab as G,a0 as ve,k as d,x as W,aj as be,o as b,e as z,_ as Z,eE as xe,aw as w,g as a,$ as H,B as U,w as n,h as R,i as l,af as ke,t as V,c as K,D as j,aI as F,f as X,aJ as De,eg as Te,aK as Ce,P as Se,c8 as Pe,aL as Le,c9 as Ne,a6 as Ie,L as $e,S as Be,aH as Ue,R as Re,T as Ve}from"./index-CT5lpOF1.js";import{u as je,a as ze}from"./table-C535fDDg.js";import{u as Ae,L as J}from"./echarts-CJ33amVt.js";import{_ as Me}from"./lodash-BxmCOPnE.js";import{_ as Oe}from"./DatePicker-CivW7jaV.js";const qe=Q({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(r){const f=r;G(()=>f.data,async t=>{S(),P()});const h=ve(),u=d(null),{domRef:y,updateOptions:x,showLoading:S,hideLoading:m}=Ae(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(t){return(t+""!="undefined"?t:"--")+"MW"}},legend:{data:["预测功率","干预后预测功率"]},toolbox:{show:!0,feature:{saveAsImage:{show:!0,name:"人工干预预测功率"},magicType:{show:!0,type:["line","bar"]}}},grid:{left:"5%",right:"8%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} MW"}},series:[{color:"#e90445",name:"预测功率",type:"line",emphasis:{focus:"series"},areaStyle:{color:new J(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.8)",shadowBlur:20},data:[],connectNulls:!0},{color:"#addb0b",name:"干预后预测功率",type:"line",emphasis:{focus:"series"},areaStyle:{color:new J(0,0,0,1,[{offset:0,color:"rgba(173, 219, 11,0.3)"},{offset:1,color:"rgba(173, 219, 11,0)"}],!1),shadowColor:"rgba(173, 219, 11,0.8)",shadowBlur:20},data:[],connectNulls:!0}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function P(){await new Promise(t=>{setTimeout(t,1e3)}),x(t=>(t.xAxis.data=f.data.map(i=>i.dbtime),t.series[0].data=f.data.map(i=>i.prePower),t.series[1].data=f.data.map(i=>i.manuPower),t))}function A(){x((t,i)=>{const k=i();return t.legend.data=k.legend.data,t.series[0].name=k.series[0].name,t.series[1].name=k.series[1].name,t})}async function M(){P()}return G(()=>h.locale,()=>{A()}),M(),W(()=>{u.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),be(()=>{u.value!==null&&(clearInterval(u.value),u.value=null)}),(t,i)=>(b(),z("div",{ref_key:"domRef",ref:y,class:"h-600px overflow-hidden"},null,512))}}),Ee=Z(qe,[["__scopeId","data-v-f7da5ef4"]]),Ge=r=>(Re("data-v-76b2b6f6"),r=r(),Ve(),r),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ke={key:0},Fe=Ge(()=>X("span",null,"二维码",-1));function Je(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!De(r)}const Qe=Q({name:"stationmanagement_predictionsettingslist",__name:"index",setup(r){const{columns:f,columnChecks:h,data:u,getData:y,loading:x,mobilePagination:S,searchParams:m,resetSearchParams:P}=je({apiFn:xe,apiParams:{page:1,pageSize:20,limit:20,type:0,startTime:w(1,Date.now()-864e5)||null,endTime:w(1,Date.now())||null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{key:"optime",title:"操作时间",align:"center",width:100},{key:"matime",title:"干预数据日期",align:"center",width:140},{key:"operate",title:"",align:"center",width:100,render(o){let e;return a(U,{ghost:!0,size:"small",onClick:()=>Y(o)},Je(e=H("common.look"))?e:{default:()=>[e]})}}]}),{drawerVisible:A,operateType:M,editingData:t,handleAdd:i,handleEdit:k,checkedRowKeys:L,onBatchDeleted:We,onDeleted:Ze}=ze(u,y),N=d(!1),I=d(),Y=o=>{N.value=!0,I.value=o},O=d([Date.now()-864e5*1,Date.now()]);async function ee(o,e){m.startTime=w(1,e[0]),m.endTime=w(1,e[1])}const ae={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()]},p=d("0"),te=()=>{p.value=="0"?$():p.value=="1"&&y()},ne=Me.debounce(te,1e3,{leading:!0,trailing:!1}),v=d([]),$=async()=>{const{data:o,error:e}=await Te({startTime:m.startTime,endTime:m.endTime});e||(v.value=o.sort((c,g)=>new Date(c.dbtime).getTime()-new Date(g.dbtime).getTime()))},oe=o=>{o=="0"?$():o=="1"&&y()};W(()=>{$()});const B=d(!1),D=d(""),se=()=>{var g,T;if(v.value.length==0)return(g=window.$message)==null?void 0:g.warning("暂无数据。请查询数据后重试。");const o={data:v.value.map(_=>({t:_.dbtime,pP:_.prePower,mP:_.manuPower})),type:1,dateTime:w(1,m.startTime)+" --- "+w(1,m.endTime)},c=fe.gzip(JSON.stringify(o),{to:"string"}).reduce((_,C)=>_+String.fromCharCode(C),"");if(D.value=`https://dingiiot.com/powerPrediction/?${btoa(c)}`,D.value.length>2700)return(T=window.$message)==null?void 0:T.warning("二维码生成失败，请缩小查询范围后重试");console.log("地址",D.value),B.value=!0},le=()=>{var e;const o=document.getElementById("qrcode");if(o){const c=document.createElement("a");c.href=o.toDataURL("image/png"),c.download="qrcode.png",c.click(),(e=window.$message)==null||e.success("下载成功")}else console.error("无法找到二维码 canvas 元素")};return(o,e)=>{const c=Oe,g=ye,T=ge,_=Ce,C=Se,q=Pe,re=Le,ie=he,ce=Ne,ue=Ie,de=$e,me=Be,E=Ue,pe=we;return b(),z("div",He,[a(ue,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[a(C,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:n(()=>[R(" 起止时间 "),a(_,null,{default:n(()=>[a(c,{value:O.value,"onUpdate:value":e[0]||(e[0]=s=>O.value=s),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":ee,shortcuts:ae},null,8,["value"]),a(l(U),{type:"primary",ghost:"",onClick:l(ne)},{icon:n(()=>[a(g,{class:ke(["text-icon",{"animate-spin":l(x)}])},null,8,["class"])]),default:n(()=>[R(" "+V(l(H)("common.search")),1)]),_:1},8,["onClick"]),p.value=="0"?(b(),K(l(U),{key:0,type:"primary",ghost:"",onClick:se,class:"ml-20px"},{icon:n(()=>[a(T,{class:"text-icon"})]),default:n(()=>[R(" "+V("生成二维码"))]),_:1})):j("",!0)]),_:1})]),_:1})]),default:n(()=>[a(ce,{type:"line",animated:"",value:p.value,"onUpdate:value":[e[3]||(e[3]=s=>p.value=s),oe],class:"h-100%","pane-wrapper-style":{flex:1}},{suffix:n(()=>[p.value=="0"?(b(),z("span",Ke,"共"+V(v.value.length)+"条数据",1)):j("",!0),p.value=="1"?(b(),K(C,{key:1,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[a(ie,{columns:l(h),"onUpdate:columns":e[2]||(e[2]=s=>F(h)?h.value=s:null)},null,8,["columns"])]),_:1})):j("",!0)]),default:n(()=>[a(q,{name:"0",tab:"人工干预数据图表对比",class:"h-100%"},{default:n(()=>[a(Ee,{data:v.value},null,8,["data"])]),_:1}),a(q,{name:"1",tab:"人工干预上报操作记录",class:"h-100%"},{default:n(()=>[a(re,{"checked-row-keys":l(L),"onUpdate:checkedRowKeys":e[1]||(e[1]=s=>F(L)?L.value=s:null),columns:l(f),data:l(u),size:"small",remote:"","row-key":s=>s.id,pagination:l(u).length?l(S):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1}),a(E,{show:N.value,"onUpdate:show":e[5]||(e[5]=s=>N.value=s),title:"详细信息",preset:"card",class:"w-800px"},{default:n(()=>[a(me,{class:"h-480px"},{default:n(()=>[a(de,{value:I.value.content,"onUpdate:value":e[4]||(e[4]=s=>I.value.content=s),rows:"20",type:"textarea",readonly:""},null,8,["value"])]),_:1})]),_:1},8,["show"]),a(E,{show:B.value,"onUpdate:show":e[6]||(e[6]=s=>B.value=s),title:"",preset:"card",class:"w-auto"},{header:n(()=>[X("div",null,[Fe,a(pe,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:le})])]),default:n(()=>[a(_e,{id:"qrcode",style:{margin:"0 auto"},value:D.value,margin:3,size:500,level:"L"},null,8,["value"])]),_:1},8,["show"])])}}}),la=Z(Qe,[["__scopeId","data-v-76b2b6f6"]]);export{la as default};
