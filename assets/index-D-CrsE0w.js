import{_ as pe,a as ce,A as me}from"./index-DNUcN358.js";import{d as fe,A as _e,z as ve,D as z,i as ge,aJ as G,c1 as ke,s as k,at as ye,b as be,o as _,f as o,w as l,M as we,c as y,G as b,h as w,N as K,c2 as Ce,S as T,g as i,B as F,bf as Ae,H as xe,J as V,a4 as Se,e as Me,t as j,a2 as Ne,c3 as he,aE as q,W as $e}from"./index-01hyoC1y.js";const Ie={class:"flex justify-center"},Ue=2,Ee=fe({name:"manage_systemconfig",__name:"index",setup(Be){const{formRef:J,validate:O}=_e(),C=ve(),t=z(Y());function Y(){return{id:0,captcha:0,merror:0,errortime:0,sdkkey:"",sdkh5:"",sdksecret:"",prosite:"",longitude:120.373885,latitude:30.303899,diserror:0}}const p={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},H={captcha:p,prosite:{type:"string",required:!0,message:"不能为空",trigger:["blur","change"]},longitude:p,latitude:p,merror:p,errortime:p,diserror:p},B=async()=>{const{data:n,error:e}=await he();e||(Object.assign(t,n),t.errortime=n.errortime/1e3/60)};ge(()=>{B()});const L=G.debounce(async()=>{var r;await O();const n=t.errortime*1e3*60,{error:e}=await ke({...t,errortime:n});e||(r=window.$message)==null||r.success("设置成功")},1e3,{leading:!0,trailing:!1}),v=k(!1),N=k();let c=null,D=null,A=null,W=null,P=null,d=null;const m=z({longitude:0,latitude:0});let g;const x=k(!1),f=k(""),S=k([]);let h=0;async function R(){try{if(window._AMapSecurityConfig={securityJsCode:t.sdksecret},!N.value)return;d=await me.load({key:t.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),c=new d.Map(N.value,{zoom:18,center:[t.longitude,t.latitude],viewMode:"3D",resizeEnable:!0}),D=new d.Geocoder,W=new d.PlaceSearch({city:"全国",pageSize:50}),P=new d.AutoComplete({city:"全国"}),$(d,{lng:t.longitude,lat:t.latitude}),c.on("click",n=>{const{lng:e,lat:r}=n.lnglat;g=2,m.latitude=r,m.longitude=e,$(d,{lng:e,lat:r})}),q(()=>window.dispatchEvent(new Event("resize")))}catch{h<Ue?(h++,console.warn(`地图加载失败，正在第 ${h} 次重试...`),setTimeout(()=>{R()},1500)):console.error("地图加载失败，已达到最大重试次数，停止重试")}}const X=G.debounce(async n=>{if(!x.value||!n.trim()){S.value=[];return}P.search(n,(e,r)=>{var s;console.log(r,"result"),e=="complete"&&r.info=="OK"&&((s=r==null?void 0:r.tips)!=null&&s.length)?S.value=r.tips.map(u=>({label:`${u.name}（${u.district||u.address||"无详细地址"}）`,value:`${u.location.lng}_${u.location.lat}`,raw:u})):S.value=[]})},300);ye(f,n=>{X(n)});function Q(n,e){if(console.log(n,e,"option"),!n)return;const[r,s]=n.split("_").map(Number);!r||!s||(c.setCenter([r,s]),g=1,$(d,{lng:r,lat:s}),m.longitude=r,m.latitude=s)}function Z(){v.value=!0,x.value=!1,g=void 0,q(async()=>{await R(),setTimeout(()=>{x.value=!0;const n=document.querySelector(".n-auto-complete input");n==null||n.blur()},500)})}function $(n,e){A&&c.remove(A),A=new n.Marker({position:[e.lng,e.lat],map:c}),c.add(A),D.getAddress(e,(r,s)=>{r==="complete"&&s.regeocode&&(console.log("result",s),console.log("formattedAddress",s.regeocode.formattedAddress),e.latitude=e.lat,e.longitude=e.lng,g==1||(g==2?f.value=s.regeocode.formattedAddress:f.value=t.prosite))})}function ee(){v.value=!1}const te=async()=>{t.latitude=m.latitude,t.longitude=m.longitude,t.prosite=f.value,v.value=!1};return(n,e)=>{const r=Ce,s=K,u=F,I=Ae,U=T,M=xe,oe=pe,E=F,le=T,ne=K,ae=V,re=we,se=ce,ue=V,ie=Se,de=Ne;return _(),be("div",Ie,[o(de,{bordered:""},{default:l(()=>[o(re,{ref_key:"formRef",ref:J,style:{margin:"0 auto",width:"800px"},"label-width":240,"label-placement":"left",model:t,rules:H},{default:l(()=>[w(C).userInfo.usertype==0?(_(),y(s,{key:0,label:"是否开启验证码",path:"captcha"},{default:l(()=>[o(r,{value:t.captcha,"onUpdate:value":e[0]||(e[0]=a=>t.captcha=a),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})):b("",!0),o(s,{label:"打卡误差范围（米）",path:"merror"},{default:l(()=>[o(U,{class:"flex items-center"},{default:l(()=>[o(u,{onClick:e[1]||(e[1]=a=>t.merror--),disabled:t.merror==0},{default:l(()=>e[16]||(e[16]=[i(" − ")])),_:1,__:[16]},8,["disabled"]),o(I,{"show-button":!1,value:t.merror,"onUpdate:value":e[2]||(e[2]=a=>t.merror=a),placeholder:"",min:0,precision:0},null,8,["value"]),o(u,{onClick:e[3]||(e[3]=a=>t.merror++),class:"mr-5px"},{default:l(()=>e[17]||(e[17]=[i(" + ")])),_:1,__:[17]}),e[18]||(e[18]=i(" 米 "))]),_:1,__:[18]})]),_:1}),o(s,{label:"打卡时间误差最大值（分钟）",path:"errortime"},{default:l(()=>[o(U,{class:"flex items-center"},{default:l(()=>[o(u,{onClick:e[4]||(e[4]=a=>t.errortime--),disabled:t.errortime==0},{default:l(()=>e[19]||(e[19]=[i(" − ")])),_:1,__:[19]},8,["disabled"]),o(I,{"show-button":!1,value:t.errortime,"onUpdate:value":e[5]||(e[5]=a=>t.errortime=a),placeholder:"",min:0,precision:0},null,8,["value"]),o(u,{onClick:e[6]||(e[6]=a=>t.errortime++),class:"mr-5px"},{default:l(()=>e[20]||(e[20]=[i(" + ")])),_:1,__:[20]}),e[21]||(e[21]=i(" 分钟 "))]),_:1,__:[21]})]),_:1}),o(s,{label:"静默打卡范围（当超过此数值将认为异常默认100）",path:"diserror"},{default:l(()=>[o(U,{class:"flex items-center"},{default:l(()=>[o(u,{onClick:e[7]||(e[7]=a=>t.diserror--),disabled:t.diserror==0},{default:l(()=>e[22]||(e[22]=[i(" − ")])),_:1,__:[22]},8,["disabled"]),o(I,{"show-button":!1,value:t.diserror,"onUpdate:value":e[8]||(e[8]=a=>t.diserror=a),placeholder:"",min:0,max:5e3,precision:0},null,8,["value"]),o(u,{onClick:e[9]||(e[9]=a=>t.diserror++),class:"mr-5px"},{default:l(()=>e[23]||(e[23]=[i(" + ")])),_:1,__:[23]}),e[24]||(e[24]=i(" 米 "))]),_:1,__:[24]})]),_:1}),w(C).userInfo.id=="1024"?(_(),y(s,{key:1,label:"AMAP_SDK_KEY",path:"sdkkey"},{default:l(()=>[o(M,{style:{width:"300px"},value:t.sdkkey,"onUpdate:value":e[10]||(e[10]=a=>t.sdkkey=a),placeholder:""},null,8,["value"])]),_:1})):b("",!0),w(C).userInfo.id=="1024"?(_(),y(s,{key:2,label:"AMAP_SDK_KEY_H5",path:"sdkh5"},{default:l(()=>[o(M,{style:{width:"300px"},value:t.sdkh5,"onUpdate:value":e[11]||(e[11]=a=>t.sdkh5=a),placeholder:""},null,8,["value"])]),_:1})):b("",!0),w(C).userInfo.id=="1024"?(_(),y(s,{key:3,label:"AMAP_SDK_SECRET",path:"sdksecret"},{default:l(()=>[o(M,{style:{width:"300px"},value:t.sdksecret,"onUpdate:value":e[12]||(e[12]=a=>t.sdksecret=a),placeholder:""},null,8,["value"])]),_:1})):b("",!0),o(ne,{label:"项目地点",path:"prosite"},{default:l(()=>[o(le,{onClick:Z},{default:l(()=>[o(M,{value:t.prosite,"onUpdate:value":e[13]||(e[13]=a=>t.prosite=a),style:{width:"400px"},placeholder:"请输入项目地点"},null,8,["value"]),o(E,null,{icon:l(()=>[o(oe,{class:"text-icon"})]),_:1})]),_:1})]),_:1}),o(s,{label:" "},{default:l(()=>[o(ae,null,{default:l(()=>[o(u,{type:"default",onClick:B},{default:l(()=>e[25]||(e[25]=[i(" 刷新 ")])),_:1,__:[25]}),o(u,{type:"info",onClick:w(L)},{default:l(()=>e[26]||(e[26]=[i(" 保存 ")])),_:1,__:[26]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model"]),o(ie,{show:v.value,"onUpdate:show":e[15]||(e[15]=a=>v.value=a),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:l(()=>[o(ue,{justify:"end",size:16},{default:l(()=>[o(E,{onClick:ee},{default:l(()=>[i(j(n.$t("common.cancel")),1)]),_:1}),o(E,{type:"primary",onClick:te},{default:l(()=>[i(j(n.$t("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[x.value?(_(),y(se,{key:0,value:f.value,"onUpdate:value":e[14]||(e[14]=a=>f.value=a),options:S.value,placeholder:"请输入地点关键字",clearable:"",onSelect:Q},null,8,["value","options"])):b("",!0),Me("div",{ref_key:"domRef",ref:N,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])]),_:1})])}}}),Re=$e(Ee,[["__scopeId","data-v-e90a60d6"]]);export{Re as default};
