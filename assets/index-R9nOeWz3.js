import{_ as ee}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CLucCwSt.js";import{d as P,n as K,p as E,s as G,D as F,o as j,c as W,w as n,g as e,i as t,W as H,ap as J,E as O,h as U,t as I,$ as p,F as te,Z as L,J as Z,B as M,N as Q,O as X,ad as Y,q as oe,b as ne,r as ae,ae as se,K as le,ah as ie,ai as re,a3 as ce,ax as pe,aE as de,az as ue,e as me,al as B,am as _e,an as fe}from"./index-CC5dz6Fg.js";import{u as ye,a as he}from"./table-BBDGFuHc.js";import{n as ve,o as ge,f as be,p as we}from"./asset-iYPNkOcS.js";import{_ as De}from"./round-search-DrOCNvJL.js";import{_ as ke}from"./round-refresh-8umJ1-xH.js";import{_ as Ne}from"./lodash-qu1GOcgR.js";import{_ as Se}from"./FormItemGridItem-C_YzeEzO.js";import{_ as xe}from"./Grid-NJJ1aoYn.js";import{h as q}from"./permission-BzZCfh7s.js";import{_ as ze}from"./Popconfirm-DnpwMr5D.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Bpt07NNf.js";import"./setting-outlined-Bhi-Zv4n.js";import"./export-Bm_KWmyD.js";import"./refresh-CQOxn1S8.js";import"./round-delete-8TaLKJiS.js";import"./round-plus-CYJW8-aI.js";import"./Upload-Cewg3tUk.js";import"./Progress-B4eY24hT.js";const Ce=P({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search"],["update:model"]),setup(_,{emit:z}){const c=z,{formRef:v,restoreValidation:d}=E(),l=G(_,"model");function N(){l.value.fuzzy="",c("search")}async function C(){await d(),c("reset")}async function g(){c("search")}const S=Ne.debounce(g,1e3,{leading:!0,trailing:!1});return(s,f)=>{const T=L,b=Se,w=Z,u=ke,y=M,i=De,x=Q,m=xe,R=X,$=Y,D=F("no-space");return j(),W($,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(R,{ref_key:"formRef",ref:v,model:l.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(t(S),["enter"])},{default:n(()=>[e(m,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[e(b,{span:"24 s:12 m:9 l:6",label:"一级资产分类",path:"pid"},{default:n(()=>[e(T,{filterable:"",clearable:"",value:l.value.pid,"onUpdate:value":[f[0]||(f[0]=o=>l.value.pid=o),g],placeholder:"请选择一级资产分类",options:t(H)(t(J)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(b,{span:"24 s:12 m:9 l:6",label:"名称",path:"fuzzy"},{default:n(()=>[O(e(w,{clearable:"",value:l.value.fuzzy,"onUpdate:value":f[1]||(f[1]=o=>l.value.fuzzy=o),placeholder:"请输入资产二级分类名称",onClear:N},null,8,["value"]),[[D]])]),_:1}),e(b,{span:"24 s:12 m:6 l:12"},{default:n(()=>[e(x,{class:"w-full"},{default:n(()=>[e(y,{onClick:C},{icon:n(()=>[e(u,{class:"text-icon"})]),default:n(()=>[U(" "+I(t(p)("common.reset")),1)]),_:1}),e(y,{type:"primary",ghost:"",onClick:t(S)},{icon:n(()=>[e(i,{class:"text-icon"})]),default:n(()=>[U(" "+I(t(p)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Te=P({name:"OperateDrawer",__name:"operate-drawer",props:K({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(_,{emit:z}){const c=_,v=z,d=G(_,"visible"),{formRef:l,validate:N,restoreValidation:C}=E(),{defaultRequiredRule:g}=oe(),S=ne(()=>({add:"新增资产类型",edit:"编辑资产类型"})[c.operateType]),s=ae(f());function f(){return{pid:void 0,aname:"",sysv:1}}const T={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择资产一级分类"},aname:g};function b(){Object.assign(s,f()),c.operateType==="edit"&&c.rowData&&Object.assign(s,c.rowData)}function w(){d.value=!1}async function u(){var y,i;if(await N(),c.operateType==="add"){const{data:x,error:m}=await ve([{pid:s.pid,aname:s.aname,sysv:s.sysv}]);m||((y=window.$message)==null||y.success(p("common.addSuccess")),w(),v("submitted"))}else{const{data:x,error:m}=await ge([{id:c.rowData.id,pid:s.pid,aname:s.aname,sysv:s.sysv}]);m||((i=window.$message)==null||i.success(p("common.updateSuccess")),w(),v("submitted"))}}return se(d,()=>{d.value&&(b(),C())}),(y,i)=>{const x=L,m=le,R=Z,$=X,D=M,o=Q,a=ie,r=re,A=F("no-space");return j(),W(r,{show:d.value,"onUpdate:show":i[2]||(i[2]=k=>d.value=k),"display-directive":"show",width:450},{default:n(()=>[e(a,{title:S.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(o,{size:16},{default:n(()=>[e(D,{onClick:w},{default:n(()=>[U(I(t(p)("common.cancel")),1)]),_:1}),e(D,{type:"primary",onClick:u},{default:n(()=>[U(I(t(p)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e($,{ref_key:"formRef",ref:l,model:s,rules:T},{default:n(()=>[e(m,{label:"资产一级分类",path:"pid"},{default:n(()=>[e(x,{filterable:"",value:s.pid,"onUpdate:value":i[0]||(i[0]=k=>s.pid=k),placeholder:"请选择资产一级分类",options:t(H)(t(J)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"资产二级分类",path:"aname"},{default:n(()=>[O(e(R,{value:s.aname,"onUpdate:value":i[1]||(i[1]=k=>s.aname=k),placeholder:"请输入资产二级分类"},null,8,["value"]),[[A]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Re={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function V(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!_e(_)}const Ze=P({name:"assetmanagement_assetgroup",__name:"index",setup(_){const z=ce(),{columns:c,columnChecks:v,data:d,getData:l,loading:N,mobilePagination:C,searchParams:g,resetSearchParams:S}=ye({apiFn:be,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,pid:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"pid",title:"资产一级分类",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:o=>p(pe[o.pid])},{key:"aname",title:"资产二级分类",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"sysv",title:"系统内置",align:"center",width:120,render:o=>{const a={0:"success",1:"info"},r=p(de[o.sysv]);return e(ue,{size:"small",type:a[o.sysv]},V(r)?r:{default:()=>[r]})}},{key:"operate",title:p("common.operate"),align:"center",width:160,render:o=>{let a;return o.sysv!=0?e("div",{class:"flex-center gap-8px"},[O(e(M,{type:"primary",ghost:!0,size:"small",onClick:()=>R(o.id)},V(a=p("common.edit"))?a:{default:()=>[a]}),[[F("no-auth"),"sys.asset.type.update"]]),e(ze,{onPositiveClick:()=>$(o.id)},{default:()=>p("common.confirmDelete"),trigger:()=>{let r;return O(e(M,{type:"error",ghost:!0,size:"small"},V(r=p("common.delete"))?r:{default:()=>[r]}),[[F("no-auth"),"sys.asset.type.delete"]])}})]):null}}]}),{drawerVisible:s,operateType:f,editingData:T,handleAdd:b,handleEdit:w,checkedRowKeys:u,onBatchDeleted:y,onDeleted:i,closeDrawer:x}=he(d,l);async function m(){console.log(u.value),D(u.value,o=>{y()})}function R(o){w(o)}function $(o){D([o],a=>{i()})}async function D(o,a){const{data:r,error:A}=await we(o);if(!A)a&&a(r);else return!1}return(o,a)=>{const r=ee,A=fe,k=Y;return j(),me("div",Re,[e(Ce,{model:t(g),"onUpdate:model":a[0]||(a[0]=h=>B(g)?g.value=h:null),onReset:t(S),onSearch:t(l)},null,8,["model","onReset","onSearch"]),e(k,{title:"资产类型",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[e(r,{columns:t(v),"onUpdate:columns":a[1]||(a[1]=h=>B(v)?v.value=h:null),"disabled-delete":t(u).length===0,loading:t(N),onAdd:t(b),onDelete:m,onRefresh:t(l),"is-view-add-button":t(q)("sys.asset.type.insert"),"is-view-delete-button":t(q)("sys.asset.type.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:n(()=>[e(A,{"checked-row-keys":t(u),"onUpdate:checkedRowKeys":a[2]||(a[2]=h=>B(u)?u.value=h:null),columns:t(c),data:t(d),size:"small","flex-height":!t(z).isMobile,"scroll-x":962,loading:t(N),remote:"","row-key":h=>h.id,pagination:t(C),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Te,{visible:t(s),"onUpdate:visible":a[3]||(a[3]=h=>B(s)?s.value=h:null),"operate-type":t(f),"row-data":t(T),onSubmitted:t(l)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Ze as default};
