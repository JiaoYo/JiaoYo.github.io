import{_ as ye}from"./round-add-BfTWXTj-.js";import{d as W,aw as J,q as Y,ai as ie,v as ce,s as de,a as be,ay as oe,bZ as ue,eg as he,eh as we,at as Q,c as L,o as x,w as a,f as t,G as le,z as X,A as pe,h as e,au as me,C as V,N as se,B as z,g as T,t as w,$ as R,aF as xe,cu as fe,aI as ae,aN as ke,r as G,ei as Se,y as Z,bh as Ce,D as q,e as _,aP as K,b as H,T as je,F as _e,cK as Te,aT as De,aX as Pe,bj as ze,ej as Ne,ek as Ue,av as $e,U as ve,b4 as Ie,M as Le,i as Me,aO as te,cP as Fe,aA as Be,el as Re,em as qe,aU as Ee,ad as Oe}from"./index-CZIEjqom.js";import{u as Ae,a as Ke}from"./table-BPk-2eq8.js";import{u as ne}from"./usePageData-B4neAonl.js";import{_ as Ve,a as He}from"./text-BP0LL0nR.js";import{N as ge}from"./Popconfirm-BDMz3KG7.js";import{_ as Ge}from"./round-search-D79Yigrq.js";import{_ as Xe}from"./Grid-CeLvsKko.js";import{_ as Ze}from"./FormItemGridItem-pS29iDvT.js";const Je=W({name:"OperateDrawer",__name:"operate-drawer",props:J({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(k,{emit:F}){Y();const l=F,M=ie("pname"),m=k,o=ce(N());function N(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null}}const v={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施"}},{pageData:p,getData:y,nextPage:U}=ne(fe),$=async n=>{const s=n.currentTarget,i=s.scrollTop;s.scrollTop+s.offsetHeight>=s.scrollHeight&&p.data.length<p.total&&(await U(),await ae(),setTimeout(()=>{s.scrollTop=i}))},b=async n=>{n?o.pid=n:o.value.pid=null},I=async()=>{var n;if(await y({fuzzy:M.value,page:1}),p.data.length==0)return(n=window.$message)==null?void 0:n.warning("没有项目")},f=async n=>{await y({fuzzy:n,page:1})},r=()=>{y({page:1})};async function h(){Object.assign(o,N()),await I(),m.pid&&(p.data.forEach(n=>{n.id==m.pid&&(n.disabled=!0)}),o.pid=m.pid),m.operateType==="edit"&&m.rowData&&Object.assign(o,m.rowData)}const{formRef:S,validate:D,restoreValidation:B}=de(),E=be(()=>({add:"新增项目总结",edit:"修改项目总结"})[m.operateType]),C=oe(k,"visible"),u=()=>{C.value=!1},c=ue.debounce(async()=>{var n,s;if(await D(),m.operateType==="edit"){const{data:i,error:d}=await he([{...o}]);d||((n=window.$message)==null||n.success("修改成功"),l("submitted"),u())}else{const{data:i,error:d}=await we([{pid:o.pid,content1:o.content1,content2:o.content2,content3:o.content3,content4:o.content4,content5:o.content5}]);d||((s=window.$message)==null||s.success("添加成功"),l("submitted"),u())}},1e3,{leading:!0,trailing:!1});return Q(C,()=>{C.value&&(h(),setTimeout(()=>{const n=document.querySelector(".n-scrollbar-content");n==null||n.scrollTo(0,0)},300),B())}),(n,s)=>{const i=pe,d=le,j=se,O=xe;return x(),L(O,{show:C.value,"onUpdate:show":s[6]||(s[6]=g=>C.value=g),title:E.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:a(()=>[t(j,{justify:"end"},{default:a(()=>[t(e(z),{size:"small",class:"mt-16px",onClick:u},{default:a(()=>[T(w(e(R)("common.cancel")),1)]),_:1}),t(e(z),{type:"primary",size:"small",class:"mt-16px",onClick:e(c)},{default:a(()=>[T(w(e(R)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:a(()=>[t(d,{ref_key:"formRef",ref:S,model:o,rules:v},{default:a(()=>[m.operateType==="add"?(x(),L(i,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:a(()=>[t(e(me),{clearable:"",filterable:"",value:o.pid,"onUpdate:value":[s[0]||(s[0]=g=>o.pid=g),b],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:r,onSearch:f,options:e(p).data,onScroll:$},null,8,["value","options"])]),_:1})):X("",!0),t(i,{label:"前期准备阶段描述",path:"content1"},{default:a(()=>[t(e(V),{clearable:"",type:"textarea",value:o.content1,"onUpdate:value":s[1]||(s[1]=g=>o.content1=g),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),t(i,{label:"遇到问题及对项目的影响",path:"content2"},{default:a(()=>[t(e(V),{clearable:"",type:"textarea",value:o.content2,"onUpdate:value":s[2]||(s[2]=g=>o.content2=g),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),t(i,{label:"经验教训与改进方案或措施",path:"content3"},{default:a(()=>[t(e(V),{clearable:"",type:"textarea",value:o.content3,"onUpdate:value":s[3]||(s[3]=g=>o.content3=g),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),t(i,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:a(()=>[t(e(V),{clearable:"",type:"textarea",value:o.content4,"onUpdate:value":s[4]||(s[4]=g=>o.content4=g),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),t(i,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:a(()=>[t(e(V),{clearable:"",type:"textarea",value:o.content5,"onUpdate:value":s[5]||(s[5]=g=>o.content5=g),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Qe={class:"mt-4 border-t pt-3"},We={class:"flex items-start gap-2 mb-3"},Ye={class:"ml-2 flex-1"},et={class:"flex items-center"},tt={class:"font-medium font-size-16px font-bold"},at={class:"text-gray-600 mt-1"},nt=W({name:"drawerLog",__name:"drawerLog",props:J({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(k){const F=Y();ke();let l=ce({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""});const M=k,m={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},o=G({});async function N(){v.value=[],l={id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""},Object.assign(l,M.rowData),$()}const v=G([]),p=oe(k,"visible");Q(p,()=>{p.value?N():(v.value=[],l.id=void 0)});function y(f){f||U()}function U(){p.value=!1}const $=async()=>{const{data:f,error:r}=await Ne({page:1,limit:100,pid:l.id});f&&(v.value=f.list)},b=ue.debounce(async()=>{var S;const f=o.value[l.id];if(!(f!=null&&f.trim()))return(S=window.$message)==null?void 0:S.warning("请输入评论内容");const{data:r,error:h}=await Se([{pid:l.id,content:f}]);r&&(o.value[l.id]="",l.num++,$())},1e3,{leading:!0,trailing:!1}),I=async f=>{var S;const{data:r,error:h}=await Ue(f.id);r&&($(),l.num--,(S=window.$message)==null||S.success("删除成功"))};return(f,r)=>{const h=pe,S=le,D=Ve,B=He,E=Ce,C=ze,u=Z("i"),c=Z("no-auth");return x(),L(C,{show:p.value,"onUpdate:show":[r[1]||(r[1]=n=>p.value=n),y],"display-directive":"show",width:600,onMaskClick:U,onEsc:U},{default:a(()=>[t(E,{title:e(l).username+"的项目总结","native-scrollbar":!1,closable:""},{default:a(()=>[t(S,{ref:"formRef",model:e(l),"show-feedback":!1},{default:a(()=>[t(h,{label:"",path:"contractname"},{label:a(()=>r[2]||(r[2]=[_("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:a(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).proname}])},w(e(l).proname),3)]),_:1}),t(h,{label:"前期准备阶段描述",path:"content1"},{label:a(()=>r[3]||(r[3]=[_("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:a(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).content1}])},w(e(l).content1),3)]),_:1}),t(h,{label:"遇到问题及对项目的影响",path:"content2"},{label:a(()=>r[4]||(r[4]=[_("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:a(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).content2}])},w(e(l).content2),3)]),_:1}),t(h,{label:"经验教训与改进方案或措施",path:"content3"},{label:a(()=>r[5]||(r[5]=[_("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:a(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).content3}])},w(e(l).content3),3)]),_:1}),t(h,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:a(()=>r[6]||(r[6]=[_("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:a(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).content4}])},w(e(l).content4),3)]),_:1}),t(h,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:a(()=>r[7]||(r[7]=[_("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:a(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).content5}])},w(e(l).content5),3)]),_:1})]),_:1},8,["model"]),q((x(),H("div",null,[T(w(e(l).num)+"评论",1)])),[[u,e(l).num]]),t(je,{name:"fade"},{default:a(()=>[_("div",Qe,[q((x(),H("div",We,[_("div",null,[t(D,{size:"small",src:m.avatar},null,8,["src"])]),t(e(V),{type:"textarea",id:`comment-input-${e(l).id}`,value:o.value[e(l).id],"onUpdate:value":r[0]||(r[0]=n=>o.value[e(l).id]=n),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:_e(Te(e(b),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),t(e(z),{type:"primary",ghost:"",onClick:e(b)},{default:a(()=>r[8]||(r[8]=[T("发送")])),_:1,__:[8]},8,["onClick"])])),[[c,"project:Summary:Comment:insert"]]),(x(!0),H(De,null,Pe(v.value,n=>(x(),H("div",{key:n.id,class:"flex mb-3"},[t(D,{size:"small",src:m.avatar},null,8,["src"]),_("div",Ye,[_("div",et,[_("span",tt,w(n.username),1),t(B,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:a(()=>[T(w(n.dbtime),1)]),_:2},1024),e(F).userInfo.id==n.creater?(x(),L(e(ge),{key:0,onPositiveClick:s=>I(n)},{trigger:a(()=>[q((x(),L(e(z),{quaternary:"",type:"error",size:"small"},{default:a(()=>r[9]||(r[9]=[T(" 删除 ")])),_:1,__:[9]})),[[c,"project:Summary:Comment:delete"]])]),default:a(()=>[r[10]||(r[10]=T(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):X("",!0)]),_("div",at,w(n.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),ot=$e(nt,[["__scopeId","data-v-4f3f349b"]]),lt=W({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search","clear"],["update:model"]),setup(k,{emit:F}){const l=F,{formRef:M}=de(),m=ie("pname"),o=oe(k,"model"),N=Y(),v=G([]),{pageData:p,getData:y,nextPage:U}=ne(fe),$=async u=>{const c=u.currentTarget,n=c.scrollTop;c.scrollTop+c.offsetHeight>=c.scrollHeight&&p.data.length<p.total&&(await U(),v.value=p.data,await ae(),setTimeout(()=>{c.scrollTop=n}))},{pageData:b,getData:I,nextPage:f}=ne(Ie),r=async u=>{const c=u.currentTarget,n=c.scrollTop;c.scrollTop+c.offsetHeight>=c.scrollHeight&&b.data.length<b.total&&(await f(),v.value=b.data,await ae(),setTimeout(()=>{c.scrollTop=n}))},h=async u=>{o.value.creater=u,l("search")},S=async u=>{var c,n;u?(o.value.pid=u,l("search"),N.setProjectInfo({pname:(c=v.value.find(s=>s.id==u))==null?void 0:c.proname,pid:u}),m.value=(n=v.value.find(s=>s.id==u))==null?void 0:n.proname):l("search")},D=async u=>{await y({fuzzy:u,page:1}),v.value=p.data},B=async()=>{await y({page:1}),v.value=p.data};(async()=>{await y(),v.value=p.data,l("search")})(),I({usertypes:"2,3"});async function C(){l("search")}return(u,c)=>{const n=me,s=Ze,i=Ge,d=z,j=se,O=Xe,g=le,ee=ve;return x(),L(ee,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[t(g,{ref_key:"formRef",ref:M,model:o.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:_e(C,["enter"])},{default:a(()=>[t(O,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[t(s,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:a(()=>[t(n,{filterable:"",clearable:"",value:o.value.pid,"onUpdate:value":[c[0]||(c[0]=A=>o.value.pid=A),S],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:v.value,onScroll:$,onClear:B,onSearch:D},null,8,["value","options"])]),_:1}),t(s,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:a(()=>[t(n,{clearable:"",filterable:"",value:o.value.creater,"onUpdate:value":[c[1]||(c[1]=A=>o.value.creater=A),h],placeholder:"请选择","label-field":"username","value-field":"id",options:e(b).data,onScroll:r},null,8,["value","options"])]),_:1}),t(s,{span:"24  s:12 m:6",class:"pr-24px"},{default:a(()=>[t(j,{class:"w-full"},{default:a(()=>[t(d,{type:"primary",ghost:"",onClick:C},{icon:a(()=>[t(i,{class:"text-icon"})]),default:a(()=>[T(" "+w(e(R)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),st={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},rt={key:0};function re(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!Ee(k)}const gt=W({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(k,{emit:F}){const l=Le(),M=Y(),m=k,o=G("");Oe("pname",o);const N=F,{columns:v,data:p,getData:y,loading:U,mobilePagination:$,searchParams:b}=Ae({showTotal:!0,immediate:!1,apiFn:Re,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:i=>t("div",null,[i.username+"的项目总结"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:R("common.operate"),align:"center",width:140,fixed:"right",render:i=>{let d;return t("div",{class:"flex-center gap-8px"},[t(z,{type:"primary",ghost:!0,size:"small",onClick:()=>n(i)},{default:()=>[T("查看详情")]}),M.userInfo.id==i.creater&&q(t(z,{type:"primary",ghost:!0,size:"small",onClick:()=>C(i.id)},re(d=R("common.edit"))?d:{default:()=>[d]}),[[Z("no-auth"),"project:Summary:update"]]),M.userInfo.id==i.creater&&t(ge,{onPositiveClick:()=>E(i.id)},{default:()=>R("common.confirmDelete"),trigger:()=>{let j;return q(t(z,{type:"error",ghost:!0,size:"small"},re(j=R("common.delete"))?j:{default:()=>[j]}),[[Z("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:I,operateType:f,editingData:r,handleAdd:h,handleEdit:S,checkedRowKeys:D,onDeleted:B}=Ke(p,y);async function E(i){const{data:d,error:j}=await qe(i);j||B()}function C(i){S(i)}const u=G(!1),c=G({}),n=i=>{u.value=!0,c.value=i},s=()=>{y()};return Q(()=>m.pid,async i=>{i&&(b.pid=i,await y())}),Q(()=>p.value,async i=>{i.length>0?N("thereIsData",1):N("thereIsData",0)}),Me(()=>{m.type!="externalLiaison"}),(i,d)=>{const j=se,O=ye,g=Be,ee=ve,A=Z("no-auth");return x(),H("div",st,[m.pid?X("",!0):(x(),L(lt,{key:0,model:e(b),"onUpdate:model":d[0]||(d[0]=P=>te(b)?b.value=P:null),onReset:s,onSearch:e(y),onClear:d[1]||(d[1]=P=>p.value=[])},null,8,["model","onSearch"])),t(ee,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Fe({header:a(()=>[t(j,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>[m.pid?X("",!0):(x(),H("div",rt,"项目总结"))]),_:1}),m.pid?q((x(),L(e(z),{key:0,onClick:e(h),size:"small",ghost:"",type:"primary"},{icon:a(()=>[t(O,{class:"text-icon"})]),default:a(()=>[d[5]||(d[5]=T(" "+w("新增")))]),_:1,__:[5]},8,["onClick"])),[[A,"project:Summary:insert"]]):X("",!0)]),default:a(()=>[t(g,{"checked-row-keys":e(D),"onUpdate:checkedRowKeys":d[2]||(d[2]=P=>te(D)?D.value=P:null),columns:e(v),data:e(p),size:"small","flex-height":!e(l).isMobile,loading:e(U),remote:"","row-key":P=>P.id,pagination:e($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Je,{visible:e(I),"onUpdate:visible":d[3]||(d[3]=P=>te(I)?I.value=P:null),onSubmitted:e(y),"operate-type":e(f),pid:m.pid||e(b).pid,"row-data":e(r)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),t(ot,{visible:u.value,"onUpdate:visible":d[4]||(d[4]=P=>u.value=P),"row-data":c.value},null,8,["visible","row-data"])]),_:2},[m.pid?void 0:{name:"header-extra",fn:a(()=>[t(j,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[q((x(),L(e(z),{onClick:e(h),size:"small",ghost:"",type:"primary"},{icon:a(()=>[t(O,{class:"text-icon"})]),default:a(()=>[d[6]||(d[6]=T(" "+w("新增")))]),_:1,__:[6]},8,["onClick"])),[[A,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{gt as _};
