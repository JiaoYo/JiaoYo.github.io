import{Q as me,p as _e,_ as fe,a as we}from"./pako.esm-CWXI_SLV.js";import{_ as ge}from"./export-DCiyxnkL.js";import{_ as he}from"./round-search-DCFj1fEa.js";import{d as j,ac as G,a0 as ye,o as x,b as O,_ as H,ea as ve,b0 as c,g as t,m as g,z as be,ak as xe,w as o,f as l,B as T,h as b,t as q,$ as V,c as L,F as M,aq as ke,e as Q,eb as De,Q as Te,T as Pe,a7 as Ce,c0 as Se,at as Ne,R as Ie,c1 as $e,ap as qe,p as Me,i as ze}from"./index-BhO9mJqH.js";import{u as Ae,a as Be}from"./table-Dxg8ykSZ.js";import{e as Ue}from"./exportExcel-Bv4G4H50.js";import{u as Le,L as W}from"./echarts-B7JzXfaq.js";import{_ as Oe}from"./DatePicker-C96CTQMI.js";import{_ as Re}from"./FormItemGridItem-B6FnsOtc.js";import{_ as Fe}from"./Grid-Dy0tlGIH.js";const Ee=j({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(h){const u=h;G(()=>u.data,async r=>{R(e=>(e.xAxis.data=u.data.map(d=>d.dbtime),e.series[0].data=u.data.map(d=>d.power),e.series[1].data=u.data.map(d=>d.prePower),e))});const P=ye(),{domRef:C,updateOptions:S,updateOptionsAsync:R}=Le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:"#6a7985",textStyle:{color:"rgb(224, 224, 224)"},valueFormatter:function(r){return(r+""!="undefined"?r:"--")+"MW"}},legend:{data:["实际功率","预测功率"]},toolbox:{show:!0,feature:{saveAsImage:{show:!0,name:"功率图表"},magicType:{show:!0,type:["line","bar"]}}},grid:{left:"2%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} MW"}},series:[{color:"#e90445",name:"实际功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new W(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.9)",shadowBlur:20},data:[],connectNulls:!0},{color:"#009688",name:"预测功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new W(0,0,0,1,[{offset:0,color:"rgba(0, 150, 136,0.3)"},{offset:1,color:"rgba(0, 150, 136,0)"}],!1),shadowColor:"rgba(0, 150, 136,0.9)",shadowBlur:20},data:[],connectNulls:!0}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function y(){await new Promise(r=>{setTimeout(r,200)}),S(r=>(r.xAxis.data=u.data.map(e=>e.dbtime),r.series[0].data=u.data.map(e=>e.power),r.series[1].data=u.data.map(e=>e.prePower),r))}function _(){S((r,e)=>{const d=e();return r.legend.data=d.legend.data,r.series[0].name=d.series[0].name,r.series[1].name=d.series[1].name,r})}async function z(){y()}return G(()=>P.locale,()=>{_()}),z(),(r,e)=>(x(),O("div",{ref_key:"domRef",ref:C,class:"h-600px overflow-hidden"},null,512))}}),Ge=H(Ee,[["__scopeId","data-v-462d4bff"]]),Ve=h=>(Me("data-v-c4c35e72"),h=h(),ze(),h),We={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},je={key:1},He=Ve(()=>Q("span",null,"二维码",-1)),Qe=j({name:"realtimequery_powerquery",__name:"index",setup(h){const u=Date.now(),P=new Date(u).setHours(0,0,0,0),C=new Date(u).setHours(23,59,59,999),{columns:S,columnChecks:R,data:y,getData:_,loading:z,mobilePagination:r,searchParams:e,resetSearchParams:d}=Ae({apiFn:ve,apiParams:{page:1,pageSize:20,limit:20,startTime:c(1,P)||null,endTime:c(1,C)||null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"dbtime",title:"时间",align:"center",width:100},{key:"power",title:"实际功率(MW)",align:"center",width:140},{key:"prePower",title:"预测功率(MW)",align:"center",width:140},{key:"ctime",title:"预测计算时间(s)",align:"center",width:140},{key:"operate",title:"误差(MW)",align:"center",width:100,render(n){const a=n.prePower-n.power>=0?n.prePower-n.power:n.power-n.prePower;return t("span",null,[a?parseFloat(a.toFixed(6)):""])}}]}),{checkedRowKeys:k}=Be(y,_),f=g(null),A=g(!1),K=n=>{if(n){if(f.value!==null)return;m(),f.value=window.setInterval(async()=>m(),1e3*60*3)}else f.value!==null&&(clearInterval(f.value),f.value=null),m()},J=async()=>{p.value=="0"?await m():await _()},D=g([]),N=g(""),m=async()=>{const{data:n,error:a}=await De({startTime:e.startTime,endTime:e.endTime});a||(D.value=n.sort((s,v)=>new Date(s.dbtime).getTime()-new Date(v.dbtime).getTime()))},I=g([P,C]);async function Z(n,a){e.startTime=c(1,a[0]),e.endTime=c(1,a[1]),p.value=="1"?_():m()}const X=n=>{n=="1"?_():m()};be(()=>{m()});const Y=()=>{const n={dbtime:"时间",power:"实际功率",prePower:"预测功率",error:"误差"},a=[];y.value.forEach(s=>{k.value.includes(s.id)&&a.push({dbtime:s.dbtime,power:s.power,prePower:s.prePower,error:s.prePower-s.power>=0?s.prePower-s.power:s.power-s.prePower||""})}),Ue(a,n,"预测数据")},p=g("0"),B=g(!1),ee=()=>{var v,$;if(D.value.length==0)return(v=window.$message)==null?void 0:v.warning("暂无数据。请查询数据后重试。");const n={data:D.value.map(w=>({t:w.dbtime,pP:w.prePower,p:w.power})),type:0,dateTime:c(1,e.startTime)+" --- "+(A.value?c(1,new Date):c(1,e.endTime))},s=_e.gzip(JSON.stringify(n),{to:"string"}).reduce((w,U)=>w+String.fromCharCode(U),"");if(N.value=`https://dingiiot.com/powerPrediction/?${btoa(s)}`,N.value.length>2700)return($=window.$message)==null?void 0:$.warning("二维码生成失败，请缩小查询范围后重试");console.log("地址",N.value),B.value=!0},ae=()=>{var a;const n=document.getElementById("qrcode");if(n){const s=document.createElement("a");s.href=n.toDataURL("image/png"),s.download="qrcode.png",s.click(),(a=window.$message)==null||a.success("下载成功")}else console.error("无法找到二维码 canvas 元素")},te={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()],超短期:[Date.now(),Date.now()+144e5],短期:[Date.now(),Date.now()+864e5*10]},ne=()=>{I.value=[Date.now(),Date.now()+144e5],e.startTime=c(1,Date.now()),e.endTime=c(1,Date.now()+144e5),p.value=="1"?_():m()},oe=()=>{I.value=[Date.now(),Date.now()+864e5*10],e.startTime=c(1,Date.now()),e.endTime=c(1,Date.now()+864e5*10),p.value=="1"?_():m()};return xe(()=>{f.value!==null&&(clearInterval(f.value),f.value=null)}),(n,a)=>{const s=Oe,v=he,$=fe,w=Te,U=Re,se=Fe,re=Pe,F=Ce,E=Se,le=Ne,ie=ge,ce=Ie,ue=$e,de=we,pe=qe;return x(),O("div",We,[t(F,{bordered:!1,size:"small"},{default:o(()=>[t(re,{ref:"formRef",model:l(e),"label-placement":"left","show-feedback":!1},{default:o(()=>[t(se,{"y-gap":16,responsive:"screen","item-responsive":""},{default:o(()=>[t(U,{span:"24 s:12 m:18",label:"起止时间",path:"startTime"},{default:o(()=>[t(s,{value:I.value,"onUpdate:value":a[0]||(a[0]=i=>I.value=i),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":Z,"default-time":["00:00:00","23:59:59"],shortcuts:te},null,8,["value"]),t(l(T),{type:"primary",ghost:"",onClick:J,class:"ml-20px"},{icon:o(()=>[t(v,{class:"text-icon"})]),default:o(()=>[b(" "+q(l(V)("common.search")),1)]),_:1}),t(l(T),{type:"primary",ghost:"",onClick:ne,class:"ml-10px"},{default:o(()=>[b(" 查询超短期 ")]),_:1}),t(l(T),{type:"primary",ghost:"",onClick:oe,class:"ml-10px"},{default:o(()=>[b(" 查询短期 ")]),_:1}),p.value=="0"?(x(),L(l(T),{key:0,type:"primary",ghost:"",onClick:ee,class:"ml-20px"},{icon:o(()=>[t($,{class:"text-icon"})]),default:o(()=>[b(" "+q("生成二维码"))]),_:1})):M("",!0),p.value=="0"?(x(),L(w,{key:1,checked:A.value,"onUpdate:checked":[a[1]||(a[1]=i=>A.value=i),K],class:"ml-20px",title:"3分钟自动刷新"},{default:o(()=>[b(" 定时刷新 ")]),_:1},8,["checked"])):M("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(F,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:o(()=>[t(ue,{type:"card",animated:"",value:p.value,"onUpdate:value":[a[3]||(a[3]=i=>p.value=i),X],class:"h-100%","tab-style":{height:"40px"},"pane-wrapper-style":{flex:1}},{suffix:o(()=>[p.value=="1"?(x(),L(ce,{key:0,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[t(l(T),{onClick:Y,size:"small",disabled:l(k).length==0},{icon:o(()=>[t(ie,{class:"text-icon"})]),default:o(()=>[b(" "+q(l(V)("common.export")),1)]),_:1},8,["disabled"])]),_:1})):M("",!0),p.value=="0"?(x(),O("span",je,"共"+q(D.value.length)+"条数据",1)):M("",!0)]),default:o(()=>[t(E,{name:"0",tab:"图表"},{default:o(()=>[t(Ge,{data:D.value},null,8,["data"])]),_:1}),t(E,{name:"1",tab:"表格",class:"h-100%"},{default:o(()=>[t(le,{"checked-row-keys":l(k),"onUpdate:checkedRowKeys":a[2]||(a[2]=i=>ke(k)?k.value=i:null),columns:l(S),data:l(y),size:"small",loading:l(z),remote:"","row-key":i=>i.id,pagination:l(y).length?l(r):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1}),t(pe,{show:B.value,"onUpdate:show":a[4]||(a[4]=i=>B.value=i),title:"",preset:"card",class:"w-auto"},{header:o(()=>[Q("div",null,[He,t(de,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:ae})])]),default:o(()=>[t(me,{id:"qrcode",style:{margin:"0 auto"},value:N.value,margin:3,size:500,level:"L"},null,8,["value"])]),_:1},8,["show"])])}}}),sa=H(Qe,[["__scopeId","data-v-c4c35e72"]]);export{sa as default};
