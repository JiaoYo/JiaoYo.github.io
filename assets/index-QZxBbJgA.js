import{d as j,n as ee,r as L,z as Te,C as A,o as w,c as $,w as t,f as h,g as e,h as f,i as E,D as B,K as Ne,ad as ae,J as F,B as G,ae as te,af as se,M as O,N as H,S as K,O as le,P as oe,Q as ne,j as U,t as R,ac as W,p as Ue,e as Q,F as M,ag as ie,ah as Ie,ai as De,aj as Ee,a0 as z,I as J,ak as Ve,al as Pe,am as re,an as ue,ao as Me,ap as ce,aq as de,ar as qe,as as Be,Y,at as me,au as Re,G as Ge,av as Oe,aw as je,ax as Fe,ay as Le,L as Ae,az as ze,aA as He}from"./index-DLQv0xE2.js";import{f as Je,a as We,b as Ke,c as Qe,d as Ye,e as Xe,g as Ze,h as et,i as tt,j as nt,k as at,l as st,m as lt,n as ot,o as it,p as rt,q as ut,r as ct,s as dt,t as mt,u as pt,v as _t,w as ft,x as gt,y as vt}from"./basic-config-CEkgV-Zf.js";import{M as yt}from"./shield-question-outline-rounded-sBztpNhz.js";import{_ as pe}from"./Table-D7I_PP_1.js";import{f as _e}from"./reportForm-xxvjNrTv.js";import{f as fe}from"./scheduleTask-BJ0xPBii.js";import{_ as bt}from"./DatePicker-ot9WJ_VW.js";import{_ as ge}from"./TimePicker-B5ZvLBUm.js";import{u as ve}from"./table-Dfen2niS.js";import{N as ht}from"./Popconfirm-G8CimJZQ.js";import{_ as wt,a as kt}from"./close-small-rounded-Bo8eLNlW.js";import{_ as xt}from"./Upload-BXVBIdnZ.js";import{u as Ct}from"./usePageData-C1R2XfJK.js";import{f as $t}from"./events-CypAcclL.js";import"./defineProperty-BYTHWXAG.js";import"./Progress-dtt87LR8.js";const ye=D=>(le("data-v-8912ff50"),D=D(),oe(),D),St={class:"flex justify-center"},Tt=ye(()=>h("span",{class:"font-bold"},"提示：",-1)),Nt=ye(()=>h("span",{style:{"text-decoration":"underline"}},"被锁定的账号会在设定的时间周期后自动解锁",-1)),Ut=j({name:"basicConfig",__name:"basicConfig",setup(D){const{formRef:c,validate:k,restoreValidation:i}=ee(),l=L(v());function v(){return{enablelock:1,locktime:5,lockcount:3,unlockeanble:1,unlocktime:5,aceffective:1,pwdexpire:1,expiretime:1,whiteenable:1,cputhreshold:80,memthreshold:80,captcha:1,tokentime:30}}const o={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},N={locktime:o,lockcount:o,unlocktime:o,expiretime:o,cputhreshold:o,memthreshold:o,tokentime:o},b=async()=>{const{data:d,error:n}=await Je();n||(Object.assign(l,d),l.locktime=d.locktime/60,l.unlocktime=d.unlocktime/60/24)};Te(()=>{b()});const a=async()=>{var u;const d=l.locktime*60,n=l.unlocktime*60*24;await k();const{error:g}=await We({...l,locktime:d,unlocktime:n});g||(u=window.$message)==null||u.success("设置成功")};return(d,n)=>{const g=Ne,u=ae,m=F,p=G,y=te,x=se,S=O,C=H,s=K,_=A("no-auth");return w(),$(s,{style:{"max-height":"calc(100vh - 245px)"}},{default:t(()=>[h("div",St,[e(C,{ref_key:"formRef",ref:c,"label-width":180,"label-placement":"left",model:l,rules:N},{default:t(()=>[e(m,{label:"是否开启自动解锁",path:"unlockeanble"},{label:t(()=>[f(" 是否开启自动解锁 "),e(g,{trigger:"hover",placement:"top","content-style":"padding: 5px;"},{trigger:t(()=>[e(E(yt),{class:"text-xl cursor-pointer c-#7a7b78"})]),default:t(()=>[Tt,Nt]),_:1})]),default:t(()=>[e(u,{value:l.unlockeanble,"onUpdate:value":n[0]||(n[0]=r=>l.unlockeanble=r),disabled:"","checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(m,{label:"解锁时间",path:"unlocktime"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(p,{onClick:n[1]||(n[1]=r=>l.unlocktime--),disabled:l.unlocktime==1},{default:t(()=>[f(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:l.unlocktime,"onUpdate:value":n[2]||(n[2]=r=>l.unlocktime=r),placeholder:"",min:1,max:3},null,8,["value"]),e(p,{onClick:n[3]||(n[3]=r=>l.unlocktime++),class:"mr-5px",disabled:l.unlocktime==3},{default:t(()=>[f(" + ")]),_:1},8,["disabled"]),f(" 天 ")]),_:1})]),_:1}),e(m,{label:"是否开启验证码",path:"captcha"},{default:t(()=>[e(u,{value:l.captcha,"onUpdate:value":n[4]||(n[4]=r=>l.captcha=r),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(m,{label:"是否开启白名单",path:"whiteenable"},{default:t(()=>[e(u,{value:l.whiteenable,"onUpdate:value":n[5]||(n[5]=r=>l.whiteenable=r),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),e(m,{label:"密码过期时间",path:"expiretime"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(p,{onClick:n[6]||(n[6]=r=>l.expiretime--),disabled:l.expiretime==1},{default:t(()=>[f(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:l.expiretime,"onUpdate:value":n[7]||(n[7]=r=>l.expiretime=r),placeholder:"",min:1,max:90},null,8,["value"]),e(p,{onClick:n[8]||(n[8]=r=>l.expiretime++),class:"mr-5px",disabled:l.expiretime==90},{default:t(()=>[f(" + ")]),_:1},8,["disabled"]),f(" 天 ")]),_:1})]),_:1}),e(m,{label:"CPU阈值",path:"cputhreshold"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(p,{onClick:n[9]||(n[9]=r=>l.cputhreshold--),disabled:l.cputhreshold==0},{default:t(()=>[f(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:l.cputhreshold,"onUpdate:value":n[10]||(n[10]=r=>l.cputhreshold=r),placeholder:"",min:0,precision:0,max:100},null,8,["value"]),e(p,{onClick:n[11]||(n[11]=r=>l.cputhreshold++),disabled:l.cputhreshold==100,class:"mr-5px"},{default:t(()=>[f(" + ")]),_:1},8,["disabled"]),f(" % ")]),_:1})]),_:1}),e(m,{label:"MEM阈值",path:"memthreshold"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(p,{onClick:n[12]||(n[12]=r=>l.memthreshold--),disabled:l.memthreshold==0},{default:t(()=>[f(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:l.memthreshold,"onUpdate:value":n[13]||(n[13]=r=>l.memthreshold=r),placeholder:"",min:0,precision:0,max:100},null,8,["value"]),e(p,{onClick:n[14]||(n[14]=r=>l.memthreshold++),disabled:l.memthreshold==100,class:"mr-5px"},{default:t(()=>[f(" + ")]),_:1},8,["disabled"]),f(" % ")]),_:1})]),_:1}),e(m,{label:"token过期时间",path:"tokentime"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(p,{onClick:n[15]||(n[15]=r=>l.tokentime--),disabled:l.tokentime==1},{default:t(()=>[f(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:l.tokentime,"onUpdate:value":n[16]||(n[16]=r=>l.tokentime=r),placeholder:"",min:1},null,8,["value"]),e(p,{onClick:n[17]||(n[17]=r=>l.tokentime++),class:"mr-5px"},{default:t(()=>[f(" + ")]),_:1}),f(" 小时 ")]),_:1})]),_:1}),e(m,{label:" "},{default:t(()=>[e(S,null,{default:t(()=>[B((w(),$(p,{type:"default",ghost:"",onClick:b},{default:t(()=>[f(" 刷新 ")]),_:1})),[[_,"system.conf.select"]]),B((w(),$(p,{type:"info",ghost:"",onClick:a},{default:t(()=>[f(" 保存 ")]),_:1})),[[_,"system.conf.update"]])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})}}}),It=ne(Ut,[["__scopeId","data-v-8912ff50"]]),Dt=h("td",null,"产品名称",-1),Et=h("td",null,"产品版本",-1),Vt=h("td",null,"build号",-1),Pt=h("td",null,"产品型号",-1),Mt=j({name:"basicInfo",__name:"basicInfo",setup(D){const c=U({id:1,pname:"",pversion:"",pbuild:"",pmodel:""});(async()=>{const{data:v,error:o}=await Ke();o||(c.value=v)})(),U(0);const i=async()=>{var N,b;const{data:v,error:o}=await Qe();o||(v==="重启失败"?(N=window.$message)==null||N.error(v):(b=window.$message)==null||b.success(v))},l=async()=>{var N,b;const{data:v,error:o}=await Ye();o||(v==="关机失败"?(N=window.$message)==null||N.error(v):(b=window.$message)==null||b.success(v))};return(v,o)=>{const N=pe,b=G,a=O,d=W,n=A("no-auth");return w(),$(d,{class:"w-600px text-center m-auto mt-20px"},{default:t(()=>[e(N,{bordered:!0,"single-line":!1},{default:t(()=>[h("tbody",null,[h("tr",null,[Dt,h("td",null,R(c.value.pname||""),1)]),h("tr",null,[Et,h("td",null,R(c.value.pversion),1)]),h("tr",null,[Vt,h("td",null,R(c.value.pbuild),1)]),h("tr",null,[Pt,h("td",null,R(c.value.pmodel),1)])])]),_:1}),e(a,{justify:"center",class:"mt-50px"},{default:t(()=>[B((w(),$(b,{type:"info",ghost:"",onClick:i},{default:t(()=>[f("重启")]),_:1})),[[n,"sysmanger.basicInfo.restart"]]),B((w(),$(b,{type:"info",ghost:"",onClick:l},{default:t(()=>[f("关机")]),_:1})),[[n,"sysmanger.basicInfo.shutdown"]])]),_:1})]),_:1})}}}),qt=j({name:"emailService",__name:"emailSever",setup(D){const{createConfirmPwdRule:c,defaultRequiredRule:k,patternRules:i}=Ue(),{formRef:l,validate:v}=ee(),o=U({port:null,pwd:"",sendserver:"",essl:0,uname:""}),N={sendserver:[{required:!0,validator:(C,s,_)=>s?Ie(s)?_():_(new Error("请输入正确的IP地址或域名")):new Error("请输入服务器地址"),trigger:["blur","input"]}],port:{type:"number",required:!0,trigger:["blur","input"],validator:(C,s,_)=>s==null||s==null?new Error("请输入端口号"):De(s)?!0:new Error("请输入在0-65535之间的数字")},uname:[{required:!0,message:"请输入账号",trigger:"blur"}],pwd:[{required:!0,message:"请输入密码",trigger:"blur"}],sendaddr:[{required:!0,message:"请输入发件邮箱",trigger:["blur","input"]},{validator:Ee,trigger:["blur","input"]}]},b=U(!1),a=L({pwd:""}),d={pwd:[{required:!0,message:"请输入密码",trigger:"blur"},i.passwordL]},n=()=>{a.pwd="",b.value=!0},g=U(),u=U(!1),m=async()=>{var r,I;await((r=g.value)==null?void 0:r.validate());const C=z(a.pwd),{data:s,error:_}=await Xe({pwd:C});_||(s!=null&&s.id||(I=window.$message)==null||I.warning("未查询到邮件服务,请先添加邮件服务"),o.value.sendserver=(s==null?void 0:s.sendserver)??o.value.sendserver,o.value.port=(s==null?void 0:s.port)??o.value.port,o.value.pwd=(s==null?void 0:s.pwd)??o.value.pwd,o.value.essl=(s==null?void 0:s.essl)??o.value.essl,o.value.uname=(s==null?void 0:s.uname)??o.value.uname,o.value.id=(s==null?void 0:s.id)??o.value.id,u.value=!0,b.value=!1)},p=async()=>{var _,r,I,V;await v();const C=z(o.value.pwd),s=z(o.value.uname);if(o.value.id){const{data:T,error:q}=await Ze({...o.value,pwd:C,uname:s});q||((_=window.$message)==null||_.destroyAll(),(r=window.$message)==null||r.success("保存成功"),m())}else{const{data:T,error:q}=await et({...o.value,pwd:C,uname:s});q||((I=window.$message)==null||I.destroyAll(),(V=window.$message)==null||V.success("保存成功"),m())}},y=async()=>{var _,r;const{data:C,error:s}=await tt();s||((_=window.$message)==null||_.destroyAll(),(r=window.$message)==null||r.success("重置成功"),o.value={port:null,pwd:"",sendserver:"",essl:0,uname:"",id:void 0})},x=U(!1),S=async()=>{var _,r;const C=z(o.value.pwd),s=z(o.value.uname);await v();try{x.value=!0;const{data:I,error:V}=await nt({...o.value,pwd:C,uname:s});V||((_=window.$message)==null||_.destroyAll(),(r=window.$message)==null||r.success("测试成功"))}finally{x.value=!1}};return(C,s)=>{const _=J,r=F,I=te,V=ae,T=H,q=G,be=O,he=J,we=F,ke=H,xe=K,Ce=G,$e=O,Se=Ve,Z=A("no-auth");return w(),Q(ie,null,[e(T,{ref_key:"formRef",ref:l,"label-width":150,model:o.value,rules:N,"label-placement":"left",class:"w-400px",style:{margin:"50px auto"}},{default:t(()=>[e(r,{label:"发送邮件服务器",path:"sendserver"},{default:t(()=>[e(_,{value:o.value.sendserver,"onUpdate:value":s[0]||(s[0]=P=>o.value.sendserver=P),placeholder:"输入服务器或IP地址"},null,8,["value"])]),_:1}),e(r,{label:"端口",path:"port"},{default:t(()=>[e(I,{value:o.value.port,"onUpdate:value":s[1]||(s[1]=P=>o.value.port=P),placeholder:"输入端口",style:{width:"100%"}},null,8,["value"])]),_:1}),e(r,{label:"用户名",path:"uname"},{default:t(()=>[e(_,{value:o.value.uname,"onUpdate:value":s[2]||(s[2]=P=>o.value.uname=P),placeholder:"用户名"},null,8,["value"])]),_:1}),e(r,{label:"密码",path:"pwd"},{default:t(()=>[e(_,{type:"password",value:o.value.pwd,"onUpdate:value":s[3]||(s[3]=P=>o.value.pwd=P),placeholder:"密码","show-password-on":"click"},null,8,["value"])]),_:1}),e(r,{label:"ssl",path:"essl"},{default:t(()=>[e(V,{value:o.value.essl,"onUpdate:value":s[4]||(s[4]=P=>o.value.essl=P),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"]),e(be,{justify:"center"},{default:t(()=>[e(q,{type:"info",ghost:"",onClick:n},{default:t(()=>[f("查询")]),_:1}),u.value?B((w(),$(q,{key:0,type:"info",ghost:"",onClick:S},{default:t(()=>[f("测试")]),_:1})),[[Z,"sysmanger.basicInfo.test.mailInfo"]]):M("",!0),u.value?B((w(),$(q,{key:1,type:"info",ghost:"",onClick:p},{default:t(()=>[f("保存")]),_:1})),[[Z,"sysmanger.mailInfo.update"]]):M("",!0),u.value?B((w(),$(q,{key:2,type:"info",ghost:"",onClick:y},{default:t(()=>[f("重置")]),_:1})),[[Z,"sysmanger.mailInfo.delete"]]):M("",!0)]),_:1}),e(Se,{show:b.value,"onUpdate:show":s[6]||(s[6]=P=>b.value=P),title:"查询邮件地址",preset:"card",class:"w-420px"},{footer:t(()=>[e($e,{justify:"center",size:16},{default:t(()=>[e(Ce,{type:"primary",onClick:m},{default:t(()=>[f(R(C.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(xe,{class:"max-h-480px pr-20px"},{default:t(()=>[e(ke,{ref_key:"checkformRef",ref:g,model:a,"label-placement":"left",rules:d,"label-width":80,"require-mark-placement":"left"},{default:t(()=>[e(we,{label:C.$t("page.login.common.password"),path:"pwd"},{default:t(()=>[e(he,{type:"password","show-password-on":"click",class:"eipaddrCss",clearable:"",value:a.pwd,"onUpdate:value":s[5]||(s[5]=P=>a.pwd=P),placeholder:"请输入当前登录账号密码"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])],64)}}}),Bt=j({name:"TimingConfig",__name:"timingConfig",setup(D){const{formRef:c,validate:k}=ee(),i=L({automatic:1,time:Pe(1,new Date),ip:"",taskId:"",showCron:!1,setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),l={time:{required:!0,message:"请选择时间",trigger:"blur"},ip:[{required:!0,message:"请输入IP",trigger:"blur"},{validator:Me,trigger:"blur"}],task:{required:!0,message:"请设置表达式",trigger:"blur"},setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:"blur"},settingCycleValue:{type:"number",required:!0,message:"请选择设置周期值",trigger:"blur"},settingTime:{required:!0,message:"请选择设置时间",trigger:"blur"}}},v=async()=>{const{data:b,error:a}=await at();a||(i.time=b)};v(),(async()=>{const{data:b,error:a}=await st();if(a)return;const{id:d,params:n}=b;try{if(n){const{cron:g,ip:u}=JSON.parse(n),m=ce(g);i.setting.settingCycle=m==null?void 0:m.settingCycle,i.setting.settingTime=m==null?void 0:m.settingTime,i.setting.settingCycleValue=m==null?void 0:m.settingCycleValue,i.ip=u,i.taskId=d}}catch(g){console.error("Error parsing params:",g)}})();const N=async()=>{var b,a;if(await k(),i.automatic){const{data:d,error:n}=await lt({dtime:i.time});n||(b=window.$message)==null||b.success(d)}else{const d=de(i.setting.settingCycle==1?{dayOfWeek:i.setting.settingCycleValue,time:i.setting.settingTime}:null,i.setting.settingCycle==2?{dayOfMonth:i.setting.settingCycleValue,time:i.setting.settingTime}:null,i.setting.settingCycle==3?{time:i.setting.settingTime}:null);i.taskId?await fe({id:i.taskId,beanName:"NtpTask",cronExpression:d,remark:"",status:1,params:JSON.stringify({ip:i.ip,cron:d})}):await _e({beanName:"NtpTask",cronExpression:d,remark:"",status:1,params:JSON.stringify({ip:i.ip,cron:d})});const{data:n,error:g}=await ot({ip:i.ip});g||(a=window.$message)==null||a.success(n)}};return(b,a)=>{const d=qe,n=O,g=Be,u=F,m=bt,p=J,y=Y,x=ge,S=G,C=H,s=A("no-auth");return w(),$(C,{ref_key:"formRef",ref:c,"label-width":180,"label-placement":"left",model:i,class:"m-auto w-600px mt-20px",rules:l},{default:t(()=>[e(u,{label:"校时",path:"enablelock"},{default:t(()=>[e(g,{value:i.automatic,"onUpdate:value":a[0]||(a[0]=_=>i.automatic=_),name:"radiogroup"},{default:t(()=>[e(n,null,{default:t(()=>[e(d,{value:1},{default:t(()=>[f("手动校时")]),_:1}),e(d,{value:0},{default:t(()=>[f("自动校时")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),i.automatic?(w(),$(u,{key:0,label:"设置中心服务器时间",path:"time"},{default:t(()=>[e(m,{"formatted-value":i.time,"onUpdate:formattedValue":a[1]||(a[1]=_=>i.time=_),format:"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:""},null,8,["formatted-value"])]),_:1})):M("",!0),i.automatic?M("",!0):(w(),Q(ie,{key:1},[e(u,{label:"NTP服务器设置",path:"ip"},{default:t(()=>[e(p,{value:i.ip,"onUpdate:value":a[2]||(a[2]=_=>i.ip=_),placeholder:"输入NTP服务器设置",style:{width:"200px"}},null,8,["value"])]),_:1}),e(u,{label:"设置周期",path:"setting.settingCycle"},{default:t(()=>[e(n,{justify:"space-between"},{default:t(()=>[e(y,{value:i.setting.settingCycle,"onUpdate:value":[a[3]||(a[3]=_=>i.setting.settingCycle=_),a[4]||(a[4]=_=>i.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"200px"}},null,8,["value"]),e(u,{label:"",path:"setting.settingCycleValue","show-feedback":!1},{default:t(()=>[e(n,null,{default:t(()=>[i.setting.settingCycle==1?(w(),$(y,{key:0,value:i.setting.settingCycleValue,"onUpdate:value":a[5]||(a[5]=_=>i.setting.settingCycleValue=_),options:E(re)(),style:{width:"200px"}},null,8,["value","options"])):M("",!0),i.setting.settingCycle==2?(w(),$(y,{key:1,value:i.setting.settingCycleValue,"onUpdate:value":a[6]||(a[6]=_=>i.setting.settingCycleValue=_),options:E(ue)(),style:{width:"200px"}},null,8,["value","options"])):M("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{label:"设置时间",path:"setting.settingTime"},{default:t(()=>[e(x,{"formatted-value":i.setting.settingTime,"onUpdate:formattedValue":a[7]||(a[7]=_=>i.setting.settingTime=_)},null,8,["formatted-value"])]),_:1})],64)),e(u,null,{label:t(()=>[i.automatic?B((w(),$(S,{key:0,type:"info",ghost:"",onClick:v},{default:t(()=>[f(" 查看服务器时间 ")]),_:1})),[[s,"sysmanger.basicInfo.gettiming"]]):M("",!0)]),default:t(()=>[e(n,null,{default:t(()=>[B((w(),$(S,{type:"info",ghost:"",onClick:N},{default:t(()=>[f(" 保存 ")]),_:1})),[[s,"sysmanger.basicInfo.manu.timing"]])]),_:1})]),_:1})]),_:1},8,["model"])}}}),Rt=j({name:"dataBase",__name:"dataBase",setup(D){const c=()=>[...Array(12).keys()].map(u=>({label:`${u+1}个月`,value:u+1})),k=L({space:80,retention:void 0,id:void 0}),{columns:i,columnChecks:l,data:v,getData:o,loading:N,mobilePagination:b,searchParams:a,resetSearchParams:d}=ve({apiFn:it,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center"}]});(async()=>{const{data:u,error:m}=await rt();m||(k.space=u.space,k.retention=u.retention,k.id=u.id)})();const g=async()=>{var p;const{data:u,error:m}=await ut({space:k.space,retention:k.retention,id:k.id});m||(p=window.$message)==null||p.success("保存成功")};return(u,m)=>{const p=G,y=te,x=se,S=F,C=Y,s=O,_=W,r=me,I=K,V=A("no-auth");return w(),$(I,{class:"h-full flex-col",style:{maxHeight:"calc(100vh - 220px)"}},{default:t(()=>[e(_,{title:"数据库维护配置",bordered:!1,class:"mb-20px","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:t(()=>[e(s,{class:"ml-50px"},{default:t(()=>[e(S,{label:"已用空间超过","label-placement":"left"},{default:t(()=>[e(x,{class:"flex items-center"},{default:t(()=>[e(p,{onClick:m[0]||(m[0]=T=>k.space--),disabled:k.space==1},{default:t(()=>[f(" − ")]),_:1},8,["disabled"]),e(y,{"show-button":!1,value:k.space,"onUpdate:value":m[1]||(m[1]=T=>k.space=T),placeholder:"",min:1,max:100,style:{width:"100px","text-align":"center"}},null,8,["value"]),e(p,{onClick:m[2]||(m[2]=T=>k.space++),disabled:k.space==100,class:"mr-5px"},{default:t(()=>[f(" + ")]),_:1},8,["disabled"]),f(" % 时自动维护 ")]),_:1})]),_:1}),e(S,{label:"数据保留时间","label-placement":"left",class:"mx-20px"},{default:t(()=>[e(C,{value:k.retention,"onUpdate:value":m[3]||(m[3]=T=>k.retention=T),placeholder:"请选择",options:c(),style:{width:"150px"}},null,8,["value","options"])]),_:1}),e(S,{label:" ","label-placement":"left"},{default:t(()=>[B((w(),$(p,{type:"info",ghost:"",onClick:g},{default:t(()=>[f("保存")]),_:1})),[[V,"sysmanger.basicInfo.insert.dataBaseMaintenance"]])]),_:1})]),_:1})]),_:1}),e(_,{title:"数据库维护列表",bordered:!1,class:"flex-1","content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:t(()=>[e(r,{columns:E(i),data:E(v),size:"small","scroll-x":462,"max-height":420,loading:E(N),remote:"","row-key":T=>T.id,pagination:E(b),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})]),_:1})}}}),Gt=j({name:"systemSnapshot",__name:"systemSnapshot",setup(D){const{columns:c,columnChecks:k,data:i,getData:l,loading:v,mobilePagination:o,searchParams:N,resetSearchParams:b}=ve({apiFn:ct,immediate:!0,apiParams:{page:1,limit:20},columns:()=>[{title:"时间",key:"dbtime",align:"center"},{title:"描述",key:"dmsg",align:"center"},{title:"结果",key:"resultmsg",align:"center",render:p=>e(Re,{type:p.resultmsg==1?"error":"success"},{default:()=>[p.resultmsg==1?"失败":"成功"]})},{title:"操作",key:"operate",align:"center",width:100,fixed:"right",render:p=>e(ht,{onPositiveClick:()=>m(p.id)},{default:()=>"确定恢复吗?恢复后将重启系统",trigger:()=>e(G,{type:"info",ghost:!0,size:"small"},{default:()=>[f("恢复")]})})}]}),a=L({id:"",setting:{settingCycle:void 0,settingCycleValue:void 0,settingTime:void 0}}),d=U(a),n={setting:{settingCycle:{type:"number",required:!0,message:"请选择设置周期",trigger:["blur","change"]},settingCycleValue:{type:"number",required:!1,message:"请选择设置周期值",trigger:["blur","change"]},settingTime:{required:!0,message:"请选择设置时间",trigger:["blur","change"]}}};(async()=>{const{data:p,error:y}=await dt();if(y)return;console.log(p,"asdas");const x=ce(p.cronExpression);Object.assign(a,{id:p.id,setting:x})})();const u=async()=>{var y,x,S;await((y=d.value)==null?void 0:y.validate());const p=de(a.setting.settingCycle==1?{dayOfWeek:a.setting.settingCycleValue,time:a.setting.settingTime}:null,a.setting.settingCycle==2?{dayOfMonth:a.setting.settingCycleValue,time:a.setting.settingTime}:null,a.setting.settingCycle==3?{time:a.setting.settingTime}:null);if(a.id){const{data:C,error:s}=await fe({id:a.id,beanName:"SnapshotTask",cronExpression:p,status:1,params:JSON.stringify({corn:p})});s||(x=window.$message)==null||x.success("设置成功")}else{const{data:C,error:s}=await _e({beanName:"SnapshotTask",cronExpression:p,remark:"",status:1,params:JSON.stringify({corn:p})});s||(S=window.$message)==null||S.success("设置成功")}},m=async p=>{var S;const{data:y,error:x}=await mt({id:p});x||(S=window.$message)==null||S.success("恢复成功")};return(p,y)=>{const x=Y,S=F,C=O,s=ge,_=H,r=W,I=me,V=K;return w(),$(V,{class:"h-full flex-col",style:{maxHeight:"calc(100vh - 220px)"}},{default:t(()=>[e(r,{title:"应用配置设置",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"}},{default:t(()=>[e(C,{class:"ml-50px"},{default:t(()=>[e(_,{"label-placement":"left",inline:"",model:a,rules:n,ref_key:"formRef",ref:d,"label-width":150,class:"px-100px"},{default:t(()=>[e(S,{label:"设置周期",path:"setting.settingCycle"},{default:t(()=>[e(C,{justify:"space-between"},{default:t(()=>[e(x,{value:a.setting.settingCycle,"onUpdate:value":[y[0]||(y[0]=T=>a.setting.settingCycle=T),y[1]||(y[1]=T=>a.setting.settingCycleValue=1)],options:[{label:"每周",value:1},{label:"每月",value:2},{label:"每日",value:3}],style:{width:"140px"}},null,8,["value"]),e(S,{label:"",path:"","show-feedback":!1},{default:t(()=>[a.setting.settingCycle==1?(w(),$(x,{key:0,value:a.setting.settingCycleValue,"onUpdate:value":y[2]||(y[2]=T=>a.setting.settingCycleValue=T),options:E(re)(),style:{width:"140px"}},null,8,["value","options"])):M("",!0),a.setting.settingCycle==2?(w(),$(x,{key:1,value:a.setting.settingCycleValue,"onUpdate:value":y[3]||(y[3]=T=>a.setting.settingCycleValue=T),options:E(ue)(),style:{width:"140px"}},null,8,["value","options"])):M("",!0)]),_:1})]),_:1})]),_:1}),e(S,{label:"设置时间",path:"setting.settingTime"},{default:t(()=>[e(s,{"formatted-value":a.setting.settingTime,"onUpdate:formattedValue":y[4]||(y[4]=T=>a.setting.settingTime=T)},null,8,["formatted-value"])]),_:1}),e(S,{label:" ","label-placement":"left"},{default:t(()=>[e(E(G),{type:"info",ghost:"",onClick:u},{default:t(()=>[f("保存")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(r,{title:"应用配置列表",bordered:!1,"content-style":{padding:"0"},"header-style":{paddingTop:"0"},class:"flex-1"},{default:t(()=>[e(I,{columns:E(c),data:E(i),size:"small","scroll-x":462,"max-height":420,loading:E(v),remote:"","row-key":T=>T.id,pagination:E(o),class:"sm:h-full"},null,8,["columns","data","loading","row-key","pagination"])]),_:1})]),_:1})}}}),X=D=>(le("data-v-358c56bb"),D=D(),oe(),D),Ot={class:"flex-col justify-between h-100%"},jt={class:"flex"},Ft=X(()=>h("td",null,"序列号",-1)),Lt=X(()=>h("td",null,"创建时间",-1)),At=X(()=>h("td",null,"有效时间",-1)),zt=X(()=>h("td",null,"可配置采集器数量",-1)),Ht=j({__name:"LicenseConfig",setup(D){const c=U(""),k=U(null),i=({file:n})=>{k.value=n.file,c.value=n.name},l=n=>{n.stopPropagation(),c.value="",k.value=null},v=U({num:"",dbtime:"",collnum:"",efftime:0}),o=U(""),N=async()=>{var n;try{const{data:g}=await pt();o.value=g}catch(g){(n=window.$message)==null||n.error("获取机器码失败"),console.error("获取机器码失败",g)}};N();const b=()=>{const n=new Oe("#copyMachineCodeBtn",{text:()=>o.value});n.on("success",g=>{var u;console.log("复制成功:",g.text),(u=window.$message)==null||u.success("复制成功"),g.clearSelection(),n.destroy()}),n.on("error",g=>{var u;console.error("复制失败:",g),(u=window.$message)==null||u.error("复制失败，请重试"),n.destroy()})},a=async()=>{try{const{data:n}=await _t();v.value=n}catch(n){console.error("获取 License 失败",n)}};a();const d=async()=>{var n,g;if(!c.value.endsWith(".lic"))return(n=window.$message)==null?void 0:n.error("请上传.lic文件");try{const u=new FormData;u.append("fi",k.value);const{data:m,error:p}=await ft(u);if(p)return;(g=window.$message)==null||g.success(m),a(),c.value="",k.value=null}catch(u){console.error("上传失败",u)}};return(n,g)=>{const u=G,m=J,p=O,y=wt,x=kt,S=xt,C=F,s=pe,_=O;return w(),$(_,{justify:"center",class:"pt-20px important-flex-col items-center"},{default:t(()=>{var r;return[e(p,{class:"mb-20px"},{default:t(()=>[h("div",Ot,[e(u,{type:"info",ghost:"",onClick:N},{default:t(()=>[f("查看机器码")]),_:1}),e(u,{id:"copyMachineCodeBtn",type:"success",ghost:"",onClick:b},{default:t(()=>[f(" 复制 ")]),_:1})]),e(m,{value:o.value,"onUpdate:value":g[0]||(g[0]=I=>o.value=I),readonly:"",type:"textarea",style:{width:"340px"},placeholder:"机器码"},null,8,["value"])]),_:1}),h("div",jt,[e(C,{label:"License管理","label-placement":"left"},{default:t(()=>[e(S,{action:"","custom-request":i,"show-file-list":!1,accept:".lic"},{default:t(()=>[c.value?(w(),Q("div",{key:0,onClick:g[1]||(g[1]=Ge(()=>{},["stop"]))},[f(R(c.value)+" ",1),e(y,{class:"font-size-30px cursor-pointer",onClick:l})])):(w(),$(u,{key:1},{icon:t(()=>[e(x,{class:"text-icon"})]),default:t(()=>[f(" 选择文件")]),_:1}))]),_:1})]),_:1}),e(C,{label:"","label-placement":"left",class:"ml-20px"},{default:t(()=>[e(u,{type:"info",ghost:"",disabled:!c.value,onClick:d},{default:t(()=>[f("上传")]),_:1},8,["disabled"])]),_:1})]),(r=v.value)!=null&&r.num?(w(),$(s,{key:0,bordered:!0,"single-line":!1,class:"w-800px text-center m-auto mt-20px"},{default:t(()=>{var I,V,T,q;return[h("tbody",null,[h("tr",null,[Ft,h("td",null,R(((I=v.value)==null?void 0:I.num)||""),1)]),h("tr",null,[Lt,h("td",null,R((V=v.value)==null?void 0:V.dbtime),1)]),h("tr",null,[At,h("td",null,R(((T=v.value)==null?void 0:T.efftime)==0?"永久":`${(q=v.value)==null?void 0:q.efftime}年`),1)]),h("tr",null,[zt,h("td",null,R(v.value.collnum),1)])])]}),_:1})):M("",!0)]}),_:1})}}}),Jt=ne(Ht,[["__scopeId","data-v-358c56bb"]]),Wt=j({__name:"sysStatus",setup(D){const c=L({mailaddr:"",snmpaddr:void 0,stype:0,tmail:0,tsnmp:0});(async()=>{const{data:a,error:d}=await gt();d||(c.mailaddr=(a==null?void 0:a.mailaddr)??c.mailaddr,c.snmpaddr=(a==null?void 0:a.snmpaddr)??c.snmpaddr,c.stype=(a==null?void 0:a.stype)??c.stype,c.tmail=(a==null?void 0:a.tmail)??c.tmail,c.tsnmp=(a==null?void 0:a.tsnmp)??c.tsnmp)})();const i=async()=>{var n;const{data:a,error:d}=await vt(c);d||(n=window.$message)==null||n.success("保存成功")},{pageData:l,getData:v,nextPage:o}=Ct($t),N=async a=>{const d=a.currentTarget;d.scrollTop+d.offsetHeight>=d.scrollHeight&&l.data.length<l.total&&o()},b=U();return je(()=>l.data,a=>{a&&(b.value=a.filter(d=>d.ftype===1))}),v(),(a,d)=>{const n=Le,g=Ae,u=J,m=F,p=Y,y=G,x=O,S=W,C=A("no-auth");return w(),$(x,{justify:"center"},{default:t(()=>[e(S,{title:"通知方式",class:"w-600px"},{default:t(()=>[e(n),e(g,{checked:c.tmail,"onUpdate:checked":d[0]||(d[0]=s=>c.tmail=s),"checked-value":1,"unchecked-value":0},{default:t(()=>[f(" 邮件 ")]),_:1},8,["checked"]),c.tmail?(w(),$(m,{key:0,label:"邮件地址","label-placement":"left","label-width":"120",class:"mt-30px",rule:{required:!0,validator:()=>{if(!c.mailaddr)return new Error("请输入邮件地址");if(!E(Fe)(c.mailaddr))return new Error("请输入正确的邮件地址")},trigger:["blur","input"]}},{default:t(()=>[e(u,{value:c.mailaddr,"onUpdate:value":d[1]||(d[1]=s=>c.mailaddr=s)},null,8,["value"])]),_:1},8,["rule"])):M("",!0),e(n),e(g,{checked:c.tsnmp,"onUpdate:checked":d[2]||(d[2]=s=>c.tsnmp=s),"checked-value":1,"unchecked-value":0},{default:t(()=>[f(" snmp trap ")]),_:1},8,["checked"]),c.tsnmp?(w(),$(m,{key:1,label:"通知服务器","label-placement":"left","label-width":"120",class:"mt-30px"},{default:t(()=>[e(p,{value:c.snmpaddr,"onUpdate:value":d[3]||(d[3]=s=>c.snmpaddr=s),options:b.value,"label-field":"ipaddr","value-field":"ipaddr",onScroll:N},null,8,["value","options"])]),_:1})):M("",!0),e(n),e(x,{justify:"end"},{default:t(()=>[B((w(),$(y,{type:"info",ghost:"",onClick:i},{default:t(()=>[f("保存")]),_:1})),[[C,"sysmanger.basicInfo.alarmNotification"]])]),_:1})]),_:1})]),_:1})}}}),Kt={class:"h-full"},Qt=j({name:"basicconfig_system-config",__name:"index",setup(D){const c=U("基本信息");return U(""),U(null),U(0),U(!1),(k,i)=>{const l=ze,v=He,o=W;return w(),Q("div",Kt,[e(o,{style:{"margin-bottom":"16px"},class:"h-full","content-style":{height:"100%"}},{default:t(()=>[e(v,{type:"card",animated:"",class:"h-100%",value:c.value,"onUpdate:value":i[0]||(i[0]=N=>c.value=N)},{default:t(()=>[e(l,{name:"基本信息",tab:"基本信息"},{default:t(()=>[e(Mt)]),_:1}),e(l,{name:"安全设置",tab:"安全设置"},{default:t(()=>[e(It)]),_:1}),e(l,{name:"邮件服务",tab:"邮件服务"},{default:t(()=>[e(qt)]),_:1}),e(l,{name:"校时配置",tab:"校时配置"},{default:t(()=>[e(Bt)]),_:1}),e(l,{name:"数据库维护",tab:"数据库维护",class:"h-100%"},{default:t(()=>[e(Rt)]),_:1}),e(l,{name:"应用配置备份",tab:"应用配置备份",class:"h-100%"},{default:t(()=>[e(Gt)]),_:1}),e(l,{name:"License管理",tab:"License管理"},{default:t(()=>[e(Jt)]),_:1}),e(l,{name:"系统告警通知",tab:"系统告警通知"},{default:t(()=>[e(Wt)]),_:1})]),_:1},8,["value"])]),_:1})])}}}),_n=ne(Qt,[["__scopeId","data-v-f0de018c"]]);export{_n as default};
