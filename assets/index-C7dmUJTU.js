import{_ as ie}from"./round-add--_pSpbF_.js";import{d as W,at as te,q as X,c4 as de,v as ce,r as L,au as ae,a2 as ue,cl as pe,y as H,c as N,o as f,w as e,f as a,av as me,b as F,z as I,G as ne,A as fe,e as u,t as h,T as _e,D as M,h as l,C as ve,F as oe,cm as ge,B as S,g as z,a5 as he,a4 as be,ay as ye,s as we,U as se,aw as ke,N as le,$ as K,c0 as xe,b_ as De,aa as Y,M as Ce,i as Se,aB as Q,cn as Ne,ad as ze,aF as je}from"./index-DMk9ecAg.js";import{f as Pe,a as Te,b as Le,_ as $e,c as Ue,d as Re}from"./operate-drawer.vue_vue_type_style_index_0_lang-Ce3WKfau.js";import{u as Be,a as Fe}from"./table-C6eerTnn.js";import{_ as Me}from"./Avatar-BkzHb7bh.js";import{_ as Ie}from"./text-DB5ihSVv.js";import{N as re}from"./Popconfirm-ZXnEhqzl.js";import{_ as Ge}from"./round-search-D0NIJO1w.js";import{u as Z}from"./usePageData-KTtgYQ98.js";import{_ as Ee}from"./Grid-BIOqdWqR.js";import{_ as Ke}from"./FormItemGridItem-CblRT5zG.js";import{N as Ve}from"./DatePicker-BTriC2aG.js";import"./v4-FuVw324d.js";const Ae={key:0},Oe={class:"mt-4 border-t pt-3"},He={class:"flex items-start gap-2 mb-3"},qe={class:"ml-2 flex-1"},Je={class:"flex items-center"},Qe={class:"font-medium font-size-16px font-bold"},We={class:"text-gray-600 mt-1"},Xe=W({name:"drawerLog",__name:"drawerLog",props:te({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(b){const V=X();de();const t=ce({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0}),j=b,i={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},_=L({});async function v(){g.value=[],Object.assign(t,j.rowData);const r=JSON.parse(j.rowData.context);t.proname=r.proname,t.notes=r.notes,t.problem=r.problem,t.solutions=r.solutions,t.feedback=r.feedback,t.summarize=r.summarize,t.percent=r.percent,D()}const g=L([]),y=ae(b,"visible");ue(y,()=>{y.value?v():(g.value=[],t.id=void 0)});function G(r){r||w()}function w(){y.value=!1}const D=async()=>{const{data:r,error:o}=await Te({page:1,limit:100,pid:t.id});r&&(g.value=r.list)},$=pe.debounce(async()=>{var k;const r=_.value[t.id];if(!(r!=null&&r.trim()))return(k=window.$message)==null?void 0:k.warning("请输入评论内容");const{data:o,error:m}=await Pe([{pid:t.id,context:r}]);o&&(_.value[t.id]="",t.num++,D())},1e3,{leading:!0,trailing:!1}),E=async r=>{var k;const{data:o,error:m}=await Le(r.id);o&&(D(),t.num--,(k=window.$message)==null||k.success("删除成功"))};return(r,o)=>{const m=fe,k=ne,U=Me,R=Ie,P=me,T=ye,s=H("no-auth");return f(),N(T,{show:y.value,"onUpdate:show":[o[1]||(o[1]=n=>y.value=n),G],"display-directive":"show",width:600,onMaskClick:w,onEsc:w},{default:e(()=>[a(P,{title:t.username+"的项目日报","native-scrollbar":!1,closable:""},{default:e(()=>[a(k,{ref:"formRef",model:t},{default:e(()=>[t.proname?(f(),N(m,{key:0,label:"项目名称",path:"proname","label-placement":"left"},{label:e(()=>o[2]||(o[2]=[u("div",{class:"font-size-16px font-bold"},"项目名称：",-1)])),default:e(()=>[u("span",null,h(t.proname),1)]),_:1})):I("",!0),a(m,{label:"当前工作内容及成果描述",path:"notes"},{label:e(()=>o[3]||(o[3]=[u("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述：",-1)])),default:e(()=>[u("span",null,h(t.notes),1)]),_:1}),a(m,{label:"遇到问题",path:"problem"},{label:e(()=>o[4]||(o[4]=[u("div",{class:"font-size-16px font-bold"},"遇到问题：",-1)])),default:e(()=>[u("span",null,h(t.problem),1)]),_:1}),a(m,{label:"解决措施",path:"solutions"},{label:e(()=>o[5]||(o[5]=[u("div",{class:"font-size-16px font-bold"},"解决措施：",-1)])),default:e(()=>[u("span",null,h(t.solutions),1)]),_:1}),a(m,{label:"建议意见反馈",path:"feedback"},{label:e(()=>o[6]||(o[6]=[u("div",{class:"font-size-16px font-bold"},"建议意见反馈：",-1)])),default:e(()=>[u("span",null,h(t.feedback),1)]),_:1}),a(m,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:e(()=>o[7]||(o[7]=[u("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感：",-1)])),default:e(()=>[u("span",null,h(t.summarize),1)]),_:1})]),_:1},8,["model"]),t.num?(f(),F("div",Ae,h(t.num)+"评论",1)):I("",!0),a(_e,{name:"fade"},{default:e(()=>[u("div",Oe,[M((f(),F("div",He,[u("div",null,[a(U,{size:"small",src:i.avatar},null,8,["src"])]),a(l(ve),{type:"textarea",id:`comment-input-${t.id}`,value:_.value[t.id],"onUpdate:value":o[0]||(o[0]=n=>_.value[t.id]=n),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:oe(ge(l($),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),a(l(S),{type:"primary",ghost:"",onClick:l($)},{default:e(()=>o[8]||(o[8]=[z("发送")])),_:1,__:[8]},8,["onClick"])])),[[s,"project:Comment:insert"]]),(f(!0),F(he,null,be(g.value,n=>(f(),F("div",{key:n.id,class:"flex mb-3"},[a(U,{size:"small",src:i.avatar},null,8,["src"]),u("div",qe,[u("div",Je,[u("span",Qe,h(n.username),1),a(R,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:e(()=>[z(h(n.dbtime),1)]),_:2},1024),l(V).userInfo.id==n.creater?(f(),N(l(re),{key:0,onPositiveClick:C=>E(n)},{trigger:e(()=>[M((f(),N(l(S),{quaternary:"",type:"error",size:"small"},{default:e(()=>o[9]||(o[9]=[z(" 删除 ")])),_:1,__:[9]})),[[s,"project:Comment:delete"]])]),default:e(()=>[o[10]||(o[10]=z(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):I("",!0)]),u("div",We,h(n.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ye=W({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:te(["reset","search","clear","setPname"],["update:model"]),setup(b,{emit:V}){const t=V,{formRef:j}=we(),i=ae(b,"model");X();const _=L([]),{pageData:v,getData:g,nextPage:y}=Z(xe),G=async s=>{const n=s.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&v.data.length<v.total&&(y(),_.value=v.data)},{pageData:w,getData:D}=Z(De),$=async s=>{const n=s.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&v.data.length<v.total&&y()},E=async s=>{i.value.creater=s,t("search")},r=async s=>{var n;s&&(i.value.pid=s),t("search"),t("setPname",((n=_.value.find(C=>C.id==s))==null?void 0:n.proname)||"")},o=async s=>{await g({fuzzy:s,page:1}),_.value=v.data},m=async()=>{await g({page:1}),_.value=v.data};(async()=>{await g(),_.value=v.data,t("search")})(),D({usertypes:"0,1,2,3,4"});const U={当日:()=>{const s=new Date().getTime();return[s,s]},本周:()=>{const s=new Date().getTime();return[s-24*60*60*1e3*7,s]},上月:()=>{const s=new Date().getTime();return[s-24*60*60*1e3*30,s]}},R=L(null);async function P(s,n){n?(i.value.statrtTime=String(Y(0,n[0])),i.value.endTime=String(Y(0,n[1]))):(i.value.statrtTime=null,i.value.endTime=null),t("search")}async function T(){t("search")}return(s,n)=>{const C=ke,B=Ke,c=Ve,d=Ge,x=S,A=le,q=Ee,J=ne,O=se;return f(),N(O,{bordered:!1,size:"small",class:"card-wrapper"},{default:e(()=>[a(J,{ref_key:"formRef",ref:j,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:oe(T,["enter"])},{default:e(()=>[a(q,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:e(()=>[a(B,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:e(()=>[a(C,{filterable:"",clearable:"",value:i.value.pid,"onUpdate:value":[n[0]||(n[0]=p=>i.value.pid=p),r],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:_.value,onScroll:G,onClear:m,onSearch:o},null,8,["value","options"])]),_:1}),a(B,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:e(()=>[a(c,{value:R.value,"onUpdate:value":n[1]||(n[1]=p=>R.value=p),type:"daterange",clearable:"",class:"w-100%",shortcuts:U,"onUpdate:formattedValue":P},null,8,["value"])]),_:1}),a(B,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:e(()=>[a(C,{clearable:"",filterable:"",value:i.value.creater,"onUpdate:value":[n[2]||(n[2]=p=>i.value.creater=p),E],placeholder:"请选择","label-field":"username","value-field":"id",options:l(w).data,onScroll:$},null,8,["value","options"])]),_:1}),a(B,{span:"24  s:12 m:6",class:"pr-24px"},{default:e(()=>[a(A,{class:"w-full"},{default:e(()=>[a(x,{type:"primary",ghost:"",onClick:T},{icon:e(()=>[a(d,{class:"text-icon"})]),default:e(()=>[z(" "+h(l(K)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},et={key:0};function ee(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!je(b)}const ft=W({name:"projectmanagement_daylog",__name:"index",props:{pid:{default:void 0},type:{}},emits:["thereIsData"],setup(b,{emit:V}){const t=Ce(),j=X(),i=b,{columns:_,data:v,getData:g,loading:y,mobilePagination:G,searchParams:w}=Be({showTotal:!0,immediate:!1,apiFn:Ue,apiParams:{page:1,pageSize:20,limit:20,statrtTime:void 0,endTime:void 0,creater:void 0,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:c=>a("div",null,[c.username+"的项目日报"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:K("common.operate"),align:"center",width:140,fixed:"right",render:c=>{let d;return a("div",{class:"flex-center gap-8px"},[a(S,{type:"primary",ghost:!0,size:"small",onClick:()=>s(c)},{default:()=>[z("查看详情")]}),j.userInfo.id==c.creater&&M(a(S,{type:"primary",ghost:!0,size:"small",onClick:()=>R(c.id)},ee(d=K("common.edit"))?d:{default:()=>[d]}),[[H("no-auth"),"project:DailyReport:update"]]),j.userInfo.id==c.creater&&a(re,{onPositiveClick:()=>U(c.id)},{default:()=>K("common.confirmDelete"),trigger:()=>{let x;return M(a(S,{type:"error",ghost:!0,size:"small"},ee(x=K("common.delete"))?x:{default:()=>[x]}),[[H("no-auth"),"project:DailyReport:delete"]])}})])}}]}),{drawerVisible:D,operateType:$,editingData:E,handleAdd:r,handleEdit:o,checkedRowKeys:m,onDeleted:k}=Fe(v,g);async function U(c){const{data:d,error:x}=await Re(c);x||k()}function R(c){o(c)}const P=L(!1),T=L({}),s=c=>{P.value=!0,T.value=c},n=()=>{g()},C=L(""),B=c=>{C.value=c};return Se(()=>{i.type!="externalLiaison"}),(c,d)=>{const x=le,A=ie,q=ze,J=se,O=H("no-auth");return f(),F("div",Ze,[i.pid?I("",!0):(f(),N(Ye,{key:0,model:l(w),"onUpdate:model":d[0]||(d[0]=p=>Q(w)?w.value=p:null),onReset:n,onSearch:l(g),onSetPname:B},null,8,["model","onSearch"])),a(J,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Ne({header:e(()=>[a(x,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:e(()=>[i.pid?I("",!0):(f(),F("div",et,"项目日报"))]),_:1}),i.pid?M((f(),N(l(S),{key:0,onClick:l(r),size:"small",ghost:"",type:"primary"},{icon:e(()=>[a(A,{class:"text-icon"})]),default:e(()=>[d[4]||(d[4]=z(" "+h("新增")))]),_:1,__:[4]},8,["onClick"])),[[O,"project:DailyReport:insert"]]):I("",!0)]),default:e(()=>[a(q,{"checked-row-keys":l(m),"onUpdate:checkedRowKeys":d[1]||(d[1]=p=>Q(m)?m.value=p:null),columns:l(_),data:l(v),size:"small","flex-height":!l(t).isMobile,loading:l(y),remote:"","row-key":p=>p.id,pagination:l(G),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a($e,{visible:l(D),"onUpdate:visible":d[2]||(d[2]=p=>Q(D)?D.value=p:null),onSubmitted:l(g),"operate-type":l($),pname:C.value,pid:i.pid||l(w).pid,"row-data":l(E)},null,8,["visible","onSubmitted","operate-type","pname","pid","row-data"]),a(Xe,{visible:P.value,"onUpdate:visible":d[3]||(d[3]=p=>P.value=p),"row-data":T.value},null,8,["visible","row-data"])]),_:2},[i.pid?void 0:{name:"header-extra",fn:e(()=>[a(x,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:e(()=>[M((f(),N(l(S),{onClick:l(r),size:"small",ghost:"",type:"primary"},{icon:e(()=>[a(A,{class:"text-icon"})]),default:e(()=>[d[5]||(d[5]=z(" "+h("新增")))]),_:1,__:[5]},8,["onClick"])),[[O,"project:DailyReport:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{ft as default};
