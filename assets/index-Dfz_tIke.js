import{_ as se}from"./table-column-setting.vue_vue_type_script_setup_true_lang-1xkiS0kT.js";import{_ as ie}from"./export-Dh2VIFyh.js";import{_ as re}from"./round-delete-D4nIF9VA.js";import{_ as me}from"./round-add-CYQ1ae4I.js";import{d as L,p as E,q as H,r as ue,k as W,s as X,ab as J,b as ce,$ as d,o as j,c as F,w as t,g as e,h as _,t as D,i as n,ew as pe,ex as de,L as Y,aU as _e,P as G,aV as fe,ak as Z,Q as ee,B as N,aJ as ge,ey as ve,aE as ye,ez as he,a6 as te,eA as be,b7 as we,A as V,z as I,eB as xe,e as ke,aN as q,af as A,aO as Ne,aT as De}from"./index-l6uRvD6G.js";import{u as Ce,a as ze}from"./table-B2r-0quL.js";import{_ as Te}from"./lodash-Bh616pQ3.js";import{_ as ae}from"./FormItemGridItem-Bv-LD8wi.js";import{_ as ne}from"./Grid-CIemVqmw.js";import{_ as Se}from"./round-search-s7SA5XFz.js";import{_ as Ue}from"./round-refresh-CauTexCm.js";import{_ as $e}from"./DatePicker-DnMg5Hoe.js";import{e as Pe}from"./exportExcel-Bv4G4H50.js";import{N as Q}from"./Popconfirm-lVd5wiwm.js";const Re=L({name:"maintenancePlan",__name:"maintenancePlan_model",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(g,{emit:z}){const m=H(g,"visible"),o=z,u=g,s=ue(b());function b(){return{mname:"",mtext:"",mstatus:1,createrid:void 0}}const v=W([]),T=async()=>{var l;if(!v.value.length){const{data:a,error:i}=await ve({page:1,limit:1e3});i||(v.value=((l=JSON.parse(JSON.stringify(a)))==null?void 0:l.list)||[])}},w=()=>{Object.assign(s,b()),u.operateType==="edit"&&u.rowData&&Object.assign(s,u.rowData),T()},{formRef:S,validate:U,restoreValidation:$}=X();J(()=>u.rowData,w),J(m,l=>{l&&(w(),$())});const c=()=>{m.value=!1},r=async()=>{var i;await U();const l=u.operateType==="add"?pe:de,{error:a}=await l([s]);a||((i=window.$message)==null||i.success(u.operateType==="add"?"添加成功":"修改成功"),c(),o("submitted"))},P=Te.debounce(r,1e3,{leading:!0,trailing:!1}),x={mname:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},mtext:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},mstatus:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},createrid:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]}},C=ce(()=>({add:d("common.add"),edit:d("common.edit")})[u.operateType]);return(l,a)=>{const i=Y,f=ae,k=_e,R=G,M=fe,O=Z,y=ne,B=ee,p=N,oe=G,le=ge;return j(),F(le,{show:m.value,"onUpdate:show":a[4]||(a[4]=h=>m.value=h),title:C.value,preset:"card",class:"w-600px"},{footer:t(()=>[e(oe,{size:16,justify:"center"},{default:t(()=>[e(p,{onClick:c,class:"w-100px"},{default:t(()=>[_(D(n(d)("common.cancel")),1)]),_:1}),e(p,{type:"primary",class:"w-100px",onClick:n(P)},{default:t(()=>[_(D(n(d)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(B,{ref_key:"formRef",ref:S,model:s,rules:x,"label-placement":"left","label-width":"100","require-mark-placement":"left"},{default:t(()=>[e(y,{responsive:"screen","item-responsive":""},{default:t(()=>[e(f,{span:"24",label:"检修名称",path:"mname"},{default:t(()=>[e(i,{value:s.mname,"onUpdate:value":a[0]||(a[0]=h=>s.mname=h),clearable:"",maxlength:"64",placeholder:"请输入"},null,8,["value"])]),_:1}),e(f,{span:"24",label:"检修状态",path:"mstatus"},{default:t(()=>[e(M,{value:s.mstatus,"onUpdate:value":a[1]||(a[1]=h=>s.mstatus=h)},{default:t(()=>[e(R,null,{default:t(()=>[e(k,{value:0},{default:t(()=>[_("已检修")]),_:1}),e(k,{value:1},{default:t(()=>[_("未检修")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),e(f,{span:"24",label:"检修人",path:"createrid"},{default:t(()=>[e(O,{value:s.createrid,"onUpdate:value":a[2]||(a[2]=h=>s.createrid=h),filterable:"",placeholder:"选择",options:v.value,"label-field":"username","value-field":"id"},null,8,["value","options"])]),_:1}),e(f,{span:"24",label:"检修内容",path:"mtext"},{default:t(()=>[e(i,{value:s.mtext,"onUpdate:value":a[3]||(a[3]=h=>s.mtext=h),clearable:"",type:"textarea",placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Me=L({name:"SearchQuery",__name:"searchQuery",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(g,{emit:z}){const m=z,o=H(g,"model"),{formRef:u,restoreValidation:s}=X(),b=W(null),v=c=>{c?(o.value.startTime=c[0],o.value.endTime=c[1]):(o.value.startTime=void 0,o.value.endTime=void 0),m("search")};async function T(){await s(),o.value.startTime=null,o.value.endTime=null,b.value=null,o.value.fuzzy=null,o.value.mstatus=null,m("reset")}const w=()=>{o.value.fuzzy="",m("search")},S={近一天:[Date.now()-864e5*1,Date.now()],近三天:[Date.now()-864e5*3,Date.now()],近七天:[Date.now()-864e5*7,Date.now()]};async function U(){m("search")}const $=c=>{o.value.mstatus=c,m("search")};return(c,r)=>{const P=Y,x=ae,C=$e,l=Z,a=Ue,i=N,f=Se,k=G,R=ne,M=ee,O=te;return j(),F(O,{bordered:!1,size:"small"},{default:t(()=>[e(M,{ref_key:"formRef",ref:u,model:o.value,"label-placement":"left","show-feedback":!1},{default:t(()=>[e(R,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:t(()=>[e(x,{span:"24 s:8 m:6 l:4",label:""},{default:t(()=>[e(P,{value:o.value.fuzzy,"onUpdate:value":r[0]||(r[0]=y=>o.value.fuzzy=y),clearable:"",placeholder:"请输入检修名称",onClear:w},null,8,["value"])]),_:1}),e(x,{span:"24 s:16 m:12 l:8",label:"起止时间"},{default:t(()=>[e(C,{value:b.value,"onUpdate:value":r[1]||(r[1]=y=>b.value=y),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":v,clearable:"",shortcuts:S},null,8,["value"])]),_:1}),e(x,{span:"24 s:12 m:8 l:4",label:"检修状态"},{default:t(()=>[e(l,{value:o.value.mstatus,"onUpdate:value":[r[2]||(r[2]=y=>o.value.mstatus=y),$],options:n(ye)(n(he)),filterable:"",placeholder:"请选择检修状态",clearable:"",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(x,{span:"24 s:12 m:8 l:6",label:""},{default:t(()=>[e(k,{class:"w-full"},{default:t(()=>[e(i,{onClick:T},{icon:t(()=>[e(a,{class:"text-icon"})]),default:t(()=>[_(" "+D(c.$t("common.reset")),1)]),_:1}),e(i,{type:"primary",ghost:"",onClick:U},{icon:t(()=>[e(f,{class:"text-icon"})]),default:t(()=>[_(" "+D(c.$t("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function K(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!Ne(g)}const We=L({name:"stationmanagement_maintenanceplan",__name:"index",setup(g){const{columns:z,columnChecks:m,data:o,getData:u,loading:s,mobilePagination:b,searchParams:v,resetSearchParams:T}=Ce({apiFn:be,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"mname",title:"检修名称",align:"center",width:140},{key:"creater",title:"检修人",align:"center",width:100},{key:"mstatus",title:"检修状态",align:"center",width:140,render:l=>e(we,{type:l.mstatus===0?"success":"warning"},{default:()=>[l.mstatus===0?"已检修":"未检修"]})},{key:"dbtime",title:"检修时间",align:"center",width:140},{key:"mtext",title:"检修内容",align:"center",width:100},{key:"operate",title:d("common.operate"),align:"center",width:200,fixed:"right",render:l=>{let a;return e("div",{class:"flex-center gap-8px"},[V(e(N,{type:"primary",ghost:!0,size:"small",onClick:()=>c(l.id)},K(a=d("common.edit"))?a:{default:()=>[a]}),[[I("no-auth"),"maintenance:update"]]),V(e(Q,{onPositiveClick:()=>C([l.id])},{default:()=>d("common.confirmDelete"),trigger:()=>{let i;return e(N,{type:"error",ghost:!0,size:"small"},K(i=d("common.delete"))?i:{default:()=>[i]})}}),[[I("no-auth"),"'maintenance:delete'"]])])}}]}),{drawerVisible:w,operateType:S,editingData:U,handleAdd:$,handleEdit:c,checkedRowKeys:r,onDeleted:P}=ze(o,u),x=()=>{Pe(o.value.map(({mname:l,mtext:a,mstatus:i,dbtime:f,creater:k})=>({mname:l,mtext:a,mstatus:i===0?"已检修":"未检修",dbtime:f,creater:k})),{mname:"检修名称",mtext:"检修内容",mstatus:"检修状态",dbtime:"检修时间",creater:"检修人"},"检修计划","sheet1")},C=async l=>{if(!l.length)return;const{error:a}=await xe({ids:l.join(",")});a||(P(),r.value=[])};return(l,a)=>{const i=G,f=me,k=re,R=ie,M=se,O=De,y=te,B=I("no-auth");return j(),ke("div",Oe,[e(Me,{model:n(v),"onUpdate:model":a[0]||(a[0]=p=>q(v)?v.value=p:null),onReset:n(T),onSearch:n(u)},null,8,["model","onReset","onSearch"]),e(y,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(i,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[_(" 检修计划 ")]),_:1})]),"header-extra":t(()=>[e(i,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[V((j(),F(n(N),{onClick:n($),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(f,{class:A(["text-icon",{"animate-spin":n(s)}])},null,8,["class"])]),default:t(()=>[_(" "+D(n(d)("common.add")),1)]),_:1},8,["onClick"])),[[B,"maintenance:insert"]]),V((j(),F(n(Q),{onPositiveClick:a[1]||(a[1]=p=>C(n(r)))},{trigger:t(()=>[e(n(N),{size:"small",ghost:"",type:"error",disabled:!n(r).length},{icon:t(()=>[e(k,{class:A(["text-icon",{"animate-spin":n(s)}])},null,8,["class"])]),default:t(()=>[_(" "+D(n(d)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:t(()=>[_(" 确认删除选中的项吗？ ")]),_:1})),[[B,"maintenance:delete"]]),e(n(N),{onClick:x,size:"small",disabled:!n(r).length},{icon:t(()=>[e(R,{class:A(["text-icon",{"animate-spin":n(s)}])},null,8,["class"])]),default:t(()=>[_(" "+D(n(d)("common.export")),1)]),_:1},8,["disabled"]),e(M,{columns:n(m),"onUpdate:columns":a[2]||(a[2]=p=>q(m)?m.value=p:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(O,{"checked-row-keys":n(r),"onUpdate:checkedRowKeys":a[3]||(a[3]=p=>q(r)?r.value=p:null),columns:n(z),data:n(o),size:"small",loading:n(s),remote:"","row-key":p=>p.id,pagination:n(b),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Re,{visible:n(w),"onUpdate:visible":a[4]||(a[4]=p=>q(w)?w.value=p:null),onSubmitted:n(u),"operate-type":n(S),"row-data":n(U)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{We as default};
