import{_ as de,a as pe,A as ce}from"./index-DKw8_iBE.js";import{d as me,s as fe,q as _e,v as z,i as ve,bZ as G,b_ as ge,r as k,at as ke,b as be,o as _,f as o,w as n,c as b,z as y,h as w,A as K,b$ as ye,b8 as T,g as i,B as V,b9 as we,C as Ce,N as q,G as Ae,e as Se,t as F,aF as xe,c0 as Me,aI as j,av as he}from"./index-9CCyyUlU.js";const Ne={class:"flex justify-center"},$e=2,Ue=me({name:"manage_systemconfig",__name:"index",setup(Ie){const{formRef:O,validate:Y}=fe(),C=_e(),t=z(L());function L(){return{id:0,captcha:0,merror:0,errortime:0,sdkkey:"",sdkh5:"",sdksecret:"",prosite:"",longitude:120.373885,latitude:30.303899,diserror:0}}const p={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},H={captcha:p,prosite:{type:"string",required:!0,message:"不能为空",trigger:["blur","change"]},longitude:p,latitude:p,merror:p,errortime:p,diserror:p},B=async()=>{const{data:l,error:e}=await Me();e||(Object.assign(t,l),t.errortime=l.errortime/1e3/60)};ve(()=>{B()});const J=G.debounce(async()=>{var r;await Y();const l=t.errortime*1e3*60,{error:e}=await ge({...t,errortime:l});e||(r=window.$message)==null||r.success("设置成功")},1e3,{leading:!0,trailing:!1}),v=k(!1),h=k();let c=null,P=null,A=null,X=null,D=null,d=null;const m=z({longitude:0,latitude:0});let g;const S=k(!1),f=k(""),x=k([]);let N=0;async function R(){try{if(window._AMapSecurityConfig={securityJsCode:t.sdksecret},!h.value)return;d=await ce.load({key:t.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),c=new d.Map(h.value,{zoom:18,center:[t.longitude,t.latitude],viewMode:"3D",resizeEnable:!0}),P=new d.Geocoder,X=new d.PlaceSearch({city:"全国",pageSize:50}),D=new d.AutoComplete({city:"全国"}),$(d,{lng:t.longitude,lat:t.latitude}),c.on("click",l=>{const{lng:e,lat:r}=l.lnglat;g=2,m.latitude=r,m.longitude=e,$(d,{lng:e,lat:r})}),j(()=>window.dispatchEvent(new Event("resize")))}catch{N<$e?(N++,console.warn(`地图加载失败，正在第 ${N} 次重试...`),setTimeout(()=>{R()},1500)):console.error("地图加载失败，已达到最大重试次数，停止重试")}}const Z=G.debounce(async l=>{if(!S.value||!l.trim()){x.value=[];return}D.search(l,(e,r)=>{var s;console.log(r,"result"),e=="complete"&&r.info=="OK"&&((s=r==null?void 0:r.tips)!=null&&s.length)?x.value=r.tips.map(u=>({label:`${u.name}（${u.district||u.address||"无详细地址"}）`,value:`${u.location.lng}_${u.location.lat}`,raw:u})):x.value=[]})},300);ke(f,l=>{Z(l)});function Q(l,e){if(console.log(l,e,"option"),!l)return;const[r,s]=l.split("_").map(Number);!r||!s||(c.setCenter([r,s]),g=1,$(d,{lng:r,lat:s}),m.longitude=r,m.latitude=s)}function W(){v.value=!0,S.value=!1,g=void 0,j(async()=>{await R(),setTimeout(()=>{S.value=!0;const l=document.querySelector(".n-auto-complete input");l==null||l.blur()},500)})}function $(l,e){A&&c.remove(A),A=new l.Marker({position:[e.lng,e.lat],map:c}),c.add(A),P.getAddress(e,(r,s)=>{r==="complete"&&s.regeocode&&(console.log("result",s),console.log("formattedAddress",s.regeocode.formattedAddress),e.latitude=e.lat,e.longitude=e.lng,g==1||(g==2?f.value=s.regeocode.formattedAddress:f.value=t.prosite))})}function ee(){v.value=!1}const te=async()=>{t.latitude=m.latitude,t.longitude=m.longitude,t.prosite=f.value,v.value=!1};return(l,e)=>{const r=ye,s=K,u=V,U=we,I=T,M=Ce,oe=de,E=V,ne=T,le=K,ae=q,re=Ae,se=pe,ue=q,ie=xe;return _(),be("div",Ne,[o(re,{ref_key:"formRef",ref:O,"label-width":240,"label-placement":"left",model:t,rules:H},{default:n(()=>[w(C).userInfo.usertype==0?(_(),b(s,{key:0,label:"是否开启验证码",path:"captcha"},{default:n(()=>[o(r,{value:t.captcha,"onUpdate:value":e[0]||(e[0]=a=>t.captcha=a),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})):y("",!0),o(s,{label:"打卡误差范围（米）",path:"merror"},{default:n(()=>[o(I,{class:"flex items-center"},{default:n(()=>[o(u,{onClick:e[1]||(e[1]=a=>t.merror--),disabled:t.merror==0},{default:n(()=>e[16]||(e[16]=[i(" − ")])),_:1,__:[16]},8,["disabled"]),o(U,{"show-button":!1,value:t.merror,"onUpdate:value":e[2]||(e[2]=a=>t.merror=a),placeholder:"",min:0,precision:0},null,8,["value"]),o(u,{onClick:e[3]||(e[3]=a=>t.merror++),class:"mr-5px"},{default:n(()=>e[17]||(e[17]=[i(" + ")])),_:1,__:[17]}),e[18]||(e[18]=i(" 米 "))]),_:1,__:[18]})]),_:1}),o(s,{label:"打卡时间误差最大值（分钟）",path:"errortime"},{default:n(()=>[o(I,{class:"flex items-center"},{default:n(()=>[o(u,{onClick:e[4]||(e[4]=a=>t.errortime--),disabled:t.errortime==0},{default:n(()=>e[19]||(e[19]=[i(" − ")])),_:1,__:[19]},8,["disabled"]),o(U,{"show-button":!1,value:t.errortime,"onUpdate:value":e[5]||(e[5]=a=>t.errortime=a),placeholder:"",min:0,precision:0},null,8,["value"]),o(u,{onClick:e[6]||(e[6]=a=>t.errortime++),class:"mr-5px"},{default:n(()=>e[20]||(e[20]=[i(" + ")])),_:1,__:[20]}),e[21]||(e[21]=i(" 分钟 "))]),_:1,__:[21]})]),_:1}),o(s,{label:"静默打卡范围（当超过此数值将认为异常默认100）",path:"diserror"},{default:n(()=>[o(I,{class:"flex items-center"},{default:n(()=>[o(u,{onClick:e[7]||(e[7]=a=>t.diserror--),disabled:t.diserror==0},{default:n(()=>e[22]||(e[22]=[i(" − ")])),_:1,__:[22]},8,["disabled"]),o(U,{"show-button":!1,value:t.diserror,"onUpdate:value":e[8]||(e[8]=a=>t.diserror=a),placeholder:"",min:0,max:5e3,precision:0},null,8,["value"]),o(u,{onClick:e[9]||(e[9]=a=>t.diserror++),class:"mr-5px"},{default:n(()=>e[23]||(e[23]=[i(" + ")])),_:1,__:[23]}),e[24]||(e[24]=i(" 米 "))]),_:1,__:[24]})]),_:1}),w(C).userInfo.id=="1024"?(_(),b(s,{key:1,label:"AMAP_SDK_KEY",path:"sdkkey"},{default:n(()=>[o(M,{style:{width:"300px"},value:t.sdkkey,"onUpdate:value":e[10]||(e[10]=a=>t.sdkkey=a),placeholder:""},null,8,["value"])]),_:1})):y("",!0),w(C).userInfo.id=="1024"?(_(),b(s,{key:2,label:"AMAP_SDK_KEY_H5",path:"sdkh5"},{default:n(()=>[o(M,{style:{width:"300px"},value:t.sdkh5,"onUpdate:value":e[11]||(e[11]=a=>t.sdkh5=a),placeholder:""},null,8,["value"])]),_:1})):y("",!0),w(C).userInfo.id=="1024"?(_(),b(s,{key:3,label:"AMAP_SDK_SECRET",path:"sdksecret"},{default:n(()=>[o(M,{style:{width:"300px"},value:t.sdksecret,"onUpdate:value":e[12]||(e[12]=a=>t.sdksecret=a),placeholder:""},null,8,["value"])]),_:1})):y("",!0),o(le,{label:"项目地点",path:"prosite"},{default:n(()=>[o(ne,{onClick:W},{default:n(()=>[o(M,{value:t.prosite,"onUpdate:value":e[13]||(e[13]=a=>t.prosite=a),style:{width:"400px"},placeholder:"请输入项目地点"},null,8,["value"]),o(E,null,{icon:n(()=>[o(oe,{class:"text-icon"})]),_:1})]),_:1})]),_:1}),o(s,{label:" "},{default:n(()=>[o(ae,null,{default:n(()=>[o(u,{type:"default",ghost:"",onClick:B},{default:n(()=>e[25]||(e[25]=[i(" 刷新 ")])),_:1,__:[25]}),o(u,{type:"info",ghost:"",onClick:w(J)},{default:n(()=>e[26]||(e[26]=[i(" 保存 ")])),_:1,__:[26]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model"]),o(ie,{show:v.value,"onUpdate:show":e[15]||(e[15]=a=>v.value=a),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:n(()=>[o(ue,{justify:"end",size:16},{default:n(()=>[o(E,{onClick:ee},{default:n(()=>[i(F(l.$t("common.cancel")),1)]),_:1}),o(E,{type:"primary",onClick:te},{default:n(()=>[i(F(l.$t("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[S.value?(_(),b(se,{key:0,value:f.value,"onUpdate:value":e[14]||(e[14]=a=>f.value=a),options:x.value,placeholder:"请输入地点关键字",clearable:"",onSelect:Q},null,8,["value","options"])):y("",!0),Se("div",{ref_key:"domRef",ref:h,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])])}}}),Pe=he(Ue,[["__scopeId","data-v-163ffbc9"]]);export{Pe as default};
