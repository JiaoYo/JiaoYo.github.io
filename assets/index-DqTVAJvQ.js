import{d as X,q as ae,j as I,a0 as te,v as fe,s as ne,r as q,L as ve,o as E,c as B,w as t,g as a,O as le,M as me,i as y,$ as A,V as _e,e as W,aj as ge,h as c,t as _,f as Z,N as he,ay as Ie,ao as O,ap as Y,A as ye,Y as Se,B as J,E as ee,D as be,aa as oe,y as we,an as Q,ae as se,aq as xe,ar as Ae,S as ke,F as Ce,az as Ee,aA as De,aw as ie}from"./index-BAVDbSG0.js";import{l as re}from"./lodash-DYSm-0lo.js";import{_ as Te,a as $e}from"./arrow-open-up-BRsx8tzn.js";import{_ as ze}from"./round-search-Bcb0t4Jv.js";import{_ as Ne}from"./round-refresh-yP8uig6G.js";import{a as Pe,T as K}from"./basicconf-CAeQx9Ji.js";import{b as Le,a as Ve,f as Me}from"./common-B4dekMWc.js";import{_ as Oe}from"./Cascader-DTs7sfMG.js";import{_ as Ue}from"./FormItemGridItem-xXViKYEE.js";import{_ as Be}from"./DatePicker-Cu_R093j.js";import{_ as Re}from"./Grid-BDOf_ubP.js";import{t as je,f as Ge,u as He}from"./events-B-qGf2G1.js";import{e as Fe}from"./exportExcel-D6OyA9oJ.js";import{_ as qe}from"./originlogInfo.vue_vue_type_script_setup_true_lang-DFICp2SJ.js";import{_ as We,a as Je}from"./DescriptionsItem-DmDsjMQ-.js";import{_ as ue}from"./DataTable-BDYCfsCN.js";import"./TimePicker-DQ_q4WUT.js";import"./defineProperty-CaBVv32k.js";import"./Forward-edmZhOxW.js";import"./CollapseItem-DYL3YvOa.js";const Ke=X({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ae(["search"],["update:model"]),setup(m,{emit:T}){const $=T,i=I(!1),L=te(),{formRef:h,restoreValidation:g}=fe(),e=ne(m,"model"),k=I();(async()=>{const{data:n,error:s}=await Le();s||(k.value=n.map(p=>({...p,id:"-"+p.id,type:p.cname})))})();const w=q({eventsTypeDataList:[],eventsCategoryData:[]});async function C(){const{data:n,error:s}=await Ve();s||(w.eventsTypeDataList=n)}C();async function V(){const{data:n,error:s}=await Me();s||(w.eventsCategoryData=n)}V();function x(){e.value.fuzzy=void 0,o()}async function d(n,s){n?(e.value.startTime=n[0],e.value.endTime=n[1]):(e.value.startTime=null,e.value.endTime=null),$("search")}async function f(){await g(),e.value.lsid=null,e.value.etype=null,e.value.elevel=null,e.value.fuzzy=null,e.value.startAndEndSendSourceIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.timeRange=null,e.value.ectgr=null,e.value.startSourceIp=null,e.value.endSourceIp=null,e.value.startAimIp=null,e.value.endAimIp=null,e.value.startSIp=null,e.value.endSIp=null,e.value.startTime=null,e.value.endTime=null,Ie(()=>{$("search")})}const r=()=>{e.value.startAndEndSendSourceIp=null,o()},b=()=>{e.value.startAndEndSourceIp=null,o()},M=()=>{e.value.startAndEndAimSourceIp=null,o()};async function o(){var n,s,p,u,l,S,z,N,D,P;if(e.value.startAndEndSendSourceIp&&e.value.startAndEndSendSourceIp.length>0?(e.value.startSIp=e.value.startAndEndSendSourceIp[0]||null,e.value.endSIp=e.value.startAndEndSendSourceIp[1]||null):(e.value.startSIp=null,e.value.endSIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=void 0,e.value.endSourceIp=void 0),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimIp=void 0,e.value.endAimIp=void 0),e.value.startSIp&&!O(e.value.startSIp)||e.value.startSourceIp&&!O(e.value.startSourceIp)||e.value.startAimIp&&!O(e.value.startAimIp))return(n=window.$message)==null||n.destroyAll(),(s=window.$message)==null||s.error("请输入正确的IP地址"),!1;if(e.value.endSIp&&!O(e.value.endSIp)||e.value.endSourceIp&&!O(e.value.endSourceIp)||e.value.endAimIp&&!O(e.value.endAimIp))return(p=window.$message)==null||p.destroyAll(),(u=window.$message)==null||u.error("请输入正确的IP地址"),!1;if(e.value.startSIp&&e.value.endSIp&&Y(e.value.startSIp,e.value.endSIp)>0)return(l=window.$message)==null||l.destroyAll(),(S=window.$message)==null||S.error("发生源起始IP不能大于发生源终止IP"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&Y(e.value.startSourceIp,e.value.endSourceIp)>0)return(z=window.$message)==null||z.destroyAll(),(N=window.$message)==null||N.error("源起始IP不能大于源终止IP"),!1;if(e.value.startAimIp&&e.value.endAimIp&&Y(e.value.startAimIp,e.value.endAimIp)>0)return(D=window.$message)==null||D.destroyAll(),(P=window.$message)==null||P.error("目的起始IP不能大于目的终止IP"),!1;$("search")}return(n,s)=>{const p=Oe,u=Ue,l=ye,S=Se,z=Be,N=Ne,D=J,P=ze,R=Te,j=$e,G=ee,H=Re,F=be,pe=oe,ce=ve("no-space");return E(),B(pe,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[a(F,{ref_key:"formRef",ref:h,model:e.value,"label-placement":"left","label-width":y(L).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:he(o,["enter"])},{default:t(()=>[a(H,{responsive:"screen","item-responsive":"","y-gap":12},{default:t(()=>[i.value?(E(),B(u,{key:0,span:"24 s:24 m:6",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:t(()=>[a(p,{value:e.value.lsid,"onUpdate:value":[s[0]||(s[0]=v=>e.value.lsid=v),o],placeholder:"请选择日志源设备",options:k.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1})):le("",!0),a(u,{span:"24 s:12 m:6",label:"事件名称",path:"fuzzy",class:"pr-24px"},{default:t(()=>[me(a(l,{value:e.value.fuzzy,"onUpdate:value":s[1]||(s[1]=v=>e.value.fuzzy=v),placeholder:"请输入事件名称",clearable:"",onClear:x},null,8,["value"]),[[ce]])]),_:1}),a(u,{span:"24 s:24 m:6",label:"事件类型",path:"etype",class:"pr-24px"},{default:t(()=>[a(S,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.etype,"onUpdate:value":[s[2]||(s[2]=v=>e.value.etype=v),o],"value-field":"id","label-field":"pname",options:w.eventsTypeDataList},null,8,["value","options"])]),_:1}),a(u,{span:"24 s:12 m:6",label:y(A)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:t(()=>[a(S,{filterable:"",clearable:"",placeholder:y(A)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[s[3]||(s[3]=v=>e.value.elevel=v),o],options:y(_e)(y(Pe))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),i.value?(E(),W(ge,{key:1},[a(u,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSendSourceIp",class:"pr-24px"},{default:t(()=>[a(l,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSendSourceIp,"onUpdate:value":s[4]||(s[4]=v=>e.value.startAndEndSendSourceIp=v),onClear:b},null,8,["value"])]),_:1}),a(u,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndSourceIp",class:"pr-24px"},{default:t(()=>[a(l,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":s[5]||(s[5]=v=>e.value.startAndEndSourceIp=v),onClear:r},null,8,["value"])]),_:1}),a(u,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px"},{default:t(()=>[a(l,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":s[6]||(s[6]=v=>e.value.startAndEndAimSourceIp=v),onClear:M},null,8,["value"])]),_:1}),a(u,{span:"24 s:12 m:8",label:"产生时间",path:"timeRange",class:"pr-24px"},{default:t(()=>[a(z,{clearable:"",value:e.value.timeRange,"onUpdate:value":s[7]||(s[7]=v=>e.value.timeRange=v),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":d},null,8,["value"])]),_:1}),a(u,{span:"24 s:12 m:8",label:"事件类别",path:"ectgr",class:"pr-24px"},{default:t(()=>[a(S,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.ectgr,"onUpdate:value":[s[8]||(s[8]=v=>e.value.ectgr=v),o],"value-field":"id","label-field":"pname",options:w.eventsCategoryData},null,8,["value","options"])]),_:1})],64)):le("",!0),a(u,{span:"24 s:12 m:6",class:"pr-24px"},{default:t(()=>[a(G,{class:"w-full",align:"center"},{default:t(()=>[a(D,{onClick:f},{icon:t(()=>[a(N,{class:"text-icon"})]),default:t(()=>[c(" "+_(y(A)("common.reset")),1)]),_:1}),a(D,{type:"primary",ghost:"",onClick:o},{icon:t(()=>[a(P,{class:"text-icon"})]),default:t(()=>[c(" "+_(y(A)("common.search")),1)]),_:1}),Z("div",{class:"cursor-pointer",title:"精准查询",onClick:s[9]||(s[9]=v=>i.value=!i.value)},[i.value?(E(),B(R,{key:0,class:"text-icon"})):(E(),B(j,{key:1,class:"text-icon"}))])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width"])]),_:1})}}}),de=m=>(Ee("data-v-db5cc676"),m=m(),De(),m),Ye=de(()=>Z("span",null,"基本信息",-1)),Qe=de(()=>Z("span",null,"原始日志信息",-1)),Xe={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"400px"}},Ze={key:1,class:"max-h-500px min-h-450px"};function el(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!se(m)}const ll=X({__name:"detailInfo",props:ae({detailInfo:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(m){const T=ne(m,"detailVisible"),$=m,i=I();we(()=>T.value,async d=>{d&&(i.value=$.detailInfo,e())});const L=[{title:"",key:"index",width:50,render:(d,f)=>`${f+1}`},{key:"pname2",title:"事件类别",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:d=>{(d.elevel===void 0||d.elevel===null)&&(d.elevel=1);const f={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},r=A(K[d.elevel]);let b={color:f[d.elevel],textColor:"#ffffff",borderColor:f[d.elevel]};return a(Q,{size:"small",color:b},el(r)?r:{default:()=>[r]})}},{key:"sourceip",title:"发生源IP",align:"center",width:120},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"operate",title:A("common.operate"),align:"center",width:80,fixed:"right",render:d=>a("div",{class:"flex-center gap-8px"},[a(J,{type:"info",ghost:!0,size:"small",onClick:()=>x(d)},{default:()=>[c("详情")]})])}],h=I(!1);let g=I([]);const e=async d=>{var b;if(!h.value)h.value=!0;else return;const{data:f,error:r}=await je({aggid:(b=i.value)==null?void 0:b.aggid,limit:10,pageId:d});r||(h.value=!1,d?g.value=[...g.value,...f]:g.value=f)};function k(d){var r;Math.abs(d.target.scrollTop+d.target.offsetHeight-d.target.scrollHeight)<=20&&((r=i.value)==null?void 0:r.aggre)>g.value.length&&U()}const U=re.debounce(()=>{e(g.value[g.value.length-1].id)},300),w=q({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:d,endIndex:f,page:r,pageSize:b,pageCount:M,itemCount:o}){var n;return`已加载${g.value.length}条 共计${(n=i.value)==null?void 0:n.aggre} 条`}}),C=I(!1),V=I(),x=async d=>{C.value=!0,V.value=d};return(d,f)=>{const r=We,b=Je,M=ee,o=xe,n=ue,s=Ae,p=ke,u=Ce;return E(),B(u,{show:T.value,"onUpdate:show":f[1]||(f[1]=l=>T.value=l),title:"事件详情",preset:"card",class:"w-1000px"},{default:t(()=>[a(p,{class:"max-h-600px pr-20px"},{default:t(()=>[a(s,{type:"line",animated:""},{default:t(()=>[a(o,{name:"1"},{tab:t(()=>[Ye]),default:t(()=>[a(M,{vertical:"",size:12},{default:t(()=>[a(b,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:t(()=>[a(r,{label:"事件名称"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.ename),1)]}),_:1}),a(r,{label:"事件类型"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.pname1),1)]}),_:1}),a(r,{label:"事件类别"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.pname2),1)]}),_:1}),a(r,{label:"事件等级"},{default:t(()=>{var l,S,z,N,D,P,R,j,G,H;return[a(y(Q),{size:"small",color:{textColor:"#ffffff",borderColor:((l=i.value)==null?void 0:l.elevel)===0?"#8e9dff":((S=i.value)==null?void 0:S.elevel)===1?"#5da8ff":((z=i.value)==null?void 0:z.elevel)===2?"#fedc69":((N=i.value)==null?void 0:N.elevel)===3?"#ff9874":((D=i.value)==null?void 0:D.elevel)===4?"#ff0000":"#5da8ff",color:((P=i.value)==null?void 0:P.elevel)===0?"#8e9dff":((R=i.value)==null?void 0:R.elevel)===1?"#5da8ff":((j=i.value)==null?void 0:j.elevel)===2?"#fedc69":((G=i.value)==null?void 0:G.elevel)===3?"#ff9874":((H=i.value)==null?void 0:H.elevel)===4?"#ff0000":"#5da8ff"}},{default:t(()=>{var F;return[c(_(y(A)(y(K)[(F=i.value)==null?void 0:F.elevel])),1)]}),_:1},8,["color"])]}),_:1}),a(r,{label:"日志源设备"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.type),1)]}),_:1}),a(r,{label:"聚合开始时间"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.aggrestarttime),1)]}),_:1}),a(r,{label:"聚合结束时间"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.aggreendtime),1)]}),_:1}),a(r,{label:"聚合数量"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.aggre),1)]}),_:1}),a(r,{label:"发生源IP"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.sip),1)]}),_:1}),a(r,{label:"源IP"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.sourceip),1)]}),_:1}),a(r,{label:"源端口"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.sourceport),1)]}),_:1}),a(r,{label:"目的IP"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.aimip),1)]}),_:1}),a(r,{label:"目的端口"},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.aimport),1)]}),_:1}),a(r,{label:"事件描述",span:3},{default:t(()=>{var l;return[c(_((l=i.value)==null?void 0:l.aimip),1)]}),_:1})]),_:1})]),_:1})]),_:1}),a(o,{name:"2"},{tab:t(()=>[Qe]),default:t(()=>[y(g).length==0?(E(),W("div",Xe," 暂无原始日志信息 ")):(E(),W("div",Ze,[a(n,{columns:L,data:y(g),size:"small","scroll-x":762,"row-key":l=>l.id,"virtual-scroll":"",class:"sm:h-full",pagination:w,onScroll:k,loading:h.value,"max-height":400,remote:""},null,8,["data","row-key","pagination","loading"])])),a(qe,{detailVisible:C.value,"onUpdate:detailVisible":f[0]||(f[0]=l=>C.value=l),detailInfo:V.value},null,8,["detailVisible","detailInfo"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),al=ie(ll,[["__scopeId","data-v-db5cc676"]]),tl={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function nl(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!se(m)}const ol=X({name:"eventalarm_eventalarm",__name:"index",setup(m){const T=te(),$=I(window.innerHeight-306),i=I(!1),L=I(),h=q({pageId:void 0,limit:100,lsid:void 0,etype:void 0,ectgr:void 0,elevel:void 0,startSIp:void 0,endSIp:void 0,startSourceIp:void 0,endSourceIp:void 0,startAimIp:void 0,endAimIp:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),g=[{title:"",key:"index",width:80,render:(o,n)=>`${n+1}`},{key:"ename",title:"事件名称",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:160},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",width:120,render:o=>{(o.elevel===void 0||o.elevel===null)&&(o.elevel=1);const n={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},s=A(K[o.elevel]);let p={color:n[o.elevel],textColor:"#ffffff",borderColor:n[o.elevel]};return a(Q,{size:"small",color:p},nl(s)?s:{default:()=>[s]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"sip",title:"发生源IP",align:"center",width:160},{key:"aggreendtime",title:"聚合结束时间",align:"center",width:160},{key:"operate",title:A("common.operate"),align:"center",width:100,fixed:"right",render:o=>a("div",{class:"flex-center gap-8px"},[a(J,{type:"primary",ghost:!0,size:"small",onClick:()=>b(o)},{default:()=>[c("查看")]})])}],e=I([]),k=I(!1),U=I(0),w=async(o=!1)=>{if(!k.value)k.value=!0;else return;const{data:n,error:s}=await Ge(h);s||(U.value=n.length,o?e.value=[...e.value,...n]:e.value=n,k.value=!1)};w();const C=I(!0),V=()=>{e.value=[],h.pageId=void 0,(n=>Object.keys(n).filter(u=>u!=="limit"&&u!=="_t").some(u=>n[u]!==void 0&&n[u]!==""&&n[u]!==null))(h)?C.value=!1:(C.value=!0,d()),w()},x=q({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:o,endIndex:n,page:s,pageSize:p,pageCount:u,itemCount:l}){return`已加载${e.value.length}条`+(e.value.length?C.value?` 共计 ${e.value.length>0?l??0:0} 条`:U.value==h.limit?"  预计还有更多":"  没有更多了":"")}});async function d(){const{data:o,error:n}=await He();n||(x.pageCount=20,x.total=Number(o),x.itemCount=Number(o))}d();function f(o){Math.abs(o.target.scrollTop+o.target.offsetHeight-o.target.scrollHeight)<=20&&x.total>e.value.length&&r()}const r=re.debounce(()=>{var o;((o=e.value)==null?void 0:o.length)<x.total&&(h.pageId=e.value[e.value.length-1].id,w(!0))},300);async function b(o){L.value=o,i.value=!0}async function M(){if(!e.value.length)return;const o=JSON.parse(JSON.stringify(e.value)),n=[];o.forEach(p=>{const u={};g.forEach(l=>{if(p.hasOwnProperty(l.key)){const S=l.key=="elevel"?A(K[p[l.key]]):p[l.key];u[l.title]=S}}),n.push(u)}),Fe(n,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50},{wpx:100},{wpx:150}],"安全事件_"+new Date().getTime())}return(o,n)=>{const s=ee,p=ue,u=oe;return E(),W("div",tl,[a(Ke,{model:h,"onUpdate:model":n[0]||(n[0]=l=>h=l),onSearch:V},null,8,["model"]),a(u,{title:"安全事件",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[a(s,null,{default:t(()=>[a(y(J),{type:"primary",size:"small",ghost:"",onClick:M,title:"导出已加载"},{default:t(()=>[c("导出已加载")]),_:1})]),_:1})]),default:t(()=>[a(p,{columns:g,data:e.value,size:"small","flex-height":!y(T).isMobile,loading:k.value,remote:"","scroll-x":g.reduce((l,S)=>l+S.width,0),"row-key":l=>l.id,pagination:x,"virtual-scroll":"",onScroll:f,class:"sm:h-full","max-height":$.value},null,8,["data","flex-height","loading","scroll-x","row-key","pagination","max-height"])]),_:1}),a(al,{detailVisible:i.value,"onUpdate:detailVisible":n[1]||(n[1]=l=>i.value=l),detailInfo:L.value},null,8,["detailVisible","detailInfo"])])}}}),kl=ie(ol,[["__scopeId","data-v-6c6a327a"]]);export{kl as default};
