import{_ as le}from"./table-column-setting.vue_vue_type_script_setup_true_lang-Dg__PXp0.js";import{_ as se}from"./round-delete-CojfW_rY.js";import{_ as ie}from"./round-add-CcJ-eWvp.js";import{d as G,aE as V,r as re,n as Y,a as ce,aG as H,aC as ue,bY as pe,cm as de,cn as me,c as P,o as U,w as t,f as e,a0 as _e,C as L,h as a,x as Z,aD as J,z as O,B as k,g as x,t as C,$ as w,a1 as fe,A as ge,Z as Q,aS as he,q as F,b as ve,aT as W,aH as be,y as M,aU as we,e as ye,co as A,cp as ke,aY as xe}from"./index-CbkGmsUT.js";import{u as Ne,a as Ce}from"./table-CST65CZ1.js";import{_ as X}from"./Grid-CyaoSB-i.js";import{_ as ee}from"./FormItemGridItem-D8sOQ-r2.js";import{_ as ze}from"./round-search-opoHbQsz.js";import{_ as De}from"./round-refresh-BzOWd9gI.js";import{h as E}from"./permission-WYQvwezt.js";import{N as I}from"./Popconfirm-CfoHIMzd.js";const Se=G({name:"OperateDrawer",__name:"operate-drawer",props:V({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(d,{emit:z}){const h=z,u=d,s=re(i());function i(){return{tname:"",weight:void 0}}async function N(){Object.assign(s,i()),u.operateType==="edit"&&u.rowData&&Object.assign(s,u.rowData)}const{formRef:D,validate:y,restoreValidation:m}=Y(),B={tname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},weight:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"}},v=[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"4",value:4},{label:"5",value:5},{label:"6",value:6},{label:"7",value:7},{label:"8",value:8},{label:"9",value:9},{label:"10",value:10}],S=ce(()=>({add:"新增权重",edit:"修改权重"})[u.operateType]),p=H(d,"visible");ue(p,()=>{p.value&&(N(),m())});function c(){p.value=!1}const j=pe.debounce(async()=>{var _,r;if(await y(),u.operateType==="edit"){const{data:b,error:f}=await de([s]);f||(c(),h("submitted"),(_=window.$message)==null||_.success("修改成功"))}else{const{data:b,error:f}=await me([{...s}]);f||(c(),h("submitted"),(r=window.$message)==null||r.success("添加成功"))}},1e3,{leading:!0,trailing:!1});return(_,r)=>{const b=ee,f=X,T=L,$=_e,o=O,n=fe;return U(),P(n,{show:p.value,"onUpdate:show":r[2]||(r[2]=l=>p.value=l),title:S.value,preset:"card",class:"w-500px"},{footer:t(()=>[e(o,{justify:"end",size:16},{default:t(()=>[e(a(k),{onClick:c},{default:t(()=>[x(C(a(w)("common.cancel")),1)]),_:1}),e(a(k),{type:"primary",onClick:a(j)},{default:t(()=>[x(C(a(w)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e($,{class:"pr-20px"},{default:t(()=>[e(T,{ref_key:"formRef",ref:D,model:s,rules:B,"label-placement":"left","label-width":120},{default:t(()=>[e(f,{responsive:"screen","item-responsive":""},{default:t(()=>[e(b,{span:"24 m:24",label:"类型名称",path:"tname"},{default:t(()=>[e(a(Z),{value:s.tname,"onUpdate:value":r[0]||(r[0]=l=>s.tname=l),placeholder:"请输入"},null,8,["value"])]),_:1}),e(b,{span:"24 m:24",label:"权重",path:"weight"},{default:t(()=>[e(a(J),{filterable:"",options:v,clearable:"",value:s.weight,"onUpdate:value":r[1]||(r[1]=l=>s.weight=l)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),je=G({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:V(["reset","search"],["update:model"]),setup(d,{emit:z}){const h=z,{formRef:u,restoreValidation:s}=Y(),i=H(d,"model"),N=[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"4",value:4},{label:"5",value:5},{label:"6",value:6},{label:"7",value:7},{label:"8",value:8},{label:"9",value:9},{label:"10",value:10}];function D(){i.value.fuzzy="",h("search")}async function y(){await s(),h("reset")}async function m(){h("search")}return(B,v)=>{const S=Z,p=ee,c=J,j=De,_=k,r=ze,b=O,f=X,T=L,$=Q;return U(),P($,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(T,{ref_key:"formRef",ref:u,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ge(m,["enter"])},{default:t(()=>[e(f,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(p,{span:"24 s:12 m:6",label:"类型名称",path:"fuzzy"},{default:t(()=>[e(S,{clearable:"",value:i.value.fuzzy,"onUpdate:value":v[0]||(v[0]=o=>i.value.fuzzy=o),placeholder:"请输入类型名称",onClear:D},null,8,["value"])]),_:1}),e(p,{span:"24 s:12 m:4",label:"权重",path:"weight"},{default:t(()=>[e(c,{clearable:"",filterable:"",value:i.value.weight,"onUpdate:value":[v[1]||(v[1]=o=>i.value.weight=o),m],placeholder:"请选择",options:N},null,8,["value"])]),_:1}),e(p,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(b,{class:"w-full"},{default:t(()=>[e(_,{onClick:y},{icon:t(()=>[e(j,{class:"text-icon"})]),default:t(()=>[x(" "+C(a(w)("common.reset")),1)]),_:1}),e(_,{type:"primary",ghost:"",onClick:m},{icon:t(()=>[e(r,{class:"text-icon"})]),default:t(()=>[x(" "+C(a(w)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Te={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function K(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!xe(d)}const qe=G({name:"manage_weight",__name:"index",setup(d){const z=he(),{columns:h,columnChecks:u,data:s,getData:i,loading:N,mobilePagination:D,searchParams:y}=Ne({showTotal:!0,apiFn:ke,apiParams:{page:1,pageSize:20,limit:20,weight:void 0,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"tname",title:"类型名称",align:"center",width:120},{key:"weight",title:"权重",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:w("common.operate"),align:"center",width:E("project:Weight:update")&&E("project:Weight:delete")?180:0,fixed:"right",render:o=>{let n;return e("div",{class:"flex-center gap-8px"},[M(e(k,{type:"primary",ghost:!0,size:"small",onClick:()=>f(o.id)},K(n=w("common.edit"))?n:{default:()=>[n]}),[[F("no-auth"),"project:Weight:update"]]),e(I,{onPositiveClick:()=>b(o.id)},{default:()=>w("common.confirmDelete"),trigger:()=>{let l;return M(e(k,{type:"error",ghost:!0,size:"small"},K(l=w("common.delete"))?l:{default:()=>[l]}),[[F("no-auth"),"project:Weight:delete"]])}})])}}]}),{drawerVisible:m,operateType:B,editingData:v,handleAdd:S,handleEdit:p,checkedRowKeys:c,onBatchDeleted:j,onDeleted:_}=Ce(s,i);async function r(){console.log(c.value),T(c.value.join(","),o=>{j()})}async function b(o){const{data:n,error:l}=await A(o);l||_()}function f(o){p(o)}async function T(o,n){const{data:l,error:R}=await A(o);if(!R)n&&n(l);else return!1}const $=()=>{i()};return(o,n)=>{const l=O,R=ie,te=se,ae=le,ne=be,oe=Q,q=F("no-auth");return U(),ve("div",Te,[e(je,{model:a(y),"onUpdate:model":n[0]||(n[0]=g=>W(y)?y.value=g:null),onReset:$,onSearch:a(i)},null,8,["model","onSearch"]),e(oe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(l,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>n[4]||(n[4]=[ye("div",null,"权重列表",-1)])),_:1,__:[4]})]),"header-extra":t(()=>[e(l,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[M((U(),P(a(k),{onClick:a(S),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(R,{class:"text-icon"})]),default:t(()=>[n[5]||(n[5]=x(" "+C("新增")))]),_:1,__:[5]},8,["onClick"])),[[q,"project:Weight:insert"]]),e(a(I),{onPositiveClick:r},{trigger:t(()=>[M((U(),P(a(k),{size:"small",ghost:"",type:"error",disabled:a(c).length==0},{icon:t(()=>[e(te,{class:we(["text-icon",{"animate-spin":a(N)}])},null,8,["class"])]),default:t(()=>[n[6]||(n[6]=x(" "+C("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[q,"project:Weight:delete"]])]),default:t(()=>[n[7]||(n[7]=x(" 确定要删除选中的权重吗？ "))]),_:1,__:[7]}),e(ae,{columns:a(u),"onUpdate:columns":n[1]||(n[1]=g=>W(u)?u.value=g:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ne,{"checked-row-keys":a(c),"onUpdate:checkedRowKeys":n[2]||(n[2]=g=>W(c)?c.value=g:null),columns:a(h),data:a(s),size:"small","flex-height":!a(z).isMobile,loading:a(N),remote:"","row-key":g=>g.id,pagination:a(D),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Se,{visible:a(m),"onUpdate:visible":n[3]||(n[3]=g=>W(m)?m.value=g:null),onSubmitted:a(i),"operate-type":a(B),"row-data":a(v)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{qe as default};
