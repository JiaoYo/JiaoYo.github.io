import{o as $,e as Z,f as y,d as se,j as v,aV as A,g as o,v as oe,ae as re,w as r,c as B,h,t as g,i as x,B as C,aW as D,Z as H,aK as U,ap as ce,x as J,F as M,aX as E,aY as P,E as V,az as W,ab as ue,aZ as de,K as ie,a_ as pe,a$ as _e,a1 as ve,M as fe,N as me,O as he}from"./index-CqzOHcIS.js";import{_ as ye}from"./Tree-CE1TZnrz.js";import{_ as ke}from"./Slider-BWwdWSe5.js";import{_ as ge}from"./DataTable-BdHa8wrw.js";import{_ as xe}from"./Split-CEptdXql.js";import"./RadioGroup-DbJqgTyK.js";import"./Forward-DTSMmYEU.js";const we={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},be=y("path",{fill:"currentColor",d:"M17 9.17a1 1 0 0 0-1.41 0L12 12.71L8.46 9.17a1 1 0 0 0-1.41 0a1 1 0 0 0 0 1.42l4.24 4.24a1 1 0 0 0 1.42 0L17 10.59a1 1 0 0 0 0-1.42"},null,-1),Ne=[be];function Ce(S,R){return $(),Z("svg",we,[...Ne])}const $e={name:"uil-angle-down",render:Ce},Se=S=>(fe("data-v-450a7017"),S=S(),me(),S),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Te={class:"flex h-100%",style:{"flex-direction":"column"}},Ie={class:"flex"},ze=Se(()=>y("span",null,"监测级别",-1)),Be={class:"flex items-center"},Le={class:"flex items-center"},De={class:"cursor-pointer"},Ue=se({name:"configsetting_realtimedata_channeldetection",__name:"index",setup(S){const R=v({0:"简单",1:"标准",2:"详细"}),b=v(!0),w=v([]),k=v(null),q=v([{title:"监视时间",key:"time",width:240,render(e){return A(2,e.time)}},{title:"监视类型",key:"data_type",width:120,render(e){return e.data_type==0?"发送>>":e.data_type==1?"接收<<":e.data_type==2?"信息  ":e.data_type==3?"警告  ":"错误  "}},{title:"内容长度",key:"data_len",width:120},{title:"监视内容",key:"data_buf",render(e){return o("div",{innerHTML:e.data_buf},null)}}]),t=v({acceptColor:"#d6f0f0",sendOutColor:"#ffe3bf",infoColor:"#f4f4f5",warningColor:"#fdf6ec",errorColor:"#fee7e7",acceptNums:0,sendOutNums:0,infoNums:0,errorNums:0,warningNums:0}),F=[{label:"信息",key:0},{label:"警告",key:1},{label:"错误",key:2}],G=e=>U(D,{value:e.key==0?t.value.infoNums:e.key==1?t.value.warningNums:t.value.errorNums},{default:()=>U("div",{class:"c-#676d71 w-50px h-32px flex items-center justify-center",style:{backgroundColor:e.key==0?t.value.infoColor:e.key==1?t.value.warningColor:t.value.errorColor,borderRadius:"4px"}},{default:()=>e.label})}),X=e=>({style:{minHeight:"50px",background:e.data_type==0?t.value.sendOutColor:e.data_type==1?t.value.acceptColor:e.data_type==2?t.value.infoColor:e.data_type==3?t.value.warningColor:t.value.errorColor}}),Y=({option:e})=>e.key==0?"":e.chl_status!==null?U("span",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:e.hasOwnProperty("chl_status")&&e.chl_status==1?"#00b42a":e.chl_status==2?"#ff0000":"#ccc"}}):"",N=v(),Q=async()=>{var s,_,n,f;const{data:e,error:l}=await ce();if((e==null?void 0:e.length)==0)return;const c=e.reduce((u,d)=>{const m=d.chlType===0?"采集通道":d.chlType===1?"转发通道":"系统通道";let p=u.find(a=>a.key===m);return p||(p={key:m,label:m,children:[],chl_status:null},u.push(p)),p.children.push({key:d.id,label:d.chlName,chlType:d.chlType,chl_status:null}),m=="系统通道"?[]:u},[]);N.value=c,N.value.length>0&&(i.value.chlId=(_=(s=N.value[0])==null?void 0:s.children[0])==null?void 0:_.key,I.value=[(f=(n=N.value[0])==null?void 0:n.children[0])==null?void 0:f.key],ee(),T())},i=v({chlId:"",type:1,level:1}),O=v(null),T=()=>{var f;(f=O.value)==null||f.close(),w.value=[],t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0};const e=new Date().getTime(),l=i.value.level==0?"1":i.value.level==1?"257":"65793";i.value.type=1;const c=J(),s=M(`${c}${e}${i.value.chlId}`),_=E(s),n=new P(V.replace("https","wss")+`/ChannelDetectionWebsocket/${i.value.chlId}/${i.value.type}/${l}/${_}/${e}/${c}?token=${W()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});O.value=n,n.connect(),n.onclose(()=>{}),n.onerror(()=>{}),n.onopen(()=>{}),n.onmessage(u=>{if(console.log(u,"通道监测websocket接受数据"),!K(u.data))return;const d=JSON.parse(u.data);if(w.value.push(...d.param),b.value&&k.value){const a=document.querySelector(".n-scrollbar-content"),z=a==null?void 0:a.scrollHeight;a&&ue(()=>{k.value.scrollTo({top:z,behavior:"smooth"})})}t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0};let m=`      监视时间                  监视类型      内容长度          监视内容
`,p="";w.value.forEach(a=>{switch(a.data_type){case 0:t.value.sendOutNums+=1;break;case 1:t.value.acceptNums+=1;break;case 2:t.value.infoNums+=1;break;case 3:t.value.warningNums+=1;break;case 4:t.value.errorNums+=1;break}p+=A(2,a.time)+"           "+(a.data_type==0?"发送>>":a.data_type==1?"接受<<":a.data_type==2?"信息  ":a.data_type==3?"警告  ":"错误  ")+"         "+a.data_len+"          "+a.data_buf+`
`}),k.value.content=m+p,w.value.length>=1e3&&(w.value=[])})},L=v(null),ee=()=>{var f;(f=L.value)==null||f.close();const e=new Date().getTime(),l=J(),c=M(`${l}${e}getchlstatus`),s=E(c),_=E("getchlstatus"),n=new P(V.replace("https","wss")+`/ChannelStatusWebsocket/${_}/${s}/${e}/${l}?token=${W()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});L.value=n,n.connect(),n.onclose(()=>{}),n.onerror(()=>{}),n.onopen(()=>{}),n.onmessage(u=>{let d=[];console.log(u,"通道状态websocket接受数据"),K(u.data)&&(d=JSON.parse(u.data).data,N.value.forEach(m=>{var p;(p=m.children)==null||p.forEach(a=>{d.forEach(z=>{z.chl_id==a.key&&(a.chl_status=z.chl_status)})})}))})};oe(()=>{Q()}),re(()=>{var e,l;(e=O.value)==null||e.close(),(l=L.value)==null||l.close()});const I=v([]),te=async(e,l,c)=>{var s,_,n;((s=c.node)==null?void 0:s.key)!=I.value[0]&&(I.value=[(_=c.node)==null?void 0:_.key],i.value.chlId=(n=c.node)==null?void 0:n.key,T())},ae=e=>{T()},j=e=>{i.value.type=e,O.value.close(),e==1&&T()},le=()=>{w.value=[],t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0},k.value.content=""},ne=()=>{let e=k.value.content?k.value.content+"":k.value.content,l=new de(".Btn",{text:function(){return e}});l.on("success",c=>{var s;(s=window.$message)==null||s.success("复制成功"),l.destroy()}),l.on("error",c=>{var s;(s=window.$message)==null||s.error("复制失败"),l.destroy()})},K=e=>{try{return JSON.parse(e),!0}catch{return!1}};return(e,l)=>{const c=ye,s=ie,_=ke,n=pe,f=$e,u=_e,d=ve,m=ge,p=xe;return $(),Z("div",Oe,[o(d,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:r(()=>[o(p,{direction:"horizontal",class:"sm:h-full","default-size":.15,max:.35,min:.1,"resize-trigger-size":6},{1:r(()=>[o(c,{"block-line":"","default-expand-all":"",data:N.value,"checked-keys":I.value,"expand-on-click":!1,"check-strategy":"child","onUpdate:checkedKeys":te,"render-prefix":Y,checkable:""},null,8,["data","checked-keys"])]),2:r(()=>[y("div",Te,[o(d,{bordered:!1,size:"small",class:"card-wrapper",style:{"min-height":"60px"}},{header:r(()=>[o(s,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:r(()=>[i.value.type==0?($(),B(x(C),{key:0,onClick:l[0]||(l[0]=a=>j(1))},{default:r(()=>[h(g("开启监视"))]),_:1})):($(),B(x(C),{key:1,onClick:l[1]||(l[1]=a=>j(0))},{default:r(()=>[h(g("停止监视"))]),_:1})),b.value?($(),B(x(C),{key:3,onClick:l[3]||(l[3]=a=>b.value=!b.value)},{default:r(()=>[h(g("停止滚屏"))]),_:1})):($(),B(x(C),{key:2,onClick:l[2]||(l[2]=a=>b.value=!b.value)},{default:r(()=>[h(g("开启滚屏"))]),_:1})),o(x(C),{onClick:le},{default:r(()=>[h(g("清空列表"))]),_:1}),o(x(C),{onClick:ne,class:"Btn"},{default:r(()=>[h(g("复制全部内容"))]),_:1})]),_:1})]),"header-extra":r(()=>[o(s,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:r(()=>[y("div",Ie,[ze,o(_,{value:i.value.level,"onUpdate:value":[l[4]||(l[4]=a=>i.value.level=a),ae],step:1,marks:R.value,min:0,max:2,style:{margin:"0 10px",width:"170px !important"}},null,8,["value","marks"])]),y("div",Be,[h(" 发送报文颜色 "),o(n,{class:"w-24px h-24px ml-5px",swatches:["#ffe3bf","#d6f0f0"],value:t.value.sendOutColor,"onUpdate:value":l[5]||(l[5]=a=>t.value.sendOutColor=a)},null,8,["value"])]),y("div",Le,[h(" 接受报文颜色 "),o(n,{class:"w-24px h-24px ml-5px",swatches:["#ffe3bf","#d6f0f0"],value:t.value.acceptColor,"onUpdate:value":l[6]||(l[6]=a=>t.value.acceptColor=a)},null,8,["value"])]),o(x(D),{value:t.value.sendOutNums},{default:r(()=>[y("div",{style:H({background:t.value.sendOutColor}),class:"c-#676d71 w-50px h-32px flex items-center justify-center"},g("发送"),4)]),_:1},8,["value"]),o(x(D),{value:t.value.acceptNums},{default:r(()=>[y("div",{style:H({background:t.value.acceptColor}),class:"c-#676d71 w-50px h-32px flex items-center justify-center"},g("接收"),4)]),_:1},8,["value"]),o(u,{trigger:"click",options:F,"render-label":G},{default:r(()=>[y("span",De,[h("其他类型 "),o(f,{class:"font-size-20px"})])]),_:1})]),_:1})]),_:1}),o(m,{columns:q.value,ref_key:"tableRef",ref:k,data:w.value,size:"small",remote:"","row-key":a=>a.id,"flex-height":!0,"scroll-x":"",class:"sm:h-full flex-1 pl-16px","row-props":X},null,8,["columns","data","row-key"])])]),_:1})]),_:1})])}}}),Me=he(Ue,[["__scopeId","data-v-450a7017"]]);export{Me as default};
