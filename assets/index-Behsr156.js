import{d as Z,q as ee,j as y,Z as le,v as de,s as ae,r as H,K as pe,o as x,c as U,w as s,g as l,N as Y,L as ce,i as I,$ as A,U as fe,e as q,ai as ve,h as v,t as _,f as J,M as me,av as _e,an as N,ao as K,A as ge,X as Ie,B as Q,E as te,D as he,a9 as ne,y as ye,am as W,ad as oe,ap as Se,aq as be,S as we,F as xe,aw as Ae,ax as ke,ay as se}from"./index-CsSYpLym.js";import{l as ie}from"./lodash-DCZj5awB.js";import{_ as Ee,a as Ce}from"./arrow-open-up-BdC2WXAm.js";import{_ as De}from"./round-search-Dtp7E9Hm.js";import{_ as $e}from"./round-refresh-DOrEb6Qo.js";import{a as Te,T as X}from"./basicconf-CaRhvIk2.js";import{b as ze,a as Pe,f as Le}from"./common-O_RqPCnR.js";import{_ as Ne}from"./Cascader-BVd1lDZ7.js";import{_ as Ve}from"./FormItemGridItem-Bdm6h163.js";import{_ as Ue}from"./DatePicker-DqKu08f5.js";import{_ as Me}from"./Grid-C4cZ6WxQ.js";import{q as Be,f as Oe,r as Re}from"./events-jF9iLWL-.js";import{_ as Ge}from"./originlogInfo.vue_vue_type_script_setup_true_lang-Dl09xhZG.js";import{_ as Fe,a as je}from"./DescriptionsItem-BxWcq1Z2.js";import{_ as re}from"./DataTable-aZh4mZz2.js";import"./TimePicker-DZnukPB5.js";import"./defineProperty-CqYQ46Aw.js";import"./Forward-C9tKHKQU.js";import"./CollapseItem-AreTU99s.js";const He=Z({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ee(["search"],["update:model"]),setup(m,{emit:$}){const b=$,i=y(!1),S=le(),{formRef:w,restoreValidation:d}=de(),e=ae(m,"model"),k=y();(async()=>{const{data:n,error:o}=await ze();o||(k.value=n.map(f=>({...f,id:"-"+f.id,type:f.cname})))})();const E=H({eventsTypeDataList:[],eventsCategoryData:[]});async function h(){const{data:n,error:o}=await Pe();o||(E.eventsTypeDataList=n)}h();async function T(){const{data:n,error:o}=await Le();o||(E.eventsCategoryData=n)}T();function V(){e.value.fuzzy=void 0,a()}async function u(n,o){n?(e.value.startTime=n[0],e.value.endTime=n[1]):(e.value.startTime=null,e.value.endTime=null),b("search")}async function c(){await d(),e.value.lsid=null,e.value.etype=null,e.value.elevel=null,e.value.fuzzy=null,e.value.startAndEndSendSourceIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.timeRange=null,e.value.ectgr=null,e.value.startSourceIp=null,e.value.endSourceIp=null,e.value.startAimIp=null,e.value.endAimIp=null,e.value.startSIp=null,e.value.endSIp=null,e.value.startTime=null,e.value.endTime=null,_e(()=>{b("search")})}async function a(){var n,o,f,r,g,C,L,t,D,z;if(e.value.startAndEndSendSourceIp&&e.value.startAndEndSendSourceIp.length>0?(e.value.startSIp=e.value.startAndEndSendSourceIp[0]||null,e.value.endSIp=e.value.startAndEndSendSourceIp[1]||null):(e.value.startSIp=null,e.value.endSIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=void 0,e.value.endSourceIp=void 0),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimIp=void 0,e.value.endAimIp=void 0),e.value.startSIp&&!N(e.value.startSIp)||e.value.startSourceIp&&!N(e.value.startSourceIp)||e.value.startAimIp&&!N(e.value.startAimIp))return(n=window.$message)==null||n.destroyAll(),(o=window.$message)==null||o.error("请输入正确的IP地址"),!1;if(e.value.endSIp&&!N(e.value.endSIp)||e.value.endSourceIp&&!N(e.value.endSourceIp)||e.value.endAimIp&&!N(e.value.endAimIp))return(f=window.$message)==null||f.destroyAll(),(r=window.$message)==null||r.error("请输入正确的IP地址"),!1;if(e.value.startSIp&&e.value.endSIp&&K(e.value.startSIp,e.value.endSIp)>0)return(g=window.$message)==null||g.destroyAll(),(C=window.$message)==null||C.error("发生源起始IP不能大于发生源终止IP"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&K(e.value.startSourceIp,e.value.endSourceIp)>0)return(L=window.$message)==null||L.destroyAll(),(t=window.$message)==null||t.error("源起始IP不能大于源终止IP"),!1;if(e.value.startAimIp&&e.value.endAimIp&&K(e.value.startAimIp,e.value.endAimIp)>0)return(D=window.$message)==null||D.destroyAll(),(z=window.$message)==null||z.error("目的起始IP不能大于目的终止IP"),!1;b("search")}return(n,o)=>{const f=Ne,r=Ve,g=ge,C=Ie,L=Ue,t=$e,D=Q,z=De,M=Ee,B=Ce,O=te,R=Me,G=he,F=ne,j=pe("no-space");return x(),U(F,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[l(G,{ref_key:"formRef",ref:w,model:e.value,"label-placement":"left","label-width":I(S).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:me(a,["enter"])},{default:s(()=>[l(R,{responsive:"screen","item-responsive":"","y-gap":12},{default:s(()=>[i.value?(x(),U(r,{key:0,span:"24 s:24 m:6",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:s(()=>[l(f,{value:e.value.lsid,"onUpdate:value":[o[0]||(o[0]=p=>e.value.lsid=p),a],placeholder:"请选择日志源设备",options:k.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1})):Y("",!0),l(r,{span:"24 s:12 m:6",label:"事件名称",path:"fuzzy",class:"pr-24px"},{default:s(()=>[ce(l(g,{value:e.value.fuzzy,"onUpdate:value":o[1]||(o[1]=p=>e.value.fuzzy=p),placeholder:"请输入事件名称",clearable:"",onClear:V},null,8,["value"]),[[j]])]),_:1}),l(r,{span:"24 s:24 m:6",label:"事件类型",path:"etype",class:"pr-24px"},{default:s(()=>[l(C,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.etype,"onUpdate:value":[o[2]||(o[2]=p=>e.value.etype=p),a],"value-field":"id","label-field":"pname",options:E.eventsTypeDataList},null,8,["value","options"])]),_:1}),l(r,{span:"24 s:12 m:6",label:I(A)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:s(()=>[l(C,{filterable:"",clearable:"",placeholder:I(A)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[o[3]||(o[3]=p=>e.value.elevel=p),a],options:I(fe)(I(Te))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),i.value?(x(),q(ve,{key:1},[l(r,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSendSourceIp",class:"pr-24px"},{default:s(()=>[l(g,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSendSourceIp,"onUpdate:value":o[4]||(o[4]=p=>e.value.startAndEndSendSourceIp=p)},null,8,["value"])]),_:1}),l(r,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndSourceIp",class:"pr-24px"},{default:s(()=>[l(g,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":o[5]||(o[5]=p=>e.value.startAndEndSourceIp=p)},null,8,["value"])]),_:1}),l(r,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px"},{default:s(()=>[l(g,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":o[6]||(o[6]=p=>e.value.startAndEndAimSourceIp=p)},null,8,["value"])]),_:1}),l(r,{span:"24 s:12 m:8",label:"产生时间",path:"timeRange",class:"pr-24px"},{default:s(()=>[l(L,{clearable:"",value:e.value.timeRange,"onUpdate:value":o[7]||(o[7]=p=>e.value.timeRange=p),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":u},null,8,["value"])]),_:1}),l(r,{span:"24 s:12 m:8",label:"事件类别",path:"ectgr",class:"pr-24px"},{default:s(()=>[l(C,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.ectgr,"onUpdate:value":[o[8]||(o[8]=p=>e.value.ectgr=p),a],"value-field":"id","label-field":"pname",options:E.eventsCategoryData},null,8,["value","options"])]),_:1})],64)):Y("",!0),l(r,{span:"24 s:12 m:6",class:"pr-24px"},{default:s(()=>[l(O,{class:"w-full",align:"center"},{default:s(()=>[l(D,{onClick:c},{icon:s(()=>[l(t,{class:"text-icon"})]),default:s(()=>[v(" "+_(I(A)("common.reset")),1)]),_:1}),l(D,{type:"primary",ghost:"",onClick:a},{icon:s(()=>[l(z,{class:"text-icon"})]),default:s(()=>[v(" "+_(I(A)("common.search")),1)]),_:1}),J("div",{class:"cursor-pointer",title:"精准查询",onClick:o[9]||(o[9]=p=>i.value=!i.value)},[i.value?(x(),U(M,{key:0,class:"text-icon"})):(x(),U(B,{key:1,class:"text-icon"}))])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width"])]),_:1})}}}),ue=m=>(Ae("data-v-d32cbfae"),m=m(),ke(),m),qe=ue(()=>J("span",null,"基本信息",-1)),Ke=ue(()=>J("span",null,"原始日志信息",-1)),We={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"400px"}},Xe={key:1,class:"max-h-500px min-h-450px"};function Ze(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!oe(m)}const Je=Z({__name:"detailInfo",props:ee({detailInfo:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(m){const $=ae(m,"detailVisible"),b=m,i=y();ye(()=>$.value,async u=>{u&&(i.value=b.detailInfo,e())});const S=[{title:"",key:"index",width:50,render:(u,c)=>`${c+1}`},{key:"pname2",title:"事件类别",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:u=>{(u.elevel===void 0||u.elevel===null)&&(u.elevel=1);const c={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},a=A(X[u.elevel]);let n={color:c[u.elevel],textColor:"#ffffff",borderColor:c[u.elevel]};return l(W,{size:"small",color:n},Ze(a)?a:{default:()=>[a]})}},{key:"sourceip",title:"发生源IP",align:"center",width:120},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"operate",title:A("common.operate"),align:"center",width:80,fixed:"right",render:u=>l("div",{class:"flex-center gap-8px"},[l(Q,{type:"info",ghost:!0,size:"small",onClick:()=>V(u)},{default:()=>[v("详情")]})])}],w=y(!1);let d=y([]);const e=async u=>{var n;if(!w.value)w.value=!0;else return;const{data:c,error:a}=await Be({aggid:(n=i.value)==null?void 0:n.aggid,limit:10,pageId:u});a||(w.value=!1,u?d.value=[...d.value,...c]:d.value=c)};function k(u){var c;u.target.scrollTop+u.target.offsetHeight==u.target.scrollHeight&&((c=i.value)==null?void 0:c.aggre)>d.value.length&&P()}const P=ie.debounce(()=>{e(d.value[d.value.length-1].id)},300),E=H({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:u,endIndex:c,page:a,pageSize:n,pageCount:o,itemCount:f}){var r;return`已加载${d.value.length}条 共计${(r=i.value)==null?void 0:r.aggre} 条`}}),h=y(!1),T=y(),V=async u=>{h.value=!0,T.value=u};return(u,c)=>{const a=Fe,n=je,o=te,f=Se,r=re,g=be,C=we,L=xe;return x(),U(L,{show:$.value,"onUpdate:show":c[1]||(c[1]=t=>$.value=t),title:"事件详情",preset:"card",class:"w-1000px"},{default:s(()=>[l(C,{class:"max-h-600px pr-20px"},{default:s(()=>[l(g,{type:"line",animated:""},{default:s(()=>[l(f,{name:"1"},{tab:s(()=>[qe]),default:s(()=>[l(o,{vertical:"",size:12},{default:s(()=>[l(n,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:s(()=>[l(a,{label:"事件名称"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.ename),1)]}),_:1}),l(a,{label:"事件类型"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.pname1),1)]}),_:1}),l(a,{label:"事件类别"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.pname2),1)]}),_:1}),l(a,{label:"事件等级"},{default:s(()=>{var t,D,z,M,B,O,R,G,F,j;return[l(I(W),{size:"small",color:{textColor:"#ffffff",borderColor:((t=i.value)==null?void 0:t.elevel)===0?"#8e9dff":((D=i.value)==null?void 0:D.elevel)===1?"#5da8ff":((z=i.value)==null?void 0:z.elevel)===2?"#fedc69":((M=i.value)==null?void 0:M.elevel)===3?"#ff9874":((B=i.value)==null?void 0:B.elevel)===4?"#ff0000":"#5da8ff",color:((O=i.value)==null?void 0:O.elevel)===0?"#8e9dff":((R=i.value)==null?void 0:R.elevel)===1?"#5da8ff":((G=i.value)==null?void 0:G.elevel)===2?"#fedc69":((F=i.value)==null?void 0:F.elevel)===3?"#ff9874":((j=i.value)==null?void 0:j.elevel)===4?"#ff0000":"#5da8ff"}},{default:s(()=>{var p;return[v(_(I(A)(I(X)[(p=i.value)==null?void 0:p.elevel])),1)]}),_:1},8,["color"])]}),_:1}),l(a,{label:"日志源设备"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.type),1)]}),_:1}),l(a,{label:"聚合开始时间"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.aggrestarttime),1)]}),_:1}),l(a,{label:"聚合结束时间"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.aggreendtime),1)]}),_:1}),l(a,{label:"聚合数量"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.aggre),1)]}),_:1}),l(a,{label:"发生源IP"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.sip),1)]}),_:1}),l(a,{label:"源IP"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.sourceip),1)]}),_:1}),l(a,{label:"源端口"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.sourceport),1)]}),_:1}),l(a,{label:"目的IP"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.aimip),1)]}),_:1}),l(a,{label:"目的端口"},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.aimport),1)]}),_:1}),l(a,{label:"事件描述",span:3},{default:s(()=>{var t;return[v(_((t=i.value)==null?void 0:t.aimip),1)]}),_:1})]),_:1})]),_:1})]),_:1}),l(f,{name:"2"},{tab:s(()=>[Ke]),default:s(()=>[I(d).length==0?(x(),q("div",We," 暂无原始日志信息 ")):(x(),q("div",Xe,[l(r,{columns:S,data:I(d),size:"small","scroll-x":762,"row-key":t=>t.id,"virtual-scroll":"",class:"sm:h-full",pagination:E,onScroll:k,loading:w.value,"max-height":400},null,8,["data","row-key","pagination","loading"])])),l(Ge,{detailVisible:h.value,"onUpdate:detailVisible":c[0]||(c[0]=t=>h.value=t),detailInfo:T.value},null,8,["detailVisible","detailInfo"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Qe=se(Je,[["__scopeId","data-v-d32cbfae"]]),Ye={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function el(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!oe(m)}const ll=Z({name:"eventalarm_eventalarm",__name:"index",setup(m){const $=le(),b=y(!1),i=y(),S=H({pageId:void 0,limit:100,lsid:void 0,etype:void 0,ectgr:void 0,elevel:void 0,startSIp:void 0,endSIp:void 0,startSourceIp:void 0,endSourceIp:void 0,startAimIp:void 0,endAimIp:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),w=[{title:"",key:"index",width:80,render:(a,n)=>`${n+1}`},{key:"ename",title:"事件名称",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:160},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",width:120,render:a=>{(a.elevel===void 0||a.elevel===null)&&(a.elevel=1);const n={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},o=A(X[a.elevel]);let f={color:n[a.elevel],textColor:"#ffffff",borderColor:n[a.elevel]};return l(W,{size:"small",color:f},el(o)?o:{default:()=>[o]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"sip",title:"发生源IP",align:"center",width:160},{key:"aggreendtime",title:"聚合结束时间",align:"center",width:160},{key:"operate",title:A("common.operate"),align:"center",width:100,fixed:"right",render:a=>l("div",{class:"flex-center gap-8px"},[l(Q,{type:"primary",ghost:!0,size:"small",onClick:()=>c(a)},{default:()=>[v("查看")]})])}],d=y([]),e=y(!1),k=async(a=!1)=>{if(!e.value)e.value=!0;else return;const{data:n,error:o}=await Oe(S);o||(a?d.value=[...d.value,...n]:d.value=n,e.value=!1)};k();const P=y(!0),E=()=>{d.value=[],S.pageId=void 0,(n=>Object.keys(n).filter(r=>r!=="limit"&&r!=="_t").some(r=>n[r]!==void 0&&n[r]!==""&&n[r]!==null))(S)?P.value=!1:(P.value=!0,T()),k()},h=H({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:n,page:o,pageSize:f,pageCount:r,itemCount:g}){return`已加载${d.value.length}条`+(d.value.length?P.value?` 共计 ${d.value.length>0?g??0:0} 条`:d.value.length>=S.limit?"  预计还有更多":"":"")}});async function T(){const{data:a,error:n}=await Re();n||(h.pageCount=20,h.total=Number(a),h.itemCount=Number(a))}T();function V(a){var n;a.target.scrollTop+a.target.offsetHeight==a.target.scrollHeight&&h.total>((n=d.value)==null?void 0:n.length)&&u()}const u=ie.debounce(()=>{var a;((a=d.value)==null?void 0:a.length)<h.total&&(S.pageId=d.value[d.value.length-1].id,k(!0))},300);async function c(a){i.value=a,b.value=!0}return(a,n)=>{const o=re,f=ne;return x(),q("div",Ye,[l(He,{model:S,"onUpdate:model":n[0]||(n[0]=r=>S=r),onSearch:E},null,8,["model"]),l(f,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:s(()=>[l(o,{columns:w,data:d.value,size:"small","flex-height":!I($).isMobile,loading:e.value,remote:"","scroll-x":w.reduce((r,g)=>r+g.width,0),"row-key":r=>r.id,pagination:h,"virtual-scroll":"",onScroll:V,class:"sm:h-full"},null,8,["data","flex-height","loading","scroll-x","row-key","pagination"])]),_:1}),l(Qe,{detailVisible:b.value,"onUpdate:detailVisible":n[1]||(n[1]=r=>b.value=r),detailInfo:i.value},null,8,["detailVisible","detailInfo"])])}}}),Sl=se(ll,[["__scopeId","data-v-c054a5f4"]]);export{Sl as default};
