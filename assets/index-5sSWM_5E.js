import{_ as Ne}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BPQY3SHr.js";import{_ as ze}from"./round-delete-Ccho25kB.js";import{_ as Se}from"./round-add-C39zxNhK.js";import{d as re,aq as oe,s as Ue,r as W,q as me,a as Te,ar as fe,a1 as qe,c as f,o as u,w as l,f as a,b5 as Pe,F as ve,y as $,h as n,at as J,A as z,an as Re,aa as $e,b8 as Ie,g as m,b as Q,e as X,t as S,B as D,N as ie,$ as I,b6 as Fe,E as je,U as ge,L as Be,i as Le,x as ne,az as Z,av as Me,C as ee,bl as Oe,W as de,aC as Ee}from"./index-CKR2IDhL.js";import{f as _e,o as Ge,s as Ve,a as He,t as Ae,u as Ke,v as We,w as ue,x as Je}from"./project-u8e2XwXH.js";import{u as Qe,a as Xe}from"./table-DL4dTkzV.js";import{u as se}from"./usePageData-2V6Iaoub.js";import{_ as ye}from"./Grid-C0u5attG.js";import{_ as he}from"./FormItemGridItem-t2jnramH.js";import{N as Ye}from"./Upload-CD63x0qa.js";import{_ as Ze}from"./round-search-Bcuze01M.js";import{_ as et}from"./round-refresh-vC6awlrf.js";import{N as pe}from"./Popconfirm-qcN6-Wmq.js";import"./Progress-5D669xFv.js";import"./utils-CrF7hGNi.js";const tt={key:0},at={key:0},lt={key:0},nt={key:0},ot=re({name:"OperateDrawer",__name:"operate-drawer",props:oe({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:oe(["submitted"],["update:visible"]),setup(U,{emit:E}){const T=E,y=U,t=Ue(c());function c(){return{pid:void 0,cid:void 0,contractId:void 0,id:"",devname:"",devmodel:"",devunit:"",devnum:0,notes:"",etype:0,devmanu:"",status:0,re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const w=W([]),{pageData:h,getData:F,nextPage:j}=se(_e),G=async s=>{const e=s.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&h.data.length<h.total&&(j(),w.value=h.data)},V=async()=>{var s,e;await F(),t.pid=(s=h.data[0])==null?void 0:s.id,w.value=h.data,await O(),t.contractId=(e=C.value[0])==null?void 0:e.id,_()},q=W(),{pageData:k,getData:x,nextPage:M}=se(Ge),_=async()=>{await x({pids:t.contractId}),q.value=[],q.value=k.data.map(s=>({label:s.devname,value:s.id}))},b=async s=>{const e=s.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&k.data.length<k.total&&(M(),q.value=k.data.map(i=>({label:i.devname,value:i.id})))},H=async s=>{var e;t.pid=s,await O(),t.contractId=(e=C.value[0])==null?void 0:e.id,await _(),t.cid=null},C=W([]),O=async()=>{const{data:s,error:e}=await Ve({id:t.pid,limit:100,page:1});C.value=s==null?void 0:s.list},A=async s=>{t.contractId=s,await _(),t.cid=null},P=W(),d=async s=>{t.cid=s;const e=k.data.find(i=>i.id==s);t.devname=e==null?void 0:e.devname,t.devnum=e==null?void 0:e.devcount,P.value=e==null?void 0:e.devcount,t.etype=e==null?void 0:e.devtype,t.devmanu=e==null?void 0:e.devmanu,t.notes=e==null?void 0:e.notes,t.devmodel=e==null?void 0:e.devmodel,t.devunit=e==null?void 0:e.devunit};async function r({file:s},e){let i=new FormData;i.append("multipartFile",s.file);const{data:N,error:le}=await He(i);le||(t[e]=N)}async function v(){var s,e;if(V(),Object.assign(t,c()),y.operateType==="edit"&&y.rowData&&(Object.assign(t,y.rowData),P.value=(s=k.data.find(i=>i.id==t.cid))==null?void 0:s.devcount,!k.data.find(i=>i.id==t.cid))){const{data:i,error:N}=await Ae(t.cid);N||(e=q.value)==null||e.push({value:i.id,label:i.devname})}}const{formRef:B,validate:K,restoreValidation:L}=me(),te={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},contractId:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},cid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devmodel:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devnum:{type:"number",required:!0,trigger:["blur","change"],message:"请输入"},devunit:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},ae=Te(()=>({add:"新增设备",edit:"修改设备"})[y.operateType]),R=fe(U,"visible");qe(R,()=>{R.value&&(v(),setTimeout(()=>{const s=document.querySelector(".n-scrollbar-content");s==null||s.scrollTo(0,0)},300),L())});function g(){R.value=!1}async function be(){var s,e;if(await K(),y.operateType==="edit"){const{data:i,error:N}=await Ke([t]);N||(g(),T("submitted"),(s=window.$message)==null||s.success("修改成功"))}else{const{data:i,error:N}=await We([{...t}]);N||(g(),T("submitted"),(e=window.$message)==null||e.success("添加成功"))}}return(s,e)=>{const i=he,N=Ie,le=$e,Y=Ye,we=ye,ke=ve,De=Pe,xe=ie,Ce=Fe;return u(),f(Ce,{show:R.value,"onUpdate:show":e[19]||(e[19]=o=>R.value=o),title:ae.value,preset:"card",class:"w-800px"},{footer:l(()=>[a(xe,{justify:"end",size:16},{default:l(()=>[a(n(D),{onClick:g},{default:l(()=>[m(S(n(I)("common.cancel")),1)]),_:1}),a(n(D),{type:"primary",onClick:be},{default:l(()=>[m(S(n(I)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[a(De,{class:"pr-20px"},{default:l(()=>[a(ke,{ref_key:"formRef",ref:B,model:t,rules:te,"label-placement":"left","label-width":120},{default:l(()=>[a(we,{responsive:"screen","item-responsive":""},{default:l(()=>[a(i,{span:"24 m:12",label:"项目列表",path:"pid"},{default:l(()=>[a(n(J),{clearable:"",filterable:"",value:t.pid,"onUpdate:value":[e[0]||(e[0]=o=>t.pid=o),H],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:w.value,onScroll:G},null,8,["value","options"])]),_:1}),a(i,{span:"24 m:12",label:"关联合同",path:"contractId"},{default:l(()=>[a(n(J),{clearable:"",filterable:"",value:t.contractId,"onUpdate:value":[e[1]||(e[1]=o=>t.contractId=o),A],placeholder:"请选择合同","label-field":"contractname","value-field":"id",options:C.value},null,8,["value","options"])]),_:1}),a(i,{span:"24 m:12",label:"绑定合同设备",path:"cid"},{default:l(()=>[a(n(J),{clearable:"",value:t.cid,"onUpdate:value":[e[2]||(e[2]=o=>t.cid=o),d],placeholder:"请选择合同设备",onScroll:b,options:q.value},null,8,["value","options"])]),_:1}),t.cid?(u(),f(i,{key:0,span:"24 m:12",label:"设备名称",path:"devname"},{default:l(()=>[a(n(z),{value:t.devname,"onUpdate:value":e[3]||(e[3]=o=>t.devname=o),clearable:"",placeholder:"请输入"},null,8,["value"])]),_:1})):$("",!0),t.cid?(u(),f(i,{key:1,span:"24 m:12",label:"数量",path:"devnum"},{default:l(()=>[a(n(Re),{value:t.devnum,"onUpdate:value":e[4]||(e[4]=o=>t.devnum=o),placeholder:"请输入",max:P.value,style:{width:"100%"}},null,8,["value","max"])]),_:1})):$("",!0),t.cid?(u(),f(i,{key:2,span:"24 m:12",label:"设备单位",path:"devunit"},{default:l(()=>[a(n(z),{value:t.devunit,"onUpdate:value":e[5]||(e[5]=o=>t.devunit=o),placeholder:"请输入",readonly:""},null,8,["value"])]),_:1})):$("",!0),t.cid?(u(),f(i,{key:3,span:"24 m:12",label:"型号",path:"devmodel"},{default:l(()=>[a(n(z),{value:t.devmodel,"onUpdate:value":e[6]||(e[6]=o=>t.devmodel=o),placeholder:"请输入",readonly:""},null,8,["value"])]),_:1})):$("",!0),t.cid?(u(),f(i,{key:4,span:"24 m:12",label:"是否为我司设备",path:"etype"},{default:l(()=>[a(le,{value:t.etype,"onUpdate:value":e[7]||(e[7]=o=>t.etype=o),name:"radiogroup",disabled:""},{default:l(()=>[a(N,{value:0},{default:l(()=>e[20]||(e[20]=[m("是")])),_:1,__:[20]}),a(N,{value:1},{default:l(()=>e[21]||(e[21]=[m("否")])),_:1,__:[21]})]),_:1},8,["value"])]),_:1})):$("",!0),t.cid?(u(),f(i,{key:5,span:"24 m:12",label:"设备厂家",path:"devmanu"},{default:l(()=>[a(n(z),{value:t.devmanu,"onUpdate:value":e[8]||(e[8]=o=>t.devmanu=o),placeholder:"请输入",readonly:""},null,8,["value"])]),_:1})):$("",!0),y.operateType=="edit"?(u(),f(i,{key:6,span:"24 m:12",label:"清点状态",path:"status"},{default:l(()=>[a(n(J),{clearable:"",value:t.status,"onUpdate:value":e[9]||(e[9]=o=>t.status=o),placeholder:"请选择",options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}]},null,8,["value"])]),_:1})):$("",!0),t.cid?(u(),f(i,{key:7,span:"24 m:12",label:"备注",path:"notes"},{default:l(()=>[a(n(z),{value:t.notes,"onUpdate:value":e[10]||(e[10]=o=>t.notes=o),placeholder:"请输入",readonly:""},null,8,["value"])]),_:1})):$("",!0),a(i,{span:"24 m:24",label:"附件1",path:"notes"},{default:l(()=>{var o;return[a(n(z),{value:t.re1,"onUpdate:value":e[11]||(e[11]=p=>t.re1=p),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl1?(u(),Q("span",tt,[m(S((o=t.fl1)==null?void 0:o.split("?")[1])+" ",1),X("span",{class:"cursor-pointer c-#c92a2a",onClick:e[12]||(e[12]=p=>t.fl1="")},"删除")])):(u(),f(Y,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":p=>r(p,"fl1"),"show-file-list":!1},{default:l(()=>[a(n(D),{size:"small",ghost:"",type:"primary"},{default:l(()=>e[22]||(e[22]=[m("选择文件")])),_:1,__:[22]})]),_:1},8,["custom-request"]))]}),_:1}),a(i,{span:"24 m:24",label:"附件2",path:"notes"},{default:l(()=>{var o;return[a(n(z),{value:t.re2,"onUpdate:value":e[13]||(e[13]=p=>t.re2=p),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl2?(u(),Q("span",at,[m(S((o=t.fl2)==null?void 0:o.split("?")[1])+" ",1),X("span",{class:"cursor-pointer c-#c92a2a",onClick:e[14]||(e[14]=p=>t.fl2="")},"删除")])):(u(),f(Y,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":p=>r(p,"fl2"),"show-file-list":!1},{default:l(()=>[a(n(D),{size:"small",ghost:"",type:"primary"},{default:l(()=>e[23]||(e[23]=[m("选择文件")])),_:1,__:[23]})]),_:1},8,["custom-request"]))]}),_:1}),a(i,{span:"24 m:24",label:"附件3",path:"notes"},{default:l(()=>{var o;return[a(n(z),{value:t.re3,"onUpdate:value":e[15]||(e[15]=p=>t.re3=p),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl3?(u(),Q("span",lt,[m(S((o=t.fl3)==null?void 0:o.split("?")[1])+" ",1),X("span",{class:"cursor-pointer c-#c92a2a",onClick:e[16]||(e[16]=p=>t.fl3="")},"删除")])):(u(),f(Y,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":p=>r(p,"fl3"),"show-file-list":!1},{default:l(()=>[a(n(D),{size:"small",ghost:"",type:"primary"},{default:l(()=>e[24]||(e[24]=[m("选择文件")])),_:1,__:[24]})]),_:1},8,["custom-request"]))]}),_:1}),a(i,{span:"24 m:24",label:"附件4",path:"notes"},{default:l(()=>{var o;return[a(n(z),{value:t.re4,"onUpdate:value":e[17]||(e[17]=p=>t.re4=p),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl4?(u(),Q("span",nt,[m(S((o=t.fl4)==null?void 0:o.split("?")[1])+" ",1),X("span",{class:"cursor-pointer c-#c92a2a",onClick:e[18]||(e[18]=p=>t.fl4="")},"删除")])):(u(),f(Y,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":p=>r(p,"fl4"),"show-file-list":!1},{default:l(()=>[a(n(D),{size:"small",ghost:"",type:"primary"},{default:l(()=>e[25]||(e[25]=[m("选择文件")])),_:1,__:[25]})]),_:1},8,["custom-request"]))]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),st=re({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:oe(["reset","search","clear"],["update:model"]),setup(U,{emit:E}){const T=E,{formRef:y,restoreValidation:t}=me(),c=fe(U,"model"),w=W([]),{pageData:h,getData:F,nextPage:j}=se(_e),G=async _=>{const b=_.currentTarget;b.scrollTop+b.offsetHeight>=b.scrollHeight&&h.data.length<h.total&&(j(),w.value=h.data)},V=async _=>{c.value.pid=_};(async()=>{var _;await F(),w.value=h.data,c.value.pid=(_=w.value[0])==null?void 0:_.id,T("search")})();async function k(){await t(),c.value.fuzzy="",T("reset")}const x=()=>{c.value.fuzzy="",T("search")};async function M(){T("search")}return(_,b)=>{const H=J,C=he,O=z,A=et,P=D,d=Ze,r=ie,v=ye,B=ve,K=ge;return u(),f(K,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[a(B,{ref_key:"formRef",ref:y,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:je(M,["enter"])},{default:l(()=>[a(v,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[a(C,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:l(()=>[a(H,{filterable:"",value:c.value.pid,"onUpdate:value":[b[0]||(b[0]=L=>c.value.pid=L),V],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:w.value,onScroll:G},null,8,["value","options"])]),_:1}),a(C,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:l(()=>[a(O,{value:c.value.fuzzy,"onUpdate:value":b[1]||(b[1]=L=>c.value.fuzzy=L),placeholder:"请输入",clearable:"",onClear:x},null,8,["value"])]),_:1}),a(C,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[a(r,{class:"w-full"},{default:l(()=>[a(P,{onClick:k},{icon:l(()=>[a(A,{class:"text-icon"})]),default:l(()=>[m(" "+S(n(I)("common.reset")),1)]),_:1}),a(P,{type:"primary",ghost:"",onClick:M},{icon:l(()=>[a(d,{class:"text-icon"})]),default:l(()=>[m(" "+S(n(I)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),rt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ce(U){return typeof U=="function"||Object.prototype.toString.call(U)==="[object Object]"&&!Ee(U)}const Dt=re({name:"projectmanagement_device",__name:"index",setup(U){const E=Be(),{columns:T,columnChecks:y,data:t,getData:c,loading:w,mobilePagination:h,searchParams:F}=Qe({showTotal:!0,immediate:!1,apiFn:Je,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"devname",title:"设备名称",align:"center",width:120},{key:"devmodel",title:"型号",align:"center",width:120},{key:"devnum",title:"数量",align:"center",width:120},{key:"devunit",title:"设备单位",align:"center",width:120},{key:"etype",title:"是否为我司设备",align:"center",width:120,render(d){return de("div",{},d.etype==0?"是":"否")}},{key:"devmanu",title:"设备厂家",align:"center",width:120},{key:"status",title:"清点状态",align:"center",width:120,render(d){return de("div",{},d.status==0?"未清点":d.status==1?"正常":d.status==2?"增补":d.status==3?"退货":"换货")}},{key:"notes",title:"备注",align:"center",width:120},{key:"dusername",title:"清点人",align:"center",width:120},{key:"ddbtime",title:"清点时间",align:"center",width:120},{key:"username",title:"操作人",align:"center",width:120},{key:"dbtime",title:"操作时间",align:"center",width:120},{key:"operate",title:I("common.operate"),align:"center",width:140,fixed:"right",render:d=>{let r;return a("div",{class:"flex-center gap-8px"},[ee(a(D,{type:"primary",ghost:!0,size:"small",onClick:()=>C(d.id)},ce(r=I("common.edit"))?r:{default:()=>[r]}),[[ne("no-auth"),"project:Equipment:update"]]),a(pe,{onPositiveClick:()=>H(d.id)},{default:()=>I("common.confirmDelete"),trigger:()=>{let v;return ee(a(D,{type:"error",ghost:!0,size:"small"},ce(v=I("common.delete"))?v:{default:()=>[v]}),[[ne("no-auth"),"project:Equipment:delete"]])}})])}}]}),{drawerVisible:j,operateType:G,editingData:V,handleAdd:q,handleEdit:k,checkedRowKeys:x,onBatchDeleted:M,onDeleted:_}=Xe(t,c);Le(async()=>{});async function b(){console.log(x.value),O(x.value.join(","),d=>{M()})}async function H(d){const{data:r,error:v}=await ue(d);v||_()}function C(d){k(d)}async function O(d,r){const{data:v,error:B}=await ue(d);if(!B)r&&r(v);else return!1}const A=d=>{c()},P=()=>{c()};return(d,r)=>{const v=ie,B=Se,K=ze,L=Ne,te=Me,ae=ge,R=ne("no-auth");return u(),Q("div",rt,[a(st,{model:n(F),"onUpdate:model":r[0]||(r[0]=g=>Z(F)?F.value=g:null),onReset:P,onSearch:n(c),onClear:r[1]||(r[1]=g=>t.value=[])},null,8,["model","onSearch"]),a(ae,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[a(v,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>r[5]||(r[5]=[X("div",null,"待调试设备",-1)])),_:1,__:[5]})]),"header-extra":l(()=>[a(v,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[ee((u(),f(n(D),{onClick:n(q),size:"small",ghost:"",type:"primary"},{icon:l(()=>[a(B,{class:"text-icon"})]),default:l(()=>[r[6]||(r[6]=m(" "+S("新增")))]),_:1,__:[6]},8,["onClick"])),[[R,"project:Equipment:insert"]]),a(n(pe),{onPositiveClick:b},{trigger:l(()=>[ee((u(),f(n(D),{size:"small",ghost:"",type:"error",disabled:n(x).length==0},{icon:l(()=>[a(K,{class:Oe(["text-icon",{"animate-spin":n(w)}])},null,8,["class"])]),default:l(()=>[r[7]||(r[7]=m(" "+S("批量删除")))]),_:1,__:[7]},8,["disabled"])),[[R,"project:Equipment:delete"]])]),default:l(()=>[r[8]||(r[8]=m(" 确定要删除选中的设备吗？ "))]),_:1,__:[8]}),a(L,{columns:n(y),"onUpdate:columns":r[2]||(r[2]=g=>Z(y)?y.value=g:null)},null,8,["columns"])]),_:1})]),default:l(()=>[a(te,{"checked-row-keys":n(x),"onUpdate:checkedRowKeys":r[3]||(r[3]=g=>Z(x)?x.value=g:null),columns:n(T),data:n(t),size:"small","flex-height":!n(E).isMobile,loading:n(w),remote:"","row-key":g=>g.id,pagination:n(h),class:"sm:h-full","onUpdate:filters":A},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(ot,{visible:n(j),"onUpdate:visible":r[4]||(r[4]=g=>Z(j)?j.value=g:null),onSubmitted:n(c),"operate-type":n(G),"row-data":n(V)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{Dt as default};
