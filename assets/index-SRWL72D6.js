import{_ as Z}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DCcFtEoA.js";import{d as j,q as V,s as G,v as W,b as ee,r as te,y as ae,K as B,o as A,c as E,w as a,g as e,h as R,t as O,i as o,$ as p,M as H,L as I,az as oe,A as Q,C as ne,aq as se,E as J,ap as le,D as X,B as F,ae as ie,af as re,ad as Y,a4 as ce,at as L,ay as ue,e as pe,ag as U,ah as de,ai as me}from"./index-ByfxsQvj.js";import{u as _e,a as fe}from"./table-Ca-5bYro.js";import{N as he,O as ve,P as ge,Q as ye}from"./basic-config-D49RGM7T.js";import{_ as be}from"./round-search-U_wZ0GRt.js";import{_ as we}from"./round-refresh-BRVSTvae.js";import{_ as ke}from"./lodash-21GmhknM.js";import{_ as De}from"./FormItemGridItem-Dtr_7n7z.js";import{_ as Ne}from"./Grid-B9K_tFX2.js";import{h as q}from"./permission-DpUBsxJs.js";import{_ as Ce}from"./Popconfirm-Bx1fZnQD.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-frQqLk93.js";import"./setting-outlined-C6sNL0co.js";import"./export-CaaNVRvS.js";import"./refresh-DDT70CE0.js";import"./round-delete-BsuQe4MI.js";import"./round-plus--T3dOesv.js";import"./Upload-BPNrVbAn.js";import"./Progress-B01mUdYA.js";const xe=j({name:"OperateDrawer",__name:"operate-drawer",props:V({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(_,{emit:$}){const u=_,g=$,d=G(_,"visible"),{formRef:s,validate:C,restoreValidation:P}=W(),D=ee(()=>({add:"新增白名单",edit:"编辑白名单"})[u.operateType]),i=te(f());function f(){return{ip:"",status:0,sysparam:0,dscb:""}}const M={ip:{required:!0,validator:oe,trigger:["input","change","blur","password-input"]}};function y(){Object.assign(i,f()),u.operateType==="edit"&&u.rowData&&Object.assign(i,u.rowData)}function b(){d.value=!1}async function w(){var r,l;if(await C(),u.operateType==="add"){const{data:k,error:m}=await he([i]);m||((r=window.$message)==null||r.success(p("common.addSuccess")),b(),g("submitted"))}else{const{data:k,error:m}=await ve([i]);m||((l=window.$message)==null||l.success(p("common.updateSuccess")),b(),g("submitted"))}}return ae(d,()=>{d.value&&(y(),P())}),(r,l)=>{const k=Q,m=ne,x=se,z=J,T=le,N=X,t=F,n=ie,c=re,S=B("no-space");return A(),E(c,{show:d.value,"onUpdate:show":l[3]||(l[3]=h=>d.value=h),"display-directive":"show",width:360},{default:a(()=>[e(n,{title:D.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(z,{size:16},{default:a(()=>[e(t,{onClick:b},{default:a(()=>[R(O(o(p)("common.cancel")),1)]),_:1}),e(t,{type:"primary",onClick:w},{default:a(()=>[R(O(o(p)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(N,{ref_key:"formRef",ref:s,model:i,rules:M,onKeyup:H(w,["enter"])},{default:a(()=>[e(m,{label:"IP",path:"ip"},{default:a(()=>[I(e(k,{clearable:"",value:i.ip,"onUpdate:value":l[0]||(l[0]=h=>i.ip=h),placeholder:"请输入IP"},null,8,["value"]),[[S]])]),_:1}),e(m,{label:"状态"},{default:a(()=>[e(T,{value:i.status,"onUpdate:value":l[1]||(l[1]=h=>i.status=h),name:"radiogroup"},{default:a(()=>[e(z,null,{default:a(()=>[e(x,{value:0},{default:a(()=>[R("启用")]),_:1}),e(x,{value:1},{default:a(()=>[R("禁用")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),e(m,{label:"描述",path:"dscb"},{default:a(()=>[I(e(k,{clearable:"",value:i.dscb,"onUpdate:value":l[2]||(l[2]=h=>i.dscb=h),placeholder:"请输入描述"},null,8,["value"]),[[S]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ze=j({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:V(["reset","search"],["update:model"]),setup(_,{emit:$}){const u=$,{formRef:g,restoreValidation:d}=W(),s=G(_,"model");function C(){s.value.fuzzy=void 0,s.value.ip=s.value.ip==""?void 0:s.value.ip,u("search")}function P(){s.value.ip=void 0,u("search")}async function D(){await d(),u("reset")}async function i(){u("search")}const f=ke.throttle(i,1e3,{trailing:!1});return(M,y)=>{const b=Q,w=De,r=we,l=F,k=be,m=J,x=Ne,z=X,T=Y,N=B("no-space");return A(),E(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(z,{ref_key:"formRef",ref:g,model:s.value,"label-placement":"left","label-width":80,"show-feedback":!1,onKeyup:H(o(f),["enter"])},{default:a(()=>[e(x,{responsive:"screen","item-responsive":"","y-gap":12},{default:a(()=>[e(w,{span:"24 s:12 m:8 l:6",label:"名称",path:"fuzzy"},{default:a(()=>[I(e(b,{clearable:"",value:s.value.fuzzy,"onUpdate:value":y[0]||(y[0]=t=>s.value.fuzzy=t),placeholder:"请输入关键字",onClear:C},null,8,["value"]),[[N]])]),_:1}),e(w,{span:"24 s:12 m:8 l:6",label:"IP",path:"ip"},{default:a(()=>[I(e(b,{clearable:"",value:s.value.ip,"onUpdate:value":y[1]||(y[1]=t=>s.value.ip=t),placeholder:"请输入IP",onClear:P},null,8,["value"]),[[N]])]),_:1}),e(w,{span:"24  s:12 m:8 l:6"},{default:a(()=>[e(m,{class:"w-full ml-20px"},{default:a(()=>[e(l,{onClick:D},{icon:a(()=>[e(r,{class:"text-icon"})]),default:a(()=>[R(" "+O(o(p)("common.reset")),1)]),_:1}),e(l,{type:"primary",ghost:"",onClick:o(f)},{icon:a(()=>[e(k,{class:"text-icon"})]),default:a(()=>[R(" "+O(o(p)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Se={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function K(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!de(_)}const He=j({name:"basicconfig_whitelist",__name:"index",setup(_){const $=ce(),{columns:u,columnChecks:g,data:d,getData:s,loading:C,mobilePagination:P,searchParams:D,resetSearchParams:i}=_e({apiFn:ge,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,ip:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,disabled:t=>t.sysparam==0},{key:"ip",title:"IP地址",align:"center",width:240},{key:"dscb",title:"描述",align:"center",width:240},{key:"status",title:"状态",align:"center",render:t=>(t.status===null&&(t.status=0),e(L,{type:{0:"success",1:"error"}[t.status]},{default:()=>[t.status==0?"启用":"禁用"]}))},{key:"sysparam",title:"系统内置",align:"center",width:240,render:t=>{t.sysparam==null&&(t.sysparam=0);const n={0:"success",1:"info"},c=p(ue[t.sysparam]);return e(L,{size:"small",type:n[t.sysparam]},K(c)?c:{default:()=>[c]})}},{key:"operate",title:p("common.operate"),align:"center",width:130,render:t=>{let n;return e("div",{class:"flex-center gap-8px"},[I(e(F,{type:"primary",ghost:!0,size:"small",onClick:()=>T(t.id),disabled:t.sysparam==0},K(n=p("common.edit"))?n:{default:()=>[n]}),[[B("no-auth"),"sys.white.list.update"]]),e(Ce,{onPositiveClick:()=>z(t.id)},{default:()=>p("common.confirmDelete"),trigger:()=>{let c;return I(e(F,{type:"error",ghost:!0,size:"small",disabled:t.sysparam==0},K(c=p("common.delete"))?c:{default:()=>[c]}),[[B("no-auth"),"sys.white.list.delete"]])}})])}}]}),{drawerVisible:f,operateType:M,editingData:y,handleAdd:b,handleEdit:w,checkedRowKeys:r,onBatchDeleted:l,onDeleted:k,closeDrawer:m}=fe(d,s);async function x(){console.log(r.value),N(r.value.join(","),t=>{l()})}function z(t){console.log(t),N(t,n=>{k()})}function T(t){w(t)}async function N(t,n){const{data:c,error:S}=await ye(t);if(!S)n&&n(c);else return!1}return(t,n)=>{const c=Z,S=me,h=Y;return A(),pe("div",Se,[e(ze,{model:o(D),"onUpdate:model":n[0]||(n[0]=v=>U(D)?D.value=v:null),onReset:o(i),onSearch:o(s)},null,8,["model","onReset","onSearch"]),e(h,{title:"白名单",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":a(()=>[e(c,{columns:o(g),"onUpdate:columns":n[1]||(n[1]=v=>U(g)?g.value=v:null),"disabled-delete":o(r).length===0,"is-view-add-button":o(q)("sys.white.list.insert"),"is-view-delete-button":o(q)("sys.white.list.delete"),loading:o(C),onAdd:o(b),onDelete:x,onRefresh:o(s)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:a(()=>[e(S,{"checked-row-keys":o(r),"onUpdate:checkedRowKeys":n[2]||(n[2]=v=>U(r)?r.value=v:null),columns:o(u),data:o(d),size:"small","flex-height":!o($).isMobile,"scroll-x":962,loading:o(C),remote:"","row-key":v=>v.id,pagination:o(P),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(xe,{visible:o(f),"onUpdate:visible":n[3]||(n[3]=v=>U(f)?f.value=v:null),"operate-type":o(M),"row-data":o(y),onSubmitted:o(s)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{He as default};
