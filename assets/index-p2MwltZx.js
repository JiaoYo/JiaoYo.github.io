import{d as X,n as Z,p as ae,s as ne,r as O,o as W,c as ee,w as l,g as a,i as f,h as n,t as p,$ as P,F as oe,aG as se,Z as ie,J as ue,B,N as le,O as re,ad as te,a3 as de,j as T,av as V,A as ce,e as pe,G as me,ai as fe,aj as ge,S as _e,ar as ve,P as he,Q as be,f as ye,R as xe}from"./index-DCJMGCjU.js";import{_ as Ce,l as Le}from"./lodash-mhSI0N8l.js";import{_ as ke}from"./round-search-CQG7dXzF.js";import{_ as Se}from"./round-refresh-BxO_w5DR.js";import{f as Te,a as Ne}from"./common-LxmdhUH8.js";import{a as De,S as J,t as $}from"./alarm-6DqfzN2u.js";import{_ as Ee}from"./FormItemGridItem-DFSPZS-5.js";import{_ as we}from"./DatePicker-vb97YeKK.js";import{_ as Re}from"./Grid-D9UUsNcy.js";import{y as je,z as Oe}from"./events-DhSaSLGQ.js";import{n as Ae}from"./Collection-CSJjnNaf.js";import{e as Me}from"./exportExcel-D6OyA9oJ.js";import{_ as Ie,a as Ge}from"./DescriptionsItem-BWHRADpQ.js";import"./TimePicker-BhqRnlN6.js";import"./defineProperty-DAPPGCWD.js";const Ue={0:"KERN",1:"USER",2:"MAIL",3:"DAEMON",4:"AUTH",5:"SYSYLOG",6:"LPR",7:"NEWS",8:"UUCP",9:"CRON",10:"AUTHPRIV",11:"FTP",12:"RESERVED_12",13:"RESERVED_13",14:"RESERVED_14",15:"RESERVED_15",16:"LOCAL0",17:"LOCAL1",18:"LOCAL2",19:"LOCAL3",20:"LOCAL4",21:"LOCAL5",22:"LOCAL6",23:"LOCAL7"},ze={0:"EMERGENCY",1:"ALERT",2:"CRITICAL",3:"ERROR",4:"WARNING",5:"NOTICE",6:"INFO",7:"DEBUG"},K={logModel:Ue,logLevel:ze},Ve=X({name:"FormSearch",__name:"form-search",props:Z(["collectorList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:Z(["search"],["update:model"]),setup(h,{emit:x}){const A=g=>Object.entries(g).map(([d,L])=>({label:L,value:d}));A(K.logLevel),A(K.logModel);const R=h,E=x,{formRef:Y,restoreValidation:w}=ae(),i=ne(h,"model");async function e(g,d){g&&g.length>0?(i.value.startTime=g[0],i.value.endTime=g[1]):(i.value.startTime=void 0,i.value.endTime=void 0),b()}async function c(){await w(),i.value.lsid=null,i.value.leid=null,i.value.lmid=null,i.value.eid=null,i.value.suject="",i.value.object="",i.value.lcon="",i.value.timeRange=null,se(()=>{E("search")})}const C=O({eventsTypeDataList:[],eventsCategoryDataList:[]});async function N(){const{data:g,error:d}=await Te();d||(C.eventsCategoryDataList=g)}async function r(){const{data:g,error:d}=await Ne();d||(C.eventsTypeDataList=g)}N(),r(),N();async function b(){E("search")}const D=Ce.debounce(b,1e3,{leading:!0,trailing:!1});return(g,d)=>{const L=ie,_=Ee,j=ue,M=we,H=Se,I=B,k=ke,F=le,t=Re,u=re,m=te;return W(),ee(m,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[a(u,{ref_key:"formRef",ref:Y,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:oe(f(D),["enter"])},{default:l(()=>[a(t,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:l(()=>[a(_,{span:"24 s:24 m:8 l:6",label:"采集器",path:"lsid"},{default:l(()=>[a(L,{filterable:"",clearable:"",placeholder:"请选择采集器",value:i.value.lsid,"onUpdate:value":[d[0]||(d[0]=o=>i.value.lsid=o),b],options:R.collectorList,"value-field":"id","label-field":"type",disabled:R.logsoudev,"reset-menu-on-options-change":!1},null,8,["value","options","disabled"])]),_:1}),a(_,{span:"24 s:24 m:8 l:6",label:"安全级别",path:"leid"},{default:l(()=>[a(L,{filterable:"",clearable:"",placeholder:"请选择级别",value:i.value.leid,"onUpdate:value":[d[1]||(d[1]=o=>i.value.leid=o),b],options:f(De),"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(_,{span:"24 s:12 m:8 l:6",label:"事件类别",path:"lmid"},{default:l(()=>[a(L,{filterable:"",clearable:"",placeholder:"请选择事件类别",value:i.value.lmid,"onUpdate:value":[d[2]||(d[2]=o=>i.value.lmid=o),b],"value-field":"id","label-field":"pname",options:C.eventsCategoryDataList},null,8,["value","options"])]),_:1}),a(_,{span:"24 s:12 m:8 l:6",label:"事件类型",path:"eid"},{default:l(()=>[a(L,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:i.value.eid,"onUpdate:value":[d[3]||(d[3]=o=>i.value.eid=o),b],"value-field":"id","label-field":"pname",options:C.eventsTypeDataList},null,8,["value","options"])]),_:1}),a(_,{span:"24 s:24 m:8 l:6",label:"事件主体",path:"suject"},{default:l(()=>[a(j,{placeholder:"请输入事件主体",value:i.value.suject,"onUpdate:value":d[4]||(d[4]=o=>i.value.suject=o),clearable:"",onClear:b},null,8,["value"])]),_:1}),a(_,{span:"24 s:24 m:8 l:6",label:"事件客体",path:"object"},{default:l(()=>[a(j,{placeholder:"请输入事件客体",value:i.value.object,"onUpdate:value":d[5]||(d[5]=o=>i.value.object=o),clearable:"",onClear:b},null,8,["value"])]),_:1}),a(_,{span:"24 s:24 m:8 l:6",label:"事件内容",path:"lcon"},{default:l(()=>[a(j,{placeholder:"请输入事件内容",value:i.value.lcon,"onUpdate:value":d[6]||(d[6]=o=>i.value.lcon=o),clearable:"",onClear:b},null,8,["value"])]),_:1}),a(_,{span:"24 s:24 m:12 l:8",label:"时间",path:"time"},{default:l(()=>[a(M,{value:i.value.timeRange,"onUpdate:value":d[7]||(d[7]=o=>i.value.timeRange=o),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":e},null,8,["value"])]),_:1}),a(_,{span:"24 s:24 m:8 l:8",label:""},{default:l(()=>[a(F,{class:"w-full"},{default:l(()=>[a(I,{onClick:c},{icon:l(()=>[a(H,{class:"text-icon"})]),default:l(()=>[n(" "+p(f(P)("common.reset")),1)]),_:1}),a(I,{type:"primary",ghost:"",onClick:f(D)},{icon:l(()=>[a(k,{class:"text-icon"})]),default:l(()=>[n(" "+p(f(P)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),$e=h=>(he("data-v-24951c27"),h=h(),be(),h),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Pe=$e(()=>ye("hr",{style:{"border-color":"#ccc","margin-bottom":"20px"}},null,-1));function He(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!fe(h)}const Fe=X({name:"eventalarm_generallog",__name:"index",props:{logsoudev:{},aip:{}},setup(h){const x=h,A=de(),R=T(window.innerHeight-395),E=T([]);(async()=>{const{data:t,error:u}=await Ae({page:1,limit:1e3,_t:new Date().getTime()});if(u)console.error("获取采集器列表失败:",u);else{const m=t;E.value=m.list.map(o=>({...o,id:o.id,type:o.cname}))}})();const w=T(!1),i=K,e=O({lsid:void 0,lsdn:"",rdbtime:"",lmid:void 0,leid:void 0,ltext:"",aname:"",procid:"",msgid:"",dbtime:"",hname:"",lcon:"",ip:"",lsip:"",priority:"",type:"",version:"",logtype:void 0,index:0,gsubject:"",gdescribe:"",gresult:"",level:0,eids:"",epids:"",gobject:""}),c=O({pageId:void 0,pageSize:100,lsid:void 0,leid:void 0,lmid:void 0,startTime:void 0,endTime:void 0,startIp:void 0,endIp:void 0,_t:new Date().getTime()}),C=O([{title:"序号",key:"index",width:80,align:"center",render:t=>`${t.index}`},{key:"type",title:"采集器名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gsubject",title:"事件主体",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"gobject",title:"事件客体",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"gdescribe",title:"事件描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gresult",title:"事件结果",align:"center",width:140,ellipsis:{tooltip:!0},render:t=>{var u,m,o;return t.gresult?a(V,{size:"small",type:(u=t.gresult)!=null&&u.includes("成功")||(m=t.gresult)!=null&&m.includes("success")?"success":(o=t.gresult)!=null&&o.includes("失败")?"error":"warning"},{default:()=>{var y;return[(y=t.gresult)!=null&&y.includes("success")?"成功":t.gresult]}}):""}},{key:"level",title:"安全级别",align:"center",width:140,render:t=>{const u=J[t.level];let m={color:$[t.level],textColor:"#ffffff",borderColor:$[t.level]};return a(V,{size:"small",color:m},He(u)?u:{default:()=>[u]})}},{key:"epids",title:"事件类别",align:"center",width:120},{key:"eids",title:"事件类型",align:"center",width:120},{key:"hname",title:"主机名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"dbtime",title:"日志时间",align:"center",width:160},{key:"operate",title:P("common.operate"),align:"center",width:120,fixed:"right",render:t=>a("div",{class:"flex-center gap-8px"},[a(B,{type:"info",ghost:!0,size:"small",onClick:()=>d(t)},{default:()=>[n("详情")]})])}]),N=T(!1),r=T([]),b=T(0),D=async(t=!1)=>{if(!N.value)N.value=!0;else return;x.logsoudev&&x.aip&&(_.value=!1,c.lsid=x.logsoudev,c.startAndEndIp=[x.aip,x.aip],c.startIp=x.aip,c.endIp=x.aip);const{data:u,error:m}=await je(c);m||(b.value=u.length,t?r.value=[...r.value,...u]:r.value=u,r.value=r.value.sort((o,y)=>y.id-o.id).map((o,y)=>(o.index=y+1,o)),N.value=!1)},g=async()=>{const{data:t,error:u}=await Oe({_t:new Date().getTime()});k.total=Number(t),k.itemCount=Number(t)};function d(t){e.lsid=t.lsid,e.lsdn=t.lsdn,e.rdbtime=t.rdbtime,e.lmid=t.lmid,e.leid=t.leid,e.ltext=t.ltext,e.aname=t.aname,e.procid=t.procid,e.msgid=t.msgid,e.dbtime=t.dbtime,e.hname=t.hname,e.lcon=t.lcon,e.ip=t.ip,e.lsip=t.lsip,e.priority=t.priority,e.type=t.type,e.version=t.version,e.logtype=t.logtype,e.gsubject=t.gsubject,e.gdescribe=t.gdescribe,e.gresult=t.gresult,e.level=t.level,e.eids=t.eids,e.epids=t.epids,e.gobject=t.gobject,w.value=!0}const L=T(),_=T(!0),j=async()=>{r.value=[],c.lsid||c.leid||c.lmid||c.startIp||c.endIp||c.startTime||c.endTime?_.value=!1:(_.value=!0,g()),c.pageId=void 0,await D(),M()},M=async()=>{var t,u,m;if(r.value.length<R.value/44&&r.value.length<k.total){if(c.pageId==((t=r.value[r.value.length-1])==null?void 0:t.id))return;c.pageId=((m=(u=r.value)==null?void 0:u[r.value.length-1])==null?void 0:m.id)??void 0,D(!0)}};ce(async()=>{await D(),await g(),M()});function H(t){Math.abs(t.target.scrollTop+t.target.offsetHeight-t.target.scrollHeight)<=20&&k.total>r.value.length&&I()}const I=Le.debounce(()=>{var t,u;if(r.value.length<k.total){if(c.pageId==r.value[r.value.length-1].id)return;c.pageId=((u=(t=r.value)==null?void 0:t[r.value.length-1])==null?void 0:u.id)??void 0,D(!0)}},300),k=O({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:t,endIndex:u,page:m,pageSize:o,pageCount:y,itemCount:s}){return`已加载${r.value.length}条`+(r.value.length?_.value?` 共计 ${r.value.length>0?s??0:0} 条`:b.value==c.pageSize?"  预计还有更多":"  没有更多了":"")}});async function F(){if(!r.value.length)return;const t=JSON.parse(JSON.stringify(r.value)),u=[];t.forEach(o=>{const y={};C.forEach(s=>{var G,U,z;if(o.hasOwnProperty(s.key)){const v=s.key==="lmid"?((G=i.logModel)==null?void 0:G[o[s.key]])??null:s.key==="leid"?((U=i.logLevel)==null?void 0:U[o[s.key]])??null:s.key==="lsid"?(z=E.value.map(S=>S.data).flat(2).find(S=>S.id==o[s.key]))==null?void 0:z.type:s.key==="level"?J[o[s.key]]??null:s.key=="ltext"?o.ltext+o.lcon:o[s.key];y[s.title]=v}}),u.push(y)}),Me(u,500,[{wpx:50},{wpx:120},{wpx:120},{wpx:120},{wpx:120},{wpx:120},{wpx:100},{wpx:100},{wpx:100},{wpx:120},{wpx:120}],"通用日志_"+new Date().getTime())}return(t,u)=>{const m=le,o=ge,y=te,s=Ie,G=Ge,U=_e,z=ve;return W(),pe("div",Be,[a(Ve,{model:c,"onUpdate:model":u[0]||(u[0]=v=>c=v),onSearch:j,collectorList:E.value,logsoudev:x.logsoudev},null,8,["model","collectorList","logsoudev"]),a(y,{title:"通用日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[a(m,null,{default:l(()=>[a(f(B),{type:"primary",size:"small",ghost:"",onClick:F,title:"导出已加载"},{default:l(()=>[n("导出已加载")]),_:1})]),_:1})]),default:l(()=>[a(o,{ref_key:"tableContainerRef",ref:L,columns:C,data:r.value,size:"small","flex-height":!f(A).isMobile,"scroll-x":C.reduce((v,S)=>v+S.width,0),loading:N.value,remote:"","row-key":v=>v.index,showTotal:"","max-height":R.value,"virtual-scroll":"",pagination:k,class:"sm:h-full",onScroll:H},null,8,["columns","data","flex-height","scroll-x","loading","row-key","max-height","pagination"])]),_:1}),a(z,{show:w.value,"onUpdate:show":u[2]||(u[2]=v=>w.value=v),title:"日志详情",preset:"card",class:"w-800px"},{footer:l(()=>[a(m,{justify:"end",size:16},{default:l(()=>[a(f(B),{type:"primary",onClick:u[1]||(u[1]=v=>{w.value=!1})},{default:l(()=>[n(p(f(P)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[Pe,a(U,{class:"h-480px pr-20px"},{default:l(()=>[a(G,{"label-placement":"left","label-style":{width:"120px"},bordered:"",column:1},{default:l(()=>[a(s,null,{label:l(()=>[n(" 采集器名称 ")]),default:l(()=>[n(" "+p(e.type),1)]),_:1}),a(s,null,{label:l(()=>[n(" 事件主体 ")]),default:l(()=>[n(" "+p(e.gsubject),1)]),_:1}),a(s,null,{label:l(()=>[n(" 事件客体 ")]),default:l(()=>[n(" "+p(e.gobject),1)]),_:1}),a(s,null,{label:l(()=>[n(" 事件描述 ")]),default:l(()=>[n(" "+p(e.gdescribe),1)]),_:1}),a(s,null,{label:l(()=>[n(" 事件结果 ")]),default:l(()=>{var v,S,q;return[e!=null&&e.gresult?(W(),ee(f(V),{key:0,size:"small",type:(v=e==null?void 0:e.gresult)!=null&&v.includes("成功")||(S=e==null?void 0:e.gresult)!=null&&S.includes("success")?"success":(q=e==null?void 0:e.gresult)!=null&&q.includes("失败")?"error":"warning"},{default:l(()=>{var Q;return[n(p((Q=e==null?void 0:e.gresult)!=null&&Q.includes("success")?"成功":e==null?void 0:e.gresult),1)]}),_:1},8,["type"])):me("",!0)]}),_:1}),a(s,null,{label:l(()=>[n(" 安全级别 ")]),default:l(()=>[a(f(V),{size:"small",color:{color:f($)[e.level],textColor:"#ffffff",borderColor:f($)[e.level]}},{default:l(()=>[n(p(f(J)[e.level]),1)]),_:1},8,["color"])]),_:1}),a(s,null,{label:l(()=>[n(" 事件类别 ")]),default:l(()=>[n(" "+p(e.epids),1)]),_:1}),a(s,null,{label:l(()=>[n(" 事件类型 ")]),default:l(()=>[n(" "+p(e.eids),1)]),_:1}),a(s,null,{label:l(()=>[n(" 日志时间 ")]),default:l(()=>[n(" "+p(e.dbtime),1)]),_:1}),a(s,null,{label:l(()=>[n(" 接收时间 ")]),default:l(()=>[n(" "+p(e.rdbtime),1)]),_:1}),a(s,null,{label:l(()=>[n(" 模块 ")]),default:l(()=>[n(" "+p(f(i).logModel[e.lmid]),1)]),_:1}),a(s,null,{label:l(()=>[n(" 级别 ")]),default:l(()=>[n(" "+p(f(i).logLevel[e.leid]),1)]),_:1}),a(s,null,{label:l(()=>[n(" 应用名称 ")]),default:l(()=>[n(" "+p(e.aname),1)]),_:1}),a(s,null,{label:l(()=>[n(" PROCID ")]),default:l(()=>[n(" "+p(e.procid),1)]),_:1}),a(s,null,{label:l(()=>[n(" MSGID ")]),default:l(()=>[n(" "+p(e.msgid||"--"),1)]),_:1}),a(s,null,{label:l(()=>[n(" 日志时间 ")]),default:l(()=>[n(" "+p(e.dbtime),1)]),_:1}),a(s,null,{label:l(()=>[n(" 主机名称 ")]),default:l(()=>[n(" "+p(e.hname),1)]),_:1}),a(s,null,{label:l(()=>[n(" 结构数据 ")]),default:l(()=>[n(" -- ")]),_:1}),a(s,null,{label:l(()=>[n(" 日志内容 ")]),default:l(()=>[n(" "+p(e.lcon),1)]),_:1}),a(s,{span:2},{label:l(()=>[n(" 日志原文 ")]),default:l(()=>[n(" "+p(e.logtype?e.ltext:e.ltext+(e.lcon?e.lcon:"")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),il=xe(Fe,[["__scopeId","data-v-24951c27"]]);export{il as default};
