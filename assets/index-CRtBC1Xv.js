import{_ as Oe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Bypa0qDO.js";import{d as te,q as ae,s as ue,v as ge,x as _e,b as $e,$ as s,r as we,j as R,y as ye,K as j,o as K,c as L,w as o,g as a,h as T,t as M,i as t,M as ve,L as z,N as re,U as le,V as he,aT as x,A as de,C as be,X as ke,D as me,B as P,E as se,aa as je,ab as ze,a9 as De,dp as pe,f as Me,F as Ue,aK as Be,am as ie,Z as qe,dq as Ve,e as Fe,ac as Y,ad as Ie,ds as Ae,S as Ke}from"./index-T9gyDO4y.js";import{h as Ee,i as Ge,j as He,e as Je,k as Le,f as Xe,l as ce,m as Ze}from"./system-manage-BX_Vy19l.js";import{u as Qe,a as We}from"./table-B9p4mU8X.js";import{U as Ye}from"./common-Ea_xvGPn.js";import{h as ea}from"./basic-config-BsSKviBw.js";import{_ as aa}from"./DatePicker-C6REZXa_.js";import{_ as ta}from"./TimePicker-_Exl3EXZ.js";import{_ as sa}from"./round-search-Bb27uErK.js";import{_ as oa}from"./round-refresh-Nk_s_Ewb.js";import{_ as na}from"./FormItemGridItem-C_-M-bXe.js";import{_ as ra}from"./Grid-LF9MSaZw.js";import{_ as la}from"./Tree-B8Q5OFvF.js";import{h as fe}from"./permission-C2VSnIQ2.js";import{_ as ia}from"./Popconfirm-CEXt8nva.js";import{_ as ua}from"./DataTable-C_gfPMHZ.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Cs26dX1f.js";import"./setting-outlined-J7sFgCWa.js";import"./round-delete-VkKQWGzF.js";import"./refresh-kuuiPl_Z.js";import"./round-plus-tcwoI66X.js";import"./Upload-1b_MjR4P.js";import"./Progress-OT364mF9.js";import"./Forward-CxaZO0Rb.js";import"./defineProperty-DW110bgN.js";const da=te({name:"UserOperateDrawer",__name:"user-operate-drawer",props:ae({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ae(["submitted"],["update:visible"]),setup(h,{emit:b}){const l=h,D=b,v=ue(h,"visible"),{formRef:f,validate:U,restoreValidation:B}=ge(),{createConfirmPwdRule:S,defaultRequiredRule:E,formRules:k}=_e(),g=$e(()=>({add:s("page.manage.user.addUser"),edit:s("page.manage.user.editUser")})[l.operateType]),e=we(_());function _(){return{username:"",usertype:void 0,oripwd:"",password:"",confirmPassword:"",superadmin:1,starttime:void 0,endtime:void 0,effstarttime:void 0,effendtime:void 0,udesc:"",status:0}}const d=R(null);async function w(m,u){e.starttime=x(1,u[0]),e.endtime=x(1,u[1])}const q={username:E,usertype:{type:"number",required:!0,trigger:["blur","change"],message:s("page.manage.user.form.usertype")},password:k.pwd,confirmPassword:[{required:!0,message:s("form.confirmPwd.required")},{asyncValidator:(m,u)=>u.trim()!==""&&u!==e.password?Promise.reject(m.message):Promise.resolve(),message:s("form.confirmPwd.invalid"),trigger:"input"}],time:{required:!0,message:"请选择起止日期",asyncValidator:(m,u)=>{var N;return console.log(d.value,"asdasdasd"),((N=d.value)==null?void 0:N.length)>1?Promise.resolve():Promise.reject(m.message)},trigger:["blur","change"]},effstarttime:{type:"number",required:!0,message:s("page.manage.user.form.effstarttime"),trigger:["blur","change"]},effendtime:{type:"number",required:!0,message:s("page.manage.user.form.effendtime"),trigger:["blur","change"]}};function V(){if(X(),d.value=null,Object.assign(e,_()),l.operateType==="edit"&&l.rowData){const m=JSON.parse(JSON.stringify(l.rowData));l.rowData.starttime=l.rowData.starttime?R(x(5,l.rowData.starttime)).value:void 0,l.rowData.endtime=l.rowData.endtime?R(x(5,l.rowData.endtime)).value:void 0,l.rowData.effstarttime=l.rowData.effstarttime&&m.starttime?R(x(5,m.starttime.substring(0,10)+" "+l.rowData.effstarttime)).value:void 0,l.rowData.effendtime=l.rowData.effendtime&&m.endtime?R(x(5,m.endtime.substring(0,10)+" "+l.rowData.effendtime)).value:void 0,d.value=l.rowData.starttime&&l.rowData.endtime?[new Date(l.rowData.starttime).getTime(),new Date(l.rowData.endtime).getTime()]:null,Object.assign(e,l.rowData)}}const O=R({}),X=async()=>{const{data:m,error:u}=await ea();u||(O.value=m)};function F(){v.value=!1}async function G(){var I,C,c,H,A;if(await U(),e.effstarttime&&!e.effendtime)return(I=window.$message)==null?void 0:I.error("有效结束时间不能为空");if(e.effendtime&&!e.effstarttime)return(C=window.$message)==null?void 0:C.error("有效开始时间不能为空");if(e.effstarttime&&e.effendtime&&e.effstarttime>e.effendtime)return(c=window.$message)==null?void 0:c.error("开始时间不能大于结束时间");let m=e.starttime?x(1,e.starttime):null,u=e.endtime?x(1,e.endtime):null,N=e.effstarttime?x(7,e.effstarttime):null,y=e.effendtime?x(7,e.effendtime):null;if(l.operateType==="add"){const{data:Z,error:$}=await Ee(e.username,e.usertype,e.password,m,u,N,y,e.status,e.superadmin,e.udesc);$||((H=window.$message)==null||H.success(s("common.addSuccess")),F(),D("submitted"))}else{const{data:Z,error:$}=await Ge(l.rowData.id,e.username,e.usertype,e.oripwd,e.password,m,u,N,y,e.status,e.superadmin,e.udesc);$||((A=window.$message)==null||A.success(s("common.updateSuccess")),F(),D("submitted"))}}return ye(v,()=>{v.value&&(V(),B())}),(m,u)=>{const N=de,y=be,I=ke,C=aa,c=ta,H=me,A=P,Z=se,$=je,W=ze,Q=j("no-space");return K(),L(W,{show:v.value,"onUpdate:show":u[9]||(u[9]=J=>v.value=J),"display-directive":"show",width:500},{default:o(()=>[a($,{title:g.value,"native-scrollbar":!1,closable:""},{footer:o(()=>[a(Z,{size:16},{default:o(()=>[a(A,{onClick:F},{default:o(()=>[T(M(t(s)("common.cancel")),1)]),_:1}),a(A,{type:"primary",onClick:G},{default:o(()=>[T(M(t(s)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(H,{ref_key:"formRef",ref:f,model:e,rules:q,onKeyup:ve(G,["enter"])},{default:o(()=>{var J,n,r;return[a(y,{label:t(s)("page.manage.user.username"),path:"username"},{default:o(()=>[z(a(N,{value:e.username,"onUpdate:value":u[0]||(u[0]=i=>e.username=i),disabled:l.operateType==="edit",placeholder:t(s)("page.manage.user.form.username")},null,8,["value","disabled","placeholder"]),[[Q]])]),_:1},8,["label"]),l.operateType==="add"?(K(),L(y,{key:0,label:t(s)("page.login.common.password"),path:"password"},{default:o(()=>[a(N,{value:e.password,"onUpdate:value":u[1]||(u[1]=i=>e.password=i),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:t(s)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])):re("",!0),l.operateType==="add"?(K(),L(y,{key:1,label:t(s)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:o(()=>[a(N,{value:e.confirmPassword,"onUpdate:value":u[2]||(u[2]=i=>e.confirmPassword=i),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:t(s)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])):re("",!0),l.operateType!=="edit"?(K(),L(y,{key:2,label:t(s)("page.manage.user.usertype"),path:"usertype"},{default:o(()=>[a(I,{filterable:"",value:e.usertype,"onUpdate:value":u[3]||(u[3]=i=>e.usertype=i),placeholder:t(s)("page.manage.user.form.usertype"),options:t(le)(t(he)),style:{width:"100%"}},null,8,["value","placeholder","options"])]),_:1},8,["label"])):re("",!0),a(y,{label:"起止日期",path:((J=O.value)==null?void 0:J.aceffective)==1?"time":""},{default:o(()=>[a(C,{value:d.value,"onUpdate:value":u[4]||(u[4]=i=>d.value=i),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":w,style:{width:"100%"}},null,8,["value"])]),_:1},8,["path"]),a(y,{label:t(s)("page.manage.user.effstarttime"),path:((n=O.value)==null?void 0:n.aceffective)==1?"effstarttime":""},{default:o(()=>[a(c,{value:e.effstarttime,"onUpdate:value":u[5]||(u[5]=i=>e.effstarttime=i),format:"HH:mm",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label","path"]),a(y,{label:t(s)("page.manage.user.effendtime"),path:((r=O.value)==null?void 0:r.aceffective)==1?"effendtime":""},{default:o(()=>[a(c,{value:e.effendtime,"onUpdate:value":u[6]||(u[6]=i=>e.effendtime=i),format:"HH:mm",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label","path"]),a(y,{label:t(s)("page.manage.user.udesc"),path:"udesc"},{default:o(()=>[a(N,{value:e.udesc,"onUpdate:value":u[7]||(u[7]=i=>e.udesc=i),placeholder:t(s)("page.manage.user.form.udesc")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(y,{label:t(s)("page.manage.user.status"),path:"status"},{default:o(()=>[a(I,{value:e.status,"onUpdate:value":u[8]||(u[8]=i=>e.status=i),placeholder:t(s)("page.manage.user.form.status"),options:t(le)(t(Ye)),style:{width:"100%"}},null,8,["value","placeholder","options"])]),_:1},8,["label"])]}),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ma=te({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:ae(["reset","search"],["update:model"]),setup(h,{emit:b}){const l=b,{formRef:D,restoreValidation:v}=ge(),f=ue(h,"model");function U(){f.value.fuzzy="",l("search")}async function B(){await v(),l("reset")}async function S(){l("search")}return(E,k)=>{const g=ke,e=na,_=de,d=oa,w=P,q=sa,V=se,O=ra,X=me,F=De,G=j("no-space");return K(),L(F,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[a(X,{ref_key:"formRef",ref:D,model:f.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ve(S,["enter"])},{default:o(()=>[a(O,{responsive:"screen","item-responsive":""},{default:o(()=>[a(e,{span:"24 s:12 m:6",label:t(s)("page.manage.user.usertype"),path:"usertype",class:"pr-24px"},{default:o(()=>[a(g,{filterable:"",clearable:"",value:f.value.usertype,"onUpdate:value":[k[0]||(k[0]=m=>f.value.usertype=m),S],placeholder:t(s)("page.manage.user.form.usertype"),options:t(le)(t(he))},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(e,{span:"24 s:12 m:6",label:t(s)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:o(()=>[z(a(_,{clearable:"",value:f.value.fuzzy,"onUpdate:value":k[1]||(k[1]=m=>f.value.fuzzy=m),placeholder:t(s)("page.manage.user.form.username"),onClear:U},null,8,["value","placeholder"]),[[G]])]),_:1},8,["label"]),a(e,{span:"24 m:12",class:"pr-24px"},{default:o(()=>[a(V,{class:"w-full"},{default:o(()=>[a(w,{onClick:B},{icon:o(()=>[a(d,{class:"text-icon"})]),default:o(()=>[T(" "+M(t(s)("common.reset")),1)]),_:1}),a(w,{type:"primary",ghost:"",onClick:S},{icon:o(()=>[a(q,{class:"text-icon"})]),default:o(()=>[T(" "+M(t(s)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),pa=Me("div",{class:"flex"},"设置用户角色",-1),ca=te({name:"assignRoles",__name:"assign-roles",props:ae({rowObj:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(h){const b=h,l=ue(h,"visible");function D(){l.value=!1}const v=pe([]),f=async()=>{const{error:g,data:e}=await Je();if(!g){const _=JSON.parse(JSON.stringify(e));v.value=_.list.map(d=>(d.rtype!=b.rowObj.usertype&&(d.disabled=!0),d.suffix=()=>Be(ie,{text:!0,type:d.rtype==0?"success":d.rtype==1?"warning":"info",size:"small"},{default:()=>d.rtype==0?"管理员":d.rtype==1?"操作员":"审计员"}),d))}},U=pe([]);async function B(){if(b.rowObj.id){const{data:g,error:e}=await Le(b.rowObj.id);e||(U.value=[g.roleId])}}const S=async(g,e,_)=>{var d;U.value=[(d=_.node)==null?void 0:d.id]};async function E(){var g,e,_;if(b.rowObj.id){const{data:d,error:w}=await He(b.rowObj.id,U.value.join(","));w||((g=window.$message)==null||g.destroyAll(),(_=(e=window.$message)==null?void 0:e.success)==null||_.call(e,s("common.modifySuccess")),D())}}function k(){b.rowObj.id&&(f(),B())}return ye(l,g=>{g&&k()}),(g,e)=>{const _=la,d=P,w=se,q=Ue;return K(),L(q,{show:l.value,"onUpdate:show":e[0]||(e[0]=V=>l.value=V),preset:"card",class:"w-480px"},{header:o(()=>[pa]),footer:o(()=>[a(w,{justify:"end"},{default:o(()=>[a(d,{size:"small",class:"mt-16px",onClick:D},{default:o(()=>[T(M(t(s)("common.cancel")),1)]),_:1}),a(d,{type:"primary",size:"small",class:"mt-16px",onClick:E},{default:o(()=>[T(M(t(s)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(_,{cascade:"","checked-keys":U.value,data:v.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"","label-field":"name","key-field":"id","children-field":"children","onUpdate:checkedKeys":S},null,8,["checked-keys","data"])]),_:1},8,["show"])}}}),fa={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ee(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Ie(h)}const Fa=te({name:"manage_user",__name:"index",setup(h){const b=qe(),{columns:l,columnChecks:D,data:v,getData:f,loading:U,mobilePagination:B,searchParams:S,resetSearchParams:E}=Qe({apiFn:Xe,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,usertype:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"username",title:s("page.manage.user.username"),align:"center",width:200},{key:"usertype",title:s("page.manage.user.usertype"),align:"center",width:140,render:n=>{n.usertype===void 0&&(n.usertype=0);const r={0:"primary",1:"primary",2:"primary"},i=s(Ve[n.usertype]);return a(ie,{type:r[n.usertype]},ee(i)?i:{default:()=>[i]})}},{key:"udesc",title:"用户描述",align:"center",width:180,ellipsis:!0},{key:"createdate",title:s("page.manage.user.createDate"),align:"center",width:180},{key:"status",title:s("page.manage.user.status"),align:"center",width:100,render:n=>{n.status===null&&(n.status=0);const r={0:"success",1:"error",2:"warning"},i=n.status==0?"正常":n.status==1?"异常":"锁定";return a(ie,{type:r[n.status]},ee(i)?i:{default:()=>[i]})}},{key:"operate",title:s("common.operate"),align:"center",width:400,fixed:"right",render:n=>{let r;return n.superadmin!=0?a("div",{class:"flex-center gap-8px"},[z(a(P,{type:"primary",ghost:!0,size:"small",onClick:()=>u(n.id)},ee(r=s("common.edit"))?r:{default:()=>[r]}),[[j("no-auth"),"sys:user:update"]]),z(a(P,{type:"primary",ghost:!0,size:"small",onClick:()=>J(n)},{default:()=>["分配角色"]}),[[j("no-auth"),"sys:user:updateRoleUser"]]),n.status==0&&z(a(P,{type:"primary",ghost:!0,size:"small",onClick:()=>G(n.id)},{default:()=>["锁定"]}),[[j("no-auth"),"sys:user:update"]]),n.status==2&&z(a(P,{type:"primary",ghost:!0,size:"small",onClick:()=>F(n.id)},{default:()=>["解锁"]}),[[j("no-auth"),"sys:user:update"]]),z(a(P,{type:"primary",ghost:!0,size:"small",onClick:()=>A(n)},{default:()=>["修改密码"]}),[[j("no-auth"),"sys:user:update"]]),a(ia,{onPositiveClick:()=>m(n.id)},{default:()=>s("common.confirmDelete"),trigger:()=>{let i;return z(a(P,{type:"error",ghost:!0,size:"small"},ee(i=s("common.delete"))?i:{default:()=>[i]}),[[j("no-auth"),"sys:user:delete"]])}})]):a("span",{class:"c-#a4b0be"},[T("系统用户不允许操作")])}}]}),{drawerVisible:k,operateType:g,editingData:e,handleAdd:_,handleEdit:d,checkedRowKeys:w,onBatchDeleted:q,onDeleted:V,closeDrawer:O}=We(v,f);async function X(){console.log(w.value),$(w.value,n=>{q()})}const F=async n=>{var r;await ce({id:n,status:0}),(r=window.$message)==null||r.success("解锁成功"),f()},G=async n=>{var r;await ce({id:n,status:2}),(r=window.$message)==null||r.success("锁定成功"),f()};function m(n){console.log(n),$([n],r=>{V()})}function u(n){d(n)}const{createConfirmPwdRule:N,defaultRequiredRule:y,patternRules:I}=_e(),C=R(!1),c=we({username:"",password:"",confirmPassword:"",id:null}),H={password:[y,I.password],confirmPassword:[{required:!0,message:s("form.confirmPwd.required")},{asyncValidator:(n,r)=>r.trim()!==""&&r!==c.password?Promise.reject(n.message):Promise.resolve(),message:s("form.confirmPwd.invalid"),trigger:"input"}]},A=n=>{C.value=!0,c.id=n.id,c.username=n.username},Z=async()=>{var i;if(!c.id)return;const{data:n,error:r}=await Ae(c.id,c.password);r||((i=window.$message)==null||i.success("修改成功"),C.value=!1)};async function $(n,r){const i=await Ze(n);console.log("data",i),r&&r(i)}const W=R(),Q=R(!1),J=n=>{W.value=n,Q.value=!0};return(n,r)=>{const i=Oe,Ne=ua,oe=de,ne=be,Pe=me,Se=Ke,xe=se,Ce=Ue,Re=De;return K(),Fe("div",fa,[a(ma,{model:t(S),"onUpdate:model":r[0]||(r[0]=p=>Y(S)?S.value=p:null),onReset:t(E),onSearch:t(f)},null,8,["model","onReset","onSearch"]),a(Re,{title:t(s)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[a(i,{columns:t(D),"onUpdate:columns":r[1]||(r[1]=p=>Y(D)?D.value=p:null),"disabled-delete":t(w).length===0,loading:t(U),onAdd:t(_),onDelete:X,onRefresh:t(f),"is-view-add-button":t(fe)("sys:user:insert"),"is-view-delete-button":t(fe)("sys:user:delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:o(()=>[a(Ne,{"checked-row-keys":t(w),"onUpdate:checkedRowKeys":r[2]||(r[2]=p=>Y(w)?w.value=p:null),columns:t(l),data:t(v),size:"small","flex-height":!t(b).isMobile,"scroll-x":t(l).reduce((p,Te)=>p+Te.width,0),loading:t(U),remote:"","row-key":p=>p.id,pagination:t(B),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),a(da,{visible:t(k),"onUpdate:visible":r[3]||(r[3]=p=>Y(k)?k.value=p:null),"operate-type":t(g),"row-data":t(e),onSubmitted:t(f)},null,8,["visible","operate-type","row-data","onSubmitted"]),a(ca,{rowObj:W.value,visible:Q.value,"onUpdate:visible":r[4]||(r[4]=p=>Q.value=p)},null,8,["rowObj","visible"]),a(Ce,{show:C.value,"onUpdate:show":r[8]||(r[8]=p=>C.value=p),title:t(s)("common.updatePassword"),preset:"card",class:"w-620px"},{footer:o(()=>[a(xe,{justify:"end",size:16},{default:o(()=>[a(t(P),{onClick:t(O)},{default:o(()=>[T(M(t(s)("common.cancel")),1)]),_:1},8,["onClick"]),a(t(P),{type:"primary",onClick:Z},{default:o(()=>[T(M(t(s)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(Se,{class:"max-h-480px pr-20px"},{default:o(()=>[a(Pe,{ref:"formRef",model:c,rules:H,"label-placement":"left","label-width":100,"require-mark-placement":"left"},{default:o(()=>[a(ne,{label:t(s)("page.manage.user.username"),path:"username"},{default:o(()=>[a(oe,{readonly:"",value:c.username,"onUpdate:value":r[5]||(r[5]=p=>c.username=p),placeholder:t(s)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(ne,{label:t(s)("page.login.common.password"),path:"password"},{default:o(()=>[a(oe,{type:"password","show-password-on":"click",clearable:"",value:c.password,"onUpdate:value":r[6]||(r[6]=p=>c.password=p),placeholder:t(s)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(ne,{label:t(s)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:o(()=>[a(oe,{type:"password","show-password-on":"click",clearable:"",value:c.confirmPassword,"onUpdate:value":r[7]||(r[7]=p=>c.confirmPassword=p),placeholder:t(s)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])]),_:1},8,["title"])])}}});export{Fa as default};
