import{_ as $e}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DiV7TjPT.js";import{d as se,q as te,s as me,v as we,x as ye,b as je,$ as s,r as ve,j as R,y as he,L as j,o as K,c as Q,w as n,g as a,h as T,t as M,i as t,N as be,M as z,O as le,V as ie,W as ke,aU as S,G as ue,A as pe,C as De,Y as Pe,D as ce,B as N,E as oe,ab as ze,ac as Me,aa as Ue,dx as fe,f as Be,F as Ne,aL as Ve,an as de,a0 as qe,dy as Fe,e as Ie,ad as ee,ae as Ae,dA as Ge,S as Ke}from"./index-g00S9pbc.js";import{h as Ee,i as He,j as Je,e as Le,k as We,f as Ye,l as ge,m as Qe}from"./system-manage-BRpEmC8T.js";import{u as Xe,a as Ze}from"./table-D4O-hiam.js";import{U as ea}from"./common-CDoUj_Xo.js";import{h as aa}from"./basic-config-D0aUNje5.js";import{_ as ta}from"./DatePicker-B0L1BwDW.js";import{_ as sa}from"./TimePicker-Cd25ys76.js";import{_ as oa}from"./round-search-O6eekLFL.js";import{_ as na}from"./round-refresh-DzVxh58h.js";import{_ as ra}from"./FormItemGridItem-dHIUWVHc.js";import{_ as la}from"./Grid-gpKm_X0x.js";import{_ as ia}from"./Tree-u9x_mN3t.js";import{h as _e}from"./permission-argpRA4v.js";import{_ as ua}from"./Popconfirm-CCkig7PK.js";import{_ as da}from"./DataTable-hpj7uXOd.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DpBKXO8Q.js";import"./setting-outlined-Ct836IgE.js";import"./round-delete-BcMOXr7T.js";import"./refresh-OZnEJ4w2.js";import"./round-plus-Dmu7BJh1.js";import"./Upload-Dlhgf6zC.js";import"./Progress-BcdTBaT9.js";import"./Forward-CnD1DDOA.js";import"./defineProperty-D-v2VQ28.js";const ma=se({name:"UserOperateDrawer",__name:"user-operate-drawer",props:te({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:te(["submitted"],["update:visible"]),setup(h,{emit:b}){const l=h,D=b,v=me(h,"visible"),{formRef:f,validate:P,restoreValidation:B}=we(),{createConfirmPwdRule:x,defaultRequiredRule:E,formRules:k}=ye(),g=je(()=>({add:s("page.manage.user.addUser"),edit:s("page.manage.user.editUser")})[l.operateType]),e=ve(_());function _(){return{username:"",usertype:void 0,oripwd:"",password:"",confirmPassword:"",superadmin:1,starttime:void 0,endtime:void 0,effstarttime:void 0,effendtime:void 0,udesc:"",status:0}}const d=R(null);async function w(m,u){e.starttime=S(1,u[0]),e.endtime=S(1,u[1])}const V={username:E,usertype:{type:"number",required:!0,trigger:["blur","change"],message:s("page.manage.user.form.usertype")},password:k.pwd,confirmPassword:[{required:!0,message:s("form.confirmPwd.required")},{asyncValidator:(m,u)=>u.trim()!==""&&u!==e.password?Promise.reject(m.message):Promise.resolve(),message:s("form.confirmPwd.invalid"),trigger:"input"}],time:{required:!0,message:"请选择起止日期",asyncValidator:(m,u)=>{var U;return console.log(d.value,"asdasdasd"),((U=d.value)==null?void 0:U.length)>1?Promise.resolve():Promise.reject(m.message)},trigger:["blur","change"]},effstarttime:{type:"number",required:!0,message:s("page.manage.user.form.effstarttime"),trigger:["blur","change"]},effendtime:{type:"number",required:!0,message:s("page.manage.user.form.effendtime"),trigger:["blur","change"]}};function q(){if(X(),d.value=null,Object.assign(e,_()),l.operateType==="edit"&&l.rowData){const m=JSON.parse(JSON.stringify(l.rowData));l.rowData.starttime=l.rowData.starttime?R(S(5,l.rowData.starttime)).value:void 0,l.rowData.endtime=l.rowData.endtime?R(S(5,l.rowData.endtime)).value:void 0,l.rowData.effstarttime=l.rowData.effstarttime&&m.starttime?R(S(5,m.starttime.substring(0,10)+" "+l.rowData.effstarttime)).value:void 0,l.rowData.effendtime=l.rowData.effendtime&&m.endtime?R(S(5,m.endtime.substring(0,10)+" "+l.rowData.effendtime)).value:void 0,d.value=l.rowData.starttime&&l.rowData.endtime?[new Date(l.rowData.starttime).getTime(),new Date(l.rowData.endtime).getTime()]:null,Object.assign(e,l.rowData)}}const O=R({}),X=async()=>{const{data:m,error:u}=await aa();u||(O.value=m)};function F(){v.value=!1}async function H(){var c,J,A,L,G;if(await P(),e.effstarttime&&!e.effendtime)return(c=window.$message)==null?void 0:c.error("有效结束时间不能为空");if(e.effendtime&&!e.effstarttime)return(J=window.$message)==null?void 0:J.error("有效开始时间不能为空");if(e.effstarttime&&e.effendtime&&e.effstarttime>e.effendtime)return(A=window.$message)==null?void 0:A.error("开始时间不能大于结束时间");let m=e.starttime?S(1,e.starttime):null,u=e.endtime?S(1,e.endtime):null,U=e.effstarttime?S(7,e.effstarttime):null,y=e.effendtime?S(7,e.effendtime):null,I=await ue(e.password),$=await ue(e.password);if(l.operateType==="add"){const{data:W,error:C}=await Ee(e.username,e.usertype,I,m,u,U,y,e.status,e.superadmin,e.udesc);C||((L=window.$message)==null||L.success(s("common.addSuccess")),F(),D("submitted"))}else{const{data:W,error:C}=await He(l.rowData.id,e.username,e.usertype,$,I,m,u,U,y,e.status,e.superadmin,e.udesc);C||((G=window.$message)==null||G.success(s("common.updateSuccess")),F(),D("submitted"))}}return he(v,()=>{v.value&&(q(),B())}),(m,u)=>{const U=pe,y=De,I=Pe,$=ta,c=sa,J=ce,A=N,L=oe,G=ze,W=Me,C=j("no-space");return K(),Q(W,{show:v.value,"onUpdate:show":u[9]||(u[9]=Y=>v.value=Y),"display-directive":"show",width:500},{default:n(()=>[a(G,{title:g.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[a(L,{size:16},{default:n(()=>[a(A,{onClick:F},{default:n(()=>[T(M(t(s)("common.cancel")),1)]),_:1}),a(A,{type:"primary",onClick:H},{default:n(()=>[T(M(t(s)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(J,{ref_key:"formRef",ref:f,model:e,rules:V,onKeyup:be(H,["enter"])},{default:n(()=>{var Y,o,r;return[a(y,{label:t(s)("page.manage.user.username"),path:"username"},{default:n(()=>[z(a(U,{value:e.username,"onUpdate:value":u[0]||(u[0]=i=>e.username=i),disabled:l.operateType==="edit",placeholder:t(s)("page.manage.user.form.username")},null,8,["value","disabled","placeholder"]),[[C]])]),_:1},8,["label"]),l.operateType==="add"?(K(),Q(y,{key:0,label:t(s)("page.login.common.password"),path:"password"},{default:n(()=>[a(U,{value:e.password,"onUpdate:value":u[1]||(u[1]=i=>e.password=i),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:t(s)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])):le("",!0),l.operateType==="add"?(K(),Q(y,{key:1,label:t(s)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:n(()=>[a(U,{value:e.confirmPassword,"onUpdate:value":u[2]||(u[2]=i=>e.confirmPassword=i),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:t(s)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])):le("",!0),l.operateType!=="edit"?(K(),Q(y,{key:2,label:t(s)("page.manage.user.usertype"),path:"usertype"},{default:n(()=>[a(I,{filterable:"",value:e.usertype,"onUpdate:value":u[3]||(u[3]=i=>e.usertype=i),placeholder:t(s)("page.manage.user.form.usertype"),options:t(ie)(t(ke)),style:{width:"100%"}},null,8,["value","placeholder","options"])]),_:1},8,["label"])):le("",!0),a(y,{label:"起止日期",path:((Y=O.value)==null?void 0:Y.aceffective)==1?"time":""},{default:n(()=>[a($,{value:d.value,"onUpdate:value":u[4]||(u[4]=i=>d.value=i),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":w,style:{width:"100%"}},null,8,["value"])]),_:1},8,["path"]),a(y,{label:t(s)("page.manage.user.effstarttime"),path:((o=O.value)==null?void 0:o.aceffective)==1?"effstarttime":""},{default:n(()=>[a(c,{value:e.effstarttime,"onUpdate:value":u[5]||(u[5]=i=>e.effstarttime=i),format:"HH:mm",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label","path"]),a(y,{label:t(s)("page.manage.user.effendtime"),path:((r=O.value)==null?void 0:r.aceffective)==1?"effendtime":""},{default:n(()=>[a(c,{value:e.effendtime,"onUpdate:value":u[6]||(u[6]=i=>e.effendtime=i),format:"HH:mm",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label","path"]),a(y,{label:t(s)("page.manage.user.udesc"),path:"udesc"},{default:n(()=>[a(U,{value:e.udesc,"onUpdate:value":u[7]||(u[7]=i=>e.udesc=i),placeholder:t(s)("page.manage.user.form.udesc")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(y,{label:t(s)("page.manage.user.status"),path:"status"},{default:n(()=>[a(I,{value:e.status,"onUpdate:value":u[8]||(u[8]=i=>e.status=i),placeholder:t(s)("page.manage.user.form.status"),options:t(ie)(t(ea)),style:{width:"100%"}},null,8,["value","placeholder","options"])]),_:1},8,["label"])]}),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),pa=se({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:te(["reset","search"],["update:model"]),setup(h,{emit:b}){const l=b,{formRef:D,restoreValidation:v}=we(),f=me(h,"model");function P(){f.value.fuzzy="",l("search")}async function B(){await v(),l("reset")}async function x(){l("search")}return(E,k)=>{const g=Pe,e=ra,_=pe,d=na,w=N,V=oa,q=oe,O=la,X=ce,F=Ue,H=j("no-space");return K(),Q(F,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(X,{ref_key:"formRef",ref:D,model:f.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:be(x,["enter"])},{default:n(()=>[a(O,{responsive:"screen","item-responsive":""},{default:n(()=>[a(e,{span:"24 s:12 m:6",label:t(s)("page.manage.user.usertype"),path:"usertype",class:"pr-24px"},{default:n(()=>[a(g,{filterable:"",clearable:"",value:f.value.usertype,"onUpdate:value":[k[0]||(k[0]=m=>f.value.usertype=m),x],placeholder:t(s)("page.manage.user.form.usertype"),options:t(ie)(t(ke))},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(e,{span:"24 s:12 m:6",label:t(s)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:n(()=>[z(a(_,{clearable:"",value:f.value.fuzzy,"onUpdate:value":k[1]||(k[1]=m=>f.value.fuzzy=m),placeholder:t(s)("page.manage.user.form.username"),onClear:P},null,8,["value","placeholder"]),[[H]])]),_:1},8,["label"]),a(e,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[a(q,{class:"w-full"},{default:n(()=>[a(w,{onClick:B},{icon:n(()=>[a(d,{class:"text-icon"})]),default:n(()=>[T(" "+M(t(s)("common.reset")),1)]),_:1}),a(w,{type:"primary",ghost:"",onClick:x},{icon:n(()=>[a(V,{class:"text-icon"})]),default:n(()=>[T(" "+M(t(s)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ca=Be("div",{class:"flex"},"设置用户角色",-1),fa=se({name:"assignRoles",__name:"assign-roles",props:te({rowObj:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(h){const b=h,l=me(h,"visible");function D(){l.value=!1}const v=fe([]),f=async()=>{const{error:g,data:e}=await Le();if(!g){const _=JSON.parse(JSON.stringify(e));v.value=_.list.map(d=>(d.rtype!=b.rowObj.usertype&&(d.disabled=!0),d.suffix=()=>Ve(de,{text:!0,type:d.rtype==0?"success":d.rtype==1?"warning":"info",size:"small"},{default:()=>d.rtype==0?"管理员":d.rtype==1?"操作员":"审计员"}),d))}},P=fe([]);async function B(){if(b.rowObj.id){const{data:g,error:e}=await We(b.rowObj.id);e||(P.value=[g.roleId])}}const x=async(g,e,_)=>{var d;P.value=[(d=_.node)==null?void 0:d.id]};async function E(){var g,e,_;if(b.rowObj.id){const{data:d,error:w}=await Je(b.rowObj.id,P.value.join(","));w||((g=window.$message)==null||g.destroyAll(),(_=(e=window.$message)==null?void 0:e.success)==null||_.call(e,s("common.modifySuccess")),D())}}function k(){b.rowObj.id&&(f(),B())}return he(l,g=>{g&&k()}),(g,e)=>{const _=ia,d=N,w=oe,V=Ne;return K(),Q(V,{show:l.value,"onUpdate:show":e[0]||(e[0]=q=>l.value=q),preset:"card",class:"w-480px"},{header:n(()=>[ca]),footer:n(()=>[a(w,{justify:"end"},{default:n(()=>[a(d,{size:"small",class:"mt-16px",onClick:D},{default:n(()=>[T(M(t(s)("common.cancel")),1)]),_:1}),a(d,{type:"primary",size:"small",class:"mt-16px",onClick:E},{default:n(()=>[T(M(t(s)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(_,{cascade:"","checked-keys":P.value,data:v.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"","label-field":"name","key-field":"id","children-field":"children","onUpdate:checkedKeys":x},null,8,["checked-keys","data"])]),_:1},8,["show"])}}}),ga={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ae(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Ae(h)}const Ia=se({name:"manage_user",__name:"index",setup(h){const b=qe(),{columns:l,columnChecks:D,data:v,getData:f,loading:P,mobilePagination:B,searchParams:x,resetSearchParams:E}=Xe({apiFn:Ye,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,usertype:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"username",title:s("page.manage.user.username"),align:"center",width:200},{key:"usertype",title:s("page.manage.user.usertype"),align:"center",width:140,render:o=>{o.usertype===void 0&&(o.usertype=0);const r={0:"primary",1:"primary",2:"primary"},i=s(Fe[o.usertype]);return a(de,{type:r[o.usertype]},ae(i)?i:{default:()=>[i]})}},{key:"udesc",title:"用户描述",align:"center",width:180,ellipsis:!0},{key:"createdate",title:s("page.manage.user.createDate"),align:"center",width:180},{key:"status",title:s("page.manage.user.status"),align:"center",width:100,render:o=>{o.status===null&&(o.status=0);const r={0:"success",1:"error",2:"warning"},i=o.status==0?"正常":o.status==1?"异常":"锁定";return a(de,{type:r[o.status]},ae(i)?i:{default:()=>[i]})}},{key:"operate",title:s("common.operate"),align:"center",width:400,fixed:"right",render:o=>{let r;return o.superadmin!=0?a("div",{class:"flex-center gap-8px"},[z(a(N,{type:"primary",ghost:!0,size:"small",onClick:()=>u(o.id)},ae(r=s("common.edit"))?r:{default:()=>[r]}),[[j("no-auth"),"sys:user:update"]]),z(a(N,{type:"primary",ghost:!0,size:"small",onClick:()=>Y(o)},{default:()=>["分配角色"]}),[[j("no-auth"),"sys:user:updateRoleUser"]]),o.status==0&&z(a(N,{type:"primary",ghost:!0,size:"small",onClick:()=>H(o.id)},{default:()=>["锁定"]}),[[j("no-auth"),"sys:user:update"]]),o.status==2&&z(a(N,{type:"primary",ghost:!0,size:"small",onClick:()=>F(o.id)},{default:()=>["解锁"]}),[[j("no-auth"),"sys:user:update"]]),z(a(N,{type:"primary",ghost:!0,size:"small",onClick:()=>A(o)},{default:()=>["修改密码"]}),[[j("no-auth"),"sys:user:update"]]),a(ua,{onPositiveClick:()=>m(o.id)},{default:()=>s("common.confirmDelete"),trigger:()=>{let i;return z(a(N,{type:"error",ghost:!0,size:"small"},ae(i=s("common.delete"))?i:{default:()=>[i]}),[[j("no-auth"),"sys:user:delete"]])}})]):a("span",{class:"c-#a4b0be"},[T("系统用户不允许操作")])}}]}),{drawerVisible:k,operateType:g,editingData:e,handleAdd:_,handleEdit:d,checkedRowKeys:w,onBatchDeleted:V,onDeleted:q,closeDrawer:O}=Ze(v,f);async function X(){console.log(w.value),G(w.value,o=>{V()})}const F=async o=>{var r;await ge({id:o,status:0}),(r=window.$message)==null||r.success("解锁成功"),f()},H=async o=>{var r;await ge({id:o,status:2}),(r=window.$message)==null||r.success("锁定成功"),f()};function m(o){console.log(o),G([o],r=>{q()})}function u(o){d(o)}const{createConfirmPwdRule:U,defaultRequiredRule:y,patternRules:I}=ye(),$=R(!1),c=ve({username:"",password:"",confirmPassword:"",id:null}),J={password:[y,I.password],confirmPassword:[{required:!0,message:s("form.confirmPwd.required")},{asyncValidator:(o,r)=>r.trim()!==""&&r!==c.password?Promise.reject(o.message):Promise.resolve(),message:s("form.confirmPwd.invalid"),trigger:"input"}]},A=o=>{$.value=!0,c.id=o.id,c.username=o.username},L=async()=>{var Z;if(!c.id)return;const o=await ue(c.password),{data:r,error:i}=await Ge(c.id,o);i||((Z=window.$message)==null||Z.success("修改成功"),$.value=!1)};async function G(o,r){const i=await Qe(o);console.log("data",i),r&&r(i)}const W=R(),C=R(!1),Y=o=>{W.value=o,C.value=!0};return(o,r)=>{const i=$e,Z=da,ne=pe,re=De,xe=ce,Se=Ke,Ce=oe,Re=Ne,Te=Ue;return K(),Ie("div",ga,[a(pa,{model:t(x),"onUpdate:model":r[0]||(r[0]=p=>ee(x)?x.value=p:null),onReset:t(E),onSearch:t(f)},null,8,["model","onReset","onSearch"]),a(Te,{title:t(s)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(i,{columns:t(D),"onUpdate:columns":r[1]||(r[1]=p=>ee(D)?D.value=p:null),"disabled-delete":t(w).length===0,loading:t(P),onAdd:t(_),onDelete:X,onRefresh:t(f),"is-view-add-button":t(_e)("sys:user:insert"),"is-view-delete-button":t(_e)("sys:user:delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:n(()=>[a(Z,{"checked-row-keys":t(w),"onUpdate:checkedRowKeys":r[2]||(r[2]=p=>ee(w)?w.value=p:null),columns:t(l),data:t(v),size:"small","flex-height":!t(b).isMobile,"scroll-x":t(l).reduce((p,Oe)=>p+Oe.width,0),loading:t(P),remote:"","row-key":p=>p.id,pagination:t(B),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),a(ma,{visible:t(k),"onUpdate:visible":r[3]||(r[3]=p=>ee(k)?k.value=p:null),"operate-type":t(g),"row-data":t(e),onSubmitted:t(f)},null,8,["visible","operate-type","row-data","onSubmitted"]),a(fa,{rowObj:W.value,visible:C.value,"onUpdate:visible":r[4]||(r[4]=p=>C.value=p)},null,8,["rowObj","visible"]),a(Re,{show:$.value,"onUpdate:show":r[8]||(r[8]=p=>$.value=p),title:t(s)("common.updatePassword"),preset:"card",class:"w-620px"},{footer:n(()=>[a(Ce,{justify:"end",size:16},{default:n(()=>[a(t(N),{onClick:t(O)},{default:n(()=>[T(M(t(s)("common.cancel")),1)]),_:1},8,["onClick"]),a(t(N),{type:"primary",onClick:L},{default:n(()=>[T(M(t(s)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(Se,{class:"max-h-480px pr-20px"},{default:n(()=>[a(xe,{ref:"formRef",model:c,rules:J,"label-placement":"left","label-width":100,"require-mark-placement":"left"},{default:n(()=>[a(re,{label:t(s)("page.manage.user.username"),path:"username"},{default:n(()=>[a(ne,{readonly:"",value:c.username,"onUpdate:value":r[5]||(r[5]=p=>c.username=p),placeholder:t(s)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(re,{label:t(s)("page.login.common.password"),path:"password"},{default:n(()=>[a(ne,{type:"password","show-password-on":"click",clearable:"",value:c.password,"onUpdate:value":r[6]||(r[6]=p=>c.password=p),placeholder:t(s)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(re,{label:t(s)("page.login.common.confirmPassword"),path:"confirmPassword"},{default:n(()=>[a(ne,{type:"password","show-password-on":"click",clearable:"",value:c.confirmPassword,"onUpdate:value":r[7]||(r[7]=p=>c.confirmPassword=p),placeholder:t(s)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])]),_:1},8,["title"])])}}});export{Ia as default};
