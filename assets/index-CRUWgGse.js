import{_ as me}from"./round-add-CR1MGL-O.js";import{az as q,d as X,aE as J,m as Y,r as ae,n as le,a as fe,aG as Z,bY as se,aC as V,H as A,d0 as _e,c as L,o as y,w as o,f as t,e as _,a0 as ve,C as ee,N as ie,h as e,v as E,aI as ge,b as T,t as g,B as S,g as x,s as P,aJ as ye,y as te,$ as O,a1 as be,aQ as we,O as he,q as H,bg as xe,aU as K,aX as ke,X as Ce,x as G,A as re,cM as Se,U as De,V as Ne,bi as je,M as ze,Z as ce,aD as Ue,b4 as $e,aO as Te,aS as Le,i as Ie,aT as Q,cR as Pe,aH as Re,aY as Me}from"./index-K-Oe9yen.js";import{u as Fe,a as We}from"./table-BjKQTj5z.js";import{_ as Be,a as Oe}from"./text-D_xfMGfj.js";import{N as de}from"./Popconfirm-CR5sQlbC.js";import{_ as qe}from"./round-search-C4uw-VPp.js";import{u as Ee}from"./usePageData-Cn0zOp5N.js";import{_ as Ge}from"./Grid-Iszn1RIZ.js";import{_ as Ve}from"./FormItemGridItem-B3wj0zec.js";function Ae(c){return q({url:"/projectWeek/getPage.do",method:"get",params:c})}function Ke(c){return q({url:"/projectWeek/insert.do",method:"post",data:c})}function He(c){return q({url:"/projectWeek/update.do",method:"put",data:c})}function Je(c){return q({url:"/projectWeek/delete.do",method:"delete",params:{arrIds:c}})}function Xe(c){return q({url:"/projectWeekComment/getPage.do",method:"get",params:c})}function Ye(c){return q({url:"/projectWeekComment/insert.do",method:"post",data:c})}function Qe(c){return q({url:"/projectWeekComment/delete.do",method:"delete",params:{arrIds:c}})}const Ze={key:0,class:""},et={key:1,class:"flex items-center w-300px"},tt={class:"mt-10px"},nt=X({name:"OperateDrawer",__name:"operate-drawer",props:J({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(c,{emit:F}){Y();const l=F,D=c,n=ae(k());function k(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",charctras:"",file1:"",file2:""}}const R={content1:{required:!0,message:"请输入",trigger:"blur"}};async function N(){Object.assign(n,k()),D.operateType==="edit"&&D.rowData&&Object.assign(n,D.rowData)}const{formRef:b,validate:W,restoreValidation:z}=le(),w=fe(()=>({add:"新增项目周报",edit:"修改项目周报"})[D.operateType]),f=Z(c,"visible"),j=()=>{f.value=!1},I=se.debounce(async()=>{var m,s;if(await W(),D.operateType==="edit"){const{data:r,error:h}=await He([{...n}]);h||((m=window.$message)==null||m.success("修改成功"),l("submitted"),j())}else{const{data:r,error:h}=await Ke([{pid:n.pid,content1:n.content1,content2:n.content2,content3:n.content3,content4:n.content4,content5:n.content5,file1:n.file1,file2:n.file2,charctras:n.charctras}]);h||((s=window.$message)==null||s.success("添加成功"),l("submitted"),j())}},1e3,{leading:!0,trailing:!1});V(f,()=>{f.value&&(N(),setTimeout(()=>{const m=document.querySelector(".n-scrollbar-content");m==null||m.scrollTo(0,0)},300),z())});const u=A([]),a=A(0);async function v({file:m},s){const r=await we(m.file,m.name,"",h=>{s=="file2"&&(a.value=h)});r&&(s=="file1"?n.value.file1=r:n.value.file2=r,a.value=0)}async function C(m,s){var r,h,M;return s=="file1"&&!["image/jpeg","image/png","image/jpg","image/x-icon"].includes(m.file.file.type)?((r=window.$message)==null||r.destroyAll(),(h=window.$message)==null||h.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1):m.file.file.size>100*1024*1024?((M=window.$message)==null||M.error("文件大小不能超过100M"),!1):!0}return V(()=>[n.content1,n.content2,n.content3,n.content4,n.content5],()=>{n.charctras=_e(n.content1+n.content2+n.content3+n.content4+n.content5)},{immediate:!0}),(m,s)=>{const r=ie,h=ge,M=ye,B=ee,i=ve,p=te,U=be;return y(),L(U,{show:f.value,"onUpdate:show":s[9]||(s[9]=d=>f.value=d),title:w.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:o(()=>[t(p,{justify:"end"},{default:o(()=>[t(e(S),{size:"small",class:"mt-16px",onClick:j},{default:o(()=>[x(g(e(O)("common.cancel")),1)]),_:1}),t(e(S),{type:"primary",size:"small",class:"mt-16px",onClick:e(I)},{default:o(()=>[x(g(e(O)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:o(()=>[t(i,{style:{height:"70vh","padding-right":"10px"}},{default:o(()=>[t(B,{ref_key:"formRef",ref:b,model:n,rules:R},{default:o(()=>[t(r,{label:"本周完成",path:"content1"},{default:o(()=>[t(e(E),{clearable:"",type:"textarea",rows:3,value:n.content1,"onUpdate:value":s[0]||(s[0]=d=>n.content1=d),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{default:o(()=>[t(e(E),{clearable:"",type:"textarea",rows:2,value:n.content2,"onUpdate:value":s[1]||(s[1]=d=>n.content2=d),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"未完成项目",path:"content3"},{default:o(()=>[t(e(E),{clearable:"",type:"textarea",rows:2,value:n.content3,"onUpdate:value":s[2]||(s[2]=d=>n.content3=d),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"下周计划",path:"content4"},{default:o(()=>[t(e(E),{clearable:"",type:"textarea",rows:2,value:n.content4,"onUpdate:value":s[3]||(s[3]=d=>n.content4=d),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"需协调与帮助",path:"content5"},{default:o(()=>[t(e(E),{clearable:"",type:"textarea",rows:2,value:n.content5,"onUpdate:value":s[4]||(s[4]=d=>n.content5=d),placeholder:"请输入内容"},null,8,["value"])]),_:1}),t(r,{label:"图片:",path:"file1"},{default:o(()=>[t(h,{ref:"uploadRef",action:"#","list-type":"image-card","default-upload":!1,max:1,"file-list":u.value,"onUpdate:fileList":s[5]||(s[5]=d=>u.value=d),"custom-request":d=>v(d,"file1"),onBeforeUpload:s[6]||(s[6]=d=>C(d,"file1"))},null,8,["file-list","custom-request"])]),_:1}),t(r,{label:"附件:",path:"file2"},{default:o(()=>[n.file2?(y(),T("div",Ze,[_("span",null,g(n.file2.split("?")[1]),1),t(e(S),{text:"",type:"error",onClick:s[7]||(s[7]=d=>n.file2="")},{default:o(()=>s[10]||(s[10]=[x("删除")])),_:1,__:[10]})])):(y(),T("div",et,[t(h,{ref:"uploadRef",action:"#","show-file-list":!1,"custom-request":d=>v(d,"file2"),onBeforeUpload:s[8]||(s[8]=d=>C(d,"file2"))},{default:o(()=>[t(e(S),{loading:a.value>0&&!n.file2},{default:o(()=>[x(g(a.value>0&&!n.file2?"上传中":"上传文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"]),a.value&&!n.file2?(y(),L(M,{key:0,type:"line",percentage:a.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):P("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1}),_("div",tt,"字符数："+g(n.charctras),1)]),_:1},8,["show","title"])}}}),ot={key:1,class:"mt-3 mb-3 text-gray-700 preview-text"},at={key:0,class:"mt-3 mb-3 text-gray-700 preview-text"},lt={class:"font-size-12px c-#a19f9d my-5px"},st={key:0},it={class:"mt-4 border-t pt-3"},rt={class:"flex items-start gap-2 mb-3"},ct={class:"ml-2 flex-1"},dt={class:"flex items-center"},ut={class:"font-medium font-size-16px font-bold"},pt={class:"text-gray-600 mt-1"},mt=X({name:"drawerLog",__name:"drawerLog",props:J({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(c){const F=Y();he();let l=ae({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:0});const D=c,n={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},k=A({});async function R(){N.value=[],Object.assign(l,D.rowData),w()}const N=A([]),b=Z(c,"visible");V(b,()=>{b.value?R():(N.value=[],l.id=void 0)}),V(()=>D.rowData,()=>{b.value&&R()});function W(u){u||z()}function z(){b.value=!1}const w=async()=>{const{data:u,error:a}=await Xe({page:1,limit:100,pid:l.id});u&&(N.value=u.list)},f=se.debounce(async()=>{var C;const u=k.value[l.id];if(!(u!=null&&u.trim()))return(C=window.$message)==null?void 0:C.warning("请输入评论内容");const{data:a,error:v}=await Ye([{pid:l.id,content:u}]);a&&(k.value[l.id]="",l.num++,w())},1e3,{leading:!0,trailing:!1}),j=async u=>{const{data:a,error:v}=await Qe(u.id);a&&(w(),l.num--,console.log("删除成功"))};async function I(u){if(!u)return;const a=u.split("?")[0],v=u.split("?")[1];try{const m=await(await fetch(a,{mode:"cors"})).blob(),s=URL.createObjectURL(m),r=document.createElement("a");r.href=s,r.download=v,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}catch(C){console.error("下载失败:",C)}}return(u,a)=>{const v=ie,C=ke,m=ee,s=Be,r=Oe,h=xe,M=je,B=H("no-auth");return y(),L(M,{show:b.value,"onUpdate:show":[a[3]||(a[3]=i=>b.value=i),W],"display-directive":"show",width:600,onMaskClick:z,onEsc:z},{default:o(()=>[t(h,{title:e(l).username+"的项目周报","native-scrollbar":!1,closable:""},{default:o(()=>[t(m,{ref:"formRef",model:e(l),"show-feedback":!1},{default:o(()=>[t(v,{label:"本周完成",path:"content1"},{label:o(()=>a[4]||(a[4]=[_("div",{class:"font-size-16px font-bold"},"本周完成",-1)])),default:o(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).content1}])},g(e(l).content1),3)]),_:1}),t(v,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{label:o(()=>a[5]||(a[5]=[_("div",{class:"font-size-16px font-bold"},"本周对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:o(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).content2}])},g(e(l).content2),3)]),_:1}),t(v,{label:"未完成项目",path:"content3"},{label:o(()=>a[6]||(a[6]=[_("div",{class:"font-size-16px font-bold"},"未完成项目",-1)])),default:o(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).content3}])},g(e(l).content3),3)]),_:1}),t(v,{label:"下周计划",path:"content4"},{label:o(()=>a[7]||(a[7]=[_("div",{class:"font-size-16px font-bold"},"下周计划",-1)])),default:o(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).content4}])},g(e(l).content4),3)]),_:1}),t(v,{label:"需协调与帮助",path:"content5"},{label:o(()=>a[8]||(a[8]=[_("div",{class:"font-size-16px font-bold"},"需协调与帮助",-1)])),default:o(()=>[_("span",{class:K(["preview-text",{textstyle:e(l).content5}])},g(e(l).content5),3)]),_:1}),t(v,{label:"图片",path:"content5"},{label:o(()=>a[9]||(a[9]=[_("div",{class:"font-size-16px font-bold"},"图片",-1)])),default:o(()=>{var i;return[e(l).file1?(y(),L(C,{key:0,width:"80",height:"80",src:e(l).file1,class:"rounded-md object-cover"},null,8,["src"])):P("",!0),e(l).file1?(y(),T("div",ot,[x(g((i=e(l).file1)==null?void 0:i.split("?")[1])+" ",1),t(e(S),{text:"",type:"primary",size:"small",onClick:a[0]||(a[0]=p=>I(e(l).file1))},{default:o(()=>a[10]||(a[10]=[x("下载")])),_:1,__:[10]})])):P("",!0)]}),_:1}),t(v,{label:"附件",path:"content5"},{label:o(()=>a[11]||(a[11]=[_("div",{class:"font-size-16px font-bold"},"附件",-1)])),default:o(()=>{var i;return[e(l).file2?(y(),T("div",at,[x(g((i=e(l).file2)==null?void 0:i.split("?")[1])+" ",1),t(e(S),{text:"",type:"primary",size:"small",onClick:a[1]||(a[1]=p=>I(e(l).file2))},{default:o(()=>a[12]||(a[12]=[x("下载")])),_:1,__:[12]})])):P("",!0)]}),_:1}),_("div",lt,"字符数："+g(e(l).charctras),1)]),_:1},8,["model"]),e(l).num?(y(),T("div",st,g(e(l).num)+"评论",1)):P("",!0),t(Ce,{name:"fade"},{default:o(()=>[_("div",it,[G((y(),T("div",rt,[_("div",null,[t(s,{size:"small",src:n.avatar},null,8,["src"])]),t(e(E),{type:"textarea",id:`comment-input-${e(l).id}`,value:k.value[e(l).id],"onUpdate:value":a[2]||(a[2]=i=>k.value[e(l).id]=i),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:re(Se(e(f),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),t(e(S),{type:"primary",ghost:"",onClick:e(f)},{default:o(()=>a[13]||(a[13]=[x("发送")])),_:1,__:[13]},8,["onClick"])])),[[B,"project:Summary:Comment:insert"]]),(y(!0),T(De,null,Ne(N.value,i=>(y(),T("div",{key:i.id,class:"flex mb-3"},[t(s,{size:"small",src:n.avatar},null,8,["src"]),_("div",ct,[_("div",dt,[_("span",ut,g(i.username),1),t(r,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:o(()=>[x(g(i.dbtime),1)]),_:2},1024),e(F).userInfo.id==i.creater?(y(),L(e(de),{key:0,onPositiveClick:p=>j(i)},{trigger:o(()=>[G((y(),L(e(S),{quaternary:"",type:"error",size:"small"},{default:o(()=>a[14]||(a[14]=[x(" 删除 ")])),_:1,__:[14]})),[[B,"project:Summary:Comment:delete"]])]),default:o(()=>[a[15]||(a[15]=x(" 确定删除吗？ "))]),_:2,__:[15]},1032,["onPositiveClick"])):P("",!0)]),_("div",pt,g(i.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),ft=ze(mt,[["__scopeId","data-v-ffa4cf32"]]),_t=X({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search","clear"],["update:model"]),setup(c,{emit:F}){const l=F,{formRef:D}=le(),n=Z(c,"model");Y();const{pageData:k,getData:R,nextPage:N}=Ee($e),b=async w=>{const f=w.currentTarget,j=f.scrollTop;f.scrollTop+f.offsetHeight>=f.scrollHeight&&k.data.length<k.total&&(await N(),await Te(),setTimeout(()=>{f.scrollTop=j}))},W=async w=>{n.value.creater=w,l("search")};R({usertypes:"2,3"});async function z(){l("search")}return(w,f)=>{const j=Ue,I=Ve,u=qe,a=S,v=te,C=Ge,m=ee,s=ce;return y(),L(s,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[t(m,{ref_key:"formRef",ref:D,model:n.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:re(z,["enter"])},{default:o(()=>[t(C,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[t(I,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:o(()=>[t(j,{clearable:"",filterable:"",value:n.value.creater,"onUpdate:value":[f[0]||(f[0]=r=>n.value.creater=r),W],placeholder:"请选择","label-field":"username","value-field":"id",options:e(k).data,onScroll:b},null,8,["value","options"])]),_:1}),t(I,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[t(v,{class:"w-full"},{default:o(()=>[t(a,{type:"primary",ghost:"",onClick:z},{icon:o(()=>[t(u,{class:"text-icon"})]),default:o(()=>[x(" "+g(e(O)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),vt={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},gt={key:0};function oe(c){return typeof c=="function"||Object.prototype.toString.call(c)==="[object Object]"&&!Me(c)}const Nt=X({name:"projectmanagement_memberlog",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(c,{emit:F}){const l=Le(),D=Y(),n=c,k=F,{columns:R,data:N,getData:b,loading:W,mobilePagination:z,searchParams:w}=Fe({showTotal:!0,immediate:!0,apiFn:Ae,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:i=>t("div",null,[i.username+"的项目周报"])},{key:"charctras",title:"字符数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:O("common.operate"),align:"center",width:140,fixed:"right",render:i=>{let p;return t("div",{class:"flex-center gap-8px"},[t(S,{type:"primary",ghost:!0,size:"small",onClick:()=>M(i)},{default:()=>[x("查看详情")]}),D.userInfo.id==i.creater&&G(t(S,{type:"primary",ghost:!0,size:"small",onClick:()=>s(i.id)},oe(p=O("common.edit"))?p:{default:()=>[p]}),[[H("no-auth"),"project:Summary:update"]]),D.userInfo.id==i.creater&&t(de,{onPositiveClick:()=>m(i.id)},{default:()=>O("common.confirmDelete"),trigger:()=>{let U;return G(t(S,{type:"error",ghost:!0,size:"small"},oe(U=O("common.delete"))?U:{default:()=>[U]}),[[H("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:f,operateType:j,editingData:I,handleAdd:u,handleEdit:a,checkedRowKeys:v,onDeleted:C}=We(N,b);async function m(i){const{data:p,error:U}=await Je(i);U||C()}function s(i){a(i)}const r=A(!1),h=A({}),M=i=>{r.value=!0,h.value=i},B=()=>{b()};return V(()=>n.pid,async i=>{i&&(w.pid=i,await b())}),V(()=>N.value,async i=>{i.length>0?k("thereIsData",1):k("thereIsData",0)}),Ie(()=>{n.type!="externalLiaison"}),(i,p)=>{const U=te,d=me,ue=Re,pe=ce,ne=H("no-auth");return y(),T("div",vt,[n.pid?P("",!0):(y(),L(_t,{key:0,model:e(w),"onUpdate:model":p[0]||(p[0]=$=>Q(w)?w.value=$:null),onReset:B,onSearch:e(b),onClear:p[1]||(p[1]=$=>N.value=[])},null,8,["model","onSearch"])),t(pe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Pe({header:o(()=>[t(U,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>[n.pid?P("",!0):(y(),T("div",gt,"项目周报"))]),_:1}),n.pid?G((y(),L(e(S),{key:0,onClick:e(u),size:"small",ghost:"",type:"primary"},{icon:o(()=>[t(d,{class:"text-icon"})]),default:o(()=>[p[5]||(p[5]=x(" "+g("新增")))]),_:1,__:[5]},8,["onClick"])),[[ne,"project:Summary:insert"]]):P("",!0)]),default:o(()=>[t(ue,{"checked-row-keys":e(v),"onUpdate:checkedRowKeys":p[2]||(p[2]=$=>Q(v)?v.value=$:null),columns:e(R),data:e(N),size:"small","flex-height":!e(l).isMobile,loading:e(W),remote:"","row-key":$=>$.id,pagination:e(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(nt,{visible:e(f),"onUpdate:visible":p[3]||(p[3]=$=>Q(f)?f.value=$:null),onSubmitted:e(b),"operate-type":e(j),pid:n.pid||e(w).pid,"row-data":e(I)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),t(ft,{visible:r.value,"onUpdate:visible":p[4]||(p[4]=$=>r.value=$),"row-data":h.value},null,8,["visible","row-data"])]),_:2},[n.pid?void 0:{name:"header-extra",fn:o(()=>[t(U,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[G((y(),L(e(S),{onClick:e(u),size:"small",ghost:"",type:"primary"},{icon:o(()=>[t(d,{class:"text-icon"})]),default:o(()=>[p[6]||(p[6]=x(" "+g("新增")))]),_:1,__:[6]},8,["onClick"])),[[ne,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{Nt as default};
