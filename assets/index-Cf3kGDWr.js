import{_ as ee}from"./table-header-operation.vue_vue_type_script_setup_true_lang-LQXhcny6.js";import{d as j,q as P,v as E,s as G,L as U,o as q,c as L,w as a,g as e,i as t,V as W,ag as H,M as F,h as I,t as M,$ as p,N as te,Y,A as J,B as O,E as Q,D as X,aa as Z,x as oe,b as ae,r as ne,y as se,C as le,ab as ie,ac as re,a0 as ce,al as pe,as as de,an as ue,e as me,ad as B,ae as _e}from"./index-BAVDbSG0.js";import{u as fe,a as ye}from"./table-KJ4OXJa6.js";import{n as ve,o as he,f as ge,p as be}from"./asset-BagffwD1.js";import{_ as we}from"./round-search-Bcb0t4Jv.js";import{_ as De}from"./round-refresh-yP8uig6G.js";import{_ as ke}from"./FormItemGridItem-xXViKYEE.js";import{_ as Ne}from"./Grid-BDOf_ubP.js";import{h as K}from"./permission-CLrEu3_U.js";import{_ as xe}from"./Popconfirm-CUDFKPM8.js";import{_ as Se}from"./DataTable-BDYCfsCN.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-C9U6osR4.js";import"./setting-outlined-D3n2FZ9Z.js";import"./round-delete-DS0ILC9q.js";import"./refresh-C3aYfWsn.js";import"./round-plus-BaLKVTfF.js";import"./Upload-B9yETaen.js";import"./Progress-CaLEcM5E.js";import"./Forward-edmZhOxW.js";const ze=j({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:P(["reset","search"],["update:model"]),setup(_,{emit:S}){const c=S,{formRef:h,restoreValidation:u}=E(),l=G(_,"model");function k(){l.value.fuzzy="",c("search")}async function z(){await u(),c("reset")}async function f(){c("search")}return($,o)=>{const N=Y,b=ke,C=J,w=De,d=O,g=we,i=Q,x=Ne,m=X,T=Z,R=U("no-space");return q(),L(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(m,{ref_key:"formRef",ref:h,model:l.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(f,["enter"])},{default:a(()=>[e(x,{responsive:"screen","item-responsive":""},{default:a(()=>[e(b,{span:"24 s:12 m:6",label:"一级资产分类",path:"pid",class:"pr-24px"},{default:a(()=>[e(N,{filterable:"",clearable:"",value:l.value.pid,"onUpdate:value":[o[0]||(o[0]=y=>l.value.pid=y),f],placeholder:"请选择一级资产分类",options:t(W)(t(H)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(b,{span:"24 s:12 m:6",label:"名称",path:"fuzzy",class:"pr-24px"},{default:a(()=>[F(e(C,{clearable:"",value:l.value.fuzzy,"onUpdate:value":o[1]||(o[1]=y=>l.value.fuzzy=y),placeholder:"请输入资产二级分类名称",onClear:k},null,8,["value"]),[[R]])]),_:1}),e(b,{span:"24 m:12",class:"pr-24px"},{default:a(()=>[e(i,{class:"w-full"},{default:a(()=>[e(d,{onClick:z},{icon:a(()=>[e(w,{class:"text-icon"})]),default:a(()=>[I(" "+M(t(p)("common.reset")),1)]),_:1}),e(d,{type:"primary",ghost:"",onClick:f},{icon:a(()=>[e(g,{class:"text-icon"})]),default:a(()=>[I(" "+M(t(p)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ce=j({name:"OperateDrawer",__name:"operate-drawer",props:P({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:P(["submitted"],["update:visible"]),setup(_,{emit:S}){const c=_,h=S,u=G(_,"visible"),{formRef:l,validate:k,restoreValidation:z}=E(),{defaultRequiredRule:f}=oe(),$=ae(()=>({add:"新增资产类型",edit:"编辑资产类型"})[c.operateType]),o=ne(N());function N(){return{pid:void 0,aname:"",sysv:1}}const b={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择资产一级分类"},aname:f};function C(){Object.assign(o,N()),c.operateType==="edit"&&c.rowData&&Object.assign(o,c.rowData)}function w(){u.value=!1}async function d(){var g,i;if(await k(),c.operateType==="add"){const{data:x,error:m}=await ve([{pid:o.pid,aname:o.aname,sysv:o.sysv}]);m||((g=window.$message)==null||g.success(p("common.addSuccess")),w(),h("submitted"))}else{const{data:x,error:m}=await he([{id:c.rowData.id,pid:o.pid,aname:o.aname,sysv:o.sysv}]);m||((i=window.$message)==null||i.success(p("common.updateSuccess")),w(),h("submitted"))}}return se(u,()=>{u.value&&(C(),z())}),(g,i)=>{const x=Y,m=le,T=J,R=X,y=O,s=Q,n=ie,r=re,A=U("no-space");return q(),L(r,{show:u.value,"onUpdate:show":i[2]||(i[2]=D=>u.value=D),"display-directive":"show",width:450},{default:a(()=>[e(n,{title:$.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(s,{size:16},{default:a(()=>[e(y,{onClick:w},{default:a(()=>[I(M(t(p)("common.cancel")),1)]),_:1}),e(y,{type:"primary",onClick:d},{default:a(()=>[I(M(t(p)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(R,{ref_key:"formRef",ref:l,model:o,rules:b},{default:a(()=>[e(m,{label:"资产一级分类",path:"pid"},{default:a(()=>[e(x,{filterable:"",value:o.pid,"onUpdate:value":i[0]||(i[0]=D=>o.pid=D),placeholder:"请选择资产一级分类",options:t(W)(t(H)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"资产二级分类",path:"aname"},{default:a(()=>[F(e(T,{value:o.aname,"onUpdate:value":i[1]||(i[1]=D=>o.aname=D),placeholder:"请输入资产二级分类"},null,8,["value"]),[[A]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Te={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function V(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!_e(_)}const Ye=j({name:"assetmanagement_assetgroup",__name:"index",setup(_){const S=ce(),{columns:c,columnChecks:h,data:u,getData:l,loading:k,mobilePagination:z,searchParams:f,resetSearchParams:$}=fe({apiFn:ge,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,pid:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"pid",title:"资产一级分类",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:s=>p(pe[s.pid])},{key:"aname",title:"资产二级分类",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"sysv",title:"系统内置",align:"center",width:120,render:s=>{const n={0:"success",1:"info"},r=p(de[s.sysv]);return e(ue,{size:"small",type:n[s.sysv]},V(r)?r:{default:()=>[r]})}},{key:"operate",title:p("common.operate"),align:"center",width:160,render:s=>{let n;return s.sysv!=0?e("div",{class:"flex-center gap-8px"},[F(e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>T(s.id)},V(n=p("common.edit"))?n:{default:()=>[n]}),[[U("no-auth"),"sys.asset.type.update"]]),e(xe,{onPositiveClick:()=>R(s.id)},{default:()=>p("common.confirmDelete"),trigger:()=>{let r;return F(e(O,{type:"error",ghost:!0,size:"small"},V(r=p("common.delete"))?r:{default:()=>[r]}),[[U("no-auth"),"sys.asset.type.delete"]])}})]):null}}]}),{drawerVisible:o,operateType:N,editingData:b,handleAdd:C,handleEdit:w,checkedRowKeys:d,onBatchDeleted:g,onDeleted:i,closeDrawer:x}=ye(u,l);async function m(){console.log(d.value),y(d.value,s=>{g()})}function T(s){w(s)}function R(s){y([s],n=>{i()})}async function y(s,n){const{data:r,error:A}=await be(s);if(!A)n&&n(r);else return!1}return(s,n)=>{const r=ee,A=Se,D=Z;return q(),me("div",Te,[e(ze,{model:t(f),"onUpdate:model":n[0]||(n[0]=v=>B(f)?f.value=v:null),onReset:t($),onSearch:t(l)},null,8,["model","onReset","onSearch"]),e(D,{title:"资产类型",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(r,{columns:t(h),"onUpdate:columns":n[1]||(n[1]=v=>B(h)?h.value=v:null),"disabled-delete":t(d).length===0,loading:t(k),onAdd:t(C),onDelete:m,onRefresh:t(l),"is-view-add-button":t(K)("sys.asset.type.insert"),"is-view-delete-button":t(K)("sys.asset.type.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:a(()=>[e(A,{"checked-row-keys":t(d),"onUpdate:checkedRowKeys":n[2]||(n[2]=v=>B(d)?d.value=v:null),columns:t(c),data:t(u),size:"small","flex-height":!t(S).isMobile,"scroll-x":962,loading:t(k),remote:"","row-key":v=>v.id,pagination:t(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ce,{visible:t(o),"onUpdate:visible":n[3]||(n[3]=v=>B(o)?o.value=v:null),"operate-type":t(N),"row-data":t(b),onSubmitted:t(l)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Ye as default};
