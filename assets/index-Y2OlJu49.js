import{_ as $e}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DCcFtEoA.js";import{d as ne,q as ae,s as _e,v as ye,x as Ae,j as ee,b as Pe,$ as s,r as Ve,y as Oe,K as Z,o as k,c as A,w as n,g as t,h as D,t as C,i as l,L as G,e as le,al as ue,Z as W,aV as Me,an as pe,f as oe,aW as je,N as te,aC as Be,aX as Ee,aY as de,A as ge,C as Fe,aq as Ie,E as ve,ap as Ge,a2 as he,ao as He,D as be,B as X,ae as qe,af as Ke,aZ as We,M as Ze,ad as we,a4 as Xe,at as me,a_ as Ye,a$ as Je,ag as q,ah as Qe,ai as et}from"./index-ByfxsQvj.js";import{f as tt,m as at,n as lt,a as nt,o as ot}from"./audit-events-Bl4EoXOV.js";import{u as st,a as rt}from"./table-Ca-5bYro.js";import{u as ce}from"./usePageData-lPm5H_26.js";import{a as it}from"./events--VzTCbWs.js";import{f as ut,a as pt}from"./common-lZBul0dM.js";import{_ as dt}from"./TimePicker-Bw31iYnN.js";import{_ as mt}from"./Cascader-CoHr4l42.js";import{_ as ct}from"./DatePicker-ChOIwL9T.js";import{_ as ft}from"./round-search-U_wZ0GRt.js";import{_ as _t}from"./round-refresh-BRVSTvae.js";import{_ as yt}from"./lodash-21GmhknM.js";import{_ as gt}from"./FormItemGridItem-Dtr_7n7z.js";import{_ as vt}from"./Grid-B9K_tFX2.js";import{h as fe}from"./permission-DpUBsxJs.js";import{T as ht}from"./basicconf-DJQBiVhW.js";import{_ as bt}from"./Popconfirm-Bx1fZnQD.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-frQqLk93.js";import"./setting-outlined-C6sNL0co.js";import"./export-CaaNVRvS.js";import"./refresh-DDT70CE0.js";import"./round-delete-BsuQe4MI.js";import"./round-plus--T3dOesv.js";import"./Upload-BPNrVbAn.js";import"./Progress-B01mUdYA.js";import"./defineProperty-D9xlJP3p.js";const wt={class:"w-100%"},kt=oe("span",null,"至",-1),Dt=oe("span",null,"至",-1),Nt=ne({name:"OperateDrawer",__name:"operate-drawer",props:ae({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ae(["submitted"],["update:visible"]),setup(N,{emit:B}){const p=N,x=B,h=_e(N,"visible"),{formRef:c,validate:P,restoreValidation:E}=ye(),{defaultRequiredRule:v}=Ae(),U=ee([]),V=Pe(()=>({add:s("page.audit.strategy.addTitle"),edit:s("page.audit.strategy.editTitle")})[p.operateType]),e=Ve(O());function O(){return{pname:"",aetype:0,psort:0,pcontent:null,efftime:0,starttime:null,endtime:null,aename:"",alevel:0,atype:null,pdesc:"",forsys:"",status:0,ptype:1,weekstart:void 0,weekend:void 0}}const L={pname:v,starttime:v,endtime:v,weekstart:{type:"number",required:!0,trigger:["change","blur"],message:"请选择星期"},weekend:{type:"number",required:!0,trigger:["change","blur"],message:"请选择星期"},time:v,efftime:{type:"number",required:!0,trigger:"change",message:"请选择审计类型"},atype:{type:"number",required:!0,trigger:"change",message:"请选择审计类型"}},M=()=>["星期一","星期二","星期三","星期四","星期五","星期六","星期天"].map((a,_)=>({label:a,value:_+1}));async function b(){await H(),await I(),await m(),Object.assign(e,O()),p.operateType==="edit"&&p.rowData&&(p.rowData.pcontent=p.rowData.pcontent?p.rowData.pcontent.split(",").map(Number):[],p.rowData.starttime=p.rowData.starttime?p.rowData.starttime:void 0,p.rowData.endtime=p.rowData.endtime?p.rowData.endtime:void 0,p.rowData.forsys=p.rowData.forsys?p.rowData.forsys.split(",").map(Number):[],Object.assign(e,p.rowData),f.value=[e.starttime,e.endtime])}function S(){h.value=!1}const T=ee([]);async function H(){const{data:i,error:a}=await ut();a||(T.value=i,i.forEach(_=>{U.value.push(_.id)}),await F())}async function F(){const{data:i,error:a}=await pt();if(!a){let _=T.value.concat(i);T.value=Ee(_)}}const{pageData:R,getData:I,nextPage:j}=ce(tt),r=async i=>{const a=i.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&R.data.length<R.total&&j()},{pageData:u,getData:m,nextPage:z}=ce(it),Y=async i=>{const a=i.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&u.data.length<u.total&&z()},f=ee(null);async function ke(i,a){e.starttime=de(1,a[0]),e.endtime=de(1,a[1])}async function De(i,a){console.log(e.pcontent)}async function Ne(){var a,_,d,g;await P();let i=[];if(e.pcontent&&e.pcontent.length>0&&(i=e.pcontent.filter(y=>!U.value.includes(y))),p.operateType==="add"){const{data:y,error:w}=await at([{pname:e.pname,aetype:e.aetype,psort:e.psort,pcontent:i.length>0?i.join(","):"",efftime:e.efftime,starttime:e.starttime,endtime:e.endtime,aename:e.aename,alevel:e.alevel,atype:e.atype,pdesc:e.pdesc,forsys:e.forsys.length>0?(a=e.forsys)==null?void 0:a.join(","):"",status:e.status,ptype:e.ptype,weekstart:e.weekstart,weekend:e.weekend}]);w||((_=window.$message)==null||_.success(s("common.addSuccess")),S(),x("submitted"))}else{const{data:y,error:w}=await lt([{id:p.rowData.id,pname:e.pname,aetype:e.aetype,psort:e.psort,pcontent:i.length>0?i.join(","):"",efftime:e.efftime,starttime:e.starttime,endtime:e.endtime,aename:e.aename,alevel:e.alevel,atype:e.atype,pdesc:e.pdesc,forsys:e.forsys.length>0?(d=e.forsys)==null?void 0:d.join(","):"",status:e.status,ptype:e.ptype,weekstart:e.weekstart,weekend:e.weekend}]);w||((g=window.$message)==null||g.success(s("common.updateSuccess")),S(),x("submitted"))}}Oe(h,()=>{h.value&&(b(),E())});const xe=i=>{var g;function a(y){const[w,J,$]=y.split(":").map(Number);return w*3600+J*60+$}const _=a(e.starttime),d=a(i);if(_>d)return e.endtime=null,(g=window.$message)==null?void 0:g.warning("开始时间不能大于结束时间，请您重新选择")},Se=i=>{var a;e.efftime=i,e.starttime=null,e.endtime=null,e.weekstart=void 0,e.weekend=void 0,f.value=null,(a=c.value)==null||a.restoreValidation()},Te=i=>(e.weekstart&&e.weekstart>i.value&&(i.disabled=!0),i.label);return(i,a)=>{const _=ge,d=Fe,g=Ie,y=ve,w=Ge,J=mt,$=he,se=dt,Ce=ct,Ue=He,Le=be,re=X,Re=qe,ze=Ke,ie=Z("no-space");return k(),A(ze,{show:h.value,"onUpdate:show":a[17]||(a[17]=o=>h.value=o),"display-directive":"show",width:560},{default:n(()=>[t(Re,{title:V.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[t(y,{size:16},{default:n(()=>[t(re,{onClick:S},{default:n(()=>[D(C(l(s)("common.cancel")),1)]),_:1}),t(re,{type:"primary",onClick:Ne},{default:n(()=>[D(C(l(s)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[t(Le,{ref_key:"formRef",ref:c,model:e,rules:L},{default:n(()=>[t(d,{label:l(s)("page.audit.strategy.name"),path:"pname"},{default:n(()=>[G(t(_,{clearable:"",value:e.pname,"onUpdate:value":a[0]||(a[0]=o=>e.pname=o),placeholder:l(s)("page.audit.strategy.form.name")},null,8,["value","placeholder"]),[[ie]])]),_:1},8,["label"]),t(d,{label:l(s)("page.audit.strategy.eventType"),path:"aetype"},{default:n(()=>[t(w,{value:e.aetype,"onUpdate:value":a[1]||(a[1]=o=>e.aetype=o)},{default:n(()=>[t(y,null,{default:n(()=>[(k(!0),le(pe,null,ue(l(W)(l(Me)),(o,Q)=>(k(),A(g,{value:o.value,key:Q},{default:n(()=>[D(C(o.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(d,{label:"事件",path:"pcontent"},{default:n(()=>[t(J,{value:e.pcontent,"onUpdate:value":[a[2]||(a[2]=o=>e.pcontent=o),De],multiple:"",clearable:"",placeholder:"请选择事件","max-tag-count":1,options:T.value,"show-path":!1,filterable:"","value-field":"id","label-field":"pname"},null,8,["value","options"])]),_:1}),t(d,{label:l(s)("page.audit.strategy.efftime"),path:"efftime","show-feedback":!1},{default:n(()=>[oe("div",wt,[t(w,{value:e.efftime,"onUpdate:value":[a[3]||(a[3]=o=>e.efftime=o),Se]},{default:n(()=>[t(y,null,{default:n(()=>[(k(!0),le(pe,null,ue(l(W)(l(je)),(o,Q)=>(k(),A(g,{value:o.value,key:Q},{default:n(()=>[D(C(o.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"]),e.efftime===1?(k(),A(y,{key:0,align:"center",justify:"space-between",class:"mt--15px"},{default:n(()=>[t(d,{path:"weekstart"},{default:n(()=>[t($,{filterable:"",value:e.weekstart,"onUpdate:value":a[4]||(a[4]=o=>e.weekstart=o),placeholder:"请选择星期",options:M(),style:{width:"230px"}},null,8,["value","options"])]),_:1}),kt,t(d,{path:"weekend"},{default:n(()=>[t($,{filterable:"",value:e.weekend,"onUpdate:value":a[5]||(a[5]=o=>e.weekend=o),placeholder:"请选择星期",options:M(),"render-label":Te,style:{width:"230px"}},null,8,["value","options"])]),_:1})]),_:1})):te("",!0),e.efftime===0||e.efftime===1?(k(),A(y,{key:1,align:"center",justify:"space-between",class:"mt--15px"},{default:n(()=>[t(d,{path:"starttime"},{default:n(()=>[t(se,{"formatted-value":e.starttime,"onUpdate:formattedValue":a[6]||(a[6]=o=>e.starttime=o),type:"time",format:"HH:mm:ss",clearable:"",style:{width:"230px"}},null,8,["formatted-value"])]),_:1}),Dt,t(d,{path:"endtime"},{default:n(()=>[t(se,{"formatted-value":e.endtime,"onUpdate:formattedValue":[a[7]||(a[7]=o=>e.endtime=o),xe],type:"time",format:"HH:mm:ss",clearable:"",style:{width:"230px"}},null,8,["formatted-value"])]),_:1})]),_:1})):te("",!0),e.efftime===2?(k(),A(y,{key:2,align:"center",class:"mt--15px w-100%","item-style":{width:"100%"}},{default:n(()=>[t(d,{path:"time"},{default:n(()=>[t(Ce,{"formatted-value":f.value,"onUpdate:formattedValue":[a[8]||(a[8]=o=>f.value=o),ke],type:"datetimerange","date-format":"yyyy-MM-dd hh:mm:ss",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})]),_:1})):te("",!0)])]),_:1},8,["label"]),t(d,{label:l(s)("page.audit.strategy.eventname"),path:"aename"},{default:n(()=>[G(t(_,{value:e.aename,"onUpdate:value":a[9]||(a[9]=o=>e.aename=o),placeholder:l(s)("page.audit.strategy.form.eventname")},null,8,["value","placeholder"]),[[ie]])]),_:1},8,["label"]),t(d,{label:l(s)("page.audit.strategy.eventLevel"),path:"alevel"},{default:n(()=>[t($,{filterable:"",value:e.alevel,"onUpdate:value":a[10]||(a[10]=o=>e.alevel=o),placeholder:"请选择审计事件级别",options:l(W)(l(Be)),style:{width:"100%"}},null,8,["value","options"])]),_:1},8,["label"]),t(d,{label:l(s)("page.audit.strategy.type"),path:"atype"},{default:n(()=>[t($,{value:e.atype,"onUpdate:value":a[11]||(a[11]=o=>e.atype=o),placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:l(R).data,"reset-menu-on-options-change":!1,onScroll:r},null,8,["value","options"])]),_:1},8,["label"]),t(d,{label:"转发策略",path:"forsys"},{default:n(()=>[t($,{value:e.forsys,"onUpdate:value":a[12]||(a[12]=o=>e.forsys=o),multiple:"",placeholder:"请选择转发策略",clearable:"",filterable:"","label-field":"ipaddr","value-field":"id",options:l(u).data,"reset-menu-on-options-change":!1,onScroll:Y},null,8,["value","options"])]),_:1}),t(d,{label:l(s)("page.audit.strategy.describe"),path:"pdesc"},{default:n(()=>[t(_,{value:e.pdesc,"onUpdate:value":a[13]||(a[13]=o=>e.pdesc=o),placeholder:l(s)("page.audit.strategy.form.describe"),type:"textarea"},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:l(s)("page.audit.strategy.status"),path:"status"},{default:n(()=>[t(w,{value:e.status,"onUpdate:value":a[14]||(a[14]=o=>e.status=o)},{default:n(()=>[t(y,null,{default:n(()=>[t(g,{value:0},{default:n(()=>[D("开启")]),_:1}),t(g,{value:1},{default:n(()=>[D("禁用")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(d,{label:l(s)("page.audit.strategy.form.built"),path:"ptype"},{default:n(()=>[t(w,{value:e.ptype,"onUpdate:value":a[15]||(a[15]=o=>e.ptype=o)},{default:n(()=>[t(y,null,{default:n(()=>[t(g,{value:0},{default:n(()=>[D(C(l(s)("common.yesOrNo.yes")),1)]),_:1}),t(g,{value:1},{default:n(()=>[D(C(l(s)("common.yesOrNo.no")),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(d,{label:l(s)("page.audit.type.sort"),path:"psort"},{default:n(()=>[t(Ue,{min:0,value:e.psort,"onUpdate:value":a[16]||(a[16]=o=>e.psort=o),placeholder:l(s)("page.audit.strategy.form.sort"),style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),xt=ne({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ae(["reset","search"],["update:model"]),setup(N,{emit:B}){const p=B,{formRef:x,restoreValidation:h}=ye(),c=_e(N,"model");function P(){c.value.fuzzy="",p("search")}async function E(){await h(),p("reset")}async function v(){p("search")}const U=yt.throttle(v,1e3,{trailing:!1});return(V,e)=>{const O=ge,L=gt,M=he,b=_t,S=X,T=ft,H=ve,F=vt,R=be,I=we,j=Z("no-space");return k(),A(I,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(R,{ref_key:"formRef",ref:x,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ze(l(U),["enter"])},{default:n(()=>[t(F,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[t(L,{span:"24 s:12 m:8 l:6",label:l(s)("page.audit.strategy.name"),path:"fuzzy"},{default:n(()=>[G(t(O,{clearable:"",value:c.value.fuzzy,"onUpdate:value":e[0]||(e[0]=r=>c.value.fuzzy=r),placeholder:l(s)("page.audit.strategy.form.name"),onClear:P},null,8,["value","placeholder"]),[[j]])]),_:1},8,["label"]),t(L,{span:"24 s:12 m:8 l:6",label:"使用状态",path:"status"},{default:n(()=>[t(M,{filterable:"",clearable:"",value:c.value.status,"onUpdate:value":[e[1]||(e[1]=r=>c.value.status=r),v],placeholder:"请选择使用状态",options:l(W)(l(We))},null,8,["value","options"])]),_:1}),t(L,{span:"24 s:12 m:8 l:6"},{default:n(()=>[t(H,{class:"w-full"},{default:n(()=>[t(S,{onClick:E},{icon:n(()=>[t(b,{class:"text-icon"})]),default:n(()=>[D(" "+C(l(s)("common.reset")),1)]),_:1}),t(S,{type:"primary",ghost:"",onClick:l(U)},{icon:n(()=>[t(T,{class:"text-icon"})]),default:n(()=>[D(" "+C(l(s)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),St={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function K(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!Qe(N)}const ea=ne({name:"audit_strategy",__name:"index",setup(N){const B=Xe(),{columns:p,columnChecks:x,data:h,getData:c,loading:P,mobilePagination:E,searchParams:v,resetSearchParams:U}=st({apiFn:nt,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,status:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"pname",title:s("page.audit.strategy.name"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"alevel",title:s("page.audit.strategy.eventLevel"),align:"center",minWidth:180,render:r=>{(r.alevel===void 0||r.alevel===null)&&(r.alevel=0);const u={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},m=s(ht[r.alevel]);let z={color:u[r.alevel],textColor:"#ffffff",borderColor:u[r.alevel]};return t(me,{size:"small",color:z},K(m)?m:{default:()=>[m]})}},{key:"pdesc",title:s("page.audit.strategy.describe"),align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"ptype",title:s("page.audit.strategy.built"),align:"center",width:120,render:r=>{const u={0:"primary",1:"error"},m=s(Ye[r.ptype]);return t(me,{type:u[r.ptype]},K(m)?m:{default:()=>[m]})}},{key:"status",title:s("page.audit.strategy.status"),align:"center",width:120,render:r=>t(Je,{disabled:!0,value:r.status,checkedValue:0,uncheckedValue:1},null)},{key:"operate",title:s("common.operate"),align:"center",width:130,render:r=>{let u;return r.ptype!=0?t("div",{class:"flex-center gap-8px"},[G(t(X,{type:"primary",ghost:!0,size:"small",onClick:()=>I(r.id)},K(u=s("common.edit"))?u:{default:()=>[u]}),[[Z("no-auth"),"sys.audit.policy.update"]]),t(bt,{onPositiveClick:()=>R(r.id)},{default:()=>s("common.confirmDelete"),trigger:()=>{let m;return G(t(X,{type:"error",ghost:!0,size:"small"},K(m=s("common.delete"))?m:{default:()=>[m]}),[[Z("no-auth"),"sys.audit.policy.delete"]])}})]):null}}]}),{drawerVisible:V,operateType:e,editingData:O,handleAdd:L,handleEdit:M,checkedRowKeys:b,onBatchDeleted:S,onDeleted:T,closeDrawer:H}=rt(h,c);async function F(){console.log(b.value),j(b.value,r=>{S()})}function R(r){console.log(r),j([r],u=>{T()})}function I(r){M(r)}async function j(r,u){const{data:m,error:z}=await ot(r);if(!z)u&&u(m);else return!1}return(r,u)=>{const m=$e,z=et,Y=we;return k(),le("div",St,[t(xt,{model:l(v),"onUpdate:model":u[0]||(u[0]=f=>q(v)?v.value=f:null),onReset:l(U),onSearch:l(c)},null,8,["model","onReset","onSearch"]),t(Y,{title:l(s)("page.audit.strategy.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[t(m,{columns:l(x),"onUpdate:columns":u[1]||(u[1]=f=>q(x)?x.value=f:null),"disabled-delete":l(b).length===0,loading:l(P),onAdd:l(L),onDelete:F,onRefresh:l(c),"is-view-add-button":l(fe)("sys.audit.policy.insert"),"is-view-delete-button":l(fe)("sys.audit.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:n(()=>[t(z,{"checked-row-keys":l(b),"onUpdate:checkedRowKeys":u[2]||(u[2]=f=>q(b)?b.value=f:null),columns:l(p),data:l(h),size:"small","flex-height":!l(B).isMobile,"scroll-x":962,loading:l(P),remote:"","row-key":f=>f.id,pagination:l(E),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Nt,{visible:l(V),"onUpdate:visible":u[3]||(u[3]=f=>q(V)?V.value=f:null),"operate-type":l(e),"row-data":l(O),onSubmitted:l(c)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{ea as default};
