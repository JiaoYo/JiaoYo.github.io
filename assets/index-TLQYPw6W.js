import{d as F,n as q,a3 as Q,p as de,s as Z,j as S,r as B,D as pe,o as V,c as X,w as l,g as a,E as ce,h as f,t as h,i as x,$ as U,F as ve,aG as me,aw as N,ax as H,J as fe,Z as ge,B as G,N as J,O as _e,ad as Y,ae as he,av as K,e as j,ai as Ie,ay as ye,aj as ee,az as Se,S as we,ar as be,P as xe,Q as Ae,f as te,R as ae}from"./index-kJGlad6M.js";import{_ as ke,l as le}from"./lodash-DXdKtNOf.js";import{_ as Ee}from"./round-search-BYKYaXiB.js";import{_ as Ce}from"./round-refresh-Dy6kiowY.js";import{c as De,a as Te,f as ze}from"./common-BgPtshCR.js";import{_ as $e}from"./Cascader-DaQcYaNU.js";import{_ as Pe}from"./FormItemGridItem-CnTVAwim.js";import{_ as Ne}from"./DatePicker-C9r8aoOO.js";import{_ as Le}from"./Grid-B6yVwz0R.js";import{v as Ve,f as Ue,w as Me}from"./events-DSU6wxou.js";import{T as Oe}from"./basicconf-BjTYMnHV.js";import{e as Re}from"./exportExcel-D6OyA9oJ.js";import{_ as Be}from"./originlogInfo.vue_vue_type_script_setup_true_lang-7FNesZUa.js";import{S as Ge,t as W}from"./alarm-Beal0Vf3.js";import{_ as He,a as je}from"./DescriptionsItem-DMmlJuCv.js";import"./TimePicker-C4siBE4Q.js";import"./defineProperty-v46mLva0.js";import"./collection-BJUjohtV.js";import"./CollapseItem-DXKagWRi.js";const Fe=F({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["search"],["update:model"]),setup(y,{emit:k}){const A=k,v=Q(),{formRef:E,restoreValidation:I}=de(),e=Z(y,"model"),m=S();(async()=>{const{data:p,error:n}=await De();n||(m.value=p.map(r=>({...r,id:"-"+r.id,type:r.cname})))})();const b=B({eventsTypeDataList:[],eventsCategoryData:[]});async function D(){const{data:p,error:n}=await Te();n||(b.eventsTypeDataList=p)}D();async function T(){const{data:p,error:n}=await ze();n||(b.eventsCategoryData=p.map(r=>({value:r.id,label:r.pname})))}T();function z(){e.value.fuzzy=void 0,g()}async function w(p,n){p?(e.value.startTime=p[0],e.value.endTime=p[1]):(e.value.startTime=null,e.value.endTime=null),A("search")}async function P(){await I(),e.value.lsid=null,e.value.etype=null,e.value.elevel=null,e.value.fuzzy=null,e.value.startAndEndSendSourceIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.timeRange=null,e.value.ectgr=null,e.value.startSourceIp=null,e.value.endSourceIp=null,e.value.startAimIp=null,e.value.endAimIp=null,e.value.startSIp=null,e.value.endSIp=null,e.value.startTime=null,e.value.endTime=null,me(()=>{A("search")})}const i=()=>{e.value.startAndEndSendSourceIp=null,g()},c=()=>{e.value.startAndEndSourceIp=null,g()},o=()=>{e.value.startAndEndAimSourceIp=null,g()};async function g(){var p,n,r,s,t,$,M,O,L,R;if(e.value.startAndEndSendSourceIp&&e.value.startAndEndSendSourceIp.length>0?(e.value.startSIp=e.value.startAndEndSendSourceIp[0]||null,e.value.endSIp=e.value.startAndEndSendSourceIp[1]||null):(e.value.startSIp=null,e.value.endSIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=void 0,e.value.endSourceIp=void 0),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimIp=void 0,e.value.endAimIp=void 0),e.value.startSIp&&!N(e.value.startSIp)||e.value.startSourceIp&&!N(e.value.startSourceIp)||e.value.startAimIp&&!N(e.value.startAimIp))return(p=window.$message)==null||p.destroyAll(),(n=window.$message)==null||n.error("请输入正确的IP地址"),!1;if(e.value.endSIp&&!N(e.value.endSIp)||e.value.endSourceIp&&!N(e.value.endSourceIp)||e.value.endAimIp&&!N(e.value.endAimIp))return(r=window.$message)==null||r.destroyAll(),(s=window.$message)==null||s.error("请输入正确的IP地址"),!1;if(e.value.startSIp&&e.value.endSIp&&H(e.value.startSIp,e.value.endSIp)>0)return(t=window.$message)==null||t.destroyAll(),($=window.$message)==null||$.error("发生源起始IP不能大于发生源终止IP"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&H(e.value.startSourceIp,e.value.endSourceIp)>0)return(M=window.$message)==null||M.destroyAll(),(O=window.$message)==null||O.error("源起始IP不能大于源终止IP"),!1;if(e.value.startAimIp&&e.value.endAimIp&&H(e.value.startAimIp,e.value.endAimIp)>0)return(L=window.$message)==null||L.destroyAll(),(R=window.$message)==null||R.error("目的起始IP不能大于目的终止IP"),!1;A("search")}const u=p=>{e.value.ectgr=p,A("search")},d=ke.debounce(g,1e3,{leading:!0,trailing:!1});return(p,n)=>{const r=$e,s=Pe,t=fe,$=ge,M=Ne,O=Ce,L=G,R=Ee,oe=J,se=Le,ie=_e,re=Y,ue=pe("no-space");return V(),X(re,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[a(ie,{ref_key:"formRef",ref:E,model:e.value,"label-placement":"left","label-width":x(v).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:ve(x(d),["enter"])},{default:l(()=>[a(se,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:l(()=>[a(s,{span:"24 s:12 m:8 l:6",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:l(()=>[a(r,{value:e.value.lsid,"onUpdate:value":[n[0]||(n[0]=_=>e.value.lsid=_),g],placeholder:"请选择日志源设备",options:m.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),a(s,{span:"24 s:12 m:8 l:6",label:"事件名称",path:"fuzzy",class:"pr-24px"},{default:l(()=>[ce(a(t,{value:e.value.fuzzy,"onUpdate:value":n[1]||(n[1]=_=>e.value.fuzzy=_),placeholder:"请输入事件名称",clearable:"",onClear:z},null,8,["value"]),[[ue]])]),_:1}),a(s,{span:"24 s:12 m:8 l:6",label:"事件类型",path:"etype",class:"pr-24px"},{default:l(()=>[a($,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.etype,"onUpdate:value":[n[2]||(n[2]=_=>e.value.etype=_),g],"value-field":"id","label-field":"pname",options:b.eventsTypeDataList},null,8,["value","options"])]),_:1}),a(s,{span:"24 s:12 m:8 l:6",label:"事件类别",path:"ectgr",class:"pr-24px"},{default:l(()=>[a($,{filterable:"",clearable:"",placeholder:"请选择事件类别",value:e.value.ectgr,"onUpdate:value":[n[3]||(n[3]=_=>e.value.ectgr=_),u],options:b.eventsCategoryData},null,8,["value","options"])]),_:1}),a(s,{span:"24 s:12 m:10 l:8",label:"发生源IP",path:"startAndEndSendSourceIp",class:"pr-24px"},{default:l(()=>[a(t,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSendSourceIp,"onUpdate:value":n[4]||(n[4]=_=>e.value.startAndEndSendSourceIp=_),onClear:c},null,8,["value"])]),_:1}),a(s,{span:"24 s:12 m:10 l:8",label:"源IP",path:"startAndEndSourceIp",class:"pr-24px"},{default:l(()=>[a(t,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":n[5]||(n[5]=_=>e.value.startAndEndSourceIp=_),onClear:i},null,8,["value"])]),_:1}),a(s,{span:"24 s:12 m:10 l:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px"},{default:l(()=>[a(t,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":n[6]||(n[6]=_=>e.value.startAndEndAimSourceIp=_),onClear:o},null,8,["value"])]),_:1}),a(s,{span:"24 s:12 m:10 l:8",label:"产生时间",path:"timeRange",class:"pr-24px"},{default:l(()=>[a(M,{clearable:"",value:e.value.timeRange,"onUpdate:value":n[7]||(n[7]=_=>e.value.timeRange=_),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":w},null,8,["value"])]),_:1}),a(s,{span:"24 s:12 m:10 l:6",class:"pr-24px"},{default:l(()=>[a(oe,{class:"w-full",align:"center"},{default:l(()=>[a(L,{onClick:P},{icon:l(()=>[a(O,{class:"text-icon"})]),default:l(()=>[f(" "+h(x(U)("common.reset")),1)]),_:1}),a(L,{type:"primary",ghost:"",onClick:x(d)},{icon:l(()=>[a(R,{class:"text-icon"})]),default:l(()=>[f(" "+h(x(U)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width","onKeyup"])]),_:1})}}}),ne=y=>(xe("data-v-c879b29f"),y=y(),Ae(),y),Je=ne(()=>te("span",null,"基本信息",-1)),Ke=ne(()=>te("span",null,"原始日志信息",-1)),We={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"480px"}},qe={key:1,class:"h-500px"};function Qe(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Ie(y)}const Ze=F({__name:"detailInfo",props:q({detailInfo:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(y){const k=Z(y,"detailVisible"),A=y,v=S();he(()=>k.value,async i=>{i&&(v.value=A.detailInfo,await m(),C())});const E=[{title:"",key:"index",width:50,render:(i,c)=>`${c+1}`},{key:"osubject",title:"事件主体",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"oobject",title:"事件客体",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"odescribe",title:"事件描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"oresult",title:"事件结果",align:"center",width:180,ellipsis:{tooltip:!0},render:i=>{var c,o;return a(K,{size:"small",type:(c=i.oresult)!=null&&c.includes("成功")?"success":(o=i.oresult)!=null&&o.includes("失败")?"error":"warning"},{default:()=>[i.oresult]})}},{key:"level",title:"安全级别",align:"center",width:120,render:i=>{const c=Ge[i.level];let o={color:W[i.level],textColor:"#ffffff",borderColor:W[i.level]};return a(K,{size:"small",color:o},Qe(c)?c:{default:()=>[c]})}},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:140},{key:"sourceip",title:"发生源IP",align:"center",width:120},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"operate",title:U("common.operate"),align:"center",width:80,fixed:"right",render:i=>a("div",{class:"flex-center gap-8px"},[a(G,{type:"info",ghost:!0,size:"small",onClick:()=>P(i)},{default:()=>[f("详情")]})])}],I=S(!1);let e=S([]);const m=async i=>{var g;if(!I.value)I.value=!0;else return;const{data:c,error:o}=await Ve({aggid:(g=v.value)==null?void 0:g.aggid,limit:20,pageId:i});o||(I.value=!1,i?e.value=[...e.value,...c]:e.value=c)},C=async()=>{var i,c,o;e.value.length<450/44&&e.value.length<((i=v.value)==null?void 0:i.aggre)&&m(((o=(c=e.value)==null?void 0:c[e.value.length-1])==null?void 0:o.id)??void 0)};function b(i){var o;Math.abs(i.target.scrollTop+i.target.offsetHeight-i.target.scrollHeight)<=20&&((o=v.value)==null?void 0:o.aggre)>e.value.length&&D()}const D=le.debounce(()=>{m(e.value[e.value.length-1].id)},300),T=B({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:i,endIndex:c,page:o,pageSize:g,pageCount:u,itemCount:d}){var p;return`已加载${e.value.length}条 共计${(p=v.value)==null?void 0:p.aggre} 条`}}),z=S(!1),w=S(),P=async i=>{z.value=!0,w.value=i};return(i,c)=>{const o=He,g=je,u=J,d=ye,p=ee,n=Se,r=we,s=be;return V(),X(s,{show:k.value,"onUpdate:show":c[1]||(c[1]=t=>k.value=t),title:"事件详情",preset:"card",class:"w-1000px"},{default:l(()=>[a(r,{class:"max-h-600px pr-20px"},{default:l(()=>[a(n,{type:"line",animated:""},{default:l(()=>[a(d,{name:"1"},{tab:l(()=>[Je]),default:l(()=>[a(u,{vertical:"",size:12},{default:l(()=>[a(g,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:l(()=>[a(o,{label:"事件名称"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.ename),1)]}),_:1}),a(o,{label:"事件类型"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.pname1),1)]}),_:1}),a(o,{label:"事件类别"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.pname2),1)]}),_:1}),a(o,{label:"日志源设备"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.type),1)]}),_:1}),a(o,{label:"聚合开始时间"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.aggrestarttime),1)]}),_:1}),a(o,{label:"聚合结束时间"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.aggreendtime),1)]}),_:1}),a(o,{label:"聚合数量"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.aggre),1)]}),_:1}),a(o,{label:"发生源IP"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.sip),1)]}),_:1}),a(o,{label:"源IP"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.sourceip),1)]}),_:1}),a(o,{label:"源端口"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.sourceport),1)]}),_:1}),a(o,{label:"目的IP"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.aimip),1)]}),_:1}),a(o,{label:"目的端口"},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.aimport),1)]}),_:1}),a(o,{label:"事件描述",span:3},{default:l(()=>{var t;return[f(h((t=v.value)==null?void 0:t.aimip),1)]}),_:1})]),_:1})]),_:1})]),_:1}),a(d,{name:"2"},{tab:l(()=>[Ke]),default:l(()=>[x(e).length==0?(V(),j("div",We," 暂无原始日志信息 ")):(V(),j("div",qe,[a(p,{columns:E,data:x(e),size:"small","row-key":t=>t.id,"virtual-scroll":"",class:"sm:h-full",pagination:T,onScroll:b,"scroll-x":E.reduce((t,$)=>t+$.width,0),loading:I.value,"max-height":480,remote:""},null,8,["data","row-key","pagination","scroll-x","loading"])])),a(Be,{detailVisible:z.value,"onUpdate:detailVisible":c[0]||(c[0]=t=>z.value=t),detailInfo:w.value},null,8,["detailVisible","detailInfo"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Xe=ae(Ze,[["__scopeId","data-v-c879b29f"]]),Ye={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},et=F({name:"eventalarm_eventalarm",__name:"index",setup(y){const k=Q(),A=S(window.innerHeight-306),v=S(!1),E=S(),I=B({pageId:void 0,limit:100,lsid:void 0,etype:void 0,ectgr:void 0,elevel:void 0,startSIp:void 0,endSIp:void 0,startSourceIp:void 0,endSourceIp:void 0,startAimIp:void 0,endAimIp:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),e=[{title:"",key:"index",width:80,align:"center",render:u=>`${u.index}`},{key:"pname1",title:"事件名称",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:160},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"sip",title:"发生源IP",align:"center",width:160},{key:"aggreendtime",title:"聚合结束时间",align:"center",width:160},{key:"operate",title:U("common.operate"),align:"center",width:100,fixed:"right",render:u=>a("div",{class:"flex-center gap-8px"},[a(G,{type:"primary",ghost:!0,size:"small",onClick:()=>o(u)},{default:()=>[f("查看")]})])}],m=S([]),C=S(!1),b=S(0),D=async(u=!1)=>{if(!C.value)C.value=!0;else return;const{data:d,error:p}=await Ue(I);p||(b.value=d.length,u?m.value=[...m.value,...d]:m.value=d,m.value=m.value.sort((n,r)=>r.id-n.id).map((n,r)=>(n.index=r+1,n)),C.value=!1)};D();const T=S(!0),z=()=>{m.value=[],I.pageId=void 0,(d=>Object.keys(d).filter(r=>r!=="limit"&&r!=="_t").some(r=>d[r]!==void 0&&d[r]!==""&&d[r]!==null))(I)?T.value=!1:(T.value=!0,P()),D()},w=B({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:u,endIndex:d,page:p,pageSize:n,pageCount:r,itemCount:s}){return`已加载${m.value.length}条`+(m.value.length?T.value?` 共计 ${m.value.length>0?s??0:0} 条`:b.value==I.limit?"  预计还有更多":"  没有更多了":"")}});async function P(){const{data:u,error:d}=await Me();d||(w.pageCount=20,w.total=Number(u),w.itemCount=Number(u))}P();function i(u){Math.abs(u.target.scrollTop+u.target.offsetHeight-u.target.scrollHeight)<=20&&w.total>m.value.length&&c()}const c=le.debounce(()=>{var u;((u=m.value)==null?void 0:u.length)<w.total&&(I.pageId=m.value[m.value.length-1].id,D(!0))},300);async function o(u){E.value=u,v.value=!0}async function g(){if(!m.value.length)return;const u=JSON.parse(JSON.stringify(m.value)),d=[];u.forEach(n=>{const r={};e.forEach(s=>{if(n.hasOwnProperty(s.key)){const t=s.key=="elevel"?n[s.key]!=null?U(Oe[n[s.key]]):"":n[s.key];r[s.title]=t}}),d.push(r)}),Re(d,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50},{wpx:100},{wpx:150}],"安全事件_"+new Date().getTime())}return(u,d)=>{const p=J,n=ee,r=Y;return V(),j("div",Ye,[a(Fe,{model:I,"onUpdate:model":d[0]||(d[0]=s=>I=s),onSearch:z},null,8,["model"]),a(r,{title:"安全事件",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[a(p,null,{default:l(()=>[a(x(G),{type:"primary",size:"small",ghost:"",onClick:g,title:"导出已加载"},{default:l(()=>[f("导出已加载")]),_:1})]),_:1})]),default:l(()=>[a(n,{columns:e,data:m.value,size:"small","flex-height":!x(k).isMobile,loading:C.value,remote:"","scroll-x":e.reduce((s,t)=>s+t.width,0),"row-key":s=>s.id,pagination:w,"virtual-scroll":"",onScroll:i,class:"sm:h-full","max-height":A.value},null,8,["data","flex-height","loading","scroll-x","row-key","pagination","max-height"])]),_:1}),a(Xe,{detailVisible:v.value,"onUpdate:detailVisible":d[1]||(d[1]=s=>v.value=s),detailInfo:E.value},null,8,["detailVisible","detailInfo"])])}}}),yt=ae(et,[["__scopeId","data-v-129a7765"]]);export{yt as default};
