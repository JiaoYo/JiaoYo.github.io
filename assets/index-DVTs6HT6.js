import{d as O,z as J,s as N,i as L,D as Q,A as W,E as H,b as y,o as _,f as a,w as s,h as e,b4 as X,b5 as j,M as C,L as U,N as p,J as Y,e as v,c as Z,G as ee,aQ as ae,az as le,d9 as se,t as f,aD as oe,g as b,$ as r,H as h,B as $,a2 as ne,a3 as te,a4 as re,ft as ue,aG as de,fu as pe,fv as ie,Q as ce,fw as me,W as fe}from"./index-CYM7WsrU.js";const we={class:"profile-wrapper"},_e={class:"avatar-wrapper group"},ve={key:1,class:"upload-wrapper"},ge={class:"font-size-16px"},ye={key:1,class:"c-#a19f9d"},be=O({name:"userinfo",__name:"index",setup(he){const k=J(),o=N({id:"",username:"",nickname:"",phnum:"",userimage:"",usertype:""}),I=async()=>{const{data:d,error:l}=await ue();l||Object.assign(o.value,d)};L(()=>{I()});async function A(d){var c,m,w;const l=d.file.file.size/1024/1024<100;return["image/jpeg","image/png","image/jpg","image/x-icon"].includes(d.file.file.type)?l?!0:((w=window.$message)==null||w.error("文件大小不能超过100M"),!1):((c=window.$message)==null||c.destroyAll(),(m=window.$message)==null||m.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1)}async function q({file:d}){var u,i,c;const l=await de(d.file,d.name,"");if(l){Object.prototype.hasOwnProperty.call(l,"result")?(u=window.$message)==null||u.destroyAll():console.log("文件上传成功");const{data:m,error:w}=await pe({id:o.value.id,image:l});w||((i=window.$message)==null||i.destroyAll(),(c=window.$message)==null||c.success("头像修改成功"),k.setUserImage(l),I())}}const P=N(!1),g=N({pwd:""}),R=async()=>{var u;const{data:d,error:l}=await ie({pwd:ce(g.value.pwd)});l||(S(),(u=window.$message)==null||u.success("解绑成功"))},z=()=>{P.value=!0,g.value.pwd=""},S=()=>{P.value=!1},n=Q(G());function G(){return{username:k.userInfo.username,pwd:"",newPwd:"",comfirmPassword:""}}const{formRef:M,validate:D}=W(),{createConfirmPwdRule:F,defaultRequiredRule:B,patternRules:V}=H(),T={pwd:B,newPwd:{...B,...V.password}};async function x(){var u,i;await D();const{data:d,error:l}=await me(n.username,n.pwd,n.newPwd,k.userInfo.id);l||((u=window.$message)==null||u.destroyAll(),(i=window.$message)==null||i.success("密码修改成功, 即将返回登录页"),setTimeout(()=>{k.resetStore()},1e3))}return(d,l)=>{const u=ae,i=le,c=se,m=Y,w=oe,E=te,K=re;return _(),y("div",we,[a(e(ne),{class:"card"},{default:s(()=>[a(e(X),{type:"segment",animated:""},{default:s(()=>[a(e(j),{name:"profile",tab:"个人中心"},{default:s(()=>[a(e(C),{model:o.value,"label-placement":"left",style:{width:"400px",margin:"20px auto 0"},"label-width":100,"require-mark-placement":"left",onKeyup:U(x,["enter"])},{default:s(()=>[a(e(p),{label:"头像"},{default:s(()=>[a(m,{justify:"center"},{default:s(()=>[v("div",_e,[o.value.userimage?(_(),Z(u,{key:0,src:o.value.userimage,class:"avatar-img","preview-disabled":""},null,8,["src"])):(_(),y("div",ve,[a(i,{ref:"uploadRef",action:"#","list-type":"picture-card","before-upload":A,"custom-request":q},{default:s(()=>l[7]||(l[7]=[v("div",{class:"upload-inner"},[v("span",null,"点击上传")],-1)])),_:1,__:[7]},512)])),o.value.userimage?(_(),y("div",{key:2,class:"avatar-overlay",onClick:l[0]||(l[0]=t=>o.value.userimage="")},[a(c,{class:"icon-close"})])):ee("",!0)])]),_:1})]),_:1}),a(e(p),{label:"用户名称：",path:"username"},{default:s(()=>[v("div",ge,f(o.value.username),1)]),_:1}),a(e(p),{label:"用户类型：",path:"usertype"},{default:s(()=>[a(w,{type:"info"},{default:s(()=>[b(f(o.value.usertype==0?"超级管理员":o.value.usertype==1?"销售":o.value.usertype==2?"项目负责人":o.value.usertype==3?"调试工程师":o.value.usertype==4?"综合管理":o.value.usertype==5?"研发工程师":o.value.usertype==6?"生产工程师":""),1)]),_:1})]),_:1}),a(e(p),{label:"联系方式：",path:"phnum"},{default:s(()=>[v("div",null,f(o.value.phnum),1)]),_:1}),a(e(p),{label:"微信昵称：",path:"nickname"},{default:s(()=>[v("div",null,[b(f(o.value.nickname)+" ",1),o.value.nickname?(_(),y("span",{key:0,class:"ml-20px cursor-pointer c-red",onClick:z},"解绑")):(_(),y("span",ye,"未绑定"))])]),_:1})]),_:1},8,["model"])]),_:1}),a(e(j),{name:"password",tab:"修改密码"},{default:s(()=>[a(e(C),{ref_key:"formRef",ref:M,model:n,rules:T,"label-placement":"left",style:{width:"400px",margin:"20px auto 0"},"label-width":100,"require-mark-placement":"left",onKeyup:U(x,["enter"])},{default:s(()=>[a(e(p),{label:e(r)("page.manage.user.username"),path:"username"},{default:s(()=>[a(e(h),{readonly:"",value:n.username,"onUpdate:value":l[1]||(l[1]=t=>n.username=t),placeholder:e(r)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(p),{label:e(r)("page.login.common.oldPassword"),path:"pwd"},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:n.pwd,"onUpdate:value":l[2]||(l[2]=t=>n.pwd=t),placeholder:e(r)("page.login.common.oldPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(p),{label:e(r)("page.login.common.password"),path:"newPwd"},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:n.newPwd,"onUpdate:value":l[3]||(l[3]=t=>n.newPwd=t),placeholder:e(r)("page.login.common.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e(p),{label:e(r)("page.login.common.confirmPassword"),path:"comfirmPassword",rule:e(F)(n.newPwd)},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:n.comfirmPassword,"onUpdate:value":l[4]||(l[4]=t=>n.comfirmPassword=t),placeholder:e(r)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rule"]),a(m,{justify:"center",size:16},{default:s(()=>[a(e($),{type:"primary",onClick:x},{default:s(()=>[b(f(e(r)("common.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),a(K,{show:P.value,"onUpdate:show":l[6]||(l[6]=t=>P.value=t),title:"解绑微信",preset:"card",class:"w-500px"},{footer:s(()=>[a(m,{justify:"end",size:16},{default:s(()=>[a(e($),{onClick:S},{default:s(()=>[b(f(e(r)("common.cancel")),1)]),_:1}),a(e($),{type:"primary",onClick:R},{default:s(()=>[b(f(e(r)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[a(E,null,{default:s(()=>[a(e(C),{ref_key:"formRef",ref:M,model:g.value,rules:T,"label-placement":"left","require-mark-placement":"left",onKeyup:U(R,["enter"])},{default:s(()=>[a(e(p),{label:e(r)("page.login.common.password"),path:"pwd"},{default:s(()=>[a(e(h),{type:"password","show-password-on":"click",clearable:"",value:g.value.pwd,"onUpdate:value":l[5]||(l[5]=t=>g.value.pwd=t),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}}),Pe=fe(be,[["__scopeId","data-v-b0d96528"]]);export{Pe as default};
