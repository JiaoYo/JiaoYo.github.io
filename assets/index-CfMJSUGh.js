import{_ as me}from"./round-add-CL2Vba1y.js";import{aW as q,d as Q,av as H,z as X,D as ae,A as le,a as fe,ax as Z,aJ as se,at as A,s as K,d3 as _e,c as I,o as y,w as o,f as n,e as _,a3 as ve,M as ee,N as re,h as e,H as E,az as ge,b as L,t as g,B as S,g as h,G as R,aA as ye,J as te,$ as O,a4 as be,aG as we,X as he,F as J,bn as xe,aL as V,aP as ke,b2 as Ce,I as G,L as ie,d4 as Se,aO as De,a_ as Ne,bp as ze,W as je,a2 as ce,au as $e,aS as Te,aE as Ue,aI as Le,i as Ie,aK as Y,cT as Pe,ay as Re,aQ as We}from"./index-BTeMkgsf.js";import{u as Fe,a as Me}from"./table-nKGzp9nE.js";import{_ as Be,a as Oe}from"./text-B_2dbn0D.js";import{N as de}from"./Popconfirm-BVBTnPX5.js";import{_ as qe}from"./round-search-D_VWcob1.js";import{u as Ee}from"./usePageData-BtaN_wXr.js";import{_ as Ge}from"./Grid-D1GO_CFb.js";import{_ as Ae}from"./FormItemGridItem-DlZX07SE.js";function Ke(c){return q({url:"/projectWeek/getPage.do",method:"get",params:c})}function Ve(c){return q({url:"/projectWeek/insert.do",method:"post",data:c})}function Je(c){return q({url:"/projectWeek/update.do",method:"put",data:c})}function He(c){return q({url:"/projectWeek/delete.do",method:"delete",params:{arrIds:c}})}function Qe(c){return q({url:"/projectWeekComment/getPage.do",method:"get",params:c})}function Xe(c){return q({url:"/projectWeekComment/insert.do",method:"post",data:c})}function Ye(c){return q({url:"/projectWeekComment/delete.do",method:"delete",params:{arrIds:c}})}const Ze={key:0,class:""},et={key:1,class:"flex items-center w-300px"},tt={class:"mt-10px"},nt=Q({name:"OperateDrawer",__name:"operate-drawer",props:H({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(c,{emit:F}){X();const l=F,D=c,t=ae(x());function x(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",charctras:"",file1:"",file2:""}}const W={content1:{required:!0,message:"请输入",trigger:"blur"}};async function N(){Object.assign(t,x()),D.operateType==="edit"&&D.rowData&&Object.assign(t,D.rowData)}const{formRef:b,validate:M,restoreValidation:$}=le(),w=fe(()=>({add:"新增项目周报",edit:"修改项目周报"})[D.operateType]),f=Z(c,"visible"),j=()=>{f.value=!1},P=se.debounce(async()=>{var m,s,i;if(await M(),t.charctras<30)return(m=window.$message)==null?void 0:m.warning("字数不能少于30字,请继续填写");if(D.operateType==="edit"){const{data:C,error:z}=await Je([{...t}]);z||((s=window.$message)==null||s.success("修改成功"),l("submitted"),j())}else{const{data:C,error:z}=await Ve([{pid:t.pid,content1:t.content1,content2:t.content2,content3:t.content3,content4:t.content4,content5:t.content5,file1:t.file1,file2:t.file2,charctras:t.charctras}]);z||((i=window.$message)==null||i.success("添加成功"),l("submitted"),j())}},1e3,{leading:!0,trailing:!1});A(f,()=>{f.value&&(N(),setTimeout(()=>{const m=document.querySelector(".n-scrollbar-content");m==null||m.scrollTo(0,0)},300),$())});const u=K([]),a=K(0);async function v({file:m},s){const i=await we(m.file,m.name,"",C=>{s=="file2"&&(a.value=C)});i&&(s=="file1"?t.value.file1=i:t.value.file2=i,a.value=0)}async function k(m,s){var i,C,z;return s=="file1"&&!["image/jpeg","image/png","image/jpg","image/x-icon"].includes(m.file.file.type)?((i=window.$message)==null||i.destroyAll(),(C=window.$message)==null||C.error("只能上传 JPG/PNG/JPEG/ICO 格式的图片"),!1):m.file.file.size>100*1024*1024?((z=window.$message)==null||z.error("文件大小不能超过100M"),!1):!0}return A(()=>[t.content1,t.content2,t.content3,t.content4,t.content5],()=>{t.charctras=_e(t.content1+t.content2+t.content3+t.content4+t.content5)},{immediate:!0}),(m,s)=>{const i=re,C=ge,z=ye,B=ee,r=ve,p=te,T=be;return y(),I(T,{show:f.value,"onUpdate:show":s[9]||(s[9]=d=>f.value=d),title:w.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:o(()=>[n(p,{justify:"end"},{default:o(()=>[n(e(S),{size:"small",class:"mt-16px",onClick:j},{default:o(()=>[h(g(e(O)("common.cancel")),1)]),_:1}),n(e(S),{type:"primary",size:"small",class:"mt-16px",onClick:e(P)},{default:o(()=>[h(g(e(O)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:o(()=>[n(r,{style:{height:"70vh","padding-right":"10px"}},{default:o(()=>[n(B,{ref_key:"formRef",ref:b,model:t,rules:W},{default:o(()=>[n(i,{label:"本周完成",path:"content1"},{default:o(()=>[n(e(E),{clearable:"",type:"textarea",rows:3,value:t.content1,"onUpdate:value":s[0]||(s[0]=d=>t.content1=d),placeholder:"请输入内容"},null,8,["value"])]),_:1}),n(i,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{default:o(()=>[n(e(E),{clearable:"",type:"textarea",rows:2,value:t.content2,"onUpdate:value":s[1]||(s[1]=d=>t.content2=d),placeholder:"请输入内容"},null,8,["value"])]),_:1}),n(i,{label:"未完成项目",path:"content3"},{default:o(()=>[n(e(E),{clearable:"",type:"textarea",rows:2,value:t.content3,"onUpdate:value":s[2]||(s[2]=d=>t.content3=d),placeholder:"请输入内容"},null,8,["value"])]),_:1}),n(i,{label:"下周计划",path:"content4"},{default:o(()=>[n(e(E),{clearable:"",type:"textarea",rows:2,value:t.content4,"onUpdate:value":s[3]||(s[3]=d=>t.content4=d),placeholder:"请输入内容"},null,8,["value"])]),_:1}),n(i,{label:"需协调与帮助",path:"content5"},{default:o(()=>[n(e(E),{clearable:"",type:"textarea",rows:2,value:t.content5,"onUpdate:value":s[4]||(s[4]=d=>t.content5=d),placeholder:"请输入内容"},null,8,["value"])]),_:1}),n(i,{label:"图片:",path:"file1"},{default:o(()=>[n(C,{ref:"uploadRef",action:"#","list-type":"image-card","default-upload":!1,max:1,"file-list":u.value,"onUpdate:fileList":s[5]||(s[5]=d=>u.value=d),"custom-request":d=>v(d,"file1"),onBeforeUpload:s[6]||(s[6]=d=>k(d,"file1"))},null,8,["file-list","custom-request"])]),_:1}),n(i,{label:"附件:",path:"file2"},{default:o(()=>[t.file2?(y(),L("div",Ze,[_("span",null,g(t.file2.split("?")[1]),1),n(e(S),{text:"",type:"error",onClick:s[7]||(s[7]=d=>t.file2="")},{default:o(()=>s[10]||(s[10]=[h("删除")])),_:1,__:[10]})])):(y(),L("div",et,[n(C,{ref:"uploadRef",action:"#","show-file-list":!1,"custom-request":d=>v(d,"file2"),onBeforeUpload:s[8]||(s[8]=d=>k(d,"file2"))},{default:o(()=>[n(e(S),{loading:a.value>0&&!t.file2},{default:o(()=>[h(g(a.value>0&&!t.file2?"上传中":"上传文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"]),a.value&&!t.file2?(y(),I(z,{key:0,type:"line",percentage:a.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):R("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1}),_("div",tt,"字数："+g(t.charctras),1)]),_:1},8,["show","title"])}}}),ot={key:1,class:"mt-3 mb-3 text-gray-700 preview-text"},at={key:0,class:"mt-3 mb-3 text-gray-700 preview-text"},lt={class:"font-size-12px c-#a19f9d my-5px"},st={key:0},rt={class:"mt-4 border-t pt-3"},it={class:"flex items-start gap-2 mb-3"},ct={class:"ml-2 flex-1"},dt={class:"flex items-center"},ut={class:"font-medium font-size-16px font-bold"},pt={class:"text-gray-600 mt-1"},mt=Q({name:"drawerLog",__name:"drawerLog",props:H({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(c){const F=X();he();let l=ae({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:0});const D=c,t={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},x=K({});async function W(){N.value=[],Object.assign(l,D.rowData),w()}const N=K([]),b=Z(c,"visible");A(b,()=>{b.value?W():(N.value=[],l.id=void 0)}),A(()=>D.rowData,()=>{b.value&&W()});function M(u){u||$()}function $(){b.value=!1}const w=async()=>{const{data:u,error:a}=await Qe({page:1,limit:100,pid:l.id});u&&(N.value=u.list)},f=se.debounce(async()=>{var k;const u=x.value[l.id];if(!(u!=null&&u.trim()))return(k=window.$message)==null?void 0:k.warning("请输入评论内容");const{data:a,error:v}=await Xe([{pid:l.id,content:u}]);a&&(x.value[l.id]="",l.num++,w())},1e3,{leading:!0,trailing:!1}),j=async u=>{const{data:a,error:v}=await Ye(u.id);a&&(w(),l.num--,console.log("删除成功"))};async function P(u){if(!u)return;const a=u.split("?")[0],v=u.split("?")[1];try{const m=await(await fetch(a,{mode:"cors"})).blob(),s=URL.createObjectURL(m),i=document.createElement("a");i.href=s,i.download=v,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}catch(k){console.error("下载失败:",k)}}return(u,a)=>{const v=re,k=ke,m=ee,s=Be,i=Oe,C=xe,z=ze,B=J("no-auth");return y(),I(z,{show:b.value,"onUpdate:show":[a[3]||(a[3]=r=>b.value=r),M],"display-directive":"show",width:600,onMaskClick:$,onEsc:$},{default:o(()=>[n(C,{title:e(l).username+"的项目周报","native-scrollbar":!1,closable:""},{default:o(()=>[n(m,{ref:"formRef",model:e(l),"show-feedback":!1},{default:o(()=>[n(v,{label:"本周完成",path:"content1"},{label:o(()=>a[4]||(a[4]=[_("div",{class:"font-size-16px font-bold"},"本周完成",-1)])),default:o(()=>[_("span",{class:V(["preview-text",{textstyle:e(l).content1}])},g(e(l).content1),3)]),_:1}),n(v,{label:"本周对你帮助最大的人，具体描述一下对你的帮助",path:"content2"},{label:o(()=>a[5]||(a[5]=[_("div",{class:"font-size-16px font-bold"},"本周对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:o(()=>[_("span",{class:V(["preview-text",{textstyle:e(l).content2}])},g(e(l).content2),3)]),_:1}),n(v,{label:"未完成项目",path:"content3"},{label:o(()=>a[6]||(a[6]=[_("div",{class:"font-size-16px font-bold"},"未完成项目",-1)])),default:o(()=>[_("span",{class:V(["preview-text",{textstyle:e(l).content3}])},g(e(l).content3),3)]),_:1}),n(v,{label:"下周计划",path:"content4"},{label:o(()=>a[7]||(a[7]=[_("div",{class:"font-size-16px font-bold"},"下周计划",-1)])),default:o(()=>[_("span",{class:V(["preview-text",{textstyle:e(l).content4}])},g(e(l).content4),3)]),_:1}),n(v,{label:"需协调与帮助",path:"content5"},{label:o(()=>a[8]||(a[8]=[_("div",{class:"font-size-16px font-bold"},"需协调与帮助",-1)])),default:o(()=>[_("span",{class:V(["preview-text",{textstyle:e(l).content5}])},g(e(l).content5),3)]),_:1}),n(v,{label:"图片",path:"content5"},{label:o(()=>a[9]||(a[9]=[_("div",{class:"font-size-16px font-bold"},"图片",-1)])),default:o(()=>{var r;return[e(l).file1?(y(),I(k,{key:0,width:"80",height:"80",src:e(l).file1,class:"rounded-md object-cover"},null,8,["src"])):R("",!0),e(l).file1?(y(),L("div",ot,[h(g((r=e(l).file1)==null?void 0:r.split("?")[1])+" ",1),n(e(S),{text:"",type:"primary",size:"small",onClick:a[0]||(a[0]=p=>P(e(l).file1))},{default:o(()=>a[10]||(a[10]=[h("下载")])),_:1,__:[10]})])):R("",!0)]}),_:1}),n(v,{label:"附件",path:"content5"},{label:o(()=>a[11]||(a[11]=[_("div",{class:"font-size-16px font-bold"},"附件",-1)])),default:o(()=>{var r;return[e(l).file2?(y(),L("div",at,[h(g((r=e(l).file2)==null?void 0:r.split("?")[1])+" ",1),n(e(S),{text:"",type:"primary",size:"small",onClick:a[1]||(a[1]=p=>P(e(l).file2))},{default:o(()=>a[12]||(a[12]=[h("下载")])),_:1,__:[12]})])):R("",!0)]}),_:1}),_("div",lt,"字符数："+g(e(l).charctras),1)]),_:1},8,["model"]),e(l).num?(y(),L("div",st,g(e(l).num)+"评论",1)):R("",!0),n(Ce,{name:"fade"},{default:o(()=>[_("div",rt,[G((y(),L("div",it,[_("div",null,[n(s,{size:"small",src:t.avatar},null,8,["src"])]),n(e(E),{type:"textarea",id:`comment-input-${e(l).id}`,value:x.value[e(l).id],"onUpdate:value":a[2]||(a[2]=r=>x.value[e(l).id]=r),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ie(Se(e(f),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),n(e(S),{type:"primary",ghost:"",onClick:e(f)},{default:o(()=>a[13]||(a[13]=[h("发送")])),_:1,__:[13]},8,["onClick"])])),[[B,"project:Summary:Comment:insert"]]),(y(!0),L(De,null,Ne(N.value,r=>(y(),L("div",{key:r.id,class:"flex mb-3"},[n(s,{size:"small",src:t.avatar},null,8,["src"]),_("div",ct,[_("div",dt,[_("span",ut,g(r.username),1),n(i,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:o(()=>[h(g(r.dbtime),1)]),_:2},1024),e(F).userInfo.id==r.creater?(y(),I(e(de),{key:0,onPositiveClick:p=>j(r)},{trigger:o(()=>[G((y(),I(e(S),{quaternary:"",type:"error",size:"small"},{default:o(()=>a[14]||(a[14]=[h(" 删除 ")])),_:1,__:[14]})),[[B,"project:Summary:Comment:delete"]])]),default:o(()=>[a[15]||(a[15]=h(" 确定删除吗？ "))]),_:2,__:[15]},1032,["onPositiveClick"])):R("",!0)]),_("div",pt,g(r.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),ft=je(mt,[["__scopeId","data-v-ffa4cf32"]]),_t=Q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:H(["reset","search","clear"],["update:model"]),setup(c,{emit:F}){const l=F,{formRef:D}=le(),t=Z(c,"model");X();const{pageData:x,getData:W,nextPage:N}=Ee(Te),b=async w=>{const f=w.currentTarget,j=f.scrollTop;f.scrollTop+f.offsetHeight>=f.scrollHeight&&x.data.length<x.total&&(await N(),await Ue(),setTimeout(()=>{f.scrollTop=j}))},M=async w=>{t.value.creater=w,l("search")};W({usertypes:"2,3"});async function $(){l("search")}return(w,f)=>{const j=$e,P=Ae,u=qe,a=S,v=te,k=Ge,m=ee,s=ce;return y(),I(s,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[n(m,{ref_key:"formRef",ref:D,model:t.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ie($,["enter"])},{default:o(()=>[n(k,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[n(P,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:o(()=>[n(j,{clearable:"",filterable:"",value:t.value.creater,"onUpdate:value":[f[0]||(f[0]=i=>t.value.creater=i),M],placeholder:"请选择","label-field":"username","value-field":"id",options:e(x).data,onScroll:b},null,8,["value","options"])]),_:1}),n(P,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[n(v,{class:"w-full"},{default:o(()=>[n(a,{type:"primary",ghost:"",onClick:$},{icon:o(()=>[n(u,{class:"text-icon"})]),default:o(()=>[h(" "+g(e(O)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),vt={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},gt={key:0};function oe(c){return typeof c=="function"||Object.prototype.toString.call(c)==="[object Object]"&&!We(c)}const Nt=Q({name:"projectmanagement_memberlog",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(c,{emit:F}){const l=Le(),D=X(),t=c,x=F,{columns:W,data:N,getData:b,loading:M,mobilePagination:$,searchParams:w}=Fe({showTotal:!0,immediate:!0,apiFn:Ke,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:r=>n("div",null,[r.username+"的项目周报"])},{key:"charctras",title:"字数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:O("common.operate"),align:"center",width:140,fixed:"right",render:r=>{let p;return n("div",{class:"flex-center gap-8px"},[n(S,{type:"primary",ghost:!0,size:"small",onClick:()=>z(r)},{default:()=>[h("查看详情")]}),D.userInfo.id==r.creater&&G(n(S,{type:"primary",ghost:!0,size:"small",onClick:()=>s(r.id)},oe(p=O("common.edit"))?p:{default:()=>[p]}),[[J("no-auth"),"project:Summary:update"]]),D.userInfo.id==r.creater&&n(de,{onPositiveClick:()=>m(r.id)},{default:()=>O("common.confirmDelete"),trigger:()=>{let T;return G(n(S,{type:"error",ghost:!0,size:"small"},oe(T=O("common.delete"))?T:{default:()=>[T]}),[[J("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:f,operateType:j,editingData:P,handleAdd:u,handleEdit:a,checkedRowKeys:v,onDeleted:k}=Me(N,b);async function m(r){const{data:p,error:T}=await He(r);T||k()}function s(r){a(r)}const i=K(!1),C=K({}),z=r=>{i.value=!0,C.value=r},B=()=>{b()};return A(()=>t.pid,async r=>{r&&(w.pid=r,await b())}),A(()=>N.value,async r=>{r.length>0?x("thereIsData",1):x("thereIsData",0)}),Ie(()=>{t.type!="externalLiaison"}),(r,p)=>{const T=te,d=me,ue=Re,pe=ce,ne=J("no-auth");return y(),L("div",vt,[t.pid?R("",!0):(y(),I(_t,{key:0,model:e(w),"onUpdate:model":p[0]||(p[0]=U=>Y(w)?w.value=U:null),onReset:B,onSearch:e(b),onClear:p[1]||(p[1]=U=>N.value=[])},null,8,["model","onSearch"])),n(pe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Pe({header:o(()=>[n(T,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>[t.pid?R("",!0):(y(),L("div",gt,"项目周报"))]),_:1}),t.pid?G((y(),I(e(S),{key:0,onClick:e(u),size:"small",ghost:"",type:"primary"},{icon:o(()=>[n(d,{class:"text-icon"})]),default:o(()=>[p[5]||(p[5]=h(" "+g("新增")))]),_:1,__:[5]},8,["onClick"])),[[ne,"project:Summary:insert"]]):R("",!0)]),default:o(()=>[n(ue,{"checked-row-keys":e(v),"onUpdate:checkedRowKeys":p[2]||(p[2]=U=>Y(v)?v.value=U:null),columns:e(W),data:e(N),size:"small","flex-height":!e(l).isMobile,loading:e(M),remote:"","row-key":U=>U.id,pagination:e($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),n(nt,{visible:e(f),"onUpdate:visible":p[3]||(p[3]=U=>Y(f)?f.value=U:null),onSubmitted:e(b),"operate-type":e(j),pid:t.pid||e(w).pid,"row-data":e(P)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),n(ft,{visible:i.value,"onUpdate:visible":p[4]||(p[4]=U=>i.value=U),"row-data":C.value},null,8,["visible","row-data"])]),_:2},[t.pid?void 0:{name:"header-extra",fn:o(()=>[n(T,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[G((y(),I(e(S),{onClick:e(u),size:"small",ghost:"",type:"primary"},{icon:o(()=>[n(d,{class:"text-icon"})]),default:o(()=>[p[6]||(p[6]=h(" "+g("新增")))]),_:1,__:[6]},8,["onClick"])),[[ne,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{Nt as default};
