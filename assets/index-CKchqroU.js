import{d as j,m as $,a as q,bC as de,bD as ue,ab as F,o as P,b as Q,t as f,ag as pe,bE as fe,c as U,w as o,g as l,e as N,ae as me,a4 as ge,f as ae,bF as _e,aH as ve,a6 as se,af as he,k as be,_ as K,v as we,a0 as Z,bG as R,bH as D,ai as ye,z as xe,aj as Se,r as De,A as Ce,J as ke,b1 as te,b2 as $e,b3 as Te,aD as Me,h,bI as Ie,a$ as V,bJ as Ne,S as Pe,ak as We,R as Oe,p as Ae,i as Be}from"./index-CZdyMK6E.js";import{_ as oe,a as ne}from"./Grid-CFTCc883.js";import{u as le,L as B}from"./echarts-C8cHILbU.js";import{h as Ge}from"./permission-bCueyuXi.js";import{G as ze,h as Le,a as Ee,b as Ve}from"./metar-CI3llg0u.js";import{_ as Re,a as Fe}from"./DescriptionsItem-BBEc7vbw.js";const je="/assets/station-GwqcmkHc.jpeg",He=j({name:"CountTo",__name:"count-to",props:{startValue:{default:0},endValue:{default:2021},duration:{default:1500},autoplay:{type:Boolean,default:!0},decimals:{default:0},prefix:{default:""},suffix:{default:""},separator:{default:","},decimal:{default:"."},useEasing:{type:Boolean,default:!0},transition:{default:"linear"}},setup(x){const a=x,m=$(a.startValue),c=q(()=>a.useEasing?de[a.transition]:void 0),C=ue(m,{disabled:!1,duration:a.duration,transition:c.value}),u=q(()=>g(C.value));function g(p){const{decimals:b,decimal:e,separator:t,suffix:s,prefix:n}=a;let S=p.toFixed(b);S=String(S);const T=S.split(".");let W=T[0];const M=T.length>1?e+T[1]:"",L=/(\d+)(\d{3})/;if(t)for(;L.test(W);)W=W.replace(L,`$1${t}$2`);return n+W+M+s}async function k(){await pe(),m.value=a.endValue}return F([()=>a.startValue,()=>a.endValue],()=>{a.autoplay&&k()},{immediate:!0}),(p,b)=>(P(),Q("span",null,f(u.value),1))}}),Je={class:"ml-20px"},Ue={class:"text-14px"},qe=j({name:"CardData",__name:"card-data",props:{MeteorologicalData:{type:Object}},setup(x){const a=x,m=q(()=>{var g,k,p,b,e,t;return[{key:"envT",title:"温度",value:((g=a.MeteorologicalData)==null?void 0:g.envT)||0,unit:"℃",color:{start:"#fdd819",end:"#e80505"},icon:"carbon:temperature-celsius"},{key:"envH",title:"湿度",value:((k=a.MeteorologicalData)==null?void 0:k.envH)||0,unit:"%",color:{start:"#97abff",end:"#123597"},icon:"lets-icons:humidity"},{key:"qy",title:"气压",value:((p=a.MeteorologicalData)==null?void 0:p.qy)||0,unit:"hPa",color:{start:"#70f570",end:"#49c628"},icon:"mdi:car-brake-low-pressure"},{key:"windS",title:"风速",value:((b=a.MeteorologicalData)==null?void 0:b.windS)||0,unit:"m/s",color:{start:"#ffe985",end:"#fa742b"},icon:"hugeicons:slow-winds"},{key:"windD",title:"风向",value:((e=a.MeteorologicalData)==null?void 0:e.windD)||0,unit:"°",color:{start:"#bbd2c5",end:"#536976"},icon:"mdi:windsock"},{key:"zfsdCount",title:"总辐射",value:((t=a.MeteorologicalData)==null?void 0:t.zfsd)||0,unit:"W/㎡",color:{start:"#ce9ffc",end:"#7367f0"},icon:"material-symbols:clear-day-rounded"}]}),[c,C]=fe();function u(g){return`linear-gradient(to bottom right, ${g.start}, ${g.end})`}return(g,k)=>{const p=be,b=He,e=ne,t=oe,s=se;return P(),U(s,{bordered:!1,size:"small",class:"card-wrapper h-100%","content-style":{padding:"20px 12px",display:"flex",flexDirection:"column",justifyContent:"center"}},{default:o(()=>[l(ae(c),null,{default:o(({$slots:n,gradientColor:S})=>[N("div",{class:"rd-8px pl-15px pb-4px pt-8px text-white",style:ge({backgroundImage:S})},[(P(),U(me(n.default)))],4)]),_:1}),l(t,{cols:"s:1 m:1 l:2",responsive:"screen","x-gap":10,"y-gap":12},{default:o(()=>[(P(!0),Q(ve,null,_e(m.value,(n,S)=>(P(),U(e,{key:n.key,class:he("animated-fade-up-"+S)},{default:o(()=>[l(ae(C),{"gradient-color":u(n.color),class:"flex-1 flex items-center h-100%",style:{"max-height":"75px !important"}},{default:o(()=>[l(p,{icon:n.icon,class:"text-32px"},null,8,["icon"]),N("div",Je,[N("h3",Ue,f(n.title),1),l(b,{suffix:n.unit,decimals:1,"start-value":1,"end-value":n.value,class:"text-16px text-white dark:text-dark"},null,8,["suffix","end-value"])])]),_:2},1032,["gradient-color"])]),_:2},1032,["class"]))),128))]),_:1})]),_:1})}}}),Qe=K(qe,[["__scopeId","data-v-5da89340"]]),Ke=j({name:"LineChart",__name:"line-chart",props:{data:{required:!0},dataModifiers:{}},emits:["update:data"],setup(x){const a=["rgb(233, 4, 69)","rgb(0, 150, 136)","rgb(59, 66, 146)","rgb(255, 99, 71)"],m=we(x,"data"),c=Z(),{domRef:C,updateOptions:u,updateOptionsAsync:g}=le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function(e){var s,n,S,T;const t=e[0];return console.log(e,"params"),`
        ${t.axisValue||""}<br/>
        <span class="round" style="background-color: ${a[0]}"></span> 实际功率: ${R((s=t.data)==null?void 0:s.power," MW")}<br/>
        <span  class="round" style="background-color: ${a[1]}"></span> 预测功率: ${R((n=t.data)==null?void 0:n.prePower," MW")}<br/>
        <span  class="round" style="background-color: ${a[2]}"></span> 实际辐射:  ${R((S=t.data)==null?void 0:S.zfsd," W/m^2")}<br/>
        <span  class="round" style="background-color: ${a[3]}"></span> 预测辐射:  ${R((T=t.data)==null?void 0:T.ssrd," W/m^2")}<br/>
        `},backgroundColor:"#6a7985",textStyle:{color:"#fff"}},legend:{data:["实际功率","预测功率","实际辐射","预测辐射"]},grid:{left:"2%",right:"5%",bottom:"0%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:[{name:"功率MW",type:"value",axisLabel:{formatter:"{value} MW"}},{name:"辐射W/m²",type:"value",axisLabel:{formatter:"{value} W/m²"}}],series:[{color:a[0],name:"实际功率",type:"line",emphasis:{focus:"series"},yAxisIndex:0,lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new B(0,0,0,1,[{offset:0,color:D(a[0],.3)},{offset:1,color:D(a[0],0)}],!1),shadowColor:D(a[0],.9),shadowBlur:20},data:[],connectNulls:!0},{color:a[1],name:"预测功率",type:"line",yAxisIndex:0,emphasis:{focus:"series"},lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new B(0,0,0,1,[{offset:0,color:D(a[1],.3)},{offset:1,color:D(a[1],0)}],!1),shadowColor:D(a[1],.9),shadowBlur:20},data:[],connectNulls:!0},{color:a[2],name:"实际辐射",type:"line",showSymbol:!1,yAxisIndex:1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new B(0,0,0,1,[{offset:0,color:D(a[2],.3)},{offset:1,color:D(a[2],0)}],!1),shadowColor:D(a[2],.7),shadowBlur:20},data:[],connectNulls:!0},{color:a[3],name:"预测辐射",type:"line",yAxisIndex:1,showSymbol:!1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new B(0,0,0,1,[{offset:0,color:D(a[3],.3)},{offset:1,color:D(a[3],0)}],!1),shadowColor:D(a[3],.7),shadowBlur:20},data:[],connectNulls:!0}]}));async function k(){await new Promise(e=>{setTimeout(e,1e3)}),u(e=>{if(m.value){const t=m.value.map(s=>({dbtime:s.dbtime,prePower:s.prePower,power:s.power,zfsd:s.zfsd,ssrd:s.ssrd}));e.xAxis.data=t.map(s=>s.dbtime),e.series[0].data=t.map(s=>({value:s.power,...s})),e.series[1].data=t.map(s=>({value:s.prePower,...s})),e.series[2].data=t.map(s=>({value:s.zfsd,...s})),e.series[3].data=t.map(s=>({value:s.ssrd,...s}))}return e})}F(()=>m.value,e=>{g(t=>{if(m.value){const s=m.value.map(n=>({dbtime:n.dbtime,prePower:n.prePower,power:n.power,zfsd:n.zfsd,ssrd:n.ssrd}));t.xAxis.data=s.map(n=>n.dbtime),t.series[0].data=s.map(n=>({value:n.prePower,...n})),t.series[1].data=s.map(n=>({value:n.power,...n})),t.series[2].data=s.map(n=>({value:n.zfsd,...n})),t.series[3].data=s.map(n=>({value:n.ssrd,...n}))}return t})});function p(){u((e,t)=>{const s=t();return e.legend.data=s.legend.data,e.series[0].name=s.series[0].name,e.series[1].name=s.series[1].name,e})}async function b(){k()}return F(()=>c.locale,()=>{p()}),b(),(e,t)=>(P(),Q("div",{ref_key:"domRef",ref:C,class:"h-100% overflow-hidden"},null,512))}}),Xe=K(Ke,[["__scopeId","data-v-7f07515f"]]),Ye=j({name:"LineChart",__name:"weather-chart",props:{data:{type:Array,default:[]}},setup(x){const a=x,m=Z(),{domRef:c,updateOptions:C,showLoading:u,updateOptionsAsync:g}=le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(e){return R(e,"°C")},backgroundColor:"#6a7985",textStyle:{color:"#fff"}},legend:{data:["环境温度","预测温度","组件温度"]},grid:{left:"2%",right:"2%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{name:"温度(°C)",type:"value",axisLabel:{formatter:"{value} °C"}},series:[{color:"#27ae60",name:"环境温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new B(0,0,0,1,[{offset:0,color:"rgba(39, 174, 96,0.4)"},{offset:1,color:"rgba(39, 174, 96,0)"}],!1),shadowColor:"rgba(39, 174, 96,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#c0392b",name:"预测温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new B(0,0,0,1,[{offset:0,color:"rgba(192, 57, 43,0.3)"},{offset:1,color:"rgba(192, 57, 43,0)"}],!1),shadowColor:"rgba(192, 57, 43,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#ffa000",name:"组件温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new B(0,0,0,1,[{offset:0,color:"rgba(255, 160, 0,0.3)"},{offset:1,color:"rgba(255, 160, 0,0)"}],!1),shadowColor:"rgba(255, 160, 0,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0}]}));async function k(){await new Promise(e=>{setTimeout(e,1e3)}),C(e=>(a.data&&(e.xAxis.data=a.data.map(t=>t.dbtime),e.series[0].data=a.data.map(t=>t.envT),e.series[1].data=a.data.map(t=>t.tt2),e.series[2].data=a.data.map(t=>t.moduleT)),e))}function p(){C((e,t)=>{const s=t();return e.legend.data=s.legend.data,e.series[0].name=s.series[0].name,e.series[1].name=s.series[1].name,e.series[2].name=s.series[2].name,e})}async function b(){k()}return F(()=>m.locale,()=>{p()}),F(()=>a.data,()=>{g(e=>(a.data&&(e.xAxis.data=a.data.map(t=>t.dbtime),e.series[0].data=a.data.map(t=>t.envT),e.series[1].data=a.data.map(t=>t.tt2),e.series[2].data=a.data.map(t=>t.moduleT)),e))}),b(),(e,t)=>(P(),Q("div",{ref_key:"domRef",ref:c,style:{height:"260px",overflow:"hidden"}},null,512))}}),Ze=K(Ye,[["__scopeId","data-v-2e037727"]]),re=x=>(Ae("data-v-efbc86dd"),x=x(),Be(),x),ea=re(()=>N("img",{src:je,alt:"",style:{height:"140px",width:"100%","margin-bottom":"20px"}},null,-1)),aa={class:"flex items-center"},ta=re(()=>N("div",{class:"w-80px font-size-14px text-right"},"气象站：",-1)),sa=j({name:"home",__name:"index",setup(x){ye();const a=Z(),m=q(()=>a.isMobile?0:16),c=$({stationP:0}),C=async()=>{const{data:d,error:_}=await Ie();_||(c.value=d)},u=$(),g=$(),k=async()=>{var r;const{data:d,error:_}=await ze();_||(g.value=d,g.value.length!=0&&(p.value=(r=d[0])==null?void 0:r.id,e()))},p=$(),b=$(),e=async()=>{const{data:d,error:_}=await Le({devId:p.value});_||(b.value=d)},t=d=>{p.value=d,e(),X()},s=Date.now(),n=new Date(s).setHours(0,0,0,0),S=new Date(s).setHours(23,59,59,999),T=$(),W=async()=>{const{data:d,error:_}=await Ee({startTime:V(1,n),endTime:V(1,S),page:1,limit:100});_||(T.value=JSON.parse(JSON.stringify(d)).list)},M=$(),L=async()=>{const{data:d,error:_}=await Ne({date:V(0,Date.now())});_||(M.value=d,M.value.forEach(r=>(T.value.forEach(v=>{r.dbtime==v.dbtime&&(r.ssrd=v.ssrd)}),r)),O.value.forEach(r=>{const v=M.value.find(A=>A.dbtime===r.dbtime);v?Object.assign(v,r):M.value.push(r)}),M.value=M.value.sort((r,v)=>new Date(r.dbtime).getTime()-new Date(v.dbtime).getTime()))},O=$(),X=async()=>{if(!p.value)return;const{data:d,error:_}=await Ve({id:p.value,startTime:V(0,Date.now())+" 00:00:00",endTime:V(1,Date.now())});console.log("气象实际数据",d),O.value=d,T.value.forEach(r=>{const v=O.value.find(A=>A.dbtime===r.dbtime);v?Object.assign(v,r):O.value.push(r)}),O.value=O.value.sort((r,v)=>new Date(r.dbtime).getTime()-new Date(v.dbtime).getTime())},Y=$(null);xe(async()=>{ie(),await k(),await C(),await W(),await X(),await L(),Y.value=setInterval(async()=>{await e(),await C(),await W(),await X(),await L()},1e3*60*1)}),Se(()=>{Y.value&&clearInterval(Y.value),H.value&&H.value.close()});const G=De({col:"",trs:""}),H=$(null),ie=()=>{var I,z,J;if((I=H.value)==null||I.close(),!Ge("channel:status:websocket")){(z=window.$message)==null||z.destroyAll(),(J=window.$message)==null||J.warning("暂无权限连接websocket");return}const d=new Date().getTime(),_=Ce(),r=ke(`${_}${d}getchlstatus`),v=te(r),A=te("getchlstatus"),y=new $e(Te+`/ChannelStatusWebsocket/${A}/${v}/${d}/${_}?token=${Me()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});H.value=y,y.connect(),y.onclose(()=>{}),y.onerror(()=>{}),y.onopen(()=>{}),y.onmessage(E=>{if(console.log(E,"通道状态websocket接受数据"),!ce(E.data))return;const i=JSON.parse(E.data).dataStatus;i&&(G.col=i.col+""=="0"||i.col+""=="1"?i.col+"":"",G.trs=i.trs+""=="0"||i.trs+""=="1"?i.trs+"":"")})},ce=d=>{try{return JSON.parse(d),!0}catch{return!1}};return(d,_)=>{const r=Re,v=Fe,A=Pe,y=se,I=ne,z=oe,J=We,E=Oe;return P(),U(E,{vertical:"",size:16,class:"h-100% home","item-style":{height:"100%"}},{default:o(()=>[l(z,{"y-gap":m.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:o(()=>[l(I,{span:"24 s:24 m:24"},{default:o(()=>[l(y,{title:"",bordered:!1,class:"card-wrapper h-100% bg-transparent","content-style":{padding:"0px"}},{default:o(()=>[l(z,{"x-gap":m.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:o(()=>[l(I,{span:"24 s:24 m:6"},{default:o(()=>[l(y,{title:"电场实时数据",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"12px"},"content-style":{padding:"12px",paddingTop:"0px",display:"flex",flexDirection:"column"}},{"header-extra":o(()=>[h(" 运行状态："+f(c.value.stationP&&c.value.stationP>0&&c.value.stationControlled==0?"并网运行":c.value.stationP&&c.value.stationP>0&&c.value.stationControlled==1?"降额运行":c.value.stationP==0?"待机":""),1)]),default:o(()=>[ea,l(A,{trigger:"none"},{default:o(()=>[l(v,{bordered:"",column:1,"label-placement":"left",size:"small",class:"flex-1","content-style":{minWidth:"100px"}},{default:o(()=>[l(r,null,{label:o(()=>[h(" 最后更新时间 ")]),default:o(()=>[h(" "+f(c.value.dbtime||"-"),1)]),_:1}),l(r,null,{label:o(()=>{var i,w;return[h(" 总有功功率"+f((i=u.value)!=null&&i.StationP?` (${(w=u.value)==null?void 0:w.StationP})`:"(MW)"),1)]}),default:o(()=>[h(" "+f(c.value.stationP??"-"),1)]),_:1}),l(r,null,{label:o(()=>{var i,w;return[h(" 总无功功率"+f((i=u.value)!=null&&i.StationQ?` (${(w=u.value)==null?void 0:w.StationQ})`:"(MVar)"),1)]}),default:o(()=>[h(" "+f(c.value.stationQ??"-"),1)]),_:1}),l(r,null,{label:o(()=>{var i,w,ee;return[h(" 总功率因数"+f(((i=u.value)==null?void 0:i.StationCOS)=="-"?"":(w=u.value)!=null&&w.StationCOS?`
                        (${(ee=u.value)==null?void 0:ee.StationCOS})`:""),1)]}),default:o(()=>[h(" "+f(c.value.stationCOS??"-"),1)]),_:1}),l(r,null,{label:o(()=>{var i,w;return[h(" 日发电量"+f((i=u.value)!=null&&i.StationDayE?` (${(w=u.value)==null?void 0:w.StationDayE})`:"(MWh)"),1)]}),default:o(()=>[h(" "+f(c.value.stationDayE??"-"),1)]),_:1}),l(r,null,{label:o(()=>{var i,w;return[h(" 总发电量"+f((i=u.value)!=null&&i.StationTotalE?` (${(w=u.value)==null?void 0:w.StationTotalE})`:"(MWh)"),1)]}),default:o(()=>[h(" "+f(c.value.stationTotalE??"-"),1)]),_:1}),l(r,null,{label:o(()=>[h(" 是否限电 ")]),default:o(()=>[N("span",null,f(c.value.stationControlled==1?"是":"否"),1)]),_:1}),l(r,null,{label:o(()=>[h(" 数据接入状态 ")]),default:o(()=>[N("span",null,f(G.col=="0"?"🟢":G.col=="1"?"🔴":"⚪"),1)]),_:1}),l(r,null,{label:o(()=>[h(" 数据上报状态 ")]),default:o(()=>[N("span",null,f(G.trs=="0"?"🟢":G.trs=="1"?"🔴":"⚪"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(I,{span:"24 s:24 m:18"},{default:o(()=>[l(y,{title:"今日预测功率",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"10px",paddingTop:"0px"}},{default:o(()=>[l(Xe,{data:M.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1}),l(I,{span:"24 s:24 m:24"},{default:o(()=>[l(y,{title:"",bordered:!0,class:"card-wrapper h-100%","content-style":{padding:"0px"}},{default:o(()=>[l(z,{"x-gap":m.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:o(()=>[l(I,{span:"24 s:24 m:6"},{default:o(()=>[l(y,{title:"气象数据",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"12px",paddingBottom:"0px"},"content-style":{padding:"0px"}},{"header-extra":o(()=>[N("div",aa,[ta,l(J,{filterable:"",placeholder:"请选择气象站",value:p.value,"onUpdate:value":_[0]||(_[0]=i=>p.value=i),options:g.value,"label-field":"sname","value-field":"id",style:{width:"140px"},onUpdateValue:t},null,8,["value","options"])])]),default:o(()=>[l(Qe,{MeteorologicalData:b.value},null,8,["MeteorologicalData"])]),_:1})]),_:1}),l(I,{span:"24 s:24 m:18"},{default:o(()=>[l(y,{title:"今日实时气象",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"0px",paddingTop:"0px"}},{default:o(()=>[l(Ze,{data:O.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1})]),_:1},8,["y-gap"])]),_:1})}}}),da=K(sa,[["__scopeId","data-v-efbc86dd"]]);export{da as default};
