import{_ as ve}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BL3fEdXs.js";import{_ as ye}from"./round-delete-BJUCXHh8.js";import{_ as we}from"./round-add-9JBusyZ3.js";import{d as ee,ay as Z,z as te,D as be,s as P,aL as re,A as ie,a as Ce,aw as ce,ax as ke,c as Q,o as A,w as o,f as a,a3 as je,M as ue,h as n,aM as pe,H,J as ae,B,g as U,t as $,$ as S,a4 as xe,cE as de,aG as me,cL as Se,cM as ze,L as De,a2 as fe,aN as Ne,Y as Te,i as Pe,F as X,b as Be,aO as J,aD as Ue,I as Y,aP as Me,e as Fe,cN as oe,cD as $e,aV as Ie}from"./index-DTejdFLI.js";import{u as Le,a as Re}from"./table-5sK02S3E.js";import{u as _e}from"./usePageData-BjjY6agq.js";import{_ as ge}from"./Grid-U7VbogCl.js";import{_ as he}from"./FormItemGridItem-OdWiLkIi.js";import{_ as Ve}from"./round-search-CcVdI1HR.js";import{_ as Oe}from"./round-refresh-CFg-lT0v.js";import{h as ne}from"./permission-BeExe-IG.js";import{N as le}from"./Popconfirm-BmNh5CYH.js";const qe=ee({name:"OperateDrawer",__name:"operate-drawer",props:Z({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Z(["submitted"],["update:visible"]),setup(w,{emit:I}){const m=I;te();const v=w,s=be(c());function c(){return{pid:void 0,id:"",pname:"",pcontact:"",proposition:"",docker:""}}const _=P([]),{pageData:r,getData:p,nextPage:b}=_e(de),L=async t=>{const e=t.currentTarget,l=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&r.data.length<r.total&&(await b(),_.value=r.data,await me(),setTimeout(()=>{e.scrollTop=l}))},j=async()=>{var t;await p({page:1,fuzzy:((t=v.rowData)==null?void 0:t.proname)||""}),_.value=r.data},z=re.debounce(async t=>{await p({fuzzy:t,page:1}),_.value=r.data},300),D=P(!1),y=P(!1),N=t=>{if(s.pid=null,D.value=!0,y.value=!1,!t){g();return}z(t)},R=async()=>{D.value&&!y.value&&(await p({page:1}),_.value=r.data,D.value=!1)},g=async()=>{await p({page:1}),_.value=r.data},M=async t=>{s.pid=t,y.value=!0};async function K(){j(),Object.assign(s,c()),v.operateType==="edit"&&v.rowData&&Object.assign(s,v.rowData)}const{formRef:V,validate:O,restoreValidation:F}=ie(),u={pid:{type:"number",required:!1,trigger:["blur","change"],message:"请选择"},pname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},docker:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},pcontact:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},i=Ce(()=>({add:"新增联系人",edit:"修改联系人"})[v.operateType]),f=ce(w,"visible");ke(f,()=>{f.value&&(K(),setTimeout(()=>{const t=document.querySelector(".n-scrollbar-content");t==null||t.scrollTo(0,0)},300),F())});function C(){f.value=!1}const x=P(!1);async function q(){var t,e;if(!x.value)try{if(await O(),x.value=!0,v.operateType==="edit"){const{data:l,error:h}=await Se([s]);h||(C(),m("submitted"),(t=window.$message)==null||t.success("修改成功"))}else{const{data:l,error:h}=await ze([{...s}]);h||(C(),m("submitted"),(e=window.$message)==null||e.success("添加成功"))}}catch{}finally{x.value=!1}}return(t,e)=>{const l=he,h=ge,G=ue,E=je,T=ae,W=xe;return A(),Q(W,{show:f.value,"onUpdate:show":e[5]||(e[5]=d=>f.value=d),title:i.value,preset:"card",class:"w-500px","mask-closable":!1,draggable:!0},{footer:o(()=>[a(T,{justify:"end",size:16},{default:o(()=>[a(n(B),{onClick:C},{default:o(()=>[U($(n(S)("common.cancel")),1)]),_:1}),a(n(B),{type:"primary",onClick:q,loading:x.value},{default:o(()=>[U($(n(S)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:o(()=>[a(E,{class:"pr-20px"},{default:o(()=>[a(G,{ref_key:"formRef",ref:V,model:s,rules:u,"label-placement":"left","label-width":120},{default:o(()=>[a(h,{responsive:"screen","item-responsive":""},{default:o(()=>[a(l,{span:"24 m:24",label:"项目",path:"pid"},{default:o(()=>[a(n(pe),{clearable:"",filterable:"",value:s.pid,"onUpdate:value":[e[0]||(e[0]=d=>s.pid=d),M],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:g,onSearch:N,options:_.value,onScroll:L,onBlur:R},null,8,["value","options"])]),_:1}),a(l,{span:"24 m:24",label:"对接方",path:"docker"},{default:o(()=>[a(n(H),{value:s.docker,"onUpdate:value":e[1]||(e[1]=d=>s.docker=d),placeholder:"请输入"},null,8,["value"])]),_:1}),a(l,{span:"24 m:24",label:"姓名",path:"pname"},{default:o(()=>[a(n(H),{value:s.pname,"onUpdate:value":e[2]||(e[2]=d=>s.pname=d),placeholder:"请输入"},null,8,["value"])]),_:1}),a(l,{span:"24 m:24",label:"联系方式",path:"pcontact"},{default:o(()=>[a(n(H),{value:s.pcontact,"onUpdate:value":e[3]||(e[3]=d=>s.pcontact=d),placeholder:"请输入"},null,8,["value"])]),_:1}),a(l,{span:"24 m:24",label:"备注",path:"proposition"},{default:o(()=>[a(n(H),{value:s.proposition,"onUpdate:value":e[4]||(e[4]=d=>s.proposition=d),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ge=ee({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Z(["reset","search","clear"],["update:model"]),setup(w,{emit:I}){const m=I,{formRef:v,restoreValidation:s}=ie(),c=ce(w,"model"),_=te(),r=P([]),{pageData:p,getData:b,nextPage:L}=_e(de),j=async u=>{const i=u.currentTarget,f=i.scrollTop;i.scrollTop+i.offsetHeight>=i.scrollHeight&&p.data.length<p.total&&(await L(),r.value=p.data,await me(),setTimeout(()=>{i.scrollTop=f}))},z=async u=>{var i;N.value=!0,u?(c.value.pid=u,m("search"),_.setProjectInfo({pname:(i=r.value.find(f=>f.id==u))==null?void 0:i.proname,pid:u})):m("clear")},D=re.debounce(async u=>{await b({fuzzy:u,page:1}),r.value=p.data},300),y=P(!1),N=P(!1),R=u=>{if(c.value.pid=null,y.value=!0,N.value=!1,!u){M();return}D(u)},g=async()=>{y.value&&!N.value&&(await b({page:1}),r.value=p.data,m("search"),y.value=!1)},M=async()=>{await b({page:1}),r.value=p.data,m("search")};(async()=>{await b({page:1}),r.value=p.data,m("search")})();async function V(){await s(),c.value.fuzzy="",m("reset")}const O=()=>{c.value.fuzzy="",m("search")};async function F(){m("search")}return(u,i)=>{const f=pe,C=he,x=H,q=Oe,t=B,e=Ve,l=ae,h=ge,G=ue,E=fe;return A(),Q(E,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[a(G,{ref_key:"formRef",ref:v,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:De(F,["enter"])},{default:o(()=>[a(h,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[a(C,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:o(()=>[a(f,{filterable:"",clearable:"",value:c.value.pid,"onUpdate:value":[i[0]||(i[0]=T=>c.value.pid=T),z],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:r.value,onScroll:j,onClear:M,onSearch:R,onBlur:g},null,8,["value","options"])]),_:1}),a(C,{span:"24 s:12 m:6",label:"姓名",path:"fuzzy"},{default:o(()=>[a(x,{value:c.value.fuzzy,"onUpdate:value":i[1]||(i[1]=T=>c.value.fuzzy=T),placeholder:"请输入",clearable:"",onClear:O},null,8,["value"])]),_:1}),a(C,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[a(l,{class:"w-full"},{default:o(()=>[a(t,{onClick:V},{icon:o(()=>[a(q,{class:"text-icon"})]),default:o(()=>[U(" "+$(n(S)("common.reset")),1)]),_:1}),a(t,{type:"primary",ghost:"",onClick:F},{icon:o(()=>[a(e,{class:"text-icon"})]),default:o(()=>[U(" "+$(n(S)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ee={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function se(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!Ie(w)}const ot=ee({name:"projectmanagement_contact",__name:"index",setup(w){const I=Ne(),m=te(),v=Te(),{columns:s,columnChecks:c,data:_,getData:r,pagination:p,loading:b,mobilePagination:L,searchParams:j}=Le({showTotal:!0,immediate:!1,apiFn:$e,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"proname",title:"项目名称",align:"center",width:240,render:t=>a("div",{class:"cursor-pointer",onClick:()=>q(t)},[t.proname])},{key:"docker",title:"对接方",align:"center",width:120},{key:"pname",title:"姓名",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pcontact",title:"联系方式",align:"center",width:120},{key:"proposition",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:S("common.operate"),align:"center",width:ne("project:Contact:update")||ne("project:Contact:delete")?140:0,fixed:"right",render:t=>{let e;return a("div",{class:"flex-center gap-8px"},[Y(a(B,{type:"primary",ghost:!0,size:"small",onClick:()=>u(t.id)},se(e=S("common.edit"))?e:{default:()=>[e]}),[[X("no-auth"),"project:Contact:update"]]),a(le,{onPositiveClick:()=>O(t.id)},{default:()=>S("common.confirmDelete"),trigger:()=>{let l;return Y(a(B,{type:"error",ghost:!0,size:"small"},se(l=S("common.delete"))?l:{default:()=>[l]}),[[X("no-auth"),"project:Contact:delete"]])}})])}}]}),{drawerVisible:z,operateType:D,editingData:y,handleAdd:N,handleEdit:R,checkedRowKeys:g,onBatchDeleted:M,onDeleted:K}=Re(_,r);Pe(async()=>{});async function V(){console.log(g.value),i(g.value.join(","),t=>{M()})}async function O(t){const{data:e,error:l}=await oe(t);l||K()}const F=()=>{N(),y.value=null};function u(t){R(t)}async function i(t,e){const{data:l,error:h}=await oe(t);if(!h)e&&e(l);else return!1}const f=t=>{r()},C=()=>{_.value=[],p.itemCount=0},x=()=>{r()},q=t=>{v.push("/projectmanagement/orderdetail?prjId="+t.pid+"&pname="+t.proname),m.setProjectInfo({pid:t.id,pname:t.proname})};return(t,e)=>{const l=ae,h=we,G=ye,E=ve,T=Ue,W=fe,d=X("no-auth");return A(),Be("div",Ee,[a(Ge,{model:n(j),"onUpdate:model":e[0]||(e[0]=k=>J(j)?j.value=k:null),onReset:x,onSearch:n(r),onClear:C},null,8,["model","onSearch"]),a(W,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[a(l,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>e[4]||(e[4]=[Fe("div",null,"项目联系人",-1)])),_:1,__:[4]})]),"header-extra":o(()=>[a(l,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[Y((A(),Q(n(B),{onClick:F,size:"small",ghost:"",type:"primary"},{icon:o(()=>[a(h,{class:"text-icon"})]),default:o(()=>[e[5]||(e[5]=U(" "+$("新增")))]),_:1,__:[5]})),[[d,"project:Contact:insert"]]),a(n(le),{onPositiveClick:V},{trigger:o(()=>[Y((A(),Q(n(B),{size:"small",ghost:"",type:"error",disabled:n(g).length==0},{icon:o(()=>[a(G,{class:Me(["text-icon",{"animate-spin":n(b)}])},null,8,["class"])]),default:o(()=>[e[6]||(e[6]=U(" "+$("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[d,"project:Contact:delete"]])]),default:o(()=>[e[7]||(e[7]=U(" 确定要删除选中的联系人吗？ "))]),_:1,__:[7]}),a(E,{columns:n(c),"onUpdate:columns":e[1]||(e[1]=k=>J(c)?c.value=k:null),ctype:11},null,8,["columns"])]),_:1})]),default:o(()=>[a(T,{"checked-row-keys":n(g),"onUpdate:checkedRowKeys":e[2]||(e[2]=k=>J(g)?g.value=k:null),columns:n(s),data:n(_),size:"small","flex-height":!n(I).isMobile,loading:n(b),remote:"","row-key":k=>k.id,pagination:n(L),class:"sm:h-full","onUpdate:filters":f},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(qe,{visible:n(z),"onUpdate:visible":e[3]||(e[3]=k=>J(z)?z.value=k:null),onSubmitted:n(r),pid:n(j).pid,"operate-type":n(D),"row-data":n(y)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{ot as default};
