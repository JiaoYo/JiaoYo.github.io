import{_ as ce}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CX0cg8ng.js";import{_ as de}from"./export-D7w4fFNy.js";import{_ as me}from"./round-search-CRTbykM-.js";import{d as A,ac as B,a0 as ue,m as f,z as pe,ak as _e,o as S,b as J,_ as q,b0 as k,g as t,w as n,f as l,B as T,ag as fe,h as C,t as b,$ as G,aq as E,c as I,e as ge,aG as he,T as ye,R as we,at as ve,O as ke,ap as be,a7 as xe}from"./index-D5B256Dj.js";import{c as V,d as De}from"./metar-Cg5usTYR.js";import{u as Te,a as Ce}from"./table-CAJzliPP.js";import{e as Se}from"./exportExcel-Bv4G4H50.js";import{u as Ne}from"./echarts-DAF0ZABC.js";import{_ as Me}from"./RadioButton-DScMUa7-.js";import{_ as j}from"./DatePicker-D-_zJaOu.js";import{_ as Oe}from"./FormItemGridItem-DAyicM1P.js";import{_ as Le}from"./Grid-BRXFl_1Z.js";const Pe=A({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(P){const c=P;B(()=>c.data,async a=>{N(),M()});const g=ue(),m=f(null),{domRef:h,updateOptions:y,showLoading:N,hideLoading:u}=Ne(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0}}},legend:{data:["功率标准差","均方根误差","平均绝对误差","平均误差","最大预测误差"]},calculable:!0,grid:{left:"6%",right:"6%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!0,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value}"},position:"left"},series:[{name:"功率标准差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"均方根误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"平均绝对误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"平均误差",type:"bar",emphasis:{focus:"series"},data:[]},{name:"最大预测误差",type:"bar",emphasis:{focus:"series"},data:[]}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function M(){await new Promise(a=>{setTimeout(a,1e3)}),y(a=>(a.xAxis.data=c.data.map(s=>s.dbtime),a.series[0].data=c.data.map(s=>s.stdpower),a.series[1].data=c.data.map(s=>s.prmse),a.series[2].data=c.data.map(s=>s.pmae),a.series[3].data=c.data.map(s=>s.pme),a.series[4].data=c.data.map(s=>s.pmaxe),a))}function _(){y((a,s)=>{const w=s();return a.legend.data=w.legend.data,a.series[0].name=w.series[0].name,a.series[1].name=w.series[1].name,a})}async function x(){M()}return B(()=>g.locale,()=>{_()}),x(),pe(()=>{m.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),_e(()=>{m.value!==null&&(clearInterval(m.value),m.value=null)}),(a,s)=>(S(),J("div",{ref_key:"domRef",ref:h,class:"h-100% overflow-hidden"},null,512))}}),Re=q(Pe,[["__scopeId","data-v-7655cf3a"]]),Ue={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ze=A({name:"realtimequery_datastatistics",__name:"index",setup(P){const{columns:c,columnChecks:g,data:m,getData:h,loading:y,mobilePagination:N,searchParams:u,resetSearchParams:M}=Te({apiFn:V,apiParams:{page:1,pageSize:20,limit:20,startTime:k(0,Date.now()-2592e5),endTime:k(0,Date.now()),_t:new Date().getTime()},immediate:!0,showTotal:!0,columns:()=>[{type:"selection",width:50},{key:"dbtime",title:"更新时间",align:"center",width:160,fixed:"left"},{key:"etime",title:"有效时长(小时)",align:"center",width:120},{key:"powermax",title:"功率最大值",align:"center",width:120},{key:"avgpower",title:"功率平均值",align:"center",width:120},{key:"stdpower",title:"功率标准差",align:"center",width:120},{key:"powertime",title:"功率最大发生时间",align:"center",width:160},{key:"uhours",title:"利用小时数",align:"center",width:120},{key:"avgload",title:"平均负荷率",align:"center",width:120},{key:"prmse",title:"均方根误差",align:"center",width:120},{key:"pmae",title:"平均绝对误差",align:"center",width:120},{key:"pme",title:"平均误差",align:"center",width:120},{key:"pclcf",title:"相关性系数",align:"center",width:120},{key:"pmaxe",title:"最大预测误差",align:"center",width:120},{key:"prate",title:"合格率",align:"center",width:120},{key:"avgenvt",title:"环境温度平均值",align:"center",width:120},{key:"avgenvh",title:"环境湿度平均值",align:"center",width:120},{key:"avgldt",title:"露点温度平均值",align:"center",width:120},{key:"avgqy",title:"气压平均值",align:"center",width:120}]}),{checkedRowKeys:_}=Ce(m,h),x=()=>{v.value=="0"?h():U()},a=f([Date.now()-864e5*3,Date.now()]);async function s(i,e){u.startTime=k(0,e[0]),u.endTime=k(0,e[1]),x()}const w=()=>{const i={};c.value.forEach(o=>{o.key!="index"&&o.key!="operation"&&o.type!=="selection"&&(i[o.key]=typeof o.title=="string"?o.title:o.title().children[0])});const e=[];m.value.forEach(o=>{if(_.value.includes(o.id)){const d=JSON.parse(JSON.stringify(i));for(const p in d)o.hasOwnProperty(p)?d[p]=o[p]:d[p]="";e.push(d)}}),Se(e,i,"数据统计")},F={近七天:[Date.now()-864e5*7,Date.now()],近一月:[Date.now()-864e5*30,Date.now()],近三月:[Date.now()-864e5*90,Date.now()]},D=f(!1),O=f(new Date().getTime()),L=f(0),H=()=>{z(),D.value=!0},K=(i,e)=>{z()},Z=()=>{D.value=!1},v=f("0"),Q=i=>{v.value=i,i=="0"?h():U()},W=(i,e)=>{const o=new Date(i).getTime(),p=(new Date(e).getTime()-o)/(1e3*60*60*24);return Math.abs(p)},R=f([]),U=async()=>{const{data:i,error:e}=await V({startTime:u.startTime,endTime:u.endTime,page:1,limit:Math.floor(W(u.startTime,u.endTime)+1)});R.value=JSON.parse(JSON.stringify(i)).list.sort((o,d)=>new Date(o.dbtime).getTime()-new Date(d.dbtime).getTime())},z=async()=>{const{data:i,error:e}=await De({date:k(3,O.value)});e||(typeof i=="number"?L.value=i:L.value="")};return(i,e)=>{const o=j,d=Me,p=he,X=me,Y=Oe,ee=Le,te=ye,ae=de,ne=ce,$=we,oe=ve,se=j,ie=ke,le=be,re=xe;return S(),J("div",Ue,[t(re,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[t(te,{ref:"formRef",model:l(u),"label-placement":"left","show-feedback":!1},{default:n(()=>[t(ee,{"y-gap":16,responsive:"screen","item-responsive":""},{default:n(()=>[t(Y,{span:"24 s:12 m:12",label:"起止时间",path:"startTime"},{default:n(()=>[t(o,{value:a.value,"onUpdate:value":e[0]||(e[0]=r=>a.value=r),type:"daterange","value-format":"yyyy-MM-dd","onUpdate:formattedValue":s,"default-time":["00:00:00","23:59:59"],shortcuts:F},null,8,["value"]),t(p,{value:v.value,"onUpdate:value":[e[1]||(e[1]=r=>v.value=r),Q],class:"ml-20px"},{default:n(()=>[t(d,{value:"0",label:"表格"}),t(d,{value:"1",label:"图表"})]),_:1},8,["value"]),t(l(T),{type:"primary",ghost:"",onClick:x,class:"ml-20px"},{icon:n(()=>[t(X,{class:fe(["text-icon",{"animate-spin":l(y)}])},null,8,["class"])]),default:n(()=>[C(" "+b(l(G)("common.search")),1)]),_:1}),t(l(T),{type:"primary",ghost:"",onClick:H,class:"ml-20px"},{default:n(()=>[C(b("月均方根误差"))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),"header-extra":n(()=>[t($,{justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[t(l(T),{onClick:w,size:"small",disabled:l(_).length==0},{icon:n(()=>[t(ae,{class:"text-icon"})]),default:n(()=>[C(" "+b(l(G)("common.export")),1)]),_:1},8,["disabled"]),t(ne,{columns:l(g),"onUpdate:columns":e[2]||(e[2]=r=>E(g)?g.value=r:null)},null,8,["columns"])]),_:1})]),default:n(()=>[v.value=="0"?(S(),I(oe,{key:0,"checked-row-keys":l(_),"onUpdate:checkedRowKeys":e[3]||(e[3]=r=>E(_)?_.value=r:null),columns:l(c),data:l(m),size:"small",loading:l(y),remote:"","row-key":r=>r.id,pagination:l(m).length?l(N):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])):(S(),I(Re,{key:1,data:R.value},null,8,["data"])),t(le,{show:D.value,"onUpdate:show":e[5]||(e[5]=r=>D.value=r),preset:"card",class:"w-320px"},{footer:n(()=>[t($,{justify:"end"},{default:n(()=>[t(l(T),{size:"small",class:"mt-16px",onClick:Z},{default:n(()=>[C(b("关闭"))]),_:1})]),_:1})]),default:n(()=>[t(ie,{label:"日期","label-placement":"left"},{default:n(()=>[t(se,{value:O.value,"onUpdate:value":[e[4]||(e[4]=r=>O.value=r),K],type:"month",clearable:""},null,8,["value"])]),_:1}),ge("h2",null,"月均方根误差："+b(L.value),1)]),_:1},8,["show"])]),_:1})])}}}),Ke=q(ze,[["__scopeId","data-v-38784de8"]]);export{Ke as default};
