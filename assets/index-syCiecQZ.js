import{_ as X}from"./table-header-operation.vue_vue_type_script_setup_true_lang-GPpnIQnS.js";import{d as j,q as O,s as G,v as W,b as Y,r as ee,y as te,K as B,o as A,c as q,w as t,g as e,h as I,t as F,i as a,$ as d,M as E,L as T,ar as ae,A as H,C as oe,E as J,D as Z,B as K,aa as ne,ab as se,a9 as Q,Z as le,am as ie,e as re,ac as U,ad as ce}from"./index-DvMCw3Rq.js";import{u as ue,a as pe}from"./table-T3UoskuP.js";import{J as de,K as me,L as _e,M as fe}from"./basic-config-JbWbfaap.js";import{b as he,a as ve,_ as ge}from"./DataTable-BnT_71C1.js";import{_ as be}from"./round-search-CPVQQ3N4.js";import{_ as ye}from"./round-refresh-Den4pxAc.js";import{_ as we}from"./FormItemGridItem-B8AmNpme.js";import{_ as De}from"./Grid-BUt7FBa5.js";import{h as L}from"./permission-DNIrq0y6.js";import{_ as ke}from"./Popconfirm-CJ9s7qbW.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-euck9wG-.js";import"./setting-outlined-DTG_YXIc.js";import"./round-delete-BPVE9jtM.js";import"./refresh-BAOyiUZF.js";import"./Upload-DUayfKBS.js";import"./Progress-CRnql7vs.js";import"./Forward-Cwgm3-FY.js";const Ne=j({name:"OperateDrawer",__name:"operate-drawer",props:O({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:O(["submitted"],["update:visible"]),setup(m,{emit:M}){const c=m,g=M,u=G(m,"visible"),{formRef:s,validate:N,restoreValidation:P}=W(),D=Y(()=>({add:"新增白名单",edit:"编辑白名单"})[c.operateType]),l=ee(k());function k(){return{ip:"",status:0,sysparam:0,dscb:""}}const b={ip:{required:!0,validator:ae,trigger:["input","change","blur","password-input"]}};function x(){Object.assign(l,k()),c.operateType==="edit"&&c.rowData&&Object.assign(l,c.rowData)}function _(){u.value=!1}async function C(){var r,i;if(await N(),c.operateType==="add"){const{data:y,error:p}=await de([l]);p||((r=window.$message)==null||r.success(d("common.addSuccess")),_(),g("submitted"))}else{const{data:y,error:p}=await me([l]);p||((i=window.$message)==null||i.success(d("common.updateSuccess")),_(),g("submitted"))}}return te(u,()=>{u.value&&(x(),P())}),(r,i)=>{const y=H,p=oe,z=he,S=J,R=ve,w=Z,o=K,n=ne,f=se,$=B("no-space");return A(),q(f,{show:u.value,"onUpdate:show":i[3]||(i[3]=h=>u.value=h),"display-directive":"show",width:360},{default:t(()=>[e(n,{title:D.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(S,{size:16},{default:t(()=>[e(o,{onClick:_},{default:t(()=>[I(F(a(d)("common.cancel")),1)]),_:1}),e(o,{type:"primary",onClick:C},{default:t(()=>[I(F(a(d)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(w,{ref_key:"formRef",ref:s,model:l,rules:b,onKeyup:E(C,["enter"])},{default:t(()=>[e(p,{label:"IP",path:"ip"},{default:t(()=>[T(e(y,{clearable:"",value:l.ip,"onUpdate:value":i[0]||(i[0]=h=>l.ip=h),placeholder:"请输入IP"},null,8,["value"]),[[$]])]),_:1}),e(p,{label:"状态"},{default:t(()=>[e(R,{value:l.status,"onUpdate:value":i[1]||(i[1]=h=>l.status=h),name:"radiogroup"},{default:t(()=>[e(S,null,{default:t(()=>[e(z,{value:0},{default:t(()=>[I("启用")]),_:1}),e(z,{value:1},{default:t(()=>[I("禁用")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),e(p,{label:"描述",path:"dscb"},{default:t(()=>[T(e(y,{clearable:"",value:l.dscb,"onUpdate:value":i[2]||(i[2]=h=>l.dscb=h),placeholder:"请输入描述"},null,8,["value"]),[[$]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),xe=j({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:O(["reset","search"],["update:model"]),setup(m,{emit:M}){const c=M,{formRef:g,restoreValidation:u}=W(),s=G(m,"model");function N(){s.value.fuzzy=void 0,s.value.ip=s.value.ip==""?void 0:s.value.ip,c("search")}function P(){s.value.ip=void 0,c("search")}async function D(){await u(),c("reset")}async function l(){c("search")}return(k,b)=>{const x=H,_=we,C=ye,r=K,i=be,y=J,p=De,z=Z,S=Q,R=B("no-space");return A(),q(S,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(z,{ref_key:"formRef",ref:g,model:s.value,"label-placement":"left","label-width":80,"show-feedback":!1,onKeyup:E(l,["enter"])},{default:t(()=>[e(p,{responsive:"screen","item-responsive":""},{default:t(()=>[e(_,{span:"24 s:12 m:6",label:"名称",path:"fuzzy",class:"pr-24px"},{default:t(()=>[T(e(x,{clearable:"",value:s.value.fuzzy,"onUpdate:value":b[0]||(b[0]=w=>s.value.fuzzy=w),placeholder:"请输入关键字",onClear:N},null,8,["value"]),[[R]])]),_:1}),e(_,{span:"24 s:12 m:6",label:"IP",path:"ip",class:"pr-24px"},{default:t(()=>[T(e(x,{clearable:"",value:s.value.ip,"onUpdate:value":b[1]||(b[1]=w=>s.value.ip=w),placeholder:"请输入IP",onClear:P},null,8,["value"]),[[R]])]),_:1}),e(_,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(y,{class:"w-full"},{default:t(()=>[e(r,{onClick:D},{icon:t(()=>[e(C,{class:"text-icon"})]),default:t(()=>[I(" "+F(a(d)("common.reset")),1)]),_:1}),e(r,{type:"primary",ghost:"",onClick:l},{icon:t(()=>[e(i,{class:"text-icon"})]),default:t(()=>[I(" "+F(a(d)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ce={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function V(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!ce(m)}const We=j({name:"basicconfig_whitelist",__name:"index",setup(m){const M=le(),{columns:c,columnChecks:g,data:u,getData:s,loading:N,mobilePagination:P,searchParams:D,resetSearchParams:l}=ue({apiFn:_e,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,ip:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"ip",title:"IP地址",align:"center",width:240},{key:"dscb",title:"描述",align:"center",width:240},{key:"status",title:"状态",align:"center",render:o=>(o.status===null&&(o.status=0),e(ie,{type:{0:"success",1:"error"}[o.status]},{default:()=>[o.status==0?"启用":"禁用"]}))},{key:"operate",title:d("common.operate"),align:"center",width:130,render:o=>{let n;return e("div",{class:"flex-center gap-8px"},[T(e(K,{type:"primary",ghost:!0,size:"small",onClick:()=>R(o.id),disabled:o.sysparam==0},V(n=d("common.edit"))?n:{default:()=>[n]}),[[B("no-auth"),"sys.white.list.update"]]),e(ke,{onPositiveClick:()=>S(o.id)},{default:()=>d("common.confirmDelete"),trigger:()=>{let f;return T(e(K,{type:"error",ghost:!0,size:"small",disabled:o.sysparam==0},V(f=d("common.delete"))?f:{default:()=>[f]}),[[B("no-auth"),"sys.white.list.delete"]])}})])}}]}),{drawerVisible:k,operateType:b,editingData:x,handleAdd:_,handleEdit:C,checkedRowKeys:r,onBatchDeleted:i,onDeleted:y,closeDrawer:p}=pe(u,s);async function z(){console.log(r.value),w(r.value.join(","),o=>{i()})}function S(o){console.log(o),w(o,n=>{y()})}function R(o){C(o)}async function w(o,n){const{data:f,error:$}=await fe(o);if(!$)n&&n(f);else return!1}return(o,n)=>{const f=X,$=ge,h=Q;return A(),re("div",Ce,[e(xe,{model:a(D),"onUpdate:model":n[0]||(n[0]=v=>U(D)?D.value=v:null),onReset:a(l),onSearch:a(s)},null,8,["model","onReset","onSearch"]),e(h,{title:"白名单",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":t(()=>[e(f,{columns:a(g),"onUpdate:columns":n[1]||(n[1]=v=>U(g)?g.value=v:null),"disabled-delete":a(r).length===0,"is-view-add-button":a(L)("sys.white.list.insert"),"is-view-delete-button":a(L)("sys.white.list.delete"),loading:a(N),onAdd:a(_),onDelete:z,onRefresh:a(s)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:t(()=>[e($,{"checked-row-keys":a(r),"onUpdate:checkedRowKeys":n[2]||(n[2]=v=>U(r)?r.value=v:null),columns:a(c),data:a(u),size:"small","flex-height":!a(M).isMobile,"scroll-x":962,loading:a(N),remote:"","row-key":v=>v.id,pagination:a(P),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ne,{visible:a(k),"onUpdate:visible":n[3]||(n[3]=v=>U(k)?k.value=v:null),"operate-type":a(b),"row-data":a(x),onSubmitted:a(s)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{We as default};
