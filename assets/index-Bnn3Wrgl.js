import{o as T,b as X,e as k,d as ue,m,av as H,g as c,z as de,aj as ie,w as r,c as D,h as y,t as x,f as b,B as O,bf as U,a4 as M,b4 as V,aM as pe,A as K,J as W,ay as R,az as q,aA as G,aB as F,ag as _e,bg as fe,R as ve,bh as me,bi as he,a6 as ye,aK as ke,p as ge,i as we,_ as xe}from"./index-BbHCbOwF.js";import{h as Q}from"./permission-Tao5P6N_.js";import{_ as be}from"./Tree-CF8Nk1EM.js";import{_ as Ne}from"./Slider-DZpI6sZn.js";import{_ as Ce}from"./Split-D0aEchfL.js";const $e={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Se=k("path",{fill:"currentColor",d:"M17 9.17a1 1 0 0 0-1.41 0L12 12.71L8.46 9.17a1 1 0 0 0-1.41 0a1 1 0 0 0 0 1.42l4.24 4.24a1 1 0 0 0 1.42 0L17 10.59a1 1 0 0 0 0-1.42"},null,-1),Oe=[Se];function Te(I,j){return T(),X("svg",$e,[...Oe])}const Ie={name:"uil-angle-down",render:Te},ze=I=>(ge("data-v-c80def0b"),I=I(),we(),I),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ae={class:"flex h-100%",style:{"flex-direction":"column"}},Le={class:"flex"},De=ze(()=>k("span",null,"监测级别",-1)),Ee={class:"flex items-center"},Ue={class:"flex items-center"},Ve={class:"cursor-pointer"},Re=ue({name:"configsetting_realtimedata_channeldetection",__name:"index",setup(I){const j=m({0:"简单",1:"标准",2:"详细"}),$=m(!0),g=m([]),w=m(null),Y=m([{title:"监视时间",key:"time",width:240,render(e){return H(2,e.time)}},{title:"监视类型",key:"data_type",width:120,render(e){return e.data_type==0?"发送>>":e.data_type==1?"接收<<":e.data_type==2?"信息  ":e.data_type==3?"警告  ":"错误  "}},{title:"内容长度",key:"data_len",width:120},{title:"监视内容",key:"data_buf",render(e){return c("div",{innerHTML:e.data_buf},null)}}]),t=m({acceptColor:"#d6f0f0",sendOutColor:"#ffe3bf",infoColor:"#f4f4f5",warningColor:"#fdf6ec",errorColor:"#fee7e7",acceptNums:0,sendOutNums:0,infoNums:0,errorNums:0,warningNums:0}),Z=[{label:"信息",key:0},{label:"警告",key:1},{label:"错误",key:2}],ee=e=>V(U,{value:e.key==0?t.value.infoNums:e.key==1?t.value.warningNums:t.value.errorNums},{default:()=>V("div",{class:"c-#676d71 w-50px h-32px flex items-center justify-center",style:{backgroundColor:e.key==0?t.value.infoColor:e.key==1?t.value.warningColor:t.value.errorColor,borderRadius:"4px"}},{default:()=>e.label})}),te=e=>({style:{minHeight:"50px",background:e.data_type==0?t.value.sendOutColor:e.data_type==1?t.value.acceptColor:e.data_type==2?t.value.infoColor:e.data_type==3?t.value.warningColor:t.value.errorColor}}),ae=({option:e})=>e.hasOwnProperty("children")?"":e.dev_status!==null?V("span",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:e.hasOwnProperty("chl_status")&&e.chl_status==1?"#00b42a":e.chl_status==2?"#ff0000":"#ccc",color:"#ff0000",lineHeight:"12px",textAlign:"center",fontSize:"16px"}},e.chlValid==1?"":e.chlValid==2?"×":""):"",N=m(),le=async()=>{var s,_,l,h;const{data:e,error:a}=await pe();if((e==null?void 0:e.length)==0)return;const d=e.reduce((f,i)=>{const u=i.chlType===0?"采集通道":i.chlType===1?"转发通道":"系统通道";let v=f.find(o=>o.key===u);return v||(v={key:u,label:u,children:[],chl_status:null},f.push(v)),v.children.push({key:i.id,label:i.chlName,chlType:i.chlType,chl_status:null}),u=="系统通道"?[]:f},[]);N.value=d,N.value.length>0&&(p.value.chlId=(_=(s=N.value[0])==null?void 0:s.children[0])==null?void 0:_.key,L.value=[(h=(l=N.value[0])==null?void 0:l.children[0])==null?void 0:h.key],ne(),A())},p=m({chlId:"",type:1,level:1}),B=m(null),A=()=>{var h,f,i;if((h=B.value)==null||h.close(),!Q("channel:detection:websocket")){(f=window.$message)==null||f.destroyAll(),(i=window.$message)==null||i.warning("暂无权限连接websocket");return}t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0};const e=new Date().getTime(),a=p.value.level==0?"1":p.value.level==1?"257":"65793";p.value.type=1;const d=K(),s=W(`${d}${e}${p.value.chlId}`),_=R(s),l=new q(G+`/ChannelDetectionWebsocket/${p.value.chlId}/${p.value.type}/${a}/${_}/${e}/${d}?token=${F()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});B.value=l,l.connect(),l.onclose(()=>{}),l.onerror(()=>{}),l.onopen(()=>{}),l.onmessage(u=>{if(console.log(u,"通道监测websocket接受数据"),!P(u.data))return;const v=JSON.parse(u.data);if(g.value.push(...v.param),$.value&&w.value){const n=document.querySelector(".n-scrollbar-content"),C=n==null?void 0:n.scrollHeight;n&&_e(()=>{w.value.scrollTo({top:C,behavior:"smooth"})})}t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0};let o=`      监视时间                  监视类型      内容长度          监视内容
`,S="";g.value.forEach(n=>{switch(n.data_type){case 0:t.value.sendOutNums+=1;break;case 1:t.value.acceptNums+=1;break;case 2:t.value.infoNums+=1;break;case 3:t.value.warningNums+=1;break;case 4:t.value.errorNums+=1;break}S+=H(2,n.time)+"           "+(n.data_type==0?"发送>>":n.data_type==1?"接受<<":n.data_type==2?"信息  ":n.data_type==3?"警告  ":"错误  ")+"         "+n.data_len+"          "+n.data_buf+`
`}),w.value.content=o+S,g.value.length>=1e3&&(g.value=[])})},E=m(null),ne=()=>{var h,f,i;if((h=E.value)==null||h.close(),!Q("channel:status:websocket")){(f=window.$message)==null||f.destroyAll(),(i=window.$message)==null||i.warning("暂无权限连接websocket");return}const e=new Date().getTime(),a=K(),d=W(`${a}${e}getchlstatus`),s=R(d),_=R("getchlstatus"),l=new q(G+`/ChannelStatusWebsocket/${_}/${s}/${e}/${a}?token=${F()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});E.value=l,l.connect(),l.onclose(()=>{}),l.onerror(()=>{}),l.onopen(()=>{}),l.onmessage(u=>{let v=[];if(console.log(u,"通道状态websocket接受数据"),!P(u.data))return;v=JSON.parse(u.data).data;const o=JSON.parse(u.data).valid;N.value.forEach(S=>{var n;(n=S.children)==null||n.forEach(C=>{v.forEach(z=>{z.chl_id==C.key&&(C.chl_status=z.chl_status)})})}),N.value.forEach(S=>{o.forEach(n=>{var C;(C=S.children)==null||C.forEach(z=>{z.key==n.id&&(z.chlValid=n.chlValid)})})})})};de(()=>{le()}),ie(()=>{var e,a;(e=B.value)==null||e.close(),(a=E.value)==null||a.close()});const L=m([]),se=async(e,a,d)=>{var s,_,l;((s=d.node)==null?void 0:s.key)!=L.value[0]&&(L.value=[(_=d.node)==null?void 0:_.key],p.value.chlId=(l=d.node)==null?void 0:l.key,g.value=[],A())},oe=e=>{g.value=[],A()},J=e=>{p.value.type=e,B.value.close(),e==1&&A()},ce=()=>{g.value=[],t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0},w.value.content=""},re=()=>{let e=w.value.content?w.value.content+"":w.value.content,a=new fe(".Btn",{text:function(){return e}});a.on("success",d=>{var s;(s=window.$message)==null||s.success("复制成功"),a.destroy()}),a.on("error",d=>{var s;(s=window.$message)==null||s.error("复制失败"),a.destroy()})},P=e=>{try{return JSON.parse(e),!0}catch{return!1}};return(e,a)=>{const d=be,s=ve,_=Ne,l=me,h=Ie,f=he,i=ye,u=ke,v=Ce;return T(),X("div",Be,[c(i,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:r(()=>[c(v,{direction:"horizontal",class:"sm:h-full","default-size":.15,max:.35,min:.1,"resize-trigger-size":6},{1:r(()=>[c(d,{"block-line":"","default-expand-all":"",data:N.value,"checked-keys":L.value,"expand-on-click":!1,"check-strategy":"child","onUpdate:checkedKeys":se,"render-prefix":ae,checkable:""},null,8,["data","checked-keys"])]),2:r(()=>[k("div",Ae,[c(i,{bordered:!1,size:"small",class:"card-wrapper",style:{"min-height":"60px"}},{header:r(()=>[c(s,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:r(()=>[p.value.type==0?(T(),D(b(O),{key:0,onClick:a[0]||(a[0]=o=>J(1))},{default:r(()=>[y(x("开启监视"))]),_:1})):(T(),D(b(O),{key:1,onClick:a[1]||(a[1]=o=>J(0))},{default:r(()=>[y(x("停止监视"))]),_:1})),$.value?(T(),D(b(O),{key:3,onClick:a[3]||(a[3]=o=>$.value=!$.value)},{default:r(()=>[y(x("停止滚屏"))]),_:1})):(T(),D(b(O),{key:2,onClick:a[2]||(a[2]=o=>$.value=!$.value)},{default:r(()=>[y(x("开启滚屏"))]),_:1})),c(b(O),{onClick:ce},{default:r(()=>[y(x("清空列表"))]),_:1}),c(b(O),{onClick:re,class:"Btn"},{default:r(()=>[y(x("复制全部内容"))]),_:1})]),_:1})]),"header-extra":r(()=>[c(s,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:r(()=>[k("div",Le,[De,c(_,{value:p.value.level,"onUpdate:value":[a[4]||(a[4]=o=>p.value.level=o),oe],step:1,marks:j.value,min:0,max:2,style:{margin:"0 10px",width:"170px !important"}},null,8,["value","marks"])]),k("div",Ee,[y(" 发送报文颜色 "),c(l,{class:"w-24px h-24px ml-5px",swatches:["#ffe3bf","#d6f0f0"],value:t.value.sendOutColor,"onUpdate:value":a[5]||(a[5]=o=>t.value.sendOutColor=o)},null,8,["value"])]),k("div",Ue,[y(" 接受报文颜色 "),c(l,{class:"w-24px h-24px ml-5px",swatches:["#ffe3bf","#d6f0f0"],value:t.value.acceptColor,"onUpdate:value":a[6]||(a[6]=o=>t.value.acceptColor=o)},null,8,["value"])]),c(b(U),{value:t.value.sendOutNums},{default:r(()=>[k("div",{style:M({background:t.value.sendOutColor}),class:"c-#676d71 w-50px h-32px flex items-center justify-center"},x("发送"),4)]),_:1},8,["value"]),c(b(U),{value:t.value.acceptNums},{default:r(()=>[k("div",{style:M({background:t.value.acceptColor}),class:"c-#676d71 w-50px h-32px flex items-center justify-center"},x("接收"),4)]),_:1},8,["value"]),c(f,{trigger:"click",options:Z,"render-label":ee},{default:r(()=>[k("span",Ve,[y("其他类型 "),c(h,{class:"font-size-20px"})])]),_:1})]),_:1})]),_:1}),c(u,{columns:Y.value,ref_key:"tableRef",ref:w,data:g.value,size:"small",remote:"","row-key":o=>o.id,"flex-height":!0,"scroll-x":"",class:"sm:h-full flex-1 pl-16px","row-props":te},null,8,["columns","data","row-key"])])]),_:1})]),_:1})])}}}),Ke=xe(Re,[["__scopeId","data-v-c80def0b"]]);export{Ke as default};
