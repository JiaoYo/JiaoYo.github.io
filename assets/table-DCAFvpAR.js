import{U as K,bP as A,r as j,m as w,a as z,dc as L,a0 as $,$ as _,ab as I,q as U,dd as H}from"./index-CAPs32oU.js";function Y(n){const{loading:u,startLoading:y,endLoading:r}=K(),{bool:C,setBool:p}=A(),{apiFn:P,apiParams:l,transformer:k,immediate:d=!0,getColumnChecks:b,getColumns:v}=n,s=j({...l}),m=w(n.columns()),S=w([]),h=w(b(n.columns())),N=z(()=>v(m.value,h.value));function D(){m.value=n.columns();const i=new Map(h.value.map(t=>[t.key,t.checked])),e=b(m.value);h.value=e.map(t=>({...t,checked:i.get(t.key)??t.checked}))}async function f(i){var g;y();const e=O(i?Object.assign(s,i):s),t=await P(e),a=k(t);S.value=a.data,p(a.data.length===0),await((g=n.onFetched)==null?void 0:g.call(n,a)),r()}function O(i){const e={};return Object.entries(i).forEach(([t,a])=>{a!=null&&(e[t]=a)}),e}function o(i){Object.assign(s,i)}function x(){Object.assign(s,l),f()}return d&&f(),{loading:u,empty:C,data:S,columns:N,columnChecks:h,reloadColumns:D,getData:f,searchParams:s,updateSearchParams:o,resetSearchParams:x}}function V(n){const u=L(),y=$(),r=z(()=>y.isMobile),{apiFn:C,apiParams:p,immediate:P,showTotal:l=!0}=n,k="__selection__",d="__expand__",{loading:b,empty:v,data:s,columns:m,columnChecks:S,reloadColumns:h,getData:N,searchParams:D,updateSearchParams:f,resetSearchParams:O}=Y({apiFn:C,apiParams:p,columns:n.columns,transformer:e=>{e.hasOwnProperty("total")||(e.total=0);const{data:t=[],pageNum:a=1,pageSize:g=20,total:c}=e||{},M=(t instanceof Array?t:t?t.hasOwnProperty("list")?t.list:t.data||[]:[]).map((F,B)=>({...F,index:(a-1)*g+B+1}));let E=D;return e.total=t instanceof Array?Object.prototype.hasOwnProperty.call(t,"total")?Number(t.total):Number(c):Number(t.total),o.itemCount=Number.isNaN(e.total)?0:e.total,{data:M,pageNum:E.page,pageSize:E.pageSize,total:Number.isNaN(e.total)?0:e.total}},getColumnChecks:e=>{const t=[];return e.forEach(a=>{T(a)?t.push({key:a.key,title:a.title,checked:!0}):a.type==="selection"?t.push({key:k,title:_("common.check"),checked:!0}):a.type==="expand"&&t.push({key:d,title:_("common.expandColumn"),checked:!0})}),t},getColumns:(e,t)=>{const a=new Map;return e.forEach(c=>{T(c)?a.set(c.key,c):c.type==="selection"?a.set(k,c):c.type==="expand"&&a.set(d,c)}),t.filter(c=>c.checked).map(c=>a.get(c.key))},onFetched:async e=>{const{pageNum:t,pageSize:a,total:g}=e;i({page:t,pageSize:a,itemCount:g})},immediate:P}),o=j({page:1,pageSize:20,showSizePicker:!0,pageSizes:[20,50,100,200],itemCount:0,onUpdatePage:async e=>{o.page=e,f({page:e,pageSize:o.pageSize||20,limit:o.pageSize||20,_t:new Date().getTime()}),N()},onUpdatePageSize:async e=>{o.pageSize=e,o.page=1,f({page:o.page,pageSize:e,limit:e,_t:new Date().getTime()}),N()},...l?{prefix:e=>_("datatable.itemCount",{total:e.itemCount})}:{}}),x=z(()=>({...o,pageSlot:r.value?3:9,prefix:!r.value&&l?o.prefix:void 0}));function i(e){Object.assign(o,e)}return u.run(()=>{I(()=>y.locale,()=>{h()})}),U(()=>{u.stop()}),{loading:b,empty:v,data:s,columns:m,columnChecks:S,reloadColumns:h,pagination:o,mobilePagination:x,updatePagination:i,getData:N,searchParams:D,updateSearchParams:f,resetSearchParams:O}}function W(n,u){const{bool:y,setTrue:r,setFalse:C}=A(),p=w("add");function P(){p.value="add",r()}const l=w(null);function k(s){p.value="edit";const m=n.value.find(S=>S.id===s)||null;l.value=H(m),r()}const d=w([]);async function b(){var s;(s=window.$message)==null||s.success(_("common.deleteSuccess")),d.value=[],await u()}async function v(){var s;(s=window.$message)==null||s.success(_("common.deleteSuccess")),await u()}return{drawerVisible:y,openDrawer:r,closeDrawer:C,operateType:p,handleAdd:P,editingData:l,handleEdit:k,checkedRowKeys:d,onBatchDeleted:b,onDeleted:v}}function T(n){return!!n.key}export{W as a,V as u};
