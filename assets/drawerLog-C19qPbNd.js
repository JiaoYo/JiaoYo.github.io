import{aY as _,d as oe,av as Y,D as Q,A as ue,s as G,aK as se,a as ce,at as ne,au as J,d8 as ee,c as x,o as h,w as o,f as l,M as le,G as M,e as u,N as re,h as c,ay as pe,t as m,H as D,J as me,B as V,g as j,$ as te,a4 as fe,cC as be,aE as ve,cA as ye,z as he,X as ge,F as _e,bp as we,b as A,aM as S,b4 as xe,I as ae,L as ze,da as ke,aP as De,b0 as je,br as Ce,W as Ne}from"./index-DCPTYPg6.js";import{u as Pe}from"./usePageData-BUYwLNSk.js";import{_ as Te,a as Le}from"./text-lxJtzljd.js";import{N as Se}from"./Popconfirm-BQoV-jsN.js";function at(r){return _({url:"/projectDailyReport/getPage.do",method:"get",params:r})}function Me(r){return _({url:"/projectDailyReport/insert.do",method:"post",data:r})}function Ie(r){return _({url:"/projectDailyReport/getIdByUuid.do",method:"get",params:r})}function Ue(r){return _({url:"/projectDailyReport/update.do",method:"put",data:r})}function ot(r){return _({url:"/projectDailyReport/delete.do",method:"delete",params:{arrIds:r}})}function Be(r){return _({url:"/projectDaily/insert.do",method:"post",data:r})}function $e(r){return _({url:"/projectComment/getPage.do",method:"get",params:r})}function Ee(r){return _({url:"/projectComment/insert.do",method:"post",data:r})}function Fe(r){return _({url:"/projectComment/delete.do",method:"delete",params:{arrIds:r}})}const st=oe({name:"OperateDrawer",__name:"operate-drawer",props:Y({operateType:{},rowData:{},pid:{},pname:{},showtype:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(r,{emit:q}){const t=q,{pageData:b,getData:z,nextPage:k}=Pe(be),I=async s=>{const a=s.currentTarget,y=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&b.data.length<b.total&&(await k({fuzzy:P.value}),await ve(),setTimeout(()=>{a.scrollTop=y}))},i=r,e=Q(U());function U(){return{id:"",proname:"",notes:"",problem:"",solutions:"",feedback:"",summarize:"",pids:[],charctras:0}}const C={notes:{required:!0,message:"请输入",trigger:"blur"}};async function N(){if(await z({fuzzy:i.pname,page:1}),Object.assign(e,U()),i.operateType==="add"&&(console.log(i.pid),i.pid&&(b.data.forEach(s=>{s.id==i.pid&&(s.disabled=!0)}),e.pids.push(i.pid))),i.operateType==="edit"&&i.rowData){Object.assign(e,i.rowData);const s=JSON.parse(i.rowData.context);e.proname=s.proname,e.notes=s.notes,e.problem=s.problem,e.solutions=s.solutions,e.feedback=s.feedback,e.summarize=s.summarize}}const{formRef:B,validate:K,restoreValidation:d}=ue(),n=async()=>{i.showtype==="detail"&&(e.pids=i.pid),await z({page:1}),$()},g=s=>{if(!s){n();return}H(s)},v=Q(new Map),P=G(""),H=se.debounce(async s=>{P.value=s,await z({fuzzy:s,page:1}),$()},300);function $(){const s=[];b.data.forEach(a=>{v.has(a.id)||s.push(a)}),v.forEach(a=>{s.push(a)}),b.data=s}const W=s=>{b.data.forEach(a=>{s.includes(a.id)&&v.set(a.id,a)}),Array.from(v.keys()).forEach(a=>{s.includes(a)||v.delete(a)})},E=ce(()=>({add:"新增项目日报",edit:"修改项目日报"})[i.operateType]),p=ne(r,"visible"),F=()=>{p.value=!1},O=G(!1),ie=async()=>{var s,a,y;if(!O.value)try{if(await K(),O.value=!0,e.charctras<30)return(s=window.$message)==null?void 0:s.warning("字数不能少于30字,请继续填写");if(i.operateType==="edit"){const w=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:R,error:T}=await Ue([{context:w,id:e.id,charctras:e.charctras}]);T||((a=window.$message)==null||a.success("修改成功"),t("submitted"),F())}else{const w=ye(),R=b.data.filter(L=>e.pids.includes(L.id)).map(L=>L.proname);e.proname=R.join(",");const T=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:f,error:de}=await Me([{context:T,uuid:w,charctras:e.charctras||ee((e.notes??"")+(e.problem??"")+(e.solutions??"")+(e.feedback??"")+(e.summarize??""))}]);if(!de){const{data:L,error:We}=await Ie({uuid:w});if(e.pids.length>0){let Z=e.pids.map(X=>({pid:X}));Z.forEach(X=>{X.did=L});const{data:Xe,error:Ye}=await Be(Z)}(y=window.$message)==null||y.success("添加成功"),t("submitted"),F()}}}catch{}finally{O.value=!1}};return J(p,()=>{p.value&&(N(),setTimeout(()=>{const s=document.querySelector(".n-scrollbar-content");s==null||s.scrollTo(0,0)},300),d())}),J(()=>[e.notes,e.problem,e.solutions,e.feedback,e.summarize],()=>{e.charctras=ee((e.notes??"")+(e.problem??"")+(e.solutions??"")+(e.feedback??"")+(e.summarize??""))},{immediate:!0}),(s,a)=>{const y=re,w=le,R=me,T=fe;return h(),x(T,{show:p.value,"onUpdate:show":a[6]||(a[6]=f=>p.value=f),title:E.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:o(()=>[l(R,{justify:"end"},{default:o(()=>[l(c(V),{size:"small",class:"mt-16px",onClick:F},{default:o(()=>[j(m(c(te)("common.cancel")),1)]),_:1}),l(c(V),{type:"primary",size:"small",class:"mt-16px",loading:O.value,onClick:ie},{default:o(()=>[j(m(c(te)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:o(()=>[l(w,{ref_key:"formRef",ref:B,model:e,rules:C},{default:o(()=>[i.operateType==="add"&&i.showtype!=="detail"?(h(),x(y,{key:0,label:"关联项目",path:"pids","label-placement":"left"},{default:o(()=>[l(c(pe),{clearable:"",filterable:"",value:e.pids,"onUpdate:value":[a[0]||(a[0]=f=>e.pids=f),W],placeholder:"请选择项目","label-field":"proname",multiple:"","value-field":"id",onClear:n,onSearch:g,options:c(b).data,onScroll:I},null,8,["value","options"])]),_:1})):M("",!0),i.operateType==="edit"&&e.proname&&i.showtype!=="detail"?(h(),x(y,{key:1,label:"项目名称",path:"proname","label-placement":"left"},{default:o(()=>[u("span",null,m(e.proname),1)]),_:1})):M("",!0),l(y,{label:"当前工作内容及成果描述：",path:"notes"},{default:o(()=>[l(c(D),{clearable:"",type:"textarea",value:e.notes,"onUpdate:value":a[1]||(a[1]=f=>e.notes=f),placeholder:"请输入"},null,8,["value"])]),_:1}),l(y,{label:"遇到问题：",path:"problem"},{default:o(()=>[l(c(D),{clearable:"",type:"textarea",rows:2,value:e.problem,"onUpdate:value":a[2]||(a[2]=f=>e.problem=f),placeholder:"请输入"},null,8,["value"])]),_:1}),l(y,{label:"解决措施：",path:"solutions"},{default:o(()=>[l(c(D),{clearable:"",type:"textarea",rows:2,value:e.solutions,"onUpdate:value":a[3]||(a[3]=f=>e.solutions=f),placeholder:"请输入"},null,8,["value"])]),_:1}),l(y,{label:"建议意见反馈：",path:"feedback"},{default:o(()=>[l(c(D),{clearable:"",type:"textarea",rows:2,value:e.feedback,"onUpdate:value":a[4]||(a[4]=f=>e.feedback=f),placeholder:"请输入"},null,8,["value"])]),_:1}),l(y,{label:"（总结）自己对一天工作的感受和体感：",path:"summarize"},{default:o(()=>[l(c(D),{clearable:"",type:"textarea",rows:2,value:e.summarize,"onUpdate:value":a[5]||(a[5]=f=>e.summarize=f),placeholder:"请输入"},null,8,["value"])]),_:1}),u("div",null,"字数："+m(e.charctras),1)]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Oe={class:"font-size-12px c-#a19f9d my-5px"},Re={key:0},Ae={class:"mt-4 border-t pt-3"},Ge={class:"flex items-start gap-2 mb-3"},Je={class:"ml-2 flex-1"},Ve={class:"flex items-center"},qe={class:"font-medium font-size-16px font-bold"},Ke={class:"text-gray-600 mt-1"},He=oe({name:"drawerLog",__name:"drawerLog",props:Y({rowData:{},showtype:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(r){const q=he();ge();const t=Q({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0,charctras:0}),b=r,z={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},k=G({});async function I(){i.value=[],Object.assign(t,b.rowData);const d=JSON.parse(b.rowData.context);t.proname=d.proname,t.notes=d.notes,t.problem=d.problem,t.solutions=d.solutions,t.feedback=d.feedback,t.summarize=d.summarize,N()}const i=G([]),e=ne(r,"visible");J(e,()=>{e.value?I():(i.value=[],t.id=void 0)}),J(()=>b.rowData,()=>{e.value&&I()});function U(d){d||C()}function C(){e.value=!1}const N=async()=>{const{data:d,error:n}=await $e({page:1,limit:100,pid:t.id});d&&(i.value=d.list)},B=se.debounce(async()=>{var v;const d=k.value[t.id];if(!(d!=null&&d.trim()))return(v=window.$message)==null?void 0:v.warning("请输入评论内容");const{data:n,error:g}=await Ee([{pid:t.id,context:d}]);n&&(k.value[t.id]="",t.num++,N())},1e3,{leading:!0,trailing:!1}),K=async d=>{var v;const{data:n,error:g}=await Fe(d.id);n&&(N(),t.num--,(v=window.$message)==null||v.success("删除成功"))};return(d,n)=>{const g=re,v=le,P=Te,H=Le,$=we,W=Ce,E=_e("no-auth");return h(),x(W,{show:e.value,"onUpdate:show":[n[1]||(n[1]=p=>e.value=p),U],"display-directive":"show",width:600,onMaskClick:C,onEsc:C},{default:o(()=>[l($,{title:t.username+"的项目日报","native-scrollbar":!1,closable:""},{default:o(()=>[l(v,{ref:"formRef",model:t,"show-feedback":!1},{default:o(()=>[t.proname&&b.showtype!="detail"?(h(),x(g,{key:0,label:"项目名称",path:"proname","label-placement":"left"},{label:o(()=>n[2]||(n[2]=[u("div",{class:"font-size-16px font-bold"},"项目名称：",-1)])),default:o(()=>[u("span",null,m(t.proname),1)]),_:1})):M("",!0),l(g,{label:"当前工作内容及成果描述",path:"notes"},{label:o(()=>n[3]||(n[3]=[u("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述：",-1)])),default:o(()=>[u("span",{class:S(["preview-text",{textstyle:t.notes}])},m(t.notes),3)]),_:1}),l(g,{label:"遇到问题",path:"problem"},{label:o(()=>n[4]||(n[4]=[u("div",{class:"font-size-16px font-bold"},"遇到问题：",-1)])),default:o(()=>[u("span",{class:S(["preview-text",{textstyle:t.problem}])},m(t.problem),3)]),_:1}),l(g,{label:"解决措施",path:"solutions"},{label:o(()=>n[5]||(n[5]=[u("div",{class:"font-size-16px font-bold"},"解决措施：",-1)])),default:o(()=>[u("span",{class:S(["preview-text",{textstyle:t.solutions}])},m(t.solutions),3)]),_:1}),l(g,{label:"建议意见反馈",path:"feedback"},{label:o(()=>n[6]||(n[6]=[u("div",{class:"font-size-16px font-bold"},"建议意见反馈：",-1)])),default:o(()=>[u("span",{class:S(["preview-text",{textstyle:t.feedback}])},m(t.feedback),3)]),_:1}),l(g,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:o(()=>n[7]||(n[7]=[u("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感：",-1)])),default:o(()=>[u("span",{class:S(["preview-text",{textstyle:t.summarize}])},m(t.summarize),3)]),_:1}),u("div",Oe,"字符数："+m(t.charctras),1)]),_:1},8,["model"]),t.num?(h(),A("div",Re,m(t.num)+"评论",1)):M("",!0),l(xe,{name:"fade"},{default:o(()=>[u("div",Ae,[ae((h(),A("div",Ge,[u("div",null,[l(P,{size:"small",src:z.avatar},null,8,["src"])]),l(c(D),{type:"textarea",id:`comment-input-${t.id}`,value:k.value[t.id],"onUpdate:value":n[0]||(n[0]=p=>k.value[t.id]=p),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ze(ke(c(B),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),l(c(V),{type:"primary",ghost:"",onClick:c(B)},{default:o(()=>n[8]||(n[8]=[j("发送")])),_:1,__:[8]},8,["onClick"])])),[[E,"project:Comment:insert"]]),(h(!0),A(De,null,je(i.value,p=>(h(),A("div",{key:p.id,class:"flex mb-3"},[l(P,{size:"small",src:z.avatar},null,8,["src"]),u("div",Je,[u("div",Ve,[u("span",qe,m(p.username),1),l(H,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:o(()=>[j(m(p.dbtime),1)]),_:2},1024),c(q).userInfo.id==p.creater?(h(),x(c(Se),{key:0,onPositiveClick:F=>K(p)},{trigger:o(()=>[ae((h(),x(c(V),{quaternary:"",type:"error",size:"small"},{default:o(()=>n[9]||(n[9]=[j(" 删除 ")])),_:1,__:[9]})),[[E,"project:Comment:delete"]])]),default:o(()=>[n[10]||(n[10]=j(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):M("",!0)]),u("div",Ke,m(p.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),nt=Ne(He,[["__scopeId","data-v-127defc8"]]);export{st as _,ot as a,Ee as b,$e as c,nt as d,Fe as e,at as f};
