import{d as W,q as G,v as le,s as q,o as E,c as K,w as n,g as a,i as b,Z as ne,az as oe,h as k,t as C,$ as g,M as ie,aA as se,a2 as ue,B as H,E as F,D as re,ad as Z,j as w,y as ce,r as U,aq as j,e as J,at as de,au as pe,S as fe,F as me,T as _e,U as ve,f as Q,ah as X,V as Y,a4 as ge}from"./index-7Q9xZuwa.js";import{f as he,a as ye,b as be,c as xe}from"./audit-events-DYnXkmR2.js";import{l as ee}from"./lodash-CYudMFH4.js";import{T as B}from"./basicconf-C0vqpl2m.js";import{_ as we}from"./round-search-BQOA9W6m.js";import{_ as ke}from"./round-refresh-DJiiF7wv.js";import{u as Te}from"./usePageData-PYHx9xl8.js";import{f as De}from"./system-manage--O3CHZ2D.js";import{_ as Se}from"./FormItemGridItem-DYTXkfwP.js";import{_ as Ce}from"./DatePicker-CNtih3Cp.js";import{_ as Ne}from"./Grid-CRtcNhSF.js";import{f as Ae}from"./events-C20QxbUR.js";import{_ as ze,a as Ie}from"./DescriptionsItem-DfMvCpt5.js";import{_ as te}from"./DataTable-n3fP4Loy.js";import{e as Pe}from"./exportExcel-D6OyA9oJ.js";import"./TimePicker-BYx0IEL9.js";import"./defineProperty-B4q_dn_D.js";import"./Forward-BzUEeUAa.js";const Ve=W({name:"FormSearch",__name:"form-search",props:G({AuditTypeData:{},AuditPolicyData:{}},{model:{required:!0},modelModifiers:{}}),emits:G(["reset","search"],["update:model"]),setup(d,{emit:I}){const N=d,o=I,{formRef:P,restoreValidation:x}=le(),i=q(d,"model");Te(De);async function T(D,t){D&&D.length>0?(i.value.startTime=D[0],i.value.endTime=D[1]):(i.value.startTime=null,i.value.endTime=null),o("search")}async function L(){await x(),i.value.timeRange=null,i.value.atype=null,i.value.ap=null,i.value.startTime=null,i.value.endTime=null,i.value.elevel=null,se(()=>{o("search")})}async function _(){o("search")}return(D,t)=>{const r=ue,u=Se,h=Ce,A=ke,z=H,y=we,S=F,V=Ne,$=re,s=Z;return E(),K(s,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a($,{ref_key:"formRef",ref:P,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ie(_,["enter"])},{default:n(()=>[a(V,{responsive:"screen","item-responsive":""},{default:n(()=>[a(u,{span:"24 s:12 m:8",label:"事件等级",path:"elevel",class:"pr-24px"},{default:n(()=>[a(r,{filterable:"",clearable:"",value:i.value.elevel,"onUpdate:value":[t[0]||(t[0]=p=>i.value.elevel=p),_],placeholder:"请选择事件等级",options:b(ne)(b(oe))},null,8,["value","options"])]),_:1}),a(u,{span:"24 s:12 m:8",label:"审计类型",path:"atype",class:"pr-24px"},{default:n(()=>[a(r,{value:i.value.atype,"onUpdate:value":[t[1]||(t[1]=p=>i.value.atype=p),_],placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:N.AuditTypeData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(u,{span:"24 s:12 m:8",label:"审计策略",path:"ap",class:"pr-24px"},{default:n(()=>[a(r,{value:i.value.ap,"onUpdate:value":[t[2]||(t[2]=p=>i.value.ap=p),_],placeholder:"请选择审计策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:N.AuditPolicyData,"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(u,{span:"24 s:12 m:8",label:"产生时间",path:"timeRange",class:"pr-24px mt-20px"},{default:n(()=>[a(h,{clearable:"",value:i.value.timeRange,"onUpdate:value":t[3]||(t[3]=p=>i.value.timeRange=p),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":T},null,8,["value"])]),_:1}),a(u,{span:"24 s:12 m:6",class:"pr-24px mt-20px",label:" "},{default:n(()=>[a(S,{class:"w-full"},{default:n(()=>[a(z,{onClick:L},{icon:n(()=>[a(A,{class:"text-icon"})]),default:n(()=>[k(" "+C(b(g)("common.reset")),1)]),_:1}),a(z,{type:"primary",ghost:"",onClick:_},{icon:n(()=>[a(y,{class:"text-icon"})]),default:n(()=>[k(" "+C(b(g)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ae=d=>(_e("data-v-4edbe7b7"),d=d(),ve(),d),$e=ae(()=>Q("span",null,"事件信息",-1)),Me=ae(()=>Q("span",null,"事件溯源",-1)),Oe={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"500px"}},Ee={key:1,class:"max-h-500px min-h-320px"};function Le(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!X(d)}const Re=W({__name:"detailInfo",props:G({detailInfo:{},AuditTypeData:{},AuditPolicyData:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(d){const I=q(d,"detailVisible"),N=d,o=w();ce(()=>I.value,async t=>{t&&(o.value=N.detailInfo,T())});const P=[{title:"",key:"index",width:50,render:(t,r)=>`${r+1}`},{key:"ename",title:"安全事件名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"安全事件类型",align:"center",width:140},{key:"pname2",title:"安全事件类别",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:t=>{(t.elevel===void 0||t.elevel===null)&&(t.elevel=1);const r={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},u=g(B[t.elevel]);let h={color:r[t.elevel],textColor:"#ffffff",borderColor:r[t.elevel]};return a(j,{size:"small",color:h},Le(u)?u:{default:()=>[u]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:180},{key:"type",title:"发生源设备类型",align:"center",width:160}],x=w(!1);let i=U([]);const T=async t=>{var h;if(!x.value)x.value=!0;else return;const{data:r,error:u}=await Ae({pageId:t,auditid:(h=o.value)==null?void 0:h.auditid,limit:20});u||(x.value=!1,t?i=[...i,...r]:i=r)};function L(t){var u;Math.abs(t.target.scrollTop+t.target.offsetHeight-t.target.scrollHeight)<=20&&((u=o.value)==null?void 0:u.eco)>i.length&&_()}const _=ee.debounce(()=>{T(i[i.length-1].id)},300),D=U({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:t,endIndex:r,page:u,pageSize:h,pageCount:A,itemCount:z}){var y,S;return`已加载${i.length}条 共${(i.length>((y=o.value)==null?void 0:y.eco)?i.length:(S=o.value)==null?void 0:S.eco)||0}条`}});return(t,r)=>{const u=ze,h=Ie,A=F,z=de,y=te,S=pe,V=fe,$=me;return E(),K($,{show:I.value,"onUpdate:show":r[0]||(r[0]=s=>I.value=s),title:"事件详情",preset:"card",class:"w-1200px"},{default:n(()=>[a(V,{class:"max-h-600px pr-20px"},{default:n(()=>[a(S,{type:"line",animated:""},{default:n(()=>[a(z,{name:"1"},{tab:n(()=>[$e]),default:n(()=>[a(A,{vertical:"",size:12},{default:n(()=>[a(h,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:n(()=>[a(u,{label:"审计事件名称"},{default:n(()=>{var s;return[k(C((s=o.value)==null?void 0:s.aename),1)]}),_:1}),a(u,{label:"审计类型"},{default:n(()=>{var s,p;return[k(C(((s=N.AuditTypeData.find(e=>{var l;return e.id===((l=o.value)==null?void 0:l.atype)}))==null?void 0:s.atypename)||((p=o.value)==null?void 0:p.atype)||""),1)]}),_:1}),a(u,{label:"审计策略"},{default:n(()=>{var s,p;return[k(C(((s=N.AuditPolicyData.find(e=>{var l;return e.id===((l=o.value)==null?void 0:l.ap)}))==null?void 0:s.pname)||((p=o.value)==null?void 0:p.ap)||""),1)]}),_:1}),a(u,{label:"事件等级"},{default:n(()=>{var s,p,e,l,c,m,v,f,M,R;return[a(b(j),{size:"small",color:{textColor:"#ffffff",borderColor:((s=o.value)==null?void 0:s.alevel)===0?"#8e9dff":((p=o.value)==null?void 0:p.alevel)===1?"#5da8ff":((e=o.value)==null?void 0:e.alevel)===2?"#fedc69":((l=o.value)==null?void 0:l.alevel)===3?"#ff9874":((c=o.value)==null?void 0:c.alevel)===4?"#ff0000":"#5da8ff",color:((m=o.value)==null?void 0:m.alevel)===0?"#8e9dff":((v=o.value)==null?void 0:v.alevel)===1?"#5da8ff":((f=o.value)==null?void 0:f.alevel)===2?"#fedc69":((M=o.value)==null?void 0:M.alevel)===3?"#ff9874":((R=o.value)==null?void 0:R.alevel)===4?"#ff0000":"#5da8ff"}},{default:n(()=>{var O;return[k(C(b(g)(b(B)[(O=o.value)==null?void 0:O.alevel])),1)]}),_:1},8,["color"])]}),_:1}),a(u,{label:"产生时间"},{default:n(()=>{var s;return[k(C((s=o.value)==null?void 0:s.dbtime),1)]}),_:1}),a(u,{label:"更新时间"},{default:n(()=>{var s;return[k(C((s=o.value)==null?void 0:s.uptime),1)]}),_:1}),a(u,{label:"事件总数"},{default:n(()=>{var s;return[k(C((s=o.value)==null?void 0:s.eco),1)]}),_:1})]),_:1})]),_:1})]),_:1}),a(z,{name:"2"},{tab:n(()=>[Me]),default:n(()=>[b(i).length==0?(E(),J("div",Oe," 暂无安全事件信息 ")):(E(),J("div",Ee,[a(y,{columns:P,remote:"",data:b(i),size:"small","scroll-x":762,"row-key":s=>s.id,"virtual-scroll":"",class:"sm:h-full","max-height":400,loading:x.value,pagination:D,onScroll:L},null,8,["data","row-key","loading","pagination"])]))]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ue=Y(Re,[["__scopeId","data-v-4edbe7b7"]]),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Ge(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!X(d)}const He=W({name:"audit_event",__name:"index",setup(d){const I=w(window.innerHeight-395),N=ge(),o=w(!1),P=w(),x=w([]);(async()=>{const{data:e,error:l}=await he({page:1,limit:1e3});l||(x.value=JSON.parse(JSON.stringify(e)).list)})();const T=w([]);(async()=>{const{data:e,error:l}=await ye({page:1,limit:1e3});l||(T.value=JSON.parse(JSON.stringify(e)).list)})();const _=U({limit:20,pageId:void 0,elevel:void 0,atype:void 0,uid:void 0,suditPolicy:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),D=[{key:"aename",title:g("page.audit.event.eventName"),align:"center",minWidth:160,ellipsis:!0,resizable:!0},{key:"atype",title:g("page.audit.event.type"),align:"center",minWidth:160,render:e=>{var c;const l=(c=x.value.find(m=>m.id===e.atype))==null?void 0:c.atypename;return a("span",null,[l||e.atype])},resizable:!0},{key:"dbtime",title:g("page.audit.event.createTime"),align:"center",width:180,resizable:!0},{key:"uptime",title:g("page.audit.event.updateTime"),align:"center",width:180,resizable:!0},{key:"ap",title:g("page.audit.event.strategy"),align:"center",width:120,render:e=>{var c;const l=(c=T.value.find(m=>m.id===e.ap))==null?void 0:c.pname;return a("span",null,[l||e.ap])},resizable:!0},{key:"alevel",title:g("page.audit.event.eventRanK"),align:"center",width:120,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=0);const l={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},c=g(B[e.alevel]);let m={color:l[e.alevel],textColor:"#ffffff",borderColor:l[e.alevel]};return a(j,{size:"small",color:m},Ge(c)?c:{default:()=>[c]})},resizable:!0},{key:"eco",title:g("page.audit.event.eventCount"),align:"center",width:120,resizable:!0},{key:"operate",title:g("common.operate"),align:"center",width:130,fixed:"right",render:e=>a("div",{class:"flex-center gap-8px"},[a(H,{type:"primary",ghost:!0,size:"small",onClick:()=>s(e)},{default:()=>[k("详情")]})])}],t=w([]),r=w(!1),u=w(0),h=async(e=!1)=>{if(!r.value)r.value=!0;else return;r.value=!0;const{data:l,error:c}=await be(_);c||(u.value=l.length,e?t.value=[...t.value,...l]:t.value=l,r.value=!1)};h();const A=w(!0),z=()=>{t.value=[],_.pageId=void 0,(l=>Object.keys(l).filter(v=>v!=="limit"&&v!=="_t").some(v=>l[v]!==void 0&&l[v]!==""&&l[v]!==null))(_)?A.value=!1:(A.value=!0,S()),h()},y=U({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:l,page:c,pageSize:m,pageCount:v,itemCount:f}){return`已加载${t.value.length}条`+(t.value.length?A.value?` 共计 ${t.value.length>0?f??0:0} 条`:u.value==_.limit?"  预计还有更多":"  没有更多了":"")}});async function S(){const{data:e,error:l}=await xe();l||(y.pageCount=20,y.total=Number(e),y.itemCount=Number(e))}S();function V(e){var c;Math.abs(e.target.scrollTop+e.target.offsetHeight-e.target.scrollHeight)<=20&&y.total>((c=t.value)==null?void 0:c.length)&&$()}const $=ee.debounce(()=>{var e;((e=t.value)==null?void 0:e.length)<y.total&&(_.pageId=t.value[t.value.length-1].id,h(!0))},300);async function s(e){P.value=e,o.value=!0}async function p(){if(!t.value.length)return;const e=JSON.parse(JSON.stringify(t.value)),l=[];e.forEach(m=>{const v={};D.forEach(f=>{var M;if(m.hasOwnProperty(f.key)){const R=f.key=="alevel"?g(B[m[f.key]]):f.key=="ap"?(M=T.value.find(O=>O.id===O[f.key]))==null?void 0:M.pname:m[f.key];v[f.title]=R}}),l.push(v)}),Pe(l,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50}],"审计事件_"+new Date().getTime())}return(e,l)=>{const c=F,m=te,v=Z;return E(),J("div",Be,[a(Ve,{model:_,"onUpdate:model":l[0]||(l[0]=f=>_=f),onSearch:z,AuditTypeData:x.value,AuditPolicyData:T.value},null,8,["model","AuditTypeData","AuditPolicyData"]),a(v,{title:b(g)("page.audit.event.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(c,null,{default:n(()=>[a(b(H),{type:"primary",size:"small",ghost:"",onClick:p,title:"导出已加载"},{default:n(()=>[k("导出已加载")]),_:1})]),_:1})]),default:n(()=>[a(m,{columns:D,data:t.value,size:"small","virtual-scroll":"","flex-height":!b(N).isMobile,loading:r.value,remote:"","row-key":f=>f.id,"max-height":I.value,pagination:y,onScroll:V,class:"sm:h-full","scroll-x":""},null,8,["data","flex-height","loading","row-key","max-height","pagination"]),a(Ue,{"detail-visible":o.value,"onUpdate:detailVisible":l[1]||(l[1]=f=>o.value=f),"detail-info":P.value,AuditTypeData:x.value,AuditPolicyData:T.value},null,8,["detail-visible","detail-info","AuditTypeData","AuditPolicyData"])]),_:1},8,["title"])])}}}),ut=Y(He,[["__scopeId","data-v-e74a75c5"]]);export{ut as default};
