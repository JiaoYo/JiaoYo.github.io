import{_ as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DCcFtEoA.js";import{d as J,q as E,s as Y,v as Z,x as me,b as fe,r as _e,y as ge,K as I,o as Q,c as ee,w as n,g as e,h as V,t as F,i as o,$ as f,M as te,L as K,A as ae,C as he,a2 as oe,D as ne,B as O,E as le,ae as ye,af as ve,J as be,ad as se,a4 as we,ay as Se,at as De,j as W,e as xe,ag as j,ah as Ce,ai as ke,S as Te,F as Ne,V as Me}from"./index-ByfxsQvj.js";import{u as ze,a as Re}from"./table-Ca-5bYro.js";import{q as re,r as ce,s as Ue,t as Le,u as Pe,v as Ae}from"./Collection-KAaQvKYa.js";import{u as q}from"./usePageData-lPm5H_26.js";import{_ as $e}from"./round-search-U_wZ0GRt.js";import{_ as Be}from"./round-refresh-BRVSTvae.js";import{_ as Ve}from"./lodash-21GmhknM.js";import{_ as Fe}from"./FormItemGridItem-Dtr_7n7z.js";import{_ as He}from"./Grid-B9K_tFX2.js";import{h as X}from"./permission-DpUBsxJs.js";import{_ as je}from"./Popconfirm-Bx1fZnQD.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-frQqLk93.js";import"./setting-outlined-C6sNL0co.js";import"./export-CaaNVRvS.js";import"./refresh-DDT70CE0.js";import"./round-delete-BsuQe4MI.js";import"./round-plus--T3dOesv.js";import"./Upload-BPNrVbAn.js";import"./Progress-B01mUdYA.js";const Ie=J({name:"OperateDrawer",__name:"operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(_,{emit:R}){const u=_,b=R,g=Y(_,"visible"),{formRef:s,validate:C,restoreValidation:U}=Z(),{createConfirmPwdRule:k,defaultRequiredRule:L,patternRules:T}=me(),N=fe(()=>({add:"新增日志源设备",edit:"编辑日志源设备"})[u.operateType]),r=_e(M());function M(){return{id:void 0,manu:null,category:null,type:"",sysparam:void 0,ldesc:""}}const P={type:L,category:{type:"number",required:!0,trigger:["blur","change"],message:"请选择日志源类别"},manu:{type:"number",required:!0,trigger:["blur","change"],message:"请选择厂商"}},{pageData:p,getData:x,nextPage:A}=q(re),H=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&p.data.length<p.total&&A()},{pageData:w,getData:d,nextPage:c}=q(ce),$=async a=>{const t=a.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&w.data.length<w.total&&c()};function S(){x(),d(),Object.assign(r,M()),u.operateType==="edit"&&u.rowData&&Object.assign(r,u.rowData)}function h(){g.value=!1}async function l(){var a,t;if(await C(),u.operateType==="add"){const{data:D,error:m}=await Ue([r]);m||((a=window.$message)==null||a.success(f("common.addSuccess")),h(),b("submitted"))}else{const{data:D,error:m}=await Le([r]);m||((t=window.$message)==null||t.success(f("common.updateSuccess")),h(),b("submitted"))}}return ge(g,()=>{g.value&&(S(),U())}),(a,t)=>{const D=ae,m=he,z=oe,B=ne,i=O,y=le,ie=ye,ue=ve,de=I("no-space");return Q(),ee(ue,{show:g.value,"onUpdate:show":t[4]||(t[4]=v=>g.value=v),"display-directive":"show",width:360},{default:n(()=>[e(ie,{title:N.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(y,{size:16},{default:n(()=>[e(i,{onClick:h},{default:n(()=>[V(F(o(f)("common.cancel")),1)]),_:1}),e(i,{type:"primary",onClick:l},{default:n(()=>[V(F(o(f)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(B,{ref_key:"formRef",ref:s,model:r,rules:P,onKeyup:te(l,["entep"])},{default:n(()=>[e(m,{label:"日志源类型",path:"type"},{default:n(()=>[K(e(D,{clearable:"",value:r.type,"onUpdate:value":t[0]||(t[0]=v=>r.type=v),placeholder:"请输入日志源类型"},null,8,["value"]),[[de]])]),_:1}),e(m,{label:"日志源类别",path:"category"},{default:n(()=>[e(z,{clearable:"",filterable:"",value:r.category,"onUpdate:value":t[1]||(t[1]=v=>r.category=v),placeholder:"请选择日志源类别",options:o(p).data,"reset-menu-on-options-change":!1,onScroll:H,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"厂商",path:"manu"},{default:n(()=>[e(z,{clearable:"",filterable:"",value:r.manu,"onUpdate:value":t[2]||(t[2]=v=>r.manu=v),placeholder:"请选择厂商",options:o(w).data,"value-field":"id","label-field":"mname",onScroll:$,"reset-menu-on-options-change":!1,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(m,{label:"描述",path:"ldesc"},{default:n(()=>[e(D,{type:"textarea",value:r.ldesc,"onUpdate:value":t[3]||(t[3]=v=>r.ldesc=v),placeholder:"请输入备注",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ke=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(_,{emit:R}){const u=R,{formRef:b,restoreValidation:g}=Z(),s=Y(_,"model");function C(d){s.value.category=d,u("search")}function U(d){s.value.manu=d,u("search")}function k(){s.value.fuzzy="",u("search")}async function L(){s.value.fuzzy=null,s.value.category=null,s.value.manu=null,u("search")}async function T(){u("search")}const N=Ve.throttle(T,1e3,{trailing:!1}),{pageData:r,getData:M,nextPage:P}=q(re),p=async d=>{const c=d.currentTarget;c.scrollTop+c.offsetHeight>=c.scrollHeight&&r.data.length<r.total&&P()},{pageData:x,getData:A,nextPage:H}=q(ce),w=async d=>{const c=d.currentTarget;c.scrollTop+c.offsetHeight>=c.scrollHeight&&x.data.length<x.total&&H()};return be(()=>{M(),A()}),(d,c)=>{const $=ae,S=Fe,h=oe,l=Be,a=O,t=$e,D=le,m=He,z=ne,B=se,i=I("no-space");return Q(),ee(B,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(z,{ref_key:"formRef",ref:b,model:s.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(o(N),["enter"])},{default:n(()=>[e(m,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[e(S,{span:"24 s:12 m:8 l:6",label:"日志源类型",path:"fuzzy"},{default:n(()=>[K(e($,{clearable:"",value:s.value.fuzzy,"onUpdate:value":c[0]||(c[0]=y=>s.value.fuzzy=y),placeholder:"请输入日志源类型关键字",onClear:k},null,8,["value"]),[[i]])]),_:1}),e(S,{span:"24 s:12 m:8 l:6",label:"厂商",path:"manu"},{default:n(()=>[e(h,{clearable:"",filterable:"",value:s.value.manu,"onUpdate:value":c[1]||(c[1]=y=>s.value.manu=y),placeholder:"请选择厂商",options:o(x).data,"value-field":"id","label-field":"mname",onScroll:w,onUpdateValue:U,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(S,{span:"24 s:12 m:8 l:6",label:"日志源类别",path:"category"},{default:n(()=>[e(h,{clearable:"",filterable:"",value:s.value.category,"onUpdate:value":c[2]||(c[2]=y=>s.value.category=y),placeholder:"请选择日志源类别",options:o(r).data,onScroll:p,onUpdateValue:C,"value-field":"id","label-field":"cname",style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(S,{span:"24  s:12 m:8 l:6"},{default:n(()=>[e(D,{class:"w-full"},{default:n(()=>[e(a,{onClick:L},{icon:n(()=>[e(l,{class:"text-icon"})]),default:n(()=>[V(" "+F(o(f)("common.reset")),1)]),_:1}),e(a,{type:"primary",ghost:"",onClick:o(N)},{icon:n(()=>[e(t,{class:"text-icon"})]),default:n(()=>[V(" "+F(o(f)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function G(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!Ce(_)}const qe=J({name:"collectionmanagement_logsource",__name:"index",setup(_){const R=we(),{columns:u,columnChecks:b,data:g,getData:s,loading:C,mobilePagination:U,searchParams:k,resetSearchParams:L}=ze({apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:void 0,category:void 0,manu:void 0,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48,disabled(l){return l.sysparam!==1}},{key:"mname",title:"厂商",align:"center",width:240},{key:"cname",title:"日志源类别",align:"center",width:240},{key:"type",title:"日志源类型",align:"center",width:240},{key:"ldesc",title:"描述",align:"center",width:500,render:l=>e("span",{class:"text-ellipsis",onClick:()=>{w.value=l.ldesc,d.value=!0},style:{display:"block",width:"100%"}},[l.ldesc])},{key:"sysparam",title:"系统内置",align:"center",width:120,render:l=>{const a={0:"success",1:"info"},t=f(Se[l.sysparam]);return e(De,{size:"small",type:a[l.sysparam]},G(t)?t:{default:()=>[t]})}},{key:"operate",title:f("common.operate"),align:"center",width:130,render:l=>{let a;return l.sysparam==1&&e("div",{class:"flex-center gap-8px"},[K(e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>S(l.id)},G(a=f("common.edit"))?a:{default:()=>[a]}),[[I("no-auth"),"sys.log.source.device.update"]]),e(je,{onPositiveClick:()=>$(l.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let t;return K(e(O,{type:"error",ghost:!0,size:"small"},G(t=f("common.delete"))?t:{default:()=>[t]}),[[I("no-auth"),"sys.log.source.device.delete"]])}})])}}]}),{drawerVisible:T,operateType:N,editingData:r,handleAdd:M,handleEdit:P,checkedRowKeys:p,onBatchDeleted:x,onDeleted:A,closeDrawer:H}=Re(g,s),w=W(""),d=W(!1);async function c(){console.log(p.value),h(p.value.join(","),l=>{x()})}function $(l){console.log(l),h(l,a=>{A()})}function S(l){P(l)}async function h(l,a){const t=await Ae(l);a&&a(t)}return(l,a)=>{const t=pe,D=ke,m=Te,z=Ne,B=se;return Q(),xe("div",Oe,[e(Ke,{model:o(k),"onUpdate:model":a[0]||(a[0]=i=>j(k)?k.value=i:null),onReset:o(L),onSearch:o(s)},null,8,["model","onReset","onSearch"]),e(B,{title:"日志源设备",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":n(()=>[e(t,{columns:o(b),"onUpdate:columns":a[1]||(a[1]=i=>j(b)?b.value=i:null),"disabled-delete":o(p).length===0,"is-view-add-button":o(X)("sys.log.source.device.insert"),"is-view-delete-button":o(X)("sys.log.source.device.delete"),loading:o(C),onAdd:o(M),onDelete:c,onRefresh:o(s)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:n(()=>[e(D,{"checked-row-keys":o(p),"onUpdate:checkedRowKeys":a[2]||(a[2]=i=>j(p)?p.value=i:null),columns:o(u),data:o(g),size:"small","flex-height":!o(R).isMobile,"scroll-x":o(u).reduce((i,y)=>i+y.width,0),loading:o(C),remote:"","row-key":i=>i.id,pagination:o(U),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),e(Ie,{visible:o(T),"onUpdate:visible":a[3]||(a[3]=i=>j(T)?T.value=i:null),"operate-type":o(N),"row-data":o(r),onSubmitted:o(s)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(z,{show:d.value,"onUpdate:show":a[4]||(a[4]=i=>d.value=i),title:"描述",preset:"card",class:"w-600px"},{default:n(()=>[e(m,{style:{"max-height":"300px"}},{default:n(()=>[V(F(w.value),1)]),_:1})]),_:1},8,["show"])]),_:1})])}}}),pt=Me(qe,[["__scopeId","data-v-dd0c97f3"]]);export{pt as default};
