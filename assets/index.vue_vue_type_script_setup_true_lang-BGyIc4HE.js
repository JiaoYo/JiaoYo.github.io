import{_ as ye}from"./round-add-C2zJSyfQ.js";import{d as Q,aE as X,m as W,ar as ce,r as de,n as ue,a as be,aG as oe,bY as le,ee as he,ef as we,aC as Z,c as L,o as w,w as n,f as a,C as se,s as G,v as pe,h as e,aD as me,x as V,N as re,B as z,g as D,t as h,$ as R,a1 as xe,cs as fe,aO as ae,O as ke,H as K,eg as Se,q as Y,bg as Ce,y as E,e as f,aU as H,b as A,X as je,A as _e,cJ as De,U as Te,V as Pe,bi as ze,eh as Ne,ei as Ue,M as $e,Z as ve,b4 as Ie,aS as Le,i as Me,aT as te,cO as Be,aH as Fe,ej as Oe,ek as Re,aY as Ee,am as qe}from"./index-JAJtFREg.js";import{u as He,a as Ve}from"./table-BRXBK7jy.js";import{u as ne}from"./usePageData-Bdo4iRgJ.js";import{_ as Ae,a as Ke}from"./text-KYxKfscL.js";import{N as ge}from"./Popconfirm-DTB2ANQW.js";import{_ as Ge}from"./round-search-DvvXtTQ6.js";import{_ as Ye}from"./Grid-2TTZqiUQ.js";import{_ as Je}from"./FormItemGridItem-B9mm_V6-.js";const Xe=Q({name:"OperateDrawer",__name:"operate-drawer",props:X({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(k,{emit:F}){W();const l=F,M=ce("pname"),p=k,o=de(N());function N(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null}}const _={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施",trigger:"blur"}},{pageData:u,getData:g,nextPage:U}=ne(fe),$=async t=>{const r=t.currentTarget,s=r.scrollTop;r.scrollTop+r.offsetHeight>=r.scrollHeight&&u.data.length<u.total&&(await U(),await ae(),setTimeout(()=>{r.scrollTop=s}))},y=async t=>{t?o.pid=t:o.value.pid=null},I=async()=>{var t;if(await g({fuzzy:M.value,page:1}),u.data.length==0)return(t=window.$message)==null?void 0:t.warning("没有项目")},m=async t=>{await g({fuzzy:t,page:1})},i=()=>{g({page:1})};async function b(){Object.assign(o,N()),await I(),p.pid&&(u.data.forEach(t=>{t.id==p.pid&&(t.disabled=!0)}),o.pid=p.pid),p.operateType==="edit"&&p.rowData&&Object.assign(o,p.rowData)}const{formRef:S,validate:T,restoreValidation:O}=ue(),B=be(()=>({add:"新增项目总结",edit:"修改项目总结"})[p.operateType]),P=oe(k,"visible"),C=()=>{P.value=!1},d=le.debounce(async()=>{var t,r;if(await T(),p.operateType==="edit"){const{data:s,error:c}=await he([{...o}]);c||((t=window.$message)==null||t.success("修改成功"),l("submitted"),C())}else{const{data:s,error:c}=await we([{pid:o.pid,content1:o.content1,content2:o.content2,content3:o.content3,content4:o.content4,content5:o.content5}]);c||((r=window.$message)==null||r.success("添加成功"),l("submitted"),C())}},1e3,{leading:!0,trailing:!1});return Z(P,()=>{P.value&&(b(),setTimeout(()=>{const t=document.querySelector(".n-scrollbar-content");t==null||t.scrollTo(0,0)},300),O())}),(t,r)=>{const s=pe,c=se,j=re,q=xe;return w(),L(q,{show:P.value,"onUpdate:show":r[6]||(r[6]=v=>P.value=v),title:B.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:n(()=>[a(j,{justify:"end"},{default:n(()=>[a(e(z),{size:"small",class:"mt-16px",onClick:C},{default:n(()=>[D(h(e(R)("common.cancel")),1)]),_:1}),a(e(z),{type:"primary",size:"small",class:"mt-16px",onClick:e(d)},{default:n(()=>[D(h(e(R)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:n(()=>[a(c,{ref_key:"formRef",ref:S,model:o,rules:_},{default:n(()=>[p.operateType==="add"?(w(),L(s,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:n(()=>[a(e(me),{clearable:"",filterable:"",value:o.pid,"onUpdate:value":[r[0]||(r[0]=v=>o.pid=v),y],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:i,onSearch:m,options:e(u).data,onScroll:$},null,8,["value","options"])]),_:1})):G("",!0),a(s,{label:"前期准备阶段描述",path:"content1"},{default:n(()=>[a(e(V),{clearable:"",type:"textarea",value:o.content1,"onUpdate:value":r[1]||(r[1]=v=>o.content1=v),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),a(s,{label:"遇到问题及对项目的影响",path:"content2"},{default:n(()=>[a(e(V),{clearable:"",type:"textarea",value:o.content2,"onUpdate:value":r[2]||(r[2]=v=>o.content2=v),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),a(s,{label:"经验教训与改进方案或措施",path:"content3"},{default:n(()=>[a(e(V),{clearable:"",type:"textarea",value:o.content3,"onUpdate:value":r[3]||(r[3]=v=>o.content3=v),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),a(s,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:n(()=>[a(e(V),{clearable:"",type:"textarea",value:o.content4,"onUpdate:value":r[4]||(r[4]=v=>o.content4=v),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),a(s,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:n(()=>[a(e(V),{clearable:"",type:"textarea",value:o.content5,"onUpdate:value":r[5]||(r[5]=v=>o.content5=v),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ze={class:"mt-4 border-t pt-3"},Qe={class:"flex items-start gap-2 mb-3"},We={class:"ml-2 flex-1"},et={class:"flex items-center"},tt={class:"font-medium font-size-16px font-bold"},at={class:"text-gray-600 mt-1"},nt=Q({name:"drawerLog",__name:"drawerLog",props:X({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(k){const F=W();ke();let l=de({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""});const M=k,p={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},o=K({});async function N(){_.value=[],l={id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""},Object.assign(l,M.rowData),$()}const _=K([]),u=oe(k,"visible");Z(u,()=>{u.value?N():(_.value=[],l.id=void 0)});function g(m){m||U()}function U(){u.value=!1}const $=async()=>{const{data:m,error:i}=await Ne({page:1,limit:100,pid:l.id});m&&(_.value=m.list)},y=le.debounce(async()=>{var S;const m=o.value[l.id];if(!(m!=null&&m.trim()))return(S=window.$message)==null?void 0:S.warning("请输入评论内容");const{data:i,error:b}=await Se([{pid:l.id,content:m}]);i&&(o.value[l.id]="",l.num++,$())},1e3,{leading:!0,trailing:!1}),I=async m=>{var S;const{data:i,error:b}=await Ue(m.id);i&&($(),l.num--,(S=window.$message)==null||S.success("删除成功"))};return(m,i)=>{const b=pe,S=se,T=Ae,O=Ke,B=Ce,P=ze,C=Y("i"),d=Y("no-auth");return w(),L(P,{show:u.value,"onUpdate:show":[i[1]||(i[1]=t=>u.value=t),g],"display-directive":"show",width:600,onMaskClick:U,onEsc:U},{default:n(()=>[a(B,{title:e(l).username+"的项目总结","native-scrollbar":!1,closable:""},{default:n(()=>[a(S,{ref:"formRef",model:e(l),"show-feedback":!1},{default:n(()=>[a(b,{label:"",path:"contractname"},{label:n(()=>i[2]||(i[2]=[f("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:n(()=>[f("span",{class:H(["preview-text",{textstyle:e(l).proname}])},h(e(l).proname),3)]),_:1}),a(b,{label:"前期准备阶段描述",path:"content1"},{label:n(()=>i[3]||(i[3]=[f("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:n(()=>[f("span",{class:H(["preview-text",{textstyle:e(l).content1}])},h(e(l).content1),3)]),_:1}),a(b,{label:"遇到问题及对项目的影响",path:"content2"},{label:n(()=>i[4]||(i[4]=[f("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:n(()=>[f("span",{class:H(["preview-text",{textstyle:e(l).content2}])},h(e(l).content2),3)]),_:1}),a(b,{label:"经验教训与改进方案或措施",path:"content3"},{label:n(()=>i[5]||(i[5]=[f("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:n(()=>[f("span",{class:H(["preview-text",{textstyle:e(l).content3}])},h(e(l).content3),3)]),_:1}),a(b,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:n(()=>i[6]||(i[6]=[f("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:n(()=>[f("span",{class:H(["preview-text",{textstyle:e(l).content4}])},h(e(l).content4),3)]),_:1}),a(b,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:n(()=>i[7]||(i[7]=[f("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:n(()=>[f("span",{class:H(["preview-text",{textstyle:e(l).content5}])},h(e(l).content5),3)]),_:1})]),_:1},8,["model"]),E((w(),A("div",null,[D(h(e(l).num)+"评论",1)])),[[C,e(l).num]]),a(je,{name:"fade"},{default:n(()=>[f("div",Ze,[E((w(),A("div",Qe,[f("div",null,[a(T,{size:"small",src:p.avatar},null,8,["src"])]),a(e(V),{type:"textarea",id:`comment-input-${e(l).id}`,value:o.value[e(l).id],"onUpdate:value":i[0]||(i[0]=t=>o.value[e(l).id]=t),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:_e(De(e(y),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),a(e(z),{type:"primary",ghost:"",onClick:e(y)},{default:n(()=>i[8]||(i[8]=[D("发送")])),_:1,__:[8]},8,["onClick"])])),[[d,"project:Summary:Comment:insert"]]),(w(!0),A(Te,null,Pe(_.value,t=>(w(),A("div",{key:t.id,class:"flex mb-3"},[a(T,{size:"small",src:p.avatar},null,8,["src"]),f("div",We,[f("div",et,[f("span",tt,h(t.username),1),a(O,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:n(()=>[D(h(t.dbtime),1)]),_:2},1024),e(F).userInfo.id==t.creater?(w(),L(e(ge),{key:0,onPositiveClick:r=>I(t)},{trigger:n(()=>[E((w(),L(e(z),{quaternary:"",type:"error",size:"small"},{default:n(()=>i[9]||(i[9]=[D(" 删除 ")])),_:1,__:[9]})),[[d,"project:Summary:Comment:delete"]])]),default:n(()=>[i[10]||(i[10]=D(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):G("",!0)]),f("div",at,h(t.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),ot=$e(nt,[["__scopeId","data-v-4f3f349b"]]),lt=Q({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:X(["reset","search","clear"],["update:model"]),setup(k,{emit:F}){const l=F,{formRef:M}=ue(),p=ce("pname"),o=oe(k,"model"),N=W(),_=K([]),{pageData:u,getData:g,nextPage:U}=ne(fe),$=async d=>{const t=d.currentTarget,r=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&u.data.length<u.total&&(await U(),_.value=u.data,await ae(),setTimeout(()=>{t.scrollTop=r}))},{pageData:y,getData:I,nextPage:m}=ne(Ie),i=async d=>{const t=d.currentTarget,r=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&y.data.length<y.total&&(await m(),_.value=y.data,await ae(),setTimeout(()=>{t.scrollTop=r}))},b=async d=>{o.value.creater=d,l("search")},S=async d=>{var t,r;d?(o.value.pid=d,l("search"),N.setProjectInfo({pname:(t=_.value.find(s=>s.id==d))==null?void 0:t.proname,pid:d}),p.value=(r=_.value.find(s=>s.id==d))==null?void 0:r.proname):l("search")},T=le.debounce(async d=>{await g({fuzzy:d,page:1}),_.value=u.data},300),O=d=>{if(!d){o.value.pid=null,B();return}T(d)},B=async()=>{await g({page:1}),_.value=u.data};(async()=>{await g(),_.value=u.data,l("search")})(),I({usertypes:"2,3"});async function C(){l("search")}return(d,t)=>{const r=me,s=Je,c=Ge,j=z,q=re,v=Ye,ee=se,J=ve;return w(),L(J,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(ee,{ref_key:"formRef",ref:M,model:o.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:_e(C,["enter"])},{default:n(()=>[a(v,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:n(()=>[a(s,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:n(()=>[a(r,{filterable:"",clearable:"",value:o.value.pid,"onUpdate:value":[t[0]||(t[0]=x=>o.value.pid=x),S],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:_.value,onScroll:$,onClear:B,onSearch:O},null,8,["value","options"])]),_:1}),a(s,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:n(()=>[a(r,{clearable:"",filterable:"",value:o.value.creater,"onUpdate:value":[t[1]||(t[1]=x=>o.value.creater=x),b],placeholder:"请选择","label-field":"username","value-field":"id",options:e(y).data,onScroll:i},null,8,["value","options"])]),_:1}),a(s,{span:"24  s:12 m:6",class:"pr-24px"},{default:n(()=>[a(q,{class:"w-full"},{default:n(()=>[a(j,{type:"primary",ghost:"",onClick:C},{icon:n(()=>[a(c,{class:"text-icon"})]),default:n(()=>[D(" "+h(e(R)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),st={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},rt={key:0};function ie(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!Ee(k)}const gt=Q({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(k,{emit:F}){const l=Le(),M=W(),p=k,o=K("");qe("pname",o);const N=F,{columns:_,data:u,getData:g,loading:U,mobilePagination:$,searchParams:y}=He({showTotal:!0,immediate:!1,apiFn:Oe,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:s=>a("div",null,[s.username+"的项目总结"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:R("common.operate"),align:"center",width:140,fixed:"right",render:s=>{let c;return a("div",{class:"flex-center gap-8px"},[a(z,{type:"primary",ghost:!0,size:"small",onClick:()=>t(s)},{default:()=>[D("查看详情")]}),M.userInfo.id==s.creater&&E(a(z,{type:"primary",ghost:!0,size:"small",onClick:()=>P(s.id)},ie(c=R("common.edit"))?c:{default:()=>[c]}),[[Y("no-auth"),"project:Summary:update"]]),M.userInfo.id==s.creater&&a(ge,{onPositiveClick:()=>B(s.id)},{default:()=>R("common.confirmDelete"),trigger:()=>{let j;return E(a(z,{type:"error",ghost:!0,size:"small"},ie(j=R("common.delete"))?j:{default:()=>[j]}),[[Y("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:I,operateType:m,editingData:i,handleAdd:b,handleEdit:S,checkedRowKeys:T,onDeleted:O}=Ve(u,g);async function B(s){const{data:c,error:j}=await Re(s);j||O()}function P(s){S(s)}const C=K(!1),d=K({}),t=s=>{C.value=!0,d.value=s},r=()=>{g()};return Z(()=>p.pid,async s=>{s&&(y.pid=s,await g())}),Z(()=>u.value,async s=>{s.length>0?N("thereIsData",1):N("thereIsData",0)}),Me(()=>{p.type!="externalLiaison"}),(s,c)=>{const j=re,q=ye,v=Fe,ee=ve,J=Y("no-auth");return w(),A("div",st,[p.pid?G("",!0):(w(),L(lt,{key:0,model:e(y),"onUpdate:model":c[0]||(c[0]=x=>te(y)?y.value=x:null),onReset:r,onSearch:e(g),onClear:c[1]||(c[1]=x=>u.value=[])},null,8,["model","onSearch"])),a(ee,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Be({header:n(()=>[a(j,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:n(()=>[p.pid?G("",!0):(w(),A("div",rt,"项目总结"))]),_:1}),p.pid?E((w(),L(e(z),{key:0,onClick:e(b),size:"small",ghost:"",type:"primary"},{icon:n(()=>[a(q,{class:"text-icon"})]),default:n(()=>[c[5]||(c[5]=D(" "+h("新增")))]),_:1,__:[5]},8,["onClick"])),[[J,"project:Summary:insert"]]):G("",!0)]),default:n(()=>[a(v,{"checked-row-keys":e(T),"onUpdate:checkedRowKeys":c[2]||(c[2]=x=>te(T)?T.value=x:null),columns:e(_),data:e(u),size:"small","flex-height":!e(l).isMobile,loading:e(U),remote:"","row-key":x=>x.id,pagination:e($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Xe,{visible:e(I),"onUpdate:visible":c[3]||(c[3]=x=>te(I)?I.value=x:null),onSubmitted:e(g),"operate-type":e(m),pid:p.pid||e(y).pid,"row-data":e(i)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),a(ot,{visible:C.value,"onUpdate:visible":c[4]||(c[4]=x=>C.value=x),"row-data":d.value},null,8,["visible","row-data"])]),_:2},[p.pid?void 0:{name:"header-extra",fn:n(()=>[a(j,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[E((w(),L(e(z),{onClick:e(b),size:"small",ghost:"",type:"primary"},{icon:n(()=>[a(q,{class:"text-icon"})]),default:n(()=>[c[6]||(c[6]=D(" "+h("新增")))]),_:1,__:[6]},8,["onClick"])),[[J,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{gt as _};
