import{_ as Y,l as ee}from"./lodash-Bu17Xiio.js";import{d as q,n as F,j as m,p as te,s as le,o as Z,c as ae,w as s,g as o,i as A,h as N,t as H,$ as D,F as ne,aG as oe,aw as C,ax as R,Z as ie,J as re,B,N as Q,O as se,ad as X,a3 as ue,r as J,av as K,A as de,e as pe,ai as ce,aZ as ve,aj as me,R as ge}from"./index-CPvLxVyj.js";import{_ as fe}from"./round-search-Bazpes3Q.js";import{_ as Ie}from"./round-refresh-BShX9Agz.js";import{a as _e,S as he,t as W}from"./alarm-BFniz6MM.js";import{_ as ye}from"./DatePicker-D0kgC-0R.js";import{_ as we}from"./FormItemGridItem-CFfJHRMO.js";import{_ as Ae}from"./Cascader-DgfpuBAK.js";import{_ as Se}from"./Grid-B7joyhXS.js";import{_ as Oe}from"./originlogInfo.vue_vue_type_script_setup_true_lang-Db-0diT6.js";import{e as be}from"./exportExcel-D6OyA9oJ.js";import{x as xe,v as Ee}from"./events-tRxH-vjm.js";import{n as ke}from"./Collection-CKAk75BO.js";import{f as Ce,a as Te}from"./common-BQxAE94s.js";import{T as Le}from"./basicconf-BBSfuwy0.js";import"./TimePicker-6saq_Vw8.js";import"./defineProperty-dYeSDo8h.js";import"./collection-ClCbq5LL.js";import"./DescriptionsItem-Bi4yPxX5.js";import"./CollapseItem-Dddq2mof.js";const Pe=q({name:"FormSearch",__name:"form-search",props:F(["eventsTypeDataList","collectorList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:F(["search"],["update:model"]),setup(I,{emit:V}){const S=I,g=V;m(0);const{formRef:L,restoreValidation:j}=te(),e=le(I,"model");async function z(){await j(),e.value.etypeid=null,e.value.elevel=null,e.value.rtime=null,e.value.user=null,e.value.logodid=null,e.value.target=null,e.value.startAndEndOriginIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.expression=null,e.value.startOriginIp=null,e.value.endOriginIp=null,e.value.startAimOriginIp=null,e.value.endAimOriginIp=null,e.value.startSourceIp=null,e.value.endSourceIp=null,oe(()=>{g("search")})}const G=a=>{e.value.elevel=a,i()},M=(a,r)=>{e.value.rtime=r,i()},T=a=>{e.value.etypeid=a,i()},P=()=>{e.value.startAndEndOriginIp=null,i()},$=()=>{e.value.startAndEndSourceIp=null,i()},_=()=>{e.value.startAndEndAimSourceIp=null,i()};async function i(){var a,r,f,d,b,h,v,y,w,x,E,k;if(e.value.startAndEndOriginIp&&e.value.startAndEndOriginIp.length>0?(e.value.startOriginIp=e.value.startAndEndOriginIp[0]||null,e.value.endOriginIp=e.value.startAndEndOriginIp[1]||null):(e.value.startOriginIp=null,e.value.endOriginIp=null),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimOriginIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimOriginIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimOriginIp=null,e.value.endAimOriginIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=null,e.value.endSourceIp=null),e.value.startOriginIp&&!C(e.value.startOriginIp)||e.value.endOriginIp&&!C(e.value.endOriginIp))return(a=window.$message)==null||a.destroyAll(),(r=window.$message)==null||r.error("请输入正确的IP地址"),!1;if(e.value.startOriginIp&&e.value.endOriginIp&&R(e.value.startOriginIp,e.value.endOriginIp)>0)return(f=window.$message)==null||f.destroyAll(),(d=window.$message)==null||d.error("起始IP不能大于终止IP"),!1;if(e.value.startAimOriginIp&&!C(e.value.startAimOriginIp)||e.value.endAimOriginIp&&!C(e.value.endAimOriginIp))return(b=window.$message)==null||b.destroyAll(),(h=window.$message)==null||h.error("请输入正确的IP地址"),!1;if(e.value.startAimOriginIp&&e.value.endAimOriginIp&&R(e.value.startAimOriginIp,e.value.endAimOriginIp)>0)return(v=window.$message)==null||v.destroyAll(),(y=window.$message)==null||y.error("起始IP不能大于终止IP"),!1;if(e.value.startSourceIp&&!C(e.value.startSourceIp)||e.value.endSourceIp&&!C(e.value.endSourceIp))return(w=window.$message)==null||w.destroyAll(),(x=window.$message)==null||x.error("请输入正确的IP地址"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&R(e.value.startSourceIp,e.value.endSourceIp)>0)return(E=window.$message)==null||E.destroyAll(),(k=window.$message)==null||k.error("起始IP不能大于终止IP"),!1;g("search")}const O=Y.debounce(i,1e3,{leading:!0,trailing:!1});return(a,r)=>{const f=ie,d=we,b=Ae,h=ye,v=re,y=Ie,w=B,x=fe,E=Q,k=Se,t=se,l=X;return Z(),ae(l,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[o(t,{ref_key:"formRef",ref:L,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(A(O),["enter"])},{default:s(()=>[o(k,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:s(()=>[o(d,{span:"24 s:24 m:8 l:6",label:"采集器",path:"logodid"},{default:s(()=>[o(f,{filterable:"",clearable:"",placeholder:"请选择采集器",value:e.value.logodid,"onUpdate:value":[r[0]||(r[0]=n=>e.value.logodid=n),i],options:S.collectorList,"value-field":"id","label-field":"type","reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),o(d,{span:"24 s:24 m:8 l:6",label:"事件类型",path:"etypeid"},{default:s(()=>[o(b,{value:e.value.etypeid,"onUpdate:value":[r[1]||(r[1]=n=>e.value.etypeid=n),T],clearable:"",placeholder:"请选择事件","max-tag-count":1,options:S.eventsTypeDataList,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),o(d,{span:"24 s:24 m:8 l:6",label:"安全级别",path:"leid"},{default:s(()=>[o(f,{filterable:"",clearable:"",placeholder:"请选择安全级别",value:e.value.elevel,"onUpdate:value":[r[2]||(r[2]=n=>e.value.elevel=n),G],options:A(_e),"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),o(d,{span:"24 s:24 m:8 l:6",label:"接收时间",path:"rtime"},{default:s(()=>[o(h,{placeholder:"请选择接收时间","formatted-value":e.value.rtime,"onUpdate:formattedValue":r[3]||(r[3]=n=>e.value.rtime=n),"value-format":"yyyy-MM-dd",type:"date",clearable:"",style:{width:"100%"},"onUpdate:value":M},null,8,["formatted-value"])]),_:1}),o(d,{span:"24 s:24 m:10 l:8",label:"源IP",path:"startAndEndOriginIp"},{default:s(()=>[o(v,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndOriginIp,"onUpdate:value":r[4]||(r[4]=n=>e.value.startAndEndOriginIp=n),onClear:P},null,8,["value"])]),_:1}),o(d,{span:"24 s:24 m:10 l:8",label:"目的IP",path:"startAndEndAimSourceIp"},{default:s(()=>[o(v,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":r[5]||(r[5]=n=>e.value.startAndEndAimSourceIp=n),onClear:_},null,8,["value"])]),_:1}),o(d,{span:"24 s:24 m:10 l:8",label:"发生源IP",path:"startAndEndSourceIp"},{default:s(()=>[o(v,{pair:"",separator:"-",disabled:S.logsoudev,placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":r[6]||(r[6]=n=>e.value.startAndEndSourceIp=n),onClear:$},null,8,["disabled","value"])]),_:1}),o(d,{span:"24 s:24 m:8 l:6"},{default:s(()=>[o(E,{class:"w-full"},{default:s(()=>[o(w,{onClick:z},{icon:s(()=>[o(y,{class:"text-icon"})]),default:s(()=>[N(" "+H(A(D)("common.reset")),1)]),_:1}),o(w,{type:"primary",ghost:"",onClick:A(O)},{icon:s(()=>[o(x,{class:"text-icon"})]),default:s(()=>[N(" "+H(A(D)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),$e={class:"min-h-500px flex-col-stretch overflow-hidden lt-sm:overflow-auto"};function Ne(I){return typeof I=="function"||Object.prototype.toString.call(I)==="[object Object]"&&!ce(I)}const De=q({name:"eventalarm_originlog",__name:"index",props:{logsoudev:{},aip:{}},setup(I){const V=ue(),S=m(window.innerHeight-395),g=I,L=m([]);(async()=>{const{data:t,error:l}=await ke({page:1,limit:1e3,_t:new Date().getTime()});if(l)console.error("获取采集器列表失败:",l);else{const n=t;L.value=n.list.map(u=>({...u,id:u.id,type:u.cname}))}})();const e=m([]),z=m([]);async function G(){const{data:t,error:l}=await Ce();l||(e.value=t,await M())}async function M(){const{data:t,error:l}=await Te();if(!l){z.value=t;let n=e.value.concat(t);e.value=ve(n)}}G();const T=m(!1),P=m(),$=m(),_=m(!1),i=J({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),O=[{title:"序号",key:"index",width:80,align:"center",render:t=>`${t.index}`},{key:"type",title:"采集器名称",align:"center",width:180},{key:"osubject",title:"事件主体",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"oobject",title:"事件客体",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"odescribe",title:"事件描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"oresult",title:"事件结果",align:"center",width:180,ellipsis:{tooltip:!0},render:t=>{var l,n;return o(K,{size:"small",type:(l=t.oresult)!=null&&l.includes("成功")?"success":(n=t.oresult)!=null&&n.includes("失败")?"error":"warning"},{default:()=>[t.oresult]})}},{key:"level",title:"安全级别",align:"center",width:120,render:t=>{const l=he[t.level];let n={color:W[t.level],textColor:"#ffffff",borderColor:W[t.level]};return o(K,{size:"small",color:n},Ne(l)?l:{default:()=>[l]})}},{key:"pname2",title:"事件类别",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"etime",title:"日志时间",align:"center",width:160},{key:"operate",title:D("common.operate"),align:"center",width:100,fixed:"right",render:t=>o("div",{class:"flex-center gap-8px"},[o(B,{type:"info",ghost:!0,size:"small",onClick:()=>w(t)},{default:()=>[N("详情")]})])}],a=m([]),r=m(0),f=async(t=!1)=>{if(!_.value)_.value=!0;else return;_.value=!0,g.logsoudev&&g.aip&&(d.value=!1,i.logodid=g.logsoudev,i.startAndEndSourceIp=[g.aip,g.aip],i.startSourceIp=g.aip,i.endSourceIp=g.aip);const{data:l,error:n}=await Ee(i);n||(r.value=l.length,t?a.value=[...a.value,...l]:a.value=l,a.value=a.value.sort((u,p)=>p.id-u.id).map((u,p)=>(u.index=p+1,u)),_.value=!1)},d=m(!0),b=async()=>{a.value=[],i.pageId=void 0,(l=>Object.keys(l).filter(p=>p!=="limit"&&p!=="_t").some(p=>l[p]!==void 0&&l[p]!==""&&l[p]!==null))(i)?d.value=!1:(d.value=!0,y()),i.pageId=void 0,await f(),h()},h=async()=>{var t,l,n;if(a.value.length<S.value/44&&a.value.length<v.total){if(i.pageId==((t=a.value[a.value.length-1])==null?void 0:t.id))return;i.pageId=((n=(l=a.value)==null?void 0:l[a.value.length-1])==null?void 0:n.id)??void 0,f(!0)}};de(async()=>{await f(),await y(),h()});const v=J({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:t,endIndex:l,page:n,pageSize:u,pageCount:p,itemCount:c}){return`已加载${a.value.length}条`+(a.value.length?d.value?` 共计 ${a.value.length>0?c??0:0} 条`:r.value==i.limit?"  预计还有更多":"  没有更多了":"")}});async function y(){const{data:t,error:l}=await xe();l||(v.pageCount=20,v.total=Number(t),v.itemCount=Number(t))}const w=t=>{P.value=t.id,$.value=t,T.value=!0};function x(t){Math.abs(t.target.scrollTop+t.target.offsetHeight-t.target.scrollHeight)<=20&&v.total>a.value.length&&E()}const E=ee.debounce(()=>{var t;if(((t=a.value)==null?void 0:t.length)<v.total){if(i.pageId==a.value[a.value.length-1].id)return;i.pageId=a.value[a.value.length-1].id,f(!0)}},300);async function k(){if(!a.value.length)return;const t=JSON.parse(JSON.stringify(a.value));console.log(t);const l=[];t.forEach(u=>{const p={};O.forEach(c=>{if(u.hasOwnProperty(c.key)){const U=c.key=="elevel"?u[c.key]!=null?D(Le[u[c.key]]):"":u[c.key];p[c.title]=U}}),l.push(p)}),be(l,500,[{wpx:120},{wpx:120},{wpx:80},{wpx:100},{wpx:100},{wpx:120},{wpx:100},{wpx:100},{wpx:500}],"原始日志_"+new Date().getTime())}return(t,l)=>{const n=Q,u=me,p=X;return Z(),pe("div",$e,[o(Pe,{model:i,"onUpdate:model":l[0]||(l[0]=c=>i=c),onSearch:b,eventsTypeDataList:e.value,collectorList:L.value,class:"mb-16px",logsoudev:g.logsoudev},null,8,["model","eventsTypeDataList","collectorList","logsoudev"]),o(p,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[o(n,null,{default:s(()=>[o(A(B),{type:"primary",size:"small",ghost:"",onClick:k,title:"导出已加载"},{default:s(()=>[N("导出已加载")]),_:1})]),_:1})]),default:s(()=>[o(u,{columns:O,data:a.value,size:"small","flex-height":!A(V).isMobile,loading:_.value,remote:"","row-key":c=>c.id,"virtual-scroll":"","scroll-x":O.reduce((c,U)=>c+U.width,0),pagination:v,class:"sm:h-full",onScroll:x,"max-height":S.value},null,8,["data","flex-height","loading","row-key","scroll-x","pagination","max-height"])]),_:1}),o(Oe,{detailVisible:T.value,"onUpdate:detailVisible":l[1]||(l[1]=c=>T.value=c),detailId:P.value,detailInfo:$.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),lt=ge(De,[["__scopeId","data-v-5c7a1905"]]);export{lt as default};
