import{d as q,n as Y,p as ee,s as le,j as x,o as Z,c as te,w as e,g as a,i as m,h as n,t as c,$ as B,F as ae,aG as ne,aZ as oe,Z as se,B as $,N as Q,O as ie,ad as X,a3 as de,r as V,av as j,A as re,e as ue,ai as ce,aj as pe,S as me,ar as fe,P as ge,Q as _e,f as ve,R as he}from"./index-CAHy1rbE.js";import{_ as ye,l as be}from"./lodash-Bb5Mhbdd.js";import{_ as xe}from"./round-search-CJzRk-ol.js";import{_ as Ce}from"./round-refresh-Vt3hK0Ql.js";import{f as Le,a as ke}from"./common-R_gsKHi_.js";import{a as Se,S as W,t as U}from"./alarm-UiJj9cxi.js";import{_ as we}from"./Cascader-Dm-I59zI.js";import{_ as Te}from"./FormItemGridItem-DHm-WNFb.js";import{_ as Ee}from"./DatePicker-BeW3vjvL.js";import{_ as Ne}from"./Grid-BeeM7t-L.js";import{x as De,y as Re}from"./events-BV0CETks.js";import{n as Ie}from"./Collection-Wnwvjk6s.js";import{e as Ae}from"./exportExcel-D6OyA9oJ.js";import{_ as Oe,a as Me}from"./DescriptionsItem-BnzyTMSr.js";import"./TimePicker-D8ULkgw8.js";import"./defineProperty-CIwHjFWx.js";const Ge={0:"KERN",1:"USER",2:"MAIL",3:"DAEMON",4:"AUTH",5:"SYSYLOG",6:"LPR",7:"NEWS",8:"UUCP",9:"CRON",10:"AUTHPRIV",11:"FTP",12:"RESERVED_12",13:"RESERVED_13",14:"RESERVED_14",15:"RESERVED_15",16:"LOCAL0",17:"LOCAL1",18:"LOCAL2",19:"LOCAL3",20:"LOCAL4",21:"LOCAL5",22:"LOCAL6",23:"LOCAL7"},ze={0:"EMERGENCY",1:"ALERT",2:"CRITICAL",3:"ERROR",4:"WARNING",5:"NOTICE",6:"INFO",7:"DEBUG"},J={logModel:Ge,logLevel:ze},Ve=q({name:"FormSearch",__name:"form-search",props:Y(["collectorList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:Y(["search"],["update:model"]),setup(v,{emit:h}){const I=g=>Object.entries(g).map(([p,k])=>({label:k,value:p}));I(J.logLevel),I(J.logModel);const R=v,E=h,{formRef:K,restoreValidation:N}=ee(),r=le(v,"model");async function t(g,p){g&&g.length>0?(r.value.startTime=g[0],r.value.endTime=g[1]):(r.value.startTime=void 0,r.value.endTime=void 0),L()}async function u(){await N(),r.value.lsid=null,r.value.leid=null,r.value.lmid=null,r.value.timeRange=null,r.value.startAndEndIp=null,ne(()=>{E("search")})}const C=x([]);async function D(){const{data:g,error:p}=await Le();p||(C.value=g,await d())}async function d(){const{data:g,error:p}=await ke();if(!p){let k=C.value.concat(g);C.value=oe(k)}}D();async function L(){E("search")}const T=ye.debounce(L,1e3,{leading:!0,trailing:!1});return(g,p)=>{const k=we,y=Te,P=se,A=Ee,H=Ce,O=$,S=xe,F=Q,l=Ne,o=ie,f=X;return Z(),te(f,{bordered:!1,size:"small",class:"card-wrapper"},{default:e(()=>[a(o,{ref_key:"formRef",ref:K,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ae(m(T),["enter"])},{default:e(()=>[a(l,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:e(()=>[a(y,{span:"24 s:24 m:8 l:8",label:"采集器",path:"lsid"},{default:e(()=>[a(k,{value:r.value.lsid,"onUpdate:value":[p[0]||(p[0]=i=>r.value.lsid=i),L],placeholder:"请选择采集器",options:R.collectorList,disabled:R.logsoudev,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options","disabled"])]),_:1}),a(y,{span:"24 s:24 m:8 l:8",label:"安全级别",path:"leid"},{default:e(()=>[a(P,{filterable:"",clearable:"",placeholder:"请选择级别",value:r.value.leid,"onUpdate:value":[p[1]||(p[1]=i=>r.value.leid=i),L],options:m(Se),"reset-menu-on-options-change":!1},null,8,["value","options"])]),_:1}),a(y,{span:"24 s:24 m:8 l:6",label:"事件类型",path:"etypeid"},{default:e(()=>[a(k,{value:r.value.lmid,"onUpdate:value":[p[2]||(p[2]=i=>r.value.lmid=i),L],clearable:"",placeholder:"请选择事件","max-tag-count":1,options:C.value,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),a(y,{span:"24 s:24 m:12 l:8",label:"时间",path:"time"},{default:e(()=>[a(A,{value:r.value.timeRange,"onUpdate:value":p[3]||(p[3]=i=>r.value.timeRange=i),clearable:"",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":t},null,8,["value"])]),_:1}),a(y,{span:"24 s:24 m:8 l:8",label:" "},{default:e(()=>[a(F,{class:"w-full"},{default:e(()=>[a(O,{onClick:u},{icon:e(()=>[a(H,{class:"text-icon"})]),default:e(()=>[n(" "+c(m(B)("common.reset")),1)]),_:1}),a(O,{type:"primary",ghost:"",onClick:m(T)},{icon:e(()=>[a(S,{class:"text-icon"})]),default:e(()=>[n(" "+c(m(B)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),je=v=>(ge("data-v-fedc9fee"),v=v(),_e(),v),Ue={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},$e=je(()=>ve("hr",{style:{"border-color":"#ccc","margin-bottom":"20px"}},null,-1));function Be(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!ce(v)}const Pe=q({name:"eventalarm_generallog",__name:"index",props:{logsoudev:{},aip:{}},setup(v){const h=v,I=de(),R=x(window.innerHeight-395),E=x([]);(async()=>{const{data:l,error:o}=await Ie({page:1,limit:1e3,_t:new Date().getTime()});if(o)console.error("获取采集器列表失败:",o);else{const f=l;E.value=f.list.map(i=>({...i,id:i.id,type:i.cname}))}})();const N=x(!1),r=J,t=V({lsid:void 0,lsdn:"",rdbtime:"",lmid:void 0,leid:void 0,ltext:"",aname:"",procid:"",msgid:"",dbtime:"",hname:"",lcon:"",ip:"",lsip:"",priority:"",type:"",version:"",logtype:void 0,index:0,gsubject:"",gdescribe:"",gresult:"",level:0,eids:"",epids:""}),u=V({pageId:void 0,pageSize:100,lsid:void 0,leid:void 0,lmid:void 0,startTime:void 0,endTime:void 0,startIp:void 0,endIp:void 0,_t:new Date().getTime()}),C=V([{title:"序号",key:"index",width:80,align:"center",render:l=>`${l.index}`},{key:"type",title:"采集器名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gsubject",title:"事件主体",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"gdescribe",title:"事件描述",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"gresult",title:"事件结果",align:"center",width:140,ellipsis:{tooltip:!0},render:l=>{var o,f;return a(j,{size:"small",type:(o=l.gresult)!=null&&o.includes("成功")?"success":(f=l.gresult)!=null&&f.includes("失败")?"error":"warning"},{default:()=>[l.gresult]})}},{key:"level",title:"安全级别",align:"center",width:140,render:l=>{const o=W[l.level];let f={color:U[l.level],textColor:"#ffffff",borderColor:U[l.level]};return a(j,{size:"small",color:f},Be(o)?o:{default:()=>[o]})}},{key:"epids",title:"事件类别",align:"center",width:120},{key:"eids",title:"事件类型",align:"center",width:120},{key:"hname",title:"主机名称",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"dbtime",title:"日志时间",align:"center",width:160},{key:"operate",title:B("common.operate"),align:"center",width:120,fixed:"right",render:l=>a("div",{class:"flex-center gap-8px"},[a($,{type:"info",ghost:!0,size:"small",onClick:()=>p(l)},{default:()=>[n("详情")]})])}]),D=x(!1),d=x([]),L=x(0),T=async(l=!1)=>{if(!D.value)D.value=!0;else return;h.logsoudev&&h.aip&&(y.value=!1,u.lsid=h.logsoudev,u.startAndEndIp=[h.aip,h.aip],u.startIp=h.aip,u.endIp=h.aip);const{data:o,error:f}=await De(u);f||(L.value=o.length,l?d.value=[...d.value,...o]:d.value=o,d.value=d.value.sort((i,b)=>b.id-i.id).map((i,b)=>(i.index=b+1,i)),D.value=!1)},g=async()=>{const{data:l,error:o}=await Re({_t:new Date().getTime()});S.total=Number(l),S.itemCount=Number(l)};function p(l){t.lsid=l.lsid,t.lsdn=l.lsdn,t.rdbtime=l.rdbtime,t.lmid=l.lmid,t.leid=l.leid,t.ltext=l.ltext,t.aname=l.aname,t.procid=l.procid,t.msgid=l.msgid,t.dbtime=l.dbtime,t.hname=l.hname,t.lcon=l.lcon,t.ip=l.ip,t.lsip=l.lsip,t.priority=l.priority,t.type=l.type,t.version=l.version,t.logtype=l.logtype,t.gsubject=l.gsubject,t.gdescribe=l.gdescribe,t.gresult=l.gresult,t.level=l.level,t.eids=l.eids,t.epids=l.epids,N.value=!0}const k=x(),y=x(!0),P=async()=>{d.value=[],u.lsid||u.leid||u.lmid||u.startIp||u.endIp||u.startTime||u.endTime?y.value=!1:(y.value=!0,g()),u.pageId=void 0,await T(),A()},A=async()=>{var l,o;if(d.value.length<R.value/44&&d.value.length<S.total){if(u.pageId==d.value[d.value.length-1].id)return;u.pageId=((o=(l=d.value)==null?void 0:l[d.value.length-1])==null?void 0:o.id)??void 0,T(!0)}};re(async()=>{await T(),await g(),A()});function H(l){Math.abs(l.target.scrollTop+l.target.offsetHeight-l.target.scrollHeight)<=20&&S.total>d.value.length&&O()}const O=be.debounce(()=>{var l,o;if(d.value.length<S.total){if(u.pageId==d.value[d.value.length-1].id)return;u.pageId=((o=(l=d.value)==null?void 0:l[d.value.length-1])==null?void 0:o.id)??void 0,T(!0)}},300),S=V({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:l,endIndex:o,page:f,pageSize:i,pageCount:b,itemCount:s}){return`已加载${d.value.length}条`+(d.value.length?y.value?` 共计 ${d.value.length>0?s??0:0} 条`:L.value==u.pageSize?"  预计还有更多":"  没有更多了":"")}});async function F(){if(!d.value.length)return;const l=JSON.parse(JSON.stringify(d.value)),o=[];l.forEach(i=>{const b={};C.forEach(s=>{var M,G,z;if(i.hasOwnProperty(s.key)){const _=s.key==="lmid"?((M=r.logModel)==null?void 0:M[i[s.key]])??null:s.key==="leid"?((G=r.logLevel)==null?void 0:G[i[s.key]])??null:s.key==="lsid"?(z=E.value.map(w=>w.data).flat(2).find(w=>w.id==i[s.key]))==null?void 0:z.type:s.key==="level"?W[i[s.key]]??null:s.key=="ltext"?i.ltext+i.lcon:i[s.key];b[s.title]=_}}),o.push(b)}),Ae(o,500,[{wpx:120},{wpx:120},{wpx:160},{wpx:80},{wpx:80},{wpx:100},{wpx:100},{wpx:100},{wpx:400}],"通用日志_"+new Date().getTime())}return(l,o)=>{const f=Q,i=pe,b=X,s=Oe,M=Me,G=me,z=fe;return Z(),ue("div",Ue,[a(Ve,{model:u,"onUpdate:model":o[0]||(o[0]=_=>u=_),onSearch:P,collectorList:E.value,logsoudev:h.logsoudev},null,8,["model","collectorList","logsoudev"]),a(b,{title:"通用日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":e(()=>[a(f,null,{default:e(()=>[a(m($),{type:"primary",size:"small",ghost:"",onClick:F,title:"导出已加载"},{default:e(()=>[n("导出已加载")]),_:1})]),_:1})]),default:e(()=>[a(i,{ref_key:"tableContainerRef",ref:k,columns:C,data:d.value,size:"small","flex-height":!m(I).isMobile,"scroll-x":C.reduce((_,w)=>_+w.width,0),loading:D.value,remote:"","row-key":_=>_.index,showTotal:"","max-height":R.value,"virtual-scroll":"",pagination:S,class:"sm:h-full",onScroll:H},null,8,["columns","data","flex-height","scroll-x","loading","row-key","max-height","pagination"])]),_:1}),a(z,{show:N.value,"onUpdate:show":o[2]||(o[2]=_=>N.value=_),title:"日志详情",preset:"card",class:"w-800px"},{footer:e(()=>[a(f,{justify:"end",size:16},{default:e(()=>[a(m($),{type:"primary",onClick:o[1]||(o[1]=_=>{N.value=!1})},{default:e(()=>[n(c(m(B)("common.confirm")),1)]),_:1})]),_:1})]),default:e(()=>[$e,a(G,{class:"h-480px pr-20px"},{default:e(()=>[a(M,{"label-placement":"left","label-style":{width:"120px"},bordered:"",column:1},{default:e(()=>[a(s,null,{label:e(()=>[n(" 采集器名称 ")]),default:e(()=>[n(" "+c(t.type),1)]),_:1}),a(s,null,{label:e(()=>[n(" 事件主体 ")]),default:e(()=>[n(" "+c(t.gsubject),1)]),_:1}),a(s,null,{label:e(()=>[n(" 事件描述 ")]),default:e(()=>[n(" "+c(t.gdescribe),1)]),_:1}),a(s,null,{label:e(()=>[n(" 事件结果 ")]),default:e(()=>{var _,w;return[a(m(j),{size:"small",type:(_=t==null?void 0:t.gresult)!=null&&_.includes("成功")?"success":(w=t==null?void 0:t.gresult)!=null&&w.includes("失败")?"error":"warning"},{default:e(()=>[n(c(t==null?void 0:t.gresult),1)]),_:1},8,["type"])]}),_:1}),a(s,null,{label:e(()=>[n(" 安全级别 ")]),default:e(()=>[a(m(j),{size:"small",color:{color:m(U)[t.level],textColor:"#ffffff",borderColor:m(U)[t.level]}},{default:e(()=>[n(c(m(W)[t.level]),1)]),_:1},8,["color"])]),_:1}),a(s,null,{label:e(()=>[n(" 事件类别 ")]),default:e(()=>[n(" "+c(t.epids),1)]),_:1}),a(s,null,{label:e(()=>[n(" 事件类型 ")]),default:e(()=>[n(" "+c(t.eids),1)]),_:1}),a(s,null,{label:e(()=>[n(" 日志时间 ")]),default:e(()=>[n(" "+c(t.dbtime),1)]),_:1}),a(s,null,{label:e(()=>[n(" 接收时间 ")]),default:e(()=>[n(" "+c(t.rdbtime),1)]),_:1}),a(s,null,{label:e(()=>[n(" 模块 ")]),default:e(()=>[n(" "+c(m(r).logModel[t.lmid]),1)]),_:1}),a(s,null,{label:e(()=>[n(" 级别 ")]),default:e(()=>[n(" "+c(m(r).logLevel[t.leid]),1)]),_:1}),a(s,null,{label:e(()=>[n(" 应用名称 ")]),default:e(()=>[n(" "+c(t.aname),1)]),_:1}),a(s,null,{label:e(()=>[n(" PROCID ")]),default:e(()=>[n(" "+c(t.procid),1)]),_:1}),a(s,null,{label:e(()=>[n(" MSGID ")]),default:e(()=>[n(" "+c(t.msgid||"--"),1)]),_:1}),a(s,null,{label:e(()=>[n(" 日志时间 ")]),default:e(()=>[n(" "+c(t.dbtime),1)]),_:1}),a(s,null,{label:e(()=>[n(" 主机名称 ")]),default:e(()=>[n(" "+c(t.hname),1)]),_:1}),a(s,null,{label:e(()=>[n(" 结构数据 ")]),default:e(()=>[n(" -- ")]),_:1}),a(s,null,{label:e(()=>[n(" 日志内容 ")]),default:e(()=>[n(" "+c(t.lcon),1)]),_:1}),a(s,{span:2},{label:e(()=>[n(" 日志原文 ")]),default:e(()=>[n(" "+c(t.logtype?t.ltext:t.ltext+(t.lcon?t.lcon:"")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),sl=he(Pe,[["__scopeId","data-v-fedc9fee"]]);export{sl as default};
