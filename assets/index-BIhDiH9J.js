import{d as ee,i as P,H as y,b2 as _,a as K,b as te,o as D,f as o,w as s,N as ae,c as W,s as H,aK as ne,g as C,B as oe,T as le,W as se,aH as re,h as p,Z as ue,cP as ie,cQ as me,cN as ce,fc as de,aX as ye,b4 as pe}from"./index-B5bfYqYu.js";import{u as ke}from"./usePageData-CSSGTaJe.js";import{_ as ve}from"./RadioButton-dJpuoutC.js";import{_ as ge}from"./DatePicker-Ci-3g9TK.js";const fe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ne=ee({name:"reportmanagement_userdatareport",__name:"index",setup(he){const{pageData:L,getData:O}=ke(pe);P(()=>{O({usertypes:"2,3"})});const l=y({dates:void 0,statrtTime:null,endTime:null}),u=y({dayTime:null,weekTime:null,monthTime:null}),m=y("day"),A=t=>{const e=new Date;if(e.setHours(0,0,0,0),t==="day"){const n=_(0,e.getTime());u.value.dayTime=n,l.value.dates=n}else if(t==="week"){u.value.weekTime=ie();const{start:n,end:r}=me(new Date().getTime());l.value.startTime=n,l.value.endTime=_(0,new Date(r).getTime())}else if(t==="month"){const n=_(3,e.getTime());u.value.monthTime=n,l.value.dates=n}k()},F=t=>{l.value.dates=t,k()},G=async t=>{const{monday:e,sunday:n}=ce(t);l.value.startTime=e,l.value.endTime=_(0,new Date(n)),k()},I=t=>{l.value.dates=t,k()},j=y({}),J=y({}),k=async()=>{const t={dates:m.value!=="week"?l.value.dates:void 0,startTime:m.value=="week"?l.value.startTime:void 0,endTime:m.value=="week"?l.value.endTime:void 0},{data:e}=await de(t);e&&(j.value=e,J.value=JSON.parse(JSON.stringify(e)))};P(()=>{const e=_(0,new Date().getTime());l.value.dates=e,u.value.dayTime=e,k()});const B=y({daily:null,weekly:null,project:null,clockin:null}),w=(t,e)=>{var i;if(!t||!t.order){B.value[e]=null;return}const n=t.columnKey??t.key??((i=t.column)==null?void 0:i.key)??t.field??null,r=t.order;B.value[e]=n?{columnKey:n,order:r}:null},b=(t,e)=>K(()=>{const n=L.data??[],r=Array.isArray(j.value[t])?j.value[t]:[],i=n.map(d=>{const g=r.find(a=>a.creater===d.id);return g?{...d,...g}:{...d,...e}}),v=B.value[t];if(!v||!v.columnKey)return i;const x=v.columnKey,c=v.order;return i.slice().sort((d,g)=>{const a=d[x],h=g[x],M=typeof a=="number"?a:Number(a),S=typeof h=="number"?h:Number(h);if(!Number.isNaN(M)&&!Number.isNaN(S))return c==="ascend"?M-S:S-M;const V=a==null?"":String(a),R=h==null?"":String(h);return V===R?0:c==="ascend"?V>R?1:-1:V<R?1:-1})}),U={reportcount:0,avgcharctras:0,totalscore:0,avgscore:0,lowcount:0,mediumcount:0,highcount:0},q=b("daily",U),E=b("weekly",U),Q=b("project",U),X=K(()=>b("clockin",{clockinnormal:0,clockinabnormal:0,normalscore:0,abnormalscore:0}).value.map(e=>{const n=Number(e.normalscore||0),r=Number(e.abnormalscore||0);return{...e,total:n+r}})),T=t=>[{key:"username",title:"调试人",width:120,align:"center",render(e){return o("div",{class:"flex items-center justify-center"},[o(ye,{width:"40",height:"40","preview-disabled":!0,src:e.userimage||"https://pictures.linkqi.cn/work-project/image/656c9f43-e1b0-42a5-a480-d8695aaba7823098852561625908631.png",class:"rounded-md object-cover"},null),o("span",null,[e.username])])}},...t.map(e=>({key:e.key,title:e.title,align:e.align??"center",sorter:!0,width:e.width??120,render:n=>{const r=n[e.key];return o("div",null,[r??0])}}))],Y=T([{key:"reportcount",title:"日报总数"},{key:"avgcharctras",title:"平均字符数"},{key:"totalscore",title:"总得分"},{key:"avgscore",title:"平均得分"},{key:"lowcount",title:"合格次数"},{key:"mediumcount",title:"良好次数"},{key:"highcount",title:"优秀次数"}]),Z=T([{key:"reportcount",title:"周报总数"},{key:"avgcharctras",title:"平均字符数"},{key:"totalscore",title:"总得分"},{key:"avgscore",title:"平均得分"},{key:"lowcount",title:"合格次数"},{key:"mediumcount",title:"良好次数"},{key:"highcount",title:"优秀次数"}]),$=T([{key:"reportcount",title:"项目总结总数"},{key:"avgcharctras",title:"平均字符数"},{key:"totalscore",title:"总得分"},{key:"avgscore",title:"平均得分"},{key:"lowcount",title:"合格次数"},{key:"mediumcount",title:"良好次数"},{key:"highcount",title:"优秀次数"}]),z=T([{key:"clockinnormal",title:"正常打卡次数"},{key:"clockinabnormal",title:"异常打卡次数"},{key:"normalscore",title:"正常分数"},{key:"abnormalscore",title:"异常分数"},{key:"total",title:"总分数"}]),N=y(window.innerHeight-325);return(t,e)=>{const n=ve,r=ne,i=ge,v=oe,x=ae,c=re,f=se,d=le,g=ue;return D(),te("div",fe,[o(g,{bordered:"",style:{height:"100%"}},{default:s(()=>[o(x,{label:"查询日期","label-placement":"left","show-feedback":!1,class:"mb-15px"},{default:s(()=>[o(r,{value:m.value,"onUpdate:value":[e[0]||(e[0]=a=>m.value=a),A],style:{"margin-right":"20px"}},{default:s(()=>[o(n,{value:"day"},{default:s(()=>e[8]||(e[8]=[C("天")])),_:1,__:[8]}),o(n,{value:"week"},{default:s(()=>e[9]||(e[9]=[C("周")])),_:1,__:[9]}),o(n,{value:"month"},{default:s(()=>e[10]||(e[10]=[C("月")])),_:1,__:[10]})]),_:1},8,["value"]),m.value==="day"?(D(),W(i,{key:0,"formatted-value":u.value.dayTime,"onUpdate:formattedValue":[e[1]||(e[1]=a=>u.value.dayTime=a),F],type:"date","value-format":"yyyy-MM-dd",style:{width:"200px"}},null,8,["formatted-value"])):H("",!0),m.value==="week"?(D(),W(i,{key:1,"formatted-value":u.value.weekTime,"onUpdate:formattedValue":[e[2]||(e[2]=a=>u.value.weekTime=a),G],type:"week",style:{width:"200px"}},null,8,["formatted-value"])):H("",!0),m.value==="month"?(D(),W(i,{key:2,"formatted-value":u.value.monthTime,"onUpdate:formattedValue":[e[3]||(e[3]=a=>u.value.monthTime=a),I],type:"month","value-format":"yyyy-MM",style:{width:"200px"}},null,8,["formatted-value"])):H("",!0),o(v,{type:"primary",ghost:"",style:{"margin-left":"20px"},onClick:k},{default:s(()=>e[11]||(e[11]=[C("查询")])),_:1,__:[11]})]),_:1}),o(d,{type:"segment",animated:""},{default:s(()=>[o(f,{name:"daily",tab:"日报数据报表"},{default:s(()=>[o(c,{columns:p(Y),data:p(q),"max-height":N.value,"onUpdate:sorter":e[4]||(e[4]=a=>w(a,"daily"))},null,8,["columns","data","max-height"])]),_:1}),o(f,{name:"weekly",tab:"周报数据报表"},{default:s(()=>[o(c,{columns:p(Z),data:p(E),"max-height":N.value,"onUpdate:sorter":e[5]||(e[5]=a=>w(a,"weekly"))},null,8,["columns","data","max-height"])]),_:1}),o(f,{name:"project",tab:"项目总结数据报表"},{default:s(()=>[o(c,{columns:p($),data:p(Q),"max-height":N.value,"onUpdate:sorter":e[6]||(e[6]=a=>w(a,"project"))},null,8,["columns","data","max-height"])]),_:1}),o(f,{name:"clockin",tab:"打卡数据报表"},{default:s(()=>[o(c,{columns:p(z),data:X.value,"max-height":N.value,"onUpdate:sorter":e[7]||(e[7]=a=>w(a,"clockin"))},null,8,["columns","data","max-height"])]),_:1})]),_:1})]),_:1})])}}});export{Ne as default};
