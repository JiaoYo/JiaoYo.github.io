import{_ as J}from"./table-header-operation.vue_vue_type_script_setup_true_lang-uYYUtpnK.js";import{d as G,n as M,j as W,s as Z,p as Q,q as X,b as Y,r as ee,ae as te,o as S,c as O,w as s,g as t,h as $,t as j,i as a,$ as y,e as L,ao as oe,G as V,Z as ae,K as le,J as ne,ap as se,O as ie,B,N as re,af as de,ag as pe,a3 as ue,E as A,D as E,ah as I,ai as ce,aj as me,ad as fe}from"./index-DcNLSryS.js";import{D as ye,E as _e,a as ve,F as ge}from"./events-BTAQ2OU2.js";import{u as we,a as be}from"./table-Bjosh10B.js";import{h as q}from"./permission-C7edkPh0.js";import{_ as he}from"./Popconfirm-Gz1bdXnB.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-BzeU6240.js";import"./setting-outlined-e5_d7SZ_.js";import"./export-_OdKzp-M.js";import"./refresh-B8VT0tb7.js";import"./round-delete-K5jUF-_n.js";import"./round-plus-ZONQTaD-.js";import"./Upload-S0GAAfBt.js";import"./Progress-BAlrfBaK.js";const De=G({name:"OperateDrawer",__name:"operate-drawer",props:M({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:M(["submitted"],["update:visible"]),setup(_,{emit:P}){const m=_,v=W([{label:"syslog",value:0},{label:"SNMP Trap",value:1}]),g=P,p=Z(_,"visible"),{formRef:N,validate:T,restoreValidation:z}=Q(),{defaultRequiredRule:H,formRules:w}=X(),U=Y(()=>({add:"新增转发策略",edit:"编辑转发策略"})[m.operateType]),e=ee(x());function x(){return{ftype:0,community:"",etpnode:"",oidnode:"",ipaddr:"",fport:null,fdesc:"",dtype:null}}const C={ipaddr:w.ip,fport:{type:"number",required:!0,trigger:["blur","change"],message:"请输入端口号"}};function f(){Object.assign(e,x()),m.operateType==="edit"&&m.rowData&&Object.assign(e,m.rowData)}function b(){p.value=!1}async function F(){var h,o;if(await T(),m.operateType==="add"){const{data:D,error:r}=await ye([{ftype:e.ftype,community:e.community,etpnode:e.etpnode,oidnode:e.oidnode,ipaddr:e.ipaddr,fport:e.fport,fdesc:e.fdesc,dtype:e.dtype}]);r||((h=window.$message)==null||h.success(y("common.addSuccess")),b(),g("submitted"))}else{const{data:D,error:r}=await _e([{id:m.rowData.id,ftype:e.ftype,community:e.community,etpnode:e.etpnode,oidnode:e.oidnode,ipaddr:e.ipaddr,fport:e.fport,fdesc:e.fdesc,dtype:e.dtype}]);r||((o=window.$message)==null||o.success(y("common.updateSuccess")),b(),g("submitted"))}}return te(p,()=>{p.value&&(f(),z())}),(h,o)=>{const D=ae,r=le,u=ne,i=se,l=ie,d=B,k=re,R=de,c=pe;return S(),O(c,{show:p.value,"onUpdate:show":o[8]||(o[8]=n=>p.value=n),"display-directive":"show",width:360},{default:s(()=>[t(R,{title:U.value,"native-scrollbar":!1,closable:""},{footer:s(()=>[t(k,{size:16},{default:s(()=>[t(d,{onClick:b},{default:s(()=>[$(j(a(y)("common.cancel")),1)]),_:1}),t(d,{type:"primary",onClick:F},{default:s(()=>[$(j(a(y)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[t(l,{ref_key:"formRef",ref:N,model:e,rules:C},{default:s(()=>[t(r,{label:"转发方式",path:"ftype"},{default:s(()=>[t(D,{filterable:"",value:e.ftype,"onUpdate:value":o[0]||(o[0]=n=>e.ftype=n),placeholder:"请选择转发方式",options:v.value,style:{width:"100%"}},null,8,["value","options"])]),_:1}),e.ftype==1?(S(),L(oe,{key:0},[t(r,{label:"Community",path:"community"},{default:s(()=>[t(u,{value:e.community,"onUpdate:value":o[1]||(o[1]=n=>e.community=n),placeholder:"请输入community",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"企业节点号",path:"etpnode"},{default:s(()=>[t(u,{value:e.etpnode,"onUpdate:value":o[2]||(o[2]=n=>e.etpnode=n),placeholder:"请输入企业节点号",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"oid节点号",path:"oidnode"},{default:s(()=>[t(u,{value:e.oidnode,"onUpdate:value":o[3]||(o[3]=n=>e.oidnode=n),placeholder:"请输入oid节点号",clearable:""},null,8,["value"])]),_:1})],64)):V("",!0),e.ftype==0?(S(),O(r,{key:1,label:"设备类型"},{default:s(()=>[t(u,{value:e.dtype,"onUpdate:value":o[4]||(o[4]=n=>e.dtype=n),placeholder:"请输入设备类型",maxlength:"6",clearable:""},null,8,["value"])]),_:1})):V("",!0),t(r,{label:"其它服务器IP",path:"ipaddr"},{default:s(()=>[t(u,{value:e.ipaddr,"onUpdate:value":o[5]||(o[5]=n=>e.ipaddr=n),placeholder:"请输入其它服务器IP",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"端口号",path:"fport"},{default:s(()=>[t(i,{min:0,max:65535,value:e.fport,"onUpdate:value":o[6]||(o[6]=n=>e.fport=n),placeholder:"请输入端口号",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1}),t(r,{label:"描述",path:"fdesc"},{default:s(()=>[t(u,{type:"textarea",value:e.fdesc,"onUpdate:value":o[7]||(o[7]=n=>e.fdesc=n),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function K(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!ce(_)}const $e=G({name:"manage_forwardserver",__name:"index",setup(_){const P=ue(),{columns:m,columnChecks:v,data:g,getData:p,loading:N,mobilePagination:T,searchParams:z,resetSearchParams:H}=we({apiFn:ve,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"ftype",title:"转发方式",align:"center",width:160,render:i=>i.ftype==0?"syslog":"SNMP Trap"},{key:"ipaddr",title:"其它服务器IP",align:"center",width:200},{key:"fport",title:"端口号",align:"center",width:140},{key:"fdesc",title:"用户描述",align:"center",minWidth:180,ellipsis:{tooltip:!0}},{key:"operate",title:y("common.operate"),align:"center",render:i=>{let l;return t("div",{class:"flex-center gap-8px"},[A(t(B,{type:"primary",ghost:!0,size:"small",onClick:()=>r(i.id)},K(l=y("common.edit"))?l:{default:()=>[l]}),[[E("no-auth"),"sys.forward.policy.update"]]),t(he,{onPositiveClick:()=>D(i.id)},{default:()=>y("common.confirmDelete"),trigger:()=>{let d;return A(t(B,{type:"error",ghost:!0,size:"small"},K(d=y("common.delete"))?d:{default:()=>[d]}),[[E("no-auth"),"sys.forward.policy.delete"]])}})])}}]}),{drawerVisible:w,operateType:U,editingData:e,handleAdd:x,handleEdit:C,checkedRowKeys:f,onBatchDeleted:b,onDeleted:F,closeDrawer:h}=be(g,p);async function o(){console.log(f.value),u(f.value,i=>{b()})}function D(i){console.log(i),u([i],l=>{F()})}function r(i){C(i)}async function u(i,l){const{data:d,error:k}=await ge(i);if(!k)l&&l(d);else return!1}return(i,l)=>{const d=J,k=me,R=fe;return S(),L("div",ke,[t(R,{title:"转发策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[t(d,{columns:a(v),"onUpdate:columns":l[0]||(l[0]=c=>I(v)?v.value=c:null),"disabled-delete":a(f).length===0,loading:a(N),onAdd:a(x),onDelete:o,onRefresh:a(p),"is-view-add-button":a(q)("sys.forward.policy.insert"),"is-view-delete-button":a(q)("sys.forward.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:s(()=>[t(k,{"checked-row-keys":a(f),"onUpdate:checkedRowKeys":l[1]||(l[1]=c=>I(f)?f.value=c:null),columns:a(m),data:a(g),size:"small","flex-height":!a(P).isMobile,"scroll-x":962,loading:a(N),remote:"","row-key":c=>c.id,pagination:a(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(De,{visible:a(w),"onUpdate:visible":l[2]||(l[2]=c=>I(w)?w.value=c:null),"operate-type":a(U),"row-data":a(e),onSubmitted:a(p)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{$e as default};
