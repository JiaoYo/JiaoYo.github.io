import{_ as ee}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CNvMu_67.js";import{d as P,q as j,v as E,s as G,K as U,o as V,c as W,w as n,g as e,i as t,T as L,ae as H,L as F,h as O,t as I,$ as p,M as te,W as Y,A as J,B as M,E as Q,D as X,a8 as Z,x as oe,b as ne,r as ae,y as se,C as le,a9 as ie,aa as re,Y as ce,aj as pe,e as de,ab as B,ac as ue}from"./index-B6CaFrdK.js";import{u as me,a as _e}from"./table-CxpHUsNu.js";import{n as fe,o as ye,f as he,p as ve}from"./asset-DEQXBhu1.js";import{_ as ge}from"./round-search-D3Y2ilQp.js";import{_ as be}from"./round-refresh-xFEcy0W1.js";import{_ as we}from"./FormItemGridItem-B1S8z6D6.js";import{_ as De}from"./Grid-Bc3MJ5ql.js";import{h as K}from"./permission-BcmavzPm.js";import{_ as ke}from"./Popconfirm-BIStIxu6.js";import{_ as xe}from"./DataTable-Bk5Sz1vp.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-pnbItTZN.js";import"./setting-outlined-D16aXhtm.js";import"./round-delete-Dd-8paeC.js";import"./refresh-CHQEe237.js";import"./round-plus-CgS0-xG0.js";import"./Upload-C6sOqKwB.js";import"./Progress-DNXes38q.js";import"./Forward-CrI4707i.js";const Ne=P({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(m,{emit:S}){const r=S,{formRef:v,restoreValidation:d}=E(),l=G(m,"model");function k(){l.value.fuzzy="",r("search")}async function z(){await d(),r("reset")}async function _(){r("search")}return($,o)=>{const x=Y,b=we,C=J,w=be,c=M,g=ge,i=Q,N=De,u=X,T=Z,R=U("no-space");return V(),W(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(u,{ref_key:"formRef",ref:v,model:l.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(_,["enter"])},{default:n(()=>[e(N,{responsive:"screen","item-responsive":""},{default:n(()=>[e(b,{span:"24 s:12 m:6",label:"一级资产分类",path:"pid",class:"pr-24px"},{default:n(()=>[e(x,{filterable:"",clearable:"",value:l.value.pid,"onUpdate:value":[o[0]||(o[0]=f=>l.value.pid=f),_],placeholder:"请选择一级资产分类",options:t(L)(t(H)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(b,{span:"24 s:12 m:6",label:"名称",path:"fuzzy",class:"pr-24px"},{default:n(()=>[F(e(C,{clearable:"",value:l.value.fuzzy,"onUpdate:value":o[1]||(o[1]=f=>l.value.fuzzy=f),placeholder:"请输入资产二级分类名称",onClear:k},null,8,["value"]),[[R]])]),_:1}),e(b,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[e(i,{class:"w-full"},{default:n(()=>[e(c,{onClick:z},{icon:n(()=>[e(w,{class:"text-icon"})]),default:n(()=>[O(" "+I(t(p)("common.reset")),1)]),_:1}),e(c,{type:"primary",ghost:"",onClick:_},{icon:n(()=>[e(g,{class:"text-icon"})]),default:n(()=>[O(" "+I(t(p)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Se=P({name:"OperateDrawer",__name:"operate-drawer",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(m,{emit:S}){const r=m,v=S,d=G(m,"visible"),{formRef:l,validate:k,restoreValidation:z}=E(),{defaultRequiredRule:_}=oe(),$=ne(()=>({add:"新增资产类型",edit:"编辑资产类型"})[r.operateType]),o=ae(x());function x(){return{pid:void 0,aname:"",sysv:1}}const b={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择资产一级分类"},aname:_};function C(){Object.assign(o,x()),r.operateType==="edit"&&r.rowData&&Object.assign(o,r.rowData)}function w(){d.value=!1}async function c(){var g,i;if(await k(),r.operateType==="add"){const{data:N,error:u}=await fe([{pid:o.pid,aname:o.aname,sysv:o.sysv}]);u||((g=window.$message)==null||g.success(p("common.addSuccess")),w(),v("submitted"))}else{const{data:N,error:u}=await ye([{id:r.rowData.id,pid:o.pid,aname:o.aname,sysv:o.sysv}]);u||((i=window.$message)==null||i.success(p("common.updateSuccess")),w(),v("submitted"))}}return se(d,()=>{d.value&&(C(),z())}),(g,i)=>{const N=Y,u=le,T=J,R=X,f=M,s=Q,a=ie,y=re,A=U("no-space");return V(),W(y,{show:d.value,"onUpdate:show":i[2]||(i[2]=D=>d.value=D),"display-directive":"show",width:450},{default:n(()=>[e(a,{title:$.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(s,{size:16},{default:n(()=>[e(f,{onClick:w},{default:n(()=>[O(I(t(p)("common.cancel")),1)]),_:1}),e(f,{type:"primary",onClick:c},{default:n(()=>[O(I(t(p)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(R,{ref_key:"formRef",ref:l,model:o,rules:b},{default:n(()=>[e(u,{label:"资产一级分类",path:"pid"},{default:n(()=>[e(N,{filterable:"",value:o.pid,"onUpdate:value":i[0]||(i[0]=D=>o.pid=D),placeholder:"请选择资产一级分类",options:t(L)(t(H)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),e(u,{label:"资产二级分类",path:"aname"},{default:n(()=>[F(e(T,{value:o.aname,"onUpdate:value":i[1]||(i[1]=D=>o.aname=D),placeholder:"请输入资产二级分类"},null,8,["value"]),[[A]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function q(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!ue(m)}const Le=P({name:"assetmanagement_assetgroup",__name:"index",setup(m){const S=ce(),{columns:r,columnChecks:v,data:d,getData:l,loading:k,mobilePagination:z,searchParams:_,resetSearchParams:$}=me({apiFn:he,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,pid:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"pid",title:"资产一级分类",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:s=>p(pe[s.pid])},{key:"aname",title:"资产二级分类",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"operate",title:p("common.operate"),align:"center",width:160,render:s=>{let a;return s.sysv!=0?e("div",{class:"flex-center gap-8px"},[F(e(M,{type:"primary",ghost:!0,size:"small",onClick:()=>T(s.id)},q(a=p("common.edit"))?a:{default:()=>[a]}),[[U("no-auth"),"sys.asset.type.update"]]),e(ke,{onPositiveClick:()=>R(s.id)},{default:()=>p("common.confirmDelete"),trigger:()=>{let y;return F(e(M,{type:"error",ghost:!0,size:"small"},q(y=p("common.delete"))?y:{default:()=>[y]}),[[U("no-auth"),"sys.asset.type.delete"]])}})]):null}}]}),{drawerVisible:o,operateType:x,editingData:b,handleAdd:C,handleEdit:w,checkedRowKeys:c,onBatchDeleted:g,onDeleted:i,closeDrawer:N}=_e(d,l);async function u(){console.log(c.value),f(c.value,s=>{g()})}function T(s){w(s)}function R(s){f([s],a=>{i()})}async function f(s,a){const{data:y,error:A}=await ve(s);if(!A)a&&a(y);else return!1}return(s,a)=>{const y=ee,A=xe,D=Z;return V(),de("div",ze,[e(Ne,{model:t(_),"onUpdate:model":a[0]||(a[0]=h=>B(_)?_.value=h:null),onReset:t($),onSearch:t(l)},null,8,["model","onReset","onSearch"]),e(D,{title:"资产类型",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[e(y,{columns:t(v),"onUpdate:columns":a[1]||(a[1]=h=>B(v)?v.value=h:null),"disabled-delete":t(c).length===0,loading:t(k),onAdd:t(C),onDelete:u,onRefresh:t(l),"is-view-add-button":t(K)("sys.asset.type.insert"),"is-view-delete-button":t(K)("sys.asset.type.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:n(()=>[e(A,{"checked-row-keys":t(c),"onUpdate:checkedRowKeys":a[2]||(a[2]=h=>B(c)?c.value=h:null),columns:t(r),data:t(d),size:"small","flex-height":!t(S).isMobile,"scroll-x":962,loading:t(k),remote:"","row-key":h=>h.id,pagination:t(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Se,{visible:t(o),"onUpdate:visible":a[3]||(a[3]=h=>B(o)?o.value=h:null),"operate-type":t(x),"row-data":t(b),onSubmitted:t(l)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Le as default};
