import{_ as Z}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Dv_clQNA.js";import{bi as P,d as V,q as j,s as E,v as G,x as ee,b as te,r as oe,y as ne,L as F,o as A,c as L,w as o,g as e,h as I,t as M,i as t,$ as d,N as H,M as U,A as W,C as ae,D as J,B as O,E as Q,ab as se,ac as le,aa as X,a0 as re,e as ie,ad as B,ae as ce}from"./index-CXJ7AQei.js";import{u as me,a as ue}from"./table-L4ZByng_.js";import{_ as de}from"./round-search-Dcl_LlCU.js";import{_ as pe}from"./round-refresh-ChJ-oMzM.js";import{_ as _e}from"./FormItemGridItem-BdFekX4I.js";import{_ as fe}from"./Grid-cHbn5tWF.js";import{h as K}from"./permission-DlfzHt7N.js";import{_ as he}from"./Popconfirm-DY78AwkW.js";import{_ as ye}from"./DataTable-ByDnShuV.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-B0zfI2c9.js";import"./setting-outlined-C5Y1YjFA.js";import"./export-DgHVdlYo.js";import"./refresh-DrCcO5M8.js";import"./round-delete-BiJxK7yA.js";import"./round-plus-DPUpje-i.js";import"./Upload-DytixMTy.js";import"./Progress-DQdwNQul.js";import"./Forward-lIzUVZHl.js";function ge(a){return P({url:"/manu/selectPage.do",method:"get",params:a})}function ve(a){return P({url:"/manu/insert.do",method:"post",data:a})}function we(a){return P({url:"/manu/update.do",method:"post",data:a})}function be(a){return P({url:"/manu/delete.do",method:"get",params:{ids:a.join(",")}})}const De=V({name:"OperateDrawer",__name:"operate-drawer",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(a,{emit:N}){const r=a,h=N,u=E(a,"visible"),{formRef:i,validate:b,restoreValidation:z}=G(),{defaultRequiredRule:y}=ee(),T=te(()=>({add:"新增厂商",edit:"编辑厂商"})[r.operateType]),s=oe(D());function D(){return{mname:"",sysparam:1}}const k={mname:y};function S(){Object.assign(s,D()),r.operateType==="edit"&&r.rowData&&Object.assign(s,r.rowData)}function g(){u.value=!1}async function c(){var v,m;if(await b(),r.operateType==="add"){const{data:x,error:p}=await ve([{mname:s.mname,sysparam:s.sysparam}]);p||((v=window.$message)==null||v.success(d("common.addSuccess")),g(),h("submitted"))}else{const{data:x,error:p}=await we([{id:r.rowData.id,mname:s.mname,sysparam:s.sysparam}]);p||((m=window.$message)==null||m.success(d("common.updateSuccess")),g(),h("submitted"))}}return ne(u,()=>{u.value&&(S(),z())}),(v,m)=>{const x=W,p=ae,R=J,C=O,$=Q,l=se,n=le,_=F("no-space");return A(),L(n,{show:u.value,"onUpdate:show":m[1]||(m[1]=w=>u.value=w),"display-directive":"show",width:360},{default:o(()=>[e(l,{title:T.value,"native-scrollbar":!1,closable:""},{footer:o(()=>[e($,{size:16},{default:o(()=>[e(C,{onClick:g},{default:o(()=>[I(M(t(d)("common.cancel")),1)]),_:1}),e(C,{type:"primary",onClick:c},{default:o(()=>[I(M(t(d)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(R,{ref_key:"formRef",ref:i,model:s,rules:k,onKeyup:H(c,["enter"])},{default:o(()=>[e(p,{label:"名称",path:"mname"},{default:o(()=>[U(e(x,{value:s.mname,"onUpdate:value":m[0]||(m[0]=w=>s.mname=w),placeholder:"请输入名称",clearable:""},null,8,["value"]),[[_]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ke=V({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(a,{emit:N}){const r=N,{formRef:h,restoreValidation:u}=G(),i=E(a,"model");function b(){i.value.fuzzy="",r("search")}async function z(){await u(),r("reset")}async function y(){r("search")}return(T,s)=>{const D=W,k=_e,S=pe,g=O,c=de,v=Q,m=fe,x=J,p=X,R=F("no-space");return A(),L(p,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[e(x,{ref_key:"formRef",ref:h,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:H(y,["enter"])},{default:o(()=>[e(m,{responsive:"screen","item-responsive":""},{default:o(()=>[e(k,{span:"24 s:12 m:6",label:"名称",path:"fuzzy",class:"pr-24px"},{default:o(()=>[U(e(D,{clearable:"",value:i.value.fuzzy,"onUpdate:value":s[0]||(s[0]=C=>i.value.fuzzy=C),placeholder:"请输入名称",onClear:b},null,8,["value"]),[[R]])]),_:1}),e(k,{span:"24 m:12",class:"pr-24px"},{default:o(()=>[e(v,{class:"w-full"},{default:o(()=>[e(g,{onClick:z},{icon:o(()=>[e(S,{class:"text-icon"})]),default:o(()=>[I(" "+M(t(d)("common.reset")),1)]),_:1}),e(g,{type:"primary",ghost:"",onClick:y},{icon:o(()=>[e(c,{class:"text-icon"})]),default:o(()=>[I(" "+M(t(d)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),xe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function q(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!ce(a)}const Ee=V({name:"manage_company",__name:"index",setup(a){const N=re(),{columns:r,columnChecks:h,data:u,getData:i,loading:b,mobilePagination:z,searchParams:y,resetSearchParams:T}=me({apiFn:ge,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,disabled:l=>l.sysparam==0},{key:"mname",title:"名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"operate",title:d("common.operate"),align:"center",width:160,render:l=>{let n;return l.sysparam!=0?e("div",{class:"flex-center gap-8px"},[U(e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>C(l.id)},q(n=d("common.edit"))?n:{default:()=>[n]}),[[F("no-auth"),"manu.source.update"]]),e(he,{onPositiveClick:()=>R(l.id)},{default:()=>d("common.confirmDelete"),trigger:()=>{let _;return U(e(O,{type:"error",ghost:!0,size:"small"},q(_=d("common.delete"))?_:{default:()=>[_]}),[[F("no-auth"),"manu.source.delete"]])}})]):null}}]}),{drawerVisible:s,operateType:D,editingData:k,handleAdd:S,handleEdit:g,checkedRowKeys:c,onBatchDeleted:v,onDeleted:m,closeDrawer:x}=ue(u,i);async function p(){console.log(c.value),$(c.value,l=>{v()})}function R(l){console.log(l),$([l],n=>{m()})}function C(l){g(l)}async function $(l,n){const{data:_,error:w}=await be(l);if(!w)n&&n(_);else return!1}return(l,n)=>{const _=Z,w=ye,Y=X;return A(),ie("div",xe,[e(ke,{model:t(y),"onUpdate:model":n[0]||(n[0]=f=>B(y)?y.value=f:null),onReset:t(T),onSearch:t(i)},null,8,["model","onReset","onSearch"]),e(Y,{title:"厂商列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[e(_,{columns:t(h),"onUpdate:columns":n[1]||(n[1]=f=>B(h)?h.value=f:null),"disabled-delete":t(c).length===0,loading:t(b),onAdd:t(S),onDelete:p,onRefresh:t(i),"is-view-add-button":t(K)("manu.source.insert"),"is-view-delete-button":t(K)("manu.source.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:o(()=>[e(w,{"checked-row-keys":t(c),"onUpdate:checkedRowKeys":n[2]||(n[2]=f=>B(c)?c.value=f:null),columns:t(r),data:t(u),size:"small","flex-height":!t(N).isMobile,"scroll-x":962,loading:t(b),remote:"","row-key":f=>f.id,pagination:t(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(De,{visible:t(s),"onUpdate:visible":n[3]||(n[3]=f=>B(s)?s.value=f:null),"operate-type":t(D),"row-data":t(k),onSubmitted:t(i)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Ee as default};
