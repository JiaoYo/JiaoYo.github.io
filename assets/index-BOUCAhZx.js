import{_ as Ce}from"./round-add-DYiCOkQk.js";import{d as le,aB as ce,z as ie,W as pe,C as ze,s as N,aD as fe,az as se,aP as _e,E as te,c as D,o as v,w as a,f as n,bi as Ne,b as K,F as R,L as ve,e as p,N as je,t as b,aR as J,a5 as Pe,H as O,h as r,G as Re,K as ge,cM as $e,B as U,g as T,a2 as Me,a3 as Ie,bk as Le,V as Be,X as Ue,A as Ve,i as ye,aW as f,a7 as he,aA as Fe,aH as He,I as we,$ as Q,cu as qe,aK as re,aX as Ee,cN as Ge,cO as ue,cP as Ke,cQ as Oe,aO as Ae,aQ as oe,cR as We,aE as Ye,aV as Je}from"./index-CF5MLTcW.js";import{f as Qe,a as Xe,b as Ze,_ as et,c as tt,d as at}from"./operate-drawer.vue_vue_type_style_index_0_lang-BbxhkW33.js";import{u as nt,a as ot}from"./table-CjO67JuQ.js";import{_ as st,a as lt}from"./text-BdwXQqJ7.js";import{N as be}from"./Popconfirm-DN_sr8cS.js";import{_ as it}from"./round-search-ZJkui7sH.js";import{u as de}from"./usePageData-Ci1OCWwf.js";import{_ as rt}from"./Grid-C1MGDjD6.js";import{_ as ut}from"./FormItemGridItem-zqSggTEs.js";import{_ as dt}from"./RadioButton-BbzJU67N.js";import{_ as mt}from"./DatePicker-BSkuVwse.js";const ct={class:"font-size-12px c-#a19f9d my-5px"},pt={key:0},ft={class:"mt-4 border-t pt-3"},_t={class:"flex items-start gap-2 mb-3"},vt={class:"ml-2 flex-1"},gt={class:"flex items-center"},yt={class:"font-medium font-size-16px font-bold"},ht={class:"text-gray-600 mt-1"},wt=le({name:"drawerLog",__name:"drawerLog",props:ce({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(S){const X=ie();pe();const t=ze({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0,charctras:0}),$=S,m={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},M=N({});async function o(){_.value=[],Object.assign(t,$.rowData);const u=JSON.parse($.rowData.context);t.proname=u.proname,t.notes=u.notes,t.problem=u.problem,t.solutions=u.solutions,t.feedback=u.feedback,t.summarize=u.summarize,j()}const _=N([]),g=fe(S,"visible");se(g,()=>{g.value?o():(_.value=[],t.id=void 0)}),se(()=>$.rowData,()=>{g.value&&o()});function I(u){u||C()}function C(){g.value=!1}const j=async()=>{const{data:u,error:l}=await Xe({page:1,limit:100,pid:t.id});u&&(_.value=u.list)},L=_e.debounce(async()=>{var k;const u=M.value[t.id];if(!(u!=null&&u.trim()))return(k=window.$message)==null?void 0:k.warning("请输入评论内容");const{data:l,error:w}=await Qe([{pid:t.id,context:u}]);l&&(M.value[t.id]="",t.num++,j())},1e3,{leading:!0,trailing:!1}),A=async u=>{var k;const{data:l,error:w}=await Ze(u.id);l&&(j(),t.num--,(k=window.$message)==null||k.success("删除成功"))};return(u,l)=>{const w=je,k=ve,H=st,V=lt,P=Ne,q=Le,E=te("no-auth");return v(),D(q,{show:g.value,"onUpdate:show":[l[1]||(l[1]=y=>g.value=y),I],"display-directive":"show",width:600,onMaskClick:C,onEsc:C},{default:a(()=>[n(P,{title:t.username+"的项目日报","native-scrollbar":!1,closable:""},{default:a(()=>[n(k,{ref:"formRef",model:t,"show-feedback":!1},{default:a(()=>[t.proname?(v(),D(w,{key:0,label:"项目名称",path:"proname","label-placement":"left"},{label:a(()=>l[2]||(l[2]=[p("div",{class:"font-size-16px font-bold"},"项目名称：",-1)])),default:a(()=>[p("span",null,b(t.proname),1)]),_:1})):R("",!0),n(w,{label:"当前工作内容及成果描述",path:"notes"},{label:a(()=>l[3]||(l[3]=[p("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述：",-1)])),default:a(()=>[p("span",{class:J(["preview-text",{textstyle:t.notes}])},b(t.notes),3)]),_:1}),n(w,{label:"遇到问题",path:"problem"},{label:a(()=>l[4]||(l[4]=[p("div",{class:"font-size-16px font-bold"},"遇到问题：",-1)])),default:a(()=>[p("span",{class:J(["preview-text",{textstyle:t.problem}])},b(t.problem),3)]),_:1}),n(w,{label:"解决措施",path:"solutions"},{label:a(()=>l[5]||(l[5]=[p("div",{class:"font-size-16px font-bold"},"解决措施：",-1)])),default:a(()=>[p("span",{class:J(["preview-text",{textstyle:t.solutions}])},b(t.solutions),3)]),_:1}),n(w,{label:"建议意见反馈",path:"feedback"},{label:a(()=>l[6]||(l[6]=[p("div",{class:"font-size-16px font-bold"},"建议意见反馈：",-1)])),default:a(()=>[p("span",{class:J(["preview-text",{textstyle:t.feedback}])},b(t.feedback),3)]),_:1}),n(w,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:a(()=>l[7]||(l[7]=[p("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感：",-1)])),default:a(()=>[p("span",{class:J(["preview-text",{textstyle:t.summarize}])},b(t.summarize),3)]),_:1}),p("div",ct,"字符数："+b(t.charctras),1)]),_:1},8,["model"]),t.num?(v(),K("div",pt,b(t.num)+"评论",1)):R("",!0),n(Pe,{name:"fade"},{default:a(()=>[p("div",ft,[O((v(),K("div",_t,[p("div",null,[n(H,{size:"small",src:m.avatar},null,8,["src"])]),n(r(Re),{type:"textarea",id:`comment-input-${t.id}`,value:M.value[t.id],"onUpdate:value":l[0]||(l[0]=y=>M.value[t.id]=y),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:ge($e(r(L),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),n(r(U),{type:"primary",ghost:"",onClick:r(L)},{default:a(()=>l[8]||(l[8]=[T("发送")])),_:1,__:[8]},8,["onClick"])])),[[E,"project:Comment:insert"]]),(v(!0),K(Me,null,Ie(_.value,y=>(v(),K("div",{key:y.id,class:"flex mb-3"},[n(H,{size:"small",src:m.avatar},null,8,["src"]),p("div",vt,[p("div",gt,[p("span",yt,b(y.username),1),n(V,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:a(()=>[T(b(y.dbtime),1)]),_:2},1024),r(X).userInfo.id==y.creater?(v(),D(r(be),{key:0,onPositiveClick:W=>A(y)},{trigger:a(()=>[O((v(),D(r(U),{quaternary:"",type:"error",size:"small"},{default:a(()=>l[9]||(l[9]=[T(" 删除 ")])),_:1,__:[9]})),[[E,"project:Comment:delete"]])]),default:a(()=>[l[10]||(l[10]=T(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):R("",!0)]),p("div",ht,b(y.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),bt=Be(wt,[["__scopeId","data-v-d3933054"]]),Tt=le({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ce(["reset","search","clear","setPname"],["update:model"]),setup(S,{emit:X}){const t=pe(),$=Ue(),m=X,{formRef:M}=Ve(),o=fe(S,"model");ie();const _=N([]),{pageData:g,getData:I,nextPage:C}=de(qe),j=async s=>{const e=s.currentTarget,i=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&g.data.length<g.total&&(await C(),_.value=g.data,await re(),setTimeout(()=>{e.scrollTop=i}))},{pageData:L,getData:A,nextPage:u}=de(Ee),l=async s=>{const e=s.currentTarget,i=e.scrollTop;e.scrollTop+e.offsetHeight>=e.scrollHeight&&L.data.length<L.total&&(await u(),await re(),setTimeout(()=>{e.scrollTop=i}))},w=async s=>{o.value.creater=s,m("search")},k=async s=>{var e;P.value=!0,s&&(o.value.pid=s),m("search"),m("setPname",((e=_.value.find(i=>i.id==s))==null?void 0:e.proname)||"")},H=_e.debounce(async s=>{await I({fuzzy:s,page:1}),_.value=g.data},300),V=N(!1),P=N(!1),q=s=>{if(o.value.pid=null,V.value=!0,P.value=!1,!s){y();return}H(s)},E=async()=>{V.value&&!P.value&&(await I({page:1}),_.value=g.data,V.value=!1)},y=async()=>{await I({page:1}),_.value=g.data},W=async()=>{await I(),_.value=g.data,o.value.pid=t.query.prjId?Number(t.query.prjId):void 0,o.value.fuzzy=t.query.pname?t.query.pname:"",B.value=t.query.prjId&&t.query.pname?"all":"day",m("search"),setTimeout(()=>{$.replace({path:t.path,query:{}})},10)};A({usertypes:"2,3"}),ye(async()=>{if(!t.query.prjId&&!t.query.pname){const s=new Date;if(s.getHours()<18){const e=new Date;e.setDate(s.getDate()-1),e.setHours(0,0,0,0),h.value.dayTime=String(f(0,e.getTime())),o.value.statrtTime=String(f(0,e.getTime()))+" 00:00:00",o.value.endTime=String(f(0,e.getTime()+24*60*60*1e3))+" 00:00:00"}else{const e=new Date;e.setHours(0,0,0,0),h.value.dayTime=String(f(0,e.getTime())),o.value.statrtTime=String(f(0,e.getTime()))+" 00:00:00",o.value.endTime=String(f(0,e.getTime()+24*60*60*1e3))+" 00:00:00"}}await W()}),se(()=>t,async s=>{s.prjId&&s.pname&&Z("all")},{immediate:!0});const h=N({dayTime:null,weekTime:null,monthTime:null}),c=async s=>{o.value.statrtTime=String(f(0,s))+" 00:00:00",o.value.endTime=String(f(0,new Date(s).getTime()+24*60*60*1e3))+" 00:00:00",m("search")},d=async s=>{const{monday:e,sunday:i}=Ge(s);o.value.statrtTime=e,o.value.endTime=f(0,new Date(i).getTime()+24*60*60*1e3),m("search")},z=async s=>{const{start:e,end:i}=ue(s);o.value.statrtTime=e,o.value.endTime=f(0,new Date(i).getTime()+24*60*60*1e3),m("search")};async function Y(){m("search")}const B=N("day"),Z=async s=>{if(s=="day"){const e=new Date;if(e.getHours()<18){const i=new Date;i.setDate(e.getDate()-1),i.setHours(0,0,0,0),h.value.dayTime=String(f(0,i.getTime())),o.value.statrtTime=String(f(0,i.getTime()))+" 00:00:00",o.value.endTime=String(f(0,i.getTime()+24*60*60*1e3))+" 00:00:00"}else{const i=new Date;i.setHours(0,0,0,0),h.value.dayTime=String(f(0,i.getTime())),o.value.statrtTime=String(f(0,i.getTime()))+" 00:00:00",o.value.endTime=String(f(0,i.getTime()+24*60*60*1e3))+" 00:00:00"}}else if(s=="week"){h.value.weekTime=Ke();const{start:e,end:i}=Oe(new Date().getTime());o.value.statrtTime=e,o.value.endTime=f(0,new Date(i).getTime()+24*60*60*1e3)}else if(s=="month"){let e=function(){const F=new Date,ae=F.getFullYear(),ne=(F.getMonth()+1).toString().padStart(2,"0");return`${ae}-${ne}`};h.value.monthTime=e();const{start:i,end:G}=ue(h.value.monthTime);o.value.statrtTime=i,o.value.endTime=f(0,new Date(G).getTime()+24*60*60*1e3)}else s=="all"&&(o.value.statrtTime=void 0,o.value.endTime=void 0);m("search")};return(s,e)=>{const i=Fe,G=ut,F=dt,ae=He,ee=mt,ne=it,Te=U,ke=we,xe=rt,De=ve,Se=he;return v(),D(Se,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[n(De,{ref_key:"formRef",ref:M,model:o.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ge(Y,["enter"])},{default:a(()=>[n(xe,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:a(()=>[n(G,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:a(()=>[n(i,{filterable:"",clearable:"",value:o.value.pid,"onUpdate:value":[e[0]||(e[0]=x=>o.value.pid=x),k],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:_.value,onScroll:j,onClear:y,onSearch:q,onBlur:E},null,8,["value","options"])]),_:1}),n(G,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:a(()=>[n(ae,{value:B.value,"onUpdate:value":[e[1]||(e[1]=x=>B.value=x),Z],style:{"margin-right":"20px"}},{default:a(()=>[n(F,{value:"day"},{default:a(()=>e[6]||(e[6]=[T("天")])),_:1,__:[6]}),n(F,{value:"week"},{default:a(()=>e[7]||(e[7]=[T("周")])),_:1,__:[7]}),n(F,{value:"month"},{default:a(()=>e[8]||(e[8]=[T("月")])),_:1,__:[8]}),n(F,{value:"all"},{default:a(()=>e[9]||(e[9]=[T("全部")])),_:1,__:[9]})]),_:1},8,["value"]),B.value==="day"?(v(),D(ee,{key:0,"formatted-value":h.value.dayTime,"onUpdate:formattedValue":[e[2]||(e[2]=x=>h.value.dayTime=x),c],type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])):R("",!0),B.value==="week"?(v(),D(ee,{key:1,"formatted-value":h.value.weekTime,"onUpdate:formattedValue":[e[3]||(e[3]=x=>h.value.weekTime=x),d],type:"week",style:{width:"100%"}},null,8,["formatted-value"])):R("",!0),B.value==="month"?(v(),D(ee,{key:2,"formatted-value":h.value.monthTime,"onUpdate:formattedValue":[e[4]||(e[4]=x=>h.value.monthTime=x),z],type:"month","value-format":"yyyy-MM",style:{width:"100%"}},null,8,["formatted-value"])):R("",!0)]),_:1}),n(G,{span:"24 s:12 m:5",label:"用户",path:"creater"},{default:a(()=>[n(i,{clearable:"",filterable:"",value:o.value.creater,"onUpdate:value":[e[5]||(e[5]=x=>o.value.creater=x),w],placeholder:"请选择","label-field":"username","value-field":"id",options:r(L).data,onScroll:l},null,8,["value","options"])]),_:1}),n(G,{span:"24  s:12 m:4",class:"pr-24px"},{default:a(()=>[n(ke,{class:"w-full"},{default:a(()=>[n(Te,{type:"primary",ghost:"",onClick:Y},{icon:a(()=>[n(ne,{class:"text-icon"})]),default:a(()=>[T(" "+b(r(Q)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),kt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},xt={key:0};function me(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Je(S)}const Bt=le({name:"projectmanagement_daylog",__name:"index",props:{pid:{default:void 0},type:{}},emits:["thereIsData"],setup(S,{emit:X}){const t=Ae(),$=ie(),m=S,{columns:M,data:o,getData:_,loading:g,mobilePagination:I,searchParams:C}=nt({showTotal:!0,immediate:!1,apiFn:tt,apiParams:{page:1,pageSize:20,limit:20,statrtTime:void 0,endTime:void 0,creater:void 0,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:200,render:c=>{const d=JSON.parse(c.context);return n("div",null,[d.proname?c.username+"的"+d.proname+"项目日报":c.username+"的项目日报"])}},{key:"charctras",title:"字符数",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:Q("common.operate"),align:"center",width:140,fixed:"right",render:c=>{let d;return n("div",{class:"flex-center gap-8px"},[n(U,{type:"primary",ghost:!0,size:"small",onClick:()=>E(c)},{default:()=>[T("查看详情")]}),$.userInfo.id==c.creater&&O(n(U,{type:"primary",ghost:!0,size:"small",onClick:()=>V(c.id)},me(d=Q("common.edit"))?d:{default:()=>[d]}),[[te("no-auth"),"project:DailyReport:update"]]),$.userInfo.id==c.creater&&n(be,{onPositiveClick:()=>H(c.id)},{default:()=>Q("common.confirmDelete"),trigger:()=>{let z;return O(n(U,{type:"error",ghost:!0,size:"small"},me(z=Q("common.delete"))?z:{default:()=>[z]}),[[te("no-auth"),"project:DailyReport:delete"]])}})])}}]}),{drawerVisible:j,operateType:L,editingData:A,handleAdd:u,handleEdit:l,checkedRowKeys:w,onDeleted:k}=ot(o,_);async function H(c){const{data:d,error:z}=await at(c);z||k()}function V(c){l(c)}const P=N(!1),q=N({}),E=c=>{P.value=!0,q.value=c},y=()=>{_()},W=N(""),h=c=>{W.value=c};return ye(()=>{m.type!="externalLiaison"}),(c,d)=>{const z=we,Y=Ce,B=Ye,Z=he,s=te("no-auth");return v(),K("div",kt,[m.pid?R("",!0):(v(),D(Tt,{key:0,model:r(C),"onUpdate:model":d[0]||(d[0]=e=>oe(C)?C.value=e:null),onReset:y,onSearch:r(_),onSetPname:h},null,8,["model","onSearch"])),n(Z,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},We({header:a(()=>[n(z,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:a(()=>[m.pid?R("",!0):(v(),K("div",xt,"项目日报"))]),_:1}),m.pid?O((v(),D(r(U),{key:0,onClick:r(u),size:"small",ghost:"",type:"primary"},{icon:a(()=>[n(Y,{class:"text-icon"})]),default:a(()=>[d[4]||(d[4]=T(" "+b("新增")))]),_:1,__:[4]},8,["onClick"])),[[s,"project:DailyReport:insert"]]):R("",!0)]),default:a(()=>[n(B,{"checked-row-keys":r(w),"onUpdate:checkedRowKeys":d[1]||(d[1]=e=>oe(w)?w.value=e:null),columns:r(M),data:r(o),size:"small","flex-height":!r(t).isMobile,loading:r(g),remote:"","row-key":e=>e.id,pagination:r(I),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),n(et,{visible:r(j),"onUpdate:visible":d[2]||(d[2]=e=>oe(j)?j.value=e:null),onSubmitted:r(_),"operate-type":r(L),pname:W.value,pid:m.pid||r(C).pid,"row-data":r(A)},null,8,["visible","onSubmitted","operate-type","pname","pid","row-data"]),n(bt,{visible:P.value,"onUpdate:visible":d[3]||(d[3]=e=>P.value=e),"row-data":q.value},null,8,["visible","row-data"])]),_:2},[m.pid?void 0:{name:"header-extra",fn:a(()=>[n(z,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[O((v(),D(r(U),{onClick:r(u),size:"small",ghost:"",type:"primary"},{icon:a(()=>[n(Y,{class:"text-icon"})]),default:a(()=>[d[5]||(d[5]=T(" "+b("新增")))]),_:1,__:[5]},8,["onClick"])),[[s,"project:DailyReport:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{Bt as default};
