import{_ as le}from"./table-column-setting.vue_vue_type_script_setup_true_lang-RLvYZSGJ.js";import{_ as ie}from"./round-delete-DDXstZni.js";import{_ as ue}from"./round-add-CDuxp0E4.js";import{d as Z,av as ce,z as ee,A as de,ax as pe,aJ as me,c as g,o as f,a2 as te,w as o,f as t,M as fe,L as _e,G as ne,H as ge,h as a,au as he,J as ae,B as k,g as h,t as U,$ as y,aS as ye,aE as ve,aI as be,Y as xe,X as ke,s as we,i as ze,at as De,F as R,b as Ce,aK as L,ay as je,I as j,aL as Ne,e as Se,aD as X,aQ as Fe,W as Ie}from"./index-CddQmI-c.js";import{p as Te,f as Y,a as Pe,b as $e}from"./index-EcFCajZ5.js";import{u as Be,a as Re}from"./table-DDoF-sKE.js";import{_ as Ue}from"./round-search-DnVu2ZZt.js";import{_ as Ae}from"./round-refresh-BklTS0D6.js";import{u as Ee}from"./usePageData-BKzmIEAP.js";import{_ as Ke}from"./Grid-CG_YWdVR.js";import{_ as Me}from"./FormItemGridItem-CBPP8HMS.js";import{f as Ve}from"./business-C7uYL7a-.js";import{N as J}from"./Popconfirm-CkfL-ZaH.js";import"./index-BczHTB4g.js";import"./round-plus-CC5Q2swW.js";import"./permission-C3pQCx4P.js";import"./DatePicker-D516kcb4.js";import"./Cascader-DYASQCtV.js";import"./index-28vg6Ljo.js";const Ge=Z({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ce(["reset","search"],["update:model"]),setup(v,{emit:A}){const d=ee(),_=A,{formRef:N,restoreValidation:S}=de(),s=pe(v,"model"),{pageData:b,getData:r,nextPage:F}=Ee(ye),E=async u=>{const l=u.currentTarget,z=l.scrollTop;l.scrollTop+l.offsetHeight>=l.scrollHeight&&b.data.length<b.total&&(await F(),await ve(),setTimeout(()=>{l.scrollTop=z}))};d.userInfo.usertype==0&&r({usertypes:"0,1"});function x(){s.value.fuzzy=void 0,_("search")}async function w(){s.value.fuzzy=void 0,s.value.creater=void 0,await S(),_("reset")}const I=me.debounce(u=>{_("search")},1e3,{leading:!0,trailing:!1}),K=u=>{s.value.fuzzy=u||void 0,I(u)},p=async u=>{s.value.creater=u,_("search")};async function T(){_("search")}return(u,l)=>{const z=ge,D=Me,M=he,V=Ae,P=k,G=Ue,m=ae,O=Ke,$=fe,q=te;return f(),g(q,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[t($,{ref_key:"formRef",ref:N,model:s.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:_e(T,["enter"])},{default:o(()=>[t(O,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[t(D,{span:"24 s:12 m:4",label:"",path:"fuzzy"},{default:o(()=>[t(z,{clearable:"",value:s.value.fuzzy,"onUpdate:value":l[0]||(l[0]=e=>s.value.fuzzy=e),placeholder:"请输入",onClear:x,onInput:K},null,8,["value"])]),_:1}),a(d).userInfo.usertype==0?(f(),g(D,{key:0,span:"24 s:12 m:5",label:"用户",path:"creater"},{default:o(()=>[t(M,{clearable:"",filterable:"",value:s.value.creater,"onUpdate:value":[l[1]||(l[1]=e=>s.value.creater=e),p],placeholder:"请选择","label-field":"username","value-field":"id",options:a(b).data,onScroll:E},null,8,["value","options"])]),_:1})):ne("",!0),t(D,{span:"24  s:12 m:4",class:"pr-24px"},{default:o(()=>[t(m,{class:"w-full"},{default:o(()=>[t(P,{onClick:w},{icon:o(()=>[t(V,{class:"text-icon"})]),default:o(()=>[h(" "+U(a(y)("common.reset")),1)]),_:1}),t(P,{type:"primary",ghost:"",onClick:T},{icon:o(()=>[t(G,{class:"text-icon"})]),default:o(()=>[h(" "+U(a(y)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Q(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Fe(v)}const qe=Z({name:"projectmanagement_projectdebuggingform",__name:"index",setup(v){const A=be(),d=ee(),_=xe(),N=ke(),{columns:S,columnChecks:s,data:b,getData:r,loading:F,mobilePagination:E,searchParams:x}=Be({showTotal:!0,apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,creater:void 0,fuzzy:void 0,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"proname",title:"项目名称",align:"center",width:180,render:e=>t("div",{class:"cursor-pointer",onClick:()=>q(e)},[e.proname])},{key:"dispatch",title:"调度名称",align:"center",width:100,render:e=>t("div",null,[e.dispatch])},{key:"dtype",title:"调试类型",align:"center",width:100,render:e=>{if(e.dtype===null)return null;const n=y(Ve[e.dtype]);return t(X,{type:e.dtype==0?"warning":e.dtype==1?"success":"info"},Q(n)?n:{default:()=>[n]})}},{key:"plantime",title:"计划调试时间",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"status",title:"提交状态",align:"center",width:80,render:e=>t(X,{type:e.status===0?"error":"success"},{default:()=>[e.status===0?"未提交":"已提交"]})},{key:"sbtime",title:"提交时间",align:"center",width:200,render(e){return t("div",null,[e.sbtime||"-"])}},{key:"username",title:"创建信息",align:"left",width:200,render(e){return t("div",{style:"display:flex; flex-direction:column; font-size:13px; gap:3px; line-height:1.4;"},[t("div",null,[t("span",{style:"color:#666"},[h("创建人：")]),t("span",{style:"font-weight:500"},[e.username||"-"])]),t("div",null,[t("span",{style:"color:#666"},[h("时间：")]),t("span",{style:" font-weight:500"},[e.dbtime||"-"])])])}},{key:"operate",title:y("common.operate"),align:"center",width:320,fixed:"right",render:e=>{let n;return t("div",{class:"flex justify-center gap-8px"},[e.status==0&&(d.userInfo.usertype==0||d.userInfo.usertype==1)&&e.creater==d.userInfo.id&&t(J,{onPositiveClick:()=>D(e,1)},{default:()=>"是否确认提交该调试单？",trigger:()=>j(t(k,{type:"success",ghost:!0,size:"small"},{default:()=>["提交"]}),[[R("no-auth"),"project:form:update"]])}),j(t(k,{type:"primary",ghost:!0,size:"small",onClick:()=>O(e)},Q(n=y("common.edit"))?n:{default:()=>[n]}),[[R("no-auth"),"project:form:update"]]),(e.status==0||d.userInfo.usertype==0)&&t(J,{onPositiveClick:()=>z(e.id)},{default:()=>y("common.confirmDelete"),trigger:()=>{let c;return j(t(k,{type:"error",ghost:!0,size:"small"},Q(c=y("common.delete"))?c:{default:()=>[c]}),[[R("no-auth"),"project:form:delete"]])}})])}}]}),{operateType:w,editingData:I,handleAdd:K,checkedRowKeys:p,onBatchDeleted:T,onDeleted:u}=Re(b,r);async function l(){console.log(p.value),M(p.value.join(","),e=>{T()})}async function z(e){const{data:n,error:c}=await Y(e);c||u()}const D=async(e,n)=>{var B;const{data:c,error:C}=await $e([{id:e.id,status:n}]);C||((B=window.$message)==null||B.success("操作成功"),r())};async function M(e,n){const{data:c,error:C}=await Y(e);if(!C)n&&n(c);else return!1}const V=e=>{r()},P=e=>{console.log(e),e.columnKey=="progess"&&r()},G=()=>{w.value="add",m.value=!0,K()},m=we(!1),O=e=>{w.value="edit",m.value=!0,I.value=e},$=()=>{r()};ze(()=>{$(),r()}),De(()=>N.query.pname,e=>{e&&!N.query.prjId&&(x.fuzzy=e,r())});const q=e=>{_.push("/projectmanagement/orderdetail?prjId="+e.proid+"&pname="+e.proname),d.setProjectInfo({pid:e.id,pname:e.proname})};return(e,n)=>{const c=ae,C=ue,B=ie,oe=le,se=je,re=te,W=R("no-auth");return f(),Ce("div",Oe,[m.value?ne("",!0):(f(),g(Ge,{key:0,model:a(x),"onUpdate:model":n[0]||(n[0]=i=>L(x)?x.value=i:null),onReset:$,onSearch:a(r)},null,8,["model","onSearch"])),m.value?(f(),g(Te,{key:2,onSubmit:n[3]||(n[3]=i=>a(r)()),onReturnandSub:n[4]||(n[4]=i=>{m.value=!1,a(r)()}),onReturn:n[5]||(n[5]=i=>m.value=!1),"operate-type":a(w),"row-data":a(I)},null,8,["operate-type","row-data"])):(f(),g(re,{key:1,bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[t(c,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>n[6]||(n[6]=[Se("div",null,"项目调试单列表",-1)])),_:1,__:[6]})]),"header-extra":o(()=>[t(c,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[j((f(),g(a(k),{onClick:G,size:"small",ghost:"",type:"primary"},{icon:o(()=>[t(C,{class:"text-icon"})]),default:o(()=>[n[7]||(n[7]=h(" "+U("新增项目调试单")))]),_:1,__:[7]})),[[W,"project:form:insert"]]),t(a(J),{onPositiveClick:l},{trigger:o(()=>[j((f(),g(a(k),{size:"small",ghost:"",type:"error",disabled:a(p).length==0},{icon:o(()=>[t(B,{class:Ne(["text-icon",{"animate-spin":a(F)}])},null,8,["class"])]),default:o(()=>[n[8]||(n[8]=h(" "+U("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[W,"project:form:delete"]])]),default:o(()=>[n[9]||(n[9]=h(" 确定要删除选中的合同吗？ "))]),_:1,__:[9]}),t(oe,{columns:a(s),"onUpdate:columns":n[1]||(n[1]=i=>L(s)?s.value=i:null),ctype:5},null,8,["columns"])]),_:1})]),default:o(()=>[t(se,{"checked-row-keys":a(p),"onUpdate:checkedRowKeys":n[2]||(n[2]=i=>L(p)?p.value=i:null),columns:a(S),data:a(b),size:"small","flex-height":!a(A).isMobile,"scroll-x":a(S).reduce((i,H)=>i+((H==null?void 0:H.width)||100),0),loading:a(F),remote:"","row-key":i=>i.id,"onUpdate:sorter":P,pagination:a(E),class:"sm:h-full","onUpdate:filters":V},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"])]),_:1}))])}}}),dt=Ie(qe,[["__scopeId","data-v-45be0751"]]);export{dt as default};
