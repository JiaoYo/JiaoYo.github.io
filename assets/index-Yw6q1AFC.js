import{o as c,b as p,e as g,d as B,cf as H,g as e,b8 as R,c as C,w as t,t as w,f as l,R as D,aL as S,a6 as L,_ as F,m as v,C as W,G as E,h as k,B as q,D as G,F as O,cg as Q,O as U,T as j}from"./index-CPZbeTv0.js";import{u as A}from"./table-D_GetrRa.js";import{_ as J,a as K}from"./Upload-zu7RJVF9.js";import{a as X,_ as Y}from"./Grid-BAx3fNyx.js";const ee={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},te=g("path",{fill:"currentColor",d:"M16 18v2H8v-2zM11 7.99V16h2V7.99h3L12 4L8 7.99z"},null,-1),ne=[te];function oe(m,n){return c(),p("svg",ee,[...ne])}const ae={name:"ic-twotone-upgrade",render:oe},se={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},le=g("path",{fill:"currentColor",d:"M11 17h2v-4.2l1.6 1.6L16 13l-4-4l-4 4l1.4 1.4l1.6-1.6V17Zm-9 3V4h8l2 2h10v14H2Zm2-2h16V8h-8.825l-2-2H4v12Zm0 0V6v12Z"},null,-1),ce=[le];function re(m,n){return c(),p("svg",se,[...ce])}const ie={name:"material-symbols-drive-folder-upload-outline-sharp",render:re},_e={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},ue=g("path",{fill:"currentColor",d:"m12 13.4l-2.917 2.925q-.277.275-.704.275t-.704-.275q-.275-.275-.275-.7t.275-.7L10.6 12L7.675 9.108Q7.4 8.831 7.4 8.404t.275-.704q.275-.275.7-.275t.7.275L12 10.625L14.892 7.7q.277-.275.704-.275t.704.275q.3.3.3.713t-.3.687L13.375 12l2.925 2.917q.275.277.275.704t-.275.704q-.3.3-.712.3t-.688-.3z"},null,-1),de=[ue];function pe(m,n){return c(),p("svg",_e,[...de])}const me={name:"material-symbols-close-small-rounded",render:pe},fe={class:"version"},he=B({__name:"table",props:{type:{type:Number,default:0}},setup(m){const n=m,{columns:f,data:h,getData:y,loading:r,mobilePagination:b,searchParams:N}=A({apiFn:H,apiParams:{page:1,pageSize:50,limit:50,type:n.type,_t:new Date().getTime()},showTotal:!0,columns:()=>[{key:"ver",title:"版本号",align:"center",minWidth:160},{key:"dbtime",title:"升级时间",align:"center",minWidth:160,render:_=>e("span",null,[_.dbtime.substring(10,0)])},{key:"status",title:"升级状态",align:"center",render:_=>e(R,{type:_.status===0?"success":"error"},{default:()=>[_.status===0?"成功":"失败"]})}]});return(_,o)=>{const i=S,a=L;return c(),C(a,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(l(D),null,{default:t(()=>{var s,u;return[g("div",null,w(n.type===0?"后台服务":n.type===1?"web服务":"预测服务"),1),g("div",fe,"当前版本："+w(((s=l(h).find(d=>d.curver===0))==null?void 0:s.ver)||((u=l(h)[0])==null?void 0:u.ver)),1)]}),_:1})]),default:t(()=>[e(i,{columns:l(f),data:l(h),size:"small",loading:l(r),remote:"","row-key":s=>s.id,pagination:l(b),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["columns","data","loading","row-key","pagination"])]),_:1})}}}),$=F(he,[["__scopeId","data-v-ba519288"]]),ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ve={key:0,style:{width:"300px"}},we=B({name:"manage_upgrade",__name:"index",setup(m){const n=v(""),f=v(null),h=({file:o,data:i,headers:a,withCredentials:s,action:u,onFinish:d,onError:V,onProgress:z})=>{f.value=o.file,n.value=o.name},y=v(0),r=v(!1),b=o=>{r.value=!0,y.value=o},N=async()=>{var o,i;if(!n.value.endsWith(".tar.gz"))return(o=window.$message)==null?void 0:o.error("请上传tar.gz文件");try{const a=new FormData;a.append("fi",f.value);const{data:s,error:u}=await Q({fname:n.value},a,b);if(u)return;(i=window.$message)==null||i.success(s),r.value=!1}catch(a){console.error(a)}finally{r.value=!1}},_=o=>{o.stopPropagation(),n.value="",f.value=null};return(o,i)=>{const a=me,s=ie,u=J,d=U,V=ae,z=D,T=K,P=j,I=L,x=X,M=Y,Z=W("no-auth");return c(),p("div",ge,[e(I,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(P,{ref:"formRef",inline:"","label-placement":"left","label-width":100,"show-feedback":!1},{default:t(()=>[e(d,{label:"升级包选择",path:"fi"},{default:t(()=>[e(u,{action:"","custom-request":h,"show-file-list":!1,accept:".gz"},{default:t(()=>[n.value?(c(),p("div",{key:0,onClick:i[0]||(i[0]=E(()=>{},["stop"]))},[k(w(n.value)+" ",1),e(a,{class:"font-size-30px cursor-pointer",onClick:_})])):(c(),C(l(q),{key:1},{icon:t(()=>[e(s,{class:"text-icon"})]),default:t(()=>[k(" 上传文件")]),_:1}))]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(z,{class:"w-full"},{default:t(()=>[G((c(),C(l(q),{onClick:N,loading:r.value,disabled:!n.value,type:"primary",ghost:""},{icon:t(()=>[e(V,{class:"text-icon"})]),default:t(()=>[k(" "+w(r.value?"正在升级中":"升级"),1)]),_:1},8,["loading","disabled"])),[[Z,"version:upload"]])]),_:1})]),_:1}),e(d,null,{default:t(()=>[r.value?(c(),p("div",ve,[e(T,{type:"line",percentage:y.value},null,8,["percentage"])])):O("",!0)]),_:1})]),_:1},512)]),_:1}),e(M,{"x-gap":"16",cols:3,class:"h-100%"},{default:t(()=>[e(x,null,{default:t(()=>[e($,{type:0,class:"h-100%"})]),_:1}),e(x,null,{default:t(()=>[e($,{type:1,class:"h-100%"})]),_:1}),e(x,null,{default:t(()=>[e($,{type:2,class:"h-100%"})]),_:1})]),_:1})])}}}),$e=F(we,[["__scopeId","data-v-ac370dce"]]);export{$e as default};
