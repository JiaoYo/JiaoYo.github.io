import{_ as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CDCEHG5B.js";import{d as G,n as A,s as J,p as te,q as me,c5 as ae,b as P,$ as s,r as fe,ax as oe,D as F,o as T,c as K,w as r,g as t,h as I,t as U,i as e,F as ne,E as L,W as _e,X as he,c6 as se,c7 as ge,J as le,K as ve,Z as ye,O as re,B as V,N as X,aD as be,aE as ke,ad as ie,e as Z,aP as ce,c8 as Q,j as W,f as Y,c9 as we,al as xe,ca as Ne,b0 as Re,av as de,a3 as De,cb as Ce,cc as Me,cd as Se,aC as E,aG as $e,au as Te}from"./index-FKKSWlZs.js";import{u as ze,a as Be}from"./table-CSyR0TzJ.js";import{_ as Ie,a as Ue,b as Le,l as Ve}from"./lodash-YkbCJgJ0.js";import{_ as Oe}from"./round-refresh-BFeEk6QU.js";import{_ as je}from"./Grid-DmN9YdMU.js";import{_ as Ee}from"./Tree-Bslyk9eG.js";import{h as ee}from"./permission-CIZuorC2.js";import{N as Fe}from"./Popconfirm-DxRR0mKc.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-BETkHMFo.js";import"./export-DQRIj4KV.js";import"./refresh-49c21s-F.js";import"./round-plus-B53Iz6E2.js";import"./Upload-Dw_AZ3VX.js";import"./Progress-BOvJ-dqS.js";const Ke=G({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:A({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:A(["submitted"],["update:visible"]),setup(h,{emit:y}){const u=h,g=y,k=J(h,"visible"),{formRef:b,validate:C,restoreValidation:z}=te(),{defaultRequiredRule:v}=me();ae();const R=P(()=>({add:s("page.manage.role.addRole"),edit:s("page.manage.role.editRole")})[u.operateType]),p=fe(D());function D(){return{name:"",remark:"",rtype:0,menuIdList:[]}}const B={name:v};P(()=>{var c;return((c=u.rowData)==null?void 0:c.id)||-1}),P(()=>u.operateType==="add"||u.operateType==="edit");async function M(){if(Object.assign(p,D()),u.operateType==="edit"&&u.rowData){const{data:c,error:i}=await se(u.rowData.id+"");Object.assign(p,c)}}function S(){k.value=!1}async function a(){var _,n,d;await C();const{data:c,error:i}=await ge(u.operateType==="edit"?(_=u.rowData)==null?void 0:_.id:null,p.name,p.menuIdList,p.remark,p.rtype);i||((n=window.$message)==null||n.destroyAll(),(d=window.$message)==null||d.success(u.operateType==="edit"?s("common.modifySuccess"):s("common.addSuccess")),S(),g("submitted"))}return oe(k,()=>{k.value&&(M(),z())}),(c,i)=>{const _=le,n=ve,d=ye,m=re,w=V,o=X,$=be,O=ke,j=F("no-space");return T(),K(O,{show:k.value,"onUpdate:show":i[3]||(i[3]=l=>k.value=l),"display-directive":"show",width:360},{default:r(()=>[t($,{title:R.value,"native-scrollbar":!1,closable:""},{footer:r(()=>[t(o,{size:16},{default:r(()=>[t(w,{onClick:S},{default:r(()=>[I(U(e(s)("common.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:a},{default:r(()=>[I(U(e(s)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(m,{ref_key:"formRef",ref:b,model:p,rules:B,onKeyup:ne(a,["enter"])},{default:r(()=>[t(n,{label:e(s)("page.manage.role.name"),path:"name"},{default:r(()=>[L(t(_,{value:p.name,"onUpdate:value":i[0]||(i[0]=l=>p.name=l),placeholder:e(s)("page.manage.role.form.name"),clearable:""},null,8,["value","placeholder"]),[[j]])]),_:1},8,["label"]),t(n,{label:e(s)("page.manage.role.remark"),path:"remark"},{default:r(()=>[L(t(_,{clearable:"",value:p.remark,"onUpdate:value":i[1]||(i[1]=l=>p.remark=l),placeholder:e(s)("page.manage.role.form.remark")},null,8,["value","placeholder"]),[[j]])]),_:1},8,["label"]),t(n,{label:e(s)("page.manage.role.type"),path:"rtype"},{default:r(()=>[t(d,{filterable:"",value:p.rtype,"onUpdate:value":i[2]||(i[2]=l=>p.rtype=l),disabled:u.operateType==="edit",placeholder:e(s)("page.manage.role.form.type"),options:e(_e)(e(he)),style:{width:"100%"}},null,8,["value","disabled","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Pe=G({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:A(["reset","search"],["update:model"]),setup(h,{emit:y}){const u=y,g=J(h,"model"),{formRef:k,restoreValidation:b}=te();function C(){g.value.name="",u("search")}async function z(){await b(),u("reset")}function v(){u("search")}const R=Ie.debounce(v,1e3,{leading:!0,trailing:!1});return(p,D)=>{const B=le,M=Ue,S=Oe,a=V,c=Le,i=X,_=je,n=re,d=ie,m=F("no-space");return T(),K(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[t(n,{model:g.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ne(v,["enter"])},{default:r(()=>[t(_,{responsive:"screen","item-responsive":"","y-gap":12},{default:r(()=>[t(M,{span:"24 s:12 m:8 l:6",label:e(s)("page.manage.role.name"),path:"name"},{default:r(()=>[L(t(B,{clearable:"",value:g.value.name,"onUpdate:value":D[0]||(D[0]=w=>g.value.name=w),placeholder:e(s)("page.manage.role.form.name"),onClear:C},null,8,["value","placeholder"]),[[m]])]),_:1},8,["label"]),t(M,{span:"24 s:12 m:8 l:6"},{default:r(()=>[t(i,{class:"w-full ml-20px"},{default:r(()=>[t(a,{onClick:z},{icon:r(()=>[t(S,{class:"text-icon"})]),default:r(()=>[I(" "+U(e(s)("common.reset")),1)]),_:1}),t(a,{type:"primary",ghost:"",onClick:e(R)},{icon:r(()=>[t(c,{class:"text-icon"})]),default:r(()=>[I(" "+U(e(s)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ae={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Ge=ce('<g transform="rotate(-90 12 12)"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="20" stroke-dashoffset="20" d="M21 3V21"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="20;0"></animate></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M17 12H3.5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.2s" values="15;0"></animate></path><path stroke-dasharray="12" stroke-dashoffset="12" d="M3 12L10 19M3 12L10 5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="12;0"></animate></path></g></g>',1),qe=[Ge];function He(h,y){return T(),Z("svg",Ae,[...qe])}const We={name:"line-md-arrow-open-down",render:He},Je={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Xe=ce('<g transform="rotate(-90 12 12) translate(24 0) scale(-1 1)"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="20" stroke-dashoffset="20" d="M21 3V21"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="20;0"></animate></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M17 12H3.5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.2s" values="15;0"></animate></path><path stroke-dasharray="12" stroke-dashoffset="12" d="M3 12L10 19M3 12L10 5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="12;0"></animate></path></g></g>',1),Ze=[Xe];function Qe(h,y){return T(),Z("svg",Je,[...Ze])}const Ye={name:"line-md-arrow-open-up",render:Qe},et={class:"flex"},tt=G({name:"MenuAuthModal",__name:"menu-auth-modal",props:A({roleRow:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(h){const y=h,u=J(h,"visible");function g(){u.value=!1}const k=P(()=>s("common.edit")+s("page.manage.role.menuAuth")),b=Q([]);function C(a,c=0){var m,w;const i=(m=a.find(o=>o.url=="/manage/role"))==null?void 0:m.id,_=(w=a.find(o=>o.url=="/manage/user"))==null?void 0:w.id;let n=[];function d(o){return o.sort(($,O)=>($.sort||0)-(O.sort||0))}return a.forEach(o=>{if(o.suffix=()=>Re(de,{text:!0,type:o.pid==0&&o.type==0?"warning":o.type==1?"info":"success",size:"small"},{default:()=>o.pid==0&&o.type==0?"目录":o.type==1?"按钮":"菜单"}),(o.pid==i||o.id==i||o.pid==_||o.id==_)&&(o.disabled=!0),o.pid==c){const $=C(a,o.id);$.length>0?o.children=$:o.children=[],n.push(o)}}),d(n)}const z=async()=>{const{error:a,data:c}=await Ne({rtype:y.roleRow.rtype}),i=C(c);if(!a){let _=function(d){for(let m=d.length-1;m>=0;m--)d[m].children&&d[m].children.length>0?_(d[m].children):d[m].children=void 0;return d},n=Ve.cloneDeep(i);n=_(n),b.value=n.filter(d=>d.id<=1e4)}},v=W(!0),R=Q([]);async function p(){const{data:a,error:c}=await se(y.roleRow.id+""),i=[];function _(n,d){return!d.includes(n.id)||n.children&&!n.children.every(m=>_(m,d))?(i.push(n.id),!1):!0}b.value.forEach(n=>{_(n,a.menuIdList)}),R.value=a.menuIdList.filter(n=>!i.includes(n))}const D=W(),B=a=>{D.value=a};function M(){var a,c;we({id:y.roleRow.id,name:y.roleRow.name,menuIdList:R.value.concat(D.value).filter(i=>i!==null)}),(c=(a=window.$message)==null?void 0:a.success)==null||c.call(a,s("common.modifySuccess")),g()}function S(){z(),p()}return oe(u,a=>{a&&S()}),(a,c)=>{const i=Ye,_=We,n=Ee,d=V,m=X,w=xe;return T(),K(w,{show:u.value,"onUpdate:show":c[2]||(c[2]=o=>u.value=o),preset:"card",class:"w-480px"},{header:r(()=>[Y("div",et,[I(U(k.value)+" ",1),Y("div",{class:"ml-10px cursor-pointer",title:"展开/收起",onClick:c[0]||(c[0]=o=>v.value=!v.value)},[v.value?(T(),K(_,{key:1,class:"text-icon"})):(T(),K(i,{key:0,class:"text-icon"}))])])]),footer:r(()=>[t(m,{justify:"end"},{default:r(()=>[t(d,{size:"small",class:"mt-16px",onClick:g},{default:r(()=>[I(U(e(s)("common.cancel")),1)]),_:1}),t(d,{type:"primary",size:"small",class:"mt-16px",onClick:M},{default:r(()=>[I(U(e(s)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(n,{cascade:"","checked-keys":R.value,"onUpdate:checkedKeys":c[1]||(c[1]=o=>R.value=o),data:b.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"",class:"h-60vh","label-field":"name","key-field":"id","children-field":"children","default-expand-all":v.value,onUpdateIndeterminateKeys:B},null,8,["checked-keys","data","default-expand-all"])]),_:1},8,["show"])}}}),at={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function H(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!$e(h)}const vt=G({name:"manage_role",__name:"index",setup(h){const y=De(),{columns:u,columnChecks:g,data:k,getData:b,loading:C,mobilePagination:z,searchParams:v,resetSearchParams:R}=ze({apiFn:Ce,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,name:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:s("page.manage.role.name"),align:"center",minWidth:120,ellipsis:!0},{key:"remark",title:s("page.manage.role.remark"),minWidth:120,align:"center",ellipsis:!0},{key:"rtype",title:s("page.manage.role.type"),width:140,align:"center",render:l=>{l.rtype===void 0&&(l.rtype=0);const f={0:"primary",1:"primary",2:"primary",3:"primary"},x=s(Me[l.rtype]);return t(de,{type:f[l.rtype]},H(x)?x:{default:()=>[x]})}},{key:"operate",title:s("common.operate"),align:"center",render:l=>{let f;return t("div",{class:"flex-center gap-8px"},[L(t(V,{type:"primary",ghost:!0,size:"small",onClick:()=>O(l.id)},H(f=s("common.edit"))?f:{default:()=>[f]}),[[F("no-auth"),"sys:role:update"]]),L(t(V,{type:"primary",ghost:!0,size:"small",onClick:()=>w(l)},{default:()=>["分配权限"]}),[[F("no-auth"),"sys:role:update"]]),[1,2,3].includes(Number(l.id))?"":t(Fe,{onPositiveClick:()=>$(l.id)},{default:()=>s("common.confirmDelete"),trigger:()=>{let x;return L(t(V,{type:"error",ghost:!0,size:"small"},H(x=s("common.delete"))?x:{default:()=>[x]}),[[F("no-auth"),"sys:role:delete"]])}})])}}]}),{drawerVisible:p,operateType:D,editingData:B,handleAdd:M,handleEdit:S,checkedRowKeys:a,onBatchDeleted:c,onDeleted:i,closeDrawer:_}=Be(k,b),{bool:n,setTrue:d}=ae(),m=W({id:0,name:"",remark:"",rtype:0,menuIdList:[]});function w(l){d(),m.value=l}async function o(){console.log(a.value),j(a.value,l=>{c()})}function $(l){console.log(l),j([l],f=>{i()})}function O(l){S(l)}async function j(l,f){const{data:x,error:q}=await Se(l);if(!q)f&&f(x);else return!1}return(l,f)=>{const x=pe,q=Te,ue=ie;return T(),Z("div",at,[t(Pe,{model:e(v),"onUpdate:model":f[0]||(f[0]=N=>E(v)?v.value=N:null),onReset:e(R),onSearch:e(b)},null,8,["model","onReset","onSearch"]),t(ue,{title:e(s)("page.manage.role.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":r(()=>[t(x,{columns:e(g),"onUpdate:columns":f[1]||(f[1]=N=>E(g)?g.value=N:null),"disabled-delete":e(a).length===0,"is-view-add-button":e(ee)("sys:role:save"),"is-view-delete-button":e(ee)("sys:role:delete"),loading:e(C),onAdd:e(M),onDelete:o,onRefresh:e(b)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:r(()=>[t(q,{"checked-row-keys":e(a),"onUpdate:checkedRowKeys":f[2]||(f[2]=N=>E(a)?a.value=N:null),columns:e(u),data:e(k),size:"small","flex-height":!e(y).isMobile,"scroll-x":702,loading:e(C),remote:"","row-key":N=>N.id,pagination:e(z),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Ke,{visible:e(p),"onUpdate:visible":f[3]||(f[3]=N=>E(p)?p.value=N:null),"operate-type":e(D),"row-data":e(B),onSubmitted:e(b)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(tt,{visible:e(n),"onUpdate:visible":f[4]||(f[4]=N=>E(n)?n.value=N:null),roleRow:m.value},null,8,["visible","roleRow"])]),_:1},8,["title"])])}}});export{vt as default};
