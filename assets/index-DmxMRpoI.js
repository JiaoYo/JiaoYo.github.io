import{_ as se}from"./location-outline-B3zou0cc.js";import{_ as ue,A as ie}from"./index-ww9_oJy4.js";import{d as de,s as pe,q as ce,v as P,i as me,bu as D,bv as fe,r as g,Z as _e,b as ge,o as v,f as o,w as a,c as S,z as x,A as z,aq as G,g as u,B as K,ar as ve,h as M,C as ke,N as q,G as ye,e as we,t as R,ax as be,bw as Ce,a0 as V,a3 as Ae}from"./index-BvFB2cuj.js";const Se={class:"flex justify-center"},xe=de({name:"manage_systemconfig",__name:"index",setup(Me){const{formRef:T,validate:j}=pe(),h=ce(),t=P(F());function F(){return{id:0,merror:0,errortime:0,sdkkey:"",sdkh5:"",sdksecret:"",prosite:"",longitude:120.373885,latitude:30.303899}}const k={type:"number",required:!0,message:"不能为空",trigger:["blur","change"]},O={prosite:{type:"string",required:!0,message:"不能为空",trigger:["blur","change"]},longitude:k,latitude:k,merror:k,errortime:k},B=async()=>{const{data:l,error:e}=await Ce();e||(Object.assign(t,l),t.errortime=l.errortime/1e3/60)};me(()=>{B()});const L=D.debounce(async()=>{var n;await j();const l=t.errortime*1e3*60,{error:e}=await fe({...t,errortime:l});e||(n=window.$message)==null||n.success("设置成功")},1e3,{leading:!0,trailing:!1}),f=g(!1),N=g();let p=null,E=null,y=null,I=null,d=null;const w=P({longitude:0,latitude:0});let _;const b=g(!1),c=g(""),C=g([]);async function Y(){window._AMapSecurityConfig={securityJsCode:t.sdksecret},N.value&&(d=await ie.load({key:t.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),p=new d.Map(N.value,{zoom:18,center:[t.longitude,t.latitude],viewMode:"3D",resizeEnable:!0}),E=new d.Geocoder,new d.PlaceSearch({city:"全国",pageSize:50}),I=new d.AutoComplete({city:"全国"}),$(d,{lng:t.longitude,lat:t.latitude}),p.on("click",l=>{const{lng:e,lat:n}=l.lnglat;_=2,$(d,{lng:e,lat:n})}),V(()=>window.dispatchEvent(new Event("resize"))))}const H=D.debounce(async l=>{if(!b.value||!l.trim()){C.value=[];return}I.search(l,(e,n)=>{var s;console.log(n,"result"),e=="complete"&&n.info=="OK"&&((s=n==null?void 0:n.tips)!=null&&s.length)?C.value=n.tips.map(i=>({label:`${i.name}（${i.district||i.address||"无详细地址"}）`,value:`${i.location.lng}_${i.location.lat}`,raw:i})):C.value=[]})},300);_e(c,l=>{H(l)});function J(l,e){if(console.log(l,e,"option"),!l)return;const[n,s]=l.split("_").map(Number);!n||!s||(p.setCenter([n,s]),_=1,$(d,{lng:n,lat:s}),w.longitude=n,w.latitude=s)}function Z(){f.value=!0,b.value=!1,_=void 0,V(async()=>{await Y(),setTimeout(()=>{b.value=!0;const l=document.querySelector(".n-auto-complete input");l==null||l.blur()},500)})}function $(l,e){y&&p.remove(y),y=new l.Marker({position:[e.lng,e.lat],map:p}),p.add(y),E.getAddress(e,(n,s)=>{n==="complete"&&s.regeocode&&(console.log("result",s),console.log("formattedAddress",s.regeocode.formattedAddress),e.latitude=e.lat,e.longitude=e.lng,_==1||(_==2?c.value=s.regeocode.formattedAddress:c.value=t.prosite))})}function Q(){f.value=!1}const W=async()=>{t.latitude=w.latitude,t.longitude=w.longitude,t.prosite=c.value,f.value=!1};return(l,e)=>{const n=K,s=ve,i=G,m=z,A=ke,X=se,U=K,ee=G,te=z,oe=q,ne=ye,le=ue,ae=q,re=be;return v(),ge("div",Se,[o(ne,{ref_key:"formRef",ref:T,"label-width":240,"label-placement":"left",model:t,rules:O},{default:a(()=>[o(m,{label:"打卡误差范围（米）",path:"merror"},{default:a(()=>[o(i,{class:"flex items-center"},{default:a(()=>[o(n,{onClick:e[0]||(e[0]=r=>t.merror--),disabled:t.merror==0},{default:a(()=>e[12]||(e[12]=[u(" − ")])),_:1,__:[12]},8,["disabled"]),o(s,{"show-button":!1,value:t.merror,"onUpdate:value":e[1]||(e[1]=r=>t.merror=r),placeholder:"",min:0,precision:0},null,8,["value"]),o(n,{onClick:e[2]||(e[2]=r=>t.merror++),class:"mr-5px"},{default:a(()=>e[13]||(e[13]=[u(" + ")])),_:1,__:[13]}),e[14]||(e[14]=u(" 米 "))]),_:1,__:[14]})]),_:1}),o(m,{label:"打卡时间误差最大值（分钟）",path:"errortime"},{default:a(()=>[o(i,{class:"flex items-center"},{default:a(()=>[o(n,{onClick:e[3]||(e[3]=r=>t.errortime--),disabled:t.errortime==0},{default:a(()=>e[15]||(e[15]=[u(" − ")])),_:1,__:[15]},8,["disabled"]),o(s,{"show-button":!1,value:t.errortime,"onUpdate:value":e[4]||(e[4]=r=>t.errortime=r),placeholder:"",min:0,precision:0},null,8,["value"]),o(n,{onClick:e[5]||(e[5]=r=>t.errortime++),class:"mr-5px"},{default:a(()=>e[16]||(e[16]=[u(" + ")])),_:1,__:[16]}),e[17]||(e[17]=u(" 分钟 "))]),_:1,__:[17]})]),_:1}),M(h).userInfo.id=="1024"?(v(),S(m,{key:0,label:"AMAP_SDK_KEY",path:"sdkkey"},{default:a(()=>[o(A,{style:{width:"300px"},value:t.sdkkey,"onUpdate:value":e[6]||(e[6]=r=>t.sdkkey=r),placeholder:""},null,8,["value"])]),_:1})):x("",!0),M(h).userInfo.id=="1024"?(v(),S(m,{key:1,label:"AMAP_SDK_KEY_H5",path:"sdkh5"},{default:a(()=>[o(A,{style:{width:"300px"},value:t.sdkh5,"onUpdate:value":e[7]||(e[7]=r=>t.sdkh5=r),placeholder:""},null,8,["value"])]),_:1})):x("",!0),M(h).userInfo.id=="1024"?(v(),S(m,{key:2,label:"AMAP_SDK_SECRET",path:"sdksecret"},{default:a(()=>[o(A,{style:{width:"300px"},value:t.sdksecret,"onUpdate:value":e[8]||(e[8]=r=>t.sdksecret=r),placeholder:""},null,8,["value"])]),_:1})):x("",!0),o(te,{label:"项目地点",path:"prosite"},{default:a(()=>[o(ee,{onClick:Z},{default:a(()=>[o(A,{value:t.prosite,"onUpdate:value":e[9]||(e[9]=r=>t.prosite=r),style:{width:"400px"},placeholder:"请输入项目地点"},null,8,["value"]),o(U,null,{icon:a(()=>[o(X,{class:"text-icon"})]),_:1})]),_:1})]),_:1}),o(m,{label:" "},{default:a(()=>[o(oe,null,{default:a(()=>[o(n,{type:"default",ghost:"",onClick:B},{default:a(()=>e[18]||(e[18]=[u(" 刷新 ")])),_:1,__:[18]}),o(n,{type:"info",ghost:"",onClick:M(L)},{default:a(()=>e[19]||(e[19]=[u(" 保存 ")])),_:1,__:[19]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model"]),o(re,{show:f.value,"onUpdate:show":e[11]||(e[11]=r=>f.value=r),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:a(()=>[o(ae,{justify:"end",size:16},{default:a(()=>[o(U,{onClick:Q},{default:a(()=>[u(R(l.$t("common.cancel")),1)]),_:1}),o(U,{type:"primary",onClick:W},{default:a(()=>[u(R(l.$t("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[b.value?(v(),S(le,{key:0,value:c.value,"onUpdate:value":e[10]||(e[10]=r=>c.value=r),options:C.value,placeholder:"请输入地点关键字",clearable:"",onSelect:J},null,8,["value","options"])):x("",!0),we("div",{ref_key:"domRef",ref:N,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])])}}}),Ue=Ae(xe,[["__scopeId","data-v-863fda1d"]]);export{Ue as default};
