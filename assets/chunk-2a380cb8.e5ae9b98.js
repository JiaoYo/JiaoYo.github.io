(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2a380cb8"],{"1c96":function(e,t,n){"use strict";var o=n("4810");n.n(o).a},4810:function(e,t,n){},"57d5":function(e,t){e.exports={messages:{CN:{commandLineDebug:"命令行调试",commandLine:"命令行",pleaseSelectCommand:"请选择命令",send:"发送",stop:"停止",screen:"筛选",getAllLogs:"查看所有日志",downloadLogs:"下载日志",viewRunningLog:"查看运行日志",viewInterfaceLog:"查看接口日志",viewCollectionLog:"查看采集日志",viewStorageLog:"查看存储日志",viewRestartLog:"查看重启日志",viewResetLog:"查看重置日志",viewOperations:"查看操作日志",viewInverterOperationLogs:"查看逆变器运行日志",pingNetworkTest:"ping(网络测试)",telnetPortDetection:"telnet(端口探测)",ifconfigCheckIpAddress:"ifconfig(查看IP地址)",routeViewRoutingTable:"route(查看路由表)",lsViewFileList:"ls(查看文件列表)",psViewProcessList:"ps(查看进程列表)",uptimeViewTimeInformation:"uptime(查看时间信息)",dfCheckDiskUsage:"df(查看磁盘占用)",getProVerCheckDriverVersionNumber:"get_pro_ver(查看驱动版本号)",authenticationTokenHasExpiredPleaseLogInAgain:"认证 token 已过期，请重新登录",WebSocketconnectionErrorOccurred:"WebSocket连接发生错误"},US:{commandLineDebug:"Command line debug",commandLine:"Command line",pleaseSelectCommand:"请选择命令",send:"Send",stop:"Stop",screen:"Screen",getAllLogs:"Get all logs",downloadLogs:"Download logs",viewRunningLog:"View running log",viewInterfaceLog:"View interface log",viewCollectionLog:"View collection log",viewStorageLog:"View storage log",viewRestartLog:"View restart log",viewResetLog:"View reset log",viewOperations:"View operation log",viewInverterOperationLogs:"View inverter operation log",pingNetworkTest:"ping (network test)",telnetPortDetection:"telnet (port detection)",ifconfigCheckIpAddress:"ifconfig (check IP address)",routeViewRoutingTable:"route (view routing table)",lsViewFileList:"ls (view file list)",psViewProcessList:"ps (view process list)",uptimeViewTimeInformation:"uptime (view time information)",dfCheckDiskUsage:"df (check disk usage)",getProVerCheckDriverVersionNumber:"get_pro_ver (check driver version number)",authenticationTokenHasExpiredPleaseLogInAgain:"Authentication token has expired, please log in again",WebSocketconnectionErrorOccurred:" WebSocket connection error occurred"}}}},e185:function(e,t,n){"use strict";n.r(t);n("caad"),n("c975"),n("a9e3"),n("d3b7"),n("ac1f"),n("2532"),n("3ca3"),n("5319"),n("ddb0"),n("2b3d");var o=n("53ca"),i=n("5530"),a=n("2f62"),r=n("a78e"),s=n.n(r),l=n("b047"),c=n.n(l),m=n("7424"),d=n("e199"),u=n("bc3a"),h=n.n(u),g=["all","run","cgi","service","sql","reboot","reset","operate","inverter"],p={name:"commandlinedebug",i18n:n("57d5"),data:function(){return{websocketArr:g,labelCol:{span:4},wrapperCol:{span:20},labelColEn:{span:6},wrapperColEn:{span:18},activeKey:["1"],dataForm:{inputValue:"ping",addContent:"www.baidu.com",screen:""},commandlineContent:"",typeList:[{name:this.$t("pingNetworkTest"),value:"ping"},{name:this.$t("telnetPortDetection"),value:"telnet"},{name:this.$t("ifconfigCheckIpAddress"),value:"ifconfig"},{name:this.$t("routeViewRoutingTable"),value:"route"},{name:this.$t("lsViewFileList"),value:"ls"},{name:this.$t("psViewProcessList"),value:"ps"},{name:this.$t("uptimeViewTimeInformation"),value:"uptime"},{name:this.$t("dfCheckDiskUsage"),value:"df"},{name:this.$t("getProVerCheckDriverVersionNumber"),value:"get_pro_ver"},{name:this.$t("getAllLogs"),value:"all"},{name:this.$t("viewRunningLog"),value:"run"},{name:this.$t("viewInterfaceLog"),value:"cgi"},{name:this.$t("viewCollectionLog"),value:"service"},{name:this.$t("viewStorageLog"),value:"sql"},{name:this.$t("viewRestartLog"),value:"reboot"},{name:this.$t("viewResetLog"),value:"reset"},{name:this.$t("viewOperations"),value:"operate"},{name:this.$t("viewInverterOperationLogs"),value:"inverter"}],websocket:null,websocketData:null,lockReconnect:!1,timeoutObj:null,reConnectTimer:null,realTimeTimer:null,isStart:!1,spinning:!1}},computed:Object(i.a)(Object(i.a)({},Object(a.e)("account",["user"])),Object(a.e)("setting",["lang"])),methods:{filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},handleSelectCommandChange:function(e){console.log(e),this.websocket&&(this.websocket.close(),this.websocket=null),this.lockReconnect=!1,this.isStart=!1,-1!=this.websocketArr.indexOf(e)?this.dataForm.addContent=100:"ping"==e?this.dataForm.addContent="www.baidu.com":"telnet"==e?this.dataForm.addContent="192.168.11.177 22":"ifconfig"==e?this.dataForm.addContent="":"route"==e?this.dataForm.addContent="-n":"ls"==e?this.dataForm.addContent="":"ps"==e?this.dataForm.addContent="-aux":"uptime"==e?this.dataForm.addContent="":"df"==e?this.dataForm.addContent="-h":"get_pro_ver"==e&&(this.dataForm.addContent="modbusrtu,104client")},formatterAddcontent:function(e){return Number(String(e).replace(/[^0-9]/g,""))},handleInputAddContentChange:function(){this.dataForm.addContent?(this.dataForm.addContent=Number(String(this.dataForm.addContent).replace(/[^0-9]/g,"")),this.dataForm.addContent-50<0&&(this.dataForm.addContent=50),this.dataForm.addContent-500>0&&(this.dataForm.addContent=500)):this.dataForm.addContent=100},handleSendCommandlineChange:c()((function(){var e=this;e.websocket&&(e.websocket.close(),e.websocket=null),e.lockReconnect=!1,e.isStart=!0,-1!=e.websocketArr.indexOf(e.dataForm.inputValue)?(e.commandlineContent="",e.createWebSocket()):(e.spinning=!0,Object(d.f)({command:e.dataForm.addContent?e.dataForm.inputValue+" "+e.dataForm.addContent:e.dataForm.inputValue}).then((function(t){var n=t.data;return n?0!=n.code?(e.spinning=!1,e.isStart=!1,e.$message.config({maxCount:1}),e.$message.destroy(),e.$message.error(n.msg)):(e.commandlineContent=n.data.result,e.spinning=!1,void(e.isStart=!1)):(e.spinning=!1,e.isStart=!1,!1)})).catch((function(t){return e.spinning=!1,e.isStart=!1,console.log(t),!1})))}),1e3,{leading:!0,trailing:!1}),handleStopCommandlineChange:c()((function(){this.websocket&&(this.websocket.close(),this.websocket=null),this.realTimeTimer&&(clearTimeout(this.realTimeTimer),this.realTimeTimer=null),this.lockReconnect=!1,this.isStart=!1}),1e3,{leading:!0,trailing:!1}),downloadLogs:function(){Object(d.i)({name:{all:"ALL",run:"iorun.log",cgi:"iofcgi.log",service:"ioservice.log",sql:"iosql.log",reboot:"reboot.log",reset:"reset_check.log",operate:"operate.log",inverter:"inverter.log"}[this.dataForm.inputValue]}).then((function(e){var t=e.data,n=window.location.origin+"/"+t.data[0].file_path+"/"+t.data[0].file_name;h()({method:"get",url:n,responseType:"blob"}).then((function(e){var n=e.data,o=new Blob([n]),i=document.createElement("a"),a=window.URL.createObjectURL(o);i.href=a,i.download=t.data[0].file_name,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a),document.body.removeChild(i)}))})).catch((function(e){return console.error("下载文件时出错：",e),!1}))},createWebSocket:function(){if(!("WebSocket"in window))return this.$message.error("当前浏览器不支持WebSocket");try{this.isStart=!1;var e=m.WEBSOCKET_URL+"/"+s.a.get("Authorization")+"/log_watch";this.websocket=new WebSocket(e),this.initWebSocket()}catch(e){console.log("尝试创建连接失败"),this.onReConnect()}},initWebSocket:function(){this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onmessage=this.websocketonmessage,this.websocket.onclose=this.websocketonclose},heartCheck:function(){var e=this,t={timeout:2e4,timeoutObj:null,start:function(){e.timeoutObj=setTimeout((function(){e.websocket&&e.websocket.send("connect success")}),2e4)},reset:function(){clearTimeout(e.timeoutObj),t.start()}};return t},onReConnect:function(){var e=this;console.log("尝试重新连接"),e.lockReconnect||(e.reConnectTimer&&clearTimeout(e.reConnectTimer),e.reConnectTimer=setTimeout((function(){e.createWebSocket()}),5e3))},websocketonopen:function(){var e=this;console.log("WebSocket连接成功"),this.isStart=!0,this.lockReconnect=!0,this.websocket.send(JSON.stringify({log_name:this.dataForm.inputValue,line:Number(this.dataForm.addContent),screen:this.dataForm.screen})),this.realTimeTimer=setInterval((function(){if(!window.location.hash.includes("/devicemonitoring/devicemonitoring"))return clearInterval(e.realTimeTimer),e.realTimeTimer=null,!1;e.websocket.send(JSON.stringify({log_name:e.dataForm.inputValue,line:Number(e.dataForm.addContent),screen:e.dataForm.screen}))}),3e3),this.reConnectTimer&&(clearTimeout(this.reConnectTimer),this.reConnectTimer=null),this.heartCheck().start()},websocketonerror:function(e){console.log(e),this.$message.error(this.$t("WebSocketconnectionErrorOccurred")),this.onReConnect()},isJsonString:function(e){if("string"==typeof e)try{var t=JSON.parse(e);return!("object"!==Object(o.a)(t)||!t)}catch(e){return!1}},websocketonmessage:function(e){var t=e.data;if(console.log(e),this.heartCheck().reset(),"连接成功"==t||"connect ack"==t)return!1;if("token is expired"==t)return this.$message.config({maxCount:1}),this.$message.destroy(),this.$message.error(this.$t("authenticationTokenHasExpiredPleaseLogInAgain")),this.$router.replace({path:"/login"}).catch((function(e){return console.log(e),!1}));try{if(this.isJsonString(t)){var n=JSON.parse(t);this.commandlineContent+=n.content,this.$nextTick((function(){var e=document.getElementById("commandlineContentContainer");e.scrollTop=e.scrollHeight}))}}catch(e){console.error("解码异常:",e)}},websocketonclose:function(e){console.log("断开连接",e)}},activated:function(){-1!=this.websocketArr.indexOf(this.dataForm.inputValue)&&this.isStart&&this.createWebSocket()},watch:{lang:{handler:function(){this.typeList=[{name:this.$t("pingNetworkTest"),value:"ping"},{name:this.$t("telnetPortDetection"),value:"telnet"},{name:this.$t("ifconfigCheckIpAddress"),value:"ifconfig"},{name:this.$t("routeViewRoutingTable"),value:"route"},{name:this.$t("lsViewFileList"),value:"ls"},{name:this.$t("psViewProcessList"),value:"ps"},{name:this.$t("uptimeViewTimeInformation"),value:"uptime"},{name:this.$t("dfCheckDiskUsage"),value:"df"},{name:this.$t("getProVerCheckDriverVersionNumber"),value:"get_pro_ver"},{name:this.$t("getAllLogs"),value:"all"},{name:this.$t("viewRunningLog"),value:"run"},{name:this.$t("viewInterfaceLog"),value:"cgi"},{name:this.$t("viewCollectionLog"),value:"service"},{name:this.$t("viewStorageLog"),value:"sql"},{name:this.$t("viewRestartLog"),value:"reboot"},{name:this.$t("viewResetLog"),value:"reset"},{name:this.$t("viewOperations"),value:"operate"},{name:this.$t("viewInverterOperationLogs"),value:"inverter"}]},deep:!0,immediate:!0}},deactivated:function(){this.websocket&&(this.websocket.close(),this.websocket=null),this.reConnectTimer&&(clearTimeout(this.reConnectTimer),this.reConnectTimer=null),this.timeoutObj&&(clearTimeout(this.timeoutObj),this.timeoutObj=null)},beforeDestroy:function(){this.lockReconnect=!1,this.realTimeTimer&&(clearInterval(this.realTimeTimer),this.realTimeTimer=null),this.websocket&&(this.websocket.close(),this.websocket=null),this.reConnectTimer&&(clearTimeout(this.reConnectTimer),this.reConnectTimer=null),this.timeoutObj&&(clearTimeout(this.timeoutObj),this.timeoutObj=null),this.chlStatusTimer&&(clearInterval(this.chlStatusTimer),this.chlStatusTimer=null)}},w=(n("1c96"),n("0c7c")),b=Object(w.a)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-card",[n("a-collapse",{model:{value:e.activeKey,callback:function(t){e.activeKey=t},expression:"activeKey"}},[n("a-collapse-panel",{key:"1",attrs:{header:e.$t("commandLineDebug"),disabled:""}},[n("a-form-model",{attrs:{colon:!1,model:e.dataForm,"label-col":"US"==e.lang?e.labelColEn:e.labelCol,"wrapper-col":"US"==e.lang?e.wrapperColEn:e.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSendCommandlineChange(t)}}},[n("a-row",{attrs:{type:"flex",align:"middle"}},[n("a-col",{attrs:{span:-1!=e.websocketArr.indexOf(e.dataForm.inputValue)?7:10}},[n("a-form-model-item",{attrs:{label:e.$t("commandLine"),prop:"inputValue"}},[n("a-select",{staticStyle:{width:"100%"},attrs:{"show-search":"",allowClear:!1,placeholder:e.$t("pleaseSelectCommand"),"option-filter-prop":"children","filter-option":e.filterOption},on:{change:e.handleSelectCommandChange},model:{value:e.dataForm.inputValue,callback:function(t){e.$set(e.dataForm,"inputValue",t)},expression:"dataForm.inputValue"}},e._l(e.typeList,(function(t){return n("a-select-option",{key:t.value,attrs:{label:t.name,value:t.value}},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),n("a-col",{attrs:{span:-1!=e.websocketArr.indexOf(e.dataForm.inputValue)?7:11}},[-1!=e.websocketArr.indexOf(e.dataForm.inputValue)?n("a-form-model-item",{attrs:{label:"————",prop:"addContent"}},[n("a-input-number",{staticStyle:{width:"100%"},attrs:{min:50,max:200,formatter:e.formatterAddcontent},model:{value:e.dataForm.addContent,callback:function(t){e.$set(e.dataForm,"addContent",t)},expression:"dataForm.addContent"}})],1):n("a-form-model-item",{attrs:{label:"——————",prop:"addContent"}},[n("a-input",{model:{value:e.dataForm.addContent,callback:function(t){e.$set(e.dataForm,"addContent",t)},expression:"dataForm.addContent"}})],1)],1),-1!=e.websocketArr.indexOf(e.dataForm.inputValue)?n("a-col",{attrs:{span:4}},[n("a-form-model-item",{staticStyle:{"margin-left":"10px"},attrs:{label:e.$t("screen"),prop:"screen"}},[n("a-input",{model:{value:e.dataForm.screen,callback:function(t){e.$set(e.dataForm,"screen",t)},expression:"dataForm.screen"}})],1)],1):e._e(),n("a-col",{staticStyle:{"text-align":"center"},attrs:{span:-1!=e.websocketArr.indexOf(e.dataForm.inputValue)?5:3}},[n("a-form-model-item",{staticStyle:{"margin-left":"30px"},attrs:{label:""}},[n("a-space",[n("a-button",{attrs:{type:"primary",disabled:e.isStart},on:{click:e.handleSendCommandlineChange}},[e.isStart?n("my-icon",{attrs:{type:"icon-fasong"}}):n("my-icon",{attrs:{type:"icon-fasong-copy"}}),e._v(" "+e._s(e.$t("send"))+" ")],1),-1!=e.websocketArr.indexOf(e.dataForm.inputValue)?n("a-button",{attrs:{disabled:!e.isStart,icon:"pause-circle",type:"primary"},on:{click:e.handleStopCommandlineChange}},[e._v(e._s(e.$t("stop")))]):e._e(),-1!=e.websocketArr.indexOf(e.dataForm.inputValue)?n("a-button",{attrs:{icon:"download",type:"primary"},on:{click:e.downloadLogs}},[e._v(e._s(e.$t("downloadLogs")))]):e._e()],1)],1)],1)],1)],1),n("a-spin",{attrs:{spinning:e.spinning}},[n("a-textarea",{ref:"commandlineContentRef",attrs:{id:"commandlineContentContainer",readOnly:"","auto-size":{minRows:30,maxRows:30}},model:{value:e.commandlineContent,callback:function(t){e.commandlineContent=t},expression:"commandlineContent"}})],1)],1)],1)],1)}),[],!1,null,"2505e62f",null).exports;t.default=b}}]);