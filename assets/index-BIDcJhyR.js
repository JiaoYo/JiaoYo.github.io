import{j as E,b as R,k as ie,m as ce,d as V,n as W,p as G,u as le,a as H,q as X,r as F,s as J,v as de,x as T,y as ue,o as v,c as U,w as h,g as f,z as A,i as g,$ as y,A as j,f as C,C as D,h as z,t as P,D as pe,E as fe,F as Q,G as Y,H as me,B as Z,I as ee,J as oe,K as ge,L as _e,M as q,N as he,O as we,R as ve,P as ye,Q as K,S as ke,T as xe,U as Ce,V as Pe,W as Se,e as x,X as be,Y as Re,Z as L,a0 as Ee}from"./index-F0x4z3rt.js";function Ue(t){const c=E(0),w=R(()=>Math.ceil(c.value/60)),l=R(()=>c.value>0),{pause:o,resume:e}=ie(()=>{c.value>0?c.value-=1:o()},{immediate:!1});function r(a=t){c.value=60*a,e()}function n(){c.value=0,o()}return ce(()=>{o()}),{count:w,isCounting:l,start:r,stop:n}}/*! js-cookie v3.0.5 | MIT */function N(t){for(var i=1;i<arguments.length;i++){var c=arguments[i];for(var w in c)t[w]=c[w]}return t}var Ne={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function B(t,i){function c(l,o,e){if(!(typeof document>"u")){e=N({},i,e),typeof e.expires=="number"&&(e.expires=new Date(Date.now()+e.expires*864e5)),e.expires&&(e.expires=e.expires.toUTCString()),l=encodeURIComponent(l).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var r="";for(var n in e)e[n]&&(r+="; "+n,e[n]!==!0&&(r+="="+e[n].split(";")[0]));return document.cookie=l+"="+t.write(o,l)+r}}function w(l){if(!(typeof document>"u"||arguments.length&&!l)){for(var o=document.cookie?document.cookie.split("; "):[],e={},r=0;r<o.length;r++){var n=o[r].split("="),a=n.slice(1).join("=");try{var d=decodeURIComponent(n[0]);if(e[d]=t.read(a,d),l===d)break}catch{}}return l?e[l]:e}}return Object.create({set:c,get:w,remove:function(l,o){c(l,"",N({},o,{expires:-1}))},withAttributes:function(l){return B(this.converter,N({},this.attributes,l))},withConverter:function(l){return B(N({},this.converter,l),this.attributes)}},{attributes:{value:Object.freeze(i)},converter:{value:Object.freeze(t)}})}var te=B(Ne,{path:"/"});const $=(t,i,c)=>{te.set(t,i)},I=t=>te.get(t),Ie=t=>(ge("data-v-a2fd546a"),t=t(),_e(),t),ze={class:"w-full flex-y-center gap-16px"},Le=["src"],Me={class:"flex-y-center justify-between updatePsd"},je=Ie(()=>C("div",{style:{display:"flex","justify-content":"right","align-items":"center"}},null,-1)),$e=V({name:"PwdLogin",__name:"pwd-login",props:{status:{type:String,required:!0},statusModifiers:{}},emits:W(["getUsername"],["update:status"]),setup(t,{emit:i}){const c=G(t,"status"),w=le();H();const{formRef:l,validate:o}=X(),e=F({username:"",captcha:"",password:""}),r=F({uuid:"",captchaSrc:"",captchaEnable:0,checked:!1});async function n(){const{data:s,error:p}=await pe();p||(r.captchaEnable=s.data,r.captchaEnable==1&&a())}async function a(){r.uuid=T(),r.captchaSrc=fe+"/captcha?uuid="+r.uuid}const d=R(()=>{const{formRules:s}=J();return{username:s.username,captcha:s.captcha,password:s.password}});async function u(){var p;await o(),r.checked?m(e.username,e.password,r.checked):k();const s=await w.login(e.username,e.password,e.captcha.trim(),r.uuid);console.log(s),((p=s==null?void 0:s.data)==null?void 0:p.login)===0&&setTimeout(()=>{const S=new CustomEvent("myCustomEvent");document.dispatchEvent(S)},500),s=="fail"&&r.captchaEnable==1&&(e.captcha="",a())}function m(s,p,S){$("energy_storage_user",s),$("energy_storage_pwd",p),$("energy_storage_check",String(S))}function _(){e.username=I("energy_storage_user")||"",e.password=I("energy_storage_pwd")||"",c.value=="pwd-login1"&&(e.password=""),r.checked=I("energy_storage_check")?I("energy_storage_check")=="true":!1}function k(){m("","",!1)}return E(!1),de(()=>{r.uuid=T(),_(),n()}),(s,p)=>{const S=Q,M=Y,se=me,ne=Z,ae=ee,re=oe,O=ue("no-space");return v(),U(re,{ref_key:"formRef",ref:l,model:e,rules:d.value,size:"large","show-label":!1},{default:h(()=>[f(M,{path:"userName"},{default:h(()=>[A(f(S,{autofocus:"",value:e.username,"onUpdate:value":p[0]||(p[0]=b=>e.username=b),placeholder:g(y)("page.login.common.userNamePlaceholder"),onKeyup:j(u,["enter"])},null,8,["value","placeholder"]),[[O]])]),_:1}),f(M,{path:"password"},{default:h(()=>[A(f(S,{value:e.password,"onUpdate:value":p[1]||(p[1]=b=>e.password=b),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:g(y)("page.login.common.passwordPlaceholder"),onKeyup:j(u,["enter"])},null,8,["value","placeholder"]),[[O]])]),_:1}),r.captchaEnable==1?(v(),U(M,{key:0,path:"captcha"},{default:h(()=>[C("div",ze,[f(S,{value:e.captcha,"onUpdate:value":p[2]||(p[2]=b=>e.captcha=b),placeholder:"请输入验证码",onKeyup:j(u,["enter"])},null,8,["value"]),C("img",{src:r.captchaSrc,alt:"captcha",style:{height:"40px"},onClick:a},null,8,Le)])]),_:1})):D("",!0),f(ae,{vertical:"",size:8},{default:h(()=>[C("div",Me,[f(se,{checked:r.checked,"onUpdate:checked":p[3]||(p[3]=b=>r.checked=b)},{default:h(()=>[z(P(g(y)("page.login.pwdLogin.rememberMe")),1)]),_:1},8,["checked"])]),f(ne,{type:"primary",size:"large",ghost:"",round:"",block:"",loading:g(w).loginLoading,onClick:u},{default:h(()=>[z(P(g(y)("common.confirm")),1)]),_:1},8,["loading"]),je]),_:1})]),_:1},8,["model","rules"])}}}),Fe=q($e,[["__scopeId","data-v-a2fd546a"]]);function De(){const{loading:t,startLoading:i,endLoading:c}=he(),{count:w,start:l,stop:o,isCounting:e}=Ue(60),r=R(()=>{let d=y("page.login.codeLogin.getCode");const u=y("page.login.codeLogin.reGetCode",{time:w.value});return t.value&&(d=""),e.value&&(d=u),d});function n(d){var u,m,_,k;return d.trim()===""?((m=(u=window.$message)==null?void 0:u.error)==null||m.call(u,y("form.mobile.required")),!1):ve.test(d)?!0:((k=(_=window.$message)==null?void 0:_.error)==null||k.call(_,y("form.mobile.invalid")),!1)}async function a(d,u){!n(d)||t.value||(i(),await new Promise(_=>{we(d,u).then(k=>{var s,p;console.log("response",k),k.error||(setTimeout(_,500),(p=(s=window.$message)==null?void 0:s.success)==null||p.call(s,y("page.login.codeLogin.sendCodeSuccess")),l(),c())}).catch(k=>{var s,p;return console.log("error",k),(p=(s=window.$message)==null?void 0:s.error)==null||p.call(s,y("page.login.codeLogin.sendCodeFailed")),!1})}))}return{label:r,start:l,stop:o,isCounting:e,loading:t,getCaptcha:a}}const Be=V({name:"ResetPwd",__name:"reset-pwd",props:W({username:{type:String,required:!0}},{status:{type:String,required:!0},statusModifiers:{}}),emits:["update:status"],setup(t){const i=G(t,"status"),c=t;H();const{formRef:w,validate:l}=X();De();const o=F({username:c.username||"",oripwd:"",code:"",password:"",confirmPassword:""}),e=R(()=>{const{formRules:n,createConfirmPwdRule:a,defaultRequiredRule:d}=J();return{username:n.username,oripwd:n.password,password:[{...d},{asyncValidator:(u,m)=>m==""||m==null?Promise.resolve():ye(m)?o.username&&m.includes(o.username)?Promise.reject("密码禁止与用户名相同或包含用户名"):o.password==o.oripwd?Promise.reject("新密码不能与旧密码相同"):Promise.resolve():Promise.reject("密码应符合：大、小写字母、数字、特殊字符的三种或以上的组合"),trigger:["blur","input"]}],code:n.code,confirmPassword:a(o.password)}});async function r(){var m,_;await l();const n=await K(o.oripwd),a=await K(o.password),{data:d,error:u}=await ke(o.username,n,a);console.log("data",d),u?(_=window.$message)==null||_.error("修改失败"):((m=window.$message)==null||m.success("修改成功"),i.value="pwd-login1")}return(n,a)=>{const d=Q,u=Y,m=Z,_=ee,k=oe;return v(),U(k,{ref_key:"formRef",ref:w,model:o,rules:e.value,size:"large","show-label":!1},{default:h(()=>[f(u,{path:"username"},{default:h(()=>[f(d,{value:o.username,"onUpdate:value":a[0]||(a[0]=s=>o.username=s),placeholder:g(y)("page.login.common.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1}),f(u,{path:"oripwd"},{default:h(()=>[f(d,{value:o.oripwd,"onUpdate:value":a[1]||(a[1]=s=>o.oripwd=s),type:"password","show-password-on":"click",placeholder:"请输入原密码"},null,8,["value"])]),_:1}),f(u,{path:"password"},{default:h(()=>[f(d,{value:o.password,"onUpdate:value":a[2]||(a[2]=s=>o.password=s),type:"password","show-password-on":"click",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),f(u,{path:"confirmPassword"},{default:h(()=>[f(d,{value:o.confirmPassword,"onUpdate:value":a[3]||(a[3]=s=>o.confirmPassword=s),type:"password","show-password-on":"click",placeholder:g(y)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1}),f(_,{vertical:"",size:18,class:"w-full"},{default:h(()=>[f(m,{type:"primary",size:"large",ghost:"",round:"",block:"",onClick:r},{default:h(()=>[z(P(g(y)("common.confirm")),1)]),_:1}),f(m,{size:"large",ghost:"",round:"",block:"",onClick:a[4]||(a[4]=s=>i.value="pwd-login"),class:"c-#fff"},{default:h(()=>[z(P(g(y)("page.login.common.back")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),Ve=q(Be,[["__scopeId","data-v-93343e55"]]),qe={class:"w-400px lt-sm:w-300px"},Oe={class:"flex-y-center justify-center"},Te={key:0,src:L,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},Ae={key:1,src:L,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},Ke={key:2,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},We={key:3,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},Ge={class:"pt-24px"},He={class:"pt-16px"},Xe={class:"flex justify-center items-center",style:{position:"fixed",top:"20px",right:"20px","z-index":"999"}},Je={key:0,src:L,alt:"Linkqi",class:"w-100px pr-10px"},Qe={key:1,src:L,alt:"Linkqi",class:"w-100px pr-10px"},Ye={key:2,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},Ze={key:3,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},eo={key:0,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},oo={key:1,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},to=V({name:"login",__name:"index",props:{module:{}},setup(t){xe();const i=Ce(),c=E("pwd-login");R(()=>i.darkMode?Pe(i.themeColor,600):i.themeColor);const w=E(""),l=n=>{w.value=n},o=R(()=>{const n="#ffffff",a=i.darkMode?.5:.2;return Se(n,i.themeColor,a)}),e=E();return(async()=>{fetch("/version.json").then(n=>n.json()).then(n=>{e.value=n}).catch(n=>{console.error("Error fetching version.json:",n)})})(),(n,a)=>{var u,m;const d=Ee;return v(),x("div",{class:"relative size-full flex-center overflow-hidden login",style:Re({backgroundColor:o.value})},[f(d,{bordered:!1,class:"relative z-4 w-auto rd-12px loginClass","content-style":{padding:"24px 36px"}},{default:h(()=>[C("div",qe,[C("header",Oe,[g(i).darkMode?(v(),x("img",Ae)):(v(),x("img",Te)),g(i).darkMode?(v(),x("h3",Ke,P(g(y)("system.title")),1)):(v(),x("h3",We,P(g(y)("system.title")),1))]),C("main",Ge,[C("div",He,[f(be,{name:g(i).page.animateMode,mode:"out-in",appear:""},{default:h(()=>[c.value=="pwd-login"||c.value=="pwd-login1"?(v(),U(Fe,{key:0,status:c.value,"onUpdate:status":a[0]||(a[0]=_=>c.value=_),onGetUsername:l},null,8,["status"])):(v(),U(Ve,{key:1,status:c.value,"onUpdate:status":a[1]||(a[1]=_=>c.value=_),username:w.value},null,8,["status","username"]))]),_:1},8,["name"])])])])]),_:1}),C("div",Xe,[g(i).darkMode?(v(),x("img",Qe)):(v(),x("img",Je)),g(i).darkMode?(v(),x("span",Ye,P(((u=e.value)==null?void 0:u.ver)||"V1.1.6"),1)):(v(),x("span",Ze,P(((m=e.value)==null?void 0:m.ver)||"V1.1.6"),1))]),g(i).darkMode?D("",!0):(v(),x("div",eo," Copyright (c) 2024 · 杭州领祺科技有限公司")),g(i).darkMode?(v(),x("div",oo," Copyright (c) 2024 · 杭州领祺科技有限公司")):D("",!0)],4)}}}),no=q(to,[["__scopeId","data-v-8c835d7a"]]);export{no as default};
