(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7a1cb21f"],{"38b9":function(e,t,a){},"5dda":function(e,t,a){"use strict";var r=a("38b9");a.n(r).a},"80c1":function(e,t,a){"use strict";a.r(t);a("7db0"),a("c740"),a("4160"),a("c975"),a("a434"),a("159b"),a("96cf");var r=a("1da1"),s=a("5530"),n=a("6c27"),o=a("e199"),i=a("b775"),l=a("2f62"),c={name:"Login",i18n:a("e0bd"),data:function(){return{systemInfo:{},labelCol:{span:4},wrapperCol:{span:20},labelColEn:{span:6},wrapperColEn:{span:18},languageList:[{name:"中文简体",value:"CN"},{name:"English",value:"US"}],dataForm:{language:1,username:"admin",password:"public"},rules:{password:[{required:!0,message:this.$t("passwordCanNotBeEmpty"),trigger:"change"}]}}},computed:Object(s.a)(Object(s.a)({},Object(l.e)("setting",["theme","menuData","isMobile","layout","systemName","lang","pageWidth"])),{},{userList:function(){return[{name:this.$t("advancedUser"),value:"admin",en:"advancedUser",txt:"public"},{name:this.$t("operator"),value:"user",en:"operator",txt:"public"},{name:this.$t("visitor"),value:"visitor",en:"visitor",txt:"123456"}]}}),methods:Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)({},Object(l.b)("setting",["setLang"])),Object(l.d)("setting",["setMenuData","setLoginInfo"])),Object(l.d)("account",["setUser","setPermissions","setRoles"])),{},{filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},handleUsernameChange:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:(r=t).$pboxLoggerDatabase.getItem("PboxLoggerLoginUser").then((function(t){if(t&&t.length>0)for(var a=0;a<t.length;a++)if(t[a].value==e){r.dataForm.password=t[a].txt;break}})).catch((function(e){console.log(e)}));case 2:case"end":return a.stop()}}),a)})))()},handleLoginChange:function(){var e=this;e.$refs.dataRulesForm.validate((function(t){if(!t)return!1;var a=e.dataForm.username,r=Object(n.sha256)(e.dataForm.password),s="US"==e.dataForm.language?2:1;Object(o.L)({user:a,pswd:r,language:s}).then(e.afterLogin).catch((function(t){return console.log("error",t),e.$message.config({maxCount:1}),e.$message.destroy(),e.$message.error(JSON.stringify(t)),!1}))}))},afterLogin:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function a(){var r,n,l,c,u,g,m,d,p;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=!1,l="US"==(r=t).dataForm.language?2:1,r.logging=!1,!((c=e.data).code>=0&&"ok"==c.data.result)){a.next=18;break}"visitor"==r.dataForm.username&&(u=r.menuData,function e(t,a){for(var r=0;r<t.length;r++){var s=t[r];s.children&&s.children.length>0&&e(s.children,a),s.path!=a||(t.splice(r,1),r--)}}(u,"firmwareupgrade"),r.setMenuData(u)),g=JSON.parse(JSON.stringify(r.userList)),m=r.userList.find((function(e){return e.value==r.dataForm.username})).txt,d=r.userList.findIndex((function(e){return e.value==r.dataForm.username})),r.$set(g[d],"txt",r.dataForm.password),r.$pboxLoggerDatabase.setItem("PboxLoggerLoginUser",g),n="admin"==r.dataForm.username||"user"==r.dataForm.username?"public"==m:"123456"==m,r.setLoginInfo(Object(s.a)(Object(s.a)({},c.data),{},{isOriginPassword:n})),p=c.data.user,r.setUser(p),r.setPermissions([p]),r.setRoles([p]),Object(i.f)({Authorization:"logger-bd98ae699fd64d63baba04caf77ffd68"}),l==r.systemInfo.language?r.$router.push("/dashboard/workplace"):Object(o.bb)({language:l}).then((function(e){var t=e.data;return!!t&&(0!=t.code?(r.$message.config({maxCount:1}),r.$message.destroy(),r.$message.error(t.msg)):"success"!=t.data.result?(r.$message.config({maxCount:1}),r.$message.destroy(),r.$message.error(t.data.result)):(r.$message.config({maxCount:1}),r.$message.destroy(),void r.$router.push("/dashboard/workplace")))})),a.next=21;break;case 18:return r.$message.config({maxCount:1}),r.$message.destroy(),a.abrupt("return",r.$message.error(c.data.result+", "+r.$t("numberOfAttemptsRemaining")+": "+(c.data.login_fail_limit-c.data.login_fail_cnt)+r.$t("times")));case 21:case"end":return a.stop()}}),a)})))()},getSystemBaseInfo:function(){var e=this,t=document.querySelector("link[rel*='icon']");Object(o.F)().then((function(a){var r=a.data;return!!r&&(0!=r.code?(e.$message.config({maxCount:1}),e.$message.destroy(),e.$message.error(r.msg)):(e.systemInfo=r.data,t&&e.systemInfo.icon&&"favicon.ico"!=e.systemInfo.icon&&(t.href=e.systemInfo.icon),e.dataForm.language=2==e.systemInfo.language?"US":"CN",void e.setLang(2==e.systemInfo.language?"US":"CN")))})).catch((function(e){return console.log(e),!1}))},getUserListFromIndexDb:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(a=e).$pboxLoggerDatabase.getItem("PboxLoggerLoginUser").then((function(e){if(e)if(e.length>0){var t=[];e.forEach((function(e){e.value==a.dataForm.username&&(a.dataForm.password=e.txt),t.push({name:a.$t("".concat(e.en)),en:e.en,txt:e.txt,value:e.value})})),a.userList=t}else a.$pboxLoggerDatabase.setItem("PboxLoggerLoginUser",a.userList);else a.$pboxLoggerDatabase.setItem("PboxLoggerLoginUser",a.userList)})).catch((function(e){console.log(e)})),a.$pboxLoggerDatabase.getItem("PboxLoggerLoginNoice").then((function(e){e||a.$pboxLoggerDatabase.setItem("PboxLoggerLoginNoice",0)})).catch((function(e){console.log(e)}));case 3:case"end":return t.stop()}}),t)})))()}}),created:function(){this.getSystemBaseInfo()},mounted:function(){this.$pboxLoggerDatabase.setItem("PboxLoggerLoginNoiceCount",0),this.getUserListFromIndexDb()},watch:{"dataForm.language":{handler:function(){this.getUserListFromIndexDb()},deep:!0,immediate:!0}}},u=(a("5dda"),a("0c7c")),g=Object(u.a)(c,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},["{}"!=JSON.stringify(e.systemInfo)?a("div",{staticClass:"right"},[a("a-form-model",{ref:"dataRulesForm",staticClass:"user-layout-login",attrs:{"label-col":"CN"==e.dataForm.language?e.labelCol:e.labelColEn,"wrapper-col":"CN"==e.dataForm.language?e.wrapperCol:e.wrapperColEn,model:e.dataForm,rules:e.rules},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLoginChange(t)}}},[a("div",{staticStyle:{"text-align":"center"}},[a("h2",{staticStyle:{color:"#fff","margin-top":"10px","margin-bottom":"10px","font-weight":"bolder"}},[e._v(e._s(e.systemInfo.name))])]),a("a-form-model-item",{attrs:{label:e.$t("language"),prop:"username"}},[a("a-select",{staticStyle:{width:"100%"},attrs:{"show-search":"",placeholder:e.$t("pleaseSelectLanguage"),"option-filter-prop":"children","filter-option":e.filterOption},on:{change:function(t){return e.setLang(t)}},model:{value:e.dataForm.language,callback:function(t){e.$set(e.dataForm,"language",t)},expression:"dataForm.language"}},e._l(e.languageList,(function(t,r){return a("a-select-option",{key:r,attrs:{value:t.value}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("a-form-model-item",{attrs:{label:e.$t("user"),prop:"username"}},[a("a-select",{staticStyle:{width:"100%"},attrs:{"show-search":"",placeholder:e.$t("pleaseSelectUser"),"option-filter-prop":"children","filter-option":e.filterOption},on:{change:e.handleUsernameChange},model:{value:e.dataForm.username,callback:function(t){e.$set(e.dataForm,"username",t)},expression:"dataForm.username"}},e._l(e.userList,(function(t,r){return a("a-select-option",{key:r,attrs:{value:t.value}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("a-form-model-item",{attrs:{label:e.$t("password"),prop:"password"}},[a("a-input-password",{ref:"password",attrs:{placeholder:e.$t("pleaseEnterPassword")},model:{value:e.dataForm.password,callback:function(t){e.$set(e.dataForm,"password",t)},expression:"dataForm.password"}},[a("a-icon",{style:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),a("a-form-model-item",{staticStyle:{"margin-top":"24px"},attrs:{wrapperCol:{offset:2,span:22}}},[a("a-button",{staticClass:"login-button",attrs:{type:"primary"},on:{click:e.handleLoginChange}},[e._v(e._s(e.$t("confirm")))])],1),a("div",{staticClass:"web_verision"},[e._v(" "+e._s(e.$t("webVersion")+": "+e.systemInfo.web_ver)+" ")]),a("div",{staticClass:"copyright"},[e._v("Copyright "),a("a-icon",{attrs:{type:"copyright"}}),e._v(e._s(e.systemInfo.company))],1)],1)],1):e._e()])}),[],!1,null,"60f992e1",null).exports;t.default=g},e0bd:function(e,t){e.exports={messages:{CN:{language:"语言",pleaseSelectLanguage:"请选择语言",user:"用户",pleaseSelectUser:"请选择用户",password:"密码",pleaseEnterPassword:"请输入密码",advancedUser:"高级用户",operator:"操作员",visitor:"游客",confirm:"确定",passwordCanNotBeEmpty:"密码不能为空",loginSuccess:"登录成功",loginFailed:"登录失败",webVersion:"网页版本",numberOfAttemptsRemaining:"剩余尝试次数",times:"次",lastLoginFailureTime:"最后一次登录失败时间"},US:{language:"Language",pleaseSelectLanguage:"Please select language",user:"User",pleaseSelectUser:"Please select user",password:"Password",pleaseEnterPassword:"Please enter password",advancedUser:"advanced User",operator:"Operator",visitor:"Visitor",confirm:"Confirm",passwordCanNotBeEmpty:"Password can not be blank",loginSuccess:"Login Successful",loginFailed:"Login Failed",webVersion:"Web version",numberOfAttemptsRemaining:"Number of attempts remaining",times:"times",lastLoginFailureTime:"Last login failure time"}}}}}]);