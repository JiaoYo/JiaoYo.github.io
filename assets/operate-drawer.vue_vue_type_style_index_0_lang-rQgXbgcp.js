import{az as p,d as $,aE as C,r as F,n as J,a as A,aG as H,bY as Y,cq as K,aC as Q,c as v,o as _,w as i,f as l,C as W,s as P,v as X,h as d,aD as Z,e as ee,t as w,x as b,N as te,B as z,g as N,$ as S,a0 as ae,cs as oe,aO as re}from"./index-CcoV6zGT.js";import{u as le}from"./usePageData-Cw3E-n6n.js";function be(a){return p({url:"/projectDailyReport/getPage.do",method:"get",params:a})}function se(a){return p({url:"/projectDailyReport/insert.do",method:"post",data:a})}function ne(a){return p({url:"/projectDailyReport/getIdByUuid.do",method:"get",params:a})}function ie(a){return p({url:"/projectDailyReport/update.do",method:"put",data:a})}function ge(a){return p({url:"/projectDailyReport/delete.do",method:"delete",params:{arrIds:a}})}function de(a){return p({url:"/projectDaily/insert.do",method:"post",data:a})}function ye(a){return p({url:"/projectComment/getPage.do",method:"get",params:a})}function he(a){return p({url:"/projectComment/insert.do",method:"post",data:a})}function ve(a){return p({url:"/projectComment/delete.do",method:"delete",params:{arrIds:a}})}const _e=$({name:"OperateDrawer",__name:"operate-drawer",props:C({operateType:{},rowData:{},pid:{},pname:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:C(["submitted"],["update:visible"]),setup(a,{emit:L}){const D=L,{pageData:u,getData:j,nextPage:U}=le(oe),B=async o=>{const t=o.currentTarget,n=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&u.data.length<u.total&&(await U(),await re(),setTimeout(()=>{t.scrollTop=n}))},s=a,e=F(k());function k(){return{id:"",proname:"",notes:"",problem:"",solutions:"",feedback:"",summarize:"",pids:[]}}const O={notes:{required:!0,message:"请输入",trigger:"blur"}};async function R(){if(await j({fuzzy:s.pname,page:1}),Object.assign(e,k()),s.operateType==="add"&&(console.log(s.pid),s.pid&&(u.data.forEach(o=>{o.id==s.pid&&(o.disabled=!0)}),e.pids.push(s.pid))),s.operateType==="edit"&&s.rowData){Object.assign(e,s.rowData);const o=JSON.parse(s.rowData.context);e.proname=o.proname,e.notes=o.notes,e.problem=o.problem,e.solutions=o.solutions,e.feedback=o.feedback,e.summarize=o.summarize}}const{formRef:M,validate:G,restoreValidation:V}=J(),q=()=>{j({page:1})},E=A(()=>({add:"新增项目日报",edit:"修改项目日报"})[s.operateType]),c=H(a,"visible"),y=()=>{c.value=!1},I=Y.debounce(async()=>{var o,t;if(await G(),s.operateType==="edit"){const n=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:g,error:m}=await ie([{context:n,id:e.id}]);m||((o=window.$message)==null||o.success("修改成功"),D("submitted"),y())}else{const n=K(),g=u.data.filter(f=>e.pids.includes(f.id)).map(f=>f.proname);e.proname=g.join(",");const m=JSON.stringify({proname:e.proname,notes:e.notes,problem:e.problem,solutions:e.solutions,feedback:e.feedback,summarize:e.summarize}),{data:x,error:r}=await se([{context:m,uuid:n}]);if(!r){const{data:f,error:pe}=await ne({uuid:n});if(e.pids.length>0){let T=e.pids.map(h=>({pid:h}));T.forEach(h=>{h.did=f});const{data:ue,error:ce}=await de(T)}(t=window.$message)==null||t.success("添加成功"),D("submitted"),y()}}},1e3,{leading:!0,trailing:!1});return Q(c,()=>{c.value&&(R(),setTimeout(()=>{const o=document.querySelector(".n-scrollbar-content");o==null||o.scrollTo(0,0)},300),V())}),(o,t)=>{const n=X,g=W,m=te,x=ae;return _(),v(x,{show:c.value,"onUpdate:show":t[6]||(t[6]=r=>c.value=r),title:E.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:i(()=>[l(m,{justify:"end"},{default:i(()=>[l(d(z),{size:"small",class:"mt-16px",onClick:y},{default:i(()=>[N(w(d(S)("common.cancel")),1)]),_:1}),l(d(z),{type:"primary",size:"small",class:"mt-16px",onClick:d(I)},{default:i(()=>[N(w(d(S)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:i(()=>[l(g,{ref_key:"formRef",ref:M,model:e,rules:O},{default:i(()=>[s.operateType==="add"?(_(),v(n,{key:0,label:"关联项目",path:"pids","label-placement":"left"},{default:i(()=>[l(d(Z),{clearable:"",filterable:"",value:e.pids,"onUpdate:value":t[0]||(t[0]=r=>e.pids=r),placeholder:"请选择项目","label-field":"proname",multiple:"","value-field":"id",onClear:q,options:d(u).data,onScroll:B},null,8,["value","options"])]),_:1})):P("",!0),s.operateType==="edit"&&e.proname?(_(),v(n,{key:1,label:"项目名称",path:"proname","label-placement":"left"},{default:i(()=>[ee("span",null,w(e.proname),1)]),_:1})):P("",!0),l(n,{label:"当前工作内容及成果描述：",path:"notes"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",value:e.notes,"onUpdate:value":t[1]||(t[1]=r=>e.notes=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"遇到问题：",path:"problem"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.problem,"onUpdate:value":t[2]||(t[2]=r=>e.problem=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"解决措施：",path:"solutions"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.solutions,"onUpdate:value":t[3]||(t[3]=r=>e.solutions=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"建议意见反馈：",path:"feedback"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.feedback,"onUpdate:value":t[4]||(t[4]=r=>e.feedback=r),placeholder:"请输入"},null,8,["value"])]),_:1}),l(n,{label:"（总结）自己对一天工作的感受和体感：",path:"summarize"},{default:i(()=>[l(d(b),{clearable:"",type:"textarea",rows:2,value:e.summarize,"onUpdate:value":t[5]||(t[5]=r=>e.summarize=r),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}});export{_e as _,ye as a,ve as b,be as c,ge as d,he as f};
