import{d as Q,aG as O,z as X,au as le,C as Y,bZ as R,s as L,A as re,a as ie,aI as ee,en as ce,eo as de,aE as G,d0 as ue,c as P,o as g,w as a,f as s,L as te,F as H,e as i,N as ae,h as t,aF as pe,G as C,t as u,I as me,B as U,g as z,$ as Z,a9 as fe,cu as ve,aP as _e,W as be,ep as ge,E as ye,bh as we,b as F,aV as x,a5 as he,H as J,K as xe,cM as Ce,a2 as ze,a3 as ke,bj as De,eq as je,er as Ne,V as Se}from"./index-CYktWG4g.js";import{u as Pe}from"./usePageData-B3dmJo7x.js";import{_ as Te,a as $e}from"./text-DOrZBLOM.js";import{N as Ie}from"./Popconfirm-CztqIDpP.js";const Me={class:"mt-10px"},We=Q({name:"OperateDrawer",__name:"operate-drawer",props:O({operateType:{},rowData:{},pid:{},pname:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:O(["submitted"],["update:visible"]),setup(k,{emit:q}){X();const n=q,y=le("pname"),c=k,e=Y(T());function T(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null,charctras:0}}const w={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施",trigger:"blur"}},{pageData:v,getData:h,nextPage:D}=Pe(ve),j=async l=>{const r=l.currentTarget,_=r.scrollTop;r.scrollTop+r.offsetHeight>=r.scrollHeight&&v.data.length<v.total&&(await D(),await _e(),setTimeout(()=>{r.scrollTop=_}))},$=async l=>{m.value=!0,l?e.pid=l:e.value.pid=null},E=async()=>{var l;if(await h({fuzzy:c.pname?c.pname:y!=null&&y.value?y==null?void 0:y.value:"",page:1}),v.data.length==0)return(l=window.$message)==null?void 0:l.warning("没有项目")},d=R.debounce(async l=>{await h({fuzzy:l,page:1})},300),o=L(!1),m=L(!1),b=l=>{if(e.pid=null,o.value=!0,m.value=!1,!l){M();return}d(l)},I=async()=>{o.value&&!m.value&&(await h({page:1}),o.value=!1)},M=()=>{h({page:1})};async function V(){Object.assign(e,T()),await E(),c.pid&&(v.data.forEach(l=>{l.id==c.pid&&(l.disabled=!0)}),e.pid=c.pid),c.operateType==="edit"&&c.rowData&&Object.assign(e,c.rowData)}const{formRef:A,validate:B,restoreValidation:f}=re(),W=ie(()=>({add:"新增项目总结",edit:"修改项目总结"})[c.operateType]),N=ee(k,"visible"),K=()=>{N.value=!1},ne=R.debounce(async()=>{var l,r;if(await B(),c.operateType==="edit"){const{data:_,error:S}=await ce([{...e}]);S||((l=window.$message)==null||l.success("修改成功"),n("submitted"),K())}else{const{data:_,error:S}=await de([{pid:e.pid,content1:e.content1,content2:e.content2,content3:e.content3,content4:e.content4,content5:e.content5,charctras:e.charctras}]);S||((r=window.$message)==null||r.success("添加成功"),n("submitted"),K())}},1e3,{leading:!0,trailing:!1});return G(N,()=>{N.value&&(V(),setTimeout(()=>{const l=document.querySelector(".n-scrollbar-content");l==null||l.scrollTo(0,0)},300),f())}),G(()=>[e.content1,e.content2,e.content3,e.content4,e.content5],()=>{e.charctras=ue(e.content1+e.content2+e.content3+e.content4+e.content5)},{immediate:!0}),(l,r)=>{const _=ae,S=te,oe=me,se=fe;return g(),P(se,{show:N.value,"onUpdate:show":r[6]||(r[6]=p=>N.value=p),title:W.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:a(()=>[s(oe,{justify:"end"},{default:a(()=>[s(t(U),{size:"small",class:"mt-16px",onClick:K},{default:a(()=>[z(u(t(Z)("common.cancel")),1)]),_:1}),s(t(U),{type:"primary",size:"small",class:"mt-16px",onClick:t(ne)},{default:a(()=>[z(u(t(Z)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:a(()=>[s(S,{ref_key:"formRef",ref:A,model:e,rules:w},{default:a(()=>[c.operateType==="add"?(g(),P(_,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:a(()=>[s(t(pe),{clearable:"",filterable:"",value:e.pid,"onUpdate:value":[r[0]||(r[0]=p=>e.pid=p),$],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:M,onSearch:b,onBlur:I,options:t(v).data,onScroll:j},null,8,["value","options"])]),_:1})):H("",!0),s(_,{label:"前期准备阶段描述",path:"content1"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content1,"onUpdate:value":r[1]||(r[1]=p=>e.content1=p),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),s(_,{label:"遇到问题及对项目的影响",path:"content2"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content2,"onUpdate:value":r[2]||(r[2]=p=>e.content2=p),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),s(_,{label:"经验教训与改进方案或措施",path:"content3"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content3,"onUpdate:value":r[3]||(r[3]=p=>e.content3=p),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),s(_,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content4,"onUpdate:value":r[4]||(r[4]=p=>e.content4=p),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),s(_,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:a(()=>[s(t(C),{clearable:"",type:"textarea",value:e.content5,"onUpdate:value":r[5]||(r[5]=p=>e.content5=p),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1}),i("div",Me,"字符数："+u(e.charctras),1)]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Be={class:"font-size-12px c-#a19f9d my-5px"},Fe={key:0},Le={class:"mt-4 border-t pt-3"},Ue={class:"flex items-start gap-2 mb-3"},qe={class:"ml-2 flex-1"},Ee={class:"flex items-center"},Ve={class:"font-medium font-size-16px font-bold"},Ae={class:"text-gray-600 mt-1"},Ke=Q({name:"drawerLog",__name:"drawerLog",props:O({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(k){const q=X();be();let n=Y({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",charctras:0,num:0});const y=k,c={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},e=L({});async function T(){w.value=[],Object.assign(n,y.rowData),j()}const w=L([]),v=ee(k,"visible");G(v,()=>{v.value?T():(w.value=[],n.id=void 0)});function h(d){d||D()}function D(){v.value=!1}const j=async()=>{const{data:d,error:o}=await je({page:1,limit:100,pid:n.id});d&&(w.value=d.list)},$=R.debounce(async()=>{var b;const d=e.value[n.id];if(!(d!=null&&d.trim()))return(b=window.$message)==null?void 0:b.warning("请输入评论内容");const{data:o,error:m}=await ge([{pid:n.id,content:d}]);o&&(e.value[n.id]="",n.num++,j())},1e3,{leading:!0,trailing:!1}),E=async d=>{var b;const{data:o,error:m}=await Ne(d.id);o&&(j(),n.num--,(b=window.$message)==null||b.success("删除成功"))};return(d,o)=>{const m=ae,b=te,I=Te,M=$e,V=we,A=De,B=ye("no-auth");return g(),P(A,{show:v.value,"onUpdate:show":[o[1]||(o[1]=f=>v.value=f),h],"display-directive":"show",width:600,onMaskClick:D,onEsc:D},{default:a(()=>[s(V,{title:t(n).username+"的项目总结","native-scrollbar":!1,closable:""},{default:a(()=>[s(b,{ref:"formRef",model:t(n),"show-feedback":!1},{default:a(()=>[s(m,{label:"",path:"contractname"},{label:a(()=>o[2]||(o[2]=[i("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).proname}])},u(t(n).proname),3)]),_:1}),s(m,{label:"前期准备阶段描述",path:"content1"},{label:a(()=>o[3]||(o[3]=[i("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content1}])},u(t(n).content1),3)]),_:1}),s(m,{label:"遇到问题及对项目的影响",path:"content2"},{label:a(()=>o[4]||(o[4]=[i("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content2}])},u(t(n).content2),3)]),_:1}),s(m,{label:"经验教训与改进方案或措施",path:"content3"},{label:a(()=>o[5]||(o[5]=[i("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content3}])},u(t(n).content3),3)]),_:1}),s(m,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:a(()=>o[6]||(o[6]=[i("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content4}])},u(t(n).content4),3)]),_:1}),s(m,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:a(()=>o[7]||(o[7]=[i("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:a(()=>[i("span",{class:x(["preview-text",{textstyle:t(n).content5}])},u(t(n).content5),3)]),_:1}),i("div",Be,"字符数："+u(t(n).charctras),1)]),_:1},8,["model"]),t(n).num?(g(),F("div",Fe,u(t(n).num)+"评论",1)):H("",!0),s(he,{name:"fade"},{default:a(()=>[i("div",Le,[J((g(),F("div",Ue,[i("div",null,[s(I,{size:"small",src:c.avatar},null,8,["src"])]),s(t(C),{type:"textarea",id:`comment-input-${t(n).id}`,value:e.value[t(n).id],"onUpdate:value":o[0]||(o[0]=f=>e.value[t(n).id]=f),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:xe(Ce(t($),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),s(t(U),{type:"primary",ghost:"",onClick:t($)},{default:a(()=>o[8]||(o[8]=[z("发送")])),_:1,__:[8]},8,["onClick"])])),[[B,"project:Summary:Comment:insert"]]),(g(!0),F(ze,null,ke(w.value,f=>(g(),F("div",{key:f.id,class:"flex mb-3"},[s(I,{size:"small",src:c.avatar},null,8,["src"]),i("div",qe,[i("div",Ee,[i("span",Ve,u(f.username),1),s(M,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:a(()=>[z(u(f.dbtime),1)]),_:2},1024),t(q).userInfo.id==f.creater?(g(),P(t(Ie),{key:0,onPositiveClick:W=>E(f)},{trigger:a(()=>[J((g(),P(t(U),{quaternary:"",type:"error",size:"small"},{default:a(()=>o[9]||(o[9]=[z(" 删除 ")])),_:1,__:[9]})),[[B,"project:Summary:Comment:delete"]])]),default:a(()=>[o[10]||(o[10]=z(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):H("",!0)]),i("div",Ae,u(f.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ze=Se(Ke,[["__scopeId","data-v-710f1fb9"]]);export{We as _,Ze as d};
