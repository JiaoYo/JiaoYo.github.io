import{_ as _e}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BqSXzLBW.js";import{_ as ge}from"./round-delete-C1xvOo2m.js";import{_ as ve}from"./round-add-CnBYTu1X.js";import{d as ee,aq as Y,p as ne,s as ye,r as Z,q as se,a as he,ar as ie,a1 as be,c as T,o as b,w as o,f as a,b5 as we,F as re,h as n,at as de,A as x,b as H,g as f,e as U,t as N,B as D,N as te,$ as q,b6 as ke,E as Ce,U as pe,L as xe,i as De,x as X,az as J,av as ze,C as Q,bl as Ne,aC as Se}from"./index-BrSW3Qk_.js";import{f as ue,b as je,D as Ue,E as Pe,F as ae,G as Te}from"./project-ClKCYf-S.js";import{u as qe,a as $e}from"./table-BgZMMP2L.js";import{u as ce}from"./usePageData-DxOb3kll.js";import{_ as me}from"./Grid-CF6VHH9t.js";import{_ as fe}from"./FormItemGridItem-CtEU2lvz.js";import{N as Re}from"./Upload-Do_zf-0j.js";import{_ as Fe}from"./round-search-Bt589pab.js";import{_ as Le}from"./round-refresh-DBlHyOAy.js";import{N as le}from"./Popconfirm-BS6m75G8.js";import"./Progress-ZAqDftr5.js";import"./utils-BNOftVEY.js";const Ie={key:0},Be={key:0},Me={key:0},Oe={key:0},Ve=ee({name:"OperateDrawer",__name:"operate-drawer",props:Y({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(S,{emit:B}){const w=B,$=ne(),v=S,t=ye(k());Z();function k(){return{pid:void 0,id:"",affectedbusiness:"",devname:"",apidocument:"",uid:void 0,period:"",notes:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}const u=Z([]),{pageData:_,getData:y,nextPage:R}=ce(ue),M=async l=>{const e=l.currentTarget;e.scrollTop+e.offsetHeight>=e.scrollHeight&&_.data.length<_.total&&(R(),u.value=_.data)},O=async()=>{var l;await y({fuzzy:$.userInfo.pname}),u.value=_.data,t.pid=v.pid?v.pid:(l=u.value[0])==null?void 0:l.id},V=async()=>{await y(),u.value=_.data},E=async l=>{t.pid=l};async function j(){O(),Object.assign(t,k()),v.operateType==="edit"&&v.rowData&&Object.assign(t,v.rowData)}const{formRef:G,validate:A,restoreValidation:I}=se(),c={pid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},affectedbusiness:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},devname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},apidocument:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},period:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},uid:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},d=he(()=>({add:"新增需要开发",edit:"修改需要开发"})[v.operateType]),h=ie(S,"visible");async function z(l){if(l)try{const i=await(await fetch(l==null?void 0:l.split("?")[0],{mode:"cors"})).blob(),p=URL.createObjectURL(i),g=document.createElement("a");g.href=p,g.download=l==null?void 0:l.split("?")[1],g.style.display="none",document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(p)}catch(e){console.error("下载失败:",e)}}be(h,()=>{h.value&&(j(),setTimeout(()=>{const l=document.querySelector(".n-scrollbar-content");l==null||l.scrollTo(0,0)},300),I())});async function P({file:l},e){let i=new FormData;i.append("multipartFile",l.file);const{data:p,error:g}=await je(i);g||(t[e]=p)}function F(){h.value=!1}async function m(){var l,e;if(await A(),v.operateType==="edit"){const{data:i,error:p}=await Ue([t]);p||(F(),w("submitted"),(l=window.$message)==null||l.success("修改成功"))}else{const{data:i,error:p}=await Pe([{...t}]);p||(F(),w("submitted"),(e=window.$message)==null||e.success("添加成功"))}}return(l,e)=>{const i=fe,p=Re,g=me,L=re,W=we,K=te,C=ke;return b(),T(C,{show:h.value,"onUpdate:show":e[19]||(e[19]=s=>h.value=s),title:d.value,preset:"card",class:"w-800px"},{footer:o(()=>[a(K,{justify:"end",size:16},{default:o(()=>[a(n(D),{onClick:F},{default:o(()=>[f(N(n(q)("common.cancel")),1)]),_:1}),a(n(D),{type:"primary",onClick:m},{default:o(()=>[f(N(n(q)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(W,{class:"pr-20px"},{default:o(()=>[a(L,{ref_key:"formRef",ref:G,model:t,rules:c,"label-placement":"left","label-width":120},{default:o(()=>[a(g,{responsive:"screen","item-responsive":""},{default:o(()=>[a(i,{span:"24 m:12",label:"项目列表",path:"pid"},{default:o(()=>[a(n(de),{clearable:"",filterable:"",value:t.pid,"onUpdate:value":[e[0]||(e[0]=s=>t.pid=s),E],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:V,options:u.value,onScroll:M},null,8,["value","options"])]),_:1}),a(i,{span:"24 m:12",label:"影响的业务",path:"affectedbusiness"},{default:o(()=>[a(n(x),{value:t.affectedbusiness,"onUpdate:value":e[1]||(e[1]=s=>t.affectedbusiness=s),placeholder:"请输入"},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"设备名称",path:"devname"},{default:o(()=>[a(n(x),{value:t.devname,"onUpdate:value":e[2]||(e[2]=s=>t.devname=s),placeholder:"请输入"},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"接口文档",path:"apidocument"},{default:o(()=>[a(n(x),{value:t.apidocument,"onUpdate:value":e[3]||(e[3]=s=>t.apidocument=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"研发对接人",path:"uid"},{default:o(()=>[a(n(x),{value:t.uid,"onUpdate:value":e[4]||(e[4]=s=>t.uid=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"研发周期",path:"period"},{default:o(()=>[a(n(x),{value:t.period,"onUpdate:value":e[5]||(e[5]=s=>t.period=s),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(i,{span:"24 m:12",label:"备注",path:"notes"},{default:o(()=>[a(n(x),{value:t.notes,"onUpdate:value":e[6]||(e[6]=s=>t.notes=s),placeholder:"请输入"},null,8,["value"])]),_:1}),a(i,{span:"24 m:24",label:"附件1",path:"notes"},{default:o(()=>{var s;return[a(n(x),{value:t.re1,"onUpdate:value":e[7]||(e[7]=r=>t.re1=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl1?(b(),H("span",Ie,[f(N((s=t.fl1)==null?void 0:s.split("?")[1])+" ",1),U("span",{class:"cursor-pointer c-#c92a2a",onClick:e[8]||(e[8]=r=>t.fl1="")},"删除"),U("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[9]||(e[9]=r=>z(t.fl1))},"下载")])):(b(),T(p,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>P(r,"fl1"),"show-file-list":!1},{default:o(()=>[a(n(D),{size:"small",ghost:"",type:"primary"},{default:o(()=>e[20]||(e[20]=[f("选择文件")])),_:1,__:[20]})]),_:1},8,["custom-request"]))]}),_:1}),a(i,{span:"24 m:24",label:"附件2",path:"notes"},{default:o(()=>{var s;return[a(n(x),{value:t.re2,"onUpdate:value":e[10]||(e[10]=r=>t.re2=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl2?(b(),H("span",Be,[f(N((s=t.fl2)==null?void 0:s.split("?")[1])+" ",1),U("span",{class:"cursor-pointer c-#c92a2a",onClick:e[11]||(e[11]=r=>t.fl2="")},"删除"),U("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[12]||(e[12]=r=>z(t.fl2))},"下载")])):(b(),T(p,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>P(r,"fl2"),"show-file-list":!1},{default:o(()=>[a(n(D),{size:"small",ghost:"",type:"primary"},{default:o(()=>e[21]||(e[21]=[f("选择文件")])),_:1,__:[21]})]),_:1},8,["custom-request"]))]}),_:1}),a(i,{span:"24 m:24",label:"附件3",path:"notes"},{default:o(()=>{var s;return[a(n(x),{value:t.re3,"onUpdate:value":e[13]||(e[13]=r=>t.re3=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl3?(b(),H("span",Me,[f(N((s=t.fl3)==null?void 0:s.split("?")[1])+" ",1),U("span",{class:"cursor-pointer c-#c92a2a",onClick:e[14]||(e[14]=r=>t.fl3="")},"删除"),U("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[15]||(e[15]=r=>z(t.fl3))},"下载")])):(b(),T(p,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>P(r,"fl3"),"show-file-list":!1},{default:o(()=>[a(n(D),{size:"small",ghost:"",type:"primary"},{default:o(()=>e[22]||(e[22]=[f("选择文件")])),_:1,__:[22]})]),_:1},8,["custom-request"]))]}),_:1}),a(i,{span:"24 m:24",label:"附件4",path:"notes"},{default:o(()=>{var s;return[a(n(x),{value:t.re4,"onUpdate:value":e[16]||(e[16]=r=>t.re4=r),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),t.fl4?(b(),H("span",Oe,[f(N((s=t.fl4)==null?void 0:s.split("?")[1])+" ",1),U("span",{class:"cursor-pointer c-#c92a2a",onClick:e[17]||(e[17]=r=>t.fl4="")},"删除"),U("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:e[18]||(e[18]=r=>z(t.fl4))},"下载")])):(b(),T(p,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":r=>P(r,"fl4"),"show-file-list":!1},{default:o(()=>[a(n(D),{size:"small",ghost:"",type:"primary"},{default:o(()=>e[23]||(e[23]=[f("选择文件")])),_:1,__:[23]})]),_:1},8,["custom-request"]))]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ee=ee({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Y(["reset","search","clear"],["update:model"]),setup(S,{emit:B}){const w=B,{formRef:$,restoreValidation:v}=se(),t=ie(S,"model"),k=ne(),u=Z([]),{pageData:_,getData:y,nextPage:R}=ce(ue),M=async c=>{const d=c.currentTarget;d.scrollTop+d.offsetHeight>=d.scrollHeight&&_.data.length<_.total&&(R(),u.value=_.data)},O=async c=>{var d;c?(t.value.pid=c,w("search"),k.setProjectInfo({pname:(d=u.value.find(h=>h.id==c))==null?void 0:d.proname,pid:c})):w("clear")},V=async c=>{await y({fuzzy:c}),u.value=_.data},E=async()=>{await y(),u.value=_.data};(async()=>{var c,d;await y({fuzzy:k.userInfo.pname}),u.value=_.data,t.value.pid=k.userInfo.pid?k.userInfo.pid:(c=u.value[0])==null?void 0:c.id,k.setProjectInfo({pid:t.value.pid,pname:(d=u.value.find(h=>h.id==t.value.pid))==null?void 0:d.proname}),w("search")})();async function G(){await v(),t.value.fuzzy="",w("reset")}const A=()=>{t.value.fuzzy="",w("search")};async function I(){w("search")}return(c,d)=>{const h=de,z=fe,P=x,F=Le,m=D,l=Fe,e=te,i=me,p=re,g=pe;return b(),T(g,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[a(p,{ref_key:"formRef",ref:$,model:t.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ce(I,["enter"])},{default:o(()=>[a(i,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:o(()=>[a(z,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:o(()=>[a(h,{filterable:"",clearable:"",value:t.value.pid,"onUpdate:value":[d[0]||(d[0]=L=>t.value.pid=L),O],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:u.value,onScroll:M,onClear:E,onSearch:V},null,8,["value","options"])]),_:1}),a(z,{span:"24 s:12 m:6",label:"设备名称",path:"fuzzy"},{default:o(()=>[a(P,{value:t.value.fuzzy,"onUpdate:value":d[1]||(d[1]=L=>t.value.fuzzy=L),placeholder:"请输入",clearable:"",onClear:A},null,8,["value"])]),_:1}),a(z,{span:"24  s:12 m:6",class:"pr-24px"},{default:o(()=>[a(e,{class:"w-full"},{default:o(()=>[a(m,{onClick:G},{icon:o(()=>[a(F,{class:"text-icon"})]),default:o(()=>[f(" "+N(n(q)("common.reset")),1)]),_:1}),a(m,{type:"primary",ghost:"",onClick:I},{icon:o(()=>[a(l,{class:"text-icon"})]),default:o(()=>[f(" "+N(n(q)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function oe(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Se(S)}const st=ee({name:"projectmanagement_need",__name:"index",setup(S){const B=xe(),{columns:w,columnChecks:$,data:v,getData:t,loading:k,pagination:u,mobilePagination:_,searchParams:y}=qe({showTotal:!0,immediate:!1,apiFn:Te,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"affectedbusiness",title:"影响的业务",align:"center",width:120},{key:"devname",title:"设备名称",align:"center",width:120},{key:"apidocument",title:"接口文档",align:"center",width:120},{key:"uid",title:"研发对接人",align:"center",width:120},{key:"period",title:"研发周期",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"操作人",align:"center",width:120},{key:"dbtime",title:"操作时间",align:"center",width:120},{key:"operate",title:q("common.operate"),align:"center",width:140,fixed:"right",render:m=>{let l;return a("div",{class:"flex-center gap-8px"},[Q(a(D,{type:"primary",ghost:!0,size:"small",onClick:()=>d(m.id)},oe(l=q("common.edit"))?l:{default:()=>[l]}),[[X("no-auth"),"project:Development:update"]]),a(le,{onPositiveClick:()=>c(m.id)},{default:()=>q("common.confirmDelete"),trigger:()=>{let e;return Q(a(D,{type:"error",ghost:!0,size:"small"},oe(e=q("common.delete"))?e:{default:()=>[e]}),[[X("no-auth"),"project:Development:delete"]])}})])}}]}),{drawerVisible:R,operateType:M,editingData:O,handleAdd:V,handleEdit:E,checkedRowKeys:j,onBatchDeleted:G,onDeleted:A}=$e(v,t);De(async()=>{});async function I(){console.log(j.value),h(j.value.join(","),m=>{G()})}async function c(m){const{data:l,error:e}=await ae(m,y.pid);e||A()}function d(m){E(m)}async function h(m,l){const{data:e,error:i}=await ae(m,y.pid);if(!i)l&&l(e);else return!1}const z=m=>{t()},P=()=>{v.value=[],u.itemCount=0},F=()=>{t()};return(m,l)=>{const e=te,i=ve,p=ge,g=_e,L=ze,W=pe,K=X("no-auth");return b(),H("div",Ge,[a(Ee,{model:n(y),"onUpdate:model":l[0]||(l[0]=C=>J(y)?y.value=C:null),onReset:F,onSearch:n(t),onClear:P},null,8,["model","onSearch"]),a(W,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[a(e,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:o(()=>l[4]||(l[4]=[U("div",null,"需要开发",-1)])),_:1,__:[4]})]),"header-extra":o(()=>[a(e,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[Q((b(),T(n(D),{onClick:n(V),size:"small",ghost:"",type:"primary"},{icon:o(()=>[a(i,{class:"text-icon"})]),default:o(()=>[l[5]||(l[5]=f(" "+N("新增")))]),_:1,__:[5]},8,["onClick"])),[[K,"project:Development:insert"]]),a(n(le),{onPositiveClick:I},{trigger:o(()=>[Q((b(),T(n(D),{size:"small",ghost:"",type:"error",disabled:n(j).length==0},{icon:o(()=>[a(p,{class:Ne(["text-icon",{"animate-spin":n(k)}])},null,8,["class"])]),default:o(()=>[l[6]||(l[6]=f(" "+N("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[K,"project:Development:delete"]])]),default:o(()=>[l[7]||(l[7]=f(" 确定要删除选中的吗？ "))]),_:1,__:[7]}),a(g,{columns:n($),"onUpdate:columns":l[1]||(l[1]=C=>J($)?$.value=C:null)},null,8,["columns"])]),_:1})]),default:o(()=>[a(L,{"checked-row-keys":n(j),"onUpdate:checkedRowKeys":l[2]||(l[2]=C=>J(j)?j.value=C:null),columns:n(w),data:n(v),size:"small","flex-height":!n(B).isMobile,loading:n(k),remote:"","row-key":C=>C.id,pagination:n(_),class:"sm:h-full","onUpdate:filters":z},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Ve,{visible:n(R),"onUpdate:visible":l[3]||(l[3]=C=>J(R)?R.value=C:null),onSubmitted:n(t),pid:n(y).pid,"operate-type":n(M),"row-data":n(O)},null,8,["visible","onSubmitted","pid","operate-type","row-data"])]),_:1})])}}});export{st as default};
