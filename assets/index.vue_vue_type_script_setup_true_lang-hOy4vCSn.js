import{_ as ye}from"./round-add-B3TuU9r6.js";import{d as J,aB as W,p as Z,ao as ce,s as de,q as ue,a as be,aD as oe,c0 as le,ei as he,ej as we,az as X,c as L,o as w,w as n,f as a,F as se,y as G,z as pe,h as e,aA as me,A as O,N as re,B as N,g as D,t as h,$ as E,aK as xe,cw as fe,aN as ae,aR as ke,r as H,ek as Se,x as Y,bk as Ce,C as q,e as f,aT as K,b as V,W as je,E as _e,cN as De,aX as Te,a$ as ze,bm as Ne,el as Pe,em as $e,a1 as Ue,Y as ve,b8 as Ie,Q as Le,i as Me,aS as te,cS as Be,aF as Fe,en as Re,eo as Ee,aY as qe,aj as Ae}from"./index-TrXGIlo8.js";import{u as Ke,a as Oe}from"./table-UFffpoad.js";import{u as ne}from"./usePageData-Dx3VPlbD.js";import{_ as Ve,a as He}from"./text-5rgAr9Gt.js";import{N as ge}from"./Popconfirm-B0oIHwaY.js";import{_ as Ge}from"./round-search-CnzeHC84.js";import{_ as Ye}from"./Grid-DfVZApFL.js";import{_ as Qe}from"./FormItemGridItem-BzBDxOWz.js";const We=J({name:"OperateDrawer",__name:"operate-drawer",props:W({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:W(["submitted"],["update:visible"]),setup(k,{emit:F}){Z();const l=F,M=ce("pname"),p=k,o=de(P());function P(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null}}const _={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施",trigger:"blur"}},{pageData:u,getData:g,nextPage:$}=ne(fe),U=async t=>{const r=t.currentTarget,s=r.scrollTop;r.scrollTop+r.offsetHeight>=r.scrollHeight&&u.data.length<u.total&&(await $(),await ae(),setTimeout(()=>{r.scrollTop=s}))},y=async t=>{t?o.pid=t:o.value.pid=null},I=async()=>{var t;if(await g({fuzzy:M.value,page:1}),u.data.length==0)return(t=window.$message)==null?void 0:t.warning("没有项目")},m=async t=>{await g({fuzzy:t,page:1})},i=()=>{g({page:1})};async function b(){Object.assign(o,P()),await I(),p.pid&&(u.data.forEach(t=>{t.id==p.pid&&(t.disabled=!0)}),o.pid=p.pid),p.operateType==="edit"&&p.rowData&&Object.assign(o,p.rowData)}const{formRef:S,validate:T,restoreValidation:R}=ue(),B=be(()=>({add:"新增项目总结",edit:"修改项目总结"})[p.operateType]),z=oe(k,"visible"),C=()=>{z.value=!1},d=le.debounce(async()=>{var t,r;if(await T(),p.operateType==="edit"){const{data:s,error:c}=await he([{...o}]);c||((t=window.$message)==null||t.success("修改成功"),l("submitted"),C())}else{const{data:s,error:c}=await we([{pid:o.pid,content1:o.content1,content2:o.content2,content3:o.content3,content4:o.content4,content5:o.content5}]);c||((r=window.$message)==null||r.success("添加成功"),l("submitted"),C())}},1e3,{leading:!0,trailing:!1});return X(z,()=>{z.value&&(b(),setTimeout(()=>{const t=document.querySelector(".n-scrollbar-content");t==null||t.scrollTo(0,0)},300),R())}),(t,r)=>{const s=pe,c=se,j=re,A=xe;return w(),L(A,{show:z.value,"onUpdate:show":r[6]||(r[6]=v=>z.value=v),title:B.value,preset:"card",class:"w-570px","mask-closable":!1,draggable:!0},{footer:n(()=>[a(j,{justify:"end"},{default:n(()=>[a(e(N),{size:"small",class:"mt-16px",onClick:C},{default:n(()=>[D(h(e(E)("common.cancel")),1)]),_:1}),a(e(N),{type:"primary",size:"small",class:"mt-16px",onClick:e(d)},{default:n(()=>[D(h(e(E)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:n(()=>[a(c,{ref_key:"formRef",ref:S,model:o,rules:_},{default:n(()=>[p.operateType==="add"?(w(),L(s,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:n(()=>[a(e(me),{clearable:"",filterable:"",value:o.pid,"onUpdate:value":[r[0]||(r[0]=v=>o.pid=v),y],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:i,onSearch:m,options:e(u).data,onScroll:U},null,8,["value","options"])]),_:1})):G("",!0),a(s,{label:"前期准备阶段描述",path:"content1"},{default:n(()=>[a(e(O),{clearable:"",type:"textarea",value:o.content1,"onUpdate:value":r[1]||(r[1]=v=>o.content1=v),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),a(s,{label:"遇到问题及对项目的影响",path:"content2"},{default:n(()=>[a(e(O),{clearable:"",type:"textarea",value:o.content2,"onUpdate:value":r[2]||(r[2]=v=>o.content2=v),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),a(s,{label:"经验教训与改进方案或措施",path:"content3"},{default:n(()=>[a(e(O),{clearable:"",type:"textarea",value:o.content3,"onUpdate:value":r[3]||(r[3]=v=>o.content3=v),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),a(s,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:n(()=>[a(e(O),{clearable:"",type:"textarea",value:o.content4,"onUpdate:value":r[4]||(r[4]=v=>o.content4=v),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),a(s,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:n(()=>[a(e(O),{clearable:"",type:"textarea",value:o.content5,"onUpdate:value":r[5]||(r[5]=v=>o.content5=v),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Xe={class:"mt-4 border-t pt-3"},Je={class:"flex items-start gap-2 mb-3"},Ze={class:"ml-2 flex-1"},et={class:"flex items-center"},tt={class:"font-medium font-size-16px font-bold"},at={class:"text-gray-600 mt-1"},nt=J({name:"drawerLog",__name:"drawerLog",props:W({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(k){const F=Z();ke();let l=de({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""});const M=k,p={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},o=H({});async function P(){_.value=[],l={id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""},Object.assign(l,M.rowData),U()}const _=H([]),u=oe(k,"visible");X(u,()=>{u.value?P():(_.value=[],l.id=void 0)});function g(m){m||$()}function $(){u.value=!1}const U=async()=>{const{data:m,error:i}=await Pe({page:1,limit:100,pid:l.id});m&&(_.value=m.list)},y=le.debounce(async()=>{var S;const m=o.value[l.id];if(!(m!=null&&m.trim()))return(S=window.$message)==null?void 0:S.warning("请输入评论内容");const{data:i,error:b}=await Se([{pid:l.id,content:m}]);i&&(o.value[l.id]="",l.num++,U())},1e3,{leading:!0,trailing:!1}),I=async m=>{var S;const{data:i,error:b}=await $e(m.id);i&&(U(),l.num--,(S=window.$message)==null||S.success("删除成功"))};return(m,i)=>{const b=pe,S=se,T=Ve,R=He,B=Ce,z=Ne,C=Y("i"),d=Y("no-auth");return w(),L(z,{show:u.value,"onUpdate:show":[i[1]||(i[1]=t=>u.value=t),g],"display-directive":"show",width:600,onMaskClick:$,onEsc:$},{default:n(()=>[a(B,{title:e(l).username+"的项目总结","native-scrollbar":!1,closable:""},{default:n(()=>[a(S,{ref:"formRef",model:e(l),"show-feedback":!1},{default:n(()=>[a(b,{label:"",path:"contractname"},{label:n(()=>i[2]||(i[2]=[f("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:n(()=>[f("span",{class:K(["preview-text",{textstyle:e(l).proname}])},h(e(l).proname),3)]),_:1}),a(b,{label:"前期准备阶段描述",path:"content1"},{label:n(()=>i[3]||(i[3]=[f("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:n(()=>[f("span",{class:K(["preview-text",{textstyle:e(l).content1}])},h(e(l).content1),3)]),_:1}),a(b,{label:"遇到问题及对项目的影响",path:"content2"},{label:n(()=>i[4]||(i[4]=[f("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:n(()=>[f("span",{class:K(["preview-text",{textstyle:e(l).content2}])},h(e(l).content2),3)]),_:1}),a(b,{label:"经验教训与改进方案或措施",path:"content3"},{label:n(()=>i[5]||(i[5]=[f("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:n(()=>[f("span",{class:K(["preview-text",{textstyle:e(l).content3}])},h(e(l).content3),3)]),_:1}),a(b,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:n(()=>i[6]||(i[6]=[f("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:n(()=>[f("span",{class:K(["preview-text",{textstyle:e(l).content4}])},h(e(l).content4),3)]),_:1}),a(b,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:n(()=>i[7]||(i[7]=[f("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:n(()=>[f("span",{class:K(["preview-text",{textstyle:e(l).content5}])},h(e(l).content5),3)]),_:1})]),_:1},8,["model"]),q((w(),V("div",null,[D(h(e(l).num)+"评论",1)])),[[C,e(l).num]]),a(je,{name:"fade"},{default:n(()=>[f("div",Xe,[q((w(),V("div",Je,[f("div",null,[a(T,{size:"small",src:p.avatar},null,8,["src"])]),a(e(O),{type:"textarea",id:`comment-input-${e(l).id}`,value:o.value[e(l).id],"onUpdate:value":i[0]||(i[0]=t=>o.value[e(l).id]=t),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:_e(De(e(y),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),a(e(N),{type:"primary",ghost:"",onClick:e(y)},{default:n(()=>i[8]||(i[8]=[D("发送")])),_:1,__:[8]},8,["onClick"])])),[[d,"project:Summary:Comment:insert"]]),(w(!0),V(Te,null,ze(_.value,t=>(w(),V("div",{key:t.id,class:"flex mb-3"},[a(T,{size:"small",src:p.avatar},null,8,["src"]),f("div",Ze,[f("div",et,[f("span",tt,h(t.username),1),a(R,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:n(()=>[D(h(t.dbtime),1)]),_:2},1024),e(F).userInfo.id==t.creater?(w(),L(e(ge),{key:0,onPositiveClick:r=>I(t)},{trigger:n(()=>[q((w(),L(e(N),{quaternary:"",type:"error",size:"small"},{default:n(()=>i[9]||(i[9]=[D(" 删除 ")])),_:1,__:[9]})),[[d,"project:Summary:Comment:delete"]])]),default:n(()=>[i[10]||(i[10]=D(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):G("",!0)]),f("div",at,h(t.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),ot=Ue(nt,[["__scopeId","data-v-4f3f349b"]]),lt=J({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:W(["reset","search","clear"],["update:model"]),setup(k,{emit:F}){const l=F,{formRef:M}=ue(),p=ce("pname"),o=oe(k,"model"),P=Z(),_=H([]),{pageData:u,getData:g,nextPage:$}=ne(fe),U=async d=>{const t=d.currentTarget,r=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&u.data.length<u.total&&(await $(),_.value=u.data,await ae(),setTimeout(()=>{t.scrollTop=r}))},{pageData:y,getData:I,nextPage:m}=ne(Ie),i=async d=>{const t=d.currentTarget,r=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&y.data.length<y.total&&(await m(),_.value=y.data,await ae(),setTimeout(()=>{t.scrollTop=r}))},b=async d=>{o.value.creater=d,l("search")},S=async d=>{var t,r;d?(o.value.pid=d,l("search"),P.setProjectInfo({pname:(t=_.value.find(s=>s.id==d))==null?void 0:t.proname,pid:d}),p.value=(r=_.value.find(s=>s.id==d))==null?void 0:r.proname):l("search")},T=le.debounce(async d=>{await g({fuzzy:d,page:1}),_.value=u.data},300),R=d=>{if(!d){o.value.pid=null,B();return}T(d)},B=async()=>{await g({page:1}),_.value=u.data};(async()=>{await g(),_.value=u.data,l("search")})(),I({usertypes:"2,3"});async function C(){l("search")}return(d,t)=>{const r=me,s=Qe,c=Ge,j=N,A=re,v=Ye,ee=se,Q=ve;return w(),L(Q,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(ee,{ref_key:"formRef",ref:M,model:o.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:_e(C,["enter"])},{default:n(()=>[a(v,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:n(()=>[a(s,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:n(()=>[a(r,{filterable:"",clearable:"",value:o.value.pid,"onUpdate:value":[t[0]||(t[0]=x=>o.value.pid=x),S],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:_.value,onScroll:U,onClear:B,onSearch:R},null,8,["value","options"])]),_:1}),a(s,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:n(()=>[a(r,{clearable:"",filterable:"",value:o.value.creater,"onUpdate:value":[t[1]||(t[1]=x=>o.value.creater=x),b],placeholder:"请选择","label-field":"username","value-field":"id",options:e(y).data,onScroll:i},null,8,["value","options"])]),_:1}),a(s,{span:"24  s:12 m:6",class:"pr-24px"},{default:n(()=>[a(A,{class:"w-full"},{default:n(()=>[a(j,{type:"primary",ghost:"",onClick:C},{icon:n(()=>[a(c,{class:"text-icon"})]),default:n(()=>[D(" "+h(e(E)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),st={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},rt={key:0};function ie(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!qe(k)}const gt=J({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(k,{emit:F}){const l=Le(),M=Z(),p=k,o=H("");Ae("pname",o);const P=F,{columns:_,data:u,getData:g,loading:$,mobilePagination:U,searchParams:y}=Ke({showTotal:!0,immediate:!1,apiFn:Re,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:s=>a("div",null,[s.username+"的项目总结"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:E("common.operate"),align:"center",width:140,fixed:"right",render:s=>{let c;return a("div",{class:"flex-center gap-8px"},[a(N,{type:"primary",ghost:!0,size:"small",onClick:()=>t(s)},{default:()=>[D("查看详情")]}),M.userInfo.id==s.creater&&q(a(N,{type:"primary",ghost:!0,size:"small",onClick:()=>z(s.id)},ie(c=E("common.edit"))?c:{default:()=>[c]}),[[Y("no-auth"),"project:Summary:update"]]),M.userInfo.id==s.creater&&a(ge,{onPositiveClick:()=>B(s.id)},{default:()=>E("common.confirmDelete"),trigger:()=>{let j;return q(a(N,{type:"error",ghost:!0,size:"small"},ie(j=E("common.delete"))?j:{default:()=>[j]}),[[Y("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:I,operateType:m,editingData:i,handleAdd:b,handleEdit:S,checkedRowKeys:T,onDeleted:R}=Oe(u,g);async function B(s){const{data:c,error:j}=await Ee(s);j||R()}function z(s){S(s)}const C=H(!1),d=H({}),t=s=>{C.value=!0,d.value=s},r=()=>{g()};return X(()=>p.pid,async s=>{s&&(y.pid=s,await g())}),X(()=>u.value,async s=>{s.length>0?P("thereIsData",1):P("thereIsData",0)}),Me(()=>{p.type!="externalLiaison"}),(s,c)=>{const j=re,A=ye,v=Fe,ee=ve,Q=Y("no-auth");return w(),V("div",st,[p.pid?G("",!0):(w(),L(lt,{key:0,model:e(y),"onUpdate:model":c[0]||(c[0]=x=>te(y)?y.value=x:null),onReset:r,onSearch:e(g),onClear:c[1]||(c[1]=x=>u.value=[])},null,8,["model","onSearch"])),a(ee,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Be({header:n(()=>[a(j,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:n(()=>[p.pid?G("",!0):(w(),V("div",rt,"项目总结"))]),_:1}),p.pid?q((w(),L(e(N),{key:0,onClick:e(b),size:"small",ghost:"",type:"primary"},{icon:n(()=>[a(A,{class:"text-icon"})]),default:n(()=>[c[5]||(c[5]=D(" "+h("新增")))]),_:1,__:[5]},8,["onClick"])),[[Q,"project:Summary:insert"]]):G("",!0)]),default:n(()=>[a(v,{"checked-row-keys":e(T),"onUpdate:checkedRowKeys":c[2]||(c[2]=x=>te(T)?T.value=x:null),columns:e(_),data:e(u),size:"small","flex-height":!e(l).isMobile,loading:e($),remote:"","row-key":x=>x.id,pagination:e(U),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(We,{visible:e(I),"onUpdate:visible":c[3]||(c[3]=x=>te(I)?I.value=x:null),onSubmitted:e(g),"operate-type":e(m),pid:p.pid||e(y).pid,"row-data":e(i)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),a(ot,{visible:C.value,"onUpdate:visible":c[4]||(c[4]=x=>C.value=x),"row-data":d.value},null,8,["visible","row-data"])]),_:2},[p.pid?void 0:{name:"header-extra",fn:n(()=>[a(j,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[q((w(),L(e(N),{onClick:e(b),size:"small",ghost:"",type:"primary"},{icon:n(()=>[a(A,{class:"text-icon"})]),default:n(()=>[c[6]||(c[6]=D(" "+h("新增")))]),_:1,__:[6]},8,["onClick"])),[[Q,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{gt as _};
