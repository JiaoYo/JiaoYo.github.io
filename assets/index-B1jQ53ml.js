import{_ as de}from"./round-add-qbOrVMgk.js";import{d as W,au as ne,q as X,c9 as ue,v as pe,r as L,av as oe,Z as me,bu as fe,y as H,c as N,o as m,w as e,f as a,aG as _e,b as R,z as F,G as se,A as ge,e as u,t as g,T as ve,D as B,h as l,C as he,F as le,cp as be,B as S,g as z,a2 as ye,a1 as we,aI as ke,s as xe,U as re,aw as De,N as ie,$ as V,c6 as Ce,a0 as Y,c4 as Te,a7 as ee,M as Se,i as Ne,aB as Q,cq as ze,ac as Pe,aF as je}from"./index-BvFB2cuj.js";import{f as Le,a as Ue,b as $e,_ as Re,c as Be,d as Fe}from"./operate-drawer.vue_vue_type_style_index_0_lang-ClwLQKl2.js";import{u as Me,a as Ie}from"./table-BGg3LzBr.js";import{_ as Ge}from"./Avatar-DSO1vx01.js";import{_ as Ee}from"./text-RGZe5l7l.js";import{N as ce}from"./Popconfirm-1kDZsQG6.js";import{_ as Ke}from"./round-search-Nrgthioa.js";import{u as te}from"./usePageData-CTXHmZzP.js";import{_ as Ve}from"./Grid-Y7np-iXa.js";import{_ as Ae}from"./FormItemGridItem-hipcXcB6.js";import{N as Oe}from"./DatePicker-DpVzl5o9.js";import"./v4-FuVw324d.js";const qe={key:0},He={class:"mt-4 border-t pt-3"},Je={class:"flex items-start gap-2 mb-3"},Ze={class:"ml-2 flex-1"},Qe={class:"flex items-center"},We={class:"font-medium font-size-16px font-bold"},Xe={class:"text-gray-600 mt-1"},Ye=W({name:"drawerLog",__name:"drawerLog",props:ne({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(w){const A=X();ue();const t=pe({id:"",proname:"",percent:void 0,notes:"",problem:"",solutions:"",feedback:"",summarize:"",username:"",num:0}),P=w,i={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},f=L({});async function h(){_.value=[],Object.assign(t,P.rowData);const r=JSON.parse(P.rowData.context);t.proname=r.proname,t.notes=r.notes,t.problem=r.problem,t.solutions=r.solutions,t.feedback=r.feedback,t.summarize=r.summarize,t.percent=r.percent,C()}const _=L([]),D=oe(w,"visible");me(D,()=>{D.value?h():(_.value=[],t.id=void 0)});function M(r){r||v()}function v(){D.value=!1}const C=async()=>{const{data:r,error:o}=await Ue({page:1,limit:100,pid:t.id});r&&(_.value=r.list)},U=fe.debounce(async()=>{var b;const r=f.value[t.id];if(!(r!=null&&r.trim()))return(b=window.$message)==null?void 0:b.warning("请输入评论内容");const{data:o,error:p}=await Le([{pid:t.id,context:r}]);o&&(f.value[t.id]="",t.num++,C())},1e3,{leading:!0,trailing:!1}),I=async r=>{var b;const{data:o,error:p}=await $e(r.id);o&&(C(),t.num--,(b=window.$message)==null||b.success("删除成功"))};return(r,o)=>{const p=ge,b=se,G=Ge,E=Ee,T=_e,$=ke,j=H("no-auth");return m(),N($,{show:D.value,"onUpdate:show":[o[1]||(o[1]=n=>D.value=n),M],"display-directive":"show",width:600,onMaskClick:v,onEsc:v},{default:e(()=>[a(T,{title:t.username+"的项目日报","native-scrollbar":!1,closable:""},{default:e(()=>[a(b,{ref:"formRef",model:t},{default:e(()=>[t.proname?(m(),N(p,{key:0,label:"项目名称",path:"proname","label-placement":"left"},{label:e(()=>o[2]||(o[2]=[u("div",{class:"font-size-16px font-bold"},"项目名称：",-1)])),default:e(()=>[u("span",null,g(t.proname),1)]),_:1})):F("",!0),a(p,{label:"当前工作内容及成果描述",path:"notes"},{label:e(()=>o[3]||(o[3]=[u("div",{class:"font-size-16px font-bold"},"当前工作内容及成果描述：",-1)])),default:e(()=>[u("span",null,g(t.notes),1)]),_:1}),a(p,{label:"遇到问题",path:"problem"},{label:e(()=>o[4]||(o[4]=[u("div",{class:"font-size-16px font-bold"},"遇到问题：",-1)])),default:e(()=>[u("span",null,g(t.problem),1)]),_:1}),a(p,{label:"解决措施",path:"solutions"},{label:e(()=>o[5]||(o[5]=[u("div",{class:"font-size-16px font-bold"},"解决措施：",-1)])),default:e(()=>[u("span",null,g(t.solutions),1)]),_:1}),a(p,{label:"建议意见反馈",path:"feedback"},{label:e(()=>o[6]||(o[6]=[u("div",{class:"font-size-16px font-bold"},"建议意见反馈：",-1)])),default:e(()=>[u("span",null,g(t.feedback),1)]),_:1}),a(p,{label:"（总结）自己对一天工作的感受和体感",path:"summarize"},{label:e(()=>o[7]||(o[7]=[u("div",{class:"font-size-16px font-bold"},"（总结）自己对一天工作的感受和体感：",-1)])),default:e(()=>[u("span",null,g(t.summarize),1)]),_:1})]),_:1},8,["model"]),t.num?(m(),R("div",qe,g(t.num)+"评论",1)):F("",!0),a(ve,{name:"fade"},{default:e(()=>[u("div",He,[B((m(),R("div",Je,[u("div",null,[a(G,{size:"small",src:i.avatar},null,8,["src"])]),a(l(he),{type:"textarea",id:`comment-input-${t.id}`,value:f.value[t.id],"onUpdate:value":o[0]||(o[0]=n=>f.value[t.id]=n),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:le(be(l(U),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),a(l(S),{type:"primary",ghost:"",onClick:l(U)},{default:e(()=>o[8]||(o[8]=[z("发送")])),_:1,__:[8]},8,["onClick"])])),[[j,"project:Comment:insert"]]),(m(!0),R(ye,null,we(_.value,n=>(m(),R("div",{key:n.id,class:"flex mb-3"},[a(G,{size:"small",src:i.avatar},null,8,["src"]),u("div",Ze,[u("div",Qe,[u("span",We,g(n.username),1),a(E,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:e(()=>[z(g(n.dbtime),1)]),_:2},1024),l(A).userInfo.id==n.creater?(m(),N(l(ce),{key:0,onPositiveClick:s=>I(n)},{trigger:e(()=>[B((m(),N(l(S),{quaternary:"",type:"error",size:"small"},{default:e(()=>o[9]||(o[9]=[z(" 删除 ")])),_:1,__:[9]})),[[j,"project:Comment:delete"]])]),default:e(()=>[o[10]||(o[10]=z(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):F("",!0)]),u("div",Xe,g(n.context),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),et=W({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:ne(["reset","search","clear","setPname"],["update:model"]),setup(w,{emit:A}){const t=A,{formRef:P}=xe(),i=oe(w,"model");X();const f=L([]),{pageData:h,getData:_,nextPage:D}=te(Ce),M=async n=>{const s=n.currentTarget,k=s.scrollTop;s.scrollTop+s.offsetHeight>=s.scrollHeight&&h.data.length<h.total&&(await D(),f.value=h.data,await Y(),setTimeout(()=>{s.scrollTop=k}))},{pageData:v,getData:C,nextPage:U}=te(Te),I=async n=>{const s=n.currentTarget,k=s.scrollTop;s.scrollTop+s.offsetHeight>=s.scrollHeight&&v.data.length<v.total&&(await U(),await Y(),setTimeout(()=>{s.scrollTop=k}))},r=async n=>{i.value.creater=n,t("search")},o=async n=>{var s;n&&(i.value.pid=n),t("search"),t("setPname",((s=f.value.find(k=>k.id==n))==null?void 0:s.proname)||"")},p=async n=>{await _({fuzzy:n,page:1}),f.value=h.data},b=async()=>{await _({page:1}),f.value=h.data};(async()=>{await _(),f.value=h.data,t("search")})(),C({usertypes:"0,1,2,3,4"});const E={当日:()=>{const n=new Date().getTime();return[n,n]},本周:()=>{const n=new Date().getTime();return[n-24*60*60*1e3*7,n]},上月:()=>{const n=new Date().getTime();return[n-24*60*60*1e3*30,n]}},T=L(null);async function $(n,s){s?(i.value.statrtTime=String(ee(0,s[0])),i.value.endTime=String(ee(0,s[1]))):(i.value.statrtTime=null,i.value.endTime=null),t("search")}async function j(){t("search")}return(n,s)=>{const k=De,c=Ae,d=Oe,x=Ke,O=S,J=ie,Z=Ve,q=se,y=re;return m(),N(y,{bordered:!1,size:"small",class:"card-wrapper"},{default:e(()=>[a(q,{ref_key:"formRef",ref:P,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:le(j,["enter"])},{default:e(()=>[a(Z,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:e(()=>[a(c,{span:"24 s:12 m:6",label:"项目列表",path:"pid"},{default:e(()=>[a(k,{filterable:"",clearable:"",value:i.value.pid,"onUpdate:value":[s[0]||(s[0]=K=>i.value.pid=K),o],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:f.value,onScroll:M,onClear:b,onSearch:p},null,8,["value","options"])]),_:1}),a(c,{span:"24 s:12 m:8",label:"查询日期",path:"selectTime"},{default:e(()=>[a(d,{value:T.value,"onUpdate:value":s[1]||(s[1]=K=>T.value=K),type:"daterange",clearable:"",class:"w-100%",shortcuts:E,"onUpdate:formattedValue":$},null,8,["value"])]),_:1}),a(c,{span:"24 s:12 m:5",label:"用户",path:"creater"},{default:e(()=>[a(k,{clearable:"",filterable:"",value:i.value.creater,"onUpdate:value":[s[2]||(s[2]=K=>i.value.creater=K),r],placeholder:"请选择","label-field":"username","value-field":"id",options:l(v).data,onScroll:I},null,8,["value","options"])]),_:1}),a(c,{span:"24  s:12 m:4",class:"pr-24px"},{default:e(()=>[a(J,{class:"w-full"},{default:e(()=>[a(O,{type:"primary",ghost:"",onClick:j},{icon:e(()=>[a(x,{class:"text-icon"})]),default:e(()=>[z(" "+g(l(V)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),tt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},at={key:0};function ae(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!je(w)}const gt=W({name:"projectmanagement_daylog",__name:"index",props:{pid:{default:void 0},type:{}},emits:["thereIsData"],setup(w,{emit:A}){const t=Se(),P=X(),i=w,{columns:f,data:h,getData:_,loading:D,mobilePagination:M,searchParams:v}=Me({showTotal:!0,immediate:!1,apiFn:Be,apiParams:{page:1,pageSize:20,limit:20,statrtTime:void 0,endTime:void 0,creater:void 0,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:c=>a("div",null,[c.username+"的项目日报"])},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:V("common.operate"),align:"center",width:140,fixed:"right",render:c=>{let d;return a("div",{class:"flex-center gap-8px"},[a(S,{type:"primary",ghost:!0,size:"small",onClick:()=>j(c)},{default:()=>[z("查看详情")]}),P.userInfo.id==c.creater&&B(a(S,{type:"primary",ghost:!0,size:"small",onClick:()=>E(c.id)},ae(d=V("common.edit"))?d:{default:()=>[d]}),[[H("no-auth"),"project:DailyReport:update"]]),P.userInfo.id==c.creater&&a(ce,{onPositiveClick:()=>G(c.id)},{default:()=>V("common.confirmDelete"),trigger:()=>{let x;return B(a(S,{type:"error",ghost:!0,size:"small"},ae(x=V("common.delete"))?x:{default:()=>[x]}),[[H("no-auth"),"project:DailyReport:delete"]])}})])}}]}),{drawerVisible:C,operateType:U,editingData:I,handleAdd:r,handleEdit:o,checkedRowKeys:p,onDeleted:b}=Ie(h,_);async function G(c){const{data:d,error:x}=await Fe(c);x||b()}function E(c){o(c)}const T=L(!1),$=L({}),j=c=>{T.value=!0,$.value=c},n=()=>{_()},s=L(""),k=c=>{s.value=c};return Ne(()=>{i.type!="externalLiaison"}),(c,d)=>{const x=ie,O=de,J=Pe,Z=re,q=H("no-auth");return m(),R("div",tt,[i.pid?F("",!0):(m(),N(et,{key:0,model:l(v),"onUpdate:model":d[0]||(d[0]=y=>Q(v)?v.value=y:null),onReset:n,onSearch:l(_),onSetPname:k},null,8,["model","onSearch"])),a(Z,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},ze({header:e(()=>[a(x,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:e(()=>[i.pid?F("",!0):(m(),R("div",at,"项目日报"))]),_:1}),i.pid?B((m(),N(l(S),{key:0,onClick:l(r),size:"small",ghost:"",type:"primary"},{icon:e(()=>[a(O,{class:"text-icon"})]),default:e(()=>[d[4]||(d[4]=z(" "+g("新增")))]),_:1,__:[4]},8,["onClick"])),[[q,"project:DailyReport:insert"]]):F("",!0)]),default:e(()=>[a(J,{"checked-row-keys":l(p),"onUpdate:checkedRowKeys":d[1]||(d[1]=y=>Q(p)?p.value=y:null),columns:l(f),data:l(h),size:"small","flex-height":!l(t).isMobile,loading:l(D),remote:"","row-key":y=>y.id,pagination:l(M),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Re,{visible:l(C),"onUpdate:visible":d[2]||(d[2]=y=>Q(C)?C.value=y:null),onSubmitted:l(_),"operate-type":l(U),pname:s.value,pid:i.pid||l(v).pid,"row-data":l(I)},null,8,["visible","onSubmitted","operate-type","pname","pid","row-data"]),a(Ye,{visible:T.value,"onUpdate:visible":d[3]||(d[3]=y=>T.value=y),"row-data":$.value},null,8,["visible","row-data"])]),_:2},[i.pid?void 0:{name:"header-extra",fn:e(()=>[a(x,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:e(()=>[B((m(),N(l(S),{onClick:l(r),size:"small",ghost:"",type:"primary"},{icon:e(()=>[a(O,{class:"text-icon"})]),default:e(()=>[d[5]||(d[5]=z(" "+g("新增")))]),_:1,__:[5]},8,["onClick"])),[[q,"project:DailyReport:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{gt as default};
