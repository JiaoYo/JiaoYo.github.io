import{_ as de}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BgfKE8t2.js";import{d as P,q as K,x as Q,s as ee,v as ue,bG as te,b as G,$ as l,r as pe,ag as ne,F as A,o as z,c as E,w as r,g as t,h as B,t as U,i as e,H as oe,G as L,Y as me,Z as _e,dp as ae,dq as fe,L as le,M as he,a1 as ge,Q as se,B as O,P as Y,ah as ve,ai as ye,af as re,dr as Z,j as W,f as J,ds as be,at as we,dt as ke,aU as xe,ax as ie,a5 as Re,du as De,dv as Ne,dw as Ce,e as Se,aj as V,ak as Te,al as Me}from"./index-b-tEOQea.js";import{u as $e,a as Ie}from"./table-BfCfNean.js";import{_ as Be}from"./round-search-BOrpJEk6.js";import{_ as Ue}from"./round-refresh-CerSsMY0.js";import{_ as ze,l as Le}from"./lodash-CqSdoX1d.js";import{_ as Oe}from"./FormItemGridItem-BGGD_lC8.js";import{_ as je}from"./Grid-BHUm-qXA.js";import{_ as Fe,a as Ve}from"./arrow-open-up-DiT4Ptvw.js";import{_ as Ae}from"./Tree-B_v83osE.js";import{h as X}from"./permission-D09LFsGp.js";import{_ as Ee}from"./Popconfirm-CdcvVkbL.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-3wfWTgiM.js";import"./setting-outlined-SXeXtAqu.js";import"./export-CEiW63Ba.js";import"./refresh-CU7cSF-I.js";import"./round-delete-BzcobGsa.js";import"./round-plus-DRNdmgq0.js";import"./Upload-BL3J4I7E.js";import"./Progress-Ehf_r-3i.js";const Ge=P({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:K({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(v,{emit:R}){const u=v,h=R,b=Q(v,"visible"),{formRef:y,validate:C,restoreValidation:$}=ee(),{defaultRequiredRule:g}=ue();te();const D=G(()=>({add:l("page.manage.role.addRole"),edit:l("page.manage.role.editRole")})[u.operateType]),p=pe(N());function N(){return{name:"",remark:"",rtype:0,menuIdList:[]}}const I={name:g};G(()=>{var c;return((c=u.rowData)==null?void 0:c.id)||-1}),G(()=>u.operateType==="add"||u.operateType==="edit");async function S(){if(Object.assign(p,N()),u.operateType==="edit"&&u.rowData){const{data:c,error:i}=await ae(u.rowData.id+"");Object.assign(p,c)}}function T(){b.value=!1}async function n(){var f,a,d;await C();const{data:c,error:i}=await fe(u.operateType==="edit"?(f=u.rowData)==null?void 0:f.id:null,p.name,p.menuIdList,p.remark,p.rtype);i||((a=window.$message)==null||a.destroyAll(),(d=window.$message)==null||d.success(u.operateType==="edit"?l("common.modifySuccess"):l("common.addSuccess")),T(),h("submitted"))}return ne(b,()=>{b.value&&(S(),$())}),(c,i)=>{const f=le,a=he,d=ge,m=se,w=O,o=Y,M=ve,j=ye,F=A("no-space");return z(),E(j,{show:b.value,"onUpdate:show":i[3]||(i[3]=s=>b.value=s),"display-directive":"show",width:360},{default:r(()=>[t(M,{title:D.value,"native-scrollbar":!1,closable:""},{footer:r(()=>[t(o,{size:16},{default:r(()=>[t(w,{onClick:T},{default:r(()=>[B(U(e(l)("common.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:n},{default:r(()=>[B(U(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(m,{ref_key:"formRef",ref:y,model:p,rules:I,onKeyup:oe(n,["enter"])},{default:r(()=>[t(a,{label:e(l)("page.manage.role.name"),path:"name"},{default:r(()=>[L(t(f,{value:p.name,"onUpdate:value":i[0]||(i[0]=s=>p.name=s),placeholder:e(l)("page.manage.role.form.name"),clearable:""},null,8,["value","placeholder"]),[[F]])]),_:1},8,["label"]),t(a,{label:e(l)("page.manage.role.remark"),path:"remark"},{default:r(()=>[L(t(f,{clearable:"",value:p.remark,"onUpdate:value":i[1]||(i[1]=s=>p.remark=s),placeholder:e(l)("page.manage.role.form.remark")},null,8,["value","placeholder"]),[[F]])]),_:1},8,["label"]),t(a,{label:e(l)("page.manage.role.type"),path:"rtype"},{default:r(()=>[t(d,{filterable:"",value:p.rtype,"onUpdate:value":i[2]||(i[2]=s=>p.rtype=s),disabled:u.operateType==="edit",placeholder:e(l)("page.manage.role.form.type"),options:e(me)(e(_e)),style:{width:"100%"}},null,8,["value","disabled","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ke=P({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search"],["update:model"]),setup(v,{emit:R}){const u=R,h=Q(v,"model"),{formRef:b,restoreValidation:y}=ee();function C(){h.value.name="",u("search")}async function $(){await y(),u("reset")}function g(){u("search")}const D=ze.debounce(g,1e3,{leading:!0,trailing:!1});return(p,N)=>{const I=le,S=Oe,T=Ue,n=O,c=Be,i=Y,f=je,a=se,d=re,m=A("no-space");return z(),E(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[t(a,{model:h.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:oe(g,["enter"])},{default:r(()=>[t(f,{responsive:"screen","item-responsive":"","y-gap":12},{default:r(()=>[t(S,{span:"24 s:12 m:8 l:6",label:e(l)("page.manage.role.name"),path:"name"},{default:r(()=>[L(t(I,{clearable:"",value:h.value.name,"onUpdate:value":N[0]||(N[0]=w=>h.value.name=w),placeholder:e(l)("page.manage.role.form.name"),onClear:C},null,8,["value","placeholder"]),[[m]])]),_:1},8,["label"]),t(S,{span:"24 s:12 m:8 l:6"},{default:r(()=>[t(i,{class:"w-full ml-20px"},{default:r(()=>[t(n,{onClick:$},{icon:r(()=>[t(T,{class:"text-icon"})]),default:r(()=>[B(" "+U(e(l)("common.reset")),1)]),_:1}),t(n,{type:"primary",ghost:"",onClick:e(D)},{icon:r(()=>[t(c,{class:"text-icon"})]),default:r(()=>[B(" "+U(e(l)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Pe={class:"flex"},qe=P({name:"MenuAuthModal",__name:"menu-auth-modal",props:K({roleRow:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(v){const R=v,u=Q(v,"visible");function h(){u.value=!1}const b=G(()=>l("common.edit")+l("page.manage.role.menuAuth")),y=Z([]);function C(n,c=0){var m,w;const i=(m=n.find(o=>o.url=="/manage/role"))==null?void 0:m.id,f=(w=n.find(o=>o.url=="/manage/user"))==null?void 0:w.id;let a=[];function d(o){return o.sort((M,j)=>(M.sort||0)-(j.sort||0))}return n.forEach(o=>{if(o.suffix=()=>xe(ie,{text:!0,type:o.pid==0&&o.type==0?"warning":o.type==1?"info":"success",size:"small"},{default:()=>o.pid==0&&o.type==0?"目录":o.type==1?"按钮":"菜单"}),(o.pid==i||o.id==i||o.pid==f||o.id==f)&&(o.disabled=!0),o.pid==c){const M=C(n,o.id);M.length>0?o.children=M:o.children=[],a.push(o)}}),d(a)}const $=async()=>{const{error:n,data:c}=await ke({rtype:R.roleRow.rtype}),i=C(c);if(!n){let f=function(d){for(let m=d.length-1;m>=0;m--)d[m].children&&d[m].children.length>0?f(d[m].children):d[m].children=void 0;return d},a=Le.cloneDeep(i);a=f(a),y.value=a.filter(d=>d.id<=1e4)}},g=W(!0),D=Z([]);async function p(){const{data:n,error:c}=await ae(R.roleRow.id+""),i=[];function f(a,d){return!d.includes(a.id)||a.children&&!a.children.every(m=>f(m,d))?(i.push(a.id),!1):!0}y.value.forEach(a=>{f(a,n.menuIdList)}),D.value=n.menuIdList.filter(a=>!i.includes(a))}const N=W(),I=n=>{N.value=n};function S(){var n,c;be({id:R.roleRow.id,name:R.roleRow.name,menuIdList:D.value.concat(N.value).filter(i=>i!==null)}),(c=(n=window.$message)==null?void 0:n.success)==null||c.call(n,l("common.modifySuccess")),h()}function T(){$(),p()}return ne(u,n=>{n&&T()}),(n,c)=>{const i=Fe,f=Ve,a=Ae,d=O,m=Y,w=we;return z(),E(w,{show:u.value,"onUpdate:show":c[2]||(c[2]=o=>u.value=o),preset:"card",class:"w-480px"},{header:r(()=>[J("div",Pe,[B(U(b.value)+" ",1),J("div",{class:"ml-10px cursor-pointer",title:"展开/收起",onClick:c[0]||(c[0]=o=>g.value=!g.value)},[g.value?(z(),E(f,{key:1,class:"text-icon"})):(z(),E(i,{key:0,class:"text-icon"}))])])]),footer:r(()=>[t(m,{justify:"end"},{default:r(()=>[t(d,{size:"small",class:"mt-16px",onClick:h},{default:r(()=>[B(U(e(l)("common.cancel")),1)]),_:1}),t(d,{type:"primary",size:"small",class:"mt-16px",onClick:S},{default:r(()=>[B(U(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:r(()=>[t(a,{cascade:"","checked-keys":D.value,"onUpdate:checkedKeys":c[1]||(c[1]=o=>D.value=o),data:y.value,checkable:"","expand-on-click":"","virtual-scroll":"","block-line":"",class:"h-60vh","label-field":"name","key-field":"id","children-field":"children","default-expand-all":g.value,onUpdateIndeterminateKeys:I},null,8,["checked-keys","data","default-expand-all"])]),_:1},8,["show"])}}}),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function H(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Te(v)}const _t=P({name:"manage_role",__name:"index",setup(v){const R=Re(),{columns:u,columnChecks:h,data:b,getData:y,loading:C,mobilePagination:$,searchParams:g,resetSearchParams:D}=$e({apiFn:De,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,name:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:l("page.manage.role.name"),align:"center",minWidth:120,ellipsis:!0},{key:"remark",title:l("page.manage.role.remark"),minWidth:120,align:"center",ellipsis:!0},{key:"rtype",title:l("page.manage.role.type"),width:140,align:"center",render:s=>{s.rtype===void 0&&(s.rtype=0);const _={0:"primary",1:"primary",2:"primary"},k=l(Ne[s.rtype]);return t(ie,{type:_[s.rtype]},H(k)?k:{default:()=>[k]})}},{key:"operate",title:l("common.operate"),align:"center",render:s=>{let _;return t("div",{class:"flex-center gap-8px"},[L(t(O,{type:"primary",ghost:!0,size:"small",onClick:()=>j(s.id)},H(_=l("common.edit"))?_:{default:()=>[_]}),[[A("no-auth"),"sys:role:update"]]),L(t(O,{type:"primary",ghost:!0,size:"small",onClick:()=>w(s)},{default:()=>["分配权限"]}),[[A("no-auth"),"sys:role:update"]]),[1,2,3].includes(Number(s.id))?"":t(Ee,{onPositiveClick:()=>M(s.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let k;return L(t(O,{type:"error",ghost:!0,size:"small"},H(k=l("common.delete"))?k:{default:()=>[k]}),[[A("no-auth"),"sys:role:delete"]])}})])}}]}),{drawerVisible:p,operateType:N,editingData:I,handleAdd:S,handleEdit:T,checkedRowKeys:n,onBatchDeleted:c,onDeleted:i,closeDrawer:f}=Ie(b,y),{bool:a,setTrue:d}=te(),m=W({id:0,name:"",remark:"",rtype:0,menuIdList:[]});function w(s){d(),m.value=s}async function o(){console.log(n.value),F(n.value,s=>{c()})}function M(s){console.log(s),F([s],_=>{i()})}function j(s){T(s)}async function F(s,_){const{data:k,error:q}=await Ce(s);if(!q)_&&_(k);else return!1}return(s,_)=>{const k=de,q=Me,ce=re;return z(),Se("div",He,[t(Ke,{model:e(g),"onUpdate:model":_[0]||(_[0]=x=>V(g)?g.value=x:null),onReset:e(D),onSearch:e(y)},null,8,["model","onReset","onSearch"]),t(ce,{title:e(l)("page.manage.role.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":r(()=>[t(k,{columns:e(h),"onUpdate:columns":_[1]||(_[1]=x=>V(h)?h.value=x:null),"disabled-delete":e(n).length===0,"is-view-add-button":e(X)("sys:role:save"),"is-view-delete-button":e(X)("sys:role:delete"),loading:e(C),onAdd:e(S),onDelete:o,onRefresh:e(y)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:r(()=>[t(q,{"checked-row-keys":e(n),"onUpdate:checkedRowKeys":_[2]||(_[2]=x=>V(n)?n.value=x:null),columns:e(u),data:e(b),size:"small","flex-height":!e(R).isMobile,"scroll-x":702,loading:e(C),remote:"","row-key":x=>x.id,pagination:e($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Ge,{visible:e(p),"onUpdate:visible":_[3]||(_[3]=x=>V(p)?p.value=x:null),"operate-type":e(N),"row-data":e(I),onSubmitted:e(y)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(qe,{visible:e(a),"onUpdate:visible":_[4]||(_[4]=x=>V(a)?a.value=x:null),roleRow:m.value},null,8,["visible","roleRow"])]),_:1},8,["title"])])}}});export{_t as default};
