import{m as L,a as R,n as re,q as le,d as T,s as K,v as W,u as ie,j as G,x as H,r as D,y as J,z as ce,A as j,C as ue,o as h,c as z,w as i,g as n,D as X,f as g,$ as y,E as F,e as s,F as B,h as E,G as de,t as S,H as pe,I as me,J as fe,K as _e,L as ge,M as he,N as Q,O as Y,S as we,P as ve,Q as ye,B as Z,R as ee,T as te,p as xe,i as ke,_ as V,U as Ce,V as be,W as Pe,X as Se,Y as q,Z as $e,a0 as Ne,a1 as Le,a2 as Re,b,a3 as Ue,a4 as Ee,a5 as M,a6 as ze}from"./index-DVq60TOR.js";function Me(v){const d=L(0),P=R(()=>Math.ceil(d.value/60)),C=R(()=>d.value>0),{pause:o,resume:k}=re(()=>{d.value>0?d.value-=1:o()},{immediate:!1});function l(t=v){d.value=60*t,k()}function e(){d.value=0,o()}return le(()=>{o()}),{count:P,isCounting:C,start:l,stop:e}}const w=v=>(xe("data-v-5d738f78"),v=v(),ke(),v),Ie={class:"w-full flex-y-center gap-16px"},je=["src"],Fe={class:"flex-y-center justify-between updatePsd"},qe={class:"agreement-container"},De=w(()=>s("h2",null,"用户协议",-1)),Be={class:"agreement-content"},Te=w(()=>s("h3",null,"1. 协议的接受",-1)),Ve=w(()=>s("p",null,"在登录之前，您必须阅读并同意本协议的全部内容。点击“同意”按钮，即表示您已详细阅读并理解本协议，并同意受其约束。",-1)),Oe=w(()=>s("h3",null,"2. 用户信息的使用",-1)),Ae=w(()=>s("p",null,"您同意并授权本系统在合法合规的前提下，使用您的用户信息以提供相关服务，包括但不限于：",-1)),Xe=w(()=>s("ul",null,[s("li",null,"查询个人账户信息；"),s("li",null,"修改个人资料，如联系方式、密码等；"),s("li",null,"保障账户安全，防止未经授权的访问或篡改。")],-1)),Ke=w(()=>s("h3",null,"3. 用户责任",-1)),We=w(()=>s("p",null,"您保证所提供的所有信息真实、准确、完整，并对您的账户安全负全部责任。",-1)),Ge=w(()=>s("p",null,"不得冒用他人身份或提供虚假信息，否则系统有权拒绝提供服务，并依法追究责任。",-1)),He=w(()=>s("h3",null,"4. 隐私保护",-1)),Je=w(()=>s("p",null,"我们承诺严格保护您的个人隐私，不会泄露或滥用您的个人信息，除非法律法规另有规定或获得您的明确授权。",-1)),Qe=w(()=>s("h3",null,"5. 协议变更",-1)),Ye=w(()=>s("p",null,"本协议可能会不定期更新，更新后的协议一旦发布即自动生效。如果您继续使用本系统的查询和修改功能，即视为接受新的协议内容。",-1)),Ze=w(()=>s("h3",null,"6. 其他",-1)),et=w(()=>s("p",null,"如对本协议有任何疑问，您可联系系统管理员获取进一步解释。",-1)),tt=w(()=>s("div",{style:{display:"flex","justify-content":"right","align-items":"center"}},null,-1)),st=T({name:"PwdLogin",__name:"pwd-login",props:{status:{type:String,required:!0},statusModifiers:{}},emits:K(["getUsername"],["update:status"]),setup(v,{emit:_}){const d=W(v,"status"),P=_,C=ie();G();const{formRef:o,validate:k}=H(),l=D({username:"",captcha:"",password:""}),e=D({uuid:"",captchaSrc:"",captchaEnable:0,checked:!1}),t=L(!1);async function r(){const{data:p,error:f}=await pe();f||(e.captchaEnable=p,e.captchaEnable==1&&a())}async function a(){e.uuid=j(),e.captchaSrc=me+"/captcha?uuid="+e.uuid;const p=j(),f=Date.now().toString(),U=fe(`${p}${f}uuid=${e.uuid}`);_e.get(e.captchaSrc,{headers:{"X-Nonce":p,"X-Timestamp":f,"X-Signature":U},responseType:"blob"}).then($=>{const I=URL.createObjectURL($.data);e.captchaSrc=I}).catch($=>{console.error("Error:",$)})}const m=R(()=>{const{formRules:p}=J();return{username:p.username,captcha:p.captcha,password:p.password1}});async function c(){var f;if(await k(),!t.value)return(f=window.$message)==null?void 0:f.warning("请阅读并同意用户协议");ge(l.username+"power_isokAgreement","true");const p=await C.login(l.username,l.password,l.captcha.trim(),e.uuid);console.log(p),p=="fail"&&e.captchaEnable==1&&(l.captcha="",a())}const x=p=>{t.value=he(l.username+"power_isokAgreement")=="true"||!1},u=()=>{d.value="resetPwd",P("getUsername",l.username)};return L(!1),ce(()=>{e.uuid=j(),r()}),(p,f)=>{const U=Q,$=Y,I=we,se=ve,oe=ye,O=Z,ne=ee,ae=te,A=ue("no-space");return h(),z(ae,{ref_key:"formRef",ref:o,model:l,rules:m.value,size:"large","show-label":!1},{default:i(()=>[n($,{path:"userName"},{default:i(()=>[X(n(U,{autofocus:"",value:l.username,"onUpdate:value":f[0]||(f[0]=N=>l.username=N),placeholder:g(y)("page.login.common.userNamePlaceholder"),onBlur:x,onKeyup:F(c,["enter"])},null,8,["value","placeholder"]),[[A]])]),_:1}),n($,{path:"password"},{default:i(()=>[X(n(U,{value:l.password,"onUpdate:value":f[1]||(f[1]=N=>l.password=N),type:"password","show-password-on":"click",minlength:6,maxlength:18,placeholder:g(y)("page.login.common.passwordPlaceholder"),onKeyup:F(c,["enter"])},null,8,["value","placeholder"]),[[A]])]),_:1}),e.captchaEnable==1?(h(),z($,{key:0,path:"captcha"},{default:i(()=>[s("div",Ie,[n(U,{value:l.captcha,"onUpdate:value":f[2]||(f[2]=N=>l.captcha=N),placeholder:"请输入验证码",onKeyup:F(c,["enter"])},null,8,["value"]),s("img",{src:e.captchaSrc,alt:"captcha",style:{height:"40px"},onClick:a},null,8,je)])]),_:1})):B("",!0),n(ne,{vertical:"",size:8},{default:i(()=>[s("div",Fe,[n(oe,{checked:t.value,"onUpdate:checked":f[4]||(f[4]=N=>t.value=N)},{default:i(()=>[E("我已阅读并同意 "),n(se,{style:{"background-color":"#fff",color:"#1f2225"},trigger:"click","content-style":{padding:0}},{trigger:i(()=>[s("span",{class:"c-#1890ff",onClick:f[3]||(f[3]=de(()=>{},["stop"]))},"用户协议")]),default:i(()=>[s("div",qe,[De,s("div",Be,[n(I,{style:{"max-height":"320px",width:"520px"},"content-style":{padding:"0 0 30px 0"}},{default:i(()=>[Te,Ve,Oe,Ae,Xe,Ke,We,Ge,He,Je,Qe,Ye,Ze,et]),_:1})])])]),_:1})]),_:1},8,["checked"]),n(O,{quaternary:"",onClick:u},{default:i(()=>[E(S("修改密码"))]),_:1})]),n(O,{type:"primary",size:"large",ghost:"",round:"",block:"",loading:g(C).loginLoading,disabled:!t.value,onClick:c},{default:i(()=>[E(S(g(y)("common.confirm")),1)]),_:1},8,["loading","disabled"]),tt]),_:1})]),_:1},8,["model","rules"])}}}),ot=V(st,[["__scopeId","data-v-5d738f78"]]);function nt(){const{loading:v,startLoading:_,endLoading:d}=Ce(),{count:P,start:C,stop:o,isCounting:k}=Me(60),l=R(()=>{let r=y("page.login.codeLogin.getCode");const a=y("page.login.codeLogin.reGetCode",{time:P.value});return v.value&&(r=""),k.value&&(r=a),r});function e(r){var a,m,c,x;return r.trim()===""?((m=(a=window.$message)==null?void 0:a.error)==null||m.call(a,y("form.mobile.required")),!1):Pe.test(r)?!0:((x=(c=window.$message)==null?void 0:c.error)==null||x.call(c,y("form.mobile.invalid")),!1)}async function t(r,a){!e(r)||v.value||(_(),await new Promise(c=>{be(r,a).then(x=>{var u,p;console.log("response",x),x.error||(setTimeout(c,500),(p=(u=window.$message)==null?void 0:u.success)==null||p.call(u,y("page.login.codeLogin.sendCodeSuccess")),C(),d())}).catch(x=>{var u,p;return console.log("error",x),(p=(u=window.$message)==null?void 0:u.error)==null||p.call(u,y("page.login.codeLogin.sendCodeFailed")),!1})}))}return{label:l,start:C,stop:o,isCounting:k,loading:v,getCaptcha:t}}const at=T({name:"ResetPwd",__name:"reset-pwd",props:K({username:{type:String,required:!0}},{status:{type:String,required:!0},statusModifiers:{}}),emits:["update:status"],setup(v){const _=W(v,"status"),d=v;G();const{formRef:P,validate:C}=H();nt();const o=D({username:d.username||"",oripwd:"",code:"",password:"",confirmPassword:""}),k=R(()=>{const{formRules:e,createConfirmPwdRule:t,defaultRequiredRule:r}=J();return{username:e.username,oripwd:e.password1,password:[{...r},{asyncValidator:(a,m)=>m==""||m==null?Promise.resolve():Se(m)?o.username&&m.toLocaleLowerCase().includes(o.username.toLocaleLowerCase())?Promise.reject("密码禁止与用户名相同或包含用户名(不区分大小写)"):o.password==o.oripwd?Promise.reject("新密码不能与旧密码相同"):Promise.resolve():Promise.reject("密码应符合：大、小写字母、数字、特殊字符的8-18位组合"),trigger:["blur","input"]}],code:e.code,confirmPassword:t(o.password)}});async function l(){var c,x;await C();const e=q(o.oripwd),t=q(o.password),r=q(o.username),{data:a,error:m}=await $e(r,e,t);console.log("data",a),m?(x=window.$message)==null||x.error("修改失败"):((c=window.$message)==null||c.success("修改成功"),_.value="pwd-login1")}return(e,t)=>{const r=Q,a=Y,m=Z,c=ee,x=te;return h(),z(x,{ref_key:"formRef",ref:P,model:o,rules:k.value,size:"large","show-label":!1},{default:i(()=>[n(a,{path:"username"},{default:i(()=>[n(r,{value:o.username,"onUpdate:value":t[0]||(t[0]=u=>o.username=u),placeholder:g(y)("page.login.common.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1}),n(a,{path:"oripwd"},{default:i(()=>[n(r,{value:o.oripwd,"onUpdate:value":t[1]||(t[1]=u=>o.oripwd=u),type:"password","show-password-on":"click",placeholder:"请输入原密码"},null,8,["value"])]),_:1}),n(a,{path:"password"},{default:i(()=>[n(r,{value:o.password,"onUpdate:value":t[2]||(t[2]=u=>o.password=u),type:"password","show-password-on":"click",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),n(a,{path:"confirmPassword"},{default:i(()=>[n(r,{value:o.confirmPassword,"onUpdate:value":t[3]||(t[3]=u=>o.confirmPassword=u),type:"password","show-password-on":"click",placeholder:g(y)("page.login.common.confirmPasswordPlaceholder")},null,8,["value","placeholder"])]),_:1}),n(c,{vertical:"",size:18,class:"w-full"},{default:i(()=>[n(m,{type:"primary",size:"large",ghost:"",round:"",block:"",onClick:l},{default:i(()=>[E(S(g(y)("common.confirm")),1)]),_:1}),n(m,{size:"large",ghost:"",round:"",block:"",onClick:t[4]||(t[4]=u=>_.value="pwd-login"),class:"c-#fff"},{default:i(()=>[E(S(g(y)("page.login.common.back")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),rt=V(at,[["__scopeId","data-v-74e31eee"]]),lt={class:"w-400px lt-sm:w-300px"},it={class:"flex-y-center justify-center"},ct={key:0,src:M,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},ut={key:1,src:M,alt:"Linkqi",style:{width:"64px",position:"absolute",left:"20px"}},dt={key:2,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},pt={key:3,class:"text-28px text-primary font-500 lt-sm:text-22px",style:{color:"#fff","text-align":"center"}},mt={class:"pt-24px"},ft={class:"pt-16px"},_t={class:"flex justify-center items-center",style:{position:"fixed",top:"20px",right:"20px","z-index":"999"}},gt={key:0,src:M,alt:"Linkqi",class:"w-100px pr-10px"},ht={key:1,src:M,alt:"Linkqi",class:"w-100px pr-10px"},wt={key:2,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},vt={key:3,style:{color:"#fff","font-size":"1.2rem","font-weight":"500"}},yt={key:0,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},xt={key:1,style:{color:"#fff",position:"fixed",left:"50%",bottom:"5%",transform:"translateX(-50%)","font-size":"1rem","z-index":"999"}},kt=T({name:"login",__name:"index",props:{module:{}},setup(v){Ne();const _=Le(),d=L("pwd-login"),P=L(""),C=e=>{P.value=e},o=R(()=>{const e="#ffffff",t=_.darkMode?.5:.2;return Re(e,_.themeColor,t)}),k=L();return(async()=>{fetch("/version.json").then(e=>e.json()).then(e=>{k.value=e}).catch(e=>{console.error("Error fetching version.json:",e)})})(),(e,t)=>{var a,m;const r=ze;return h(),b("div",{class:"relative size-full flex-center overflow-hidden login",style:Ee({backgroundColor:o.value})},[n(r,{bordered:!1,class:"relative z-4 w-auto rd-12px loginClass","content-style":{padding:"24px 36px"}},{default:i(()=>[s("div",lt,[s("header",it,[g(_).darkMode?(h(),b("img",ut)):(h(),b("img",ct)),g(_).darkMode?(h(),b("h3",dt,S(g(y)("system.title")),1)):(h(),b("h3",pt,S(g(y)("system.title")),1))]),s("main",mt,[s("div",ft,[n(Ue,{name:g(_).page.animateMode,mode:"out-in",appear:""},{default:i(()=>[d.value=="pwd-login"||d.value=="pwd-login1"?(h(),z(ot,{key:0,status:d.value,"onUpdate:status":t[0]||(t[0]=c=>d.value=c),onGetUsername:C},null,8,["status"])):(h(),z(rt,{key:1,status:d.value,"onUpdate:status":t[1]||(t[1]=c=>d.value=c),username:P.value},null,8,["status","username"]))]),_:1},8,["name"])])])])]),_:1}),s("div",_t,[g(_).darkMode?(h(),b("img",ht)):(h(),b("img",gt)),g(_).darkMode?(h(),b("span",wt,S(((a=k.value)==null?void 0:a.ver)||""),1)):(h(),b("span",vt,S(((m=k.value)==null?void 0:m.ver)||""),1))]),g(_).darkMode?B("",!0):(h(),b("div",yt," Copyright (c) 2025 · 杭州领祺科技有限公司")),g(_).darkMode?(h(),b("div",xt," Copyright (c) 2025 · 杭州领祺科技有限公司")):B("",!0)],4)}}}),bt=V(kt,[["__scopeId","data-v-5677dafd"]]);export{bt as default};
