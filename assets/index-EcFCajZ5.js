import{_ as ca,a as pa,V as Ma,b as Ia,c as Oa,d as qa,e as Ra,f as Ha,g as Ja}from"./index-BczHTB4g.js";import{_ as Ut}from"./round-plus-CC5Q2swW.js";import{aW as ae,R as ga,b as A,o as $,e as E,d as yt,z as bt,s as y,F as Rt,aO as He,c as ue,G as O,f as i,I as st,t as K,w as d,g as w,h as _,B as C,ay as Ze,a4 as _t,M as fa,N as Tt,H as Q,aA as it,J as ye,az as vt,$ as W,aM as Ga,n as a,aG as mt,dh as Wa,W as va,av as ot,A as Yt,a as Kt,ax as Xt,at as Zt,au as Ce,K as ia,a5 as rt,aR as Ee,cu as ma,aS as ha,aE as Oe,bf as ya,cX as ba,cM as _a,f4 as Ht,cy as Ya,aJ as ra,i as ka,d0 as Ka,dk as Xa,D as Qe,bo as Za,S as Qa,f5 as el,aI as tl,X as al,Y as ll,dq as nl,cY as sl,cA as oa,dt as il,d5 as zt,a2 as rl,a_ as ua,b2 as ol,aL as ul,a7 as qt,dv as dl,a3 as cl}from"./index-CddQmI-c.js";import{u as Ve}from"./usePageData-BKzmIEAP.js";import{h as Ie}from"./permission-C3pQCx4P.js";import{N as et}from"./Popconfirm-CkfL-ZaH.js";import{_ as ht}from"./DatePicker-D516kcb4.js";import{N as Jt}from"./Cascader-DYASQCtV.js";import{_ as pl,a as gl,A as fl}from"./index-28vg6Ljo.js";import{g as vl}from"./business-C7uYL7a-.js";import{_ as ml}from"./Grid-CG_YWdVR.js";import{_ as hl}from"./FormItemGridItem-CBPP8HMS.js";function Yn(x){return ae({url:"/projectForm/getPage.do",method:"get",params:x})}function yl(x){return ae({url:"/projectForm/insert.do",method:"post",data:x})}function bl(x){return ae({url:"/projectForm/update.do",method:"put",data:x})}function Kn(x){return ae({url:"/projectForm/delete.do",method:"delete",params:{arrIds:x}})}function _l(x){return ae({url:"/projectForm/getById.do",method:"get",params:{id:x}})}function kl(x){return ae({url:"/projectForm/getIdByProId.do",method:"get",params:{proId:x}})}function xl(x){return ae({url:"/projectForm/getProjectPage.do",method:"get",params:x})}function Gt(x){return ae({url:"/projectFormContact/getPage.do",method:"get",params:x})}function Sl(x){return ae({url:"/projectFormContact/insert.do",method:"post",data:x})}function Ll(x){return ae({url:"/projectFormContact/update.do",method:"put",data:x})}function Dl(x){return ae({url:"/projectFormContact/delete.do",method:"delete",params:{arrIds:x}})}function Wt(x){return ae({url:"/projectFormEquipment/getPage.do",method:"get",params:x})}function xa(x){return ae({url:"/projectFormEquipment/insert.do",method:"post",data:x})}function Cl(x){return ae({url:"/projectFormEquipment/update.do",method:"put",data:x})}function Fl(x){return console.log(x),ae({url:"/projectFormEquipment/delete.do",method:"delete",params:{arrIds:x}})}function $l(x){return ae({url:"/projectFormDebug/getPage.do",method:"get",params:x})}function Sa(x){return ae({url:"/projectFormDebug/insert.do",method:"post",data:x})}function wl(x){return ae({url:"/projectFormDebug/update.do",method:"put",data:x})}function zl(x){return ae({url:"/projectFormDebug/delete.do",method:"delete",params:{arrIds:x}})}function Ul(x){return ae({url:"/projectFormFile/getPage.do",method:"get",params:x})}function Tl(x){return ae({url:"/projectFormFile/insert.do",method:"post",data:x})}function jl(x){return ae({url:"/projectFormFile/update.do",method:"put",data:x})}function Pl(x){return ae({url:"/projectFormFile/delete.do",method:"delete",params:{arrIds:x}})}const Bl={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Nl(x,Se){return $(),A("svg",Bl,Se[0]||(Se[0]=[E("path",{fill:"currentColor",d:"M21 7v14H3V3h14zm-2 .85L16.15 5H5v14h14zM12 18q1.25 0 2.125-.875T15 15t-.875-2.125T12 12t-2.125.875T9 15t.875 2.125T12 18m-6-8h9V6H6zM5 7.85V19V5z"},null,-1)]))}const El=ga({name:"material-symbols-save-outline-sharp",render:Nl}),Vl={class:"inline-block",viewBox:"0 0 14 14",width:"1em",height:"1em"};function Al(x,Se){return $(),A("svg",Vl,Se[0]||(Se[0]=[E("path",{fill:"currentColor","fill-rule":"evenodd",d:"M6.545.998a1 1 0 0 0 0 2h2.728a2.638 2.638 0 0 1 0 5.275H4.817V6.545a1 1 0 0 0-1.707-.707L.384 8.564a1 1 0 0 0-.22 1.09q.073.18.218.327l2.728 2.728a1 1 0 0 0 1.707-.707v-1.729h4.456a4.638 4.638 0 1 0 0-9.275z","clip-rule":"evenodd"},null,-1)]))}const Ml=ga({name:"streamline-return2-solid",render:Al}),Il={class:"flex items-center justify-between"},Ol={class:"flex items-center"},ql={style:{margin:"10px 0","font-weight":"bolder",width:"140px"}},Rl={key:0,class:"font-size-12px c-#ffa502 ml-10px"},Hl={key:0},Jl={style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Gl={key:0},Wl={style:{display:"flex","justify-content":"space-between"}},Yl={key:3},Kl=["src"],Xl=yt({__name:"fileList",props:{pid:{},data:{},fileType:{},typename:{},operateType:{}},emits:["getData","myClick","submittedData"],setup(x,{emit:Se}){const ee=x,J=bt(),be=Se,m=[{title:"文件别名",key:"name",align:"center",width:200,ellipsis:{tooltip:!0}},{title:"文件名称",key:"filename",align:"center",width:200,ellipsis:{tooltip:!0}},{title:"上传人",key:"creator",align:"center",width:100},{title:"上传时间",key:"dbtime",align:"center",width:200},{title:"操作",key:"actions",align:"center",width:180,render(r,p){return a(ye,{justify:"center"},[a(C,{type:"info",size:"small",ghost:!0,onClick:()=>{ke(r)}},{default:()=>"查看"}),a(C,{type:"info",size:"small",ghost:!0,onClick:()=>{Fe(r)}},{default:()=>"下载"}),Ie("project:form:File:update")&&a(C,{type:"info",size:"small",ghost:!0,onClick:()=>{M(r)}},{default:()=>"编辑"}),Ie("project:form:File:delete")&&J.userInfo.usertype==0&&a(et,{onPositiveClick:async()=>{var h;if(r.id){const{data:b,error:l}=await Wa(r.url),{data:u,error:g}=await Pl(r.id);g||((h=window.$message)==null||h.success("删除成功"),be("getData"))}}},{default:()=>W("common.confirmDelete"),trigger:()=>a(C,{type:"error",ghost:!0,size:"small"},{default:()=>W("common.delete")})})])}}];async function _e(r){var p;return r.file.file.size>100*1024*1024?((p=window.$message)==null||p.error("文件大小不能超过100M"),!1):!0}const q=y(!1),B=y(null),H=y({fileName:"",file:null,id:void 0}),ze={fileName:[{required:!0,message:"请输入文件别名",trigger:["blur","change"]}]},f=y(0),Ae=()=>{be("myClick"),I.value=[],q.value=!0,f.value=0,H.value.id=void 0,H.value.fileName="",H.value.file=null},Ue=async()=>{var r,p,h,b;try{if(await((r=B.value)==null?void 0:r.validate()),H.value.id){const{data:l,error:u}=await jl([{id:H.value.id,filename:H.value.fileName}]);if(u)return(p=window.$message)==null?void 0:p.error("保存文件记录失败");(h=window.$message)==null||h.destroyAll(),(b=window.$message)==null||b.success("编辑成功"),be("getData"),le.value=!1;return}}catch{le.value=!1}};async function Fe(r){if(r!=null&&r.url)try{const h=await(await fetch(r.url,{mode:"cors"})).blob(),b=URL.createObjectURL(h),l=document.createElement("a");l.href=b,l.download=r.filename,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(b)}catch(p){console.error("下载失败:",p)}}const Be=()=>{console.log("渲染完成")},Le=r=>{console.log(r,"渲染失败")},ve=y(!1),c=y(""),N=y([]),re=y(""),X=y("预览文件"),Ne=y(!1),me=y(0),ke=r=>{var h,b;if(!(r!=null&&r.url))return;const p=(h=r.filename.split(".").pop())==null?void 0:h.toLowerCase();if(c.value=r.url,X.value=r.filename,["xls","xlsx"].includes(p))re.value="xls";else if(["doc","docx"].includes(p))re.value="doc";else if(["pdf"].includes(p))re.value="pdf";else if(["png","jpg","jpeg","gif","bmp"].includes(p)){re.value="img",N.value=ee.data.map(u=>{var g;return["png","jpg","jpeg","gif","bmp"].includes((g=u.filename.split(".").pop())==null?void 0:g.toLowerCase())?u.url:""}).filter(u=>u!=="");const l=N.value.findIndex(u=>u===r.url);me.value=l,Ne.value=!0;return}else if(["mp4"].includes(p))re.value="mp4";else{(b=window.$message)==null||b.warning("暂不支持该文件类型预览");return}ve.value=!0},De=y(45),de=()=>{De.value==45?De.value=350:De.value=45},le=y(!1);function M(r){H.value.id=r.id,H.value.fileName=r.name,le.value=!0}const xe=()=>{le.value=!1};function Te(r){return r.replace(/\.[^/.]+$/,"")}const G=[{title:"文件名称",key:"filename",align:"center",render(r){if(!r.name){const p=async({file:b,onFinish:l,onError:u})=>{var g,S;try{r.status=!0;const z=await mt(b.file,b.name,"",V=>{r.progress=V});z&&(r.url=z,r.name=b.name,r.status=!1)}catch(z){console.error(z),(S=(g=window.$message)==null?void 0:g.error)==null||S.call(g,"文件上传出错"),r.status=!1}};async function h(b){var l;return b.file.file.size>100*1024*1024?((l=window.$message)==null||l.error("文件大小不能超过100M"),!1):!0}return a("div",{style:"display: flex; justify-content: center; align-items: center;"},[a(vt,{action:"#",showFileList:!1,customRequest:p,onBeforeUpload:h},{default:()=>a(C,{type:"info",size:"small",ghost:!0,loading:r.status},{default:()=>"上传文件"})}),r.progress?a(it,{type:"line",percentage:r.progress,indicatorPlacement:"inside",processing:!0}):null])}return a("div",{},r.name)}},{title:"文件别名",key:"filename",align:"center",render(r){return a(Q,{value:r.filename??Te(r.name)??"",onUpdateValue:p=>{r.filename=p}})}},{title:"操作",key:"actions",align:"center",width:100,render(r){return a(ye,{justify:"center"},[a(C,{type:"error",size:"small",ghost:!0,onClick:()=>{I.value=I.value.filter(p=>p!==r)}},{default:()=>"删除"})])}}],I=y([]),ne=y(0),ce=y(!1),n=async()=>{var p,h,b,l,u;let r=!0;for(let g=0;g<I.value.length;g++){const S=I.value[g];if(!S.name){(p=window.$message)==null||p.warning(`第${g+1}个文件的文件名称不能为空`),r=!1;break}if(!S.name){(h=window.$message)==null||h.warning(`第${g+1}个文件的文件别名不能为空`),r=!1;break}}if(r){ce.value=!0;const g=I.value.length;for(let S=0;S<g;S++){ne.value=S;const z=I.value[S];z.indexText=`${S+1}/${g}`,z.progress=0,z.status="uploading";try{z.url=await mt(z.file,z.name,"",V=>{z.progress=V}),z.progress=100,z.status="done"}catch{z.status="error"}}if(ee.operateType=="edit"){const S=I.value.map(T=>({file:T.url,filename:T.filename,pid:ee.pid,sort:ee.fileType})),{data:z,error:V}=await Tl(S);if(V)return(b=window.$message)==null?void 0:b.error("保存文件记录失败");be("getData"),(l=window.$message)==null||l.destroyAll(),(u=window.$message)==null||u.success("上传成功"),q.value=!1,ce.value=!1}else{console.log(I.value);const S=I.value.map(z=>({file:z.url,filename:z.name,name:z.filename,sort:ee.fileType}));be("submittedData",S),q.value=!1,ce.value=!1}}},v=()=>{q.value=!1};function F(r){r.fileList.forEach(p=>{p.filename||(p.filename=Te(p.name))}),I.value=r.fileList}return(r,p)=>{const h=Ut,b=ca,l=pa,u=Tt,g=fa,S=_t,z=Ga,V=Rt("no-auth");return $(),A(He,null,[E("div",Il,[E("div",Ol,[E("h2",ql,K(ee.typename),1),st(($(),ue(_(C),{size:"small",ghost:"",type:"primary",onClick:Ae},{icon:d(()=>[i(h,{class:"text-icon"})]),default:d(()=>[w(" 新增"+K(ee.typename),1)]),_:1})),[[V,"project:form:File:insert"]]),ee.fileType==4?($(),A("span",Rl,"照片数不少于6张")):O("",!0)]),ee.data.length>0?($(),A("div",Hl,"共"+K(ee.data.length)+"条",1)):O("",!0)]),ee.data.length>0?($(),ue(_(Ze),{key:0,columns:m,data:ee.data,size:"small","scroll-x":702,"row-key":T=>T.id,"max-height":De.value},null,8,["data","row-key","max-height"])):O("",!0),E("div",Jl,[De.value==45&&ee.data.length>1?($(),A("span",{key:0,onClick:de},[p[7]||(p[7]=w(" 更多 ")),i(b,{class:"font-size-20px"})])):O("",!0),De.value==350&&ee.data.length>1?($(),A("span",{key:1,onClick:de},[p[8]||(p[8]=w(" 收起 ")),i(l,{class:"font-size-20px"})])):O("",!0)]),i(S,{show:le.value,"onUpdate:show":p[1]||(p[1]=T=>le.value=T),title:(H.value.id?"编辑":"新增")+ee.typename,preset:"card",class:"w-700px"},{default:d(()=>[i(g,{ref_key:"formRef",ref:B,model:H.value,rules:ze,"label-width":"auto",style:{width:"100%"}},{default:d(()=>[i(u,{label:"文件别名",path:"fileName"},{default:d(()=>[i(_(Q),{value:H.value.fileName,"onUpdate:value":p[0]||(p[0]=T=>H.value.fileName=T),placeholder:"请输入"},null,8,["value"])]),_:1}),f.value?($(),ue(_(it),{key:0,type:"line",percentage:f.value,color:f.value==100?"#18a058":"#2080f0","indicator-placement":"inside",processing:""},null,8,["percentage","color"])):O("",!0),i(u,null,{default:d(()=>[i(_(ye),{justify:"center",style:{width:"100%"}},{default:d(()=>[i(_(C),{type:"primary",onClick:Ue},{default:d(()=>p[9]||(p[9]=[w(K("确认"))])),_:1,__:[9]}),i(_(C),{onClick:xe},{default:d(()=>p[10]||(p[10]=[w("取消")])),_:1,__:[10]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),i(S,{show:q.value,"onUpdate:show":p[3]||(p[3]=T=>q.value=T),title:(H.value.id?"编辑":"新增")+ee.typename,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:d(()=>[i(_(ye),{justify:"end"},{default:d(()=>[i(_(C),{size:"small",class:"mt-16px",onClick:v},{default:d(()=>[w(K(_(W)("common.cancel")),1)]),_:1}),i(_(C),{type:"primary",size:"small",class:"mt-16px",onClick:n},{default:d(()=>[w(K(_(W)("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[i(_(vt),{ref:"uploadRef",action:void 0,class:"mb-10px","file-list":I.value,"onUpdate:fileList":p[2]||(p[2]=T=>I.value=T),"auto-upload":!1,onBeforeUpload:_e,multiple:!0,onChange:F,"show-file-list":!1},{default:d(()=>[i(_(C),{size:"small",ghost:"",type:"primary"},{default:d(()=>p[11]||(p[11]=[w("选择文件")])),_:1,__:[11]})]),_:1},8,["file-list"]),i(_(Ze),{columns:G,"paginate-single-page":!1,data:I.value,"max-height":350},null,8,["data"]),I.value[ne.value]&&ce.value?($(),A("div",Gl,[E("div",Wl,[E("span",null,K(I.value[ne.value].filename||I.value[ne.value].name),1),E("span",null,K(I.value[ne.value].indexText),1)]),i(_(it),{percentage:I.value[ne.value].progress,status:I.value[ne.value].status==="error"?"error":"success","show-indicator":""},null,8,["percentage","status"])])):O("",!0)]),_:1},8,["show","title"]),i(S,{show:ve.value,"onUpdate:show":p[4]||(p[4]=T=>ve.value=T),title:X.value,preset:"card",style:{width:"80%"}},{default:d(()=>[re.value.includes("xls")?($(),ue(_(Ma),{key:0,options:{xls:!0,minColLength:0,minRowLength:0,widthOffset:20,heightOffset:5},src:c.value,style:{height:"80vh"},onRendered:Be,onError:Le},null,8,["src"])):O("",!0),re.value.includes("doc")?($(),ue(_(Ia),{key:1,src:c.value,style:{height:"80vh"},onRendered:Be,onError:Le},null,8,["src"])):O("",!0),re.value.includes("pdf")?($(),ue(_(Oa),{key:2,src:c.value,style:{height:"80vh"},onRendered:Be,onError:Le},null,8,["src"])):O("",!0),re.value.includes("mp4")?($(),A("div",Yl,[E("video",{src:c.value,controls:"",style:{width:"100%",height:"80vh"}},null,8,Kl)])):O("",!0)]),_:1},8,["show","title"]),i(z,{show:Ne.value,"onUpdate:show":p[5]||(p[5]=T=>Ne.value=T),"src-list":N.value,current:me.value,"onUpdate:current":p[6]||(p[6]=T=>me.value=T)},null,8,["show","src-list","current"])],64)}}}),da=va(Xl,[["__scopeId","data-v-bc346840"]]),Zl=yt({name:"businessModal",__name:"businessModal",props:ot({pid:{},operateType:{},debuggedDevieceList:{},contactList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ot(["submitted","submittedData"],["update:visible"]),setup(x,{emit:Se}){const ee=Se;bt();const J=x;async function be(){B(),Be(),N(),De(),M.value=[],le.value=!0,de.value=!0,G.value=[]}Yt();const m=Kt(()=>"新增待调试业务"),_e=Xt(x,"visible");Zt(_e,()=>{_e.value&&be()});const{pageData:q,getData:B,nextPage:H}=Ve(ma),ze=async l=>{const u=l.currentTarget;u.scrollTop+u.offsetHeight>=u.scrollHeight&&q.data.length<q.total&&H()},{pageData:f,getData:Ae,nextPage:Ue}=Ve(Gt),Fe=async l=>{const u=l.currentTarget;u.scrollTop+u.offsetHeight>=u.scrollHeight&&f.data.length<f.total&&(Ue(),f.data=f.data.map(g=>({...g,value:g.docker+"&id="+g.id})))},Be=async()=>{await Ae({pid:J.pid}),f.data=f.data.map(l=>({...l,value:l.docker+"&id="+l.id}))},{pageData:Le,getData:ve,nextPage:c}=Ve(ha),N=async()=>{await ve({usertypes:"2,3"})},re=async l=>{const u=l.currentTarget;u.scrollTop+u.offsetHeight>=u.scrollHeight&&Le.data.length<Le.total&&c()},{pageData:X,getData:Ne,nextPage:me}=Ve(Wt),ke=async l=>{const u=l.currentTarget,g=u.scrollTop;u.scrollTop+u.offsetHeight>=u.scrollHeight&&q.data.length<q.total&&(await me(),await Oe(),setTimeout(()=>{u.scrollTop=g}))},De=async()=>{J.pid&&await Ne({pid:J.pid})},de=y(!0),le=y(!0),M=y([]),xe=[{title:"权重",key:"dtype",width:180,align:"center",render(l,u){return l.setStatus?a(Ce,{value:l.dtype,filterable:!0,placeholder:"请选择权重",options:q.data,labelField:"tname",valueField:"id",onUpdateValue(g){var S;M.value[u].dtype=Number(g)||0,M.value[u].debugname=((S=q.data.find(z=>z.id==g))==null?void 0:S.tname)||""},onScroll(g){ze(g)}}):a("div",{},l.tname)}},{title:"业务名称",key:"debugname",width:180,align:"center",render(l,u){return l.setStatus?a(Q,{value:l.debugname,placeholder:"请输入业务名称",onUpdateValue(g){M.value[u].debugname=g}}):a("div",{},l.debugname)}},{key:"eqmname",title:"调试设备",align:"center",width:150,render(l,u){return a(Ce,{value:l.eqmid,placeholder:"请选择调试设备",options:J.operateType=="edit"?X.data:J.debuggedDevieceList,onscroll:ke,labelField:"devname",valueField:J.operateType=="edit"?"id":"eqmid",clearable:!0,filterable:!0,onUpdateValue(g){M.value[u].eqmid=g}})}},{key:"dbcreater",width:140,align:"center",title:()=>a("div",{style:"display:flex;align-items:center;justify-content:center;gap:6px;"},[a("span",null,"调试人"),a(ia,{size:"small",checked:le.value,label:"联动",style:"margin-left: 10px;font-size: 12px;",onUpdateChecked:l=>{le.value=l}})]),render(l,u){return l.setStatus?a(Ce,{value:l.dbcreater,filterable:!0,placeholder:"请选择调试人",options:Le.data,labelField:"username",valueField:"id",onUpdateValue(g){le.value?M.value.forEach((S,z)=>{S.dbcreater=g||0}):M.value[u].dbcreater=g||0},onScroll(g){re(g)}}):a("div",{},l.dbusername)}},{key:"docker",width:140,align:"center",title:()=>a("div",{style:"display:flex;align-items:center;justify-content:center;gap:6px;"},[a("span",null,"对接方"),a(ia,{size:"small",checked:de.value,label:"联动",style:"margin-left: 10px;font-size: 12px;",onUpdateChecked:l=>{de.value=l}})]),render(l,u){var g;return l.setStatus?a(Ce,{value:l.docker,placeholder:"请输入或选择对接方",options:J.operateType=="edit"?f.data:J.contactList,onscroll:Fe,labelField:"docker",valueField:J.operateType=="edit"?"value":"docker",clearable:!0,filterable:!0,tag:!0,onClear(){l.dockcharge="",l.dockcontact=""},onUpdateValue(S){var z;if(de.value)M.value.forEach((V,T)=>{var te;V.docker=S;let Y={};if(J.operateType=="edit"){const[pe,qe]=(te=l.docker)==null?void 0:te.split("&id=");Y=f.data.find(ge=>ge.docker===pe&&ge.id===Number(qe))}else Y=J.contactList.find(pe=>pe.docker==V.docker);console.log(J.contactList,V.docker,"sss"),Y?(V.dockcharge=Y.pname,V.dockcontact=Y.pcontact):(V.dockcharge="",V.dockcontact="")});else{M.value[u].docker=S;let V={};if(J.operateType=="edit"){const[T,Y]=(z=l.docker)==null?void 0:z.split("&id=");V=f.data.find(te=>te.docker===T&&te.id===Number(Y))}else V=J.contactList.find(T=>T.docker==S);V?(l.dockcharge=V.pname,l.dockcontact=V.pcontact):(l.dockcharge="",l.dockcontact="")}}}):a("div",{},(g=l.docker)==null?void 0:g.split("&id=")[0])}},{title:"对接方负责人",key:"dockcharge",width:100,align:"center",render(l,u){return l.setStatus?a(Q,{value:l.dockcharge,placeholder:"请输入对接方负责人",onUpdateValue(g){M.value[u].dockcharge=g}}):a("div",{},l.dockcharge)}},{title:"联系方式",key:"dockcontact",width:120,align:"center",render(l,u){return l.setStatus?a(Q,{value:l.dockcontact,placeholder:"请输入联系方式",onUpdateValue(g){M.value[u].dockcontact=g}}):a("div",{},l.dockcontact)}},{title:"文件",key:"re1",width:100,align:"center",render(l,u){return l.setStatus?a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>v(l,u)},{default:()=>"上传文件"}):a(rt,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const g=[{alias:l.re1,file:l.fl1},{alias:l.re2,file:l.fl2},{alias:l.re3,file:l.fl3},{alias:l.re4,file:l.fl4}].filter(S=>S.alias||S.file);return g.length===0?a("div",{style:"padding: 10px; color: #999;"},"暂无文件"):a("div",{style:"padding: 10px;"},[a("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[a("thead",[a("tr",[a("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),a("th",{style:"text-align:center; padding: 4px 8px;"},"文件")])]),a("tbody",g.map(S=>{var z;return a("tr",[a("td",{style:"text-align:center; padding: 4px 8px;"},S.alias||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},((z=S.file)==null?void 0:z.split("?")[1])||"-")])}))])])}})}},{title:"备注",key:"notes",width:200,align:"center",render(l,u){return l.setStatus?a(Q,{value:l.notes,placeholder:"请输入备注",onUpdateValue(g){M.value[u].notes=g}}):a("div",{},l.notes)}},{title:"计划开始时间",key:"starttime",width:200,align:"center",render(l,u){return l.setStatus?a(ht,{type:"date",clearable:!0,value:l.starttime,valueFormat:"yyyy-MM-dd",placeholder:"请选择",onUpdateValue(g){M.value[u].starttime=g}}):a("div",Ee(0,l.starttime))}},{title:"计划结束时间",key:"endtime",width:200,align:"center",render:(l,u)=>l.setStatus?a(ht,{type:"date",clearable:!0,valueFormat:"yyyy-MM-dd",value:l.endtime,placeholder:"请选择",onUpdateValue(g){M.value[u].endtime=g}}):Ee(0,l.endtime)},{key:"operate",title:W("common.operate"),align:"center",width:120,fixed:"right",render(l,u){return a("div",{class:"flex-center gap-8px"},[a(et,{onPositiveClick:()=>{M.value.splice(u,1),G.value.splice(u,1)}},{default:()=>W("common.confirmDelete"),trigger:()=>a(C,{type:"error",ghost:!0,size:"small"},{default:()=>W("common.delete")})})])}}];function Te(){_e.value=!1}const G=y([]),I=l=>{M.value=[],l.forEach(u=>{var g;M.value.push({debugname:(g=q.data.find(S=>S.id==u))==null?void 0:g.tname,docker:void 0,dockcharge:"",dockcontact:"",debugresult:0,status:0,notes:"",dbcreater:void 0,dtype:u,setStatus:!0,pid:J.pid,starttime:null,endtime:null})})};async function ne(){var S,z,V,T;const l=["dtype","debugname","docker"];if(M.value.find((Y,te)=>l.some(pe=>!Y[pe]||Y[pe].toString().trim()===""))){(z=(S=window.$message)==null?void 0:S.error)==null||z.call(S,"请完整填写所有必填项（权重、业务名称、对接方）");return}const g=M.value.map(Y=>{var te;return{...Y,starttime:Ee(0,Y.starttime),endtime:Ee(0,Y.endtime),docker:(te=Y.docker)==null?void 0:te.split("&id=")[0]}});if(J.operateType=="edit"){const{data:Y,error:te}=await Sa(g);te||((T=(V=window.$message)==null?void 0:V.success)==null||T.call(V,"添加成功"),Te(),ee("submitted"))}else ee("submittedData",g)}const ce=y(!1),n=y(),v=(l,u)=>{r.value=[],ce.value=!0,n.value=u,l.re1&&r.value.push({id:"",name:l.re1,url:l.fl1,status:!1}),l.re2&&r.value.push({id:"",name:l.re2,url:l.fl2,status:!1}),l.re3&&r.value.push({id:"",name:l.re3,url:l.fl3,status:!1}),l.re4&&r.value.push({id:"",name:l.re4,url:l.fl4,status:!1})},F=[{title:"文件名称",key:"filename",align:"center",render(l){if(!l.url){const u=async({file:S,onFinish:z,onError:V})=>{var T,Y;try{l.status=!0;const te=await mt(S.file,S.name,"",pe=>{l.progress=pe});te&&(l.url=te,l.name=S.name,l.status=!1)}catch(te){console.error(te),(Y=(T=window.$message)==null?void 0:T.error)==null||Y.call(T,"文件上传出错"),l.status=!1}};async function g(S){var z;return S.file.file.size>100*1024*1024?((z=window.$message)==null||z.error("文件大小不能超过100M"),!1):!0}return a("div",{style:"display: flex; justify-content: center; align-items: center;"},[a(vt,{action:"#",showFileList:!1,customRequest:u,onBeforeUpload:g},{default:()=>a(C,{type:"info",size:"small",ghost:!0,loading:l.status},{default:()=>"上传文件"})}),l.progress?a(it,{type:"line",percentage:l.progress,indicatorPlacement:"inside",processing:!0}):null])}return l.url&&!l.id?i("span",null,[l.url.split("?")[1],w(" "),i("span",{onClick:()=>l.url="",style:"color: red;cursor: pointer;font-size: 12px;"},[w("删除")])]):a("div",{},l.url.split("?")[1])}},{title:"文件别名",key:"name",align:"center",render(l){return a(Q,{value:l.name,onUpdateValue:u=>{l.name=u}})}},{title:"操作",key:"actions",align:"center",width:100,render(l){return a(ye,{justify:"center"},[a(C,{type:"error",size:"small",ghost:!0,onClick:()=>{r.value=r.value.filter(u=>u!==l)}},{default:()=>"删除"})])}}],r=y([]),p=()=>{var l,u;if(r.value.length>=4)return(u=(l=window.$message)==null?void 0:l.warning)==null?void 0:u.call(l,"最多上传4个文件");r.value.push({id:"",name:"",url:"",status:!1,setStatus:!0})},h=async()=>{r.value.forEach(async(l,u)=>{M.value[n.value][`re${u+1}`]=l.name,M.value[n.value][`fl${u+1}`]=l.url}),ce.value=!1,n.value=void 0},b=()=>{ce.value=!1};return(l,u)=>{const g=Tt,S=Ze,z=_t,V=Ut;return $(),A(He,null,[i(z,{show:_e.value,"onUpdate:show":u[1]||(u[1]=T=>_e.value=T),title:m.value,preset:"card",class:"w-80% h-70vh","mask-closable":!1,draggable:!0},{footer:d(()=>[i(_(ye),{justify:"end",size:16},{default:d(()=>[i(_(C),{onClick:Te},{default:d(()=>[w(K(_(W)("common.cancel")),1)]),_:1}),i(_(C),{type:"primary",onClick:ne},{default:d(()=>[w(K(_(W)("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[i(g,{label:"权重","label-placement":"left"},{default:d(()=>[i(_(Ce),{filterable:"",multiple:"",value:G.value,"onUpdate:value":[u[0]||(u[0]=T=>G.value=T),I],tag:"",style:{"min-width":"300px"},placeholder:"请选择权重","label-field":"tname","value-field":"id",options:_(q).data,onScroll:ze},null,8,["value","options"])]),_:1}),i(S,{style:{width:"100%"},columns:xe,data:M.value,size:"small","row-key":T=>T.id,striped:"","scroll-x":xe.reduce((T,Y)=>T+Y.width,0),"max-height":350},null,8,["data","row-key","scroll-x"])]),_:1},8,["show","title"]),i(z,{show:ce.value,"onUpdate:show":u[2]||(u[2]=T=>ce.value=T),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:d(()=>u[3]||(u[3]=[w(" 待调试业务文件列表 ")])),footer:d(()=>[i(_(ye),{justify:"end"},{default:d(()=>[i(_(C),{size:"small",class:"mt-16px",onClick:b},{default:d(()=>[w(K(_(W)("common.cancel")),1)]),_:1}),i(_(C),{type:"primary",size:"small",class:"mt-16px",onClick:h},{default:d(()=>[w(K(_(W)("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[i(_(C),{size:"small",ghost:"",type:"primary",onClick:p},{icon:d(()=>[i(V,{class:"text-icon"})]),default:d(()=>[u[4]||(u[4]=w(" 添加 "))]),_:1,__:[4]}),i(S,{columns:F,"paginate-single-page":!1,data:r.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])],64)}}}),Ql=yt({name:"deviceModal",__name:"deviceModal",props:ot({pid:{},proid:{},operateType:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ot(["submitted","submittedData"],["update:visible"]),setup(x,{emit:Se}){const ee=Se;bt();const J=x;async function be(){q(),c.value=[],N.value=[]}const m=Xt(x,"visible");Zt(m,()=>{m.value&&be()});const _e=y([]),q=async()=>{var F,r;const{data:n,error:v}=await ba({page:1,limit:100,id:J.proid});if(n){if(_e.value=n==null?void 0:n.list.map(p=>({value:p.id,label:p.contractname,isLeaf:!1})),_e.value.length==0)return(F=window.$message)==null?void 0:F.error("该项目没有绑定合同！");Ue((r=n==null?void 0:n.list[0])==null?void 0:r.id)}},B=y([]),H=y(),{pageData:ze,getData:f,nextPage:Ae}=Ve(_a),Ue=async n=>{await f({pids:n}),H.value=[],B.value=Array.from(new Set([...B.value,...ze.data])),H.value=ze.data.map(v=>({label:v.devname,value:v.id}))},Fe=async n=>{var v;await Ue(n.value),n.children=(v=H.value)==null?void 0:v.map(F=>({label:F.label,value:F.value,isLeaf:!0})),await Oe(),setTimeout(()=>{const F=document.querySelectorAll(".n-cascader-submenu-wrapper .n-scrollbar");console.log(F[1]),F[1]&&(F[1].removeEventListener("scroll",de),F[1].addEventListener("scroll",de))},2e3)};function Be(n,v){const F=n.filter(p=>!v.includes(p)),r=v.filter(p=>!n.includes(p));return{toDelete:F,toAdd:r}}const Le=y([]),ve=async n=>{const{toDelete:v,toAdd:F}=Be(Le.value,n);v.forEach(r=>{const p=N.value.findIndex(h=>h.cid==r);p!=-1&&N.value.splice(p,1)}),F.forEach(async r=>{var p,h,b,l,u,g,S,z,V,T,Y,te,pe,qe,ge,tt;N.value.push({devname:((h=(p=B.value)==null?void 0:p.find(oe=>oe.id==r))==null?void 0:h.devname)||"",devmodel:((l=(b=B.value)==null?void 0:b.find(oe=>oe.id==r))==null?void 0:l.devmodel)||"",devnum:((g=(u=B.value)==null?void 0:u.find(oe=>oe.id==r))==null?void 0:g.devcount)||0,devmanu:((z=(S=B.value)==null?void 0:S.find(oe=>oe.id==r))==null?void 0:z.devmanu)||"",etype:((T=(V=B.value)==null?void 0:V.find(oe=>oe.id==r))==null?void 0:T.etype)||0,status:0,devunit:((te=(Y=B.value)==null?void 0:Y.find(oe=>oe.id==r))==null?void 0:te.devunit)||"",notes:((qe=(pe=B.value)==null?void 0:pe.find(oe=>oe.id==r))==null?void 0:qe.notes)||"",setStatus:!0,cid:r,pid:J.pid,install:1,connectionmode:"",devstatus:2,manucontact:"",manuinfo:"",devnumber:((tt=(ge=B.value)==null?void 0:ge.find(oe=>oe.id==r))==null?void 0:tt.devcount)||0})}),Le.value=n},c=y([]),N=y([]),re=[{title:"绑定合同设备",key:"cid",width:300,align:"center",render(n,v){var F,r;return n.setStatus?a(Jt,{style:"width: 270px",value:n.cid,filterable:!0,placeholder:"请选择合同设备",options:_e.value,checkStrategy:"child",showPath:!1,remote:!0,onLoad:Fe,onUpdateValue(p){var b;N.value[v].cid=Number(p)||0;const h=(b=B.value)==null?void 0:b.find(l=>l.id==p);n.devname=(h==null?void 0:h.devname)||"",n.devnum=(h==null?void 0:h.devcount)||"",n.notes=(h==null?void 0:h.notes)||"",n.devnumber=(h==null?void 0:h.devcount)||0,n.etype=(h==null?void 0:h.devtype)||0,n.devmanu=(h==null?void 0:h.devmanu)||"",n.devmodel=((h==null?void 0:h.devmodel.length)>64?h==null?void 0:h.devname:h==null?void 0:h.devmodel)||"",n.devunit=(h==null?void 0:h.devunit)||""}}):a("div",{},n.devname2||((r=(F=H.value)==null?void 0:F.find(p=>p.value==n.cid))==null?void 0:r.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(n,v){return n.setStatus?a(Q,{value:n.devname,placeholder:"请输入",onUpdateValue(F){N.value[v].devname=F}}):a("div",{},n.devname)}},{title:"型号",key:"devmodel",width:220,align:"center",render(n,v){return a("div",{},n.devmodel)}},{title:"设备单位",key:"devunit",width:120,align:"center",render(n,v){return a("div",{},n.devunit)}},{title:"数量",key:"devnum",width:100,align:"center",render(n,v){return n.setStatus?a(ya,{value:n.devnum,placeholder:"请输入",max:n.devnumber,onUpdateValue(F){N.value[v].devnum=F}}):a("div",{},n.devnum)}},{title:"是否为我司设备",key:"etype",width:260,align:"center",render(n,v){return a("div",{},n.etype==0?"是":"否")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(n,v){return a("div",{},n.devmanu)}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(n,v){return n.setStatus?a(Q,{value:n.manucontact,placeholder:"请输入",onUpdateValue(F){N.value[v].manucontact=F}}):a("div",{},n.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(n,v){return n.setStatus?a(Q,{value:n.manuinfo,placeholder:"请输入",onUpdateValue(F){N.value[v].manuinfo=F}}):a("div",{},n.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(n,v){return n.setStatus&&n.id?a(Ce,{value:n.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(F){N.value[v].devstatus=Number(F)||0}}):a("div",{},n.devstatus===0?"设备无异常":n.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(n,v){return n.setStatus?a(Q,{value:n.connectionmode,placeholder:"请输入",onUpdateValue(F){N.value[v].connectionmode=F}}):a("div",{},n.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(n,v){return n.setStatus&&n.id?a(Ce,{value:n.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(F){N.value[v].install=Number(F)||0}}):a("div",{},n.install===0?"是":"否")}},{title:"备注",key:"notes",width:200,align:"center",render(n,v){return a("div",{},n.notes)}},{title:"文件",key:"re1",width:160,align:"center",render(n,v){return n.setStatus?a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>xe(n,v)},{default:()=>"上传文件"}):a(rt,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const F=[{alias:n.re1,file:n.fl1},{alias:n.re2,file:n.fl2},{alias:n.re3,file:n.fl3},{alias:n.re4,file:n.fl4}].filter(r=>r.alias||r.file);return F.length===0?a("div",{style:"padding: 10px; color: #999;"},"暂无文件"):a("div",{style:"padding: 10px;"},[a("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[a("thead",[a("tr",[a("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),a("th",{style:"text-align:center; padding: 4px 8px;"},"文件")])]),a("tbody",F.map(r=>{var p;return a("tr",[a("td",{style:"text-align:center; padding: 4px 8px;"},r.alias||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},((p=r.file)==null?void 0:p.split("?")[1])||"-")])}))])])}})}},{title:"操作信息",key:"dbtime",width:180,align:"center",render(n,v){return a(rt,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},n.dbtime?Ee(1,n.dbtime):""),default:()=>a("div",{style:"padding: 10px;"},i("div",null,[i("div",null,[w("操作人："),n.username]),i("div",null,[w("操作时间："),n.dbtime]),i("div",null,[w("清点人："),n.dusername]),i("div",null,[w("清点时间："),n.ddbtime])]))})}},{key:"operate",title:W("common.operate"),align:"center",width:180,fixed:"right",render(n,v){return a("div",{class:"flex-center gap-8px"},[a(et,{onPositiveClick:()=>{n.id||(N.value.splice(v,1),c.value.splice(v,1))}},{default:()=>W("common.confirmDelete"),trigger:()=>a(C,{type:"error",ghost:!0,size:"small"},{default:()=>W("common.delete")})})])}}];function X(){m.value=!1}async function Ne(){var F,r,p,h;const n=["cid","devname","devnum"];if(N.value.find((b,l)=>n.some(u=>!b[u]||b[u].toString().trim()===""))){(r=(F=window.$message)==null?void 0:F.error)==null||r.call(F,"请完整填写所有必填项（合同设备、设备名称、数量");return}if(J.operateType=="edit"){const{data:b,error:l}=await xa(N.value.map(u=>({...u,eqmid:Ht()})));l||((h=(p=window.$message)==null?void 0:p.success)==null||h.call(p,"添加成功"),X(),ee("submitted"))}else ee("submittedData",N.value.map(b=>({...b,eqmid:Ht()})))}const me=async n=>{},ke=y(!1),De=y(!0),de=async n=>{console.log(n);const v=n.target;v.scrollHeight-v.scrollTop-v.clientHeight<10&&!ke.value&&De.value&&(ke.value=!0,Ae(),H.value=ze.data.map(r=>({label:r.devname,value:r.id})),ke.value=!1)},le=y(!1),M=y(),xe=(n,v)=>{G.value=[],le.value=!0,M.value=v,n.re1&&G.value.push({id:"",name:n.re1,url:n.fl1,status:"uploading",progress:0}),n.re2&&G.value.push({id:"",name:n.re2,url:n.fl2,status:!1,progress:0}),n.re3&&G.value.push({id:"",name:n.re3,url:n.fl3,status:!1,progress:0}),n.re4&&G.value.push({id:"",name:n.re4,url:n.fl4,status:!1,progress:0})},Te=[{title:"文件名称",key:"filename",align:"center",render(n){if(!n.url){const v=async({file:r,onFinish:p,onError:h})=>{var b,l;try{n.status=!0;const u=await mt(r.file,r.name,"",g=>{n.progress=g});u&&(n.url=u,n.name=r.name,n.status=!1)}catch(u){console.error(u),(l=(b=window.$message)==null?void 0:b.error)==null||l.call(b,"文件上传出错"),n.status=!1}};async function F(r){var p;return r.file.file.size>100*1024*1024?((p=window.$message)==null||p.error("文件大小不能超过100M"),!1):!0}return a("div",{style:"display: flex; justify-content: center; align-items: center;"},[a(vt,{action:"#",showFileList:!1,customRequest:v,onBeforeUpload:F},{default:()=>a(C,{type:"info",size:"small",ghost:!0,loading:n.status},{default:()=>"上传文件"})}),n.progress?a(it,{type:"line",percentage:n.progress,indicatorPlacement:"inside",processing:!0}):null])}return n.url&&!n.id?i("span",null,[n.url.split("?")[1],w(" "),i("span",{onClick:()=>n.url="",style:"color: red;cursor: pointer;font-size: 12px;"},[w("删除")])]):a("div",{},n.url.split("?")[1])}},{title:"文件别名",key:"name",align:"center",render(n){return a(Q,{value:n.name,onUpdateValue:v=>{n.name=v}})}},{title:"操作",key:"actions",align:"center",width:100,render(n){return a(ye,{justify:"center"},[a(C,{type:"error",size:"small",ghost:!0,onClick:()=>{G.value=G.value.filter(v=>v!==n)}},{default:()=>"删除"})])}}],G=y([]),I=()=>{var n,v;if(G.value.length>=4)return(v=(n=window.$message)==null?void 0:n.warning)==null?void 0:v.call(n,"最多上传4个文件");G.value.push({id:"",name:"",url:"",status:!1,setStatus:!0})},ne=async()=>{G.value.forEach(async(n,v)=>{N.value[M.value][`re${v+1}`]=n.name,N.value[M.value][`fl${v+1}`]=n.url}),le.value=!1,M.value=void 0},ce=()=>{le.value=!1};return(n,v)=>{const F=Tt,r=Ze,p=_t,h=Ut;return $(),A(He,null,[i(p,{show:m.value,"onUpdate:show":v[1]||(v[1]=b=>m.value=b),title:"新增待调试设备",preset:"card",class:"w-80% h-70vh","mask-closable":!1,draggable:!0},{footer:d(()=>[i(_(ye),{justify:"end",size:16},{default:d(()=>[i(_(C),{onClick:X},{default:d(()=>[w(K(_(W)("common.cancel")),1)]),_:1}),i(_(C),{type:"primary",onClick:Ne},{default:d(()=>[w(K(_(W)("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[i(F,{label:"合同设备","label-placement":"left"},{default:d(()=>[i(_(Jt),{value:c.value,"onUpdate:value":[v[0]||(v[0]=b=>c.value=b),ve],placeholder:"请选择合同设备",options:_e.value,"check-strategy":"child","show-path":!1,labelKey:"label",remote:"",multiple:"","on-load":Fe,"onUpdate:show":me},null,8,["value","options"])]),_:1}),i(r,{style:{width:"100%"},columns:re,data:N.value,size:"small","row-key":b=>b.id,striped:"","scroll-x":re.reduce((b,l)=>b+l.width,0),"max-height":350},null,8,["data","row-key","scroll-x"])]),_:1},8,["show"]),i(p,{show:le.value,"onUpdate:show":v[2]||(v[2]=b=>le.value=b),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:d(()=>v[3]||(v[3]=[w(" 待调试设备文件列表 ")])),footer:d(()=>[i(_(ye),{justify:"end"},{default:d(()=>[i(_(C),{size:"small",class:"mt-16px",onClick:ce},{default:d(()=>[w(K(_(W)("common.cancel")),1)]),_:1}),i(_(C),{type:"primary",size:"small",class:"mt-16px",onClick:ne},{default:d(()=>[w(K(_(W)("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[i(_(C),{size:"small",ghost:"",type:"primary",onClick:I},{icon:d(()=>[i(h,{class:"text-icon"})]),default:d(()=>[v[4]||(v[4]=w(" 添加 "))]),_:1,__:[4]}),i(r,{columns:Te,"paginate-single-page":!1,data:G.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])],64)}}}),en={class:"w-100%"},tn={class:"flex"},an={class:"flex-col w-100%"},ln=2,nn=yt({__name:"prjDetail",props:ot({operateType:{}},{prjInfo:{default:()=>({id:void 0,proname:void 0,proaddr:"",prosite:"",longitude:120.373885,latitude:30.303899,proid:null,dtype:null,dispatch:"",status:0,plantime:null,region:null,provice:null})},prjInfoModifiers:{}}),emits:ot(["submit","changePrj"],["update:prjInfo"]),setup(x,{expose:Se,emit:ee}){const J=bt(),be=x,m=Xt(x,"prjInfo"),_e=ee,q=y([]),{pageData:B,getData:H,nextPage:ze}=Ve(J.userInfo.usertype==1?xl:Ya),f=async U=>{const k=U.currentTarget,j=k.scrollTop;k.scrollTop+k.offsetHeight>=k.scrollHeight&&B.data.length<B.total&&(await ze(),q.value=B.data,await Oe(),setTimeout(()=>{k.scrollTop=j}))},Ae=ra.debounce(async U=>{await H({page:1,fuzzy:U}),q.value=B.data},300),Ue=y(!1),Fe=y(!1),Be=U=>{if(m.value.proid=null,Ue.value=!0,Fe.value=!1,!U){ve();return}Ae(U)},Le=async()=>{Ue.value&&!Fe.value&&(await H({page:1}),q.value=B.data,Ue.value=!1)},ve=async()=>{await H({page:1}),q.value=B.data},c=async U=>{await re(U),N.value?m.value.proid=null:m.value.proid=U,_e("changePrj")},N=y(!1),re=async U=>{var P;N.value=!1;const{data:k,error:j}=await kl(U);k&&(N.value=!0,(P=window.$message)==null||P.warning("该项目已存在调试单，请勿重复添加"))},X=y({id:void 0,proname:void 0,proaddr:"",prosite:"",longitude:120.373885,latitude:30.303899,proid:null,dtype:null,dispatch:"",status:0,plantime:null,region:null,provice:null});function Ne(U){return JSON.parse(JSON.stringify(el(U)))}Kt(()=>X.value?JSON.stringify(m.value)!==JSON.stringify(X.value):!1),ka(async()=>{await H({page:1}),q.value=B.data,le(),be.operateType=="edit"&&I(m.value.provice),Oe(()=>{X.value=Ne(m.value)})});const me={status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择提交状态"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择调试类型"},proid:{type:"number",required:!0,trigger:["blur","change"],message:"请选择项目"},prosite:{type:"string",required:!0,trigger:["blur","change","focus"],message:"请输入项目地址"},proaddr:{type:"string",required:!0,trigger:["blur","change","focus"],message:"请输入项目详细地址"},plantime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择计划调试时间"},provice:{type:"number",required:!0,trigger:["blur","change"],message:"请选择省份"},region:{type:"number",required:!0,trigger:["blur","change"],message:"请选择城市"},dispatch:{type:"string",required:!0,trigger:["blur","change"],message:"请输入调度名称"}},{formRef:ke,validate:De}=Yt(),de=y([]),le=async()=>{const{data:U,error:k}=await Ka();U&&(de.value=U)},M=U=>{I(U),m.value.region=null,m.value.proaddr=""},xe=U=>{var j;const k=(j=G.value.find(P=>P.id===U))==null?void 0:j.name;m.value.region&&m.value.prosite&&m.value.proaddr&&!v?(m.value.prosite="",m.value.proaddr=""):Te(k)};function Te(U){!U||!v||!n||v.getLocation(U,(k,j)=>{var P;if(k==="complete"&&((P=j.geocodes)!=null&&P.length)){const{location:$e,formattedAddress:Me}=j.geocodes[0],Je=$e.lng,Re=$e.lat;n.setZoomAndCenter(14,[Je,Re]),b.longitude=Je,b.latitude=Re,m.value.latitude=b.latitude,m.value.longitude=b.longitude,pe(h,{lng:Je,lat:Re}),m.value.proaddr=Me,m.value.prosite=Me,g.value=Me}})}const G=y([]),I=async U=>{var P;if(!U)return(P=window.$message)==null?void 0:P.warning("请先选择省份");const{data:k,error:j}=await Xa({province:U});k&&(G.value=k)},ne=y(!1),ce=y();let n=null,v=null,F=null,r=null,p=null,h=null;const b=Qe({longitude:0,latitude:0});let l;const u=y(!1),g=y(""),S=y([]);let z=0;async function V(){try{if(window._AMapSecurityConfig={securityJsCode:J.userInfo.sdksecret},!ce.value)return;h=await fl.load({key:J.userInfo.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),n=new h.Map(ce.value,{zoom:18,center:[m.value.longitude,m.value.latitude],viewMode:"3D",resizeEnable:!0}),v=new h.Geocoder,r=new h.PlaceSearch({city:"全国",pageSize:50}),p=new h.AutoComplete({city:"全国"}),pe(h,{lng:m.value.longitude,lat:m.value.latitude}),n.on("click",U=>{const{lng:k,lat:j}=U.lnglat;l=2,b.latitude=j,b.longitude=k,pe(h,{lng:k,lat:j})}),z=0,Oe(()=>{window.dispatchEvent(new Event("resize"))})}catch(U){console.error("地图加载失败：",U),z<ln?(z++,console.warn(`地图加载失败，正在第 ${z} 次重试...`),setTimeout(()=>{V()},1500)):console.error("地图加载失败，已达到最大重试次数，停止重试")}}const T=ra.debounce(async U=>{if(!u.value||!U.trim()){S.value=[];return}p.search(U,(k,j)=>{var P;console.log(j,"result"),k=="complete"&&j.info=="OK"&&((P=j==null?void 0:j.tips)!=null&&P.length)?S.value=j.tips.map($e=>({label:`${$e.name}（${$e.district||$e.address||"无详细地址"}）`,value:`${$e.location.lng}_${$e.location.lat}`,raw:$e})):S.value=[]})},300);Zt(g,U=>{T(U)});function Y(U,k){if(console.log(U,k,"option"),!U)return;const[j,P]=U.split("_").map(Number);!j||!P||(n.setCenter([j,P]),l=1,pe(h,{lng:j,lat:P}),b.longitude=j,b.latitude=P)}function te(){ne.value=!0,u.value=!1,l=void 0,Oe(async()=>{await V(),setTimeout(()=>{u.value=!0;const U=document.querySelector(".n-auto-complete input");U==null||U.blur(),console.log(m),m.value.region&&!m.value.prosite&&!m.value.prosite&&xe(m.value.region)},500)})}function pe(U,k){F&&n.remove(F),F=new U.Marker({position:[k.lng,k.lat],map:n}),n.add(F),v.getAddress(k,async(j,P)=>{j==="complete"&&P.regeocode&&(console.log("result",P),console.log("formattedAddress",P.regeocode.formattedAddress),k.latitude=k.lat,k.longitude=k.lng,l==1?m.value.proaddr=P.regeocode.formattedAddress:l==2?(g.value=P.regeocode.formattedAddress,m.value.proaddr=P.regeocode.formattedAddress,m.value.provice=qe(m.value.proaddr,de.value),await I(m.value.provice),m.value.region=ge(m.value.proaddr,G.value)):(g.value=m.value.prosite||P.regeocode.formattedAddress,setTimeout(async()=>{m.value.provice=qe(g.value,de.value),await I(m.value.provice),m.value.region=ge(g.value,G.value)},300)))})}function qe(U,k){let j=null;for(const P of k)if(U.includes(P.name)){j=P.id;break}return j}function ge(U,k){let j=null;for(const P of k)if(U.includes(P.name)){j=P.id;break}return j}const tt=async()=>{m.value.latitude=b.latitude,m.value.longitude=b.longitude,m.value.prosite=g.value,ne.value=!1};function oe(){ne.value=!1}return Se({validate:De}),(U,k)=>{const j=Ce,P=hl,$e=ht,Me=Q,Je=pl,Re=C,jt=Qa,Pt=ml,Bt=fa,ut=Tt,dt=ye,kt=gl,he=_t;return $(),A(He,null,[i(Bt,{ref_key:"formRef",ref:ke,model:m.value,rules:me,"label-placement":"left","label-width":"120"},{default:d(()=>[i(Pt,{responsive:"screen","item-responsive":"","x-gap":"15"},{default:d(()=>[i(P,{span:"24 s:12 m:9",label:"项目名称",path:"proid"},{default:d(()=>[i(j,{filterable:"",clearable:"",value:m.value.proid,"onUpdate:value":[k[0]||(k[0]=R=>m.value.proid=R),c],placeholder:"请选择项目","label-field":"proname","value-field":"id",disabled:be.operateType=="edit",options:q.value,onScroll:f,onClear:ve,onSearch:Be,onBlur:Le},null,8,["value","disabled","options"])]),_:1}),i(P,{span:"24 s:12 m:5",label:"计划调试时间",path:"plantime"},{default:d(()=>[i($e,{"formatted-value":m.value.plantime,"onUpdate:formattedValue":k[1]||(k[1]=R=>m.value.plantime=R),type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),i(P,{span:"24 s:12 m:5",label:"调试类型",path:"dtype"},{default:d(()=>[i(j,{filterable:"",value:m.value.dtype,"onUpdate:value":k[2]||(k[2]=R=>m.value.dtype=R),placeholder:"请选择调试类型",options:_(Za)(_(vl))},null,8,["value","options"])]),_:1}),i(P,{span:"24 s:12 m:5",label:"提交状态",path:"status"},{default:d(()=>[i(j,{filterable:"",disabled:"",value:m.value.status,"onUpdate:value":k[3]||(k[3]=R=>m.value.status=R),placeholder:"请选择提交状态",options:[{label:"未提交",value:0},{label:"已提交",value:1}]},null,8,["value"])]),_:1}),i(P,{span:"24 s:12 m:8",label:"省份",path:"provice"},{default:d(()=>[i(j,{filterable:"",value:m.value.provice,"onUpdate:value":[k[4]||(k[4]=R=>m.value.provice=R),M],placeholder:"请选择省份","label-field":"name","value-field":"id",options:de.value},null,8,["value","options"])]),_:1}),i(P,{span:"24 s:12 m:8",label:"地区",path:"region"},{default:d(()=>[i(j,{filterable:"",value:m.value.region,"onUpdate:value":[k[5]||(k[5]=R=>m.value.region=R),xe],placeholder:"请选择地区","label-field":"name","value-field":"id",options:G.value},null,8,["value","options"])]),_:1}),i(P,{span:"24 s:12 m:8",label:"调度名称",path:"dispatch"},{default:d(()=>[i(Me,{clearable:"",value:m.value.dispatch,"onUpdate:value":k[6]||(k[6]=R=>m.value.dispatch=R),placeholder:"请输入调度名称"},null,8,["value"])]),_:1}),i(P,{span:"24 s:12 m:12",label:"项目默认地点",path:"prosite"},{default:d(()=>[E("div",en,[E("div",tn,[i(jt,{onClick:k[8]||(k[8]=R=>te())},{default:d(()=>[i(Me,{value:m.value.prosite,"onUpdate:value":k[7]||(k[7]=R=>m.value.prosite=R),placeholder:"请选择项目地点"},null,8,["value"]),i(Re,null,{icon:d(()=>[i(Je,{class:"text-icon"})]),_:1})]),_:1})])])]),_:1}),i(P,{span:"24 s:12 m:12",label:"项目详细地址",path:"proaddr"},{default:d(()=>[i(Me,{type:"textarea",rows:1,clearable:"",value:m.value.proaddr,"onUpdate:value":k[9]||(k[9]=R=>m.value.proaddr=R),placeholder:"请输入项目详细地址"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"]),i(he,{show:ne.value,"onUpdate:show":k[14]||(k[14]=R=>ne.value=R),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:d(()=>[i(dt,{justify:"end",size:16},{default:d(()=>[i(Re,{onClick:oe},{default:d(()=>[w(K(U.$t("common.cancel")),1)]),_:1}),i(Re,{type:"primary",onClick:tt},{default:d(()=>[w(K(U.$t("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[i(dt,null,{default:d(()=>[i(ut,{label:"省份",path:"provice","label-placement":"left","label-width":"70"},{default:d(()=>[i(j,{filterable:"",value:m.value.provice,"onUpdate:value":[k[10]||(k[10]=R=>m.value.provice=R),M],placeholder:"请选择省份","label-field":"name","value-field":"id",options:de.value},null,8,["value","options"])]),_:1}),i(ut,{label:"地区",path:"region","label-placement":"left","label-width":"70"},{default:d(()=>[i(j,{filterable:"",value:m.value.region,"onUpdate:value":[k[11]||(k[11]=R=>m.value.region=R),xe],placeholder:"请选择地区","label-field":"name","value-field":"id",options:G.value},null,8,["value","options"])]),_:1})]),_:1}),u.value?($(),ue(ut,{key:0,label:"项目地址","label-placement":"left"},{default:d(()=>[E("div",an,[i(kt,{value:g.value,"onUpdate:value":[k[12]||(k[12]=R=>g.value=R),_(T)],options:S.value,style:{"margin-bottom":"7px"},placeholder:"请输入地点关键字",clearable:"",onSelect:Y},null,8,["value","options","onUpdate:value"]),i(Me,{type:"textarea",rows:2,clearable:"",value:m.value.proaddr,"onUpdate:value":k[13]||(k[13]=R=>m.value.proaddr=R),placeholder:"请输入详细地址"},null,8,["value"])])]),_:1})):O("",!0),E("div",{ref_key:"domRef",ref:ce,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])],64)}}}),sn={class:"flex justify-center items-center"},rn={class:"font-size-22px font-bold"},on={class:"position-absolute right-80px flex items-center gap-x-20px"},un={class:"flex-col-stretch"},dn={class:"timeline-wrapper"},cn={class:"timeline-layout"},pn={class:"timeline"},gn=["id"],fn={class:"timeline-icon"},vn=["onClick"],mn={class:"flex justify-between"},hn=["onClick"],yn={class:"timeline-rows"},bn={key:0,class:"timeline-content",style:{"padding-left":"80px",position:"relative"}},_n={class:"timeline-icon"},kn=["onClick"],xn=["onClick"],Sn=["id"],Ln={style:{display:"flex","align-items":"center",gap:"10px"}},Dn={key:0},Cn={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Fn={style:{display:"flex","align-items":"center",gap:"10px"}},$n={key:0},wn={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},zn={key:0,style:{height:"20px"}},Un={style:{display:"flex","align-items":"center",gap:"10px"}},Tn={key:0},jn={key:1,style:{width:"100%",display:"flex","justify-content":"center",cursor:"pointer"}},Pn={key:0,style:{height:"20px"}},Bn=yt({name:"projectmanagement_projectdebuggingformdetail",__name:"index",props:{operateType:{},rowData:{}},emits:["return","submit","returnandSub"],setup(x,{emit:Se}){const ee=bt(),J=tl(),be=y(""),m=al(),_e=ll(),q=Qe({debuggedBusinessList:[],developBusinessList:[],needsList:[]});Yt();const B=x,H=Se,ze=()=>{H("return")},f=Qe(Ae());function Ae(){return{id:void 0,proname:void 0,proaddr:"",prosite:"",longitude:120.373885,latitude:30.303899,proid:null,dtype:null,dispatch:"",status:0,plantime:null,region:null,provice:null}}async function Ue(){Object.assign(f,Ae()),pe(),k(),c.value={projectDetail:{},contactList:[],debuggedBusinessList:[],fileList:[],debuggedDevieceList:[]},B.operateType==="edit"&&B.rowData&&(Object.assign(f,B.rowData),await Be(f.proid),Te(),Je()),N(),setTimeout(()=>{_e.replace({path:m.path,query:{}})},100)}const Fe=y(!1),Be=async e=>{if(!e){c.value={projectDetail:{},contactList:[],debuggedBusinessList:[],fileList:[],debuggedDevieceList:[]};return}Fe.value=!0;try{const t=await Promise.allSettled([At(f.id),ut(),me(f.id),Ge(f.id),b(f.id)]);N(),t.forEach((o,s)=>{o.status==="fulfilled"?console.log(`任务 ${s} 成功:`,o):console.warn(`任务 ${s} 失败:`,o.reason)})}catch(t){console.error("意料之外的错误:",t)}finally{Fe.value=!1}},Le=async()=>{const{data:e,error:t}=await _l(f.id);t||Object.assign(f,e)},ve=Qe([{id:"phase1",title:"基本信息",show:!0,tables:[]},{id:"phase2",title:"实施信息",show:!0,tables:[]}]),c=y({projectDetail:{},contactList:[],fileList:[],debuggedDevieceList:[],debuggedBusinessList:[]}),N=()=>{ve[0].tables=[{id:1,name:"项目联系人",type:c.value.contactList.length>0?1:0},{id:2,name:"待调试设备",type:c.value.debuggedDevieceList.length>0?1:0},{id:3,name:"图纸",type:c.value.fileList.length>0?1:0}],ve[1].tables=[{id:1,name:"待调试业务",type:c.value.debuggedBusinessList.length>0?1:0},{id:2,name:"文件",type:pt.value.length>0||St.value.length>0||Lt.value.length>0||Dt.value.length>0||Ct.value.length>0?1:0}]},re=()=>{X.pageSize==1?X.pageSize=20:X.pageSize=1,me(f.id)},X=Qe({page:1,pageSize:1,showSizePicker:!0,fuzzy:"",itemCount:0,pageSizes:[10,20],prefix:()=>`共 ${X.itemCount} 条`,onChange:e=>{X.page=e,me(f.id)},onUpdatePageSize:e=>{X.pageSize=e,X.page=1,me(f.id)}}),Ne=[{title:"对接方",key:"docker",align:"center",render(e,t){return e.setStatus?a(Q,{value:e.docker,placeholder:"请输入",onUpdateValue(o){c.value.contactList[t].docker=o}}):a("div",{},e.docker)}},{title:"姓名",key:"pname",align:"center",render(e,t){return e.setStatus?a(Q,{value:e.pname,placeholder:"请输入",onUpdateValue(o){c.value.contactList[t].pname=o}}):a("div",{},e.pname)}},{title:"联系方式",key:"pcontact",align:"center",render(e,t){return e.setStatus?a(Q,{value:e.pcontact,placeholder:"请输入",onUpdateValue(o){c.value.contactList[t].pcontact=o}}):a("div",{},e.pcontact)}},{title:"备注",key:"proposition",align:"center",render(e,t){return e.setStatus?a(Q,{value:e.proposition,placeholder:"请输入",onUpdateValue(o){c.value.contactList[t].proposition=o}}):a("div",{},e.proposition)}},{title:"操作人",key:"username",align:"center"},{title:"操作时间",key:"dbtime",align:"center",render:e=>e.dbtime?Ee(1,e.dbtime):""},{key:"operate",title:W("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return a("div",{class:"flex-center gap-8px"},[e.setStatus?[Ie("project:Form:Contact:insert")&&a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>le(e)},{default:()=>"保存"}),a(C,{type:"default",ghost:!0,size:"small",onClick:()=>de(e,t)},{default:()=>"取消"}),Ie("project:Form:Contact:delete")&&a(et,{onPositiveClick:async()=>{var o;if(e.id){const{data:s,error:D}=await Dl(e.id);s&&(c.value.contactList.splice(t,1),(o=window.$message)==null||o.success("删除成功"),me(f.id),f.status=0,N())}else c.value.contactList.splice(t,1)}},{default:()=>W("common.confirmDelete"),trigger:()=>a(C,{type:"error",ghost:!0,size:"small"},{default:()=>W("common.delete")})})]:Ie("project:Form:Contact:update")&&a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>De(e)},{default:()=>"编辑"})])}}],me=async e=>{if(!e)return;const{data:t}=await Gt({page:X.page,limit:X.pageSize,pid:e});c.value.contactList=t==null?void 0:t.list,console.log(t.list,"项目联系人"),X.itemCount=t==null?void 0:t.total,c.value.contactList.forEach(o=>{o.setStatus=!1}),q.contactList=JSON.parse(JSON.stringify(c.value.contactList)),ke.value=!1},ke=y(!1),De=e=>{c.value.contactList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus,ke.value=!0},de=(e,t)=>{e.setStatus=!e.setStatus,!e.id&&!ke.value?c.value.contactList.splice(t,1):e.id&&ke.value&&(c.value.contactList=JSON.parse(JSON.stringify(q.contactList)))},le=async e=>{var t,o,s,D,L;if(!e.docker){(t=window.$message)==null||t.warning("请输入对接方");return}if(!e.pname){(o=window.$message)==null||o.warning("请输入联系人姓名");return}if(!e.pcontact){(s=window.$message)==null||s.warning("请输入联系方式");return}if(e.id){const{data:se,error:ie}=await Ll([e]);ie||((D=window.$message)==null||D.success("修改成功"),me(f.id),f.status=0,e.setStatus=!e.setStatus)}else if(B.operateType=="edit"){const{data:se,error:ie}=await Sl([{...e,pid:f.id}]);ie||((L=window.$message)==null||L.success("添加成功"),me(f.id),e.setStatus=!e.setStatus,f.status=0,N())}else e.setStatus=!e.setStatus,ke.value=!1;Je()};function M(){var e;$t.value.includes("1")||$t.value.push("1"),((e=c.value.contactList[0])!=null&&e.pname||c.value.contactList.length==0)&&(c.value.contactList.unshift({pname:"",pcontact:"",proposition:"",setStatus:!0}),ke.value=!1)}const xe=y([]),Te=async()=>{var o;const{data:e,error:t}=await ba({page:1,limit:100,id:f.proid});xe.value=e==null?void 0:e.list.map(s=>({value:s.id,label:s.contractname,isLeaf:!1})),n((o=e==null?void 0:e.list[0])==null?void 0:o.id)},G=y([]),I=y(),{pageData:ne,getData:ce}=Ve(_a),n=async e=>{await ce({pids:e}),I.value=[],G.value=Array.from(new Set([...G.value,...ne.data])),I.value=ne.data.map(t=>({label:t.devname,value:t.id}))},v=async e=>{var t;await n(e.value),e.children=(t=I.value)==null?void 0:t.map(o=>({label:o.label,value:o.value,isLeaf:!0}))},F=()=>{r.pageSize==1?r.pageSize=20:r.pageSize=1,b(f.id)},r=Qe({page:1,pageSize:1,itemCount:0,showSizePicker:!0,fuzzy:"",pageSizes:[10,20],prefix:()=>`共 ${r.itemCount} 条`,onChange:e=>{r.page=e,b(f.id)},onUpdatePageSize:e=>{r.pageSize=e,r.page=1,b(f.id)}}),p=y(),h=[{title:"绑定合同设备",key:"cid",width:220,align:"center",render(e,t){var o,s;return e.setStatus?a(Jt,{style:"width: 200px",value:e.cid,filterable:!0,placeholder:"请选择合同设备",options:xe.value,checkStrategy:"child",showPath:!1,remote:!0,renderSuffix:D=>D.option.hidden?null:D.node,renderLabel:D=>D.hidden?null:D.label,onLoad:v,onUpdateValue(D){var se;c.value.debuggedDevieceList[t].cid=Number(D)||0;const L=(se=G.value)==null?void 0:se.find(ie=>ie.id==D);e.devname=(L==null?void 0:L.devname)||"",e.devnum=(L==null?void 0:L.devcount)||"",e.notes=(L==null?void 0:L.notes)||"",p.value=(L==null?void 0:L.devcount)||0,e.etype=(L==null?void 0:L.devtype)||0,e.devmanu=(L==null?void 0:L.devmanu)||"",e.devmodel=((L==null?void 0:L.devmodel.length)>64?L==null?void 0:L.devname:L==null?void 0:L.devmodel)||"",e.devunit=(L==null?void 0:L.devunit)||""}}):a("div",{},e.devname2||((s=(o=I.value)==null?void 0:o.find(D=>D.value==e.cid))==null?void 0:s.label))}},{title:"设备名称",key:"devname",width:200,align:"center",render(e,t){return e.setStatus?a(Q,{value:e.devname,placeholder:"请输入",onUpdateValue(o){c.value.debuggedDevieceList[t].devname=o}}):a("div",{},e.devname)}},{title:"型号",key:"devmodel",width:100,align:"center",render(e){return a(nl,{tooltipPlacement:"center",style:{maxWidth:"100px"}},{default:()=>e.devmodel||"",tooltip:()=>a("div",{style:{textAlign:"center",padding:"8px",maxWidth:"600px"}},e.devmodel||"")})}},{title:"设备单位",key:"devunit",width:80,align:"center",render(e,t){return a("div",{},e.devunit)}},{title:"数量",key:"devnum",width:100,align:"center",render(e,t){return e.setStatus?a(ya,{value:e.devnum,placeholder:"请输入",max:p.value,onUpdateValue(o){c.value.debuggedDevieceList[t].devnum=o}}):a("div",{},e.devnum)}},{title:"是否为我司设备",key:"etype",width:120,align:"center",render(e,t){return a("div",{},e.etype==0?"是":"否")}},{title:"设备厂家",key:"devmanu",width:100,align:"center",render(e,t){return a("div",{},e.devmanu)}},{title:"厂家联系人",key:"manucontact",width:100,align:"center",render(e,t){return e.setStatus?a(Q,{value:e.manucontact,placeholder:"请输入",onUpdateValue(o){c.value.debuggedDevieceList[t].manucontact=o}}):a("div",{},e.manucontact)}},{title:"厂家联系方式",key:"manuinfo",width:100,align:"center",render(e,t){return e.setStatus?a(Q,{value:e.manuinfo,placeholder:"请输入",onUpdateValue(o){c.value.debuggedDevieceList[t].manuinfo=o}}):a("div",{},e.manuinfo)}},{title:"设备状态",key:"devstatus",width:120,align:"center",render(e,t){return e.setStatus&&e.id?a(Ce,{value:e.devstatus,filterable:!0,placeholder:"请选择",options:[{label:"设备无异常",value:0},{label:"异常",value:1},{label:"未知",value:2}],onUpdateValue(o){c.value.debuggedDevieceList[t].devstatus=Number(o)||0}}):a("div",{},e.devstatus===0?"设备无异常":e.devstatus===1?"异常":"未知")}},{title:"接线方式",key:"connectionmode",width:100,align:"center",render(e,t){return e.setStatus?a(Q,{value:e.connectionmode,placeholder:"请输入",onUpdateValue(o){c.value.debuggedDevieceList[t].connectionmode=o}}):a("div",{},e.connectionmode)}},{title:"是否安装就位",key:"install",width:120,align:"center",render(e,t){return e.setStatus&&e.id?a(Ce,{value:e.install,filterable:!0,placeholder:"请选择",options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(o){c.value.debuggedDevieceList[t].install=Number(o)||0}}):a("div",{},e.install===0?"是":"否")}},{title:"备注",key:"notes",width:100,align:"center",render(e,t){return e.setStatus?a(Q,{value:e.notes,placeholder:"请输入",onUpdateValue(o){c.value.debuggedDevieceList[t].notes=o}}):a("div",{},e.notes)}},{title:"文件",key:"re1",width:100,align:"center",render(e,t){return e.setStatus?a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>ta(e,"debuggedDevieceList",t)},{default:()=>"上传文件"}):a(rt,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const o=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(s=>s.alias||s.file);return o.length===0?a("div",{style:"padding: 10px; color: #999;"},"暂无文件"):a("div",{style:"padding: 10px;"},[a("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[a("thead",[a("tr",[a("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),a("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),a("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),a("tbody",o.map((s,D)=>{var L;return a("tr",[a("td",{style:"text-align:center; padding: 4px 8px;"},s.alias||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},((L=s.file)==null?void 0:L.split("?")[1])||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>aa({url:s.file})},{default:()=>"下载"}))])}))])])}})}},{title:"操作信息",key:"dbtime",width:180,align:"center",render(e,t){return a(rt,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},e.dbtime?Ee(1,e.dbtime):""),default:()=>a("div",{style:"padding: 10px;"},i("div",null,[i("div",null,[w("操作人："),e.username]),i("div",null,[w("操作时间："),e.dbtime]),i("div",null,[w("清点人："),e.dusername]),i("div",null,[w("清点时间："),e.ddbtime])]))})}},{key:"operate",title:W("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return a("div",{class:"flex-center gap-8px"},[e.setStatus?[a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>S(e)},{default:()=>"保存"}),a(C,{type:"default",ghost:!0,size:"small",onClick:()=>g(e,t)},{default:()=>"取消"}),Ie("project:Form:Equipment:delete")&&a(et,{onPositiveClick:async()=>{var o,s;if(e.id){const{data:D,error:L}=await Fl(e.id);D&&(c.value.debuggedDevieceList.splice(t,1),(o=window.$message)==null||o.success("删除成功"),f.status=0,b(f.id),N())}else{if(c.value.debuggedBusinessList.some(L=>L.eqmid==e.eqmid))return(s=window.$message)==null?void 0:s.error("该设备在待调试业务中已绑定，请先解除绑定后在删除！");c.value.debuggedDevieceList.splice(t,1)}}},{default:()=>W("common.confirmDelete"),trigger:()=>a(C,{type:"error",ghost:!0,size:"small"},{default:()=>W("common.delete")})})]:Ie("project:Form:Equipment:update")&&a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>u(e)},{default:()=>"编辑"})])}}],b=async e=>{if(!e)return;const{data:t}=await Wt({page:r.page,limit:r.pageSize,fuzzy:r.fuzzy,pid:e});c.value.debuggedDevieceList=t.list,r.itemCount=t.total,c.value.debuggedDevieceList.forEach(o=>{o.setStatus=!1}),q.debuggedDevieceList=JSON.parse(JSON.stringify(c.value.debuggedDevieceList)),l.value=!1,N()},l=y(!1),u=async e=>{console.log(ne.data,e.cid,"ssssssssssssssss"),c.value.debuggedDevieceList.forEach(s=>{s.setStatus=!1});const{data:t,error:o}=await sl(e.cid);o||(xe.value[xe.value.length-1].value!=t.id&&xe.value.push({value:t.id,label:t.devname,disabled:!0,isLeaf:!0,hidden:!0}),p.value=t.devcount||0),l.value=!0,e.setStatus=!e.setStatus},g=(e,t)=>{e.setStatus=!e.setStatus,!e.id&&!l.value?c.value.debuggedDevieceList.splice(t,1):e.id&&l.value&&(c.value.debuggedDevieceList=JSON.parse(JSON.stringify(q.debuggedDevieceList)))},S=async e=>{var t,o,s,D,L,se;if(!e.cid){(t=window.$message)==null||t.warning("请选择合同设备");return}if(!e.devname){(o=window.$message)==null||o.warning("设备名称不能为空");return}if(!e.devmodel){(s=window.$message)==null||s.warning("设备型号不能为空");return}if(!e.devnum){(D=window.$message)==null||D.warning("设备数量不能为空");return}if(e.id&&B.operateType=="edit"){const{data:ie,error:fe}=await Cl([e]);fe||((L=window.$message)==null||L.success("修改成功"),b(f.id),f.status=0,e.setStatus=!e.setStatus)}else if(B.operateType=="edit"){const{data:ie,error:fe}=await xa([{...e,pid:f.id}]);fe||((se=window.$message)==null||se.success("添加成功"),b(f.id),f.status=0,e.setStatus=!e.setStatus,N())}else e.id?e.id:Ht(),e.setStatus=!e.setStatus,l.value=!1},z=y(!1);function V(){z.value=!0}const{pageData:T,getData:Y,nextPage:te}=Ve(ha),pe=async()=>{await Y({usertypes:"2,3"})},qe=async e=>{const t=e.currentTarget,o=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&T.data.length<T.total&&(await te(),await Oe(),setTimeout(()=>{t.scrollTop=o}))},{pageData:ge,getData:tt,nextPage:oe}=Ve(ma),U=async e=>{const t=e.currentTarget,o=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&ge.data.length<ge.total&&(await oe(),await Oe(),setTimeout(()=>{t.scrollTop=o}))},k=async()=>{await tt(),ge.data=ge.data.map(e=>(e.name=`${e.weight}  `+e.tname,e))},{pageData:j,getData:P,nextPage:$e}=Ve(Gt),Me=async e=>{const t=e.currentTarget,o=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&j.data.length<j.total&&(await $e(),j.data=j.data.map(s=>({...s,value:s.docker+"&id="+s.id})),await Oe(),setTimeout(()=>{t.scrollTop=o}))},Je=async()=>{await P({pid:f.id}),j.data=j.data.map(e=>({...e,value:e.docker+"&id="+e.id}))},{pageData:Re,getData:jt,nextPage:Pt}=Ve(Wt),Bt=async e=>{const t=e.currentTarget,o=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&ge.data.length<ge.total&&(await Pt(),await Oe(),setTimeout(()=>{t.scrollTop=o}))},ut=async()=>{f.id&&await jt({pid:f.id})},dt=y(),kt=[{title:"权重",key:"dtype",width:180,align:"center",render(e,t){var o;return e.setStatus?a(Ce,{value:e.dtype,filterable:!0,placeholder:"请选择权重",options:ge.data,labelField:"tname",valueField:"id",onUpdateValue(s){var D;c.value.debuggedBusinessList[t].dtype=Number(s)||0,c.value.debuggedBusinessList[t].debugname=((D=ge.data.find(L=>L.id==s))==null?void 0:D.tname)||""},onScroll(s){U(s)}}):a("div",{},e.tname||((o=ge.data.find(s=>s.id==e.dtype))==null?void 0:o.tname))}},{title:"业务名称",key:"debugname",width:180,align:"center",render(e,t){return e.setStatus?a(Q,{value:e.debugname,placeholder:"请输入业务名称",onUpdateValue(o){c.value.debuggedBusinessList[t].debugname=o}}):a("div",{},e.debugname)}},{key:"eqmname",title:"调试设备",align:"center",width:150,render(e,t){var o;return e.setStatus?a(Ce,{value:e.eqmid,placeholder:"请选择调试设备",options:B.operateType=="edit"?Re.data:c.value.debuggedDevieceList,onscroll:Bt,labelField:"devname",valueField:"id",clearable:!0,filterable:!0,onUpdateValue(s){c.value.debuggedBusinessList[t].eqmid=s}}):a("div",{},e.eqmname||((o=c.value.debuggedDevieceList.find(s=>s.eqmid==e.eqmid))==null?void 0:o.devname))}},{title:"调试人",key:"dbcreater",width:120,align:"center",render(e,t){var o;return e.setStatus?a(Ce,{value:e.dbcreater,filterable:!0,placeholder:"请选择调试人",options:T.data,labelField:"username",valueField:"id",onUpdateValue(s){c.value.debuggedBusinessList[t].dbcreater=s||0},onScroll(s){qe(s)}}):a("div",{},e.dbusername||((o=T.data.find(s=>s.id==e.dbcreater))==null?void 0:o.username))}},{title:"对接方",key:"docker",width:120,align:"center",render(e,t){var o;return e.setStatus?a(Ce,{value:e.docker,placeholder:"请输入或选择对接方",options:B.operateType=="edit"?j.data:c.value.contactList,onscroll:Me,labelField:"docker",valueField:"value",clearable:!0,filterable:!0,tag:!0,onClear(){e.dockcharge="",e.dockcontact=""},onUpdateValue(s){var ie;c.value.debuggedBusinessList[t].docker=s;const[D,L]=(ie=e.docker)==null?void 0:ie.split("&id="),se=j.data.find(fe=>fe.docker===D&&fe.id===Number(L));se?(e.dockcharge=se.pname,e.dockcontact=se.pcontact):(e.dockcharge="",e.dockcontact="")}}):a("div",{},(o=e.docker)==null?void 0:o.split("&id=")[0])}},{title:"对接方负责人",key:"dockcharge",width:100,align:"center",render(e,t){return e.setStatus?a(Q,{value:e.dockcharge,placeholder:"请输入对接方负责人",onUpdateValue(o){c.value.debuggedBusinessList[t].dockcharge=o}}):a("div",{},e.dockcharge)}},{title:"联系方式",key:"dockcontact",width:140,align:"center",render(e,t){return e.setStatus?a(Q,{value:e.dockcontact,placeholder:"请输入联系方式",onUpdateValue(o){c.value.debuggedBusinessList[t].dockcontact=o}}):a("div",{},e.dockcontact)}},{title:"文件",key:"re1",width:80,align:"center",render(e,t){return e.setStatus?a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>ta(e,"debuggedBusinessList",t)},{default:()=>"上传文件"}):a(rt,{trigger:"hover"},{trigger:()=>a("div",{style:"color: #1890ff;cursor: pointer;"},"文件列表"),default:()=>{const o=[{alias:e.re1,file:e.fl1},{alias:e.re2,file:e.fl2},{alias:e.re3,file:e.fl3},{alias:e.re4,file:e.fl4}].filter(s=>s.alias||s.file);return o.length===0?a("div",{style:"padding: 10px; color: #999;"},"暂无文件"):a("div",{style:"padding: 10px;"},[a("table",{class:"n-table n-table--bordered n-table--single-line",style:"width: 100%; border-collapse: collapse;"},[a("thead",[a("tr",[a("th",{style:"text-align:center; padding: 4px 8px;"},"文件别名"),a("th",{style:"text-align:center; padding: 4px 8px;"},"文件"),a("th",{style:"text-align:center; padding: 4px 8px;"},"操作")])]),a("tbody",o.map((s,D)=>{var L;return a("tr",[a("td",{style:"text-align:center; padding: 4px 8px;"},s.alias||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},((L=s.file)==null?void 0:L.split("?")[1])||"-"),a("td",{style:"text-align:center; padding: 4px 8px;"},a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>aa({url:s.file})},{default:()=>"下载"}))])}))])])}})}},{title:"备注",key:"notes",width:120,align:"center",render(e,t){return e.setStatus?a(Q,{value:e.notes,placeholder:"请输入备注",onUpdateValue(o){c.value.debuggedBusinessList[t].notes=o}}):a("div",{},e.notes)}},{title:"计划开始时间",key:"starttime",width:140,align:"center",render(e,t){return e.setStatus?a(ht,{type:"date",clearable:!0,value:e.starttime,valueFormat:"yyyy-MM-dd",placeholder:"请选择",onUpdateValue(o){c.value.debuggedBusinessList[t].starttime=o}}):a("div",e.starttime?Ee(0,e.starttime):"")}},{title:"计划结束时间",key:"endtime",width:140,align:"center",render:(e,t)=>e.setStatus?a(ht,{type:"date",clearable:!0,valueFormat:"yyyy-MM-dd",value:e.endtime,placeholder:"请选择",onUpdateValue(o){c.value.debuggedBusinessList[t].endtime=o}}):e.endtime?Ee(0,e.endtime):""},{key:"username",title:"创建信息",align:"left",width:240,render(e){return i("div",{style:"display:flex; flex-direction:column; gap:3px; line-height:1.4;"},[i("div",null,[i("span",{style:"color:#666"},[w("创建人：")]),i("span",null,[e.username||"-"])]),i("div",null,[i("span",{style:"color:#666"},[w("时间：")]),i("span",null,[e.dbtime||"-"])])])}},{key:"operate",title:W("common.operate"),align:"center",width:280,fixed:"right",render(e,t){return a("div",{class:"flex-center gap-8px"},[e.setStatus?[Ie("project:Form:Debug:insert")&&a(et,{onPositiveClick:()=>{Ca(e)}},{default:()=>"是否确认保存？",trigger:()=>a(C,{type:"info",ghost:!0,size:"small"},{default:()=>"保存"})}),a(C,{type:"default",ghost:!0,size:"small",onClick:()=>Da(e,t)},{default:()=>"取消"}),Ie("project:Form:Debug:delete")&&a(et,{onPositiveClick:async()=>{var o;if(e.id){const{data:s,error:D}=await zl(e.id);s&&(c.value.debuggedBusinessList.splice(t,1),(o=window.$message)==null||o.success("删除成功"),Ge(f.id),f.status=0,N())}else c.value.debuggedBusinessList.splice(t,1)}},{default:()=>W("common.confirmDelete"),trigger:()=>a(C,{type:"error",ghost:!0,size:"small"},{default:()=>W("common.delete")})})]:Ie("project:Form:Debug:update")&&a(C,{type:"primary",ghost:!0,size:"small",onClick:()=>La(e)},{default:()=>"编辑"})])}}],he=Qe({page:1,pageSize:1,showSizePicker:!0,itemCount:0,creater:"",pageSizes:[10,20],prefix:()=>`共 ${he.itemCount} 条`,onChange:e=>{he.page=e,Ge(f.id)},onUpdatePageSize:e=>{he.pageSize=e,he.page=1,Ge(f.id)}}),R=()=>{he.pageSize==1?he.pageSize=20:he.pageSize=1,Ge(f.id)},Ge=async e=>{if(!e)return;const{data:t}=await $l({page:he.page,limit:he.pageSize,creater:ee.userInfo.id,pid:e});c.value.debuggedBusinessList=t.list,he.itemCount=t.total,c.value.debuggedBusinessList.forEach(o=>{o.setStatus=!1}),q.debuggedBusinessList=JSON.parse(JSON.stringify(c.value.debuggedBusinessList)),ct.value=!1},ct=y(!1),La=e=>{e.starttime=oa(e.starttime),e.endtime=oa(e.endtime),dt.value=e.status,c.value.debuggedBusinessList.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus,ct.value=!0},Da=(e,t)=>{e.setStatus=!e.setStatus,!e.id&&!ct.value?c.value.debuggedBusinessList.splice(t,1):e.id&&ct.value&&(c.value.debuggedBusinessList=JSON.parse(JSON.stringify(q.debuggedBusinessList)))},Ca=async e=>{var s,D,L,se,ie,fe,Ye,Ke,ft,wt;if(!e.dtype){(s=window.$message)==null||s.warning("请选择权重");return}if(!e.debugname){(D=window.$message)==null||D.warning("请输入业务名称");return}if(!e.docker){(L=window.$message)==null||L.warning("请选择或输入对接方");return}if(!e.dockcharge){(se=window.$message)==null||se.warning("请输入对接方负责人");return}if(!e.dockcontact){(ie=window.$message)==null||ie.warning("请输入对接方联系方式");return}if(!e.dbcreater){(fe=window.$message)==null||fe.warning("请选择调试人");return}const t=Ee(0,e.starttime),o=Ee(0,e.endtime);if(e.id){const Xe=JSON.parse(JSON.stringify(e));dt.value==Xe.status&&delete Xe.status,Xe.docker=(Ye=Xe.docker)==null?void 0:Ye.split("&id=")[0];const{data:at,error:It}=await wl([{...Xe,starttime:t,endtime:o}]);It||((Ke=window.$message)==null||Ke.success("修改成功"),Ge(f.id),f.status=0,e.setStatus=!e.setStatus)}else if(B.operateType=="edit"){e.docker=(ft=e.docker)==null?void 0:ft.split("&id=")[0];const{data:Xe,error:at}=await Sa([{...e,starttime:t,endtime:o,pid:f.id}]);at||((wt=window.$message)==null||wt.success("添加成功"),Ge(f.id),e.setStatus=!e.setStatus,f.status=0,N())}else e.setStatus=!e.setStatus,ct.value=!1},xt=y(!1);function Fa(){xt.value=!0}const $a=()=>{const e=document.getElementById("__SCROLL_EL_ID__");e==null||e.scrollTo({top:0,behavior:"smooth"})},Qt=e=>{ve[e].show=!ve[e].show},Nt=e=>{const t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth",block:"start"}),be.value=e)},Et=()=>{const e=[];ve.forEach(s=>{s.tables.forEach((D,L)=>e.push(`${s.id}-${L}`))});const t=window.scrollY;let o="";for(const s of e){const D=document.getElementById(s);D&&D.offsetTop-100<=t&&(o=s)}be.value=o},pt=y([]),St=y([]),Lt=y([]),Dt=y([]),Ct=y([]),Vt=y([]),ea=y({});async function At(e){const{data:t,error:o}=await Ul({limit:100,page:1,pid:e});o||(c.value.fileList=[],pt.value=[],St.value=[],Lt.value=[],Dt.value=[],Ct.value=[],Vt.value=[],ea.value=t,console.log("data",ea.value),t.list.forEach(s=>{s.sort==1&&c.value.fileList.push({id:s.id,name:s.filename,url:s.file.split("?")[0],filename:s.file.split("?")[1],status:"finished",creator:s.username,dbtime:s.dbtime}),s.sort==2&&pt.value.push({id:s.id,name:s.filename,url:s.file.split("?")[0],filename:s.file.split("?")[1],status:"finished",creator:s.username,dbtime:s.dbtime}),s.sort==3&&St.value.push({id:s.id,name:s.filename,url:s.file.split("?")[0],filename:s.file.split("?")[1],status:"finished",creator:s.username,dbtime:s.dbtime}),s.sort==4&&Lt.value.push({id:s.id,name:s.filename,url:s.file.split("?")[0],filename:s.file.split("?")[1],status:"finished",creator:s.username,dbtime:s.dbtime}),s.sort==5&&Dt.value.push({id:s.id,name:s.filename,url:s.file.split("?")[0],filename:s.file.split("?")[1],status:"finished",creator:s.username,dbtime:s.dbtime}),s.sort==6&&Ct.value.push({id:s.id,name:s.filename,url:s.file.split("?")[0],filename:s.file.split("?")[1],status:"finished",creator:s.username,dbtime:s.dbtime}),s.sort==7&&Vt.value.push({id:s.id,name:s.filename,url:s.file.split("?")[0],filename:s.file.split("?")[1],status:"finished",creator:s.username,dbtime:s.dbtime})}),c.value.fileList.reverse(),pt.value.reverse(),St.value.reverse(),Lt.value.reverse(),Dt.value.reverse(),Ct.value.reverse(),Vt.value.reverse(),N())}const wa=e=>{const t=e.target,o=document.getElementById("__SCROLL_EL_ID__"),s=document.getElementById("scrollToTop");!o||!s||(t.scrollTop>(o.clientHeight||0)+500?s.classList.add("show"):s.classList.remove("show"))},gt=y(!1),We=y(""),Ft=y(),ta=(e,t,o)=>{je.value=[],gt.value=!0,We.value=t,Ft.value=o,e.re1&&je.value.push({id:"",name:e.re1,url:e.fl1,status:"uploading",setStatus:!1,progress:0}),e.re2&&je.value.push({id:"",name:e.re2,url:e.fl2,status:"uploading",setStatus:!1,progress:0}),e.re3&&je.value.push({id:"",name:e.re3,url:e.fl3,status:"uploading",setStatus:!1,progress:0}),e.re4&&je.value.push({id:"",name:e.re4,url:e.fl4,status:"uploading",setStatus:!1,progress:0})},za=[{title:"文件名称",key:"filename",align:"center",render(e){if(!e.url){const t=async({file:s,onFinish:D,onError:L})=>{var se,ie;try{e.status=!0;const fe=await mt(s.file,s.name,"",Ye=>{e.progress=Ye});fe&&(e.url=fe,e.name=s.name,e.status=!1)}catch(fe){console.error(fe),(ie=(se=window.$message)==null?void 0:se.error)==null||ie.call(se,"文件上传出错"),e.status=!1}};async function o(s){var D;return s.file.file.size>100*1024*1024?((D=window.$message)==null||D.error("文件大小不能超过100M"),!1):!0}return a("div",{style:"display: flex; justify-content: center; align-items: center;"},[a(vt,{action:"#",showFileList:!1,customRequest:t,onBeforeUpload:o},{default:()=>a(C,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})}),e.progress?a(it,{type:"line",percentage:e.progress,indicatorPlacement:"inside",processing:!0}):null])}return e.url&&!e.id?i("span",null,[e.url.split("?")[1],w(" "),i("span",{onClick:()=>{e.url="",e.progress=0,e.status=!1},style:"color: red;cursor: pointer;font-size: 12px;"},[w("删除")])]):a("div",{},e.url.split("?")[1])}},{title:"文件别名",key:"name",align:"center",render(e){return a(Q,{value:e.name,onUpdateValue:t=>{e.name=t}})}},{title:"操作",key:"actions",align:"center",width:100,render(e){return a(ye,{justify:"center"},[a(C,{type:"error",size:"small",ghost:!0,onClick:()=>{je.value=je.value.filter(t=>t!==e)}},{default:()=>"删除"})])}}],je=y([]),Ua=()=>{var e,t;if(je.value.length>=4)return(t=(e=window.$message)==null?void 0:e.warning)==null?void 0:t.call(e,"最多上传4个文件");je.value.push({id:"",name:"",url:"",status:!1,setStatus:!0,progress:0})};async function aa(e){if(e!=null&&e.url)try{const o=await(await fetch(e.url.split("?")[0],{mode:"cors"})).blob(),s=URL.createObjectURL(o),D=document.createElement("a");D.href=s,D.download=e.url.split("?")[1],D.style.display="none",document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(s)}catch(t){console.error("下载失败:",t)}}const Ta=async()=>{var t,o;let e=!0;for(let s=0;s<je.value.length;s++){const D=je.value[s];if(!D.url){(t=window.$message)==null||t.warning(`第${s+1}个文件的文件名称不能为空`),e=!1;break}if(!D.name){(o=window.$message)==null||o.warning(`第${s+1}个文件的文件别名不能为空`),e=!1;break}c.value[We.value][Ft.value][`re${s+1}`]=D.name,c.value[We.value][Ft.value][`fl${s+1}`]=D.url}e&&(gt.value=!1,We.value="",Ft.value=void 0)},ja=()=>{gt.value=!1};ka(async()=>{Ue(),m.query.IsScroll&&setTimeout(()=>{Nt("phase2-0")},800),window.addEventListener("scroll",Et);const e=document.getElementById("__SCROLL_EL_ID__");e&&e.addEventListener("scroll",wa)}),il(()=>{window.removeEventListener("scroll",Et);const e=document.getElementById("__SCROLL_EL_ID__");e&&e.removeEventListener("scroll",Et)});const $t=y(["1","2","3"]),Pa=e=>{$t.value=e},la=y(["1","2","3","4"]),Ba=e=>{la.value=e},Na=Kt(()=>({add:"新增项目调试单",edit:"修改项目调试单"})[B.operateType]),Ea=e=>{c.value.debuggedDevieceList=c.value.debuggedDevieceList.concat(e).map(t=>({...t,cid:t.cid*1,setStatus:!1})),z.value=!1},Va=e=>{c.value.debuggedBusinessList=c.value.debuggedBusinessList.concat(e).map(t=>({...t,setStatus:!1})),xt.value=!1},na=e=>{c.value.fileList=c.value.fileList.concat(e).map(t=>({...t}))},Mt=y();async function Aa(e=0){var t;await Mt.value[0].validate(),(t=window.$dialog)==null||t.info({title:"提示",content:"确定保存并提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await sa(e)}})}async function sa(e=0){var t,o;if(await Mt.value[0].validate(),B.operateType==="edit"){const s=JSON.parse(JSON.stringify(e==1?{...f,status:e}:{...f})),{data:D,error:L}=await bl([s]);L||((t=window.$message)==null||t.success("保存成功"),H("returnandSub"))}else{const s=e==1?{...f,status:e}:{...f},{data:D,error:L}=await yl({projectFormPojo:s,projectFormContactPojoList:c.value.contactList,projectFormDebugPojos:c.value.debuggedBusinessList,projectFormEquipmentPojoList:c.value.debuggedDevieceList,projectFormFilePojos:c.value.fileList});D&&((o=window.$message)==null||o.success(D||"添加成功"),H("returnandSub"))}}return(e,t)=>{const o=Ml,s=El,D=rl,L=qa,se=Ra,ie=Ut,fe=ca,Ye=pa,Ke=Ja,ft=Ha,wt=_t,Xe=cl,at=Rt("no-auth"),It=Rt("loading");return $(),A(He,null,[i(D,{bordered:!1,size:"small",class:"card-wrapper"},{default:d(()=>[E("div",sn,[E("h2",rn,K(Na.value),1),E("div",on,[i(_(C),{ghost:"",type:"primary",onClick:zt(ze,["stop"])},{icon:d(()=>[i(o,{class:"text-icon"})]),default:d(()=>[t[14]||(t[14]=w(" 返回 "))]),_:1,__:[14]}),i(_(C),{type:"primary",onClick:t[0]||(t[0]=we=>sa())},{icon:d(()=>[i(s,{class:"text-icon"})]),default:d(()=>[t[15]||(t[15]=w(" "+K("保存")))]),_:1,__:[15]}),f.status==0?($(),ue(_(C),{key:0,type:"primary",onClick:t[1]||(t[1]=we=>Aa(1))},{icon:d(()=>[i(s,{class:"text-icon"})]),default:d(()=>[t[16]||(t[16]=w(" "+K("保存并提交")))]),_:1,__:[16]})):O("",!0)])])]),_:1}),i(Xe,{style:{height:"calc(100vh - 182px)"}},{default:d(()=>[st(($(),A("div",un,[E("div",{id:"scrollToTop",onClick:$a,title:"回到顶部"},[i(L,{class:"font-size-30px"})]),i(D,{bordered:!1,size:"small",class:"card-wrapper pb-40px"},{default:d(()=>[E("div",dn,[E("div",cn,[E("div",pn,[($(!0),A(He,null,ua(ve,(we,lt)=>($(),A("div",{key:we.id,class:"timeline-phase"},[E("div",{class:"timeline-row",id:"phase"+(lt+1)},[E("div",fn,[t[17]||(t[17]=E("div",{class:"vertical-line"},null,-1)),E("div",{class:"flashing-icon",onClick:Pe=>Qt(lt)},null,8,vn)]),E("div",mn,[E("div",{class:"phase-title",onClick:Pe=>Qt(lt)},K(we.title),9,hn),i(_(ye))])],8,gn),i(ol,{name:"fade"},{default:d(()=>[st(E("div",yn,[lt===0?($(),A("div",bn,[i(nn,{ref_for:!0,ref_key:"prjDetailRef",ref:Mt,onSubmit:Le,prjInfo:f,"onUpdate:prjInfo":t[2]||(t[2]=Pe=>f=Pe),onChangePrj:Te,"operate-type":B.operateType},null,8,["prjInfo","operate-type"])])):O("",!0),($(!0),A(He,null,ua(we.tables,(Pe,nt)=>($(),A("div",{key:`${we.id}-${nt}`,class:"timeline-row"},[E("div",_n,[t[18]||(t[18]=E("div",{class:"vertical-line"},null,-1)),Pe.type==1?($(),A("div",{key:0,class:ul(["icon",{active:be.value===`${we.id}-${nt}`}]),style:{"font-size":"20px",border:"3px solid #409eff",color:"#409eff"},onClick:Z=>Nt(`${we.id}-${nt}`)},[i(se)],10,kn)):($(),A("div",{key:1,class:"icon",style:{"font-size":"20px",border:"3px solid #ccc",color:"#ccc"},onClick:Z=>Nt(`${we.id}-${nt}`)}," 一 ",8,xn))]),E("div",{class:"actProgress",style:qt({background:Pe.type==1?"#409eff":"#ccc"})},null,4),E("div",{class:"timeline-content",id:`${we.id}-${nt}`},[lt===0?($(),A(He,{key:0},[i(ft,{"expanded-names":$t.value,"onUpdate:expandedNames":Pa,"trigger-areas":["arrow"]},{default:d(()=>[Pe.id==1?($(),ue(Ke,{key:0,name:"1"},{header:d(()=>[i(_(ye),{align:"center",justify:"space-between",style:{width:"100%"}},{default:d(()=>[E("div",Ln,[t[20]||(t[20]=E("span",null,"项目联系人",-1)),st(($(),ue(_(C),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:zt(M,["stop"])},{icon:d(()=>[i(ie,{class:"text-icon"})]),default:d(()=>[t[19]||(t[19]=w(" 添加项目联系人 "))]),_:1,__:[19]})),[[at,"project:Form:Contact:insert"]])]),X.itemCount>0?($(),A("div",Dn,"共"+K(X.itemCount)+"条",1)):O("",!0)]),_:1})]),default:d(()=>[c.value.contactList.length>0?($(),ue(_(Ze),{key:0,columns:Ne,data:c.value.contactList,size:"small","scroll-x":702,"row-key":Z=>Z.id,"paginate-single-page":!1,"max-height":350,pagination:X.pageSize==1?!1:X,remote:""},null,8,["data","row-key","pagination"])):O("",!0),X.itemCount>1?($(),A("div",Cn,[c.value.contactList.length==1?($(),A("span",{key:0,onClick:re},[t[21]||(t[21]=w("更多")),i(fe,{class:"font-size-20px"})])):($(),A("span",{key:1,onClick:re},[t[22]||(t[22]=w("收起")),i(Ye,{class:"font-size-20px"})]))])):O("",!0)]),_:1})):O("",!0),Pe.id==2?($(),ue(Ke,{key:1,title:"待调试设备",name:"2"},{header:d(()=>[i(_(ye),{align:"center",justify:"space-between",style:{width:"100%"}},{default:d(()=>[E("div",Fn,[t[24]||(t[24]=E("span",null,"待调试设备",-1)),st(($(),ue(_(C),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:zt(V,["stop"])},{icon:d(()=>[i(ie,{class:"text-icon"})]),default:d(()=>[t[23]||(t[23]=w(" 添加待调试设备 "))]),_:1,__:[23]})),[[at,"project:Equipment:insert"]])]),r.itemCount>0?($(),A("div",$n,"共"+K(r.itemCount)+"条",1)):O("",!0)]),_:1})]),default:d(()=>[i(Ql,{onSubmitted:t[3]||(t[3]=Z=>{b(f.id),f.status=0}),onSubmittedData:t[4]||(t[4]=Z=>Ea(Z)),visible:z.value,"onUpdate:visible":t[5]||(t[5]=Z=>z.value=Z),"operate-type":B.operateType,pid:f.id,proid:f.proid},null,8,["visible","operate-type","pid","proid"]),c.value.debuggedDevieceList.length>0?($(),ue(_(Ze),{key:0,style:qt({width:_(J).siderCollapse?"calc(100vw - 219px)":"calc(100vw - 375px)"}),columns:h,data:c.value.debuggedDevieceList,size:"small","scroll-x":h.reduce((Z,Ot)=>Z+Ot.width,0),"row-key":Z=>Z.id,"max-height":350,pagination:r.pageSize==1?!1:r,remote:"","paginate-single-page":!1},null,8,["style","data","scroll-x","row-key","pagination"])):O("",!0),r.itemCount>1?($(),A("div",wn,[c.value.debuggedDevieceList.length==1?($(),A("span",{key:0,onClick:F},[t[25]||(t[25]=w("更多")),i(fe,{class:"font-size-20px"})])):($(),A("span",{key:1,onClick:F},[t[26]||(t[26]=w("收起")),i(Ye,{class:"font-size-20px"})]))])):O("",!0)]),_:2},1024)):O("",!0),Pe.id==3?($(),ue(Ke,{key:2,title:"图纸",name:"3"},{default:d(()=>[i(da,{data:c.value.fileList,pid:f.id,"operate-type":B.operateType,onGetData:t[6]||(t[6]=Z=>{At(f.id),f.status=0}),typename:"图纸",onSubmittedData:t[7]||(t[7]=Z=>na(Z)),fileType:1},null,8,["data","pid","operate-type"])]),_:1})):O("",!0)]),_:2},1032,["expanded-names"]),Pe==4?($(),A("div",zn)):O("",!0)],64)):O("",!0),lt===1?($(),A(He,{key:1},[i(ft,{"expanded-names":la.value,"onUpdate:expandedNames":Ba,"trigger-areas":["arrow"]},{default:d(()=>[Pe.id==1?($(),ue(Ke,{key:0,title:"待调试业务",name:"1"},{header:d(()=>[i(_(ye),{align:"center",justify:"space-between",style:{width:"100%"}},{default:d(()=>[E("div",Un,[t[28]||(t[28]=E("span",null,[w("待调试业务 "),E("span",{class:"c-#f0a020 font-bold"},"※")],-1)),st(($(),ue(_(C),{size:"small",ghost:"",type:"primary",class:"pos-absolute left-140px",onClick:zt(Fa,["stop"])},{icon:d(()=>[i(ie,{class:"text-icon"})]),default:d(()=>[t[27]||(t[27]=w(" 添加待调试业务 "))]),_:1,__:[27]})),[[at,"project:Debug:insert"]])]),he.itemCount>0?($(),A("div",Tn,"共"+K(he.itemCount)+"条",1)):O("",!0)]),_:1})]),default:d(()=>[i(Zl,{onSubmitted:t[8]||(t[8]=Z=>{Ge(f.id),f.status=0}),visible:xt.value,"onUpdate:visible":t[9]||(t[9]=Z=>xt.value=Z),"operate-type":B.operateType,pid:f.id,contactList:c.value.contactList,debuggedDevieceList:c.value.debuggedDevieceList,onSubmittedData:t[10]||(t[10]=Z=>Va(Z))},null,8,["visible","operate-type","pid","contactList","debuggedDevieceList"]),c.value.debuggedBusinessList.length>0?($(),ue(_(Ze),{key:0,style:qt({width:_(J).siderCollapse?"calc(100vw - 219px)":"calc(100vw - 375px)"}),columns:kt,data:c.value.debuggedBusinessList,size:"small","row-key":Z=>Z.id,striped:"","scroll-x":kt.reduce((Z,Ot)=>Z+Ot.width,0),"paginate-single-page":!1,pagination:he.pageSize==1?!1:he,remote:"","max-height":350},null,8,["style","data","row-key","scroll-x","pagination"])):O("",!0),he.itemCount>1?($(),A("div",jn,[c.value.debuggedBusinessList.length==1?($(),A("span",{key:0,onClick:R},[t[29]||(t[29]=w(" 更多 ")),i(fe,{class:"font-size-20px"})])):($(),A("span",{key:1,onClick:R},[t[30]||(t[30]=w(" 收起 ")),i(Ye,{class:"font-size-20px"})]))])):O("",!0)]),_:1})):O("",!0),Pe.id===2?($(),ue(Ke,{key:1,title:"文件",name:"2"},{default:d(()=>[i(da,{data:pt.value,pid:f.id,onGetData:t[11]||(t[11]=Z=>{At(f.id),f.status=0}),typename:"项目文件",onSubmittedData:t[12]||(t[12]=Z=>na(Z)),"operate-type":B.operateType,fileType:2},null,8,["data","pid","operate-type"])]),_:1})):O("",!0)]),_:2},1032,["expanded-names"]),nt===2?($(),A("div",Pn)):O("",!0)],64)):O("",!0)],8,Sn)]))),128))],512),[[dl,we.show]])]),_:2},1024)]))),128))])])])]),_:1}),i(wt,{show:gt.value,"onUpdate:show":t[13]||(t[13]=we=>gt.value=we),preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{header:d(()=>[w(K(We.value=="debuggedDevieceList"?"待调试设备":We.value=="debuggedBusinessList"?"待调试业务":We.value=="needsList"?"客户需求变更":We.value=="developBusinessList"?"需要开发":"")+" 文件列表 ",1)]),footer:d(()=>[i(_(ye),{justify:"end"},{default:d(()=>[i(_(C),{size:"small",class:"mt-16px",onClick:ja},{default:d(()=>[w(K(_(W)("common.cancel")),1)]),_:1}),i(_(C),{type:"primary",size:"small",class:"mt-16px",onClick:Ta},{default:d(()=>[w(K(_(W)("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[i(_(C),{size:"small",ghost:"",type:"primary",onClick:Ua},{icon:d(()=>[i(ie,{class:"text-icon"})]),default:d(()=>[t[31]||(t[31]=w(" 添加 "))]),_:1,__:[31]}),i(_(Ze),{columns:za,"paginate-single-page":!1,data:je.value,"max-height":350},null,8,["data"])]),_:1},8,["show"])])),[[It,Fe.value]])]),_:1})],64)}}}),Nn=va(Bn,[["__scopeId","data-v-1f37b945"]]),Xn=Object.freeze(Object.defineProperty({__proto__:null,default:Nn},Symbol.toStringTag,{value:"Module"}));export{Yn as a,bl as b,Kn as f,Xn as i,Nn as p};
