import{_ as Ze}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DblglBez.js";import{aB as L,aC as he,aE as oe,aD as fe,bz as _e,bs as Xe,d as pe,aG as Oe,b4 as et,aH as Pe,bb as tt,aM as k,bA as nt,bB as at,bd as ot,bC as it,be as st,bf as lt,b as se,b5 as G,aL as rt,aQ as $e,bD as Te,aN as xe,bE as ct,bF as Le,bG as ut,bH as dt,q as we,v as Ue,s as je,j as W,r as ue,K as Se,o as B,c as le,w as u,g as n,i as c,Z as Fe,aW as pt,L as ze,h as re,t as ce,$ as F,M as Be,a2 as ke,A as Ce,B as Y,E as Ve,D as Ge,ad as He,x as mt,y as Re,N as ie,f as be,e as de,am as ye,ak as ft,aa as Ae,aA as gt,aY as Ke,C as vt,ae as ht,af as _t,a4 as xt,ag as ge,ah as bt}from"./index-7Q9xZuwa.js";import{u as yt,a as wt}from"./table-G6_8Abm0.js";import{_ as St}from"./round-search-BQOA9W6m.js";import{_ as zt}from"./round-refresh-DJiiF7wv.js";import{u as We}from"./usePageData-PYHx9xl8.js";import{b as De,a as kt}from"./common-DPaMBBEl.js";import{f as Ne}from"./multipe-yIOM3_rv.js";import{_ as qe}from"./Cascader-B05gdiL9.js";import{_ as Ct}from"./FormItemGridItem-DYTXkfwP.js";import{_ as Dt}from"./Grid-CRtcNhSF.js";import{a as Nt}from"./basicconf-C0vqpl2m.js";import{m as It,n as Je,o as $t,p as Tt}from"./events-C20QxbUR.js";import{_ as Qe}from"./DataTable-n3fP4Loy.js";import{h as Me}from"./permission-BYoerBbx.js";import{_ as Lt}from"./Popconfirm-BEMrdOuM.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-D8fMBsYv.js";import"./setting-outlined-V9qGIWHT.js";import"./export-oh2-I3ZA.js";import"./refresh-av0Mcmzj.js";import"./round-delete-BZFRn3Yp.js";import"./round-plus-Cy8c1zzO.js";import"./Upload-CwzIyBrH.js";import"./Progress-DAZ1S5w7.js";import"./Forward-BzUEeUAa.js";const Rt=L("steps",`
 width: 100%;
 display: flex;
`,[L("step",`
 position: relative;
 display: flex;
 flex: 1;
 `,[he("disabled","cursor: not-allowed"),he("clickable",`
 cursor: pointer;
 `),oe("&:last-child",[L("step-splitor","display: none;")])]),L("step-splitor",`
 background-color: var(--n-splitor-color);
 margin-top: calc(var(--n-step-header-font-size) / 2);
 height: 1px;
 flex: 1;
 align-self: flex-start;
 margin-left: 12px;
 margin-right: 12px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `),L("step-content","flex: 1;",[L("step-content-header",`
 color: var(--n-header-text-color);
 margin-top: calc(var(--n-indicator-size) / 2 - var(--n-step-header-font-size) / 2);
 line-height: var(--n-step-header-font-size);
 font-size: var(--n-step-header-font-size);
 position: relative;
 display: flex;
 font-weight: var(--n-step-header-font-weight);
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `,[fe("title",`
 white-space: nowrap;
 flex: 0;
 `)]),fe("description",`
 color: var(--n-description-text-color);
 margin-top: 12px;
 margin-left: 9px;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `)]),L("step-indicator",`
 background-color: var(--n-indicator-color);
 box-shadow: 0 0 0 1px var(--n-indicator-border-color);
 height: var(--n-indicator-size);
 width: var(--n-indicator-size);
 border-radius: 50%;
 display: flex;
 align-items: center;
 justify-content: center;
 transition:
 background-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 `,[L("step-indicator-slot",`
 position: relative;
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 font-size: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 `,[fe("index",`
 display: inline-block;
 text-align: center;
 position: absolute;
 left: 0;
 top: 0;
 white-space: nowrap;
 font-size: var(--n-indicator-index-font-size);
 width: var(--n-indicator-icon-size);
 height: var(--n-indicator-icon-size);
 line-height: var(--n-indicator-icon-size);
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[_e()]),L("icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[_e()]),L("base-icon",`
 color: var(--n-indicator-text-color);
 transition: color .3s var(--n-bezier);
 `,[_e()])])]),he("vertical","flex-direction: column;",[Xe("show-description",[oe(">",[L("step","padding-bottom: 8px;")])]),oe(">",[L("step","margin-bottom: 16px;",[oe("&:last-child","margin-bottom: 0;"),oe(">",[L("step-indicator",[oe(">",[L("step-splitor",`
 position: absolute;
 bottom: -8px;
 width: 1px;
 margin: 0 !important;
 left: calc(var(--n-indicator-size) / 2);
 height: calc(100% - var(--n-indicator-size));
 `)])]),L("step-content",[fe("description","margin-top: 8px;")])])])])])]);function At(e,C){return typeof e!="object"||e===null||Array.isArray(e)?null:(e.props||(e.props={}),e.props.internalIndex=C+1,e)}function Mt(e){return e.map((C,d)=>At(C,d))}const Et=Object.assign(Object.assign({},Pe.props),{current:Number,status:{type:String,default:"process"},size:{type:String,default:"medium"},vertical:Boolean,"onUpdate:current":[Function,Array],onUpdateCurrent:[Function,Array]}),Ye=ot("n-steps"),Ot=pe({name:"Steps",props:Et,setup(e,{slots:C}){const{mergedClsPrefixRef:d,mergedRtlRef:D}=Oe(e),p=et("Steps",D,d),_=Pe("Steps","-steps",Rt,it,e,d);return tt(Ye,{props:e,mergedThemeRef:_,mergedClsPrefixRef:d,stepsSlots:C}),{mergedClsPrefix:d,rtlEnabled:p}},render(){const{mergedClsPrefix:e}=this;return k("div",{class:[`${e}-steps`,this.rtlEnabled&&`${e}-steps--rtl`,this.vertical&&`${e}-steps--vertical`]},Mt(nt(at(this))))}}),Pt={status:String,title:String,description:String,disabled:Boolean,internalIndex:{type:Number,default:0}},Ut=pe({name:"Step",props:Pt,setup(e){const C=st(Ye,null);C||lt("step","`n-step` must be placed inside `n-steps`.");const{inlineThemeDisabled:d}=Oe(),{props:D,mergedThemeRef:p,mergedClsPrefixRef:_,stepsSlots:I}=C,A=se(()=>D.vertical),H=se(()=>{const{status:g}=e;if(g)return g;{const{internalIndex:x}=e,{current:$}=D;if($===void 0)return"process";if(x<$)return"finish";if(x===$)return D.status||"process";if(x>$)return"wait"}return"process"}),M=se(()=>{const{value:g}=H,{size:x}=D,{common:{cubicBezierEaseInOut:$},self:{stepHeaderFontWeight:R,[G("stepHeaderFontSize",x)]:O,[G("indicatorIndexFontSize",x)]:P,[G("indicatorSize",x)]:V,[G("indicatorIconSize",x)]:U,[G("indicatorTextColor",g)]:Z,[G("indicatorBorderColor",g)]:q,[G("headerTextColor",g)]:X,[G("splitorColor",g)]:ee,[G("indicatorColor",g)]:te,[G("descriptionTextColor",g)]:K}}=p.value;return{"--n-bezier":$,"--n-description-text-color":K,"--n-header-text-color":X,"--n-indicator-border-color":q,"--n-indicator-color":te,"--n-indicator-icon-size":U,"--n-indicator-index-font-size":P,"--n-indicator-size":V,"--n-indicator-text-color":Z,"--n-splitor-color":ee,"--n-step-header-font-size":O,"--n-step-header-font-weight":R}}),E=d?rt("step",se(()=>{const{value:g}=H,{size:x}=D;return`${g[0]}${x[0]}`}),M,D):void 0,t=se(()=>{if(e.disabled)return;const{onUpdateCurrent:g,"onUpdate:current":x}=D;return g||x?()=>{g&&$e(g,e.internalIndex),x&&$e(x,e.internalIndex)}:void 0});return{stepsSlots:I,mergedClsPrefix:_,vertical:A,mergedStatus:H,handleStepClick:t,cssVars:d?void 0:M,themeClass:E==null?void 0:E.themeClass,onRender:E==null?void 0:E.onRender}},render(){const{mergedClsPrefix:e,onRender:C,handleStepClick:d,disabled:D}=this,p=Te(this.$slots.default,_=>{const I=_||this.description;return I?k("div",{class:`${e}-step-content__description`},I):null});return C==null||C(),k("div",{class:[`${e}-step`,D&&`${e}-step--disabled`,!D&&d&&`${e}-step--clickable`,this.themeClass,p&&`${e}-step--show-description`,`${e}-step--${this.mergedStatus}-status`],style:this.cssVars,onClick:d},k("div",{class:`${e}-step-indicator`},k("div",{class:`${e}-step-indicator-slot`},k(ct,null,{default:()=>Te(this.$slots.icon,_=>{const{mergedStatus:I,stepsSlots:A}=this;return I==="finish"||I==="error"?I==="finish"?k(Le,{clsPrefix:e,key:"finish"},{default:()=>xe(A["finish-icon"],()=>[k(ut,null)])}):I==="error"?k(Le,{clsPrefix:e,key:"error"},{default:()=>xe(A["error-icon"],()=>[k(dt,null)])}):null:_||k("div",{key:this.internalIndex,class:`${e}-step-indicator-slot__index`},this.internalIndex)})})),this.vertical?k("div",{class:`${e}-step-splitor`}):null),k("div",{class:`${e}-step-content`},k("div",{class:`${e}-step-content-header`},k("div",{class:`${e}-step-content-header__title`},xe(this.$slots.title,()=>[this.title])),this.vertical?null:k("div",{class:`${e}-step-splitor`})),p))}}),jt=pe({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:we(["reset","search"],["update:model"]),setup(e,{emit:C}){const d=C,{formRef:D,restoreValidation:p}=Ue(),_=je(e,"model"),I=W();(async()=>{const{data:$,error:R}=await De();R||(I.value=$.map(O=>({...O,id:"-"+O.id,type:O.cname})))})();const{pageData:H,getData:M,nextPage:E}=We(Ne);M(),ue({multipeGroupList:[]});function t(){_.value.fuzzy="",d("search")}async function g(){await p(),d("reset")}async function x(){d("search")}return($,R)=>{const O=qe,P=Ct,V=ke,U=Ce,Z=zt,q=Y,X=St,ee=Ve,te=Dt,K=Ge,y=He,J=Se("no-space");return B(),le(y,{bordered:!1,size:"small",class:"card-wrapper"},{default:u(()=>[n(K,{ref_key:"formRef",ref:D,model:_.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Be(x,["enter"])},{default:u(()=>[n(te,{responsive:"screen","item-responsive":""},{default:u(()=>[n(P,{span:"24 s:12 m:6",label:"日志源设备",path:"lid",class:"pr-24px"},{default:u(()=>[n(O,{value:_.value.lid,"onUpdate:value":[R[0]||(R[0]=T=>_.value.lid=T),x],placeholder:"请选择日志源设备",options:I.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),n(P,{span:"24 s:12 m:6",label:"状态",path:"status",class:"pr-24px"},{default:u(()=>[n(V,{filterable:"",value:_.value.status,"onUpdate:value":[R[1]||(R[1]=T=>_.value.status=T),x],placeholder:"请选择状态",options:c(Fe)(c(pt)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),n(P,{span:"24 s:12 m:6",label:"字段值",path:"fuzzy",class:"pr-24px"},{default:u(()=>[ze(n(U,{clearable:"",value:_.value.fuzzy,"onUpdate:value":R[2]||(R[2]=T=>_.value.fuzzy=T),placeholder:"请输入字段值",onClear:t},null,8,["value"]),[[J]])]),_:1}),n(P,{span:"24 m:4",class:"pr-24px"},{default:u(()=>[n(ee,{class:"w-full"},{default:u(()=>[n(q,{onClick:g},{icon:u(()=>[n(Z,{class:"text-icon"})]),default:u(()=>[re(" "+ce(c(F)("common.reset")),1)]),_:1}),n(q,{type:"primary",ghost:"",onClick:x},{icon:u(()=>[n(X,{class:"text-icon"})]),default:u(()=>[re(" "+ce(c(F)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ft={class:"ml-30px h-100%"},Bt={style:{width:"800px",height:"125px",border:"1px solid #ccc",padding:"8px","white-space":"pre-wrap","user-select":"none"}},Vt=pe({name:"OperateDrawer",__name:"operate-drawer",props:we({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:we(["submitted"],["update:visible"]),setup(e,{emit:C}){const d=e,D=C,p=ue({current:1}),_=je(e,"visible"),{formRef:I,validate:A,restoreValidation:H}=Ue(),{defaultRequiredRule:M}=mt(),E=se(()=>({add:"新增自定义解析",edit:"修改自定义解析"})[d.operateType]),t=ue(g());function g(){return{lid:void 0,cvalue:"",orilog:"",multi:"",multicon:void 0,expre:"",status:1,re1:"",re2:""}}const x={lid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"},orilog:M},$=W(),R=async()=>{const{data:o,error:i}=await De();i||($.value=o.map(a=>({...a,id:"-"+a.id,type:a.cname})))},O=[{id:1,value:"%{mask1->}"},{id:2,value:"%{mask2->}"},{id:3,value:"%{ip1->}"},{id:4,value:"%{ip2->}"},{id:5,value:"%{port1->}"},{id:6,value:"%{port2->}"},{id:7,value:"%{mac1->}"},{id:8,value:"%{mac2->}"},{id:9,value:"%{level->}"},{id:10,value:"%{protocol->}"},{id:11,value:"%{code->}"},{id:12,value:"%{type2Name->}"},{id:13,value:"%{user->}"},{id:14,value:"%{resultName->}"},{id:15,value:"%{targetName->}"},{id:16,value:"%{log_time->}"},{id:17,value:"%{targetObject->}"}],P=W([]),{pageData:V,getData:U,nextPage:Z}=We(Ne),q=async o=>{const i=o.currentTarget;i.scrollTop+i.offsetHeight>=i.scrollHeight&&V.data.length<V.total&&Z()},X=ue({eventsTypeDataList:[]});async function ee(){const{data:o,error:i}=await kt();i||(X.eventsTypeDataList=o)}async function te(){if(p.current=1,await R(),await U(),await ee(),m.list=[],y.value=new Set([]),Object.assign(t,g()),d.operateType==="edit"&&d.rowData&&(Object.assign(t,d.rowData),d.rowData.multicon)){let o=JSON.parse(d.rowData.multicon);y.value=t.re1?new Set(t.re1.split(",").map(Number)):new Set([]),m.list=o}}function K(){_.value=!1}const y=W(new Set),J=W(null),T=W([]);function l(o){var ne,ae;let i=!0;const a=t.orilog,w=window.getSelection();if(!w.rangeCount)return;const v=w.getRangeAt(0),r=v.startContainer,f=v.endContainer;if(w.removeAllRanges(),!J.value.contains(r)||!J.value.contains(f))return;const S=Array.from(J.value.childNodes),b=S.indexOf(r.parentNode)-1,N=S.indexOf(f.parentNode);if(console.log("startIndex",b),console.log("endIndex",N),N-b==0)return!1;for(let h=b;h<N;h++)y.value.has(h)&&(console.log("尝试选择已禁用的字符，操作被阻止"),i=!1);if(i){if(b>=0&&N>=0&&b<=N)for(let h=b;h<N;h++)T.value.push(h);for(let h=b;h<N;h++)y.value.add(h);b>0&&y.value.add(b-1),N<a.length&&y.value.add(N),m.list.push({startIndex:b,endIndex:N,name:a.substring(b,N),multipegroup:null,value:null})}else return(ne=window.$message)==null||ne.destroyAll(),(ae=window.$message)==null||ae.warning("相邻划词不允许选中。"),!1;console.log("当前选中的文本:",a.substring(b,N)),console.log("已禁用的字符索引:",Array.from(y.value))}async function s(){var o,i,a;if(await A(),d.operateType==="add"){const{data:w,error:v}=await It([{lid:t.lid,cvalue:t.cvalue,orilog:t.orilog,multi:t.multi,multicon:t.multicon,expre:t.expre,status:t.status,re1:Array.from(y.value).length>0?Array.from(y.value).join(","):""}]);v||((o=window.$message)==null||o.success(F("common.addSuccess")),K(),D("submitted"))}else{const{data:w,error:v}=await Je([{id:(i=d.rowData)==null?void 0:i.id,lid:t.lid,cvalue:t.cvalue,orilog:t.orilog,multi:t.multi,multicon:t.multicon,expre:t.expre,status:t.status,re1:Array.from(y.value).length>0?Array.from(y.value).join(","):""}]);v||((a=window.$message)==null||a.success(F("common.updateSuccess")),K(),D("submitted"))}}Re(_,()=>{_.value&&(T.value=[],te(),H())}),Re(V,(o,i)=>{P.value=V.data.map(a=>{var w;return{id:a.id,value:O.find(v=>v.id===a.id)?(w=O.find(v=>v.id===a.id))==null?void 0:w.value:"",label:a.tname}})},{deep:!0});const z=W([{title:"字段值",key:"name",width:160,align:"center",ellipsis:{tooltip:!0}},{title:"多元组",key:"multipegroup",align:"center",width:160,render(o,i){return k(ke,{size:"small",clearable:!0,valueField:"id",filterable:!0,options:P.value,defaultValue:o.multipegroup,onScroll:q,"onUpdate:value":a=>{o.multipegroup=a,o.value=null,console.log(o.multipegroup)}})}},{title:"值",key:"value",align:"center",width:160,render(o,i){return o.multipegroup===11||o.multipegroup===9?k(ke,{size:"small",key:o.multipegroup,clearable:!0,filterable:!0,valueField:o.multipegroup===11?"id":"value",labelField:o.multipegroup===11?"pname":"label",options:o.multipegroup===11?X.eventsTypeDataList:Fe(Nt),defaultValue:o.value,"onUpdate:value":a=>{o.value=a}}):null}},{key:"operate",title:F("common.operate"),align:"center",width:80,fixed:"right",render(o,i){return k(Y,{size:"small",type:"error",ghost:!0,onClick:()=>Q(o,i)},{default:()=>F("common.delete")})}}]);function j(o,i){return o.filter(a=>!i.includes(a))}function Q(o,i){let a=[o.startIndex-1,o.endIndex];m.list.splice(i,1);for(let r=o.startIndex;r<o.endIndex;r++)a.push(r);const w=Math.max(...a),v=Math.min(...a);y.value.has(w+1)&&(a=a.filter(r=>r!==w)),y.value.has(v-1)&&(a=a.filter(r=>r!==v)),y.value=new Set(j(Array.from(y.value),a)),T.value=[],m.list.forEach(r=>{for(let f=r.startIndex;f<r.endIndex;f++)T.value.push(f)})}const m=ue({list:[]});function me(o,i){let a=o.split(""),w=0;for(const{startIndex:v,endIndex:r,replacement:f}of i){const S=v+w,b=r+w;if(S<0||b>=a.length||S>b)throw new Error("Invalid index range");const N=b-S+1,ne=a.slice(0,S).join(""),ae=a.slice(b+1).join("");a=(ne+f+ae).split(""),w+=f.length-N}return a.join("")}async function ve(){var o,i,a,w;if(p.current==1)await A(),p.current++,gt(()=>{var v;(v=d.rowData)!=null&&v.id&&(T.value=[],m.list.forEach(r=>{for(let f=r.startIndex;f<r.endIndex;f++)T.value.push(f)}))});else{let v=!0;if(m.list.length>0){for(let r=0;r<m.list.length;r++){let f=m.list[r];if(f.multipegroup){if((f.multipegroup===11||f.multipegroup===9)&&(console.log(f.value),!f.value&&f.value!=0)){v=!1;break}}else{v=!1;break}}if(v){t.cvalue="",t.multi="";let r={},f=[];P.value.forEach(S=>{r[S.id]=S.value}),m.list.forEach((S,b)=>{t.cvalue+=S.name+"，",t.multi+=S.multipegroup+",",f.push({startIndex:S.startIndex,endIndex:S.endIndex-1,replacement:S.multipegroup==11?"%{?x"+b+1+"}":S.multipegroup==9?"%{level->}":r[S.multipegroup]})}),console.log("finallyTransArr",f),t.cvalue=t.cvalue.substring(0,t.cvalue.length-1),t.multi=t.multi.substring(0,t.multi.length-1),t.multicon=JSON.stringify(m.list),t.expre=me(t.orilog,f),console.log(t.expre),p.current&&p.current++}else return(o=window.$message)==null||o.destroyAll(),(i=window.$message)==null||i.warning("请补充完整内容。"),!1}else return(a=window.$message)==null||a.destroyAll(),(w=window.$message)==null||w.warning("请添加日志划词。"),!1}}return(o,i)=>{const a=Ut,w=Ot,v=Ke,r=vt,f=qe,S=Qe,b=Ge,N=Ve,ne=ht,ae=_t;return B(),le(ae,{show:_.value,"onUpdate:show":i[5]||(i[5]=h=>_.value=h),"display-directive":"show",width:1e3,"content-style":{height:"100%"}},{default:u(()=>[n(ne,{title:E.value,"native-scrollbar":!1,closable:"","body-content-style":{height:"100%"}},{footer:u(()=>[n(N,{size:16},{default:u(()=>[n(c(Y),{onClick:K},{default:u(()=>[re(ce(c(F)("common.cancel")),1)]),_:1}),p.current===2||p.current===3?(B(),le(c(Y),{key:0,onClick:i[4]||(i[4]=h=>p.current--)},{default:u(()=>[re("上一步")]),_:1})):ie("",!0),p.current===1||p.current===2?(B(),le(c(Y),{key:1,type:"primary",onClick:ve},{default:u(()=>[re(ce(p.current===1?"下一步":"生成解析"),1)]),_:1})):ie("",!0),p.current===3?(B(),le(c(Y),{key:2,type:"primary",onClick:s},{default:u(()=>[re(ce(c(F)("common.confirm")),1)]),_:1})):ie("",!0)]),_:1})]),default:u(()=>[n(N,{class:"h-100%"},{default:u(()=>[n(w,{vertical:"",current:p.current,class:"h-400px"},{default:u(()=>[n(a,{title:"基本信息"}),n(a,{title:"日志划词"}),n(a,{title:"生成解析"})]),_:1},8,["current"]),be("div",Ft,[n(b,{ref_key:"formRef",ref:I,model:t,rules:x,onKeyup:Be(s,["enter"]),style:{height:"100%",display:"flex","flex-direction":"column"}},{default:u(()=>[p.current===1?(B(),de(ye,{key:0},[n(r,{label:"使用状态",path:"status"},{default:u(()=>[n(v,{value:t.status,"onUpdate:value":i[0]||(i[0]=h=>t.status=h),"checked-value":0,"unchecked-value":1},null,8,["value"])]),_:1}),n(r,{label:"日志源设备",path:"lid"},{default:u(()=>[n(f,{value:t.lid,"onUpdate:value":i[1]||(i[1]=h=>t.lid=h),placeholder:"请选择日志源设备",options:$.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"800px"},"show-path":!1},null,8,["value","options"])]),_:1}),n(r,{label:"日志原文",path:"orilog"},{default:u(()=>[n(c(Ce),{type:"textarea",value:t.orilog,"onUpdate:value":i[2]||(i[2]=h=>t.orilog=h),placeholder:"请输入日志原文",clearable:"",autosize:{minRows:5,maxRows:7},style:{width:"800px"}},null,8,["value"])]),_:1})],64)):ie("",!0),p.current===2?(B(),de(ye,{key:1},[n(r,{label:"日志原文",path:"orilog"},{default:u(()=>[be("div",Bt,[be("div",{class:"w-100%",ref_key:"editableDiv",ref:J,style:{"user-select":"text"},onMouseup:l},[(B(!0),de(ye,null,ft(t.orilog,(h,Ie)=>(B(),de("span",{key:Ie,style:Ae({color:T.value.includes(Ie)?"#f00":"#000"})},ce(h),5))),128))],544)])]),_:1}),n(r,{label:"划词信息",style:{flex:"1"}},{default:u(()=>[n(S,{columns:z.value,data:m.list,style:Ae([{width:"800px"},{height:"100%"}]),"scroll-x":702,"flex-height":""},null,8,["columns","data"])]),_:1})],64)):ie("",!0),p.current===3?(B(),le(r,{key:2,label:"表达式",path:"expre"},{default:u(()=>[n(c(Ce),{type:"textarea",value:t.expre,"onUpdate:value":i[3]||(i[3]=h=>t.expre=h),placeholder:"请输入表达式",clearable:"",style:{width:"800px"},readonly:"",autosize:{minRows:5,maxRows:7}},null,8,["value"])]),_:1})):ie("",!0)]),_:1},8,["model"])])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Gt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Ee(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!bt(e)}const hn=pe({name:"eventalarm_customparsing",__name:"index",setup(e){const C=xt(),d=W();(async()=>{const{data:l,error:s}=await De();s||(d.value=l.map(z=>z.data).flat())})();const p=W();(async()=>{const{data:l,error:s}=await Ne({page:1,limit:1e3});s||(p.value=JSON.parse(JSON.stringify(l)).list)})();const{columns:I,columnChecks:A,data:H,getData:M,loading:E,mobilePagination:t,searchParams:g,resetSearchParams:x}=yt({apiFn:$t,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,lid:null,multis:null,status:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"cvalue",title:"字段值",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"multi",title:"多元组",align:"center",minWidth:160,ellipsis:{tooltip:!0},render:l=>{const s=l.multi.split(",").map(Number);return n("span",null,[s.map((z,j)=>{var m,me;const Q=(me=(m=p.value)==null?void 0:m.find(ve=>ve.id===z))==null?void 0:me.tname;return Q?`${Q}${j!==s.length-1?"，":""}`:""})])}},{key:"lid",title:"日志源设备",align:"center",minWidth:180,ellipsis:{tooltip:!0},render:l=>{var s,z;return n("span",null,[((z=(s=d.value)==null?void 0:s.find(j=>j.id===l.lid))==null?void 0:z.type)||l.lid])}},{key:"dbtime",title:"入库时间",align:"center",width:160},{key:"status",title:"使用状态",align:"center",width:160,render:l=>n(Ke,{value:l.status,"onUpdate:value":[s=>l.status=s,()=>T(l)],checkedValue:0,uncheckedValue:1},null)},{key:"operate",title:F("common.operate"),align:"center",width:160,fixed:"right",render:l=>{let s;return n("div",{class:"flex-center gap-8px"},[ze(n(Y,{type:"info",ghost:!0,size:"small",onClick:()=>te(l.id)},Ee(s=F("common.edit"))?s:{default:()=>[s]}),[[Se("no-auth"),"custorm.parsing.update"]]),n(Lt,{onPositiveClick:()=>K(l.id)},{default:()=>F("common.confirmDelete"),trigger:()=>{let z;return ze(n(Y,{type:"error",ghost:!0,size:"small"},Ee(z=F("common.delete"))?z:{default:()=>[z]}),[[Se("no-auth"),"custorm.parsing.delete"]])}})])}}]}),{drawerVisible:$,operateType:R,editingData:O,handleAdd:P,handleEdit:V,checkedRowKeys:U,onBatchDeleted:Z,onDeleted:q,closeDrawer:X}=wt(H,M);async function ee(){console.log(U.value),y(U.value,l=>{Z()})}function te(l){V(l)}function K(l){console.log(l),y([l],s=>{q()})}async function y(l,s){const{data:z,error:j}=await Tt(l);if(!j)s&&s(z);else return!1}async function J(){}async function T(l){var z,j;const s={id:l.id,status:l.status};try{const{data:Q,error:m}=await Je([s]);if(!m)(z=window.$message)==null||z.success(l.status===0?"启用成功":"停用成功"),M();else throw new Error("更新失败")}catch{l.status=l.status===1?0:1,(j=window.$message)==null||j.error("操作失败，请重试")}}return(l,s)=>{const z=Ze,j=Qe,Q=He;return B(),de("div",Gt,[n(jt,{model:c(g),"onUpdate:model":s[0]||(s[0]=m=>ge(g)?g.value=m:null),onReset:c(x),onSearch:c(M)},null,8,["model","onReset","onSearch"]),n(Q,{title:"自定义解析",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":u(()=>[n(z,{columns:c(A),"onUpdate:columns":s[1]||(s[1]=m=>ge(A)?A.value=m:null),"disabled-delete":c(U).length===0,loading:c(E),onAdd:c(P),onDelete:ee,onRefresh:c(M),"is-view-export-button":!0,onExportHandler:J,"is-view-add-button":c(Me)("custorm.parsing.insert"),"is-view-delete-button":c(Me)("custorm.parsing.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:u(()=>[n(j,{"checked-row-keys":c(U),"onUpdate:checkedRowKeys":s[2]||(s[2]=m=>ge(U)?U.value=m:null),columns:c(I),data:c(H),size:"small","flex-height":!c(C).isMobile,"scroll-x":962,loading:c(E),remote:"","row-key":m=>m.id,pagination:c(t),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),n(Vt,{visible:c($),"onUpdate:visible":s[3]||(s[3]=m=>ge($)?$.value=m:null),"operate-type":c(R),"row-data":c(O),onSubmitted:c(M)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{hn as default};
