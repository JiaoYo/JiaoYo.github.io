import{_ as te}from"./table-header-operation.vue_vue_type_script_setup_true_lang-Du8FMrvy.js";import{d as V,n as j,s as G,p as W,b as ae,r as ne,ae as oe,D as M,o as A,c as E,w as a,g as e,h as I,t as F,i as n,$ as m,F as J,E as $,aB as H,J as Q,K as se,as as le,N as X,aq as ie,O as Y,B as K,af as re,ag as ue,ad as Z,a3 as ce,av as L,aA as pe,e as de,ah as U,ai as me,aw as _e,aj as fe}from"./index-B_wOAzJn.js";import{u as he,a as ge}from"./table-B3fPyxDQ.js";import{I as ve,J as ye,K as be,L as we}from"./basic-config-oZ-86ygg.js";import{_ as ke}from"./round-search-Dx_76RR_.js";import{_ as De}from"./round-refresh-CBluOOUc.js";import{_ as Ne}from"./lodash-fIpXyN_k.js";import{_ as xe}from"./FormItemGridItem-BnRAuO0l.js";import{_ as Ce}from"./Grid-BR8A0FgT.js";import{h as q}from"./permission-Sp9xUxU_.js";import{_ as ze}from"./Popconfirm-C9qTVe0_.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DnXpxBsm.js";import"./setting-outlined-BBxiNmLF.js";import"./export-Dh6g0Mr7.js";import"./refresh-COqHTRS6.js";import"./round-delete-D1n5_Qkt.js";import"./round-plus-BHbJRvUE.js";import"./Upload-B9KGHRVa.js";import"./Progress-Cb2HPN78.js";const Se=V({name:"OperateDrawer",__name:"operate-drawer",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(g,{emit:P}){const c=g,w=P,_=G(g,"visible"),{formRef:s,validate:N,restoreValidation:R}=W(),p=ae(()=>({add:"新增白名单",edit:"编辑白名单"})[c.operateType]),l=ne(k());function k(){return{ip:"",status:0,sysparam:0,dscb:""}}const x={ip:{required:!0,validator:H,trigger:["input","change","blur","password-input"]}};function B(){Object.assign(l,k()),c.operateType==="edit"&&c.rowData&&Object.assign(l,c.rowData)}function f(){_.value=!1}async function D(){var i,r;if(await N(),c.operateType==="add"){const{data:v,error:h}=await ve([l]);h||((i=window.$message)==null||i.success(m("common.addSuccess")),f(),w("submitted"))}else{const{data:v,error:h}=await ye([l]);h||((r=window.$message)==null||r.success(m("common.updateSuccess")),f(),w("submitted"))}}return oe(_,()=>{_.value&&(B(),R())}),(i,r)=>{const v=Q,h=se,C=le,z=X,T=ie,S=Y,y=K,t=re,o=ue,u=M("no-space");return A(),E(o,{show:_.value,"onUpdate:show":r[3]||(r[3]=d=>_.value=d),"display-directive":"show",width:360},{default:a(()=>[e(t,{title:p.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(z,{size:16},{default:a(()=>[e(y,{onClick:f},{default:a(()=>[I(F(n(m)("common.cancel")),1)]),_:1}),e(y,{type:"primary",onClick:D},{default:a(()=>[I(F(n(m)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(S,{ref_key:"formRef",ref:s,model:l,rules:x,onKeyup:J(D,["enter"])},{default:a(()=>[e(h,{label:"IP",path:"ip"},{default:a(()=>[$(e(v,{clearable:"",value:l.ip,"onUpdate:value":r[0]||(r[0]=d=>l.ip=d),placeholder:"请输入IP"},null,8,["value"]),[[u]])]),_:1}),e(h,{label:"状态"},{default:a(()=>[e(T,{value:l.status,"onUpdate:value":r[1]||(r[1]=d=>l.status=d),name:"radiogroup"},{default:a(()=>[e(z,null,{default:a(()=>[e(C,{value:0},{default:a(()=>[I("启用")]),_:1}),e(C,{value:1},{default:a(()=>[I("禁用")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),e(h,{label:"描述",path:"dscb"},{default:a(()=>[$(e(v,{clearable:"",value:l.dscb,"onUpdate:value":r[2]||(r[2]=d=>l.dscb=d),placeholder:"请输入描述"},null,8,["value"]),[[u]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ie=V({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(g,{emit:P}){const c=P,{formRef:w,restoreValidation:_}=W(),s=G(g,"model"),N={ip:[{validator:H,trigger:["blur","change","input"]}]};function R(){s.value.fuzzy=void 0,s.value.ip=s.value.ip==""?void 0:s.value.ip,c("search")}function p(){s.value.ip=void 0,c("search")}async function l(){await _(),c("reset")}async function k(){c("search")}const x=Ne.debounce(k,1e3,{leading:!0,trailing:!1});return(B,f)=>{const D=Q,i=xe,r=De,v=K,h=ke,C=X,z=Ce,T=Y,S=Z,y=M("no-space");return A(),E(S,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(T,{ref_key:"formRef",ref:w,model:s.value,"label-placement":"left",rules:N,"label-width":80,"show-require-mark":!1,onKeyup:J(n(x),["enter"])},{default:a(()=>[e(z,{responsive:"screen","item-responsive":"","y-gap":12},{default:a(()=>[e(i,{span:"24 s:12 m:8 l:6",label:"名称",path:"fuzzy"},{default:a(()=>[$(e(D,{clearable:"",value:s.value.fuzzy,"onUpdate:value":f[0]||(f[0]=t=>s.value.fuzzy=t),placeholder:"请输入关键字",onClear:R},null,8,["value"]),[[y]])]),_:1}),e(i,{span:"24 s:12 m:8 l:6",label:"IP",path:"ip"},{default:a(()=>[$(e(D,{clearable:"",value:s.value.ip,"onUpdate:value":f[1]||(f[1]=t=>s.value.ip=t),placeholder:"请输入IP",onClear:p},null,8,["value"]),[[y]])]),_:1}),e(i,{span:"24  s:12 m:8 l:6"},{default:a(()=>[e(C,{class:"w-full ml-20px"},{default:a(()=>[e(v,{onClick:l},{icon:a(()=>[e(r,{class:"text-icon"})]),default:a(()=>[I(" "+F(n(m)("common.reset")),1)]),_:1}),e(v,{type:"primary",ghost:"",onClick:n(x)},{icon:a(()=>[e(h,{class:"text-icon"})]),default:a(()=>[I(" "+F(n(m)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),$e={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function O(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!me(g)}const Qe=V({name:"basicconfig_whitelist",__name:"index",setup(g){const P=ce(),{columns:c,columnChecks:w,data:_,getData:s,loading:N,mobilePagination:R,searchParams:p,resetSearchParams:l}=he({apiFn:be,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,ip:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,disabled:t=>t.sysparam==0},{key:"ip",title:"IP地址",align:"center",width:240},{key:"dscb",title:"描述",align:"center",width:240},{key:"status",title:"状态",align:"center",render:t=>(t.status===null&&(t.status=0),e(L,{type:{0:"success",1:"error"}[t.status]},{default:()=>[t.status==0?"启用":"禁用"]}))},{key:"sysparam",title:"系统内置",align:"center",width:240,render:t=>{t.sysparam==null&&(t.sysparam=0);const o={0:"success",1:"info"},u=m(pe[t.sysparam]);return e(L,{size:"small",type:o[t.sysparam]},O(u)?u:{default:()=>[u]})}},{key:"operate",title:m("common.operate"),align:"center",width:130,render:t=>{let o;return e("div",{class:"flex-center gap-8px"},[$(e(K,{type:"primary",ghost:!0,size:"small",onClick:()=>T(t.id),disabled:t.sysparam==0},O(o=m("common.edit"))?o:{default:()=>[o]}),[[M("no-auth"),"sys.white.list.update"]]),e(ze,{onPositiveClick:()=>z(t.id)},{default:()=>m("common.confirmDelete"),trigger:()=>{let u;return $(e(K,{type:"error",ghost:!0,size:"small",disabled:t.sysparam==0},O(u=m("common.delete"))?u:{default:()=>[u]}),[[M("no-auth"),"sys.white.list.delete"]])}})])}}]}),{drawerVisible:k,operateType:x,editingData:B,handleAdd:f,handleEdit:D,checkedRowKeys:i,onBatchDeleted:r,onDeleted:v,closeDrawer:h}=ge(_,s);async function C(){console.log(i.value),S(i.value.join(","),t=>{r()})}function z(t){console.log(t),S(t,o=>{v()})}function T(t){D(t)}async function S(t,o){const{data:u,error:d}=await we(t);if(!d)o&&o(u);else return!1}const y=()=>{if(p.ip=="")p.ip=null;else if(p.ip!=null&&!_e(p.ip)){window.$message.warning("请输入正确的IP地址");return}s()};return(t,o)=>{const u=te,d=fe,ee=Z;return A(),de("div",$e,[e(Ie,{model:n(p),"onUpdate:model":o[0]||(o[0]=b=>U(p)?p.value=b:null),onReset:n(l),onSearch:y},null,8,["model","onReset"]),e(ee,{title:"白名单",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":a(()=>[e(u,{columns:n(w),"onUpdate:columns":o[1]||(o[1]=b=>U(w)?w.value=b:null),"disabled-delete":n(i).length===0,"is-view-add-button":n(q)("sys.white.list.insert"),"is-view-delete-button":n(q)("sys.white.list.delete"),loading:n(N),onAdd:n(f),onDelete:C,onRefresh:y},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd"])]),default:a(()=>[e(d,{"checked-row-keys":n(i),"onUpdate:checkedRowKeys":o[2]||(o[2]=b=>U(i)?i.value=b:null),columns:n(c),data:n(_),size:"small","flex-height":!n(P).isMobile,"scroll-x":962,loading:n(N),remote:"","row-key":b=>b.id,pagination:n(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Se,{visible:n(k),"onUpdate:visible":o[3]||(o[3]=b=>U(k)?k.value=b:null),"operate-type":n(x),"row-data":n(B),onSubmitted:y},null,8,["visible","operate-type","row-data"])]),_:1})])}}});export{Qe as default};
