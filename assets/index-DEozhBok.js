import{l as Q}from"./lodash-BR1Gv7hU.js";import{d as j,q as R,j as f,v as X,s as Z,o as J,c as ee,w as o,g as l,i as I,$ as S,V as ae,h as U,t as q,N as te,ax as le,ao as b,ap as M,Y as ne,A as oe,B as H,E as K,D as re,aa as Y,a0 as se,r as F,an as ie,e as ue,ae as de,aT as pe,av as ce}from"./index-DO9pjeOx.js";import{_ as ve}from"./round-search-rkqN6O1z.js";import{_ as me}from"./round-refresh-Bvv9ypfF.js";import{u as ge}from"./usePageData-CYY_aK43.js";import{a as fe,T as W}from"./basicconf-DBn-JWL4.js";import{f as he}from"./system-manage-8AYBgome.js";import{_ as Ie}from"./DatePicker-BFCKJ1hl.js";import{_ as _e}from"./Cascader-DDQOcSvy.js";import{_ as ye}from"./FormItemGridItem-DsJRh41Q.js";import{_ as we}from"./Grid-y-4oCE-1.js";import{_ as Ae}from"./originlogInfo.vue_vue_type_script_setup_true_lang-B-84-bt7.js";import{e as Se}from"./exportExcel-D6OyA9oJ.js";import{q as xe,y as Oe}from"./events-DACmeimf.js";import{b as be,f as Ee,a as Le}from"./common-DqKotnDS.js";import{_ as De}from"./DataTable-B4sIbOLe.js";import"./TimePicker-Bm-qfOeq.js";import"./defineProperty-ZSdetxpb.js";import"./Forward-Blm4mu5D.js";import"./DescriptionsItem-B1V1st1V.js";import"./CollapseItem-Lke9v3VO.js";const ke=j({name:"FormSearch",__name:"form-search",props:R(["eventsTypeDataList","LogSourceDeviceList","logsoudev"],{model:{required:!0},modelModifiers:{}}),emits:R(["search"],["update:model"]),setup(_,{emit:V}){const E=_,x=V;f(0);const{formRef:P,restoreValidation:B}=X(),e=Z(_,"model"),{pageData:L,getData:z,nextPage:G}=ge(he),D=async m=>{const n=m.currentTarget;n.scrollTop+n.offsetHeight>=n.scrollHeight&&L.data.length<L.total&&G()};z();async function $(){await B(),e.value.etypeid=null,e.value.elevel=null,e.value.rtime=null,e.value.user=null,e.value.logodid=null,e.value.target=null,e.value.startAndEndOriginIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.expression=null,e.value.startOriginIp=null,e.value.endOriginIp=null,e.value.startAimOriginIp=null,e.value.endAimOriginIp=null,e.value.startSourceIp=null,e.value.endSourceIp=null,le(()=>{x("search")})}const N=m=>{e.value.elevel=m,c()},w=(m,n)=>{e.value.rtime=n,c()},g=m=>{e.value.logodid=m,c()},k=()=>{e.value.startAndEndOriginIp=null,c()},s=()=>{e.value.startAndEndSourceIp=null,c()},C=()=>{e.value.startAndEndAimSourceIp=null,c()};async function c(){var m,n,y,p,A,O,h,a,t,r,v,i;if(e.value.startAndEndOriginIp&&e.value.startAndEndOriginIp.length>0?(e.value.startOriginIp=e.value.startAndEndOriginIp[0]||null,e.value.endOriginIp=e.value.startAndEndOriginIp[1]||null):(e.value.startOriginIp=null,e.value.endOriginIp=null),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimOriginIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimOriginIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimOriginIp=null,e.value.endAimOriginIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=null,e.value.endSourceIp=null),e.value.startOriginIp&&!b(e.value.startOriginIp)||e.value.endOriginIp&&!b(e.value.endOriginIp))return(m=window.$message)==null||m.destroyAll(),(n=window.$message)==null||n.error("请输入正确的IP地址"),!1;if(e.value.startOriginIp&&e.value.endOriginIp&&M(e.value.startOriginIp,e.value.endOriginIp)>0)return(y=window.$message)==null||y.destroyAll(),(p=window.$message)==null||p.error("起始IP不能大于终止IP"),!1;if(e.value.startAimOriginIp&&!b(e.value.startAimOriginIp)||e.value.endAimOriginIp&&!b(e.value.endAimOriginIp))return(A=window.$message)==null||A.destroyAll(),(O=window.$message)==null||O.error("请输入正确的IP地址"),!1;if(e.value.startAimOriginIp&&e.value.endAimOriginIp&&M(e.value.startAimOriginIp,e.value.endAimOriginIp)>0)return(h=window.$message)==null||h.destroyAll(),(a=window.$message)==null||a.error("起始IP不能大于终止IP"),!1;if(e.value.startSourceIp&&!b(e.value.startSourceIp)||e.value.endSourceIp&&!b(e.value.endSourceIp))return(t=window.$message)==null||t.destroyAll(),(r=window.$message)==null||r.error("请输入正确的IP地址"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&M(e.value.startSourceIp,e.value.endSourceIp)>0)return(v=window.$message)==null||v.destroyAll(),(i=window.$message)==null||i.error("起始IP不能大于终止IP"),!1;x("search")}return(m,n)=>{const y=_e,p=ye,A=ne,O=Ie,h=oe,a=me,t=H,r=ve,v=K,i=we,u=re,T=Y;return J(),ee(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[l(u,{ref_key:"formRef",ref:P,model:e.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:te(c,["enter"])},{default:o(()=>[l(i,{responsive:"screen","item-responsive":""},{default:o(()=>[l(p,{span:"24 s:24 m:6",label:"事件类型",path:"etypeid",class:"pr-24px"},{default:o(()=>[l(y,{value:e.value.etypeid,"onUpdate:value":[n[0]||(n[0]=d=>e.value.etypeid=d),g],clearable:"",placeholder:"请选择事件","max-tag-count":1,options:E.eventsTypeDataList,"show-path":!1,filterable:"","value-field":"id","check-strategy":"child","label-field":"pname"},null,8,["value","options"])]),_:1}),l(p,{span:"24 s:24 m:6",label:I(S)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:o(()=>[l(A,{filterable:"",clearable:"",placeholder:I(S)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[n[1]||(n[1]=d=>e.value.elevel=d),N],"reset-menu-on-options-change":!1,options:I(ae)(I(fe))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),l(p,{span:"24 s:24 m:6",label:"接收时间",path:"rtime",class:"pr-24px"},{default:o(()=>[l(O,{placeholder:"请选择接收时间","formatted-value":e.value.rtime,"onUpdate:formattedValue":n[2]||(n[2]=d=>e.value.rtime=d),"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",clearable:"",style:{width:"100%"},"onUpdate:value":w},null,8,["formatted-value"])]),_:1}),l(p,{span:"24 s:24 m:6",label:"用户",path:"user",class:"pr-24px"},{default:o(()=>[l(A,{value:e.value.user,"onUpdate:value":n[3]||(n[3]=d=>e.value.user=d),placeholder:"请选择用户",clearable:"",filterable:"","value-field":"id","label-field":"username",options:I(L).data,"reset-menu-on-options-change":!1,onScroll:D},null,8,["value","options"])]),_:1}),l(p,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndOriginIp",class:"pr-24px mt-10px"},{default:o(()=>[l(h,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndOriginIp,"onUpdate:value":n[4]||(n[4]=d=>e.value.startAndEndOriginIp=d),onClear:k},null,8,["value"])]),_:1}),l(p,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px mt-10px"},{default:o(()=>[l(h,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":n[5]||(n[5]=d=>e.value.startAndEndAimSourceIp=d),onClear:C},null,8,["value"])]),_:1}),l(p,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSourceIp",class:"pr-24px mt-10px"},{default:o(()=>[l(h,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":n[6]||(n[6]=d=>e.value.startAndEndSourceIp=d),onClear:s},null,8,["value"])]),_:1}),l(p,{span:"24 s:24 m:6",label:"日志源设备",path:"logodid",class:"pr-24px mt-10px"},{default:o(()=>[l(y,{disabled:E.logsoudev,value:e.value.logodid,"onUpdate:value":[n[7]||(n[7]=d=>e.value.logodid=d),c],placeholder:"请选择日志源设备",options:E.LogSourceDeviceList,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["disabled","value","options"])]),_:1}),l(p,{span:"24 s:24 m:6",label:"目标对象",path:"target",class:"pr-24px mt-10px"},{default:o(()=>[l(h,{placeholder:"请输入目标对象",value:e.value.target,"onUpdate:value":n[8]||(n[8]=d=>e.value.target=d),clearable:""},null,8,["value"])]),_:1}),l(p,{span:"24 m:8",class:"pr-24px mt-10px"},{default:o(()=>[l(v,{class:"w-full"},{default:o(()=>[l(t,{onClick:$},{icon:o(()=>[l(a,{class:"text-icon"})]),default:o(()=>[U(" "+q(I(S)("common.reset")),1)]),_:1}),l(t,{type:"primary",ghost:"",onClick:c},{icon:o(()=>[l(r,{class:"text-icon"})]),default:o(()=>[U(" "+q(I(S)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ce={class:"min-h-500px flex-col-stretch overflow-hidden lt-sm:overflow-auto"};function Te(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!de(_)}const Pe=j({name:"eventalarm_originlog",__name:"index",props:{logsoudev:{}},setup(_){const V=se(),E=f(window.innerHeight-395),x=_,P=f([]);(async()=>{const{data:a,error:t}=await be();t||(P.value=a.map(r=>({...r,id:"+"+r.id,type:r.cname})))})();const e=f([]),L=f([]);async function z(){const{data:a,error:t}=await Ee();t||(e.value=a,await G())}async function G(){const{data:a,error:t}=await Le();if(!t){L.value=a;let r=e.value.concat(a);e.value=pe(r)}}z();const D=f(!1),$=f(),N=f(),w=f(!1),g=F({pageId:void 0,limit:100,etypeid:void 0,elevel:void 0,rtime:void 0,startOriginIp:void 0,endOriginIp:void 0,startAimOriginIp:void 0,endAimOriginIp:void 0,startSourceIp:void 0,endSourceIp:void 0,logodid:void 0,user:void 0,target:void 0,fuzzy:void 0,_t:new Date().getTime()}),k=[{title:"",key:"key",width:80,render:(a,t)=>`${t+1}`},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160},{key:"elevel",title:"事件等级",align:"center",width:120,render:a=>{(a.elevel===void 0||a.elevel===null)&&(a.elevel=1);const t={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},r=S(W[a.elevel]);let v={color:t[a.elevel],textColor:"#ffffff",borderColor:t[a.elevel]};return l(ie,{size:"small",color:v},Te(r)?r:{default:()=>[r]})}},{key:"cname",title:"设备类别",align:"center",width:180},{key:"type",title:"设备类型",align:"center",width:180},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"sourceip",title:"发生源IP",align:"center",width:180},{key:"prifinallog",title:"日志原文",align:"center",width:240,ellipsis:{tooltip:!0}},{key:"operate",title:S("common.operate"),align:"center",width:100,fixed:"right",render:a=>l("div",{class:"flex-center gap-8px"},[l(H,{type:"info",ghost:!0,size:"small",onClick:()=>p(a)},{default:()=>[U("详情")]})])}],s=f([]),C=async(a=!1)=>{if(!w.value)w.value=!0;else return;w.value=!0,x.logsoudev&&(c.value=!1,g.logodid=x.logsoudev);const{data:t,error:r}=await xe(g);r||(a?s.value=[...s.value,...t]:s.value=t,w.value=!1)},c=f(!0),m=()=>{s.value=[],g.pageId=void 0,(t=>Object.keys(t).filter(i=>i!=="limit"&&i!=="_t").some(i=>(console.log(i,t[i]),t[i]!==void 0&&t[i]!==""&&t[i]!==null)))(g)?c.value=!1:(c.value=!0,y()),C()};C();const n=F({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:a,endIndex:t,page:r,pageSize:v,pageCount:i,itemCount:u}){return`已加载${s.value.length}条`+(s.value.length?c.value?` 共计 ${s.value.length>0?u??0:0} 条`:s.value.length>=g.limit?"  预计还有更多":"":"")}});async function y(){const{data:a,error:t}=await Oe();t||(n.pageCount=20,n.total=Number(a),n.itemCount=Number(a))}y();const p=a=>{$.value=a.id,N.value=a,D.value=!0};function A(a){Math.abs(a.target.scrollTop+a.target.offsetHeight-a.target.scrollHeight)<=20&&n.total>s.value.length&&O()}const O=Q.debounce(()=>{var a;if(((a=s.value)==null?void 0:a.length)<n.total){if(g.pageId==s.value[s.value.length-1].id)return;g.pageId=s.value[s.value.length-1].id,C(!0)}},300);async function h(){if(!s.value.length)return;const a=JSON.parse(JSON.stringify(s.value)),t=[];a.forEach(v=>{const i={};k.forEach(u=>{if(v.hasOwnProperty(u.key)){const T=u.key=="elevel"?S(W[v[u.key]]):v[u.key];i[u.title]=T}}),t.push(i)}),Se(t,500,[{wpx:120},{wpx:120},{wpx:80},{wpx:100},{wpx:100},{wpx:120},{wpx:100},{wpx:500}],"原始日志_"+new Date().getTime())}return(a,t)=>{const r=K,v=De,i=Y;return J(),ue("div",Ce,[l(ke,{model:g,"onUpdate:model":t[0]||(t[0]=u=>g=u),onSearch:m,eventsTypeDataList:e.value,LogSourceDeviceList:P.value,class:"mb-16px",logsoudev:x.logsoudev},null,8,["model","eventsTypeDataList","LogSourceDeviceList","logsoudev"]),l(i,{title:"原始日志",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[l(r,null,{default:o(()=>[l(I(H),{type:"primary",size:"small",ghost:"",onClick:h,title:"导出已加载"},{default:o(()=>[U("导出已加载")]),_:1})]),_:1})]),default:o(()=>[l(v,{columns:k,data:s.value,size:"small","flex-height":!I(V).isMobile,loading:w.value,remote:"","row-key":u=>u.id,"virtual-scroll":"","scroll-x":k.reduce((u,T)=>u+T.width,0),pagination:n,class:"sm:h-full",onScroll:A,"max-height":E.value},null,8,["data","flex-height","loading","row-key","scroll-x","pagination","max-height"])]),_:1}),l(Ae,{detailVisible:D.value,"onUpdate:detailVisible":t[1]||(t[1]=u=>D.value=u),detailId:$.value,detailInfo:N.value},null,8,["detailVisible","detailId","detailInfo"])])}}}),aa=ce(Pe,[["__scopeId","data-v-a0cfe5d1"]]);export{aa as default};
