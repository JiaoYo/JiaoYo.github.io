import{_ as te}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DMbL-Mlp.js";import{d as P,aq as A,ar as K,q as W,v as ae,a as ne,s as le,$ as d,W as $,A as L,B as S,a1 as oe,c as E,o as j,w as n,f as e,as as se,F as G,z as re,h as a,at as J,au as H,av as Q,e as q,g as B,N as X,t as V,aw as ie,ax as ce,ay as de,E as pe,U as Y,L as ue,b as me,az as O,aA as _e,aB as fe,ab as ge,aC as be}from"./index-L-fc37A6.js";import{e as Z,a as he}from"./business-Ck8yJ6cd.js";import{u as ve,a as ye}from"./table-D8utkW2F.js";import{_ as we}from"./round-plus-BZ7q1IZk.js";import{N as ee}from"./Popconfirm-BzF4QpZe.js";import{_ as Ne}from"./round-search-CZXNsD-X.js";import{_ as ke}from"./round-refresh-Bnhuq11H.js";import{_ as De}from"./Grid-BXk3mt7Q.js";import{_ as Se}from"./FormItemGridItem-s7MwQACu.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-DI0LtGm8.js";import"./export-CuycmJ9m.js";import"./round-delete-C_4zLiR5.js";import"./Upload-QqP-xHe3.js";import"./Progress-EddtyCRs.js";import"./utils-BKZAihyB.js";const xe={style:{display:"flex","align-items":"center"}},Ce=P({name:"OperateDrawer",__name:"operate-drawer",props:A({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:A(["submitted"],["update:visible"]),setup(h,{emit:R}){const u=h,v=R,f=K(h,"visible"),{formRef:r,validate:x,restoreValidation:U}=W(),{defaultRequiredRule:N}=ae(),k=ne(()=>({add:"新增调试步骤列表",edit:"修改调试步骤列表"})[u.operateType]),t=le(m());function m(){return{name:"",desc:"",enable:1,stepsList:[]}}const C={name:N,stepsList:{type:"array",required:!0,message:"请输入调试步骤",trigger:["input","change","blur"]}},y=[{key:"no",title:"序号",align:"center",render(c,l){return $(L,{value:c.no,clearable:!0,placeholder:"请输入序号",onUpdateValue(i){t.stepsList[l].no=i}})}},{key:"name",title:"名称",align:"center",render(c,l){return $(L,{value:c.name,clearable:!0,placeholder:"请输入名称",onUpdateValue(i){t.stepsList[l].name=i}})}},{key:"desc",title:"描述",align:"center",render(c,l){return $(L,{value:c.desc,clearable:!0,placeholder:"请输入描述",onUpdateValue(i){t.stepsList[l].desc=i}})}},{key:"operate",title:d("common.operate"),align:"center",width:80,fixed:"right",render(c,l){return $(ee,{onPositiveClick:()=>{t.stepsList.splice(l,1)}},{default:()=>d("common.confirmDelete"),trigger:()=>$(S,{type:"error",ghost:!0,size:"small"},{default:()=>d("common.delete")})})}}];function T(){Object.assign(t,m()),u.operateType==="edit"&&u.rowData&&Object.assign(t,u.rowData)}function g(){t.stepsList.push({no:t.stepsList.length+1,name:"",desc:""})}function w(){f.value=!1}async function z(){var c,l;if(await x(),u.operateType==="add"){const{data:i,error:b}=await ce({name:t.name,desc:t.desc,enable:t.enable,stepsList:t.stepsList.length>0?JSON.stringify(t.stepsList):""});b||((c=window.$message)==null||c.success(d("common.addSuccess")),w(),v("submitted"))}else{const{data:i,error:b}=await de({id:u.rowData.id,name:t.name,desc:t.desc,enable:t.enable,stepsList:t.stepsList.length>0?JSON.stringify(t.stepsList):""});b||((l=window.$message)==null||l.success(d("common.updateSuccess")),w(),v("submitted"))}}return oe(f,()=>{f.value&&(T(),U())}),(c,l)=>{const i=re,b=J,o=we,s=Q,p=G,F=X,I=se,_=ie;return j(),E(_,{show:f.value,"onUpdate:show":l[3]||(l[3]=D=>f.value=D),"display-directive":"show",width:1e3},{default:n(()=>[e(I,{title:k.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(F,{size:16},{default:n(()=>[e(a(S),{onClick:w},{default:n(()=>[B(V(a(d)("common.cancel")),1)]),_:1}),e(a(S),{type:"primary",onClick:z},{default:n(()=>[B(V(a(d)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(p,{ref_key:"formRef",ref:r,model:t,rules:C},{default:n(()=>[e(i,{label:"名称",path:"name"},{default:n(()=>[e(a(L),{clearable:"",value:t.name,"onUpdate:value":l[0]||(l[0]=D=>t.name=D),placeholder:"请输入名称"},null,8,["value"])]),_:1}),e(i,{label:"是否启用",path:"enable"},{default:n(()=>[e(b,{filterable:"",value:t.enable,"onUpdate:value":l[1]||(l[1]=D=>t.enable=D),options:a(H)(a(Z)),placeholder:"请选择是否启用"},null,8,["value","options"])]),_:1}),e(i,{label:"调试步骤",path:"stepsList"},{label:n(()=>[q("div",xe,[l[5]||(l[5]=q("span",{style:{"margin-right":"10px"}},"调试步骤",-1)),e(a(S),{size:"small",ghost:"",type:"primary",onClick:g},{icon:n(()=>[e(o,{class:"text-icon"})]),default:n(()=>[l[4]||(l[4]=B(" 添加调试步骤 "))]),_:1,__:[4]})])]),default:n(()=>[e(s,{bordered:"",size:"small",data:t.stepsList,columns:y,pagination:!1},null,8,["data"])]),_:1}),e(i,{label:"描述",path:"desc"},{default:n(()=>[e(a(L),{type:"textarea",clearable:"",value:t.desc,"onUpdate:value":l[2]||(l[2]=D=>t.desc=D),placeholder:"请输入描述",autosize:{minRows:4}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Le=P({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:A(["reset","search"],["update:model"]),setup(h,{emit:R}){const u=R,{formRef:v,restoreValidation:f}=W(),r=K(h,"model");function x(){r.value.name=null,u("search")}function U(){r.value.desc=null,u("search")}async function N(){await f(),u("reset")}async function k(){u("search")}return(t,m)=>{const C=L,y=Se,T=J,g=ke,w=S,z=Ne,c=X,l=De,i=G,b=Y;return j(),E(b,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(i,{ref_key:"formRef",ref:v,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:pe(k,["enter"])},{default:n(()=>[e(l,{responsive:"screen","item-responsive":""},{default:n(()=>[e(y,{span:"24 s:12 m:6",label:"名称",path:"name",class:"pr-24px"},{default:n(()=>[e(C,{clearable:"",value:r.value.name,"onUpdate:value":m[0]||(m[0]=o=>r.value.name=o),placeholder:"请输入名称",onClear:x},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:6",label:"描述",path:"desc",class:"pr-24px"},{default:n(()=>[e(C,{clearable:"",value:r.value.desc,"onUpdate:value":m[1]||(m[1]=o=>r.value.desc=o),placeholder:"请输入描述",onClear:U},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:6",label:"是否启用",path:"desc",class:"pr-24px"},{default:n(()=>[e(T,{clearable:"",filterable:"",value:r.value.enable,"onUpdate:value":[m[2]||(m[2]=o=>r.value.enable=o),k],options:a(H)(a(Z)),placeholder:"请选择是否启用"},null,8,["value","options"])]),_:1}),e(y,{span:"24 s:12 m:6",class:"pr-24px"},{default:n(()=>[e(c,{class:"w-full"},{default:n(()=>[e(w,{onClick:N},{icon:n(()=>[e(g,{class:"text-icon"})]),default:n(()=>[B(" "+V(a(d)("common.reset")),1)]),_:1}),e(w,{type:"primary",ghost:"",onClick:k},{icon:n(()=>[e(z,{class:"text-icon"})]),default:n(()=>[B(" "+V(a(d)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Re={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function M(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!be(h)}const Ee=P({name:"manage_debugstep",__name:"index",setup(h){const R=ue(),{columns:u,columnChecks:v,data:f,getData:r,loading:x,mobilePagination:U,searchParams:N,resetSearchParams:k}=ve({apiFn:fe,immediate:!1,apiParams:{page:1,pageSize:20,limit:20,name:null,desc:null,enable:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"name",title:"名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"desc",title:"描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"stepsList",title:"调试步骤",align:"center",minWidth:300},{key:"enable",title:"是否启用",align:"center",width:180,render:o=>{o.enable===null&&(o.enable=0);const s={0:"error",1:"success"},p=d(he[o.enable]);return e(ge,{type:s[o.enable]},M(p)?p:{default:()=>[p]})}},{key:"createTime",title:d("page.manage.user.createDate"),align:"center",width:180},{key:"operate",title:d("common.operate"),align:"center",width:130,render:o=>{let s;return e("div",{class:"flex-center gap-8px"},[e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>i(o.id)},M(s=d("common.edit"))?s:{default:()=>[s]}),e(ee,{onPositiveClick:()=>l(o.id)},{default:()=>d("common.confirmDelete"),trigger:()=>{let p;return e(S,{type:"error",ghost:!0,size:"small"},M(p=d("common.delete"))?p:{default:()=>[p]})}})])}}]}),{drawerVisible:t,operateType:m,editingData:C,handleAdd:y,handleEdit:T,checkedRowKeys:g,onBatchDeleted:w,onDeleted:z}=ye(f,r);async function c(){console.log(g.value),b(g.value,o=>{w()})}function l(o){console.log(o),b([o],s=>{z()})}function i(o){T(o)}async function b(o,s){const p=await _e(o);console.log("data",p),s&&s(p)}return(o,s)=>{const p=te,F=Q,I=Y;return j(),me("div",Re,[e(Le,{model:a(N),"onUpdate:model":s[0]||(s[0]=_=>O(N)?N.value=_:null),onReset:a(k),onSearch:a(r)},null,8,["model","onReset","onSearch"]),e(I,{title:"调试步骤列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[e(p,{columns:a(v),"onUpdate:columns":s[1]||(s[1]=_=>O(v)?v.value=_:null),"disabled-delete":a(g).length===0,loading:a(x),onAdd:a(y),onDelete:c,onRefresh:a(r)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:n(()=>[e(F,{"checked-row-keys":a(g),"onUpdate:checkedRowKeys":s[2]||(s[2]=_=>O(g)?g.value=_:null),columns:a(u),data:a(f),size:"small","flex-height":!a(R).isMobile,"scroll-x":962,loading:a(x),remote:"","row-key":_=>_.id,pagination:a(U),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ce,{visible:a(t),"onUpdate:visible":s[3]||(s[3]=_=>O(t)?t.value=_:null),"operate-type":a(m),"row-data":a(C),onSubmitted:a(r)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Ee as default};
