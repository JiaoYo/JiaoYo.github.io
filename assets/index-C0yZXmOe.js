import{_ as pe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-B_nfZvCo.js";import{_ as ue}from"./round-delete-CcNGgyIA.js";import{_ as de}from"./round-add-CHsveicE.js";import{d as K,aq as O,s as ce,q as X,a as me,ar as Y,a1 as fe,c as U,o as m,w as t,f as e,b5 as _e,F as ee,h as l,A as S,at as te,b as P,g as p,e as M,t as h,B as _,N as Z,$ as q,b6 as ve,bZ as ge,E as he,U as ae,L as ye,r as we,x as I,az as V,av as be,C as A,bl as ke,aC as xe}from"./index-IJPUKuVg.js";import{y as Ce,z as De,a as Ne,A as ze,B as J,C as Se}from"./project-BDdZNt5n.js";import{u as Ue,a as qe}from"./table-CogYQEHF.js";import{_ as oe}from"./Grid-L-iwlohn.js";import{_ as ne}from"./FormItemGridItem-D247iqno.js";import{N as Te}from"./Upload--4vTHIhR.js";import{_ as je}from"./round-search-Bm2wvj6V.js";import{_ as Le}from"./round-refresh-DFoMKxfw.js";import{N as Q}from"./Popconfirm-C-8L0Flv.js";import"./Progress-CPEfy4E3.js";import"./utils-Dreq_XfI.js";const $e={key:0},Re={key:0},Fe={key:0},Be={key:0},Pe=K({name:"OperateDrawer",__name:"operate-drawer",props:O({operateType:{},rowData:{},provinceList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:O(["submitted"],["update:visible"]),setup(v,{emit:$}){const x=$,f=v,n=ce(C());function C(){return{id:"",dname:"",dcon:"",province:null,region:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}async function u(){Object.assign(n,C()),f.operateType==="edit"&&f.rowData&&Object.assign(n,f.rowData)}const{formRef:y,validate:j,restoreValidation:R}=X(),w={dname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},province:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dcon:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},region:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},L=me(()=>({add:"新增调度",edit:"修改调度"})[f.operateType]),d=Y(v,"visible");fe(d,()=>{d.value&&(u(),setTimeout(()=>{const i=document.querySelector(".n-scrollbar-content");i==null||i.scrollTo(0,0)},300),R())});function D(){d.value=!1}async function N(){var i,a;if(await j(),f.operateType==="edit"){const{data:r,error:c}=await Ce([n]);c||(D(),x("submitted"),(i=window.$message)==null||i.success("修改成功"))}else{const{data:r,error:c}=await De([{...n}]);c||(D(),x("submitted"),(a=window.$message)==null||a.success("添加成功"))}}async function z({file:i},a){let r=new FormData;r.append("multipartFile",i.file);const{data:c,error:T}=await Ne(r);T||(n[a]=c)}return(i,a)=>{const r=ne,c=Te,T=oe,F=ee,B=_e,b=Z,E=ve;return m(),U(E,{show:d.value,"onUpdate:show":a[12]||(a[12]=s=>d.value=s),title:L.value,preset:"card",class:"w-800px"},{footer:t(()=>[e(b,{justify:"end",size:16},{default:t(()=>[e(l(_),{onClick:D},{default:t(()=>[p(h(l(q)("common.cancel")),1)]),_:1}),e(l(_),{type:"primary",onClick:N},{default:t(()=>[p(h(l(q)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(B,{class:"pr-20px"},{default:t(()=>[e(F,{ref_key:"formRef",ref:y,model:n,rules:w,"label-placement":"left","label-width":120},{default:t(()=>[e(T,{responsive:"screen","item-responsive":""},{default:t(()=>[e(r,{span:"24 m:12",label:"调度名称",path:"dname"},{default:t(()=>[e(l(S),{value:n.dname,"onUpdate:value":a[0]||(a[0]=s=>n.dname=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"调度联系方式",path:"dcon"},{default:t(()=>[e(l(S),{value:n.dcon,"onUpdate:value":a[1]||(a[1]=s=>n.dcon=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"省份",path:"province"},{default:t(()=>[e(l(te),{filterable:"",options:f.provinceList,clearable:"",value:n.province,"onUpdate:value":a[2]||(a[2]=s=>n.province=s),"value-field":"id","label-field":"name"},null,8,["options","value"])]),_:1}),e(r,{span:"24 m:12",label:"地区",path:"region"},{default:t(()=>[e(l(S),{value:n.region,"onUpdate:value":a[3]||(a[3]=s=>n.region=s),placeholder:"请输入"},null,8,["value"])]),_:1}),e(r,{span:"24 m:24",label:"附件1",path:"notes"},{default:t(()=>{var s;return[e(l(S),{value:n.re1,"onUpdate:value":a[4]||(a[4]=o=>n.re1=o),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),n.fl1?(m(),P("span",$e,[p(h((s=n.fl1)==null?void 0:s.split("?")[1])+" ",1),M("span",{class:"cursor-pointer c-#c92a2a",onClick:a[5]||(a[5]=o=>n.fl1="")},"删除")])):(m(),U(c,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":o=>z(o,"fl1"),"show-file-list":!1},{default:t(()=>[e(l(_),{size:"small",ghost:"",type:"primary"},{default:t(()=>a[13]||(a[13]=[p("选择文件")])),_:1,__:[13]})]),_:1},8,["custom-request"]))]}),_:1}),e(r,{span:"24 m:24",label:"附件2",path:"notes"},{default:t(()=>{var s;return[e(l(S),{value:n.re2,"onUpdate:value":a[6]||(a[6]=o=>n.re2=o),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),n.fl2?(m(),P("span",Re,[p(h((s=n.fl2)==null?void 0:s.split("?")[1])+" ",1),M("span",{class:"cursor-pointer c-#c92a2a",onClick:a[7]||(a[7]=o=>n.fl2="")},"删除")])):(m(),U(c,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":o=>z(o,"fl2"),"show-file-list":!1},{default:t(()=>[e(l(_),{size:"small",ghost:"",type:"primary"},{default:t(()=>a[14]||(a[14]=[p("选择文件")])),_:1,__:[14]})]),_:1},8,["custom-request"]))]}),_:1}),e(r,{span:"24 m:24",label:"附件3",path:"notes"},{default:t(()=>{var s;return[e(l(S),{value:n.re3,"onUpdate:value":a[8]||(a[8]=o=>n.re3=o),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),n.fl3?(m(),P("span",Fe,[p(h((s=n.fl3)==null?void 0:s.split("?")[1])+" ",1),M("span",{class:"cursor-pointer c-#c92a2a",onClick:a[9]||(a[9]=o=>n.fl3="")},"删除")])):(m(),U(c,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":o=>z(o,"fl3"),"show-file-list":!1},{default:t(()=>[e(l(_),{size:"small",ghost:"",type:"primary"},{default:t(()=>a[15]||(a[15]=[p("选择文件")])),_:1,__:[15]})]),_:1},8,["custom-request"]))]}),_:1}),e(r,{span:"24 m:24",label:"附件4",path:"notes"},{default:t(()=>{var s;return[e(l(S),{value:n.re4,"onUpdate:value":a[10]||(a[10]=o=>n.re4=o),placeholder:"请输入",style:{width:"250px","margin-right":"20px"}},null,8,["value"]),n.fl4?(m(),P("span",Be,[p(h((s=n.fl4)==null?void 0:s.split("?")[1])+" ",1),M("span",{class:"cursor-pointer c-#c92a2a",onClick:a[11]||(a[11]=o=>n.fl4="")},"删除")])):(m(),U(c,{key:1,style:{width:"auto"},ref:"uploadRef",action:"#","custom-request":o=>z(o,"fl4"),"show-file-list":!1},{default:t(()=>[e(l(_),{size:"small",ghost:"",type:"primary"},{default:t(()=>a[16]||(a[16]=[p("选择文件")])),_:1,__:[16]})]),_:1},8,["custom-request"]))]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Me=K({name:"FormSearch",__name:"form-search",props:O({provinceList:{}},{model:{required:!0},modelModifiers:{}}),emits:O(["reset","search"],["update:model"]),setup(v,{emit:$}){const x=v;ge();const f=$,{formRef:n,restoreValidation:C}=X(),u=Y(v,"model");function y(){u.value.fuzzy="",f("search")}const j=()=>{u.value.region="",f("search")};async function R(){await C(),f("reset")}async function w(){f("search")}return(L,d)=>{const D=S,N=ne,z=te,i=Le,a=_,r=je,c=Z,T=oe,F=ee,B=ae;return m(),U(B,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(F,{ref_key:"formRef",ref:n,model:u.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:he(w,["enter"])},{default:t(()=>[e(T,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(N,{span:"24 s:12 m:6",label:"调度名称",path:"fuzzy"},{default:t(()=>[e(D,{clearable:"",value:u.value.fuzzy,"onUpdate:value":d[0]||(d[0]=b=>u.value.fuzzy=b),placeholder:"请输入调度名称",onClear:y},null,8,["value"])]),_:1}),e(N,{span:"24 s:12 m:4",label:"省份",path:"province"},{default:t(()=>[e(z,{clearable:"",filterable:"",value:u.value.province,"onUpdate:value":[d[1]||(d[1]=b=>u.value.province=b),w],placeholder:"请选择省份","label-field":"name","value-field":"id",options:x.provinceList},null,8,["value","options"])]),_:1}),e(N,{span:"24 s:12 m:6",label:"地区",path:"region"},{default:t(()=>[e(D,{clearable:"",value:u.value.region,"onUpdate:value":d[2]||(d[2]=b=>u.value.region=b),placeholder:"请输入地区",onClear:j},null,8,["value"])]),_:1}),e(N,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(c,{class:"w-full"},{default:t(()=>[e(a,{onClick:R},{icon:t(()=>[e(i,{class:"text-icon"})]),default:t(()=>[p(" "+h(l(q)("common.reset")),1)]),_:1}),e(a,{type:"primary",ghost:"",onClick:w},{icon:t(()=>[e(r,{class:"text-icon"})]),default:t(()=>[p(" "+h(l(q)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ve={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!xe(v)}const tt=K({name:"projectmanagement_dispatch",__name:"index",setup(v){const $=ye(),x=we([]);(async()=>{const{data:s}=await ze();s&&(x.value=s)})();const{columns:n,columnChecks:C,data:u,getData:y,loading:j,mobilePagination:R,searchParams:w}=Ue({showTotal:!0,apiFn:Se,apiParams:{page:1,pageSize:20,limit:20,province:void 0,region:"",fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"dname",title:"调度名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"dcon",title:"调度联系方式",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"provinceName",title:"省份",align:"center",width:120},{key:"region",title:"地区",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:q("common.operate"),align:"center",width:140,fixed:"right",render:s=>{let o;return e("div",{class:"flex-center gap-8px"},[A(e(_,{type:"primary",ghost:!0,size:"small",onClick:()=>F(s.id)},W(o=q("common.edit"))?o:{default:()=>[o]}),[[I("no-auth"),"project:Dispatch:update"]]),e(Q,{onPositiveClick:()=>T(s.id)},{default:()=>q("common.confirmDelete"),trigger:()=>{let g;return A(e(_,{type:"error",ghost:!0,size:"small"},W(g=q("common.delete"))?g:{default:()=>[g]}),[[I("no-auth"),"project:Dispatch:delete"]])}})])}}]}),{drawerVisible:L,operateType:d,editingData:D,handleAdd:N,handleEdit:z,checkedRowKeys:i,onBatchDeleted:a,onDeleted:r}=qe(u,y);async function c(){console.log(i.value),B(i.value.join(","),s=>{a()})}async function T(s){const{data:o,error:g}=await J(s);g||r()}function F(s){z(s)}async function B(s,o){const{data:g,error:G}=await J(s);if(!G)o&&o(g);else return!1}const b=s=>{y()},E=()=>{y()};return(s,o)=>{const g=Z,G=de,le=ue,se=pe,ie=be,re=ae,H=I("no-auth");return m(),P("div",Ve,[e(Me,{model:l(w),"onUpdate:model":o[0]||(o[0]=k=>V(w)?w.value=k:null),onReset:E,onSearch:l(y),provinceList:x.value},null,8,["model","onSearch","provinceList"]),e(re,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(g,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>o[4]||(o[4]=[M("div",null,"调度列表",-1)])),_:1,__:[4]})]),"header-extra":t(()=>[e(g,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[A((m(),U(l(_),{onClick:l(N),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(G,{class:"text-icon"})]),default:t(()=>[o[5]||(o[5]=p(" "+h("新增")))]),_:1,__:[5]},8,["onClick"])),[[H,"project:Dispatch:insert"]]),e(l(Q),{onPositiveClick:c},{trigger:t(()=>[A((m(),U(l(_),{size:"small",ghost:"",type:"error",disabled:l(i).length==0},{icon:t(()=>[e(le,{class:ke(["text-icon",{"animate-spin":l(j)}])},null,8,["class"])]),default:t(()=>[o[6]||(o[6]=p(" "+h("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[H,"project:Dispatch:delete"]])]),default:t(()=>[o[7]||(o[7]=p(" 确定要删除选中的调度吗？ "))]),_:1,__:[7]}),e(se,{columns:l(C),"onUpdate:columns":o[1]||(o[1]=k=>V(C)?C.value=k:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ie,{"checked-row-keys":l(i),"onUpdate:checkedRowKeys":o[2]||(o[2]=k=>V(i)?i.value=k:null),columns:l(n),data:l(u),size:"small","flex-height":!l($).isMobile,loading:l(j),remote:"","row-key":k=>k.id,pagination:l(R),class:"sm:h-full","onUpdate:filters":b},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Pe,{visible:l(L),"onUpdate:visible":o[3]||(o[3]=k=>V(L)?L.value=k:null),onSubmitted:l(y),"operate-type":l(d),provinceList:x.value,"row-data":l(D)},null,8,["visible","onSubmitted","operate-type","provinceList","row-data"])]),_:1})])}}});export{tt as default};
