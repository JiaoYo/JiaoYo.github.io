import{_ as pe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BD5EmZdz.js";import{_ as me}from"./refresh-D5qCRGpf.js";import{_ as _e}from"./round-delete-Byh6SRU2.js";import{_ as fe}from"./round-plus-CZqFpiNq.js";import{d as A,p as q,q as X,s as Y,b as he,r as ve,ab as ge,z as j,o as F,c as L,w as t,g as e,h as r,t as D,i as a,$ as c,C as ee,A as z,dZ as te,d_ as ye,d$ as be,L as ae,M as we,aV as ke,P as E,aW as Ce,Q as ne,B as P,c0 as xe,c1 as Ne,a6 as oe,a0 as De,e0 as ze,b7 as Se,k as Q,e1 as $e,e2 as Ie,e as Pe,aH as K,f as se,af as Ue,aI as Te,ca as Be,aK as Re}from"./index-B-HmciRB.js";import{u as Me,a as Ve}from"./table-CbT8k4P-.js";import{a as je,b as Fe}from"./basic_config-DeMn_bv6.js";import{_ as Ge}from"./round-search-D3NIxLnI.js";import{_ as Ke}from"./round-refresh-Ef9F8L1S.js";import{_ as Le}from"./FormItemGridItem-DphoIt9J.js";import{_ as Oe}from"./Grid-Vvkivldk.js";import{N as Z}from"./Popconfirm-B5Sdc9gk.js";const We=A({name:"OperateDrawer",__name:"operate-drawer",props:q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["submitted"],["update:visible"]),setup(y,{emit:B}){const u=y,k=B,f=X(y,"visible"),{formRef:s,validate:U,restoreValidation:R}=Y(),S=he(()=>({add:"新增白名单",edit:"编辑白名单"})[u.operateType]),i=ve($());function $(){return{ip:"",status:0,sysparam:0,dscb:""}}const h={ip:{required:!0,validator:te,trigger:["input","change","blur","password-input"]}};function b(){Object.assign(i,$()),u.operateType==="edit"&&u.rowData&&Object.assign(i,u.rowData)}function w(){f.value=!1}async function v(){var C,l;if(await U(),u.operateType==="add"){const{data:x,error:d}=await ye([i]);d||((C=window.$message)==null||C.success(c("common.addSuccess")),w(),k("submitted"))}else{const{data:x,error:d}=await be([i]);d||((l=window.$message)==null||l.success(c("common.updateSuccess")),w(),k("submitted"))}}return ge(f,()=>{f.value&&(b(),R())}),(C,l)=>{const x=ae,d=we,p=ke,T=E,M=Ce,V=ne,N=P,O=xe,W=Ne,G=j("no-space");return F(),L(W,{show:f.value,"onUpdate:show":l[3]||(l[3]=g=>f.value=g),"display-directive":"show",width:360},{default:t(()=>[e(O,{title:S.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(T,{size:16},{default:t(()=>[e(N,{onClick:w},{default:t(()=>[r(D(a(c)("common.cancel")),1)]),_:1}),e(N,{type:"primary",onClick:v,ghost:""},{default:t(()=>[r(D(a(c)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(V,{ref_key:"formRef",ref:s,model:i,rules:h,onKeyup:ee(v,["enter"])},{default:t(()=>[e(d,{label:"IP",path:"ip"},{default:t(()=>[z(e(x,{clearable:"",value:i.ip,"onUpdate:value":l[0]||(l[0]=g=>i.ip=g),placeholder:"请输入IP"},null,8,["value"]),[[G]])]),_:1}),e(d,{label:"状态"},{default:t(()=>[e(M,{value:i.status,"onUpdate:value":l[1]||(l[1]=g=>i.status=g),name:"radiogroup"},{default:t(()=>[e(T,null,{default:t(()=>[e(p,{value:0},{default:t(()=>[r("启用")]),_:1}),e(p,{value:1},{default:t(()=>[r("禁用")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),e(d,{label:"描述",path:"dscb"},{default:t(()=>[z(e(x,{clearable:"",value:i.dscb,"onUpdate:value":l[2]||(l[2]=g=>i.dscb=g),placeholder:"请输入描述"},null,8,["value"]),[[G]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),qe=A({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["reset","search"],["update:model"]),setup(y,{emit:B}){const u=B,{formRef:k,restoreValidation:f}=Y(),s=X(y,"model"),U={ip:[{validator:te,trigger:["blur","change","input"]}]};function R(){s.value.fuzzy=void 0,s.value.ip=s.value.ip==""?void 0:s.value.ip,u("search")}function S(){s.value.ip=void 0,u("search")}async function i(){await f(),u("reset")}async function $(){u("search")}return(h,b)=>{const w=ae,v=Le,C=Ke,l=P,x=Ge,d=E,p=Oe,T=ne,M=oe,V=j("no-space");return F(),L(M,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(T,{ref_key:"formRef",ref:k,model:s.value,"label-placement":"left",rules:U,"label-width":80,"show-require-mark":!1,onKeyup:ee($,["enter"])},{default:t(()=>[e(p,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:t(()=>[e(v,{span:"24 s:12 m:8 l:6",label:"名称",path:"fuzzy"},{default:t(()=>[z(e(w,{clearable:"",value:s.value.fuzzy,"onUpdate:value":b[0]||(b[0]=N=>s.value.fuzzy=N),placeholder:"请输入关键字",onClear:R},null,8,["value"]),[[V]])]),_:1}),e(v,{span:"24 s:12 m:8 l:6",label:"IP",path:"ip"},{default:t(()=>[z(e(w,{clearable:"",value:s.value.ip,"onUpdate:value":b[1]||(b[1]=N=>s.value.ip=N),placeholder:"请输入IP",onClear:S},null,8,["value"]),[[V]])]),_:1}),e(v,{span:"24  s:12 m:8 l:6"},{default:t(()=>[e(d,{class:"w-full"},{default:t(()=>[e(l,{onClick:i},{icon:t(()=>[e(C,{class:"text-icon"})]),default:t(()=>[r(" "+D(a(c)("common.reset")),1)]),_:1}),e(l,{type:"primary",ghost:"",onClick:$},{icon:t(()=>[e(x,{class:"text-icon"})]),default:t(()=>[r(" "+D(a(c)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ae={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"},Ee=se("div",null,"白名单",-1),He={class:"font-size-14px flex align-center gap-8px"};function J(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Te(y)}const it=A({name:"manage_whitelist",__name:"index",setup(y){const B=De(),{columns:u,columnChecks:k,data:f,getData:s,loading:U,mobilePagination:R,searchParams:S,resetSearchParams:i}=Me({apiFn:ze,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,ip:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,disabled:n=>n.sysparam==0},{key:"ip",title:"IP地址",align:"center",width:240},{key:"dscb",title:"描述",align:"center",width:240},{key:"status",title:"状态",width:100,align:"center",render:n=>(n.status===null&&(n.status=0),e(Se,{type:{0:"success",1:"error"}[n.status]},{default:()=>[n.status==0?"启用":"禁用"]}))},{key:"operate",title:c("common.operate"),align:"center",width:130,render:n=>{let o;return e("div",{class:"flex-center gap-8px"},[z(e(P,{type:"primary",ghost:!0,size:"small",onClick:()=>G(n.id),disabled:n.sysparam==0||h.value==0},J(o=c("common.edit"))?o:{default:()=>[o]}),[[j("no-auth"),"sys.white.list.update"]]),e(Z,{onPositiveClick:()=>W(n.id)},{default:()=>c("common.confirmDelete"),trigger:()=>{let m;return z(e(P,{type:"error",ghost:!0,size:"small",disabled:n.sysparam==0||h.value==0},J(m=c("common.delete"))?m:{default:()=>[m]}),[[j("no-auth"),"sys.white.list.delete"]])}})])}}]}),$=()=>{s()},h=Q(),b=Q(),w=async()=>{const{data:n,error:o}=await je();if(!o)h.value=n.whiteenable,b.value=n.id;else return!1};w();const{drawerVisible:v,operateType:C,editingData:l,handleAdd:x,handleEdit:d,checkedRowKeys:p,onBatchDeleted:T,onDeleted:M,closeDrawer:V}=Ve(f,s),N=async n=>{var I;const{data:o,error:m}=await Fe({whiteenable:n?1:0,id:b.value});if(!m)(I=window.$message)==null||I.success("操作成功"),w();else return!1};async function O(){console.log(p.value),g(p.value.join(","),n=>{T()})}function W(n){console.log(n),g(n,o=>{M()})}function G(n){d(n),$e({id:n}).then(({data:o,error:m})=>{m||console.log(o)})}async function g(n,o){const{data:m,error:I}=await Ie(n);if(!I)o&&o(m);else return!1}return(n,o)=>{const m=Be,I=E,le=fe,ie=_e,ce=me,re=pe,ue=Re,de=oe,H=j("no-auth");return F(),Pe("div",Ae,[e(qe,{model:a(S),"onUpdate:model":o[0]||(o[0]=_=>K(S)?S.value=_:null),onReset:a(i),onSearch:a(s)},null,8,["model","onReset","onSearch"]),e(de,{bordered:!1,size:"small",class:"sm:flex-1-hidden"},{header:t(()=>[e(I,{align:"center"},{default:t(()=>[Ee,se("div",He,[r(" 是否启用白名单"),e(m,{value:h.value,"onUpdate:value":[o[1]||(o[1]=_=>h.value=_),N],"checked-value":1,"unchecked-value":0},{checked:t(()=>[r(" 是 ")]),unchecked:t(()=>[r(" 否 ")]),_:1},8,["value"])])]),_:1})]),"header-extra":t(()=>[e(I,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[z((F(),L(a(P),{size:"small",ghost:"",type:"primary",onClick:a(x),disabled:h.value==0},{icon:t(()=>[e(le,{class:"text-icon"})]),default:t(()=>[r(" "+D(a(c)("common.add")),1)]),_:1},8,["onClick","disabled"])),[[H,"sys.white.list.insert"]]),z((F(),L(a(Z),{onPositiveClick:O},{trigger:t(()=>[e(a(P),{size:"small",ghost:"",type:"error",disabled:a(p).length===0||h.value==0},{icon:t(()=>[e(ie,{class:"text-icon"})]),default:t(()=>[r(" "+D(a(c)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:t(()=>[r(" "+D(a(c)("common.confirmDelete")),1)]),_:1})),[[H,"sys.white.list.delete"]]),e(a(P),{size:"small",onClick:$},{icon:t(()=>[e(ce,{class:Ue(["text-icon",{"animate-spin":a(U)}])},null,8,["class"])]),default:t(()=>[r(" "+D(a(c)("common.refresh")),1)]),_:1}),e(re,{columns:a(k),"onUpdate:columns":o[2]||(o[2]=_=>K(k)?k.value=_:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ue,{"checked-row-keys":a(p),"onUpdate:checkedRowKeys":o[3]||(o[3]=_=>K(p)?p.value=_:null),columns:a(u),data:a(f),size:"small","flex-height":!a(B).isMobile,"scroll-x":962,loading:a(U),remote:"","row-key":_=>_.id,pagination:a(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(We,{visible:a(v),"onUpdate:visible":o[4]||(o[4]=_=>K(v)?v.value=_:null),"operate-type":a(C),"row-data":a(l),onSubmitted:a(s)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{it as default};
