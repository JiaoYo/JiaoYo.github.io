import{_ as qe}from"./round-plus-CK9DqpBO.js";import{aK as Me,aH as ae,aJ as De,b2 as Re,aI as j,d as F,aM as Te,b3 as ze,b4 as je,b5 as A,a5 as Ae,aO as Be,b6 as R,aS as K,b7 as Ee,C as Ue,b8 as Ve,b as se,o as y,e as E,f as C,a4 as Le,j as v,r as Oe,g as n,J as D,Z as le,B as w,$ as L,aw as q,h as g,A as Ge,D as re,w as a,i as _,t as O,F as Ke,E as G,ao as Fe,am as Je,c as B,ai as We,b9 as He,N as Qe,ad as Ze,K as Xe,O as Ye,af as et,ag as tt,aj as nt,ar as at,P as st,Q as lt,aa as rt,aB as oe,_ as ot,ba as it,R as ut}from"./index-DOohPrRP.js";import{l as ie}from"./lodash-ffFD2ya4.js";import{d as ct,e as ue,g as dt}from"./basic-config-5gTERu5z.js";import{_ as pt}from"./FormItemGridItem-BscgKSfD.js";import{_ as ft}from"./Grid-CohnLNvv.js";const mt=Re(24,null).map((i,p)=>{const f=p+1,l=`calc(100% / 24 * ${f})`;return[j(`${f}-span`,{width:l}),j(`${f}-offset`,{marginLeft:l}),j(`${f}-push`,{left:l}),j(`${f}-pull`,{right:l})]}),_t=Me([ae("row",{width:"100%",display:"flex",flexWrap:"wrap"}),ae("col",{verticalAlign:"top",boxSizing:"border-box",display:"inline-block",position:"relative",zIndex:"auto"},[De("box",{position:"relative",zIndex:"auto",width:"100%",height:"100%"}),mt])]),ce=Ee("n-row"),gt={gutter:{type:[Array,Number,String],default:0},alignItems:String,justifyContent:String},vt=F({name:"Row",props:gt,setup(i){const{mergedClsPrefixRef:p,mergedRtlRef:f}=Te(i);ze("-legacy-grid",_t,p);const l=je("Row",f,p),I=A(()=>{const{gutter:c}=i;return Array.isArray(c)&&c[1]||0}),x=A(()=>{const{gutter:c}=i;return Array.isArray(c)?c[0]:Number(c)});return Ae(ce,{mergedClsPrefixRef:p,gutterRef:Be(i,"gutter"),verticalGutterRef:I,horizontalGutterRef:x}),{mergedClsPrefix:p,rtlEnabled:l,styleMargin:A(()=>`-${R(I.value,{c:.5})} -${R(x.value,{c:.5})}`),styleWidth:A(()=>`calc(100% + ${R(x.value)})`)}},render(){return K("div",{class:[`${this.mergedClsPrefix}-row`,this.rtlEnabled&&`${this.mergedClsPrefix}-row--rtl`],style:{margin:this.styleMargin,width:this.styleWidth,alignItems:this.alignItems,justifyContent:this.justifyContent}},this.$slots)}}),ht={span:{type:[String,Number],default:1},push:{type:[String,Number],default:0},pull:{type:[String,Number],default:0},offset:{type:[String,Number],default:0}},bt=F({name:"Col",props:ht,setup(i){const p=Ue(ce,null);return p||Ve("col","`n-col` must be placed inside `n-row`."),{mergedClsPrefix:p.mergedClsPrefixRef,gutter:p.gutterRef,stylePadding:se(()=>`${R(p.verticalGutterRef.value,{c:.5})} ${R(p.horizontalGutterRef.value,{c:.5})}`),mergedPush:se(()=>Number(i.push)-Number(i.pull))}},render(){const{$slots:i,span:p,mergedPush:f,offset:l,stylePadding:I,gutter:x,mergedClsPrefix:c}=this;return K("div",{class:[`${c}-col`,{[`${c}-col--${p}-span`]:!0,[`${c}-col--${f}-push`]:f>0,[`${c}-col--${-f}-pull`]:f<0,[`${c}-col--${l}-offset`]:l}],style:{padding:I}},x?K("div",null,i):i)}}),kt={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},wt=C("path",{fill:"currentColor",d:"M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h11.175q.4 0 .763.15t.637.425l2.85 2.85q.275.275.425.638t.15.762V19q0 .825-.587 1.413T19 21zM19 7.85L16.15 5H5v14h14zM12 18q1.25 0 2.125-.875T15 15t-.875-2.125T12 12t-2.125.875T9 15t.875 2.125T12 18m-5-8h7q.425 0 .713-.288T15 9V7q0-.425-.288-.712T14 6H7q-.425 0-.712.288T6 7v2q0 .425.288.713T7 10M5 7.85V19V5z"},null,-1),yt=[wt];function xt(i,p){return y(),E("svg",kt,[...yt])}const $t={name:"material-symbols-save-outline-rounded",render:xt},St={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Ct=C("path",{fill:"currentColor",d:"m9.25 22l-.4-3.2q-.325-.125-.612-.3t-.563-.375L4.7 19.375l-2.75-4.75l2.575-1.95Q4.5 12.5 4.5 12.338v-.675q0-.163.025-.338L1.95 9.375l2.75-4.75l2.975 1.25q.275-.2.575-.375t.6-.3l.4-3.2h5.5l.4 3.2q.325.125.613.3t.562.375l2.975-1.25l2.75 4.75l-2.575 1.95q.025.175.025.338v.674q0 .163-.05.338l2.575 1.95l-2.75 4.75l-2.95-1.25q-.275.2-.575.375t-.6.3l-.4 3.2zm2.8-6.5q1.45 0 2.475-1.025T15.55 12t-1.025-2.475T12.05 8.5q-1.475 0-2.488 1.025T8.55 12t1.013 2.475T12.05 15.5"},null,-1),It=[Ct];function Nt(i,p){return y(),E("svg",St,[...It])}const Pt={name:"material-symbols-settings",render:Nt},de=i=>(st("data-v-2c2d1c59"),i=i(),lt(),i),qt={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"},Mt={class:"lan-network"},Dt=de(()=>C("span",{class:"font-size-16px font-700"},"系统网络配置",-1)),Rt=de(()=>C("span",{style:{width:"3px",height:"15px",background:"#1980ff",display:"inline-block","margin-right":"5px","border-radius":"20px"}},null,-1)),Tt={class:"w-100% h-100% flex-col"};function zt(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!We(i)}const jt=F({name:"basicconfig_network-manage",__name:"index",setup(i){const p=Le(),f=()=>{let e=[];for(let t=1;t<=32;t++)e.push({label:t+"",value:t,name:He(t)});return e},l=v([{id:1,nname:"eno1",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",curr:null,checked2:[],list2:[]},{id:2,nname:"eno2",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",curr:null,checked2:[],list2:[]},{id:3,nname:"eno3",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",curr:null,checked2:[],list2:[]},{id:4,nname:"eno4",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",curr:null,checked2:[],list2:[]},{id:5,nname:"eno5",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",curr:null,checked2:[],list2:[]},{id:6,nname:"eno6",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",curr:null,checked2:[],list2:[]},{id:7,nname:"eno7",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",curr:null,checked2:[],list2:[]},{id:8,nname:"eno8",nip:"",nmaskbits:null,nmask:"",predns:"",bakdns:"",gateway:"",curr:null,checked2:[],list2:[]}]),I=Oe([{key:"ip",title:"目标",width:240,align:"center",render:e=>n(D,{value:e.ip,clearable:!0,"onUpdate:value":t=>e.ip=t,status:e.inputStatus?"error":"success",onBlur:()=>J(e,e.ip),onInput:t=>J(e,t)},null)},{key:"netMask",title:"掩码",align:"center",width:240,render:e=>(console.log(e.netMask),n(le,{renderLabel:Y,value:e.netMask,clearable:!0,status:e.selectStatus?"error":"success",onBlur:()=>H(e,e.netMask),"onUpdate:value":t=>H(e,t),options:f()},null))},{key:"nextip",title:"下一跳",align:"center",width:240,render:e=>n(D,{value:e.nextip,"onUpdate:value":t=>e.nextip=t,clearable:!0,status:e.inputStatus1?"error":"success",onBlur:()=>W(e,e.nextip),onInput:t=>W(e,t)},null)},{key:"operate",title:"操作",align:"center",width:130,fixed:"right",render:(e,t)=>{let r;return n("div",{class:"flex-center gap-8px"},[n(w,{type:"error",ghost:!0,size:"small",onClick:()=>x(t)},zt(r=L("common.delete"))?r:{default:()=>[r]})])}}]),x=e=>{N.value.splice(e,1)},c=v(-1),U=v(""),V=async()=>{var r;const{data:e,error:t}=await ct();if(e){if(e.hasOwnProperty("data")){c.value=-1;return}const s=JSON.parse(JSON.stringify(e));c.value=s.findIndex(o=>o.curr),U.value=(r=s.find(o=>o.curr))==null?void 0:r.nip,l.value.forEach((o,h)=>{const b=s.find(S=>S.nname.charAt(S.nname.length-1)==o.id);b&&(l.value[h]={...b,id:h+1})})}},$=v(),pe={nip:[{required:!0,message:"请输入IP地址",trigger:["input","change","blur","password-input"]},{validator:oe,trigger:["input","change","blur","password-input"]}],nmaskbits:{required:!0,validator:(e,t)=>new Promise((r,s)=>{t==0||t==null?s(new Error("请选择掩码")):r()}),trigger:["input","change","blur"]}},fe={nip:[{required:!0,message:"请输入IP地址",trigger:["input"]},{validator:oe,trigger:["input"]}],nmaskbits:{required:!0,validator:(e,t)=>new Promise((r,s)=>{t==0||t==null?s(new Error("请选择掩码")):r()}),trigger:["change"]}},J=(e,t)=>{e.inputStatus=!q(t)},W=(e,t)=>{e.inputStatus1=!q(t)},H=(e,t)=>{e.netMask=t,e.selectStatus=t==null},me=async()=>{var s,o,h,b,S;const e=l.value.findIndex(d=>!d.nip&&d.nmaskbits||d.nip&&!d.nmaskbits);e!=-1&&await $.value[e].validate(),$.value[c.value].validate();const t=l.value.filter((d,k)=>{if(d.nip&&d.nmaskbits)return d.nip&&d.nmaskbits;!d.nip&&!d.nmaskbits&&$.value[k].restoreValidation()});if(t.length==0)return(s=window.$message)==null?void 0:s.warning("请至少设置一个网口的配置");const r=(o=l.value.find(d=>d.curr))==null?void 0:o.nip;if(r!=U.value)(h=window.$dialog)==null||h.warning({title:"提示",content:"检测到您要修改当前网关的IP地址，确认要修改吗？",positiveText:"确认",negativeText:"取消",positiveButtonProps:{type:"info",ghost:!0},onPositiveClick:async()=>{const d=window.location.href.replace(new RegExp(U.value,"g"),r);setTimeout(()=>{window.location.href=d},3e3);try{const{data:k,error:ee}=await ue(t)}catch{}}});else try{const{data:d,error:k}=await ue(t);k||((b=window.$message)==null||b.destroyAll(),(S=window.$message)==null||S.success("配置成功"),V())}catch(d){console.error(d)}},_e=e=>{l.value[e].nmaskbits||setTimeout(()=>{$.value[e].restoreValidation()},100)},ge=e=>{l.value[e].nip||setTimeout(()=>{$.value[e].restoreValidation()},100)},T=v(!1),z=v(0),N=v(),ve=async e=>{await $.value[e].validate(),T.value=!0,z.value=e,N.value=ie.cloneDeep(l.value[e].list2)?ie.cloneDeep(l.value[e].list2).map((t,r)=>{const[s,o]=t.ip.split("/");return{...t,id:r+1,ip:s,netMask:o&&Number(o)}}):[]},he=()=>{var r;if(!(s=>{for(const o of s){if(!q(o.ip))return o.inputStatus=!0,!1;if(o.netMask==null||o.netMask==0)return o.selectStatus=!0,!1;if(!q(o.nextip))return o.inputStatus1=!0,!1}return!0})(N.value))return(r=window.$message)==null?void 0:r.warning("目标IP、掩码、下一跳IP不能为空或IP格式错误，请检查后重试");l.value[z.value].list2=N.value.map(s=>(s.ip=s.ip+"/"+s.netMask,s.netMask=null,s.id=void 0,s.inputStatus=void 0,s.inputStatus1=void 0,s.selectStatus=void 0,s)),T.value=!1},Q=v(),m=v({visible:!1,dns1:"",dns2:""}),be={dns1:{required:!0,trigger:["blur","input","change"],validator:(e,t)=>t?q(t)?!0:new Error("请输入正确的DNS"):new Error("请输入DNS")},dns2:{required:!1,trigger:["input","change"],validator:(e,t)=>t?q(t)?!0:new Error("请输入正确的DNS"):!0}},ke=()=>{m.value.visible=!0,m.value.dns1=l.value[c.value].predns,m.value.dns2=l.value[c.value].bakdns},Z=async()=>{var r,s;const{data:e,error:t}=await dt({dns1:m.value.dns1,dns2:m.value.dns2});t||((r=window.$message)==null||r.destroyAll(),(s=window.$message)==null||s.success("配置成功"),V(),X())},we=e=>{setTimeout(()=>{Q.value.restoreValidation()},100)},X=()=>{m.value.visible=!1,m.value.dns1="",m.value.dns2=""},Y=e=>n("div",{style:{display:"flex",alignItems:"center"}},[n("span",null,[e.label]),n("span",{style:{fontSize:"12px",marginLeft:"20px"}},[g("("),e.name,g(")")])]);return Ge(()=>{V()}),(e,t)=>{const r=Pt,s=Qe,o=Ze,h=Xe,b=Ye,S=et,d=tt,k=ot,ee=it,te=pt,ye=ft,xe=bt,$e=vt,Se=$t,Ce=qe,Ie=nt,Ne=at,ne=re("no-space"),Pe=re("no-auth");return y(),E("div",qt,[C("div",Mt,[n(o,{bordered:!0,size:"small"},{default:a(()=>[n(s,{justify:"space-between",align:"center",class:"w-100%"},{default:a(()=>[Dt,n(_(w),{type:"info",ghost:"",onClick:ke},{icon:a(()=>[n(r,{class:"text-icon"})]),default:a(()=>[g(" DNS配置 ")]),_:1})]),_:1})]),_:1}),n(d,{show:m.value.visible,"onUpdate:show":t[2]||(t[2]=u=>m.value.visible=u),"display-directive":"show",width:300},{default:a(()=>[n(S,{title:"设置DNS","native-scrollbar":!1,closable:""},{footer:a(()=>[n(s,{size:16},{default:a(()=>[n(_(w),{onClick:X},{default:a(()=>[g(O(_(L)("common.cancel")),1)]),_:1}),n(_(w),{type:"primary",onClick:Z},{default:a(()=>[g(O(_(L)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[n(b,{ref_key:"formRef",ref:Q,model:m.value,rules:be,onKeyup:Ke(Z,["enter"])},{default:a(()=>[n(h,{label:"DNS(首选)",path:"dns1"},{default:a(()=>[G(n(_(D),{clearable:"",value:m.value.dns1,"onUpdate:value":t[0]||(t[0]=u=>m.value.dns1=u),placeholder:"请输入IP"},null,8,["value"]),[[ne]])]),_:1}),n(h,{label:"DNS(备用)",path:"dns2"},{default:a(()=>[G(n(_(D),{clearable:"",value:m.value.dns2,"onUpdate:value":t[1]||(t[1]=u=>m.value.dns2=u),onClear:we,placeholder:"请输入IP"},null,8,["value"]),[[ne]])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])]),n($e,{gutter:[12,12]},{default:a(()=>[(y(!0),E(Fe,null,Je(l.value,(u,M)=>(y(),B(xe,{span:12,key:u.nname},{default:a(()=>[n(o,{bordered:!0,size:"small"},{header:a(()=>[C("div",{style:rt({color:_(p).themeScheme==="dark"?"#fff":"#000",fontWeight:"bolder",padding:"5px",fontSize:"18px",marginBottom:"10px",display:"flex",alignItems:"center"})},[Rt,g(" "+O(u.nname)+"网络配置   ",1),Number(u.nname.charAt(u.nname.length-1)||u.nname.replace("eno",""))==c.value+1?(y(),B(k,{key:0,"local-icon":"lan-active",style:{"font-size":"24px"},class:"animation"})):(y(),B(k,{key:1,"local-icon":"lan-default",style:{"font-size":"24px"}}))],4)]),"header-extra":a(()=>[n(ee,{value:u.list2.length,max:100,type:"info"},{default:a(()=>[n(_(w),{type:"info",ghost:"",onClick:P=>ve(M),class:"ml-20px"},{icon:a(()=>[n(r,{class:"text-icon"})]),default:a(()=>[g(" 网关路由 ")]),_:2},1032,["onClick"])]),_:2},1032,["value"])]),default:a(()=>[n(b,{ref_for:!0,ref_key:"IpformRef",ref:$,model:u,rules:c.value==M?pe:fe,"label-placement":"left","label-width":70,"show-require-mark":c.value==M,"require-mark-placement":"left"},{default:a(()=>[n(ye,{responsive:"screen","item-responsive":""},{default:a(()=>[n(te,{span:"24 s:12 m:12",label:"IP地址",path:"nip"},{default:a(()=>[n(_(D),{clearable:"",placeholder:"请输入IP地址",value:u.nip,"onUpdate:value":P=>u.nip=P,onClear:P=>_e(M)},null,8,["value","onUpdate:value","onClear"])]),_:2},1024),n(te,{span:"24 s:12 m:12",label:"掩码",path:"nmaskbits"},{default:a(()=>[n(_(le),{"render-label":Y,clearable:"",options:f(),placeholder:"请选择掩码位数",value:u.nmaskbits,"onUpdate:value":P=>u.nmaskbits=P,onClear:P=>ge(M)},null,8,["options","value","onUpdate:value","onClear"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["model","rules","show-require-mark"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),n(s,{justify:"center",class:"w-100%"},{default:a(()=>[G((y(),B(_(w),{type:"info",ghost:"",onClick:me,"icon-placement":"left"},{icon:a(()=>[n(Se)]),default:a(()=>[g(" 应用配置 ")]),_:1})),[[Pe,"sys.network.update"]])]),_:1}),n(Ne,{show:T.value,"onUpdate:show":t[4]||(t[4]=u=>T.value=u),title:l.value[z.value].nname+"网关路由配置",preset:"card","mask-closable":!1,class:"w-900px h-500px"},{footer:a(()=>[n(s,{size:16,justify:"end"},{default:a(()=>[n(_(w),{type:"primary",onClick:he},{default:a(()=>[g("保存")]),_:1})]),_:1})]),default:a(()=>[C("div",Tt,[n(s,{justify:"end",align:"center",class:"w-100% mb-10px"},{default:a(()=>[n(_(w),{size:"small",ghost:"",type:"primary",onClick:t[3]||(t[3]=u=>N.value.push({id:l.value[z.value].list2.length+1,ip:"",nextip:"",netMask:null}))},{icon:a(()=>[n(Ce,{class:"text-icon"})]),default:a(()=>[g(" 添加")]),_:1})]),_:1}),n(Ie,{columns:I,data:N.value,size:"small",remote:"","row-key":u=>u.id,class:"sm:h-full","max-height":280},null,8,["columns","data","row-key"])])]),_:1},8,["show","title"])])}}}),Ot=ut(jt,[["__scopeId","data-v-2c2d1c59"]]);export{Ot as default};
