import{_ as ue}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CCvnnz1-.js";import{_ as pe}from"./refresh-CjKIJ-Gm.js";import{_ as de}from"./round-delete-wrLYiM23.js";import{_ as me}from"./round-plus-CR3by7B7.js";import{d as A,n as O,p as Z,q as J,b as _e,r as fe,a6 as he,y as j,o as F,c as W,w as t,g as e,h as u,t as k,i as n,$ as r,A as Q,z as C,cW as ve,cX as ge,cY as ye,H as ee,I as be,K as q,L as te,B as S,bL as we,bM as ke,a1 as ae,U as Ce,cZ as xe,aN as Ne,j as H,c_ as De,c$ as ze,e as Se,al as V,f as ne,aa as $e,am as Ie,bW as Ue}from"./index-Pu-ecW3m.js";import{u as Pe,a as Te}from"./table-B-tC3aJN.js";import{f as Be,a as Re}from"./basic_config-BGGXK-Ta.js";import{_ as Me,a as je}from"./RadioGroup-CdePeEWq.js";import{_ as Fe}from"./round-search-BTMYWU48.js";import{_ as Le}from"./round-refresh-CjnR0Dcy.js";import{_ as Ve}from"./FormItemGridItem-BuP4tzlJ.js";import{_ as We}from"./Grid-cx5oYJRf.js";import{N as X}from"./Popconfirm-Dhct3qWO.js";import{_ as Ge}from"./DataTable-BT2dbSfK.js";import"./Forward-Bwa4pvoO.js";const Ke=A({name:"OperateDrawer",__name:"operate-drawer",props:O({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:O(["submitted"],["update:visible"]),setup(v,{emit:T}){const p=v,b=T,h=Z(v,"visible"),{formRef:s,validate:$,restoreValidation:B}=J(),x=_e(()=>({add:"新增白名单",edit:"编辑白名单"})[p.operateType]),l=fe(d());function d(){return{ip:"",status:0,sysparam:0,dscb:""}}const g={ip:{required:!0,validator:ve,trigger:["input","change","blur","password-input"]}};function N(){Object.assign(l,d()),p.operateType==="edit"&&p.rowData&&Object.assign(l,p.rowData)}function m(){h.value=!1}async function I(){var y,c;if(await $(),p.operateType==="add"){const{data:w,error:i}=await ge([l]);i||((y=window.$message)==null||y.success(r("common.addSuccess")),m(),b("submitted"))}else{const{data:w,error:i}=await ye([l]);i||((c=window.$message)==null||c.success(r("common.updateSuccess")),m(),b("submitted"))}}return he(h,()=>{h.value&&(N(),B())}),(y,c)=>{const w=ee,i=be,U=Me,P=q,R=je,D=te,L=S,G=we,K=ke,M=j("no-space");return F(),W(K,{show:h.value,"onUpdate:show":c[3]||(c[3]=a=>h.value=a),"display-directive":"show",width:360},{default:t(()=>[e(G,{title:x.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(P,{size:16},{default:t(()=>[e(L,{onClick:m},{default:t(()=>[u(k(n(r)("common.cancel")),1)]),_:1}),e(L,{type:"primary",onClick:I,ghost:""},{default:t(()=>[u(k(n(r)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(D,{ref_key:"formRef",ref:s,model:l,rules:g,onKeyup:Q(I,["enter"])},{default:t(()=>[e(i,{label:"IP",path:"ip"},{default:t(()=>[C(e(w,{clearable:"",value:l.ip,"onUpdate:value":c[0]||(c[0]=a=>l.ip=a),placeholder:"请输入IP"},null,8,["value"]),[[M]])]),_:1}),e(i,{label:"状态"},{default:t(()=>[e(R,{value:l.status,"onUpdate:value":c[1]||(c[1]=a=>l.status=a),name:"radiogroup"},{default:t(()=>[e(P,null,{default:t(()=>[e(U,{value:0},{default:t(()=>[u("启用")]),_:1}),e(U,{value:1},{default:t(()=>[u("禁用")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),e(i,{label:"描述",path:"dscb"},{default:t(()=>[C(e(w,{clearable:"",value:l.dscb,"onUpdate:value":c[2]||(c[2]=a=>l.dscb=a),placeholder:"请输入描述"},null,8,["value"]),[[M]])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Oe=A({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:O(["reset","search"],["update:model"]),setup(v,{emit:T}){const p=T,{formRef:b,restoreValidation:h}=J(),s=Z(v,"model");function $(){s.value.fuzzy=void 0,s.value.ip=s.value.ip==""?void 0:s.value.ip,p("search")}function B(){s.value.ip=void 0,p("search")}async function x(){await h(),p("reset")}async function l(){p("search")}return(d,g)=>{const N=ee,m=Ve,I=Le,y=S,c=Fe,w=q,i=We,U=te,P=ae,R=j("no-space");return F(),W(P,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(U,{ref_key:"formRef",ref:b,model:s.value,"label-placement":"left","label-width":80,"show-feedback":!1,onKeyup:Q(l,["enter"])},{default:t(()=>[e(i,{responsive:"screen","item-responsive":""},{default:t(()=>[e(m,{span:"24 s:12 m:6",label:"名称",path:"fuzzy",class:"pr-24px"},{default:t(()=>[C(e(N,{clearable:"",value:s.value.fuzzy,"onUpdate:value":g[0]||(g[0]=D=>s.value.fuzzy=D),placeholder:"请输入关键字",onClear:$},null,8,["value"]),[[R]])]),_:1}),e(m,{span:"24 s:12 m:6",label:"IP",path:"ip",class:"pr-24px"},{default:t(()=>[C(e(N,{clearable:"",value:s.value.ip,"onUpdate:value":g[1]||(g[1]=D=>s.value.ip=D),placeholder:"请输入IP",onClear:B},null,8,["value"]),[[R]])]),_:1}),e(m,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(w,{class:"w-full"},{default:t(()=>[e(y,{onClick:x},{icon:t(()=>[e(I,{class:"text-icon"})]),default:t(()=>[u(" "+k(n(r)("common.reset")),1)]),_:1}),e(y,{type:"primary",ghost:"",onClick:l},{icon:t(()=>[e(c,{class:"text-icon"})]),default:t(()=>[u(" "+k(n(r)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ae={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"},qe=ne("div",null,"白名单",-1),Ee={class:"font-size-14px flex align-center gap-8px"};function Y(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Ie(v)}const rt=A({name:"manage_whitelist",__name:"index",setup(v){const T=Ce(),{columns:p,columnChecks:b,data:h,getData:s,loading:$,mobilePagination:B,searchParams:x,resetSearchParams:l}=Pe({apiFn:xe,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,ip:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,disabled:a=>a.sysparam==0},{key:"ip",title:"IP地址",align:"center",width:240},{key:"dscb",title:"描述",align:"center",width:240},{key:"status",title:"状态",width:100,align:"center",render:a=>(a.status===null&&(a.status=0),e(Ne,{type:{0:"success",1:"error"}[a.status]},{default:()=>[a.status==0?"启用":"禁用"]}))},{key:"operate",title:r("common.operate"),align:"center",width:130,render:a=>{let o;return e("div",{class:"flex-center gap-8px"},[C(e(S,{type:"primary",ghost:!0,size:"small",onClick:()=>K(a.id),disabled:a.sysparam==0||d.value==0},Y(o=r("common.edit"))?o:{default:()=>[o]}),[[j("no-auth"),"sys.white.list.update"]]),e(X,{onPositiveClick:()=>G(a.id)},{default:()=>r("common.confirmDelete"),trigger:()=>{let _;return C(e(S,{type:"error",ghost:!0,size:"small",disabled:a.sysparam==0||d.value==0},Y(_=r("common.delete"))?_:{default:()=>[_]}),[[j("no-auth"),"sys.white.list.delete"]])}})])}}]}),d=H(),g=H(),N=async()=>{const{data:a,error:o}=await Be();if(!o)d.value=a.whiteenable,g.value=a.id;else return!1};N();const{drawerVisible:m,operateType:I,editingData:y,handleAdd:c,handleEdit:w,checkedRowKeys:i,onBatchDeleted:U,onDeleted:P,closeDrawer:R}=Te(h,s),D=async a=>{var z;const{data:o,error:_}=await Re({whiteenable:a?1:0,id:g.value});if(!_)(z=window.$message)==null||z.success("操作成功"),N();else return!1};async function L(){console.log(i.value),M(i.value.join(","),a=>{U()})}function G(a){console.log(a),M(a,o=>{P()})}function K(a){w(a),De({id:a}).then(({data:o,error:_})=>{_||console.log(o)})}async function M(a,o){const{data:_,error:z}=await ze(a);if(!z)o&&o(_);else return!1}return(a,o)=>{const _=Ue,z=q,oe=me,se=de,le=pe,ie=ue,ce=Ge,re=ae,E=j("no-auth");return F(),Se("div",Ae,[e(Oe,{model:n(x),"onUpdate:model":o[0]||(o[0]=f=>V(x)?x.value=f:null),onReset:n(l),onSearch:n(s)},null,8,["model","onReset","onSearch"]),e(re,{bordered:!1,size:"small",class:"sm:flex-1-hidden"},{header:t(()=>[e(z,{align:"center"},{default:t(()=>[qe,ne("div",Ee,[u(" 是否启用白名单"),e(_,{value:d.value,"onUpdate:value":[o[1]||(o[1]=f=>d.value=f),D],"checked-value":1,"unchecked-value":0},{checked:t(()=>[u(" 是 ")]),unchecked:t(()=>[u(" 否 ")]),_:1},8,["value"])])]),_:1})]),"header-extra":t(()=>[e(z,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[C((F(),W(n(S),{size:"small",ghost:"",type:"primary",onClick:n(c),disabled:d.value==0},{icon:t(()=>[e(oe,{class:"text-icon"})]),default:t(()=>[u(" "+k(n(r)("common.add")),1)]),_:1},8,["onClick","disabled"])),[[E,"sys.white.list.insert"]]),C((F(),W(n(X),{onPositiveClick:L},{trigger:t(()=>[e(n(S),{size:"small",ghost:"",type:"error",disabled:n(i).length===0||d.value==0},{icon:t(()=>[e(se,{class:"text-icon"})]),default:t(()=>[u(" "+k(n(r)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:t(()=>[u(" "+k(n(r)("common.confirmDelete")),1)]),_:1})),[[E,"sys.white.list.delete"]]),e(n(S),{size:"small",onClick:n(s)},{icon:t(()=>[e(le,{class:$e(["text-icon",{"animate-spin":n($)}])},null,8,["class"])]),default:t(()=>[u(" "+k(n(r)("common.refresh")),1)]),_:1},8,["onClick"]),e(ie,{columns:n(b),"onUpdate:columns":o[2]||(o[2]=f=>V(b)?b.value=f:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(ce,{"checked-row-keys":n(i),"onUpdate:checkedRowKeys":o[3]||(o[3]=f=>V(i)?i.value=f:null),columns:n(p),data:n(h),size:"small","flex-height":!n(T).isMobile,"scroll-x":962,loading:n($),remote:"","row-key":f=>f.id,pagination:n(B),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ke,{visible:n(m),"onUpdate:visible":o[4]||(o[4]=f=>V(m)?m.value=f:null),"operate-type":n(I),"row-data":n(y),onSubmitted:n(s)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{rt as default};
