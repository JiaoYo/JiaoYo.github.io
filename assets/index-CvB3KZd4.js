import{d as F,m as $,a as q,bC as de,bD as ue,ab as R,o as O,b as Q,t as m,ag as pe,bE as fe,c as U,w as o,g as n,e as I,ae as me,a4 as ge,f as ae,bF as be,aH as _e,a6 as se,af as he,k as ve,_ as K,v as we,a0 as Z,bG as H,bH as C,ai as ye,z as xe,aj as Se,r as De,A as Ce,J as ke,b1 as te,b2 as $e,b3 as Te,aD as Me,h,bI as Ne,a$ as V,bJ as Ie,S as Oe,ak as Pe,R as We,p as Ae,i as Le}from"./index-Dh5aZxAY.js";import{_ as oe,a as ne}from"./Grid-DhuTI4T_.js";import{u as le,L}from"./echarts-CouYGFQL.js";import{h as Be}from"./permission-Cj8XNQf9.js";import{G as Ge,h as ze,a as Ee,b as Ve}from"./metar-HlsT9Xg5.js";import{_ as He,a as Re}from"./DescriptionsItem-CEknryh-.js";const Fe="/assets/station-GwqcmkHc.jpeg",je=F({name:"CountTo",__name:"count-to",props:{startValue:{default:0},endValue:{default:2021},duration:{default:1500},autoplay:{type:Boolean,default:!0},decimals:{default:0},prefix:{default:""},suffix:{default:""},separator:{default:","},decimal:{default:"."},useEasing:{type:Boolean,default:!0},transition:{default:"linear"}},setup(D){const t=D,g=$(t.startValue),c=q(()=>t.useEasing?de[t.transition]:void 0),T=ue(g,{disabled:!1,duration:t.duration,transition:c.value}),u=q(()=>f(T.value));function f(p){const{decimals:v,decimal:w,separator:x,suffix:e,prefix:a}=t;let s=p.toFixed(v);s=String(s);const r=s.split(".");let P=r[0];const M=r.length>1?w+r[1]:"",z=/(\d+)(\d{3})/;if(x)for(;z.test(P);)P=P.replace(z,`$1${x}$2`);return a+P+M+e}async function k(){await pe(),g.value=t.endValue}return R([()=>t.startValue,()=>t.endValue],()=>{t.autoplay&&k()},{immediate:!0}),(p,v)=>(O(),Q("span",null,m(u.value),1))}}),Je={class:"ml-20px"},Ue={class:"text-14px"},qe=F({name:"CardData",__name:"card-data",props:{MeteorologicalData:{type:Object}},setup(D){const t=D,g=q(()=>{var f,k,p,v,w,x;return[{key:"envT",title:"温度",value:((f=t.MeteorologicalData)==null?void 0:f.envT)||0,unit:"℃",color:{start:"#fdd819",end:"#e80505"},icon:"carbon:temperature-celsius"},{key:"envH",title:"湿度",value:((k=t.MeteorologicalData)==null?void 0:k.envH)||0,unit:"%",color:{start:"#97abff",end:"#123597"},icon:"lets-icons:humidity"},{key:"qy",title:"气压",value:((p=t.MeteorologicalData)==null?void 0:p.qy)||0,unit:"hPa",color:{start:"#70f570",end:"#49c628"},icon:"mdi:car-brake-low-pressure"},{key:"windS",title:"风速",value:((v=t.MeteorologicalData)==null?void 0:v.windS)||0,unit:"m/s",color:{start:"#ffe985",end:"#fa742b"},icon:"hugeicons:slow-winds"},{key:"windD",title:"风向",value:((w=t.MeteorologicalData)==null?void 0:w.windD)||0,unit:"°",color:{start:"#bbd2c5",end:"#536976"},icon:"mdi:windsock"},{key:"zfsdCount",title:"总辐射",value:((x=t.MeteorologicalData)==null?void 0:x.zfsd)||0,unit:"W/㎡",color:{start:"#ce9ffc",end:"#7367f0"},icon:"material-symbols:clear-day-rounded"}]}),[c,T]=fe();function u(f){return`linear-gradient(to bottom right, ${f.start}, ${f.end})`}return(f,k)=>{const p=ve,v=je,w=ne,x=oe,e=se;return O(),U(e,{bordered:!1,size:"small",class:"card-wrapper h-100%","content-style":{padding:"20px 12px",display:"flex",flexDirection:"column",justifyContent:"center"}},{default:o(()=>[n(ae(c),null,{default:o(({$slots:a,gradientColor:s})=>[I("div",{class:"rd-8px pl-15px pb-4px pt-8px text-white",style:ge({backgroundImage:s})},[(O(),U(me(a.default)))],4)]),_:1}),n(x,{cols:"s:1 m:1 l:2",responsive:"screen","x-gap":10,"y-gap":12},{default:o(()=>[(O(!0),Q(_e,null,be(g.value,(a,s)=>(O(),U(w,{key:a.key,class:he("animated-fade-up-"+s)},{default:o(()=>[n(ae(T),{"gradient-color":u(a.color),class:"flex-1 flex items-center h-100%",style:{"max-height":"75px !important"}},{default:o(()=>[n(p,{icon:a.icon,class:"text-32px"},null,8,["icon"]),I("div",Je,[I("h3",Ue,m(a.title),1),n(v,{suffix:a.unit,decimals:1,"start-value":1,"end-value":a.value,class:"text-16px text-white dark:text-dark"},null,8,["suffix","end-value"])])]),_:2},1032,["gradient-color"])]),_:2},1032,["class"]))),128))]),_:1})]),_:1})}}}),Qe=K(qe,[["__scopeId","data-v-5da89340"]]),Ke=F({name:"LineChart",__name:"line-chart",props:{data:{required:!0},dataModifiers:{}},emits:["update:data"],setup(D){const t=["rgb(233, 4, 69)","rgb(0, 150, 136)","rgb(59, 66, 146)","rgb(255, 99, 71)"],g=we(D,"data"),c=Z(),T=Date.now(),u=new Date(T).setHours(23,59,59,999),{domRef:f,updateOptions:k,updateOptionsAsync:p}=le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:function(e){return console.log(e,"params"),`
      ${e[0].axisValueLabel||""}<br/>
      <span class="round" style="background-color: ${t[0]}"></span> ${e[0].seriesName}: ${H(e[0].value[1]," MW")}<br/>
      <span class="round" style="background-color: ${t[1]}"></span> ${e[1].seriesName}: ${H(e[1].value[1]," MW")}<br/>
      <span class="round" style="background-color: ${t[2]}"></span> ${e[2].seriesName}: ${H(e[2].value[1]," W/m^2")}<br/>
      <span class="round" style="background-color: ${t[3]}"></span> ${e[3].seriesName}: ${H(e[3].value[1]," W/m^2")}<br/>
      `},backgroundColor:"#6a7985",textStyle:{color:"#fff"}},legend:{data:["实际功率","预测功率","实际辐射","预测辐射"]},grid:{left:"2%",right:"5%",bottom:"0%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd} {HH}:{mm}"},max:u+60*1e3,data:[]},yAxis:[{name:"功率MW",type:"value",axisLabel:{formatter:"{value} MW"}},{name:"辐射W/m²",type:"value",axisLabel:{formatter:"{value} W/m²"}}],series:[{color:t[0],name:"实际功率",type:"line",emphasis:{focus:"series"},yAxisIndex:0,lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new L(0,0,0,1,[{offset:0,color:C(t[0],.3)},{offset:1,color:C(t[0],0)}],!1),shadowColor:C(t[0],.9),shadowBlur:20},data:[],connectNulls:!0},{color:t[1],name:"预测功率",type:"line",yAxisIndex:0,emphasis:{focus:"series"},lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new L(0,0,0,1,[{offset:0,color:C(t[1],.3)},{offset:1,color:C(t[1],0)}],!1),shadowColor:C(t[1],.9),shadowBlur:20},data:[],connectNulls:!0},{color:t[2],name:"实际辐射",type:"line",showSymbol:!1,yAxisIndex:1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new L(0,0,0,1,[{offset:0,color:C(t[2],.3)},{offset:1,color:C(t[2],0)}],!1),shadowColor:C(t[2],.7),shadowBlur:20},data:[],connectNulls:!0},{color:t[3],name:"预测辐射",type:"line",yAxisIndex:1,showSymbol:!1,emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new L(0,0,0,1,[{offset:0,color:C(t[3],.3)},{offset:1,color:C(t[3],0)}],!1),shadowColor:C(t[3],.7),shadowBlur:20},data:[],connectNulls:!0}]}));async function v(){await new Promise(e=>{setTimeout(e,1e3)}),k(e=>{if(g.value){const a=g.value.map(s=>({dbtime:s.dbtime,prePower:s.prePower,power:s.power,zfsd:s.zfsd,ssrd:s.ssrd}));e.xAxis.data=a.map(s=>s.dbtime),e.series[0].data=a.map(s=>[s.dbtime,s.power]),e.series[1].data=a.map(s=>[s.dbtime,s.prePower]),e.series[2].data=a.map(s=>[s.dbtime,s.zfsd]),e.series[3].data=a.map(s=>[s.dbtime,s.ssrd])}return e})}R(()=>g.value,e=>{p(a=>{if(g.value){const s=g.value.map(r=>({dbtime:r.dbtime,prePower:r.prePower,power:r.power,zfsd:r.zfsd,ssrd:r.ssrd}));a.xAxis.data=s.map(r=>r.dbtime),a.series[0].data=s.map(r=>[r.dbtime,r.power]),a.series[1].data=s.map(r=>[r.dbtime,r.prePower]),a.series[2].data=s.map(r=>[r.dbtime,r.zfsd]),a.series[3].data=s.map(r=>[r.dbtime,r.ssrd])}return a})});function w(){k((e,a)=>{const s=a();return e.legend.data=s.legend.data,e.series[0].name=s.series[0].name,e.series[1].name=s.series[1].name,e})}async function x(){v()}return R(()=>c.locale,()=>{w()}),x(),(e,a)=>(O(),Q("div",{ref_key:"domRef",ref:f,class:"h-100% overflow-hidden"},null,512))}}),Xe=K(Ke,[["__scopeId","data-v-88106aff"]]),Ye=F({name:"LineChart",__name:"weather-chart",props:{data:{type:Array,default:[]}},setup(D){const t=D,g=Z(),c=Date.now(),T=new Date(c).setHours(23,59,59,999),{domRef:u,updateOptions:f,showLoading:k,updateOptionsAsync:p}=le(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(e){return H(e,"°C")},backgroundColor:"#6a7985",textStyle:{color:"#fff"}},legend:{data:["环境温度","预测温度","组件温度"]},grid:{left:"2%",right:"5%",bottom:"10%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd} {HH}:{mm}"},max:T+60*1e3,data:[]},yAxis:{name:"温度(°C)",type:"value",axisLabel:{formatter:"{value} °C"}},series:[{color:"#27ae60",name:"环境温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new L(0,0,0,1,[{offset:0,color:"rgba(39, 174, 96,0.4)"},{offset:1,color:"rgba(39, 174, 96,0)"}],!1),shadowColor:"rgba(39, 174, 96,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#c0392b",name:"预测温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new L(0,0,0,1,[{offset:0,color:"rgba(192, 57, 43,0.3)"},{offset:1,color:"rgba(192, 57, 43,0)"}],!1),shadowColor:"rgba(192, 57, 43,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0},{color:"#ffa000",name:"组件温度",type:"line",lineStyle:{width:1},showSymbol:!1,areaStyle:{color:new L(0,0,0,1,[{offset:0,color:"rgba(255, 160, 0,0.3)"},{offset:1,color:"rgba(255, 160, 0,0)"}],!1),shadowColor:"rgba(255, 160, 0,0.9)",shadowBlur:20},emphasis:{focus:"series"},data:[],connectNulls:!0}]}));async function v(){await new Promise(e=>{setTimeout(e,1e3)}),f(e=>(t.data&&(e.xAxis.data=t.data.map(a=>a.dbtime),e.series[0].data=t.data.map(a=>[a.dbtime,a.envT]),e.series[1].data=t.data.map(a=>[a.dbtime,a.tt2]),e.series[2].data=t.data.map(a=>[a.dbtime,a.moduleT])),e))}function w(){f((e,a)=>{const s=a();return e.legend.data=s.legend.data,e.series[0].name=s.series[0].name,e.series[1].name=s.series[1].name,e.series[2].name=s.series[2].name,e})}async function x(){v()}return R(()=>g.locale,()=>{w()}),R(()=>t.data,()=>{p(e=>(t.data&&(e.xAxis.data=t.data.map(a=>a.dbtime),e.series[0].data=t.data.map(a=>[a.dbtime,a.envT]),e.series[1].data=t.data.map(a=>[a.dbtime,a.tt2]),e.series[2].data=t.data.map(a=>[a.dbtime,a.moduleT])),e))}),x(),(e,a)=>(O(),Q("div",{ref_key:"domRef",ref:u,style:{height:"260px",overflow:"hidden"}},null,512))}}),Ze=K(Ye,[["__scopeId","data-v-27d01d4a"]]),re=D=>(Ae("data-v-efbc86dd"),D=D(),Le(),D),ea=re(()=>I("img",{src:Fe,alt:"",style:{height:"140px",width:"100%","margin-bottom":"20px"}},null,-1)),aa={class:"flex items-center"},ta=re(()=>I("div",{class:"w-80px font-size-14px text-right"},"气象站：",-1)),sa=F({name:"home",__name:"index",setup(D){ye();const t=Z(),g=q(()=>t.isMobile?0:16),c=$({stationP:0}),T=async()=>{const{data:d,error:b}=await Ne();b||(c.value=d)},u=$(),f=$(),k=async()=>{var l;const{data:d,error:b}=await Ge();b||(f.value=d,f.value.length!=0&&(p.value=(l=d[0])==null?void 0:l.id,w()))},p=$(),v=$(),w=async()=>{const{data:d,error:b}=await ze({devId:p.value});b||(v.value=d)},x=d=>{p.value=d,w(),X()},e=Date.now(),a=new Date(e).setHours(0,0,0,0),s=new Date(e).setHours(23,59,59,999),r=$(),P=async()=>{const{data:d,error:b}=await Ee({startTime:V(1,a),endTime:V(1,s),page:1,limit:100});b||(r.value=JSON.parse(JSON.stringify(d)).list)},M=$(),z=async()=>{const{data:d,error:b}=await Ie({date:V(0,Date.now())});b||(M.value=d,M.value.forEach(l=>(r.value.forEach(_=>{l.dbtime==_.dbtime&&(l.ssrd=_.ssrd)}),l)),W.value.forEach(l=>{const _=M.value.find(A=>A.dbtime===l.dbtime);_?Object.assign(_,l):M.value.push(l)}),M.value=M.value.sort((l,_)=>new Date(l.dbtime).getTime()-new Date(_.dbtime).getTime()))},W=$(),X=async()=>{if(!p.value)return;const{data:d,error:b}=await Ve({id:p.value,startTime:V(0,Date.now())+" 00:00:00",endTime:V(1,Date.now())});console.log("气象实际数据",d),W.value=d,r.value.forEach(l=>{const _=W.value.find(A=>A.dbtime===l.dbtime);_?Object.assign(_,l):W.value.push(l)}),W.value=W.value.sort((l,_)=>new Date(l.dbtime).getTime()-new Date(_.dbtime).getTime())},Y=$(null);xe(async()=>{ie(),await k(),await T(),await P(),await X(),await z(),Y.value=setInterval(async()=>{await w(),await T(),await P(),await X(),await z()},1e3*60*1)}),Se(()=>{Y.value&&clearInterval(Y.value),j.value&&j.value.close()});const B=De({col:"",trs:""}),j=$(null),ie=()=>{var N,G,J;if((N=j.value)==null||N.close(),!Be("channel:status:websocket")){(G=window.$message)==null||G.destroyAll(),(J=window.$message)==null||J.warning("暂无权限连接websocket");return}const d=new Date().getTime(),b=Ce(),l=ke(`${b}${d}getchlstatus`),_=te(l),A=te("getchlstatus"),S=new $e(Te+`/ChannelStatusWebsocket/${A}/${_}/${d}/${b}?token=${Me()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});j.value=S,S.connect(),S.onclose(()=>{}),S.onerror(()=>{}),S.onopen(()=>{}),S.onmessage(E=>{if(console.log(E,"通道状态websocket接受数据"),!ce(E.data))return;const i=JSON.parse(E.data).dataStatus;i&&(B.col=i.col+""=="0"||i.col+""=="1"?i.col+"":"",B.trs=i.trs+""=="0"||i.trs+""=="1"?i.trs+"":"")})},ce=d=>{try{return JSON.parse(d),!0}catch{return!1}};return(d,b)=>{const l=He,_=Re,A=Oe,S=se,N=ne,G=oe,J=Pe,E=We;return O(),U(E,{vertical:"",size:16,class:"h-100% home","item-style":{height:"100%"}},{default:o(()=>[n(G,{"y-gap":g.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:o(()=>[n(N,{span:"24 s:24 m:24"},{default:o(()=>[n(S,{title:"",bordered:!1,class:"card-wrapper h-100% bg-transparent","content-style":{padding:"0px"}},{default:o(()=>[n(G,{"x-gap":g.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:o(()=>[n(N,{span:"24 s:24 m:6"},{default:o(()=>[n(S,{title:"电场实时数据",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"12px"},"content-style":{padding:"12px",paddingTop:"0px",display:"flex",flexDirection:"column"}},{"header-extra":o(()=>[h(" 运行状态："+m(c.value.stationP&&c.value.stationP>0&&c.value.stationControlled==0?"并网运行":c.value.stationP&&c.value.stationP>0&&c.value.stationControlled==1?"降额运行":c.value.stationP==0?"待机":""),1)]),default:o(()=>[ea,n(A,{trigger:"none"},{default:o(()=>[n(_,{bordered:"",column:1,"label-placement":"left",size:"small",class:"flex-1","content-style":{minWidth:"100px"}},{default:o(()=>[n(l,null,{label:o(()=>[h(" 最后更新时间 ")]),default:o(()=>[h(" "+m(c.value.dbtime||"-"),1)]),_:1}),n(l,null,{label:o(()=>{var i,y;return[h(" 总有功功率"+m((i=u.value)!=null&&i.StationP?` (${(y=u.value)==null?void 0:y.StationP})`:"(MW)"),1)]}),default:o(()=>[h(" "+m(c.value.stationP??"-"),1)]),_:1}),n(l,null,{label:o(()=>{var i,y;return[h(" 总无功功率"+m((i=u.value)!=null&&i.StationQ?` (${(y=u.value)==null?void 0:y.StationQ})`:"(MVar)"),1)]}),default:o(()=>[h(" "+m(c.value.stationQ??"-"),1)]),_:1}),n(l,null,{label:o(()=>{var i,y,ee;return[h(" 总功率因数"+m(((i=u.value)==null?void 0:i.StationCOS)=="-"?"":(y=u.value)!=null&&y.StationCOS?`
                        (${(ee=u.value)==null?void 0:ee.StationCOS})`:""),1)]}),default:o(()=>[h(" "+m(c.value.stationCOS??"-"),1)]),_:1}),n(l,null,{label:o(()=>{var i,y;return[h(" 日发电量"+m((i=u.value)!=null&&i.StationDayE?` (${(y=u.value)==null?void 0:y.StationDayE})`:"(MWh)"),1)]}),default:o(()=>[h(" "+m(c.value.stationDayE??"-"),1)]),_:1}),n(l,null,{label:o(()=>{var i,y;return[h(" 总发电量"+m((i=u.value)!=null&&i.StationTotalE?` (${(y=u.value)==null?void 0:y.StationTotalE})`:"(MWh)"),1)]}),default:o(()=>[h(" "+m(c.value.stationTotalE??"-"),1)]),_:1}),n(l,null,{label:o(()=>[h(" 是否限电 ")]),default:o(()=>[I("span",null,m(c.value.stationControlled==1?"是":"否"),1)]),_:1}),n(l,null,{label:o(()=>[h(" 数据接入状态 ")]),default:o(()=>[I("span",null,m(B.col=="0"?"🟢":B.col=="1"?"🔴":"⚪"),1)]),_:1}),n(l,null,{label:o(()=>[h(" 数据上报状态 ")]),default:o(()=>[I("span",null,m(B.trs=="0"?"🟢":B.trs=="1"?"🔴":"⚪"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(N,{span:"24 s:24 m:18"},{default:o(()=>[n(S,{title:"今日预测功率",bordered:!0,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"10px",paddingTop:"0px"}},{default:o(()=>[n(Xe,{data:M.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1}),n(N,{span:"24 s:24 m:24"},{default:o(()=>[n(S,{title:"",bordered:!0,class:"card-wrapper h-100%","content-style":{padding:"0px"}},{default:o(()=>[n(G,{"x-gap":g.value,responsive:"screen",class:"h-100%","item-responsive":""},{default:o(()=>[n(N,{span:"24 s:24 m:6"},{default:o(()=>[n(S,{title:"气象数据",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"12px",paddingBottom:"0px"},"content-style":{padding:"0px"}},{"header-extra":o(()=>[I("div",aa,[ta,n(J,{filterable:"",placeholder:"请选择气象站",value:p.value,"onUpdate:value":b[0]||(b[0]=i=>p.value=i),options:f.value,"label-field":"sname","value-field":"id",style:{width:"140px"},onUpdateValue:x},null,8,["value","options"])])]),default:o(()=>[n(Qe,{MeteorologicalData:v.value},null,8,["MeteorologicalData"])]),_:1})]),_:1}),n(N,{span:"24 s:24 m:18"},{default:o(()=>[n(S,{title:"今日实时气象",bordered:!1,class:"card-wrapper h-100%","header-style":{padding:"10px 30px 0 30px"},"content-style":{padding:"0px",paddingTop:"0px"}},{default:o(()=>[n(Ze,{data:W.value},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["x-gap"])]),_:1})]),_:1})]),_:1},8,["y-gap"])]),_:1})}}}),da=K(sa,[["__scopeId","data-v-efbc86dd"]]);export{da as default};
