import{_ as ke}from"./round-delete-BJUCXHh8.js";import{_ as Ne}from"./round-add-9JBusyZ3.js";import{d as H,ay as V,D as oe,A as ne,a as xe,aw as se,ax as Ce,aL as De,c as $,o as j,w as t,f as e,a3 as le,M as J,h as o,H as O,J as Q,B as g,g as w,t as v,$ as m,a4 as re,L as ze,a2 as ie,aN as Se,E as Re,s as U,F as E,b as je,aO as K,aD as Pe,I as B,aP as Fe,e as I,G as Te,N as $e,aW as Le,Q as Me,aX as Ue,aV as Be}from"./index-DTejdFLI.js";import{o as Ie,p as Ve,q as ee,j as Oe}from"./aftersale-8Ftoe63T.js";import{u as Ae,a as qe}from"./table-5sK02S3E.js";import{_ as ce}from"./Grid-U7VbogCl.js";import{_ as de}from"./FormItemGridItem-OdWiLkIi.js";import{_ as Ge}from"./round-search-CcVdI1HR.js";import{_ as Ee}from"./round-refresh-CFg-lT0v.js";import{N as te}from"./Popconfirm-BmNh5CYH.js";const Ke=H({name:"OperateDrawer",__name:"operate-drawer",props:V({operateType:{},rowData:{},provinceList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(f,{emit:P}){const y=P,p=f,r=oe(i());function i(){return{id:"",rs:"",rsdesc:""}}async function z(){Object.assign(r,i()),p.operateType==="edit"&&p.rowData&&Object.assign(r,p.rowData)}const{formRef:_,validate:N,restoreValidation:L}=ne(),b={rs:{type:"string",required:!0,trigger:["blur","change"],message:"请输入售后原因"}},x=xe(()=>({add:"新增售后原因",edit:"修改售后原因"})[p.operateType]),u=se(f,"visible");Ce(u,()=>{u.value&&(z(),setTimeout(()=>{const c=document.querySelector(".n-scrollbar-content");c==null||c.scrollTo(0,0)},300),L())});function C(){u.value=!1}const S=De.debounce(async()=>{var c,s;if(await N(),p.operateType==="edit"){const{data:k,error:h}=await Ie([r]);h||(C(),y("submitted"),(c=window.$message)==null||c.success("修改成功"))}else{const{data:k,error:h}=await Ve([{...r}]);h||(C(),y("submitted"),(s=window.$message)==null||s.success("添加成功"))}},1e3,{leading:!0,trailing:!0});return(c,s)=>{const k=de,h=ce,F=J,T=le,A=Q,q=re;return j(),$(q,{show:u.value,"onUpdate:show":s[2]||(s[2]=D=>u.value=D),title:x.value,preset:"card",class:"w-600px","mask-closable":!1,draggable:!0},{footer:t(()=>[e(A,{justify:"end",size:16},{default:t(()=>[e(o(g),{onClick:C},{default:t(()=>[w(v(o(m)("common.cancel")),1)]),_:1}),e(o(g),{type:"primary",onClick:o(S)},{default:t(()=>[w(v(o(m)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(T,{class:"pr-20px"},{default:t(()=>[e(F,{ref_key:"formRef",ref:_,model:r,rules:b,"label-placement":"left","label-width":120},{default:t(()=>[e(h,{responsive:"screen","item-responsive":""},{default:t(()=>[e(k,{span:"24 m:24",label:"售后原因",path:"rs"},{default:t(()=>[e(o(O),{value:r.rs,"onUpdate:value":s[0]||(s[0]=D=>r.rs=D),placeholder:"请输入"},null,8,["value"])]),_:1}),e(k,{span:"24 m:24",label:"描述",path:"rsdesc"},{default:t(()=>[e(o(O),{value:r.rsdesc,"onUpdate:value":s[1]||(s[1]=D=>r.rsdesc=D),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),He=H({name:"FormSearch",__name:"form-search",props:V({provinceList:{}},{model:{required:!0},modelModifiers:{}}),emits:V(["reset","search"],["update:model"]),setup(f,{emit:P}){const y=P,{formRef:p,restoreValidation:r}=ne(),i=se(f,"model");function z(){i.value.fuzzy="",i.value.page=1,y("search")}async function _(){i.value.fuzzy="",await r(),y("reset")}async function N(){y("search"),i.value.page=1}return(L,b)=>{const x=O,u=de,C=Ee,S=g,c=Ge,s=Q,k=ce,h=J,F=ie;return j(),$(F,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(h,{ref_key:"formRef",ref:p,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:ze(N,["enter"])},{default:t(()=>[e(k,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(u,{span:"24 s:12 m:4",label:"",path:"fuzzy"},{default:t(()=>[e(x,{clearable:"",value:i.value.fuzzy,"onUpdate:value":b[0]||(b[0]=T=>i.value.fuzzy=T),placeholder:"请输入关键字",onClear:z},null,8,["value"])]),_:1}),e(u,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(s,{class:"w-full"},{default:t(()=>[e(S,{onClick:_},{icon:t(()=>[e(C,{class:"text-icon"})]),default:t(()=>[w(" "+v(o(m)("common.reset")),1)]),_:1}),e(S,{type:"primary",ghost:"",onClick:N},{icon:t(()=>[e(c,{class:"text-icon"})]),default:t(()=>[w(" "+v(o(m)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Qe={style:{"font-weight":"500",color:"#1890ff","margin-right":"15px","font-size":"20px"}};function ae(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!Be(f)}const lt=H({name:"aftersales_aftersalesreason",__name:"index",setup(f){const P=Se(),{patternRules:y}=Re(),p=U([]);(async()=>{const{data:n}=await Le();n&&(p.value=n)})();const{columns:i,data:z,getData:_,loading:N,mobilePagination:L,searchParams:b}=Ae({showTotal:!0,apiFn:Oe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"rs",title:"售后原因",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"rsdesc",title:"描述",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:m("common.operate"),align:"center",width:140,fixed:"right",render:n=>{let a;return e("div",{class:"flex-center gap-8px"},[B(e(g,{type:"primary",ghost:!0,size:"small",onClick:()=>A(n.id)},ae(a=m("common.edit"))?a:{default:()=>[a]}),[[E("no-auth"),"project:Dispatch:update"]]),e(te,{onPositiveClick:()=>T(n.id)},{default:()=>m("common.confirmDelete"),trigger:()=>{let l;return B(e(g,{type:"error",ghost:!0,size:"small"},ae(l=m("common.delete"))?l:{default:()=>[l]}),[[E("no-auth"),"project:Dispatch:delete"]])}})])}}]}),{drawerVisible:x,operateType:u,editingData:C,handleAdd:S,handleEdit:c,checkedRowKeys:s,onBatchDeleted:k,onDeleted:h}=qe(z,_);async function F(){console.log(s.value),q(s.value.join(","),n=>{k()})}async function T(n){const{data:a,error:l}=await ee(n);l||h()}function A(n){c(n)}async function q(n,a){const{data:l,error:G}=await ee(n);if(!G)a&&a(l);else return!1}const D=n=>{_()},pe=()=>{_()},W=U(!1),R=oe({id:"",name:"",pwd:""}),X=U(null),ue={pwd:[{required:!0,message:"请输入密码",trigger:"blur"},y.password]},M=U(""),me=async()=>{var l;await((l=X.value)==null?void 0:l.validate());const n=Me(R.pwd),a=await Ue({id:R.id,pwd:n});a.error||(M.value=a.data)},fe=n=>{n&&navigator.clipboard.writeText(n).then(()=>{var a;(a=window.$message)==null||a.success("已复制到剪贴板")}).catch(()=>{var a;(a=window.$message)==null||a.error("复制失败，请手动复制")})};return(n,a)=>{const l=Q,G=Ne,_e=ke,he=Pe,ge=ie,we=O,Y=$e,ve=J,ye=le,be=re,Z=E("no-auth");return j(),je("div",Je,[e(He,{model:o(b),"onUpdate:model":a[0]||(a[0]=d=>K(b)?b.value=d:null),onReset:pe,onSearch:o(_),provinceList:p.value},null,8,["model","onSearch","provinceList"]),e(ge,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(l,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>a[6]||(a[6]=[I("div",null,"售后原因",-1)])),_:1,__:[6]})]),"header-extra":t(()=>[e(l,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[B((j(),$(o(g),{onClick:o(S),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(G,{class:"text-icon"})]),default:t(()=>[a[7]||(a[7]=w(" "+v("新增")))]),_:1,__:[7]},8,["onClick"])),[[Z,"project:Dispatch:insert"]]),e(o(te),{onPositiveClick:F},{trigger:t(()=>[B((j(),$(o(g),{size:"small",ghost:"",type:"error",disabled:o(s).length==0},{icon:t(()=>[e(_e,{class:Fe(["text-icon",{"animate-spin":o(N)}])},null,8,["class"])]),default:t(()=>[a[8]||(a[8]=w(" "+v("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[Z,"project:Dispatch:delete"]])]),default:t(()=>[a[9]||(a[9]=w(" 确定要删除选中的调度吗？ "))]),_:1,__:[9]})]),_:1})]),default:t(()=>[e(he,{"checked-row-keys":o(s),"onUpdate:checkedRowKeys":a[1]||(a[1]=d=>K(s)?s.value=d:null),columns:o(i),data:o(z),size:"small","flex-height":!o(P).isMobile,loading:o(N),remote:"","row-key":d=>d.id,pagination:o(L),class:"sm:h-full","onUpdate:filters":D},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ke,{visible:o(x),"onUpdate:visible":a[2]||(a[2]=d=>K(x)?x.value=d:null),onSubmitted:o(_),"operate-type":o(u),provinceList:p.value,"row-data":o(C)},null,8,["visible","onSubmitted","operate-type","provinceList","row-data"])]),_:1}),e(be,{show:W.value,"onUpdate:show":a[5]||(a[5]=d=>W.value=d),title:"查看主站联系方式",preset:"card",class:"w-420px"},{footer:t(()=>[e(l,{justify:"end",size:16},{default:t(()=>[e(o(g),{type:"primary",onClick:me},{default:t(()=>[w(v(o(m)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(ye,{class:"max-h-480px pr-20px"},{default:t(()=>[e(ve,{ref_key:"checkformRef",ref:X,model:R,"label-placement":"left",rules:ue,"label-width":80,"require-mark-placement":"left"},{default:t(()=>[e(Y,{label:o(m)("page.login.common.password"),path:"pwd"},{default:t(()=>[e(we,{type:"password","show-password-on":"click",clearable:"",value:R.pwd,"onUpdate:value":a[3]||(a[3]=d=>R.pwd=d),placeholder:"请输入当前登录账号密码"},null,8,["value"])]),_:1},8,["label"]),M.value?(j(),$(Y,{key:0,label:" "},{default:t(()=>[I("div",null,[I("span",null,v(`${R.name}的主站联系方式为：`),1),I("span",Qe,v(M.value),1),e(o(g),{size:"tiny",type:"primary",ghost:"",onClick:a[4]||(a[4]=d=>fe(M.value))},{default:t(()=>a[10]||(a[10]=[w(" 复制 ")])),_:1,__:[10]})])]),_:1})):Te("",!0)]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])}}});export{lt as default};
