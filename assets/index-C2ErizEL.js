import{_ as ie}from"./table-header-operation.vue_vue_type_script_setup_true_lang-DCcFtEoA.js";import{d as A,q as V,s as W,v as Z,x as re,b as se,r as pe,y as ce,K as M,o as E,c as Q,w as n,g as t,h as O,t as F,i as o,$ as f,M as X,L as q,Z as Y,au as j,av as H,A as ee,C as ue,a2 as te,D as oe,B as K,E as G,ae as de,af as me,ad as le,a4 as _e,at as fe,j as ve,J as ge,e as ye,ag as B,ah as he,ai as be}from"./index-ByfxsQvj.js";import{u as we,a as ke}from"./table-Ca-5bYro.js";import{e as Ne,g as De,h as Pe,i as Ce,j as Ie}from"./Collection-KAaQvKYa.js";import{b as ae,T as Se}from"./collection-Cbj-Z2Uh.js";import{_ as xe}from"./round-search-U_wZ0GRt.js";import{_ as Te}from"./round-refresh-BRVSTvae.js";import{_ as Re}from"./lodash-21GmhknM.js";import{_ as ze}from"./FormItemGridItem-Dtr_7n7z.js";import{_ as $e}from"./Grid-B9K_tFX2.js";import{h as J}from"./permission-DpUBsxJs.js";import{_ as Ue}from"./Popconfirm-Bx1fZnQD.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-frQqLk93.js";import"./setting-outlined-C6sNL0co.js";import"./export-CaaNVRvS.js";import"./refresh-DDT70CE0.js";import"./round-delete-BsuQe4MI.js";import"./round-plus--T3dOesv.js";import"./Upload-BPNrVbAn.js";import"./Progress-B01mUdYA.js";const je=A({name:"OperateDrawer",__name:"operate-drawer",props:V({operateType:{},rowData:{},tTypeList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(y,{emit:R}){const u=y,w=R,v=W(y,"visible"),{formRef:p,validate:z,restoreValidation:$}=Z(),{createConfirmPwdRule:S,defaultRequiredRule:U,patternRules:N}=re(),x=se(()=>({add:"新增策略",edit:"编辑策略"})[u.operateType]),e=pe(T());function T(){return{id:void 0,pname:"",llevel:[],etype:[],oriip:"",aimip:"",cdesc:""}}const D={pname:U,oriip:{type:"string",required:!1,validator:(h,l)=>!j(l[0])||!j(l[1])?new Error("请输入正确的IP"):!0,trigger:["input"]},aimip:{type:"string",required:!1,validator:(h,l)=>!j(l[0])||!j(l[1])?new Error("请输入正确的IP"):!0,trigger:["input"]},llevel:{type:"array",required:!1,trigger:["blur","change"],message:"请选择日志级别"},etype:{type:"array",required:!1,trigger:["blur","change"],message:"请选择事件类型"}};function g(){Object.assign(e,T()),u.operateType==="edit"&&u.rowData&&(Object.assign(e,u.rowData),e.oriip=e.oriip.split("-"),e.aimip=e.aimip.split("-"),e.llevel=e.llevel.split(",").map(Number),e.etype=e.etype.split(",").map(Number))}function P(){v.value=!1}async function C(){var h,l,m,d,b,k;if(e.pname==="")return(h=window.$message)==null?void 0:h.error("请输入策略名称");if((e.llevel.length===0||!e.llevel)&&(e.etype.length===0||!e.etype)&&(!e.oriip[0]||!e.oriip[1])&&(!e.aimip[0]||!e.aimip[1]))return(l=window.$message)==null?void 0:l.error("日志级别、事件类型、源IP、目的IP至少填写一个");if(H(e.oriip[0],e.oriip[1])!=-1)return(m=window.$message)==null?void 0:m.error("源起始IP不能大于源结束IP");if(H(e.aimip[0],e.aimip[1])!=-1)return(d=window.$message)==null?void 0:d.error("目的起始IP不能大于目的结束IP");if(e.oriip=e.oriip.join("-"),e.aimip=e.aimip.join("-"),e.llevel=e.llevel.join(","),e.etype=e.etype.join(","),u.operateType==="add"){const{data:_,error:i}=await Ne([e]);i||((b=window.$message)==null||b.success(f("common.addSuccess")),P(),w("submitted"))}else{const{data:_,error:i}=await De([e]);i||((k=window.$message)==null||k.success(f("common.updateSuccess")),P(),w("submitted"))}}return ce(v,()=>{v.value&&(g(),$())}),(h,l)=>{const m=ee,d=ue,b=te,k=oe,_=K,i=G,a=de,c=me,I=M("no-space");return E(),Q(c,{show:v.value,"onUpdate:show":l[6]||(l[6]=r=>v.value=r),"display-directive":"show",width:360},{default:n(()=>[t(a,{title:x.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[t(i,{size:16},{default:n(()=>[t(_,{onClick:P},{default:n(()=>[O(F(o(f)("common.cancel")),1)]),_:1}),t(_,{type:"primary",onClick:C},{default:n(()=>[O(F(o(f)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[t(k,{ref_key:"formRef",ref:p,model:e,rules:D,onKeyup:X(C,["enter"])},{default:n(()=>[t(d,{label:"策略名称",path:"pname"},{default:n(()=>[q(t(m,{value:e.pname,"onUpdate:value":l[0]||(l[0]=r=>e.pname=r),placeholder:"请输入策略名称",clearable:""},null,8,["value"]),[[I]])]),_:1}),t(d,{label:"日志级别",path:"llevel"},{default:n(()=>[t(b,{value:e.llevel,"onUpdate:value":l[1]||(l[1]=r=>e.llevel=r),multiple:"",placeholder:"请选择日志级别",options:o(Y)(o(ae))},null,8,["value","options"])]),_:1}),t(d,{label:"事件类型",path:"etype"},{default:n(()=>[t(b,{value:e.etype,"onUpdate:value":l[2]||(l[2]=r=>e.etype=r),multiple:"",placeholder:"请选择日志级别","value-field":"id","label-field":"pname",options:u.tTypeList},null,8,["value","options"])]),_:1}),t(d,{label:"源IP",path:"oriip"},{default:n(()=>[t(m,{pair:"",separator:"-",value:e.oriip,"onUpdate:value":l[3]||(l[3]=r=>e.oriip=r),placeholder:["源起始IP","源终止IP"],clearable:""},null,8,["value"])]),_:1}),t(d,{label:"目的IP",path:"aimip"},{default:n(()=>[t(m,{pair:"",separator:"-",value:e.aimip,"onUpdate:value":l[4]||(l[4]=r=>e.aimip=r),placeholder:["目的起始IP","目的终止IP"],clearable:""},null,8,["value"])]),_:1}),t(d,{label:"描述",path:"cdesc"},{default:n(()=>[t(m,{type:"textarea",value:e.cdesc,"onUpdate:value":l[5]||(l[5]=r=>e.cdesc=r),placeholder:"请输入描述",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Be=A({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:V(["reset","search"],["update:model"]),setup(y,{emit:R}){const u=R,{formRef:w,restoreValidation:v}=Z(),p=W(y,"model");function z(){p.value.fuzzy="",u("search")}async function $(){await v(),u("reset")}async function S(){u("search")}function U(x){p.value.llevel=x,u("search")}const N=Re.throttle(S,1e3,{trailing:!1});return(x,e)=>{const T=ee,D=ze,g=te,P=Te,C=K,h=xe,l=G,m=$e,d=oe,b=le,k=M("no-space");return E(),Q(b,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(d,{ref_key:"formRef",ref:w,model:p.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:X(o(N),["enter"])},{default:n(()=>[t(m,{responsive:"screen","item-responsive":"","x-gap":12,"y-gap":12},{default:n(()=>[t(D,{span:"24 s:12 m:8 l:6",label:"策略名称",path:"fuzzy"},{default:n(()=>[q(t(T,{clearable:"",value:p.value.fuzzy,"onUpdate:value":e[0]||(e[0]=_=>p.value.fuzzy=_),placeholder:"请输入策略名称",onClear:z},null,8,["value"]),[[k]])]),_:1}),t(D,{span:"24 s:12 m:8 l:6",label:"日志级别",path:"llevel"},{default:n(()=>[t(g,{clearable:"",filterable:"",value:p.value.llevel,"onUpdate:value":e[1]||(e[1]=_=>p.value.llevel=_),placeholder:"请选择日志级别",options:o(Y)(o(ae)),onUpdateValue:U,style:{width:"100%"}},null,8,["value","options"])]),_:1}),t(D,{span:"24 s:12 m:8 l:6"},{default:n(()=>[t(l,{class:"w-full"},{default:n(()=>[t(C,{onClick:$},{icon:n(()=>[t(P,{class:"text-icon"})]),default:n(()=>[O(" "+F(o(f)("common.reset")),1)]),_:1}),t(C,{type:"primary",ghost:"",onClick:o(N)},{icon:n(()=>[t(h,{class:"text-icon"})]),default:n(()=>[O(" "+F(o(f)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","onKeyup"])]),_:1})}}}),Le={class:"min-h-500px flex-col-stretch gap-16px overflow-auto lt-sm:overflow-auto"};function L(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!he(y)}const at=A({name:"collectionmanagement_collectionpolicy",__name:"index",setup(y){const R=_e(),{columns:u,columnChecks:w,data:v,getData:p,loading:z,mobilePagination:$,searchParams:S,resetSearchParams:U}=we({apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,llevel:null,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"pname",title:"策略名称",align:"center",width:140},{key:"llevel",title:"日志级别",align:"center",width:300,render:i=>{let a;const c=i.llevel.split(",").map(Number),I={0:"default",1:"success",2:"info",3:"warning",4:"error"};return t(G,{justify:"center"},L(a=c.map(r=>{const s=f(Se[r]);return t(fe,{type:I[r]},L(s)?s:{default:()=>[s]})}))?a:{default:()=>[a]})}},{key:"etype",title:"事件类型",align:"center",render:i=>{const a=i.etype.split(",").map(Number);return t("span",null,[a.map((c,I)=>{var s;const r=(s=l.value.find(ne=>ne.id===c))==null?void 0:s.pname;return r?`${r}${I!==a.length-1?"，":""}`:""})])},ellipsis:{tooltip:!0,tooltipPlacement:"top"}},{key:"oriip",title:"源IP",align:"center"},{key:"aimip",title:"目的IP",align:"center"},{key:"cdesc",title:"描述",align:"center",minWidth:200},{key:"operate",title:f("common.operate"),align:"center",width:130,render:i=>{let a;return t("div",{class:"flex-center gap-8px"},[q(t(K,{type:"primary",ghost:!0,size:"small",onClick:()=>k(i.id)},L(a=f("common.edit"))?a:{default:()=>[a]}),[[M("no-auth"),"sys.collection.policy.update"]]),t(Ue,{onPositiveClick:()=>b(i.id)},{default:()=>f("common.confirmDelete"),trigger:()=>{let c;return q(t(K,{type:"error",ghost:!0,size:"small"},L(c=f("common.delete"))?c:{default:()=>[c]}),[[M("no-auth"),"sys.collection.policy.delete"]])}})])}}]}),{drawerVisible:N,operateType:x,editingData:e,handleAdd:T,handleEdit:D,checkedRowKeys:g,onBatchDeleted:P,onDeleted:C,closeDrawer:h}=ke(v,p),l=ve([]),m=async()=>{const{data:i,error:a}=await Ie();l.value=i};async function d(){console.log(g.value),_(g.value.join(","),i=>{P()})}function b(i){console.log(i),_(i,a=>{C()})}function k(i){D(i)}async function _(i,a){const c=await Ce(i);console.log("data",c),a&&a(c)}return ge(()=>{m()}),(i,a)=>{const c=ie,I=be,r=le;return E(),ye("div",Le,[t(Be,{model:o(S),"onUpdate:model":a[0]||(a[0]=s=>B(S)?S.value=s:null),onReset:o(U),onSearch:o(p)},null,8,["model","onReset","onSearch"]),t(r,{title:"采集过滤策略",bordered:!1,size:"small",class:"sm:flex-1-hidden"},{"header-extra":n(()=>[t(c,{columns:o(w),"onUpdate:columns":a[1]||(a[1]=s=>B(w)?w.value=s:null),"disabled-delete":o(g).length===0,"is-view-add-button":o(J)("sys.collection.policy.insert"),"is-view-delete-button":o(J)("sys.collection.policy.delete"),loading:o(z),onAdd:o(T),onDelete:d,onRefresh:o(p)},null,8,["columns","disabled-delete","is-view-add-button","is-view-delete-button","loading","onAdd","onRefresh"])]),default:n(()=>[t(I,{"checked-row-keys":o(g),"onUpdate:checkedRowKeys":a[2]||(a[2]=s=>B(g)?g.value=s:null),columns:o(u),data:o(v),size:"small","flex-height":!o(R).isMobile,"scroll-x":962,loading:o(z),remote:"","row-key":s=>s.id,pagination:o($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(je,{visible:o(N),"onUpdate:visible":a[3]||(a[3]=s=>B(N)?N.value=s:null),"operate-type":o(x),"row-data":o(e),tTypeList:l.value,onSubmitted:o(p)},null,8,["visible","operate-type","row-data","tTypeList","onSubmitted"])]),_:1})])}}});export{at as default};
