import{_ as ye}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DSCmHFV3.js";import{_ as we}from"./round-refresh-DjBXwukd.js";import{_ as Ne}from"./round-add-DGE928ry.js";import{_ as ke}from"./round-search-CUxy2s3B.js";import{d as ee,s as X,m as T,v as se,r as oe,x as De,y as Ie,ab as ce,ag as pe,a as Ce,$ as x,C as H,o as L,c as Y,w as t,g as e,h as S,t as V,f as l,D as W,F as xe,E as Me,e as $e,b9 as Se,ba as Ae,ak as te,N as me,aP as Ue,aV as qe,R as Q,aW as ze,T as ie,B as z,aG as re,aM as _e,aD as ve,b as fe,aE as Z,ao as Oe,ai as Te,bb as Ve,b7 as Pe,z as Ee,bc as Re,af as ne,aH as le,aI as Be,aJ as je,aK as Fe,a6 as Le}from"./index-Cb_NZueQ.js";import{u as Ge,a as Ke}from"./table-D_pOzmZb.js";import{_ as de}from"./FormItemGridItem-DlZb1cgP.js";import{_ as ue}from"./Grid-DyJ3S8uu.js";import{y as Je}from"./common-DEM4GlL4.js";import{N as He}from"./Popconfirm-BIgGRwii.js";import{_ as We}from"./InputGroupLabel-DG8uBh6u.js";const Qe=$e("span",null,"批量新增：格式为（采集设备1-10）",-1),Xe=ee({__name:"add_model",props:X({operateType:{},rowData:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(N,{emit:R}){const M=T(!1),b=se(N,"visible"),g=R,u=N,n=oe(k());function k(){return{devName:"采集设备1",chlId:void 0,devCommAddr:"1",devPubAddr:"1",devValid:1,devDesc:"",reserve0:"",reserve1:""}}const P=oe({channelList:[]});async function h(){const{data:c,error:s}=await _e({type:0});s||(P.channelList=c)}async function A(){await h(),u.operateType==="edit"&&u.rowData?Object.assign(n,u.rowData):(Object.assign(n,k()),n.chlId=u.chlId||P.channelList[0].id)}const{formRef:_,validate:i,restoreValidation:U}=De();Ie(),ce(()=>u.rowData,()=>{A()}),ce(b,()=>{b.value&&(pe(()=>{u.operateType==="add"&&pe(()=>{setTimeout(()=>{M.value=!0},200)})}),A(),U())});const D=()=>{b.value=!1,M.value=!1},O=async()=>{var c,s,j;if(await i(),u.operateType==="add"){let p=[],d=n.devName;if(((c=n.devName)==null?void 0:c.indexOf("-"))!=-1){let o=Math.abs(d==null?void 0:d.substring(d.lastIndexOf("-")).replace(/[^0-9]/gi,"")),v=d.split(/-(?![^-]*-)/),I=d.substring(0,d.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],m=I.replace(/[^0]/g,""),F=I,E=v[0],C=E.substring(0,E.length-E.match(/(\d+)[^0-9]*$/)[1].length),K=o-I+1;for(let r=0;r<K;r++){let w=F++,J=JSON.parse(JSON.stringify(n));J.devName=parseInt(I)==0?m.length>0?String(w).length>=m.length?C+w:C+m.substring(0,m.length-String(w).length)+w:C+w:m.length>0?w>=10?C+m.substring(0,m.length-String(w).length+1)+w:C+m.substring(0,m.length)+w:C+w,J.devCommAddr=Number(n.devCommAddr)+r,p.push(J)}}else p=[n];if(p.length>1e3){(s=window.$message)==null||s.destroyAll(),(j=window.$message)==null||j.warning("批量添加最多仅支持1000条");return}const{data:G,error:a}=await Se(p);a?console.log("error",a):(console.log("success",G),D(),g("submitted"))}else{const{data:p,error:d}=await Ae([n]);d?console.log("error",d):(console.log("success",p),D(),g("submitted"))}},$={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},B={devName:$,chlId:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},devCommAddr:$,devPubAddr:$},y=Ce(()=>({add:x("common.add"),edit:x("common.edit")})[u.operateType]);return(c,s)=>{const j=te,p=de,d=me,G=Ue,a=qe,o=Q,v=ze,I=ue,m=ie,F=z,E=Q,C=re,K=H("no-space");return L(),Y(C,{show:b.value,"onUpdate:show":s[6]||(s[6]=r=>b.value=r),title:y.value,preset:"card",class:"w-30%",onAfterLeave:D},{footer:t(()=>[e(E,{size:16,justify:"center"},{default:t(()=>[e(F,{onClick:D,class:"w-100px"},{default:t(()=>[S(V(l(x)("common.cancel")),1)]),_:1}),e(F,{type:"primary",class:"w-100px",onClick:O},{default:t(()=>[S(V(l(x)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(m,{ref_key:"formRef",ref:_,model:n,rules:B,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:Me(O,["enter"])},{default:t(()=>[e(I,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(j,{filterable:"",placeholder:"请选择所属通道",value:n.chlId,"onUpdate:value":s[0]||(s[0]=r=>n.chlId=r),"label-field":"chlName","value-field":"id",options:P.channelList},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:24",label:"设备名称",path:"devName"},{default:t(()=>[e(G,{show:M.value,placement:"right-start"},{trigger:t(()=>[W(e(d,{clearable:"",value:n.devName,"onUpdate:value":s[1]||(s[1]=r=>n.devName=r),maxlength:"64",placeholder:"请输入设备名称"},null,8,["value"]),[[K]])]),default:t(()=>[Qe]),_:1},8,["show"])]),_:1}),e(p,{span:"24 m:24",label:"通讯地址",path:"devCommAddr"},{default:t(()=>[e(d,{clearable:"",value:n.devCommAddr,"onUpdate:value":s[2]||(s[2]=r=>n.devCommAddr=r),maxlength:"50",placeholder:"请输入通讯地址"},null,8,["value"])]),_:1}),e(p,{span:"24 m:24",label:"公共地址",path:"devPubAddr"},{default:t(()=>[e(d,{clearable:"",value:n.devPubAddr,"onUpdate:value":s[3]||(s[3]=r=>n.devPubAddr=r),placeholder:"请输入公共地址"},null,8,["value"])]),_:1}),u.operateType=="edit"?(L(),Y(p,{key:0,span:"24 m:24",label:"设备有效性",path:"devValid"},{default:t(()=>[e(v,{value:n.devValid,"onUpdate:value":s[4]||(s[4]=r=>n.devValid=r),name:"radiogroup"},{default:t(()=>[e(o,null,{default:t(()=>[e(a,{label:"是",value:1}),e(a,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):xe("",!0),e(p,{span:"24 m:24",label:"设备描述",path:"devDesc"},{default:t(()=>[e(d,{clearable:"",value:n.devDesc,"onUpdate:value":s[5]||(s[5]=r=>n.devDesc=r),placeholder:"请输入设备描述",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ye=ee({__name:"merge_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:X(["submitted"],["update:visible"]),setup(N,{emit:R}){const b=ve({0:"采集104tcp",1:"采集104udp"}),g=se(N,"visible"),u=T(null),n=T({targetDevice:void 0,EquipmentMerged:void 0}),k=()=>{},h={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}},A=T(!1);return(_,i)=>{const U=te,D=de,O=ue,$=ie,q=z,B=Q,y=re;return L(),fe(Oe,null,[e(y,{show:g.value,"onUpdate:show":i[3]||(i[3]=c=>g.value=c),title:"设备合并",preset:"card",class:"w-40%"},{footer:t(()=>[e(B,{size:16,justify:"center"},{default:t(()=>[e(q,{onClick:i[2]||(i[2]=c=>g.value=!1),class:"w-100px"},{default:t(()=>[S(V(_.$t("common.cancel")),1)]),_:1}),e(q,{type:"primary",class:"w-100px",onClick:k},{default:t(()=>[S(V(_.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e($,{ref_key:"formRef",ref:u,"label-width":120,"label-placement":"left",model:n.value,rules:h},{default:t(()=>[e(O,{responsive:"screen","item-responsive":""},{default:t(()=>[e(D,{span:"24 m:12",label:"目标设备",path:"targetDevice"},{default:t(()=>[e(U,{filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.targetDevice,"onUpdate:value":i[0]||(i[0]=c=>n.value.targetDevice=c),options:l(Z)(l(b))},null,8,["value","options"])]),_:1}),e(D,{span:"24 m:12",label:"待合并设备",path:"EquipmentMerged"},{default:t(()=>[e(U,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.EquipmentMerged,"onUpdate:value":i[1]||(i[1]=c=>n.value.EquipmentMerged=c),options:l(Z)(l(b))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(y,{show:A.value,"onUpdate:show":i[4]||(i[4]=c=>A.value=c),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),Ze=ee({__name:"move_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:X(["submitted"],["update:visible"]),setup(N,{emit:R}){const b=ve({0:"采集104tcp",1:"采集104udp"}),g=se(N,"visible"),u=T(null),n=T({targetDevice:void 0,EquipmentMerged:void 0}),k=()=>{},h={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}};return(A,_)=>{const i=te,U=de,D=ue,O=ie,$=z,q=Q,B=re;return L(),Y(B,{show:g.value,"onUpdate:show":_[3]||(_[3]=y=>g.value=y),title:"设备移动至通道",preset:"card",class:"w-40%"},{footer:t(()=>[e(q,{size:16,justify:"center"},{default:t(()=>[e($,{onClick:_[2]||(_[2]=y=>g.value=!1),class:"w-100px"},{default:t(()=>[S(V(A.$t("common.cancel")),1)]),_:1}),e($,{type:"primary",class:"w-100px",onClick:k},{default:t(()=>[S(V(A.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(O,{ref_key:"formRef",ref:u,"label-width":120,"label-placement":"left",model:n.value,rules:h},{default:t(()=>[e(D,{responsive:"screen","item-responsive":""},{default:t(()=>[e(U,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:t(()=>[e(i,{filterable:"",clearable:"",placeholder:"请选择通道",value:n.value.targetDevice,"onUpdate:value":_[0]||(_[0]=y=>n.value.targetDevice=y),options:l(Z)(l(b))},null,8,["value","options"])]),_:1}),e(U,{span:"24 m:12",label:"待移动设备",path:"EquipmentMerged"},{default:t(()=>[e(i,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.EquipmentMerged,"onUpdate:value":_[1]||(_[1]=y=>n.value.EquipmentMerged=y),options:l(Z)(l(b))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),et={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ae(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!Be(N)}const pt=ee({name:"configsetting_collectionservices_subdevicemanagement",__name:"index",setup(N){const R=Te(),M=oe({channelList:[],chlIdAndNameMap:{}}),{columns:b,columnChecks:g,data:u,getData:n,loading:k,mobilePagination:P,searchParams:h,resetSearchParams:A}=Ge({apiFn:Ve,apiParams:{page:1,pageSize:20,limit:20,type:0,chlId:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",fixed:"left",width:48},{key:"id",title:"设备ID",align:"center",fixed:"left",width:60},{key:"devName",title:"设备名称",align:"center",width:100},{key:"chlId",title:"所属通道",align:"center",width:140,render:a=>e("span",null,[M.chlIdAndNameMap[a.chlId]])},{key:"devDesc",title:"设备描述",align:"center",width:140,render:a=>e("span",null,[a.devDesc?a.devDesc:"无"])},{key:"devCommAddr",title:"设备通信地址",align:"center",width:140},{key:"devPubAddr",title:"设备公共地址",align:"center",width:140},{key:"devValid",title:"有效性",align:"center",width:140,render:a=>{let o;return e(Pe,{type:a.devValid==0?"error":"success"},ae(o=x(Je[a.devValid]))?o:{default:()=>[o]})}},{key:"operate",title:x("common.operate"),align:"center",width:250,fixed:"right",render:a=>{let o;return e("div",{class:"flex-center gap-8px"},[e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>G(a)},{default:()=>["采集测点管理"]}),W(e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>j(a.id)},ae(o=x("common.edit"))?o:{default:()=>[o]}),[[H("no-auth"),"device:update"]]),W(e(He,{onPositiveClick:()=>c(a.id)},{default:()=>x("common.confirmDelete"),trigger:()=>{let v;return e(z,{type:"error",ghost:!0,size:"small"},ae(v=x("common.delete"))?v:{default:()=>[v]})}}),[[H("no-auth"),"device:delete"]])])}}]});async function _(){var v;const{data:a,error:o}=await _e({type:0});if(!o){if(a.length==0)return(v=window.$message)==null?void 0:v.warning("暂无通道，请先添加通道");M.channelList=a,a.forEach(m=>{M.chlIdAndNameMap[m.id]=m.chlName});const I=R.currentRoute.value.query.channelId;I&&(h.chlId=Number(I)),n()}}Ee(()=>{_()});const{drawerVisible:i,operateType:U,editingData:D,handleAdd:O,handleEdit:$,checkedRowKeys:q,onBatchDeleted:B,onDeleted:y}=Ke(u,n),c=async a=>{const{data:o,error:v}=await Re({ids:a});v||y()},s=a=>{h.chlId=a,n()},j=a=>{$(a)},p=T(!1),d=T(!1),G=a=>{R.push({path:"/configsetting/collectionservices/pointmanagement",query:{channelId:a.chlId,deviceId:a.id}})};return(a,o)=>{const v=We,I=te,m=me,F=ke,E=je,C=Q,K=Ne,r=we,w=ye,J=Fe,ge=Le,be=H("no-space"),he=H("no-auth");return L(),fe("div",et,[e(ge,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(C,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(E,null,{default:t(()=>[e(v,null,{default:t(()=>[S("所属通道")]),_:1}),e(I,{filterable:"",clearable:"",placeholder:"请选择通道",value:l(h).chlId,"onUpdate:value":o[0]||(o[0]=f=>l(h).chlId=f),"label-field":"chlName","value-field":"id",options:M.channelList,onUpdateValue:s},null,8,["value","options"]),e(v,null,{default:t(()=>[S("设备名称")]),_:1}),W(e(m,{clearable:"",value:l(h).fuzzy,"onUpdate:value":o[1]||(o[1]=f=>l(h).fuzzy=f),placeholder:"请输入设备名称",style:{width:"100%"}},null,8,["value"]),[[be]]),e(l(z),{type:"primary",ghost:"",onClick:l(n)},{icon:t(()=>[e(F,{class:ne(["text-icon",{"animate-spin":l(k)}])},null,8,["class"])]),default:t(()=>[S(" "+V(l(x)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":t(()=>[e(C,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[W((L(),Y(l(z),{onClick:l(O),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(K,{class:ne(["text-icon",{"animate-spin":l(k)}])},null,8,["class"])]),default:t(()=>[S(" "+V(l(x)("common.add")),1)]),_:1},8,["onClick"])),[[he,"device:insert"]]),e(l(z),{onClick:l(n),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(r,{class:ne(["text-icon",{"animate-spin":l(k)}])},null,8,["class"])]),_:1},8,["onClick"]),e(w,{columns:l(g),"onUpdate:columns":o[2]||(o[2]=f=>le(g)?g.value=f:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(J,{"checked-row-keys":l(q),"onUpdate:checkedRowKeys":o[3]||(o[3]=f=>le(q)?q.value=f:null),columns:l(b),data:l(u),size:"small",loading:l(k),remote:"","row-key":f=>f.id,pagination:l(u).length?l(P):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Xe,{visible:l(i),"onUpdate:visible":o[4]||(o[4]=f=>le(i)?i.value=f:null),onSubmitted:l(n),"operate-type":l(U),"row-data":l(D),chlId:l(h).chlId},null,8,["visible","onSubmitted","operate-type","row-data","chlId"]),e(Ye,{visible:p.value,"onUpdate:visible":o[5]||(o[5]=f=>p.value=f)},null,8,["visible"]),e(Ze,{visible:d.value,"onUpdate:visible":o[6]||(o[6]=f=>d.value=f)},null,8,["visible"])]),_:1})])}}});export{pt as default};
