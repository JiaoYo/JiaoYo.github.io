import{o as $,e as W,f as y,d as se,j as m,aV as j,g as o,v as oe,ae as re,w as c,c as z,h,t as g,i as x,B as C,aW as L,Z as K,aK as D,ap as ce,x as A,F as H,aX as J,aY as M,E as P,az as V,ab as ue,aZ as de,K as ie,a_ as pe,a$ as _e,a1 as ve,M as fe,N as me,O as he}from"./index-C2u6vOA1.js";import{_ as ye}from"./Tree-4caxcqoe.js";import{_ as ke}from"./Slider-B-uD_NTx.js";import{_ as ge}from"./DataTable-B59_lcFE.js";import{_ as xe}from"./Split-DdPVVjTV.js";import"./RadioGroup-dVRs7CWd.js";import"./Forward-DB9iWvzA.js";const we={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},be=y("path",{fill:"currentColor",d:"M17 9.17a1 1 0 0 0-1.41 0L12 12.71L8.46 9.17a1 1 0 0 0-1.41 0a1 1 0 0 0 0 1.42l4.24 4.24a1 1 0 0 0 1.42 0L17 10.59a1 1 0 0 0 0-1.42"},null,-1),Ne=[be];function Ce(S,U){return $(),W("svg",we,[...Ne])}const $e={name:"uil-angle-down",render:Ce},Se=S=>(fe("data-v-72ea1523"),S=S(),me(),S),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Te={class:"flex h-100%",style:{"flex-direction":"column"}},Ie={class:"flex"},ze=Se(()=>y("span",null,"监测级别",-1)),Be={class:"flex items-center"},Le={class:"flex items-center"},De={class:"cursor-pointer"},Ue=se({name:"configsetting_realtimedata_channeldetection",__name:"index",setup(S){const U=m({0:"简单",1:"标准",2:"详细"}),b=m(!0),w=m([]),k=m(null),Z=m([{title:"监视时间",key:"time",width:240,render(e){return j(2,e.time)}},{title:"监视类型",key:"data_type",width:120,render(e){return e.data_type==0?"发送>>":e.data_type==1?"接收<<":e.data_type==2?"信息  ":e.data_type==3?"警告  ":"错误  "}},{title:"内容长度",key:"data_len",width:120},{title:"监视内容",key:"data_buf",render(e){return o("div",{innerHTML:e.data_buf},null)}}]),t=m({acceptColor:"#d6f0f0",sendOutColor:"#ffe3bf",infoColor:"#f4f4f5",warningColor:"#fdf6ec",errorColor:"#fee7e7",acceptNums:0,sendOutNums:0,infoNums:0,errorNums:0,warningNums:0}),q=[{label:"信息",key:0},{label:"警告",key:1},{label:"错误",key:2}],F=e=>D(L,{value:e.key==0?t.value.infoNums:e.key==1?t.value.warningNums:t.value.errorNums},{default:()=>D("div",{class:"c-#676d71 w-50px h-32px flex items-center justify-center",style:{backgroundColor:e.key==0?t.value.infoColor:e.key==1?t.value.warningColor:t.value.errorColor,borderRadius:"4px"}},{default:()=>e.label})}),G=e=>({style:{minHeight:"50px",background:e.data_type==0?t.value.sendOutColor:e.data_type==1?t.value.acceptColor:e.data_type==2?t.value.infoColor:e.data_type==3?t.value.warningColor:t.value.errorColor}}),X=({option:e})=>e.key==0?"":e.chl_status!==null?D("span",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:e.hasOwnProperty("chl_status")&&e.chl_status==1?"#00b42a":e.chl_status==2?"#ff0000":"#ccc"}}):"",N=m(),Y=async()=>{var n,r,s,v;const{data:e,error:l}=await ce();if((e==null?void 0:e.length)==0)return;const u=e.reduce((i,p)=>{const f=p.chlType===0?"采集通道":p.chlType===1?"转发通道":"系统通道";let _=i.find(a=>a.key===f);return _||(_={key:f,label:f,children:[],chl_status:null},i.push(_)),_.children.push({key:p.id,label:p.chlName,chlType:p.chlType,chl_status:null}),f=="系统通道"?[]:i},[]);N.value=u,N.value.length>0&&(d.value.chlId=(r=(n=N.value[0])==null?void 0:n.children[0])==null?void 0:r.key,I.value=[(v=(s=N.value[0])==null?void 0:s.children[0])==null?void 0:v.key],Q(),T())},d=m({chlId:"",type:1,level:1}),O=m(null),T=()=>{var v;(v=O.value)==null||v.close(),w.value=[],t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0};const e=new Date().getTime(),l=d.value.level==0?"1":d.value.level==1?"257":"65793";d.value.type=1;const u=A(),n=H(`${u}${e}${d.value.chlId}`),r=J(n),s=new M(P.replace("https","wss")+`/ChannelDetectionWebsocket/${d.value.chlId}/${d.value.type}/${l}/${r}/${e}/${u}?token=${V()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});O.value=s,s.connect(),s.onclose(()=>{}),s.onerror(()=>{}),s.onopen(()=>{}),s.onmessage(i=>{if(console.log(i,"通道监测websocket接受数据"),!R(i.data))return;const p=JSON.parse(i.data);if(w.value.push(...p.param),b.value&&k.value){const a=document.querySelector(".n-scrollbar-content"),ne=a==null?void 0:a.scrollHeight;a&&ue(()=>{k.value.scrollTo({top:ne,behavior:"smooth"})})}t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0};let f=`      监视时间                  监视类型      内容长度          监视内容
`,_="";w.value.forEach(a=>{switch(a.data_type){case 0:t.value.sendOutNums+=1;break;case 1:t.value.acceptNums+=1;break;case 2:t.value.infoNums+=1;break;case 3:t.value.warningNums+=1;break;case 4:t.value.errorNums+=1;break}_+=j(2,a.time)+"           "+(a.data_type==0?"发送>>":a.data_type==1?"接受<<":a.data_type==2?"信息  ":a.data_type==3?"警告  ":"错误  ")+"         "+a.data_len+"          "+a.data_buf+`
`}),k.value.content=f+_,w.value.length>=1e3&&(w.value=[])})},B=m(null),Q=()=>{var s;(s=B.value)==null||s.close();const e=new Date().getTime(),l=A(),u=H(`${l}${e}getchlstatus`),n=J(u),r=new M(P.replace("https","wss")+`/ChannelStatusWebsocket/getchlstatus/${n}/${e}/${l}?token=${V()}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});B.value=r,r.connect(),r.onclose(()=>{}),r.onerror(()=>{}),r.onopen(()=>{}),r.onmessage(v=>{let i=[];console.log(v,"通道状态websocket接受数据"),R(v.data)&&(i=JSON.parse(v.data).data,N.value.forEach(p=>{var f;(f=p.children)==null||f.forEach(_=>{i.forEach(a=>{a.chl_id==_.key&&(_.chl_status=a.chl_status)})})}))})};oe(()=>{Y()}),re(()=>{var e,l;(e=O.value)==null||e.close(),(l=B.value)==null||l.close()});const I=m([]),ee=async(e,l,u)=>{var n,r,s;((n=u.node)==null?void 0:n.key)!=I.value[0]&&(I.value=[(r=u.node)==null?void 0:r.key],d.value.chlId=(s=u.node)==null?void 0:s.key,T())},te=e=>{T()},E=e=>{d.value.type=e,O.value.close(),e==1&&T()},ae=()=>{w.value=[],t.value={...t.value,sendOutNums:0,acceptNums:0,infoNums:0,warningNums:0,errorNums:0},k.value.content=""},le=()=>{let e=k.value.content?k.value.content+"":k.value.content,l=new de(".Btn",{text:function(){return e}});l.on("success",u=>{var n;(n=window.$message)==null||n.success("复制成功"),l.destroy()}),l.on("error",u=>{var n;(n=window.$message)==null||n.error("复制失败"),l.destroy()})},R=e=>{try{return JSON.parse(e),!0}catch{return!1}};return(e,l)=>{const u=ye,n=ie,r=ke,s=pe,v=$e,i=_e,p=ve,f=ge,_=xe;return $(),W("div",Oe,[o(p,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:c(()=>[o(_,{direction:"horizontal",class:"sm:h-full","default-size":.15,max:.35,min:.1,"resize-trigger-size":6},{1:c(()=>[o(u,{"block-line":"","default-expand-all":"",data:N.value,"checked-keys":I.value,"expand-on-click":!1,"check-strategy":"child","onUpdate:checkedKeys":ee,"render-prefix":X,checkable:""},null,8,["data","checked-keys"])]),2:c(()=>[y("div",Te,[o(p,{bordered:!1,size:"small",class:"card-wrapper",style:{"min-height":"60px"}},{header:c(()=>[o(n,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:c(()=>[d.value.type==0?($(),z(x(C),{key:0,onClick:l[0]||(l[0]=a=>E(1))},{default:c(()=>[h(g("开启监视"))]),_:1})):($(),z(x(C),{key:1,onClick:l[1]||(l[1]=a=>E(0))},{default:c(()=>[h(g("停止监视"))]),_:1})),b.value?($(),z(x(C),{key:3,onClick:l[3]||(l[3]=a=>b.value=!b.value)},{default:c(()=>[h(g("停止滚屏"))]),_:1})):($(),z(x(C),{key:2,onClick:l[2]||(l[2]=a=>b.value=!b.value)},{default:c(()=>[h(g("开启滚屏"))]),_:1})),o(x(C),{onClick:ae},{default:c(()=>[h(g("清空列表"))]),_:1}),o(x(C),{onClick:le,class:"Btn"},{default:c(()=>[h(g("复制全部内容"))]),_:1})]),_:1})]),"header-extra":c(()=>[o(n,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:c(()=>[y("div",Ie,[ze,o(r,{value:d.value.level,"onUpdate:value":[l[4]||(l[4]=a=>d.value.level=a),te],step:1,marks:U.value,min:0,max:2,style:{margin:"0 10px",width:"170px !important"}},null,8,["value","marks"])]),y("div",Be,[h(" 发送报文颜色 "),o(s,{class:"w-24px h-24px ml-5px",swatches:["#ffe3bf","#d6f0f0"],value:t.value.sendOutColor,"onUpdate:value":l[5]||(l[5]=a=>t.value.sendOutColor=a)},null,8,["value"])]),y("div",Le,[h(" 接受报文颜色 "),o(s,{class:"w-24px h-24px ml-5px",swatches:["#ffe3bf","#d6f0f0"],value:t.value.acceptColor,"onUpdate:value":l[6]||(l[6]=a=>t.value.acceptColor=a)},null,8,["value"])]),o(x(L),{value:t.value.sendOutNums},{default:c(()=>[y("div",{style:K({background:t.value.sendOutColor}),class:"c-#676d71 w-50px h-32px flex items-center justify-center"},g("发送"),4)]),_:1},8,["value"]),o(x(L),{value:t.value.acceptNums},{default:c(()=>[y("div",{style:K({background:t.value.acceptColor}),class:"c-#676d71 w-50px h-32px flex items-center justify-center"},g("接收"),4)]),_:1},8,["value"]),o(i,{trigger:"click",options:q,"render-label":F},{default:c(()=>[y("span",De,[h("其他类型 "),o(v,{class:"font-size-20px"})])]),_:1})]),_:1})]),_:1}),o(f,{columns:Z.value,ref_key:"tableRef",ref:k,data:w.value,size:"small",remote:"","row-key":a=>a.id,"flex-height":!0,"scroll-x":"",class:"sm:h-full flex-1 pl-16px","row-props":G},null,8,["columns","data","row-key"])])]),_:1})]),_:1})])}}}),Me=he(Ue,[["__scopeId","data-v-72ea1523"]]);export{Me as default};
