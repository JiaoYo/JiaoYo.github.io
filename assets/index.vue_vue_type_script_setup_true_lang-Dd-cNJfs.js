import{_ as me}from"./round-add-CklvM9g8.js";import{d as G,aq as K,s as ae,q as ne,a as fe,ar as Z,a1 as H,c as I,o as k,w as t,f as e,F as J,y as O,z as oe,h as n,at as le,A as R,N as Q,B as T,g as D,t as x,$ as F,b6 as _e,p as W,bY as ve,r as A,c0 as ge,x as V,as as ye,C as E,e as v,b as q,T as be,E as se,c1 as he,a5 as we,a4 as xe,aw as ke,U as re,L as Se,i as Ce,az as Y,c2 as je,av as De,aC as Pe}from"./index-Di8oPgLW.js";import{f as ie,Y as Ne,Z as ze,_ as Te,$ as $e,a0 as Ie,a1 as Ue,a2 as Le}from"./project-DRu3AMfZ.js";import{u as Me,a as Be}from"./table-Dm46UBms.js";import{u as ce}from"./usePageData-DCTUleRA.js";import{_ as Fe}from"./Avatar-BlXGE7e6.js";import{_ as Ee}from"./text-mhg-TU-S.js";import{N as de}from"./Popconfirm-1WQGFJyG.js";import{_ as Re}from"./round-search-7wOoFfG_.js";import{_ as qe}from"./Grid-B4qyEiJt.js";import{_ as Oe}from"./FormItemGridItem-I5PiQxhG.js";const Ve=G({name:"OperateDrawer",__name:"operate-drawer",props:K({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(C,{emit:U}){const l=U,b=C,a=ae(h());function h(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null}}const S={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施"}},{pageData:p,getData:_,nextPage:L}=ce(ie),$=async i=>{const r=i.currentTarget;r.scrollTop+r.offsetHeight>=r.scrollHeight&&p.data.length<p.total&&L()},j=async i=>{i?a.pid=i:a.value.pid=null},P=async()=>{var i;if(await _(),p.data.length==0)return(i=window.$message)==null?void 0:i.warning("没有项目")};async function M(){Object.assign(a,h()),await P(),b.pid&&(p.data.forEach(i=>{i.id==b.pid&&(i.disabled=!0)}),a.pid=b.pid),b.operateType==="edit"&&b.rowData&&Object.assign(a,b.rowData)}const{formRef:g,validate:o,restoreValidation:u}=ne(),c=fe(()=>({add:"新增项目总结",edit:"修改项目总结"})[b.operateType]),w=Z(C,"visible"),N=()=>{w.value=!1},B=async()=>{var i,r;if(await o(),b.operateType==="edit"){const{data:y,error:f}=await Ne([{...a}]);f||((i=window.$message)==null||i.success("修改成功"),l("submitted"),N())}else{const y=a.pids.map(s=>({pid:s}));y.forEach(s=>{s.content1=a.content1,s.content2=a.content2,s.content3=a.content3,s.content4=a.content4,s.content5=a.content5});const{data:f,error:d}=await ze(y);d||((r=window.$message)==null||r.success("添加成功"),l("submitted"),N())}};return H(w,()=>{w.value&&(M(),setTimeout(()=>{const i=document.querySelector(".n-scrollbar-content");i==null||i.scrollTo(0,0)},300),u())}),(i,r)=>{const y=oe,f=J,d=Q,s=_e;return k(),I(s,{show:w.value,"onUpdate:show":r[6]||(r[6]=m=>w.value=m),title:c.value,preset:"card",class:"w-570px"},{footer:t(()=>[e(d,{justify:"end"},{default:t(()=>[e(n(T),{size:"small",class:"mt-16px",onClick:N},{default:t(()=>[D(x(n(F)("common.cancel")),1)]),_:1}),e(n(T),{type:"primary",size:"small",class:"mt-16px",onClick:B},{default:t(()=>[D(x(n(F)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(f,{ref_key:"formRef",ref:g,model:a,rules:S},{default:t(()=>[b.operateType==="add"?(k(),I(y,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:t(()=>[e(n(le),{clearable:"",filterable:"",value:a.pid,"onUpdate:value":[r[0]||(r[0]=m=>a.pid=m),j],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:n(p).data,onScroll:$},null,8,["value","options"])]),_:1})):O("",!0),e(y,{label:"前期准备阶段描述",path:"content1"},{default:t(()=>[e(n(R),{clearable:"",type:"textarea",value:a.content1,"onUpdate:value":r[1]||(r[1]=m=>a.content1=m),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),e(y,{label:"遇到问题及对项目的影响",path:"content2"},{default:t(()=>[e(n(R),{clearable:"",type:"textarea",value:a.content2,"onUpdate:value":r[2]||(r[2]=m=>a.content2=m),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),e(y,{label:"经验教训与改进方案或措施",path:"content3"},{default:t(()=>[e(n(R),{clearable:"",type:"textarea",value:a.content3,"onUpdate:value":r[3]||(r[3]=m=>a.content3=m),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(y,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:t(()=>[e(n(R),{clearable:"",type:"textarea",value:a.content4,"onUpdate:value":r[4]||(r[4]=m=>a.content4=m),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(y,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:t(()=>[e(n(R),{clearable:"",type:"textarea",value:a.content5,"onUpdate:value":r[5]||(r[5]=m=>a.content5=m),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ae={class:"mt-4 border-t pt-3"},Ke={class:"flex items-start gap-2 mb-3"},He={class:"ml-2 flex-1"},Ge={class:"flex items-center"},Ye={class:"font-medium font-size-16px font-bold"},Ze={class:"text-gray-600 mt-1"},Je=G({name:"drawerLog",__name:"drawerLog",props:K({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(C){const U=W();ve();const l=ae({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""}),b=C,a={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},h=A({});async function S(){p.value=[],Object.assign(l,b.rowData),j()}const p=A([]),_=Z(C,"visible");H(_,()=>{_.value?S():(p.value=[],l.id=void 0)});function L(g){g||$()}function $(){_.value=!1}const j=async()=>{const{data:g,error:o}=await $e({page:1,limit:100,pid:l.id});g&&(p.value=g.list)},P=ge.debounce(async()=>{var c;const g=h.value[l.id];if(!(g!=null&&g.trim()))return(c=window.$message)==null?void 0:c.warning("请输入评论内容");const{data:o,error:u}=await Te([{pid:l.id,content:g}]);o&&(h.value[l.id]="",l.num++,j())},1e3,{leading:!0,trailing:!1}),M=async g=>{var c;const{data:o,error:u}=await Ie(g.id);o&&(j(),l.num--,(c=window.$message)==null||c.success("删除成功"))};return(g,o)=>{const u=oe,c=J,w=Fe,N=Ee,B=ye,i=ke,r=V("i"),y=V("no-auth");return k(),I(i,{show:_.value,"onUpdate:show":[o[1]||(o[1]=f=>_.value=f),L],"display-directive":"show",width:600,onMaskClick:$,onEsc:$},{default:t(()=>[e(B,{title:l.username+"的项目总结","native-scrollbar":!1,closable:""},{default:t(()=>[e(c,{ref:"formRef",model:l},{default:t(()=>[e(u,{label:"",path:"contractname"},{label:t(()=>o[2]||(o[2]=[v("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:t(()=>[v("span",null,x(l.proname),1)]),_:1}),e(u,{label:"前期准备阶段描述",path:"content1"},{label:t(()=>o[3]||(o[3]=[v("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:t(()=>[v("span",null,x(l.content1),1)]),_:1}),e(u,{label:"遇到问题及对项目的影响",path:"content2"},{label:t(()=>o[4]||(o[4]=[v("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:t(()=>[v("span",null,x(l.content2),1)]),_:1}),e(u,{label:"经验教训与改进方案或措施",path:"content3"},{label:t(()=>o[5]||(o[5]=[v("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:t(()=>[v("span",null,x(l.content3),1)]),_:1}),e(u,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:t(()=>o[6]||(o[6]=[v("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:t(()=>[v("span",null,x(l.content4),1)]),_:1}),e(u,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:t(()=>o[7]||(o[7]=[v("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:t(()=>[v("span",null,x(l.content5),1)]),_:1})]),_:1},8,["model"]),E((k(),q("div",null,[D(x(l.num)+"评论",1)])),[[r,l.num]]),e(be,{name:"fade"},{default:t(()=>[v("div",Ae,[E((k(),q("div",Ke,[v("div",null,[e(w,{size:"small",src:a.avatar},null,8,["src"])]),e(n(R),{type:"textarea",id:`comment-input-${l.id}`,value:h.value[l.id],"onUpdate:value":o[0]||(o[0]=f=>h.value[l.id]=f),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:se(he(n(P),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),e(n(T),{type:"primary",ghost:"",onClick:n(P)},{default:t(()=>o[8]||(o[8]=[D("发送")])),_:1,__:[8]},8,["onClick"])])),[[y,"project:Summary:Comment:insert"]]),(k(!0),q(we,null,xe(p.value,f=>(k(),q("div",{key:f.id,class:"flex mb-3"},[e(w,{size:"small",src:a.avatar},null,8,["src"]),v("div",He,[v("div",Ge,[v("span",Ye,x(f.username),1),e(N,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:t(()=>[D(x(f.dbtime),1)]),_:2},1024),n(U).userInfo.id==f.creater?(k(),I(n(de),{key:0,onPositiveClick:d=>M(f)},{trigger:t(()=>[E((k(),I(n(T),{quaternary:"",type:"error",size:"small"},{default:t(()=>o[9]||(o[9]=[D(" 删除 ")])),_:1,__:[9]})),[[y,"project:Summary:Comment:delete"]])]),default:t(()=>[o[10]||(o[10]=D(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):O("",!0)]),v("div",Ze,x(f.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Qe=G({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search","clear"],["update:model"]),setup(C,{emit:U}){const l=U,{formRef:b}=ne(),a=Z(C,"model"),h=W(),S=A([]),{pageData:p,getData:_,nextPage:L}=ce(ie),$=async u=>{const c=u.currentTarget;c.scrollTop+c.offsetHeight>=c.scrollHeight&&p.data.length<p.total&&(L(),S.value=p.data)},j=async u=>{var c;u?(a.value.pid=u,l("search"),h.setProjectInfo({pname:(c=S.value.find(w=>w.id==u))==null?void 0:c.proname,pid:u})):l("search")},P=async u=>{await _({fuzzy:u}),S.value=p.data},M=async()=>{await _(),S.value=p.data};(async()=>{var u,c;await _({fuzzy:h.userInfo.pname}),S.value=p.data,a.value.pid=h.userInfo.pid?h.userInfo.pid:(u=S.value[0])==null?void 0:u.id,h.setProjectInfo({pid:a.value.pid,pname:(c=S.value.find(w=>w.id==a.value.pid))==null?void 0:c.proname}),l("search")})();async function o(){l("search")}return(u,c)=>{const w=le,N=Oe,B=Re,i=T,r=Q,y=qe,f=J,d=re;return k(),I(d,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(f,{ref_key:"formRef",ref:b,model:a.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:se(o,["enter"])},{default:t(()=>[e(y,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(N,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:t(()=>[e(w,{filterable:"",clearable:"",value:a.value.pid,"onUpdate:value":[c[0]||(c[0]=s=>a.value.pid=s),j],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:S.value,onScroll:$,onClear:M,onSearch:P},null,8,["value","options"])]),_:1}),e(N,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(r,{class:"w-full"},{default:t(()=>[e(i,{type:"primary",ghost:"",onClick:o},{icon:t(()=>[e(B,{class:"text-icon"})]),default:t(()=>[D(" "+x(n(F)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),We={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Xe={key:0};function te(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!Pe(C)}const ut=G({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(C,{emit:U}){const l=Se(),b=W(),a=C,h=U,{columns:S,data:p,getData:_,loading:L,mobilePagination:$,searchParams:j}=Me({showTotal:!0,immediate:!1,apiFn:Ue,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:d=>e("div",null,[d.username+"的项目总结"])},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:F("common.operate"),align:"center",width:140,fixed:"right",render:d=>{let s;return e("div",{class:"flex-center gap-8px"},[e(T,{type:"primary",ghost:!0,size:"small",onClick:()=>y(d)},{default:()=>[D("查看详情")]}),b.userInfo.id==d.creater&&E(e(T,{type:"primary",ghost:!0,size:"small",onClick:()=>B(d.id)},te(s=F("common.edit"))?s:{default:()=>[s]}),[[V("no-auth"),"project:Summary:update"]]),b.userInfo.id==d.creater&&e(de,{onPositiveClick:()=>N(d.id)},{default:()=>F("common.confirmDelete"),trigger:()=>{let m;return E(e(T,{type:"error",ghost:!0,size:"small"},te(m=F("common.delete"))?m:{default:()=>[m]}),[[V("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:P,operateType:M,editingData:g,handleAdd:o,handleEdit:u,checkedRowKeys:c,onDeleted:w}=Be(p,_);async function N(d){const{data:s,error:m}=await Le(d);m||w()}function B(d){u(d)}const i=A(!1),r=A({}),y=d=>{i.value=!0,r.value=d},f=()=>{_()};return H(()=>a.pid,async d=>{d&&(j.pid=d,await _())}),H(()=>p.value,async d=>{d.length>0?h("thereIsData",1):h("thereIsData",0)}),Ce(()=>{a.type!="externalLiaison"&&_()}),(d,s)=>{const m=Q,X=me,ue=De,pe=re,ee=V("no-auth");return k(),q("div",We,[a.pid?O("",!0):(k(),I(Qe,{key:0,model:n(j),"onUpdate:model":s[0]||(s[0]=z=>Y(j)?j.value=z:null),onReset:f,onSearch:n(_),onClear:s[1]||(s[1]=z=>p.value=[])},null,8,["model","onSearch"])),e(pe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},je({header:t(()=>[e(m,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[a.pid?O("",!0):(k(),q("div",Xe,"项目总结"))]),_:1}),a.pid?E((k(),I(n(T),{key:0,onClick:n(o),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(X,{class:"text-icon"})]),default:t(()=>[s[5]||(s[5]=D(" "+x("新增")))]),_:1,__:[5]},8,["onClick"])),[[ee,"project:Summary:insert"]]):O("",!0)]),default:t(()=>[e(ue,{"checked-row-keys":n(c),"onUpdate:checkedRowKeys":s[2]||(s[2]=z=>Y(c)?c.value=z:null),columns:n(S),data:n(p),size:"small","flex-height":!n(l).isMobile,loading:n(L),remote:"","row-key":z=>z.id,pagination:n($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ve,{visible:n(P),"onUpdate:visible":s[3]||(s[3]=z=>Y(P)?P.value=z:null),onSubmitted:n(_),"operate-type":n(M),pid:a.pid||n(j).pid,"row-data":n(g)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),e(Je,{visible:i.value,"onUpdate:visible":s[4]||(s[4]=z=>i.value=z),"row-data":r.value},null,8,["visible","row-data"])]),_:2},[a.pid?void 0:{name:"header-extra",fn:t(()=>[e(m,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[E((k(),I(n(T),{onClick:n(o),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(X,{class:"text-icon"})]),default:t(()=>[s[6]||(s[6]=D(" "+x("新增")))]),_:1,__:[6]},8,["onClick"])),[[ee,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{ut as _};
