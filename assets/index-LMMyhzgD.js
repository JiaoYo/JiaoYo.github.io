import{d as Z,q as le,j as b,Z as ae,v as de,s as te,r as F,L as pe,o as E,c as U,w as n,g as a,O as ee,M as ce,i as S,$ as A,U as fe,e as q,ai as ve,h as _,t as h,f as Q,N as me,aw as _e,an as V,ao as K,A as ge,X as he,B as W,E as Y,D as Ie,a9 as ne,y as ye,am as X,ad as oe,ap as Se,aq as be,S as we,F as xe,ax as Ae,ay as ke,au as se}from"./index-W31l-hMM.js";import{l as ie}from"./lodash-TTc0gmdQ.js";import{_ as Ee,a as Ce}from"./arrow-open-up-CnFTcNhn.js";import{_ as De}from"./round-search-rrZxW6gK.js";import{_ as Te}from"./round-refresh-BMibHRNx.js";import{a as $e,T as J}from"./basicconf-DVqQKAlq.js";import{b as ze,a as Ne,f as Pe}from"./common-EHk80M_j.js";import{_ as Le}from"./Cascader-0zBorgsn.js";import{_ as Ve}from"./FormItemGridItem-D73TxqmL.js";import{_ as Ue}from"./DatePicker-C1EVOkwN.js";import{_ as Oe}from"./Grid-CIumVYLX.js";import{q as Me,f as Be,r as Re}from"./events-Dqd4Kbte.js";import{e as Ge}from"./exportExcel-D6OyA9oJ.js";import{_ as He}from"./originlogInfo.vue_vue_type_script_setup_true_lang-CkiD3qqt.js";import{_ as je,a as Fe}from"./DescriptionsItem-m0roC6cp.js";import{_ as re}from"./DataTable--9asdZH_.js";import"./TimePicker-DCnBxtff.js";import"./defineProperty-Z6nS0v7G.js";import"./Forward-DyDCrUKk.js";import"./CollapseItem-DSC7F7rt.js";const qe=Z({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:le(["search"],["update:model"]),setup(g,{emit:D}){const T=D,s=b(!1),N=ae(),{formRef:y,restoreValidation:I}=de(),e=te(g,"model"),k=b();(async()=>{const{data:d,error:l}=await ze();l||(k.value=d.map(o=>({...o,id:"-"+o.id,type:o.cname})))})();const x=F({eventsTypeDataList:[],eventsCategoryData:[]});async function $(){const{data:d,error:l}=await Ne();l||(x.eventsTypeDataList=d)}$();async function w(){const{data:d,error:l}=await Pe();l||(x.eventsCategoryData=d)}w();function L(){e.value.fuzzy=void 0,i()}async function u(d,l){d?(e.value.startTime=d[0],e.value.endTime=d[1]):(e.value.startTime=null,e.value.endTime=null),T("search")}async function v(){await I(),e.value.lsid=null,e.value.etype=null,e.value.elevel=null,e.value.fuzzy=null,e.value.startAndEndSendSourceIp=null,e.value.startAndEndSourceIp=null,e.value.startAndEndAimSourceIp=null,e.value.timeRange=null,e.value.ectgr=null,e.value.startSourceIp=null,e.value.endSourceIp=null,e.value.startAimIp=null,e.value.endAimIp=null,e.value.startSIp=null,e.value.endSIp=null,e.value.startTime=null,e.value.endTime=null,_e(()=>{T("search")})}async function i(){var d,l,o,r,m,c,p,t,C,z;if(e.value.startAndEndSendSourceIp&&e.value.startAndEndSendSourceIp.length>0?(e.value.startSIp=e.value.startAndEndSendSourceIp[0]||null,e.value.endSIp=e.value.startAndEndSendSourceIp[1]||null):(e.value.startSIp=null,e.value.endSIp=null),e.value.startAndEndSourceIp&&e.value.startAndEndSourceIp.length>0?(e.value.startSourceIp=e.value.startAndEndSourceIp[0]||null,e.value.endSourceIp=e.value.startAndEndSourceIp[1]||null):(e.value.startSourceIp=void 0,e.value.endSourceIp=void 0),e.value.startAndEndAimSourceIp&&e.value.startAndEndAimSourceIp.length>0?(e.value.startAimIp=e.value.startAndEndAimSourceIp[0]||null,e.value.endAimIp=e.value.startAndEndAimSourceIp[1]||null):(e.value.startAimIp=void 0,e.value.endAimIp=void 0),e.value.startSIp&&!V(e.value.startSIp)||e.value.startSourceIp&&!V(e.value.startSourceIp)||e.value.startAimIp&&!V(e.value.startAimIp))return(d=window.$message)==null||d.destroyAll(),(l=window.$message)==null||l.error("请输入正确的IP地址"),!1;if(e.value.endSIp&&!V(e.value.endSIp)||e.value.endSourceIp&&!V(e.value.endSourceIp)||e.value.endAimIp&&!V(e.value.endAimIp))return(o=window.$message)==null||o.destroyAll(),(r=window.$message)==null||r.error("请输入正确的IP地址"),!1;if(e.value.startSIp&&e.value.endSIp&&K(e.value.startSIp,e.value.endSIp)>0)return(m=window.$message)==null||m.destroyAll(),(c=window.$message)==null||c.error("发生源起始IP不能大于发生源终止IP"),!1;if(e.value.startSourceIp&&e.value.endSourceIp&&K(e.value.startSourceIp,e.value.endSourceIp)>0)return(p=window.$message)==null||p.destroyAll(),(t=window.$message)==null||t.error("源起始IP不能大于源终止IP"),!1;if(e.value.startAimIp&&e.value.endAimIp&&K(e.value.startAimIp,e.value.endAimIp)>0)return(C=window.$message)==null||C.destroyAll(),(z=window.$message)==null||z.error("目的起始IP不能大于目的终止IP"),!1;T("search")}return(d,l)=>{const o=Le,r=Ve,m=ge,c=he,p=Ue,t=Te,C=W,z=De,O=Ee,M=Ce,B=Y,R=Oe,G=Ie,H=ne,j=pe("no-space");return E(),U(H,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(G,{ref_key:"formRef",ref:y,model:e.value,"label-placement":"left","label-width":S(N).locale=="en-US"?120:100,"show-feedback":!1,onKeyup:me(i,["enter"])},{default:n(()=>[a(R,{responsive:"screen","item-responsive":"","y-gap":12},{default:n(()=>[s.value?(E(),U(r,{key:0,span:"24 s:24 m:6",label:"日志源设备",path:"lsid",class:"pr-24px"},{default:n(()=>[a(o,{value:e.value.lsid,"onUpdate:value":[l[0]||(l[0]=f=>e.value.lsid=f),i],placeholder:"请选择日志源设备",options:k.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1})):ee("",!0),a(r,{span:"24 s:12 m:6",label:"事件名称",path:"fuzzy",class:"pr-24px"},{default:n(()=>[ce(a(m,{value:e.value.fuzzy,"onUpdate:value":l[1]||(l[1]=f=>e.value.fuzzy=f),placeholder:"请输入事件名称",clearable:"",onClear:L},null,8,["value"]),[[j]])]),_:1}),a(r,{span:"24 s:24 m:6",label:"事件类型",path:"etype",class:"pr-24px"},{default:n(()=>[a(c,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.etype,"onUpdate:value":[l[2]||(l[2]=f=>e.value.etype=f),i],"value-field":"id","label-field":"pname",options:x.eventsTypeDataList},null,8,["value","options"])]),_:1}),a(r,{span:"24 s:12 m:6",label:S(A)("page.manage.alarm.level"),path:"elevel",class:"pr-24px"},{default:n(()=>[a(c,{filterable:"",clearable:"",placeholder:S(A)("page.manage.alarm.form.level"),value:e.value.elevel,"onUpdate:value":[l[3]||(l[3]=f=>e.value.elevel=f),i],options:S(fe)(S($e))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),s.value?(E(),q(ve,{key:1},[a(r,{span:"24 s:24 m:8",label:"发生源IP",path:"startAndEndSendSourceIp",class:"pr-24px"},{default:n(()=>[a(m,{pair:"",separator:"-",placeholder:["发送源起始IP","发生源终止IP"],clearable:"",value:e.value.startAndEndSendSourceIp,"onUpdate:value":l[4]||(l[4]=f=>e.value.startAndEndSendSourceIp=f)},null,8,["value"])]),_:1}),a(r,{span:"24 s:24 m:8",label:"源IP",path:"startAndEndSourceIp",class:"pr-24px"},{default:n(()=>[a(m,{pair:"",separator:"-",placeholder:["源起始IP","源终止IP"],clearable:"",value:e.value.startAndEndSourceIp,"onUpdate:value":l[5]||(l[5]=f=>e.value.startAndEndSourceIp=f)},null,8,["value"])]),_:1}),a(r,{span:"24 s:24 m:8",label:"目的IP",path:"startAndEndAimSourceIp",class:"pr-24px"},{default:n(()=>[a(m,{pair:"",separator:"-",placeholder:["目的起始IP","目的终止IP"],clearable:"",value:e.value.startAndEndAimSourceIp,"onUpdate:value":l[6]||(l[6]=f=>e.value.startAndEndAimSourceIp=f)},null,8,["value"])]),_:1}),a(r,{span:"24 s:12 m:8",label:"产生时间",path:"timeRange",class:"pr-24px"},{default:n(()=>[a(p,{clearable:"",value:e.value.timeRange,"onUpdate:value":l[7]||(l[7]=f=>e.value.timeRange=f),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":u},null,8,["value"])]),_:1}),a(r,{span:"24 s:12 m:8",label:"事件类别",path:"ectgr",class:"pr-24px"},{default:n(()=>[a(c,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:e.value.ectgr,"onUpdate:value":[l[8]||(l[8]=f=>e.value.ectgr=f),i],"value-field":"id","label-field":"pname",options:x.eventsCategoryData},null,8,["value","options"])]),_:1})],64)):ee("",!0),a(r,{span:"24 s:12 m:6",class:"pr-24px"},{default:n(()=>[a(B,{class:"w-full",align:"center"},{default:n(()=>[a(C,{onClick:v},{icon:n(()=>[a(t,{class:"text-icon"})]),default:n(()=>[_(" "+h(S(A)("common.reset")),1)]),_:1}),a(C,{type:"primary",ghost:"",onClick:i},{icon:n(()=>[a(z,{class:"text-icon"})]),default:n(()=>[_(" "+h(S(A)("common.search")),1)]),_:1}),Q("div",{class:"cursor-pointer",title:"精准查询",onClick:l[9]||(l[9]=f=>s.value=!s.value)},[s.value?(E(),U(O,{key:0,class:"text-icon"})):(E(),U(M,{key:1,class:"text-icon"}))])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","label-width"])]),_:1})}}}),ue=g=>(Ae("data-v-314c6cd8"),g=g(),ke(),g),We=ue(()=>Q("span",null,"基本信息",-1)),Je=ue(()=>Q("span",null,"原始日志信息",-1)),Ke={key:0,style:{display:"flex","justify-content":"center","align-items":"center",color:"#606266","font-size":"14px",height:"400px"}},Xe={key:1,class:"max-h-500px min-h-450px"};function Ze(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!oe(g)}const Qe=Z({__name:"detailInfo",props:le({detailInfo:{}},{detailVisible:{default:!1},detailVisibleModifiers:{}}),emits:["update:detailVisible"],setup(g){const D=te(g,"detailVisible"),T=g,s=b();ye(()=>D.value,async u=>{u&&(s.value=T.detailInfo,e())});const N=[{title:"",key:"index",width:50,render:(u,v)=>`${v+1}`},{key:"pname2",title:"事件类别",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:140},{key:"elevel",title:"事件等级",align:"center",width:120,render:u=>{(u.elevel===void 0||u.elevel===null)&&(u.elevel=1);const v={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},i=A(J[u.elevel]);let d={color:v[u.elevel],textColor:"#ffffff",borderColor:v[u.elevel]};return a(X,{size:"small",color:d},Ze(i)?i:{default:()=>[i]})}},{key:"sourceip",title:"发生源IP",align:"center",width:120},{key:"rtime",title:"接收时间",align:"center",width:160},{key:"operate",title:A("common.operate"),align:"center",width:80,fixed:"right",render:u=>a("div",{class:"flex-center gap-8px"},[a(W,{type:"info",ghost:!0,size:"small",onClick:()=>L(u)},{default:()=>[_("详情")]})])}],y=b(!1);let I=b([]);const e=async u=>{var d;if(!y.value)y.value=!0;else return;const{data:v,error:i}=await Me({aggid:(d=s.value)==null?void 0:d.aggid,limit:10,pageId:u});i||(y.value=!1,u?I.value=[...I.value,...v]:I.value=v)};function k(u){var v;u.target.scrollTop+u.target.offsetHeight==u.target.scrollHeight&&((v=s.value)==null?void 0:v.aggre)>I.value.length&&P()}const P=ie.debounce(()=>{e(I.value[I.value.length-1].id)},300),x=F({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:u,endIndex:v,page:i,pageSize:d,pageCount:l,itemCount:o}){var r;return`已加载${I.value.length}条 共计${(r=s.value)==null?void 0:r.aggre} 条`}}),$=b(!1),w=b(),L=async u=>{$.value=!0,w.value=u};return(u,v)=>{const i=je,d=Fe,l=Y,o=Se,r=re,m=be,c=we,p=xe;return E(),U(p,{show:D.value,"onUpdate:show":v[1]||(v[1]=t=>D.value=t),title:"事件详情",preset:"card",class:"w-1000px"},{default:n(()=>[a(c,{class:"max-h-600px pr-20px"},{default:n(()=>[a(m,{type:"line",animated:""},{default:n(()=>[a(o,{name:"1"},{tab:n(()=>[We]),default:n(()=>[a(l,{vertical:"",size:12},{default:n(()=>[a(d,{"label-placement":"left",bordered:"",column:2,"label-style":{width:"160px"}},{default:n(()=>[a(i,{label:"事件名称"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.ename),1)]}),_:1}),a(i,{label:"事件类型"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.pname1),1)]}),_:1}),a(i,{label:"事件类别"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.pname2),1)]}),_:1}),a(i,{label:"事件等级"},{default:n(()=>{var t,C,z,O,M,B,R,G,H,j;return[a(S(X),{size:"small",color:{textColor:"#ffffff",borderColor:((t=s.value)==null?void 0:t.elevel)===0?"#8e9dff":((C=s.value)==null?void 0:C.elevel)===1?"#5da8ff":((z=s.value)==null?void 0:z.elevel)===2?"#fedc69":((O=s.value)==null?void 0:O.elevel)===3?"#ff9874":((M=s.value)==null?void 0:M.elevel)===4?"#ff0000":"#5da8ff",color:((B=s.value)==null?void 0:B.elevel)===0?"#8e9dff":((R=s.value)==null?void 0:R.elevel)===1?"#5da8ff":((G=s.value)==null?void 0:G.elevel)===2?"#fedc69":((H=s.value)==null?void 0:H.elevel)===3?"#ff9874":((j=s.value)==null?void 0:j.elevel)===4?"#ff0000":"#5da8ff"}},{default:n(()=>{var f;return[_(h(S(A)(S(J)[(f=s.value)==null?void 0:f.elevel])),1)]}),_:1},8,["color"])]}),_:1}),a(i,{label:"日志源设备"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.type),1)]}),_:1}),a(i,{label:"聚合开始时间"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.aggrestarttime),1)]}),_:1}),a(i,{label:"聚合结束时间"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.aggreendtime),1)]}),_:1}),a(i,{label:"聚合数量"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.aggre),1)]}),_:1}),a(i,{label:"发生源IP"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.sip),1)]}),_:1}),a(i,{label:"源IP"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.sourceip),1)]}),_:1}),a(i,{label:"源端口"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.sourceport),1)]}),_:1}),a(i,{label:"目的IP"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.aimip),1)]}),_:1}),a(i,{label:"目的端口"},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.aimport),1)]}),_:1}),a(i,{label:"事件描述",span:3},{default:n(()=>{var t;return[_(h((t=s.value)==null?void 0:t.aimip),1)]}),_:1})]),_:1})]),_:1})]),_:1}),a(o,{name:"2"},{tab:n(()=>[Je]),default:n(()=>[S(I).length==0?(E(),q("div",Ke," 暂无原始日志信息 ")):(E(),q("div",Xe,[a(r,{columns:N,data:S(I),size:"small","scroll-x":762,"row-key":t=>t.id,"virtual-scroll":"",class:"sm:h-full",pagination:x,onScroll:k,loading:y.value,"max-height":400,remote:""},null,8,["data","row-key","pagination","loading"])])),a(He,{detailVisible:$.value,"onUpdate:detailVisible":v[0]||(v[0]=t=>$.value=t),detailInfo:w.value},null,8,["detailVisible","detailInfo"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ye=se(Qe,[["__scopeId","data-v-314c6cd8"]]),el={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ll(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!oe(g)}const al=Z({name:"eventalarm_eventalarm",__name:"index",setup(g){const D=ae(),T=b(window.innerHeight-306),s=b(!1),N=b(),y=F({pageId:void 0,limit:100,lsid:void 0,etype:void 0,ectgr:void 0,elevel:void 0,startSIp:void 0,endSIp:void 0,startSourceIp:void 0,endSourceIp:void 0,startAimIp:void 0,endAimIp:void 0,startTime:void 0,endTime:void 0,fuzzy:void 0,_t:new Date().getTime()}),I=[{title:"",key:"index",width:80,render:(l,o)=>`${o+1}`},{key:"ename",title:"事件名称",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"pname1",title:"事件类型",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"aggrestarttime",title:"聚合开始时间",align:"center",width:160},{key:"pname2",title:"事件类别",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",width:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",width:120,render:l=>{(l.elevel===void 0||l.elevel===null)&&(l.elevel=1);const o={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},r=A(J[l.elevel]);let m={color:o[l.elevel],textColor:"#ffffff",borderColor:o[l.elevel]};return a(X,{size:"small",color:m},ll(r)?r:{default:()=>[r]})}},{key:"aggre",title:"聚合数量",align:"center",width:120},{key:"sip",title:"发生源IP",align:"center",width:160},{key:"aggreendtime",title:"聚合结束时间",align:"center",width:160},{key:"operate",title:A("common.operate"),align:"center",width:100,fixed:"right",render:l=>a("div",{class:"flex-center gap-8px"},[a(W,{type:"primary",ghost:!0,size:"small",onClick:()=>i(l)},{default:()=>[_("查看")]})])}],e=b([]),k=b(!1),P=async(l=!1)=>{if(!k.value)k.value=!0;else return;const{data:o,error:r}=await Be(y);r||(l?e.value=[...e.value,...o]:e.value=o,k.value=!1)};P();const x=b(!0),$=()=>{e.value=[],y.pageId=void 0,(o=>Object.keys(o).filter(c=>c!=="limit"&&c!=="_t").some(c=>o[c]!==void 0&&o[c]!==""&&o[c]!==null))(y)?x.value=!1:(x.value=!0,L()),P()},w=F({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:l,endIndex:o,page:r,pageSize:m,pageCount:c,itemCount:p}){return`已加载${e.value.length}条`+(e.value.length?x.value?` 共计 ${e.value.length>0?p??0:0} 条`:e.value.length>=y.limit?"  预计还有更多":"":"")}});async function L(){const{data:l,error:o}=await Re();o||(w.pageCount=20,w.total=Number(l),w.itemCount=Number(l))}L();function u(l){var o;l.target.scrollTop+l.target.offsetHeight==l.target.scrollHeight&&w.total>((o=e.value)==null?void 0:o.length)&&v()}const v=ie.debounce(()=>{var l;((l=e.value)==null?void 0:l.length)<w.total&&(y.pageId=e.value[e.value.length-1].id,P(!0))},300);async function i(l){N.value=l,s.value=!0}async function d(){if(!e.value.length)return;const l=JSON.parse(JSON.stringify(e.value)),o=[];l.forEach(m=>{const c={};I.forEach(p=>{if(m.hasOwnProperty(p.key)){const t=p.key=="elevel"?A(J[m[p.key]]):m[p.key];c[p.title]=t}}),o.push(c)}),Ge(o,500,[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:50},{wpx:100},{wpx:150}],"安全事件_"+new Date().getTime())}return(l,o)=>{const r=Y,m=re,c=ne;return E(),q("div",el,[a(qe,{model:y,"onUpdate:model":o[0]||(o[0]=p=>y=p),onSearch:$},null,8,["model"]),a(c,{title:"安全事件",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(r,null,{default:n(()=>[a(S(W),{type:"primary",size:"small",ghost:"",onClick:d,title:"导出已加载"},{default:n(()=>[_("导出已加载")]),_:1})]),_:1})]),default:n(()=>[a(m,{columns:I,data:e.value,size:"small","flex-height":!S(D).isMobile,loading:k.value,remote:"","scroll-x":I.reduce((p,t)=>p+t.width,0),"row-key":p=>p.id,pagination:w,"virtual-scroll":"",onScroll:u,class:"sm:h-full","max-height":T.value},null,8,["data","flex-height","loading","scroll-x","row-key","pagination","max-height"])]),_:1}),a(Ye,{detailVisible:s.value,"onUpdate:detailVisible":o[1]||(o[1]=p=>s.value=p),detailInfo:N.value},null,8,["detailVisible","detailInfo"])])}}}),wl=se(al,[["__scopeId","data-v-8c592530"]]);export{wl as default};
