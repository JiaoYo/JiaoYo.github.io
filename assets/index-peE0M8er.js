import{_ as Te}from"./table-header-operation.vue_vue_type_script_setup_true_lang-B2YtY34E.js";import{d as W,q as se,v as pe,s as te,K as le,o as G,c as Q,w as d,g as t,L as q,h as w,t as ae,i as p,$ as A,M as Ae,A as oe,B as x,E as V,D as me,a9 as fe,r as ue,j as ve,J as be,f as ie,aK as Y,X as T,aj as ee,U as ge,an as he,bg as ye,a$ as _e,S as re,ay as de,x as Ue,b as Ie,y as Pe,C as Le,aW as we,F as Ne,Z as $e,am as Re,e as Fe,ac as Z,ad as ze}from"./index-DlLV7eJe.js";import{u as Me,a as Ve}from"./table-xSkcT9xW.js";import{_ as Be}from"./round-search-uoPZAsSe.js";import{_ as Oe}from"./round-refresh-DIMT2get.js";import{_ as Ge}from"./FormItemGridItem-DjCxY7Vt.js";import{_ as Qe}from"./Grid-bjmXIqt-.js";import{u as H}from"./usePageData-XjYcd0SE.js";import{a as xe,T as He}from"./basicconf-CAJn02po.js";import{j as Je,g as Ke,a as qe,k as We,l as Xe,h as Ze,e as Ye}from"./events-BqZsEKq6.js";import{q as je,u as De}from"./Collection-xTBLmQlU.js";import{f as Ee,a as Se}from"./common-Deu1ZJjc.js";import{_ as K}from"./Popconfirm-C-vI-05V.js";import{_ as ke}from"./Tree-E4OE8j1e.js";import{h as ce}from"./permission-Dfhxc3Ea.js";import{_ as el}from"./DataTable-BwnkzsBT.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-Q9h1kBIb.js";import"./setting-outlined-DGGDrLZH.js";import"./round-delete-Bh5Ji38l.js";import"./refresh-BSBTPq_T.js";import"./round-plus-BeIrYIqA.js";import"./Upload-DGP5NI1c.js";import"./Progress-D1R6cNrt.js";import"./Forward-DMhxKM_M.js";const ll=W({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:se(["reset","search"],["update:model"]),setup(j,{emit:m}){const e=m,{formRef:S,restoreValidation:h}=pe(),y=te(j,"model");function D(){y.value.fuzzy=void 0,e("search")}async function P(){await h(),e("reset")}async function E(){e("search")}return(L,o)=>{const U=oe,I=Ge,N=Oe,k=x,_=Be,$=V,R=Qe,z=me,C=fe,F=le("no-space");return G(),Q(C,{bordered:!1,size:"small",class:"card-wrapper"},{default:d(()=>[t(z,{ref_key:"formRef",ref:S,model:y.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ae(E,["enter"])},{default:d(()=>[t(R,{responsive:"screen","item-responsive":""},{default:d(()=>[t(I,{span:"24 s:12 m:6",label:"策略名称",path:"fuzzy",class:"pr-24px"},{default:d(()=>[q(t(U,{clearable:"",value:y.value.fuzzy,"onUpdate:value":o[0]||(o[0]=n=>y.value.fuzzy=n),placeholder:"请输入策略名称",onClear:D},null,8,["value"]),[[F]])]),_:1}),t(I,{span:"24 m:4",class:"pr-24px"},{default:d(()=>[t($,{class:"w-full"},{default:d(()=>[t(k,{onClick:P},{icon:d(()=>[t(N,{class:"text-icon"})]),default:d(()=>[w(" "+ae(p(A)("common.reset")),1)]),_:1}),t(k,{type:"primary",ghost:"",onClick:E},{icon:d(()=>[t(_,{class:"text-icon"})]),default:d(()=>[w(" "+ae(p(A)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),al=W({name:"ConditionTree",__name:"conditionTree",props:{data:{default:[]},dataModifiers:{}},emits:["update:data"],setup(j){const m=te(j,"data"),e=ue({showValueDom:1,obj:{colume:void 0,option:void 0,value:void 0},options1:[{value:"addr0",label:"发生源IP 数字",type:"long"},{value:"addr1",label:"源IP 数字",type:"long"},{value:"addr2",label:"目的IP 数字 ",type:"long"},{value:"ip0",label:"发生源IP",type:"string"},{value:"ip1",label:"源IP",type:"string"},{value:"ip2",label:"目的IP",type:"string"},{value:"port1",label:"源端口",type:"int"},{value:"port2",label:"目的端口",type:"int"},{value:"mac1",label:"源MAC地址",type:"string"},{value:"mac2",label:"目的MAC",type:"string"},{value:"category",label:"发生源设备类别",type:"int"},{value:"device",label:"发生源设备类型",type:"int"},{value:"kind",label:"事件类别",type:"int"},{value:"type",label:"事件类型",type:"int"},{value:"level",label:"事件等级",type:"int"},{value:"proType",label:"日志来源协议",type:"string"},{value:"protocol",label:"协议",type:"string"},{value:"code",label:"关键字",type:"string"}],options2:[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],options3:[]});function S({option:n}){return t("div",{style:{display:"flex",alignItems:"center"}},[t("div",{class:"flex-center  mr-30px",style:{gap:"8px 20px"}},[n.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>L("||或",n)},{default:()=>[w("||或")]}),n.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>L("&&与",n)},{default:()=>[w("&&与")]}),n.children&&t(K,{onPositiveClick:()=>o(n),showIcon:!1,show:n.isShow,onNegativeClick:()=>n.isShow=!1,onUpdateShow:s=>{e.obj={colume:void 0,option:void 0,value:void 0},e.showValueDom=1}},{default:Y(t(V,null,{default:()=>[t(T,{options:e.options1,value:e.obj.colume,"onUpdate:value":s=>P(s),placeholder:"请选择",style:{width:"180px"}},null),t(T,{options:e.options2,value:e.obj.option,"onUpdate:value":s=>e.obj.option=s,placeholder:"请选择",style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="category"||e.obj.colume=="device")&&t(T,{clearable:!0,options:e.options3,key:e.obj.colume,value:e.obj.value,placeholder:"请选择",labelField:e.obj.colume=="category"?"cname":e.obj.colume=="device"?"type":"",valueField:"id",onScroll:s=>F(s),"onUpdate:value":s=>e.obj.value=s,style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="kind"||e.obj.colume=="type"||e.obj.colume=="level")&&t(T,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,"onUpdate:value":s=>e.obj.value=s,style:{width:"180px"},placeholder:"请选择"},null),e.showValueDom==1&&t(oe,{clearable:!0,value:e.obj.value,"onUpdate:value":s=>e.obj.value=s},null),e.showValueDom==0&&t(ee,{clearable:!0,value:e.obj.value,"onUpdate:value":s=>e.obj.value=s},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>n.isShow=!0},{default:()=>[w("配置")]})}),t(x,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>U(n)},{default:()=>[w("删除")]})])])}const h=ve(1),y=()=>(h.value++,h.value),D=()=>{const n=s=>{let b=-1/0;const u=l=>{for(const a of l)a.id>b&&(b=a.id),a.children&&u(a.children)};return u(s),b};h.value=n(m.value)};be(()=>{setTimeout(()=>{m.value.length>0&&D()},500)});const P=async n=>{const s=["addr0","addr1","addr2"],b=["ip0","ip1","ip2","mac1","mac2","port1","port2","proType","protocol","code"];s.includes(n)?e.showValueDom=0:b.includes(n)?e.showValueDom=1:e.showValueDom=2,n=="category"?(await N(),e.options3=I.data):n=="device"?(await $(),e.options3=_.data):n=="kind"?z():n=="type"?C():n=="level"&&(e.options3=ge(xe)),["ip0","ip1","ip2","mac1","mac2","proType","protocol","code"].includes(n)?e.options2=[{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"},{label:"匹配",value:"MATCH"}]:e.options2=[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],e.obj.option=e.options2[0].value,e.obj.colume=n,e.obj.value=void 0},E=n=>{m.value.length>0||(m.value.push({label:n,id:1,isShow:!1,children:[]}),h.value=1)},L=(n,s)=>{s.children.push({label:n,id:y(),children:[],isShow:!1})},o=n=>{var a,i,r,c,v,B,O;if(!e.obj.colume)return(a=window.$message)==null?void 0:a.warning("选择的信息项不能为空");if(e.obj.value==null)return(i=window.$message)==null?void 0:i.warning("条件值不能为空");const s=["ip0","ip1","ip2"],b=["mac1","mac2"],u=["port1","port2"];if(s.includes(e.obj.colume)&&!he(e.obj.value))return(r=window.$message)==null?void 0:r.warning("请输入正确的IP地址");if(b.includes(e.obj.colume)&&!ye(e.obj.value))return(c=window.$message)==null?void 0:c.warning("请输入正确的MAC地址");if(u.includes(e.obj.colume)&&!_e(e.obj.value))return(v=window.$message)==null?void 0:v.warning("请输入正确的端口号");let l=e.obj.value;if(e.showValueDom==2)if(e.obj.colume=="category"||e.obj.colume=="device"){const g=e.options3.find(M=>M.id==e.obj.value);l=e.obj.colume=="category"?g==null?void 0:g.cname:g==null?void 0:g.type}else{const g=e.options3.find(M=>M.value==e.obj.value);l=g==null?void 0:g.label}n.children.push({colume:e.obj.colume,option:e.obj.option,value:e.obj.value,id:y(),label:`${(B=e.options1.find(g=>g.value==e.obj.colume))==null?void 0:B.label} ${(O=e.options2.find(g=>g.value==e.obj.option))==null?void 0:O.label} ${l} `,flag:!1}),e.obj={colume:void 0,option:void 0,value:void 0},e.showValueDom=1,n.isShow=!1},U=n=>{console.log(n,"row");function s(b,u){return b.reduce((l,a)=>(a.id===u||(a.children&&(a.children=s(a.children,u)),l.push(a)),l),[])}m.value=s(m.value,n.id)},{pageData:I,getData:N,nextPage:k}=H(je),{pageData:_,getData:$,nextPage:R}=H(De),z=async()=>{const{data:n,error:s}=await Ee();console.log(n),e.options3=n.map(b=>({label:b.pname,value:b.id}))},C=async()=>{const{data:n,error:s}=await Se();console.log(n),e.options3=n.map(b=>({label:b.pname,value:b.id}))},F=async n=>{const s=n.currentTarget;s.scrollTop+s.offsetHeight>=s.scrollHeight&&(e.obj.colume=="category"&&k(),e.obj.colume=="device"&&R())};return(n,s)=>{const b=ke,u=re;return G(),Q(u,{class:"h-220px",style:{border:"1px solid #dcdcdc","border-radius":"6px"}},{default:d(()=>[t(p(V),{justify:"end",class:"p-5px"},{default:d(()=>[ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:s[0]||(s[0]=l=>E("||或"))},"||或"),ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:s[1]||(s[1]=l=>E("&&与"))},"&&与")]),_:1}),(G(),Q(b,{"block-line":"",data:m.value,"default-expand-all":"",selectable:!1,"render-suffix":S,key:h.value,"key-field":"id"},null,8,["data"]))]),_:1})}}}),tl=de(al,[["__scopeId","data-v-8027c5a8"]]),ol=W({name:"RelationRuleTree",__name:"relationRuleTree",props:{data:{default:[]},dataModifiers:{}},emits:["update:data"],setup(j){const m=te(j,"data"),e=ue({showValueDom:1,obj:{colume:void 0,option:void 0,value:void 0,duration:60,times:2,columns:[],ishappen:1},options1:[{value:"addr0",label:"发生源IP 数字",type:"long"},{value:"addr1",label:"源IP 数字",type:"long"},{value:"addr2",label:"目的IP 数字 ",type:"long"},{value:"ip0",label:"发生源IP",type:"string"},{value:"ip1",label:"源IP",type:"string"},{value:"ip2",label:"目的IP",type:"string"},{value:"port1",label:"源端口",type:"int"},{value:"port2",label:"目的端口",type:"int"},{value:"mac1",label:"源MAC地址",type:"string"},{value:"mac2",label:"目的MAC",type:"string"},{value:"category",label:"发生源设备类别",type:"int"},{value:"device",label:"发生源设备类型",type:"int"},{value:"kind",label:"事件类别",type:"int"},{value:"type",label:"事件类型",type:"int"},{value:"level",label:"事件等级",type:"int"},{value:"proType",label:"日志来源协议",type:"string"},{value:"protocol",label:"协议",type:"string"},{value:"code",label:"关键字",type:"string"}],options2:[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],options3:[]});function S({option:l}){return t("div",{style:{display:"flex",alignItems:"center"}},[t("span",{style:{minWidth:"50px"}},[l.label]),t("div",{class:"flex-center mx-30px",style:{gap:"8px 20px"}},[l.children&&!l.logic&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>o("||或",l)},{default:()=>[w("||或")]}),l.children&&t(x,{type:"info",text:!0,ghost:!0,size:"small",onClick:()=>o("&&与",l)},{default:()=>[w("&&与")]}),l.children&&!l.logic&&!l.times&&!l.duration&&t(K,{onPositiveClick:()=>U(l),showIcon:!1,show:l.isShow,onNegativeClick:()=>l.isShow=!1},{default:Y(t(V,null,{default:()=>[t(T,{options:e.options1,value:e.obj.colume,"onUpdate:value":a=>E(a),placeholder:"请选择",style:{width:"180px"}},null),t(T,{options:e.options2,value:e.obj.option,"onUpdate:value":a=>e.obj.option=a,placeholder:"请选择",style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="category"||e.obj.colume=="device")&&t(T,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,labelField:e.obj.colume=="category"?"cname":e.obj.colume=="device"?"type":"",placeholder:"请选择",onScroll:a=>u(a),valueField:"id","onUpdate:value":a=>e.obj.value=a,style:{width:"180px"}},null),e.showValueDom==2&&(e.obj.colume=="kind"||e.obj.colume=="type"||e.obj.colume=="level")&&t(T,{clearable:!0,options:e.options3,value:e.obj.value,key:e.obj.colume,"onUpdate:value":a=>e.obj.value=a,style:{width:"180px"},placeholder:"请选择"},null),e.showValueDom==1&&t(oe,{clearable:!0,value:e.obj.value,"onUpdate:value":a=>e.obj.value=a},null),e.showValueDom==0&&t(ee,{clearable:!0,value:e.obj.value,"onUpdate:value":a=>e.obj.value=a},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>l.isShow=!0},{default:()=>[w("配置")]})}),l.children&&l.times&&l.duration&&t(K,{onPositiveClick:()=>I(l),showIcon:!1},{default:Y(t(V,null,{default:()=>[t(ee,{style:{width:"140px"},clearable:!0,value:e.obj.duration,"onUpdate:value":a=>e.obj.duration=a},null),t(ee,{style:{width:"140px"},clearable:!0,value:e.obj.times,"onUpdate:value":a=>e.obj.times=a},null),t(T,{clearable:!0,options:e.options1,value:e.obj.columns,multiple:!0,"onUpdate:value":a=>e.obj.columns=a,placeholder:"请选择",style:{width:"180px"}},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>{e.obj.columns=l.columns,e.obj.duration=l.duration,e.obj.times=l.times}},{default:()=>[w("配置")]})}),l.children&&l.logic&&t(K,{onPositiveClick:()=>h(l),showIcon:!1},{default:Y(t(V,null,{default:()=>[t(T,{clearable:!0,options:[{label:"发生",value:1},{label:"不发生",value:0}],value:e.obj.ishappen,"onUpdate:value":a=>e.obj.ishappen=a,placeholder:"请选择",style:{width:"180px"}},null)]})),trigger:()=>t(x,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>e.obj.ishappen=l.ishappen},{default:()=>[w("配置")]})}),!l.logic&&t(x,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>N(l)},{default:()=>[w("删除")]})]),l.duration&&l.times&&t("span",null,["在"+l.duration+"秒内，发生"+l.times+"次   归并字段："+k(l.columns)])])}const h=l=>{const a=/状态(\d+)/g;let i;const r=[];for(;(i=a.exec(l.label))!==null;)r.push(i[1]);l.ishappen=e.obj.ishappen,l.label=`状态${r[0]}之后${e.obj.ishappen?"发生":"不发生"}状态${r[1]}`},y=ve(1),D=()=>y.value+=1,P=()=>{const l=a=>{let i=-1/0;const r=c=>{for(const v of c)v.id>i&&(i=v.id),v.children&&r(v.children)};return r(a),i};y.value=l(m.value)};be(()=>{setTimeout(()=>{m.value.length>0&&P()},500)});const E=async l=>{const a=["addr0","addr1","addr2"],i=["ip0","ip1","ip2","mac1","mac2","port1","port2","proType","protocol","code"];a.includes(l)?e.showValueDom=0:i.includes(l)?e.showValueDom=1:e.showValueDom=2,l=="category"?(await R(),e.options3=$.data):l=="device"?(await F(),e.options3=C.data):l=="kind"?s():l=="type"?b():l=="level"&&(e.options3=[]),["ip0","ip1","ip2","mac1","mac2","proType","protocol","code"].includes(l)?e.options2=[{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"},{label:"匹配",value:"MATCH"}]:e.options2=[{label:"大于",value:"GREATER"},{label:"小于",value:"LESS"},{label:"大于等于",value:"GREATER_EQUAL"},{label:"小于等于",value:"LESS_EQUAL"},{label:"等于",value:"EQUAL"},{label:"不等于",value:"NOT_EQUAL"}],e.obj.option=e.options2[0].value,e.obj.colume=l,e.obj.value=void 0},L=()=>{if(m.value.length==0){m.value.push({label:"状态1",id:1,children:[],duration:60,times:2,columns:[]});return}const l=(m.value.length-1)/2+1;m.value.push({label:`状态${l}之后发生状态${l+1}`,id:D(),ishappen:1,logic:"and",children:[]});const a=m.value[m.value.length-1].id;m.value.push({label:`状态${l+1}`,id:D(),subId:a,children:[],duration:60,times:2,columns:[]})},o=(l,a)=>{a.children.push({label:l,id:D(),children:[],isShow:!1})},U=l=>{var v,B,O,g,M,X,J;if(!e.obj.colume)return(v=window.$message)==null?void 0:v.warning("选择的信息项不能为空");if(e.obj.value==null)return(B=window.$message)==null?void 0:B.warning("条件值不能为空");const a=["ip0","ip1","ip2"],i=["mac1","mac2"],r=["port1","port2"];if(a.includes(e.obj.colume)&&!he(e.obj.value))return(O=window.$message)==null?void 0:O.warning("请输入正确的IP地址");if(i.includes(e.obj.colume)&&!ye(e.obj.value))return(g=window.$message)==null?void 0:g.warning("请输入正确的MAC地址");if(r.includes(e.obj.colume)&&!_e(e.obj.value))return(M=window.$message)==null?void 0:M.warning("请输入正确的端口号");let c=e.obj.value;if(e.showValueDom==2){const f=e.options3.find(Ce=>Ce.value==e.obj.value);c=f==null?void 0:f.label}l.children.push({colume:e.obj.colume,option:e.obj.option,value:e.obj.value,id:D(),label:`${(X=e.options1.find(f=>f.value==e.obj.colume))==null?void 0:X.label} ${(J=e.options2.find(f=>f.value==e.obj.option))==null?void 0:J.label} ${c} `,flag:!1}),_(),l.isShow=!1},I=l=>{l.duration=e.obj.duration,l.times=e.obj.times,l.columns=e.obj.columns},N=l=>{function a(i,r){return i.reduce((c,v)=>(r.includes(v.id)||(v.children&&(v.children=a(v.children,r)),c.push(v)),c),[])}l.subId?m.value=a(m.value,[l.id,l.subId]):m.value=a(m.value,[l.id])},k=l=>{let a="";return l.forEach((i,r)=>{var c;a+=`${(c=e.options1.find(v=>v.value==i))==null?void 0:c.label}${r==l.length-1?"":"、"}`}),a},_=()=>{e.obj={colume:void 0,option:void 0,value:void 0,duration:60,times:2,ishappen:1,columns:[]}},{pageData:$,getData:R,nextPage:z}=H(je),{pageData:C,getData:F,nextPage:n}=H(De),s=async()=>{const{data:l,error:a}=await Ee();console.log(l),e.options3=l.map(i=>({label:i.pname,value:i.id}))},b=async()=>{const{data:l,error:a}=await Se();console.log(l),e.options3=l.map(i=>({label:i.pname,value:i.id}))},u=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&(e.obj.colume=="category"&&z(),e.obj.colume=="device"&&n())};return(l,a)=>{const i=ke,r=re;return G(),Q(r,{class:"h-220px",style:{border:"1px solid #dcdcdc","border-radius":"6px"}},{default:d(()=>[t(p(V),{justify:"end",class:"p-5px"},{default:d(()=>[ie("span",{class:"text_hover",style:{padding:"2px 8px"},onClick:L},"㊉ 新增关联状态")]),_:1}),(G(),Q(i,{"block-line":"",data:m.value,"default-expand-all":"",selectable:!1,"render-label":S,"key-field":"id",key:y.value},null,8,["data"]))]),_:1})}}}),nl=de(ol,[["__scopeId","data-v-0bdad4b6"]]),sl=W({name:"OperateDrawer",__name:"operate-drawer",props:se({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:se(["submitted"],["update:visible"]),setup(j,{emit:m}){const e=j,S=m,h=te(j,"visible"),{formRef:y,validate:D,restoreValidation:P}=pe(),{defaultRequiredRule:E}=Ue(),L=Ie(()=>({add:"新增关联策略",edit:"修改关联策略"})[e.operateType]),o=ue(U());function U(){return{aname:"",adesc:"",acond:[],arules:[],eid:null,elevel:null,fid:null,etext:"",syspara:1,dbtime:"",status:1}}const I={aname:E,eid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"}};async function N(){var l;if(await $(),await F(),Object.assign(o,U()),e.operateType==="edit"&&e.rowData){const{data:a,error:i}=await Je(e.rowData.id);i||(Object.assign(o,a),o.fid=(l=o.fid)==null?void 0:l.split(","),o.acond=a.acond.replace(/&amp;/g,"&"),o.arules=a.arules.replace(/&amp;/g,"&"),o.acond=JSON.parse(o.acond),o.arules=JSON.parse(o.arules))}}function k(){h.value=!1}const{pageData:_,getData:$,nextPage:R}=H(Ke),z=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&_.data.length<_.total&&R()},{pageData:C,getData:F,nextPage:n}=H(qe),s=async l=>{const a=l.currentTarget;a.scrollTop+a.offsetHeight>=a.scrollHeight&&C.data.length<C.total&&n()},b=l=>l.ipaddr+":"+l.fport+" ("+(l.ftype==0?"syslog":"SNMP Trap")+")";async function u(){var l,a,i,r;if(console.log(o.acond),console.log(o.arules),await D(),e.operateType==="add"){const{data:c,error:v}=await We([{acond:JSON.stringify(o.acond),adesc:o.adesc,aname:o.aname,arules:JSON.stringify(o.arules),dbtime:o.dbtime,eid:o.eid,elevel:o.elevel,fid:(l=o.fid)==null?void 0:l.join(","),etext:o.etext,syspara:o.syspara,status:o.status}]);v||((a=window.$message)==null||a.success(A("common.addSuccess")),k(),S("submitted"))}else{const{data:c,error:v}=await Xe([{id:e.rowData.id,acond:JSON.stringify(o.acond),adesc:o.adesc,aname:o.aname,arules:JSON.stringify(o.arules),dbtime:o.dbtime,eid:o.eid,elevel:o.elevel,fid:(i=o.fid)==null?void 0:i.join(","),etext:o.etext,syspara:o.syspara,status:o.status}]);v||((r=window.$message)==null||r.success(A("common.updateSuccess")),k(),S("submitted"))}}return Pe(h,()=>{h.value&&(N(),P())}),(l,a)=>{const i=oe,r=Le,c=T,v=we,B=me,O=re,g=x,M=V,X=Ne,J=le("no-space");return G(),Q(X,{show:h.value,"onUpdate:show":a[9]||(a[9]=f=>h.value=f),title:L.value,preset:"card",class:"w-800px"},{footer:d(()=>[t(M,{size:16,justify:"center"},{default:d(()=>[t(g,{onClick:k},{default:d(()=>[w(ae(p(A)("common.cancel")),1)]),_:1}),t(g,{type:"primary",onClick:u},{default:d(()=>[w(ae(p(A)("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[t(O,{class:"max-h-480px pr-20px"},{default:d(()=>[t(B,{ref_key:"formRef",ref:y,model:o,rules:I,"label-placement":"top","label-width":"120"},{default:d(()=>[t(r,{label:"策略名称",path:"aname"},{default:d(()=>[q(t(i,{value:o.aname,"onUpdate:value":a[0]||(a[0]=f=>o.aname=f),clearable:"",placeholder:"请输入策略名称"},null,8,["value"]),[[J]])]),_:1}),t(r,{label:"策略描述",path:"adesc"},{default:d(()=>[q(t(i,{type:"textarea",value:o.adesc,"onUpdate:value":a[1]||(a[1]=f=>o.adesc=f),placeholder:"请输入策略描述",clearable:""},null,8,["value"]),[[J]])]),_:1}),t(r,{label:"条件",path:"acond"},{default:d(()=>[t(tl,{data:o.acond,"onUpdate:data":a[2]||(a[2]=f=>o.acond=f)},null,8,["data"])]),_:1}),t(r,{label:"关联规则",path:"arules"},{default:d(()=>[t(nl,{data:o.arules,"onUpdate:data":a[3]||(a[3]=f=>o.arules=f)},null,8,["data"])]),_:1}),t(r,{label:"事件名称",path:"eid"},{default:d(()=>[t(c,{value:o.eid,"onUpdate:value":a[4]||(a[4]=f=>o.eid=f),placeholder:"请选择事件名称",clearable:"",filterable:"","value-field":"id","label-field":"ename",options:p(_).data,"reset-menu-on-options-change":!1,onScroll:z},null,8,["value","options"])]),_:1}),t(r,{label:"事件等级",path:"elevel"},{default:d(()=>[t(c,{filterable:"",value:o.elevel,"onUpdate:value":a[5]||(a[5]=f=>o.elevel=f),placeholder:"请选择事件等级",options:p(ge)(p(xe)),style:{width:"100%"}},null,8,["value","options"])]),_:1}),t(r,{label:"转发外系统",path:"fid"},{default:d(()=>[t(c,{multiple:"","max-tag-count":1,value:o.fid,"onUpdate:value":a[6]||(a[6]=f=>o.fid=f),placeholder:"请选择转发外系统",clearable:"",filterable:"","render-label":b,"value-field":"id","label-field":"ipaddr",options:p(C).data,"reset-menu-on-options-change":!1,onScroll:s},null,8,["value","options"])]),_:1}),t(r,{label:"事件文本",path:"etext"},{default:d(()=>[t(i,{type:"textarea",value:o.etext,"onUpdate:value":a[7]||(a[7]=f=>o.etext=f),placeholder:"请输入事件文本",clearable:""},null,8,["value"])]),_:1}),t(r,{label:"使用状态",path:"maxagg"},{default:d(()=>[t(v,{value:o.status,"onUpdate:value":a[8]||(a[8]=f=>o.status=f),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),il=de(sl,[["__scopeId","data-v-4d146dd4"]]),ul={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ne(j){return typeof j=="function"||Object.prototype.toString.call(j)==="[object Object]"&&!ze(j)}const Pl=W({name:"eventalarm_associatedeventspolicy",__name:"index",setup(j){const m=$e(),{columns:e,columnChecks:S,data:h,getData:y,loading:D,mobilePagination:P,searchParams:E,resetSearchParams:L}=Me({apiFn:Ze,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"aname",title:"策略名称",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"adesc",title:"策略描述",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"elevel",title:"事件等级",align:"center",minWidth:120,render:u=>{(u.elevel===void 0||u.elevel===null)&&(u.elevel=1);const l={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},a=A(He[u.elevel]);let i={color:l[u.elevel],textColor:"#ffffff",borderColor:l[u.elevel]};return t(Re,{size:"small",color:i},ne(a)?a:{default:()=>[a]})}},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"status",title:"使用状态",align:"center",width:160,render:u=>t(we,{disabled:!0,value:u.status,"checked-value":1,"unchecked-value":0},null)},{key:"operate",title:A("common.operate"),align:"center",width:160,fixed:"right",render:u=>{let l;return u.syspara!=0?t("div",{class:"flex-center gap-8px"},[q(t(x,{type:"primary",ghost:!0,size:"small",onClick:()=>F(u.id)},ne(l=A("common.edit"))?l:{default:()=>[l]}),[[le("no-auth"),"assocition.policy.update"]]),t(K,{onPositiveClick:()=>n(u.id)},{default:()=>A("common.confirmDelete"),trigger:()=>{let a;return q(t(x,{type:"error",ghost:!0,size:"small"},ne(a=A("common.delete"))?a:{default:()=>[a]}),[[le("no-auth"),"assocition.policy.delete"]])}})]):null}}]}),{drawerVisible:o,operateType:U,editingData:I,handleAdd:N,handleEdit:k,checkedRowKeys:_,onBatchDeleted:$,onDeleted:R,closeDrawer:z}=Ve(h,y);async function C(){console.log(_.value),s(_.value,u=>{$()})}function F(u){k(u)}function n(u){console.log(u),s([u],l=>{R()})}async function s(u,l){const{data:a,error:i}=await Ye(u);if(!i)l&&l(a);else return!1}async function b(){}return(u,l)=>{const a=Te,i=el,r=fe;return G(),Fe("div",ul,[t(ll,{model:p(E),"onUpdate:model":l[0]||(l[0]=c=>Z(E)?E.value=c:null),onReset:p(L),onSearch:p(y)},null,8,["model","onReset","onSearch"]),t(r,{title:"关联策略",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":d(()=>[t(a,{columns:p(S),"onUpdate:columns":l[1]||(l[1]=c=>Z(S)?S.value=c:null),"disabled-delete":p(_).length===0,loading:p(D),onAdd:p(N),onDelete:C,onRefresh:p(y),"is-view-export-button":!0,onExportHandler:b,"is-view-add-button":p(ce)("assocition.policy.insert"),"is-view-delete-button":p(ce)("assocition.policy.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:d(()=>[t(i,{"checked-row-keys":p(_),"onUpdate:checkedRowKeys":l[2]||(l[2]=c=>Z(_)?_.value=c:null),columns:p(e),data:p(h),size:"small","flex-height":!p(m).isMobile,"scroll-x":962,loading:p(D),remote:"","row-key":c=>c.id,pagination:p(P),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(il,{visible:p(o),"onUpdate:visible":l[3]||(l[3]=c=>Z(o)?o.value=c:null),"operate-type":p(U),"row-data":p(I),onSubmitted:p(y)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Pl as default};
