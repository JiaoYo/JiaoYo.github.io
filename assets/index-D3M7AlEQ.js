import{d as ya,n as xa,dM as ba,a4 as ga,s as Ta,j as x,ae as ha,o as Ca,c as La,w as r,f as k,g as n,aa as wa,i as B,a_ as p,S as Na,ar as Sa,P as Aa,Q as ka,R as $a,e as Da,h as va,aS as S,$ as Ia,at as Ra,av as Ea,Z as Ba,K as Fa,B as Ma,O as Ua,ad as Ga}from"./index-DxV58OoN.js";import{n as Ka,o as Va,a as Ha}from"./reportForm-BwWjnyiN.js";import{f as Oa}from"./asset-Dc3sgmzu.js";import{u as Qa}from"./usePageData-D__4y68b.js";import{_ as Wa,a as za,b as Ja,c as Za}from"./file-pdf-BM4phlZN.js";import{_ as qa}from"./DatePicker-BJDRLH9v.js";import{a as Xa,_ as Ya}from"./Grid-DPmgvaC7.js";import"./echarts.vue_vue_type_script_setup_true_lang-DhghHAFj.js";import"./index-BhRqCdHu.js";import"./installCanvasRenderer-CyOrKSjT.js";import"./install-CX03SWNg.js";import"./TimePicker-DcqVkZ1t.js";import"./defineProperty-BE_Hp7tH.js";const ae=C=>(Aa("data-v-d674d4e5"),C=C(),ka(),C),ee=ae(()=>k("span",{class:"mr-20px"},"报表预览",-1)),te={title:"导出PDF"},oe={title:"导出Word"},ne={title:"导出Excel"},le=ya({name:"reportPreview",__name:"reportPreview",props:xa({data:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(C){ba(c=>({"03cdc49e":B($)}));const y=ga(),h=C,_=Ta(C,"visible"),d=x(""),P=()=>{var c,s;d.value=((s=(c=h.data)==null?void 0:c.find(j=>j.type=="title"))==null?void 0:s.value)+"报表"+p(1,new Date)};ha(_,()=>{_.value&&P()});const b=x(),$=y.themeScheme=="dark"?"#001428":"#fff";return(c,s)=>{const j=Wa,D=za,I=Ja,L=Za,R=Na,E=Sa;return Ca(),La(E,{show:_.value,"onUpdate:show":s[3]||(s[3]=g=>_.value=g),preset:"card",class:"w-1000px reportPreview",style:wa({"background-color":B(y).themeScheme=="dark"?"#001428":"#fff"})},{header:r(()=>[ee,k("span",te,[n(j,{class:"text-32px c-#d63031 cursor-pointer",onClick:s[0]||(s[0]=g=>b.value.toPdf(d.value))})]),k("span",oe,[n(D,{class:"text-32px c-#1e90ff cursor-pointer",onClick:s[1]||(s[1]=g=>b.value.toWord(d.value))})]),k("span",ne,[n(I,{class:"text-32px c-#15703d cursor-pointer",onClick:s[2]||(s[2]=g=>b.value.toExcel(d.value))})])]),default:r(()=>[n(R,{class:"max-h-600px"},{default:r(()=>[n(L,{ref_key:"filePreviewExportRef",ref:b,width:800,data:h.data},null,8,["data"])]),_:1})]),_:1},8,["show","style"])}}}),se=$a(le,[["__scopeId","data-v-d674d4e5"]]),je=ya({name:"reportmanagement_reporttemplate",__name:"index",setup(C){const y=x([]),h=async t=>{const{data:o,error:a}=await Ha({rtype:t});a||(o.forEach(l=>{l.rtext=JSON.parse(l.rtext)}),console.log(o,"dataxxxxxxxxxxxxxxx"),y.value=o[0].rtext)},_=x(!1),d=x({atypes:[],time:void 0,startTime:void 0,endTime:void 0}),P=x([]),b=async()=>{var a;P.value=[],await h(0);const{data:t,error:o}=await Ka({atypes:(a=d.value.atypes)==null?void 0:a.join(","),startTime:d.value.startTime,endTime:d.value.endTime});o||(_.value=!0,y.value.forEach(l=>{l.type=="chart"&&l.dataName=="assetType"&&(l.value.data.series[0].data=Object.entries(t.assetType).map(([f,v],T)=>({value:v,name:f}))),l.type=="table"&&l.dataName=="baseInfo"&&(l.value.body=t.baseInfo.map(f=>l.value.tableHeaderValue.map(v=>f[v])))}),P.value=y.value)};async function $(t,o){d.value.startTime=p(0,o[0]),d.value.endTime=p(0,o[1])}const c=x({time:[new Date().getTime()-864e5*30,new Date().getTime()],startTime:p(0,new Date().getTime()-864e5*30),endTime:p(0,new Date().getTime())}),s=["一般","低级","中级","高级","严重"],j=["#99CC00","#1e90ff","#FF9900","#FF6666","#CC0033"],D=async()=>{P.value=[],await h(1);const{data:t,error:o}=await Va({startTime:c.value.startTime,endTime:c.value.endTime});o||(_.value=!0,y.value.forEach(a=>{var l,f,v,T,w,N,A,m,F,M,U,G,K,V,H,O,Q,W,z,J,Z,q,X,Y,aa,ea,ta,oa,na,la,sa,ua,ra,da,ia,pa,ca,ma,_a;a.type=="chart"&&(a.dataName=="secureCountPojo"&&(a.value.data.series[0].data=s.map((e,i)=>{const u=`e${i+1}`;return{value:t.secureCountPojo[u]==0||t.secureCountPojo[u]==null?null:t.secureCountPojo[u],name:e,itemStyle:{color:j[i]}}})),a.dataName=="secureCountPojo_typeCountPojoList"&&(a.value.data.xAxis.data?a.value.data.xAxis.data=(T=(v=t.alarmCountPojo)==null?void 0:v.typeCountPojoList)==null?void 0:T.map(e=>e.tname):a.value.data.yAxis.data=(f=(l=t.alarmCountPojo)==null?void 0:l.typeCountPojoList)==null?void 0:f.map(e=>e.tname),a.value.data.series[0].data=(N=(w=t.secureCountPojo)==null?void 0:w.typeCountPojoList)==null?void 0:N.map(e=>e.tcount)),a.dataName=="secureCountPojo_dayCountPojoList"&&(a.value.data.xAxis.data=(m=(A=t.secureCountPojo)==null?void 0:A.dayCountPojoList)==null?void 0:m.map(e=>p(0,e.date)),a.value.data.series[0].data=(M=(F=t.secureCountPojo)==null?void 0:F.dayCountPojoList)==null?void 0:M.map(e=>e.dailycount)),a.dataName=="auditCountPojo"&&(a.value.data.series[0].data=s.map((e,i)=>{const u=`e${i+1}`;return{value:t.auditCountPojo[u]==0||t.auditCountPojo[u]==null?null:t.auditCountPojo[u],name:e,itemStyle:{color:j[i]}}})),a.dataName=="auditCountPojo_typeCountPojoList"&&(a.value.data.xAxis.data?a.value.data.xAxis.data=(V=(K=t.alarmCountPojo)==null?void 0:K.typeCountPojoList)==null?void 0:V.map(e=>e.tname):a.value.data.yAxis.data=(G=(U=t.alarmCountPojo)==null?void 0:U.typeCountPojoList)==null?void 0:G.map(e=>e.tname),a.value.data.series[0].data=(O=(H=t.auditCountPojo)==null?void 0:H.typeCountPojoList)==null?void 0:O.map(e=>e.tcount)),a.dataName=="auditCountPojo_dayCountPojoList"&&(a.value.data.xAxis.data=(W=(Q=t.auditCountPojo)==null?void 0:Q.dayCountPojoList)==null?void 0:W.map(e=>p(0,e.date)),a.value.data.series[0].data=(J=(z=t.auditCountPojo)==null?void 0:z.dayCountPojoList)==null?void 0:J.map(e=>e.dailycount)),a.dataName=="alarmCountPojo"&&(a.value.data.series[0].data=s.map((e,i)=>{const u=`e${i+1}`;return{value:t.alarmCountPojo[u]==0||t.alarmCountPojo[u]==null?null:t.alarmCountPojo[u],name:e,itemStyle:{color:j[i]}}})),a.dataName=="alarmCountPojo_typeCountPojoList"&&(a.value.data.xAxis.data?a.value.data.xAxis.data=(Y=(X=t.alarmCountPojo)==null?void 0:X.typeCountPojoList)==null?void 0:Y.map(e=>e.tname):a.value.data.yAxis.data=(q=(Z=t.alarmCountPojo)==null?void 0:Z.typeCountPojoList)==null?void 0:q.map(e=>e.tname),a.value.data.series[0].data=(ea=(aa=t.alarmCountPojo)==null?void 0:aa.typeCountPojoList)==null?void 0:ea.map(e=>e.tcount)),a.dataName=="alarmCountPojo_dayCountPojoList"&&(a.value.data.xAxis.data=(oa=(ta=t.alarmCountPojo)==null?void 0:ta.dayCountPojoList)==null?void 0:oa.map(e=>p(0,e.date)),a.value.data.series[0].data=(la=(na=t.alarmCountPojo)==null?void 0:na.dayCountPojoList)==null?void 0:la.map(e=>e.dailycount))),a.type=="table"&&(a.dataName==""&&(a.value.body=[["安全事件",t.e1],["审计事件",t.e3],["告警事件",t.e4]]),a.dataName=="secureCountPojo"&&(a.value.body=s.map((e,i)=>{const u=t.secureCountPojo[`e${i+1}`];return[e,u]})),a.dataName=="secureCountPojo_typeCountPojoList"&&(a.value.body=(ua=(sa=t.secureCountPojo)==null?void 0:sa.typeCountPojoList)==null?void 0:ua.map(e=>[e.tname,e.tcount])),a.dataName=="secureCountPojo_dayCountPojoList"&&(a.value.body=(ra=t.secureCountPojo.dayCountPojoList)==null?void 0:ra.map(e=>[p(0,e.date),e.dailycount])),a.dataName=="auditCountPojo"&&(a.value.body=s.map((e,i)=>{const u=t.auditCountPojo[`e${i+1}`];return[e,u]})),a.dataName=="auditCountPojo_typeCountPojoList"&&(a.value.body=(ia=(da=t.auditCountPojo)==null?void 0:da.typeCountPojoList)==null?void 0:ia.map(e=>[e.tname,e.tcount])),a.dataName=="auditCountPojo_dayCountPojoList"&&(a.value.body=(pa=t.auditCountPojo.dayCountPojoList)==null?void 0:pa.map(e=>[p(0,e.date),e.dailycount])),a.dataName=="alarmCountPojo"&&(a.value.body=s.map((e,i)=>{const u=t.alarmCountPojo[`e${i+1}`];return[e,u]})),a.dataName=="alarmCountPojo_typeCountPojoList"&&(a.value.body=(ma=(ca=t.alarmCountPojo)==null?void 0:ca.typeCountPojoList)==null?void 0:ma.map(e=>[e.tname,e.tcount])),a.dataName=="alarmCountPojo_dayCountPojoList"&&(a.value.body=(_a=t.alarmCountPojo.dayCountPojoList)==null?void 0:_a.map(e=>[p(0,e.date),e.dailycount])))}),P.value=y.value)};async function I(t,o){c.value.startTime=o?p(0,o[0]):void 0,c.value.endTime=o?p(0,o[1]):void 0}const{pageData:L,getData:R,nextPage:E}=Qa(Oa),g=async t=>{const o=t.currentTarget;o.scrollTop+o.offsetHeight>=o.scrollHeight&&L.data.length<L.total&&E()};R();const Pa=t=>{const o=t.pid;return S("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"}},[S("div",null,[t.aname]),S("span",{depth:3,tag:"div",style:{color:"#999"}},{default:()=>Ia(Ra[o])})])},ja=({option:t,handleClose:o})=>S(Ea,{style:{padding:"0 6px 0 4px"},closable:!0,onClose:a=>{a.stopPropagation(),o()}},{default:()=>S("div",{style:{display:"flex",alignItems:"center"}},[t.aname])});return(t,o)=>{const a=Ba,l=Fa,f=qa,v=Ma,T=Ua,w=Ga,N=Xa,A=Ya;return Ca(),Da("div",null,[n(A,{"x-gap":"12",cols:2},{default:r(()=>[n(N,null,{default:r(()=>[n(w,{title:"资产信息报表"},{default:r(()=>[n(T,{ref:"formRef",class:"h-200px","label-width":80,"label-placement":"left",model:d.value},{default:r(()=>[n(l,{label:"资产类型",path:"atypes"},{default:r(()=>[n(a,{value:d.value.atypes,"onUpdate:value":o[0]||(o[0]=m=>d.value.atypes=m),placeholder:"请选择资产类型",clearable:"",filterable:"","value-field":"id",multiple:"","label-field":"aname",options:B(L).data,"reset-menu-on-options-change":!1,class:"w-100%","render-label":Pa,"render-tag":ja,onScroll:g},null,8,["value","options"])]),_:1}),n(l,{label:"查询日期",path:"selectTime"},{default:r(()=>[n(f,{value:d.value.time,"onUpdate:value":o[1]||(o[1]=m=>d.value.time=m),type:"daterange",clearable:"",class:"w-100%","onUpdate:formattedValue":$},null,8,["value"])]),_:1}),n(l,{label:" "},{default:r(()=>[n(v,{"attr-type":"button",onClick:b},{default:r(()=>[va(" 查询 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),n(N,null,{default:r(()=>[n(w,{title:"综合报表"},{default:r(()=>[n(T,{ref:"formRef",class:"h-200px","label-width":80,"label-placement":"left",model:c.value},{default:r(()=>[n(l,{label:"查询日期",path:"selectTime"},{default:r(()=>[n(f,{value:c.value.time,"onUpdate:value":o[2]||(o[2]=m=>c.value.time=m),type:"daterange",class:"w-100%","onUpdate:formattedValue":I},null,8,["value"])]),_:1}),n(l,{label:""}),n(l,{label:" "},{default:r(()=>[n(v,{"attr-type":"button",onClick:D},{default:r(()=>[va(" 查询 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),n(se,{data:P.value,visible:_.value,"onUpdate:visible":o[3]||(o[3]=m=>_.value=m)},null,8,["data","visible"])])}}});export{je as default};
