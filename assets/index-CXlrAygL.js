import{_ as la}from"./table-column-setting.vue_vue_type_script_setup_true_lang-B27ilpYI.js";import{_ as $t}from"./round-delete-nbvgQq8b.js";import{_ as ia}from"./round-add-DP8HgVrw.js";import{d as Ze,aw as Ke,q as Tt,v as Te,r as C,s as At,$ as A,a5 as d,C as O,B as g,cC as oa,ct as ra,cA as ua,cB as St,b9 as kt,au as ke,cV as da,cW as ca,cR as pa,cS as wt,a as ma,ay as it,at as He,bZ as Ut,b as qe,o as J,aT as Ct,f as a,bj as fa,w as l,bh as ga,G as Lt,F as Ft,c as le,z as Ae,h as n,bi as Le,e as T,b8 as va,cL as xt,g as v,aX as ha,N as me,aA as ot,t as Z,aF as Ot,dS as ya,dK as Et,e4 as Dt,e5 as _a,e6 as zt,e7 as ba,cr as Sa,e8 as ka,e9 as wa,dM as Pt,dH as Nt,aI as nt,dT as Ca,cZ as xa,c$ as Da,dL as za,cD as Pa,cK as Na,dN as Ia,aB as ja,aC as Mt,dG as $a,dO as Ta,ea as Aa,be as Ua,U as rt,a$ as It,cT as La,cH as Fa,aG as We,av as Rt,M as Oa,a_ as Ea,aN as Ma,i as Ra,y as Je,aO as Ge,D as Ue,aP as Va,aD as Ba,eb as Ja,cu as Ga,aU as qa}from"./index-9CCyyUlU.js";import{u as lt,a as Ka}from"./table-CdQ6GQ_M.js";import{_ as Ha}from"./round-plus-rp8ImzCg.js";import{_ as Wa,a as Za,A as Xa}from"./index-DKw8_iBE.js";import{g as ut,h as Qa,i as Vt,p as Ya,f as es}from"./business-CuPwCvz8.js";import{u as ts}from"./usePageData-BXqTxcmW.js";import{N as we}from"./Popconfirm-DtXOZuwc.js";import{_ as Bt}from"./Grid-BJohx9hb.js";import{_ as Jt}from"./FormItemGridItem-BhvP7sJ5.js";import{_ as as}from"./round-search-DI_38Hoo.js";import{_ as ss}from"./round-refresh-DgFAx-HS.js";import{N as ns}from"./DatePicker-WBRN1db9.js";import{N as ls}from"./RadioButton-C1T2uxP0.js";const is={class:"w-100%"},os={class:"flex"},rs={style:{display:"flex","flex-direction":"column",width:"100%"}},us={class:"flex items-center"},ds={class:"w-100%"},cs={class:"w-100px"},ps={style:{display:"flex","flex-direction":"column"}},ms={style:{display:"flex","flex-direction":"column"}},fs={style:{display:"flex","flex-direction":"column"}},gs=Ze({name:"OperateDrawer",__name:"operate-drawer",props:Ke({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Ke(["submitted"],["update:visible"]),setup(G,{emit:ee}){const _=Tt(),X=ee,E=Te({contactList:[],debuggedDevieceList:[]}),r=G,o=Te(te());function te(){return{proname:"",dispatchIds:[],contractIds:[],proaddr:"",cpdbtime:null,prosite:"",longitude:120.373885,latitude:30.303899,period:void 0,dtype:void 0,dispatch:"",status:1}}const P=C(0),Q=C(void 0);async function ie(){x.value=[{longitude:120.373885,latitude:30.303899,addr:""}],Object.assign(o,te()),Yt(),r.operateType==="edit"&&r.rowData&&(await Promise.all([ta(),z(),b(),c(),Ve()]),Object.assign(o,r.rowData),P.value=o.period,Q.value=o.status,await vt(),yt(o.proaddr||o.prosite),Ht())}const{formRef:I,validate:M,restoreValidation:h}=At(),D={proname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入项目名称"},status:{type:"number",required:!0,trigger:["blur","change"],message:"请选择项目状态"},contractIds:{type:"array",required:!0,trigger:["blur","change"],message:"请选择合同"},dtype:{type:"number",required:!0,trigger:["blur","change"],message:"请选择调试类型"},period:{type:"number",required:!0,trigger:["blur","change"],message:"请输入周期"},prosite:{type:"string",required:!0,trigger:["blur","change","focus"],message:"请选择项目地点"},cpdbtime:{type:"string",required:!0,trigger:["blur","change"],message:"请选择时间"}},y=C([]),j=Te({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",pageSizes:[20],prefix:()=>`共 ${y.value.length} 条`,onChange:e=>{j.page=e,b()},onUpdatePageSize:e=>{j.pageSize=e,j.page=1,b()}}),L=[{title:"姓名",key:"pname",align:"center",render(e,t){return e.setStatus?d(O,{value:e.pname,placeholder:"请输入姓名",onUpdateValue(s){y.value[t].pname=s}}):d("div",{},e.pname)}},{title:"联系方式",key:"pcontact",align:"center",render(e,t){return e.setStatus?d(O,{value:e.pcontact,placeholder:"请输入联系方式",onUpdateValue(s){y.value[t].pcontact=s}}):d("div",{},e.pcontact)}},{title:"备注",key:"proposition",align:"center",render(e,t){return e.setStatus?d(O,{value:e.proposition,placeholder:"请输入备注",onUpdateValue(s){y.value[t].proposition=s}}):d("div",{},e.proposition)}},{key:"operate",title:A("common.operate"),align:"center",minWidth:120,fixed:"right",render(e,t){return d("div",{class:"flex-center gap-8px"},[e.setStatus?[d(g,{type:"primary",ghost:!0,size:"small",onClick:()=>fe(e)},{default:()=>"保存"}),d(g,{type:"default",ghost:!0,size:"small",onClick:()=>H(e,t)},{default:()=>"取消"}),d(we,{onPositiveClick:()=>{r.operateType==="edit"&&e.id?oa(e.id).then(()=>{var s;y.value.splice(t,1),(s=window.$message)==null||s.success("删除成功")}):y.value.splice(t,1)}},{default:()=>A("common.confirmDelete"),trigger:()=>d(g,{type:"error",ghost:!0,size:"small"},{default:()=>A("common.delete")})})]:d(g,{type:"primary",ghost:!0,size:"small",onClick:()=>R(e)},{default:()=>"编辑"})])}}],b=async()=>{var t;const{data:e}=await ra({page:j.page,limit:j.pageSize,pid:(t=r.rowData)==null?void 0:t.id});y.value=e==null?void 0:e.list,y.value.forEach(s=>{s.setStatus=!1}),E.contactList=JSON.parse(JSON.stringify(y.value))},R=e=>{y.value.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},H=(e,t)=>{e.setStatus=!e.setStatus,e.id?y.value=JSON.parse(JSON.stringify(E.contactList)):y.value.splice(t,1)},fe=async e=>{var t,s,u,m,S;if(!e.pname){(t=window.$message)==null||t.warning("请输入联系人姓名");return}if(!e.pcontact){(s=window.$message)==null||s.warning("请输入联系方式");return}if(r.operateType==="edit")if(e.id){const{data:U,error:w}=await ua([e]);w||((u=window.$message)==null||u.success("修改成功"),b(),e.setStatus=!e.setStatus)}else{const{data:U,error:w}=await St([{...e,pid:(m=r.rowData)==null?void 0:m.id}]);w||((S=window.$message)==null||S.success("添加成功"),b(),e.setStatus=!e.setStatus)}else e.setStatus=!e.setStatus};function ge(){var e;((e=y.value[0])!=null&&e.pname||y.value.length==0)&&y.value.unshift({pname:"",pcontact:"",proposition:"",setStatus:!0})}const f=C([]),F=Te({page:1,pageSize:20,showSizePicker:!0,fuzzy:"",pageSizes:[20],prefix:()=>`共 ${f.value.length} 条`,onChange:e=>{F.page=e,z()},onUpdatePageSize:e=>{F.pageSize=e,F.page=1,z()}}),Pe=[{title:"设备名称",key:"devname",align:"center",render(e,t){return e.setStatus?d(O,{value:e.devname,placeholder:"请输入设备名称",onUpdateValue(s){f.value[t].devname=s}}):d("div",{},e.devname)}},{title:"型号",key:"devmodel",align:"center",render(e,t){return e.setStatus?d(O,{value:e.devmodel,placeholder:"请输入型号",onUpdateValue(s){f.value[t].devmodel=s}}):d("div",{},e.devmodel)}},{title:"数量",key:"devnum",align:"center",render(e,t){return e.setStatus?d(kt,{value:e.devnum,placeholder:"请输入数量",onUpdateValue(s){f.value[t].devnum=Number(s)||0}}):d("div",{},e.devnum)}},{title:"是否为我司设备",key:"etype",align:"center",render(e,t){return e.setStatus?d(ke,{value:e.etype,options:[{label:"是",value:0},{label:"否",value:1}],onUpdateValue(s){f.value[t].etype=s}}):d("div",{},e.etype===0?"是":"否")}},{title:"设备厂家",key:"devmanu",align:"center",render(e,t){return e.setStatus?d(O,{value:e.devmanu,placeholder:"请输入设备厂家",onUpdateValue(s){f.value[t].devmanu=s}}):d("div",{},e.devmanu)}},{title:"备注",key:"notes",align:"center",render(e,t){return e.setStatus?d(O,{value:e.notes,placeholder:"请输入备注",onUpdateValue(s){f.value[t].notes=s}}):d("div",{},e.notes)}},{title:"清点状态",key:"status",align:"center",render(e,t){return e.setStatus?d(ke,{value:e.status,options:[{label:"未清点",value:0},{label:"正常",value:1},{label:"增补",value:2},{label:"退货",value:3},{label:"换货",value:4}],onUpdateValue(s){f.value[t].status=s}}):d("div",{},e.status===0?"未清点":e.status===1?"正常":e.status===2?"增补":e.status===3?"退货":"换货")}},{key:"operate",title:A("common.operate"),align:"center",width:180,fixed:"right",render(e,t){return d("div",{class:"flex-center gap-8px"},[e.setStatus?[d(g,{type:"primary",ghost:!0,size:"small",onClick:()=>Xe(e)},{default:()=>"保存"}),d(g,{type:"default",ghost:!0,size:"small",onClick:()=>Ce(e,t)},{default:()=>"取消"}),d(we,{onPositiveClick:()=>{r.operateType==="edit"&&e.id?da(e.id).then(()=>{var s;f.value.splice(t,1),(s=window.$message)==null||s.success("删除成功")}):f.value.splice(t,1)}},{default:()=>A("common.confirmDelete"),trigger:()=>d(g,{type:"error",ghost:!0,size:"small"},{default:()=>A("common.delete")})})]:d(g,{type:"primary",ghost:!0,size:"small",onClick:()=>Ne(e)},{default:()=>"编辑"})])}}],z=async()=>{var t;const{data:e}=await ca({page:F.page,limit:F.pageSize,fuzzy:F.fuzzy,pid:(t=r.rowData)==null?void 0:t.id});f.value=e.list,E.debuggedDevieceList=JSON.parse(JSON.stringify(f.value))},Ne=e=>{f.value.forEach(t=>{t.setStatus=!1}),e.setStatus=!e.setStatus},Ce=(e,t)=>{e.setStatus=!e.setStatus,e.id?f.value=JSON.parse(JSON.stringify(E.debuggedDevieceList)):f.value.splice(t,1)},Xe=async e=>{var s,u,m,S,U,w;if(!e.devname){(s=window.$message)==null||s.warning("设备名称不能为空");return}if(!e.devmodel){(u=window.$message)==null||u.warning("设备型号不能为空");return}if(!e.devnum){(m=window.$message)==null||m.warning("设备数量不能为空");return}const t=e.dcreater*1;if(r.operateType==="edit")if(e.id){const{data:Y,error:V}=await pa([{...e,dcreater:t}]);V||((S=window.$message)==null||S.success("修改成功"),z(),e.setStatus=!e.setStatus)}else{const{data:Y,error:V}=await wt([{...e,pid:(U=r.rowData)==null?void 0:U.id,dcreater:t}]);V||((w=window.$message)==null||w.success("添加成功"),z(),e.setStatus=!e.setStatus)}else e.setStatus=!e.setStatus};function Fe(){var e;((e=f.value[0])!=null&&e.devname||f.value.length==0)&&f.value.unshift({status:void 0,devmanu:"",etype:0,devname:"",devmodel:"",devnum:0,notes:"",setStatus:!0})}const Oe=C({}),i=C([]);async function c(){var t;i.value=[];const{data:e}=await ya({page:1,limit:100,pid:(t=r.rowData)==null?void 0:t.id});e.list.forEach(s=>{s.sort==1&&i.value.push({id:s.id,name:s.filename,url:s.file,status:"finished",creator:s.username,dbtime:s.dbtime})}),i.value.reverse(),Oe.value=JSON.parse(JSON.stringify(e))}const ve=[{title:"文件别名",key:"name",align:"center",width:200,render(e){return e.setStatus?d(O,{value:e.name,onUpdateValue:t=>{e.name=t}}):d("div",{},e.name)}},{title:"文件名称",key:"filename",align:"center",width:200,render(e){return e.setStatus&&!e.url?d("div",{style:"display: flex; justify-content: center; align-items: center;"},[d(ja,{action:"#",showFileList:!1,customRequest:async({file:s,onFinish:u,onError:m})=>{var S,U;try{e.status=!0;const{data:w,error:Y}=await Aa(s.file,V=>{e.progress=V});w&&(e.url=w,e.status=!1)}catch(w){console.error(w),(U=(S=window.$message)==null?void 0:S.error)==null||U.call(S,"文件上传出错"),e.status=!1}}},{default:()=>d(g,{type:"info",size:"small",ghost:!0,loading:e.status},{default:()=>"上传文件"})}),e.progress?d(Mt,{type:"line",percentage:e.progress,indicatorPlacement:"inside",processing:!0}):null]):e.setStatus&&e.url&&!e.id?a("span",null,[e.url.split("?")[1],v(" "),a("span",{onClick:()=>e.url="",style:"color: red;cursor: pointer;font-size: 12px;"},[v("删除")])]):d("div",{},e.url.split("?")[1])}},{title:"上传人",key:"creator",align:"center",width:100,render(e){return d("div",{},e.creator)}},{title:"上传时间",key:"dbtime",align:"center",width:200,render(e){return d("div",{},e.dbtime?e.dbtime:"")}},{title:"操作",key:"actions",align:"center",width:180,render(e){return d(me,{justify:"center"},[!e.setStatus&&e.id&&d(g,{type:"info",size:"small",ghost:!0,onClick:()=>{he(e)}},{default:()=>"下载"}),e.setStatus&&d(g,{type:"info",size:"small",ghost:!0,onClick:()=>{Qe(e)}},{default:()=>"保存"}),e.setStatus&&d(g,{type:"info",size:"small",ghost:!0,onClick:()=>{e.setStatus=!e.setStatus}},{default:()=>"取消"}),!e.setStatus&&d(g,{type:"info",size:"small",ghost:!0,onClick:()=>{e.setStatus=!e.setStatus}},{default:()=>"编辑"})])}}];async function he(e){if(e!=null&&e.url)try{const s=await(await fetch(e.url.split("?")[0],{mode:"cors"})).blob(),u=URL.createObjectURL(s),m=document.createElement("a");m.href=u,m.download=e.url.split("?")[1],m.style.display="none",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(u)}catch(t){console.error("下载失败:",t)}}const ye=()=>{i.value.push({id:"",name:"",url:"",status:"uploading",setStatus:!0})},Qe=async e=>{var t,s,u,m,S,U,w,Y,V,_e,be,Se;if(!e.name){(s=(t=window.$message)==null?void 0:t.warning)==null||s.call(t,"请输入文件别名");return}if(!e.url){(m=(u=window.$message)==null?void 0:u.warning)==null||m.call(u,"请上传文件");return}if((S=r.rowData)!=null&&S.id){const{data:q,error:p}=await Nt([{pid:(U=r.rowData)==null?void 0:U.id,filename:e.name,file:e.url,sort:1}]);if(p)return(w=window.$message)==null?void 0:w.error("保存文件记录失败");(Y=window.$message)==null||Y.destroyAll(),e.setStatus=!e.setStatus,c(),(V=window.$message)==null||V.success("保存成功")}else if(e.id){const{data:q,error:p}=await $a([{id:e.id,filename:e.name}]);if(p)return(_e=window.$message)==null?void 0:_e.error("保存文件记录失败");(be=window.$message)==null||be.destroyAll(),e.setStatus=!e.setStatus,(Se=window.$message)==null||Se.success("编辑成功")}else e.setStatus=!e.setStatus},Ye=ma(()=>({add:"新增项目",edit:"修改项目"})[r.operateType]),oe=it(G,"visible");He(oe,()=>{oe.value&&(ie(),setTimeout(()=>{const e=document.querySelector(".n-scrollbar-content");e==null||e.scrollTo(0,0)},300),h())});function et(e){e||ae()}function ae(){oe.value=!1}async function Ie(){var e;await M(),(e=window.$dialog)==null||e.info({title:"提示",content:"确定提交吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await $()}})}async function $(){var e,t,s,u,m,S,U,w,Y,V,_e,be,Se;if(r.operateType==="edit"){const q=JSON.parse(JSON.stringify(o));P.value==q.period&&delete q.period,Q.value==q.status&&delete q.status;const{data:p,error:ce}=await Et([q]);if(!ce){let B=function(ne,W){const K=ne.filter(pe=>!W.includes(pe)),De=W.filter(pe=>!ne.includes(pe));return{toDelete:K,toAdd:De}};if((e=o.dispatchIds)!=null&&e.length&&((t=o.dispatchIds)==null?void 0:t.length)>0){const{toDelete:ne,toAdd:W}=B(ft.value,o.dispatchIds);if(W.length>0){const K=W.map(Be=>({pid:o.id,did:Be})),{data:De,error:pe}=await Dt(K)}if(ne.length>0){const{data:K,error:De}=await _a(ne.join(","))}}if((s=o.contractIds)!=null&&s.length&&((u=o.contractIds)==null?void 0:u.length)>0){const{toDelete:ne,toAdd:W}=B(_t.value,o.contractIds);if(W.length>0){const K=W.map(Be=>({pid:o.id,did:Be})),{data:De,error:pe}=await zt(K)}if(ne.length>0){const{data:K,error:De}=await ba(ne.join(","))}}ae(),X("submitted"),(m=window.$message)==null||m.success("修改成功")}}else{const q=Sa(),{data:p,error:ce}=await ka([{...o,uuid:q}]);if(!ce){const{data:B,error:ne}=await wa(q);if(B){let W=function(N,ze,bt){return N.map($e=>({...$e,pid:ze}))};if(o.dispatchIds&&o.dispatchIds.length>0){const N=[];(S=o.dispatchIds)==null||S.forEach(async $e=>{N.push({pid:B,did:$e})});const{data:ze,error:bt}=await Dt(N)}if(o.contractIds&&o.contractIds.length>0){const N=[];(U=o.contractIds)==null||U.forEach(async $e=>{N.push({proid:B,conid:$e})});const{data:ze,error:bt}=await zt(N)}const K=[];if(y.value.length>0){const N=W(y.value,B);K.push(St(N))}if(f.value.length>0){const N=W(f.value,B);K.push(wt(N))}if(x.value.length>0&&K.push(Pt(x.value)),(await Promise.allSettled(K)).forEach((N,ze)=>{N.status==="fulfilled"?console.log(`第 ${ze+1} 个请求成功`,N.value):console.error(`第 ${ze+1} 个请求失败`,N.reason)}),!i.value.length){(w=window.$message)==null||w.destroyAll(),(Y=window.$message)==null||Y.success("操作成功"),ae(),X("submitted");return}const pe=[];i.value.forEach(N=>{pe.push({pid:B,filename:N.name,file:N.url,sort:1})});const{data:Be,error:na}=await Nt(pe);na&&((V=window.$message)==null||V.error("保存文件记录失败")),(_e=window.$message)==null||_e.destroyAll(),(be=window.$message)==null||be.success("操作成功"),ae(),X("submitted")}}ae(),X("submitted"),(Se=window.$message)==null||Se.success("添加成功")}}const se=C(!1),tt=C();let xe=null,dt=null,Ee=null,ct=null,re=null;const ue=Te({longitude:0,latitude:0});let je;const Me=C(!1),de=C(""),Re=C([]);async function Gt(){window._AMapSecurityConfig={securityJsCode:_.userInfo.sdksecret},tt.value&&(re=await Xa.load({key:_.userInfo.sdkkey,version:"2.0",plugins:["AMap.Scale","AMap.PlaceSearch","AMap.AutoComplete","AMap.Geocoder","AMap.Geolocation"]}),xe=new re.Map(tt.value,{zoom:18,center:[k.value>0?x.value[k.value-1].longitude:o.longitude,k.value>0?x.value[k.value-1].latitude:o.latitude],viewMode:"3D",resizeEnable:!0}),dt=new re.Geocoder,new re.PlaceSearch({city:"全国",pageSize:50}),ct=new re.AutoComplete({city:"全国"}),at(re,{lng:k.value>0?x.value[k.value-1].longitude:o.longitude,lat:k.value>0?x.value[k.value-1].latitude:o.latitude}),xe.on("click",e=>{const{lng:t,lat:s}=e.lnglat;je=2,ue.latitude=s,ue.longitude=t,at(re,{lng:t,lat:s})}),nt(()=>window.dispatchEvent(new Event("resize"))))}const pt=Ut.debounce(async e=>{if(!Me.value||!e.trim()){Re.value=[];return}ct.search(e,(t,s)=>{var u;console.log(s,"result"),t=="complete"&&s.info=="OK"&&((u=s==null?void 0:s.tips)!=null&&u.length)?Re.value=s.tips.map(m=>({label:`${m.name}（${m.district||m.address||"无详细地址"}）`,value:`${m.location.lng}_${m.location.lat}`,raw:m})):Re.value=[]})},300);He(de,e=>{pt(e)});function qt(e,t){if(console.log(e,t,"option"),!e)return;const[s,u]=e.split("_").map(Number);!s||!u||(xe.setCenter([s,u]),je=1,at(re,{lng:s,lat:u}),ue.longitude=s,ue.latitude=u)}const k=C(0);function mt(e){e?k.value=e:k.value=0,se.value=!0,Me.value=!1,je=void 0,nt(async()=>{await Gt(),setTimeout(()=>{Me.value=!0;const t=document.querySelector(".n-auto-complete input");t==null||t.blur()},500)})}function at(e,t){Ee&&xe.remove(Ee),Ee=new e.Marker({position:[t.lng,t.lat],map:xe}),xe.add(Ee),dt.getAddress(t,(s,u)=>{s==="complete"&&u.regeocode&&(console.log("result",u),console.log("formattedAddress",u.regeocode.formattedAddress),t.latitude=t.lat,t.longitude=t.lng,je==1||(je==2?de.value=u.regeocode.formattedAddress:de.value=k.value>0?x.value[k.value-1].addr||u.regeocode.formattedAddress:o.prosite||u.regeocode.formattedAddress))})}function Kt(e,t){if(!t)return null;const s=t.replace(/省|市|特别行政区|自治区|壮族|回族|维吾尔/g,"").trim(),u=e.find(m=>t.includes(m.name)||m.name.includes(s));return u?u.id:null}const ft=C([]),Ht=async()=>{const{data:e,error:t}=await Ca({page:1,limit:100,pid:r.rowData.id});o.dispatchIds=e==null?void 0:e.list.map(s=>s.did),ft.value=JSON.parse(JSON.stringify(o.dispatchIds))},gt=C([]),vt=async()=>{const{data:e,error:t}=await xa();e&&(gt.value=e)},ht=C([]),yt=async e=>{let t=Kt(gt.value,e);const{data:s,error:u}=await Da({page:1,limit:100,province:t});ht.value=s.list},Wt=async()=>{var e,t,s;if(k.value==0)o.latitude=ue.latitude,o.longitude=ue.longitude,o.prosite=de.value,await vt(),yt(de.value);else if(x.value[k.value-1].addr=de.value,x.value[k.value-1].latitude=ue.latitude,x.value[k.value-1].longitude=ue.longitude,r.operateType=="edit"){let u=x.value[k.value-1];if(x.value[k.value-1].id){const{data:m,error:S}=await za([u]);m&&((e=window.$message)==null||e.success("修改位置成功"),se.value=!1,k.value=0,Ve())}else{u.pid=(t=r.rowData)==null?void 0:t.id;const{data:m,error:S}=await Pt([u]);m&&((s=window.$message)==null||s.success("添加位置成功"),se.value=!1,k.value=0,Ve())}}se.value=!1,k.value=0};function Zt(){se.value=!1}const{pageData:st,getData:Xt,nextPage:Qt}=ts(Pa),Yt=async()=>{await Xt({limit:100})},ea=async e=>{const t=e.currentTarget,s=t.scrollTop;t.scrollTop+t.offsetHeight>=t.scrollHeight&&st.data.length<st.total&&(await Qt(),await nt(),setTimeout(()=>{t.scrollTop=s}))},_t=C([]),ta=async()=>{var s;const{data:e,error:t}=await Na({page:1,limit:100,proid:(s=r.rowData)==null?void 0:s.id});o.contractIds=e==null?void 0:e.list.map(u=>u.conid),_t.value=JSON.parse(JSON.stringify(o.contractIds))},x=C([{longitude:120.373885,latitude:30.303899,addr:""}]),aa=C([]),Ve=async()=>{var s;const{data:e,error:t}=await Ia({pid:(s=r.rowData)==null?void 0:s.id,page:1,limit:99});x.value=e.list.length==0?[{longitude:120.373885,latitude:30.303899,addr:""}]:e.list,aa.value=JSON.parse(JSON.stringify(x.value))},sa=async e=>{var t;if(e.id){const{data:s,error:u}=await Ta(e.id);s&&((t=window.$message)==null||t.success("删除成功"),Ve())}else x.value.splice(x.value.indexOf(e),1)};return(e,t)=>{const s=Jt,u=Wa,m=va,S=Ha,U=$t,w=ot,Y=Bt,V=Lt,_e=ga,be=fa,Se=Za,q=Ot;return J(),qe(Ct,null,[a(be,{show:oe.value,"onUpdate:show":[t[13]||(t[13]=p=>oe.value=p),et],"display-directive":"show",width:1100,onMaskClick:t[14]||(t[14]=p=>oe.value=!0),onEsc:ae},{default:l(()=>[a(_e,{title:Ye.value,"native-scrollbar":!1,closable:""},{footer:l(()=>[a(n(me),{size:16,justify:"end"},{default:l(()=>[a(n(g),{onClick:ae},{default:l(()=>[v(Z(n(A)("common.cancel")),1)]),_:1}),a(n(g),{type:"primary",onClick:Ie},{default:l(()=>[v(Z(n(A)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[a(V,{ref_key:"formRef",ref:I,model:o,rules:D,onKeyup:Ft(Ie,["enter"])},{default:l(()=>[a(Y,{responsive:"screen","item-responsive":"","x-gap":"15"},{default:l(()=>[a(s,{span:"24 s:12 m:12",label:"项目名称",path:"proname"},{default:l(()=>[a(n(O),{clearable:"",value:o.proname,"onUpdate:value":t[0]||(t[0]=p=>o.proname=p),placeholder:"请输入项目名称"},null,8,["value"])]),_:1}),r.operateType==="add"?(J(),le(s,{key:0,span:"24 s:12 m:12",label:"绑定合同",path:"contractIds"},{default:l(()=>[a(n(ke),{filterable:"",multiple:"",value:o.contractIds,"onUpdate:value":t[1]||(t[1]=p=>o.contractIds=p),placeholder:"请选择合同","label-field":"contractname","value-field":"id",options:n(st).data,onScroll:ea},null,8,["value","options"])]),_:1})):Ae("",!0),r.operateType==="edit"?(J(),le(s,{key:1,span:"24 s:12 m:12",label:"项目状态",path:"status"},{default:l(()=>[a(n(ke),{filterable:"",value:o.status,"onUpdate:value":t[2]||(t[2]=p=>o.status=p),placeholder:"请选择项目状态",options:n(Le)(n(_).userInfo.usertype==0||n(_).userInfo.usertype==2?n(ut):n(Qa))},null,8,["value","options"])]),_:1})):Ae("",!0),a(s,{span:"24 s:12 m:12",label:"周期（天）",path:"period"},{default:l(()=>[a(n(kt),{clearable:"",value:o.period,"onUpdate:value":t[3]||(t[3]=p=>o.period=p),style:{width:"100%"},placeholder:"请输入周期"},null,8,["value"])]),_:1}),a(s,{span:"24 s:12 m:12",label:"调试类型",path:"dtype"},{default:l(()=>[a(n(ke),{filterable:"",value:o.dtype,"onUpdate:value":t[4]||(t[4]=p=>o.dtype=p),placeholder:"请选择调试类型",options:n(Le)(n(Vt))},null,8,["value","options"])]),_:1}),a(s,{span:"24 s:12 m:12",label:"项目默认地点",path:"prosite"},{default:l(()=>[T("div",is,[T("div",os,[a(m,{onClick:t[6]||(t[6]=p=>mt())},{default:l(()=>[a(n(O),{value:o.prosite,"onUpdate:value":t[5]||(t[5]=p=>o.prosite=p),placeholder:"请选择项目地点"},null,8,["value"]),a(n(g),null,{icon:l(()=>[a(u,{class:"text-icon"})]),_:1})]),_:1})])])]),_:1}),a(s,{span:"24 s:12 m:12",label:"项目详细地址",path:"proaddr"},{default:l(()=>[a(n(O),{type:"textarea",rows:1,clearable:"",value:o.proaddr,"onUpdate:value":t[7]||(t[7]=p=>o.proaddr=p),placeholder:"请输入项目详细地址"},null,8,["value"])]),_:1}),x.value.length?(J(),le(s,{key:2,span:"24 s:12 m:24",label:"",path:""},{default:l(()=>[T("div",rs,[T("div",us,[T("span",{class:"mr-10px",onClick:t[8]||(t[8]=xt(()=>{},["stop"]))},"其他地址"),a(n(g),{size:"small",ghost:"",type:"primary",onMousedown:t[9]||(t[9]=xt(()=>{},["stop"])),onClick:t[10]||(t[10]=p=>x.value.push({latitude:30.303899,longitude:120.373885,addr:""}))},{icon:l(()=>[a(S,{class:"text-icon"})]),default:l(()=>[t[17]||(t[17]=v(" 添加 "))]),_:1,__:[17]})]),T("div",ds,[(J(!0),qe(Ct,null,ha(x.value,(p,ce)=>(J(),qe("div",{class:"flex px-50px items-center mt-10px w-100%",key:p.latitude},[T("span",cs,"项目地址"+Z(ce+1),1),a(m,{onClick:B=>mt(ce+1)},{default:l(()=>[a(n(O),{readonly:"",value:p.addr,"onUpdate:value":B=>p.addr=B,placeholder:"请选择项目地址"+(ce+1)},null,8,["value","onUpdate:value","placeholder"]),a(n(g),null,{icon:l(()=>[a(u,{class:"text-icon"})]),_:1})]),_:2},1032,["onClick"]),a(n(we),{onPositiveClick:B=>sa(p)},{trigger:l(()=>[a(n(g),{size:"small",ghost:"",type:"error",class:"ml-10px"},{icon:l(()=>[a(U,{class:"text-icon"})]),default:l(()=>[t[18]||(t[18]=v(" "+Z("删除")))]),_:1,__:[18]})]),default:l(()=>[v(" 确定要删除项目地址"+Z(ce+1)+"吗？ ",1)]),_:2},1032,["onPositiveClick"])]))),128))])])]),_:1})):Ae("",!0),a(s,{span:"24 s:12 m:12",label:"调度名称",path:"dispatch"},{default:l(()=>[a(n(O),{clearable:"",value:o.dispatch,"onUpdate:value":t[11]||(t[11]=p=>o.dispatch=p),placeholder:"请输入调度名称"},null,8,["value"])]),_:1}),a(s,{span:"24 s:12 m:12",label:"选择调度",path:"dispatchIds"},{default:l(()=>[a(n(ke),{filterable:"",multiple:"",value:o.dispatchIds,"onUpdate:value":t[12]||(t[12]=p=>o.dispatchIds=p),placeholder:"请选择调度","label-field":"dname","value-field":"id",options:ht.value},null,8,["value","options"])]),_:1}),a(s,{span:"24 s:12 m:24",path:"contactList"},{default:l(()=>[T("div",ps,[a(n(me),{align:"center",style:{"margin-bottom":"10px"}},{default:l(()=>[t[20]||(t[20]=T("span",null,"项目联系人",-1)),a(n(g),{size:"small",ghost:"",type:"primary",onClick:ge},{icon:l(()=>[a(S,{class:"text-icon"})]),default:l(()=>[t[19]||(t[19]=v(" 添加项目联系人 "))]),_:1,__:[19]})]),_:1,__:[20]}),a(w,{columns:L,"paginate-single-page":!1,data:y.value,pagination:j,"max-height":350},null,8,["data","pagination"])])]),_:1}),a(s,{span:"24 s:12 m:24",path:"debuggedDevieceList"},{default:l(()=>[T("div",ms,[a(n(me),{align:"center",style:{"margin-bottom":"10px"}},{default:l(()=>[t[22]||(t[22]=T("span",null,"待调试设备",-1)),a(n(g),{size:"small",ghost:"",type:"primary",onClick:Fe},{icon:l(()=>[a(S,{class:"text-icon"})]),default:l(()=>[t[21]||(t[21]=v(" 添加待调试设备 "))]),_:1,__:[21]})]),_:1,__:[22]}),a(w,{columns:Pe,"paginate-single-page":!1,data:f.value,pagination:F,"max-height":350},null,8,["data","pagination"])])]),_:1}),a(s,{span:"24 s:12 m:24"},{default:l(()=>[T("div",fs,[a(n(me),{align:"center",style:{"margin-bottom":"10px"}},{default:l(()=>[t[24]||(t[24]=T("span",null,"图纸",-1)),a(n(g),{size:"small",ghost:"",type:"primary",onClick:ye},{icon:l(()=>[a(S,{class:"text-icon"})]),default:l(()=>[t[23]||(t[23]=v(" 添加图纸 "))]),_:1,__:[23]})]),_:1,__:[24]}),i.value.length>0?(J(),le(w,{key:0,columns:ve,data:i.value,size:"small","scroll-x":702,"row-key":p=>p.id,"max-height":350},null,8,["data","row-key"])):Ae("",!0)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"]),a(q,{show:se.value,"onUpdate:show":t[16]||(t[16]=p=>se.value=p),title:"选择项目位置",preset:"card",class:"w-800px"},{footer:l(()=>[a(n(me),{justify:"end",size:16},{default:l(()=>[a(n(g),{onClick:Zt},{default:l(()=>[v(Z(n(A)("common.cancel")),1)]),_:1}),a(n(g),{type:"primary",onClick:Wt},{default:l(()=>[v(Z(n(A)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[Me.value?(J(),le(Se,{key:0,value:de.value,"onUpdate:value":[t[15]||(t[15]=p=>de.value=p),n(pt)],options:Re.value,placeholder:"请输入地点关键字",clearable:"",onSelect:qt},null,8,["value","options","onUpdate:value"])):Ae("",!0),T("div",{ref_key:"domRef",ref:tt,class:"h-full w-full",style:{width:"100%",height:"500px","margin-top":"10px"}},null,512)]),_:1},8,["show"])],64)}}}),vs=Ze({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:Ke(["reset","search"],["update:model"]),setup(G,{emit:ee}){Ua();const _=ee,{formRef:X,restoreValidation:E}=At(),r=it(G,"model"),o={当日:()=>{const h=new Date().getTime();return[h,h]},本周:()=>{const h=new Date().getTime();return[h-24*60*60*1e3*7,h]},上月:()=>{const h=new Date().getTime();return[h-24*60*60*1e3*30,h]},近一年:()=>{const h=new Date().getTime();return[h-24*60*60*1e3*365,h]},近三年:()=>{const h=new Date().getTime();return[h-24*60*60*1e3*365*3,h]}};function te(){r.value.fuzzy="",_("search")}async function P(h,D){if(!h){r.value.startTime=void 0,r.value.endTime=void 0,_("search");return}r.value.startTime=String(It(1,D[0])),r.value.endTime=String(It(1,D[1])),_("search")}async function Q(){r.value.startTime=void 0,r.value.endTime=void 0,r.value.startAndTimeRange=null,r.value.fuzzy="",r.value.status=null,r.value.ptype=null,r.value.dtype=null,await E(),_("reset")}const ie=Ut.debounce(h=>{_("search")},1e3,{leading:!0,trailing:!1}),I=h=>{r.value.fuzzy=h,ie(h)};async function M(){_("search")}return(h,D)=>{const y=O,j=Jt,L=ke,b=ns,R=ss,H=g,fe=as,ge=me,f=Bt,F=Lt,Pe=rt;return J(),le(Pe,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[a(F,{ref_key:"formRef",ref:X,model:r.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:Ft(M,["enter"])},{default:l(()=>[a(f,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[a(j,{span:"24 s:12 m:6",label:"项目/客户",path:"fuzzy"},{default:l(()=>[a(y,{clearable:"",value:r.value.fuzzy,"onUpdate:value":D[0]||(D[0]=z=>r.value.fuzzy=z),placeholder:"请输入项目名称或客户名称",onClear:te,onInput:I},null,8,["value"])]),_:1}),a(j,{span:"24 s:12 m:6",label:"项目状态",path:"status"},{default:l(()=>[a(L,{clearable:"",filterable:"",value:r.value.status,"onUpdate:value":[D[1]||(D[1]=z=>r.value.status=z),M],placeholder:"请选择项目状态",options:n(Le)(n(ut)).sort((z,Ne)=>z.value-Ne.value)},null,8,["value","options"])]),_:1}),a(j,{span:"24 s:12 m:6",label:"进度状态",path:"ptype"},{default:l(()=>[a(L,{clearable:"",filterable:"",value:r.value.ptype,"onUpdate:value":[D[2]||(D[2]=z=>r.value.ptype=z),M],placeholder:"请选择进度状态",options:[{label:"正常",value:0},{label:"已延期",value:1}]},null,8,["value"])]),_:1}),a(j,{span:"24 s:12 m:6",label:"调试类型",path:"dtype"},{default:l(()=>[a(L,{clearable:"",filterable:"",value:r.value.dtype,"onUpdate:value":[D[3]||(D[3]=z=>r.value.dtype=z),M],placeholder:"请选择调试类型",options:n(Le)(n(Vt))},null,8,["value","options"])]),_:1}),a(j,{span:"24 s:12 m:8",label:"起止时间"},{default:l(()=>[a(b,{value:r.value.startAndTimeRange,"onUpdate:value":D[4]||(D[4]=z=>r.value.startAndTimeRange=z),type:"datetimerange",clearable:"",shortcuts:o,"onUpdate:formattedValue":P},null,8,["value"])]),_:1}),a(j,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[a(ge,{class:"w-full"},{default:l(()=>[a(H,{onClick:Q},{icon:l(()=>[a(R,{class:"text-icon"})]),default:l(()=>[v(" "+Z(n(A)("common.reset")),1)]),_:1}),a(H,{type:"primary",ghost:"",onClick:M},{icon:l(()=>[a(fe,{class:"text-icon"})]),default:l(()=>[v(" "+Z(n(A)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),hs={class:"min-h-500px flex gap-16px"},ys={class:"flex items-center justify-end gap-16px"},_s=Ze({__name:"relatedContractLook",props:Ke({id:{}},{visable:{type:Boolean},visableModifiers:{}}),emits:["update:visable"],setup(G){const ee=G,_=it(G,"visable"),{columns:X,data:E,getData:r,loading:o,mobilePagination:te,searchParams:P}=lt({apiFn:La,immediate:!1,apiParams:{page:1,pageSize:20,limit:20,id:ee.id,_t:new Date().getTime()},columns:()=>[{key:"contractname",title:"合同",width:200,render:b=>a("div",{class:y.pids==b.id?"bg-#f1f1f1 cursor-pointer p-5px":"cursor-pointer p-5px",onClick:()=>j(b.id)},[a("div",{class:"flex"},[a("div",{class:"w-60px inline-block"},[v("名称：")]),b.contractname]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("编号：")]),v(" "),b.contractnum]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("联系人：")]),b.businesscon]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("联系方式：")]),b.businessinfo]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("注意事项：")]),b.precautions]),a("div",{class:"font-size-12px c-#7d7575 flex"},[a("div",{class:"w-60px inline-block"},[v("备注：")]),b.notes])])}]}),{columns:Q,data:ie,getData:I,loading:M,pagination:h,mobilePagination:D,searchParams:y}=lt({apiFn:Fa,immediate:!1,apiParams:{page:1,pageSize:20,limit:20,pids:ee.id,_t:new Date().getTime()},columns:()=>[{key:"devname",title:"设备名称",align:"center",width:200,ellipsis:{tooltip:!0}},{key:"devcount",title:"数量",align:"center",width:120},{key:"devmodel",title:"规格型号",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"devunit",title:"单位",align:"center",width:120},{key:"devtype",title:"是否为我司设备",align:"center",width:120,render:b=>b.devtype==0?a(We,{type:"success"},{default:()=>[v("是")]}):a(We,{type:"info"},{default:()=>[v("否")]})},{key:"devmanu",title:"设备厂家",align:"center",width:120},{key:"notes",title:"备注",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:180}]}),j=b=>{y.pids=b,I()},L=()=>{_.value=!1};return He(()=>_.value,async b=>{var R;b&&(P.id=ee.id,ie.value=[],h.itemCount=0,await r(),y.pids=(R=E.value[0])==null?void 0:R.id,y.pids&&I())}),(b,R)=>{const H=ot,fe=rt,ge=Ot;return J(),le(ge,{show:_.value,"onUpdate:show":R[0]||(R[0]=f=>_.value=f),preset:"card",class:"w-1400px",title:"项目关联的合同"},{footer:l(()=>[T("div",ys,[a(n(g),{type:"primary",size:"small",onClick:L},{default:l(()=>R[1]||(R[1]=[v(" 关闭 ")])),_:1,__:[1]})])]),default:l(()=>[T("div",hs,[a(H,{class:"left",columns:n(X),data:n(E),"paginate-single-page":!1,size:"small",remote:"",loading:n(o),pagination:n(te),"row-key":f=>f.id,"max-height":600},null,8,["columns","data","loading","pagination","row-key"]),a(fe,{bordered:!1,size:"small",title:"设备",class:"w-1100px"},{default:l(()=>[a(H,{style:{width:"100%"},columns:n(Q),data:n(ie),size:"small","max-height":600,loading:n(M),remote:"","scroll-x":n(Q).reduce((f,F)=>f+(F.width||100),0),"paginate-single-page":!1,pagination:n(D),"row-key":f=>f.id},null,8,["columns","data","loading","scroll-x","pagination","row-key"])]),_:1})])]),_:1},8,["show"])}}}),bs=Rt(_s,[["__scopeId","data-v-a53f455a"]]),Ss={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function jt(G){return typeof G=="function"||Object.prototype.toString.call(G)==="[object Object]"&&!qa(G)}const ks=Ze({name:"projectmanagement_projectlist",__name:"index",setup(G){const ee=Oa(),_=Tt(),X=Ea(),E=Ma(),{columns:r,columnChecks:o,data:te,getData:P,loading:Q,mobilePagination:ie,searchParams:I}=lt({showTotal:!0,apiFn:Ga,apiParams:{page:1,pageSize:20,limit:20,status:null,startAndTimeRange:null,startTime:null,endTime:null,creater:void 0,fuzzy:"",sort:void 0,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"proname",title:"项目名称",align:"center",width:240,render:i=>a("div",{class:"cursor-pointer",onClick:()=>Fe(i)},[i.proname])},{key:"progess",title:"项目进度",align:"center",width:140,sorter:!0,render:i=>a(Mt,{type:"line",showIndicator:!0,percentage:i.progess,"indicator-placement":"inside",processing:!0,color:"#1890ff"},null)},{key:"status",title:"项目状态",align:"center",width:120,defaultFilterOptionValue:null,filterOptions:Le(ut),filter:!0,filterMultiple:!1,render:i=>{if(i.status===null)return null;const c=A(Ya[i.status]);return a("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:i.status==-1?"#a27ff9":i.status===0?"#9ca3af":i.status===1?"#3b82f6":i.status===2?"#facc15":"#22c55e",borderRadius:"50%"}},[a("span",{style:{width:"10px",height:"10px",marginRight:"5px",backgroundColor:i.status==-1?"#a27ff9":i.status===0?"#9ca3af":i.status===1?"#3b82f6":i.status===2?"#facc15":"#22c55e",borderRadius:"50%"}},null),a("span",null,[c])])}},{key:"cpdbtime",title:"预计完成日期",align:"center",width:180,ellipsis:{tooltip:!0}},{key:"period",title:"周期",align:"center",width:100,render:i=>a("div",null,[i.period,v("天")])},{key:"ptype",title:"状态",align:"center",width:100,render:i=>a(We,{type:i.ptype===0?"success":"error"},{default:()=>[i.ptype===0?"正常":"已延期"]})},{key:"dtype",title:"调试类型",align:"center",width:100,render:i=>{if(i.dtype===null)return null;const c=A(es[i.dtype]);return a(We,{type:i.dtype==0?"warning":i.dtype==1?"success":"info"},jt(c)?c:{default:()=>[c]})}},{key:"username",title:"创建人",align:"center",width:100,ellipsis:{tooltip:!0}},{key:"dbtime",title:"创建时间",align:"center",width:180},{key:"operate",title:A("common.operate"),align:"center",width:320,fixed:"right",render:i=>{let c;return a("div",{class:"flex justify-end gap-8px"},[i.status==-1&&(_.userInfo.usertype==0||_.userInfo.id==1021||_.userInfo.id==1023)&&a(we,{onPositiveClick:()=>H(i,0)},{default:()=>"确定核准该项目吗？",trigger:()=>a(g,{color:"#a43cf9",ghost:!0,size:"small"},{default:()=>["核准"]})}),i.status==0&&(_.userInfo.usertype==0||_.userInfo.usertype==2)&&a(we,{onPositiveClick:()=>H(i,1)},{default:()=>"确定启动该项目吗？",trigger:()=>Ue(a(g,{type:"success",ghost:!0,size:"small"},{default:()=>["启动"]}),[[Je("no-auth"),"project:Info:update"]])}),i.status==2&&(_.userInfo.usertype==0||_.userInfo.usertype==2)&&a(we,{onPositiveClick:()=>H(i,3)},{default:()=>"是否确认执行审核操作？",trigger:()=>Ue(a(g,{type:"warning",ghost:!0,size:"small"},{default:()=>["审核"]}),[[Je("no-auth"),"project:Info:update"]])}),a(g,{type:"primary",ghost:!0,size:"small",onClick:()=>Fe(i)},{default:()=>["详情"]}),a(g,{type:"primary",ghost:!0,size:"small",onClick:()=>Pe(i)},{default:()=>["关联合同"]}),Ue(a(g,{type:"primary",ghost:!0,size:"small",onClick:()=>fe(i.id)},jt(c=A("common.edit"))?c:{default:()=>[c]}),[[Je("no-auth"),"project:Info:update"]])])}}]}),{drawerVisible:M,operateType:h,editingData:D,handleAdd:y,handleEdit:j,checkedRowKeys:L,onBatchDeleted:b}=Ka(te,P);async function R(){console.log(L.value),ge(L.value.join(","),i=>{b()})}const H=async(i,c)=>{var ye;const{data:ve,error:he}=await Et([{id:i.id,status:c}]);he||((ye=window.$message)==null||ye.success("操作成功"),P(),c==3&&window.dispatchEvent(new CustomEvent("clearReview",{detail:{id:i.pid,type:"prj"}})))};function fe(i){j(i)}async function ge(i,c){const{data:ve,error:he}=await Ja(i);if(!he)c&&c(ve);else return!1}const f=C(!1),F=C(0),Pe=i=>{f.value=!0,F.value=i.id},z=i=>{I.status=i.status,P()},Ne=i=>{console.log(i),i.columnKey=="progess"&&(I.sort=i.order=="ascend"?0:i.order=="descend"?1:void 0,P())},Ce=C(-1),Xe=i=>{i>0?(Ce.value=i,I.creater=JSON.parse(JSON.stringify(i)),P()):(I.creater=void 0,Ce.value=-1,P())},Fe=i=>{X.push("/projectmanagement/orderdetail?prjId="+i.id),_.setProjectInfo({pid:i.id,pname:i.proname})},Oe=()=>{P()};return Ra(()=>{E.query.pname?(I.fuzzy=E.query.pname,I.status=2,Oe()):P()}),He(()=>E.query.pname,i=>{i&&(I.fuzzy=i,P())}),(i,c)=>{const ve=ls,he=Ba,ye=me,Qe=ia,Ye=$t,oe=la,et=ot,ae=rt,Ie=Je("no-auth");return J(),qe("div",Ss,[a(vs,{model:n(I),"onUpdate:model":c[0]||(c[0]=$=>Ge(I)?I.value=$:null),onReset:Oe,onSearch:n(P)},null,8,["model","onSearch"]),a(ae,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[a(ye,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>[c[6]||(c[6]=T("div",null,"项目列表",-1)),a(he,{size:"small",value:Ce.value,"onUpdate:value":[c[1]||(c[1]=$=>Ce.value=$),Xe],name:"radiobuttongroup1"},{default:l(()=>[a(ve,{value:-1,label:"默认"}),a(ve,{value:n(_).userInfo.id,label:"我创建的"},null,8,["value"])]),_:1},8,["value"])]),_:1,__:[6]})]),"header-extra":l(()=>[a(ye,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[Ue((J(),le(n(g),{onClick:n(y),size:"small",ghost:"",type:"primary"},{icon:l(()=>[a(Qe,{class:"text-icon"})]),default:l(()=>[c[7]||(c[7]=v(" "+Z("新增项目")))]),_:1,__:[7]},8,["onClick"])),[[Ie,"project:Info:insert"]]),a(n(we),{onPositiveClick:R},{trigger:l(()=>[Ue((J(),le(n(g),{size:"small",ghost:"",type:"error",disabled:n(L).length==0},{icon:l(()=>[a(Ye,{class:Va(["text-icon",{"animate-spin":n(Q)}])},null,8,["class"])]),default:l(()=>[c[8]||(c[8]=v(" "+Z("批量删除")))]),_:1,__:[8]},8,["disabled"])),[[Ie,"project:Info:delete"]])]),default:l(()=>[c[9]||(c[9]=v(" 确定要删除选中的合同吗？ "))]),_:1,__:[9]}),a(oe,{columns:n(o),"onUpdate:columns":c[2]||(c[2]=$=>Ge(o)?o.value=$:null)},null,8,["columns"])]),_:1})]),default:l(()=>[a(et,{"checked-row-keys":n(L),"onUpdate:checkedRowKeys":c[3]||(c[3]=$=>Ge(L)?L.value=$:null),columns:n(r),data:n(te),size:"small","flex-height":!n(ee).isMobile,"scroll-x":n(r).reduce(($,se)=>$+(se.width||100),0),loading:n(Q),remote:"","row-key":$=>$.id,"onUpdate:sorter":Ne,pagination:n(ie),class:"sm:h-full","onUpdate:filters":z},null,8,["checked-row-keys","columns","data","flex-height","scroll-x","loading","row-key","pagination"]),a(gs,{visible:n(M),"onUpdate:visible":c[4]||(c[4]=$=>Ge(M)?M.value=$:null),onSubmitted:n(P),"operate-type":n(h),"row-data":n(D)},null,8,["visible","onSubmitted","operate-type","row-data"]),a(bs,{visable:f.value,"onUpdate:visable":c[5]||(c[5]=$=>f.value=$),id:F.value},null,8,["visable","id"])]),_:1})])}}}),Ms=Rt(ks,[["__scopeId","data-v-3b40784c"]]);export{Ms as default};
