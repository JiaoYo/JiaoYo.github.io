import{_ as mt}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DTyciG8n.js";import{_ as ft}from"./round-refresh-Ce8bIByR.js";import{_ as gt}from"./export-DbEN2073.js";import{_ as vt}from"./round-delete-D92O9eM9.js";import{bd as xe,o as O,e as Ne,f as Pe,d as je,p as ve,r as Ie,q as Ve,s as Oe,v as ht,ab as Be,b as st,$ as D,aL as dt,g as e,z as ke,w as a,h as w,t as x,i as t,aE as Y,A as ae,aN as Fe,ao as Ee,aF as Ce,aP as Le,ak as Ae,L as he,B as V,aS as qe,b1 as Ge,Q as Je,P as $e,aJ as Xe,aT as We,bf as bt,k as Ue,aK as tt,c as ne,D as De,a0 as _t,ai as yt,x as wt,C as Tt,af as ue,aO as kt,y as Ft,H as It,I as Lt,G as Nt,aC as Dt,a6 as Pt}from"./index-00pZtPBt.js";import{_ as Ct}from"./round-add-BJVAZVna.js";import{_ as Ut}from"./round-search-Cgm8cfgb.js";import{u as He,a as Qe}from"./table-BUcbG8zn.js";import{p as ge,d as rt,a as xt,b as lt,c as at}from"./gather-BDoQC_Yg.js";import{_ as Ye}from"./FormItemGridItem-CHgxRxLI.js";import{_ as Ze}from"./Grid-DZYnaI-Y.js";import{N as nt}from"./Popconfirm-B352hAvh.js";import{_ as jt}from"./InputGroupLabel-C7hqUUah.js";function At(L){return xe({url:"/transTag/selectPage.do",method:"get",params:L})}function ct(L){return xe({url:"/transTag/insert.do",method:"post",data:L})}function Me(L){return xe({url:"/transTag/update.do",method:"post",data:L})}function ot(L){return xe({url:"/transTag/delete.do",method:"get",params:L})}const $t={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},St=Pe("path",{fill:"currentColor",d:"M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36M20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83l3.75 3.75z"},null,-1),zt=[St];function Rt(L,Z){return O(),Ne("svg",$t,[...zt])}const Kt={name:"ic-round-edit",render:Rt},Mt=Pe("span",null,[w("物模型标识"),Pe("br"),w("(测点描述)")],-1),Vt=je({__name:"add_model",props:ve({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ve(["submitted"],["update:visible"]),setup(L,{emit:Z}){const n=Ie({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:{},dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),v=Ve(L,"visible"),B=Z,R=L,l=Ie(q());function q(){return{chlId:void 0,devId:void 0,tagDevId:"",tagName:"",tagId:void 0,tagDesc:"",tagUnit:"",tagType:1,tagK:1,objAddr:"0",collectType:1,dataType:4,dataFormat:0}}async function y(){var h;const{data:d,error:i}=await bt({page:1,limit:1e4,type:1});i||(n.deveicelList=d.list.map(b=>({...b,label:b.devName,value:b.id+"_"+b.chlId})),R.operateType==="add"&&n.deveicelList.length>0&&!l.tagDevId&&(l.tagDevId=(h=n.deveicelList[0])==null?void 0:h.value,l.devId=Number(l.tagDevId.split("_")[0]),l.chlId=Number(l.tagDevId.split("_")[1]),l.collectType=void 0),j())}async function j(){const{data:d,error:i}=await Le({chlId:l.chlId});i||(n.functionList=JSON.parse(d).data,l.collectType=n.functionList[0].FuncCode)}function z(){Object.assign(l,q()),y(),R.operateType==="edit"&&R.rowData&&(Object.assign(l,R.rowData),T(R.rowData))}const{formRef:ee,validate:_,restoreValidation:oe}=Oe();ht(),Be(v,()=>{v.value&&(z(),oe())});const $=()=>{v.value=!1};function T(d,i){console.log(d),d==0||d==1||d==2||d==3||d==4||d==7?n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:d==5||d==6||d==8||d==9||d==10||d==12||d==13?n.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],n.collectionPointForm.dataFormatList.find(h=>h.value===l.dataFormat)||(l.dataFormat=n.collectionPointForm.dataFormatList[0].value)}const K=async()=>{var d,i;if(await _(),console.log(l),R.operateType==="add"){const{data:h,error:b}=await ct([l]);b||($(),(d=window.$message)==null||d.success("添加成功"),B("submitted"))}else{const{data:h,error:b}=await Me([l]);b||($(),(i=window.$message)==null||i.success("编辑成功"),B("submitted"))}},S={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},P={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},A={devId:P,tagName:S,tagK:P,objAddr:S,collectType:P,dataType:P,dataFormat:P},X=st(()=>({add:D("common.add"),edit:D("common.edit")})[R.operateType]),{columns:W,columnChecks:ie,data:H,getData:M,loading:N,mobilePagination:se,searchParams:p,resetSearchParams:Se}=He({apiFn:dt,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",multiple:!1,align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140},{key:"devId",title:"所属设备",align:"center",width:140,render:d=>{var i;return e("span",null,[((i=n.collectionPointForm.deveicelList.find(h=>h.id===d.devId))==null?void 0:i.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),pe=()=>{M()},{drawerVisible:ze,operateType:Re,editingData:f,handleAdd:m,handleEdit:F,checkedRowKeys:k,onBatchDeleted:Q,onDeleted:be}=Qe(H,M);async function G(){const{data:d,error:i}=await Ce();i||(console.log("data",d),d.length>0&&(n.collectionPointForm.channelList=d.filter(h=>h.chlType!==1).map(h=>({label:h.chlName,value:h.id,devicePojoList:h.devicePojoList||[]}))))}G();const de=d=>{var h;p.chlid=d,p.devId=null;let i=(h=n.collectionPointForm.channelList.find(b=>b.value==d))==null?void 0:h.devicePojoList;n.collectionPointForm.deveicelList=i,te(),M()};function me(){var d,i;if(n.collectionPointForm.channelList.length>0)if(p.chlid)n.collectionPointForm.visible=!0;else{let h=n.collectionPointForm.channelList[0];p.chlid=h.value,n.collectionPointForm.deveicelList=h.devicePojoList,te(),k.value=[l.tagId],n.collectionPointForm.checkedRows.tagName=l.tagName,n.collectionPointForm.checkedRows.id=l.tagId}else return(d=window.$message)==null||d.destroyAll(),(i=window.$message)==null||i.warning("暂无通道，请您先创建通道在进行查询"),!1}async function te(){const{data:d,error:i}=await Le({chlId:p.chlid});i||(n.collectionPointForm.functionList=JSON.parse(d).data,n.collectionPointForm.visible=!0,M())}function _e(){n.collectionPointForm.visible=!1}function C(d,i,h){console.log(i),n.collectionPointForm.checkedRows=i[0]}function ye(){var d,i;if(k.value.length===0)return(d=window.$message)==null||d.destroyAll(),(i=window.$message)==null||i.warning("请您先选择采集点"),!1;l.tagName=n.collectionPointForm.checkedRows.tagName,l.tagId=n.collectionPointForm.checkedRows.id,l.tagDesc||(l.tagDesc=n.collectionPointForm.checkedRows.tagDesc),n.collectionPointForm.visible=!1}return(d,i)=>{const h=Ae,b=Ye,I=he,Ke=V,s=qe,o=he,u=Ge,c=Ze,E=Je,U=V,J=$e,re=Xe,le=We,fe=ke("no-space");return O(),Ne(Ee,null,[e(re,{show:v.value,"onUpdate:show":i[10]||(i[10]=r=>v.value=r),title:X.value,preset:"card",class:"w-50%"},{footer:a(()=>[e(J,{size:16,justify:"center"},{default:a(()=>[e(U,{onClick:$,class:"w-100px"},{default:a(()=>[w(x(t(D)("common.cancel")),1)]),_:1}),e(U,{type:"primary",class:"w-100px",onClick:K},{default:a(()=>[w(x(t(D)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(E,{ref_key:"formRef",ref:ee,model:l,rules:A,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(c,{responsive:"screen","item-responsive":""},{default:a(()=>[e(b,{span:"24 m:12",label:"所属设备",path:"belongingChannel"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择所属设备",value:l.devId,"onUpdate:value":i[0]||(i[0]=r=>l.devId=r),"value-field":"id",options:n.deveicelList},null,8,["value","options"])]),_:1}),e(b,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:a(()=>[e(s,null,{default:a(()=>[e(I,{value:l.tagName,"onUpdate:value":i[1]||(i[1]=r=>l.tagName=r),style:{width:"80%"},readonly:""},null,8,["value"]),e(Ke,{type:"primary",ghost:"",onClick:me},{default:a(()=>[w("请选择")]),_:1})]),_:1})]),_:1}),e(b,{span:"24 m:12",label:"物模型标识(测点描述)",path:"tagDesc"},{label:a(()=>[Mt]),default:a(()=>[e(o,{clearable:"",value:l.tagDesc,"onUpdate:value":i[2]||(i[2]=r=>l.tagDesc=r),placeholder:"请输入物模型标识(测点描述)"},null,8,["value"])]),_:1}),e(b,{span:"24 m:12",label:"测点类型",path:"tagType"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择测点类型",value:l.tagType,"onUpdate:value":i[3]||(i[3]=r=>l.tagType=r),options:t(Y)(t(ge))},null,8,["value","options"])]),_:1}),e(b,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:a(()=>[e(u,{clearable:"",value:l.tagK,"onUpdate:value":i[4]||(i[4]=r=>l.tagK=r),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(b,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择转发功能码",value:l.collectType,"onUpdate:value":i[5]||(i[5]=r=>l.collectType=r),options:n.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(b,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:a(()=>[e(o,{clearable:"",value:l.objAddr,"onUpdate:value":i[6]||(i[6]=r=>l.objAddr=r),placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(b,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择数据类型",value:l.dataType,"onUpdate:value":[i[7]||(i[7]=r=>l.dataType=r),T],options:t(Y)(t(rt))},null,8,["value","options"])]),_:1}),e(b,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择数据格式",value:l.dataFormat,"onUpdate:value":i[8]||(i[8]=r=>l.dataFormat=r),options:n.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(b,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:a(()=>[e(o,{clearable:"",value:l.tagUnit,"onUpdate:value":i[9]||(i[9]=r=>l.tagUnit=r),placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(re,{show:n.collectionPointForm.visible,"onUpdate:show":i[17]||(i[17]=r=>n.collectionPointForm.visible=r),title:"选择采集点",preset:"card",class:"w-60%"},{footer:a(()=>[e(J,{size:16,justify:"end"},{default:a(()=>[e(U,{onClick:_e},{default:a(()=>[w(x(t(D)("common.cancel")),1)]),_:1}),e(U,{type:"primary",onClick:ye},{default:a(()=>[w(x(t(D)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(E,{model:n.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(c,{responsive:"screen","item-responsive":""},{default:a(()=>[e(b,{span:"24 m:12",label:"所属通道"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择所属通道",value:t(p).chlid,"onUpdate:value":i[11]||(i[11]=r=>t(p).chlid=r),options:n.collectionPointForm.channelList,onUpdateValue:de},null,8,["value","options"])]),_:1}),e(b,{span:"24 m:12",label:"所属设备"},{default:a(()=>[e(h,{filterable:"",clearable:"",placeholder:"请选择所属设备",value:t(p).devId,"onUpdate:value":i[12]||(i[12]=r=>t(p).devId=r),"label-field":"devName","value-field":"id",options:n.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(b,{span:"24 m:12",label:"测点类型"},{default:a(()=>[e(h,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(p).tagType,"onUpdate:value":i[13]||(i[13]=r=>t(p).tagType=r),options:t(Y)(t(ge))},null,8,["value","options"])]),_:1}),e(b,{span:"24 m:12",label:"测点功能码"},{default:a(()=>[e(h,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:t(p).collectType,"onUpdate:value":i[14]||(i[14]=r=>t(p).collectType=r),options:n.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(b,{span:"24 m:12",label:"测点名称"},{default:a(()=>[ae(e(o,{clearable:"",value:t(p).fuzzy,"onUpdate:value":i[15]||(i[15]=r=>t(p).fuzzy=r),placeholder:"请输入测点名称"},null,8,["value"]),[[fe]])]),_:1}),e(b,{span:"24 m:12",label:" "},{default:a(()=>[e(U,{onClick:pe},{default:a(()=>[w(x(t(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(le,{"checked-row-keys":t(k),"onUpdate:checkedRowKeys":[i[16]||(i[16]=r=>Fe(k)?k.value=r:null),C],columns:t(W),data:t(H),size:"small","max-height":500,loading:t(N),remote:"","row-key":r=>r.id,pagination:t(se)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1},8,["show"])],64)}}}),Ot={class:"flex"},Bt=je({__name:"add_multipe_model",props:ve(["devId","chlid"],{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ve(["submitted"],["update:visible"]),setup(L,{emit:Z}){const n=Ie({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:[],dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),v=Ve(L,"visible"),B=L,R=Z,l=Ie(q());function q(){return{chlId:void 0,devId:void 0,tagDevId:void 0,tagName:"",tagNames:"",tagId:"",tagDesc:"",tagDescs:"",tagUnit:"",tagType:0,tagK:1,objAddr:"0",collectType:void 0,dataType:4,dataFormat:0}}async function y(){var u,c;const{data:s,error:o}=await Ce({type:1});if(!o){const E=[];s.forEach(U=>{U.devicePojoList&&U.devicePojoList.length>0&&U.devicePojoList.forEach(J=>{E.push({label:`${U.chlName}__${J.devName}`,value:`${J.id}_${U.id}`})})}),n.deveicelList=E,n.deveicelList.length>0&&(l.tagDevId=B.devId&&B.chlid?B.devId+"_"+B.chlid:n.deveicelList[0].value,l.devId=Number((u=l.tagDevId)==null?void 0:u.split("_")[0]),l.chlId=Number((c=l.tagDevId)==null?void 0:c.split("_")[1]),l.collectType=void 0,j())}}async function j(){const{data:s,error:o}=await Le({chlId:l.chlId});o||(n.functionList=JSON.parse(s).data,l.collectType=n.functionList[0].FuncCode)}function z(){Object.assign(l,q()),y(),n.collectionPointForm.checkedRows=[],C.value=[]}const{formRef:ee,validate:_,restoreValidation:oe}=Oe();Be(v,()=>{v.value&&(z(),oe())});const $=()=>{v.value=!1};function T(s,o){console.log(s),s==0||s==1||s==2||s==3||s==4||s==7?n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:s==5||s==6||s==8||s==9||s==10||s==12||s==13?n.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],n.collectionPointForm.dataFormatList.find(u=>u.value===l.dataFormat)||(l.dataFormat=n.collectionPointForm.dataFormatList[0].value)}const K=async()=>{var J,re,le;await _();let s=l.tagNames.split(","),o=(J=l.tagDescs)==null?void 0:J.split(","),u=(re=l.tagId)==null?void 0:re.split(","),c=[];delete l.tagNames,delete l.tagDescs,delete l.tagId,s.forEach((fe,r)=>{var we,Te;let ce={...l,tagName:fe,tagDesc:l.tagDesc?l.tagDesc:o[r],tagId:Number(u[r]),objAddr:l.objAddr?+l.objAddr+r:r+"",devId:Number((we=l.tagDevId)==null?void 0:we.split("_")[0]),chlId:Number((Te=l.tagDevId)==null?void 0:Te.split("_")[1])};c.push(ce)});const{data:E,error:U}=await ct(c);U||($(),(le=window.$message)==null||le.success("添加成功"),R("submitted"))},S={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},P={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},A={tagDevId:S,tagName:S,tagDesc:[{trigger:["input","blur"],validator:(s,o)=>!/\$/.test(o),message:"不能含有非法字符"},{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]}],tagK:P,objAddr:S,collectType:P,dataType:P,dataFormat:P},X=st(()=>({add:"批量新增",edit:D("common.edit")}).add),{columns:W,columnChecks:ie,data:H,getData:M,loading:N,mobilePagination:se,searchParams:p,resetSearchParams:Se}=He({apiFn:dt,apiParams:{page:1,pageSize:200,limit:200,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140,render:s=>{var o;return e("span",null,[((o=ge.find(u=>u.value===s.tagType))==null?void 0:o.label)||""])}},{key:"belongingEquipment",title:"所属设备",align:"center",width:140,render:s=>{var o;return e("span",null,[((o=n.collectionPointForm.deveicelList.find(u=>u.id===s.devId))==null?void 0:o.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),pe=()=>{M()},{drawerVisible:ze,operateType:Re,editingData:f,handleAdd:m,handleEdit:F,checkedRowKeys:k,onBatchDeleted:Q,onDeleted:be}=Qe(H,M);async function G(){const{data:s,error:o}=await Ce();o||(console.log("data",s),s.length>0&&(n.collectionPointForm.channelList=s.filter(u=>u.chlType!==1).map(u=>({label:u.chlName,value:u.id,devicePojoList:u.devicePojoList||[]}))))}const de=s=>{var u;p.chlid=s,p.devId=null;let o=(u=n.collectionPointForm.channelList.find(c=>c.value==s))==null?void 0:u.devicePojoList;n.collectionPointForm.deveicelList=o,te(),M()};G();function me(){var s,o;if(k.value=C.value.map(u=>u.id),n.collectionPointForm.channelList.length>0)if(p.chlid)n.collectionPointForm.visible=!0;else{let u=n.collectionPointForm.channelList[0];p.chlid=u.value,n.collectionPointForm.deveicelList=u.devicePojoList,te()}else return(s=window.$message)==null||s.destroyAll(),(o=window.$message)==null||o.warning("暂无通道，请您先创建通道在进行查询"),!1}async function te(){const{data:s,error:o}=await Le({chlId:p.chlid});o||(n.collectionPointForm.functionList=JSON.parse(s).data,n.collectionPointForm.visible=!0,M())}function _e(){n.collectionPointForm.visible=!1}const C=Ue([]),ye=[{title(){return e("div",{class:"flex"},[e("span",{class:"flex-1"},[`已选${C.value.length}个`]),e("span",{class:"c-red cursor-pointer",onClick:h},[w("清空")])])},align:"center",render:s=>{var o;return e("span",null,[s.tagName,w("--"),(o=n.collectionPointForm.channelList.find(u=>u.value==s.chlId))==null?void 0:o.label])}}];function d(s,o,u){console.log(o),o=o.filter(c=>c!=null),p.devId&&(C.value=C.value.filter(c=>c.devId!=p.devId||c.page!=p.page)),p.chlid&&(C.value=C.value.filter(c=>c.chlId!=p.chlid||c.page!=p.page)),C.value.push(...o.filter(c=>c!=null)),C.value=[...new Set(C.value)],C.value.forEach(c=>{c.page=c.page?c.page:p.page})}function i(){var s,o,u,c,E;if(n.collectionPointForm.checkedRows=k.value,l.tagNames="",l.tagDescs="",l.tagId="",k.value.length===0)return(s=window.$message)==null||s.destroyAll(),(o=window.$message)==null||o.warning("请您先选择采集点"),!1;C.value.forEach(U=>{l.tagNames+=U.tagName+",",l.tagDescs+=U.tagDesc+",",l.tagId+=U.id+","}),l.tagName=C.value[0].tagName,l.tagNames=(u=l.tagNames)==null?void 0:u.substring(0,l.tagNames.length-1),l.tagDescs=(c=l.tagDescs)==null?void 0:c.substring(0,l.tagDescs.length-1),l.tagId=(E=l.tagId)==null?void 0:E.substring(0,l.tagId.length-1),n.collectionPointForm.visible=!1}const h=()=>{C.value=[],k.value=[]},b=()=>{k.value=[]},I=()=>({style:{height:"40px"}}),Ke=s=>{p.devId=s,pe()};return(s,o)=>{const u=Ae,c=Ye,E=he,U=V,J=qe,re=Ge,le=he,fe=Ze,r=Je,ce=V,we=$e,Te=Xe,et=We,ut=ke("no-space");return O(),Ne(Ee,null,[e(Te,{show:v.value,"onUpdate:show":o[9]||(o[9]=g=>v.value=g),title:X.value,preset:"card",class:"w-50%"},{footer:a(()=>[e(we,{size:16,justify:"center"},{default:a(()=>[e(ce,{onClick:$,class:"w-100px"},{default:a(()=>[w(x(t(D)("common.cancel")),1)]),_:1}),e(ce,{type:"primary",class:"w-100px",onClick:K},{default:a(()=>[w(x(t(D)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(r,{ref_key:"formRef",ref:ee,model:l,rules:A,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(fe,{responsive:"screen","item-responsive":""},{default:a(()=>[e(c,{span:"24 m:12",label:"所属设备",path:"tagDevId"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择所属设备",value:l.tagDevId,"onUpdate:value":o[0]||(o[0]=g=>l.tagDevId=g),options:n.deveicelList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:a(()=>[e(J,{style:{width:"100%"}},{default:a(()=>[e(E,{value:l.tagName,"onUpdate:value":o[1]||(o[1]=g=>l.tagName=g),readonly:""},null,8,["value"]),e(U,{type:"primary",ghost:"",onClick:me},{default:a(()=>[w(x(n.collectionPointForm.checkedRows.length>1?`+${n.collectionPointForm.checkedRows.length}`:"请选择"),1)]),_:1})]),_:1})]),_:1}),e(c,{span:"24 m:12",label:"测点类型",path:"dataType"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择测点类型",value:l.tagType,"onUpdate:value":o[2]||(o[2]=g=>l.tagType=g),options:t(Y)(t(ge))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:a(()=>[e(re,{clearable:"",value:l.tagK,"onUpdate:value":o[3]||(o[3]=g=>l.tagK=g),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(c,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择转发功能码",value:l.collectType,"onUpdate:value":o[4]||(o[4]=g=>l.collectType=g),options:n.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:a(()=>[e(le,{clearable:"",value:l.objAddr,"onUpdate:value":o[5]||(o[5]=g=>l.objAddr=g),maxlength:"128",placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(c,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择数据类型",value:l.dataType,"onUpdate:value":[o[6]||(o[6]=g=>l.dataType=g),T],options:t(Y)(t(rt))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择数据格式",value:l.dataFormat,"onUpdate:value":o[7]||(o[7]=g=>l.dataFormat=g),options:n.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:a(()=>[e(le,{clearable:"",value:l.tagUnit,"onUpdate:value":o[8]||(o[8]=g=>l.tagUnit=g),maxlength:"12",placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(Te,{show:n.collectionPointForm.visible,"onUpdate:show":o[16]||(o[16]=g=>n.collectionPointForm.visible=g),title:"选择采集点",preset:"card",class:"w-65%",onAfterLeave:b},{footer:a(()=>[e(we,{size:16,justify:"end"},{default:a(()=>[e(ce,{onClick:_e},{default:a(()=>[w(x(t(D)("common.cancel")),1)]),_:1}),e(ce,{type:"primary",onClick:i},{default:a(()=>[w(x(t(D)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(r,{model:n.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(fe,{responsive:"screen","item-responsive":""},{default:a(()=>[e(c,{span:"24 m:12",label:"所属通道"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择所属通道",value:t(p).chlid,"onUpdate:value":o[10]||(o[10]=g=>t(p).chlid=g),options:n.collectionPointForm.channelList,onUpdateValue:de},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"所属设备"},{default:a(()=>[e(u,{filterable:"",clearable:"",placeholder:"请选择所属设备","label-field":"devName","value-field":"id",value:t(p).devId,"onUpdate:value":[o[11]||(o[11]=g=>t(p).devId=g),Ke],options:n.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点类型"},{default:a(()=>[e(u,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(p).tagType,"onUpdate:value":o[12]||(o[12]=g=>t(p).tagType=g),options:t(Y)(t(ge))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点功能码"},{default:a(()=>[e(u,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:t(p).collectType,"onUpdate:value":o[13]||(o[13]=g=>t(p).collectType=g),options:n.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点名称"},{default:a(()=>[ae(e(le,{clearable:"",value:t(p).fuzzy,"onUpdate:value":o[14]||(o[14]=g=>t(p).fuzzy=g),placeholder:"请输入测点名称"},null,8,["value"]),[[ut]])]),_:1}),e(c,{span:"24 m:12",label:" "},{default:a(()=>[e(ce,{onClick:pe},{default:a(()=>[w(x(t(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),Pe("div",Ot,[e(et,{"checked-row-keys":t(k),"onUpdate:checkedRowKeys":[o[15]||(o[15]=g=>Fe(k)?k.value=g:null),d],columns:t(W),data:t(H),size:"small","max-height":400,loading:t(N),remote:"","row-key":g=>g.id,pagination:t(se),class:"flex-1 w-80%","row-props":I,"scroll-x":t(W).reduce((g,pt)=>g+pt.width,0)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination","scroll-x"]),e(et,{columns:ye,data:C.value,size:"small","max-height":440,loading:t(N),remote:"","row-key":g=>g.id,class:"w-20% ml-10px","row-props":I},null,8,["data","loading","row-key"])])]),_:1},8,["show"])],64)}}}),Et=je({__name:"batchEdit_model",props:ve({checkedRowKeys:{type:Array,default:[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ve(["submitted"],["update:visible"]),setup(L,{emit:Z}){const n=L,v=Ve(L,"visible");Be(()=>v.value,$=>{y.value={editType:0,editMode:0,startV:"0",step:"1",tagK:0}});const B=Z,{formRef:R,validate:l,restoreValidation:q}=Oe(),y=Ue({editType:0,editMode:0,startV:"0",step:"1",tagK:0}),j=async()=>{var $,T;if(await l(),y.value.editType==0){console.log(n.checkedRowKeys);let K=[];n.checkedRowKeys.forEach((A,X)=>{K.push({id:A,objAddr:+y.value.startV+X*+y.value.step+""})});const{data:S,error:P}=await Me(K);P||(v.value=!1,($=window.$message)==null||$.success("批量修改成功"),B("submitted"))}else if(y.value.editType==1){let K=[];n.checkedRowKeys.forEach((A,X)=>{K.push({id:A,tagK:y.value.tagK})});const{data:S,error:P}=await Me(K);P||(v.value=!1,(T=window.$message)==null||T.success("批量修改成功"),B("submitted"))}},z={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},ee={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},_={editType:z,editMode:z,startV:ee,step:ee},oe=Ue(!1);return($,T)=>{const K=Ae,S=Ye,P=he,A=Ge,X=Ze,W=Je,ie=V,H=$e,M=Xe;return O(),Ne(Ee,null,[e(M,{show:v.value,"onUpdate:show":T[6]||(T[6]=N=>v.value=N),title:"批量修改",preset:"card",class:"w-40%"},{footer:a(()=>[e(H,{size:16,justify:"center"},{default:a(()=>[e(ie,{onClick:T[5]||(T[5]=N=>v.value=!1),class:"w-100px"},{default:a(()=>[w(x($.$t("common.cancel")),1)]),_:1}),e(ie,{type:"primary",class:"w-100px",onClick:j},{default:a(()=>[w(x($.$t("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(W,{ref_key:"formRef",ref:R,"label-width":120,"label-placement":"left",model:y.value,rules:_},{default:a(()=>[e(X,{responsive:"screen","item-responsive":""},{default:a(()=>[e(S,{span:"24 m:12",label:"修改类型",path:"editType"},{default:a(()=>[e(K,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editType,"onUpdate:value":T[0]||(T[0]=N=>y.value.editType=N),options:t(Y)(t(tt)({0:"寄存器地址",1:"系数K"}))},null,8,["value","options"])]),_:1}),y.value.editType==0?(O(),ne(S,{key:0,span:"24 m:12",label:"修改步长",path:"editMode"},{default:a(()=>[e(K,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editMode,"onUpdate:value":T[1]||(T[1]=N=>y.value.editMode=N),options:t(Y)(t(tt)({0:"步长"}))},null,8,["value","options"])]),_:1})):De("",!0),y.value.editType==0?(O(),ne(S,{key:1,span:"24 m:12",label:"起始值",path:"startV"},{default:a(()=>[e(P,{clearable:"",value:y.value.startV,"onUpdate:value":T[2]||(T[2]=N=>y.value.startV=N),placeholder:"请输入起始值"},null,8,["value"])]),_:1})):De("",!0),y.value.editType==0?(O(),ne(S,{key:2,span:"24 m:12",label:"步长",path:"step"},{default:a(()=>[e(P,{clearable:"",value:y.value.step,"onUpdate:value":T[3]||(T[3]=N=>y.value.step=N),placeholder:"请输入步长"},null,8,["value"])]),_:1})):De("",!0),y.value.editType==1?(O(),ne(S,{key:3,span:"24 m:12",label:"修改的值",path:"step"},{default:a(()=>[e(A,{clearable:"",value:y.value.tagK,"onUpdate:value":T[4]||(T[4]=N=>y.value.tagK=N),placeholder:"请输入修改的值"},null,8,["value"])]),_:1})):De("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(M,{show:oe.value,"onUpdate:show":T[7]||(T[7]=N=>oe.value=N),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),qt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function it(L){return typeof L=="function"||Object.prototype.toString.call(L)==="[object Object]"&&!kt(L)}const ol=je({name:"configsetting_forwardingservice_forwardingpointmanagement",__name:"index",setup(L){const Z=_t(),n=yt(),v=Ie({channelList:[],channelAndDevObj:{},deveicelList:[],transFunctionOptions:[],addMultipeModelVisible:!1});async function B(){var F;const{data:f,error:m}=await Ce({type:1});if(!m){if(f==0)return(F=window.$message)==null?void 0:F.warning("暂无转发通道，请先添加通道");v.channelList=f||[],v.channelList.forEach(Q=>{v.channelAndDevObj[Q.id]=Q.devicePojoList||[]}),_.chlid=_.chlid||v.channelList[0].id,v.deveicelList=v.channelAndDevObj[_.chlid]||[];const k=n.currentRoute.value.query.deviceId;_.devId=Number(k)*1||v.deveicelList[0].id,R(),j()}}async function R(){const{data:f,error:m}=await Le({chlId:_.chlid});m||(v.transFunctionOptions=JSON.parse(f).data)}const{columns:l,columnChecks:q,data:y,getData:j,loading:z,mobilePagination:ee,searchParams:_,resetSearchParams:oe}=He({apiFn:At,apiParams:{page:1,pageSize:200,limit:200,chlid:null,devId:null,tagType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"测点ID",align:"center",width:80},{key:"tagName",title:"测点名称",align:"center",minWidth:100},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",minWidth:140},{key:"tagType",title:"测点类型",align:"center",width:140,render:f=>e("span",null,[xt[f.tagType]||""])},{key:"devName",title:"所属设备",align:"center",width:140,render:f=>{var m,F;return e("span",null,[((F=(m=v.deveicelList)==null?void 0:m.find(k=>k.id===f.devId))==null?void 0:F.devName)||""])}},{key:"collectname",title:"转发功能码",align:"center",width:140,render:f=>{var m;return e("span",null,[(m=f.collectname)==null?void 0:m.replace(/\(.*?\)/g,"")])}},{key:"dataType",title:"数据类型",align:"center",width:140,render:f=>e("span",null,[f.dataType?lt[Number(f.dataType)]:lt[0]])},{key:"dataFormat",title:"数据格式",align:"center",width:140,render:f=>e("span",null,[f.dataType?at[Number(f.dataFormat)]:at[0]])},{key:"tagK",title:"系数K",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140},{key:"operate",title:D("common.operate"),align:"center",width:140,fixed:"right",render:f=>{let m;return e("div",{class:"flex-center gap-8px"},[ae(e(V,{type:"primary",ghost:!0,size:"small",onClick:()=>M(f.id)},it(m=D("common.edit"))?m:{default:()=>[m]}),[[ke("no-auth"),"transTag:update"]]),ae(e(nt,{onPositiveClick:()=>H(f.id)},{default:()=>D("common.confirmDelete"),trigger:()=>{let F;return e(V,{type:"error",ghost:!0,size:"small"},it(F=D("common.delete"))?F:{default:()=>[F]})}}),[[ke("no-auth"),"transTag:delete"]])])}}]});wt(()=>{const f=n.currentRoute.value.query.channelId;_.chlid=Number(f)*1||null,B()});const{drawerVisible:$,operateType:T,editingData:K,handleAdd:S,handleEdit:P,checkedRowKeys:A,onBatchDeleted:X,onDeleted:W}=Qe(y,j),ie=()=>{j()},H=async f=>{const{data:m,error:F}=await ot({ids:f});F||W()},M=f=>{P(f)},N=f=>{f===""&&j()},se=Ue(!1),p=()=>{se.value=!0};function Se(f,m){var F;f&&(_.chlid=Number(f),_.devId=null,_.collectType=void 0,v.deveicelList=v.channelAndDevObj[f],_.devId=v.deveicelList[0].id,(!v.deveicelList||v.deveicelList.length==0)&&((F=window.$message)==null||F.warning("该通道下无设备! 请选择其他通道")),R(),j())}function pe(){v.addMultipeModelVisible=!0}const ze=async()=>{const f=A.value.join(","),{data:m,error:F}=await ot({ids:f});F||W(),A.value=[]},Re=()=>{var k;if(!_.devId){(k=window.$message)==null||k.warning("请选择导出设备");return}const f=Ft(),m=Date.now().toString(),F=It(`${f}${m}${"devId="+_.devId}`);Lt({url:`${Nt}/transTag/exports.do`,method:"post",params:{devId:_.devId},responseType:"blob",headers:{token:Dt(),"X-Nonce":f,"X-Timestamp":m,"X-Signature":F}}).then(async Q=>{if(Q.data){const be=window.URL.createObjectURL(new Blob([Q.data])),G=document.createElement("a");G.href=be,G.setAttribute("download",new Date().getTime()+".xls"),document.body.appendChild(G),G.click()}})};return(f,m)=>{const F=jt,k=Ae,Q=he,be=Ut,G=qe,de=$e,me=Pt,te=Ct,_e=Kt,C=vt,ye=gt,d=ft,i=mt,h=We,b=ke("no-auth");return O(),Ne("div",qt,[e(me,{bordered:!1,size:"small"},{default:a(()=>[e(de,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:a(()=>[e(G,null,{default:a(()=>[e(F,null,{default:a(()=>[w("所属通道")]),_:1}),e(k,{filterable:"",placeholder:"请选择通道",value:t(_).chlid,"onUpdate:value":m[0]||(m[0]=I=>t(_).chlid=I),"label-field":"chlName","value-field":"id",options:v.channelList,onUpdateValue:Se},null,8,["value","options"]),e(F,null,{default:a(()=>[w("所属设备")]),_:1}),e(k,{filterable:"",clearable:"",placeholder:"请选择设备",value:t(_).devId,"onUpdate:value":[m[1]||(m[1]=I=>t(_).devId=I),t(j)],"label-field":"devName","value-field":"id",options:v.deveicelList},null,8,["value","options","onUpdate:value"]),e(F,null,{default:a(()=>[w("测点类型")]),_:1}),e(k,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(_).tagType,"onUpdate:value":[m[2]||(m[2]=I=>t(_).tagType=I),t(j)],style:{width:"80%"},options:t(Y)(t(ge))},null,8,["value","options","onUpdate:value"]),e(Q,{clearable:"",value:t(_).fuzzy,"onUpdate:value":[m[3]||(m[3]=I=>t(_).fuzzy=I),N],placeholder:"请输入测点名称或描述",style:{width:"100%"},onKeyup:Tt(t(j),["enter"])},null,8,["value","onKeyup"]),e(t(V),{type:"primary",ghost:"",onClick:ie},{icon:a(()=>[e(be,{class:ue(["text-icon",{"animate-spin":t(z)}])},null,8,["class"])]),default:a(()=>[w(" "+x(t(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(me,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[e(de,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"})]),"header-extra":a(()=>[e(de,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[e(t(V),{onClick:t(S),size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(te,{class:ue(["text-icon",{"animate-spin":t(z)}])},null,8,["class"])]),default:a(()=>[w(" "+x(t(D)("common.add")),1)]),_:1},8,["onClick"]),ae((O(),ne(t(V),{onClick:pe,size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(te,{class:ue(["text-icon",{"animate-spin":t(z)}])},null,8,["class"])]),default:a(()=>[w(" "+x("批量新增"))]),_:1})),[[b,"transTag:insert"]]),ae((O(),ne(t(V),{onClick:p,size:"small",ghost:"",type:"primary",disabled:!t(A).length},{icon:a(()=>[e(_e,{class:ue(["text-icon",{"animate-spin":t(z)}])},null,8,["class"])]),default:a(()=>[w(" "+x("批量修改"))]),_:1},8,["disabled"])),[[b,"transTag:update"]]),ae((O(),ne(t(nt),{onPositiveClick:ze},{trigger:a(()=>[e(t(V),{size:"small",ghost:"",type:"error",disabled:t(A).length==0},{icon:a(()=>[e(C,{class:ue(["text-icon",{"animate-spin":t(z)}])},null,8,["class"])]),default:a(()=>[w(" "+x(t(D)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:a(()=>[w(" 确认删除选中的项吗？ ")]),_:1})),[[b,"transTag:delete"]]),ae((O(),ne(t(V),{onClick:Re,size:"small"},{icon:a(()=>[e(ye,{class:ue(["text-icon",{"animate-spin":t(z)}])},null,8,["class"])]),default:a(()=>[w(" "+x(t(D)("common.export")),1)]),_:1})),[[b,"transTag:export"]]),e(t(V),{onClick:ie,size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(d,{class:ue(["text-icon",{"animate-spin":t(z)}])},null,8,["class"])]),_:1}),e(i,{columns:t(q),"onUpdate:columns":m[4]||(m[4]=I=>Fe(q)?q.value=I:null)},null,8,["columns"])]),_:1})]),default:a(()=>[e(h,{"checked-row-keys":t(A),"onUpdate:checkedRowKeys":m[5]||(m[5]=I=>Fe(A)?A.value=I:null),columns:t(l),data:t(y),size:"small",class:"sm:h-full","flex-height":!t(Z).isMobile,loading:t(z),remote:"","row-key":I=>I.id,pagination:t(ee)},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Vt,{visible:t($),"onUpdate:visible":m[6]||(m[6]=I=>Fe($)?$.value=I:null),onSubmitted:t(j),"operate-type":t(T),"row-data":t(K)},null,8,["visible","onSubmitted","operate-type","row-data"]),e(Bt,{visible:v.addMultipeModelVisible,"onUpdate:visible":m[7]||(m[7]=I=>v.addMultipeModelVisible=I),devId:t(_).devId,chlid:t(_).chlid,onSubmitted:t(j)},null,8,["visible","devId","chlid","onSubmitted"]),e(Et,{visible:se.value,"onUpdate:visible":m[8]||(m[8]=I=>se.value=I),onSubmitted:t(j),checkedRowKeys:t(A)},null,8,["visible","onSubmitted","checkedRowKeys"])]),_:1})])}}});export{ol as default};
