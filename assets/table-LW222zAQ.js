import{T as L,cu as j,r as A,j as b,b as x,c3 as $,a3 as I,$ as _,ae as H,l as U,cv as Y}from"./index-CPo--K2z.js";function G(o){const{loading:d,startLoading:w,endLoading:l}=L(),{bool:v,setBool:m}=j(),{apiFn:z,apiParams:u,transformer:S,immediate:g=!1,getColumnChecks:k,getColumns:D}=o,s=A({...u}),h=b(o.columns()),P=b([]),f=b(k(o.columns())),N=x(()=>D(h.value,f.value));function C(){h.value=o.columns();const i=new Map(f.value.map(e=>[e.key,e.checked])),r=k(h.value);f.value=r.map(e=>({...e,checked:i.get(e.key)??e.checked}))}async function y(i){var a;w();const r=O(i?Object.assign(s,i):s),e=await z(r),t=S(e);P.value=t.data,m(t.data.length===0),await((a=o.onFetched)==null?void 0:a.call(o,t)),l()}function O(i){const r={};return Object.entries(i).forEach(([e,t])=>{t!=null&&(r[e]=t)}),r}function n(i){Object.assign(s,i)}function T(){Object.assign(s,u),y()}return g&&y(),{loading:d,empty:v,data:P,columns:N,columnChecks:f,reloadColumns:C,getData:y,searchParams:s,updateSearchParams:n,resetSearchParams:T}}function W(o){const d=$(),w=I(),l=x(()=>w.isMobile),{apiFn:v,apiParams:m,immediate:z,showTotal:u=!0}=o,S="__selection__",g="__expand__",{loading:k,empty:D,data:s,columns:h,columnChecks:P,reloadColumns:f,getData:N,searchParams:C,updateSearchParams:y,resetSearchParams:O}=G({apiFn:v,apiParams:m,columns:o.columns,transformer:e=>{let t=C;if(e.error)return{data:[],pageNum:t.page,pageSize:t.pageSize,total:0};e.hasOwnProperty("total")||(e.total=0);const{data:a=[],pageNum:p=1,pageSize:c=20,total:M=0}=e||{},F=(a instanceof Array?a:a?a.hasOwnProperty("list")?a.list:a.data||[]:[]).map((B,K)=>({...B,index:(p-1)*c+K+1}));return e.total=a instanceof Array?Object.prototype.hasOwnProperty.call(a,"total")?Number(a.total):Number(M):Number(a.total),{data:F,pageNum:t.page,pageSize:t.pageSize,total:Number.isNaN(e.total)?0:e.total}},getColumnChecks:e=>{const t=[];return e.forEach(a=>{E(a)?t.push({key:a.key,title:a.title,checked:!0}):a.type==="selection"?t.push({key:S,title:_("common.check"),checked:!0}):a.type==="expand"&&t.push({key:g,title:_("common.expandColumn"),checked:!0})}),t},getColumns:(e,t)=>{const a=new Map;return e.forEach(c=>{E(c)?a.set(c.key,c):c.type==="selection"?a.set(S,c):c.type==="expand"&&a.set(g,c)}),t.filter(c=>c.checked).map(c=>a.get(c.key))},onFetched:async e=>{const{pageNum:t,pageSize:a,total:p}=e;r({page:t,pageSize:a,itemCount:p})},immediate:z}),n=A({page:1,pageSize:20,itemCount:0,showSizePicker:!0,pageSizes:[20,50,100,200],onUpdatePage:async e=>{n.page=e,y({page:e,pageSize:n.pageSize||20,limit:n.pageSize||20,_t:new Date().getTime()}),await T()},onUpdatePageSize:async e=>{n.pageSize=e,n.page=1,y({page:n.page,pageSize:e,limit:e,_t:new Date().getTime()}),await T()},...u?{prefix:e=>_("datatable.itemCount",{total:e.itemCount})}:{}}),T=async()=>{const e=n.page,t=n.pageSize;await N();const a=n.itemCount,p=Math.ceil(a/t);e>p&&e>1?(n.page=p,C.page=p,await N()):s.value.length===0&&e>1&&(n.page=e-1,C.page=e-1,await N())},i=x(()=>({...n,pageSlot:l.value?3:9,prefix:!l.value&&u?n.prefix:void 0}));function r(e){Object.assign(n,e)}return d.run(()=>{H(()=>w.locale,()=>{f()})}),U(()=>{d.stop()}),{loading:k,empty:D,data:s,columns:h,columnChecks:P,reloadColumns:f,pagination:n,mobilePagination:i,updatePagination:r,getData:T,searchParams:C,updateSearchParams:y,resetSearchParams:O}}function X(o,d){const{bool:w,setTrue:l,setFalse:v}=j(),m=b("add");function z(){m.value="add",l()}const u=b(null);function S(s){m.value="edit";const h=o.value.find(P=>P.id===s)||null;u.value=Y(h),l()}const g=b([]);async function k(){var s;(s=window.$message)==null||s.success(_("common.deleteSuccess")),g.value=[],await d()}async function D(){var s;(s=window.$message)==null||s.success(_("common.deleteSuccess")),await d()}return{drawerVisible:w,openDrawer:l,closeDrawer:v,operateType:m,handleAdd:z,editingData:u,handleEdit:S,checkedRowKeys:g,onBatchDeleted:k,onDeleted:D}}function E(o){return!!o.key}export{X as a,W as u};
