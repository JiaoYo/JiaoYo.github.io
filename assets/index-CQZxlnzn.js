import{_ as se}from"./refresh-C4dS7lL3.js";import{l as ie}from"./lodash-CCiSDTQ9.js";import{d as W,q as re,a0 as j,j as T,v as ce,s as ue,L as I,o as C,c as z,w as s,g as l,M,i,$ as m,V as B,h as S,t as P,f as pe,e as q,aj as me,O as de,N as fe,ax as _e,A as ge,Y as ve,B as A,E as Y,D as he,aa as J,r as E,an as O,br as ye,ae as xe,av as be}from"./index-Q9iUVXST.js";import{f as ke,a as Te,b as Ce,c as Se}from"./alarm-Ci0c_26W.js";import{_ as De,a as we}from"./arrow-open-up-8LSG07-6.js";import{_ as Ne}from"./round-search-JnLgWGnX.js";import{_ as ze}from"./round-refresh-BNnTboqd.js";import{u as F}from"./usePageData-CS6lVTn3.js";import{C as Ae,a as $e}from"./common-C1lCmQ73.js";import{f as Le}from"./audit-events-25HshTVA.js";import{a as Re,T as Ve}from"./basicconf-kuEqrOwl.js";import{_ as He}from"./FormItemGridItem-DooIbcuJ.js";import{_ as Ie}from"./DatePicker-Bo2p23Ga.js";import{_ as Me}from"./Grid-y0HfPjHq.js";import{_ as G}from"./Popconfirm-PA_LwYOO.js";import{_ as Pe}from"./DataTable-BILuSidq.js";import"./TimePicker-dHYDusz9.js";import"./defineProperty-BwfsO5-x.js";import"./Forward-Dutqe5AL.js";const Ue=W({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:re(["reset","search"],["update:model"]),setup(h,{emit:$}){const y=$,d=j(),x=T(!1),{formRef:r,restoreValidation:f}=ce(),n=ue(h,"model"),{pageData:g,getData:L,nextPage:_}=F(Le),w=async o=>{const t=o.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&g.data.length<g.total&&_()};L();const{pageData:D,getData:R,nextPage:v}=F(ke),V=async o=>{const t=o.currentTarget;t.scrollTop+t.offsetHeight>=t.scrollHeight&&D.data.length<D.total&&v()};R();async function H(o,t){o?(n.value.startTime=o[0],n.value.endTime=o[1]):(n.value.startTime=null,n.value.endTime=null),y("search")}function N(){n.value.fuzzy=void 0,y("search")}async function e(){await f(),n.value.timeRange=null,n.value.atype=null,n.value.alevel=null,n.value.alatype=null,n.value.apolicy=null,n.value.startTime=null,n.value.endTime=null,_e(()=>{y("search")})}async function a(){y("search")}return(o,t)=>{const u=ge,p=He,b=ve,k=ze,U=A,Q=Ne,X=De,Z=we,ee=Y,ae=Ie,te=Me,le=he,ne=J,oe=I("no-space");return C(),z(ne,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[l(le,{ref_key:"formRef",ref:r,model:n.value,"label-placement":"left","label-width":i(d).locale=="en-US"?120:80,"show-feedback":!1,onKeyup:fe(a,["enter"])},{default:s(()=>[l(te,{responsive:"screen","item-responsive":""},{default:s(()=>[l(p,{span:"24 s:12 m:6",label:"审计名称",path:"fuzzy",class:"pr-24px"},{default:s(()=>[M(l(u,{autofocus:"",value:n.value.fuzzy,"onUpdate:value":t[0]||(t[0]=c=>n.value.fuzzy=c),placeholder:"请输入审计名称",clearable:"",onClear:N},null,8,["value"]),[[oe]])]),_:1}),l(p,{span:"24 s:12 m:6",label:i(m)("page.manage.alarm.level"),path:"alevel",class:"pr-24px"},{default:s(()=>[l(b,{filterable:"",clearable:"",placeholder:i(m)("page.manage.alarm.form.level"),value:n.value.alevel,"onUpdate:value":[t[1]||(t[1]=c=>n.value.alevel=c),a],options:i(B)(i(Re))},null,8,["placeholder","value","options"])]),_:1},8,["label"]),l(p,{span:"24 s:12 m:6",label:"告警状态",path:"alatype",class:"pr-24px"},{default:s(()=>[l(b,{filterable:"",clearable:"",placeholder:i(m)("page.manage.alarm.form.status"),value:n.value.alatype,"onUpdate:value":[t[2]||(t[2]=c=>n.value.alatype=c),a],options:i(B)(i(Ae))},null,8,["placeholder","value","options"])]),_:1}),l(p,{span:"24 s:12 m:6",class:"pr-24px"},{default:s(()=>[l(ee,{class:"w-full flex items-center"},{default:s(()=>[l(U,{onClick:e},{icon:s(()=>[l(k,{class:"text-icon"})]),default:s(()=>[S(" "+P(i(m)("common.reset")),1)]),_:1}),l(U,{type:"primary",ghost:"",onClick:a},{icon:s(()=>[l(Q,{class:"text-icon"})]),default:s(()=>[S(" "+P(i(m)("common.search")),1)]),_:1}),pe("div",{class:"cursor-pointer",title:"精准查询",onClick:t[3]||(t[3]=c=>x.value=!x.value)},[x.value?(C(),z(X,{key:0,class:"text-icon"})):(C(),z(Z,{key:1,class:"text-icon"}))])]),_:1})]),_:1}),x.value?(C(),q(me,{key:0},[l(p,{span:"24 s:12 m:6",label:"审计类型",path:"atype",class:"pr-24px mt-20px"},{default:s(()=>[l(b,{value:n.value.atype,"onUpdate:value":[t[4]||(t[4]=c=>n.value.atype=c),a],placeholder:"请选择审计类型",clearable:"",filterable:"","value-field":"id","label-field":"atypename",options:i(g).data,"reset-menu-on-options-change":!1,onScroll:w},null,8,["value","options"])]),_:1}),l(p,{span:"24 s:12 m:6",label:"告警策略",path:"apolicy",class:"pr-24px mt-20px"},{default:s(()=>[l(b,{value:n.value.apolicy,"onUpdate:value":[t[5]||(t[5]=c=>n.value.apolicy=c),a],placeholder:"请选择告警策略",clearable:"",filterable:"","value-field":"id","label-field":"pname",options:i(D).data,"reset-menu-on-options-change":!1,onScroll:V},null,8,["value","options"])]),_:1}),l(p,{span:"24 s:24 m:8",label:"时间",path:"timeRange",class:"pr-24px mt-20px"},{default:s(()=>[l(ae,{clearable:"",value:n.value.timeRange,"onUpdate:value":t[6]||(t[6]=c=>n.value.timeRange=c),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",style:{width:"100%"},"onUpdate:formattedValue":H},null,8,["value"])]),_:1})],64)):de("",!0)]),_:1})]),_:1},8,["model","label-width"])]),_:1})}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function K(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!xe(h)}const Ee=W({name:"platformalarm_alarm",__name:"index",setup(h){const $=j(),y=T(window.innerHeight-395),d=E({limit:20,alatype:void 0,aname:void 0,pageId:void 0,alevel:void 0,atype:void 0,apolicy:void 0,startTime:void 0,endTime:void 0,_t:new Date().getTime()}),x=[{type:"selection",align:"center",width:48,fixed:"left"},{key:"aname",title:"审计名称",align:"center",minWidth:120,ellipsis:!0},{key:"alevel",title:"事件级别",align:"center",width:100,render:e=>{(e.alevel===void 0||e.alevel===null)&&(e.alevel=0);const a={0:"#8e9dff",1:"#5da8ff",2:"#fedc69",3:"#ff9874",4:"#ff0000"},o=m(Ve[e.alevel]);let t={color:a[e.alevel],textColor:"#ffffff",borderColor:a[e.alevel]};return l(O,{size:"small",color:t},K(o)?o:{default:()=>[o]})}},{key:"pname",title:"审计类型",align:"center",minWidth:120},{key:"pname1",title:"告警策略",align:"center",minWidth:120},{key:"etol",title:"事件总数",align:"center",width:120},{key:"grtime",title:"产生时间",align:"center",width:160},{key:"dbtime",title:"更新时间",align:"center",width:160},{key:"alatype",title:m("page.manage.alarm.status"),align:"center",minWidth:120,render:e=>{e.alatype!==1&&(e.alatype=0);const a={0:"error",1:"success"},o=m($e[e==null?void 0:e.alatype]);return l(O,{size:"small",type:a[e==null?void 0:e.alatype]},K(o)?o:{default:()=>[o]})}},{key:"operate",title:m("common.operate"),align:"center",width:130,fixed:"right",render:e=>e.alatype===0&&l("div",{class:"flex-center gap-8px"},[l(G,{onPositiveClick:()=>N([e.id])},{default:()=>"确定要确认改数据吗？",trigger:()=>M(l(A,{type:"error",ghost:!0,size:"small"},{default:()=>[S("确认")]}),[[I("no-auth"),"audit.alarm.update"]])})])}],r=T([]),f=T(!1),n=async(e=!1)=>{if(!f.value)f.value=!0;else return;f.value=!0;const{data:a,error:o}=await Ce(d);o||(e?r.value=[...r.value,...a]:r.value=a,f.value=!1)};n();const g=T(!0),L=()=>{r.value=[],d.pageId=void 0,(a=>Object.keys(a).filter(u=>u!=="limit"&&u!=="_t").some(u=>a[u]!==void 0&&a[u]!==""&&a[u]!==null))(d)?g.value=!1:(g.value=!0,w()),n()},_=E({page:1,pageCount:1,pageSize:20,total:0,prefix({startIndex:e,endIndex:a,page:o,pageSize:t,pageCount:u,itemCount:p}){return`已加载${r.value.length}条`+(r.value.length?g.value?` 共计 ${r.value.length>0?p??0:0} 条`:r.value.length>=d.limit?"  预计还有更多":"":"")}});async function w(){const{data:e,error:a}=await Se();a||(_.pageCount=20,_.total=Number(e),_.itemCount=Number(e))}w();function D(e){var a;e.target.scrollTop+e.target.offsetHeight==e.target.scrollHeight&&_.total>((a=r.value)==null?void 0:a.length)&&R()}const R=ie.debounce(()=>{var e;((e=r.value)==null?void 0:e.length)<_.total&&(d.pageId=r.value[r.value.length-1].id,n(!0))},300),v=T([]),V=e=>{v.value=e},H=()=>{N(v.value),v.value=[]},N=async e=>{var a,o;await Te(e),r.value.forEach(t=>{e.includes(t.id)&&(t.alatype=1)}),(a=window.$message)==null||a.destroyAll(),(o=window.$message)==null||o.success("确认成功")};return(e,a)=>{const o=se,t=Y,u=Pe,p=J,b=I("no-auth");return C(),q("div",Be,[l(Ue,{model:d,"onUpdate:model":a[0]||(a[0]=k=>d=k),onSearch:L},null,8,["model"]),l(p,{title:"审计告警",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[l(t,null,{default:s(()=>[l(i(G),{onPositiveClick:H},{trigger:s(()=>[M((C(),z(i(A),{size:"small",ghost:"",type:"primary",disabled:v.value.length==0},{default:s(()=>[S(" 批量确认 ")]),_:1},8,["disabled"])),[[b,"audit.alarm.update"]])]),default:s(()=>[S(" 确定要确认选中的数据吗？ ")]),_:1}),l(i(A),{size:"small",onClick:a[1]||(a[1]=k=>n())},{icon:s(()=>[l(o,{class:ye(["text-icon",{"animate-spin":f.value}])},null,8,["class"])]),default:s(()=>[S(" "+P(i(m)("common.refresh")),1)]),_:1})]),_:1})]),default:s(()=>[l(u,{columns:x,"checked-row-keys":v.value,data:r.value,onUpdateCheckedRowKeys:V,size:"small","flex-height":!i($).isMobile,"scroll-x":702,loading:f.value,remote:"","row-key":k=>k.id,pagination:_,class:"sm:h-full",onScroll:D,"max-height":y.value,"virtual-scroll":""},null,8,["checked-row-keys","data","flex-height","loading","row-key","pagination","max-height"])]),_:1})])}}}),ia=be(Ee,[["__scopeId","data-v-2bdb64c8"]]);export{ia as default};
