import{_ as _e}from"./round-add-BomLsZ_W.js";import{d as Z,at as J,q as Q,v as se,s as re,a as ve,av as ae,bZ as ie,ef as ge,eg as ye,aw as X,c as I,o as x,w as t,f as e,G as ne,z as A,A as ce,h as o,az as de,C as H,N as oe,B as z,g as T,t as w,$ as F,aE as be,cs as ue,aH as ee,aN as he,r as G,eh as we,y as K,bh as xe,D as R,e as v,b as V,T as ke,F as pe,cJ as Se,aT as Ce,aX as je,bj as Te,ei as De,ej as Pe,U as me,b4 as ze,M as Ne,i as Ue,aO as Y,cO as Ie,ay as $e,ek as Le,el as Me,aU as Be}from"./index-BhBp_qK9.js";import{u as Fe,a as Re}from"./table-txCoW33S.js";import{u as te}from"./usePageData-DDI8WLoO.js";import{_ as Ee,a as Oe}from"./text-C6iqvgHl.js";import{N as fe}from"./Popconfirm-M-SYUm8J.js";import{_ as qe}from"./round-search-B9RiPIED.js";import{_ as He}from"./Grid-CO09elz5.js";import{_ as Ve}from"./FormItemGridItem-UGN3dIqT.js";const Ae=Z({name:"OperateDrawer",__name:"operate-drawer",props:J({operateType:{},rowData:{},pid:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(S,{emit:M}){const i=Q(),N=M,c=S,n=se(y());function y(){return{id:"",content1:"",content2:"",content3:"",content4:"",content5:"",pid:null}}const f={pid:{type:"number",required:!0,message:"请选择项目",trigger:"blur"},content1:{required:!0,message:"请输入前期准备阶段描述",trigger:"blur"},content2:{required:!0,message:"请输入遇到问题及对项目的影响",trigger:"blur"},content3:{required:!0,message:"请输入经验教训与改进方案或措施"}},{pageData:m,getData:$,nextPage:U}=te(ue),b=async l=>{const a=l.currentTarget,r=a.scrollTop;a.scrollTop+a.offsetHeight>=a.scrollHeight&&m.data.length<m.total&&(await U(),await ee(),setTimeout(()=>{a.scrollTop=r}))},D=async l=>{l?n.pid=l:n.value.pid=null},B=async()=>{var l,a;if(await $({fuzzy:(l=i.userInfo)==null?void 0:l.pname,page:1}),m.data.length==0)return(a=window.$message)==null?void 0:a.warning("没有项目")},_=()=>{$({page:1})};async function s(){Object.assign(n,y()),await B(),c.pid&&(m.data.forEach(l=>{l.id==c.pid&&(l.disabled=!0)}),n.pid=c.pid),c.operateType==="edit"&&c.rowData&&Object.assign(n,c.rowData)}const{formRef:k,validate:h,restoreValidation:L}=re(),E=ve(()=>({add:"新增项目总结",edit:"修改项目总结"})[c.operateType]),C=ae(S,"visible"),p=()=>{C.value=!1},d=ie.debounce(async()=>{var l,a;if(await h(),c.operateType==="edit"){const{data:r,error:u}=await ge([{...n}]);u||((l=window.$message)==null||l.success("修改成功"),N("submitted"),p())}else{const{data:r,error:u}=await ye([{pid:n.pid,content1:n.content1,content2:n.content2,content3:n.content3,content4:n.content4,content5:n.content5}]);u||((a=window.$message)==null||a.success("添加成功"),N("submitted"),p())}},1e3,{leading:!0,trailing:!1});return X(C,()=>{C.value&&(s(),setTimeout(()=>{const l=document.querySelector(".n-scrollbar-content");l==null||l.scrollTo(0,0)},300),L())}),(l,a)=>{const r=ce,u=ne,j=oe,O=be;return x(),I(O,{show:C.value,"onUpdate:show":a[6]||(a[6]=g=>C.value=g),title:E.value,preset:"card",class:"w-570px"},{footer:t(()=>[e(j,{justify:"end"},{default:t(()=>[e(o(z),{size:"small",class:"mt-16px",onClick:p},{default:t(()=>[T(w(o(F)("common.cancel")),1)]),_:1}),e(o(z),{type:"primary",size:"small",class:"mt-16px",onClick:o(d)},{default:t(()=>[T(w(o(F)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[e(u,{ref_key:"formRef",ref:k,model:n,rules:f},{default:t(()=>[c.operateType==="add"?(x(),I(r,{key:0,label:"项目",path:"pid","label-placement":"left"},{default:t(()=>[e(o(de),{clearable:"",filterable:"",value:n.pid,"onUpdate:value":[a[0]||(a[0]=g=>n.pid=g),D],placeholder:"请选择项目","label-field":"proname","value-field":"id",onClear:_,options:o(m).data,onScroll:b},null,8,["value","options"])]),_:1})):A("",!0),e(r,{label:"前期准备阶段描述",path:"content1"},{default:t(()=>[e(o(H),{clearable:"",type:"textarea",value:n.content1,"onUpdate:value":a[1]||(a[1]=g=>n.content1=g),placeholder:"请输入前期准备阶段描述"},null,8,["value"])]),_:1}),e(r,{label:"遇到问题及对项目的影响",path:"content2"},{default:t(()=>[e(o(H),{clearable:"",type:"textarea",value:n.content2,"onUpdate:value":a[2]||(a[2]=g=>n.content2=g),placeholder:"请输入遇到问题及对项目的影响"},null,8,["value"])]),_:1}),e(r,{label:"经验教训与改进方案或措施",path:"content3"},{default:t(()=>[e(o(H),{clearable:"",type:"textarea",value:n.content3,"onUpdate:value":a[3]||(a[3]=g=>n.content3=g),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(r,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{default:t(()=>[e(o(H),{clearable:"",type:"textarea",value:n.content4,"onUpdate:value":a[4]||(a[4]=g=>n.content4=g),placeholder:"请输入经验教训与改进方案或措施"},null,8,["value"])]),_:1}),e(r,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{default:t(()=>[e(o(H),{clearable:"",type:"textarea",value:n.content5,"onUpdate:value":a[5]||(a[5]=g=>n.content5=g),placeholder:"请输入此次项目对你帮助最大的人，具体描述一下对你的帮助"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ke={class:"mt-4 border-t pt-3"},Ge={class:"flex items-start gap-2 mb-3"},Je={class:"ml-2 flex-1"},Xe={class:"flex items-center"},Ze={class:"font-medium font-size-16px font-bold"},Qe={class:"text-gray-600 mt-1"},We=Z({name:"drawerLog",__name:"drawerLog",props:J({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(S){const M=Q();he();const i=se({id:"",content1:"",content2:"",content3:"",content4:"",content5:"",username:"",contractname:"",num:""}),N=S,c={id:99,name:"张三",avatar:"https://cdn-icons-png.flaticon.com/128/3135/3135715.png"},n=G({});async function y(){f.value=[],Object.assign(i,N.rowData),b()}const f=G([]),m=ae(S,"visible");X(m,()=>{m.value?y():(f.value=[],i.id=void 0)});function $(_){_||U()}function U(){m.value=!1}const b=async()=>{const{data:_,error:s}=await De({page:1,limit:100,pid:i.id});_&&(f.value=_.list)},D=ie.debounce(async()=>{var h;const _=n.value[i.id];if(!(_!=null&&_.trim()))return(h=window.$message)==null?void 0:h.warning("请输入评论内容");const{data:s,error:k}=await we([{pid:i.id,content:_}]);s&&(n.value[i.id]="",i.num++,b())},1e3,{leading:!0,trailing:!1}),B=async _=>{var h;const{data:s,error:k}=await Pe(_.id);s&&(b(),i.num--,(h=window.$message)==null||h.success("删除成功"))};return(_,s)=>{const k=ce,h=ne,L=Ee,E=Oe,C=xe,p=Te,d=K("i"),l=K("no-auth");return x(),I(p,{show:m.value,"onUpdate:show":[s[1]||(s[1]=a=>m.value=a),$],"display-directive":"show",width:600,onMaskClick:U,onEsc:U},{default:t(()=>[e(C,{title:i.username+"的项目总结","native-scrollbar":!1,closable:""},{default:t(()=>[e(h,{ref:"formRef",model:i},{default:t(()=>[e(k,{label:"",path:"contractname"},{label:t(()=>s[2]||(s[2]=[v("div",{class:"font-size-16px font-bold"},"项目名称",-1)])),default:t(()=>[v("span",null,w(i.proname),1)]),_:1}),e(k,{label:"前期准备阶段描述",path:"content1"},{label:t(()=>s[3]||(s[3]=[v("div",{class:"font-size-16px font-bold"},"前期准备阶段描述",-1)])),default:t(()=>[v("span",null,w(i.content1),1)]),_:1}),e(k,{label:"遇到问题及对项目的影响",path:"content2"},{label:t(()=>s[4]||(s[4]=[v("div",{class:"font-size-16px font-bold"},"遇到问题及对项目的影响",-1)])),default:t(()=>[v("span",null,w(i.content2),1)]),_:1}),e(k,{label:"经验教训与改进方案或措施",path:"content3"},{label:t(()=>s[5]||(s[5]=[v("div",{class:"font-size-16px font-bold"},"经验教训与改进方案或措施",-1)])),default:t(()=>[v("span",null,w(i.content3),1)]),_:1}),e(k,{label:"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",path:"content4"},{label:t(()=>s[6]||(s[6]=[v("div",{class:"font-size-16px font-bold"},"项目完工确认描述(对于进度延期需具体说明原因及改进措施)",-1)])),default:t(()=>[v("span",null,w(i.content4),1)]),_:1}),e(k,{label:"此次项目对你帮助最大的人，具体描述一下对你的帮助",path:"content5"},{label:t(()=>s[7]||(s[7]=[v("div",{class:"font-size-16px font-bold"},"此次项目对你帮助最大的人，具体描述一下对你的帮助",-1)])),default:t(()=>[v("span",null,w(i.content5),1)]),_:1})]),_:1},8,["model"]),R((x(),V("div",null,[T(w(i.num)+"评论",1)])),[[d,i.num]]),e(ke,{name:"fade"},{default:t(()=>[v("div",Ke,[R((x(),V("div",Ge,[v("div",null,[e(L,{size:"small",src:c.avatar},null,8,["src"])]),e(o(H),{type:"textarea",id:`comment-input-${i.id}`,value:n.value[i.id],"onUpdate:value":s[0]||(s[0]=a=>n.value[i.id]=a),placeholder:"善语结善缘，恶语伤人心...",autosize:"",onKeydown:pe(Se(o(D),["exact","prevent"]),["enter"])},null,8,["id","value","onKeydown"]),e(o(z),{type:"primary",ghost:"",onClick:o(D)},{default:t(()=>s[8]||(s[8]=[T("发送")])),_:1,__:[8]},8,["onClick"])])),[[l,"project:Summary:Comment:insert"]]),(x(!0),V(Ce,null,je(f.value,a=>(x(),V("div",{key:a.id,class:"flex mb-3"},[e(L,{size:"small",src:c.avatar},null,8,["src"]),v("div",Je,[v("div",Xe,[v("span",Ze,w(a.username),1),e(E,{depth:"3",style:{"font-size":"12px","margin-left":"20px"}},{default:t(()=>[T(w(a.dbtime),1)]),_:2},1024),o(M).userInfo.id==a.creater?(x(),I(o(fe),{key:0,onPositiveClick:r=>B(a)},{trigger:t(()=>[R((x(),I(o(z),{quaternary:"",type:"error",size:"small"},{default:t(()=>s[9]||(s[9]=[T(" 删除 ")])),_:1,__:[9]})),[[l,"project:Summary:Comment:delete"]])]),default:t(()=>[s[10]||(s[10]=T(" 确定删除吗？ "))]),_:2,__:[10]},1032,["onPositiveClick"])):A("",!0)]),v("div",Qe,w(a.content),1)])]))),128))])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ye=Z({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search","clear"],["update:model"]),setup(S,{emit:M}){const i=M,{formRef:N}=re(),c=ae(S,"model"),n=Q(),y=G([]),{pageData:f,getData:m,nextPage:$}=te(ue),U=async p=>{const d=p.currentTarget,l=d.scrollTop;d.scrollTop+d.offsetHeight>=d.scrollHeight&&f.data.length<f.total&&(await $(),y.value=f.data,await ee(),setTimeout(()=>{d.scrollTop=l}))},{pageData:b,getData:D,nextPage:B}=te(ze),_=async p=>{const d=p.currentTarget,l=d.scrollTop;d.scrollTop+d.offsetHeight>=d.scrollHeight&&b.data.length<b.total&&(await B(),y.value=b.data,await ee(),setTimeout(()=>{d.scrollTop=l}))},s=async p=>{c.value.creater=p,i("search")},k=async p=>{var d;p?(c.value.pid=p,i("search"),n.setProjectInfo({pname:(d=y.value.find(l=>l.id==p))==null?void 0:d.proname,pid:p})):i("search")},h=async p=>{await m({fuzzy:p,page:1}),y.value=f.data},L=async()=>{await m({page:1}),y.value=f.data};(async()=>{var p,d;await m({fuzzy:n.userInfo.pname}),y.value=f.data,c.value.pid=n.userInfo.pid?n.userInfo.pid:(p=y.value[0])==null?void 0:p.id,n.setProjectInfo({pid:c.value.pid,pname:(d=y.value.find(l=>l.id==c.value.pid))==null?void 0:d.proname}),i("search")})(),D({usertypes:"0,1,2,3,4"});async function C(){i("search")}return(p,d)=>{const l=de,a=Ve,r=qe,u=z,j=oe,O=He,g=ne,W=me;return x(),I(W,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(g,{ref_key:"formRef",ref:N,model:c.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:pe(C,["enter"])},{default:t(()=>[e(O,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:t(()=>[e(a,{span:"24 s:12 m:6",label:"项目列表",path:"PrjId"},{default:t(()=>[e(l,{filterable:"",clearable:"",value:c.value.pid,"onUpdate:value":[d[0]||(d[0]=q=>c.value.pid=q),k],placeholder:"请选择项目","label-field":"proname","value-field":"id",options:y.value,onScroll:U,onClear:L,onSearch:h},null,8,["value","options"])]),_:1}),e(a,{span:"24 s:12 m:6",label:"用户",path:"creater"},{default:t(()=>[e(l,{clearable:"",filterable:"",value:c.value.creater,"onUpdate:value":[d[1]||(d[1]=q=>c.value.creater=q),s],placeholder:"请选择","label-field":"username","value-field":"id",options:o(b).data,onScroll:_},null,8,["value","options"])]),_:1}),e(a,{span:"24  s:12 m:6",class:"pr-24px"},{default:t(()=>[e(j,{class:"w-full"},{default:t(()=>[e(u,{type:"primary",ghost:"",onClick:C},{icon:t(()=>[e(r,{class:"text-icon"})]),default:t(()=>[T(" "+w(o(F)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),et={class:"h-300px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},tt={key:0};function le(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Be(S)}const ut=Z({name:"projectmanagement_projectsummary",__name:"index",props:{pid:{default:void 0},type:{},prjId:{default:void 0}},emits:["thereIsData"],setup(S,{emit:M}){const i=Ne(),N=Q(),c=S,n=M,{columns:y,data:f,getData:m,loading:$,mobilePagination:U,searchParams:b}=Fe({showTotal:!0,immediate:!1,apiFn:Le,apiParams:{page:1,pageSize:20,limit:20,pid:void 0,_t:new Date().getTime()},columns:()=>[{key:"kk",title:" ",align:"center",width:120,render:r=>e("div",null,[r.username+"的项目总结"])},{key:"dbtime",title:"创建时间",align:"center",width:120},{key:"operate",title:F("common.operate"),align:"center",width:140,fixed:"right",render:r=>{let u;return e("div",{class:"flex-center gap-8px"},[e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>l(r)},{default:()=>[T("查看详情")]}),N.userInfo.id==r.creater&&R(e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>C(r.id)},le(u=F("common.edit"))?u:{default:()=>[u]}),[[K("no-auth"),"project:Summary:update"]]),N.userInfo.id==r.creater&&e(fe,{onPositiveClick:()=>E(r.id)},{default:()=>F("common.confirmDelete"),trigger:()=>{let j;return R(e(z,{type:"error",ghost:!0,size:"small"},le(j=F("common.delete"))?j:{default:()=>[j]}),[[K("no-auth"),"project:Summary:delete"]])}})])}}]}),{drawerVisible:D,operateType:B,editingData:_,handleAdd:s,handleEdit:k,checkedRowKeys:h,onDeleted:L}=Re(f,m);async function E(r){const{data:u,error:j}=await Me(r);j||L()}function C(r){k(r)}const p=G(!1),d=G({}),l=r=>{p.value=!0,d.value=r},a=()=>{m()};return X(()=>c.pid,async r=>{r&&(b.pid=r,await m())}),X(()=>f.value,async r=>{r.length>0?n("thereIsData",1):n("thereIsData",0)}),Ue(()=>{c.type!="externalLiaison"}),(r,u)=>{const j=oe,O=_e,g=$e,W=me,q=K("no-auth");return x(),V("div",et,[c.pid?A("",!0):(x(),I(Ye,{key:0,model:o(b),"onUpdate:model":u[0]||(u[0]=P=>Y(b)?b.value=P:null),onReset:a,onSearch:o(m),onClear:u[1]||(u[1]=P=>f.value=[])},null,8,["model","onSearch"])),e(W,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},Ie({header:t(()=>[e(j,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:t(()=>[c.pid?A("",!0):(x(),V("div",tt,"项目总结"))]),_:1}),c.pid?R((x(),I(o(z),{key:0,onClick:o(s),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(O,{class:"text-icon"})]),default:t(()=>[u[5]||(u[5]=T(" "+w("新增")))]),_:1,__:[5]},8,["onClick"])),[[q,"project:Summary:insert"]]):A("",!0)]),default:t(()=>[e(g,{"checked-row-keys":o(h),"onUpdate:checkedRowKeys":u[2]||(u[2]=P=>Y(h)?h.value=P:null),columns:o(y),data:o(f),size:"small","flex-height":!o(i).isMobile,loading:o($),remote:"","row-key":P=>P.id,pagination:o(U),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ae,{visible:o(D),"onUpdate:visible":u[3]||(u[3]=P=>Y(D)?D.value=P:null),onSubmitted:o(m),"operate-type":o(B),pid:c.pid||o(b).pid,"row-data":o(_)},null,8,["visible","onSubmitted","operate-type","pid","row-data"]),e(We,{visible:p.value,"onUpdate:visible":u[4]||(u[4]=P=>p.value=P),"row-data":d.value},null,8,["visible","row-data"])]),_:2},[c.pid?void 0:{name:"header-extra",fn:t(()=>[e(j,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[R((x(),I(o(z),{onClick:o(s),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(O,{class:"text-icon"})]),default:t(()=>[u[6]||(u[6]=T(" "+w("新增")))]),_:1,__:[6]},8,["onClick"])),[[q,"project:Summary:insert"]])]),_:1})]),key:"0"}]),1024)])}}});export{ut as _};
