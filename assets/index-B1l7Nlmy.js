import{_ as J}from"./table-header-operation.vue_vue_type_script_setup_true_lang-4uJD7G6W.js";import{o as i,e as v,f as z,d as W,a0 as Q,g as o,an as X,j as d,K as Y,L as Z,w as a,t as x,M as C,c as g,bn as ee,h,i as s,B as $,O as ae,ad as te,C as oe,E as ne,D as se,aa as le,ay as ie,az as re,av as ce}from"./index-Cw03N3Zb.js";import{_ as ue,a as de}from"./close-small-rounded-BAP3yc56.js";import{J as pe,K as _e,L as me,M as fe}from"./basic-config-NTLfSrdG.js";import{u as ge}from"./table-pW7AL8c6.js";import{_ as he}from"./Progress-Bo8SvBah.js";import{_ as ve}from"./Upload-B9graKKF.js";import{_ as we}from"./DataTable-Cl633dKI.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-7Piq3qDV.js";import"./setting-outlined-BCm9xmub.js";import"./round-delete-DyFqyA58.js";import"./refresh-ITAUszw8.js";import"./round-plus-CnpkLCwp.js";import"./Popconfirm-B2thSO6u.js";import"./Forward-CjRKdAIx.js";const ye={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},ke=z("path",{fill:"currentColor",d:"M16 18v2H8v-2zM11 7.99V16h2V7.99h3L12 4L8 7.99z"},null,-1),be=[ke];function xe(p,M){return i(),v("svg",ye,[...be])}const Ce={name:"ic-twotone-upgrade",render:xe},$e=p=>(ie("data-v-42f2a201"),p=p(),re(),p),ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Me={class:"version"},Ne={key:0,style:{width:"300px"}},Ve=$e(()=>z("div",null,"升级记录",-1)),De=W({name:"basicconfig_upgrade-management",__name:"index",setup(p){const M=Q(),{columns:P,columnChecks:w,data:B,getData:F,loading:N,mobilePagination:T,searchParams:Re,resetSearchParams:Se}=ge({apiFn:pe,apiParams:{page:1,pageSize:20,limit:20,_t:new Date().getTime()},immediate:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"dbtime",title:"升级时间",align:"center"},{key:"upgradecon",title:"升级内容",align:"center"},{key:"prever",title:"升级前版本",align:"center"},{key:"version",title:"升级后版本",align:"center"},{key:"status",title:"状态",align:"center",render:e=>(e.status===null&&(e.status=0),o(X,{type:{0:"error",1:"success"}[e.status]},{default:()=>[e.status==1?"成功":"失败"]}))}]}),y=d(""),V=async()=>{const{data:e,error:t}=await _e();t||(typeof e=="object"?y.value=e.data:y.value=e)},U=async()=>{var n;const{data:e,error:t}=await me({uid:r.value[0]});t||(n=window.$message)==null||n.success(e)},l=d(""),m=d(null),K=({file:e,data:t,headers:n,withCredentials:c,action:f,onFinish:R,onError:S,onProgress:k})=>{m.value=e.file,l.value=e.name},D=d(0),u=d(!1),L=e=>{u.value=!0,D.value=e},r=d([]),E=(e,t,n)=>{var c;n.action==="check"?r.value=[(c=n.row)==null?void 0:c.uid]:r.value=[]},j=async()=>{var e,t;if(!l.value.endsWith(".tar.gz"))return(e=window.$message)==null?void 0:e.error("请上传tar.gz文件");try{const n=new FormData;n.append("fi",m.value);const{data:c,error:f}=await fe({name:l.value},n,L);if(f)return;(t=window.$message)==null||t.success(c),u.value=!1,l.value="",m.value=null,V()}catch{u.value=!1}},q=e=>{e.stopPropagation(),l.value="",m.value=null};return Y(()=>{V()}),(e,t)=>{const n=oe,c=ue,f=de,R=ve,S=Ce,k=ne,G=he,H=se,I=le,O=J,A=we,b=Z("no-auth");return i(),v("div",ze,[o(I,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[o(H,{ref:"formRef",inline:"","label-placement":"left","label-width":100,"show-feedback":!1},{default:a(()=>[o(n,null,{default:a(()=>[z("span",Me,"当前版本号："+x(y.value),1)]),_:1}),C((i(),g(n,{label:"升级包选择",path:"fi"},{default:a(()=>[o(R,{action:"","custom-request":K,"show-file-list":!1,accept:".gz"},{default:a(()=>[l.value?(i(),v("div",{key:0,onClick:t[0]||(t[0]=ee(()=>{},["stop"]))},[h(x(l.value)+" ",1),o(c,{class:"font-size-30px cursor-pointer",onClick:q})])):(i(),g(s($),{key:1},{icon:a(()=>[o(f,{class:"text-icon"})]),default:a(()=>[h(" 上传文件")]),_:1}))]),_:1})]),_:1})),[[b,"sys.upgrade.upload"]]),o(n,null,{default:a(()=>[o(k,{class:"w-full"},{default:a(()=>[C((i(),g(s($),{onClick:j,loading:u.value,disabled:!l.value,type:"primary",ghost:""},{icon:a(()=>[o(S,{class:"text-icon"})]),default:a(()=>[h(" "+x(u.value?"正在升级中":"升级"),1)]),_:1},8,["loading","disabled"])),[[b,"sys.upgrade.upload"]]),C((i(),g(s($),{onClick:U,type:"primary",ghost:"",disabled:r.value.length==0},{default:a(()=>[h(" 回退版本 ")]),_:1},8,["disabled"])),[[b,"sys.upgrade.fallback.version"]])]),_:1})]),_:1}),o(n,null,{default:a(()=>[u.value?(i(),v("div",Ne,[o(G,{type:"line",percentage:D.value},null,8,["percentage"])])):ae("",!0)]),_:1})]),_:1},512)]),_:1}),o(I,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[o(k,{align:"center"},{default:a(()=>[Ve]),_:1})]),"header-extra":a(()=>[o(O,{columns:s(w),"onUpdate:columns":t[1]||(t[1]=_=>te(w)?w.value=_:null),"disabled-delete":r.value.length===0,loading:s(N),onRefresh:s(F)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:a(()=>[o(A,{"checked-row-keys":r.value,"onUpdate:checkedRowKeys":t[2]||(t[2]=_=>r.value=_),columns:s(P),data:s(B),size:"small","flex-height":!s(M).isMobile,"scroll-x":962,loading:s(N),remote:"","row-key":_=>_.uid,pagination:s(T),class:"sm:h-full",onUpdateCheckedRowKeys:E},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1})])}}}),Je=ce(De,[["__scopeId","data-v-42f2a201"]]);export{Je as default};
