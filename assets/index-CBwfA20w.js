import{_ as ce}from"./table-column-setting.vue_vue_type_script_setup_true_lang-ByxhZwKB.js";import{_ as de}from"./round-delete-C5ACT_Yd.js";import{_ as fe}from"./round-add-CiHgedV9.js";import{d as Q,aE as Y,r as me,n as ae,a as ve,aG as ne,aC as _e,bY as ge,cV as ye,cW as he,H as J,c as k,o as m,w as l,f as e,Z as be,C as oe,h as n,x as B,aD as se,b as A,s as G,g as v,e as S,t as y,aI as we,B as x,aJ as ke,N as W,$ as P,a0 as xe,aQ as Ce,bd as Ne,A as De,Y as ie,aS as Ue,q as Z,aT as I,aH as ze,y as K,aU as Se,cX as $e,cY as ee,cZ as Le,aY as Re}from"./index-CwsogUdO.js";import{u as je,a as qe}from"./table-DmynGf54.js";import{_ as re}from"./Grid-EBnMWc0y.js";import{_ as pe}from"./FormItemGridItem-CAH_tKOz.js";import{_ as Te}from"./round-search-DFgnPdZ7.js";import{_ as Be}from"./round-refresh-D85UEohG.js";import{N as te}from"./Popconfirm-BcfCvBvw.js";const Pe={key:0,style:{"margin-left":"20px"}},Fe={key:0,style:{"margin-left":"20px"}},Me={key:0,style:{"margin-left":"20px"}},Ve={key:0,style:{"margin-left":"20px"}},Oe=Q({name:"OperateDrawer",__name:"operate-drawer",props:Y({operateType:{},rowData:{},provinceList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(C,{emit:V}){const $=V,b=C,t=me(L());function L(){return{id:"",dname:"",dcon:"",province:null,region:"",re1:"",re2:"",re3:"",re4:"",fl1:"",fl2:"",fl3:"",fl4:""}}async function _(){Object.assign(t,L()),b.operateType==="edit"&&b.rowData&&Object.assign(t,b.rowData)}const{formRef:N,validate:F,restoreValidation:O}=ae(),D={dname:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},province:{type:"number",required:!0,trigger:["blur","change"],message:"请选择"},dcon:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"},region:{type:"string",required:!0,trigger:["blur","change"],message:"请输入"}},M=ve(()=>({add:"新增调度",edit:"修改调度"})[b.operateType]),g=ne(C,"visible");_e(g,()=>{g.value&&(_(),setTimeout(()=>{const i=document.querySelector(".n-scrollbar-content");i==null||i.scrollTo(0,0)},300),O())});function R(){g.value=!1}const j=ge.debounce(async()=>{var i,a;if(await F(),b.operateType==="edit"){const{data:r,error:c}=await ye([t]);c||(R(),$("submitted"),(i=window.$message)==null||i.success("修改成功"))}else{const{data:r,error:c}=await he([{...t}]);c||(R(),$("submitted"),(a=window.$message)==null||a.success("添加成功"))}},1e3,{leading:!0,trailing:!0}),p=J(0),u=J("");async function U({file:i},a){p.value=0,u.value=a;const r=await Ce(i.file,i.name,"",c=>{p.value=c});r&&(t[a]=r,p.value=0)}async function q(i){var a;return i.file.file.size>100*1024*1024?((a=window.$message)==null||a.error("文件大小不能超过100M"),!1):!0}async function T(i){if(i)try{const r=await(await fetch(i==null?void 0:i.split("?")[0],{mode:"cors"})).blob(),c=URL.createObjectURL(r),h=document.createElement("a");h.href=c,h.download=i==null?void 0:i.split("?")[1],h.style.display="none",document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(c)}catch(a){console.error("下载失败:",a)}}return(i,a)=>{const r=pe,c=we,h=ke,d=re,s=oe,w=be,E=W,H=xe;return m(),k(H,{show:g.value,"onUpdate:show":a[16]||(a[16]=o=>g.value=o),title:M.value,preset:"card",class:"w-800px","mask-closable":!1,draggable:!0},{footer:l(()=>[e(E,{justify:"end",size:16},{default:l(()=>[e(n(x),{onClick:R},{default:l(()=>[v(y(n(P)("common.cancel")),1)]),_:1}),e(n(x),{type:"primary",onClick:n(j)},{default:l(()=>[v(y(n(P)("common.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),default:l(()=>[e(w,{class:"pr-20px"},{default:l(()=>[e(s,{ref_key:"formRef",ref:N,model:t,rules:D,"label-placement":"left","label-width":120},{default:l(()=>[e(d,{responsive:"screen","item-responsive":""},{default:l(()=>[e(r,{span:"24 m:12",label:"主站名称",path:"dname"},{default:l(()=>[e(n(B),{value:t.dname,"onUpdate:value":a[0]||(a[0]=o=>t.dname=o),placeholder:"请输入"},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"主站联系方式",path:"dcon"},{default:l(()=>[e(n(B),{value:t.dcon,"onUpdate:value":a[1]||(a[1]=o=>t.dcon=o),placeholder:"请输入"},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"省份",path:"province"},{default:l(()=>[e(n(se),{filterable:"",options:b.provinceList,clearable:"",value:t.province,"onUpdate:value":a[2]||(a[2]=o=>t.province=o),"value-field":"id","label-field":"name"},null,8,["options","value"])]),_:1}),e(r,{span:"24 m:12",label:"地区",path:"region"},{default:l(()=>[e(n(B),{value:t.region,"onUpdate:value":a[3]||(a[3]=o=>t.region=o),placeholder:"请输入"},null,8,["value"])]),_:1}),e(r,{span:"24 m:24",label:"",path:"notes","show-feedback":!1},{default:l(()=>[e(d,{responsive:"screen","item-responsive":""},{default:l(()=>[e(r,{span:"24 m:12",label:"附件1",path:"notes"},{default:l(()=>[e(n(B),{value:t.re1,"onUpdate:value":a[4]||(a[4]=o=>t.re1=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[t.fl1?(m(),A("span",Pe,[v(y((o=t.fl1)==null?void 0:o.split("?")[1])+" ",1),S("span",{class:"cursor-pointer c-#c92a2a",onClick:a[5]||(a[5]=f=>t.fl1="")},"删除"),S("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[6]||(a[6]=f=>T(t.fl1))},"下载")])):(m(),k(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":f=>U(f,"fl1"),"show-file-list":!1,onBeforeUpload:q},{default:l(()=>[e(n(x),{loading:p.value>0&&!t.fl1&&u.value=="fl1",size:"small",ghost:"",type:"primary"},{default:l(()=>[v(y(p.value>0&&!t.fl1&&u.value=="fl1"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!t.fl1&&u.value=="fl1"?(m(),k(h,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):G("",!0)]}),_:1})]),_:1})]),_:1}),e(r,{span:"24 m:12",label:"附件2",path:"notes"},{default:l(()=>[e(n(B),{value:t.re2,"onUpdate:value":a[7]||(a[7]=o=>t.re2=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[t.fl2?(m(),A("span",Fe,[v(y((o=t.fl2)==null?void 0:o.split("?")[1])+" ",1),S("span",{class:"cursor-pointer c-#c92a2a",onClick:a[8]||(a[8]=f=>t.fl2="")},"删除"),S("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[9]||(a[9]=f=>T(t.fl2))},"下载")])):(m(),k(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":f=>U(f,"fl2"),"show-file-list":!1,onBeforeUpload:q},{default:l(()=>[e(n(x),{loading:p.value>0&&!t.fl2&&u.value=="fl2",size:"small",ghost:"",type:"primary"},{default:l(()=>[v(y(p.value>0&&!t.fl2&&u.value=="fl2"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!t.fl2&&u.value=="fl2"?(m(),k(h,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):G("",!0)]}),_:1}),e(r,{span:"24 m:12",label:"附件3",path:"notes"},{default:l(()=>[e(n(B),{value:t.re3,"onUpdate:value":a[10]||(a[10]=o=>t.re3=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[t.fl3?(m(),A("span",Me,[v(y((o=t.fl3)==null?void 0:o.split("?")[1])+" ",1),S("span",{class:"cursor-pointer c-#c92a2a",onClick:a[11]||(a[11]=f=>t.fl3="")},"删除"),S("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[12]||(a[12]=f=>T(t.fl3))},"下载")])):(m(),k(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":f=>U(f,"fl3"),"show-file-list":!1,onBeforeUpload:q},{default:l(()=>[e(n(x),{loading:p.value>0&&!t.fl3&&u.value=="fl3",size:"small",ghost:"",type:"primary"},{default:l(()=>[v(y(p.value>0&&!t.fl3&&u.value=="fl3"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!t.fl3&&u.value=="fl3"?(m(),k(h,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):G("",!0)]}),_:1}),e(r,{span:"24 m:12",label:"附件4",path:"notes"},{default:l(()=>[e(n(B),{value:t.re4,"onUpdate:value":a[13]||(a[13]=o=>t.re4=o),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])]),_:1}),e(r,{span:"24 m:12",label:"",path:"notes"},{default:l(()=>{var o;return[t.fl4?(m(),A("span",Ve,[v(y((o=t.fl4)==null?void 0:o.split("?")[1])+" ",1),S("span",{class:"cursor-pointer c-#c92a2a",onClick:a[14]||(a[14]=f=>t.fl4="")},"删除"),S("span",{class:"cursor-pointer c-#1890ff ml-5px inline-block",onClick:a[15]||(a[15]=f=>T(t.fl4))},"下载")])):(m(),k(c,{key:1,style:{width:"auto","margin-left":"20px"},ref:"uploadRef",action:"#","custom-request":f=>U(f,"fl4"),"show-file-list":!1,onBeforeUpload:q},{default:l(()=>[e(n(x),{loading:p.value>0&&!t.fl4&&u.value=="fl4",size:"small",ghost:"",type:"primary"},{default:l(()=>[v(y(p.value>0&&!t.fl4&&u.value=="fl4"?"上传中":"选择文件"),1)]),_:1},8,["loading"])]),_:1},8,["custom-request"])),p.value&&!t.fl4&&u.value=="fl4"?(m(),k(h,{key:2,type:"line",percentage:p.value,"indicator-placement":"inside",processing:""},null,8,["percentage"])):G("",!0)]}),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ee=Q({name:"FormSearch",__name:"form-search",props:Y({provinceList:{}},{model:{required:!0},modelModifiers:{}}),emits:Y(["reset","search"],["update:model"]),setup(C,{emit:V}){const $=C;Ne();const b=V,{formRef:t,restoreValidation:L}=ae(),_=ne(C,"model");function N(){_.value.fuzzy="",b("search")}const F=()=>{_.value.region="",b("search")};async function O(){await L(),b("reset")}async function D(){b("search")}return(M,g)=>{const R=B,j=pe,p=se,u=Be,U=x,q=Te,T=W,i=re,a=oe,r=ie;return m(),k(r,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[e(a,{ref_key:"formRef",ref:t,model:_.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:De(D,["enter"])},{default:l(()=>[e(i,{responsive:"screen","item-responsive":"","x-gap":16,"y-gap":16},{default:l(()=>[e(j,{span:"24 s:12 m:6",label:"调度名称",path:"fuzzy"},{default:l(()=>[e(R,{clearable:"",value:_.value.fuzzy,"onUpdate:value":g[0]||(g[0]=c=>_.value.fuzzy=c),placeholder:"请输入调度名称",onClear:N},null,8,["value"])]),_:1}),e(j,{span:"24 s:12 m:4",label:"省份",path:"province"},{default:l(()=>[e(p,{clearable:"",filterable:"",value:_.value.province,"onUpdate:value":[g[1]||(g[1]=c=>_.value.province=c),D],placeholder:"请选择省份","label-field":"name","value-field":"id",options:$.provinceList},null,8,["value","options"])]),_:1}),e(j,{span:"24 s:12 m:6",label:"地区",path:"region"},{default:l(()=>[e(R,{clearable:"",value:_.value.region,"onUpdate:value":g[2]||(g[2]=c=>_.value.region=c),placeholder:"请输入地区",onClear:F},null,8,["value"])]),_:1}),e(j,{span:"24  s:12 m:6",class:"pr-24px"},{default:l(()=>[e(T,{class:"w-full"},{default:l(()=>[e(U,{onClick:O},{icon:l(()=>[e(u,{class:"text-icon"})]),default:l(()=>[v(" "+y(n(P)("common.reset")),1)]),_:1}),e(U,{type:"primary",ghost:"",onClick:D},{icon:l(()=>[e(q,{class:"text-icon"})]),default:l(()=>[v(" "+y(n(P)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ae={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function le(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!Re(C)}const et=Q({name:"projectmanagement_dispatch",__name:"index",setup(C){const V=Ue(),$=J([]);(async()=>{const{data:d}=await $e();d&&($.value=d)})();const{columns:t,columnChecks:L,data:_,getData:N,loading:F,mobilePagination:O,searchParams:D}=je({showTotal:!0,apiFn:Le,apiParams:{page:1,pageSize:20,limit:20,province:void 0,region:"",fuzzy:"",_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"dname",title:"主站名称",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"dcon",title:"主站联系方式",align:"center",width:120,ellipsis:{tooltip:!0}},{key:"provinceName",title:"省份",align:"center",width:120},{key:"region",title:"地区",align:"center",width:120},{key:"username",title:"创建人",align:"center",width:120},{key:"dbtime",title:"创建时间",align:"center",width:120,sorter:!0},{key:"operate",title:P("common.operate"),align:"center",width:140,fixed:"right",render:d=>{let s;return e("div",{class:"flex-center gap-8px"},[K(e(x,{type:"primary",ghost:!0,size:"small",onClick:()=>a(d.id)},le(s=P("common.edit"))?s:{default:()=>[s]}),[[Z("no-auth"),"project:Dispatch:update"]]),e(te,{onPositiveClick:()=>i(d.id)},{default:()=>P("common.confirmDelete"),trigger:()=>{let w;return K(e(x,{type:"error",ghost:!0,size:"small"},le(w=P("common.delete"))?w:{default:()=>[w]}),[[Z("no-auth"),"project:Dispatch:delete"]])}})])}}]}),{drawerVisible:M,operateType:g,editingData:R,handleAdd:j,handleEdit:p,checkedRowKeys:u,onBatchDeleted:U,onDeleted:q}=qe(_,N);async function T(){console.log(u.value),r(u.value.join(","),d=>{U()})}async function i(d){const{data:s,error:w}=await ee(d);w||q()}function a(d){p(d)}async function r(d,s){const{data:w,error:E}=await ee(d);if(!E)s&&s(w);else return!1}const c=d=>{N()},h=()=>{N()};return(d,s)=>{const w=W,E=fe,H=de,o=ce,f=ze,ue=ie,X=Z("no-auth");return m(),A("div",Ae,[e(Ee,{model:n(D),"onUpdate:model":s[0]||(s[0]=z=>I(D)?D.value=z:null),onReset:h,onSearch:n(N),provinceList:$.value},null,8,["model","onSearch","provinceList"]),e(ue,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[e(w,{align:"center",wrap:"",class:"lt-sm:w-200px"},{default:l(()=>s[4]||(s[4]=[S("div",null,"主站联系人",-1)])),_:1,__:[4]})]),"header-extra":l(()=>[e(w,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[K((m(),k(n(x),{onClick:n(j),size:"small",ghost:"",type:"primary"},{icon:l(()=>[e(E,{class:"text-icon"})]),default:l(()=>[s[5]||(s[5]=v(" "+y("新增")))]),_:1,__:[5]},8,["onClick"])),[[X,"project:Dispatch:insert"]]),e(n(te),{onPositiveClick:T},{trigger:l(()=>[K((m(),k(n(x),{size:"small",ghost:"",type:"error",disabled:n(u).length==0},{icon:l(()=>[e(H,{class:Se(["text-icon",{"animate-spin":n(F)}])},null,8,["class"])]),default:l(()=>[s[6]||(s[6]=v(" "+y("批量删除")))]),_:1,__:[6]},8,["disabled"])),[[X,"project:Dispatch:delete"]])]),default:l(()=>[s[7]||(s[7]=v(" 确定要删除选中的调度吗？ "))]),_:1,__:[7]}),e(o,{columns:n(L),"onUpdate:columns":s[1]||(s[1]=z=>I(L)?L.value=z:null)},null,8,["columns"])]),_:1})]),default:l(()=>[e(f,{"checked-row-keys":n(u),"onUpdate:checkedRowKeys":s[2]||(s[2]=z=>I(u)?u.value=z:null),columns:n(t),data:n(_),size:"small","flex-height":!n(V).isMobile,loading:n(F),remote:"","row-key":z=>z.id,pagination:n(O),class:"sm:h-full","onUpdate:filters":c},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Oe,{visible:n(M),"onUpdate:visible":s[3]||(s[3]=z=>I(M)?M.value=z:null),onSubmitted:n(N),"operate-type":n(g),provinceList:$.value,"row-data":n(R)},null,8,["visible","onSubmitted","operate-type","provinceList","row-data"])]),_:1})])}}});export{et as default};
