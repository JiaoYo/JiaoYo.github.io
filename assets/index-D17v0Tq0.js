import{_ as ie}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BraKu64w.js";import{d as P,q as O,v as K,s as W,r as j,j as H,L as E,o as V,c as X,w as a,g as e,M as I,h as A,t as F,i as t,$ as h,N as re,X as Z,A as J,B as M,E as Q,D as Y,a9 as ee,x as ce,b as de,y as ue,C as pe,aa as me,ab as _e,Z as fe,e as ve,ac as $,ad as he}from"./index-DdFRcMsp.js";import{u as ge,a as ye}from"./table-BsTW9ABZ.js";import{_ as be}from"./round-search-AKByPIH4.js";import{_ as we}from"./round-refresh-D4zfNVQ9.js";import{a as te,b as ae}from"./common-B5-M_UQJ.js";import{_ as ne}from"./Cascader-ARBTVUkj.js";import{_ as De}from"./FormItemGridItem-DPQJLVMW.js";import{_ as ke}from"./Grid-DeVCkw14.js";import{s as Se,t as xe,u as Ne,v as Te}from"./events-CXu3r_Ue.js";import{h as q}from"./permission-CbewqLcP.js";import{_ as Le}from"./Popconfirm-B2my08_G.js";import{_ as ze}from"./DataTable-BtNWuVb4.js";import"./table-column-setting.vue_vue_type_script_setup_true_lang-s0NFLylz.js";import"./setting-outlined-BwbZ2xnc.js";import"./round-delete-BpT5z0wb.js";import"./refresh-sbMXe3AT.js";import"./round-plus-DEoRZ8xG.js";import"./Upload-DT01sVlP.js";import"./Progress-CjbFKRLF.js";import"./Forward-wDqmGldW.js";const Ce=P({name:"FormSearch",__name:"form-search",props:{model:{required:!0},modelModifiers:{}},emits:O(["reset","search"],["update:model"]),setup(g,{emit:z}){const u=z,{formRef:b,restoreValidation:f}=K(),i=W(g,"model"),S=j({eventsTypeDataList:[]});async function C(){const{data:y,error:c}=await te();c||(S.eventsTypeDataList=y)}C();const w=H();(async()=>{const{data:y,error:c}=await ae();c||(w.value=y.map(r=>({...r,id:"-"+r.id,type:r.cname})))})();function n(){i.value.fuzzy="",u("search")}async function T(){await f(),u("reset")}async function D(){u("search")}return(y,c)=>{const r=ne,k=De,R=Z,L=J,B=we,d=M,s=be,p=Q,o=ke,l=Y,m=ee,x=E("no-space");return V(),X(m,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(l,{ref_key:"formRef",ref:b,model:i.value,"label-placement":"left","label-width":100,"show-feedback":!1,onKeyup:re(D,["enter"])},{default:a(()=>[e(o,{responsive:"screen","item-responsive":""},{default:a(()=>[e(k,{span:"24 s:12 m:6",label:"日志源设备",path:"lid",class:"pr-24px"},{default:a(()=>[e(r,{value:i.value.lid,"onUpdate:value":[c[0]||(c[0]=v=>i.value.lid=v),D],placeholder:"请选择日志源设备",options:w.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),e(k,{span:"24 s:24 m:6",label:"事件类型",path:"eid",class:"pr-24px"},{default:a(()=>[e(R,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:i.value.eid,"onUpdate:value":[c[1]||(c[1]=v=>i.value.eid=v),D],"value-field":"id","label-field":"pname",options:S.eventsTypeDataList},null,8,["value","options"])]),_:1}),e(k,{span:"24 s:12 m:6",label:"特征值",path:"fuzzy",class:"pr-24px"},{default:a(()=>[I(e(L,{clearable:"",value:i.value.fuzzy,"onUpdate:value":c[2]||(c[2]=v=>i.value.fuzzy=v),placeholder:"请输入特征值",onClear:n},null,8,["value"]),[[x]])]),_:1}),e(k,{span:"24 m:4",class:"pr-24px"},{default:a(()=>[e(p,{class:"w-full"},{default:a(()=>[e(d,{onClick:T},{icon:a(()=>[e(B,{class:"text-icon"})]),default:a(()=>[A(" "+F(t(h)("common.reset")),1)]),_:1}),e(d,{type:"primary",ghost:"",onClick:D},{icon:a(()=>[e(s,{class:"text-icon"})]),default:a(()=>[A(" "+F(t(h)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Re=P({name:"OperateDrawer",__name:"operate-drawer",props:O({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:O(["submitted"],["update:visible"]),setup(g,{emit:z}){const u=g,b=z,f=W(g,"visible"),{formRef:i,validate:S,restoreValidation:C}=K(),{defaultRequiredRule:w}=ce(),U=de(()=>({add:"新增事件特征值",edit:"修改事件特征值"})[u.operateType]),n=j(T());function T(){return{ename:"",lid:void 0,eid:void 0}}const D={ename:w,lid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"},eid:{type:"number",required:!0,trigger:["blur","change"],message:"不能为空"}},y=H();(async()=>{const{data:d,error:s}=await ae();s||(y.value=d.map(p=>({...p,id:"-"+p.id,type:p.cname})))})();const r=j({eventsTypeDataList:[]});async function k(){const{data:d,error:s}=await te();s||(r.eventsTypeDataList=d)}k();function R(){Object.assign(n,T()),u.operateType==="edit"&&u.rowData&&Object.assign(n,u.rowData)}function L(){f.value=!1}async function B(){var d,s;if(await S(),u.operateType==="add"){const{data:p,error:o}=await Se([{ename:n.ename,lid:n.lid,eid:n.eid}]);o||((d=window.$message)==null||d.success(h("common.addSuccess")),L(),b("submitted"))}else{const{data:p,error:o}=await xe([{id:u.rowData.id,ename:n.ename,lid:n.lid,eid:n.eid}]);o||((s=window.$message)==null||s.success(h("common.updateSuccess")),L(),b("submitted"))}}return ue(f,()=>{f.value&&(R(),C())}),(d,s)=>{const p=J,o=pe,l=ne,m=Z,x=Y,v=M,_=Q,oe=me,le=_e,se=E("no-space");return V(),X(le,{show:f.value,"onUpdate:show":s[3]||(s[3]=N=>f.value=N),"display-directive":"show",width:600},{default:a(()=>[e(oe,{title:U.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(_,{size:16},{default:a(()=>[e(v,{onClick:L},{default:a(()=>[A(F(t(h)("common.cancel")),1)]),_:1}),e(v,{type:"primary",onClick:B},{default:a(()=>[A(F(t(h)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(x,{ref_key:"formRef",ref:i,model:n,rules:D},{default:a(()=>[e(o,{label:"特征值",path:"ename"},{default:a(()=>[I(e(p,{value:n.ename,"onUpdate:value":s[0]||(s[0]=N=>n.ename=N),placeholder:"请输入特征值",clearable:""},null,8,["value"]),[[se]])]),_:1}),e(o,{label:"日志源设备",path:"lid"},{default:a(()=>[e(l,{value:n.lid,"onUpdate:value":s[1]||(s[1]=N=>n.lid=N),placeholder:"请选择日志源设备",options:y.value,"check-strategy":"child","children-field":"data","value-field":"id","label-field":"type",clearable:"",style:{width:"100%"},"show-path":!1},null,8,["value","options"])]),_:1}),e(o,{label:"事件类型",path:"eid"},{default:a(()=>[e(m,{filterable:"",clearable:"",placeholder:"请选择事件类型",value:n.eid,"onUpdate:value":s[2]||(s[2]=N=>n.eid=N),"value-field":"id","label-field":"pname",options:r.eventsTypeDataList},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function G(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!he(g)}const et=P({name:"eventalarm_eventcharacteristicvalue",__name:"index",setup(g){const z=fe(),{columns:u,columnChecks:b,data:f,getData:i,loading:S,mobilePagination:C,searchParams:w,resetSearchParams:U}=ge({apiFn:Ne,immediate:!0,apiParams:{page:1,pageSize:20,limit:20,lid:null,eid:null,fuzzy:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"ename",title:"特征值",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"type",title:"日志源设备",align:"center",minWidth:160,ellipsis:{tooltip:!0}},{key:"pname",title:"事件类型",align:"center",minWidth:180,ellipsis:{tooltip:!0}},{key:"dbtime",title:"入库时间",align:"center",width:180},{key:"operate",title:h("common.operate"),align:"center",width:160,fixed:"right",render:o=>{let l;return e("div",{class:"flex-center gap-8px"},[I(e(M,{type:"info",ghost:!0,size:"small",onClick:()=>d(o.id)},G(l=h("common.edit"))?l:{default:()=>[l]}),[[E("no-auth"),"event.eigen.value.update"]]),e(Le,{onPositiveClick:()=>s(o.id)},{default:()=>h("common.confirmDelete"),trigger:()=>{let m;return I(e(M,{type:"error",ghost:!0,size:"small"},G(m=h("common.delete"))?m:{default:()=>[m]}),[[E("no-auth"),"event.eigen.value.delete"]])}})])}}]}),{drawerVisible:n,operateType:T,editingData:D,handleAdd:y,handleEdit:c,checkedRowKeys:r,onBatchDeleted:k,onDeleted:R,closeDrawer:L}=ye(f,i);async function B(){console.log(r.value),p(r.value,o=>{k()})}function d(o){c(o)}function s(o){console.log(o),p([o],l=>{R()})}async function p(o,l){const{data:m,error:x}=await Te(o);if(!x)l&&l(m);else return!1}return(o,l)=>{const m=ie,x=ze,v=ee;return V(),ve("div",Be,[e(Ce,{model:t(w),"onUpdate:model":l[0]||(l[0]=_=>$(w)?w.value=_:null),onReset:t(U),onSearch:t(i)},null,8,["model","onReset","onSearch"]),e(v,{title:"事件特征值",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(m,{columns:t(b),"onUpdate:columns":l[1]||(l[1]=_=>$(b)?b.value=_:null),"disabled-delete":t(r).length===0,loading:t(S),onAdd:t(y),onDelete:B,onRefresh:t(i),"is-view-add-button":t(q)("event.eigen.value.insert"),"is-view-delete-button":t(q)("event.eigen.value.delete")},null,8,["columns","disabled-delete","loading","onAdd","onRefresh","is-view-add-button","is-view-delete-button"])]),default:a(()=>[e(x,{"checked-row-keys":t(r),"onUpdate:checkedRowKeys":l[2]||(l[2]=_=>$(r)?r.value=_:null),columns:t(u),data:t(f),size:"small","flex-height":!t(z).isMobile,"scroll-x":962,loading:t(S),remote:"","row-key":_=>_.id,pagination:t(C),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Re,{visible:t(n),"onUpdate:visible":l[3]||(l[3]=_=>$(n)?n.value=_:null),"operate-type":t(T),"row-data":t(D),onSubmitted:t(i)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{et as default};
