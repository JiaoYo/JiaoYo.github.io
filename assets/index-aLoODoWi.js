import{_ as ye}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CaE2L_JR.js";import{_ as we}from"./round-refresh-wmfCgaIG.js";import{_ as Ne}from"./round-add-BPgRFa0m.js";import{_ as Ie}from"./round-search-Dxiz62Oh.js";import{d as Y,n as H,j as V,p as ae,r as le,q as ke,s as De,a7 as de,ac as ue,b as Ce,$ as D,y as K,o as L,c as W,w as t,g as e,h as A,t as B,i as l,z as J,C as xe,A as Me,f as Se,aP as Ae,aQ as qe,ag as Z,I as ce,at as Ue,L as Q,M as oe,B as z,al as se,aq as pe,ai as me,e as _e,aj as X,aB as $e,ae as ze,aR as Oe,aN as Te,v as Pe,aS as Ve,ab as ee,am as te,an as Be,ao as Re,a2 as je}from"./index-ByQsQpYG.js";import{u as Ee,a as Le}from"./table-CQrIFVLV.js";import{_ as ie}from"./FormItemGridItem-DGZImIns.js";import{_ as Fe,a as Ge}from"./RadioGroup-DngHp1Rz.js";import{_ as re}from"./Grid-B95GY2KH.js";import{y as Ke}from"./common-CLQgGQcy.js";import{N as Je}from"./Popconfirm-BA4IjE_D.js";import{_ as Qe}from"./InputGroupLabel-Ca7DOQhJ.js";import{_ as He}from"./DataTable-BmHddFa8.js";import"./Forward-L7FBmiBZ.js";const We=Se("span",null,"批量新增：格式为（采集设备1-10）",-1),Xe=Y({__name:"add_model",props:H({operateType:{},rowData:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(y,{emit:j}){const C=V(!1),g=ae(y,"visible"),_=j,u=y,n=le(w());function w(){return{devName:"采集设备1",chlId:void 0,devCommAddr:"1",devPubAddr:"1",devValid:1,devDesc:"",reserve0:"",reserve1:""}}const R=le({channelList:[]});async function h(){const{data:c,error:s}=await pe({type:0});s||(R.channelList=c)}async function q(){await h(),u.operateType==="edit"&&u.rowData?Object.assign(n,u.rowData):(Object.assign(n,w()),n.chlId=u.chlId||R.channelList[0].id)}const{formRef:p,validate:r,restoreValidation:U}=ke();De(),de(()=>u.rowData,()=>{q()}),de(g,()=>{g.value&&(ue(()=>{u.operateType==="add"&&ue(()=>{setTimeout(()=>{C.value=!0},200)})}),q(),U())});const N=()=>{g.value=!1,C.value=!1},O=async()=>{var c;if(await r(),u.operateType==="add"){let s=[],v=n.devName;if(((c=n.devName)==null?void 0:c.indexOf("-"))!=-1){let F=Math.abs(v==null?void 0:v.substring(v.lastIndexOf("-")).replace(/[^0-9]/gi,"")),o=v.split(/-(?![^-]*-)/),a=v.substring(0,v.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],i=a.replace(/[^0]/g,""),T=a,S=o[0],k=S.substring(0,S.length-S.match(/(\d+)[^0-9]*$/)[1].length),G=F-a+1;for(let P=0;P<G;P++){let f=T++,d=JSON.parse(JSON.stringify(n));d.devName=parseInt(a)==0?i.length>0?String(f).length>=i.length?k+f:k+i.substring(0,i.length-String(f).length)+f:k+f:i.length>0?f>=10?k+i.substring(0,i.length-String(f).length+1)+f:k+i.substring(0,i.length)+f:k+f,d.devCommAddr=Number(n.devCommAddr)+P,s.push(d)}}else s=[n];const{data:I,error:M}=await Ae(s);M?console.log("error",M):(console.log("success",I),N(),_("submitted"))}else{const{data:s,error:v}=await qe([n]);v?console.log("error",v):(console.log("success",s),N(),_("submitted"))}},x={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},E={devName:x,chlId:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},devCommAddr:x,devPubAddr:x},b=Ce(()=>({add:D("common.add"),edit:D("common.edit")})[u.operateType]);return(c,s)=>{const v=Z,I=ie,M=ce,F=Ue,o=Fe,a=Q,i=Ge,T=re,S=oe,k=z,G=Q,P=se,f=K("no-space");return L(),W(P,{show:g.value,"onUpdate:show":s[6]||(s[6]=d=>g.value=d),title:b.value,preset:"card",class:"w-30%",onAfterLeave:N},{footer:t(()=>[e(G,{size:16,justify:"center"},{default:t(()=>[e(k,{onClick:N,class:"w-100px"},{default:t(()=>[A(B(l(D)("common.cancel")),1)]),_:1}),e(k,{type:"primary",class:"w-100px",onClick:O},{default:t(()=>[A(B(l(D)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(S,{ref_key:"formRef",ref:p,model:n,rules:E,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:Me(O,["enter"])},{default:t(()=>[e(T,{responsive:"screen","item-responsive":""},{default:t(()=>[e(I,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(v,{filterable:"",placeholder:"请选择所属通道",value:n.chlId,"onUpdate:value":s[0]||(s[0]=d=>n.chlId=d),"label-field":"chlName","value-field":"id",options:R.channelList},null,8,["value","options"])]),_:1}),e(I,{span:"24 m:24",label:"设备名称",path:"devName"},{default:t(()=>[e(F,{show:C.value,placement:"right-start"},{trigger:t(()=>[J(e(M,{clearable:"",value:n.devName,"onUpdate:value":s[1]||(s[1]=d=>n.devName=d),maxlength:"64",placeholder:"请输入设备名称"},null,8,["value"]),[[f]])]),default:t(()=>[We]),_:1},8,["show"])]),_:1}),e(I,{span:"24 m:24",label:"通讯地址",path:"devCommAddr"},{default:t(()=>[e(M,{clearable:"",value:n.devCommAddr,"onUpdate:value":s[2]||(s[2]=d=>n.devCommAddr=d),maxlength:"50",placeholder:"请输入通讯地址"},null,8,["value"])]),_:1}),e(I,{span:"24 m:24",label:"公共地址",path:"devPubAddr"},{default:t(()=>[e(M,{clearable:"",value:n.devPubAddr,"onUpdate:value":s[3]||(s[3]=d=>n.devPubAddr=d),placeholder:"请输入公共地址"},null,8,["value"])]),_:1}),u.operateType=="edit"?(L(),W(I,{key:0,span:"24 m:24",label:"设备有效性",path:"devValid"},{default:t(()=>[e(i,{value:n.devValid,"onUpdate:value":s[4]||(s[4]=d=>n.devValid=d),name:"radiogroup"},{default:t(()=>[e(a,null,{default:t(()=>[e(o,{label:"是",value:1}),e(o,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):xe("",!0),e(I,{span:"24 m:24",label:"设备描述",path:"devDesc"},{default:t(()=>[e(M,{clearable:"",value:n.devDesc,"onUpdate:value":s[5]||(s[5]=d=>n.devDesc=d),placeholder:"请输入设备描述",maxlength:"64",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ye=Y({__name:"merge_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:H(["submitted"],["update:visible"]),setup(y,{emit:j}){const g=me({0:"采集104tcp",1:"采集104udp"}),_=ae(y,"visible"),u=V(null),n=V({targetDevice:void 0,EquipmentMerged:void 0}),w=()=>{},h={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}},q=V(!1);return(p,r)=>{const U=Z,N=ie,O=re,x=oe,$=z,E=Q,b=se;return L(),_e($e,null,[e(b,{show:_.value,"onUpdate:show":r[3]||(r[3]=c=>_.value=c),title:"设备合并",preset:"card",class:"w-40%"},{footer:t(()=>[e(E,{size:16,justify:"center"},{default:t(()=>[e($,{onClick:r[2]||(r[2]=c=>_.value=!1),class:"w-100px"},{default:t(()=>[A(B(p.$t("common.cancel")),1)]),_:1}),e($,{type:"primary",class:"w-100px",onClick:w},{default:t(()=>[A(B(p.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(x,{ref_key:"formRef",ref:u,"label-width":120,"label-placement":"left",model:n.value,rules:h},{default:t(()=>[e(O,{responsive:"screen","item-responsive":""},{default:t(()=>[e(N,{span:"24 m:12",label:"目标设备",path:"targetDevice"},{default:t(()=>[e(U,{filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.targetDevice,"onUpdate:value":r[0]||(r[0]=c=>n.value.targetDevice=c),options:l(X)(l(g))},null,8,["value","options"])]),_:1}),e(N,{span:"24 m:12",label:"待合并设备",path:"EquipmentMerged"},{default:t(()=>[e(U,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.EquipmentMerged,"onUpdate:value":r[1]||(r[1]=c=>n.value.EquipmentMerged=c),options:l(X)(l(g))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(b,{show:q.value,"onUpdate:show":r[4]||(r[4]=c=>q.value=c),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),Ze=Y({__name:"move_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:H(["submitted"],["update:visible"]),setup(y,{emit:j}){const g=me({0:"采集104tcp",1:"采集104udp"}),_=ae(y,"visible"),u=V(null),n=V({targetDevice:void 0,EquipmentMerged:void 0}),w=()=>{},h={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}};return(q,p)=>{const r=Z,U=ie,N=re,O=oe,x=z,$=Q,E=se;return L(),W(E,{show:_.value,"onUpdate:show":p[3]||(p[3]=b=>_.value=b),title:"设备移动至通道",preset:"card",class:"w-40%"},{footer:t(()=>[e($,{size:16,justify:"center"},{default:t(()=>[e(x,{onClick:p[2]||(p[2]=b=>_.value=!1),class:"w-100px"},{default:t(()=>[A(B(q.$t("common.cancel")),1)]),_:1}),e(x,{type:"primary",class:"w-100px",onClick:w},{default:t(()=>[A(B(q.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(O,{ref_key:"formRef",ref:u,"label-width":120,"label-placement":"left",model:n.value,rules:h},{default:t(()=>[e(N,{responsive:"screen","item-responsive":""},{default:t(()=>[e(U,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:t(()=>[e(r,{filterable:"",clearable:"",placeholder:"请选择通道",value:n.value.targetDevice,"onUpdate:value":p[0]||(p[0]=b=>n.value.targetDevice=b),options:l(X)(l(g))},null,8,["value","options"])]),_:1}),e(U,{span:"24 m:12",label:"待移动设备",path:"EquipmentMerged"},{default:t(()=>[e(r,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.EquipmentMerged,"onUpdate:value":p[1]||(p[1]=b=>n.value.EquipmentMerged=b),options:l(X)(l(g))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),et={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ne(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Be(y)}const vt=Y({name:"configsetting_collectionservices_subdevicemanagement",__name:"index",setup(y){const j=ze(),C=le({channelList:[],chlIdAndNameMap:{}}),{columns:g,columnChecks:_,data:u,getData:n,loading:w,mobilePagination:R,searchParams:h,resetSearchParams:q}=Ee({apiFn:Oe,apiParams:{page:1,pageSize:20,limit:20,type:0,chlId:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",fixed:"left",width:48},{key:"id",title:"设备ID",align:"center",fixed:"left",width:60},{key:"devName",title:"设备名称",align:"center",width:100},{key:"chlId",title:"所属通道",align:"center",width:140,render:o=>e("span",null,[C.chlIdAndNameMap[o.chlId]])},{key:"devDesc",title:"设备描述",align:"center",width:140,render:o=>e("span",null,[o.devDesc?o.devDesc:"无"])},{key:"devCommAddr",title:"设备通信地址",align:"center",width:140},{key:"devPubAddr",title:"设备公共地址",align:"center",width:140},{key:"devValid",title:"有效性",align:"center",width:140,render:o=>{let a;return e(Te,{type:o.devValid==0?"error":"success"},ne(a=D(Ke[o.devValid]))?a:{default:()=>[a]})}},{key:"operate",title:D("common.operate"),align:"center",width:250,fixed:"right",render:o=>{let a;return e("div",{class:"flex-center gap-8px"},[e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>F(o)},{default:()=>["采集测点管理"]}),J(e(z,{type:"primary",ghost:!0,size:"small",onClick:()=>v(o.id)},ne(a=D("common.edit"))?a:{default:()=>[a]}),[[K("no-auth"),"device:update"]]),J(e(Je,{onPositiveClick:()=>c(o.id)},{default:()=>D("common.confirmDelete"),trigger:()=>{let i;return e(z,{type:"error",ghost:!0,size:"small"},ne(i=D("common.delete"))?i:{default:()=>[i]})}}),[[K("no-auth"),"device:delete"]])])}}]});async function p(){var i;const{data:o,error:a}=await pe({type:0});if(!a){if(o.length==0)return(i=window.$message)==null?void 0:i.warning("暂无通道，请先添加通道");C.channelList=o,o.forEach(S=>{C.chlIdAndNameMap[S.id]=S.chlName});const T=j.currentRoute.value.query.channelId;T&&(h.chlId=Number(T)),n()}}Pe(()=>{p()});const{drawerVisible:r,operateType:U,editingData:N,handleAdd:O,handleEdit:x,checkedRowKeys:$,onBatchDeleted:E,onDeleted:b}=Le(u,n),c=async o=>{const{data:a,error:i}=await Ve({ids:o});i||b()},s=o=>{h.chlId=o,n()},v=o=>{x(o)},I=V(!1),M=V(!1),F=o=>{j.push({path:"/configsetting/collectionservices/pointmanagement",query:{channelId:o.chlId,deviceId:o.id}})};return(o,a)=>{const i=Qe,T=Z,S=ce,k=Ie,G=Re,P=Q,f=Ne,d=we,ve=ye,fe=He,ge=je,he=K("no-space"),be=K("no-auth");return L(),_e("div",et,[e(ge,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(P,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(G,null,{default:t(()=>[e(i,null,{default:t(()=>[A("所属通道")]),_:1}),e(T,{filterable:"",clearable:"",placeholder:"请选择通道",value:l(h).chlId,"onUpdate:value":a[0]||(a[0]=m=>l(h).chlId=m),"label-field":"chlName","value-field":"id",options:C.channelList,onUpdateValue:s},null,8,["value","options"]),e(i,null,{default:t(()=>[A("设备名称")]),_:1}),J(e(S,{clearable:"",value:l(h).fuzzy,"onUpdate:value":a[1]||(a[1]=m=>l(h).fuzzy=m),placeholder:"请输入设备名称",style:{width:"100%"}},null,8,["value"]),[[he]]),e(l(z),{type:"primary",ghost:"",onClick:l(n)},{icon:t(()=>[e(k,{class:ee(["text-icon",{"animate-spin":l(w)}])},null,8,["class"])]),default:t(()=>[A(" "+B(l(D)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":t(()=>[e(P,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[J((L(),W(l(z),{onClick:l(O),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(f,{class:ee(["text-icon",{"animate-spin":l(w)}])},null,8,["class"])]),default:t(()=>[A(" "+B(l(D)("common.add")),1)]),_:1},8,["onClick"])),[[be,"device:insert"]]),e(l(z),{onClick:l(n),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(d,{class:ee(["text-icon",{"animate-spin":l(w)}])},null,8,["class"])]),_:1},8,["onClick"]),e(ve,{columns:l(_),"onUpdate:columns":a[2]||(a[2]=m=>te(_)?_.value=m:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(fe,{"checked-row-keys":l($),"onUpdate:checkedRowKeys":a[3]||(a[3]=m=>te($)?$.value=m:null),columns:l(g),data:l(u),size:"small",loading:l(w),remote:"","row-key":m=>m.id,pagination:l(u).length?l(R):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Xe,{visible:l(r),"onUpdate:visible":a[4]||(a[4]=m=>te(r)?r.value=m:null),onSubmitted:l(n),"operate-type":l(U),"row-data":l(N),chlId:l(h).chlId},null,8,["visible","onSubmitted","operate-type","row-data","chlId"]),e(Ye,{visible:I.value,"onUpdate:visible":a[5]||(a[5]=m=>I.value=m)},null,8,["visible"]),e(Ze,{visible:M.value,"onUpdate:visible":a[6]||(a[6]=m=>M.value=m)},null,8,["visible"])]),_:1})])}}});export{vt as default};
