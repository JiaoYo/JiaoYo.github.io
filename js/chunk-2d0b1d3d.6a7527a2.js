(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b1d3d"],{2207:function(e,a,t){"use strict";t.r(a);var l=function(){var e=this,a=e._self._c;return a("el-dialog",{attrs:{width:"800",visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(a){e.visible=a},opened:e.handleDialogOpenChange}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":"140px"},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.dataFormSubmitHandle()}}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{prop:"fileVersion",label:e.$t("upgrade.fileVersion")}},[a("el-input",{attrs:{placeholder:e.$t("upgrade.fileVersion"),maxlength:255,clearable:""},model:{value:e.dataForm.fileVersion,callback:function(a){e.$set(e.dataForm,"fileVersion",a)},expression:"dataForm.fileVersion"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{prop:"available",label:e.$t("upgrade.available")}},[a("el-radio-group",{model:{value:e.dataForm.available,callback:function(a){e.$set(e.dataForm,"available",a)},expression:"dataForm.available"}},e._l(e.availableList,(function(t){return a("el-radio",{key:t.label,attrs:{label:t.value}},[e._v("\n                            "+e._s(t.label)+"\n                        ")])})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{prop:"fileDesc",label:e.$t("upgrade.filedesc")}},[a("el-input",{attrs:{placeholder:e.$t("upgrade.filedesc"),maxlength:255,clearable:""},model:{value:e.dataForm.fileDesc,callback:function(a){e.$set(e.dataForm,"fileDesc",a)},expression:"dataForm.fileDesc"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{prop:"fileType",label:e.$t("upgrade.filetype")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("upgrade.pleaseSelect")},model:{value:e.dataForm.fileType,callback:function(a){e.$set(e.dataForm,"fileType",a)},expression:"dataForm.fileType"}},e._l(e.fileTypeList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{directives:[{name:"show",rawName:"v-show",value:1===e.dataForm.fileType,expression:"dataForm.fileType === 1"}],attrs:{span:12}},[a("el-form-item",[a("el-checkbox",{model:{value:e.dataForm.isChecked,callback:function(a){e.$set(e.dataForm,"isChecked",a)},expression:"dataForm.isChecked"}},[e._v(e._s(e.$t("upgrade.isItAFactoryPackage")))])],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"","label-width":"60px"}},[a("el-upload",{staticClass:"upload-demo",attrs:{drag:"",multiple:!0,"file-list":e.fileList,accept:"application/x-gzip, application/octet-stream","before-upload":e.handleBeforeUploadZip,"http-request":e.requestFile,"on-remove":e.removeFile,action:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text",domProps:{innerHTML:e._s(e.$t("upload.text"))}})])],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"","label-width":"60px"}},[a("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"","http-request":e.uploadSectionMd5File,"on-remove":e.handleMd5Remove,"file-list":e.md5CodeFileList,"before-upload":e.beforeMd5Upload}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text",domProps:{innerHTML:e._s(e.$t("upload.textMd5"))}})])],1)],1)],1)],1),a("template",{slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),a("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},i=[],r=(t("96cf"),t("1da1")),s=(t("a481"),t("7f7f"),t("28a5"),t("ac6a"),t("bc3a")),o=t.n(s),n=t("f744"),d=t("b047"),f=t.n(d),p=null,m={data:function(){return{visible:!1,loading:!1,interfaceMap:{},loadProgress:0,fileList:[],md5CodeFileList:[],md5CodeMap:{},uploadFileList:[],saveQueryParams:[],dataForm:{fileDesc:this.$t("upgrade.pleaseReviewTheCompleteUpdateLog"),fileVersion:"",available:1,fileType:1,isChecked:!1},availableList:[{label:this.$t("upgrade.yes"),value:1},{label:this.$t("upgrade.no"),value:0}],fileTypeList:[{label:this.$t("upgrade.upgradePack"),value:1},{label:this.$t("upgrade.factoryPack"),value:2}],domain:"https://firmware.linkqi.cn",rules:{fileVersion:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){this.visible=!0},handleDialogOpenChange:function(){var e=this;e.fileList=[],e.md5CodeMap={},e.md5CodeFileList=[],e.uploadFileList=[],e.saveQueryParams=[],e.loadProgress=0,e.loading=!1,e.getInterFaceInfo((function(){e.getInterfaceRootAndChildren(),e.$nextTick((function(){e.$notify({title:e.$t("prompt.title"),message:e.$t("upgrade.pleaseUploadTheMdFileFirstForMatching"),duration:2e3}),e.$refs["dataForm"].resetFields()}))}))},getInterFaceInfo:function(e){var a={_t:(new Date).getTime()};o.a.get("/interfaceInfo.json",{params:a}).then((function(a){var t=a.data;p=t,e()})).catch((function(e){return!1}))},getInterfaceRootAndChildren:function(){var e=this,a={};e.$hasPermission("interface:manu:select:permission.do")?e.$http.get("/gwtype/interface/selectMenu.do",{params:a}).then((function(a){var t=a.data;if(0!=t.code)return e.$message.error(t.data||t.msg);e.interfaceMap=t.data})):e.$message.warning("暂无权限, 请联系管理员")},removeFile:function(){this.loading=!1},handleBeforeUploadZip:function(e){var a=this,t="";return a.interfaceMap.forEach((function(a){(p[e.name.split("-")[1]]==a.model||a.hasOwnProperty("list")&&a.list.length>0&&-1!=a.list.indexOf(p[e.name.split("-")[1]]))&&(t="bin/"+a.model+"/"+e.name)})),t?!(e.size>104857600)||(a.$message.error(a.$t("upgrade.uploadFileSizeExceeds")),!1):(a.$message.error(e.name+a.$t("upgrade.noMatchingVersionNumberFound")),!1)},uploadWithSDK:function(e,a,t,l,i){var r=this;if(i){var s="";if(r.interfaceMap.forEach((function(e){(p[i.name.split("-")[1]]==e.model||e.hasOwnProperty("list")&&e.list.length>0&&-1!=e.list.indexOf(p[i.name.split("-")[1]]))&&(s="bin/"+e.model+"/"+i.name)})),!s)return r.$message.error(i.name+r.$t("upgrade.noMatchingVersionNumberFound"));if(i.size>1048576e3)return r.$message.error(r.$t("upgrade.uploadFileSizeExceeds"));r.fileList.push(i);var o=function(e){r.$message.error(e.data.error),r.loading=!1},d=function(e){r.uploadFileList.push(e.key),100==r.loadProgress&&r.uploadFileList.length==r.fileList.length&&(u.unsubscribe(),r.uploadFileList.forEach((function(e){r.interfaceMap.forEach((function(a){(p[e.split("ioserver_bin")[1].split("-")[1]]==a.model||a.hasOwnProperty("list")&&a.list.length>0&&-1!=a.list.indexOf(p[e.split("ioserver_bin")[1].split("-")[1]]))&&(1==r.dataForm.fileType&&r.dataForm.isChecked?(r.saveQueryParams.push({available:r.dataForm.available,file_desc:r.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:r.dataForm.fileType,file_url:r.domain.replace(/http:\/\//,"").replace(/https:\/\//,"")+"/"+e,file_version:r.dataForm.fileVersion,gw_model:a.model,patch_target:"",md5code:r.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?r.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""}),r.saveQueryParams.push({available:r.dataForm.available,file_desc:r.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:2,file_url:r.domain.replace(/http:\/\//,"").replace(/https:\/\//,"")+"/"+e,file_version:r.dataForm.fileVersion,gw_model:a.model,patch_target:"",md5code:r.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?r.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""})):r.saveQueryParams.push({available:r.dataForm.available,file_desc:r.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:r.dataForm.fileType,file_url:r.domain.replace(/http:\/\//,"").replace(/https:\/\//,"")+"/"+e,file_version:r.dataForm.fileVersion,gw_model:a.model,patch_target:"",md5code:r.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?r.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""}))}))})),r.loading=!1)},f=function(e){r.loadProgress=100*Math.round(e.total.percent/100)},m={next:f,error:o,complete:d},c=n["a"](i,s,e,a,t),u=c.subscribe(m)}},requestFile:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(a){var t,l,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this,l="",i=new FormData,i.append("multipartFile",a.file),t.interfaceMap.forEach((function(e){(p[file.name.split("-")[1]]==e.model||e.hasOwnProperty("list")&&e.list.length>0&&-1!=e.list.indexOf(p[file.name.split("-")[1]]))&&(l="bin/"+e.model+"/"+file.name)})),l){e.next=1;break}return e.abrupt("return",t.$message.error(file.name+"未找到匹配的版本号"));case 1:if(!(a.file.size>1048576e3)){e.next=2;break}return e.abrupt("return",t.$message.error("上传文件大小超过1000M"));case 2:t.loading=!0,t.fileList.push(a.file),t.$http.post("/goFastDfs/uploadFile.do",i).then((function(e){var a=e.data;0==a.code?(t.uploadFileList.push(a.data),t.uploadFileList.length==t.fileList.length&&(t.uploadFileList.forEach((function(e){t.interfaceMap.forEach((function(a){p[e.split("ioserver_bin")[1].split("-")[1]]==a.model?1==t.dataForm.fileType&&t.dataForm.isChecked?(t.saveQueryParams.push({available:t.dataForm.available,file_desc:t.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:t.dataForm.fileType,file_url:e,file_version:t.dataForm.fileVersion,gw_model:a.model,patch_target:"",md5code:t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""}),t.saveQueryParams.push({available:t.dataForm.available,file_desc:t.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:2,file_url:e,file_version:t.dataForm.fileVersion,gw_model:a.model,patch_target:"",md5code:t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""})):t.saveQueryParams.push({available:t.dataForm.available,file_desc:t.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:t.dataForm.fileType,file_url:e,file_version:t.dataForm.fileVersion,gw_model:a.model,patch_target:"",md5code:t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""}):a.hasOwnProperty("list")&&a.list.length>0&&-1!=a.list.indexOf(p[e.split("ioserver_bin")[1].split("-")[1]])&&(1==t.dataForm.fileType&&t.dataForm.isChecked?(t.saveQueryParams.push({available:t.dataForm.available,file_desc:t.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:t.dataForm.fileType,file_url:t.domain.replace(/http:\/\//,"").replace(/https:\/\//,"")+"/"+e,file_version:t.dataForm.fileVersion,gw_model:a.model,patch_target:"",md5code:t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""}),t.saveQueryParams.push({available:t.dataForm.available,file_desc:t.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:2,file_url:t.domain.replace(/http:\/\//,"").replace(/https:\/\//,"")+"/"+e,file_version:t.dataForm.fileVersion,gw_model:a.model,patch_target:"",md5code:t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""})):t.saveQueryParams.push({available:t.dataForm.available,file_desc:t.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:t.dataForm.fileType,file_url:t.domain.replace(/http:\/\//,"").replace(/https:\/\//,"")+"/"+e,file_version:t.dataForm.fileVersion,gw_model:a.model,patch_target:"",md5code:t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?t.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""}))}))})),t.loading=!1)):(t.$message.error(t.$t("template.uploadError")),t.loading=!1,t.handleRemove())})).catch((function(e){return t.loading=!1,!1}));case 3:case"end":return e.stop()}}),e,this)})));function a(a){return e.apply(this,arguments)}return a}(),beforeMd5Upload:function(e){if(-1==e.name.indexOf(".md5"))return this.$message.error(this.$t("upload.tip",{format:"md5"})),!1},handleMd5Remove:function(e,a){this.md5CodeMap={},this.md5CodeFileList=a,this.md5CodeFileList=[]},uploadSectionMd5File:function(e){this.md5CodeFileList.push(e.file),this.getUploadMd5Data(e.file)},getUploadMd5Data:function(e){var a=this;a.md5CodeMap={};var t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=function(e){var t=e.target.result.split("\n");t.length>0&&t.forEach((function(e){if(e){var t=e.split(/\s+/);t.length>1&&(a.md5CodeMap[t[1]]=t[0])}}))}},handleClose:f()((function(){this.fileList=[],this.saveQueryParams=[],this.loading=!1,this.loadProgress=0,this.visible=!1}),1e3,{leading:!0,trailing:!1}),dataFormSubmitHandle:f()((function(){var e=this;this.$refs["dataForm"].validate((function(a){return!!a&&(0===e.fileList.length||0==e.saveQueryParams.length?e.$message.info(e.$t("upgrade.pleaseUploadFile")):(e.saveQueryParams[0].fileVersion||e.saveQueryParams.forEach((function(a){a.file_version=e.dataForm.fileVersion})),void(e.$hasPermission("interface:insetList:permission.do")?(e.saveQueryParams.forEach((function(a){1==e.dataForm.fileType&&e.dataForm.isChecked?(a.file_version=e.dataForm.fileVersion,a.file_desc=e.dataForm.fileDesc,a.available=e.dataForm.available):(a.file_version=e.dataForm.fileVersion,a.file_desc=e.dataForm.fileDesc,a.available=e.dataForm.available,a.file_type=e.dataForm.fileType)})),e.$http.post("/gwtype/interface/insetList.do",e.saveQueryParams).then((function(a){var t=a.data;if(0!=t.code)return e.$message.error(t.data||t.msg);e.$message.success(t.msg),e.visible=!1,e.$emit("refreshDataList")})).catch((function(a){return e.visible=!1,e.$emit("refreshDataList"),!1}))):e.$message.warning("暂无版本新增权限, 请联系管理员"))))}))}),1e3,{leading:!0,trailing:!1})}},c=m,u=t("2877"),h=Object(u["a"])(c,l,i,!1,null,null,null);a["default"]=h.exports}}]);