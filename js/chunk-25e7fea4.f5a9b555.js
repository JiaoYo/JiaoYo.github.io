(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-25e7fea4"],{"1a16":function(e,t,a){},2491:function(e,t,a){"use strict";a("589d")},2950:function(e,t,a){"use strict";a.r(t);a("7f7f");var i=function(){var e=this,t=e._self._c;return t("section",[t("div",{attrs:{id:"formulaCalculationQueryContainer"}},[t("el-form",{attrs:{inline:!0,model:e.dataForm},nativeOn:{submit:function(e){e.preventDefault()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.querySearch()}}},[t("el-form-item",[t("el-input",{attrs:{size:"small",placeholder:e.$t("formulacalculation.pleaseEnterTargetPoint"),clearable:""},on:{clear:e.querySearch},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1),e.$hasPermission("formula:select:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",icon:"el-icon-search"},on:{click:function(t){return e.querySearch()}}},[e._v(e._s(e.$t("query")))])],1):e._e(),e.$hasPermission("formula:insert:permission.do")&&e.isShowSetting?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.handleAddOrUpdateChange()}}},[e._v("\n                    "+e._s(e.$t("add"))+"\n                ")])],1):e._e(),e.$hasPermission("formula:delete:permission.do")&&e.isShowSetting?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"danger",icon:"el-icon-delete",disabled:0===e.tagIds.length||0===e.dataList.length},on:{click:function(t){return e.handleDeleteChange()}}},[e._v("\n                    "+e._s(e.$t("deleteBatch"))+"\n                ")])],1):e._e(),e.$hasPermission("formula:select:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"success"},on:{click:e.getDataList}},[t("i",{staticClass:"el-icon-refresh"})])],1):e._e()],1)],1),e.scrollTableHeight?t("div",[t("vxe-table",{ref:"recordTable",staticStyle:{width:"100%"},attrs:{size:"mini",border:"",resizable:"","show-overflow":"","show-header-overflow":"","highlight-hover-row":"","highlight-current-row":"","max-height":e.scrollTableHeight,loading:e.dataListLoading,"row-config":{keyField:"id"},"checkbox-config":e.checkboxConfig,"empty-text":e.$t("formulacalculation.noData"),"scroll-y":{enabled:!0},"scroll-x":{enable:!0,scrollToLeftOnChange:!0}},on:{"checkbox-all":e.selectAll,"checkbox-change":e.dataListSelectionHandleChange,scroll:e.handleScrollChange}},[e.$hasPermission("formula:delete:permission.do")?t("vxe-table-column",{attrs:{type:"checkbox","header-align":"center",align:"center",width:"60",fixed:"left",checked:!1}}):e._e(),t("vxe-table-column",{attrs:{field:"tagName",title:e.$t("formulacalculation.targetPoint"),"header-align":"center",align:"center",width:"210",fixed:"left","show-overflow-tooltip":!0}}),t("vxe-table-column",{attrs:{field:"cycle",title:e.$t("formulacalculation.cycle"),"header-align":"center",align:"center",width:"120","show-overflow-tooltip":!0}}),t("vxe-table-column",{attrs:{field:"text",title:e.$t("formulacalculation.formula"),"header-align":"center",align:"center","min-width":200,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{attrs:{placement:"top",trigger:"hover","popper-class":"popperOtherClass","visible-arrow":!1}},[[t("div",{domProps:{innerHTML:e._s(e.formatterText(a.row,a.row.text))}})],t("div",{staticClass:"set-content",attrs:{slot:"reference"},slot:"reference"},[e._v("\n                            "+e._s(e.formatterText(a.row,a.row.text))+"\n                        ")])],2)]}}],null,!1,1591287663)}),t("vxe-table-column",{attrs:{field:"badCode",title:e.$t("formulacalculation.ignoreBadPixels"),"header-align":"center",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{size:"small",type:0==a.row.badCode?"danger":"success"}},[e._v("\n                        "+e._s(0==a.row.badCode?e.$t("no"):e.$t("yes"))+"\n                    ")])]}}],null,!1,1240317298)}),(e.$hasPermission("formula:update:permission.do")||e.$hasPermission("formula:delete:permission.do"))&&e.isShowSetting?t("vxe-table-column",{attrs:{title:e.$t("handle"),"header-align":"center",align:"center",width:"130",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.$hasPermission("formula:update:permission.do")?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleAddOrUpdateChange(a.row.id)}}},[e._v("\n                        "+e._s(e.$t("update"))+"\n                    ")]):e._e(),e.$hasPermission("formula:delete:permission.do")?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleDeleteChange(a.row.id)}}},[e._v("\n                        "+e._s(e.$t("delete"))+"\n                    ")]):e._e()]}}],null,!1,3097597120)}):e._e()],1),t("vxe-pager",{attrs:{perfect:"",size:"mini",loading:e.pagerLoading,"current-page":e.page,"page-size":e.limit,"page-sizes":[100,200,500,1e3,2e3,5e3,1e4],total:e.total,layouts:["PrevPage","JumpNumber","NextPage","FullJump","Sizes","Total"]},on:{"page-change":e.handlePageChange}})],1):e._e(),e.addOrUpdateVisible?t("add-or-update",{ref:"addOrUpdate",attrs:{id:e.dataForm.propId},on:{refreshDataList:e.getDataList}}):e._e()],1)},n=[],o=(a("ac6a"),a("c5f6"),a("a481"),a("b047")),r=a.n(o),l=a("d07e"),s={name:"formulacalculation",data:function(){return{isShowSetting:!1,pagerLoading:!1,checkboxConfig:{checkStrictly:!1,reserve:!0,highlight:!0,checkField:"checked"},addOrUpdateVisible:!1,currentPageCheccked:!1,selectedTagIdAndObjAddrList:[],multipleSelectionAll:[],scrollleft:0,scorlltop:0,page:1,limit:1e3,total:0,dataList:[],allCheck:!1,tagIds:[],dataListLoading:!1,scrollTableHeight:0,dataForm:{name:"",propId:null}}},components:{AddOrUpdate:l["default"]},methods:{pageSizeChangeHandle:function(e){this.page=1,this.limit=e,this.getDataList()},pageCurrentChangeHandle:function(e){this.page=e,this.getDataList()},querySearch:function(){var e=this;this.$hasSessionStorageGwsn()?(this.page=1,this.getDataList()):this.$message({showClose:!1,message:this.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})},handleScrollChange:function(e){e.type;var t=e.scrollTop,a=e.scrollLeft;this.scrollleft=a,this.scorlltop=t},getDataList:r()((function(){var e=this;if(this.$hasSessionStorageGwsn()){if(!this.$hasPermission("formula:select:permission.do"))return void this.$message.warning("暂无公式查询权限, 请联系管理员");var t={page:this.page,limit:this.limit,sn:sessionStorage.getItem("gwsn")};this.dataForm.name&&(t["fuzzy"]=this.dataForm.name.replace(/_/g,"\\_").replace(/%/g,"\\%")),this.total=0,this.dataList=[],this.dataListLoading=!0,this.pagerLoading=!0,this.$http.get("/formula/selectPage.do",{params:t}).then((function(a){var i=a.data;if(0!=i.code)return e.dataListLoading=!1,e.$message.error(i.data||i.msg);e.page=t.page,e.$nextTick((function(){e.dataList=i.data.list||[],e.$refs.recordTable&&(e.$refs.recordTable.clearCheckboxRow(),e.$refs.recordTable.loadData(e.dataList).then((function(){e.dataListLoading=!1,e.pagerLoading=!1,e.total=Number(i.data.total)||0})).finally((function(){if(e.dataList.length>0){if(e.$refs.recordTable.scrollTo(0,0),e.currentPageCheccked&&!e.allCheck&&(e.$set(e.checkboxConfig,"checkStrictly",!1),e.$refs.recordTable.setAllCheckboxRow(!1),e.tagIds=[],e.dataList.forEach((function(t){e.tagIds.push(t.id)})),e.$refs.recordTable.setAllCheckboxRow(!0)),!e.currentPageCheccked&&!e.allCheck)if(e.multipleSelectionAll.length>0){e.$set(e.checkboxConfig,"checkStrictly",!1),e.$refs.recordTable.setAllCheckboxRow(!1),e.tagIds=[];var t=!1;e.dataList.forEach((function(t){var a=e.multipleSelectionAll.length>0&&-1!==e.multipleSelectionAll.indexOf(t.id);a&&e.tagIds.push(t.id)})),e.multipleSelectionAll.forEach((function(a){e.dataList.forEach((function(i){i.id==a&&(t=!0,e.$refs.recordTable.setCheckboxRow(i,!0))}))})),t||(e.tagIds=[])}else e.$set(e.checkboxConfig,"checkStrictly",!1),e.$refs.recordTable.setAllCheckboxRow(!1);e.allCheck&&(e.$set(e.checkboxConfig,"checkStrictly",!1),e.$refs.recordTable.setAllCheckboxRow(!0),e.$set(e.checkboxConfig,"checkStrictly",!0),e.getAllChecked())}})))}))})).catch((function(t){return e.dataListLoading=!1,!1}))}else this.$message({showClose:!1,message:"未获取到网关编号",type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})}),1e3,{leading:!0,trailing:!1}),formatterText:function(e,t){return 0==e.type?t:1==e.type?t.replaceAll(",","+"):2==e.type?t.replaceAll(",","-"):3==e.type?t.replaceAll(",","*"):4==e.type?t.replaceAll(",","/"):8==e.type?t.replaceAll(",","&&"):9==e.type?t.replaceAll(",","||"):5==e.type?"GroupTone<equal>("+t+")":6==e.type?"GroupTone<average>("+t+")":7==e.type?"GroupControl("+t+")":void 0},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.page=t,this.limit=a,this.getDataList()},selectAll:function(e){var t=this;this.tagIds=[],e.records.length>0?(this.currentPageCheccked=!0,e.records.forEach((function(e){t.tagIds.push(e.id)}))):this.currentPageCheccked=!1,this.allCheck&&!e.checked&&this.$refs.recordTable&&this.$refs.recordTable.setCheckboxRow(this.$refs.recordTable.getRowById(e.row.id),!0)},dataListSelectionHandleChange:function(e){var t=this;this.tagIds=[],e.records.length>0&&e.records.forEach((function(e){t.tagIds.push(e.id)})),this.allCheck&&!e.checked&&this.$refs.recordTable&&this.$refs.recordTable.setCheckboxRow(this.$refs.recordTable.getRowById(e.row.id),!0)},reduceSame:function(e){var t={};return e.reduce((function(e,a){return!t[a.id]&&(t[a.id]=e.push(a)),e}),[])},handleAddOrUpdateChange:function(e){var t=this;if(this.dataForm.propId=null,e){if(this.dataForm.propId=e,!this.$hasPermission("formula:update:permission.do"))return void this.$message.warning("暂无公式计算修改权限, 请联系管理员")}else if(!this.$hasPermission("formula:insert:permission.do"))return void this.$message.warning("暂无公式计算新增权限, 请联系管理员");this.addOrUpdateVisible=!0,this.$nextTick((function(){t.$refs.addOrUpdate.init()}))},handleDeleteChange:r()((function(e){var t=this,a=[];if(t.$hasSessionStorageGwsn()){if(e?a.push(e):a=t.tagIds,0===a.length)return t.$message.error(t.$t("deleteInfo.noData"));if(!t.$hasPermission("formula:delete:permission.do"))return void t.$message.warning("暂无公式删除权限, 请联系管理员");t.$confirm(t.$t("deleteInfo.noticeTitle"),t.$t("deleteInfo.noticePrompt"),{confirmButtonText:t.$t("deleteInfo.confirm"),cancelButtonText:t.$t("deleteInfo.cancel"),type:"warning"}).then((function(){t.dataListLoading=!0,t.$http.delete("/formula/delete.do",{params:{ids:a.join(",")}}).then((function(e){var a=e.data;if(0!=a.code)return t.dataListLoading=!1,t.$message.error(a.data||t.$t("deleteInfo.deleteFail"));t.$message.success(t.$t("deleteInfo.deleteSuccess")),t.dataListLoading=!1,t.allCheck=!1,t.currentPageCheccked=!1,t.getDataList()})).catch((function(e){return t.dataListLoading=!1,t.getDataList(),!1}))})).catch((function(e){}))}else t.$message({showClose:!1,message:t.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),t.$router.replace({path:"/tgw-tgwinfo"})}})}),1e3,{leading:!0,trailing:!1})},mounted:function(){var e=this;e.isShowSetting=0!=sessionStorage.getItem("per"),e.$erd.listenTo(document.getElementById("formulaCalculationQueryContainer"),(function(t){var a=document.getElementById("formulaCalculationQueryContainer").offsetHeight;e.scrollTableHeight=window.innerHeight-130-a})),e.getDataList(),window.onresize=function(){return function(){if(document.getElementById("formulaCalculationQueryContainer")){var t=document.getElementById("formulaCalculationQueryContainer").offsetHeight;e.scrollTableHeight=window.innerHeight-130-t}}()}},watch:{total:function(){this.total==(this.page-1)*this.limit&&0!=this.total&&(this.page-=1,this.getDataList())},page:function(){this.currentPageCheccked=!1},multipleSelectionAll:function(){0!=this.multipleSelectionAll.length&&this.multipleSelectionAll.length==this.dataList.length||(this.currentPageCheccked=!1)},dataList:{handler:function(e){this.allCheck&&(this.$set(this.checkboxConfig,"checkStrictly",!1),this.$refs.recordTable&&this.$refs.recordTable.setAllCheckboxRow(!0),this.$set(this.checkboxConfig,"checkStrictly",!0))},deep:!0}}},c=s,d=(a("e14e"),a("2491"),a("2877")),h=Object(d["a"])(c,i,n,!1,null,"458d6a7d",null);t["default"]=h.exports},"589d":function(e,t,a){},e14e:function(e,t,a){"use strict";a("1a16")}}]);