(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c6493c8","chunk-529b2564"],{"0c53":function(e,t,a){"use strict";a("cccd3")},"2a1f":function(e,t,a){"use strict";a.r(t);a("34ef"),a("28a5"),a("6b54"),a("4917");
/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */
(function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return void new Blob}catch(n){}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},a=function(){this.data=[]},n=function(e,t,a){this.data=e,this.size=e.length,this.type=t,this.encoding=a},r=a.prototype,i=n.prototype,o=e.FileReaderSync,l=function(e){this.code=this[this.name=e]},s="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=s.length,d=e.URL||e.webkitURL||e,u=d.createObjectURL,f=d.revokeObjectURL,p=d,m=e.btoa,h=e.atob,v=e.ArrayBuffer,g=e.Uint8Array,b=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;n.fake=i.fake=!0;while(c--)l.prototype[s[c]]=c+1;return d.createObjectURL||(p=e.URL=function(e){var t,a=document.createElementNS("http://www.w3.org/1999/xhtml","a");return a.href=e,"origin"in a||("data:"===a.protocol.toLowerCase()?a.origin=null:(t=e.match(b),a.origin=t&&t[1])),a}),p.createObjectURL=function(e){var t,a=e.type;return null===a&&(a="application/octet-stream"),e instanceof n?(t="data:"+a,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):m?t+";base64,"+m(e.data):t+","+encodeURIComponent(e.data)):u?u.call(d,e):void 0},p.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&f&&f.call(d,e)},r.append=function(e){var a=this.data;if(g&&(e instanceof v||e instanceof g)){for(var r="",i=new g(e),s=0,c=i.length;s<c;s++)r+=String.fromCharCode(i[s]);a.push(r)}else if("Blob"===t(e)||"File"===t(e)){if(!o)throw new l("NOT_READABLE_ERR");var d=new o;a.push(d.readAsBinaryString(e))}else e instanceof n?"base64"===e.encoding&&h?a.push(h(e.data)):"URI"===e.encoding?a.push(decodeURIComponent(e.data)):"raw"===e.encoding&&a.push(e.data):("string"!==typeof e&&(e+=""),a.push(unescape(encodeURIComponent(e))))},r.getBlob=function(e){return arguments.length||(e=null),new n(this.data.join(""),e,"raw")},r.toString=function(){return"[object BlobBuilder]"},i.slice=function(e,t,a){var r=arguments.length;return r<3&&(a=null),new n(this.data.slice(e,r>1?t:this.data.length),a,this.encoding)},i.toString=function(){return"[object Blob]"},i.close=function(){this.size=0,delete this.data},a}(e);e.Blob=function(e,a){var n=a&&a.type||"",r=new t;if(e)for(var i=0,o=e.length;i<o;i++)Uint8Array&&e[i]instanceof Uint8Array?r.append(e[i].buffer):r.append(e[i]);var l=r.getBlob(n);return!l.slice&&l.webkitSlice&&(l.slice=l.webkitSlice),l};var a=Object.getPrototypeOf||function(e){return e.__proto__};e.Blob.prototype=a(new e.Blob)})("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||void 0)},"2bc0":function(e,t,a){"use strict";a("d19c")},"376b":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));a("6b54"),a("34ef"),a("ac6a");function n(e,t){t&&(e+=1462);var a=Date.parse(e);return(a-new Date(Date.UTC(1899,11,30)))/864e5}function r(e,t){for(var a={},r={s:{c:1e7,r:1e7},e:{c:0,r:0}},i=0;i!=e.length;++i)for(var o=0;o!=e[i].length;++o){r.s.r>i&&(r.s.r=i),r.s.c>o&&(r.s.c=o),r.e.r<i&&(r.e.r=i),r.e.c<o&&(r.e.c=o);var l={v:e[i][o]};if(null!=l.v){var s=XLSX.utils.encode_cell({c:o,r:i});"number"===typeof l.v?l.t="n":"boolean"===typeof l.v?l.t="b":l.v instanceof Date?(l.t="n",l.z=XLSX.SSF._table[14],l.v=n(l.v)):l.t="s",a[s]=l}}return r.s.c<1e7&&(a["!ref"]=XLSX.utils.encode_range(r)),a}function i(){if(!(this instanceof i))return new i;this.SheetNames=[],this.Sheets={}}function o(e){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),n=0;n!=e.length;++n)a[n]=255&e.charCodeAt(n);return t}function l(e,t,a){var n=t;n.unshift(e);for(var l="SheetJS",s=new i,c=r(n),d=n.map((function(e){return e.map((function(e){return null==e?{wch:10}:e.toString().charCodeAt(0)>255?{wch:2*e.toString().length+5}:{wch:e.toString().length+5}}))})),u=d[0],f=1;f<d.length;f++)for(var p=0;p<d[f].length;p++)u[p]["wch"]<d[f][p]["wch"]&&(u[p]["wch"]=d[f][p]["wch"]);c["!cols"]=u,s.SheetNames.push(l),s.Sheets[l]=c;var m=XLSX.write(s,{bookType:"xlsx",bookSST:!1,type:"binary"}),h=a||"列表";saveAs(new Blob([o(m)],{type:"application/octet-stream"}),h+".xlsx")}a("2a1f"),a("0fd4"),a("1447")},4579:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose,footer:null},on:{"update:visible":function(t){e.visible=t}}},[t("el-steps",{attrs:{active:e.activeStep}},[t("el-step",{attrs:{title:"上传文件",icon:"el-icon-upload"}}),t("el-step",{attrs:{title:"新增驱动",icon:"el-icon-circle-check"}})],1),0==e.activeStep?t("div",[t("el-row",{staticStyle:{margin:"10px 0"}},[t("el-col",{attrs:{xs:24,sm:24,md:12,lg:12,xl:12}},[t("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"","show-file-list":!1,"http-request":e.uploadSectionFile,"file-list":e.fileList,"before-upload":e.beforeUpload,multiple:"",limit:300,"on-exceed":e.handleExceed}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")]),e._v(", 只能上传so文件")])])],1),t("el-col",{attrs:{xs:24,sm:24,md:12,lg:12,xl:12}},[t("el-input",{attrs:{type:"textarea",readonly:"",autosize:{minRows:8,maxRows:8},placeholder:"上传文件名称"},model:{value:e.fileNames,callback:function(t){e.fileNames=t},expression:"fileNames"}})],1)],1),t("el-row",[t("el-col",{attrs:{xs:24,sm:24,md:12,lg:12,xl:12}},[t("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"",accept:"application/json","http-request":e.uploadSectionJSONFile,"on-remove":e.handleJSONRemove,"file-list":e.fileJSONList,"before-upload":e.beforeJSONUpload}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")]),e._v(", 只能上传json文件")])])],1)],1)],1):e._e(),1==e.activeStep?t("div",[t("el-row",[t("el-col",{attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[t("vxe-table",{ref:"recordTable",staticStyle:{width:"100%"},attrs:{size:"medium",border:"",resizable:"","auto-resize":"","sync-resize":"","show-overflow":"","show-header-overflow":"","highlight-hover-row":"","highlight-current-row":"",data:e.dataList,"max-height":"400"}},[t("vxe-table-column",{key:"1",attrs:{field:"name",title:"驱动名称","header-align":"center",align:"center",width:"230",fixed:"left","show-overflow-tooltip":!0}}),t("vxe-table-column",{key:"2",attrs:{field:"platform",title:"平台","header-align":"center",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[e.fileJSONList.length>0?t("span",[e._v(e._s(0==a.row.platform?"A7":1==a.row.platform?"arm9":2==a.row.platform?"x86-linux":3==a.row.platform?"A53":4==a.row.platform?"A9":"--"))]):t("el-select",{on:{change:function(t){return e.handlePlantFormChange(a.row)}},model:{value:a.row.platform,callback:function(t){e.$set(a.row,"platform",t)},expression:"scope.row.platform"}},e._l(e.plantformList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}],null,!1,372935393)}),t("vxe-table-column",{key:"3",attrs:{field:"mainVer",title:"主版本","header-align":"center",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[e.fileJSONList.length>0?t("span",[e._v(e._s(a.row.mainVer))]):t("el-input-number",{attrs:{min:1},model:{value:a.row.mainVer,callback:function(t){e.$set(a.row,"mainVer",t)},expression:"scope.row.mainVer"}})]}}],null,!1,3535865292)}),t("vxe-table-column",{key:"4",attrs:{field:"subVer",title:"子版本","header-align":"center",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[e.fileJSONList.length>0?t("span",[e._v(e._s(a.row.subVer))]):t("el-input-number",{attrs:{min:1},model:{value:a.row.subVer,callback:function(t){e.$set(a.row,"subVer",t)},expression:"scope.row.subVer"}})]}}],null,!1,2168432108)})],1)],1)],1)],1):e._e(),t("template",{slot:"footer"},[0==e.activeStep?t("div",[t("el-button",{on:{click:e.handleClose}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleNextStepChange}},[e._v("下一步")])],1):e._e(),1==e.activeStep?t("div",[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1):e._e()])],2)},r=[],i=(a("20d6"),a("2909")),o=(a("6762"),a("2fdb"),a("ac6a"),a("7f7f"),a("b047")),l=a.n(o),s={props:["platform","drivePropId"],data:function(){return{visible:!1,activeStep:0,fileList:[],fileNames:"",fileNameList:[],fileJSONList:[],dataList:[],storeDataList:[],plantformList:[{label:"A7",value:0},{label:"arm9",value:1},{label:"x86-linux",value:2},{label:"A53",value:3},{label:"A9",value:4}],plantMainSunVerMap:{}}},methods:{init:function(){var e=this;this.visible=!0,this.$nextTick((function(){e.activeStep=0,e.fileList=[],e.dataList=[],e.fileNameList=[],e.fileNames="",e.fileJSONList=[],e.plantMainSunVerMap={}}))},beforeUpload:function(e){if(-1==e.name.indexOf(".so"))return this.$message.error(this.$t("upload.tip",{format:"so"})),!1},handleRemove:function(e,t){this.fileNameList=this.fileNameList.filter((function(t){return t+".so"!==e.name})),this.fileList=t,this.fileNames=this.fileNameList.length>0?this.fileNameList.join(","):""},handleExceed:function(e,t){this.$message.warning("$t('driver.currentlyLimitFielsToSelect') ".concat(e.length," $t('driver.filesTotalSelected') ").concat(e.length+t.length," $t('driver.files')"))},uploadSectionFile:function(e){this.fileList.push(e.file),this.fileNameList.push(e.file.name.substring(0,e.file.name.lastIndexOf(".so"))),this.fileNames=this.fileNameList.join(",")},beforeJSONUpload:function(e){if("application/json"!=e.type||-1==e.name.indexOf(".json"))return this.$message.error(this.$t("upload.tip",{format:"json"})),!1},handleJSONRemove:function(e,t){this.fileJSONList=t},uploadSectionJSONFile:function(e){this.fileJSONList.push(e.file),this.getUploadJsonData(e.file)},getUploadJsonData:function(e){var t=this;t.storeDataList=[];var a=new FileReader;a.readAsText(e,"UTF-8"),a.onload=function(e){var a=JSON.parse(e.target.result);a.length>0&&a.forEach((function(e){t.storeDataList.push({name:e.libName,platform:e.platform,mainVer:e.mainVer,subVer:e.subVer})}))}},handleNextStepChange:function(){var e=this,t=!0,a=[];if(e.dataList=[],0==e.fileNameList.length||0==e.fileList.length)return e.$message.warning(e.$t("driver.pleaseUploadSoFileFirst"));if(e.fileJSONList.length>0)if(e.storeDataList.length<e.fileNameList.length){var n=e.storeDataList.map((function(e){return e.name}));a=n.filter((function(t){return!e.fileNameList.includes(t)})),a.length>0?(t=!1,e.storeDataList.forEach((function(t){a.includes(t.name)||e.dataList.push(t)}))):e.dataList=e.storeDataList}else{e.fileNameList.forEach((function(t){e.storeDataList.forEach((function(a){t==a.name&&e.dataList.push(a)}))}));var r=e.storeDataList.map((function(e){return e.name}));a=r.filter((function(t){return!e.fileNameList.includes(t)})),a.length>0&&(t=!1)}else{t=!0;var o=parseInt(e.platform);e.$http.get("/drivers/driversVersion.do",{params:{libNames:e.fileNameList.join(",")}}).then((function(t){var a=t.data;if(0!=a.code)return e.$message.error(a.data||a.msg);if("{}"!=JSON.stringify(a.data)){for(var n in e.plantMainSunVerMap={},a.data)a.data[n].length>0&&a.data[n].forEach((function(t){e.plantMainSunVerMap.hasOwnProperty(t.libName+"&"+t.platform)?(e.plantMainSunVerMap[t.libName+"&"+t.platform].mainVer.push(t.mainVer),e.plantMainSunVerMap[t.libName+"&"+t.platform].subVer.push(t.subVer)):e.plantMainSunVerMap[t.libName+"&"+t.platform]={mainVer:[t.mainVer],subVer:[t.subVer]}}));e.fileNameList.forEach((function(t){var a=-1,n=-1,r=-1;0==o||1==o||2==o||3==o||4==o?e.plantMainSunVerMap.hasOwnProperty(t+"&"+o)&&e.plantMainSunVerMap[t+"&"+o].mainVer.length>0&&(n=Math.max.apply(Math,Object(i["a"])(e.plantMainSunVerMap[t+"&"+o].mainVer)),a=e.plantMainSunVerMap[t+"&"+o].mainVer.findIndex((function(e){return e==n})),r=e.plantMainSunVerMap[t+"&"+o].subVer[a]):e.plantMainSunVerMap.hasOwnProperty(t+"&0")&&e.plantMainSunVerMap[t+"&0"].mainVer.length>0&&(n=Math.max.apply(Math,Object(i["a"])(e.plantMainSunVerMap[t+"&0"].mainVer)),a=e.plantMainSunVerMap[t+"&0"].mainVer.findIndex((function(e){return e==n})),r=e.plantMainSunVerMap[t+"&0"].subVer[a]),e.dataList.push({name:t,platform:0==o||1==o||2==o||3==o||4==o?o:0,mainVer:-1!=a?n:1,subVer:-1!=a?r:1})}))}else e.fileNameList.forEach((function(t){e.dataList.push({name:t,platform:0==o||1==o||2==o||3==o||4==o?o:0,mainVer:null,subVer:null})}))}))}t?e.activeStep=1:e.fileJSONList.length>0&&e.$confirm(e.$t("driver.missingFromSoFile")+a.join("、")+e.$t("driver.waitFiles")+","+e.$t("driver.whetherToContinue"),e.$t("prompt.title"),{confirmButtonText:e.$t("confirm"),cancelButtonText:e.$t("cancel"),type:"warning"}).then((function(){e.activeStep=1})).catch((function(){}))},handlePlantFormChange:function(e){var t=-1,a=-1,n=-1;this.plantMainSunVerMap.hasOwnProperty(e.name+"&"+e.platform)&&this.plantMainSunVerMap[e.name+"&"+e.platform].mainVer.length>0&&(a=Math.max.apply(Math,Object(i["a"])(this.plantMainSunVerMap[e.name+"&"+e.platform].mainVer)),t=this.plantMainSunVerMap[e.name+"&"+e.platform].mainVer.findIndex((function(e){return e==a})),n=this.plantMainSunVerMap[e.name+"&"+e.platform].subVer[t]),-1!=t?(e.mainVer=a,e.subVer=n):(e.mainVer=1,e.subVer=1)},handleClose:function(){this.fileList=[],this.dataList=[],this.fileNameList=[],this.fileNames="",this.fileJSONList=[],this.plantMainSunVerMap={},this.visible=!1},dataFormSubmitHandle:l()((function(){var e=this,t=this,a=[],n=[];if(t.$hasPermission("drivers:upload:permission.do"))if(t.fileJSONList.length>0){t.dataList.forEach((function(e){t.fileList.forEach((function(r){if(e.name+".so"==r.name){var i=new FormData;i.append("file",r),i.append("platform",e.platform),i.append("mainVer",e.mainVer),i.append("subVer",e.subVer),t.$http.post("/drivers/upload.do",i).then((function(t){var r=t.data;0!=r.code&&(a.push(e.name),n.push(e))}))}}))}));var r=function(){if(!(a.length>0))return t.$message.success(t.$t("prompt.success")),t.handleClose(),t.$emit("refreshDataList");e.$confirm(a.join(",")+e.$t("driver.soFileUploadFailsWantToContinueUpload"),e.$t("prompt.title"),{confirmButtonText:e.$t("confirm"),cancelButtonText:e.$t("cancel"),type:"warning"}).then((function(){a=[],n=[],n.forEach((function(e){t.fileList.forEach((function(r){if(e.name+".so"==r.name){var i=new FormData;i.append("file",r),i.append("platform",e.platform),i.append("mainVer",e.mainVer),i.append("subVer",e.subVer),t.$http.post("/drivers/upload.do",i).then((function(t){var r=t.data;0!=r.code&&(a.push(e.name),n.push(i))}))}}))}))})).catch((function(){return t.handleClose(),t.$emit("refreshDataList")}))};r()}else{var i=!0;if(t.dataList.forEach((function(e){e.mainVer&&e.subVer||(i=!1)})),!i)return t.$message.warning(t.$t("driver.mainversionAndSubversionCannotBeEmpty"));t.dataList.forEach((function(e){t.fileList.forEach((function(r){if(e.name+".so"==r.name){var i=new FormData;i.append("file",r),i.append("platform",e.platform),i.append("mainVer",e.mainVer),i.append("subVer",e.subVer),t.$http.post("/drivers/upload.do",i).then((function(t){var r=t.data;0!=r.code&&(a.push(e.name),n.push(e))}))}}))}));var o=function(){if(!(a.length>0))return t.$message.success(t.$t("prompt.success")),t.handleClose(),t.$emit("refreshDataList");e.$confirm(a.join(",")+e.$t("driver.soFileUploadFailsWantToContinueUpload"),e.$t("prompt.title"),{confirmButtonText:e.$t("confirm"),cancelButtonText:e.$t("cancel"),type:"warning"}).then((function(){a=[],n=[],n.forEach((function(e){t.fileList.forEach((function(r){if(e.name+".so"==r.name){var i=new FormData;i.append("file",r),i.append("platform",e.platform),i.append("mainVer",e.mainVer),i.append("subVer",e.subVer),t.$http.post("/drivers/upload.do",i).then((function(t){var r=t.data;0!=r.code&&(a.push(e.name),n.push(i))}))}}))}))})).catch((function(){return t.handleClose(),t.$emit("refreshDataList")}))};o()}else t.$message.warning("暂无驱动上传权限, 请联系管理员")}),1e3,{leading:!0,trailing:!1})}},c=s,d=(a("2bc0"),a("0c53"),a("2877")),u=Object(d["a"])(c,n,r,!1,null,"4cbfe774",null);t["default"]=u.exports},"52b4":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-card",{attrs:{shadow:"never"}},[t("el-form",{attrs:{inline:!0,model:e.dataForm},nativeOn:{submit:function(e){e.preventDefault()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.querySearch.apply(null,arguments)}}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[t("el-form-item",{attrs:{label:e.$t("driver.platform")}},[t("el-select",{attrs:{size:"small",placeholder:e.$t("driver.pleaseSelectPlatform"),clearable:""},on:{clear:e.querySearch,change:e.querySearch},model:{value:e.dataForm.plantform,callback:function(t){e.$set(e.dataForm,"plantform",t)},expression:"dataForm.plantform"}},e._l(e.plantformList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:e.$t("driver.driverMainVersion")}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("driver.pleaseEnterDriverMainVersion"),clearable:""},on:{clear:e.querySearch},model:{value:e.dataForm.mainVer,callback:function(t){e.$set(e.dataForm,"mainVer",t)},expression:"dataForm.mainVer"}})],1),t("el-form-item",[t("el-input",{attrs:{size:"small",placeholder:e.$t("driver.pleaseEnterNameOrDriverName"),clearable:""},on:{clear:e.querySearch},model:{value:e.dataForm.driveName,callback:function(t){e.$set(e.dataForm,"driveName",t)},expression:"dataForm.driveName"}})],1),e.$hasPermission("drivers:select:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",icon:"el-icon-search"},on:{click:e.querySearch}},[e._v(e._s(e.$t("query")))])],1):e._e(),1==e.currentUserSuperAdmin&&e.$hasPermission("drivers:upload:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.handleAddOrUpdate()}}},[e._v("\n                        "+e._s(e.$t("add"))+"\n                    ")])],1):e._e(),e.$hasPermission("drivers:download:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-download"},on:{click:function(t){return e.handleDownLoadDriveChange()}}},[e._v(e._s(e.$t("driver.multipeDownLoad")))])],1):e._e(),e.$hasPermission("drivers:select:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-download"},on:{click:function(t){return e.handleExportExcel()}}},[e._v(e._s(e.$t("export")))])],1):e._e(),e.$hasPermission("drivers:select:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"success"},on:{click:e.getDataList}},[t("i",{staticClass:"el-icon-refresh"})])],1):e._e()],1)],1)],1),t("vxe-table",{ref:"recordTable",staticStyle:{width:"100%"},attrs:{size:"small",border:"",resizable:"","auto-resize":"","sync-resize":"","show-overflow":"","show-header-overflow":"","highlight-hover-row":"","highlight-current-row":"","max-height":e.scrollTableHeight,loading:e.dataListLoading,"row-config":{keyField:"id"},"checkbox-config":e.checkboxConfig},on:{"checkbox-all":e.selectAll,"checkbox-change":e.dataListSelectionHandle}},[e.$hasPermission("drivers:select:permission.do")&&e.$hasPermission("drivers:download:permission.do")?t("vxe-table-column",{key:"1",attrs:{type:"checkbox","header-align":"center",align:"center",width:"60",fixed:"left"}}):e._e(),t("vxe-table-column",{key:"2",attrs:{field:"name",title:e.$t("driver.name"),"header-align":"center",align:"center",fixed:"left"}}),t("vxe-table-column",{key:"3",attrs:{field:"libName",title:e.$t("driver.driverName"),"header-align":"center",align:"center","show-overflow-tooltip":!0}}),t("vxe-table-column",{key:"4",attrs:{field:"platform",title:e.$t("driver.platform"),"header-align":"center",align:"center",width:"160","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(0==t.row.platform?"A7":1==t.row.platform?"arm9":2==t.row.platform?"x86-linux":3==t.row.platform?"A53":4==t.row.platform?"A9":"--")+"\n            ")]}}])}),t("vxe-table-column",{key:"5",attrs:{field:"mainVer",title:e.$t("driver.driverMainVersion"),"header-align":"center",align:"center",width:"160","show-overflow-tooltip":!0}}),t("vxe-table-column",{key:"6",attrs:{field:"subVer",title:e.$t("driver.driverSubVersion"),"header-align":"center",align:"center",width:"160","show-overflow-tooltip":!0}}),t("vxe-table-column",{key:"7",attrs:{field:"username",title:e.$t("driver.creator"),"header-align":"center",align:"center","min-width":"160","show-overflow-tooltip":!0}}),t("vxe-table-column",{key:"8",attrs:{field:"dbTime",title:e.$t("driver.createDate"),"header-align":"center",align:"center",width:"160","show-overflow-tooltip":!0}}),e.$hasPermission("drivers:download:permission.do")?t("vxe-table-column",{key:"9",attrs:{title:e.$t("handle"),"header-align":"center",align:"center",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.$hasPermission("drivers:download:permission.do")?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDownLoadDriveChange(a.row)}}},[e._v(e._s(e.$t("driver.download")))]):e._e()]}}],null,!1,3333520609)}):e._e()],1),t("el-pagination",{attrs:{"current-page":e.page,"page-sizes":[20,50,100,200],"page-size":e.limit,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.pageSizeChangeHandle,"current-change":e.pageCurrentChangeHandle}}),e.driveVisible?t("driveAddOrUpdate",{ref:"driveOptionRef",attrs:{platform:e.dataForm.plantform,drivePropId:e.drivePropId},on:{refreshDataList:e.getDataList}}):e._e()],1)},r=[],i=(a("7f7f"),a("4917"),a("ac6a"),a("c5f6"),a("a481"),a("b047")),o=a.n(i),l=a("376b"),s=a("4579"),c={data:function(){return{page:1,limit:20,total:0,drivePropId:null,driveVisible:!1,currentUserSuperAdmin:null,dataListLoading:!1,checkedDriveIds:[],dataList:[],dataForm:{driveName:"",plantform:null,mainVer:""},checkboxConfig:{reserve:!0,highlight:!0},plantformList:[{label:"A7",value:0},{label:"arm9",value:1},{label:"x86-linux",value:2},{label:"A53",value:3},{label:"A9",value:4}],scrollTableHeight:window.innerHeight-220-53}},components:{driveAddOrUpdate:s["default"]},methods:{pageSizeChangeHandle:function(e){this.page=1,this.limit=e,this.getDataList()},pageCurrentChangeHandle:function(e){this.page=e,this.getDataList()},querySearch:function(){this.page=1,this.getDataList()},getDataList:o()((function(){var e=this,t=[],a=!1,n={pageNum:this.page,pageSize:this.limit};this.dataForm.driveName&&(n["fuzzy"]=this.dataForm.driveName.replace(/_/g,"\\_").replace(/%/g,"\\%")),null!=this.dataForm.plantform&&(n["plantform"]=this.dataForm.plantform),this.dataForm.mainVer&&(n["mainVer"]=String(this.dataForm.mainVer).replace(/_/g,"\\_").replace(/%/g,"\\%")),this.total=0,this.dataList=[],this.$hasPermission("drivers:select:permission.do")?(this.dataListLoading=!0,this.$http.get("/drivers/page.do",{params:n}).then((function(r){var i=r.data;if(e.gwsns=[],0!=i.code)return e.dataListLoading=!1,e.$message.error(i.data||i.msg);e.page=n.pageNum,e.dataList=i.data.list,e.total=Number(i.data.total),e.dataListLoading=!1,e.$refs.recordTable.loadData(e.dataList).then((function(){e.dataListLoading=!1})).finally((function(){e.$refs.recordTable&&(e.$refs.recordTable.setAllCheckboxRow(!1),e.checkedDriveIds.forEach((function(n){e.dataList.forEach((function(r){r.id==n&&(a=!0,t.push(r.id),e.$refs.recordTable.setCheckboxRow(r,!0))}))})),e.checkedDriveIds=a?t:[])}))})).catch((function(t){return e.dataListLoading=!1,!1}))):this.$message.warning("暂无驱动查询权限, 请联系管理员")}),100,{leading:!0,trailing:!1}),getRowKey:function(e){return e.id},handleAddOrUpdate:function(){var e=this;this.driveVisible=!0,this.$nextTick((function(){e.$refs.driveOptionRef.init()}))},selectAll:function(e){var t=this,a=this.$refs.recordTable.getCheckboxReserveRecords().concat(this.$refs.recordTable.getCheckboxRecords());this.checkedDriveIds=[],a.forEach((function(e){t.checkedDriveIds.push(e.id)}))},dataListSelectionHandle:function(e){var t=this,a=this.$refs.recordTable.getCheckboxReserveRecords().concat(this.$refs.recordTable.getCheckboxRecords());this.checkedDriveIds=[],a.forEach((function(e){t.checkedDriveIds.push(e.id)}))},browserType:function(){var e=navigator.userAgent.toLowerCase(),t={ie:function(){return!(!window.ActiveXObject&&!("ActiveXObject"in window))},edge:function(){return/dge/.test(e)},chrome:function(){return/chrome/.test(e)},safari:function(){return/safari/.test(e)&&!/chrome/.test(e)},opera:function(){return/opera/.test(e)},msie:function(){return/msie/.test(e)&&!/opera/.test(e)},mozilla:function(){return/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)}},a={};for(var n in t){var r=t[n](),i=(e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1];if(r)return a.browser=n,a.version=i,a}},handleDownLoadDriveChange:function(e){var t=this,a={};if(e)a["ids"]=e.id;else{if(0===t.checkedDriveIds.length)return t.$message.warning(t.$t("driver.pleaseSelectDataSourceToDownload"));a["ids"]=t.checkedDriveIds.join(",")}t.$hasPermission("drivers:download:permission.do")?t.$http.get("/drivers/download.do",{params:a}).then((function(e){var a=e.data;if(0!=a.code)return t.$message.error(a.data||a.msg);var n=a.data,r=new XMLHttpRequest;r.open("get",n),r.responseType="blob",r.send(),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=t.browserType();if("ie"!==e.browser||"10.0"!=e.version&&"11.0"!=e.version)window.location.href=n;else{var a=document.createElement("iframe");a.src=n,a.style.display="none",document.body.appendChild(a)}}}})).catch((function(e){return t.getDataList(),!1})):t.$message.warning("暂无驱动下载权限, 请联系管理员")},handleDeleteDriveChange:o()((function(e){var t=this,a={};if(e)a["ids"]=e.id;else{if(0===t.checkedDriveIds.length)return t.$message.error(t.$t("deleteInfo.noData"));a["ids"]=t.checkedDriveIds.join(",")}t.$hasPermission("drivers:delete:permission.do")?t.$confirm(t.$t("deleteInfo.noticeTitle"),t.$t("deleteInfo.noticePrompt"),{confirmButtonText:t.$t("deleteInfo.confirm"),cancelButtonText:t.$t("deleteInfo.cancel"),type:"warning"}).then((function(){t.$http.delete("/drivers/delete.do",{params:a}).then((function(e){var a=e.data;if(0!=a.code)return t.$message.error(a.data||a.msg);t.$message.success(t.$t("deleteInfo.deleteSuccess")),t.getDataList()})).catch((function(e){return t.getDataList(),!1}))})).catch((function(e){})):t.$message.warning("暂无驱动删除权限, 请联系管理员")}),100,{leading:!0,trailing:!1}),resetExcelData:function(e){var t=[];this.dataList.forEach((function(e){var a={name:e.name,libName:e.libName,platform:0==e.platform?"A7":1==e.platform?"arm9":2==e.platform?"x86-linux":3==e.platform?"A53":4==e.platform?"A9":"--",mainVer:e.mainVer,subVer:e.subVer,username:e.username,dbTime:e.dbTime};t.push(a)})),e(t)},handleExportExcel:o()((function(){var e=this;if(0==this.dataList.length)return this.$message.warning(this.$t("gwsn.thereIsCurrentlyNoDataAvailableForExport"));Promise.resolve().then(function(){e.resetExcelData((function(t){for(var a=[{label:e.$t("driver.name"),prop:"name"},{label:e.$t("driver.driverName"),prop:"libName"},{label:e.$t("driver.platform"),prop:"platform"},{label:e.$t("driver.driverMainVersion"),prop:"mainVer"},{label:e.$t("driver.driverSubVersion"),prop:"subVer"},{label:e.$t("driver.creator"),prop:"username"},{label:e.$t("driver.createDate"),prop:"dbTime"}],n=[],r=[],i=0;i<a.length;i++)n[i]=a[i].label,r[i]=a[i].prop;var o=n,s=r,c=t,d=e.formatJson(s,c);Object(l["a"])(o,d,e.$t("driver.driverList")+"_"+(new Date).getTime())}))}.bind(null,a)).catch(a.oe)}),1e3,{leading:!0,trailing:!1}),formatJson:function(e,t){return t.map((function(t){return e.map((function(e){return t[e]}))})),t.map((function(t){return e.map((function(e){return t[e]}))}))}},updated:function(){this.$refs.recordTable&&this.$refs.recordTable.doLayout&&this.$refs.recordTable.doLayout()},mounted:function(){var e=this;"{}"!=JSON.stringify(this.$route.query)?(this.dataForm.plantform=Number(this.$route.query.plantform),this.dataForm.mainVer=Number(this.$route.query.mainVer)):(this.dataForm.plantform=null,this.dataForm.mainVer=""),this.currentUserSuperAdmin=this.$store.state.user.superAdmin,this.getDataList(),window.onresize=function(){return function(){e.scrollTableHeight=window.innerHeight-220-53,e.$refs.recordTable&&e.$refs.recordTable.doLayout&&e.$refs.recordTable.doLayout()}()}},watch:{total:function(){this.total==(this.page-1)*this.limit&&0!=this.total&&(this.page-=1,sessionStorage.setItem("page9",this.page),this.getDataList())}}},d=c,u=a("2877"),f=Object(u["a"])(d,n,r,!1,null,null,null);t["default"]=f.exports},cccd3:function(e,t,a){},d19c:function(e,t,a){}}]);