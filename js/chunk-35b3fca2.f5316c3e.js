(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-35b3fca2"],{"1a19":function(e,t,a){},"5d31":function(e,t,a){"use strict";a("1a19")},e70c:function(e,t,a){"use strict";a.r(t);a("a481");var i=function(){var e=this,t=e._self._c;return t("section",[t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":(e.$i18n.locale,"140px")},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"是否输入网关编号",prop:"img7"}},[t("el-radio-group",{attrs:{size:"small"},model:{value:e.dataForm.img7,callback:function(t){e.$set(e.dataForm,"img7",t)},expression:"dataForm.img7"}},e._l(e.typeList,(function(a,i){return t("el-radio",{key:i,attrs:{label:a.value}},[e._v("\n                                "+e._s(a.label)+"\n                            ")])})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"客户名称",prop:"userId"}},[t("el-select",{directives:[{name:"el-select-loadmore",rawName:"v-el-select-loadmore:rangeNumber",value:e.loadMore(e.rangeNumber),expression:"loadMore(rangeNumber)",arg:"rangeNumber"}],staticStyle:{width:"100%"},attrs:{clearable:"",size:"small",placeholder:"请选择客户名称"},on:{clear:e.handleUserClearChange,"visible-change":e.handleUserVisibleChange},model:{value:e.dataForm.userId,callback:function(t){e.$set(e.dataForm,"userId",t)},expression:"dataForm.userId"}},[[t("el-input",{ref:"userInput",staticStyle:{width:"98%",position:"absolute",left:"1%",top:"0","z-index":"99"},attrs:{autofocus:"",size:"small",clearable:"",placeholder:"请输入搜索内容"},model:{value:e.userSearch,callback:function(t){e.userSearch=t},expression:"userSearch"}}),t("div",{staticStyle:{width:"100%",height:"32px"}}),e._l(e.showUserList.slice(0,e.rangeNumber),(function(e){return t("el-option",{key:e.label,attrs:{label:e.label,value:e.value,disabled:!!e.disabled&&e.disabled}})}))]],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"合同编号",prop:"productNum"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入合同编号",clearable:""},model:{value:e.dataForm.productNum,callback:function(t){e.$set(e.dataForm,"productNum",t)},expression:"dataForm.productNum"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"技术服务",prop:"technicalService"}},[t("el-radio-group",{attrs:{size:"small"},model:{value:e.dataForm.technicalService,callback:function(t){e.$set(e.dataForm,"technicalService",t)},expression:"dataForm.technicalService"}},e._l(e.technicalServiceList,(function(a,i){return t("el-radio",{key:i,attrs:{label:a.value}},[e._v("\n                                "+e._s(a.label)+"\n                            ")])})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"质保时长(月)",prop:"warranty"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入质保时长",clearable:""},on:{input:function(t){e.dataForm.warranty=e.dataForm.warranty.replace(/^(0+)|[^\d]+/g,"")}},model:{value:e.dataForm.warranty,callback:function(t){e.$set(e.dataForm,"warranty",t)},expression:"dataForm.warranty"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"项目名称",prop:"company"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入项目名称",clearable:""},model:{value:e.dataForm.company,callback:function(t){e.$set(e.dataForm,"company",t)},expression:"dataForm.company"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"出库日期",prop:"odate"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"small",align:"right",type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"选择日期",clearable:!1,"picker-options":e.pickerOptions},model:{value:e.dataForm.odate,callback:function(t){e.$set(e.dataForm,"odate",t)},expression:"dataForm.odate"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"是否出库检测",prop:"checked"}},[t("el-switch",{attrs:{size:"small","active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.dataForm.checked,callback:function(t){e.$set(e.dataForm,"checked",t)},expression:"dataForm.checked"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"网关型号",prop:"img9"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"请选择网关型号"},on:{change:e.getModelDescList},model:{value:e.dataForm.img9,callback:function(t){e.$set(e.dataForm,"img9",t)},expression:"dataForm.img9"}},e._l(e.allModelList,(function(e){return t("el-option",{key:e.model,attrs:{label:e.model,value:e.model}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"客户型号",prop:"img8"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入客户型号",clearable:""},model:{value:e.dataForm.img8,callback:function(t){e.$set(e.dataForm,"img8",t)},expression:"dataForm.img8"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"录入网关数量"}},[t("span",{staticStyle:{"font-weight":"600"}},[e._v("已录入 "),t("span",{staticStyle:{"font-weight":"bolder","font-size":"20px"}},[e._v(e._s(e.snsLength))]),e._v(" 个网关")]),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"primary",disabled:!(e.snsLength>0)},on:{click:e.handleSnsDeleteChange}},[e._v("删除最后一次录入出库网关编号")])],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"描述",prop:"img10"}},[t("el-autocomplete",{staticStyle:{width:"100%"},attrs:{clearable:"",size:"small","fetch-suggestions":e.querySearchAsync,placeholder:"请输入描述"},on:{select:e.handleSelect},model:{value:e.dataForm.img10,callback:function(t){e.$set(e.dataForm,"img10",t)},expression:"dataForm.img10"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"出库网关编号",prop:"sns"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入出库网关编号",autosize:{minRows:4,maxRows:8}},on:{input:e.handleSnsChange},model:{value:e.dataForm.sns,callback:function(t){e.$set(e.dataForm,"sns",t)},expression:"dataForm.sns"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"图片"}},[t("div",[t("video",{attrs:{id:"videoCamera",width:e.videoWidth,height:e.videoHeight,autoplay:""}}),t("canvas",{staticStyle:{display:"none"},attrs:{id:"canvasCamera",width:e.videoWidth,height:e.videoHeight}}),t("div",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.getCompetence()}}},[e._v("打开摄像头")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.setImage()}}},[e._v("拍照")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.stopNavigator()}}},[e._v("关闭摄像头")])],1)]),t("el-upload",{attrs:{action:"",limit:6,multiple:"","list-type":"picture-card","file-list":e.fileList,"auto-upload":!1,"before-upload":e.beforeUpload,"on-exceed":e.handleExceedChange,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove,"on-change":e.handleFileChange}},[t("i",{staticClass:"el-icon-plus"})])],1)],1),e.fileList.length>0?t("el-col",{staticStyle:{"text-align":"right"},attrs:{span:24}},[t("el-button",{attrs:{type:"primary"},on:{click:e.uploadImage}},[e._v("上传文件")])],1):e._e()],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:function(t){return e.handleClose()}}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2),t("el-dialog",{attrs:{visible:e.imgVisible},on:{"update:visible":function(t){e.imgVisible=t}}},[t("img",{staticStyle:{height:"500px"},attrs:{src:e.imageUrl,alt:""}})])],1)},r=[],s=(a("8e6e"),a("456d"),a("c5f6"),a("ade3")),n=(a("7f7f"),a("34ef"),a("4917"),a("6762"),a("2fdb"),a("ac6a"),a("4f7f"),a("5df3"),a("1c4c"),a("28a5"),a("2b0e")),l=a("b047"),o=a.n(l);function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(s["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}n["default"].directive("el-select-loadmore",{bind:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}});var m={data:function(){return{videoWidth:500,videoHeight:300,imgSrc:"",thisCancas:null,thisContext:null,thisVideo:null,visible:!1,loading:!1,showUserList:[],allUserList:[],rangeNumber:50,userSearch:"",allModelList:[],fileList:[],gwModelDescList:[],fileUrlSuccessList:[],isUploadSuccess:!0,typeList:[{label:"否",value:"0"},{label:"是",value:"1"}],technicalServiceList:[{label:"线上",value:1},{label:"现场",value:2},{label:"无",value:0}],dataForm:{id:"",userId:"",productNum:"",company:"",technicalService:1,warranty:18,odate:"",sns:"",checked:!1,img7:"1",img8:"",img9:"",img10:""},rules:{userId:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],warranty:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],img9:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],sns:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}]},pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},imageUrl:"",imgVisible:!1}},computed:{snsLength:function(){if(this.dataForm.sns){var e=","==this.dataForm.sns[this.dataForm.sns.length-1]?this.dataForm.sns.substring(0,this.dataForm.sns.length-1):this.dataForm.sns;return e.split(",").length}return 0}},methods:{init:function(){var e=this;e.loading=!0,e.visible=!0,e.$nextTick((function(){e.fileList=[],e.isUploadSuccess=!0,e.fileUrlSuccessList=[],e.imageUrl="",e.imgVisible=!1,e.$refs["dataForm"].resetFields(),e.dataForm.odate=e.$dateFormatter(new Date,!1),e.dataForm.id?e.getInfo():e.getAllUserList()}))},getAllUserList:function(){var e=this,t=[],a={pageNum:1,pageSize:1e5,_t:(new Date).getTime()};e.allUserList=[],e.showUserList=[],e.$http.get("/userCus/getPage.do",{params:a}).then((function(a){var i=a.data;if(0!=i.code)return e.loading=!1,e.$message.error(i.data||i.msg);for(var r=i.data.list,s=0;s<r.length;s++){var n={label:r[s].uname,value:r[s].id};t.push(n)}e.allUserList=t,e.showUserList=t,e.dataForm.username&&(e.userSearch=e.dataForm.username),e.getAllSuperModelList()})).catch((function(t){return e.loading=!1,!1}))},getAllSuperModelList:function(){var e=this,t={_t:(new Date).getTime()};e.$hasPermission("interface:manu:select:permission.do")?e.$http.get("/gwtype/interface/selectMenu.do",t).then((function(t){var a=t.data;if(0!=a.code)return e.loading=!1,e.$message.error(a.data||a.msg);e.allModelList=a.data,e.loading=!1})).catch((function(t){return e.loading=!1,!1})):e.$message.warning("暂无权限, 请联系管理员")},getModelDescList:function(){var e=this,t={pageNum:1,pageSize:1e4,gwModel:e.dataForm.img9,_t:(new Date).getTime()};e.dataForm.img9&&(e.dataForm.img10="",e.gwModelDescList=[],e.$http.get("/modeldesc/getPage.do",{params:t}).then((function(t){var a=t.data;0==a.code&&(e.gwModelDescList=a.data.list)})))},querySearchAsync:function(e,t){for(var a=this,i=a.gwModelDescList,r=0,s=i.length;r<s;r++)i[r].value=i[r].gwDesc,i[r].label=i[r].gwDesc;var n=e?i.filter(a.createStateFilter(e)):i;t(n)},createStateFilter:function(e){return function(t){return-1!=t.value.indexOf(e)}},handleSelect:function(e){this.dataForm.img10=e.value},handleUserClearChange:function(){this.userSearch="",this.dataForm.userId=""},handleUserVisibleChange:function(e){var t=this;e&&this.$nextTick((function(){t.$refs.userInput.focus()}))},loadMore:function(e){var t=this;return function(){return t.rangeNumber+=50}},handleSnsDeleteChange:function(){var e=","==this.dataForm.sns[this.dataForm.sns.length-1]?this.dataForm.sns.substring(0,this.dataForm.sns.length-1):this.dataForm.sns,t=e.split(",");t.length>1?(t.splice(-1,1),this.dataForm.sns=t.join(",")+","):this.dataForm.sns=""},handleSnsChange:function(){var e=this,t={sn:"",_t:(new Date).getTime()};if(e.dataForm.sns){e.dataForm.sns=e.dataForm.sns.replace(/\r?\n/g,",");var a=","==e.dataForm.sns[e.dataForm.sns.length-1]?e.dataForm.sns.substring(0,e.dataForm.sns.length-1):e.dataForm.sns,i=a.split(",");if(","==e.dataForm.sns[e.dataForm.sns.length-1]&&4==i[i.length-1].length)return i.splice(-1,1),e.dataForm.sns=i.length>0?i.join(",")+",":"",e.$message.warning("您录入的不是网关编号，已自动处理");e.dataForm.checked?(Array.from(new Set(i)).length<i.length&&(e.dataForm.sns=Array.from(new Set(i)).join(",")+",",e.$message.warning("网关编号"+i[i.length-1]+"重复，已自动处理")),12==i[i.length-1].length&&(t["sn"]=i[i.length-1],e.$http.get("/customer/selectSn.do",{params:t}).then((function(t){var a=t.data;0!=a.code?e.$messages.error(a.data||a.msg):0==a.data&&e.$message.warning("该网关编号在心跳记录中暂无数据，请您先确定数据后再进行其余操作")})))):Array.from(new Set(i)).length<i.length&&(e.dataForm.sns=Array.from(new Set(i)).join(",")+",",e.$message.warning("网关编号"+i[i.length-1]+"重复，已自动处理"))}},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png",a=e.size/1024/1024<5;return t||this.$message.error(this.$t("domainInfo.pictureType")),a||this.$message.error(this.$t("domainInfo.uploadSystemBglimit")),t&&a},handleExceedChange:function(e,t){return this.$message.warning("图片最多上传6个文件")},handleRemove:function(e,t){var a=[];this.fileList=t,this.fileList.forEach((function(e){e.url.includes("https://firmware.linkqi.cn")&&a.push(e.url)})),this.fileUrlSuccessList=a},handlePictureCardPreview:function(e){this.imageUrl=e.url,this.imgVisible=!0},handleFileChange:function(e,t){this.fileList=t},getCompetence:function(){var e=this;e.thisCancas=document.getElementById("canvasCamera"),e.thisContext=e.thisCancas.getContext("2d"),e.thisVideo=document.getElementById("videoCamera"),void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;return t?new Promise((function(a,i){t.call(navigator,e,a,i)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))});var t={audio:!1,video:{width:e.videoWidth,height:e.videoHeight,transform:"scaleX(-1)"}};navigator.mediaDevices.getUserMedia(t).then((function(t){"srcObject"in e.thisVideo?e.thisVideo.srcObject=t:e.thisVideo.src=window.URL.createObjectURL(t),e.thisVideo.onloadedmetadata=function(t){e.thisVideo.play()}})).catch((function(t){return e.thisVideo=null,e.$message.warning("暂未发现设备，请先连接设备再打开摄像头"),!1}))},setImage:function(){if(!this.thisVideo||!this.thisContext)return this.$message.warning("请您先打开摄像头");if(!(this.fileList.length<6))return this.$message.warning("图片最多上传6个文件");this.thisContext.drawImage(this.thisVideo,0,0,this.videoWidth,this.videoHeight);var e=this.thisCancas.toDataURL("image/png");this.imgSrc=e,this.fileList.push({name:this.fileList.length+1,url:e}),this.$emit("refreshDataList",this.imgSrc)},dataURLtoFile:function(e,t){var a=e.split(","),i=a[0].match(/:(.*?);/)[1],r=atob(a[1]),s=r.length,n=new Uint8Array(s);while(s--)n[s]=r.charCodeAt(s);return new File([n],t,{type:i})},stopNavigator:function(){this.thisVideo&&(this.thisVideo.srcObject.getTracks()[0].stop(),this.thisVideo=null)},uploadImage:function(){var e=this,t="",a=[],i=[],r=[];a=e.fileList.filter((function(e){return!e.url.includes("https://firmware.linkqi.cn")})),e.fileList.forEach((function(e){e.url.includes("https://firmware.linkqi.cn")&&i.push(e.url)})),e.fileUrlSuccessList=i,a.length>0&&(e.loading=!0,a.forEach((function(i,s){var n=new FormData;n.append("file",i.raw),e.$http.post("/upload/powerstationUpload",n).then((function(n){var l=n.data;0!=l.code?r.push(i.name):e.fileUrlSuccessList.push("https://"+l.data),s+1==a.length&&(r.length>0&&(r.forEach((function(e){t+=e+"上传失败!<br/><br/>"})),e.fileList=e.fileList.filter((function(e){return e.url.includes("https://firmware.linkqi.cn")})),e.$message({type:"error",showClose:!0,dangerouslyUseHTMLString:!0,message:t,duration:r.length<2?3e3:3e3+1e3*r.length})),e.loading=!1)})).catch((function(e){return!1}))})))},getInfo:function(){var e=this,t={id:e.dataForm.id,_t:(new Date).getTime()};e.$http.get("/customer/select.do",{params:t}).then((function(t){var a=t.data;if(0!==a.code)return e.loading=!1,e.$message.error(a.data||a.msg);e.dataForm=d(d({},e.dataForm),a.data),e.dataForm.userId=Number(e.dataForm.userId);for(var i=1;i<7;i++)a.data["img"+i]&&(e.fileUrlSuccessList.push(a.data["img"+i]),e.fileList.push({name:i,url:a.data["img"+i]}));e.getAllUserList()})).catch((function(t){return e.loading=!1,!1}))},handleClose:function(){this.dataForm.id="",this.$refs["dataForm"].resetFields(),this.stopNavigator(),this.visible=!1},dataFormSubmitHandle:o()((function(){var e=this,t=[{userId:e.dataForm.userId,productNum:e.dataForm.productNum,company:e.dataForm.company,technicalService:e.dataForm.technicalService,odate:e.dataForm.odate,warranty:e.dataForm.warranty,img7:e.dataForm.img7,img8:e.dataForm.img8,img9:e.dataForm.img9,img10:e.dataForm.img10,sns:","==e.dataForm.sns[e.dataForm.sns.length-1]?e.dataForm.sns.substring(0,e.dataForm.sns.length-1):e.dataForm.sns}],a="/customer/insert.do";if(e.fileList.length>0){for(var i=0;i<6;i++)t[0]["img"+(i+1)]=i+1>e.fileUrlSuccessList.length?"":e.fileUrlSuccessList[i];for(var r=0;r<e.fileList.length;r++)if(!e.fileList[r].url.includes("https://firmware.linkqi.cn")){e.isUploadSuccess=!1;break}}e.$refs["dataForm"].validate((function(i){return!!i&&(e.isUploadSuccess?(","==e.dataForm.sns[e.dataForm.sns.length-1]&&(e.dataForm.sns=e.dataForm.sns.substring(0,e.dataForm.sns.length-1)),e.loading=!0,e.dataForm.id&&(a="/customer/update.do",t[0]["id"]=e.dataForm.id),void e.$http[e.dataForm.id?"put":"post"](a,t).then((function(t){var a=t.data;if(0!==a.code)return e.loading=!1,e.$message.error(a.data||a.msg),!1;e.loading=!1,e.dataForm.id,e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.stopNavigator(),e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(t){return e.loading=!1,e.stopNavigator(),e.visible=!1,e.$emit("refreshDataList")}))):e.$message.info("系统检测到有部分图片未上传,请先上传图片再进行操作"))}))}),1e3,{leading:!0,trailing:!1})},watch:{userSearch:function(e,t){e?(this.showUserList=this.allUserList,this.showUserList=this.showUserList.filter((function(t){if(t.label.toLowerCase().includes(e.toLowerCase()))return t})),0==this.showUserList.length&&this.showUserList.push({label:"暂无匹配数据",value:"",disabled:!0})):this.showUserList=this.allUserList}}},u=m,h=(a("5d31"),a("2877")),g=Object(h["a"])(u,i,r,!1,null,"02ceb3f8",null);t["default"]=g.exports}}]);