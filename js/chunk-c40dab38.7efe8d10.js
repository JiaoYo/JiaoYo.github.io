(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c40dab38"],{3763:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.deviceVisible,title:e.$t("deviceInfo.addMulitipe"),"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.deviceVisible=t},close:e.handleCloseDialog}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":(e.$i18n.locale,"120px")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{xs:24,sm:24,md:12,xl:12,lg:12}},[t("el-tree",{ref:"tree",attrs:{data:e.dataTree,"show-checkbox":"","node-key":"id","default-expand-all":""},on:{check:e.handleCheckChange}})],1),t("el-col",{attrs:{xs:24,sm:24,md:12,xl:12,lg:12}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.channel"),prop:"chlid"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("deviceInfo.pleaseSelect")},model:{value:e.dataForm.chlId,callback:function(t){e.$set(e.dataForm,"chlId",t)},expression:"dataForm.chlId"}},e._l(e.chlList,(function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.chlId}},[t("span",{staticStyle:{width:"50%",display:"inline-block","text-align":"left",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:a.label}},[e._v(e._s(a.label))]),t("span",{staticStyle:{color:"#8492a6","font-size":"13px",display:"inline-block",width:"50%","text-align":"right",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:a.chlcomment}},[e._v(e._s(a.chlcomment||"无"))])])})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"转发设备前缀",prop:"devPre"}},[t("el-input",{attrs:{placeholder:"请输入转发设备前缀(可空)",clearable:""},model:{value:e.dataForm.devPre,callback:function(t){e.$set(e.dataForm,"devPre",t)},expression:"dataForm.devPre"}})],1)],1),e.showSpecialDesign||1==e.superAdmin?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devcommaddr"),prop:"devcommaddr"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.devicecommaddr"),maxlength:32,clearable:""},model:{value:e.dataForm.devcommaddr,callback:function(t){e.$set(e.dataForm,"devcommaddr",t)},expression:"dataForm.devcommaddr"}})],1)],1):e._e(),e.showSpecialDesign||1==e.superAdmin?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devpublicaddr"),prop:"devpublicaddr"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.canEmpty"),maxlength:32,clearable:""},model:{value:e.dataForm.devpublicaddr,callback:function(t){e.$set(e.dataForm,"devpublicaddr",t)},expression:"dataForm.devpublicaddr"}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"设备有效性",prop:"valid"}},[t("el-radio-group",{model:{value:e.dataForm.valid,callback:function(t){e.$set(e.dataForm,"valid",t)},expression:"dataForm.valid"}},[t("el-radio",{attrs:{label:0}},[e._v("是")]),t("el-radio",{attrs:{label:2}},[e._v("否")])],1)],1)],1)],1)],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleCloseDialog}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},r=[],s=(a("4f7f"),a("5df3"),a("1c4c"),a("a481"),a("ac6a"),a("55dd"),a("4328")),n=a.n(s),l=a("b047"),d=a.n(l),c={props:["queryParams"],data:function(){return{loading:!1,showSpecialDesign:!1,superAdmin:0,deviceVisible:!1,dataTree:[],checkedId:[],chlList:[],chlId:[],devId:[],dataForm:{chlId:"",devPre:"",valid:0,devcommaddr:"1",devpublicaddr:"1",reserve1:""},rules:{chlId:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],reserve1:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){var e=this;e.superAdmin=localStorage.getItem("superAdmin"),e.$http.post("/ProcotolTemplate/getAu.do",{}).then((function(t){var a=t.data;0!=a.code?e.showSpecialDesign=!1:e.showSpecialDesign=!0,e.getchlList()})).catch((function(t){return e.showSpecialDesign=!1,e.getchlList()}))},compareBySort:function(e,t){return e.sort((function(e,a){return e[t]-a[t]}))},getchlList:function(){var e=this;if(this.$hasSessionStorageGwsn()){this.chlList=[];var t={gwsn:sessionStorage.getItem("gwsn")};if(!this.$hasPermission("list:getChlList:select:permission.do"))return void setTimeout((function(){e.$message.warning("暂无通道查询权限, 请联系管理员")}),500);this.$http.get("/list/getChlList.do",{params:t}).then((function(t){var a=t.data;if(0!=a.code)return e.$message.error(a.data||a.msg);if(!(a.data.length>0))return e.$message.warning("暂无转发通道，请您先创建转发通道再执行此操作");if(a.data.forEach((function(t){if(1==t.chlType){var a={label:t.chlName,value:t.id,chlId:t.chlID,chlcomment:t.chlComment};e.chlList.push(a)}})),!(e.chlList.length>0))return e.$message.warning("暂无转发通道，请您先创建转发通道再执行此操作");if(e.chlList=e.compareBySort(e.chlList,"chlId"),e.queryParams.chlId)for(var i=0;i<e.chlList.length;i++){var r=e.chlList[i];if(e.queryParams.chlId==r.chlId){e.dataForm.chlId=r.chlId;break}}else e.dataForm.chlId=e.chlList[0].chlId;e.$nextTick((function(){e.getTreeList()}))})).catch((function(e){return!1}))}else this.$message({showClose:!1,message:"未获取到网关编号",type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})},getTreeList:function(){var e=this,t={chltype:0,gwsn:sessionStorage.getItem("gwsn")};if(e.dataTree=[{id:0,label:e.$t("attribute.own"),children:[]}],e.$hasSessionStorageGwsn()){if(!e.$hasPermission("channelinfo:selectChlAndDev:permission.do"))return void e.$message.warning("暂无通道、设备查询权限, 请联系管理员");e.$http.post("/info/channelinfo/selectChlAndDev",n.a.stringify(t)).then((function(t){var a=t.data;if(!(a.length>0))return e.$message.warning("暂无采集信息(通道、设备), 请先创建采集信息(通道、设备)再执行此操作");a.forEach((function(t){var a={id:t.id,label:t.chlname,p_id:0};t.children.length>0&&(a.children=[],t.children.forEach((function(e){var t={id:e.devid,label:e.devname,tagdevids:e.id,p_id:e.chlid,children:[]};a.children.push(t)}))),e.dataTree[0].children.push(a)})),e.deviceVisible=!0})).catch((function(e){return!1}))}else e.$message({showClose:!1,message:"未获取到网关编号",type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})},handleCheckChange:function(e,t){var a=[],i=[];if(0==e.id)if(t.checkedNodes.length>0){var r=function(e){return e.forEach((function(e){e.hasOwnProperty("p_id")&&(0!=e.p_id?a.push(e.id):e.hasOwnProperty("children")&&e.children.length>0&&r(e.children))})),a};i=r(e.children),this.checkedId=i}else this.checkedId=[];else if(0==e.p_id)if(t.checkedNodes.length>0){var s=function(e){return e.forEach((function(e){e.hasOwnProperty("p_id")&&(0!=e.p_id?a.push(e.id):e.hasOwnProperty("children")&&e.children.length>0&&s(e.children))})),a};i=s(e.children),this.checkedId=this.checkedId.concat(i).filter((function(e){return-1!=t.checkedKeys.indexOf(e)}))}else this.checkedId=[];else a.push(e.id),a=Array.from(new Set(a)),t.checkedNodes.length>0?(a.forEach((function(e){t.checkedNodes.forEach((function(t){e==t.id&&i.push(e)}))})),this.checkedId=this.checkedId.concat(i).filter((function(e){return-1!=t.checkedKeys.indexOf(e)}))):this.checkedId=[]},handleCloseDialog:function(){this.checkedId=[],this.$refs["dataForm"].resetFields(),this.deviceVisible=!1},dataFormSubmitHandle:d()((function(){var e=this;if(this.$hasSessionStorageGwsn()){var t={chlId:this.dataForm.chlId,devids:"",devPre:this.dataForm.devPre,gwsn:sessionStorage.getItem("gwsn"),val:this.dataForm.valid};if(0===this.checkedId.length)return this.$message.warning(this.$t("deviceInfo.pleaseSelectDevice"));if(t["devids"]=this.checkedId.join(","),(this.showSpecialDesign||1==this.superAdmin)&&(t["type"]=1,t["rc"]=1,t["addr"]=this.dataForm.devcommaddr,t["publicAddr"]=this.dataForm.devpublicaddr),!this.$hasPermission("deviceinfo:insertSaves:permission.do"))return void this.$message.warning("暂无批量新增设备权限, 请联系管理员");this.$refs["dataForm"].validate((function(a){if(!a)return!1;e.loading=!0,e.$http.get("/info/deviceinfo/insertTransDevs.do",{params:t}).then((function(t){var a=t.data;if(0!=a.code)return e.loading=!1,e.$message.error(a.data||a.msg);e.loading=!1,e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataTree=[],e.checkedId=[],e.$refs.tree.setCheckedKeys([]),e.$refs["dataForm"].resetFields(),e.deviceVisible=!1,e.$emit("refreshDataList")}})})).catch((function(t){return e.loading=!1,e.dataTree=[],e.checkedId=[],e.$refs.tree.setCheckedKeys([]),e.$refs["dataForm"].resetFields(),e.deviceVisible=!1,e.$message.error("请求超时, 请查看是否操作成功"),e.$emit("refreshDataList")}))}))}else this.$message({showClose:!1,message:"未获取到网关编号",type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})}),1e3,{leading:!0,trailing:!1})}},o=c,h=(a("e498"),a("2877")),u=Object(h["a"])(o,i,r,!1,null,"67c4cce4",null);t["default"]=u.exports},"6cfc":function(e,t,a){},e498:function(e,t,a){"use strict";a("6cfc")}}]);