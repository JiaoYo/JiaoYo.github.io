(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c6f0080"],{"34df":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e._self._c;return t("section",[t("el-header",{staticStyle:{height:"50px"}},[t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("span",[e._v("    ")]),t("span",[e._v(e._s(e.$t("chlwatch.gwsn")))]),t("span",{staticClass:"colorConfig"},[e._v(e._s(e.dataForm.sn))]),t("span",[e._v("    ")]),t("span",[e._v(e._s(e.$t("chlwatch.lineStatus")))]),t("span",{staticClass:"statusWrap",style:{backgroundColor:0==e.dataForm.status?"#ffa500":1==e.dataForm.status||2==e.dataForm.status?"#0f0":"#ffa500"}}),t("span",{class:0==e.dataForm.status?"colorConfig redConfig":"colorConfig"},[e._v(e._s(0==e.dataForm.status?"关闭":1==e.dataForm.status?"运行":2==e.dataForm.status?"正在运行(无法获取配置)":"关闭"))]),t("span",[e._v("    ")]),t("span",[e._v(e._s("代理类型："))]),t("span",{staticClass:"colorConfig"},[e._v(e._s("自定义HTTP/HTTPS"))]),t("span",[e._v("    ")]),t("span",[e._v(e._s("IP:"))]),t("span",{staticClass:"colorConfig",staticStyle:{"margin-left":"5px"}},[e._v(e._s(e.dataForm.com))]),t("span",[e._v("    ")]),t("span",[e._v(e._s("端口: "))]),t("span",{staticClass:"colorConfig",staticStyle:{"margin-left":"5px"}},[e._v(e._s(e.dataForm.baud))])]),"readAndWrite"===e.userPermission?t("div",{staticStyle:{"padding-right":"20px"}},[t("el-button",{staticClass:"search-btn",attrs:{loading:e.closeConsoleLoading,size:"mini"},on:{click:function(t){e.closeConsoleLoading=!0,e.handleCloseConsoleChange()}}},[e._v("\n                关闭代理\n            ")])],1):e._e()]),e.remoteControlLoading?t("div",{staticClass:"box",staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[e._m(0)]):e._e(),t("iframe",{style:{width:"100%",height:"calc(100vh - 53px)"},attrs:{src:e.iframeSrc,frameborder:"0"}}),t("el-dialog",{attrs:{visible:e.checkSnAndPwdVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.checkSnAndPwdVisible=t}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleCheckSnAndPwdConfirmChange.apply(null,arguments)}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.checkSnAndPwdLoading,expression:"checkSnAndPwdLoading"}],ref:"checkSnAndPwdRef",attrs:{rules:e.rules,model:e.checkSnAndPwdForm,"label-width":"80px"}},[t("el-row",[t("el-col",{attrs:{xl:24,md:24,sm:24}},[t("el-form-item",{attrs:{prop:"sn",label:"网关编号"}},[t("el-input",{attrs:{readonly:""},model:{value:e.checkSnAndPwdForm.sn,callback:function(t){e.$set(e.checkSnAndPwdForm,"sn",t)},expression:"checkSnAndPwdForm.sn"}})],1)],1),t("el-col",{attrs:{xl:24,md:24,sm:24}},[t("el-form-item",{attrs:{prop:"pwd",label:"网关密码"}},[t("el-input",{ref:"input",attrs:{placeholder:"请输入网关密码",clearable:"","show-password":""},model:{value:e.checkSnAndPwdForm.pwd,callback:function(t){e.$set(e.checkSnAndPwdForm,"pwd",t)},expression:"checkSnAndPwdForm.pwd"}})],1)],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleCheckSnAndPwdConfirmChange}},[e._v(e._s(e.$t("confirm")))])],1)],1),t("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleCloseConsoleNoDialogChange},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("span",[e._v("您已经三分钟无操作，连接已自动断开")]),"readAndWrite"===e.userPermission?t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleCloseConsoleNoDialogChange}},[e._v("关闭")])],1):e._e()])],1)},s=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"dot-spinner"},[t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"})])}],i=n("53ca"),a=(n("6b54"),n("a481"),n("b047")),r=n.n(a),c=n("a78e"),l=n.n(c),d=n("ed08"),m={name:"remotecontrol",data:function(){return{iframeSrc:"",consoleStatus:1,userPermission:"",remoteControlLoading:!0,dataForm:{sn:"",com:"",baud:null,type:null,status:null},idleTimeout:18e4,idleTimer:null,lastActivityTime:null,checkSnAndPwdVisible:!1,checkSnAndPwdLoading:!1,checkSnAndPwdForm:{sn:"",pwd:""},dialogVisible:!1,rules:{pwd:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]},websocket:null,resname:"",wsUrl:"",getMQTTTimer:null,closeConsoleLoading:!1,closeConsoleDisabled:!1}},mounted:function(){var e=this,t=0,n=0;if(!l.a.get("token"))return e.$router.replace({name:"login"}).catch((function(e){return!1})),!1;window.addEventListener("beforeunload",(function(){t=(new Date).getTime()})),window.addEventListener("unload",(function(){n=(new Date).getTime()-t,n<=5&&e.handleCloseConsoleDirectChange()}));var o=e.$route.query;e.checkSnAndPwdForm.sn=o.sn,e.checkSnAndPwdForm.pwd=sessionStorage.getItem("pwd")||"",e.dataForm.sn=o.sn,e.dataForm.type=o.type,e.dataForm.com=o.com,e.dataForm.baud=o.baud,e.dataForm.status=o.status,e.checkSnAndPwdLoading=!1,e.checkSnAndPwdForm.pwd?(e.checkSnAndPwdLoading=!0,e.$http.get("/info/tgwinfo/tgwinfoNameAndPwd",{params:{gwsn:e.checkSnAndPwdForm.sn,pwd:e.checkSnAndPwdForm.pwd}}).then((function(t){var n=t.data;"fail"==n.msg?(e.remoteControlLoading=!1,e.$message.error(n.data),e.checkSnAndPwdForm.pwd="",e.checkSnAndPwdLoading=!1,e.checkSnAndPwdVisible=!0):(e.remoteControlLoading=!1,e.iframeSrc="http://localhost:3000/proxy?url=http://172.20.1.191:8080/")})).catch((function(t){return e.remoteControlLoading=!1,!1}))):e.checkSnAndPwdVisible=!0},beforeDestroy:function(){this.close(),this.timeoutObj&&clearTimeout(this.timeoutObj),this.timeoutnum&&clearTimeout(this.timeoutnum),this.idleTimer&&clearTimeout(this.idleTimer),this.xterm&&(this.xterm.textarea.removeEventListener("paste",this.pasteHandler),this.xterm.element.removeEventListener("paste",this.pasteHandler)),this.websocket&&this.websocket.readyState===WebSocket.OPEN&&(this.websocket.close(),this.websocket=null)},methods:{close:function(){this.idleTimer&&clearTimeout(this.idleTimer)},handleCheckSnAndPwdConfirmChange:function(){var e=this;e.$refs["checkSnAndPwdRef"].validate((function(t){if(!t)return!1;e.checkSnAndPwdLoading=!0,e.$http.get("/info/tgwinfo/tgwinfoNameAndPwd",{params:{gwsn:e.checkSnAndPwdForm.sn,pwd:e.checkSnAndPwdForm.pwd}}).then((function(t){var n=t.data;"fail"==n.msg?(e.remoteControlLoading=!1,e.$message.error(n.data),e.checkSnAndPwdForm.pwd="",e.checkSnAndPwdLoading=!1):(e.remoteControlLoading=!1,e.iframeSrc=e.dataForm.com+":"+e.dataForm.baud)})).catch((function(t){return e.remoteControlLoading=!1,!1}))}))},resetIdleTimer:function(){var e=this;clearTimeout(this.idleTimer),this.lastActivityTime=Date.now(),this.idleTimer=setTimeout((function(){e.closeConnection()}),this.idleTimeout)},closeConnection:function(){this.close(),this.dialogVisible=!0},handleCloseDialogChange:function(){this.close(),this.dialogVisible=!1,this.closeConsoleLoading=!1,window.opener?(window.opener.postMessage({type:"fromChildWindow",data:"refresh"},"*"),window.close()):window.location.replace("about:blank")},handleCloseConsoleDirectChange:function(){"readAndWrite"===this.userPermission&&0!=this.consoleStatus&&window.opener.postMessage({type:"closeConsole",timestamp:Date.now()},"*")},handleCloseConsoleNoDialogChange:r()((function(){var e=this,t=e.$randomStrFun(),n=String(parseInt((new Date).getTime().toString().substring(0,10)));if("readAndWrite"!==e.userPermission)return e.handleCloseDialogChange(),!1;var o={start:0,type:2,com:"/bin/bash",baud:e.dataForm.baud,server:"dingiiot.com",port:9015},s=Object(d["p"])(JSON.stringify(o));e.resname="setconsole",e.$nextTick((function(){e.wsUrl="consoleWebscoket/setconsole/"+e.checkSnAndPwdForm.sn+"/"+e.stringToHex(s)+"/"+e.$md5(e.stringToHex(s)+t+n)+"/"+n,e.createWebSocket(),e.closeConsoleLoading=!0,e.getMQTTTimer=setTimeout((function(){if(e.closeConsoleLoading)return e.closeConsoleLoading=!1,e.websocket&&"setconsole"==e.resname&&(e.websocket.close(),e.websocket=null),e.getMQTTTimer&&(clearTimeout(e.getMQTTTimer),e.getMQTTTimer=null),e.$message.error(e.$t("issue.timeout"))}),"30000")}))}),1e3,{leading:!0,trailing:!1}),handleCloseConsoleChange:r()((function(){var e=this,t=e.$randomStrFun(),n=String(parseInt((new Date).getTime().toString().substring(0,10)));e.$confirm("确定要关闭代理吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var o={start:0,type:2,com:"/bin/bash",baud:e.dataForm.baud,server:"dingiiot.com",port:9015},s=Object(d["p"])(JSON.stringify(o));e.resname="setconsole",e.$nextTick((function(){e.wsUrl="consoleWebscoket/setconsole/"+e.checkSnAndPwdForm.sn+"/"+e.stringToHex(s)+"/"+e.$md5(e.stringToHex(s)+t+n)+"/"+n,e.createWebSocket(),e.closeConsoleLoading=!0,e.getMQTTTimer=setTimeout((function(){if(e.closeConsoleLoading)return e.closeConsoleLoading=!1,e.websocket&&"setconsole"==e.resname&&(e.websocket.close(),e.websocket=null),e.getMQTTTimer&&(clearTimeout(e.getMQTTTimer),e.getMQTTTimer=null),e.$message.error(e.$t("issue.timeout"))}),"30000")}))})).catch((function(){}))}),1e3,{leading:!0,trailing:!1}),createWebSocket:function(){var e=this;if(e.websocket&&e.websocket.readyState===WebSocket.OPEN&&(e.websocket.close(),e.websocket=null),e.getMQTTTimer&&(clearTimeout(e.getMQTTTimer),e.getMQTTTimer=null),!("WebSocket"in window))return e.$message.error(e.$t("websocket.notSupportWebsocket"));try{var t=window.SITE_CONFIG["socketUrl"]+e.wsUrl+"?token="+e.$getToken();e.websocket=new WebSocket(t),e.initWebSocket()}catch(n){}},initWebSocket:function(){this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onmessage=this.websocketonmessage,this.websocket.onclose=this.websocketonclose},websocketonopen:function(){},websocketonerror:function(e){this.closeConsoleLoading=!1},isJsonString:function(e){if("string"===typeof e)try{var t=JSON.parse(e);return!("object"!==Object(i["a"])(t)||!t)}catch(n){return!1}},websocketonmessage:function(e){var t=this;if(!this.isJsonString(e.data))return!1;if(this.getMQTTTimer&&(clearTimeout(this.getMQTTTimer),this.getMQTTTimer=null),this.websocket&&this.websocket.readyState===WebSocket.OPEN&&(this.websocket.close(),this.websocket=null),"setconsole"===this.resname&&"setconsole"==JSON.parse(e.data).res_name){var n=JSON.parse(e.data).res_content;1===n.successed?(this.consoleStatus=0,this.$message.success("关闭代理成功"),setTimeout((function(){t.handleCloseDialogChange()}),1e3)):this.$message.error("关闭代理失败")}},websocketonclose:function(e){2!=e.currentTarget.readyState&&3!=e.currentTarget.readyState&&this.websocket&&this.websocket.readyState===WebSocket.OPEN&&(this.websocket.close(),this.websocket=null)}}},u=m,h=(n("7cfb"),n("2877")),g=Object(h["a"])(u,o,s,!1,null,"5e369c7a",null);t["default"]=g.exports},"7cfb":function(e,t,n){"use strict";n("a45d")},a45d:function(e,t,n){}}]);