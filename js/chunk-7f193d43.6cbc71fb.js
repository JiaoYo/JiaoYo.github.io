(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f193d43"],{"3a69":function(t,e,a){"use strict";a("6a4b")},"6a4b":function(t,e,a){},dee2:function(t,e,a){"use strict";a.r(e);a("a481");var r=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.visible,title:t.dataForm.id?t.$t("update"):t.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",attrs:{model:t.dataForm,rules:t.dataRule,"label-width":"en-US"===t.$i18n.locale?"120px":"80px"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.dataFormSubmitHandle()}}},[e("el-row",[e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:t.$t("project.projectName"),prop:"prjName"}},[e("el-input",{attrs:{placeholder:t.$t("project.projectName"),clearable:""},on:{input:function(e){t.dataForm.prjName=t.dataForm.prjName.replace(/\s+/g,"")}},model:{value:t.dataForm.prjName,callback:function(e){t.$set(t.dataForm,"prjName","string"===typeof e?e.trim():e)},expression:"dataForm.prjName"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:t.$t("project.location"),prop:"prjAddr"}},[e("el-input",{attrs:{placeholder:t.$t("project.location"),readonly:""},model:{value:t.dataForm.prjAddr,callback:function(e){t.$set(t.dataForm,"prjAddr",e)},expression:"dataForm.prjAddr"}})],1)],1)],1),e("el-row",[e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:t.$t("project.detailLocation"),prop:"prjaddress"}},[e("el-input",{attrs:{placeholder:t.$t("project.enterDetailLocation"),clearable:""},model:{value:t.dataForm.prjaddress,callback:function(e){t.$set(t.dataForm,"prjaddress",e)},expression:"dataForm.prjaddress"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:t.$t("project.creator"),prop:"createName"}},[e("el-input",{attrs:{placeholder:t.$t("project.creator"),readonly:""},model:{value:t.dataForm.createName,callback:function(e){t.$set(t.dataForm,"createName",e)},expression:"dataForm.createName"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{prop:"deptName",label:t.$t("user.deptName")}},[e("el-popover",{ref:"deptListPopover",attrs:{placement:"bottom-start",trigger:"click"},model:{value:t.deptListVisible,callback:function(e){t.deptListVisible=e},expression:"deptListVisible"}},[e("el-input",{attrs:{size:"small",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}}),e("el-tree",{ref:"deptListTree",attrs:{id:"singleTree",data:t.deptIdList,props:{label:"name",children:"children"},"node-key":"id","highlight-current":!0,"expand-on-click-node":!1,accordion:"","filter-node-method":t.filterNode},on:{"current-change":t.deptListTreeCurrentChangeHandle}})],1),e("el-input",{directives:[{name:"popover",rawName:"v-popover:deptListPopover",arg:"deptListPopover"}],attrs:{readonly:!0,placeholder:t.$t("user.deptName")},model:{value:t.dataForm.deptName,callback:function(e){t.$set(t.dataForm,"deptName",e)},expression:"dataForm.deptName"}})],1)],1)],1)],1)],1),e("el-col",{attrs:{span:12}},[t.visible?e("div",{staticClass:"app-container"},[e("el-autocomplete",{staticStyle:{width:"100%"},attrs:{clearable:"","fetch-suggestions":t.querySearch,placeholder:t.$t("project.enterPosition"),"trigger-on-focus":!1},on:{select:t.handleSelect},model:{value:t.mapLocation.address,callback:function(e){t.$set(t.mapLocation,"address",e)},expression:"mapLocation.address"}}),e("div",{staticStyle:{margin:"5px"}},[e("baidu-map",{staticClass:"bm-view",attrs:{center:t.mapCenter,zoom:t.mapZoom,"scroll-wheel-zoom":!0,mapClick:!1,ak:"GSLAaCfy9IF40brhKpYgmcbbb2D6blUa"},on:{ready:t.handlerBMap,click:t.getClickInfo}},[e("bm-map-type",{attrs:{"map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),e("bm-marker",{attrs:{position:t.mapCenter,animation:"BMAP_ANIMATION_BOUNCE"}})],1)],1)],1):t._e()])],1),e("template",{slot:"footer"},[e("el-button",{on:{click:t.handleClose}},[t._v(t._s(t.$t("cancel")))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.dataFormSubmitHandle()}}},[t._v(t._s(t.$t("confirm")))])],1)],2)},o=[],i=(a("8e6e"),a("456d"),a("ade3")),n=(a("ac6a"),a("7f7f"),a("386d"),a("b047")),d=a.n(n);function s(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?s(Object(a),!0).forEach((function(e){Object(i["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var p={props:{id:{type:String,default:""},createName:{type:String,default:""}},data:function(){return{map:null,mapZoom:15,visible:!1,loading:!1,mapCenter:{lng:0,lat:0},mapLocation:{address:void 0,coordinate:void 0},filterText:"",deptIdList:[],deptListVisible:!1,dataForm:{id:"",prjName:"",prjDesc:"",prjAddr:"",prjUrl:"",prjaddress:"",latitude:"30.310701",longitude:"120.382155",createName:"",deptId:"",deptName:""},detailLocation:null}},computed:{dataRule:function(){return{prjName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjDesc:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjAddr:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjaddress:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{handlerBMap:function(t){var e=this,a=t.BMap,r=t.map;this.BMap=a,this.map=r,this.mapZoom=15,this.$nextTick((function(){e.dataForm.id||e.getCurrentlocation()}))},getCurrentlocation:function(){if(!this.BMap)return!1;var t=this;t.loading=!1;var e={point:{lat:"30.310701",lng:"120.382155"}};t.mapLocation.coordinate=e.point,t.dataForm.longitude=e.point.lng,t.dataForm.latitude=e.point.lat,t.makerCenter(e.point)},getPrjInfoLocation:function(){if(!this.BMap)return!1;this.mapZoom=15;var t={lat:this.dataForm.latitude,lng:this.dataForm.longitude};this.mapLocation.coordinate=t,this.mapLocation.address=this.dataForm.prjAddr+this.dataForm.prjaddress,this.mapCenter.lng=this.dataForm.longitude,this.mapCenter.lat=this.dataForm.latitude,this.loading=!1},querySearch:function(t,e){var a=this,r=new this.BMap.Geocoder;r.getPoint(t,(function(t){a.mapLocation.coordinate=t||null}),this.locationCity);var o={onSearchComplete:function(t){if(0===i.getStatus())for(var a=[],r=0;r<t.getCurrentNumPois();r++){var o=t.getPoi(r),n={value:o.address+o.title,point:o.point};a.push(n),e(a)}else e()}},i=new this.BMap.LocalSearch(this.map,o);i.search(t)},handleSelect:function(t){this.detailLocation=t.value;var e=t.point;this.mapLocation.coordinate=e,this.dataForm.longitude=e.lng,this.dataForm.latitude=e.lat,this.makerCenter(e)},getClickInfo:function(t){this.mapLocation.coordinate=t.point,this.dataForm.longitude=t.point.lng,this.dataForm.latitude=t.point.lat,this.makerCenter(t.point)},makerCenter:function(t){if(this.map){var e=this,a=new this.BMap.Geocoder;e.mapCenter.lng=t.lng,e.mapCenter.lat=t.lat,e.dataForm.longitude=t.lng,e.dataForm.latitude=t.lat,a.getLocation(t,(function(t){if(!t)return e.mapLocation.address="",!1;e.dataForm.prjAddr=t.addressComponents.province+" "+t.addressComponents.city+" "+t.addressComponents.district,e.dataForm.prjaddress=t.business?t.business:t.addressComponents.street,e.mapLocation.address=t.address+t.business,e.dataForm.prjaddress||(e.dataForm.prjaddress=e.detailLocation),e.mapLocation.address!=e.detailLocation&&(e.mapLocation.address=e.detailLocation)}))}},init:function(){var t=this;this.loading=!0,this.getSystemDeptList((function(e){t.filterText="",t.deptIdList=e.data.list,t.visible=!0,t.dataForm.id=t.id,t.$nextTick((function(){t.$refs["dataForm"].resetFields(),t.dataForm.id?t.getInfo():(t.dataForm.deptId=t.$store.state.user.deptId,t.$refs.deptListTree.setCurrentKey(t.dataForm.deptId),setTimeout((function(){t.dataForm.deptName=t.$refs.deptListTree.getCurrentNode()?t.$refs.deptListTree.getCurrentNode().name:""}),200),t.$nextTick((function(){t.getCurrentlocation()}))),t.dataForm.createName=t.$store.state.user.name}))}))},getSystemDeptList:function(t){var e=this;this.deptIdList=[],this.$http.get("/sys/dept/getDeptList.do",{params:{pageNum:1,pageSize:1e4}}).then((function(a){var r=a.data;if(0!=r.code)return e.$message.error(r.data||r.msg);t(r)}))},deptListTreeCurrentChangeHandle:function(t,e){this.dataForm.deptId=t.id,this.dataForm.deptName=t.name,this.deptListVisible=!1},filterNode:function(t,e,a){if(!t)return!0;a.level;var r=[];this.getReturnNode(a,r,t);var o=!1;return r.forEach((function(t){o=o||t})),o},getReturnNode:function(t,e,a){var r=t.data&&t.data.name&&-1!==t.data.name.indexOf(a);r&&e.push(r),!r&&1!=t.level&&t.parent&&this.getReturnNode(t.parent,e,a)},getInfo:function(){var t=this;if(!this.dataForm.id)return this.visible=!1,this.$message.error(this.$t("failedToGetProjectId"));this.loading=!0,this.$http.get("/info/tprjinfo/".concat(this.dataForm.id)).then((function(e){var a=e.data;if(0!==a.code)return t.loading=!1,t.$message.error(a.data||a.msg);t.dataForm=l(l({},t.dataForm),a.data),t.dataForm.createName=t.createName,t.$refs.deptListTree.setCurrentKey(t.dataForm.deptId),setTimeout((function(){t.dataForm.deptName=t.$refs.deptListTree.getCurrentNode()?t.$refs.deptListTree.getCurrentNode().name:""}),200),t.getPrjInfoLocation()})).catch((function(e){return t.loading=!1,!1}))},handleClose:function(){this.visible=!1},dataFormSubmitHandle:d()((function(){var t=this;this.$refs["dataForm"].validate((function(e){if(!e)return!1;var a={};a=t.dataForm.id?{deptId:t.dataForm.deptId,id:t.dataForm.id,latitude:t.dataForm.latitude,longitude:t.dataForm.longitude,prjAddr:t.dataForm.prjAddr,prjDesc:t.dataForm.prjDesc,prjName:t.dataForm.prjName,prjUrl:t.dataForm.prjUrl,prjaddress:t.dataForm.prjaddress}:t.dataForm,t.$http[t.dataForm.id?"put":"post"]("/info/tprjinfo/",a).then((function(e){var a=e.data;if(0!==a.code)return t.$message.error(a.data||a.msg);t.$message({message:t.$t("prompt.success"),type:"success",duration:500,onClose:function(){t.visible=!1,t.$emit("refreshDataList")}})})).catch((function(t){return!1}))}))}),1e3,{leading:!0,trailing:!1})},watch:{filterText:function(t){this.$refs.deptListTree.filter(t)}}},c=p,m=(a("3a69"),a("2877")),u=Object(m["a"])(c,r,o,!1,null,null,null);e["default"]=u.exports}}]);