(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-413b25c4"],{"211f":function(t,e,a){"use strict";a("87c8")},"4c12":function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var r=a("3835"),n={bd09ToGcj02:function(t,e){var a=t-.0065,r=e-.006,n=Math.sqrt(a*a+r*r)-2e-5*Math.sin(r*Math.PI),i=Math.atan2(r,a)-3e-6*Math.cos(a*Math.PI);return[n*Math.cos(i),n*Math.sin(i)]},gcj02ToWgs84:function(t,e){if(this._outOfChina(t,e))return[t,e];var a=this._transformLat(t-105,e-35),r=this._transformLng(t-105,e-35),n=e/180*Math.PI,i=Math.sin(n),o=.006693421622965943,s=6378245,d=Math.sqrt(1-o*i*i),l=180*a/(s*(1-o)/Math.pow(d,3)*Math.PI),p=180*r/(s/d*Math.cos(n)*Math.PI);return[t-p,e-l]},bd09ToWgs84:function(t,e){var a=this.bd09ToGcj02(t,e),n=Object(r["a"])(a,2),i=n[0],o=n[1];return this.gcj02ToWgs84(i,o)},_transformLat:function(t,e){var a=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return a+=2*(20*Math.sin(6*t*Math.PI)+20*Math.sin(2*t*Math.PI))/3,a+=2*(20*Math.sin(e*Math.PI)+40*Math.sin(e/3*Math.PI))/3,a+=2*(160*Math.sin(e/12*Math.PI)+320*Math.sin(e*Math.PI/30))/3,a},_transformLng:function(t,e){var a=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return a+=2*(20*Math.sin(6*t*Math.PI)+20*Math.sin(2*t*Math.PI))/3,a+=2*(20*Math.sin(t*Math.PI)+40*Math.sin(t/3*Math.PI))/3,a+=2*(150*Math.sin(t/12*Math.PI)+300*Math.sin(t/30*Math.PI))/3,a},_outOfChina:function(t,e){return!(t>73.66&&t<135.05&&e>3.86&&e<53.55)}}},"87c8":function(t,e,a){},f98c:function(t,e,a){"use strict";a.r(e);a("a481");var r=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.visible,title:t.dataForm.id?t.$t("update"):t.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",attrs:{model:t.dataForm,rules:t.dataRule,"label-width":"en-US"===t.$i18n.locale?"120px":"80px"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.dataFormSubmitHandle()}}},[e("el-row",[e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:t.$t("project.projectName"),prop:"prjName"}},[e("el-input",{attrs:{placeholder:t.$t("project.projectName"),clearable:""},on:{input:function(e){t.dataForm.prjName=t.dataForm.prjName.replace(/\s+/g,"")}},model:{value:t.dataForm.prjName,callback:function(e){t.$set(t.dataForm,"prjName","string"===typeof e?e.trim():e)},expression:"dataForm.prjName"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:t.$t("project.location"),prop:"prjAddr"}},[e("el-input",{attrs:{placeholder:t.$t("project.location"),readonly:""},model:{value:t.dataForm.prjAddr,callback:function(e){t.$set(t.dataForm,"prjAddr",e)},expression:"dataForm.prjAddr"}})],1)],1)],1),e("el-row",[e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:t.$t("project.detailLocation"),prop:"prjaddress"}},[e("el-input",{attrs:{placeholder:t.$t("project.enterDetailLocation"),clearable:""},model:{value:t.dataForm.prjaddress,callback:function(e){t.$set(t.dataForm,"prjaddress",e)},expression:"dataForm.prjaddress"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:t.$t("project.creator"),prop:"createName"}},[e("el-input",{attrs:{placeholder:t.$t("project.creator"),readonly:""},model:{value:t.dataForm.createName,callback:function(e){t.$set(t.dataForm,"createName",e)},expression:"dataForm.createName"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{prop:"deptName",label:t.$t("user.deptName")}},[e("el-popover",{ref:"deptListPopover",attrs:{placement:"bottom-start",trigger:"click",disabled:0==t.superAdmin},model:{value:t.deptListVisible,callback:function(e){t.deptListVisible=e},expression:"deptListVisible"}},[e("el-input",{attrs:{size:"small",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}}),e("el-tree",{ref:"deptListTree",attrs:{id:"singleTree",data:t.deptIdList,props:{label:"name",children:"children"},"node-key":"id","highlight-current":!0,"expand-on-click-node":!1,accordion:"","filter-node-method":t.filterNode},on:{"current-change":t.deptListTreeCurrentChangeHandle}})],1),e("el-input",{directives:[{name:"popover",rawName:"v-popover:deptListPopover",arg:"deptListPopover"}],attrs:{readonly:!0,placeholder:t.$t("user.deptName")},model:{value:t.dataForm.deptName,callback:function(e){t.$set(t.dataForm,"deptName",e)},expression:"dataForm.deptName"}})],1)],1)],1)],1)],1),e("el-col",{attrs:{span:12}},[t.visible?e("div",{staticClass:"app-container"},[e("el-autocomplete",{staticStyle:{width:"100%"},attrs:{clearable:"","fetch-suggestions":function(e,a){t.getSearchList(e,a)},placeholder:t.$t("project.enterPosition"),"trigger-on-focus":!1},on:{select:t.handleSelect},model:{value:t.mapLocation.address,callback:function(e){t.$set(t.mapLocation,"address",e)},expression:"mapLocation.address"}}),e("div",{staticStyle:{margin:"5px"}},[e("div",{staticStyle:{width:"100%",height:"240px"},attrs:{id:"containerTprj"}})])],1):t._e()])],1),e("template",{slot:"footer"},[e("el-button",{on:{click:t.handleClose}},[t._v(t._s(t.$t("cancel")))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.dataFormSubmitHandle()}}},[t._v(t._s(t.$t("confirm")))])],1)],2)},n=[],i=(a("8e6e"),a("456d"),a("ade3")),o=(a("386d"),a("28a5"),a("ac6a"),a("7f7f"),a("b047")),s=a.n(o),d=a("4c12");function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function p(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){Object(i["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var c={props:{id:{type:String,default:""},createName:{type:String,default:""}},data:function(){return{map:null,mapZoom:18,marker:null,localsearch:null,visible:!1,loading:!1,mapLocation:{address:void 0},filterText:"",deptIdList:[],deptListVisible:!1,dataForm:{id:"",prjName:"",prjDesc:"",prjAddr:"",prjUrl:"",prjaddress:"",latitude:"30.310701",longitude:"120.382155",createName:"",deptId:"",deptName:""},superAdmin:0}},computed:{dataRule:function(){return{prjName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjDesc:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjAddr:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjaddress:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){var t=this;this.superAdmin=this.$store.state.user.superAdmin,this.$hasPermission("dept:select:permission.do")?(this.loading=!0,this.getSystemDeptList((function(e){t.filterText="",t.deptIdList=e.data.list,t.visible=!0,t.dataForm.id=t.id,t.mapZoom=18,t.$nextTick((function(){t.$refs["dataForm"].resetFields(),t.dataForm.id?t.getInfo():(t.handlerMap(),t.dataForm.deptId=t.$store.state.user.deptId,t.$refs.deptListTree&&(t.$refs.deptListTree.setCurrentKey(t.dataForm.deptId),setTimeout((function(){t.dataForm.deptName=t.$refs.deptListTree.getCurrentNode()?t.$refs.deptListTree.getCurrentNode().name:""}),200)),t.getCurrentlocation()),t.dataForm.createName=t.$store.state.user.name}))}))):(this.filterText="",this.deptIdList=[],this.visible=!0,this.dataForm.id=this.id,this.mapZoom=18,this.$nextTick((function(){t.$refs["dataForm"].resetFields(),t.dataForm.id?t.getInfo():(t.handlerMap(),t.dataForm.deptId=t.$store.state.user.deptId,t.$refs.deptListTree&&(t.$refs.deptListTree.setCurrentKey(t.dataForm.deptId),setTimeout((function(){t.dataForm.deptName=t.$refs.deptListTree.getCurrentNode()?t.$refs.deptListTree.getCurrentNode().name:""}),200)),t.getCurrentlocation()),t.dataForm.createName=t.$store.state.user.name,setTimeout((function(){t.$message.warning("暂无部门查询权限, 请联系管理员")}),500)})))},getSystemDeptList:function(t){var e=this;this.deptIdList=[],this.$http.get("/sys/dept/getDeptList.do",{params:{pageNum:1,pageSize:1e4}}).then((function(a){var r=a.data;if(0!=r.code)return e.$message.error(r.data||r.msg);t(r)}))},deptListTreeCurrentChangeHandle:function(t,e){this.dataForm.deptId=t.id,this.dataForm.deptName=t.name,this.deptListVisible=!1},filterNode:function(t,e,a){if(!t)return!0;a.level;var r=[];this.getReturnNode(a,r,t);var n=!1;return r.forEach((function(t){n=n||t})),n},getReturnNode:function(t,e,a){var r=t.data&&t.data.name&&-1!==t.data.name.indexOf(a);r&&e.push(r),!r&&1!=t.level&&t.parent&&this.getReturnNode(t.parent,e,a)},handlerMap:function(){var t=this;t.map=new T.Map("containerTprj",{projection:"EPSG:4326",attributionControl:!1,inertia:!1}),t.geocodeMap=new T.Geocoder,t.map.addEventListener("click",(function(e){t.makerCenter({lat:e.lnglat.lat,lng:e.lnglat.lng})})),t.$nextTick((function(){t.dataForm.id?t.getPrjInfoLocation():t.getCurrentlocation()}))},getCurrentlocation:function(){var t=this;if(!t.map)return!1;t.loading=!1;var e={point:{lat:30.30665,lng:120.36991}};t.dataForm.longitude=e.point.lng,t.dataForm.latitude=e.point.lat,t.makerCenter(e.point)},getPrjInfoLocation:function(){if(!this.map)return!1;this.mapZoom=18;var t={lat:null,lng:null};if(this.dataForm.longitude&&this.dataForm.latitude)if(parseInt(BigInt(this.dataForm.id)-BigInt(0x10a360d13ac32900))>0)t.lat=this.dataForm.latitude,t.lng=this.dataForm.longitude;else{var e=[this.dataForm.longitude,this.dataForm.latitude],a=d["a"].bd09ToWgs84.apply(d["a"],e);t.lat=a[1],t.lng=a[0]}else t.lat=30.30665,t.lng=120.36991;this.makerCenter(t)},getSuggestsAddressList:function(t){var e=[];if(t&&t.length>0)for(var a=0;a<t.length;a++){var r={};r.value=t[a].title,r.point={lat:t[a].point.lat,lng:t[a].point.lng},e.push(r)}return e},getSearchList:function(t,e){var a=this;a.localsearch=new T.LocalSearch(a.map,{pageCapacity:20,onSearchComplete:function(t){var a=[],r=t.getSuggests();if(r&&r.length>0){for(var n=0;n<r.length;n++){var i={};i.value=r[n].name+" "+r[n].address,i.point={lat:r[n].lonlat?r[n].lonlat.split(",")[1]:"",lng:r[n].lonlat?r[n].lonlat.split(",")[0]:""},a.push(i)}e(a)}else e([])}}),a.localsearch.search(t,4)},handleSelect:function(t){var e=t.point;this.dataForm.longitude=e.lng,this.dataForm.latitude=e.lat,this.makerCenter(e)},makerCenter:function(t){var e=this;e.map&&(e.marker&&e.map.removeOverLay(e.marker),e.dataForm.longitude=t.lng,e.dataForm.latitude=t.lat,e.map.centerAndZoom(new T.LngLat(t.lng,t.lat),e.map.getZoom()||e.mapZoom),e.marker=new T.Marker(new T.LngLat(t.lng,t.lat)),e.map.addOverLay(e.marker),e.geocodeMap&&e.geocodeMap.getLocation(new T.LngLat(t.lng,t.lat),(function(t){if(!t.addressComponent)return e.mapLocation.address="",!1;e.mapLocation.address=t.formatted_address,e.dataForm.prjAddr=t.addressComponent.province+t.addressComponent.city+t.addressComponent.county,e.dataForm.prjaddress=t.formatted_address}))),e.loading=!1},getInfo:function(){var t=this;return t.$hasPermission("tprjinfo:select:permission.do")?t.dataForm.id?(t.loading=!0,void t.$http.get("/info/tprjinfo/".concat(t.dataForm.id)).then((function(e){var a=e.data;if(0!==a.code)return t.loading=!1,t.$message.error(a.data||a.msg);t.dataForm=p(p({},t.dataForm),a.data),t.dataForm.createName=t.createName,t.$refs.deptListTree&&(t.$refs.deptListTree.setCurrentKey(t.dataForm.deptId),setTimeout((function(){t.dataForm.deptName=t.$refs.deptListTree.getCurrentNode()?t.$refs.deptListTree.getCurrentNode().name:""}),200)),t.handlerMap()})).catch((function(e){return t.loading=!1,!1}))):(this.visible=!1,this.$message.error(this.$t("failedToGetProjectId"))):(t.$message.warning("暂无根据项目ID查询权限, 请联系管理员"),void t.handlerMap())},handleClose:function(){if(this.map){var t=document.getElementById("containerTprj");t&&(t.innerHTML=""),this.map=null}this.visible=!1},dataFormSubmitHandle:s()((function(){var t=this;this.$refs["dataForm"].validate((function(e){if(!e)return!1;var a={};if(t.dataForm.id){if(a={deptId:t.dataForm.deptId,id:t.dataForm.id,latitude:t.dataForm.latitude,longitude:t.dataForm.longitude,prjAddr:t.dataForm.prjAddr,prjDesc:t.dataForm.prjDesc,prjName:t.dataForm.prjName,prjUrl:t.dataForm.prjUrl,prjaddress:t.dataForm.prjaddress},!t.$hasPermission("info:tprjinfo:update"))return void t.$message.warning("暂无项目修改权限, 请联系管理员")}else if(a=t.dataForm,!t.$hasPermission("info:tprjinfo:save"))return void t.$message.warning("暂无项目保存权限, 请联系管理员");t.loading=!0,t.$http[t.dataForm.id?"put":"post"]("/info/tprjinfo/",a).then((function(e){var a=e.data;if(t.loading=!1,0!==a.code)return t.$message.error(a.data||a.msg);t.$message({message:t.$t("prompt.success"),type:"success",duration:500,onClose:function(){t.visible=!1,t.$emit("refreshDataList")}})})).catch((function(e){return t.loading=!1,!1}))}))}),1e3,{leading:!0,trailing:!1})},watch:{filterText:function(t){this.$refs.deptListTree.filter(t)}}},m=c,u=(a("211f"),a("2877")),h=Object(u["a"])(m,r,n,!1,null,null,null);e["default"]=h.exports}}]);