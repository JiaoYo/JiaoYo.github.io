(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21d486"],{d147:function(e,a,t){"use strict";t.r(a);var i=function(){var e=this,a=e._self._c;return a("el-dialog",{attrs:{width:"800",visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(a){e.visible=a},opened:e.handleDialogOpenChange}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":"140px"},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.dataFormSubmitHandle()}}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{prop:"fileVersion",label:e.$t("upgrade.fileVersion")}},[a("el-input",{attrs:{placeholder:e.$t("upgrade.fileVersion"),maxlength:255,clearable:""},model:{value:e.dataForm.fileVersion,callback:function(a){e.$set(e.dataForm,"fileVersion",a)},expression:"dataForm.fileVersion"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{prop:"available",label:e.$t("upgrade.available")}},[a("el-radio-group",{model:{value:e.dataForm.available,callback:function(a){e.$set(e.dataForm,"available",a)},expression:"dataForm.available"}},e._l(e.availableList,(function(t){return a("el-radio",{key:t.label,attrs:{label:t.value}},[e._v("\n                            "+e._s(t.label)+"\n                        ")])})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{prop:"fileDesc",label:e.$t("upgrade.filedesc")}},[a("el-input",{attrs:{placeholder:e.$t("upgrade.filedesc"),maxlength:255,clearable:""},model:{value:e.dataForm.fileDesc,callback:function(a){e.$set(e.dataForm,"fileDesc",a)},expression:"dataForm.fileDesc"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{prop:"fileType",label:e.$t("upgrade.filetype")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("upgrade.pleaseSelect")},model:{value:e.dataForm.fileType,callback:function(a){e.$set(e.dataForm,"fileType",a)},expression:"dataForm.fileType"}},e._l(e.fileTypeList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{directives:[{name:"show",rawName:"v-show",value:1===e.dataForm.fileType,expression:"dataForm.fileType === 1"}],attrs:{span:12}},[a("el-form-item",[a("el-checkbox",{model:{value:e.dataForm.isChecked,callback:function(a){e.$set(e.dataForm,"isChecked",a)},expression:"dataForm.isChecked"}},[e._v(e._s(e.$t("upgrade.isItAFactoryPackage")))])],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"","label-width":"60px"}},[a("el-upload",{staticClass:"upload-demo",attrs:{drag:"",multiple:!0,"file-list":e.fileList,accept:"application/x-gzip, application/octet-stream","before-upload":e.handleBeforeUploadZip,"http-request":e.requestFile,"on-remove":e.removeFile,action:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text",domProps:{innerHTML:e._s(e.$t("upload.text"))}})])],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"","label-width":"60px"}},[a("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"","http-request":e.uploadSectionMd5File,"on-remove":e.handleMd5Remove,"file-list":e.md5CodeFileList,"before-upload":e.beforeMd5Upload}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text",domProps:{innerHTML:e._s(e.$t("upload.textMd5"))}})])],1)],1)],1)],1),a("template",{slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),a("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},l=[],s=(t("7f7f"),t("28a5"),t("ac6a"),t("bc3a")),o=t.n(s),r=(t("f744"),t("b047")),n=t.n(r),d=null,p={data:function(){return{visible:!1,loading:!1,interfaceMap:{},loadProgress:0,fileList:[],md5CodeFileList:[],md5CodeMap:{},uploadFileList:[],saveQueryParams:[],dataForm:{fileDesc:this.$t("upgrade.pleaseReviewTheCompleteUpdateLog"),fileVersion:"",available:1,fileType:1,isChecked:!1},availableList:[{label:this.$t("upgrade.yes"),value:1},{label:this.$t("upgrade.no"),value:0}],fileTypeList:[{label:this.$t("upgrade.upgradePack"),value:1},{label:this.$t("upgrade.factoryPack"),value:2}],domain:"https://firmware.linkqi.cn",rules:{fileVersion:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){this.visible=!0},handleDialogOpenChange:function(){var e=this;e.fileList=[],e.md5CodeMap={},e.md5CodeFileList=[],e.uploadFileList=[],e.saveQueryParams=[],e.loadProgress=0,e.loading=!1,e.getInterFaceInfo((function(){e.getInterfaceRootAndChildren(),e.$nextTick((function(){e.$notify({title:e.$t("prompt.title"),message:e.$t("upgrade.pleaseUploadTheMdFileFirstForMatching"),duration:2e3}),e.$refs["dataForm"].resetFields()}))}))},getInterFaceInfo:function(e){var a={_t:(new Date).getTime()};o.a.get("https://dingiiot.com/interfaceInfo.json",{params:a}).then((function(a){var t=a.data;d=t,e()})).catch((function(e){return!1}))},getInterfaceRootAndChildren:function(){var e=this,a={};e.$hasPermission("interface:manu:select:permission.do")?e.$http.get("/gwtype/interface/selectMenu.do",{params:a}).then((function(a){var t=a.data;if(0!=t.code)return e.$message.error(t.data||t.msg);e.interfaceMap=t.data})):e.$message.warning("暂无权限, 请联系管理员")},removeFile:function(){this.loading=!1},handleBeforeUploadZip:function(e){var a=this,t="";return a.interfaceMap.forEach((function(a){(d[e.name.split("-")[1]]==a.model||a.hasOwnProperty("list")&&a.list.length>0&&-1!=a.list.indexOf(d[e.name.split("-")[1]]))&&(t="bin/"+a.model+"/"+e.name)})),t?!(e.size>1048576e3)||(a.$message.error(a.$t("upgrade.uploadFileSizeExceeds")),!1):(a.$message.error(e.name+a.$t("upgrade.noMatchingVersionNumberFound")),!1)},uploadWithSDK:function(e){var a=this,t="",i=new FormData;if(e){var l="";if(a.interfaceMap.forEach((function(a){(d[e.name.split("-")[1]]==a.model||a.hasOwnProperty("list")&&a.list.length>0&&-1!=a.list.indexOf(d[e.name.split("-")[1]]))&&(t=a.model,l="bin/"+a.model+"/"+e.name)})),!l)return a.loading=!1,a.$message.error(e.name+a.$t("upgrade.noMatchingVersionNumberFound")),!1;if(e.size>1048576e3)return a.loading=!1,a.$message.error(a.$t("upgrade.uploadFileSizeExceeds")),!1;a.fileList.push(e),i.append("file",e),i.append("gwModel",t),i.append("name",e.name),a.$http.post("/upload/upload",i).then((function(e){var t=e.data;0==t.code?(a.uploadFileList.push("https://"+t.data),a.uploadFileList.length==a.fileList.length&&(a.uploadFileList.forEach((function(e){a.interfaceMap.forEach((function(t){(d[e.split("ioserver_bin")[1].split("-")[1]]==t.model||t.hasOwnProperty("list")&&t.list.length>0&&-1!=t.list.indexOf(d[e.split("ioserver_bin")[1].split("-")[1]]))&&(1==a.dataForm.fileType&&a.dataForm.isChecked?(a.saveQueryParams.push({available:a.dataForm.available,file_desc:a.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:a.dataForm.fileType,file_url:e,file_version:a.dataForm.fileVersion,gw_model:t.model,patch_target:"",md5code:a.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?a.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""}),a.saveQueryParams.push({available:a.dataForm.available,file_desc:a.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:2,file_url:e,file_version:a.dataForm.fileVersion,gw_model:t.model,patch_target:"",md5code:a.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?a.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""})):a.saveQueryParams.push({available:a.dataForm.available,file_desc:a.dataForm.fileDesc,file_name:e.substr(e.lastIndexOf("/")+1),file_type:a.dataForm.fileType,file_url:e,file_version:a.dataForm.fileVersion,gw_model:t.model,patch_target:"",md5code:a.md5CodeMap[e.substr(e.lastIndexOf("/")+1)]?a.md5CodeMap[e.substr(e.lastIndexOf("/")+1)].toLocaleLowerCase():""}))}))})),a.loading=!1)):(a.$message.error(t.data||a.$t("upgrade.uploadError")),a.loading=!1)})).catch((function(e){return a.loading=!1,a.$message.error("请求超时, 请查看是否操作成功"),!1}))}},requestFile:function(e){this.loading=!0,this.uploadWithSDK(e.file)},beforeMd5Upload:function(e){if(-1==e.name.indexOf(".md5"))return this.$message.error(this.$t("upload.tip",{format:"md5"})),!1},handleMd5Remove:function(e,a){this.md5CodeMap={},this.md5CodeFileList=a,this.md5CodeFileList=[]},uploadSectionMd5File:function(e){this.md5CodeFileList.push(e.file),this.getUploadMd5Data(e.file)},getUploadMd5Data:function(e){var a=this;a.md5CodeMap={};var t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=function(e){var t=e.target.result.split("\n");t.length>0&&t.forEach((function(e){if(e){var t=e.split(/\s+/);t.length>1&&(a.md5CodeMap[t[1]]=t[0])}}))}},handleClose:n()((function(){this.fileList=[],this.saveQueryParams=[],this.loading=!1,this.loadProgress=0,this.visible=!1}),1e3,{leading:!0,trailing:!1}),dataFormSubmitHandle:n()((function(){var e=this;this.$refs["dataForm"].validate((function(a){return!!a&&(0===e.fileList.length||0==e.saveQueryParams.length?e.$message.info(e.$t("upgrade.pleaseUploadFile")):(e.saveQueryParams[0].fileVersion||e.saveQueryParams.forEach((function(a){a.file_version=e.dataForm.fileVersion})),void(e.$hasPermission("interface:insetList:permission.do")?(e.saveQueryParams.forEach((function(a){1==e.dataForm.fileType&&e.dataForm.isChecked?(a.file_version=e.dataForm.fileVersion,a.file_desc=e.dataForm.fileDesc,a.available=e.dataForm.available):(a.file_version=e.dataForm.fileVersion,a.file_desc=e.dataForm.fileDesc,a.available=e.dataForm.available,a.file_type=e.dataForm.fileType)})),e.$http.post("/gwtype/interface/insetList.do",e.saveQueryParams).then((function(a){var t=a.data;if(0!=t.code)return e.$message.error(t.data||t.msg);e.$message.success(t.msg),e.visible=!1,e.$emit("refreshDataList")})).catch((function(a){return e.visible=!1,e.$emit("refreshDataList"),!1}))):e.$message.warning("暂无版本新增权限, 请联系管理员"))))}))}),1e3,{leading:!0,trailing:!1})}},f=p,c=t("2877"),m=Object(c["a"])(f,i,l,!1,null,null,null);a["default"]=m.exports}}]);