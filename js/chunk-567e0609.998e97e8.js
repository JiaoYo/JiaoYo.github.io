(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-567e0609","chunk-2d222545"],{"30c5":function(t,e,o){"use strict";o.r(e);o("7f7f");var a=function(){var t=this,e=t._self._c;return e("el-card",{attrs:{shadow:"never"}},[e("el-form",{attrs:{inline:!0,model:t.dataForm},nativeOn:{submit:function(t){t.preventDefault()},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.querySearch()}}},[e("el-form-item",[e("el-select",{staticStyle:{width:"160px"},attrs:{size:"small",filterable:"",clearable:"",placeholder:t.$t("protocol.pleaseSelectProtocolProperty")},on:{change:t.querySearch},model:{value:t.dataForm.attribute,callback:function(e){t.$set(t.dataForm,"attribute",e)},expression:"dataForm.attribute"}},t._l(t.attributeList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",[e("el-select",{staticStyle:{width:"160px"},attrs:{size:"small",filterable:"",clearable:"",placeholder:t.$t("protocol.pleaseSelectProtocolType")},on:{change:t.querySearch},model:{value:t.dataForm.type,callback:function(e){t.$set(t.dataForm,"type",e)},expression:"dataForm.type"}},t._l(t.typeList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",[e("el-input",{attrs:{placeholder:t.$t("protocol.pleaseEnterProtocolName"),clearable:"",size:"small"},on:{clear:t.querySearch},model:{value:t.dataForm.name,callback:function(e){t.$set(t.dataForm,"name",e)},expression:"dataForm.name"}})],1),t.$hasPermission("protocol:select:permission.do")?e("el-form-item",[e("el-button",{attrs:{icon:"el-icon-search",size:"small"},on:{click:function(e){return t.querySearch()}}},[t._v(t._s(t.$t("query")))])],1):t._e(),1==t.superAdmin&&t.$hasPermission("protocol:insert:permission.do")?e("el-form-item",[e("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(e){return t.handleAddOrUpdateProtocolChange()}}},[t._v(t._s(t.$t("add")))])],1):t._e(),1==t.superAdmin&&t.$hasPermission("protocol:insert:permission.do")?e("el-form-item",[e("el-button",{attrs:{disabled:1!=t.protocolIds.length,size:"small",icon:"el-icon-copy-document",type:"primary"},on:{click:function(e){return t.handleCopyProtocolChange()}}},[t._v(t._s(t.$t("copy")))])],1):t._e()],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dataListLoading,expression:"dataListLoading"}],ref:"protocolTable",staticStyle:{width:"100%"},attrs:{size:"small",data:t.dataList,border:"","max-height":t.scrollTableHeight,"row-key":t.getRowKey,"row-style":{height:"20px"},"cell-style":{padding:"2px"}},on:{"selection-change":t.dataListSelectionProtocolChangeHandle}},[1==t.superAdmin&&t.$hasPermission("protocol:select:permission.do")&&t.$hasPermission("protocol:insert:permission.do")?e("el-table-column",{key:"1",attrs:{type:"selection","header-align":"center",align:"center",width:"50","reserve-selection":!0}}):t._e(),e("el-table-column",{key:"2",attrs:{prop:"name",label:t.$t("role.name"),"header-align":"center",align:"center","show-overflow-tooltip":!0}}),e("el-table-column",{key:"3",attrs:{prop:"libName",label:t.$t("protocol.protocolLibraryName"),"header-align":"center",align:"center","show-overflow-tooltip":!0}}),e("el-table-column",{key:"4",attrs:{prop:"manuf",label:t.$t("protocol.manufacturer"),"header-align":"center",align:"center",width:"160","show-overflow-tooltip":!0}}),e("el-table-column",{key:"5",attrs:{prop:"attribute",label:t.$t("protocol.protocolProperty"),"header-align":"center",align:"center",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(0==e.row.attribute?t.$t("protocol.collectionProtocol"):1==e.row.attribute?t.$t("protocol.forwardingProtocol"):t.$t("protocol.maintenanceAgreement"))+"\n            ")]}}])}),e("el-table-column",{key:"6",attrs:{prop:"type",label:t.$t("protocol.protocolType"),"header-align":"center",align:"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(0==e.row.type?"TCP":1==e.row.type?t.$t("channelInfo.com"):"OPC")+"\n            ")]}}])}),e("el-table-column",{key:"7",attrs:{prop:"defaultCfg",label:t.$t("protocol.defaultParameter"),"header-align":"center",align:"center",width:"180","show-overflow-tooltip":!0}}),e("el-table-column",{key:"8",attrs:{prop:"funcCode",label:t.$t("protocol.functionCode"),"header-align":"center",align:"center",width:"180","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(o){return[e("el-tooltip",{attrs:{placement:"right"}},[e("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.toBreakWay(o.row.funcCode))},slot:"content"}),e("span",{domProps:{innerHTML:t._s(t.viewJsonWay(o.row.funcCode))}})])]}}])}),1==t.superAdmin&&t.$hasPermission("protocol:insert:permission.do")&&t.$hasPermission("protocol:update:permission.do")?e("el-table-column",{key:"9",attrs:{label:t.$t("handle"),fixed:"right","header-align":"center",align:"center",width:"150"},scopedSlots:t._u([{key:"default",fn:function(o){return[t.$hasPermission("protocol:update:permission.do")?e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.handleAddOrUpdateProtocolChange(o.row)}}},[t._v(t._s(t.$t("update")))]):t._e(),t.$hasPermission("protocol:insert:permission.do")?e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.handleCopyProtocolChange(o.row)}}},[t._v(t._s(t.$t("copy")))]):t._e()]}}],null,!1,2864439342)}):t._e()],1),e("el-pagination",{attrs:{"current-page":t.page,"page-sizes":[10,20,50,100],"page-size":t.limit,total:t.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"size-change":t.pageSizeChangeHandle,"current-change":t.pageCurrentChangeHandle}}),t.addOrUpdateVisible?e("add-or-update",{ref:"addOrUpdate",attrs:{id:t.dataForm.propId,copySource:t.dataForm.propCopySource},on:{refreshDataList:t.getDataList}}):t._e()],1)},r=[],n=(o("ac6a"),o("c5f6"),o("b047")),i=o.n(n),l=o("cdc1"),c={data:function(){return{page:1,limit:20,total:0,dataList:[],dataListLoading:!1,addOrUpdateVisible:!1,protocolIds:[],superAdmin:0,scrollTableHeight:window.innerHeight-220-53,dataForm:{attribute:"",type:"",name:"",propId:"",propCopySource:null},attributeList:[{label:this.$t("protocol.collectionProtocol"),value:0},{label:this.$t("protocol.forwardingProtocol"),value:1},{label:this.$t("protocol.maintenanceAgreement"),value:2}],typeList:[{label:"TCP",value:0},{label:this.$t("channelInfo.com"),type:1},{label:"OPC",value:2}]}},components:{AddOrUpdate:l["default"]},methods:{pageSizeChangeHandle:function(t){this.limit=t,this.page=1,this.getDataList()},pageCurrentChangeHandle:function(t){this.page=t,this.getDataList()},querySearch:function(){this.page=1,this.getDataList()},getDataList:i()((function(){var t=this,e={page:t.page,limit:t.limit};null==t.dataForm.attribute&&void 0==t.dataForm.attribute||(e["attribute"]=t.dataForm.attribute),null==t.dataForm.type&&void 0==t.dataForm.type||(e["Type"]=t.dataForm.type),t.dataForm.name&&(e["fuzzy"]=t.dataForm.name),t.protocolIds=[],t.dataList=[],t.total=0,t.$hasPermission("protocol:select:permission.do")?(t.dataListLoading=!0,t.$refs.protocolTable.clearSelection(),t.$http.get("/protocol/getPage.do",{params:e}).then((function(o){var a=o.data;if(0!=a.code)return t.dataListLoading=!1,t.$message.error(a.data||a.msg);t.page=e.page,t.dataListLoading=!1,t.dataList=a.data.list,t.total=Number(a.data.total)||0,t.$refs.protocolTable&&t.$refs.protocolTable.doLayout&&t.$refs.protocolTable.doLayout()})).catch((function(e){return t.dataListLoading=!1,!1}))):t.$message.warning("暂无协议查询权限, 请联系管理员")}),10,{leading:!0,trailing:!1}),toBreakWay:function(t){if(t){var e="",o=JSON.parse(t).data;return o.forEach((function(t){e+=t.description+": "+t.FuncCode+"<br />"})),e}return""},viewJsonWay:function(t){if(t){var e="",o=JSON.parse(t).data;return o.length>1?e+=o[0].description+": "+o[0].FuncCode+"(剩余"+(o.length-1)+"个)":o.forEach((function(t){e+=t.description+": "+t.FuncCode+"<br />"})),e}return""},getRowKey:function(t){return t.id},dataListSelectionProtocolChangeHandle:function(t){var e=this;this.protocolIds=[],t.forEach((function(t){e.protocolIds.push(t.id)}))},handleAddOrUpdateProtocolChange:function(t){var e=this;this.dataForm.propId="",this.dataForm.propCopySource=null,t&&(this.dataForm.propId=t.id),this.addOrUpdateVisible=!0,this.$nextTick((function(){e.$refs.addOrUpdate.init()}))},handleCopyProtocolChange:function(t){var e=this;if(t)e.dataForm.propCopySource=t,e.dataForm.propId="",e.addOrUpdateVisible=!0,e.$nextTick((function(){e.$refs.addOrUpdate.init()}));else{if(0===e.protocolIds.length||e.protocolIds.length>1)return e.$message.error("请选择一个协议以进行复制操作");for(var o=0;o<e.dataList.length;o++)if(e.dataList[o].id==e.protocolIds[0]){e.dataForm.propCopySource=e.dataList[o],e.dataForm.propId="",e.addOrUpdateVisible=!0,e.$nextTick((function(){e.$refs.addOrUpdate.init()}));break}}},handleDeleteProtocolChange:function(t){var e=this,o={ids:""};if(t)o["ids"]=t;else{if(0===e.protocolIds.length)return e.$message.error(e.$t("deleteInfo.noData"));o["ids"]=e.protocolIds.join(",")}e.$hasPermission("protocol:delete:permission.do")?e.$confirm(e.$t("deleteInfo.noticeTitle"),e.$t("deleteInfo.noticePrompt"),{confirmButtonText:e.$t("deleteInfo.confirm"),cancelButtonText:e.$t("deleteInfo.cancel"),type:"warning"}).then((function(){e.dataListLoading=!0,e.$http.delete("/protocol/delete.do",{params:o}).then((function(t){var o=t.data;if(0!=o.code)return e.dataListLoading=!1,e.$message.error(o.data||e.$t("deleteInfo.deleteFail"));e.$message.success(e.$t("deleteInfo.deleteSuccess")),e.dataListLoading=!1,e.getDataList(),e.$refs.protocolTable.clearSelection()})).catch((function(t){return e.dataListLoading=!1,!1}))})).catch((function(t){})):e.$message.warning("暂无协议删除权限, 请联系管理员")}},updated:function(){this.$refs.protocolTable&&this.$refs.protocolTable.doLayout&&this.$refs.protocolTable.doLayout()},mounted:function(){var t=this;this.getDataList(),this.superAdmin=this.$store.state.user.superAdmin,window.onresize=function(){return function(){t.scrollTableHeight=window.innerHeight-220-53,t.$refs.protocolTable&&t.$refs.protocolTable.doLayout&&t.$refs.protocolTable.doLayout()}()}},watch:{total:function(){this.total==(this.page-1)*this.limit&&0!=this.total&&(this.page-=1,this.getDataList())}}},s=c,d=o("2877"),u=Object(d["a"])(s,a,r,!1,null,null,null);e["default"]=u.exports},cdc1:function(t,e,o){"use strict";o.r(e);o("7f7f");var a=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.visible,title:t.dataForm.id?t.$t("update"):t.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.visible=e},opened:t.handleDialogOpenChange}},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",attrs:{model:t.dataForm,rules:t.dataRule,"label-width":"en-US"===t.$i18n.locale?"180px":"120px"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.dataFormSubmitHandle()}}},[e("el-row",[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{prop:"name",label:t.$t("protocol.protocolName")}},[e("el-input",{attrs:{placeholder:t.$t("protocol.pleaseEnterProtocolName"),clearable:""},model:{value:t.dataForm.name,callback:function(e){t.$set(t.dataForm,"name",e)},expression:"dataForm.name"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{prop:"manuf",label:t.$t("protocol.protocolManufacturer")}},[e("el-input",{attrs:{placeholder:t.$t("protocol.pleaseEnterTheProtocolManufacturer"),clearable:""},model:{value:t.dataForm.manuf,callback:function(e){t.$set(t.dataForm,"manuf",e)},expression:"dataForm.manuf"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{prop:"attribute",label:t.$t("protocol.protocolProperty")}},[e("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:t.$t("protocol.pleaseSelectProtocolProperty")},model:{value:t.dataForm.attribute,callback:function(e){t.$set(t.dataForm,"attribute",e)},expression:"dataForm.attribute"}},t._l(t.attributeList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{prop:"type",label:t.$t("protocol.protocolType")}},[e("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:t.$t("protocol.pleaseSelectProtocolType")},model:{value:t.dataForm.type,callback:function(e){t.$set(t.dataForm,"type",e)},expression:"dataForm.type"}},t._l(t.typeList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{prop:"libName",label:t.$t("protocol.protocolLibraryName")}},[e("el-input",{attrs:{placeholder:t.$t("protocol.pleaseEnterTheNameOfTheProtocolLibrary"),clearable:""},model:{value:t.dataForm.libName,callback:function(e){t.$set(t.dataForm,"libName",e)},expression:"dataForm.libName"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{prop:"groupID",label:t.$t("protocol.protocolGrouping")}},[e("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:t.$t("protocol.pleaseSelectAProtocolGroup")},model:{value:t.dataForm.groupID,callback:function(e){t.$set(t.dataForm,"groupID",e)},expression:"dataForm.groupID"}},t._l(t.groupIdList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.groupName,value:t.groupID}})})),1)],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{prop:"defaultCfg",label:t.$t("protocol.defaultParameter")}},[e("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:t.$t("protocol.pleaseEnterDefaultParameters")},model:{value:t.dataForm.defaultCfg,callback:function(e){t.$set(t.dataForm,"defaultCfg",e)},expression:"dataForm.defaultCfg"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{prop:"funcCode",label:t.$t("protocol.functionCode")}},[e("el-button",{attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"small"},on:{click:t.handleAddFuncodeList}},[t._v("\n                        "+t._s(t.$t("add"))+"\n                    ")]),e("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{size:"small",border:"",data:t.funcCodeList.concat(t.fixFuncCodeList),"row-style":{height:"20px"},"cell-style":{padding:"2px"},"max-height":300}},[e("el-table-column",{attrs:{prop:"FuncCode",label:t.$t("protocol.index"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("el-input",{attrs:{readonly:1==t.dataForm.attribute?99==o.row.FuncCode:98==o.row.FuncCode||99==o.row.FuncCode,placeholder:t.$t("protocol.pleaseEnterTheIndex"),clearable:"",onkeyup:"value=value.replace(/[^0-9]/g,'')",onpaste:"value=value.replace(/[^0-9]/g,'')"},model:{value:o.row.FuncCode,callback:function(e){t.$set(o.row,"FuncCode",e)},expression:"scope.row.FuncCode"}})]}}])}),e("el-table-column",{attrs:{prop:"description",label:t.$t("product.description"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("el-input",{attrs:{readonly:1==t.dataForm.attribute?99==o.row.FuncCode:98==o.row.FuncCode||99==o.row.FuncCode,placeholder:t.$t("product.pleaseEnterTheDescription"),clearable:""},model:{value:o.row.description,callback:function(e){t.$set(o.row,"description",e)},expression:"scope.row.description"}})]}}])}),e("el-table-column",{attrs:{label:t.$t("handle"),align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(o){return[1!=t.dataForm.attribute&&98==o.row.FuncCode||99==o.row.FuncCode?t._e():e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handleDeleteFuncodeList(o.$index)}}},[t._v("\n                                    "+t._s(t.$t("delete"))+"\n                                ")])]}}])})],1)],1)],1)],1)],1),e("template",{slot:"footer"},[e("el-button",{on:{click:function(e){t.visible=!1}}},[t._v(t._s(t.$t("cancel")))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.dataFormSubmitHandle()}}},[t._v(t._s(t.$t("confirm")))])],1)],2)},r=[],n=(o("8e6e"),o("456d"),o("5df3"),o("4f7f"),o("2909")),i=o("ade3"),l=(o("c5f6"),o("ac6a"),o("ed08")),c=o("b047"),s=o.n(c);function d(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,a)}return o}function u(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?d(Object(o),!0).forEach((function(e){Object(i["a"])(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var p={props:["id","copySource"],data:function(){return{loading:!1,visible:!1,dataForm:{id:"",name:"",manuf:"",attribute:0,type:0,libName:"",groupID:"",defaultCfg:"",funcCode:"",iscopy:!0},attributeList:[{label:this.$t("protocol.collectionProtocol"),value:0},{label:this.$t("protocol.forwardingProtocol"),value:1},{label:this.$t("protocol.maintenanceAgreement"),value:2}],typeList:[{label:"TCP",value:0},{label:this.$t("channelInfo.com"),value:1},{label:"OPC",value:2}],groupIdList:[],funcCodeList:[{FuncCode:1,description:""}],fixFuncCodeList:[{FuncCode:98,description:this.$t("protocol.calculationPoint")},{FuncCode:99,description:this.$t("protocol.deviceCommunicationInterruption")}]}},computed:{dataRule:function(){return{name:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],manuf:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],libName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],groupID:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){this.visible=!0,this.loading=!0},handleDialogOpenChange:function(){this.$refs["dataForm"].resetFields(),this.dataForm.id=this.id,this.getGroupDataList()},getGroupDataList:function(){var t=this;if(this.groupIdList=[],!this.$hasPermission("protocol:select:permission.do"))return this.loading=!1,void this.$message.warning("暂无协议分组查询权限, 请联系管理员");this.$http.get("/protocol/getGroup.do",{}).then((function(e){var o=e.data;if(0!=o.code)return t.loading=!1,t.$message.error(o.data||o.msg);o.data.forEach((function(e){-1!=e.upGroupID&&t.groupIdList.push(e)})),t.dataForm.id?t.getInfo():t.copySource?(t.dataForm.name=t.copySource.name,t.dataForm.manuf=t.copySource.manuf,t.dataForm.attribute=t.copySource.attribute,t.dataForm.type=t.copySource.type,t.dataForm.libName=t.copySource.libName,t.dataForm.groupID=t.copySource.groupID,t.dataForm.defaultCfg=t.copySource.defaultCfg,t.dataForm.iscopy=!0,0==t.dataForm.attribute?(t.funcCodeList=JSON.parse(t.copySource.funcCode).data.slice(0,JSON.parse(t.copySource.funcCode).data.length-2),t.fixFuncCodeList=[{FuncCode:98,description:t.$t("protocol.calculationPoint")},{FuncCode:99,description:t.$t("protocol.deviceCommunicationInterruption")}]):1==t.dataForm.attribute?(t.funcCodeList=JSON.parse(t.copySource.funcCode).data.slice(0,JSON.parse(t.copySource.funcCode).data.length-1),t.fixFuncCodeList=JSON.parse(t.copySource.funcCode).data.slice(JSON.parse(t.copySource.funcCode).data.length-1,JSON.parse(t.copySource.funcCode).data.length)):(t.funcCodeList=JSON.parse(t.copySource.funcCode).data,t.fixFuncCodeList=[]),t.loading=!1):(0==t.dataForm.attribute?t.fixFuncCodeList=[{FuncCode:98,description:t.$t("protocol.calculationPoint")},{FuncCode:99,description:t.$t("protocol.deviceCommunicationInterruption")}]:1==t.dataForm.attribute?t.fixFuncCodeList=[{FuncCode:99,description:t.$t("protocol.deviceCommunicationInterruption")}]:(t.funcCodeList=[],t.fixFuncCodeList=[]),t.dataForm.groupID=t.groupIdList.length>0?t.groupIdList[0].id:"",t.loading=!1)})).catch((function(t){return!1}))},handleAddFuncodeList:function(){var t={FuncCode:this.funcCodeList.length>0?Number(this.funcCodeList[this.funcCodeList.length-1].FuncCode)+1:1,description:""};this.funcCodeList.push(t)},handleDeleteFuncodeList:function(t){this.funcCodeList.splice(t,1)},getInfo:function(){var t=this;if(this.funcCodeList=[],!this.$hasPermission("protocol:select:permission.do"))return this.loading=!1,void this.$message.warning("暂无协议信息查询权限, 请联系管理员");this.$http.get("/protocol/selectById.do",{params:{id:this.dataForm.id}}).then((function(e){var o=e.data;if(0!==o.code)return t.loading=!1,t.$message.error(o.data||o.msg);if(t.dataForm=u(u({},t.dataForm),o.data),o.data.funcCode){var a=JSON.parse(o.data.funcCode).data;a.forEach((function(e){98!=e.FuncCode&&99!=e.FuncCode&&t.funcCodeList.push(e)}))}t.loading=!1})).catch((function(e){return t.loading=!1,!1}))},dataFormSubmitHandle:s()((function(){var t=this,e="",o=!0,a=null,r=[],i=[],c=this.funcCodeList.concat(this.fixFuncCodeList);this.$refs["dataForm"].validate((function(s){if(!s)return!1;if(t.dataForm.defaultCfg&&!Object(l["r"])(t.dataForm.defaultCfg))return t.$message.error("请填写正确的默认参数");c.forEach((function(t){r.push(Number(t.FuncCode)),i.push(t.description),null!=t.FuncCode&&void 0!=t.FuncCode&&t.description||(o=!1)}));var d=Object(n["a"])(new Set(r)),u=Object(n["a"])(new Set(i));if(!o)return t.$message.warning(t.$t("protocol.functionCodeIndexAndDescriptionCannotBeEmpty"));if(d.length!=c.length)return t.$message.warning(t.$t("protocol.theFunctionCodeIndexCannotBeDuplicated"));if(u.length!=c.length)return t.$message.warning(t.$t("protocol.functionCodeDescriptionCannotBeDuplicated"));if(t.dataForm.id){if(!t.$hasPermission("protocol:update:permission.do"))return void t.$message.warning("暂无协议修改权限, 请联系管理员");e="/protocol/update.do",a=[{id:t.dataForm.id,attribute:t.dataForm.attribute,defaultCfg:t.dataForm.defaultCfg,funcCode:JSON.stringify({data:c}),groupID:t.dataForm.groupID,libName:t.dataForm.libName,manuf:t.dataForm.manuf,name:t.dataForm.name,type:t.dataForm.type}]}else{if(!t.$hasPermission("protocol:insert:permission.do"))return void t.$message.warning("暂无协议新增权限, 请联系管理员");a=[{attribute:t.dataForm.attribute,defaultCfg:t.dataForm.defaultCfg,funcCode:JSON.stringify({data:c}),groupID:t.dataForm.groupID,libName:t.dataForm.libName,manuf:t.dataForm.manuf,name:t.dataForm.name,type:t.dataForm.type}],e="/protocol/insert.do",t.copySource&&(e="/protocol/insert.do?oid="+t.copySource.id)}t.loading=!0,t.$http[t.dataForm.id?"put":"post"](e,a).then((function(e){var o=e.data;if(0!==o.code)return t.loading=!1,t.$message.error(o.data||o.msg);t.loading=!1,t.$message({message:t.$t("prompt.success"),type:"success",duration:500,onClose:function(){t.visible=!1,t.$emit("refreshDataList")}})})).catch((function(e){return t.loading=!1,!1}))}))}),1e3,{leading:!0,trailing:!1})}},m=p,f=o("2877"),h=Object(f["a"])(m,a,r,!1,null,null,null);e["default"]=h.exports}}]);