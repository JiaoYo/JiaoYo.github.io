(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a25920c","chunk-4c0d6fe5"],{"04ef":function(e,t,a){"use strict";a("4c9d")},"0cef":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t},opened:e.openFun}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":"en-US"===e.$i18n.locale?"150px":"120px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-form-item",{attrs:{label:"网关编号",prop:"sn"}},[t("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:e.handleGwsnScroll,expression:"handleGwsnScroll"}],staticStyle:{width:"100%"},attrs:{clearable:""},on:{"visible-change":e.handleGwsnVisibleChange},model:{value:e.dataForm.sn,callback:function(t){e.$set(e.dataForm,"sn",t)},expression:"dataForm.sn"}},[[t("div",{staticStyle:{width:"100%",position:"absolute",left:"0",top:"0","z-index":"99","background-color":"#fff"}},[t("el-input",{ref:"gwsnInput",staticStyle:{width:"98%","margin-left":"1%","margin-top":"5px","margin-bottom":"5px"},attrs:{size:"small",clearable:"",placeholder:e.$t("gwsn.pleaseEnterSearchContent")},model:{value:e.gwsnSearch,callback:function(t){e.gwsnSearch=t},expression:"gwsnSearch"}})],1),t("div",{staticStyle:{width:"100%",height:"42px"}}),e._l(e.tgwList,(function(a){return t("el-option",{key:a.sn,attrs:{label:a.sn,value:a.sn,disabled:!!a.hasOwnProperty("disabled")&&a.disabled}},[t("span",{staticStyle:{width:"100%",display:"inline-block","text-align":"left",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:a.sn}},[e._v("\n                            "+e._s(a.sn)+"\n                        ")])])}))]],2)],1),t("el-form-item",{attrs:{label:"共享用户名",prop:"sharename"}},[t("el-input",{attrs:{placeholder:"请输入共享用户名",clearable:""},model:{value:e.dataForm.sharename,callback:function(t){e.$set(e.dataForm,"sharename","string"===typeof t?t.trim():t)},expression:"dataForm.sharename"}})],1),t("el-form-item",{attrs:{label:"共享用户手机号",prop:"sharemobile"}},[t("el-input",{attrs:{maxlength:11,placeholder:"请输入共享用户手机号"},nativeOn:{keyup:function(t){return e.mobileValidate.apply(null,arguments)}},model:{value:e.dataForm.sharemobile,callback:function(t){e.$set(e.dataForm,"sharemobile",t)},expression:"dataForm.sharemobile"}})],1),t("el-form-item",{attrs:{label:"权限",prop:"type"}},[t("el-radio-group",{model:{value:e.dataForm.type,callback:function(t){e.$set(e.dataForm,"type",t)},expression:"dataForm.type"}},[t("el-radio",{attrs:{label:0}},[e._v("仅查看")]),t("el-radio",{attrs:{label:1}},[e._v("可编辑")])],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},r=[],s=(a("7f7f"),a("c5f6"),a("a481"),a("b047")),i=a.n(s),o=a("61f7"),l={props:["id"],directives:{loadmore:{inserted:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-Math.ceil(this.scrollTop)<=this.clientHeight;e&&0!==this.scrollTop&&t.value()}))}}},data:function(){return{isCloseDialog:!1,visible:!1,loading:!1,gwsnPage:1,gwsnTotal:0,gwsnSearch:"",tgwList:[],queryParamas:{},oldGwsnDesc:"",dataForm:{sn:"",sharename:"",sharemobile:"",shareId:null,type:0},rules:{sn:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],sharename:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],sharemobile:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){this.visible=!0},openFun:function(){var e=this;e.isCloseDialog=!1,e.$refs["dataForm"].resetFields(),e.dataForm.id=e.id,e.gwsnPage=1,e.gwsnTotal=0,e.tgwList=[],e.getAllGwsnDataList(),e.dataForm.id?e.$http.get("/shareSn/getById.do",{params:{id:e.dataForm.id}}).then((function(t){var a=t.data;if(0!=a.code)return e.$message.error(a.data||a.msg);e.gwsnSearch=a.data.sn,e.dataForm.sn=a.data.sn,e.oldGwsnDesc=a.data.sn,e.dataForm.sharename=a.data.sname,e.dataForm.type=a.data.per})).catch((function(e){return!1})):e.getAllGwsnDataList()},mobileValidate:function(){this.dataForm.sharemobile=this.dataForm.sharemobile.replace(/[^\.\d]/g,""),this.dataForm.sharemobile=this.dataForm.sharemobile.replace(".","")},getAllGwsnDataList:function(){var e=this,t={pageNum:e.gwsnPage,pageSize:200,sn:e.gwsnSearch,_t:(new Date).getTime()};e.$http.get("/shareSn/getShareSnList.do",{params:t}).then((function(t){var a=t.data;if(a.hasOwnProperty("code")&&0!=a.code)return e.$message.error(a.data||a.msg);1==e.gwsnPage?e.tgwList=a.data.list.map((function(t){return{sn:t,gwDesc:e.$t("noMatchingDataYet")}})):e.tgwList=e.tgwList.concat(a.data.list.map((function(t){return{sn:t,gwDesc:e.$t("noMatchingDataYet")}}))),0==e.tgwList.length&&e.tgwList.push({sn:e.$t("noMatchingDataYet"),gwDesc:e.$t("noMatchingDataYet"),disabled:!0}),e.gwsnTotal=Number(a.data.total)})).catch((function(e){return!1}))},handleGwsnVisibleChange:function(e){var t=this;e&&this.$nextTick((function(){t.$refs.gwsnInput.focus()}))},handleGwsnScroll:function(){this.tgwList.length<this.gwsnTotal&&(this.gwsnPage++,this.getAllGwsnDataList())},handleClose:function(){this.isCloseDialog=!0,this.gwsnSearch="",this.visible=!1},dataFormSubmitHandle:i()((function(){var e=this,t=null;e.$refs["dataForm"].validate((function(a){return!!a&&(Object(o["b"])(e.dataForm.sharemobile)?void(e.$store.state.user.name!==e.dataForm.sharename.trim()?e.$http.get("/shareSn/getIdByUname.do",{params:{uname:e.dataForm.sharename,mobile:e.dataForm.sharemobile}}).then((function(a){var n=a.data;if(0!=n.code)e.$message.error(n.data||n.msg);else{if(!n.data)return e.$message.warning("暂无该用户，请确认后在进行操作"),!1;e.dataForm.id?(t=e.oldGwsnDesc===e.dataForm.sn?[{id:e.dataForm.id,suid:n.data,per:e.dataForm.type}]:[{id:e.dataForm.id,sn:e.dataForm.sn,suid:n.data,per:e.dataForm.type}],e.$http.put("/shareSn/update.do",t).then((function(t){var a=t.data;if(0!=a.code)return e.$message.error(a.data||a.msg);e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.isCloseDialog=!0,e.gwsnSearch="",e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(e){return!1}))):(t=[{sn:e.dataForm.sn,suid:n.data,per:e.dataForm.type}],e.$http.post("/shareSn/insert.do",t).then((function(t){var a=t.data;if(0!=a.code)return e.$message.error(a.data||a.msg);e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.isCloseDialog=!0,e.gwsnSearch="",e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(e){return!1})))}})).catch((function(e){return!1})):e.$message.warning("禁止共享给自己，请重新操作")):e.$message.error("请输入正确的手机号"))}))}),1e3,{leading:!0,trailing:!1}),watchGwsnSearch:i()((function(){var e=document.getElementsByClassName("el-scrollbar__wrap").length;document.getElementsByClassName("el-scrollbar__wrap")[e-1].scrollTo(0,0),this.gwsnPage=1,this.getAllGwsnDataList(),this.$refs.gwsnInput.focus()}),500)},watch:{gwsnSearch:function(e,t){this.isCloseDialog||this.watchGwsnSearch()}}},d=l,c=(a("5e64"),a("2877")),u=Object(c["a"])(d,n,r,!1,null,"6d99bbe4",null);t["default"]=u.exports},"4c9d":function(e,t,a){},"5e64":function(e,t,a){"use strict";a("c67b")},acd4:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"aui-card--fill",attrs:{shadow:"never"}},[t("el-form",{attrs:{inline:!0,model:e.dataForm},nativeOn:{submit:function(e){e.preventDefault()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.querySearch.apply(null,arguments)}}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{xs:24,sm:24,md:24,lg:22,xl:22}},[t("el-form-item",{attrs:{label:"网关编号"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入网关编号",clearable:""},on:{clear:e.querySearch},model:{value:e.dataForm.sn,callback:function(t){e.$set(e.dataForm,"sn",t)},expression:"dataForm.sn"}})],1),t("el-form-item",{attrs:{label:"类型"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:e.$t("select")},on:{change:e.querySearch},model:{value:e.dataForm.type,callback:function(t){e.$set(e.dataForm,"type",t)},expression:"dataForm.type"}},e._l(e.typeList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:e.$t("select")},on:{change:e.querySearch},model:{value:e.dataForm.status,callback:function(t){e.$set(e.dataForm,"status",t)},expression:"dataForm.status"}},e._l(e.statusList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),e.$hasPermission("shareSn:select:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",icon:"el-icon-search"},on:{click:e.querySearch}},[e._v("\n                        "+e._s(e.$t("query"))+"\n                    ")])],1):e._e(),e.$hasPermission("shareSn:insert:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.handleAddOrUpdateChange()}}},[e._v("\n                        "+e._s(e.$t("add"))+"\n                    ")])],1):e._e(),e.$hasPermission("shareSn:delete:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.deleteHandle()}}},[e._v(e._s(e.$t("deleteBatch"))+"\n                    ")])],1):e._e(),e.$hasPermission("shareSn:select:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"success"},on:{click:e.getDataList}},[t("i",{staticClass:"el-icon-refresh"})])],1):e._e()],1)],1)],1),t("vxe-table",{ref:"recordTable",staticStyle:{width:"100%"},attrs:{size:"medium",border:"",resizable:"","auto-resize":"","sync-resize":"","show-overflow":"","show-header-overflow":"","highlight-hover-row":"","highlight-current-row":"",data:e.dataList,"max-height":e.scrollTableHeight,loading:e.dataListLoading,"row-config":{keyField:"id"},"checkbox-config":e.checkboxConfig},on:{"checkbox-all":e.selectAll,"checkbox-change":e.dataListSelectionHandle}},[t("vxe-table-column",{key:"1",attrs:{type:"checkbox","header-align":"center",align:"center",width:"60",fixed:"left",checked:!1}}),t("vxe-table-column",{key:"2",attrs:{field:"sn",title:e.$t("gwsn.number"),"header-align":"center",align:"center",fixed:"left","show-overflow-tooltip":!0}}),t("vxe-table-column",{key:"3",attrs:{field:"status",title:"状态","header-align":"center",align:"center",width:"140"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{size:"small",type:0===a.row.status?"warning":1===a.row.status?"danger":2===a.row.status?"success":"info"}},[e._v("\n                    "+e._s(0===a.row.status?"待确认":1===a.row.status?"拒绝":2===a.row.status?"确认":"未知")+"\n                ")])]}}])}),t("vxe-table-column",{key:"4",attrs:{field:"per",title:"权限","header-align":"center",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{size:"small",type:0===a.row.per||1===a.row.per?"primary":"info"}},[e._v("\n                    "+e._s(0===a.row.per?"仅查看":1===a.row.per?"可编辑":"未知")+"\n                ")])]}}])}),t("vxe-table-column",{key:"5",attrs:{field:"sname",title:"共享用户","header-align":"center",align:"center",width:"200"}}),t("vxe-table-column",{key:"6",attrs:{field:"oname",title:"创建者","header-align":"center",align:"center",width:"200"}}),t("vxe-table-column",{key:"7",attrs:{title:e.$t("handle"),"header-align":"center",align:"center",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.ouid!=e.currentUserId&&0===a.row.status?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleRefuseOrAgreeChange(a.row.id,"refuse")}}},[e._v("\n                    "+e._s("拒绝")+"\n                ")]):e._e(),a.row.ouid!=e.currentUserId&&0===a.row.status?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleRefuseOrAgreeChange(a.row.id,"agree")}}},[e._v("\n                    "+e._s("同意")+"\n                ")]):e._e(),a.row.ouid===e.currentUserId?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleAddOrUpdateChange(a.row.id)}}},[e._v("\n                    "+e._s(e.$t("update"))+"\n                ")]):e._e(),a.row.ouid===e.currentUserId?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteHandle(a.row.id)}}},[e._v("\n                    "+e._s(e.$t("delete"))+"\n                ")]):e._e()]}}])})],1),t("el-pagination",{attrs:{"current-page":e.page,"page-sizes":[20,50,100,200],"page-size":e.limit,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.pageSizeChangeHandle,"current-change":e.pageCurrentChangeHandle}}),e.addOrUpdateVisible?t("snconfigAddOrUpdate",{ref:"addOrUpdate",attrs:{id:e.dataForm.propId},on:{refreshDataList:e.getDataList}}):e._e()],1)},r=[],s=(a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("7f7f"),a("6b54"),a("ac6a"),a("c5f6"),a("a481"),a("b047")),i=a.n(s),o=a("0cef");function l(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=d(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==a.return||a.return()}finally{if(o)throw s}}}}function d(e,t){if(e){if("string"==typeof e)return c(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}var u={data:function(){return{page:1,limit:20,total:0,currentUserId:null,dataListLoading:!1,dataList:[],dataForm:{sn:"",type:-1,status:-1,propId:null},checkboxConfig:{reserve:!0,highlight:!0,checkField:"checked"},addOrUpdateVisible:!1,scrollTableHeight:window.innerHeight-220-53,typeList:[{label:"全部",value:-1},{label:"我共享的",value:0},{label:"共享给我的",value:1}],statusList:[{label:"全部",value:-1},{label:"待确认",value:0},{label:"拒绝",value:1},{label:"确认",value:2}]}},components:{snconfigAddOrUpdate:o["default"]},methods:{pageSizeChangeHandle:function(e){this.page=1,this.limit=e,this.getDataList()},pageCurrentChangeHandle:function(e){this.page=e,this.getDataList()},querySearch:function(){var e=this;this.page=1,this.$nextTick((function(){e.getDataList()}))},getDataList:i()((function(){var e=this,t={page:e.page,limit:e.limit};e.dataForm.gwsn&&(t["sn"]=e.dataForm.sn.replace(/_/g,"\\_").replace(/%/g,"\\%").trim()),-1!=e.dataForm.type&&(t["type"]=e.dataForm.type),-1!=e.dataForm.status&&(t["status"]=e.dataForm.status),e.dataListLoading=!0,e.total=0,e.$http.get("/shareSn/getPage.do",{params:t}).then((function(a){var n=a.data;if(e.gwsns=[],e.$refs.recordTable.clearCheckboxRow(),e.$refs.recordTable.clearCheckboxReserve(),0!=n.code)return e.dataList=[],e.dataListLoading=!1,e.$message.error(n.data||n.msg);n.data.list.length>0?(e.page=t.page,e.dataList=n.data.list,e.total=Number(n.data.total),e.$refs.recordTable.loadData(e.dataList),e.dataListLoading=!1):(e.dataList=[],e.total=0,e.page=1,e.dataListLoading=!1)})).catch((function(t){return e.dataListLoading=!1,!1}))}),100,{leading:!0,trailing:!1}),getRowKey:function(e){return e.id},handleAddOrUpdateChange:function(e){var t=this;this.dataForm.propId=null,e&&(this.dataForm.propId=e),this.addOrUpdateVisible=!0,this.$nextTick((function(){t.$refs.addOrUpdate.init()}))},handleRefuseOrAgreeChange:function(e,t){var a=this,n=[{id:e,status:"agree"===t?2:1}];a.$confirm("确定要"+("agree"===t?"同意":"拒绝")+"该共享网关吗？",a.$t("deleteInfo.noticePrompt"),{confirmButtonText:a.$t("deleteInfo.confirm"),cancelButtonText:a.$t("deleteInfo.cancel"),type:"warning"}).then((function(){a.$http.put("/shareSn/update.do",n).then((function(e){var t=e.data;if(0!=t.code)return a.$message.error(t.data||t.msg);a.$message.success(a.$t("prompt.success")),a.getDataList()})).catch((function(e){return a.getDataList(),!1}))})).catch((function(e){}))},hasTargetUrl:function(e,t){var a,n=l(e);try{for(n.s();!(a=n.n()).done;){var r=a.value;if(r.url===t)return!0;if(r.children&&r.children.length&&this.hasTargetUrl(r.children,t))return!0}}catch(s){n.e(s)}finally{n.f()}return!1},realtimeViewer:function(e,t){var a=this,n={gwsn:t.sn};if(t.prjId&&(n["prjId"]=t.prjId),window.SITE_CONFIG["menuList"].length>0){var r=a.hasTargetUrl(window.SITE_CONFIG["menuList"],"runmonitor/equipment-list");r?a.$router.push({path:"runmonitor-equipment-list",name:"runmonitor-equipment-list",query:n}):a.$message.error("暂无权限，请联系上级管理员")}},selectAll:function(e){var t=this,a=[],n=this.$refs.recordTable.getCheckboxRecords(!1);this.gwsns=[],n.forEach((function(e){t.gwsns.push(e.sn),a.push(e.gwId)})),this.ids=a.join(","),this.$store.dispatch("changeIds",this.ids)},dataListSelectionHandle:function(e){var t=this,a=[],n=this.$refs.recordTable.getCheckboxRecords(!1);this.gwsns=[],n.forEach((function(e){t.gwsns.push(e.sn),a.push(e.gwId)})),this.ids=a.join(","),this.$store.dispatch("changeIds",this.ids)},deleteHandle:i()((function(e){var t=this,a={id:""};if(e)a["ids"]=e;else{if(0===t.gwsns.length)return t.$message.error(t.$t("deleteInfo.noData"));a["ids"]=t.ids.join(",")}t.$confirm(t.$t("deleteInfo.noticeTitle"),t.$t("deleteInfo.noticePrompt"),{confirmButtonText:t.$t("deleteInfo.confirm"),cancelButtonText:t.$t("deleteInfo.cancel"),type:"warning"}).then((function(){t.$http.delete("/shareSn/delete.do",{params:{ids:a["ids"]}}).then((function(e){var a=e.data;if(0!=a.code)return t.$message.error(a.data||a.msg);t.$message.success(t.$t("deleteInfo.deleteSuccess")),t.getDataList()})).catch((function(e){return t.getDataList(),!1}))})).catch((function(e){}))}),1e3,{leading:!0,trailing:!1})},mounted:function(){var e=this;this.currentUserId=this.$store.state.user.id,this.getDataList(),window.onresize=function(){return function(){e.scrollTableHeight=window.innerHeight-220-53}()}},watch:{total:function(){this.total==(this.page-1)*this.limit&&0!=this.total&&(this.page-=1,sessionStorage.setItem("page9",this.page),this.getDataList())}}},h=u,g=(a("04ef"),a("2877")),m=Object(g["a"])(h,n,r,!1,null,"3b2db1e4",null);t["default"]=m.exports},c67b:function(e,t,a){}}]);