(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0da960"],{"6bdb":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":(e.$i18n.locale,"120px")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.channel")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("deviceInfo.pleaseSelect")},model:{value:e.dataForm.chlid,callback:function(t){e.$set(e.dataForm,"chlid",t)},expression:"dataForm.chlid"}},e._l(e.chlList,(function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.chlId}},[t("span",{staticStyle:{width:"50%",display:"inline-block","text-align":"left",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:a.label}},[e._v(e._s(a.label))]),t("span",{staticStyle:{color:"#8492a6","font-size":"13px",display:"inline-block",width:"50%","text-align":"right",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:a.chlcomment}},[e._v(e._s(a.chlcomment||"无"))])])})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devname"),prop:"devname"}},[t("el-input",{ref:"devname",attrs:{placeholder:e.$t("deviceInfo.devname"),maxlength:48,clearable:""},model:{value:e.dataForm.devname,callback:function(t){e.$set(e.dataForm,"devname","string"===typeof t?t.trim():t)},expression:"dataForm.devname"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devcommaddr"),prop:"devcommaddr"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.devicecommaddr"),maxlength:32,clearable:""},model:{value:e.dataForm.devcommaddr,callback:function(t){e.$set(e.dataForm,"devcommaddr",t)},expression:"dataForm.devcommaddr"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devpublicaddr"),prop:"devpublicaddr"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.canEmpty"),maxlength:32,clearable:""},model:{value:e.dataForm.devpublicaddr,callback:function(t){e.$set(e.dataForm,"devpublicaddr",t)},expression:"dataForm.devpublicaddr"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"协议能源代码",prop:"devmanu"}},[t("el-input",{attrs:{placeholder:"请输入协议能源代码",maxlength:64,clearable:""},model:{value:e.dataForm.devmanu,callback:function(t){e.$set(e.dataForm,"devmanu",t)},expression:"dataForm.devmanu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"COM口",prop:"reserve1"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.canEmpty"),clearable:"",oninput:"value=value.replace(/^(0+)|[^\\d]+/g, '')",maxlength:2},model:{value:e.dataForm.reserve1,callback:function(t){e.$set(e.dataForm,"reserve1","string"===typeof t?t.trim():t)},expression:"dataForm.reserve1"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"设备有效性",prop:"valid"}},[t("el-radio-group",{model:{value:e.dataForm.valid,callback:function(t){e.$set(e.dataForm,"valid",t)},expression:"dataForm.valid"}},[t("el-radio",{attrs:{label:0}},[e._v("是")]),t("el-radio",{attrs:{label:2}},[e._v("否")])],1)],1)],1)],1),t("el-row",[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devcomment"),prop:"devcomment"}},[t("el-input",{attrs:{type:"textarea",maxlength:24,autosize:{minRows:2,maxRows:4},placeholder:e.$t("attribute.pleaceEnterContent")},model:{value:e.dataForm.devcomment,callback:function(t){e.$set(e.dataForm,"devcomment",t)},expression:"dataForm.devcomment"}})],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},r=[],i=(a("8e6e"),a("456d"),a("ade3")),n=(a("ac6a"),a("55dd"),a("3b2b"),a("4917"),a("a481"),a("4328")),d=a.n(n),s=a("b047"),l=a.n(s);function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var v={props:["queryParams"],data:function(){var e=this;return{showSpecialDesign:!1,storeChlId:"",visible:!1,loading:!1,tooltipTransdevicevisible:!0,chlList:[],devList:[],protocolMap:{},paramsData:[],dataForm:{id:"",chlid:"",devname:"",devcommaddr:"1",devpublicaddr:"1",devmanu:"",devmodel:"",reserve0:"",reserve1:"",devcomment:"",ptype:1,modeltype:0,gwsn:"",devid:"",valid:0},rules:{chlid:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],devname:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{validator:function(t,a,o){if(e.dataForm.id){var r=/^[a-zA-Z0-9-_#\[\.\]\\u4e00-\u9fa5]+$/,i=r.test(a);if(!i)return o(new Error(e.$t("deviceInfo.devnameNoSpecial")));o()}else if(a)if(-1!=a.indexOf("-")){var n=Math.abs(a.substring(a.lastIndexOf("-")).replace(/[^0-9]/gi,""));if(null==a.substring(0,a.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)||null==a.substring(a.lastIndexOf("-"),a.length).match(/(\d+)[^0-9]*$/))return o(new Error(e.$t("deviceInfo.devnameNoRules")));var d=a.substring(0,a.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],s=n-d+1;if(s<=0)return o(new Error(e.$t("deviceInfo.devnameNoRules")));var l=a.lastIndexOf("-"),c=a.substring(0,l),m=a.substring(l+1,a.length),v=/^[a-zA-Z0-9_#\[\.\]\u4e00-\u9fa5]+$/,u=v.test(c),h=new RegExp("^[0-9]([0-9])*$").test(m);if(!u)return o(new Error(e.$t("deviceInfo.devnameNoSpecial")));if(!h)return o(new Error(e.$t("deviceInfo.devnameNoRules")));o()}else{var f=/^[a-zA-Z0-9_#\[\.\]\\u4e00-\u9fa5]+$/,p=f.test(a);if(!p)return o(new Error(e.$t("deviceInfo.devnameNoSpecial")));o()}},trigger:"change"}],devcommaddr:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){this.getchlList()},compareBySort:function(e,t){return e.sort((function(e,a){return e[t]-a[t]}))},getchlList:function(){var e=this,t=this,a={gwsn:sessionStorage.getItem("gwsn")};if(t.$hasSessionStorageGwsn()){if(t.chlList=[],t.devList=[],!t.$hasPermission("list:getChlList:select:permission.do"))return void setTimeout((function(){t.$message.warning("暂无通道查询权限, 请联系管理员")}),500);t.$http.get("/list/getChlList.do",{params:a}).then((function(a){var o=a.data;if(0!=o.code)return t.$message.error(o.data||o.msg);if(o.data.length>0){if(o.data.forEach((function(e){if(1==e.chlType){var a={label:e.chlName,value:e.id,chlId:e.chlID,chlcomment:e.chlComment};t.chlList.push(a)}else t.devList=t.devList.concat(e.hasOwnProperty("dev2PojoList")?e.dev2PojoList:[])})),t.chlList=t.compareBySort(e.chlList,"chlId"),t.devList=t.devList.filter((function(e){return e.hasOwnProperty("modeltype")&&2==e.modeltype})),!(t.chlList.length>0))return t.$message.warning("暂无转发通道，请您先创建转发通道再执行此操作");if(t.dataForm.id){for(var r=0;r<t.chlList.length;r++)if(t.dataForm.chlid==t.chlList[r].chlId){t.dataForm.devid=t.chlList[r].chlId;break}}else if(t.queryParams.chlId){for(var i=0;i<t.chlList.length;i++)if(t.queryParams.chlId==t.chlList[i].chlId){t.dataForm.chlid=t.chlList[i].chlId;break}}else t.dataForm.chlid=t.chlList[0].chlId;t.visible=!0,t.loading=!0,t.$nextTick((function(){t.$http.post("/ProcotolTemplate/getAu.do",{}).then((function(e){var a=e.data;0!=a.code?(1==localStorage.getItem("superAdmin")?t.showSpecialDesign=!0:t.showSpecialDesign=!1,t.getProtocolList((function(){t.$nextTick((function(){t.$refs["dataForm"].resetFields(),t.showSpecialDesign||t.$refs.devname.focus(),t.dataForm.id?t.getInfo():t.dataForm.devname=t.$t("deviceInfo.defaultTransDevname")}))}))):(t.showSpecialDesign=!0,t.getProtocolList((function(){t.$nextTick((function(){t.$refs["dataForm"].resetFields(),t.dataForm.id&&t.getInfo()}))})))})).catch((function(e){1==localStorage.getItem("superAdmin")?t.showSpecialDesign=!0:t.showSpecialDesign=!1,t.getProtocolList((function(){t.$nextTick((function(){t.$refs["dataForm"].resetFields(),t.showSpecialDesign||t.$refs.devname.focus(),t.dataForm.id?t.getInfo():t.dataForm.devname=t.$t("deviceInfo.defaultTransDevname")}))}))}))}))}})).catch((function(e){return!1}))}else this.$message({showClose:!1,message:"未获取到网关编号",type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})},getProtocolList:function(e){var t=this,a={page:1,limit:2e3};t.protocolMap={},t.$hasPermission("ProcotolTemplate:select:permission.do")?t.$http.get("/ProcotolTemplate/selectPage.do",{params:a}).then((function(a){var o=a.data;0!=o.code||o.data.list.forEach((function(e){t.protocolMap[e.id]=e.proEnergyTypeCode})),e()})).catch((function(t){e()})):t.$message.warning("暂无协议模板查询权限, 请联系管理员")},handleDeviceChange:function(e){for(var t=0;t<this.devList.length;t++)e==this.devList[t].devName&&(this.dataForm.devcommaddr=this.devList[t].devCommAddr,this.dataForm.reserve0=this.protocolMap[this.devList[t].templateid]||"")},getdevModelList:function(){var e=this,t=[],a={};e.devManuList=[],e.$hasPermission("devtypeinfo:selectlistAll:permission.do")?e.$http.post("/info/devtypeinfo/listAll",d.a.stringify({})).then((function(o){var r=o.data,i=r.data;if(i.length>0){for(var n=0;n<i.length;n++){var d=i[n].devPlatform;a[d]||(t.push(i[n]),a[d]=!0)}t.forEach((function(t){var a={label:t.platformName,value:t.devPlatform};e.devManuList.push(a)})),e.dataForm.id||(e.dataForm.devmanu=-1,e.handleManu(e.dataForm.devmanu))}})).catch((function(e){return!1})):e.$message.warning("暂无设备型号查询权限, 请联系管理员")},handleManu:function(e){var t=this,a={devPlatform:e};t.devModelList=[],t.$hasPermission("devtypeinfo:selectlistAll:permission.do")?t.$http.post("/info/devtypeinfo/listAll",d.a.stringify(a)).then((function(a){var o=a.data,r=o.data;if(r.length>0){if(r.forEach((function(e){var a={label:e.devDesc,value:e.devIndex};t.devModelList.push(a)})),t.dataForm.id)if(-1==e)t.dataForm.devmodel=t.devModelList[0].value;else{for(var i=!1,n=0;n<t.devModelList.length;n++){var d=t.devModelList[n];if(t.dataForm.devmodel==d.value){i=!0,t.loading=!1;break}}i||(t.loading=!1,t.dataForm.devmodel=t.devModelList[0].value)}else t.dataForm.devmodel=t.devModelList[0].value;t.loading=!1}})).catch((function(e){return!1})):t.$message.warning("暂无设备型号查询权限, 请联系管理员")},getInfo:function(){var e=this;this.$hasPermission("deviceinfo:selectById:permission.do")?(this.loading=!0,this.$http.get("/info/deviceinfo/".concat(this.dataForm.id)).then((function(t){var a=t.data;if(0!==a.code)return e.loading=!1,e.$message.error(a.data||a.msg);e.dataForm=m(m({},e.dataForm),a.data),e.storeChlId=e.dataForm.chlid,e.loading=!1})).catch((function(t){return e.loading=!1,!1}))):this.$message.warning("暂无设备信息查询权限, 请联系管理员")},handleClose:function(){this.dataForm.id="",this.dataForm.chlid="",this.storeChlId="",this.visible=!1},dataFormSubmitHandle:l()((function(){var e=this,t="",a=null;this.$hasSessionStorageGwsn()?(this.paramsData=[],this.$refs["dataForm"].validate((function(o){if(!o)return!1;if(e.dataForm.id){if(!e.$hasPermission("deviceinfo:update:permission.do"))return void e.$message.warning("暂无转发设备修改权限, 请联系管理员");if(e.storeChlId!=e.dataForm.chlid&&!e.$hasPermission("channelinfo:updateDevicesChlId:permission.do"))return void e.$message.warning("暂无转发设备修改所属通道权限, 请联系管理员")}else if(!e.$hasPermission("deviceinfo:insert:permission.do"))return void e.$message.warning("暂无转发设备新增权限, 请联系管理员");e.loading=!0,a={devname:e.dataForm.devname,chlid:e.dataForm.chlid,devmanu:e.dataForm.devmanu,devmodel:e.dataForm.devmodel,reserve0:e.dataForm.reserve0,reserve1:e.dataForm.reserve1,devcomment:e.dataForm.devcomment,devcommaddr:e.dataForm.devcommaddr,devpublicaddr:e.dataForm.devpublicaddr,gwsn:sessionStorage.getItem("gwsn"),modeltype:e.showSpecialDesign?2:0,ptype:1,valid:e.dataForm.valid},e.dataForm.id?(t="/info/deviceinfo",a["id"]=e.dataForm.id,a["devid"]=e.dataForm.devid):t="/info/deviceinfo/insert.do",e.$http[e.dataForm.id?"put":"post"](t,a).then((function(t){var a=t.data;if(0!=a.code)return e.loading=!1,e.$message.error(a.data||a.msg);e.dataForm.id?e.storeChlId==e.dataForm.chlid?e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataForm.id="",e.dataForm.chlid="",e.storeChlId="",e.loading=!1,e.visible=!1,e.$emit("refreshDataList")}}):e.$http.get("/info/channelinfo/updateDevicesChlId.do",{params:{sn:sessionStorage.getItem("gwsn"),deviceIds:e.dataForm.devid,chlId:e.dataForm.chlid,type:1}}).then((function(t){var a=t.data;if(0!=a.code)return e.loading=!1,e.$message.error(a.data||a.msg);e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataForm.id="",e.dataForm.chlid="",e.storeChlId="",e.loading=!1,e.visible=!1,e.$emit("refreshDataList")}})})):e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataForm.id="",e.dataForm.chlid="",e.storeChlId="",e.loading=!1,e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(t){return e.dataForm.id="",e.dataForm.chlid="",e.storeChlId="",e.loading=!1,e.visible=!1,e.$emit("refreshDataList")}))}))):this.$message({showClose:!1,message:"未获取到网关编号",type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})}),1e3,{leading:!0,trailing:!1})}},u=v,h=a("2877"),f=Object(h["a"])(u,o,r,!1,null,null,null);t["default"]=f.exports}}]);