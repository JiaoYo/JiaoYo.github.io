(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d213e5c"],{af45:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t},opened:e.handleDialogOpenChange}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":"140px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"fileName",label:e.$t("template.filename")}},[t("el-input",{attrs:{placeholder:e.$t("template.filename"),maxlength:255,clearable:""},model:{value:e.dataForm.fileName,callback:function(t){e.$set(e.dataForm,"fileName",t)},expression:"dataForm.fileName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"fileVersion",label:e.$t("upgrade.fileVersion")}},[t("el-input",{attrs:{placeholder:e.$t("upgrade.pleaseEnterTheFileVersion"),clearable:""},model:{value:e.dataForm.fileVersion,callback:function(t){e.$set(e.dataForm,"fileVersion",t)},expression:"dataForm.fileVersion"}},[t("template",{slot:"prepend"},[e._v("V")])],2)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"protocol",label:e.$t("channelInfo.chlprotocol")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",placeholder:e.$t("template.pleaseSelect")},model:{value:e.dataForm.protocol,callback:function(t){e.$set(e.dataForm,"protocol",t)},expression:"dataForm.protocol"}},e._l(e.protocolList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"fileDesc",label:e.$t("upgrade.filedesc")}},[t("el-input",{attrs:{placeholder:e.$t("upgrade.pleaseEnterAVersionDescription"),maxlength:255,clearable:""},model:{value:e.dataForm.fileDesc,callback:function(t){e.$set(e.dataForm,"fileDesc",t)},expression:"dataForm.fileDesc"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"available",label:e.$t("template.available")}},[t("el-radio-group",{model:{value:e.dataForm.available,callback:function(t){e.$set(e.dataForm,"available",t)},expression:"dataForm.available"}},e._l(e.availableList,(function(a){return t("el-radio",{key:a.label,attrs:{label:a.value}},[e._v("\n                            "+e._s(a.label)+"\n                        ")])})),1)],1)],1)],1),e.dataForm.id?e._e():t("el-row",[t("el-form-item",[t("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"","on-change":e.handleChange,"http-request":e.uploadSectionFile,"on-remove":e.handleRemove,"file-list":e.fileList,"before-upload":e.beforeUpload,multiple:""}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text",domProps:{innerHTML:e._s(e.$t("upload.text"))}})])],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},l=[],r=(a("8e6e"),a("456d"),a("7f7f"),a("ade3")),o=(a("ac6a"),a("96cf"),a("1da1")),n=a("b047"),s=a.n(n);function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){Object(r["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p={data:function(){return{num:0,url:"",visible:!1,loading:!1,deptListVisible:!1,modelList:[],fileList:[],protocolList:[],file:{fileName:"",fileUrl:""},dataForm:{id:"",fileName:"",fileVersion:"",protocol:"",available:1,fileDesc:"",deptid:""},fileTypeList:[{label:this.$t("template.collectTemplate"),value:0},{label:this.$t("template.transTemplate"),value:1}],availableList:[{label:this.$t("template.yes"),value:1},{label:this.$t("template.no"),value:0}],rules:{fileName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],fileVersion:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],protocol:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){this.visible=!0},handleDialogOpenChange:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$refs["dataForm"].resetFields(),e.next=1,this.getProtocol();case 1:if(this.dataForm.deptid=this.$store.state.user.deptId,this.fileList=[],!this.dataForm.id){e.next=2;break}return e.next=2,this.getInfo();case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getProtocol:function(){var e=this,t={attribute:2};e.protocolList=[],e.$hasPermission("protocolinfo:select:permission.do")?e.$http.get("/info/protocolinfo/proGuidAll",{params:t}).then((function(t){var a=t.data;if(0!=a.code)return e.$message.error(a.data||a.msg);a.data.length>0&&a.data.forEach((function(t){var a={label:t.manuf,value:t.libname};e.protocolList.push(a)}))})).catch((function(e){return!1})):e.$message.warning("暂无协议查询权限, 请联系管理员")},getInfo:function(){var e=this;this.$hasPermission("devvermanage:select:permission.do")?(this.loading=!0,this.$http.get("/info/devvermanage/".concat(this.dataForm.id)).then((function(t){var a=t.data;e.dataForm=c(c({},e.dataForm),a.data),e.loading=!1})).catch((function(t){return e.loading=!1,!1}))):this.$message.warning("暂无子设备版本信息查询权限, 请联系管理员")},beforeUpload:function(e){if("application/octet-stream"!=e.type&&-1==e.name.indexOf(".bin"))return this.$message.error(this.$t("upload.tip",{format:"bin"})),!1},handleChange:function(e,t){},handleRemove:function(e,t){this.fileList=[]},uploadSectionFile:function(e,t){this.loading=!0,this.fileList.push(e.file);var a=new FormData;a.append("file",e.file),a.append("name",e.file.name),this.importfile(a)},importfile:function(e){var t=this;this.$http.post("/upload/upload",e).then((function(e){var a=e.data;0==a.code?(t.file.fileUrl=a.data,t.$message.success(t.$t("template.uploadSuccess")),t.loading=!1):(t.$message.error(a.data||t.$t("template.uploadError")),t.loading=!1,t.handleRemove())})).catch((function(e){return!1}))},handleClose:s()((function(){this.file.fileUrl="",this.fileList=[],this.visible=!1}),1e3,{leading:!0,trailing:!1}),dataFormSubmitHandle:s()((function(){var e=this,t={};this.$refs["dataForm"].validate((function(a){if(!a)return!1;if(e.dataForm.id){if(!e.$hasPermission("devvermanage:update:permission.do"))return void e.$message.warning("暂无协议修改权限, 请联系管理员");t=e.dataForm}else{if(!e.file.fileUrl||0===e.fileList.length)return e.$message.info(e.$t("template.pleaseUploadFile"));if(!e.$hasPermission("devvermanage:insert:permission.do"))return void e.$message.warning("暂无协议新增权限, 请联系管理员");t={fileName:e.dataForm.fileName,fileVersion:e.dataForm.fileVersion,available:e.dataForm.available,fileDesc:e.dataForm.fileDesc,protocol:e.dataForm.protocol,creator:e.$store.state.user.id,fileUrl:e.file.fileUrl,deptid:e.dataForm.deptid}}e.$http[e.dataForm.id?"put":"post"]("/info/devvermanage",t).then((function(t){var a=t.data;if(0!=a.code)return e.$message.error(a.data||a.msg);e.$message.success(a.msg),e.visible=!1,e.$emit("refreshDataList")})).catch((function(t){return e.visible=!1,e.$emit("refreshDataList"),!1}))}))}),1e3,{leading:!0,trailing:!1})}},m=p,f=a("2877"),u=Object(f["a"])(m,i,l,!1,null,null,null);t["default"]=u.exports}}]);