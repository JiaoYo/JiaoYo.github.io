(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-41967c54"],{"86f4":function(e,t,a){},d78c:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("section",[t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.visible=t},close:e.handleClose}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-position":"left","label-width":"140px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"devPlatform",label:e.$t("gwsn.number")}},[t("el-input",{attrs:{readonly:"",placeholder:e.$t("gwsn.enterGwsn")},model:{value:e.dataForm.sns,callback:function(t){e.$set(e.dataForm,"sns",t)},expression:"dataForm.sns"}},[t("template",{slot:"append"},[t("el-button",{attrs:{type:"text"},on:{click:e.handleGetAllGwsnChange}},[e._v(e._s(e.$t("select")))])],1)],2)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"way",label:e.$t("authorization.upgradeWay")}},[t("el-radio-group",{model:{value:e.dataForm.way,callback:function(t){e.$set(e.dataForm,"way",t)},expression:"dataForm.way"}},[t("el-radio",{attrs:{label:0}},[e._v(e._s(e.$t("authorization.overrideAuthorization")))]),t("el-radio",{attrs:{label:1}},[e._v(e._s(e.$t("authorization.combinedAuthorization")))])],1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",[t("template",{slot:"label"},[t("h3",{staticStyle:{margin:"0"}},[e._v(e._s(e.$t("authorization.basicAuthorization")))])])],2)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"softwareName"}},[t("template",{slot:"label"},[t("el-checkbox",{model:{value:e.dataForm.softwareChecked,callback:function(t){e.$set(e.dataForm,"softwareChecked",t)},expression:"dataForm.softwareChecked"}},[e._v(e._s(e.$t("authorization.softwareName")))])],1),t("el-input",{attrs:{placeholder:e.$t("authorization.pleaseEnterSoftwareName"),clearable:""},model:{value:e.dataForm.softwareName,callback:function(t){e.$set(e.dataForm,"softwareName",t)},expression:"dataForm.softwareName"}})],2)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"expireTime"}},[t("template",{slot:"label"},[t("el-checkbox",{model:{value:e.dataForm.expireTimeChecked,callback:function(t){e.$set(e.dataForm,"expireTimeChecked",t)},expression:"dataForm.expireTimeChecked"}},[e._v(e._s(e.$t("authorization.expirationDate")))])],1),t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:e.$t("authorization.pleaseSelectExpirationDate"),align:"right",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions},model:{value:e.dataForm.expireTime,callback:function(t){e.$set(e.dataForm,"expireTime",t)},expression:"dataForm.expireTime"}})],2)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"tagCount"}},[t("template",{slot:"label"},[t("el-checkbox",{model:{value:e.dataForm.tagCountChecked,callback:function(t){e.$set(e.dataForm,"tagCountChecked",t)},expression:"dataForm.tagCountChecked"}},[e._v(e._s(e.$t("authorization.tagNum")))])],1),t("el-input",{attrs:{placeholder:e.$t("authorization.pleaseEnterTagNum"),clearable:""},model:{value:e.dataForm.tagCount,callback:function(t){e.$set(e.dataForm,"tagCount",t)},expression:"dataForm.tagCount"}})],2)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",[t("template",{slot:"label"},[t("h3",{staticStyle:{margin:"0"}},[e._v(e._s(e.$t("authorization.extendedLicense")))])])],2)],1),e._l(e.protocolInfoList,(function(a,o){return t("el-col",{key:o,attrs:{span:24}},[t("el-form-item",[t("template",{slot:"label"},[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminateObj[o]},on:{change:function(t){return e.handleCheckAllChange(t,o)}},model:{value:e.checkAllObj[o],callback:function(t){e.$set(e.checkAllObj,o,t)},expression:"checkAllObj[index]"}},[t("div",{attrs:{title:a.label}},[e._v("\n                                    "+e._s(a.label)+"\n                                    ")])])],1),t("el-checkbox-group",{on:{change:function(t){return e.handleCheckedProtocolChange(t,o)}},model:{value:e.checkedObj[o],callback:function(t){e.$set(e.checkedObj,o,t)},expression:"checkedObj[index]"}},e._l(a.children,(function(a){return t("el-checkbox",{key:a.value,attrs:{label:a.value}},[t("div",{attrs:{title:a.label}},[e._v("\n                                    "+e._s(a.label)+"\n                                    ")])])})),1)],2)],1)}))],2)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("authorization.generateAuthorizationTasks")))])],1)],2),t("el-dialog",{attrs:{visible:e.gwsnVisible,title:e.$t("authorization.selectGateway"),"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.gwsnVisible=t}}},[t("el-form",{attrs:{inline:!0,model:e.dataForm},nativeOn:{submit:function(e){e.preventDefault()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.querySearch.apply(null,arguments)}}},[t("el-row",[t("el-col",{attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[t("el-form-item",{attrs:{label:e.$t("gwsn.belongProject")}},[t("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:e.handlePrjScroll,expression:"handlePrjScroll"}],attrs:{clearable:"",size:"small",placeholder:e.$t("select")},on:{"visible-change":e.handlePrjVisibleChange,change:e.querySearch,clear:e.handlePrjClearChange},model:{value:e.gwsnForm.prjName,callback:function(t){e.$set(e.gwsnForm,"prjName",t)},expression:"gwsnForm.prjName"}},[[t("div",{staticStyle:{width:"100%",position:"absolute",left:"0",top:"0","z-index":"99","background-color":"#fff"}},[t("el-input",{ref:"prjInput",staticStyle:{width:"98%","margin-left":"1%","margin-top":"5px","margin-bottom":"5px"},attrs:{size:"small",clearable:"",placeholder:e.$t("gwsn.pleaseEnterSearchContent")},model:{value:e.prjSearch,callback:function(t){e.prjSearch=t},expression:"prjSearch"}})],1),t("div",{staticStyle:{width:"100%",height:"42px"}}),e._l(e.prjList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.prjName,value:e.id,disabled:!!e.hasOwnProperty("disabled")&&e.disabled}})}))]],2)],1),t("el-form-item",[t("el-input",{attrs:{size:"small",placeholder:e.$t("gwsn.enter"),clearable:""},on:{clear:e.querySearch},model:{value:e.gwsnForm.gwsn,callback:function(t){e.$set(e.gwsnForm,"gwsn",t)},expression:"gwsnForm.gwsn"}})],1),e.$hasPermission("info:gwbaseinfo:list")?t("el-form-item",[t("el-button",{attrs:{size:"small",icon:"el-icon-search"},on:{click:e.querySearch}},[e._v(e._s(e.$t("query"))+" ")])],1):e._e(),e.$hasPermission("info:gwbaseinfo:list")?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"success"},on:{click:e.getDataList}},[t("i",{staticClass:"el-icon-refresh"})])],1):e._e(),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleConfirmGwsnChange}},[e._v(e._s(e.$t("confirm")))])],1)],1)],1)],1),t("vxe-table",{ref:"recordTable",staticStyle:{width:"100%"},attrs:{size:"medium",border:"",resizable:"","auto-resize":"","sync-resize":"","show-overflow":"","show-header-overflow":"","highlight-hover-row":"","highlight-current-row":"",data:e.dataList,"max-height":460,loading:e.dataListLoading,"row-config":{keyField:"id"},"radio-config":{highlight:!0},"empty-text":e.$t("noData")},on:{"radio-change":e.radioChangeEvent}},[t("vxe-column",{key:"1",attrs:{type:"radio",width:"60","header-align":"center",align:"center",fixed:"left"},scopedSlots:e._u([{key:"header",fn:function(){return[t("vxe-button",{attrs:{type:"text",disabled:!e.selectRow},on:{click:e.clearRadioRowEevnt}},[e._v(e._s(e.$t("cancel")))])]},proxy:!0}])}),t("vxe-table-column",{key:"2",attrs:{field:"sn",title:e.$t("gwsn.number"),"header-align":"center",align:"center","min-width":"170",fixed:"left","show-overflow-tooltip":!0}}),t("vxe-table-column",{key:"6",attrs:{field:"gwDesc",title:e.$t("gwsn.gwsnNote"),"header-align":"center",align:"center","min-width":"220","show-overflow-tooltip":!0,"edit-render":{}}}),t("vxe-table-column",{key:"8",attrs:{field:"prjName",title:e.$t("gwsn.belongProject"),"header-align":"center",align:"center","min-width":"160","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.prjName||e.$t("no")))])]}}])})],1),t("vxe-pager",{attrs:{perfect:"",size:"mini","current-page":e.page,"page-size":e.limit,"page-sizes":[20,50,100,200],total:e.total,layouts:["PrevPage","JumpNumber","NextPage","FullJump","Sizes","Total"]},on:{"page-change":e.handlePageChange}})],1)],1)},r=[],i=a("2909"),n=(a("456d"),a("7f7f"),a("c5f6"),a("a481"),a("28a5"),a("ac6a"),a("4328")),s=a.n(n),l=a("bc3a"),c=a.n(l),d=a("b047"),h=a.n(d),p={directives:{loadmore:{inserted:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-Math.ceil(this.scrollTop)<=this.clientHeight;e&&0!==this.scrollTop&&t.value()}))}}},props:["propId"],data:function(){return{visible:!1,loading:!1,checked:!0,checkAllObj:{},isIndeterminateObj:{},checkedObj:{},dataForm:{id:"",sns:"",way:0,softwareChecked:!0,softwareName:"PBOX",expireTimeChecked:!0,expireTime:"2099-12-31 23:59:59",tagCountChecked:!0,tagCount:"81920"},rules:{sns:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],way:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],softwareName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],expireTime:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],tagCount:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]},protocolInfoMap:{},protocolInfoList:[],pickerOptions:{shortcuts:[{text:this.$t("product.today"),onClick:function(e){e.$emit("pick",new Date)}},{text:this.$t("product.yesterday"),onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$t("product.yesterday"),onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},prjInfo:{page:1,total:0},gwsnVisible:!1,page:1,limit:100,total:0,prjName:"",dataListLoading:!1,dataList:[],prjSearch:"",prjList:[],gwsnForm:{gwsn:"",prjName:"",searchType:"1"},selectRow:null,checkboxConfig:{reserve:!0,highlight:!0},isClosedPage:!1,multipleSelectionAll:[]}},methods:{init:function(){this.getDefaultProtocolInfoList()},getDefaultProtocolInfoList:function(){var e=this,t=(new Date).getTime();c.a.get(window.location.origin+"/licenseupgrade.json?_t="+t).then((function(t){var a=t.data;if(e.protocolInfoList=a,e.checkAllObj={},e.isIndeterminateObj={},e.checkedObj={},e.protocolInfoList.forEach((function(t,a){e.$set(e.checkAllObj,a,!1),e.$set(e.isIndeterminateObj,a,!1),e.$set(e.checkedObj,a,[])})),!(e.protocolInfoList.length>0))return e.$message.error(e.$t("authorization.correspondingExtendedAuthorization"));e.visible=!0,e.$nextTick((function(){e.isClosedPage=!1,e.$refs["dataForm"].resetFields(),e.dataForm={id:"",sns:"",way:0,softwareChecked:!0,softwareName:"PBOX",expireTimeChecked:!0,expireTime:"2099-12-31 23:59:59",tagCountChecked:!0,tagCount:"81920"},e.dataForm.id=e.propId,e.dataForm.id&&e.getInfo()}))}))},handleCheckAllChange:function(e,t){this.checkedObj[t]=e?this.protocolInfoMap[t]:[],this.isIndeterminateObj[t]=!1},handleCheckedProtocolChange:function(e,t){var a=e.length;this.checkAllObj[t]=a===this.protocolInfoMap[t].length,this.isIndeterminateObj[t]=a>0&&a<this.protocolInfoMap[t].length},handleGetAllGwsnChange:function(){var e=this;this.gwsnVisible=!0,this.$nextTick((function(){0==e.prjList.length&&(e.prjInfo.page=1,e.getPrjNameList()),0==e.dataList.length&&(e.page=1,e.gwsnForm.gwsn=e.dataForm.sns,e.getDataList()),e.multipleSelectionAll=e.dataForm.sns.split(",")}))},getPrjNameList:function(){var e=this,t={page:e.prjInfo.page,limit:50,priName:e.prjSearch.replace(/\s+/g,""),_t:(new Date).getTime()};e.$http.get("/info/tprjinfo/tprjinfoList",{params:t}).then((function(t){var a=t.data;if(a.hasOwnProperty("code"))return e.$message.error(a.msg);1==e.prjInfo.page?e.prjList=a.list:e.prjList=e.prjList.concat(a.list),e.prjInfo.total=Number(a.total),0==e.prjList.length?e.prjList.push({id:e.$t("noMatchingDataYet"),prjName:e.$t("noMatchingDataYet"),disabled:!0}):JSON.stringify(e.$route.query)})).catch((function(e){return!1}))},handlePrjClearChange:function(){this.gwsnForm.prjName="",this.querySearch()},handlePrjVisibleChange:function(e){var t=this;e&&this.$nextTick((function(){t.$refs.prjInput.focus()}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.page=t,this.limit=a,this.getDataList()},querySearch:function(){var e=this;this.page=1,this.$nextTick((function(){e.getDataList()}))},getDataList:h()((function(){var e=this,t={pageNum:e.page,pageSize:e.limit,prjId:e.gwsnForm.prjName};e.gwsnForm.gwsn&&(t["fuzzy"]=e.gwsnForm.gwsn.replace(/_/g,"\\_").replace(/%/g,"\\%")),e.dataListLoading=!0,e.total=0,e.$http.post("/info/gwbaseinfo/selectByPage.do",s.a.stringify(t)).then((function(a){var o=a.data;if(0!=o.code)return e.dataList=[],e.dataListLoading=!1,e.$message.error(o.data||o.msg);e.page=t.pageNum,e.dataList=o.data.list||[],e.$refs.recordTable&&(e.$refs.recordTable.clearRadioRow(),e.$refs.recordTable.loadData(e.dataList).then((function(){e.dataListLoading=!1,e.total=Number(o.data.total)||0})).finally((function(){if(e.dataForm.sns)for(var t=0;t<e.dataList.length;t++)if(e.dataForm.sns==e.dataList[t].sn){!0,e.$refs.recordTable.setRadioRow(e.dataList[t],!0);break}})))})).catch((function(t){return e.dataListLoading=!1,!1}))}),100,{leading:!0,trailing:!1}),radioChangeEvent:function(e){var t=e.row;this.selectRow=t},clearRadioRowEevnt:function(){this.selectRow=null,this.$refs.recordTable.clearRadioRow()},handleConfirmGwsnChange:function(){if(!this.selectRow)return this.$message.error(this.$t("authorization.pleaseSelectGatewayAuthorizedUpgrade"));this.dataForm.sns=this.selectRow.sn,this.gwsnVisible=!1},selectAll:function(e){var t=this,a=this.$refs.recordTable.getCheckboxReserveRecords().concat(this.$refs.recordTable.getCheckboxRecords());this.multipleSelectionAll=[],a.length>0&&e.records.forEach((function(e){t.multipleSelectionAll.push(e.sn)}))},dataListSelectionHandle:function(e){var t=this,a=this.$refs.recordTable.getCheckboxReserveRecords().concat(this.$refs.recordTable.getCheckboxRecords());this.multipleSelectionAll=[],a.length>0&&e.records.forEach((function(e){t.multipleSelectionAll.push(e.sn)}))},handlePrjScroll:function(){this.prjList.length<this.prjInfo.total&&(this.prjInfo.page++,this.getPrjNameList())},watchPrjSearch:h()((function(){var e=document.getElementsByClassName("el-scrollbar__wrap").length;document.getElementsByClassName("el-scrollbar__wrap")[e-1].scrollTo(0,0),this.prjInfo.page=1,this.getPrjNameList(),this.$refs.prjInput.focus()}),500),getprotocolinfoList:function(){var e=this;e.protocolInfoMap={},e.$http.get("/info/groupinfo/getNode").then((function(t){var a=t.data,o=a.data;o.length>0&&(o.forEach((function(t){if(-1!==t.upgroupid||-1!==t.groupname.indexOf("*")){var a={label:t.groupname,value:String(t.groupid),children:[]};e.protocolInfoMap[String(t.groupid)]=a}})),e.getThirdData())})).catch((function(e){return!1}))},getThirdData:function(){var e=this;e.$http.get("/info/protocolinfo/proGuidAll",{params:{}}).then((function(t){var a=t.data;a.data.forEach((function(t){if(e.protocolInfoMap.hasOwnProperty(t.groupid)){var a={label:t.name,value:String(t.id)};e.protocolInfoMap[String(t.groupid)].children.push(a)}})),e.getFinallyData()})).catch((function(e){return!1}))},getFinallyData:function(){var e=this;for(var t in this.protocolInfoMap)0==this.protocolInfoMap[t].children.length&&delete this.protocolInfoMap[t];this.checkAllObj={},this.isIndeterminateObj={},this.checkedObj={},Object.keys(this.protocolInfoMap).forEach((function(t,a){e.$set(e.checkAllObj,a,!1),e.$set(e.isIndeterminateObj,a,!1),e.$set(e.checkedObj,a,[])})),Object.keys(this.protocolInfoMap).length>0&&(this.visible=!0,this.$nextTick((function(){e.$refs["dataForm"].resetFields(),e.dataForm.sns=e.sns})))},getInfo:function(){var e=this,t=[];e.loading=!0,e.$http.get("/authorizes/task/".concat(e.propId),{params:{id:e.propId}}).then((function(a){var o=a.data;if(0!=o.code)return e.loading=!1,e.$message.error(o.msg);if(e.selectRow={sn:o.data.sn},e.dataForm={id:o.data.id,sns:o.data.sn,way:o.data.updateType,softwareChecked:!0,softwareName:o.data.softName,expireTimeChecked:!0,expireTime:o.data.ovDate,tagCountChecked:!0,tagCount:o.data.tagNum},o.data.protocols)for(var r in t=o.data.protocols.split(",").map(Number),t.forEach((function(t){for(var a in e.protocolInfoMap)-1!=e.protocolInfoMap[a].indexOf(t)&&e.checkedObj[a].push(t)})),e.protocolInfoMap){var i=e.checkedObj[r].length;e.checkAllObj[r]=i===e.protocolInfoMap[r].length,e.isIndeterminateObj[r]=i>0&&i<e.protocolInfoMap[r].length}e.loading=!1})).catch((function(t){return e.loading=!1,!1}))},handleClose:h()((function(){this.isClosedPage=!1,this.prjSearch="",this.prjInfo.page=1,this.prjList=[],this.dataList=[],this.multipleSelectionAll=[],this.visible=!1}),1e3,{leading:!0,trailing:!1}),dataFormSubmitHandle:h()((function(){var e=this,t="/authorizes/task/wg_authorize",a=[],o={protocolIdList:[],updateType:e.dataForm.way};e.$refs["dataForm"].validate((function(r){if(!r)return!1;if(e.dataForm.id?(t="/authorizes/task",o={id:e.dataForm.id,sn:e.dataForm.sns,protocols:"",updateType:e.dataForm.way}):o={protocolIdList:[],updateType:e.dataForm.way,snList:e.dataForm.sns.split(",")},!e.dataForm.softwareChecked)return e.$message.error(e.$t("authorization.pleaseCheckSoftwareName"));if(!e.dataForm.softwareName)return e.$message.error(e.$t("authorization.authorizedSoftwareNameEmpty"));if(e.dataForm.id?o["softName"]=e.dataForm.softwareName:o["name"]=e.dataForm.softwareName,!e.dataForm.expireTimeChecked)return e.$message.error(e.$t("authorization.pleaseCheckExpirationDate"));if(!e.dataForm.expireTime)return e.$message.error(e.$t("authorization.authorizedExpirationDateEmpty"));if(o["ovDate"]=e.dataForm.expireTime,!e.dataForm.tagCountChecked)return e.$message.error(e.$t("authorization.pleaseCheckTagNum"));if(!e.dataForm.tagCount)return e.$message.error(e.$t("authorization.authorizedTagNumEmpty"));for(var n in e.dataForm.id?o["tagNum"]=e.dataForm.tagCount:o["tnum"]=e.dataForm.tagCount,e.checkedObj)e.checkedObj[n]&&(a=[].concat(Object(i["a"])(a),Object(i["a"])(e.checkedObj[n])));if(0==a.length)return e.$message.error(e.$t("authorization.pleaseSelectExtandedAuthorizationinformation"));e.dataForm.id?o["protocols"]=a.join(","):o["protocolIdList"]=a,e.loading=!0,e.$http[e.dataForm.id?"put":"post"](t,o).then((function(t){var a=t.data;if(0!=a.code)return e.loading=!1,e.$message.error(a.msg);e.loading=!1,e.$message.success(a.msg),e.isClosedPage=!1,e.prjSearch="",e.prjInfo.page=1,e.prjList=[],e.dataList=[],e.multipleSelectionAll=[],e.visible=!1,e.$emit("refreshDataList")})).catch((function(e){return!1}))}))}),1e3,{leading:!0,trailing:!1})},watch:{prjSearch:function(e,t){this.isClosedPage||this.watchPrjSearch()}}},u=p,m=(a("e8c3"),a("2877")),g=Object(m["a"])(u,o,r,!1,null,"178e7d5a",null);t["default"]=g.exports},e8c3:function(e,t,a){"use strict";a("86f4")}}]);