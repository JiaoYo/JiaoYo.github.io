(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7bbfbb81"],{"851c":function(e,t,a){"use strict";a.r(t);a("6762"),a("2fdb");var r=function(){var e=this,t=e._self._c;return t("section",[t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose,width:"65%"},on:{"update:visible":function(t){e.visible=t},opened:e.handleDialogOpenChange}},[t("el-steps",{attrs:{active:e.activeIndex,"finish-status":"success"}},[t("el-step",{attrs:{title:"步骤一"}}),t("el-step",{attrs:{title:"步骤二"}}),t("el-step",{attrs:{title:"步骤三"}})],1),t("div",{staticStyle:{"margin-top":"20px"}}),t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":"en-US"===e.$i18n.locale?"220px":"140px"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-row",[0==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"网关设备编号",prop:"sn"}},[t("el-input",{attrs:{clearable:"",type:"textarea",placeholder:"请输入网关设备编号",disabled:!!e.dataForm.id,autosize:{minRows:4,maxRows:8}},on:{input:e.handleSnInput},nativeOn:{keyup:function(t){return e.handleKeydown.apply(null,arguments)}},model:{value:e.dataForm.sn,callback:function(t){e.$set(e.dataForm,"sn",t)},expression:"dataForm.sn"}})],1)],1):e._e(),0==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"最近售后记录"}},[t("vxe-table",{staticStyle:{width:"100%"},attrs:{size:"medium",border:"",resizable:"","auto-resize":"","sync-resize":"","show-overflow":"","show-header-overflow":"","highlight-hover-row":"","highlight-current-row":"",data:e.recentAftersalesList,"max-height":"500px","row-config":{keyField:"id"},"row-style":{height:"60px"}}},[t("vxe-table-column",{key:"1",attrs:{field:"dbtime",title:"创建时间","header-align":"center",width:"140",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[e._v(e._s("日期: "+a.row.dbtime.substring(0,10)))]),t("div",[e._v(e._s("时间: "+a.row.dbtime.substr(11)))])]}}],null,!1,3289474929)}),t("vxe-table-column",{key:"2",attrs:{field:"comp",title:"客户信息","header-align":"center",width:"240",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{attrs:{title:"公司名称: "+a.row.comp},domProps:{innerHTML:e._s("公司名称: "+a.row.comp)}})]}}],null,!1,4035060233)}),t("vxe-table-column",{key:"3",attrs:{field:"sn",title:"网关信息","header-align":"center",width:"220"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{domProps:{innerHTML:e._s("网关编号: "+(a.row.sn?a.row.rsn?a.row.rsn==a.row.sn||a.row.rsn.includes("无")?a.row.sn:a.row.sn+'(<span style="color: red; font-weight: bold;">更换</span>)':a.row.sn:"--")+"<br />网关型号: "+(a.row.model||"--")+"<br />")}})]}}],null,!1,3918787713)}),t("vxe-table-column",{key:"4",attrs:{field:"project",title:"项目名称","header-align":"center",align:"center",width:"180"}}),t("vxe-table-column",{key:"5",attrs:{field:"fault",title:"故障现象","header-align":"center",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.fault))])]}}],null,!1,2668916396)}),t("vxe-table-column",{key:"6",attrs:{field:"duration",title:"处理时长","header-align":"center",align:"center",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                    "+e._s(t.row.duration)+"\n                                ")]}}],null,!1,1102685379)}),t("vxe-table-column",{key:"11",attrs:{field:"status",title:"当前状态","header-align":"center",align:"center",width:"120",fixed:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",[t("span",[e._v("当前状态")]),t("div",{staticStyle:{color:"#f00","font-size":"12px","font-weight":"lighter"}},[e._v("(悬浮查看详情)")])])]},proxy:!0},{key:"default",fn:function(a){return[t("el-popover",{attrs:{placement:"top",width:"450",trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[t("span",{staticClass:"status-text",staticStyle:{cursor:"pointer"},on:{click:function(e){return e.stopPropagation()}}},[e._v("\n                                                "+e._s(e.getStatusText(a.row.status))+"\n                                            ")])]},proxy:!0}],null,!0)},[t("div",{staticClass:"popover-content"},[t("p",[t("strong",[e._v("当前状态：")]),e._v(e._s(e.getStatusText(a.row.status)))]),t("el-timeline",[t("el-timeline-item",{class:{"status-positive":a.row.status>0,"status-negative":a.row.status<=0},attrs:{color:a.row.status-0>=0?"#0bbd87":"",timestamp:a.row.dbtime}},[e._v("\n                                                    信息待完善\n                                                ")]),t("el-timeline-item",{class:{"status-positive":a.row.status>1,"status-negative":a.row.status<=1},attrs:{color:a.row.status-1>=0?"#0bbd87":"",timestamp:a.row.redbtime}},[e._v("\n                                                    待收件后处理 "),a.row.receipt?t("span",[e._v("(快递单号: "),a.row.receipt?t("a",{staticStyle:{"margin-left":"5px"},attrs:{href:"https://www.kuaidi100.com?nu="+encodeURIComponent(a.row.receipt),target:"_blank"}},[e._v(e._s(a.row.receipt))]):e._e(),e._v(")")]):e._e()]),t("el-timeline-item",{class:{"status-positive":a.row.status>2,"status-negative":a.row.status<=2},attrs:{color:a.row.status-2>=0?"#0bbd87":""}},[e._v("\n                                                    分析中\n                                                ")]),t("el-timeline-item",{class:{"status-positive":a.row.status>3,"status-negative":a.row.status<=3},attrs:{color:a.row.status-3>=0?"#0bbd87":""}},[e._v("\n                                                    处理中\n                                                ")]),t("el-timeline-item",{class:{"status-positive":a.row.status>4,"status-negative":a.row.status<=4},attrs:{color:a.row.status-4>=0?"#0bbd87":""}},[e._v("\n                                                    待寄回\n                                                ")]),t("el-timeline-item",{class:{"status-positive":a.row.status>5,"status-negative":a.row.status<=5},attrs:{color:a.row.status-5>=0?"#0bbd87":"",timestamp:a.row.rdbtime}},[e._v("\n                                                    待收件 "),a.row.returnnum?t("span",[e._v("(快递单号: "),t("a",{staticStyle:{"margin-left":"5px"},attrs:{href:"https://www.kuaidi100.com?nu="+encodeURIComponent(a.row.returnnum),target:"_blank"}},[e._v(e._s(a.row.returnnum))]),e._v(")")]):e._e()]),t("el-timeline-item",{class:{"status-positive":a.row.status>=6,"status-negative":a.row.status<6},attrs:{color:a.row.status-6>=0?"#0bbd87":""}},[e._v("\n                                                    已签收\n                                                ")])],1)],1)])]}}],null,!1,4152036960)})],1)],1)],1):e._e(),1==e.activeIndex?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"贵司名称",prop:"comp"}},[t("el-input",{attrs:{placeholder:"请输入贵司名称",clearable:""},model:{value:e.dataForm.comp,callback:function(t){e.$set(e.dataForm,"comp",t)},expression:"dataForm.comp"}})],1)],1):e._e(),1==e.activeIndex?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"联系人",prop:"contact"}},[t("el-input",{attrs:{placeholder:"请输入联系人",clearable:""},model:{value:e.dataForm.contact,callback:function(t){e.$set(e.dataForm,"contact",t)},expression:"dataForm.contact"}})],1)],1):e._e(),1==e.activeIndex?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"联系方式",prop:"contactinfo"}},[t("el-input",{attrs:{placeholder:"请输入联系方式",clearable:""},model:{value:e.dataForm.contactinfo,callback:function(t){e.$set(e.dataForm,"contactinfo",t)},expression:"dataForm.contactinfo"}})],1)],1):e._e(),1==e.activeIndex?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"项目名称",prop:"project"}},[t("el-input",{attrs:{placeholder:"请输入项目名称",clearable:""},model:{value:e.dataForm.project,callback:function(t){e.$set(e.dataForm,"project",t)},expression:"dataForm.project"}})],1)],1):e._e(),1==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"故障现象",prop:"fault"}},[t("el-input",{attrs:{clearable:"",type:"textarea",placeholder:"详细准确的故障现象描述，有助于工程师定位问题，提升售后效率。",autosize:{minRows:4,maxRows:8}},model:{value:e.dataForm.fault,callback:function(t){e.$set(e.dataForm,"fault",t)},expression:"dataForm.fault"}})],1)],1):e._e(),1==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"对接工程师",prop:"dock"}},[t("el-input",{attrs:{placeholder:"请输入对接的厂家工程师，例如胡工",clearable:""},model:{value:e.dataForm.dock,callback:function(t){e.$set(e.dataForm,"dock",t)},expression:"dataForm.dock"}})],1)],1):e._e(),1==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"现场照片"}},[t("el-upload",{attrs:{multiple:"",action:"",limit:3,"http-request":e.handleUploadImageChange,"file-list":e.fileList,"list-type":"picture-card","on-exceed":e.handleExceedChange,"before-upload":e.handleBeforeUploadChange,"on-change":e.handleFileChange,"on-remove":e.handleRemoveUploadFileChange}},[t("i",{staticClass:"el-icon-plus"})])],1)],1):e._e(),1==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"现场视频"}},[t("el-upload",{attrs:{action:"","http-request":e.handleUploadVideoChange,"show-file-list":!1,"before-upload":e.handleBeforeUploadVideoChange}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-upload"}},[e._v("上传视频")])],1)],1),e.videoSrc?t("video",{staticStyle:{width:"100%"},attrs:{src:e.videoSrc,autoplay:""}}):e._e()],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"客户寄件类型",prop:"details"}},[t("el-radio-group",{model:{value:e.dataForm.details,callback:function(t){e.$set(e.dataForm,"details",t)},expression:"dataForm.details"}},[t("el-radio",{attrs:{label:0}},[e._v("仅裸机")]),t("el-radio",{attrs:{label:1}},[e._v("含配件")])],1)],1)],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"我司收件信息",prop:"address"}},[t("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between"}},[t("el-input",{attrs:{disabled:"",type:"textarea",placeholder:"请输入我司收件信息",autosize:{minRows:3}},model:{value:e.dataForm.address,callback:function(t){e.$set(e.dataForm,"address",t)},expression:"dataForm.address"}}),t("el-button",{staticClass:"machineInfoContentCopy",staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success",icon:"el-icon-copy-document"},on:{click:function(t){return e.handleCopyChange()}}},[e._v("\n                                "+e._s(e.$t("copy"))+"\n                            ")])],1)])],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"客户寄出照片"}},[t("el-upload",{attrs:{multiple:"",action:"",limit:3,"http-request":e.handleUploadSendImageChange,"file-list":e.sendFileList,"list-type":"picture-card","on-exceed":e.handleExceedChange,"before-upload":e.handleBeforeUploadChange,"on-change":e.handleSendFileChange,"on-remove":e.handleRemoveSendFileChange}},[t("i",{staticClass:"el-icon-plus"})])],1)],1):e._e(),2==e.activeIndex&&1==e.dataForm.details?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"客户寄件配件详情",prop:"accessory"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入客户寄件配件详情"},model:{value:e.dataForm.accessory,callback:function(t){e.$set(e.dataForm,"accessory",t)},expression:"dataForm.accessory"}})],1)],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"客户寄出信息",prop:"receipt"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入客户寄出信息"},model:{value:e.dataForm.receipt,callback:function(t){e.$set(e.dataForm,"receipt",t)},expression:"dataForm.receipt"}})],1)],1):e._e(),2==e.activeIndex?t("h3",[e._v("* 您的收件信息(售后完成时的回寄地址)")]):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"联系人",prop:"rcontact"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入联系人"},model:{value:e.dataForm.rcontact,callback:function(t){e.$set(e.dataForm,"rcontact",t)},expression:"dataForm.rcontact"}})],1)],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"联系方式",prop:"rcontactinfo"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入联系方式"},model:{value:e.dataForm.rcontactinfo,callback:function(t){e.$set(e.dataForm,"rcontactinfo",t)},expression:"dataForm.rcontactinfo"}})],1)],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"收件地址",prop:"raddress"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入收件地址"},model:{value:e.dataForm.raddress,callback:function(t){e.$set(e.dataForm,"raddress",t)},expression:"dataForm.raddress"}})],1)],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"寄出信息",prop:"returnnum"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入寄出信息"},model:{value:e.dataForm.returnnum,callback:function(t){e.$set(e.dataForm,"returnnum",t)},expression:"dataForm.returnnum"}})],1)],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"寄出网关编号",prop:"rsn"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入寄出网关编号"},model:{value:e.dataForm.rsn,callback:function(t){e.$set(e.dataForm,"rsn",t)},expression:"dataForm.rsn"}})],1)],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"寄件类型",prop:"rdetails"}},[t("el-radio-group",{model:{value:e.dataForm.rdetails,callback:function(t){e.$set(e.dataForm,"rdetails",t)},expression:"dataForm.rdetails"}},[t("el-radio",{attrs:{label:0}},[e._v("仅裸机")]),t("el-radio",{attrs:{label:1}},[e._v("含配件")])],1)],1)],1):e._e(),2==e.activeIndex&&1==e.dataForm.rdetails?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"寄件配件详情",prop:"raccessory"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入寄件配件详情"},model:{value:e.dataForm.raccessory,callback:function(t){e.$set(e.dataForm,"raccessory",t)},expression:"dataForm.raccessory"}})],1)],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"寄出照片"}},[t("el-upload",{attrs:{multiple:"",action:"",limit:3,"http-request":e.handleUploadReceiveImageChange,"file-list":e.receiveFileList,"list-type":"picture-card","on-exceed":e.handleExceedChange,"before-upload":e.handleBeforeUploadChange,"on-change":e.handleReceiveFileChange,"on-remove":e.handleRemoveFileChange}},[t("i",{staticClass:"el-icon-plus"})])],1)],1):e._e(),2==e.activeIndex?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"分析照片"}},[t("el-upload",{attrs:{multiple:"",action:"",limit:3,"http-request":e.handleUploadAnalyzeImageChange,"file-list":e.analyzeFileList,"list-type":"picture-card","on-exceed":e.handleExceedChange,"before-upload":e.handleBeforeUploadChange,"on-change":e.handleAnalyzeFileChange}},[t("i",{staticClass:"el-icon-plus"})])],1)],1):e._e()],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:function(t){return e.handleClose()}}},[e._v(e._s(e.$t("cancel")))]),0!=e.activeIndex?t("el-button",{on:{click:function(t){return e.handlePreviousStepChange()}}},[e._v(e._s("上一步"))]):e._e(),0!=e.activeIndex?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSaveDraftChange()}}},[e._v(e._s("存为草稿"))]):e._e(),0==e.activeIndex||1==e.activeIndex?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleNextStepChange()}}},[e._v(e._s("下一步"))]):e._e(),2==e.activeIndex?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))]):e._e()],1)],2),t("el-dialog",{attrs:{visible:e.imgVisible},on:{"update:visible":function(t){e.imgVisible=t}}},[t("img",{staticStyle:{height:"500px"},attrs:{src:e.imageUrl,alt:""}})])],1)},n=[],i=(a("8e6e"),a("ac6a"),a("456d"),a("c5f6"),a("ade3")),s=(a("7f7f"),a("96cf"),a("1da1")),o=(a("20d6"),a("2909")),l=(a("28a5"),a("a481"),a("4328")),c=a.n(l),d=a("f744"),u=a("bc3a"),m=a.n(u),p=a("b047"),f=a.n(p),h=a("ed08"),g=a("b311"),v=a.n(g);function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var y={props:["id"],data:function(){return{maxSnCount:100,activeIndex:0,visible:!1,loading:!1,recentAftersalesList:[],fileList:[],sendFileList:[],receiveFileList:[],analyzeFileList:[],videoSrc:"",loadProgress:0,domain:"https://pictures.linkqi.cn",dataForm:{id:"",sn:"",comp:"",contact:"",contactinfo:"",project:"",fault:"",dock:"",address:"收件人：吴越\n手机号：19032214987\n地址：浙江杭州市钱塘区6号路中自科技园 领祺科技 (13F幢)4楼",details:0,accessory:"",receipt:"",rcontact:"",rcontactinfo:"",raddress:"",returnnum:"",re1:"",re2:"",re3:"",re4:"",re5:"",re6:"",re7:"",re8:"",re9:"",re10:"",re11:"",re12:"",rsn:"",rdetails:0,raccessory:"",receiptType:1,returnnumType:1},rules:{sn:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],comp:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],contact:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],contactinfo:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的联系方式"}],project:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],fault:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],dock:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],address:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],details:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],accessory:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],rcontact:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],rcontactinfo:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的联系方式"}],raddress:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}],raccessory:[{required:!0,message:this.$t("validate.required"),trigger:["change","blur"]}]},imageUrl:"",imgVisible:!1}},computed:{snList:function(){if(!this.dataForm.sn)return[];var e=this.dataForm.sn.trim();return""===e?[]:(e=e.replace(/，|、/g,","),","===e[e.length-1]&&(e=e.substring(0,e.length-1)),e.split(",").map((function(e){return e.trim().replace(/\u3000/g,"").trim()})).filter((function(e){return""!==e})))}},methods:{init:function(){this.loading=!0,this.visible=!0},handleDialogOpenChange:function(){var e=this;e.videoSrc="",e.fileList=[],e.sendFileList=[],e.receiveFileList=[],e.analyzeFileList=[],e.imageUrl="",e.imgVisible=!1,e.activeIndex=0,e.dataForm.id=e.id,e.getReceiveAddressInfo(),e.getDataList(),e.dataForm.id?e.getInfo():e.$nextTick((function(){e.loading=!1;var t=localStorage.getItem("draftData")?JSON.parse(localStorage.getItem("draftData")):{};if("{}"!=JSON.stringify(t))e.activeIndex=t.activeIndex||0,e.fileList=t.fileList||[],e.sendFileList=t.sendFileList||[],e.receiveFileList=t.receiveFileList||[],e.analyzeFileList=t.analyzeFileList||[],e.videoSrc=t.videoSrc,t.hasOwnProperty("receipt")&&(t.receipt.includes("无")?t.receiptType=2:t.receiptType=1),t.hasOwnProperty("returnnum")&&(t.returnnum.includes("无")?t.returnnumType=2:t.returnnumType=1),Object.assign(e.dataForm,t);else{var a={id:"",sn:"",comp:"",contact:"",contactinfo:"",project:"",fault:"",dock:"",details:0,accessory:"",receipt:"",rcontact:"",rcontactinfo:"",raddress:"",returnnum:"",re1:"",re2:"",re3:"",re4:"",re5:"",re6:"",re7:"",re8:"",re9:"",re10:"",rsn:"",rdetails:0,raccessory:"",receiptType:1,returnnumType:1};Object.assign(e.dataForm,a),e.$refs.dataForm&&e.$nextTick((function(){e.$refs["dataForm"].clearValidate()}))}}))},getStatusText:function(e){return 0===e?"信息待完善":1===e?"待收件后处理":2===e?"分析中":3===e?"处理中":4===e?"待寄回":5===e?"待收件":6===e?"已签收":"未知"},handleSnInput:function(e){var t=this,a=e.replace(/，/g,",").replace(/、/g,",").replace(/　/g," "),r=this.parseSnString(a),n=a[a.length-1];if(r.length>=this.maxSnCount&&","===n)this.$nextTick((function(){t.dataForm.sn=e.substring(0,e.length-1)}));else if(r.length>this.maxSnCount){var i=r.slice(0,this.maxSnCount).join(", ");this.$nextTick((function(){t.dataForm.sn=i}))}else a!==e&&this.$nextTick((function(){t.dataForm.sn=a}))},parseSnString:function(e){return e?(e=e.trim(),""===e?[]:e.split(",").map((function(e){return e.trim().replace(/\u3000/g,"").trim()})).filter((function(e){return""!==e}))):[]},handleKeydown:function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())},handleReceiptTypeChange:function(e){this.dataForm.receipt=""},handleReceiptInput:function(e){1===this.dataForm.receiptType&&(this.dataForm.receipt=e.replace(/[^a-zA-Z0-9]/g,""))},handleReturnnumTypeChange:function(e){this.dataForm.returnnum=""},handleReturnnumInput:function(e){1===this.dataForm.returnnumType&&(this.dataForm.returnnum=e.replace(/[^a-zA-Z0-9]/g,""))},getDataList:function(){var e=this,t={page:1,limit:10};e.$http.get("/aftermarket/getProjectPage.do",{params:t}).then((function(t){var a=t.data;if(0!=a.code)return e.recentAftersalesList=[],e.$message.error(a.data||a.msg);a.data.list.length>0?e.recentAftersalesList=a.data.list:e.recentAftersalesList=[]})).catch((function(e){return!1}))},getReceiveAddressInfo:function(){var e=this,t={_t:(new Date).getTime()};m.a.get("https://dingiiot.com/companyReceiveaddress.json",{params:t}).then((function(t){var a=t.data;e.dataForm.address="收件人："+a.username+"\n手机号："+a.mobile+"\n地址："+a.address})).catch((function(e){return!1}))},handleCheckSnExitChange:function(e){var t=this,a=Object(o["a"])(t.snList);function r(){var n=a.shift();if(n){var i=t.snList;i.includes(n)?t.$http.get("/aftermarket/selectBySn.do",{params:{sn:n}}).then((function(e){var a=e.data;0==a.code?"string"===typeof a.data?"该编号无任何记录"===a.data?t.$confirm("编号 [".concat(n,"] 没有任何记录，是否继续？"),t.$t("deleteInfo.noticePrompt"),{confirmButtonText:"继续",cancelButtonText:"删除",type:"warning"}).then((function(){r()})).catch((function(e){var a=i.filter((function(e){return e!==n}));t.dataForm.sn=a.join(","),r()})):(t.$message.info("编号 [".concat(n,"] ").concat(a.data)),r()):(t.dataForm.id||(t.dataForm.comp=a.data.username,t.dataForm.project=a.data.company),r()):t.$confirm("编号 [".concat(n,"] ").concat(a.data,"，是否保留？"),t.$t("deleteInfo.noticePrompt"),{confirmButtonText:"保留",cancelButtonText:"删除",type:"warning"}).then((function(){r()})).catch((function(e){var a=i.filter((function(e){return e!==n}));t.dataForm.sn=a.join(","),r()}))})).catch((function(e){t.$confirm("查询编号 [".concat(n,"] 失败，是否保留？"),t.$t("deleteInfo.noticePrompt"),{confirmButtonText:"保留",cancelButtonText:"删除",type:"warning"}).then((function(){r()})).catch((function(e){var a=i.filter((function(e){return e!==n}));t.dataForm.sn=a.join(","),r()}))})):r()}else e()}0!==a.length&&r()},handlePreviousStepChange:function(){this.activeIndex--},handleNextStepChange:function(){var e=this;e.$refs["dataForm"].validate((function(t){if(!t)return!1;0==e.activeIndex?e.handleCheckSnExitChange((function(){e.$nextTick((function(){e.dataForm.sn&&e.activeIndex++}),500)})):(e.dataForm.rcontact||(e.dataForm.rcontact=e.dataForm.contact),e.dataForm.rcontactinfo||(e.dataForm.rcontactinfo=e.dataForm.contactinfo),e.activeIndex++)}))},handleBeforeUploadChange:function(e){var t=["image/jpeg","image/png","image/jpg","image/x-icon"],a=t.includes(e.type),r=e.size/1024/1024<5;return a||this.$message.error(this.$t("domainInfo.pictureType")),r||this.$message.error(this.$t("domainInfo.uploadSystemBglimit")),a&&r},handleExceedChange:function(e,t){return this.$message.warning("图片最多上传3个文件")},handlePictureCardPreview:function(e){this.imageUrl=e.url,this.imgVisible=!0},handleFileChange:function(e,t){this.fileList=t},handleRemoveUploadFileChange:function(e,t){this.fileList=t},handleUploadImageChange:function(e){var t=this,a=new FormData;t.loading=!0,a.append("multipartFile",e.file),t.$http.post("/aftermarket/uploadFile.do",a).then((function(a){var r=a.data;if(0!=r.code)return t.loading=!1,t.$message.error(r.msg);var n=t.fileList.findIndex((function(t){return t.uid===e.file.uid}));-1!==n&&t.$set(t.fileList[n],"url",r.data),t.$message.success("上传成功"),t.loading=!1})).catch((function(e){return t.loading=!1,!1}))},handleSendFileChange:function(e,t){this.sendFileList=t},handleRemoveSendFileChange:function(e,t){this.sendFileList=t},handleUploadSendImageChange:function(e){var t=this,a=new FormData;t.loading=!0,a.append("multipartFile",e.file),t.$http.post("/aftermarket/uploadFile.do",a).then((function(a){var r=a.data;if(0!=r.code)return t.loading=!1,t.$message.error(r.msg);var n=t.sendFileList.findIndex((function(t){return t.uid===e.file.uid}));-1!==n&&t.$set(t.sendFileList[n],"url",r.data),t.$message.success("上传成功"),t.loading=!1})).catch((function(e){return t.loading=!1,!1}))},handleReceiveFileChange:function(e,t){this.receiveFileList=t},handleRemoveFileChange:function(e,t){this.receiveFileList=t},handleUploadReceiveImageChange:function(e){var t=this,a=new FormData;t.loading=!0,a.append("multipartFile",e.file),t.$http.post("/aftermarket/uploadFile.do",a).then((function(a){var r=a.data;if(0!=r.code)return t.loading=!1,t.$message.error(r.msg);var n=t.receiveFileList.findIndex((function(t){return t.uid===e.file.uid}));-1!==n&&t.$set(t.receiveFileList[n],"url",r.data),t.$message.success("上传成功"),t.loading=!1})).catch((function(e){return t.loading=!1,!1}))},handleAnalyzeFileChange:function(e,t){this.analyzeFileList=t},handleUploadAnalyzeImageChange:function(e){var t=this,a=new FormData;t.loading=!0,a.append("multipartFile",e.file),t.$http.post("/aftermarket/uploadFile.do",a).then((function(a){var r=a.data;if(0!=r.code)return t.loading=!1,t.$message.error(r.msg);var n=t.analyzeFileList.findIndex((function(t){return t.uid===e.file.uid}));-1!==n&&t.$set(t.analyzeFileList[n],"url",r.data),t.$message.success("上传成功"),t.loading=!1})).catch((function(e){return t.loading=!1,!1}))},handleBeforeUploadVideoChange:function(e){var t=["video/mp4","video/avi","video/mov","video/mpeg"],a=t.includes(e.type),r=e.size/1024/1024<100;return a||this.$message.error("视频格式错误,请上传视频!"),r||this.$message.error("视频大小不能超过100MB"),a&&r},getQiniuToken:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,this.$http.post("/qiniu/getUpload.do",c.a.stringify({bucket:"pictures-cloud"}));case 1:if(t=e.sent,!t.data){e.next=2;break}return e.abrupt("return",t.data.data);case 2:throw new Error("获取token失败");case 3:e.next=5;break;case 4:throw e.prev=4,a=e["catch"](0),a;case 5:case"end":return e.stop()}}),e,this,[[0,4]])})));function t(){return e.apply(this,arguments)}return t}(),handleUploadVideoChange:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=this,e.next=1,a.getQiniuToken();case 1:r=e.sent,a.loading=!0,n={useCdnDomain:!0,disableStatisticsReport:!1,retryCount:6},i={customVars:{}},a.uploadWithSDK(r,i,n,a.domain,t.file);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),uploadWithSDK:function(e,t,a,r,n){var i=this,s=n.raw||n,o="aftermarket/image/".concat(Object(h["h"])(),"_").concat(s.name.replace(/\s+/g,"_")),l=function(e){i.$message.error(e.data.error||"上传失败"),i.loading=!1},c=function(e){i.loadProgress=Math.round(e.total.percent)},u=function(e){p.unsubscribe(),i.videoSrc="".concat(r,"/").concat(e.key),i.loading=!1},m=d["a"](s,o,e,t,a),p=m.subscribe({next:c,error:l,complete:u})},handleCopyChange:function(){var e=this,t=this.dataForm.address;if(!t)return!1;var a=new v.a(".machineInfoContentCopy",{text:function(){return t}});a.on("success",(function(t){e.$message({message:e.$t("upgrade.copySuccess"),showClose:!0,type:"success"}),a.destroy()})),a.on("error",(function(t){e.$message({message:e.$t("upgrade.copyFail"),showClose:!0,type:"error"}),a.destroy()}))},getInfo:function(){var e=this,t={id:e.dataForm.id,_t:(new Date).getTime()};e.$http.get("/aftermarket/getById.do",{params:t}).then((function(t){var a=t.data;if(0!==a.code)return e.loading=!1,e.$message.error(a.data||a.msg);e.dataForm=b(b({},e.dataForm),a.data),e.dataForm.receipt.includes("无")?e.dataForm.receiptType=2:e.dataForm.receiptType=1,e.dataForm.returnnum.includes("无")?e.dataForm.returnnumType=2:e.dataForm.returnnumType=1,e.dataForm.userId=Number(e.dataForm.userId),a.data.re1&&e.fileList.push({name:0,url:a.data.re1}),a.data.re2&&e.fileList.push({name:1,url:a.data.re2}),a.data.re3&&e.fileList.push({name:2,url:a.data.re3}),a.data.re4&&(e.videoSrc=a.data.re4),a.data.re5&&e.sendFileList.push({name:0,url:a.data.re5}),a.data.re6&&e.sendFileList.push({name:1,url:a.data.re6}),a.data.re7&&e.sendFileList.push({name:2,url:a.data.re7}),a.data.re8&&e.receiveFileList.push({name:0,url:a.data.re8}),a.data.re9&&e.receiveFileList.push({name:1,url:a.data.re9}),a.data.re10&&e.receiveFileList.push({name:2,url:a.data.re10}),a.data.re11&&e.analyzeFileList.push({name:0,url:a.data.re11}),a.data.re12&&e.analyzeFileList.push({name:1,url:a.data.re12}),e.loading=!1})).catch((function(t){return e.loading=!1,!1}))},handleClose:function(){this.dataForm.id="",this.visible=!1},handleSaveDraftChange:function(){this.activeIndex,localStorage.setItem("draftData",JSON.stringify({activeIndex:this.activeIndex,sn:this.dataForm.sn,comp:this.dataForm.comp,contact:this.dataForm.contact,contactinfo:this.dataForm.contactinfo,project:this.dataForm.project,fault:this.dataForm.fault,dock:this.dataForm.dock,fileList:this.fileList,videoSrc:this.videoSrc,details:this.dataForm.details,sendFileList:this.sendFileList,accessory:this.dataForm.accessory,receipt:this.dataForm.receipt,rcontact:this.dataForm.rcontact,rcontactinfo:this.dataForm.rcontactinfo,raddress:this.dataForm.raddress,returnnum:this.dataForm.returnnum,rsn:this.dataForm.rsn,rdetails:this.dataForm.rdetails,receiveFileList:this.receiveFileList,raccessory:this.dataForm.raccessory,analyzeFileList:this.analyzeFileList,receiptType:this.dataForm.receiptType,returnnumType:this.dataForm.returnnumType})),this.$message.success("草稿已保存")},dataFormSubmitHandle:f()((function(){var e=this,t="/aftermarketComp/insert.do",a=[],r=[];e.$refs["dataForm"].validate((function(n){if(!n)return!1;if(1==e.dataForm.details&&0==e.sendFileList.length)return e.$message.warning("客户寄出照片不能为空","none");if(1==e.dataForm.rdetails&&0==e.receiveFileList.length)return e.$message.warning("寄出照片不能为空","none");a.push({comp:e.dataForm.comp,contact:e.dataForm.contact,contactinfo:e.dataForm.contactinfo,dock:e.dataForm.dock,project:e.dataForm.project,raddress:e.dataForm.raddress,rcontact:e.dataForm.rcontact,rcontactinfo:e.dataForm.rcontactinfo,receipt:e.dataForm.receipt,re1:e.sendFileList.length>0?e.sendFileList[0].url:null,re2:e.sendFileList.length>1?e.sendFileList[1].url:null,re3:e.sendFileList.length>2?e.sendFileList[2].url:null,re4:e.receiveFileList.length>0?e.receiveFileList[0].url:null,re5:e.receiveFileList.length>1?e.receiveFileList[1].url:null,re6:e.receiveFileList.length>2?e.receiveFileList[2].url:null});var i=e.snList;e.dataForm.receipt?(e.loading=!0,e.$http.post(t,a).then((function(t){var a=t.data;if(0!==a.code)return e.loading=!1,e.$message.error(a.data||a.msg),!1;for(var n=JSON.parse(a.data).uuid,s=0;s<i.length;s++)r.push({sn:i[s],details:e.dataForm.details,accessory:e.dataForm.accessory,fault:e.dataForm.fault,returnnum:e.dataForm.returnnum,rsn:e.dataForm.rsn,rdetails:e.dataForm.rdetails,raccessory:e.dataForm.raccessory,re1:e.fileList.length>0?e.fileList[0].url:null,re2:e.fileList.length>1?e.fileList[1].url:null,re3:e.fileList.length>2?e.fileList[2].url:null,re4:e.videoSrc||null});e.$http.post("/aftermarket/insert.do?uid="+n,r).then((function(t){var a=t.data;if(0!==a.code)return e.loading=!1,e.$message.error(a.data||a.msg),!1;e.loading=!1,e.dataForm.id?e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataForm.id="",e.visible=!1,e.$emit("refreshDataList")}}):e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataForm.id="",localStorage.removeItem("draftData"),e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(t){e.loading=!1}))})).catch((function(t){e.loading=!1}))):e.$confirm("快递单号未填写，是否继续？",e.$t("deleteInfo.noticePrompt"),{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,e.$http.post(t,a).then((function(t){var a=t.data;if(0!==a.code)return e.loading=!1,e.$message.error(a.data||a.msg),!1;for(var n=JSON.parse(a.data).uuid,s=0;s<i.length;s++)r.push({sn:i[s],details:e.dataForm.details,accessory:e.dataForm.accessory,fault:e.dataForm.fault,returnnum:e.dataForm.returnnum,rsn:e.dataForm.rsn,rdetails:e.dataForm.rdetails,raccessory:e.dataForm.raccessory,re1:e.fileList.length>0?e.fileList[0].url:null,re2:e.fileList.length>1?e.fileList[1].url:null,re3:e.fileList.length>2?e.fileList[2].url:null,re4:e.videoSrc||null});e.$http.post("/aftermarket/insert.do?uid="+n,r).then((function(t){var a=t.data;if(0!==a.code)return e.loading=!1,e.$message.error(a.data||a.msg),!1;e.loading=!1,e.dataForm.id?e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataForm.id="",e.visible=!1,e.$emit("refreshDataList")}}):e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataForm.id="",localStorage.removeItem("draftData"),e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(t){e.loading=!1}))})).catch((function(t){e.loading=!1}))})).catch((function(e){}))}))}),1e3,{leading:!0,trailing:!1})}},x=y,w=(a("cb7e"),a("2877")),$=Object(w["a"])(x,r,n,!1,null,"136a72f5",null);t["default"]=$.exports},9030:function(e,t,a){},cb7e:function(e,t,a){"use strict";a("9030")}}]);