(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08f24e27"],{"1e8b":function(e,t,n){},"90c2f":function(e,t,n){"use strict";n("1e8b")},d7fc:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e._self._c;return t("section",[t("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{visible:e.vpnConfigVisible,width:"65%","close-on-click-modal":!1,"close-on-press-escape":!1,title:"VPN配置("+e.dataForm.sn+"-"+(e.dataForm.gwDesc||"暂无描述")+")","before-close":e.handleClose},on:{"update:visible":function(t){e.vpnConfigVisible=t}}},[t("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{label:e.$t("gwsnSetting.VPNConfig"),name:"first"}},[t("el-form",{ref:"vpnForm",attrs:{model:e.vpnForm,"label-width":"en-US"===e.$i18n.locale?"120px":"80px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("gwsnSetting.eth"),prop:"eth"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("gwsnSetting.pleaseSelect")},model:{value:e.vpnForm.eth,callback:function(t){e.$set(e.vpnForm,"eth",t)},expression:"vpnForm.eth"}},e._l(e.networkList,(function(e,n){return t("el-option",{key:n,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("vpnConfig.connectionMethod"),prop:"autoconnect"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("gwsnSetting.pleaseSelect")},model:{value:e.vpnForm.autoconnect,callback:function(t){e.$set(e.vpnForm,"autoconnect",t)},expression:"vpnForm.autoconnect"}},e._l(e.connectList,(function(e,n){return t("el-option",{key:n,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("vpnConfig.username"),prop:"user"}},[t("el-input",{attrs:{placeholder:e.$t("vpnConfig.pleaseEnterUsername"),clearable:""},model:{value:e.vpnForm.user,callback:function(t){e.$set(e.vpnForm,"user",t)},expression:"vpnForm.user"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("vpnConfig.password"),prop:"password"}},[t("el-input",{attrs:{placeholder:e.$t("vpnConfig.pleaseEnterPassword"),clearable:"","show-password":""},model:{value:e.vpnForm.password,callback:function(t){e.$set(e.vpnForm,"password",t)},expression:"vpnForm.password"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("vpnConfig.vpnName"),prop:"hub"}},[t("el-input",{attrs:{placeholder:e.$t("vpnConfig.pleaseEnterVpnName"),clearable:""},model:{value:e.vpnForm.hub,callback:function(t){e.$set(e.vpnForm,"hub",t)},expression:"vpnForm.hub"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",[e.$hasPermission("socketsOne:getVpn:select:websocket")?t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-refresh"},on:{click:e.getVPNConfigRefresh}},[e._v("\n                                    "+e._s(e.$t("gwsnSetting.refresh"))+"\n                                ")]):e._e(),e.$hasPermission("socketList:vpn.do:websocket")&&e.dataForm.isShowSetting?t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-setting"},on:{click:e.handleCreateVpnAccountSetChange}},[e._v("\n                                    "+e._s(e.$t("gwsnSetting.set"))+"\n                                ")]):e._e()],1)],1)],1)],1),t("el-form",{ref:"ipListForm",attrs:{model:e.ipListForm,rules:e.ipListRules,"label-width":"en-US"===e.$i18n.locale?"120px":"80px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleIpSubmit.apply(null,arguments)}}},[t("el-row",[t("el-form-item",{attrs:{label:e.$t("gwsnSetting.addGwsnIp"),"label-width":"100"}})],1),t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{label:e.$t("gwsnSetting.IP"),prop:"ip"}},[t("el-input",{attrs:{clearable:"",placeholder:e.$t("gwsnSetting.IP"),disabled:"dhcp"==e.vpnForm.mode||-1!=String(e.vpnForm.eth).indexOf("_")},model:{value:e.ipListForm.ip,callback:function(t){e.$set(e.ipListForm,"ip",t)},expression:"ipListForm.ip"}})],1)],1),t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{label:e.$t("gwsnSetting.mask"),prop:"mask"}},[t("el-input",{attrs:{clearable:"",placeholder:e.$t("gwsnSetting.mask"),disabled:"dhcp"==e.vpnForm.mode||-1!=String(e.vpnForm.eth).indexOf("_")},on:{focus:e.handleMask},model:{value:e.ipListForm.mask,callback:function(t){e.$set(e.ipListForm,"mask",t)},expression:"ipListForm.mask"}})],1)],1),e.$hasPermission("socketList:vpn.do:websocket")&&e.dataForm.isShowSetting?t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"small",disabled:"dhcp"==e.vpnForm.mode||-1!=String(e.vpnForm.eth).indexOf("_")},on:{click:e.handleIpSubmit}},[e._v("\n                                "+e._s(e.$t("gwsnSetting.add"))+"\n                            ")])],1):e._e()],1)],1),t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:22}},[t("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{size:"small",border:"",data:e.ipList,"tooltip-effect":"dark"},on:{"selection-change":e.handleIPSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{prop:"ip",label:e.$t("gwsnSetting.IP"),align:"center"}}),t("el-table-column",{attrs:{prop:"mask",label:e.$t("gwsnSetting.mask"),align:"center"}}),e.$hasPermission("socketList:vpn.do:websocket")&&e.dataForm.isShowSetting?t("el-table-column",{attrs:{label:e.$t("handle"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-button",{attrs:{type:"text",disabled:"dhcp"==e.vpnForm.mode||-1!=String(e.vpnForm.eth).indexOf("_")},on:{click:function(t){return e.handleIPMaskVisible(n.$index,n.row)}}},[e._v("\n                                        "+e._s(e.$t("update"))+"\n                                    ")]),t("el-button",{attrs:{type:"text",disabled:"dhcp"==e.vpnForm.mode||-1!=String(e.vpnForm.eth).indexOf("_")},on:{click:function(t){return e.handleIpDelete(n.row)}}},[e._v("\n                                        "+e._s(e.$t("delete"))+"\n                                    ")])]}}],null,!1,2364673293)}):e._e()],1)],1),e.$hasPermission("socketList:vpn.do:websocket")&&e.dataForm.isShowSetting?t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{icon:"el-icon-delete",type:"danger",size:"small",disabled:"dhcp"==e.vpnForm.mode||-1!=String(e.vpnForm.eth).indexOf("_")},on:{click:e.handleIpDelete}},[e._v("\n                            "+e._s(e.$t("delete"))+"\n                        ")])],1):e._e()],1)],1)],1)],1),t("el-dialog",{attrs:{title:e.$t("update"),visible:e.IPMaskVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.IPMaskVisible=t}}},[t("el-form",{ref:"IPMaskForm",attrs:{model:e.IPMaskForm,rules:e.IPMaskRules,"label-width":"en-US"===e.$i18n.locale?"150px":"100px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.IPMaskFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("gwsnSetting.IP"),prop:"ip"}},[t("el-input",{attrs:{placeholder:e.$t("gwsnSetting.IP")},model:{value:e.IPMaskForm.ip,callback:function(t){e.$set(e.IPMaskForm,"ip",t)},expression:"IPMaskForm.ip"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("gwsnSetting.mask"),prop:"mask"}},[t("el-input",{attrs:{type:"text",placeholder:e.$t("gwsnSetting.mask")},on:{focus:e.handleMask},model:{value:e.IPMaskForm.mask,callback:function(t){e.$set(e.IPMaskForm,"mask",t)},expression:"IPMaskForm.mask"}})],1)],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:function(t){e.IPMaskVisible=!1}}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.IPMaskFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)],1)},i=[],r=(n("ac4d"),n("8a81"),n("5df3"),n("1c4c"),n("7f7f"),n("53ca")),a=(n("6b54"),n("a481"),n("c5f6"),n("ac6a"),n("ed08")),o=n("b047"),l=n.n(o);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=p(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw r}}}}function p(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}var u={name:"tagwinfo-vpn",props:["vpnBasicForm"],data:function(){return{wsUrl:"",content:"",resname:"",websocket:null,getMQTTTimer:null,loading:!1,activeName:"first",vpnConfigVisible:!1,networkList:[],ipIds:[],ipList:[],storeIPList:[],dataForm:{sn:"",gwDesc:"",gwModel:"",isShowSetting:!1},vpnForm:{eth:null,autoconnect:1,user:"",password:"",hub:""},connectList:[{label:this.$t("vpnConfig.manualConnection"),value:0},{label:this.$t("vpnConfig.automaticConnection"),value:1}],ipListForm:{ip:"",mask:""},ipListRules:{ip:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{pattern:/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,message:this.$t("gwsnSetting.enterCorrectIp")}],mask:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{pattern:/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){3}$/,message:this.$t("gwsnSetting.enterCorrectMask")}]},updateIndex:null,IPMaskVisible:!1,IPMaskForm:{ip:"",mask:""},IPMaskRules:{ip:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{pattern:/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,message:this.$t("gwsnSetting.enterCorrectIp")}],mask:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{pattern:/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){3}$/,message:this.$t("gwsnSetting.enterCorrectMask")}]}}},methods:{init:function(){var e=this;this.wsUrl="",this.activeName="first",this.loading=!0,this.dataForm.sn=this.vpnBasicForm.gwSn,this.dataForm.gwDesc=this.vpnBasicForm.gwDesc,this.dataForm.gwModel=this.vpnBasicForm.gwModel,this.dataForm.isShowSetting=1==this.vpnBasicForm.per,this.getNetWorkDataList((function(t){if(t.hasOwnProperty("code")&&0!=t.code)return e.loading=!1,e.$message.error(t.msg);e.loading=!1;var n=JSON.parse(t.list[0].gwInterface).network.list;n.length>0&&(n.forEach((function(t){e.networkList.push({label:t,value:Number(t.replace(/[^0-9]/gi,""))})})),e.vpnConfigVisible=!0,e.$nextTick((function(){e.ipIds=[],e.ipList=[],e.storeIPList=[],e.vpnForm={eth:null,autoconnect:0,user:"",password:"",hub:""},e.ipListForm={ip:"",mask:""},e.getVPNConfigRefresh()})))}))},getNetWorkDataList:function(e){var t=this,n={page:1,limit:1,model:t.dataForm.gwModel};t.networkList=[],t.$hasPermission("interface:select:permission.do")?t.$http.get("/gwtype/interface/selectByModel",{params:n}).then((function(t){var n=t.data;e(n)})).catch((function(e){})):setTimeout((function(){t.$message.warning("暂无权限, 请联系管理员")}),500)},encryMD5:function(e){var t=this.$randomStrFun();return this.$md5(t+e)+"/"+String(parseInt((new Date).getTime().toString().substring(0,10)))},encryMD5List:function(){var e=this.$randomStrFun();return this.$md5(e)+"/"+String(parseInt((new Date).getTime().toString().substring(0,10)))},handleClick:function(e,t){this.loading=!1,this.websocket&&this.websocket.readyState===WebSocket.OPEN&&(this.websocket.close(),this.websocket=null),this.getMQTTTimer&&(clearTimeout(this.getMQTTTimer),this.getMQTTTimer=null)},createWebSocket:function(){var e=this;if(!("WebSocket"in window))return e.$message.error(e.$t("websocket.notSupportWebsocket"));try{var t=window.SITE_CONFIG["socketUrl"]+e.wsUrl+"?token="+e.$getToken();e.websocket=new WebSocket(t),e.initWebSocket()}catch(n){}},initWebSocket:function(){this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onmessage=this.websocketonmessage,this.websocket.onclose=this.websocketonclose},websocketonopen:function(){},websocketonerror:function(e){},isJsonString:function(e){if("string"===typeof e)try{var t=JSON.parse(e);return!("object"!==Object(r["a"])(t)||!t)}catch(n){return!1}},websocketonmessage:function(e){if(!this.isJsonString(e.data))return!1;if(this.getMQTTTimer&&(clearTimeout(this.getMQTTTimer),this.getMQTTTimer=null),this.websocket&&(this.websocket.close(),this.websocket=null),"getVPNAccounts"===this.resname&&"getVPNAccounts"==JSON.parse(e.data).res_name){var t=JSON.parse(e.data).res_content;1===t.result?(this.vpnForm={eth:t.param.length>0?Number(String(t.param[0].bridge).replace(/[^0-9]/gi,"")):"",autoconnect:t.param.length>0?t.param[0].autoconnect:"",user:t.param.length>0?t.param[0].UserName:"",password:t.param.length>0?t.param[0].passwd:"",hub:t.param.length>0?t.param[0].HubName:""},this.ipListForm={ip:"",mask:""},this.ipIds=[],this.ipList=[],this.storeIPList=[],this.$message.success(this.$t("vpnConfig.obtainVPNConfigurationSuccessfully"))):this.$message.error(this.$t("vpnConfig.obtainVPNConfigurationFailed")),this.loading=!1}else if("createVPNAccount"===this.resname&&"createVPNAccount"==JSON.parse(e.data).res_name){this.loading=!1;var n=JSON.parse(e.data).res_content;1===n.result?this.$message.success(this.$t("vpnConfig.vpnSetupSuccessful")):this.$message.error(this.$t("vpnConfig.vpnSetupFailed"))}},websocketonclose:function(e){},getVPNConfigRefresh:l()((function(){var e=this;e.resname="getVPNAccounts",e.wsUrl="socketsOne/getVpn/"+e.dataForm.sn+"/"+e.encryMD5(e.dataForm.sn),e.$hasPermission("socketsOne:getVpn:select:websocket")?(e.getipList=[],e.createWebSocket(),e.loading=!0,e.getMQTTTimer=setTimeout((function(){if(e.loading)return e.loading=!1,e.websocket&&(e.websocket.close(),e.websocket=null),e.getMQTTTimer&&(clearTimeout(e.getMQTTTimer),e.getMQTTTimer=null),e.$message.error(e.$t("issue.timeout"))}),"30000")):setTimeout((function(){e.$message.warning("暂无获取VPN配置权限, 请联系管理员")}),500)}),1e3,{leading:!0,trailing:!1}),handleMask:function(){var e=parseInt(this.ipListForm.ip);this.ipListForm.mask=e>=0&&e<=127?"255.0.0.0":e>=128&&e<=191?"255.255.0.0":"255.255.255.0"},handleIpSubmit:l()((function(){var e=this;e.$refs["ipListForm"].validate((function(t){if(t){if(e.ipList.length<10){if(0==e.ipList.length)e.ipList.push({ip:e.ipListForm.ip,mask:e.ipListForm.mask});else{var n,s=!1,i=c(e.ipList);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.ip==e.ipListForm.ip&&r.mask==e.ipListForm.mask)return s=!0,e.$message.error(e.$t("gwsnSetting.hasExistIP"))}}catch(a){i.e(a)}finally{i.f()}s||e.ipList.push({ip:e.ipListForm.ip,mask:e.ipListForm.mask})}return e.storeIPList=e.ipList,e.ipListForm.ip="",e.ipListForm.mask="",e.$message.success(e.$t("gwsnSetting.addSuccess"))}return e.$message.info(e.$t("gwsnSetting.setIPLimit"))}}))}),1e3,{leading:!0,trailing:!1}),handleIPSelectionChange:function(e){this.ipIds=e},handleIPMaskVisible:l()((function(e,t){this.IPMaskForm={ip:t.ip,mask:t.mask},this.updateIndex=e,this.IPMaskVisible=!0}),1e3,{leading:!0,trailing:!1}),IPMaskFormSubmitHandle:l()((function(){var e,t=this,n=!1,s=c(this.ipList);try{for(s.s();!(e=s.n()).done;){var i=e.value;if(i.ip==this.IPMaskForm.ip&&i.mask==this.IPMaskForm.mask)return n=!0,this.$message.error(this.$t("gwsnSetting.hasExistIPUpdateError"))}}catch(r){s.e(r)}finally{s.f()}this.$nextTick((function(){n||(t.IPMaskVisible=!1,t.$set(t.ipList,t.updateIndex,t.IPMaskForm))}))}),1e3,{leading:!0,trailing:!1}),handleIpDelete:l()((function(e){var t=this;if(e.ip&&(t.ipIds=[],t.ipIds.push(e)),0===t.ipIds.length)return t.$message.error(t.$t("gwsnSetting.noDeleteData"));for(var n=0;n<t.ipIds.length;n++)for(var s=0;s<t.ipList.length;s++)t.ipList[s].ip==t.ipIds[n].ip&&t.ipList.splice(s,1);t.storeIPList=t.ipList,t.$message.success(t.$t("gwsnSetting.deleteSuccess"))}),1e3,{leading:!0,trailing:!1}),stringToHex:function(e){for(var t=/[\u4E00-\u9FA5]/,n=[],s=0;s<e.length;s++){var i="";i=t.test(e.charAt(s))?encodeURI(e.charAt(s)).replace(/%/g,""):e.charCodeAt(s).toString(16),n.push(i)}return e=n.join(""),e},handleCreateVpnAccountSetChange:l()((function(){var e=this;e.resname="createVPNAccount",e.$hasPermission("socketList:vpn.do:websocket")?e.$confirm(e.$t("gwsnSetting.editIPPromptContent"),e.$t("gwsnSetting.prompt"),{confirmButtonText:e.$t("confirm"),cancelButtonText:e.$t("cancel"),type:"info"}).then((function(){e.$refs["vpnForm"].validate((function(t){if(!t)return!1;var n={gwsn:e.dataForm.sn,eth:e.vpnForm.eth,autoconnect:e.vpnForm.autoconnect,user:e.vpnForm.user,password:e.vpnForm.password,hub:e.vpnForm.hub,ipinfo:[]};e.ipList.length>0&&e.ipList.forEach((function(e){var t={ip:e.ip,mask:e.mask};n["ipinfo"].push(t)}));var s=Object(a["p"])(JSON.stringify(n));e.$nextTick((function(){e.wsUrl="socketList/vpn.do/"+e.stringToHex(s)+"/"+e.encryMD5List(),e.loading=!0,e.createWebSocket(),e.getMQTTTimer=setTimeout((function(){if(e.loading)return e.loading=!1,e.websocket&&(e.websocket.close(),e.websocket=null),e.getMQTTTimer&&(clearTimeout(e.getMQTTTimer),e.getMQTTTimer=null),e.$message.error(e.$t("issue.timeout"))}),"30000")}))}))})).catch((function(e){})):e.$message.warning("暂无创建VPN账户权限, 请联系管理员")}),1e3,{leading:!0,trailing:!1}),handleClose:function(){this.getMQTTTimer&&(clearTimeout(this.getMQTTTimer),this.getMQTTTimer=null),this.websocket&&this.websocket.readyState===WebSocket.OPEN&&(this.websocket.close(),this.websocket=null),this.vpnConfigVisible=!1}}},d=u,g=(n("90c2f"),n("2877")),h=Object(g["a"])(d,s,i,!1,null,"a5bb7406",null);t["default"]=h.exports}}]);