(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2172a7"],{c620:function(e,t,r){"use strict";r.r(t);r("7f7f");var a=function(){var e=this,t=e._self._c;return t("el-card",{attrs:{shadow:"never"}},[t("el-form",{attrs:{inline:!0},nativeOn:{submit:function(e){e.preventDefault()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.querySearch()}}},[t("el-form-item",{attrs:{label:e.$t("project.projectName")}},[t("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:e.handlePrjScroll,expression:"handlePrjScroll"}],attrs:{clearable:"",size:"small",disabled:!!e.isOpenMainMode,placeholder:e.$t("historyQuery.pleaseSelect")},on:{"visible-change":e.handlePrjVisibleChange,change:e.getGwsnList},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}},[[t("div",{staticStyle:{width:"100%",position:"absolute",left:"0",top:"0","z-index":"99","background-color":"#fff"}},[t("el-input",{ref:"prjInput",staticStyle:{width:"98%","margin-left":"1%","margin-top":"5px","margin-bottom":"5px"},attrs:{size:"small",clearable:"",placeholder:e.$t("gwsn.pleaseEnterSearchContent")},model:{value:e.prjSearch,callback:function(t){e.prjSearch=t},expression:"prjSearch"}})],1),t("div",{staticStyle:{width:"100%",height:"42px"}}),e._l(e.projectList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.prjName,value:e.id,disabled:!!e.hasOwnProperty("disabled")&&e.disabled}})}))]],2)],1),t("el-form-item",{attrs:{label:e.$t("historyQuery.gwsn")}},[t("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:e.handleGwsnScroll,expression:"handleGwsnScroll"}],attrs:{clearable:"",size:"small",disabled:!!e.isOpenMainMode,placeholder:e.$t("historyQuery.pleaseSelect")},on:{"visible-change":e.handleGwsnVisibleChange,change:e.selectGwsn},model:{value:e.dataForm.gwsn,callback:function(t){e.$set(e.dataForm,"gwsn",t)},expression:"dataForm.gwsn"}},[[t("div",{staticStyle:{width:"100%",position:"absolute",left:"0",top:"0","z-index":"99","background-color":"#fff"}},[t("el-input",{ref:"gwsnInput",staticStyle:{width:"98%","margin-left":"1%","margin-top":"5px","margin-bottom":"5px"},attrs:{size:"small",clearable:"",placeholder:e.$t("gwsn.pleaseEnterSearchContent")},model:{value:e.gwsnSearch,callback:function(t){e.gwsnSearch=t},expression:"gwsnSearch"}})],1),t("div",{staticStyle:{width:"100%",height:"42px"}}),e._l(e.gwsnList,(function(r){return t("el-option",{key:r.sn,attrs:{label:r.sn,value:r.value,disabled:!!r.hasOwnProperty("disabled")&&r.disabled}},[t("span",{staticStyle:{width:"200px",display:"inline-block","text-align":"left",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:r.sn}},[e._v("\n                            "+e._s(r.sn)+"\n                        ")]),t("span",{staticStyle:{color:"#8492a6","font-size":"13px",display:"inline-block","margin-left":"10px",width:"calc(100%- 210px)","text-align":"right",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:r.gwDesc}},[e._v("\n                            "+e._s(r.gwDesc||e.$t("historyQuery.no"))+"\n                        ")])])}))]],2)],1),t("el-form-item",[e.$hasPermission("integerFaces:select:permission.do")?t("el-button",{attrs:{size:"small",icon:"el-icon-search"},on:{click:function(t){return e.querySearch()}}},[e._v(e._s(e.$t("query")))]):e._e()],1),t("el-form-item",[e.isOpenMainMode?e._e():t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-video-play"},on:{click:function(t){return e.handleOpenMainMode()}}},[e._v(" "+e._s(e.$t("project.enableMaintenanceMode"))+" ")]),e.isOpenMainMode?t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-video-play"},on:{click:function(t){return e.recoverChannelStatus()}}},[e._v(" "+e._s(e.$t("project.turnOffMaintenanceMode"))+" ")]):e._e()],1),t("el-form-item",[e.isOpenMainMode?e._e():t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("project.pleaseEnableMaintenanceModeFirst"),placement:"top"}},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-setting"}},[e._v("\n                    "+e._s(e.$t("project.setSubDeviceParameters"))+"\n                ")])],1),e.isOpenMainMode?t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-setting"},on:{click:function(t){return e.setDeviceParam()}}},[e._v("\n                "+e._s(e.$t("project.setSubDeviceParameters"))+" ")]):e._e()],1),t("el-form-item",[e.isOpenMainMode?e._e():t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("project.pleaseEnableMaintenanceModeFirst"),placement:"top"}},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-refresh"}},[e._v(" "+e._s(e.$t("gwsn.refresh"))+" ")])],1),e.isOpenMainMode?t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-refresh"},on:{click:function(t){return e.refreshStatus()}}},[e._v("\n                "+e._s(e.$t("gwsn.refresh"))+" ")]):e._e()],1),t("el-form-item",[e.isOpenMainMode?e._e():t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("project.pleaseEnableMaintenanceModeFirst"),placement:"top"}},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-top"}},[e._v(" "+e._s(e.$t("gwsn.upgrade"))+" ")])],1),e.isOpenMainMode?t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-top"},on:{click:function(t){return e.upgradeDevice()}}},[e._v("\n                "+e._s(e.$t("gwsn.upgrade"))+" ")]):e._e()],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search",disabled:0==e.selectCOMList.length},on:{click:function(t){return e.searchHandler()}}},[e._v(" "+e._s(e.$t("search"))+" ")])],1),t("el-form-item",[e.$hasPermission("integerFaces:delete:permission.do")?t("el-button",{attrs:{size:"small",type:"danger",icon:"el-icon-delete",disabled:0==e.selectDeviceList.length},on:{click:function(t){return e.deleteDevice()}}},[e._v(" "+e._s(e.$t("delete"))+" ")]):e._e()],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataListLoading,expression:"dataListLoading"}],ref:"recordTable",staticStyle:{width:"100%"},attrs:{size:"small",data:e.dataList,border:"","max-height":e.scrollTableHeight,"row-key":"id","row-style":{height:"20px"},"cell-style":{padding:"2px"},"default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"}},on:{"selection-change":e.dataListSelectionHandle,"select-all":e.selectAllDataList}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{prop:"interface",label:e.$t("project.interfaceName"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.interface)+"\n            ")]}}])}),t("el-table-column",{attrs:{prop:"devId",label:e.$t("project.uniqueIdentifier"),width:"140",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.devId)+"\n            ")]}}])}),t("el-table-column",{attrs:{prop:"devModel",label:e.$t("project.deviceModel"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.devModel)+"\n            ")]}}])}),t("el-table-column",{attrs:{prop:"devAddr",label:e.$t("project.deviceAddress"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.devAddr)+"\n            ")]}}])}),t("el-table-column",{attrs:{prop:"devSource",label:e.$t("project.deviceSource"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(1==t.row.devSource?e.$t("project.manualAddition"):0==t.row.devSource?e.$t("search"):"")+"\n            ")]}}])}),t("el-table-column",{attrs:{prop:"devVer",label:e.$t("project.mainVersionNumber"),width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.devVer)+"\n            ")]}}])}),t("el-table-column",{attrs:{prop:"devSubVer",label:e.$t("project.minorVersionNumber"),width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.devSubVer)+"\n            ")]}}])}),t("el-table-column",{attrs:{prop:"devStatus",label:e.$t("project.currentStatus"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[r.row.devId||r.row.devAddr?e._e():t("span"),r.row.devId||r.row.devAddr?t("span",[e._v(e._s(0==r.row.devStatus?e.$t("project.init"):1==r.row.devStatus?e.$t("project.searching"):2==r.row.devStatus?e.$t("project.erasing"):3==r.row.devStatus?e.$t("project.upgrading"):4==r.row.devStatus?e.$t("domainInfo.complete"):5==r.row.devStatus?e.$t("logOperation.status0"):6==r.row.devStatus?e.$t("project.eraseFailed"):7==r.row.devStatus?e.$t("project.settingParameters"):8==r.row.devStatus?e.$t("project.settingParametersSuccess"):9==r.row.devStatus?e.$t("project.settingParametersFailed"):""))]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"devprogress",label:e.$t("project.currentProgress"),align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(r){return[r.row.devId||r.row.devAddr?t("el-progress",{attrs:{percentage:r.row.devprogress,color:e.customColorMethod,"text-inside":!0,"stroke-width":20}}):e._e()]}}])}),t("el-table-column",{attrs:{label:e.$t("handle"),align:"center",fixed:"right","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(r){return[r.row.devId||r.row.devAddr||!e.$hasPermission("integerFaces:insert:permission.do")?e._e():t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handAdd(r.$index,r.row)}}},[e._v(e._s(e.$t("gwsnSetting.add"))+" | ")]),r.row.devId||r.row.devAddr?e._e():t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.searchHandler(r.$index,r.row)}}},[e._v(e._s(e.$t("search"))+" | ")]),r.row.devId||r.row.devAddr?e._e():t("el-button",{attrs:{type:"text",disabled:""},on:{click:function(t){return e.refreshStatus(r.$index,r.row)}}},[e._v(e._s(e.$t("gwsn.refresh"))+" ")]),(r.row.devId||r.row.devAddr)&&e.$hasPermission("integerFaces:update:permission.do")?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.editDevice(r.$index,r.row)}}},[e._v(e._s(e.$t("update"))+" ")]):e._e(),(r.row.devId||r.row.devAddr)&&e.$hasPermission("integerFaces:delete:permission.do")?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.deleteDevice(r.$index,r.row)}}},[e._v(e._s(e.$t("delete"))+" ")]):e._e(),r.row.devId||r.row.devAddr?t("el-button",{attrs:{type:"text",disabled:!e.isOpenMainMode},on:{click:function(t){return e.upgradeDevice(r.$index,r.row)}}},[e._v(e._s(e.$t("gwsn.upgrade"))+" ")]):e._e()]}}])})],1),t("el-dialog",{attrs:{title:e.$t("project.addSubDevice"),visible:e.addDeviceVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.addDeviceVisible=t}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.addDeviceloading,expression:"addDeviceloading"}],ref:"addDeviceForm",attrs:{model:e.addDeviceForm,rules:e.rules,"label-width":"en-US"===e.$i18n.locale?"150px":"100px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addDeviceFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.addNumber"),prop:"count"}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("project.addNumber"),clearable:""},model:{value:e.addDeviceForm.count,callback:function(t){e.$set(e.addDeviceForm,"count",t)},expression:"addDeviceForm.count"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.startValue"),prop:"startvalue"}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("project.startValue"),clearable:""},model:{value:e.addDeviceForm.startvalue,callback:function(t){e.$set(e.addDeviceForm,"startvalue",t)},expression:"addDeviceForm.startvalue"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.step"),prop:"step"}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("project.step"),clearable:""},model:{value:e.addDeviceForm.step,callback:function(t){e.$set(e.addDeviceForm,"step",t)},expression:"addDeviceForm.step"}})],1)],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:function(t){e.addDeviceVisible=!1}}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addDeviceFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2),t("el-dialog",{attrs:{title:e.$t("project.enableMaintenanceMode")+"("+e.selectedGwsn+"_"+(e.selectedDesc?e.selectedDesc:e.$t("gwsn.noDesc"))+")",visible:e.openMainModeVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleMainModeClose},on:{"update:visible":function(t){e.openMainModeVisible=t}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.openMainModeLoading,expression:"openMainModeLoading"}],ref:"openMainModeForm",attrs:{model:e.openMainModeForm,"label-width":"en-US"===e.$i18n.locale?"170px":"100px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.openMainModeFormSubmitHandle()}}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-table",{ref:"mainModeListTable",staticStyle:{width:"100%"},attrs:{data:e.openMainModeForm.mainModeList,border:"","row-key":"interface","max-height":"400","row-style":{height:"20px"},"cell-style":{padding:"2px"}},on:{"selection-change":e.mainModeListSelectionHandle}},[t("el-table-column",{attrs:{type:"selection","header-align":"center",align:"center",width:"50","reserve-selection":!0}}),t("el-table-column",{attrs:{label:e.$t("project.interfaceName"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                "+e._s(t.row.interface)+"\n                            ")]}}])}),t("el-table-column",{attrs:{label:e.$t("channelInfo.baud"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",size:"small",placeholder:e.$t("channelInfo.pleaseSelect")},model:{value:r.row.baud,callback:function(t){e.$set(r.row,"baud",t)},expression:"scope.row.baud"}},e._l(e.baudList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),t("el-table-column",{attrs:{label:e.$t("channelInfo.data_bit"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",size:"small",placeholder:e.$t("channelInfo.pleaseSelect")},model:{value:r.row.data_bit,callback:function(t){e.$set(r.row,"data_bit",t)},expression:"scope.row.data_bit"}},e._l(e.data_bitList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),t("el-table-column",{attrs:{label:e.$t("channelInfo.stop_bit"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",size:"small",placeholder:e.$t("channelInfo.pleaseSelect")},model:{value:r.row.stop_bit,callback:function(t){e.$set(r.row,"stop_bit",t)},expression:"scope.row.stop_bit"}},e._l(e.stopbitList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),t("el-table-column",{attrs:{label:e.$t("channelInfo.check_bit"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",size:"small",placeholder:e.$t("channelInfo.pleaseSelect")},model:{value:r.row.check_bit,callback:function(t){e.$set(r.row,"check_bit",t)},expression:"scope.row.check_bit"}},e._l(e.checkbitList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])})],1)],1)],1),t("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.maintenanceAgreement")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",size:"small",placeholder:e.$t("channelInfo.pleaseSelect")},model:{value:e.openMainModeForm.mode,callback:function(t){e.$set(e.openMainModeForm,"mode",t)},expression:"openMainModeForm.mode"}},e._l(e.modeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleMainModeClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.openMainModeFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2),t("el-dialog",{attrs:{title:e.$t("gwsn.upgrade")+"("+e.selectedGwsn+"_"+(e.selectedDesc?e.selectedDesc:"")+")",visible:e.upgradeVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleUpgradeClose},on:{"update:visible":function(t){e.upgradeVisible=t}}},[t("el-form",{ref:"upgradeForm",attrs:{model:e.upgradeForm,rules:e.upgradeRules,"label-width":"en-US"===e.$i18n.locale?"150px":"100px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.upgradeFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.currentDeviceVersion")}},[t("el-input",{attrs:{clearable:"",size:"small",type:"textarea",readOnly:"",autosize:{minRows:2,maxRows:4},placeholder:e.$t("project.pleaseEnter")},model:{value:e.upgradeForm.currentVersion,callback:function(t){e.$set(e.upgradeForm,"currentVersion",t)},expression:"upgradeForm.currentVersion"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("upgrade.targetVersion"),prop:"targetVersion"}},[t("el-select",{attrs:{size:"small",filterable:"",placeholder:e.$t("attribute.placeholderSelect")},model:{value:e.upgradeForm.targetVersion,callback:function(t){e.$set(e.upgradeForm,"targetVersion",t)},expression:"upgradeForm.targetVersion"}},e._l(e.versionList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.fileVersion,value:e.fileUrl}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.retryCount"),prop:"count"}},[t("el-checkbox",{attrs:{size:"small"},model:{value:e.upgradeForm.checked,callback:function(t){e.$set(e.upgradeForm,"checked",t)},expression:"upgradeForm.checked"}},[e._v(e._s(e.$t("project.upgradeFailedAndRetry")))]),t("el-input",{staticStyle:{width:"100px",margin:"0 5px"},attrs:{clearable:"",size:"small"},model:{value:e.upgradeForm.count,callback:function(t){e.$set(e.upgradeForm,"count",t)},expression:"upgradeForm.count"}}),e._v("\n                        次\n                    ")],1)],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleUpgradeClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.upgradeFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2),t("el-dialog",{attrs:{title:e.$t("project.modifySubDevices"),visible:e.editDeviceVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.editDeviceVisible=t}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.editDeviceLoading,expression:"editDeviceLoading"}],ref:"editDeviceForm",attrs:{model:e.editDeviceForm,rules:e.editRules,"label-width":"en-US"===e.$i18n.locale?"150px":"100px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.editDeviceFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("gwsn.number"),prop:"gwSn"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",placeholder:e.$t("attribute.placeholderSelect"),disabled:""},model:{value:e.editDeviceForm.gwSn,callback:function(t){e.$set(e.editDeviceForm,"gwSn",t)},expression:"editDeviceForm.gwSn"}},e._l(e.gwsnList,(function(r){return t("el-option",{key:r.gwSn,attrs:{label:r.gwSn,value:r.gwSn}},[t("span",{staticStyle:{width:"100px",display:"inline-block","text-align":"left",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:r.gwSn}},[e._v(e._s(r.gwSn))]),t("span",{staticStyle:{color:"#8492a6","font-size":"13px",display:"inline-block",width:"100px","text-align":"right",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:r.gwDesc}},[e._v(e._s(r.gwDesc||e.$t("historyQuery.no")))])])})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.belongingToSerialPort"),prop:"interfaces"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",placeholder:e.$t("attribute.placeholderSelect"),disabled:""},model:{value:e.editDeviceForm.interfaces,callback:function(t){e.$set(e.editDeviceForm,"interfaces",t)},expression:"editDeviceForm.interfaces"}},e._l(e.comList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.uniqueIdentifier"),prop:"devId"}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("project.uniqueIdentificationOfSubDevicesWhichCanBeAddressesSerialNumbersEtc"),clearable:""},model:{value:e.editDeviceForm.devId,callback:function(t){e.$set(e.editDeviceForm,"devId",t)},expression:"editDeviceForm.devId"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.deviceModel"),prop:"devModel"}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("project.pleaseEnter"),clearable:""},model:{value:e.editDeviceForm.devModel,callback:function(t){e.$set(e.editDeviceForm,"devModel",t)},expression:"editDeviceForm.devModel"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.equipmentRemarks"),prop:"devName"}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("project.pleaseEnter"),clearable:""},model:{value:e.editDeviceForm.devName,callback:function(t){e.$set(e.editDeviceForm,"devName",t)},expression:"editDeviceForm.devName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.deviceAddress"),prop:"devAddr"}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("project.pleaseEnter"),clearable:""},model:{value:e.editDeviceForm.devAddr,callback:function(t){e.$set(e.editDeviceForm,"devAddr",t)},expression:"editDeviceForm.devAddr"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.mainVersionNumber"),prop:"devVer"}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("project.pleaseEnter"),clearable:""},model:{value:e.editDeviceForm.devVer,callback:function(t){e.$set(e.editDeviceForm,"devVer",t)},expression:"editDeviceForm.devVer"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.minorVersionNumber"),prop:"devSubVer"}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("project.pleaseEnter"),clearable:""},model:{value:e.editDeviceForm.devSubVer,callback:function(t){e.$set(e.editDeviceForm,"devSubVer",t)},expression:"editDeviceForm.devSubVer"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.deviceStatus"),prop:"devStatus"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",placeholder:e.$t("attribute.placeholderSelect")},model:{value:e.editDeviceForm.devStatus,callback:function(t){e.$set(e.editDeviceForm,"devStatus",t)},expression:"editDeviceForm.devStatus"}},e._l(e.devStatusList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:function(t){e.editDeviceVisible=!1}}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.editDeviceFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2),t("el-dialog",{attrs:{title:e.$t("project.searchForSubDevices")+"("+e.selectedGwsn+"_"+(e.selectedDesc?e.selectedDesc:"")+")",visible:e.searchVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.searchVisible=t}}},[t("el-form",{ref:"searchForm",attrs:{model:e.searchForm,rules:e.searchRules,"label-width":"en-US"===e.$i18n.locale?"150px":"100px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("channelInfo.com"),prop:"coms"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",multiple:"","collapse-tags":"",disabled:"",placeholder:e.$t("attribute.placeholderSelect")},model:{value:e.searchForm.coms,callback:function(t){e.$set(e.searchForm,"coms",t)},expression:"searchForm.coms"}},e._l(e.comList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.interfaceType"),prop:"type"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",disabled:"",placeholder:e.$t("attribute.placeholderSelect")},model:{value:e.searchForm.type,callback:function(t){e.$set(e.searchForm,"type",t)},expression:"searchForm.type"}},e._l(e.typeList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("protocol.maintenanceAgreement"),prop:"protocol"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",placeholder:e.$t("attribute.placeholderSelect"),disabled:""},model:{value:e.searchForm.protocol,callback:function(t){e.$set(e.searchForm,"protocol",t)},expression:"searchForm.protocol"}},e._l(e.modeList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("channelInfo.timeout"),prop:"timeout"}},[t("el-input",{attrs:{clearable:"",size:"small",placeholder:e.$t("channelInfo.enterTimeout"),onkeyup:"value=value.replace(/[^\\d]/g,'');"},on:{change:e.handleTimeout},model:{value:e.searchForm.timeout,callback:function(t){e.$set(e.searchForm,"timeout",t)},expression:"searchForm.timeout"}},[t("template",{slot:"append"},[e._v("ms")])],2)],1)],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:function(t){e.searchVisible=!1}}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.searchFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2),t("el-dialog",{attrs:{title:e.$t("project.setSubDeviceParameters")+"("+e.selectedGwsn+"_"+(e.selectedDesc?e.selectedDesc:"")+")",visible:e.setDeviceParamVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.setDeviceParamVisible=t}}},[t("el-form",{ref:"setDeviceParamForm",attrs:{model:e.setDeviceParamForm,rules:e.setDeviceParamRules,"label-width":"en-US"===e.$i18n.locale?"150px":"100px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.setDeviceParamFormSubmitHandle()}}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.maintenanceAgreement"),prop:"protocol"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",disabled:"",placeholder:e.$t("attribute.placeholderSelect")},on:{change:e.getGuidList},model:{value:e.setDeviceParamForm.protocol,callback:function(t){e.$set(e.setDeviceParamForm,"protocol",t)},expression:"setDeviceParamForm.protocol"}},e._l(e.deviveModeList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("project.functionDescription"),prop:"paramIndex"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",placeholder:e.$t("attribute.placeholderSelect")},model:{value:e.setDeviceParamForm.paramIndex,callback:function(t){e.$set(e.setDeviceParamForm,"paramIndex",t)},expression:"setDeviceParamForm.paramIndex"}},e._l(e.paramIndexList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.description,value:e.FuncCode}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("channelInfo.timeout"),prop:"timeout"}},[t("el-input",{attrs:{clearable:"",size:"small",placeholder:e.$t("channelInfo.enterTimeout"),onkeyup:"value=value.replace(/[^\\d]/g,'');"},on:{change:e.handleSetDeviceParamTimeout},model:{value:e.setDeviceParamForm.timeout,callback:function(t){e.$set(e.setDeviceParamForm,"timeout",t)},expression:"setDeviceParamForm.timeout"}},[t("template",{slot:"append"},[e._v("ms")])],2)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.setDeviceParamForm.dataList,border:"","max-height":"400","row-style":{height:"20px"},"cell-style":{padding:"3px"}}},[t("el-table-column",{attrs:{label:e.$t("project.uniqueIdentifier"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                "+e._s(t.row.devId)+"\n                            ")]}}])}),t("el-table-column",{attrs:{label:e.$t("project.deviceSourceAddress"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                "+e._s(t.row.devAddr)+"\n                            ")]}}])}),t("el-table-column",{attrs:{label:e.$t("project.targetAddress"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"dataList."+r.$index+".targetAddr","label-width":"0",rules:e.setDeviceParamRules.targetAddr}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("project.pleaseEnter")},model:{value:r.row.targetAddr,callback:function(t){e.$set(r.row,"targetAddr",t)},expression:"scope.row.targetAddr"}})],1)],1)],1)]}}])}),t("el-table-column",{attrs:{label:e.$t("project.belongingToSerialPort"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                "+e._s(t.row.interfaces)+"\n                            ")]}}])}),t("el-table-column",{attrs:{label:e.$t("project.mainVersionNumber"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                "+e._s(t.row.devVer)+"\n                            ")]}}])})],1)],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:function(t){e.setDeviceParamVisible=!1}}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.setDeviceParamFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)],1)},s=[],n=(r("ac4d"),r("8a81"),r("8e6e"),r("456d"),r("96cf"),r("1da1")),i=(r("4f7f"),r("5df3"),r("1c4c"),r("53ca")),o=(r("ac6a"),r("6b54"),r("28a5"),r("ade3")),l=(r("c5f6"),r("a481"),r("4328")),c=r.n(l),d=r("b047"),u=r.n(d),m=r("ed08");function p(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=v(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,s=function(){};return{s:s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,n=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw n}}}}function v(e,t){if(e){if("string"==typeof e)return f(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=Array(t);r<t;r++)a[r]=e[r];return a}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){Object(o["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var b={directives:{loadmore:{inserted:function(e,t){var r=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");r.addEventListener("scroll",(function(){var e=this.scrollHeight-Math.ceil(this.scrollTop)<=this.clientHeight;e&&0!==this.scrollTop&&t.value()}))}}},data:function(){var e=this;return{wsUrl:"",total:0,resname:"",resultCount:0,retryCount:0,isSingle:!1,selectCOMList:[],selectDeviceList:[],selectedGwsn:"",selectedDesc:"",selectedModel:"",handAddObj:null,sdTimer:null,getCycleTimer:null,websocket:null,lockReconnect:!1,isOpenMainMode:!1,searchTimeOutTimer:null,setparamTimer:null,openMainModeVisible:!1,openMainModeLoading:!1,addDeviceVisible:!1,dataListLoading:!1,upgradeVisible:!1,upgradeMulitipeVisible:!1,addDeviceloading:!1,editDeviceLoading:!1,searchVisible:!1,searchForm:{coms:[],type:1,protocol:"",timeout:3e4},upgradeForm:{currentVersion:"",targetVersion:"",checked:!1,count:3},versionList:[],setDeviceParamVisible:!1,paramIndexList:[],setDeviceParamForm:{protocol:"",paramIndex:"",timeout:3e4,dataList:[]},dataForm:{name:"",gwsn:""},typeList:[{label:this.$t("project.ethernetPort"),value:0},{label:this.$t("channelInfo.com"),value:1}],rangeNumber:50,prjPage:1,prjTotal:0,prjSearch:"",gwsnPage:1,gwsnTotal:0,projectList:[],storeGwsnMap:{},gwsnSearch:"",gwsnList:[],dataList:[],comList:[],multipleSelectionAll:[],selectedComList:[],addDeviceForm:{count:1,startvalue:1,step:1},editDeviceVisible:!1,editDeviceForm:{gwSn:"",interfaces:"",devId:"",devModel:"",devName:"",devAddr:"",devSource:1,devVer:"",devSubVer:"",devStatus:0},devStatusList:[{label:this.$t("schedule.status1"),value:0},{label:this.$t("project.underMaintenance"),value:1},{label:this.$t("project.upgrading"),value:2}],openMainModeForm:{mainModeList:[],mode:""},modeList:[],deviveModeList:[],baudList:[{label:"300",value:300},{label:"600",value:600},{label:"1200",value:1200},{label:"2400",value:2400},{label:"4800",value:4800},{label:"9600",value:9600},{label:"19200",value:19200},{label:"38400",value:38400},{label:"57600",value:57600},{label:"115200",value:115200}],data_bitList:[{label:5,value:5},{label:6,value:6},{label:7,value:7},{label:8,value:8}],checkbitList:[{label:this.$t("channelInfo.nocheck"),value:0},{label:this.$t("channelInfo.oddcheck"),value:1},{label:this.$t("channelInfo.evencheck"),value:2}],stopbitList:[{label:1,value:1},{label:2,value:2}],scrollTableHeight:window.innerHeight-220-53,rules:{count:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{pattern:/^[1-9]\d*/,message:this.$t("channelInfo.enterIntNumber")}],startvalue:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{pattern:/^[1-9]\d*/,message:this.$t("channelInfo.enterIntNumber")}],step:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{validator:function(t,r,a){if(r){var s=/^[-]?[1-9]$/;s.test(r)?a():a(new Error(e.$t("chlwatch.pleaseEnterIntNumber")))}},trigger:"change"}]},editRules:{devAddr:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{pattern:/^[0-9]\d*/,message:this.$t("chlwatch.pleaseEnterIntNumber")}]},upgradeRules:{count:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{pattern:/^[1-9]\d*/,message:this.$t("channelInfo.enterIntNumber")}],targetVersion:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]},searchRules:{coms:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],type:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],protocol:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],timeout:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{pattern:/^[1-9]\d*/,message:this.$t("channelInfo.enterIntNumber")}]},setDeviceParamRules:{protocol:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],paramIndex:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],timeout:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{pattern:/^[1-9]\d*/,message:this.$t("channelInfo.enterIntNumber")}],targetAddr:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{getPrjNameList:function(){var e=this,t={page:e.prjPage,limit:50,priName:e.prjSearch.replace(/\s+/g,""),_t:(new Date).getTime()};e.$hasPermission("tprjinfo:list:select")?e.$http.get("/info/tprjinfo/tprjinfoList",{params:t}).then((function(t){var r=t.data;if(r.hasOwnProperty("code")&&0!=r.code)return e.$message.error(r.data||r.msg);e.prjTotal=Number(r.total),1==e.prjPage?e.projectList=r.list:e.projectList=e.projectList.concat(r.list),0==e.projectList.length&&e.projectList.push({id:e.$t("noMatchingDataYet"),prjName:e.$t("noMatchingDataYet"),disabled:!0})})).catch((function(e){return!1})):e.$message.warning("暂无项目查询权限, 请联系管理员")},handlePrjVisibleChange:function(e){var t=this;e&&this.$nextTick((function(){t.$refs.prjInput.focus()}))},handleGwsnVisibleChange:function(e){var t=this;e&&this.$nextTick((function(){t.$refs.gwsnInput.focus()}))},handlePrjScroll:function(){this.projectList.length<this.prjTotal&&(this.prjPage++,this.getPrjNameList())},getGwsnList:function(){var e=this,t=!1,r={pageNum:e.gwsnPage,pageSize:200,prjId:e.dataForm.name,fuzzy:e.gwsnSearch,_t:(new Date).getTime()};e.$hasPermission("gwbaseinfo:select:permission.do")?e.$http.post("/info/gwbaseinfo/selectByPage.do",c.a.stringify(r)).then((function(r){var a=r.data;if(0!=a.code)return e.$message.error(a.data||a.msg),!1;if(1==e.gwsnPage?e.gwsnList=a.data.list.map((function(e){return g(g({},e),{value:e.modelr?e.sn+"_"+e.modelr+e.gwDesc:e.sn+"_"+e.model+e.gwDesc})})):e.gwsnList=e.gwsnList.concat(a.data.list.map((function(e){return g(g({},e),{value:e.modelr?e.sn+"_"+e.modelr+e.gwDesc:e.sn+"_"+e.model+e.gwDesc})}))),0==e.gwsnList.length)t=!1,e.gwsnList.push({sn:e.$t("noMatchingDataYet"),gwDesc:e.$t("noMatchingDataYet"),disabled:!0});else if(e.dataForm.gwsn)for(var s=0;s<e.gwsnList.length;s++){var n=e.gwsnList[s];if(e.dataForm.gwsn==n.sn){t=!0;break}}e.gwsnTotal=Number(a.data.total),e.$nextTick((function(){t||(e.dataForm.gwsn="",e.dataList=[])}))})).catch((function(e){return!1})):e.$message.warning("暂无网关查询权限, 请联系管理员")},handleGwsnScroll:function(){this.gwsnList.length<this.gwsnTotal&&(this.gwsnPage++,this.getGwsnList())},selectGwsn:function(e){this.selectedComList=[],this.selectedGwsn=e.split("_")[0],this.selectedModel=e.split("_")[1],this.selectedDesc=e.split("_")[2]},encryMD5:function(e){var t=this.$randomStrFun();return this.$md5(t+e)+"/"+String(parseInt((new Date).getTime().toString().substring(0,10)))},encryMD5List:function(){var e=this.$randomStrFun();return this.$md5(e)+"/"+String(parseInt((new Date).getTime().toString().substring(0,10)))},querySearchCOM:function(e){var t=this,r={};if(!t.selectedGwsn)return t.$message.warning(this.$t("project.pleaseSelectTheGatewayFirstBeforeConductingTheQuery"));t.comList=[],r["gwsn"]=t.selectedGwsn,r["model"]=t.selectedModel,t.$hasPermission("integerFaces:select:permission.do")?t.$nextTick((function(){t.$http.get("/info/integerFaces/info",{params:r}).then((function(r){var a=r.data;if(0!=a.code)return t.$message.error(a.data||a.msg);if(t.total=a.data.total,a.data&&a.data.dataMsg.length>0){var s=a.data.dataMsg;s.forEach((function(e){var r={label:e.interface,value:e.interface};t.comList.push(r)})),e()}})).catch((function(e){return!1}))})):t.$message.warning("暂无权限, 请联系管理员")},querySearch:function(){var e=this,t="",r={};if(!e.selectedGwsn)return e.$message.warning(e.$t("project.pleaseSelectTheGatewayFirstBeforeConductingTheQuery"));e.$hasPermission("integerFaces:select:permission.do")?(r["gwsn"]=e.selectedGwsn,r["model"]=e.selectedModel,e.selectedComList.length>0&&(e.selectedComList.forEach((function(e){t+=e.interface+","})),r["listCom"]=t.substring(0,t.length-1)),e.dataListLoading=!0,e.$nextTick((function(){e.$http.get("/info/integerFaces/info",{params:r}).then((function(t){var r=t.data;if(0!=r.code)return e.$message.error(r.data||r.msg);if(e.total=r.data.total,r.data&&r.data.dataMsg.length>0){var a=r.data.dataMsg,s=[];a.forEach((function(t){var r={id:"-"+t.interface.replace(/[^0-9]/gi,""),interface:t.interface,devName:"",devId:"",devAddr:"",devVer:"",devSubVer:"",devStatus:null,devprogress:0,devSource:null,gwModel:e.selectedModel,children:t.children};s.push(r)})),e.dataList=s,e.dataListLoading=!1,e.$refs.recordTable&&e.$refs.recordTable.doLayout&&e.$refs.recordTable.doLayout()}})).catch((function(e){return!1}))}))):e.$message.warning("暂无权限, 请联系管理员")},handAdd:function(e,t){this.handAddObj=t,this.addDeviceVisible=!0},searchHandler:function(e,t){var r=this;if(!r.isOpenMainMode)return r.$message.warning(r.$t("project.pleaseEnableMaintenanceModeFirst")+"!!!");r.$hasPermission("integerFaces:insert:permission.do")?r.$hasPermission("integerFaces:update:permission.do")?(r.searchForm.coms=[],r.getSearchProtocol(),r.$nextTick((function(){r.querySearchCOM((function(){t?r.searchForm.coms.push(t.interface):r.selectedComList.forEach((function(e){r.searchForm.coms.push(e.interface)})),r.searchVisible=!0}))}))):r.$message.warning("暂无子设备修改权限, 请联系管理员"):r.$message.warning("暂无子设备新增权限, 请联系管理员")},getSearchProtocol:function(){var e=this,t={attribute:2};e.modeList=[],e.$hasPermission("protocolinfo:select:permission.do")?e.$http.get("/info/protocolinfo/proGuidAll",{params:t}).then((function(t){var r=t.data;if(0!=r.code)return e.$message.error(r.data||r.msg);r.data.length>0&&(r.data.forEach((function(t){var r={label:t.manuf,value:t.libname};e.modeList.push(r)})),e.searchForm.protocol=e.openMainModeForm.mode)})).catch((function(e){return!1})):e.$message.warning("暂无协议查询权限, 请联系管理员")},handleTimeout:function(e){e<3e3?this.searchForm.timeout=3e3:e>18e4&&(this.searchForm.timeout=18e5)},searchFormSubmitHandle:function(){var e=this,t=[];e.$refs["searchForm"].validate((function(r){if(!r)return!1;e.searchForm.coms.forEach((function(r){var a={gwsn:e.selectedGwsn,index:r.replace(/[^0-9]/gi,""),protocol:e.searchForm.protocol,timeout:Number(e.searchForm.timeout),type:e.searchForm.type};t.push(a)})),e.resname="search";var a=Object(m["p"])(JSON.stringify(t));e.$nextTick((function(){e.searchVisible=!1,e.wsUrl="socketList/searchs/"+Object(m["q"])(a)+"/"+e.encryMD5List(),e.lockReconnect||e.createWebSocket()}))}))},editDevice:function(e,t){var r=this;this.$hasPermission("integerFaces:update:permission.do")?this.$hasPermission("integerFaces:select:permission.do")?(this.editDeviceVisible=!0,this.$http.get("/info/integerFaces/".concat(t.id),{params:{id:t.id}}).then((function(e){var t=e.data;if(0!=t.code)return r.$message.error(t.data||t.msg);r.editDeviceForm=g(g({},r.editDeviceForm),t.data)})).catch((function(e){return!1}))):this.$message.warning("暂无子设备查询权限, 请联系管理员"):this.$message.warning("暂无子设备修改权限, 请联系管理员")},editDeviceFormSubmitHandle:function(){var e=this;e.$refs["editDeviceForm"].validate((function(t){t&&(e.$hasPermission("integerFaces:update:permission.do")?(e.editDeviceLoading=!0,e.$http.put("/info/integerFaces",e.editDeviceForm).then((function(t){var r=t.data;return 0!=r.code?(e.editDeviceLoading=!1,e.$message.error(r.data||r.msg)):(e.editDeviceLoading=!1,e.editDeviceVisible=!1,e.querySearch(),e.$message.success(r.msg))})).catch((function(t){return e.editDeviceLoading=!1,!1}))):e.$message.warning("暂无子设备修改权限, 请联系管理员"))}))},deleteDevice:function(e,t){var r=this,a=[],s={};if(e&&t)s["ids"]=t.id;else{if(0==r.selectDeviceList.length)return r.$message.warning(this.$t("project.pleaseSelectTheDataToBeDeleted"));r.selectDeviceList.forEach((function(e){a.push(e.id)})),s["ids"]=a.join(",")}r.$hasPermission("integerFaces:delete:permission.do")?r.$confirm(r.$t("deleteInfo.noticeTitle"),r.$t("deleteInfo.noticePrompt"),{confirmButtonText:r.$t("deleteInfo.confirm"),cancelButtonText:r.$t("deleteInfo.cancel"),type:"warning"}).then((function(){r.dataListLoading=!0,r.$http.delete("/info/integerFaces",{params:s}).then((function(e){var t=e.data;if(0!=t.code)return r.dataListLoading=!1,r.$message.error(t.data||r.$t("deleteInfo.deleteFail"));r.$message.success(r.$t("deleteInfo.deleteSuccess")),r.dataListLoading=!1,r.querySearch()})).catch((function(e){return r.dataListLoading=!1,!1}))})).catch((function(e){})):r.$message.warning("暂无子设备删除权限, 请联系管理员")},createWebSocket:function(){var e=this;if(!("WebSocket"in window))return e.$message.error(e.$t("websocket.notSupportWebsocket"));try{var t=window.SITE_CONFIG["socketUrl"]+e.wsUrl+"?token="+e.$getToken();e.websocket=new WebSocket(t),e.initWebSocket()}catch(r){e.reConnect()}},initWebSocket:function(){this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onmessage=this.websocketonmessage,this.websocket.onclose=this.websocketonclose},websocketonopen:function(){this.lockReconnect=!0},websocketonerror:function(e){this.lockReconnect=!1},isJsonString:function(e){if("string"===typeof e)try{var t=JSON.parse(e);return!("object"!==Object(i["a"])(t)||!t)}catch(r){return!1}},websocketonmessage:function(e){var t=this;if(!this.isJsonString(e.data))return!1;this.getMQTTTimer&&(clearTimeout(this.getMQTTTimer),this.getMQTTTimer=null),"setchlstatus"!=this.resname&&"maintain"!=this.resname&&"setchlstatusCB"!=this.resname&&"setchlstatusC"!=this.resname&&"getstatus"!=this.resname&&"getstatusCStatus"!=this.resname||this.websocket&&(this.websocket.close(),this.websocket=null),this.$nextTick((function(){if("setchlstatus"==t.resname&&"setchlstatus"==JSON.parse(e.data).res_name)1==JSON.parse(e.data).res_content.received&&t.setMaintainMode();else if("maintain"==t.resname&&"maintain"==JSON.parse(e.data).res_name)1==JSON.parse(e.data).res_content.received&&t.setComProtocol();else if("setcom"==t.resname&&"setcom"==JSON.parse(e.data).res_name){if(JSON.parse(e.data).res_content.err_code)return!1;t.resultCount=0;var r=!0,a=JSON.parse(e.data).res_content.results;if(a.length>0){var s,n=p(a);try{for(n.s();!(s=n.n()).done;){var i=s.value;1!=i.result?r=!1:t.resultCount++}}catch(X){n.e(X)}finally{n.f()}}t.$nextTick((function(){return r&&t.resultCount==t.selectedComList.length?(t.isOpenMainMode=!0,t.openMainModeLoading=!1,t.openMainModeVisible=!1,t.websocket&&(t.websocket.close(),t.websocket=null),t.$message.success(t.$t("subDeviceUpgrade.openSerialPortMaintenanceSuccessfully")),t.querySearch()):(t.isOpenMainMode=!1,t.openMainModeLoading=!1,t.websocket&&(t.websocket.close(),t.websocket=null),t.$message.error(t.$t("subDeviceUpgrade.openSerialPortMaintenanceFailed")))}))}else if("downfile"==t.resname&&"downfile"==JSON.parse(e.data).res_name){var o=JSON.parse(e.data).res_content,l=Math.floor(o.downloaded_size/o.total_size*10)/10*100;100==l&&(t.websocket&&(t.websocket.close(),t.websocket=null),t.$nextTick((function(){t.upgradeConfirm()})))}else if("upgrade"==t.resname&&"upgrade"==JSON.parse(e.data).res_name){t.resultCount=0;var c=!0,d=JSON.parse(e.data).res_content.results;if(d.length>0){var u,m=p(d);try{for(m.s();!(u=m.n()).done;){var v=u.value;0!=v.result?c=!1:t.resultCount++}}catch(X){m.e(X)}finally{m.f()}}t.$nextTick((function(){return c&&t.resultCount==t.selectDeviceList.length?(t.upgradeVisible=!1,t.refresh(),t.$message.success(t.$t("subDeviceUpgrade.addingUpgradeTaskSuccessfully"))):(t.upgradeVisible=!1,t.$message.error(t.$t("subDeviceUpgrade.addingUpgradeTaskFailed")))}))}else if("getstatus"==t.resname&&"getstatus"==JSON.parse(e.data).res_name){if(JSON.parse(e.data).err_code)return!1;t.resultCount=0,t.retryCount=0;var f=JSON.parse(e.data).res_content.results;if(f.length>0){var h,g=p(t.dataList);try{for(g.s();!(h=g.n()).done;){var b,w=h.value,$=p(f);try{for($.s();!(b=$.n()).done;){var S=b.value;if(w.children&&w.children.length>0){var y,k=p(w.children);try{for(k.s();!(y=k.n()).done;){var _=y.value;if(-1!=_.interfaces.indexOf(S.com_index)&&_.devAddr==S.dev_addr)if(t.$set(_,"devprogress",Math.round(100*S.dev_progress)/100),t.$set(_,"devStatus",S.dev_status),5==S.dev_status||6==S.dev_status||9==S.dev_status){if(t.resultCount++,t.resultCount==t.selectDeviceList.length)return t.sdTimer&&(clearInterval(t.sdTimer),t.sdTimer=null),t.websocket&&(t.websocket.close(),t.websocket=null),t.$message.success(t.$t("subDeviceUpgrade.equipmentUpgradeCompleted"))}else if(100==S.dev_progress)return t.sdTimer&&(clearInterval(t.sdTimer),t.sdTimer=null),t.websocket&&(t.websocket.close(),t.websocket=null),t.$message.success(t.$t("subDeviceUpgrade.equipmentUpgradeCompleted"))}}catch(X){k.e(X)}finally{k.f()}}}}catch(X){$.e(X)}finally{$.f()}}}catch(X){g.e(X)}finally{g.f()}}}else if("getstatusCStatus"==t.resname&&"getstatus"==JSON.parse(e.data).res_name){if(JSON.parse(e.data).err_code)return!1;var D=0,M=JSON.parse(e.data).res_content.results;if(M.length>0){var L,F=p(t.dataList);try{for(F.s();!(L=F.n()).done;){var x,j=L.value,O=p(M);try{for(O.s();!(x=O.n()).done;){var T=x.value;if(j.children&&j.children.length>0){var I,V=p(j.children);try{for(V.s();!(I=V.n()).done;){var P=I.value;if(-1!=P.interfaces.indexOf(T.com_index)&&P.devAddr==T.dev_addr&&(D++,t.$set(P,"devprogress",Math.round(100*T.dev_progress)/100),t.$set(P,"devStatus",T.dev_status),D==t.selectDeviceList.length))return t.websocket&&(t.websocket.close(),t.websocket=null),t.$message.success(t.$t("subDeviceUpgrade.refreshSuccessful"))}}catch(X){V.e(X)}finally{V.f()}}}}catch(X){O.e(X)}finally{O.f()}}}catch(X){F.e(X)}finally{F.f()}}}else{if("setchlstatusC"==t.resname&&"setchlstatus"==JSON.parse(e.data).res_name)return 1==JSON.parse(e.data).res_content.received?(t.websocket&&(t.websocket.close(),t.websocket=null),t.$message.success(t.$t("subDeviceUpgrade.closeSerialPortMaintenanceSuccessfully")),t.resetChannelStatus()):(t.isOpenMainMode=!1,t.$message.error(t.$t("subDeviceUpgrade.closeSerialPortMaintenanceFailed")));if("setchlstatusCReset"==t.resname&&"setchlstatus"==JSON.parse(e.data).res_name)1==JSON.parse(e.data).res_content.received&&(t.websocket&&(t.websocket.close(),t.websocket=null),t.$nextTick((function(){t.$refs.mainModeListTable.clearSelection(),t.isOpenMainMode=!1,t.selectedComList=[],t.dataList=[],t.total=0})));else if("setchlstatusCB"==t.resname&&"setchlstatus"==JSON.parse(e.data).res_name)t.isOpenMainMode=!1,t.websocket&&(t.websocket.close(),t.websocket=null),t.sdTimer&&(clearInterval(t.sdTimer),t.sdTimer=null);else if("search"==t.resname&&"search"==JSON.parse(e.data).res_name){if(0!=JSON.parse(e.data).res_content.result)return t.websocket&&(t.websocket.close(),t.websocket=null),t.$message.error(t.$t("subDeviceUpgrade.searchFailed"));if(JSON.parse(e.data).res_content.dev){var C,A=JSON.parse(e.data).res_content.dev,N=[],q=p(t.dataList);try{for(q.s();!(C=q.n()).done;){var E=C.value;if(-1!=E.interface.indexOf(A.com_index)&&E.children){if(E.children.length>0){for(var G=0;G<E.children.length;G++)if(E.children[G].devId==A.dev_id&&E.children[G].devAddr==A.dev_addr){var z={id:E.children[G].id,gwSn:t.selectedGwsn,devName:E.children[G].devName,devSource:E.children[G].devSource,interfaces:E.children[G].interfaces,devId:E.children[G].devId,devModel:A.model?A.model:E.children[G].devModel,devAddr:E.children[G].devAddr,devVer:A.main_ver?A.main_ver:E.children[G].devVer,devSubVer:A.sub_ver?A.sub_ver:E.children[G].devSubVer,devStatus:E.children[G].devStatus,devprogress:E.children[G].devprogress};return N.push(z),t.searchUpdateMysql(N)}var J=[{gwSn:t.selectedGwsn,devName:"",devSource:0,interfaces:"COM"+A.com_index,devId:A.dev_id,devModel:A.model,devAddr:A.dev_addr,devVer:A.main_ver,devSubVer:A.sub_ver,devStatus:0,devprogress:0}];return t.searchAddMysql(J)}var U=[{gwSn:t.selectedGwsn,devName:"",devSource:0,interfaces:"COM"+A.com_index,devId:A.dev_id,devModel:A.model,devAddr:A.dev_addr,devVer:A.main_ver,devSubVer:A.sub_ver,devStatus:0,devprogress:0}];return t.searchAddMysql(U)}}}catch(X){q.e(X)}finally{q.f()}}clearTimeout(t.searchTimeOutTimer),t.searchTimeOutTimer=setTimeout((function(){return t.websocket&&(t.websocket.close(),t.websocket=null),t.$message.success(t.$t("subDeviceUpgrade.searchSuccessful"))}),t.searchForm.timeout)}else if("setparam"==t.resname&&"setparam"==JSON.parse(e.data).res_name){if(!JSON.parse(e.data).res_content.dev)return;if(0!=JSON.parse(e.data).res_content.result)return t.websocket&&(t.websocket.close(),t.websocket=null),t.$message.error(t.$t("subDeviceUpgrade.setAddressFailed"));if(JSON.parse(e.data).res_content.dev){var H,R=JSON.parse(e.data).res_content.dev,B=p(t.dataList);try{for(B.s();!(H=B.n()).done;){var W=H.value;if(W.children&&W.children.length>0){var Q,Y=p(W.children);try{for(Y.s();!(Q=Y.n()).done;){var K=Q.value;-1!=K.interfaces.indexOf(R.com_index)&&K.devId==R.dev_id&&t.$set(K,"devAddr",R.dev_addr)}}catch(X){Y.e(X)}finally{Y.f()}}}}catch(X){B.e(X)}finally{B.f()}}clearTimeout(t.setparamTimer),t.setparamTimer=setTimeout((function(){return t.websocket&&(t.websocket.close(),t.websocket=null),t.$message.success(t.$t("subDeviceUpgrade.setAddressSuccessfully"))}),t.setDeviceParamForm.timeout)}}}))},websocketonclose:function(e){this.lockReconnect=!1},searchAddMysql:function(e){var t=this;t.$hasPermission("integerFaces:insert:permission.do")?t.$http.post("/info/integerFaces",e).then((function(e){e.data;t.querySearch()})).catch((function(e){return!1})):t.$message.warning("暂无子设备新增权限, 请联系管理员")},searchUpdateMysql:function(e){var t=this;t.$hasPermission("integerFaces:update:permission.do")?t.$http.post("/info/integerFaces/updateBatch",e).then((function(e){e.data;t.querySearch()})).catch((function(e){return!1})):t.$message.warning("暂无子设备修改权限, 请联系管理员")},handleOpenMainMode:function(){var e=this,t=[];if(!e.selectedGwsn)return e.$message.warning(this.$t("project.pleaseSelectTheGatewayBeforeEnablingMaintenanceMode"));e.getProtocol(),e.querySearchCOM((function(){e.comList.forEach((function(e){var r={interface:e.value,baud:9600,data_bit:8,stop_bit:1,check_bit:0};t.push(r)})),e.openMainModeForm.mainModeList=t}))},getDeviceProtocol:function(){var e=this,t={attribute:2};e.deviveModeList=[],e.$hasPermission("protocolinfo:select:permission.do")?e.$http.get("/info/protocolinfo/proGuidAll",{params:t}).then((function(t){var r=t.data;if(0!=r.code)return e.$message.error(r.data||r.msg);r.data.length>0&&(r.data.forEach((function(t){var r={label:t.manuf,value:t.libname,guid:t.guid};e.deviveModeList.push(r)})),e.setDeviceParamForm.protocol=e.openMainModeForm.mode,e.getGuidList(e.setDeviceParamForm.protocol),e.$nextTick((function(){e.setDeviceParamVisible=!0})))})).catch((function(e){return!1})):e.$message.warning("暂无协议查询权限, 请联系管理员")},getGuidList:function(e){var t=this;if(t.deviveModeList.length>0)for(var r=0;r<t.deviveModeList.length;r++){var a=t.deviveModeList[r];if(a.value==e){t.getDeviceProtocolFunctioncodeList(a.guid);break}}},getDeviceProtocolFunctioncodeList:function(e){var t=this,r={guid:e};t.$hasPermission("protocolinfo:select:permission.do")?t.$http.get("/info/protocolinfo/proguid",{params:r}).then((function(e){var r=e.data;if(0!=r.code)return t.$message.error(r.data||r.msg);t.paramIndexList=JSON.parse(r.data[0].funccode).data})).catch((function(e){return!1})):t.$message.warning("暂无协议查询权限, 请联系管理员")},setDeviceParam:function(){var e=this;if(e.setDeviceParamForm.dataList=[],0==e.selectDeviceList.length)return e.$message.warning(this.$t("project.pleaseSelectTheDeviceFirstBeforeSettingSubDeviceParameters"));e.selectDeviceList.forEach((function(t){var r={interfaces:t.interfaces,devAddr:t.devAddr,devId:t.devId,devVer:t.devVer,targetAddr:""};e.setDeviceParamForm.dataList.push(r)})),e.$nextTick((function(){e.getDeviceProtocol()}))},handleSetDeviceParamTimeout:function(e){e<3e3?this.setDeviceParamForm.timeout=3e3:e>18e4&&(this.setDeviceParamForm.timeout=18e4)},setDeviceParamFormSubmitHandle:function(){var e=this,t=this,r=[],a=[],s=[];t.$refs["setDeviceParamForm"].validate((function(n){if(n){t.setDeviceParamForm.dataList.forEach((function(e){var t={comIndex:e.interfaces,devId:e.devId,devAddr:e.devAddr,paramValue:e.targetAddr};r.push(t)})),r.map((function(e){-1===a.indexOf(e.comIndex)&&(s.push({comIndex:e.comIndex.replace(/[^0-9]/gi,""),gwsn:t.selectedGwsn,paramIndex:t.setDeviceParamForm.paramIndex,protocol:t.setDeviceParamForm.protocol.split("_")[0],timeout:t.setDeviceParamForm.timeout,setChildenVOList:[]}),a.push(e.comIndex))})),s.map((function(e){r.map((function(t){e.comIndex.replace(/[^0-9]/gi,"")==t.comIndex.replace(/[^0-9]/gi,"")&&e.setChildenVOList.push({devid:t.devId,devAddr:t.devAddr,paramValue:t.paramValue})}))}));for(var i=0,o=s;i<o.length;i++)for(var l=o[i],c=0;c<l.setChildenVOList.length-1;c++)for(var d=c+1;d<l.setChildenVOList.length;d++)if(l.setChildenVOList[c].paramValue===l.setChildenVOList[d].paramValue)return e.$message.error(e.$t("project.pleaseReEnterTheTargetAddress"));t.$nextTick((function(){t.resname="setparam";var e=Object(m["p"])(JSON.stringify(s));t.$nextTick((function(){t.setDeviceParamVisible=!1,t.wsUrl="socketList/setparam/"+Object(m["q"])(e)+"/"+t.encryMD5List(),t.createWebSocket()}))}))}}))},getProtocol:function(){var e=this,t={attribute:2};e.modeList=[],e.$hasPermission("protocolinfo:select:permission.do")?e.$http.get("/info/protocolinfo/proGuidAll",{params:t}).then((function(t){var r=t.data;if(0!=r.code)return e.$message.error(r.data||r.msg);r.data.length>0&&(r.data.forEach((function(t){var r={label:t.manuf,value:t.libname};e.modeList.push(r)})),e.openMainModeForm.mode=e.modeList[0].value,e.openMainModeVisible=!0,e.openMainModeLoading=!1)})).catch((function(e){return!1})):e.$message.warning("暂无协议查询权限, 请联系管理员")},customColorMethod:function(e){return e<30?"#909399":e<80?"#e6a23c":"#67c23a"},getRowKey:function(e){return e.id},reduceSame:function(e){var t={};return e.reduce((function(e,r){return!t[r.id]&&(t[r.id]=e.push(r)),e}),[])},dataListSelectionHandle:function(e){var t=this;this.selectDeviceList=[],this.selectCOMList=[],e.length>0?(e.forEach((function(e){if(e.children){var r={interfaces:e.interface};t.selectCOMList.push(r),e.children.length>0&&e.children.forEach((function(e){var r={id:e.id,devId:e.devId,devAddr:e.devAddr,devVer:e.devVer,interfaces:e.interfaces};t.selectDeviceList.push(r)}))}else{var a={id:e.id,devId:e.devId,devAddr:e.devAddr,devVer:e.devVer,interfaces:e.interfaces};t.selectDeviceList.push(a)}})),this.$nextTick((function(){t.selectDeviceList=t.reduceArrObj(t.selectDeviceList)}))):(this.selectDeviceList=[],this.selectCOMList=[])},selectAllDataList:function(e){var t=this,r=!1,a=0;if(e.length>0)for(var s=0;s<e.length;s++){var n=e[s];if(n.children&&(a++,a==this.total)){r=!0;break}}this.selectDeviceList=[],this.$nextTick((function(){r?(t.dataList.forEach((function(e){t.$refs.recordTable.toggleRowSelection(e,!0),void 0!=e.children&&e.children.forEach((function(e){t.$refs.recordTable.toggleRowSelection(e,!0);var r={id:e.id,devId:e.devId,devAddr:e.devAddr,devVer:e.devVer,interfaces:e.interfaces};t.selectDeviceList.push(r)}))})),t.$nextTick((function(){t.selectDeviceList=t.reduceArrObj(t.selectDeviceList)}))):(t.selectDeviceList=[],t.dataList.forEach((function(e){t.$refs.recordTable.toggleRowSelection(e,!1),void 0!=e.children&&e.children.forEach((function(e){t.$refs.recordTable.toggleRowSelection(e,!1)}))})))}))},reduceArrObj:function(e){for(var t=0;t<e.length-1;t++)for(var r=t+1;r<e.length;r++)e[t].interfaces==e[r].interfaces&&e[t].devAddr==e[r].devAddr&&e.splice(r,1);for(var a=0;a<e.length;a++)e[a].interfaces||e.splice(a,1);return e},mainModeListSelectionHandle:function(e){var t=this;this.selectedComList=[],e.length>0?(this.multipleSelectionAll=this.reduceSame(e),this.multipleSelectionAll=this.multipleSelectionAll.map((function(e){return e.id})),e.forEach((function(e){t.selectedComList.push(e)}))):(this.selectedComList=[],this.multipleSelectionAll=[])},setComStatus:function(){var e=this,t=[];e.openMainModeLoading=!0,e.resname="setchlstatus",e.selectedComList.forEach((function(r){var a={gwsn:e.selectedGwsn,com:r.interface.replace(/[^0-9]/gi,""),status:3};t.push(a)}));var r=Object(m["p"])(JSON.stringify(t));e.wsUrl="socketList/setchlstatusCds/"+Object(m["q"])(r)+"/"+e.encryMD5List(),e.createWebSocket()},setMaintainMode:function(){var e=this;e.resname="maintain",e.wsUrl="socketsOne/getMaintain/"+e.selectedGwsn+"/"+e.encryMD5(e.selectedGwsn),e.createWebSocket()},setComProtocol:function(){var e=this,t=[];e.resname="setcom",e.selectedComList.forEach((function(r){var a={index:r.interface.replace(/[^0-9]/gi,""),baud:r.baud,databit:r.data_bit,stopit:r.stop_bit,checkbit:r.check_bit,open:1,type:1,gwsn:e.selectedGwsn,protocol:e.openMainModeForm.mode};t.push(a)}));var r=Object(m["p"])(JSON.stringify(t));e.$nextTick((function(){e.wsUrl="socketList/setcom/"+Object(m["q"])(r)+"/"+e.encryMD5List(),e.createWebSocket(),e.getMQTTTimer=setTimeout((function(){if(e.openMainModeLoading)return e.openMainModeLoading=!1,e.getMQTTTimer&&(clearTimeout(e.getMQTTTimer),e.getMQTTTimer=null),e.$message.error(e.$t("issue.timeout"))}),"30000")}))},handleMainModeClose:function(){this.openMainModeVisible=!1,this.websocket&&(this.websocket.close(),this.websocket=null)},openMainModeFormSubmitHandle:function(){var e=this;if(0==e.selectedComList.length)return e.$message.warning(this.$t("project.pleaseSelectTheInterfaceToEnterMaintenanceMode")+"!!!");e.$confirm(this.$t("project.openMaintenanceMode"),this.$t("prompt.title"),{confirmButtonText:this.$t("confirm"),cancelButtonText:this.$t("cancel"),type:"warning"}).then((function(){e.setComStatus()})).catch((function(e){}))},reduceCOM:function(e){for(var t=0;t<e.length-1;t++)for(var r=t+1;r<e.length;r++)e[t].com==e[r].com&&(e.splice(r,1),r--);return e},upgradeDevice:function(e,t){var r=this;if(e&&t){this.isSingle=!0,this.selectDeviceList=[];var a={devId:t.devId,devAddr:t.devAddr,devVer:t.devVer,interfaces:t.interfaces};this.selectDeviceList.push(a),this.upgradeForm.currentVersion=t.devVer}else{if(this.isSingle=!1,0==this.selectDeviceList.length)return this.$message.warning(this.$t("project.pleaseSelectTheDeviceFirstBeforeUpgrading"));this.upgradeForm.currentVersion="";var s,n=[],i=p(this.selectDeviceList);try{for(i.s();!(s=i.n()).done;){var o=s.value;o.devVer&&n.push(o.devVer)}}catch(u){i.e(u)}finally{i.f()}n=Array.from(new Set(n));var l,c=p(n);try{for(c.s();!(l=c.n()).done;){var d=l.value;this.upgradeForm.currentVersion+=d+","}}catch(u){c.e(u)}finally{c.f()}this.upgradeForm.currentVersion=this.upgradeForm.currentVersion.slice(0,this.upgradeForm.currentVersion.length-1)}this.$nextTick((function(){r.getTargetVersionList(),r.upgradeVisible=!0}))},getTargetVersionList:function(){var e=this,t={page:1,limit:50,available:1};this.versionList=[],this.$hasPermission("devvermanage:selectInfo:permission.do")?this.$http.get("/info/devvermanage/getInfo",{params:t}).then((function(t){var r=t.data;e.versionList=r.data.list})).catch((function(e){return!1})):this.$message.warning("暂无子版本管理查询权限, 请联系管理员")},handleUpgradeClose:function(){this.isSingle&&(this.selectDeviceList=[]),this.upgradeVisible=!1,this.websocket&&(this.websocket.close(),this.websocket=null)},upgradeFormSubmitHandle:function(){var e=this,t={gwsn:e.selectedGwsn,fileType:6,fileUrl:"http://"+e.upgradeForm.targetVersion,savePath:"/data/download"+e.upgradeForm.targetVersion.substring(e.upgradeForm.targetVersion.lastIndexOf("/"))};e.resname="downfile",e.$refs["upgradeForm"].validate((function(r){if(!r)return!1;var a=Object(m["p"])(JSON.stringify(t));e.$nextTick((function(){e.wsUrl="socketNine/getDownfile/"+Object(m["q"])(a)+"/"+e.encryMD5List(),e.createWebSocket()}))}))},upgradeConfirm:function(){var e,t=this,r=[],a=p(t.selectDeviceList);try{for(a.s();!(e=a.n()).done;){var s=e.value,n={comIndex:s.interfaces.replace(/[^0-9]/gi,""),devid:s.devId,devAddr:s.devAddr,fileName:"/data/download"+t.upgradeForm.targetVersion.substring(t.upgradeForm.targetVersion.lastIndexOf("/")),protocol:t.openMainModeForm.mode,timeOut:3e3,retryTime:t.upgradeForm.checked?t.upgradeForm.count:1,gwsn:t.selectedGwsn};r.push(n)}}catch(o){a.e(o)}finally{a.f()}t.resname="upgrade";var i=Object(m["p"])(JSON.stringify(r));t.$nextTick((function(){t.wsUrl="socketList/upgrade/"+Object(m["q"])(i)+"/"+t.encryMD5List(),t.createWebSocket()}))},getSDStatus:function(){var e=this,t=[];if(0==e.selectDeviceList.length)return e.$message.warning(this.$t("project.pleaseSelectTheDeviceToRefreshTheStatus"));e.selectDeviceList.forEach((function(r){var a={comIndex:r.interfaces.replace(/[^0-9]/gi,""),devAddr:r.devAddr,devid:r.devId,gwsn:e.selectedGwsn,protocol:e.openMainModeForm.mode};t.push(a)})),e.resname="getstatus";var r=Object(m["p"])(JSON.stringify(t));e.wsUrl="socketList/getstatus/"+Object(m["q"])(r)+"/"+e.encryMD5List(),e.createWebSocket()},getCycleGetStatus:function(){var e=this;this.sdTimer=setInterval((function(){e.getSDStatus()}),5e3)},getSDStatusStatus:function(){var e=this,t=[];if(0==e.selectDeviceList.length)return e.$message.warning(this.$t("project.pleaseSelectTheDeviceToRefreshTheStatus"));e.selectDeviceList.forEach((function(r){var a={comIndex:r.interfaces.replace(/[^0-9]/gi,""),devAddr:r.devAddr,devid:r.devId,gwsn:e.selectedGwsn,protocol:e.openMainModeForm.mode};t.push(a)})),e.resname="getstatusCStatus";var r=Object(m["p"])(JSON.stringify(t));e.wsUrl="socketList/getstatus/"+Object(m["q"])(r)+"/"+e.encryMD5List(),e.websocket||e.createWebSocket()},refreshStatus:function(){var e=this,t=[];if(0==e.selectDeviceList.length)return e.$message.warning(this.$t("project.pleaseSelectTheDeviceFirstBeforeRefreshing"));e.selectDeviceList.forEach((function(r){var a={comIndex:r.interfaces.replace(/[^0-9]/gi,""),devAddr:r.devAddr,devid:r.devId,gwsn:e.selectedGwsn,protocol:e.openMainModeForm.mode};t.push(a)})),e.sdTimer&&(clearInterval(e.sdTimer),e.sdTimer=null),e.resname="getstatusCStatus";var r=Object(m["p"])(JSON.stringify(t));e.$nextTick((function(){e.wsUrl="socketList/getstatus/"+Object(m["q"])(r)+"/"+e.encryMD5List(),e.websocket?(e.websocket.close(),e.websocket=null,e.createWebSocket(),e.getSDStatusStatus(),e.getCycleGetStatus()):(e.createWebSocket(),e.getSDStatusStatus(),e.getCycleGetStatus())}))},refresh:function(){var e=this,t=[];e.selectDeviceList.forEach((function(r){var a={comIndex:r.interfaces.replace(/[^0-9]/gi,""),devAddr:r.devAddr,devid:r.devId,gwsn:e.selectedGwsn,protocol:e.openMainModeForm.mode};t.push(a)})),e.sdTimer&&(clearInterval(e.sdTimer),e.sdTimer=null),e.resname="getstatus";var r=Object(m["p"])(JSON.stringify(t));e.wsUrl="socketList/getstatus/"+Object(m["q"])(r)+"/"+e.encryMD5List(),e.createWebSocket(),e.getCycleGetStatus()},recoverChannelStatus:function(){var e=this,t=[];e.$confirm("此操作将关闭维护模式, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.selectedComList.forEach((function(r){var a={gwsn:e.selectedGwsn,com:r.interface.replace(/[^0-9]/gi,""),status:0};t.push(a)})),e.resname="setchlstatusC";var r=Object(m["p"])(JSON.stringify(t));e.wsUrl="socketList/setchlstatusCds/"+Object(m["q"])(r)+"/"+e.encryMD5List(),e.createWebSocket()})).catch((function(e){}))},resetChannelStatus:function(){var e=this,t=[];e.selectedComList.forEach((function(r){var a={gwsn:e.selectedGwsn,com:r.interface.replace(/[^0-9]/gi,""),status:1};t.push(a)})),e.$nextTick((function(){e.resname="setchlstatusCReset";var r=Object(m["p"])(JSON.stringify(t));e.wsUrl="socketList/setchlstatusCds/"+Object(m["q"])(r)+"/"+e.encryMD5List(),e.createWebSocket()}))},recoverChannelStatusBeforeLeave:function(){var e=this,t=[];e.selectedComList.forEach((function(r){var a={gwsn:e.selectedGwsn,com:r.interface.replace(/[^0-9]/gi,""),status:0};t.push(a)})),e.resname="setchlstatusCB";var r=Object(m["p"])(JSON.stringify(t));e.$nextTick((function(){e.wsUrl="socketList/setchlstatusCds/"+Object(m["q"])(r)+"/"+e.encryMD5List(),e.createWebSocket()}))},addDeviceFormSubmitHandle:function(){var e=this,t=[];e.$refs["addDeviceForm"].validate((function(r){if(r){e.addDeviceloading=!0;for(var a=e.addDeviceForm.startvalue,s=0;s<e.addDeviceForm.count;s++){var n={gwSn:e.selectedGwsn,interfaces:e.handAddObj.interface,devId:"",devModel:"",devName:"",gwModel:e.selectedModel,devAddr:a,devSource:1,devVer:"",devSubVer:"",devStatus:null};a=Number(a)+Number(e.addDeviceForm.step),t.push(n)}e.$hasPermission("integerFaces:insert:permission.do")?e.$http.post("/info/integerFaces",t).then((function(t){var r=t.data;return 0!=r.code?(e.addDeviceloading=!1,e.$message.error(r.data||r.msg)):(e.addDeviceloading=!1,e.addDeviceVisible=!1,e.querySearch(),e.$message.success(r.msg))})).catch((function(e){return!1})):e.$message.warning("暂无子设备新增权限, 请联系管理员")}}))},watchPrjSearch:u()((function(){var e=document.getElementsByClassName("el-scrollbar__wrap").length;document.getElementsByClassName("el-scrollbar__wrap")[e-1].scrollTo(0,0),this.prjPage=1,this.getPrjNameList(),this.$refs.prjInput.focus()}),500),watchGwsnSearch:u()((function(){var e=document.getElementsByClassName("el-scrollbar__wrap").length;document.getElementsByClassName("el-scrollbar__wrap")[e-1].scrollTo(0,0),this.gwsnPage=1,this.getGwsnList(),this.$refs.gwsnInput.focus()}),500)},updated:function(){this.$refs.recordTable&&this.$refs.recordTable.doLayout&&this.$refs.recordTable.doLayout()},mounted:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=1,this.getPrjNameList();case 1:return e.next=2,this.getGwsnList();case 2:window.onresize=function(){return function(){t.scrollTableHeight=window.innerHeight-220-53,t.$refs.recordTable&&t.$refs.recordTable.doLayout&&t.$refs.recordTable.doLayout()}()};case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),beforeDestroy:function(){this.selectedModel="",this.websocket&&this.websocket.close(),this.sdTimer&&(clearInterval(this.sdTimer),this.sdTimer=null),this.isOpenMainMode&&this.recoverChannelStatusBeforeLeave()},watch:{prjSearch:function(e,t){this.watchPrjSearch()},gwsnSearch:function(e,t){this.watchGwsnSearch()}}},w=b,$=r("2877"),S=Object($["a"])(w,a,s,!1,null,null,null);t["default"]=S.exports}}]);