(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-019bfb70"],{"62dd":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e._self._c;return t("section",[t("div",{staticClass:"total"},[t("div",{staticClass:"systemOverview"},[t("div",[t("div",[t("div",{staticClass:"systemOverviewLeft"},[e._v(e._s(e.$t("indexPage.connectedDeviceTotal")))]),t("div",{staticClass:"systemOverviewRight"},[e._v(e._s(e.deviceForm.baseCount))])]),t("div",{staticClass:"systemOverviewMargin"},[t("div",{staticClass:"systemOverviewLeft"},[e._v(e._s(e.$t("indexPage.deviceInOffLine")))]),t("div",{staticClass:"systemOverviewRight"},[t("span",{staticClass:"systemOverviewOnline"},[e._v(e._s(e.deviceForm.onlineCount))]),e._v(" / "),t("span",{staticClass:"systemOverviewOffline"},[e._v(e._s(e.deviceForm.offlineCount))])])])]),t("div",[t("div",[t("div",{staticClass:"systemOverviewLeft"},[e._v(e._s(e.$t("indexPage.projectTotal")))]),t("div",{staticClass:"systemOverviewRight"},[e._v(e._s(e.deviceForm.priinfo))])]),t("div",{staticClass:"systemOverviewMargin"},[t("div",{staticClass:"systemOverviewLeft"},[e._v(e._s(e.$t("indexPage.deviceInLineRate")))]),t("div",{staticClass:"systemOverviewRight"},[t("span",{staticClass:"systemOverviewOnline"},[e._v(e._s(e.deviceForm.onlineRate))]),e._v(" %\n                    ")])])])])]),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%",height:"660px","margin-top":"20px"},attrs:{id:"container"}})])},a=[],o=(n("7f7f"),n("96cf"),n("1da1")),s=n("bc3a"),r=n.n(s),l=n("b513"),c={name:"home",data:function(){return{timer:null,cluster:null,loading:!1,deviceForm:{baseCount:0,onlineCount:0,offlineCount:0,priinfo:0,onlineRate:0},markerList:[],pointCollection:null,map:null,zoom:3}},methods:{init:function(){var e=this,t=null,n=[],i=[],a={};function s(){t||(t=document.createElement("div"),t.style.position="fixed",t.style.padding="6px 10px",t.style.background="rgba(0,0,0,0.7)",t.style.color="#fff",t.style.borderRadius="6px",t.style.pointerEvents="none",t.style.fontSize="14px",t.style.fontFamily="Microsoft Yahei",t.style.whiteSpace="nowrap",t.style.zIndex=99999999,document.getElementById("container").appendChild(t))}e.loading=!0,r.a.get("/mapconfig.json?_t="+(new Date).getTime()).then(function(){var r=Object(o["a"])(regeneratorRuntime.mark((function o(r){var c;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:c=r.data,c&&c.baiduKey&&Object(l["a"])(c.baiduKey).then((function(){e.map=new BMapGL.Map("container");var o=new BMapGL.Point(116.404,39.915);e.map.centerAndZoom(o,e.zoom),e.map.enableScrollWheelZoom(!0);var r=new mapvgl.View({map:e.map}),l=new mapvgl.IconLayer({width:100/6,height:25.5,offset:[0,-12.75],opacity:.8,icon:"/marker.png",enablePicked:!0,selectedIndex:-1,autoSelect:!0,selectedColor:"#ff0000",onClick:function(t){var i=t.dataIndex,a=n[i];a&&e.$router.push({path:"/tprj-tprjinfo",query:{prjName:a.name}})},onMousemove:function(i){if(i.dataItem){var a=i.dataIndex,o=n[a],r=o.name;s(),t.innerText=r,t.style.display="block";var l=document.getElementById("container"),c=l.getBoundingClientRect(),d=e.map.pointToPixel(new BMapGL.Point(o.lnglat[0],o.lnglat[1])),u=c.left+d.x,v=c.top+d.y;t.style.left=u-t.offsetWidth/2+"px",t.style.top=v-60+"px"}else t.style.display="none"}});e.$http.get("/list/getProList.do",{params:a}).then((function(t){var a=t.data;if(0!=a.code)return e.loading=!1,e.$message.error(a.data||a.msg);for(var o=0;o<a.data.length;o++){var s=a.data[o];if(s.latitude&&s.longitude){i.push({geometry:{type:"Point",coordinates:[s.longitude,s.latitude]}});var c={lnglat:[s.longitude,s.latitude],name:s.prjName,style:0,prjNameI18n:e.$t("indexPage.projectName")};n.push(c)}}r.addLayer(l),l.setData(i),e.map.setDefaultCursor("default"),e.loading=!1})).catch((function(e){return!1}))})).catch((function(e){}));case 1:case"end":return o.stop()}}),o)})));return function(e){return r.apply(this,arguments)}}())},getOnlineStatus:function(){var e=this,t={};e.$http.get("/info/ding/count/gwbaseInfoCount",{params:t}).then((function(t){var n=t.data;if(0!=n.code)return e.$message.error(n.msg);e.deviceForm.baseCount=n.data.baseCount,e.deviceForm.onlineCount=n.data.onlineCount,e.deviceForm.offlineCount=n.data.offlineCount,e.deviceForm.priinfo=n.data.priinfo,0===e.deviceForm.baseCount?e.deviceForm.onlineRate=0:e.deviceForm.onlineRate=Math.ceil(e.deviceForm.onlineCount/e.deviceForm.baseCount*1e4/100)})).catch((function(e){return!1}))},getOnlineCount:function(){var e=this;this.timer=setInterval((function(){e.getOnlineStatus()}),1e4)}},mounted:function(){this.init(),window.onbeforeunload=function(e){this.timer&&(clearInterval(this.timer),this.timer=null)}},beforeDestroy:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},activated:function(){this.getOnlineStatus(),this.getOnlineCount()},deactivated:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},d=c,u=(n("b4ff"),n("2877")),v=Object(u["a"])(d,i,a,!1,null,"11958f13",null);t["default"]=v.exports},ac25:function(e,t,n){},b4ff:function(e,t,n){"use strict";n("ac25")},b513:function(e,t,n){"use strict";function i(e){return new Promise((function(t,n){if(window.BMapGL)t(window.BMapGL);else{var i=document.createElement("script");i.type="text/javascript",i.src="https://api.map.baidu.com/api?v=1.0&type=webgl&ak=".concat(e,"&callback=onBMapGLLoad"),i.onerror=function(){return n(new Error("Failed to load Baidu Map GL"))},window.onBMapGLLoad=function(){t(window.BMapGL)},document.head.appendChild(i)}}))}n.d(t,"a",(function(){return i}))}}]);