(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-65b86792"],{"27d8":function(t,e,n){"use strict";n("929c")},"62dd":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t._self._c;return e("section",[e("div",{staticClass:"total"},[e("div",{staticClass:"systemOverview"},[e("div",[e("div",[e("div",{staticClass:"systemOverviewLeft"},[t._v(t._s(t.$t("indexPage.connectedDeviceTotal")))]),e("div",{staticClass:"systemOverviewRight"},[t._v(t._s(t.deviceForm.baseCount))])]),e("div",{staticClass:"systemOverviewMargin"},[e("div",{staticClass:"systemOverviewLeft"},[t._v(t._s(t.$t("indexPage.deviceInOffLine")))]),e("div",{staticClass:"systemOverviewRight"},[e("span",{staticClass:"systemOverviewOnline"},[t._v(t._s(t.deviceForm.onlineCount))]),t._v(" / "),e("span",{staticClass:"systemOverviewOffline"},[t._v(t._s(t.deviceForm.offlineCount))])])])]),e("div",[e("div",[e("div",{staticClass:"systemOverviewLeft"},[t._v(t._s(t.$t("indexPage.projectTotal")))]),e("div",{staticClass:"systemOverviewRight"},[t._v(t._s(t.deviceForm.priinfo))])]),e("div",{staticClass:"systemOverviewMargin"},[e("div",{staticClass:"systemOverviewLeft"},[t._v(t._s(t.$t("indexPage.deviceInLineRate")))]),e("div",{staticClass:"systemOverviewRight"},[e("span",{staticClass:"systemOverviewOnline"},[t._v(t._s(t.deviceForm.onlineRate))]),t._v(" %\n                    ")])])])])]),e("div",{staticStyle:{"margin-top":"10px",position:"relative",overflow:"hidden"}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%",height:"660px"},attrs:{id:"container"}})])])},a=[],r=(n("ac6a"),n("3835")),s={bd09ToGcj02:function(t,e){var n=t-.0065,i=e-.006,a=Math.sqrt(n*n+i*i)-2e-5*Math.sin(i*Math.PI),r=Math.atan2(i,n)-3e-6*Math.cos(n*Math.PI);return[a*Math.cos(r),a*Math.sin(r)]},gcj02ToWgs84:function(t,e){if(this._outOfChina(t,e))return[t,e];var n=this._transformLat(t-105,e-35),i=this._transformLng(t-105,e-35),a=e/180*Math.PI,r=Math.sin(a),s=.006693421622965943,o=6378245,l=Math.sqrt(1-s*r*r),v=180*n/(o*(1-s)/Math.pow(l,3)*Math.PI),c=180*i/(o/l*Math.cos(a)*Math.PI);return[t-c,e-v]},bd09ToWgs84:function(t,e){var n=this.bd09ToGcj02(t,e),i=Object(r["a"])(n,2),a=i[0],s=i[1];return this.gcj02ToWgs84(a,s)},_transformLat:function(t,e){var n=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*Math.PI)+20*Math.sin(2*t*Math.PI))/3,n+=2*(20*Math.sin(e*Math.PI)+40*Math.sin(e/3*Math.PI))/3,n+=2*(160*Math.sin(e/12*Math.PI)+320*Math.sin(e*Math.PI/30))/3,n},_transformLng:function(t,e){var n=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*Math.PI)+20*Math.sin(2*t*Math.PI))/3,n+=2*(20*Math.sin(t*Math.PI)+40*Math.sin(t/3*Math.PI))/3,n+=2*(150*Math.sin(t/12*Math.PI)+300*Math.sin(t/30*Math.PI))/3,n},_outOfChina:function(t,e){return!(t>73.66&&t<135.05&&e>3.86&&e<53.55)}},o={name:"home",data:function(){return{map:null,control:null,timer:null,loading:!1,deviceForm:{baseCount:0,onlineCount:0,offlineCount:0,priinfo:0,onlineRate:0},prjMarks:new Array,markerCluster:null,mapStyle:""}},methods:{getCurrentTime:function(){var t=new Date,e=t.getHours();this.mapStyle=e>=19||e<=6?"indigo":""},init:function(){var t=this,e={};t.loading=!0,t.$nextTick((function(){t.map=new T.Map("container",{projection:"EPSG:4326",attributionControl:!1,inertia:!1}),t.map.centerAndZoom(new T.LngLat(120.37435948848726,30.304369795918284),3),t.map.addEventListener("moveend",t.handleMapChange),t.mapStyle?t.map.setStyle(t.mapStyle):t.map.removeStyle(),t.control=new T.Control.Zoom,t.map.addControl(t.control);var n=new T.Control.MapType;if(t.map.addControl(n),t.prjMarks=[],!t.$hasPermission("list:getProList:select:permission.do"))return t.loading=!1,void t.$message.warning("暂无项目查询权限, 请联系管理员");t.$http.get("/list/getProList.do",{params:e}).then((function(e){var n=e.data;if(0!=n.code)return t.loading=!1,t.$message.error(n.data||n.msg);for(var i=0;i<n.data.length;i++){var a=n.data[i],r=null;if(a.latitude&&a.longitude){if(parseInt(BigInt(a.id)-BigInt(0x10a360d13ac32900))>0)r=new T.Marker(new T.LngLat(a.longitude,a.latitude),{title:a.prjName});else{var o=[a.longitude,a.latitude],l=s.bd09ToWgs84.apply(s,o);r=new T.Marker(new T.LngLat(l[0],l[1]),{title:a.prjName})}var v=a.prjName;t.addClickHandler(v,r),t.prjMarks.push(r)}}t.markerCluster=new T.MarkerClusterer(t.map,{markers:t.prjMarks}),t.loading=!1})).catch((function(t){return!1}))}))},handleMapChange:function(){var t=this.map.getBounds();t.getSouthWest(),t.getNorthEast()},addClickHandler:function(t,e){var n=this,i=null;e.addEventListener("mouseover",(function(e){var a=e.lnglat;i=new T.InfoWindow("项目名称: "+t,{offset:new T.Point(0,-30)}),n.map.openInfoWindow(i,a)})),e.addEventListener("mouseout",(function(t){n.map.closeInfoWindow()})),e.addEventListener("click",(function(e){n.map.closeInfoWindow(),n.$router.push({path:"/tprj-tprjinfo",query:{prjName:t}})}))},getOnlineStatus:function(){var t=this,e={};t.$http.get("/info/ding/count/gwbaseInfoCount",{params:e}).then((function(e){var n=e.data;if(0!=n.code)return t.$message.error(n.msg);t.deviceForm.baseCount=n.data.baseCount,t.deviceForm.onlineCount=n.data.onlineCount,t.deviceForm.offlineCount=n.data.offlineCount,t.deviceForm.priinfo=n.data.priinfo,0===t.deviceForm.baseCount?t.deviceForm.onlineRate=0:t.deviceForm.onlineRate=Math.ceil(t.deviceForm.onlineCount/t.deviceForm.baseCount*1e4/100)})).catch((function(t){return!1}))},getOnlineCount:function(){var t=this;this.timer=setInterval((function(){t.getOnlineStatus()}),1e4)}},mounted:function(){window.onbeforeunload=function(t){this.timer&&(clearInterval(this.timer),this.timer=null)}},beforeDestroy:function(){var t=this;if(this.timer&&(clearInterval(this.timer),this.timer=null),this.map){this.prjMarks&&this.prjMarks.length&&(this.prjMarks.forEach((function(e){e.removeEventListener("mouseover"),e.removeEventListener("mouseout"),e.removeEventListener("click"),t.map.removeOverLay(e)})),this.markers=[]),this.markerCluster&&(this.markerCluster.clearMarkers(),this.markerCluster=null),this.control&&(this.map.removeControl(this.control),this.control=null);var e=document.getElementById("container");e&&(e.innerHTML=""),this.map=null}},activated:function(){this.getOnlineStatus(),this.getOnlineCount(),this.getCurrentTime(),this.init()},deactivated:function(){var t=this;if(this.timer&&(clearInterval(this.timer),this.timer=null),this.map){this.prjMarks&&this.prjMarks.length&&(this.prjMarks.forEach((function(e){e.removeEventListener("mouseover"),e.removeEventListener("mouseout"),e.removeEventListener("click"),t.map.removeOverLay(e)})),this.markers=[]),this.markerCluster&&(this.markerCluster.clearMarkers(),this.markerCluster=null),this.control&&(this.map.removeControl(this.control),this.control=null);var e=document.getElementById("container");e&&(e.innerHTML=""),this.map=null}}},l=o,v=(n("27d8"),n("2877")),c=Object(v["a"])(l,i,a,!1,null,"4485af96",null);e["default"]=c.exports},"929c":function(t,e,n){}}]);