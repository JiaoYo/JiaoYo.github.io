(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-db2a431a"],{3476:function(t,e,a){"use strict";a("6846")},6846:function(t,e,a){},d07e:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("section",[e("el-dialog",{attrs:{visible:t.visible,title:t.dataForm.id?t.$t("update"):t.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e},opened:t.handleDialogOpenChange}},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",attrs:{model:t.dataForm,rules:t.rules,"label-width":"en-US"===t.$i18n.locale?"140px":"100px"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.dataFormSubmitHandle()}}},[e("el-row",[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:t.$t("formulacalculation.cycle")+"(ms)",prop:"cycle"}},[e("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:1,max:864e5,placeholder:t.$t("formulacalculation.pleaseEnterCycle")},model:{value:t.dataForm.cycle,callback:function(e){t.$set(t.dataForm,"cycle","string"===typeof e?e.trim():e)},expression:"dataForm.cycle"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:t.$t("formulacalculation.ignoreBadPixels"),prop:"badCode"}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.dataForm.badCode,callback:function(e){t.$set(t.dataForm,"badCode",e)},expression:"dataForm.badCode"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:t.$t("formulacalculation.targetPoint"),prop:"tagId"}},[e("el-input",{attrs:{placeholder:t.$t("attribute.placeholderSelect"),readonly:""},on:{focus:function(e){return t.handleCollectTagChange("simple")}},model:{value:t.targetName,callback:function(e){t.targetName=e},expression:"targetName"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:t.$t("formulacalculation.formula"),prop:"text"}},[e("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:t.$t("attribute.placeholderSelect"),readonly:""},on:{focus:function(e){return t.handleCollectTagChange("multiple")}},model:{value:t.dataForm.text,callback:function(e){t.$set(t.dataForm,"text",e)},expression:"dataForm.text"}})],1)],1)],1)],1),e("template",{slot:"footer"},[e("el-button",{on:{click:t.handleClose}},[t._v(t._s(t.$t("cancel")))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.dataFormSubmitHandle()}}},[t._v(t._s(t.$t("confirm")))])],1)],2),e("el-dialog",{attrs:{visible:t.tagVisible,width:"60%",title:t.$t("attribute.collectTagName"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":t.handleDialogClose},on:{"update:visible":function(e){t.tagVisible=e}}},[e("el-row",[e("el-form",{attrs:{inline:!0,model:t.tagForm},nativeOn:{submit:function(t){t.preventDefault()},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.queryTagSearch()}}},[e("el-form-item",{attrs:{label:t.$t("attribute.belongChannel")}},[e("el-select",{attrs:{size:"small",filterable:"",placeholder:t.$t("attribute.placeholderSelect")},on:{change:t.handleChannel},model:{value:t.tagForm.chlname,callback:function(e){t.$set(t.tagForm,"chlname",e)},expression:"tagForm.chlname"}},t._l(t.chlList,(function(a){return e("el-option",{key:a.value,attrs:{label:a.label,value:a.chlId}},[e("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center","max-width":"577px"}},[e("span",{style:{display:"inline-block",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",minWidth:"160px"},attrs:{title:a.label}},[t._v(t._s(a.label))]),e("span",{staticStyle:{color:"#8492a6","font-size":"13px",display:"inline-block","margin-left":"20px","text-align":"right",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis","max-width":"200px"},attrs:{title:a.chlcomment}},[t._v("\n                                    "+t._s(a.chlcomment)+"\n                                ")])])])})),1)],1),e("el-form-item",{attrs:{label:t.$t("attribute.devive")}},[e("el-select",{attrs:{size:"small",filterable:"",clearable:"",placeholder:t.$t("attribute.placeholderSelect")},on:{change:t.queryTagSearch},model:{value:t.tagForm.devname,callback:function(e){t.$set(t.tagForm,"devname",e)},expression:"tagForm.devname"}},t._l(t.devList,(function(a,r){return e("el-option",{key:r,attrs:{label:a.label,value:a.devId}},[e("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center","max-width":"577px"}},[e("span",{style:{display:"inline-block",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",minWidth:"160px"},attrs:{title:a.label}},[t._v(t._s(a.label))]),e("span",{staticStyle:{color:"#8492a6","font-size":"13px",display:"inline-block","margin-left":"20px","text-align":"right",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis","max-width":"200px"},attrs:{title:a.devcomment}},[t._v("\n                                    "+t._s(a.devcomment)+"\n                                ")])])])})),1)],1),e("el-form-item",{attrs:{label:t.$t("attribute.alarmtype")}},[e("el-select",{staticStyle:{width:"150px"},attrs:{size:"small",clearable:"",placeholder:t.$t("attribute.placeholderSelect")},on:{change:t.queryTagSearch},model:{value:t.tagForm.alarmtype,callback:function(e){t.$set(t.tagForm,"alarmtype",e)},expression:"tagForm.alarmtype"}},t._l(t.alarmtypeList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:t.$t("attribute.collectType")}},[e("el-select",{staticStyle:{width:"150px"},attrs:{size:"small",filterable:"",multiple:"","collapse-tags":"",clearable:"",placeholder:t.$t("attribute.placeholderSelect")},on:{change:t.queryTagSearch},model:{value:t.tagForm.collecttypec,callback:function(e){t.$set(t.tagForm,"collecttypec",e)},expression:"tagForm.collecttypec"}},t._l(t.funcodeList,(function(t){return e("el-option",{key:t.FuncCode,attrs:{label:t.description,value:t.FuncCode}})})),1)],1),e("el-form-item",[e("el-input",{attrs:{size:"small",placeholder:t.$t("formulacalculation.pleaseEnterTagnameOrDescription"),clearable:""},on:{clear:t.queryTagSearch},model:{value:t.tagForm.tagname,callback:function(e){t.$set(t.tagForm,"tagname",e)},expression:"tagForm.tagname"}})],1),e("el-form-item",[e("el-button",{attrs:{size:"small",icon:"el-icon-search"},on:{click:function(e){return t.queryTagSearch()}}},[t._v(t._s(t.$t("query")))])],1),e("el-form-item",[e("el-button",{attrs:{size:"small",type:"success"},on:{click:t.getDataList}},[e("i",{staticClass:"el-icon-refresh"})])],1)],1)],1),e("vxe-table",{ref:"recordTable",staticStyle:{width:"100%"},attrs:{size:"mini",border:"",resizable:"","sync-resize":"","show-overflow":"","show-header-overflow":"","highlight-hover-row":"","highlight-current-row":"","max-height":360,loading:t.dataListLoading,"row-config":{keyField:"id"},"radio-config":t.radioConfig,"checkbox-config":t.checkboxConfig,"empty-text":t.$t("formulacalculation.noData"),"scroll-y":{enabled:!0}},on:{"checkbox-all":t.selectAll,"checkbox-change":t.dataListSelectionHandleChange}},["simple"==t.tagType?e("vxe-column",{key:1,attrs:{type:"radio","header-align":"center",align:"center",width:"60",fixed:"left"}}):t._e(),"simple"!=t.tagType?e("vxe-table-column",{key:2,attrs:{type:"checkbox","header-align":"center",align:"center",width:"60",fixed:"left",checked:!1}}):t._e(),e("vxe-table-column",{key:3,attrs:{field:"tagname",title:t.$t("attribute.tagname"),"header-align":"center",align:"center",width:"210",fixed:"left","show-overflow-tooltip":!0}}),e("vxe-table-column",{key:4,attrs:{field:"tagcomment",title:t.$t("attribute.modelattribute"),"header-align":"center",align:"center",width:"180","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.row.tagcomment||t.$t("attribute.noContent")))])]}}])}),e("vxe-table-column",{key:5,attrs:{field:"alarmtype",title:t.$t("attribute.alarmtype"),"header-align":"center",align:"center",width:"100",formatter:t.formatterAlarmtype}}),e("vxe-table-column",{key:6,attrs:{field:"devname",title:t.$t("attribute.devive"),"header-align":"center",align:"center",width:"160","show-overflow-tooltip":!0}}),e("vxe-table-column",{key:7,attrs:{field:"collDescript",title:t.$t("attribute.collectCollecttypec"),"header-align":"center",align:"center",width:"140",formatter:t.formatterCollecttypec,"show-overflow-tooltip":!0}}),e("vxe-table-column",{key:8,attrs:{field:"objaddr",title:t.$t("attribute.registerAddress"),"header-align":"center",align:"center",width:"120","show-overflow-tooltip":!0}}),e("vxe-table-column",{key:9,attrs:{field:"datatype",title:t.$t("attribute.datatype"),"header-align":"center",align:"center",width:"130",formatter:t.formatterDatatype}}),e("vxe-table-column",{key:10,attrs:{field:"dataformat",title:t.$t("attribute.dataformat"),"header-align":"center",align:"center",width:"80",formatter:t.formatterDataformat}}),e("vxe-table-column",{key:11,attrs:{field:"tagrwprop",title:t.$t("attribute.tagrwprop"),"header-align":"center",align:"center",width:"80",formatter:t.formatterRwtype}})],1),e("vxe-pager",{attrs:{perfect:"",size:"mini","current-page":t.page,"page-size":t.limit,"page-sizes":[100,200,500,1e3,2e3,5e3,1e4],total:t.total,layouts:["PrevPage","JumpNumber","NextPage","FullJump","Sizes","Total"]},on:{"page-change":t.handlePageChange}}),"multiple"==t.tagType?e("div",{staticClass:"calculationTypeContainer",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center","flex-wrap":"wrap"}},[e("el-button",{attrs:{type:1==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("1")}}},[t._v(t._s(t.$t("formulacalculation.accumulate")))]),e("el-button",{attrs:{type:2==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("2")}}},[t._v(t._s(t.$t("formulacalculation.cumulativeReductionage")))]),e("el-button",{attrs:{type:3==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("3")}}},[t._v(t._s(t.$t("formulacalculation.tiring")))]),e("el-button",{attrs:{type:4==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("4")}}},[t._v(t._s(t.$t("formulacalculation.cumulativeDivision")))]),e("el-button",{attrs:{type:8==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("8")}}},[t._v(t._s(t.$t("formulacalculation.and")))]),e("el-button",{attrs:{type:9==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("9")}}},[t._v(t._s(t.$t("formulacalculation.or")))]),e("el-button",{attrs:{type:5==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("5")}}},[t._v(t._s(t.$t("formulacalculation.groupTuneEqual")))]),e("el-button",{attrs:{type:6==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("6")}}},[t._v(t._s(t.$t("formulacalculation.groupTuneAverage")))]),e("el-button",{attrs:{type:7==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("7")}}},[t._v(t._s(t.$t("formulacalculation.groupControl")))]),e("el-button",{attrs:{type:10==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("10")}}},[t._v("+")]),e("el-button",{attrs:{type:11==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("11")}}},[t._v("-")]),e("el-button",{attrs:{type:12==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("12")}}},[t._v("*")]),e("el-button",{attrs:{type:13==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("13")}}},[t._v("/")]),e("el-button",{attrs:{type:14==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("14")}}},[t._v("(")]),e("el-button",{attrs:{type:15==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("15")}}},[t._v(")")]),e("el-button",{attrs:{type:16==t.buttonType?"primary":""},on:{click:function(e){return t.handleCalculationTypeChange("16")}}},[t._v(t._s(t.$t("formulacalculation.choose"))+"——>")]),e("el-button",{on:{click:t.handleClearTextChange}},[t._v(t._s(t.$t("formulacalculation.clearInputBox")))])],1):t._e(),"multiple"==t.tagType?e("div",{staticStyle:{"margin-top":"10px"}},[e("el-input",{ref:"textInput",attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:t.$t("attribute.placeholderSelect")},on:{input:t.handleMouseDown},model:{value:t.dataForm.text,callback:function(e){t.$set(t.dataForm,"text",e)},expression:"dataForm.text"}})],1):t._e(),e("template",{slot:"footer"},[e("el-button",{on:{click:function(e){return t.handleDialogClose()}}},[t._v(t._s(t.$t("cancel")))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleDialogConfirm()}}},[t._v(t._s(t.$t("confirm")))])],1)],2)],1)},o=[],n=(a("8e6e"),a("456d"),a("ade3")),l=(a("4f7f"),a("5df3"),a("1c4c"),a("4917"),a("28a5"),a("6762"),a("2fdb"),a("c5f6"),a("55dd"),a("a481"),a("ac6a"),a("b047")),i=a.n(l);function s(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?s(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var u={props:["id"],data:function(){return{loading:!1,visible:!1,originText:"",dataForm:{id:"",cycle:1,tagId:void 0,text:"",type:0,badCode:0,sn:""},rules:{cycle:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],tagId:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],text:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]},buttonType:null,tagVisible:!1,tagType:"",tagForm:{chlname:null,devname:null,alarmtype:null,collecttypec:[],tagname:null},page:1,limit:1e3,total:0,chlList:[],storeDevMap:{},devList:[],funcodeList:[],guidList:[],selectRecordInfo:{},checkedLastRow:{},dataListLoading:!1,dataList:[],radioConfig:{highlight:!0},checkboxConfig:{checkStrictly:!1,reserve:!0,highlight:!0,checkField:"checked"},alarmtypeList:[{label:this.$t("attribute.all"),value:""},{label:this.$t("attribute.visualValue"),value:0},{label:this.$t("attribute.switchValue"),value:1}],tagrwpropList:[{label:this.$t("attribute.all"),value:""},{label:this.$t("attribute.onlyRead"),value:0},{label:this.$t("attribute.readWrite"),value:1},{label:this.$t("attribute.onlyWrite"),value:2}]}},computed:{targetName:function(){return this.dataForm.tagId?this.selectRecordInfo.tagname:""}},methods:{init:function(){this.visible=!0,this.loading=!1},handleDialogOpenChange:function(){this.$refs["dataForm"].resetFields(),this.dataForm.id=this.id,this.dataForm.sn=sessionStorage.getItem("gwsn"),this.originText="",this.dataForm.id?this.getInfo():this.selectRecordInfo={}},handleCollectTagChange:function(t){var e=this,a={gwsn:sessionStorage.getItem("gwsn")};if(e.page=1,e.tagType=t,e.$hasSessionStorageGwsn()){if(e.chlList=[],e.storeDevMap={},!e.$hasPermission("list:getChlList:select:permission.do"))return void e.$message.warning("暂无通道查询权限, 请联系管理员");e.$http.get("/list/getChlList.do",{params:a}).then((function(t){var a=t.data;if(0!=a.code)return e.$message.error(a.data||a.msg);a.data.length>0&&(a.data.forEach((function(t){if(0==t.chlType){var a=t.chlID,r={label:t.chlName,chlId:t.chlID,chlcomment:t.chlComment||e.$t("none")};e.chlList.push(r),e.storeDevMap[a]=t.dev2PojoList&&t.dev2PojoList.length>0?t.dev2PojoList:[]}})),e.chlList.length>0&&(e.tagForm.chlname=e.chlList[0].chlId,e.tagForm.devname=""),e.tagVisible=!0,"multiple"==e.tagType&&(e.checkedLastRow={}),e.$nextTick((function(){e.getFuncodeList(e.tagForm.chlname)})))})).catch((function(t){return e.addDisabled=!0,!1}))}else e.$message({showClose:!1,message:e.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})},handleChannel:function(t){this.tagForm.devname="",this.tagForm.collecttypec=[],this.getFuncodeList(t)},getFuncodeList:function(t){var e=this;if(e.$hasSessionStorageGwsn()){if(!e.$hasPermission("channelinfo:info:select:permission.do"))return void e.$message.warning("暂无通道信息查询权限, 请联系管理员");e.$http.get("/info/channelinfo/getByChliId",{params:{chlid:t,gwsn:sessionStorage.getItem("gwsn")}}).then((function(t){var a=t.data;if(0!=a.code)return e.$message.error(a.msg);e.$hasPermission("protocolinfo:select:permission.do")?e.$http.get("/info/protocolinfo/proguid",{params:{guid:a.data[0].chlprotocol}}).then((function(t){var a=t.data;e.funcodeList=JSON.parse(a.data[0].funccode).data,e.getDevlist()})):e.$message.warning("暂无协议查询权限, 请联系管理员")})).catch((function(t){return!1}))}else e.$message({showClose:!1,message:e.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})},getDevlist:function(){var t=this;t.devList=[{label:t.$t("attribute.all"),devId:"",chlId:"",devcomment:""}],t.total=0,t.dataList=[];var e=t.storeDevMap[t.tagForm.chlname];e.length>0?(e.forEach((function(e){var a={label:e.devName,chlId:t.tagForm.chlname,devId:e.devID,devcomment:e.devComment||t.$t("formulacalculation.none")};t.devList.push(a)})),t.devList.length>0?(t.devList=t.compareBySort(t.devList,"devId"),t.getDataList()):t.tagForm.devname=""):t.$refs.recordTable&&t.$refs.recordTable.loadData([]).then((function(){})).finally((function(){}))},handlePageChange:function(t){var e=t.currentPage,a=t.pageSize;this.page=e,this.limit=a,this.getDataList()},queryTagSearch:function(){var t=this;this.$hasSessionStorageGwsn()?(this.page=1,this.getDataList()):this.$message({showClose:!1,message:_this.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),t.$router.replace({path:"/tgw-tgwinfo"})}})},compareBySort:function(t,e){return t.sort((function(t,a){return t[e]-a[e]}))},getDataList:i()((function(){var t=this;if(this.$hasSessionStorageGwsn()){var e={page:this.page,limit:this.limit,sort:"id asc",tagchlid:this.tagForm.chlname,gwsn:sessionStorage.getItem("gwsn")};if(this.tagForm.devname&&(e["deviceid"]=this.tagForm.devname),null!=this.tagForm.alarmtype&&(e["alarmtype"]=this.tagForm.alarmtype),this.tagForm.collecttypec.length>0&&(e["collecttypec"]=this.tagForm.collecttypec.join(",")),this.tagForm.tagname&&(e["sname"]=this.tagForm.tagname.replace(/_/g,"\\_").replace(/%/g,"\\%")),this.dataList=[],this.total=0,!this.$hasPermission("taginfo:select:permission.do"))return void this.$message.warning("暂无测点查询权限, 请联系管理员");this.dataListLoading=!0,this.$http.get("/info/taginfo/selectTags.do",{params:e}).then((function(a){var r=a.data;t.page=e.page,t.$nextTick((function(){0!=r.code&&t.$refs.recordTable&&t.$refs.recordTable.loadData([]).then((function(){t.dataListLoading=!1})).finally((function(){return t.$message.error(r.data||r.msg)})),t.dataList=r.data.rows||[],t.$refs.recordTable&&(t.$refs.recordTable.clearCheckboxRow(),t.$refs.recordTable.loadData(t.dataList).then((function(){t.dataListLoading=!1,t.total=Number(r.data.total)||0})).finally((function(){if("simple"==t.tagType&&t.dataForm.tagId&&t.dataList.forEach((function(e){e.tagid==t.dataForm.tagId&&t.$refs.recordTable.setRadioRow(e)})),"multiple"==t.tagType){if(t.$set(t.checkboxConfig,"checkStrictly",!1),t.$refs.recordTable.setAllCheckboxRow(!1),t.originText.includes(",")&&0!=t.dataForm.type)for(var e=t.originText.split(","),a=0;a<e.length;a++)for(var r=0;r<t.dataList.length;r++)e[a]==t.dataList[r].tagname&&t.$refs.recordTable.setCheckboxRow(t.dataList[r],!0);if(t.originText&&0==t.dataForm.type)for(var o=t.dataForm.text.replaceAll("+",",").replaceAll("-",",").replaceAll("*",",").replaceAll("/",",").replaceAll(")",",").replaceAll("&&",",").replaceAll("||",",").replaceAll("GroupTone<equal>(",",").replaceAll("GroupTone<average>(",",").replaceAll("GroupControl(",","),n=o.split(","),l=0;l<n.length;l++)for(var i=0;i<t.dataList.length;i++)n[l]==t.dataList[i].tagname&&t.$refs.recordTable.setCheckboxRow(t.dataList[i],!0)}})))}))})).catch((function(e){return t.dataListLoading=!1,!1}))}else this.$message({showClose:!1,message:_this.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),t.$router.replace({path:"/tgw-tgwinfo"})}})}),100,{leading:!0,trailing:!1}),formatterAlarmtype:function(t){var e=t.row;t.column;return 0===e.alarmtype?this.$t("attribute.visualValue"):this.$t("attribute.switchValue")},formatterRwtype:function(t){var e=t.row;t.column;return 0===e.tagrwprop?this.$t("attribute.onlyRead"):1===e.tagrwprop?this.$t("attribute.readWrite"):this.$t("attribute.onlyWrite")},formatterCollecttypec:function(t){var e=t.row;t.column;if(!e.collDescript)return"";if(-1==e.collDescript.indexOf("("))return e.collDescript;var a=e.collDescript.indexOf("(");if(a>0){var r=e.collDescript.substring(0,a);return r}},formatterDatatype:function(t){var e=t.row;t.column;return 0===e.datatype?this.$t("attribute.bit"):1===e.datatype?this.$t("attribute.eightNoSymbol"):2===e.datatype?this.$t("attribute.eightSymbol"):3===e.datatype?this.$t("attribute.sixteenNoSymbol"):4===e.datatype?this.$t("attribute.sixteenSymbol"):5===e.datatype?this.$t("attribute.thirtySecondNoSymbol"):14===e.datatype?this.$t("attribute.twentyFourNoSymbol"):15===e.datatype?this.$t("attribute.twentyFourSymbol"):6===e.datatype?this.$t("attribute.thirtySecondSymbol"):7===e.datatype?this.$t("attribute.sixteenBCD"):8===e.datatype?this.$t("attribute.thirtySecondBCD"):9===e.datatype?this.$t("attribute.singleFloat"):10===e.datatype?this.$t("attribute.doubleFloat"):11===e.datatype?this.$t("attribute.string"):12===e.datatype?this.$t("attribute.sixtyFourUnsigned"):13===e.datatype?this.$t("attribute.sixtyFourSigned"):""},formatterDataformat:function(t){var e=t.row;t.column;return 0===e.dataformat?"12":1===e.dataformat?"21":2===e.dataformat?"1234":3===e.dataformat?"2143":4===e.dataformat?"3412":"4321"},selectAll:function(t){"multiple"==this.tagType&&(t.checked?this.$refs.recordTable.setAllCheckboxRow(!0):this.$refs.recordTable.clearCheckboxRow())},dataListSelectionHandleChange:function(t){var e=this;"multiple"==this.tagType&&(t.records.length>0?(this.$refs.recordTable.clearCheckboxRow(),this.checkedLastRow=t.row,t.records.forEach((function(t){e.$refs.recordTable.setCheckboxRow(t,!0)}))):this.$refs.recordTable.clearCheckboxRow())},handleMouseDown:function(t){},handleCalculationTypeChange:function(t){var e=this,a="",r=e.$refs.recordTable.getCheckboxRecords(!0),o=e.$refs.textInput.$refs.textarea.selectionStart;if(e.buttonType=Number(t),r.length>0)switch(e.buttonType){case 1:r.forEach((function(t){a+=t.tagname+"+"})),a=a.substring(0,a.length-1),e.dataForm.text?e.dataForm.text=e.dataForm.text.slice(0,o)+"+"+a+e.dataForm.text.slice(o):e.dataForm.text=a,0==o&&e.$refs.textInput.focus(),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+("+"+a).length,o+("+"+a).length),e.$refs.textInput.focus()}));break;case 2:r.forEach((function(t){a+=t.tagname+"-"})),a=a.substring(0,a.length-1),e.dataForm.text?e.dataForm.text=e.dataForm.text.slice(0,o)+"-"+a+e.dataForm.text.slice(o):e.dataForm.text=a,e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+("-"+a).length,o+("-"+a).length),e.$refs.textInput.focus()}));break;case 3:r.forEach((function(t){a+=t.tagname+"*"})),a=a.substring(0,a.length-1),e.dataForm.text?e.dataForm.text=e.dataForm.text.slice(0,o)+"*"+a+e.dataForm.text.slice(o):e.dataForm.text=a,e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+("*"+a).length,o+("*"+a).length),e.$refs.textInput.focus()}));break;case 4:r.forEach((function(t){a+=t.tagname+"/"})),a=a.substring(0,a.length-1),e.dataForm.text?e.dataForm.text=e.dataForm.text.slice(0,o)+"/"+a+e.dataForm.text.slice(o):e.dataForm.text=a,e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+("/"+a).length,o+("/"+a).length),e.$refs.textInput.focus()}));break;case 8:r.forEach((function(t){a+=t.tagname+"&&"})),a=a.substring(0,a.length-2),e.dataForm.text?e.dataForm.text=e.dataForm.text.slice(0,o)+"&&"+a+e.dataForm.text.slice(o):e.dataForm.text=a,e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+("&&"+a).length,o+("&&"+a).length),e.$refs.textInput.focus()}));break;case 9:r.forEach((function(t){a+=t.tagname+"||"})),a=a.substring(0,a.length-2),e.dataForm.text?e.dataForm.text=e.dataForm.text.slice(0,o)+"||"+a+e.dataForm.text.slice(o):e.dataForm.text=a,e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+("||"+a).length,o+("||"+a).length),e.$refs.textInput.focus()}));break;case 5:if(r.forEach((function(t){a+=t.tagname+","})),a=a.substring(0,a.length-1),e.dataForm.text){var n="",l=e.dataForm.text.match(/GroupTone<equal>\(([^)]+)\)/g);if(l){l.forEach((function(t){var e=t.match(/\(([^)]+)\)/)[1];n+=e+","}));var i=Array.from(new Set((n+a).split(","))).join(",");e.dataForm.text="GroupTone<equal>("+i+")"}else e.dataForm.text="GroupTone<equal>("+a+")"}else e.dataForm.text="GroupTone<equal>("+a+")";0==o&&e.$refs.textInput.focus(),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+("+GroupTone<equal>("+a+")").length,o+("+GroupTone<equal>("+a+")").length),e.$refs.textInput.focus()}));break;case 6:if(r.forEach((function(t){a+=t.tagname+","})),a=a.substring(0,a.length-1),e.dataForm.text){var s="",c=e.dataForm.text.match(/GroupTone<average>\(([^)]+)\)/g);if(c){c.forEach((function(t){var e=t.match(/\(([^)]+)\)/)[1];s+=e+","}));var u=Array.from(new Set((s+a).split(","))).join(",");e.dataForm.text="GroupTone<average>("+u+")"}else e.dataForm.text="GroupTone<average>("+a+")"}else e.dataForm.text="GroupTone<average>("+a+")";0==o&&e.$refs.textInput.focus(),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+("+GroupTone<average>("+a+")").length,o+("+GroupTone<average>("+a+")").length),e.$refs.textInput.focus()}));break;case 7:if(r.forEach((function(t){a+=t.tagname+","})),a=a.substring(0,a.length-1),e.dataForm.text){var d="",m=e.dataForm.text.match(/GroupControl\(([^)]+)\)/g);if(m){m.forEach((function(t){var e=t.match(/\(([^)]+)\)/)[1];d+=e+","}));var p=Array.from(new Set((d+a).split(","))).join(",");e.dataForm.text="GroupControl("+p+")"}else e.dataForm.text="GroupControl("+a+")"}else e.dataForm.text="GroupControl("+a+")";0==o&&e.$refs.textInput.focus(),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+("+GroupControl("+a+")").length,o+("+GroupControl("+a+")").length),e.$refs.textInput.focus()}));break;case 10:e.dataForm.text=e.dataForm.text.slice(0,o)+"+"+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 11:e.dataForm.text=e.dataForm.text.slice(0,o)+"-"+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 12:e.dataForm.text=e.dataForm.text.slice(0,o)+"*"+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 13:e.dataForm.text=e.dataForm.text.slice(0,o)+"/"+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 14:e.dataForm.text=e.dataForm.text.slice(0,o)+"("+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 15:e.dataForm.text=e.dataForm.text.slice(0,o)+")"+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 16:"{}"!=JSON.stringify(e.checkedLastRow)?e.dataForm.text=e.dataForm.text.slice(0,o)+e.checkedLastRow.tagname+e.dataForm.text.slice(o):e.dataForm.text=e.dataForm.text.slice(0,o)+r[r.length-1].tagname+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+r[r.length-1].tagname.length,o+r[r.length-1].tagname.length),e.$refs.textInput.focus()}));break;default:e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o,o),e.$refs.textInput.focus()}));break}else switch(e.buttonType){case 10:e.dataForm.text=e.dataForm.text.slice(0,o)+"+"+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 11:e.dataForm.text=e.dataForm.text.slice(0,o)+"-"+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 12:e.dataForm.text=e.dataForm.text.slice(0,o)+"*"+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 13:e.dataForm.text=e.dataForm.text.slice(0,o)+"/"+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 14:e.dataForm.text=e.dataForm.text.slice(0,o)+"("+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 15:e.dataForm.text=e.dataForm.text.slice(0,o)+")"+e.dataForm.text.slice(o),e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o+1,o+1),e.$refs.textInput.focus()}));break;case 16:e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o,o),e.$refs.textInput.focus()}));break;default:e.$nextTick((function(){e.$refs.textInput.$refs.textarea.setSelectionRange(o,o),e.$refs.textInput.focus()}));break}this.$refs.recordTable&&(this.$refs.recordTable.clearCheckboxRow(),this.$refs.recordTable.clearCheckboxReserve())},handleClearTextChange:function(){this.dataForm.text="",this.$refs.textInput.focus()},handleDialogClose:function(){this.tagVisible=!1,this.checkedLastRow=null},handleDialogConfirm:function(){if("simple"===this.tagType){if(this.selectRecordInfo=this.$refs.recordTable.getRadioRecord(),!this.selectRecordInfo)return this.$message.warning(this.$t("formulacalculation.aPieceDataTargetDataSource"));this.dataForm.tagId=this.selectRecordInfo.tagid,this.tagVisible=!1}else this.checkedLastRow=null,this.tagVisible=!1},getInfo:function(){var t=this;this.$hasPermission("formula:select:permission.do")?(this.loading=!0,this.$http.get("/formula/selectById.do",{params:{id:this.dataForm.id,_t:(new Date).getTime()}}).then((function(e){var a=e.data;if(0!==a.code)return t.$message.error(a.data||a.msg);t.dataForm=c(c({},t.dataForm),a.data),t.originText=t.dataForm.text,t.dataForm.text=t.formatterText(t.dataForm,t.dataForm.text),t.loading=!1,t.selectRecordInfo={tagid:a.data.tagId,tagname:a.data.tagName}})).catch((function(e){return t.loading=!1,!1}))):this.$message.warning("暂无公式信息查询权限, 请联系管理员")},formatterText:function(t,e){return 0==t.type?e:1==t.type?e.replaceAll(",","+"):2==t.type?e.replaceAll(",","-"):3==t.type?e.replaceAll(",","*"):4==t.type?e.replaceAll(",","/"):8==t.type?e.replaceAll(",","&&"):9==t.type?e.replaceAll(",","||"):5==t.type?"GroupTone<equal>("+e+")":6==t.type?"GroupTone<average>("+e+")":7==t.type?"GroupControl("+e+")":void 0},handleClose:i()((function(){this.visible=!1}),1e3,{leading:!0,trailing:!1}),dataFormSubmitHandle:i()((function(){var t=this,e="",a="",r=[];t.$hasSessionStorageGwsn()?t.$refs["dataForm"].validate((function(o){if(!o)return!1;if(t.dataForm.type=0,a=t.dataForm.text,!t.dataForm.text.includes("+")||t.dataForm.text.includes("-")||t.dataForm.text.includes("*")||t.dataForm.text.includes("/")||t.dataForm.text.includes("&&")||t.dataForm.text.includes("||")||t.dataForm.text.includes("GroupTone<equal>")||t.dataForm.text.includes("GroupTone<average>")||t.dataForm.text.includes("GroupControl")||(t.dataForm.type=1,a=t.dataForm.text.replaceAll("+",",").replaceAll("\n","").replaceAll(" ","")),!t.dataForm.text.includes("-")||t.dataForm.text.includes("+")||t.dataForm.text.includes("*")||t.dataForm.text.includes("/")||t.dataForm.text.includes("&&")||t.dataForm.text.includes("||")||t.dataForm.text.includes("GroupTone<equal>")||t.dataForm.text.includes("GroupTone<average>")||t.dataForm.text.includes("GroupControl")||(t.dataForm.type=2,a=t.dataForm.text.replaceAll("-",",").replaceAll("\n","").replaceAll(" ","")),!t.dataForm.text.includes("*")||t.dataForm.text.includes("+")||t.dataForm.text.includes("-")||t.dataForm.text.includes("/")||t.dataForm.text.includes("&&")||t.dataForm.text.includes("||")||t.dataForm.text.includes("GroupTone<equal>")||t.dataForm.text.includes("GroupTone<average>")||t.dataForm.text.includes("GroupControl")||(t.dataForm.type=3,a=t.dataForm.text.replaceAll("*",",").replaceAll("\n","").replaceAll(" ","")),!t.dataForm.text.includes("/")||t.dataForm.text.includes("+")||t.dataForm.text.includes("-")||t.dataForm.text.includes("*")||t.dataForm.text.includes("&&")||t.dataForm.text.includes("||")||t.dataForm.text.includes("GroupTone<equal>")||t.dataForm.text.includes("GroupTone<average>")||t.dataForm.text.includes("GroupControl")||(t.dataForm.type=4,a=t.dataForm.text.replaceAll("/",",").replaceAll("\n","").replaceAll(" ","")),!t.dataForm.text.includes("&&")||t.dataForm.text.includes("+")||t.dataForm.text.includes("-")||t.dataForm.text.includes("*")||t.dataForm.text.includes("/")||t.dataForm.text.includes("||")||t.dataForm.text.includes("GroupTone<equal>")||t.dataForm.text.includes("GroupTone<average>")||t.dataForm.text.includes("GroupControl")||(t.dataForm.type=8,a=t.dataForm.text.replaceAll("&&",",").replaceAll("\n","").replaceAll(" ","")),!t.dataForm.text.includes("||")||t.dataForm.text.includes("+")||t.dataForm.text.includes("-")||t.dataForm.text.includes("*")||t.dataForm.text.includes("/")||t.dataForm.text.includes("&&")||t.dataForm.text.includes("GroupTone<equal>")||t.dataForm.text.includes("GroupTone<average>")||t.dataForm.text.includes("GroupControl")||(t.dataForm.type=9,a=t.dataForm.text.replaceAll("||",",").replaceAll("\n","").replaceAll(" ","")),!t.dataForm.text.includes("GroupTone<equal>")||t.dataForm.text.includes("+")||t.dataForm.text.includes("-")||t.dataForm.text.includes("*")||t.dataForm.text.includes("/")||t.dataForm.text.includes("&&")||t.dataForm.text.includes("||")||t.dataForm.text.includes("GroupTone<average>")||t.dataForm.text.includes("GroupControl")||(t.dataForm.type=5,a=t.dataForm.text.replaceAll("GroupTone<equal>(",",").replaceAll(")","").replaceAll("\n","").replaceAll(" ","")),!t.dataForm.text.includes("GroupTone<average>")||t.dataForm.text.includes("+")||t.dataForm.text.includes("-")||t.dataForm.text.includes("*")||t.dataForm.text.includes("/")||t.dataForm.text.includes("&&")||t.dataForm.text.includes("||")||t.dataForm.text.includes("GroupTone<equal>")||t.dataForm.text.includes("GroupControl")||(t.dataForm.type=6,a=t.dataForm.text.replaceAll("GroupTone<average>(",",").replaceAll(")","").replaceAll("\n","").replaceAll(" ","")),!t.dataForm.text.includes("GroupControl")||t.dataForm.text.includes("+")||t.dataForm.text.includes("-")||t.dataForm.text.includes("*")||t.dataForm.text.includes("/")||t.dataForm.text.includes("&&")||t.dataForm.text.includes("||")||t.dataForm.text.includes("GroupTone<equal>")||t.dataForm.text.includes("GroupTone<average>")||(t.dataForm.type=7,a=t.dataForm.text.replaceAll("GroupControl(",",").replaceAll(")","").replaceAll("\n","").replaceAll(" ","")),r=JSON.parse(JSON.stringify([t.dataForm])),","==a.substring(0,1)?a=a.substr(1):","==a.substring(0,1)&&(a=a.substring(a.length-1,a.length)),r[0].text=a,t.dataForm.id){if(e="/formula/update.do",!t.$hasPermission("formula:update:permission.do"))return void t.$message.warning("暂无公式修改权限, 请联系管理员")}else if(e="/formula/insert.do",!t.$hasPermission("formula:insert:permission.do"))return void t.$message.warning("暂无公式新增权限, 请联系管理员");t.loading=!0,t.$http[t.dataForm.id?"put":"post"](e,r).then((function(e){var a=e.data;if(0!==a.code)return t.loading=!1,t.$message.error(a.data||a.msg);t.tagForm.chlname=null,t.tagForm.devname=null,t.tagForm.alarmtype=null,t.tagForm.collecttypec=[],t.tagForm.tagname=null,t.chlList=[],t.storeDevMap={},t.devList=[],t.funcodeList=[],t.guidList=[],t.selectRecordInfo={},t.buttonType=null,t.tagVisible=!1,t.tagType="",t.dataListLoading=!1,t.dataList=[],t.loading=!1,t.$message({message:t.$t("prompt.success"),type:"success",duration:500,onClose:function(){t.visible=!1,t.$emit("refreshDataList")}})})).catch((function(e){return t.loading=!1,!1}))})):t.$message({showClose:!1,message:t.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),t.$router.replace({path:"/tgw-tgwinfo"})}})}),1e3,{leading:!0,trailing:!1})}},d=u,m=(a("3476"),a("2877")),p=Object(m["a"])(d,r,o,!1,null,"53abfb47",null);e["default"]=p.exports}}]);