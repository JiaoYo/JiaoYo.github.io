(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2227b6"],{cf96:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t},opened:e.handleDialogOpenChange}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-width":(e.$i18n.locale,"120px")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.channel")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("deviceInfo.pleaseSelect")},model:{value:e.dataForm.chlid,callback:function(t){e.$set(e.dataForm,"chlid",t)},expression:"dataForm.chlid"}},e._l(e.chlList,(function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.chlId}},[t("span",{staticStyle:{width:"50%",display:"inline-block","text-align":"left",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:a.label}},[e._v(e._s(a.label))]),t("span",{staticStyle:{color:"#8492a6","font-size":"13px",display:"inline-block",width:"50%","text-align":"right",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:a.chlcomment}},[e._v(e._s(a.chlcomment||e.$t("none")))])])})),1)],1)],1),t("el-col",{attrs:{span:12}},[e.showSpecialDesign?t("div",[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devname"),prop:"devname"}},[t("el-input",{ref:"devname",attrs:{placeholder:e.$t("deviceInfo.devname"),maxlength:48,clearable:""},model:{value:e.dataForm.devname,callback:function(t){e.$set(e.dataForm,"devname","string"===typeof t?t.trim():t)},expression:"dataForm.devname"}})],1)],1):t("div",[e.dataForm.id?e._e():t("el-form-item",{attrs:{label:e.$t("deviceInfo.devname"),prop:"devname"}},[t("tooltip",{attrs:{placement:"top-left",mode:"manual",visible:e.tooltipTransdevicevisible}},[t("div",{attrs:{slot:"outlet"},slot:"outlet"}),t("div",{attrs:{slot:"tooltip"},slot:"tooltip"},[e._v(e._s(e.$t("deviceInfo.addMulitipeTransDevname")))])]),t("el-input",{ref:"devname",attrs:{placeholder:e.$t("deviceInfo.devname"),maxlength:48,clearable:""},model:{value:e.dataForm.devname,callback:function(t){e.$set(e.dataForm,"devname","string"===typeof t?t.trim():t)},expression:"dataForm.devname"}})],1),e.dataForm.id?t("el-form-item",{attrs:{label:e.$t("deviceInfo.devname"),prop:"devname"}},[t("el-input",{ref:"devname",attrs:{placeholder:e.$t("deviceInfo.devname"),maxlength:48,clearable:""},model:{value:e.dataForm.devname,callback:function(t){e.$set(e.dataForm,"devname","string"===typeof t?t.trim():t)},expression:"dataForm.devname"}})],1):e._e()],1)]),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devcommaddr"),prop:"devcommaddr"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.devicecommaddr"),maxlength:64,clearable:""},model:{value:e.dataForm.devcommaddr,callback:function(t){e.$set(e.dataForm,"devcommaddr",t)},expression:"dataForm.devcommaddr"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devpublicaddr"),prop:"devpublicaddr"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.canEmpty"),maxlength:64,clearable:""},model:{value:e.dataForm.devpublicaddr,callback:function(t){e.$set(e.dataForm,"devpublicaddr",t)},expression:"dataForm.devpublicaddr"}})],1)],1),e.showSpecialDesign?e._e():t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devmanu"),prop:"devmanu"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("deviceInfo.pleaseSelect")},on:{change:e.handleManu},model:{value:e.dataForm.devmanu,callback:function(t){e.$set(e.dataForm,"devmanu",t)},expression:"dataForm.devmanu"}},e._l(e.devManuList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e.showSpecialDesign?e._e():t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devmodel"),prop:"devmodel"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("deviceInfo.pleaseSelect")},model:{value:e.dataForm.devmodel,callback:function(t){e.$set(e.dataForm,"devmodel",t)},expression:"dataForm.devmodel"}},e._l(e.devModelList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e.showSpecialDesign?e._e():t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.reserve0"),prop:"reserve0"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.canEmpty"),maxlength:64,clearable:""},model:{value:e.dataForm.reserve0,callback:function(t){e.$set(e.dataForm,"reserve0",t)},expression:"dataForm.reserve0"}})],1)],1),e.showSpecialDesign?e._e():t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.reserve1"),prop:"reserve1"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.canEmpty"),maxlength:64,clearable:""},model:{value:e.dataForm.reserve1,callback:function(t){e.$set(e.dataForm,"reserve1",t)},expression:"dataForm.reserve1"}})],1)],1),e.showSpecialDesign?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.protocolEnergyCode"),prop:"devmanu"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.pleaseEnterTheProtocolEnergyCode"),maxlength:64,clearable:""},model:{value:e.dataForm.devmanu,callback:function(t){e.$set(e.dataForm,"devmanu",t)},expression:"dataForm.devmanu"}})],1)],1):e._e(),e.showSpecialDesign?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.comPort"),prop:"reserve1"}},[t("el-input",{attrs:{placeholder:e.$t("deviceInfo.canEmpty"),clearable:"",oninput:"value=value.replace(/^(0+)|[^\\d]+/g, '')",maxlength:2},model:{value:e.dataForm.reserve1,callback:function(t){e.$set(e.dataForm,"reserve1","string"===typeof t?t.trim():t)},expression:"dataForm.reserve1"}})],1)],1):e._e()],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deviceInfo.equipmentAvailability"),prop:"valid"}},[t("el-radio-group",{model:{value:e.dataForm.valid,callback:function(t){e.$set(e.dataForm,"valid",t)},expression:"dataForm.valid"}},[t("el-radio",{attrs:{label:0}},[e._v(e._s(e.$t("yes")))]),t("el-radio",{attrs:{label:2}},[e._v(e._s(e.$t("no")))])],1)],1)],1)],1),t("el-row",[t("el-form-item",{attrs:{label:e.$t("deviceInfo.devcomment"),prop:"devcomment"}},[t("el-input",{attrs:{type:"textarea",maxlength:24,autosize:{minRows:2,maxRows:4},placeholder:e.$t("attribute.pleaceEnterContent")},nativeOn:{keydown:function(t){return e.handleKeydown.apply(null,arguments)}},model:{value:e.dataForm.devcomment,callback:function(t){e.$set(e.dataForm,"devcomment",t)},expression:"dataForm.devcomment"}})],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},o=[],n=(a("8e6e"),a("456d"),a("ade3")),i=(a("c5f6"),a("96cf"),a("1da1")),d=(a("ac6a"),a("55dd"),a("3b2b"),a("4917"),a("a481"),a("4328")),l=a.n(d),s=a("b047"),c=a.n(s);function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var u={props:["queryParams"],data:function(){var e=this;return{showSpecialDesign:!1,storeChlId:"",visible:!1,loading:!1,tooltipTransdevicevisible:!0,chlList:[],devList:[],protocolMap:{},paramsData:[],dataForm:{id:"",chlid:"",devname:"",devcommaddr:"1",devpublicaddr:"1",devmanu:"",devmodel:"",reserve0:"",reserve1:"",devcomment:"",ptype:1,modeltype:0,gwsn:"",devid:"",valid:0},devManuList:[],devModelList:[],rules:{chlid:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],devname:[{required:!0,message:this.$t("validate.required"),trigger:"change"},{validator:function(t,a,r){if(e.dataForm.id){var o=/^[a-zA-Z0-9-_#\[\.\]\\u4e00-\u9fa5]+$/,n=o.test(a);if(!n)return r(new Error(e.$t("deviceInfo.devnameNoSpecial")));r()}else if(a)if(-1!=a.indexOf("-")){var i=Math.abs(a.substring(a.lastIndexOf("-")).replace(/[^0-9]/gi,""));if(null==a.substring(0,a.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)||null==a.substring(a.lastIndexOf("-"),a.length).match(/(\d+)[^0-9]*$/))return r(new Error(e.$t("deviceInfo.devnameNoRules")));var d=a.substring(0,a.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],l=i-d+1;if(l<=0)return r(new Error(e.$t("deviceInfo.devnameNoRules")));var s=a.lastIndexOf("-"),c=a.substring(0,s),m=a.substring(s+1,a.length),v=/^[a-zA-Z0-9_#\[\.\]\u4e00-\u9fa5]+$/,u=v.test(c),p=new RegExp("^[0-9]([0-9])*$").test(m);if(!u)return r(new Error(e.$t("deviceInfo.devnameNoSpecial")));if(!p)return r(new Error(e.$t("deviceInfo.devnameNoRules")));r()}else{var h=/^[a-zA-Z0-9_#\[\.\]\\u4e00-\u9fa5]+$/,f=h.test(a);if(!f)return r(new Error(e.$t("deviceInfo.devnameNoSpecial")));r()}},trigger:"change"}],devcommaddr:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){this.visible=!0},handleDialogOpenChange:function(){this.getchlList()},handleKeydown:function(e){"Enter"===e.key&&e.preventDefault()},compareBySort:function(e,t){return e.sort((function(e,a){return e[t]-a[t]}))},getchlList:function(){var e=this,t=this,a={gwsn:sessionStorage.getItem("gwsn")};if(t.$hasSessionStorageGwsn()){if(t.chlList=[],t.devList=[],!t.$hasPermission("list:getChlList:select:permission.do"))return void t.$message.warning("暂无通道查询权限, 请联系管理员");t.$http.get("/list/getChlList.do",{params:a}).then((function(a){var r=a.data;if(0!=r.code)return t.$message.error(r.data||r.msg);if(r.data.length>0){if(r.data.forEach((function(e){if(1==e.chlType){var a={label:e.chlName,value:e.id,chlId:e.chlID,chlcomment:e.chlComment};t.chlList.push(a)}else t.devList=t.devList.concat(e.hasOwnProperty("dev2PojoList")?e.dev2PojoList:[])})),t.chlList=t.compareBySort(e.chlList,"chlId"),t.devList=t.devList.filter((function(e){return e.hasOwnProperty("modeltype")&&2==e.modeltype})),!(t.chlList.length>0))return t.$message.warning(t.$t("deviceInfo.noForwardingChannelPleaseCreateForwardingChannel"));if(t.dataForm.id){for(var o=0;o<t.chlList.length;o++)if(t.dataForm.chlid==t.chlList[o].chlId){t.dataForm.devid=t.chlList[o].chlId;break}}else if(t.queryParams.chlId){for(var n=0;n<t.chlList.length;n++)if(t.queryParams.chlId==t.chlList[n].chlId){t.dataForm.chlid=t.chlList[n].chlId;break}}else t.dataForm.chlid=t.chlList[0].chlId;t.$nextTick((function(){t.$http.post("/ProcotolTemplate/getAu.do",{}).then((function(e){var a=e.data;0!=a.code?(t.showSpecialDesign=!1,t.visible=!0,t.loading=!0,t.getProtocolList((function(){t.$nextTick(Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$refs["dataForm"].resetFields(),t.$refs.devname.focus(),e.next=1,t.getdevModelList();case 1:if(!t.dataForm.id){e.next=3;break}return e.next=2,t.getInfo();case 2:e.next=4;break;case 3:t.dataForm.devname=t.$t("deviceInfo.defaultTransDevname");case 4:case"end":return e.stop()}}),e)}))))}))):(t.showSpecialDesign=!0,t.visible=!0,t.loading=!0,t.getProtocolList((function(){t.$nextTick(Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$refs["dataForm"].resetFields(),!t.dataForm.id){e.next=2;break}return e.next=1,t.getInfo();case 1:e.next=3;break;case 2:t.loading=!1;case 3:case"end":return e.stop()}}),e)}))))})))})).catch((function(e){t.showSpecialDesign=!1,t.visible=!0,t.loading=!0,t.getProtocolList((function(){t.$nextTick(Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$refs["dataForm"].resetFields(),t.$refs.devname.focus(),e.next=1,t.getdevModelList();case 1:if(!t.dataForm.id){e.next=3;break}return e.next=2,t.getInfo();case 2:e.next=4;break;case 3:t.dataForm.devname=t.$t("deviceInfo.defaultTransDevname");case 4:case"end":return e.stop()}}),e)}))))}))}))}))}})).catch((function(e){return!1}))}else t.$message({showClose:!1,message:t.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),t.$router.replace({path:"/tgw-tgwinfo"})}})},getProtocolList:function(e){var t=this,a={page:1,limit:2e3};t.protocolMap={},t.$hasPermission("ProcotolTemplate:select:permission.do")?t.$http.get("/ProcotolTemplate/selectPage.do",{params:a}).then((function(a){var r=a.data;0!=r.code||r.data.list.forEach((function(e){t.protocolMap[e.id]=e.proEnergyTypeCode})),e()})).catch((function(t){e()})):t.$message.warning("暂无协议模板查询权限, 请联系管理员")},handleDeviceChange:function(e){for(var t=0;t<this.devList.length;t++)e==this.devList[t].devName&&(this.dataForm.devcommaddr=this.devList[t].devCommAddr,this.dataForm.reserve0=this.protocolMap[this.devList[t].templateid]||"")},getdevModelList:function(){var e=this,t=[],a={};e.devManuList=[],e.$hasPermission("devtypeinfo:selectlistAll:permission.do")?e.$http.post("/info/devtypeinfo/listAll",l.a.stringify({})).then((function(r){var o=r.data,n=o.data;if(n.length>0){for(var i=0;i<n.length;i++){var d=n[i].devPlatform;a[d]||(t.push(n[i]),a[d]=!0)}t.forEach((function(t){var a={label:t.platformName,value:t.devPlatform};e.devManuList.push(a)})),e.dataForm.id||(e.dataForm.devmanu=-1,e.handleManu(e.dataForm.devmanu))}})).catch((function(e){return!1})):e.$message.warning("暂无设备型号查询权限, 请联系管理员")},handleManu:function(e){var t=this,a={devPlatform:e};t.devModelList=[],t.$hasPermission("devtypeinfo:selectlistAll:permission.do")?t.$http.post("/info/devtypeinfo/listAll",l.a.stringify(a)).then((function(a){var r=a.data,o=r.data;if(o.length>0){if(o.forEach((function(e){var a={label:e.devDesc,value:e.devIndex};t.devModelList.push(a)})),t.dataForm.id)if(-1==e)t.dataForm.devmodel=t.devModelList[0].value;else{for(var n=!1,i=0;i<t.devModelList.length;i++){var d=t.devModelList[i];if(t.dataForm.devmodel==d.value){n=!0,t.loading=!1;break}}n||(t.loading=!1,t.dataForm.devmodel=t.devModelList[0].value)}else t.dataForm.devmodel=t.devModelList[0].value;t.loading=!1}})).catch((function(e){return!1})):t.$message.warning("暂无设备型号查询权限, 请联系管理员")},getInfo:function(){var e=this;this.$hasPermission("deviceinfo:selectById:permission.do")?(this.loading=!0,this.$http.get("/info/deviceinfo/".concat(this.dataForm.id)).then((function(t){var a=t.data;if(0!==a.code)return e.$message.error(a.data||a.msg);e.showSpecialDesign||(a.data.devmanu=Number(a.data.devmanu),a.data.devmodel=Number(a.data.devmodel)),e.dataForm=v(v({},e.dataForm),a.data),e.storeChlId=e.dataForm.chlid,e.showSpecialDesign?e.loading=!1:e.handleManu(a.data.devmanu)})).catch((function(e){return!1}))):this.$message.warning("暂无设备信息查询权限, 请联系管理员")},handleClose:function(){this.dataForm.id="",this.dataForm.chlid="",this.storeChlId="",this.visible=!1},dataFormSubmitHandle:c()((function(){var e=this,t="",a=null;if(this.$hasSessionStorageGwsn()){if(this.dataForm.id){if(!this.$hasPermission("deviceinfo:update:permission.do"))return void this.$message.warning("暂无转发设备修改权限, 请联系管理员");if(this.storeChlId!=this.dataForm.chlid&&!this.$hasPermission("channelinfo:updateDevicesChlId:permission.do"))return void this.$message.warning("暂无转发设备修改所属通道权限, 请联系管理员")}else if(!this.$hasPermission("deviceinfo:insert:permission.do"))return void this.$message.warning("暂无转发设备新增权限, 请联系管理员");this.paramsData=[],this.$refs["dataForm"].validate((function(r){if(!r)return!1;e.loading=!0,a=e.showSpecialDesign?{devname:e.dataForm.devname,chlid:e.dataForm.chlid,reserve0:e.dataForm.reserve0,reserve1:e.dataForm.reserve1,devcomment:e.dataForm.devcomment,devcommaddr:e.dataForm.devcommaddr,devpublicaddr:e.dataForm.devpublicaddr,gwsn:sessionStorage.getItem("gwsn"),modeltype:2,ptype:1,valid:e.dataForm.valid}:{devname:e.dataForm.devname,chlid:e.dataForm.chlid,devmanu:e.dataForm.devmanu,devmodel:e.dataForm.devmodel,reserve0:e.dataForm.reserve0,reserve1:e.dataForm.reserve1,devcomment:e.dataForm.devcomment,devcommaddr:e.dataForm.devcommaddr,devpublicaddr:e.dataForm.devpublicaddr,gwsn:sessionStorage.getItem("gwsn"),modeltype:0,ptype:1,valid:e.dataForm.valid},e.dataForm.id?(t="/info/deviceinfo",a["id"]=e.dataForm.id,a["devid"]=e.dataForm.devid):t="/info/deviceinfo/insert.do",e.$http[e.dataForm.id?"put":"post"](t,a).then((function(t){var a=t.data;if(0!=a.code)return e.loading=!1,e.$message.error(a.data||a.msg);e.dataForm.id?e.storeChlId==e.dataForm.chlid?e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataForm.id="",e.dataForm.chlid="",e.storeChlId="",e.loading=!1,e.visible=!1,e.$emit("refreshDataList")}}):e.$http.get("/info/channelinfo/updateDevicesChlId.do",{params:{sn:sessionStorage.getItem("gwsn"),deviceIds:e.dataForm.devid,chlId:e.dataForm.chlid,type:1}}).then((function(t){var a=t.data;if(0!=a.code)return e.loading=!1,e.$message.error(a.data||a.msg);e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataForm.id="",e.dataForm.chlid="",e.storeChlId="",e.loading=!1,e.visible=!1,e.$emit("refreshDataList")}})})):e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.dataForm.id="",e.dataForm.chlid="",e.storeChlId="",e.loading=!1,e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(t){return e.dataForm.id="",e.dataForm.chlid="",e.storeChlId="",e.loading=!1,e.visible=!1,e.$emit("refreshDataList")}))}))}else this.$message({showClose:!1,message:this.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})}),1e3,{leading:!0,trailing:!1})}},p=u,h=a("2877"),f=Object(h["a"])(p,r,o,!1,null,null,null);t["default"]=f.exports}}]);