(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3496949e"],{1280:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,"label-position":"left","label-width":"140px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"devPlatform",label:"网关编号"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入网关编号",readonly:""},model:{value:e.dataForm.sns,callback:function(t){e.$set(e.dataForm,"sns",t)},expression:"dataForm.sns"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"way",label:"升级方式"}},[t("el-radio-group",{model:{value:e.dataForm.way,callback:function(t){e.$set(e.dataForm,"way",t)},expression:"dataForm.way"}},[t("el-radio",{attrs:{label:0}},[e._v("覆盖授权")]),t("el-radio",{attrs:{label:1}},[e._v("合并授权")])],1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",[t("template",{slot:"label"},[t("h3",{staticStyle:{margin:"0"}},[e._v("基础授权")])])],2)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"softwareName"}},[t("template",{slot:"label"},[t("el-checkbox",{model:{value:e.dataForm.softwareChecked,callback:function(t){e.$set(e.dataForm,"softwareChecked",t)},expression:"dataForm.softwareChecked"}},[e._v("软件名称")])],1),t("el-input",{attrs:{placeholder:"请输入软件名称",clearable:""},model:{value:e.dataForm.softwareName,callback:function(t){e.$set(e.dataForm,"softwareName",t)},expression:"dataForm.softwareName"}})],2)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"expireTime"}},[t("template",{slot:"label"},[t("el-checkbox",{model:{value:e.dataForm.expireTimeChecked,callback:function(t){e.$set(e.dataForm,"expireTimeChecked",t)},expression:"dataForm.expireTimeChecked"}},[e._v("过期时间")])],1),t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"请选择过期时间",align:"right",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions},model:{value:e.dataForm.expireTime,callback:function(t){e.$set(e.dataForm,"expireTime",t)},expression:"dataForm.expireTime"}})],2)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"tagCount"}},[t("template",{slot:"label"},[t("el-checkbox",{model:{value:e.dataForm.tagCountChecked,callback:function(t){e.$set(e.dataForm,"tagCountChecked",t)},expression:"dataForm.tagCountChecked"}},[e._v("测点数量")])],1),t("el-input",{attrs:{placeholder:"请输入测点数量",clearable:""},model:{value:e.dataForm.tagCount,callback:function(t){e.$set(e.dataForm,"tagCount",t)},expression:"dataForm.tagCount"}})],2)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",[t("template",{slot:"label"},[t("h3",{staticStyle:{margin:"0"}},[e._v("扩展授权")])])],2)],1),e._l(e.protocolInfoList,(function(a,o){return t("el-col",{key:o,attrs:{span:24}},[t("el-form-item",[t("template",{slot:"label"},[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminateObj[o]},on:{change:function(t){return e.handleCheckAllChange(t,o)}},model:{value:e.checkAllObj[o],callback:function(t){e.$set(e.checkAllObj,o,t)},expression:"checkAllObj[index]"}},[t("div",{attrs:{title:a.label}},[e._v("\n                                "+e._s(a.label)+"\n                                ")])])],1),t("el-checkbox-group",{on:{change:function(t){return e.handleCheckedProtocolChange(t,o)}},model:{value:e.checkedObj[o],callback:function(t){e.$set(e.checkedObj,o,t)},expression:"checkedObj[index]"}},e._l(a.children,(function(a){return t("el-checkbox",{key:a.value,attrs:{label:a.value}},[t("div",{attrs:{title:a.label}},[e._v("\n                                "+e._s(a.label)+"\n                                ")])])})),1)],2)],1)}))],2)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v("生成授权任务")])],1)],2)},r=[],n=a("2909"),i=(a("456d"),a("7f7f"),a("ac6a"),a("bc3a")),l=a.n(i),s=a("b047"),c=a.n(s),d={props:["sns"],data:function(){return{visible:!1,loading:!1,checked:!0,checkAllObj:{},isIndeterminateObj:{},checkedObj:{},dataForm:{sns:"",way:0,softwareChecked:!0,softwareName:"",expireTimeChecked:!0,expireTime:"",tagCountChecked:!0,tagCount:""},rules:{sns:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],way:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],softwareName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],expireTime:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],tagCount:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]},protocolInfoMap:{},protocolInfoList:[],pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]}}},methods:{init:function(){this.getDefaultProtocolInfoList()},getDefaultProtocolInfoList:function(){var e=this,t=this,a=(new Date).getTime();l.a.get(window.location.origin+"/licenseupgrade.json?_t="+a).then((function(a){var o=a.data;if(t.protocolInfoList=o,t.checkAllObj={},t.isIndeterminateObj={},t.checkedObj={},t.protocolInfoList.forEach((function(e,a){t.$set(t.checkAllObj,a,!1),t.$set(t.isIndeterminateObj,a,!1),t.$set(t.checkedObj,a,[])})),!(t.protocolInfoList.length>0))return t.$message.error("暂未获取到相应的扩展授权");t.visible=!0,t.$nextTick((function(){t.$refs["dataForm"].resetFields(),t.dataForm.sns=e.sns}))}))},handleCheckAllChange:function(e,t){this.checkedObj[t]=e?this.protocolInfoMap[t]:[],this.isIndeterminateObj[t]=!1},handleCheckedProtocolChange:function(e,t){var a=e.length;this.checkAllObj[t]=a===this.protocolInfoMap[t].length,this.isIndeterminateObj[t]=a>0&&a<this.protocolInfoMap[t].length},getprotocolinfoList:function(){var e=this;e.protocolInfoMap={},e.$http.get("/info/groupinfo/getNode").then((function(t){var a=t.data,o=a.data;o.length>0&&(o.forEach((function(t){if(-1!==t.upgroupid||-1!==t.groupname.indexOf("*")){var a={label:t.groupname,value:String(t.groupid),children:[]};e.protocolInfoMap[String(t.groupid)]=a}})),e.getThirdData())})).catch((function(e){return!1}))},getThirdData:function(){var e=this;e.$http.get("/info/protocolinfo/proGuidAll",{params:{}}).then((function(t){var a=t.data;a.data.forEach((function(t){if(e.protocolInfoMap.hasOwnProperty(t.groupid)){var a={label:t.name,value:String(t.id)};e.protocolInfoMap[String(t.groupid)].children.push(a)}})),e.getFinallyData()})).catch((function(e){return!1}))},getFinallyData:function(){var e=this;for(var t in this.protocolInfoMap)0==this.protocolInfoMap[t].children.length&&delete this.protocolInfoMap[t];this.checkAllObj={},this.isIndeterminateObj={},this.checkedObj={},Object.keys(this.protocolInfoMap).forEach((function(t,a){e.$set(e.checkAllObj,a,!1),e.$set(e.isIndeterminateObj,a,!1),e.$set(e.checkedObj,a,[])})),Object.keys(this.protocolInfoMap).length>0&&(this.visible=!0,this.$nextTick((function(){e.$refs["dataForm"].resetFields(),e.dataForm.sns=e.sns})))},handleClose:c()((function(){this.visible=!1}),1e3,{leading:!0,trailing:!1}),dataFormSubmitHandle:c()((function(){var e=this,t=[],a={gwSn:e.dataForm.sns,name:e.dataForm.softwareName,ovDate:e.dataForm.expireTime,tnum:e.dataForm.tagCount,protocolIdList:[]};e.$refs["dataForm"].validate((function(o){if(!o)return!1;if(!e.dataForm.softwareChecked)return e.$message.error("请勾选软件名称");if(!e.dataForm.expireTimeChecked)return e.$message.error("请勾选过期时间");if(!e.dataForm.tagCountChecked)return e.$message.error("请勾选测点数量");for(var r in e.checkedObj)e.checkedObj[r]&&(t=[].concat(Object(n["a"])(t),Object(n["a"])(e.checkedObj[r])));if(0==t.length)return e.$message.error("请选择扩展授权信息");a["protocolIdList"]=t,e.loading=!0,e.$http.post("/conf/ation/wg_authorize",a).then((function(t){var a=t.data;if(0!=a.code)return e.loading=!1,e.$message.error(a.msg);e.loading=!1,e.$message.success(a.msg),e.visible=!1})).catch((function(t){return e.visible=!1,!1}))}))}),1e3,{leading:!0,trailing:!1})}},m=d,u=(a("47a9"),a("2877")),h=Object(u["a"])(m,o,r,!1,null,"eb807828",null);t["default"]=h.exports},"47a9":function(e,t,a){"use strict";a("f5e2")},f5e2:function(e,t,a){}}]);