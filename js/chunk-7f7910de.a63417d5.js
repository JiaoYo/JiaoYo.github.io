(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f7910de"],{"0753":function(e,t,n){},2:function(e,t){},3:function(e,t){},"31a0":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e._self._c;return t("section",[t("el-header",{staticStyle:{height:"50px"}},[t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("span",[e._v("Â Â Â Â ")]),t("span",[e._v(e._s(e.$t("chlwatch.gwsn")))]),t("span",{staticClass:"colorConfig"},[e._v(e._s(e.dataForm.sn))]),t("span",[e._v("Â Â Â Â ")]),t("span",[e._v(e._s(e.$t("chlwatch.lineStatus")))]),t("span",{staticClass:"statusWrap",style:{backgroundColor:0==e.dataForm.status?"#ffa500":1==e.dataForm.status||2==e.dataForm.status?"#0f0":"#ffa500"}}),t("span",{class:0==e.dataForm.status?"colorConfig redConfig":"colorConfig"},[e._v(e._s(0==e.dataForm.status?"å…³é—­":1==e.dataForm.status?"è¿è¡Œ":2==e.dataForm.status?"æ­£åœ¨è¿è¡Œ(æ— æ³•èŽ·å–é…ç½®)":"å…³é—­"))]),t("span",[e._v("Â Â Â Â ")]),t("span",[e._v(e._s("ä»£ç†ç±»åž‹ï¼š"))]),t("span",{staticClass:"colorConfig"},[e._v(e._s(0==e.dataForm.type?"è‡ªå®šä¹‰ä¸²å£":1==e.dataForm.type?"å—ç½‘åŠ å¯†":2==e.dataForm.type?"æœ¬æœºç»ˆç«¯":3==e.dataForm.type?"è‡ªå®šä¹‰SSH/TELNET":4==e.dataForm.type?"è‡ªå®šä¹‰HTTP/HTTPS":99==e.dataForm.type?"å—ç‘žåŠ å¯†":"è‡ªå®šä¹‰ä¸²å£"))]),t("span",[e._v("Â Â Â Â ")]),0==e.dataForm.type||3==e.dataForm.type||4==e.dataForm.type||99==e.dataForm.type?t("span",[e._v(e._s(3==e.dataForm.type||4==e.dataForm.type?"IP:":"COM:"))]):e._e(),0==e.dataForm.type||3==e.dataForm.type||4==e.dataForm.type?t("span",{staticClass:"colorConfig",staticStyle:{"margin-left":"5px"}},[e._v(e._s(e.dataForm.com))]):e._e(),0==e.dataForm.type||3==e.dataForm.type||4==e.dataForm.type?t("span",[e._v("Â Â Â Â ")]):e._e(),2!=e.dataForm.type?t("span",[e._v(e._s(3==e.dataForm.type||4==e.dataForm.type?"ç«¯å£: ":"æ³¢ç‰¹çŽ‡:"))]):e._e(),2!=e.dataForm.type?t("span",{staticClass:"colorConfig",staticStyle:{"margin-left":"5px"}},[e._v(e._s(e.dataForm.baud))]):e._e(),t("span",[e._v("Â Â Â Â ")]),t("span",[e._v(e._s("å­—ä½“å¤§å°ï¼š"))]),t("span",{staticClass:"colorConfig",staticStyle:{margin:"0 5px"}},[e._v(e._s(e.xtremFontSize))]),t("el-button-group",[t("el-button",{attrs:{size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.handleAddOrReduceFontSizeChange("add")}}},[e._v("å¢žå¤§")]),t("el-button",{attrs:{size:"small",icon:"el-icon-remove-outline"},on:{click:function(t){return e.handleAddOrReduceFontSizeChange("reduce")}}},[e._v("å‡å°")])],1),t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s("å­—ç¬¦ç¼–ç ï¼š"))]),t("el-select",{attrs:{size:"small",placeholder:"è¯·é€‰æ‹©å­—ç¬¦ç¼–ç "},model:{value:e.characterEncoding,callback:function(t){e.characterEncoding=t},expression:"characterEncoding"}},[t("el-option",{attrs:{label:"UTF-8",value:"utf-8"}}),t("el-option",{attrs:{label:"GBK",value:"gbk"}})],1)],1),"readAndWrite"===e.userPermission?t("div",{staticStyle:{"padding-right":"20px"}},[t("el-button",{staticClass:"search-btn",attrs:{loading:e.closeConsoleLoading,size:"mini"},on:{click:function(t){e.closeConsoleLoading=!0,e.handleCloseConsoleChange()}}},[e._v("\n                å…³é—­ä»£ç†\n            ")])],1):e._e()]),e.xtremLoading?t("div",{staticClass:"box",staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[e._m(0)]):t("div",{staticClass:"box"},[t("div",{staticClass:"xterm-box",attrs:{id:"xterm"}})]),t("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:e.handleFileSelect}}),t("el-dialog",{attrs:{visible:e.checkSnAndPwdVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.checkSnAndPwdVisible=t}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleCheckSnAndPwdConfirmChange.apply(null,arguments)}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.checkSnAndPwdLoading,expression:"checkSnAndPwdLoading"}],ref:"checkSnAndPwdRef",attrs:{rules:e.rules,model:e.checkSnAndPwdForm,"label-width":"80px"}},[t("el-row",[t("el-col",{attrs:{xl:24,md:24,sm:24}},[t("el-form-item",{attrs:{prop:"sn",label:"ç½‘å…³ç¼–å·"}},[t("el-input",{attrs:{readonly:""},model:{value:e.checkSnAndPwdForm.sn,callback:function(t){e.$set(e.checkSnAndPwdForm,"sn",t)},expression:"checkSnAndPwdForm.sn"}})],1)],1),t("el-col",{attrs:{xl:24,md:24,sm:24}},[t("el-form-item",{attrs:{prop:"pwd",label:"ç½‘å…³å¯†ç "}},[t("el-input",{ref:"input",attrs:{placeholder:"è¯·è¾“å…¥ç½‘å…³å¯†ç ",clearable:"","show-password":""},model:{value:e.checkSnAndPwdForm.pwd,callback:function(t){e.$set(e.checkSnAndPwdForm,"pwd",t)},expression:"checkSnAndPwdForm.pwd"}})],1)],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleCheckSnAndPwdConfirmChange}},[e._v(e._s(e.$t("confirm")))])],1)],1),t("el-dialog",{attrs:{title:"æç¤º",visible:e.dialogVisible,width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleCloseConsoleNoDialogChange},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("span",[e._v("æ‚¨å·²ç»ä¸‰åˆ†é’Ÿæ— æ“ä½œï¼Œè¿žæŽ¥å·²è‡ªåŠ¨æ–­å¼€")]),"readAndWrite"===e.userPermission?t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleCloseConsoleNoDialogChange}},[e._v("å…³é—­")])],1):e._e()]),t("el-dialog",{attrs:{title:"æç¤º",visible:e.forceCloseDialogVisible,width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleCloseForceCloseDialogChange},on:{"update:visible":function(t){e.forceCloseDialogVisible=t}}},[t("span",[e._v("è¯¥ç»ˆç«¯å·²è¢«å…¶ä»–ç”¨æˆ·å…³é—­ï¼Œç‚¹å‡»ç¡®è®¤å…³é—­å½“å‰é¡µé¢ã€‚")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleCloseForceCloseDialogChange}},[e._v("ç¡®è®¤å…³é—­")])],1)])],1)},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"dot-spinner"},[t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"}),t("div",{staticClass:"dot-spinner__dot"})])}],i=(n("ac4d"),n("8a81"),n("5df3"),n("1c4c"),n("96cf"),n("1da1")),s=(n("7f7f"),n("53ca")),a=n("2909"),c=(n("28a5"),n("34ef"),n("6b54"),n("a481"),n("b047")),l=n.n(c),d=n("fcf3"),u=n("47d0"),m=(n("173c"),n("abb2"),n("a78e")),f=n.n(m),h=n("7c1c"),p=n.n(h),g=n("ed08"),w=n("acf9"),k=n.n(w);function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=S(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}function S(e,t){if(e){if("string"==typeof e)return y(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var v=new u["FitAddon"],T={name:"xterm",data:function(){return{consoleStatus:1,htmlContent:"",characterEncoding:"utf-8",userPermission:"",xtremFontSize:15,xtremLoading:!0,dataForm:{sn:"",com:"",baud:null,type:null,status:null,model:null},xterm:null,terminalSocket:"",WebSocketUrl:"",lockReconnect:!1,timeout:28e3,timeoutObj:null,timeoutnum:null,pasteHandler:null,idleTimeout:18e4,idleTimer:null,lastActivityTime:null,checkSnAndPwdVisible:!1,checkSnAndPwdLoading:!1,checkSnAndPwdForm:{sn:"",pwd:""},dialogVisible:!1,forceCloseDialogVisible:!1,rules:{pwd:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]},websocket:null,resname:"",wsUrl:"",getMQTTTimer:null,closeConsoleLoading:!1,closeConsoleDisabled:!1,uploadFileList:[],zsentry:null,currentZsession:null,broadcastChannel:null}},mounted:function(){var e=this,t=0,n=0;if(!f.a.get("token"))return e.$router.replace({name:"login"}).catch((function(e){return!1})),!1;window.addEventListener("beforeunload",(function(){t=(new Date).getTime()})),window.addEventListener("unload",(function(){n=(new Date).getTime()-t,n<=5&&e.handleCloseConsoleDirectChange()}));var o=e.$route.query;e.checkSnAndPwdForm.sn=o.sn,e.checkSnAndPwdForm.pwd=sessionStorage.getItem("pwd")||"",e.dataForm.sn=o.sn,e.dataForm.type=o.type,e.dataForm.com=o.com,e.dataForm.baud=o.baud,e.dataForm.status=o.status,e.dataForm.model=o.model,e.checkSnAndPwdLoading=!1,e.setupCloseListener(),e.checkSnAndPwdForm.pwd?(e.checkSnAndPwdLoading=!0,e.$http.get("/info/tgwinfo/tgwinfoNameAndPwd",{params:{gwsn:e.checkSnAndPwdForm.sn,pwd:e.checkSnAndPwdForm.pwd}}).then((function(t){var n=t.data;if("fail"==n.msg)e.$message.error(n.data),e.checkSnAndPwdForm.pwd="",e.checkSnAndPwdLoading=!1,e.checkSnAndPwdVisible=!0;else{e.checkSnAndPwdLoading=!1,e.checkSnAndPwdVisible=!1;var o=Object(g["h"])(),r="",i=String((new Date).getTime()),s={sn:e.checkSnAndPwdForm.sn,pwd:e.checkSnAndPwdForm.pwd},a=JSON.stringify(s);r=Object(g["e"])(o+i+a),a=Object(g["p"])(a),r=Object(g["p"])(r),e.WebSocketUrl=window.SITE_CONFIG["socketUrl"].replace("8092","8093")+"tcpWebsocket/"+e.stringToHex(a)+"/"+e.stringToHex(r)+"/"+i+"/"+o,setTimeout((function(){e.init(e.WebSocketUrl)}),2e3)}})).catch((function(e){return!1}))):e.checkSnAndPwdVisible=!0},beforeDestroy:function(){this.close(),this.timeoutObj&&clearTimeout(this.timeoutObj),this.timeoutnum&&clearTimeout(this.timeoutnum),this.idleTimer&&clearTimeout(this.idleTimer),this.xterm&&(this.xterm.textarea.removeEventListener("paste",this.pasteHandler),this.xterm.element.removeEventListener("paste",this.pasteHandler)),this.websocket&&(this.websocket.close(),this.websocket=null)},methods:{setupCloseListener:function(){var e=this;"undefined"!==typeof BroadcastChannel&&(e.broadcastChannel=new BroadcastChannel("terminal_".concat(e.dataForm.sn)),e.broadcastChannel.onmessage=function(t){try{var n=JSON.parse(t.data);"terminal_closed"===n.type&&"readAndWrite"!==e.userPermission&&e.handleOtherInstanceClosed(n),"terminal_force_closed"===n.type&&e.handleInitiativeClosedChange(n)}catch(o){}})},handleOtherInstanceClosed:function(e){"onlyRead"===this.userPermission&&(this.close(),this.forceCloseDialogVisible=!0)},handleInitiativeClosedChange:function(e){this.close(),this.forceCloseDialogVisible=!0},handleCloseForceCloseDialogChange:function(){this.forceCloseDialogVisible=!1,window.opener?window.close():window.location.replace("about:blank")},handleAddOrReduceFontSizeChange:function(e){"add"===e?this.xtremFontSize++:this.xtremFontSize--,this.xterm.options.fontSize=this.xtremFontSize,v.fit()},stringToHex:function(e){for(var t=/[\u4E00-\u9FA5]/,n=[],o=0;o<e.length;o++){var r="";r=t.test(e.charAt(o))?encodeURI(e.charAt(o)).replace(/%/g,""):e.charCodeAt(o).toString(16),n.push(r)}return e=n.join(""),e},handleCheckSnAndPwdConfirmChange:function(){var e=this;e.$refs["checkSnAndPwdRef"].validate((function(t){if(!t)return!1;e.checkSnAndPwdLoading=!0,e.$http.get("/info/tgwinfo/tgwinfoNameAndPwd",{params:{gwsn:e.checkSnAndPwdForm.sn,pwd:e.checkSnAndPwdForm.pwd}}).then((function(t){var n=t.data;if("fail"==n.msg)e.$message.error(n.data),e.checkSnAndPwdForm.pwd="",e.checkSnAndPwdLoading=!1;else{e.checkSnAndPwdLoading=!1,e.checkSnAndPwdVisible=!1;var o=Object(g["h"])(),r="",i=String((new Date).getTime()),s={sn:e.checkSnAndPwdForm.sn,pwd:e.checkSnAndPwdForm.pwd},a=JSON.stringify(s);r=Object(g["e"])(o+i+a),a=Object(g["p"])(a),r=Object(g["p"])(r),e.WebSocketUrl=window.SITE_CONFIG["socketUrl"].replace("8092","8093")+"tcpWebsocket/"+e.stringToHex(a)+"/"+e.stringToHex(r)+"/"+i+"/"+o,e.init(e.WebSocketUrl)}})).catch((function(e){return!1}))}))},reconnect:function(){var e=this;e.lockReconnect||(e.lockReconnect=!0,e.timeoutnum&&clearTimeout(e.timeoutnum),e.timeoutnum=setTimeout((function(){e.init(e.WebSocketUrl),e.lockReconnect=!1}),2e3))},start:function(){var e=this;e.timeoutObj&&clearTimeout(e.timeoutObj),e.timeoutObj=setInterval((function(){1==e.terminalSocket.readyState&&e.terminalSocket&&e.terminalSocket.send("")}),e.timeout)},resetIdleTimer:function(){var e=this;clearTimeout(e.idleTimer),e.lastActivityTime=Date.now(),e.idleTimer=setTimeout((function(){"onlyRead"!==e.userPermission&&e.closeConnection()}),e.idleTimeout)},closeConnection:function(){this.close(),this.dialogVisible=!0},initXterm:function(){var e=this;e.xterm&&e.xterm.dispose(),e.xterm=new d["Terminal"]({rendererType:"canvas",convertEol:!0,disableStdin:!0,cursorBlink:!0,fontSize:e.xtremFontSize,theme:{cursor:"#00FF00",background:"#060101"}}),e.xterm.open(document.getElementById("xterm")),e.xterm.focus(),e.xterm.loadAddon(v),v.fit(),e.xterm.onData((function(t){e.resetIdleTimer(),"utf-8"===e.characterEncoding?"\r"===t?e.terminalSocket&&e.terminalSocket.send(e.strToUint8("\n")):"[A"===t?e.terminalSocket&&e.terminalSocket.send(e.strToUint8("[A")):"[B"===t?e.terminalSocket&&e.terminalSocket.send(e.strToUint8("[B")):"\t"===t?e.terminalSocket&&e.terminalSocket.send(e.strToUint8("\t")):"[3~"===t?e.terminalSocket&&e.terminalSocket.send(e.strToUint8("[3~")):e.terminalSocket&&e.terminalSocket.send(e.strToUint8(t)):"\r"===t?e.terminalSocket&&e.terminalSocket.send(e.strGbkToUint8("\n")):"[A"===t?e.terminalSocket&&e.terminalSocket.send(e.strGbkToUint8("[A")):"[B"===t?e.terminalSocket&&e.terminalSocket.send(e.strGbkToUint8("[B")):"\t"===t?e.terminalSocket&&e.terminalSocket.send(e.strGbkToUint8("\t")):"[3~"===t?e.terminalSocket&&e.terminalSocket.send(e.strGbkToUint8("[3~")):e.terminalSocket&&e.terminalSocket.send(e.strGbkToUint8(t))}))},init:function(e){var t=this;t.terminalSocket=new WebSocket(e),t.terminalSocket.binaryType="arraybuffer",t.terminalSocket.onopen=t.open,t.terminalSocket.onerror=t.error,t.terminalSocket.onmessage=t.getMessage,t.terminalSocket.onsend=t.send},open:function(){var e=this;e.xtremLoading=!1,e.dialogVisible=!1,e.$nextTick((function(){e.initXterm()})),e.resetIdleTimer(),e.start(),setTimeout((function(){4==e.dataForm.type&&e.terminalSocket&&e.terminalSocket.send(e.strToUint8("GET / HTTP/1.1\r\nHost: "+e.dataForm.com+":"+e.dataForm.baud+"\r\n\r\n"))}),1e3)},error:function(){this.$message.error("ä¸‹ä½æœºæœªè¿žæŽ¥ï¼Œè¯·ç¨åŽå†è¯•"),this.reconnect()},close:function(){this.terminalSocket&&this.terminalSocket.close(),this.xterm&&(this.xterm.options.disableStdin=!0),this.idleTimer&&clearTimeout(this.idleTimer)},hexToArrayBuffer:function(e){e=e.replace(/\s+/g,"");for(var t=e.length/2,n=new ArrayBuffer(t),o=new Uint8Array(n),r=0;r<t;r++)o[r]=parseInt(e.substr(2*r,2),16);return n},convertToArrayBuffer:function(e){if(e instanceof ArrayBuffer)return e;if(e instanceof Uint8Array)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"===typeof e){var t=e.trim();if(/^([0-9a-fA-F]{2}(\s+|$))+$/.test(t)){var n,o=t.split(/\s+/).filter((function(e){return e.length>0})),r=b(o);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!/^[0-9a-fA-F]{2}$/.test(i))return null}}catch(u){r.e(u)}finally{r.f()}for(var s=o.length,a=new ArrayBuffer(s),c=new Uint8Array(a),l=0;l<s;l++){var d=parseInt(o[l],16);c[l]=d}return a}return this.hexToArrayBuffer(e)}return null},detectZmodemHeader:function(e){if(!e||e.length<4)return!1;if("readAndWrite"!==this.userPermission)return!1;for(var t=[42,42,24,66],n=0;n<=e.length-4;n++){for(var o=!0,r=0;r<4;r++)if(e[n+r]!==t[r]){o=!1;break}if(o)return!0}return!1},initZmodemSentry:function(){var e=this;e.zsentry&&"function"===typeof e.zsentry.destroy&&(e.zsentry.destroy(),e.zsentry=null),e.zsentry=new p.a.Sentry({to_terminal:function(t){"utf-8"===e.characterEncoding?e.xterm.write(t):e.xterm.write(e.decodeFromArrayBuffer(t))},on_detect:function(t){if("readAndWrite"===e.userPermission){var n,o=t.confirm();if(o)n="receive"===o.type?e.downloadFile(o):e.uploadFile(o),n.then((function(){try{o.close()}catch(t){}try{e.zsentry.destroy()}catch(n){}e.zsentry=null,e.initZmodemSentry()})).catch((function(t){try{o.close()}catch(n){}try{e.zsentry.destroy()}catch(r){}e.zsentry=null,e.initZmodemSentry(),setTimeout((function(){e.terminalSocket&&e.terminalSocket.send(e.strToUint8("\r\n"))}),500)}))}else t.skip()},on_retract:function(){e.zsentry=null},sender:function(t){"readAndWrite"===e.userPermission&&e.terminalSocket.send(new Uint8Array(t))}})},getMessage:function(e){var t=this;if("è¿žæŽ¥æˆåŠŸ"!==e.data){if("onlyRead"==e.data||"readAndWrite"==e.data)return t.userPermission=e.data,void("onlyRead"==e.data?(t.zsentry&&"function"===typeof t.zsentry.destroy&&t.zsentry.destroy(),t.xterm&&(t.xterm.options.disableStdin=!0,t.xterm.options.cursorBlink=!1,t.$message.info("æ­¤ç»ˆç«¯å·²æœ‰ä¸€ä¸ªè¿œç¨‹è¿žæŽ¥ï¼Œæ‚¨å½“å‰ä»…æœ‰åªè¯»æƒé™"))):(t.initZmodemSentry(),t.xterm&&(t.xterm.options.disableStdin=!1,t.xterm.options.cursorBlink=!0)));var n=t.convertToArrayBuffer(e.data);if(!n)return;var o=new Uint8Array(n);if("readAndWrite"===t.userPermission)try{if(t.zsentry){var r=t.zsentry.consume(o);if(r)return}}catch(i){t.terminalSocket&&t.terminalSocket.send(t.strToUint8("\r\n"))}else{if(t.detectZmodemHeaderOnlyRead(o))return;"utf-8"===t.characterEncoding?t.xterm.write(o):t.xterm.write(t.decodeFromArrayBuffer(o))}}},decodeDecimalArrayToString:function(e){var t="";return t=String.fromCharCode.apply(String,Object(a["a"])(e)),t},decodeFromArrayBuffer:function(e){try{var t=k.a.decode(e,"gbk");return t}catch(n){}},detectZmodemHeaderOnlyRead:function(e){if(!e||e.length<2)return!1;if(42===e[0]&&42===e[1])return!0;if(24===e[0]||42===e[0])return!0;var t=this.uint8ToString(e);return/^(B[0-9A-F]{2,8}|rz|sz|ZModem)/i.test(t)},uint8ToString:function(e){var t=new TextDecoder("utf-8");return t.decode(e)},strToUint8:function(e){return(new TextEncoder).encode(e)},strGbkToUint8:function(e){var t=k.a.encode(e,"gbk");return new Uint8Array(t).buffer},send:function(e){this.terminalSocket&&this.terminalSocket.send(e)},handleCloseDialogChange:function(){this.close(),this.dialogVisible=!1,this.closeConsoleLoading=!1,window.opener?(window.opener.postMessage({type:"fromChildWindow",data:"refresh"},"*"),window.close()):window.location.replace("about:blank")},handleReconnectChange:function(){this.xterm&&this.xterm.dispose(),this.init(this.WebSocketUrl)},handleCloseConsoleDirectChange:function(){"readAndWrite"===this.userPermission&&0!=this.consoleStatus&&window.opener.postMessage({type:"closeConsole",timestamp:Date.now()},"*")},handleCloseConsoleNoDialogChange:l()((function(){var e=this,t=e.$randomStrFun(),n=String(parseInt((new Date).getTime().toString().substring(0,10)));if("readAndWrite"!==e.userPermission)return e.handleCloseDialogChange(),!1;var o={start:0,type:2,com:"/bin/bash",baud:e.dataForm.baud,server:"dingiiot.com",port:9015},r=Object(g["p"])(JSON.stringify(o));e.resname="setconsole",e.$nextTick((function(){e.wsUrl="consoleWebscoket/setconsole/"+e.checkSnAndPwdForm.sn+"/"+e.stringToHex(r)+"/"+e.$md5(e.stringToHex(r)+t+n)+"/"+n,e.createWebSocket(),e.closeConsoleLoading=!0,e.getMQTTTimer=setTimeout((function(){if(e.closeConsoleLoading)return e.closeConsoleLoading=!1,e.websocket&&"setconsole"==e.resname&&(e.websocket.close(),e.websocket=null),e.getMQTTTimer&&(clearTimeout(e.getMQTTTimer),e.getMQTTTimer=null),e.$message.error(e.$t("issue.timeout"))}),"30000")}))}),1e3,{leading:!0,trailing:!1}),handleCloseConsoleChange:l()((function(){var e=this,t=e.$randomStrFun(),n=String(parseInt((new Date).getTime().toString().substring(0,10)));e.$confirm("ç¡®å®šè¦å…³é—­ä»£ç†å—?","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}).then((function(){var o={start:0,type:2,com:"/bin/bash",baud:e.dataForm.baud,server:"dingiiot.com",port:9015},r=Object(g["p"])(JSON.stringify(o));e.resname="setconsole",e.$nextTick((function(){e.wsUrl="consoleWebscoket/setconsole/"+e.checkSnAndPwdForm.sn+"/"+e.stringToHex(r)+"/"+e.$md5(e.stringToHex(r)+t+n)+"/"+n,e.createWebSocket(),e.closeConsoleLoading=!0,e.getMQTTTimer=setTimeout((function(){if(e.closeConsoleLoading)return e.closeConsoleLoading=!1,e.websocket&&"setconsole"==e.resname&&(e.websocket.close(),e.websocket=null),e.getMQTTTimer&&(clearTimeout(e.getMQTTTimer),e.getMQTTTimer=null),e.$message.error(e.$t("issue.timeout"))}),"30000")}))})).catch((function(){e.closeConsoleLoading=!1}))}),1e3,{leading:!0,trailing:!1}),createWebSocket:function(){var e=this;if(e.websocket&&(e.websocket.close(),e.websocket=null),e.getMQTTTimer&&(clearTimeout(e.getMQTTTimer),e.getMQTTTimer=null),!("WebSocket"in window))return e.$message.error(e.$t("websocket.notSupportWebsocket"));try{var t=window.SITE_CONFIG["socketUrl"]+e.wsUrl;e.websocket=new WebSocket(t),e.initWebSocket()}catch(n){}},initWebSocket:function(){this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onmessage=this.websocketonmessage,this.websocket.onclose=this.websocketonclose},websocketonopen:function(){},websocketonerror:function(e){this.closeConsoleLoading=!1},isJsonString:function(e){if("string"===typeof e)try{var t=JSON.parse(e);return!("object"!==Object(s["a"])(t)||!t)}catch(n){return!1}},websocketonmessage:function(e){var t=this;if(!this.isJsonString(e.data))return!1;if(this.getMQTTTimer&&(clearTimeout(this.getMQTTTimer),this.getMQTTTimer=null),this.websocket&&(this.websocket.close(),this.websocket=null),"setconsole"===this.resname&&"setconsole"==JSON.parse(e.data).res_name){var n=JSON.parse(e.data).res_content;if(1===n.successed){if(this.consoleStatus=0,this.$message.success("å…³é—­ä»£ç†æˆåŠŸ"),"readAndWrite"===this.userPermission){var o=JSON.stringify({type:"terminal_closed",sn:this.checkSnAndPwdForm.sn,timestamp:Date.now(),source:"readAndWrite"});if("undefined"!==typeof BroadcastChannel){var r=new BroadcastChannel("terminal_".concat(this.checkSnAndPwdForm.sn));r.postMessage(o),r.close()}}setTimeout((function(){t.handleCloseDialogChange()}),1e3)}else this.$message.error("å…³é—­ä»£ç†å¤±è´¥")}},websocketonclose:function(e){2!=e.currentTarget.readyState&&3!=e.currentTarget.readyState&&this.websocket&&(this.websocket.close(),this.websocket=null)},send_files:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=[],r=0,i=t.length-1;i>=0;i--){var s=t[i];r+=s.size,o[i]={obj:s,name:s.name,size:s.size,mtime:new Date(s.lastModified),files_remaining:t.length-i,bytes_remaining:r}}var a=0;function c(){var t=o[a];return t?(a++,e.send_offer(t).then((function(o){return o?(n.on_offer_response&&n.on_offer_response(t.obj,o),new Promise((function(r,i){var s=new FileReader;s.onerror=function(e){i(e)},s.onprogress=function(r){if(r.target.result){var i=new Uint8Array(r.target.result).slice(o.get_offset());if(e.aborted())return;o.send(i),n.on_progress&&n.on_progress(t.obj,o,i)}},s.onload=function(i){if(!e.aborted()){var s=new Uint8Array(i.target.result);0===s.length?o.end().then((function(){n.on_file_complete&&n.on_file_complete(t.obj,o),r(c())})):o.end(s).then((function(){n.on_progress&&n.on_progress(t.obj,o,s),n.on_file_complete&&n.on_file_complete(t.obj,o),r(c())}))}},s.readAsArrayBuffer(t.obj)}))):c()}))):Promise.resolve()}return c()},updateProgress:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n,o,r,i,s,a,c=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=c.length>1&&void 0!==c[1]?c[1]:"upload",o=t.get_details(),r=o.name,i=o.size,s=t.get_offset(),a=0===i||i===s?100:Math.round(s/i*100),this.xterm.write("\r".concat(n," ").concat(r,": ").concat(this.bytesHuman(s)," ").concat(this.bytesHuman(i)," ").concat(a,"%"));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),uploadFile:function(e){var t=this;return"send"!==e.type?(e.close(),Promise.reject("Invalid session type for upload")):(this.currentZsession=e,new Promise((function(e){t.resolveUploadPromise=e,t.$refs.fileInput.click()})))},closeZmodemCurrentZsession:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{this.currentZsession._last_header_name="ZRINIT",this.currentZsession.close()}catch(t){}e||this.terminalSocket&&this.terminalSocket.send(this.strToUint8("\r\n"))},handleFileSelect:function(e){this.uploadFileList=Array.from(e.target.files),this.handleUploadConfirm()},handleUploadConfirm:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this,n=t.uploadFileList,n&&0!==n.length){e.next=1;break}return t.closeZmodemCurrentZsession(),e.abrupt("return");case 1:return e.prev=1,e.next=2,t.send_files(t.currentZsession,n,{on_offer_response:function(e,n){n?t.xterm.write("\r\n"):(t.xterm.write(e.name+" was skipped\r\n"),t.closeZmodemCurrentZsession())},on_progress:function(e,n){t.updateProgress(n)},on_file_complete:function(e,n){t.xterm.write("\r\n".concat(e.name," upload complete\r\n"))}});case 2:e.next=4;break;case 3:e.prev=3,o=e["catch"](1),t.$message.error("File upload failed: "+o.message),t.currentZsession.abort();case 4:return e.prev=4,t.resolveUploadPromise&&t.resolveUploadPromise(),t.uploadFileList=[],t.$refs.fileInput.value="",e.finish(4);case 5:case"end":return e.stop()}}),e,this,[[1,3,4,5]])})));function t(){return e.apply(this,arguments)}return t}(),save_to_disk:function(e,t){var n=t,o=e.get_details().name,r=new Blob(n,{type:"application/octet-stream"}),i=document.createElement("a");i.href=URL.createObjectURL(r),i.download=o,i.click(),URL.revokeObjectURL(i.href)},downloadFile:function(e){var t=this;e.on("offer",(function(e){var n=function(){if(e.get_details().size>4294967296)return e.skip(),void t.$message.warning("".concat(e.get_details().name," è¶…è¿‡ 4G, æ— æ³•ä¸‹è½½"));var n=[];e.on("input",(function(o){t.updateProgress(e,"download"),n.push(new Uint8Array(o))})),e.accept().then((function(){t.save_to_disk(e,n)})).catch((function(){}))};n()}));var n=new Promise((function(n){e.on("session_end",(function(){t.terminalSocket&&t.terminalSocket.send(t.strToUint8("\r\n")),n()}))}));return e.start(),n},bytesHuman:function(e,t){if(!/^([-+])?|(\.\d+)(\d+(\.\d+)?|(\d+\.)|Infinity)$/.test(e))return"-";if(0===e)return"0";"undefined"===typeof t&&(t=1);var n=["B","KB","MB","GB","TB","PB","EB","ZB","YB","BB"],o=Math.floor(Math.log(e)/Math.log(1024)),r=(e/Math.pow(1024,Math.floor(o))).toFixed(t);return"".concat(r," ").concat(n[o])}}},C=T,_=(n("5917"),n("2877")),F=Object(_["a"])(C,o,r,!1,null,"3254a2ae",null);t["default"]=F.exports},5917:function(e,t,n){"use strict";n("0753")}}]);