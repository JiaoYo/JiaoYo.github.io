(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c1dac7ba"],{"491d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.visible,title:t.dataForm.id?t.$t("update"):t.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e},opened:t.openFun}},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",attrs:{model:t.dataForm,rules:t.rules,"label-width":"en-US"===t.$i18n.locale?"150px":"120px"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.dataFormSubmitHandle()}}},[e("el-form-item",{attrs:{label:"项目名称",prop:"prjId"}},[e("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:t.handlePrjScroll,expression:"handlePrjScroll"}],staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:t.$t("select")},on:{"visible-change":t.handlePrjVisibleChange},model:{value:t.dataForm.prjId,callback:function(e){t.$set(t.dataForm,"prjId",e)},expression:"dataForm.prjId"}},[[e("div",{staticStyle:{width:"100%",position:"absolute",left:"0",top:"0","z-index":"99","background-color":"#fff"}},[e("el-input",{ref:"prjInput",staticStyle:{width:"98%","margin-left":"1%","margin-top":"5px","margin-bottom":"5px"},attrs:{size:"small",clearable:"",placeholder:t.$t("gwsn.pleaseEnterSearchContent")},model:{value:t.prjSearch,callback:function(e){t.prjSearch=e},expression:"prjSearch"}})],1),e("div",{staticStyle:{width:"100%",height:"42px"}}),t._l(t.prjList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.prjName,value:t.id,disabled:!!t.hasOwnProperty("disabled")&&t.disabled}})}))]],2)],1),e("el-form-item",{attrs:{label:"网关编号",prop:"sn"}},[e("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:t.handleGwsnScroll,expression:"handleGwsnScroll"}],staticStyle:{width:"100%"},attrs:{clearable:""},on:{"visible-change":t.handleGwsnVisibleChange},model:{value:t.dataForm.sn,callback:function(e){t.$set(t.dataForm,"sn",e)},expression:"dataForm.sn"}},[[e("div",{staticStyle:{width:"100%",position:"absolute",left:"0",top:"0","z-index":"99","background-color":"#fff"}},[e("el-input",{ref:"gwsnInput",staticStyle:{width:"98%","margin-left":"1%","margin-top":"5px","margin-bottom":"5px"},attrs:{size:"small",clearable:"",placeholder:t.$t("gwsn.pleaseEnterSearchContent")},model:{value:t.gwsnSearch,callback:function(e){t.gwsnSearch=e},expression:"gwsnSearch"}})],1),e("div",{staticStyle:{width:"100%",height:"42px"}}),t._l(t.tgwList,(function(a){return e("el-option",{key:a.sn,attrs:{label:a.sn,value:a.sn,disabled:!!a.hasOwnProperty("disabled")&&a.disabled}},[e("span",{staticStyle:{width:"calc(100% - 210px)",display:"inline-block","text-align":"left",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:a.sn}},[t._v("\n                            "+t._s(a.sn)+"\n                        ")]),e("span",{staticStyle:{color:"#8492a6","font-size":"13px",display:"inline-block","margin-left":"10px",width:"200px","text-align":"right",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:a.gwDesc}},[t._v("\n                            "+t._s(a.gwDesc||t.$t("historyQuery.no"))+"\n                        ")])])}))]],2)],1),e("el-form-item",{attrs:{label:"过户用户名",prop:"transname"}},[e("el-input",{attrs:{placeholder:"请输入过户用户名",clearable:""},model:{value:t.dataForm.transname,callback:function(e){t.$set(t.dataForm,"transname","string"===typeof e?e.trim():e)},expression:"dataForm.transname"}})],1),e("el-form-item",{attrs:{label:"过户用户手机号",prop:"transmobile"}},[e("el-input",{attrs:{maxlength:11,placeholder:"请输入过户用户手机号"},nativeOn:{keyup:function(e){return t.mobileValidate.apply(null,arguments)}},model:{value:t.dataForm.transmobile,callback:function(e){t.$set(t.dataForm,"transmobile",e)},expression:"dataForm.transmobile"}})],1)],1),e("template",{slot:"footer"},[e("el-button",{on:{click:t.handleClose}},[t._v(t._s(t.$t("cancel")))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.dataFormSubmitHandle()}}},[t._v(t._s(t.$t("confirm")))])],1)],2)},r=[],n=(a("7f7f"),a("c5f6"),a("a481"),a("4328")),i=a.n(n),l=a("b047"),o=a.n(l),d=a("61f7"),c={props:["id"],directives:{loadmore:{inserted:function(t,e){var a=t.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var t=this.scrollHeight-Math.ceil(this.scrollTop)<=this.clientHeight;t&&0!==this.scrollTop&&e.value()}))}}},data:function(){return{isCloseDialog:!1,visible:!1,loading:!1,prjPage:1,prjTotal:0,prjSearch:"",prjList:[],gwsnPage:1,gwsnTotal:0,gwsnSearch:"",tgwList:[],queryParamas:{},oldGwsnDesc:"",dataForm:{prjId:"",sn:"",transname:"",transmobile:""},rules:{prjId:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],sn:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],transname:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],transmobile:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){this.visible=!0},openFun:function(){var t=this;t.isCloseDialog=!1,t.$refs["dataForm"].resetFields(),t.dataForm.id=t.id,t.prjPage=1,t.prjTotal=0,t.prjList=[],t.gwsnPage=1,t.gwsnTotal=0,t.tgwList=[],t.getList(),t.getAllGwsnDataList(),t.dataForm.id?t.$http.get("/transSn/getById.do",{params:{id:t.dataForm.id}}).then((function(e){var a=e.data;if(0!=a.code)return t.$message.error(a.data||a.msg);t.gwsnSearch=a.data.sn,t.dataForm.sn=a.data.sn,t.oldGwsnDesc=a.data.sn,t.dataForm.transname=a.data.tname,t.dataForm.prjId=a.data.pid})).catch((function(t){return!1})):t.getAllGwsnDataList()},mobileValidate:function(){this.dataForm.transmobile=this.dataForm.transmobile.replace(/[^\.\d]/g,""),this.dataForm.transmobile=this.dataForm.transmobile.replace(".","")},getList:function(){var t=this,e={page:t.prjPage,limit:50,prjname:t.prjSearch.replace(/\s+/g,""),_t:(new Date).getTime()};t.loading=!0,t.$http.get("/transSn/getProByUser.do",{params:e}).then((function(e){var a=e.data;if(0!=a.code)return t.$message.error(a.data||a.msg);1==t.prjPage?t.prjList=a.data.list:t.prjList=t.prjList.concat(a.data.list),t.prjTotal=Number(a.data.total),0==t.prjList.length?(t.loading=!1,t.prjList.push({id:t.$t("noMatchingDataYet"),prjName:t.$t("noMatchingDataYet"),disabled:!0})):(t.prjId&&(t.dataForm.prjId=t.prjId,t.getAllGwsnDataList()),t.loading=!1)})).catch((function(e){return t.loading=!1,!1}))},handlePrjVisibleChange:function(t){var e=this;t&&this.$nextTick((function(){e.$refs.prjInput.focus()}))},handlePrjScroll:function(){this.prjList.length<this.prjTotal&&(this.prjPage++,this.getList())},getAllGwsnDataList:function(){var t=this,e={pageNum:t.gwsnPage,pageSize:200,fuzzy:t.gwsnSearch,_t:(new Date).getTime()};t.$http.post("/info/gwbaseinfo/selectByPage.do",i.a.stringify(e)).then((function(e){var a=e.data;if(a.hasOwnProperty("code")&&0!=a.code)return t.$message.error(a.data||a.msg);1==t.gwsnPage?t.tgwList=a.data.list:t.tgwList=t.tgwList.concat(a.data.list),0==t.tgwList.length&&t.tgwList.push({sn:t.$t("noMatchingDataYet"),gwDesc:t.$t("noMatchingDataYet"),disabled:!0}),t.gwsnTotal=Number(a.data.total)})).catch((function(t){return!1}))},handleGwsnVisibleChange:function(t){var e=this;t&&this.$nextTick((function(){e.$refs.gwsnInput.focus()}))},handleGwsnScroll:function(){this.tgwList.length<this.gwsnTotal&&(this.gwsnPage++,this.getAllGwsnDataList())},handleClose:function(){this.isCloseDialog=!0,this.prjSearch="",this.gwsnSearch="",this.visible=!1},dataFormSubmitHandle:o()((function(){var t=this,e=null;t.$refs["dataForm"].validate((function(a){return!!a&&(Object(d["b"])(t.dataForm.transmobile)?void(t.$store.state.user.name!==t.dataForm.transname.trim()?t.$http.get("/transSn/getIdByUname.do",{params:{uname:t.dataForm.transname,mobile:t.dataForm.transmobile}}).then((function(a){var s=a.data;if(0!=s.code)t.$message.error(s.data||s.msg);else{if(!s.data)return t.$message.warning("暂无该用户，请确认后在进行操作"),!1;t.dataForm.id?(e=t.oldGwsnDesc===t.dataForm.sn?[{id:t.dataForm.id,pid:t.dataForm.prjId,tuid:s.data}]:[{id:t.dataForm.id,pid:t.dataForm.prjId,sn:t.dataForm.sn,tuid:s.data}],t.$http.put("/transSn/update.do",e).then((function(e){var a=e.data;if(0!=a.code)return t.$message.error(a.data||a.msg);t.$message({message:t.$t("prompt.success"),type:"success",duration:500,onClose:function(){t.isCloseDialog=!0,t.prjSearch="",t.gwsnSearch="",t.visible=!1,t.$emit("refreshDataList")}})})).catch((function(t){return!1}))):(e=[{sn:t.dataForm.sn,pid:t.dataForm.prjId,tuid:s.data}],t.$http.post("/transSn/insert.do",e).then((function(e){var a=e.data;if(0!=a.code)return t.$message.error(a.data||a.msg);t.$message({message:t.$t("prompt.success"),type:"success",duration:500,onClose:function(){t.isCloseDialog=!0,t.prjSearch="",t.gwsnSearch="",t.visible=!1,t.$emit("refreshDataList")}})})).catch((function(t){return!1})))}})).catch((function(t){return!1})):t.$message.warning("禁止过户给自己，请重新操作")):t.$message.error("请输入正确的手机号"))}))}),1e3,{leading:!0,trailing:!1}),watchPrjSearch:o()((function(){var t=document.getElementsByClassName("el-scrollbar__wrap").length;document.getElementsByClassName("el-scrollbar__wrap")[t-1].scrollTo(0,0),this.prjPage=1,this.getList(),this.$refs.prjInput.focus()}),500),watchGwsnSearch:o()((function(){var t=document.getElementsByClassName("el-scrollbar__wrap").length;document.getElementsByClassName("el-scrollbar__wrap")[t-1].scrollTo(0,0),this.gwsnPage=1,this.getAllGwsnDataList(),this.$refs.gwsnInput.focus()}),500)},watch:{prjSearch:function(t,e){this.isCloseDialog||this.watchPrjSearch()},gwsnSearch:function(t,e){this.isCloseDialog||this.watchGwsnSearch()}}},p=c,m=(a("fcb2"),a("2877")),g=Object(m["a"])(p,s,r,!1,null,"5eb70a8f",null);e["default"]=g.exports},a4e1:function(t,e,a){},fcb2:function(t,e,a){"use strict";a("a4e1")}}]);