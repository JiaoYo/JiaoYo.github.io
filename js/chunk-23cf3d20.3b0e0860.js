(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-23cf3d20"],{"06fb":function(e,t,n){e.exports=n.p+"img/check.4be9fcc6.png"},"0b67":function(e,t,n){"use strict";n("8995")},"3b5a":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e._self._c;return t("section",[t("el-header",{staticStyle:{height:"auto",padding:"10px 20px","margin-bottom":"10px"}},[t("div",[t("span",[e._v(e._s(e.$t("chlwatch.project")))]),t("span",{staticClass:"colorConfig"},[e._v(e._s(e.projectName))]),t("span",[e._v("    ")]),t("span",[e._v(e._s(e.$t("scriptCode.scripname"))+":")]),t("span",{staticClass:"colorConfig",staticStyle:{"margin-left":"5px"}},[e._v(e._s(e.scriptInfo.scriptname))]),t("span",[e._v("    ")]),t("span",[e._v(e._s(e.$t("chlwatch.gwsn")))]),t("span",{staticClass:"colorConfig"},[e._v(e._s(e.scriptInfo.gwSn)),t("span",[e._v(e._s("("+e.gwDesc+")"))])]),t("span",[e._v("    ")]),t("span",[e._v(e._s(e.$t("chlwatch.activeTime")))]),t("span",{class:"离线"===e.lineStatus?"colorConfig redConfig":"colorConfig"},[e._v(e._s(e.activityTime))]),t("span",[e._v("    ")]),t("span",[e._v(e._s(e.$t("chlwatch.lineStatus")))]),t("span",{class:"离线"===e.lineStatus?"colorConfig redConfig":"colorConfig"},[e._v(e._s(e.lineStatus))]),t("span",[e._v("    ")]),t("el-button",{attrs:{size:"small"},on:{click:e.getOnlineInfo}},[t("i",{staticClass:"el-icon-refresh"})])],1)]),t("el-row",{attrs:{type:"flex",justify:"space-between",align:"center"}},[t("el-col",{attrs:{xl:21,lg:21,sm:24,md:24,xs:24}},[t("span",{staticStyle:{margin:"0 10px"}},[e._v(e._s(e.$t("scriptCode.editorTheme")))]),t("el-select",{staticStyle:{"margin-right":"5px"},attrs:{size:"small",filterable:"",placeholder:e.$t("select")},on:{change:e.selectTheme},model:{value:e.theme,callback:function(t){e.theme=t},expression:"theme"}},e._l(e.themeLists,(function(e,n){return t("el-option",{key:n,attrs:{label:e.label,value:e.value}})})),1),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.checkCode("")}}},[t("img",{staticStyle:{"vertical-align":"middle","margin-right":"5px"},attrs:{src:n("06fb"),alt:""}}),t("span",{staticStyle:{"vertical-align":"middle"}},[e._v(e._s(e.$t("scriptCode.checkOnline")))])]),e.$hasPermission("lua:websocket")?t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-bottom"},on:{click:e.sendTogatewayCheck}},[e._v(e._s(e.$t("scriptCode.sendToGatewayForInspection")))]):e._e(),t("el-button",{attrs:{size:"small",icon:"el-icon-circle-plus-outline"},on:{click:e.enlargeFont}},[e._v(e._s(e.$t("scriptCode.increaseFontsize")))]),t("el-button",{attrs:{size:"small",icon:"el-icon-remove-outline"},on:{click:e.ensmallFont}},[e._v(e._s(e.$t("scriptCode.decreaseFontsize")))]),e.$hasPermission("scriptinfo:update:permission.do")?t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.dataFormSubmit}},[e._v(e._s(e.$t("scriptCode.save")))]):e._e()],1),t("el-col",{staticStyle:{"text-align":"right","margin-right":"10px"},attrs:{xl:3,lg:3,sm:24,md:24,xs:24}},[t("el-button",{attrs:{size:"small",icon:"el-icon-question"},on:{click:e.handleShowDoc}},[e._v(e._s(e.$t("scriptCode.luaScriptDocumentationHelp")))])],1)],1),t("el-row",{staticStyle:{margin:"10px 0 0 0"}},[t("el-col",{attrs:{span:24}},[t("el-input",{attrs:{id:"code",type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:e.$t("scriptCode.pleaseEnterContent")}})],1),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"panel panel-success pull-left",staticStyle:{width:"100%",height:"305px"}},[t("div",{staticClass:"panel-heading"},[t("h3",{staticClass:"panel-title"},[e._v(e._s(e.$t("scriptCode.outputConsole")))])]),t("div",{staticClass:"panel-body"},[t("el-input",{attrs:{id:"output",type:"textarea",autosize:{minRows:10},readonly:""},model:{value:e.outputValue,callback:function(t){e.outputValue=t},expression:"outputValue"}})],1)])]),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"panel panel-danger pull-right",staticStyle:{width:"100%",height:"305px"}},[t("div",{staticClass:"panel-heading"},[t("h3",{staticClass:"panel-title"},[e._v(e._s(e.$t("scriptCode.errorConsole")))])]),t("div",{staticClass:"panel-body"},[t("div",{attrs:{id:"error"}})])])])],1)],1)},o=[],i=n("53ca"),r=(n("a481"),n("4917"),n("ac6a"),n("28a5"),n("8449"),n("6b54"),n("4328")),s=n.n(r),c=n("a78e"),l=n.n(c),u=n("fb92"),h=n("b047"),g=n.n(h),d=(n("7cbf"),n("6e54"),n("bdb2"),n("f4ee"),n("f775"),n("b0be"),n("8f30"),n("1064"),n("a6d4"),n("43f5"),n("ba98"),n("a067"),n("8234"),n("511f"),n("0c19"),n("8c49"),n("7ea9"),n("9fc3"),n("3840"),n("84392"),n("6939"),n("9a12"),n("9331"),n("e48f"),n("518d"),n("8502"),n("8638"),n("206e"),n("04bc"),n("27b5"),n("0388"),n("cfdd"),n("584a1"),n("2c8e"),n("29b2c"),n("53c4"),n("e39d"),n("0cd9"),n("b0e2"),n("b046"),n("9d7c"),n("3b76"),n("3ed5"),n("c15c"),n("9507"),n("dcfe"),n("3614"),n("6a5d"),n("b8cb"),n("be46"),n("ae6a"),n("a65a"),n("73f3"),n("845fc"),n("5568"),n("02ed"),n("5e54"),n("015a"),n("21f1"),n("48ad"),n("4051"),n("8d323"),n("1b7a"),n("df99"),n("eae9"),n("02d6"),n("b421"),n("d08c"),window.CodeMirror||u),f=n("27ae").Base64,p={name:"scriptcode",data:function(){return{gwDesc:"",theme:"monokai",isCodeTrue:!1,activityTime:"",lineStatus:"",projectName:"",scriptInfo:{},outputValue:"",editor:null,onLineTimer:null,themeLists:[{label:"3024-day",value:"3024-day"},{label:"3024-night",value:"3024-night"},{label:"abcdef",value:"abcdef"},{label:"ambiance",value:"ambiance"},{label:"ayu-dark",value:"ayu-dark"},{label:"ayu-mirage",value:"ayu-mirage"},{label:"base16-dark",value:"base16-dark"},{label:"base16-light",value:"base16-light"},{label:"bespin",value:"bespin"},{label:"blackboard",value:"blackboard"},{label:"cobalt",value:"cobalt"},{label:"colorforth",value:"colorforth"},{label:"darcula",value:"darcula"},{label:"dracula",value:"dracula"},{label:"duotone-dark",value:"duotone-dark"},{label:"duotone-light",value:"duotone-light"},{label:"eclipse",value:"eclipse"},{label:"elegant",value:"elegant"},{label:"erlang-dark",value:"erlang-dark"},{label:"gruvbox-dark",value:"gruvbox-dark"},{label:"hopscotch",value:"hopscotch"},{label:"icecoder",value:"icecoder"},{label:"idea",value:"idea"},{label:"isotope",value:"isotope"},{label:"lesser-dark",value:"lesser-dark"},{label:"liquibyte",value:"liquibyte"},{label:"lucario",value:"lucario"},{label:"material",value:"material"},{label:"material-darker",value:"material-darker"},{label:"material-palenight",value:"material-palenight"},{label:"material-ocean",value:"material-ocean"},{label:"mbo",value:"mbo"},{label:"mdn-like",value:"mdn-like"},{label:"midnight",value:"midnight"},{label:"monokai",value:"monokai"},{label:"moxer",value:"moxer"},{label:"neat",value:"neat"},{label:"neo",value:"neo"},{label:"night",value:"night"},{label:"nord",value:"nord"},{label:"oceanic-next",value:"oceanic-next"},{label:"panda-syntax",value:"panda-syntax"},{label:"paraiso-dark",value:"paraiso-dark"},{label:"paraiso-light",value:"paraiso-light"},{label:"pastel-on-dark",value:"pastel-on-dark"},{label:"railscasts",value:"railscasts"},{label:"rubyblue",value:"rubyblue"},{label:"seti",value:"seti"},{label:"shadowfox",value:"shadowfox"},{label:"solarized dark",value:"solarized dark"},{label:"solarized light",value:"solarized light"},{label:"the-matrix",value:"the-matrix"},{label:"tomorrow-night-bright",value:"tomorrow-night-bright"},{label:"tomorrow-night-eighties",value:"tomorrow-night-eighties"},{label:"ttcn",value:"ttcn"},{label:"twilight",value:"twilight"},{label:"vibrant-ink",value:"vibrant-ink"},{label:"xq-dark",value:"xq-dark"},{label:"xq-light",value:"xq-light"},{label:"yeti",value:"yeti"},{label:"yonce",value:"yonce"},{label:"zenburn",value:"zenburn"}],onOrOffLineTimer:null,onlineWebsocket:null,onLineLockReconnect:!1,recconectOnLineTimer:null,isOnlineClose:!1,isPerform:!1,websocketSendTogatewayCheck:null,sendTogatewayCheckReconnect:!1,recconectSendTogatewayCheckTimer:null,isSendTogatewayCheckClose:!1}},methods:{encryMD5:function(e){var t=this.$randomStrFun();return this.$md5(t+e)+"/"+String(parseInt((new Date).getTime().toString().substring(0,10)))},encryMD5List:function(){var e=this.$randomStrFun();return this.$md5(e)+"/"+String(parseInt((new Date).getTime().toString().substring(0,10)))},selectTheme:function(e){this.editor.setOption("theme",e)},getScriptInfo:function(){var e=this,t=e.$route.query.scriptIds,n={id:t};e.$hasPermission("scriptinfo:select:permission.do")?e.$http.get("/info/scriptinfo/".concat(t),{params:n}).then((function(t){var n=t.data;if(0!=n.code)return e.$message.error(n.data||n.msg);e.scriptInfo=n.data,e.getGwsnInfoAndStatus(),e.getOnlineInfo(),e.getStatus(),e.init(),e.$nextTick((function(){e.createOnLineWebSocket()}))})).catch((function(t){return e.$message.error(e.$t("requestTimedout")),!1})):e.$message.warning("暂无LUA脚本运算信息查询权限, 请联系管理员")},getGwsnInfoAndStatus:function(){var e=this,t={sn:e.scriptInfo.gwSn};e.$hasPermission("gwbaseinfo:select:permission.do")?e.$http.get("/info/gwbaseinfo",{params:t}).then((function(t){var n=t.data;if(0!=n.code)return!1;var a=n.data;a&&(e.gwDesc=a.gwDesc?a.gwDesc:e.$t("chlwatch.noDesc"),e.projectName=a.prjName?a.prjName:e.$t("chlwatch.no"))})).catch((function(e){return!1})):e.$message.warning("暂无网关信息查询权限, 请联系管理员")},createOnLineWebSocket:function(){var e=this;if(!("WebSocket"in window))return e.$message.error(e.$t("currentBrowerSupportWebSocket"));try{var t=e.encryMD5(sessionStorage.getItem("gwsn")),n=window.SITE_CONFIG["socketUrl"]+"heart/".concat(e.scriptInfo.gwSn,"/").concat(t)+"?token="+e.$getToken();e.onlineWebsocket=new WebSocket(n),e.initOnlineWebSocket()}catch(a){e.onLineReConnect()}},initOnlineWebSocket:function(){this.onlineWebsocket.onopen=this.onLineWebsocketonopen,this.onlineWebsocket.onerror=this.onLineWebsocketonerror,this.onlineWebsocket.onmessage=this.onLineWebsocketonmessage,this.onlineWebsocket.onclose=this.onLineWebsocketonclose},heartCheck:function(){var e=this,t={timeout:2e4,timeoutObj:null,start:function(){e.timeoutObj=setTimeout((function(){e.onLineLockReconnect&&e.onlineWebsocket.send("connect success")}),2e4)},reset:function(){clearTimeout(e.timeoutObj),t.start()}};return t},onLineReConnect:function(){var e=this;e.onLineLockReconnect||(e.recconectOnLineTimer&&clearTimeout(e.recconectOnLineTimer),e.recconectOnLineTimer=setTimeout((function(){e.createOnLineWebSocket()}),5e3))},onLineWebsocketonopen:function(){this.isOnlineClose=!0,this.onLineLockReconnect=!0,this.heartCheck().start()},onLineWebsocketonerror:function(e){this.onLineLockReconnect=!1,this.onLineReConnect()},onLineWebsocketonmessage:function(e){var t=this;return this.heartCheck().reset(),"连接成功"!=e.data&&"connect success"!=e.data||(this.onOrOffLineTimer&&(clearInterval(this.onOrOffLineTimer),this.onOrOffLineTimer=null),this.onOrOffLineTimer=setInterval((function(){if(localStorage.getItem("offLineStatus"+t.scriptInfo.gwSn)&&"true"==localStorage.getItem("offLineStatus"+t.scriptInfo.gwSn)&&!t.isPerform){if(!t.$hasPermission("tgwinfo:update:permission.do"))return void t.$message.warning("暂无网关状态修改权限, 请联系管理员");t.$http.post("/info/tgwinfo/updateStatus",{gwSn:t.scriptInfo.gwSn,lineStatus:2}).then((function(e){var n=e.data;if(0!=n.code)return t.$message.error(n.data||n.msg);t.getPerformOnlineInfo(),t.$message.error(t.$t("gatewayIsOffline"))}))}}),1e3)),1==e.data?(localStorage.setItem("offLineStatus"+this.scriptInfo.gwSn,""),this.getOnlineInfo(),this.isPerform=!1,this.$message.success(this.$t("onLineGateway"))):0==e.data?(localStorage.setItem("offLineStatus"+this.scriptInfo.gwSn,""),this.isPerform=!1,this.getOnlineInfo()):void 0},onLineWebsocketonclose:function(e){this.isOnlineClose?this.onLineLockReconnect=!1:(this.onLineLockReconnect=!1,this.onLineReConnect())},getPerformOnlineInfo:function(){var e=this,t={gwsn:this.scriptInfo.gwSn};this.$hasPermission("tgwinfo:select:permission.do")?(this.isPerform=!0,this.$http.post("/info/tgwinfo/selectStatus",s.a.stringify(t)).then((function(t){var n=t.data;n.msg,e.activityTime=n.data.lastTime,e.lineStatus=1===n.data.status?e.$t("chlwatch.inLine"):e.$t("chlwatch.offLine"),localStorage.setItem("offLineStatus"+e.scriptInfo.gwSn,1!==n.data.status||"")})).catch((function(e){return!1}))):this.$message.warning("暂无网关在线状态查询权限, 请联系管理员")},getOnlineInfo:function(){var e=this,t={gwsn:this.scriptInfo.gwSn};this.onLineTimer&&(clearInterval(this.onLineTimer),this.onLineTimer=null),this.$hasPermission("tgwinfo:select:permission.do")?this.$http.post("/info/tgwinfo/selectStatus",s.a.stringify(t)).then((function(t){var n=t.data;e.getStatus(),n.msg,e.activityTime=n.data.lastTime,e.lineStatus=1===n.data.status?e.$t("chlwatch.inLine"):e.$t("chlwatch.offLine")})).catch((function(e){return!1})):this.$message.warning("暂无网关在线状态查询权限, 请联系管理员")},getStatus:function(){var e=this;this.onLineTimer=setInterval((function(){e.getOnlineInfo()}),6e4)},init:function(){var e=this;e.editor=d.fromTextArea(document.getElementById("code"),{lineNumbers:!0,styleActiveLine:!0,theme:"monokai",mode:{name:"text/x-lua"},indentWithTabs:!0,gutters:["CodeMirror-lint-markers"],autofocus:!0,lint:!0,matchBrackets:!0,lineWrapping:!0,showCursorWhenSelecting:!0,smartIndent:!0,extraKeys:{Ctrl:"autocomplete"}}),e.scriptInfo.scriptcontent&&e.editor.replaceSelection(e.scriptInfo.scriptcontent),e.editor.setOption("extraKeys",{"Ctrl-/":function(e){var t=[],n="",a=e.doc.sel.ranges[0].anchor.line,o=e.doc.sel.ranges[0].anchor.ch,i=e.doc.sel.ranges[0].head.line,r=e.doc.sel.ranges[0].head.ch;e.getSelections().length>0&&(-1!=e.getSelections()[0].indexOf("\n")?(t=e.getSelections()[0].split("\n"),t.forEach((function(e){-1!=e.indexOf("--")?n+=e.substring(2,e.length)+"\n":n+="--"+e+"\n"})),n=n.substring(0,n.lastIndexOf("\n")),e.replaceSelection(n),a-i>0?e.setSelection({line:a,ch:e.getLine(a).length},{line:i,ch:r}):a-i<0&&e.setSelection({line:a,ch:o},{line:i,ch:e.getLine(i).length})):(-1!=e.getLine(e.getCursor().line).indexOf("--")?n=e.getLine(e.getCursor().line).substring(2,e.getLine(e.getCursor().line).length):(r-o>0?r+=2:o+=2,n="--"+e.getLine(e.getCursor().line)),r-o>0?(e.replaceRange(n,{line:a,ch:0},{line:i,ch:r}),e.setSelection({line:a,ch:0},{line:i,ch:r})):(e.replaceRange(n,{line:a,ch:0},{line:i,ch:o}),e.setSelection({line:a,ch:0},{line:i,ch:o}))))}}),e.editor.on("keypress",(function(){var t=e.editor.getValue()+"";t=t.replace(/[a-z]+[\-|\']+[a-z]+/gi,"").match(/([a-z]+)/gi),d.ukeys=t,e.editor.showHint()}))},enlargeFont:g()((function(){var e=$(".CodeMirror").css("font-size"),t=parseFloat(e,10),n=e.slice(-2);t+=1,$(".CodeMirror").css("font-size",t+n),this.editor.setOption("cursorHeight",1)}),300,{leading:!0,trailing:!1}),ensmallFont:g()((function(){var e=$(".CodeMirror").css("font-size"),t=parseFloat(e,10),n=e.slice(-2);t-=1,$(".CodeMirror").css("font-size",t+n),this.editor.setOption("cursorHeight",1)}),300,{leading:!0,trailing:!1}),luaPrint:function(e){var t=$("#output").append(localStorage.getItem("kt")+"\n");t.scrollTop(t[0].scrollHeight-t.height())},checkCode:function(e){var t=this;$("#error").text("");var n=this.editor.getValue(),a="";if(n||(this.isCodeTrue=!1),-1!=n.indexOf("GetTagValue")||-1!=n.indexOf("SetTagValue")||-1!=n.indexOf("GetTagValueAndQos")||-1!=n.indexOf("TxPacket")||-1!=n.indexOf("GetDevTagValue")||-1!=n.indexOf("SetDevTagValue")||-1!=n.indexOf("SetTagValue2")||-1!=n.indexOf("LuaClog")||-1!=n.indexOf("LuaSleep")){var o="GetTagValue = function(...) \n\r\r print(1)\n\r\r return 1\nend\nSetTagValue = function(...) \n\r\r print(1)\n\r\r return 1\nend\nGetTagValueAndQos = function(...) \n\r\r print(1)\n\r\r return 1\nend\nTxPacket = function(...) \n\r\r print(1)\n\r\r return 1\nend\nGetDevTagValue = function(...) \n\r\r print(1)\n\r\r return 1\nend\nSetDevTagValue = function(...) \n\r\r print(1)\n\r\r return 1\nend\nSetTagValue2 = function(...) \n\r\r print(1)\n\r\r return 1\nend\nLuaClog = function(...) \n\r\r print(1)\n\r\r return 1\nend\nLuaSleep = function(...) \n\r\r print(1)\n\r\r return 1\nend\n";a=o+n}else a=n;try{luaparse.parse(a,{locations:!0,ranges:!0})}catch(i){return $("#error").text(i.message.replaceAll(/\[.*?\]/g,"")),this.isCodeTrue=!1,"save"!=e&&this.$message.error(this.$t("scriptCode.pleaseCheckCode"))}this.$nextTick((function(){return null==localStorage.getItem("kt")||void 0==localStorage.getItem("kt")?"save"==e?(t.isCodeTrue=!0,!0):(t.isCodeTrue=!0,t.$message.success(t.$t("scriptCode.codeCheckIsCorrect"))):"error"==localStorage.getItem("codemirrorError")?"save"==e?(t.isCodeTrue=!1,localStorage.removeItem("codemirrorError"),!1):(t.isCodeTrue=!1,localStorage.removeItem("codemirrorError"),t.$message.error(t.$t("scriptCode.pleaseCheckCode"))):null!=localStorage.getItem("kt")||void 0!=localStorage.getItem("kt")?"save"==e?(t.isCodeTrue=!0,!0):(t.isCodeTrue=!0,t.$message.success(t.$t("scriptCode.codeCheckIsCorrect"))):void 0}))},createSendTogatewayCheckWebSocket:function(){var e=this;e.editor.getValue();if(e.$hasPermission("lua:websocket")){if(!("WebSocket"in window))return e.$message.error(e.$t("currentBrowerSupportWebSocket"));try{var t=window.SITE_CONFIG["socketUrl"]+"lua/"+e.scriptInfo.gwSn+"/"+e.encryMD5(e.scriptInfo.gwSn)+"?token="+e.$getToken();e.websocketSendTogatewayCheck=new WebSocket(t),e.initSendTogatewayCheckWebSocket()}catch(n){e.sendTogatewayCheckWebsocketReConnect()}}else e.$message.warning("暂无LUA脚本下发至网关检查权限, 请联系管理员")},initSendTogatewayCheckWebSocket:function(){this.websocketSendTogatewayCheck.onopen=this.sendTogatewayCheckWebsocketonopen,this.websocketSendTogatewayCheck.onerror=this.sendTogatewayCheckWebsocketonerror,this.websocketSendTogatewayCheck.onmessage=this.sendTogatewayCheckWebsocketonmessage,this.websocketSendTogatewayCheck.onclose=this.sendTogatewayCheckWebsocketonclose},sendTogatewayCheckWebsocketReConnect:function(){var e=this;e.sendTogatewayCheckReconnect||(e.recconectSendTogatewayCheckTimer&&clearTimeout(e.recconectSendTogatewayCheckTimer),e.recconectSendTogatewayCheckTimer=setTimeout((function(){e.createSendTogatewayCheckWebSocket()}),5e3))},sendTogatewayCheckWebsocketonopen:function(){this.isSendTogatewayCheckClose=!0,this.sendTogatewayCheckReconnect=!0;for(var e=f.encode(this.editor.getValue()),t=0;t<Math.ceil(e.length/1e3);t++)t==Math.ceil(e.length/1e3)-1?this.websocketSendTogatewayCheck.send(JSON.stringify({content:e.substring(1e3*t,1e3*(t+1)),sn:this.scriptInfo.gwSn})):this.websocketSendTogatewayCheck.send(e.substring(1e3*t,1e3*(t+1)))},sendTogatewayCheckWebsocketonerror:function(e){this.sendTogatewayCheckReconnect=!1,this.sendTogatewayCheckWebsocketReConnect()},isJsonString:function(e){try{if("object"==Object(i["a"])(JSON.parse(e)))return!0}catch(t){}return!1},sendTogatewayCheckWebsocketonmessage:function(e){if("连接成功"==e.data||"connect success"==e.data)return!1;if(this.isJsonString(e.data)){var t=JSON.parse(e.data).res_content;if(0==t.successed){var n=this.$t("scriptCode.gatewayReturnsError")+t.msg.replace(/\n/g,"<br/>");return this.$message.error({dangerouslyUseHTMLString:!0,message:n}),this.isSendTogatewayCheckClose=!0,this.websocketSendTogatewayCheck.close(),this.websocketSendTogatewayCheck=null,!1}return this.$message.success(this.$t("scriptCode.scriptContentisCheckedCorrectly")),this.isSendTogatewayCheckClose=!0,this.websocketSendTogatewayCheck.close(),this.websocketSendTogatewayCheck=null,!1}return!1},sendTogatewayCheckWebsocketonclose:function(e){this.isSendTogatewayCheckClose?this.sendTogatewayCheckReconnect=!1:(this.sendTogatewayCheckReconnect=!1,this.sendTogatewayCheckWebsocketReConnect())},sendTogatewayCheck:function(){var e=this,t=e.editor.getValue();if(!t)return e.$message.warning(e.$t("scriptCode.scriptContentCannotBeEmpty"));e.$hasPermission("lua:websocket")?e.$confirm(e.$t("scriptCode.pleaseEnsurethatExecuting"),e.$t("prompt.title"),{confirmButtonText:e.$t("confirm"),cancelButtonText:e.$t("cancel"),type:"warning"}).then((function(){e.$nextTick((function(){e.createSendTogatewayCheckWebSocket()}))})).catch((function(e){})):e.$message.warning("暂无LUA脚本下发至网关检查权限, 请联系管理员")},getExpress:function(){var e=this,t=this.editor.getValue();$("#output").text(""),$("#error").html("");try{fengari.load(t)()}catch(n){$("#error").html(n)}this.$nextTick((function(){e.outputValue=null!=localStorage.getItem("kt")||void 0!=localStorage.getItem("kt")?localStorage.getItem("kt"):"",localStorage.removeItem("kt")}))},dataFormSubmit:g()((function(){var e=this,t=this;if(t.checkCode("save"),!t.editor.getValue())return t.$message.warning(t.$t("scriptCode.scriptContentCannotBeEmpty"));t.$hasPermission("scriptinfo:update:permission.do")?t.$nextTick((function(){t.isCodeTrue?(t.scriptInfo["scriptcontent"]=t.editor.getValue(),t.$http.put("/info/scriptinfo",t.scriptInfo).then((function(n){var a=n.data;if(0!==a.code)return e.$message.error(a.data||a.msg);t.$message.success(t.$t("prompt.success"))})).catch((function(e){return!1}))):t.$confirm(t.$t("scriptCode.errorCodeCheck"),t.$t("prompt.title"),{confirmButtonText:t.$t("confirm"),cancelButtonText:t.$t("cancel"),type:"warning"}).then((function(){t.scriptInfo["scriptcontent"]=t.editor.getValue(),t.$http.put("/info/scriptinfo",t.scriptInfo).then((function(e){var n=e.data;if(0!==n.code)return t.$message.error(n.data||n.msg);t.$message.success(t.$t("prompt.success"))})).catch((function(e){return!1}))})).catch((function(){}))})):t.$message.warning("暂无LUA脚本修改权限, 请联系管理员")}),1e3,{leading:!0,trailing:!1}),handleShowDoc:function(){window.open(window.location.origin+"/help-doc/lua_page/1.GetTagValue/","_blank")}},created:function(){window.SITE_CONFIG["permissions"]=localStorage.getItem("permissionsDingiiotCom")?JSON.parse(localStorage.getItem("permissionsDingiiotCom")):[]},mounted:function(){this.onLineTimer&&(clearInterval(this.onLineTimer),this.onLineTimer=null),this.onOrOffLineTimer&&(clearInterval(this.onOrOffLineTimer),this.onOrOffLineTimer=null),this.onlineWebsocket&&(this.onlineWebsocket.close(),this.onlineWebsocket=null),this.websocketSendTogatewayCheck&&(this.websocketSendTogatewayCheck.close(),this.websocketSendTogatewayCheck=null),l.a.get("token")?this.getScriptInfo():this.$router.replace({name:"login"}).catch((function(e){return!1}))},beforeDestroy:function(){l.a.get("token")&&(this.onLineTimer&&(clearInterval(this.onLineTimer),this.onLineTimer=null),this.onOrOffLineTimer&&(clearInterval(this.onOrOffLineTimer),this.onOrOffLineTimer=null),this.onlineWebsocket&&(this.onlineWebsocket.close(),this.onlineWebsocket=null),this.websocketSendTogatewayCheck&&(this.websocketSendTogatewayCheck.close(),this.websocketSendTogatewayCheck=null))},deactivated:function(){l.a.get("token")&&(this.onLineTimer&&(clearInterval(this.onLineTimer),this.onLineTimer=null),this.onOrOffLineTimer&&(clearInterval(this.onOrOffLineTimer),this.onOrOffLineTimer=null),this.onlineWebsocket&&(this.onlineWebsocket.close(),this.onlineWebsocket=null),this.websocketSendTogatewayCheck&&(this.websocketSendTogatewayCheck.close(),this.websocketSendTogatewayCheck=null))},watch:{$route:"getScriptInfo"}},m=p,b=(n("0b67"),n("2877")),k=Object(b["a"])(m,a,o,!1,null,null,null);t["default"]=k.exports},8995:function(e,t,n){},eae9:function(e,t,n){"use strict";(function(e){n("ac4d"),n("8a81"),n("5df3"),n("1c4c"),n("4917"),n("3b2b"),n("a481"),n("28a5"),n("7f7f"),n("6b54");var t=n("53ca");function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw r}}}}function o(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}(function(a){"object"==("undefined"===typeof exports?"undefined":Object(t["a"])(exports))&&"object"==Object(t["a"])(e)?a(n("fb92"),n("8d323")):"function"==typeof define&&n("3c35")?define(["../../lib/codemirror","../../mode/lua/lua"],a):a(CodeMirror)})((function(e){var n,o,i,r,s={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},c=e.Pos,l=e.cmpPos;function u(e){return"[object Array]"==Object.prototype.toString.call(e)}function h(t){var n=t.doc.modeOption;return"text/x-lua"===n.name&&(n.name="text/x-lua"),e.resolveMode(n.name).keywords}function g(t){var n=t.doc.modeOption;return"lua"===n&&(n="text/x-lua"),e.resolveMode(n).identifierQuote||"`"}function d(e){return"string"==typeof e?e:e.text}function f(e,t){return u(t)&&(t={columns:t}),t.text||(t.text=e),t}function p(e){var t={};if(u(e))for(var n=e.length-1;n>=0;n--){var a=e[n];t[d(a).toUpperCase()]=f(d(a),a)}else if(e)for(var o in e)t[o.toUpperCase()]=f(o,e[o]);return t}function m(e){return n[e.toUpperCase()]}function b(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function k(e,t){var n=e.length,a=d(t).substr(0,n);return e.toUpperCase()===a.toUpperCase()}function v(e,t,n,a){if(u(n))for(var o=0;o<n.length;o++)k(t,n[o])&&e.push(a(n[o]));else for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];r=r&&!0!==r?r.displayText?{text:r.text,displayText:r.displayText}:r.text:i,k(t,r)&&e.push(a(r))}}function w(e){"."==e.charAt(0)&&(e=e.substr(1));for(var t=e.split(r+r),n=0;n<t.length;n++)t[n]=t[n].replace(new RegExp(r,"g"),"");return t.join(r)}function C(e){for(var t=d(e).split("."),n=0;n<t.length;n++)t[n]=r+t[n].replace(new RegExp(r,"g"),r+r)+r;var a=t.join(".");return"string"==typeof e?a:(e=b(e),e.text=a,e)}function S(e,t,a,i){var s=!1,l=[],u=t.start,h=!0;while(h)h="."==t.string.charAt(0),s=s||t.string.charAt(0)==r,u=t.start,l.unshift(w(t.string)),t=i.getTokenAt(c(e.line,t.start)),"."==t.string&&(h=!0,t=i.getTokenAt(c(e.line,t.start)));var g=l.join(".");v(a,g,n,(function(e){return s?C(e):e})),v(a,g,o,(function(e){return s?C(e):e})),g=l.pop();var d=l.join("."),f=!1,p=d;if(!m(d)){var k=d;d=y(d,i),d!==k&&(f=!0)}var S=m(d);return S&&S.columns&&(S=S.columns),S&&v(a,g,S,(function(e){var t=d;return 1==f&&(t=p),"string"==typeof e?e=t+"."+e:(e=b(e),e.text=t+"."+e.text),s?C(e):e})),u}function T(e,t){for(var n=e.split(/\s+/),a=0;a<n.length;a++)n[a]&&t(n[a].replace(/[,;]/g,""))}function y(e,t){var n=t.doc,a=n.getValue(),o=e.toUpperCase(),i="",r="",u=[],h={start:c(0,0),end:c(t.lastLine(),t.getLineHandle(t.lastLine()).length)},g=a.indexOf(s.QUERY_DIV);while(-1!=g)u.push(n.posFromIndex(g)),g=a.indexOf(s.QUERY_DIV,g+1);u.unshift(c(0,0)),u.push(c(t.lastLine(),t.getLineHandle(t.lastLine()).text.length));for(var d=null,f=t.getCursor(),p=0;p<u.length;p++){if((null==d||l(f,d)>0)&&l(f,u[p])<=0){h={start:d,end:u[p]};break}d=u[p]}if(h.start){var b=n.getRange(h.start,h.end,!1);for(p=0;p<b.length;p++){var k=b[p];if(T(k,(function(e){var t=e.toUpperCase();t===o&&m(i)&&(r=i),t!==s.ALIAS_KEYWORD&&(i=e)})),r)break}}return r}e.registerHelper("hint","lua",(function(e,s){n=p(s&&s.tables);var l=s&&s.defaultTable,u=s&&s.disableKeywords;o=l&&m(l),i=h(e),r=g(e),l&&!o&&(o=y(l,e)),o=o||[],o.columns&&(o=o.columns);var d,f,b,k=e.getCursor(),w=[],C=e.getTokenAt(k);if(C.end>k.ch&&(C.end=k.ch,C.string=C.string.slice(0,k.ch-C.start)),C.string.match(/^[.`"'\w@][\w$#]*$/g)?(b=C.string,d=C.start,f=C.end):(d=f=k.ch,b=""),"."==b.charAt(0)||b.charAt(0)==r)d=S(k,C,w,e);else{var T=function(e,n){return"object"===Object(t["a"])(e)?e.className=n:e={text:e,className:n},e};v(w,b,o,(function(e){return T(e,"CodeMirror-hint-table CodeMirror-hint-default-table")})),v(w,b,n,(function(e){return T(e,"CodeMirror-hint-table")})),u||v(w,b,i,(function(e){return T(e.toUpperCase(),"CodeMirror-hint-keyword")}))}var $=["_G","_VERSION","assert","collectgarbage","dofile","error","getfenv","getmetatable","ipairs","load","loadfile","loadstring","module","next","pairs","pcall","print","rawequal","rawget","rawset","require","select","setfenv","setmetatable","tonumber","tostring","type","unpack","xpcall","coroutine.create","coroutine.resume","coroutine.running","coroutine.status","coroutine.wrap","coroutine.yield","debug.debug","debug.getfenv","debug.gethook","debug.getinfo","debug.getlocal","debug.getmetatable","debug.getregistry","debug.getupvalue","debug.setfenv","debug.sethook","debug.setlocal","debug.setmetatable","debug.setupvalue","debug.traceback","close","flush","lines","read","seek","setvbuf","write","io.close","io.flush","io.input","io.lines","io.open","io.output","io.popen","io.read","io.stderr","io.stdin","io.stdout","io.tmpfile","io.type","io.write","math.abs","math.acos","math.asin","math.atan","math.atan2","math.ceil","math.cos","math.cosh","math.deg","math.exp","math.floor","math.fmod","math.frexp","math.huge","math.ldexp","math.log","math.log10","math.max","math.min","math.modf","math.pi","math.pow","math.rad","math.random","math.randomseed","math.sin","math.sinh","math.sqrt","math.tan","math.tanh","os.clock","os.date","os.difftime","os.execute","os.exit","os.getenv","os.remove","os.rename","os.setlocale","os.time","os.tmpname","package.cpath","package.loaded","package.loaders","package.loadlib","package.path","package.preload","package.seeall","string.byte","string.char","string.dump","string.find","string.format","string.gmatch","string.gsub","string.len","string.lower","string.match","string.rep","string.reverse","string.sub","string.upper","table.concat","table.insert","table.maxn","table.remove","table.sort","and","break","elseif","false","nil","not","or","return","true","function","end","if","then","else","do","while","repeat","until","for","in","local","{","}","GetTagValue","SetTagValue","GetTagValueAndQos","TxPacket","GetDevTagValue","SetDevTagValue","SetTagValue2","LuaClog","LuaSleep"],x=[];if(C.string){var L,O=a($);try{for(O.s();!(L=O.n()).done;){var I=L.value;-1!=I.indexOf(C.string)&&x.push(I)}}catch(_){O.e(_)}finally{O.f()}}else x=[];return{list:x,from:c(k.line,d),to:c(k.line,f)}}))}))}).call(this,n("dd40")(e))}}]);