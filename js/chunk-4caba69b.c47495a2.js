(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4caba69b"],{"256a3":function(e,t,n){"use strict";n("d4bf")},"8ea4":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"aui-card--fill",attrs:{shadow:"never"}},[t("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{size:"small",type:"primary",disabled:0==e.gwsns.length||0==e.dataList.length},on:{click:e.handleMultipeIssuedPrjToGwsn}},[e._v("\n        批量下发工程\n    ")]),t("el-table",{ref:"recordTable",staticStyle:{width:"100%"},attrs:{size:"small",data:e.dataList,border:"","row-key":e.getRowKey},on:{"selection-change":e.dataListSelectionHandle}},[t("el-table-column",{attrs:{type:"selection","header-align":"center",align:"center",width:"55","reserve-selection":!0}}),t("el-table-column",{attrs:{prop:"gwSn",label:e.$t("gwsn.number"),"header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("a",{attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.realtimeViewer(n.$index,n.row)}}},[e._v("\n                    "+e._s(n.row.gwSn)+"\n                ")])]}}])}),t("el-table-column",{attrs:{"header-align":"center",align:"center",prop:"progress",label:"下发工程进度"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-progress",{attrs:{percentage:e.row.progress,color:"#67c23a","text-inside":"","stroke-width":20}})]}}])})],1),t("rebootrun",{directives:[{name:"show",rawName:"v-show",value:e.confirmVisible,expression:"confirmVisible"}],attrs:{title:"提示",content:e.confirmDialogcontent,dangerText:"确定",rerunText:"重启应用",confirmText:"稍后自行重启",cancelText:"取消"},on:{cancel:function(t){return e.clickCancel()},rerun:function(t){return e.restartRerun()},confirmAndReboot:function(t){return e.clickConfirmAndReboot()},confirm:function(t){return e.clickConfirm()}}})],1)},o=[],i=n("53ca"),r=(n("6b54"),n("4f7f"),n("5df3"),n("1c4c"),n("ac6a"),n("b047")),c=n.n(r),a=n("bd6e"),l={data:function(){return{rebootOrRerun:"",issueSuccessTimer:null,confirmDialogcontent:"",issueSuccessGwsnMap:{},confirmVisible:!1,wsUrl:"",websocket:null,lockReconnect:!1,gwsns:[],dataList:[{gwSn:"202112141048"},{gwSn:"202112141049"},{gwSn:"202112141050"},{gwSn:"202112141051"},{gwSn:"202112141061"},{gwSn:"202112141163"},{gwSn:"202112141173"},{gwSn:"202112141175"}]}},components:{rebootrun:a["a"]},methods:{getRowKey:function(e){return e.gwSn},dataListSelectionHandle:function(e){var t=this;this.gwsns=[],e.forEach((function(e){t.gwsns.push(e.gwSn)}))},handleMultipeIssuedPrjToGwsn:function(){this.confirmVisible=!0,this.confirmDialogcontent="确定对这些网关工程下发吗？工程下发完成后需要重启后生效,点击[确定]设置并重启，点击[稍后自行重启]仅设置不重启。在此过程中请勿操作及离开此页面，否则会出现下发失败问题"},getArrDifference:function(e,t){return e.concat(t).filter((function(e,t,n){return n.indexOf(e)===n.lastIndexOf(e)}))},handleIssueSuccessChange:function(){var e=this,t=[],n=e.gwsns.length;e.issueSuccessTimer=setInterval((function(){if("{}"!=JSON.stringify(e.issueSuccessGwsnMap)){var s=function(n){e.dataList.forEach((function(s){n==s.gwSn&&(e.$set(s,"progress",Math.floor(e.issueSuccessGwsnMap[n].downloaded_size/e.issueSuccessGwsnMap[n].total_size*10)/10*100),100==s.progress&&(t.push(n),t=Array.from(new Set(t))))}))};for(var o in e.issueSuccessGwsnMap)s(o);t.length==n&&(e.websocket&&(setTimeout((function(){e.dataList.forEach((function(t){e.$set(t,"progress",0)}))}),2e3),e.issueSuccessGwsnMap={},e.websocket.close(),e.websocket=null),clearInterval(e.issueSuccessTimer),e.issueSuccessTimer=null,setTimeout((function(){e.rebootOrRerun&&"notReboot"!=e.rebootOrRerun&&e.$http.get("/info/channelinfo/reProsBySn.do",{params:{sns:e.gwsns.join(","),action:e.rebootOrRerun}}).then((function(t){var n=t.data;if(0!=n.code)return e.$message.error(n.data||n.msg);e.$message.success(n.data||msg)}))}),2e3))}}),0),setTimeout((function(){if(e.websocket){e.dataList.forEach((function(t){e.$set(t,"progress",0)}));var n=e.getArrDifference(e.gwsns,t);n.length>0&&e.$message.error(n.join(",")+"下发工程失败"),e.issueSuccessGwsnMap={},e.websocket.close(),e.websocket=null,clearInterval(e.issueSuccessTimer),e.issueSuccessTimer=null,e.rebootOrRerun&&"notReboot"!=e.rebootOrRerun&&e.$http.get("/info/channelinfo/reProsBySn.do",{params:{sns:e.gwsns.join(","),action:e.rebootOrRerun}}).then((function(t){var n=t.data;if(0!=n.code)return e.$message.error(n.data||n.msg);e.$message.success(n.data||msg)}))}}),2e4)},clickCancel:function(){this.websocket&&(this.websocket.close(),this.websocket=null),this.rebootOrRerun="",this.confirmVisible=!1},clickConfirmAndReboot:c()((function(){var e=this;e.confirmVisible=!1,e.rebootOrRerun="reboot",e.handleIssueSuccessChange(),e.wsUrl="issuePros/issue/"+e.gwsns.join(",")+"/"+e.encryMD5List(),e.createWebSocket()}),1e3,{leading:!0,trailing:!1}),encryMD5List:function(){var e=this.$randomStrFun(),t=String(parseInt((new Date).getTime().toString().substring(0,10)));return this.$md5(e+t)+"/"+t},restartRerun:c()((function(){var e=this;e.confirmVisible=!1,e.rebootOrRerun="reRun",e.handleIssueSuccessChange(),e.wsUrl="issuePros/issue/"+e.gwsns.join(",")+"/"+e.encryMD5List(),e.createWebSocket()}),1e3,{leading:!0,trailing:!1}),clickConfirm:c()((function(){var e=this;e.confirmVisible=!1,e.rebootOrRerun="notReboot",e.handleIssueSuccessChange(),e.wsUrl="issuePros/issue/"+e.gwsns.join(",")+"/"+e.encryMD5List(),e.createWebSocket()}),1e3,{leading:!0,trailing:!1}),createWebSocket:function(){var e=this,t="";if(!("WebSocket"in window))return e.$message.error(e.$t("websocket.notSupportWebsocket"));try{t=window.SITE_CONFIG["socketUrl"]+e.wsUrl+"?token="+e.$getToken(),e.websocket=new WebSocket(t),e.initWebSocket()}catch(n){}},initWebSocket:function(){this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onmessage=this.websocketonmessage,this.websocket.onclose=this.websocketonclose},websocketonopen:function(){this.lockReconnect=!0},websocketonerror:function(e){this.lockReconnect=!1},isJsonString:function(e){if("string"===typeof e)try{var t=JSON.parse(e);return!("object"!==Object(i["a"])(t)||!t)}catch(n){return!1}},websocketonmessage:function(e){var t=this;if(!this.isJsonString(e.data))return!1;var n=JSON.parse(e.data),s=JSON.parse(n.data).res_content;this.issueSuccessGwsnMap[n.sn]=s,this.dataList.forEach((function(e){n.sn==e.gwSn&&t.$set(e,"progress",Math.floor(s.downloaded_size/s.total_size*10)/10*100)})),setTimeout((function(){!e&&t.websocket&&(t.websocket.close(),t.websocket=null)}),"30000")},websocketonclose:function(e){this.lockReconnect=!1}}},u=l,f=(n("256a3"),n("2877")),b=Object(f["a"])(u,s,o,!1,null,"63eaba73",null);t["default"]=b.exports},bd6e:function(e,t,n){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"dialog"},[t("div",{staticClass:"dialog-container"},[t("div",{staticClass:"dialog-title"},[e._v(e._s(e.title))]),t("div",{staticClass:"content",domProps:{innerHTML:e._s(e.content)}}),e.isShowCheckbox?t("div",{staticClass:"content",staticStyle:{"margin-top":"10px"}},[t("el-checkbox",{model:{value:e.checkboxValue,callback:function(t){e.checkboxValue=t},expression:"checkboxValue"}},[e._v("是否更新驱动")])],1):e._e(),t("div",{staticClass:"btns"},[t("div",{staticClass:"default-btn",on:{click:e.closeBtn}},[e._v(e._s(e.cancelText))]),e.returnVisible?t("div",{staticClass:"rerun-btn",on:{click:e.rerunBtn}},[e._v(e._s(e.rerunText))]):e._e(),e.confirmAndRebootVisible?t("div",{staticClass:"danger-btn",on:{click:e.confirmAndRebootBtn}},[e._v(e._s(e.confirmAndRebootText))]):e._e(),e.confirmVisible?t("div",{staticClass:"confirm-btn",on:{click:e.confirmBtn}},[e._v(e._s(e.confirmText))]):e._e()]),t("div",{staticClass:"close-btn",on:{click:e.closeBtn}},[t("i",{staticClass:"el-icon-close"})])])])},o=[],i={name:"rebootrun",props:{type:{type:String,default:"default"},content:{type:String,default:""},title:{type:String,default:""},isShowCheckbox:{type:Boolean,default:!1},isUpdateDriver:{type:Boolean,default:!1},cancelText:{type:String,default:"取消"},returnVisible:{type:Boolean,default:!0},rerunText:{type:String,default:"重启应用"},confirmAndRebootVisible:{type:Boolean,default:!0},confirmAndRebootText:{type:String,default:"确定"},confirmVisible:{type:Boolean,default:!0},confirmText:{type:String,default:"稍后自行重启"}},data:function(){return{checkboxValue:this.isUpdateDriver}},methods:{closeBtn:function(){this.$emit("cancel")},confirmAndRebootBtn:function(){this.$emit("confirmAndReboot")},confirmBtn:function(){this.$emit("confirm")},rerunBtn:function(){this.$emit("rerun")}},watch:{checkboxValue:function(e){this.$emit("update:isUpdateDriver",e)},isUpdateDriver:function(e){this.checkboxValue=e}}},r=i,c=(n("e8b6"),n("2877")),a=Object(c["a"])(r,s,o,!1,null,"ebbafae2",null);t["a"]=a.exports},d4bf:function(e,t,n){},e8b6:function(e,t,n){"use strict";n("fefb")},fefb:function(e,t,n){}}]);