(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d222545"],{cdc1:function(e,t,o){"use strict";o.r(t);o("7f7f");var a=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.visible=t},opened:e.handleDialogOpenChange}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataRule,"label-width":"en-US"===e.$i18n.locale?"180px":"120px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"name",label:e.$t("protocol.protocolName")}},[t("el-input",{attrs:{placeholder:e.$t("protocol.pleaseEnterProtocolName"),clearable:""},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"manuf",label:e.$t("protocol.protocolManufacturer")}},[t("el-input",{attrs:{placeholder:e.$t("protocol.pleaseEnterTheProtocolManufacturer"),clearable:""},model:{value:e.dataForm.manuf,callback:function(t){e.$set(e.dataForm,"manuf",t)},expression:"dataForm.manuf"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"attribute",label:e.$t("protocol.protocolProperty")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("protocol.pleaseSelectProtocolProperty")},model:{value:e.dataForm.attribute,callback:function(t){e.$set(e.dataForm,"attribute",t)},expression:"dataForm.attribute"}},e._l(e.attributeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"type",label:e.$t("protocol.protocolType")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("protocol.pleaseSelectProtocolType")},model:{value:e.dataForm.type,callback:function(t){e.$set(e.dataForm,"type",t)},expression:"dataForm.type"}},e._l(e.typeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"libName",label:e.$t("protocol.protocolLibraryName")}},[t("el-input",{attrs:{placeholder:e.$t("protocol.pleaseEnterTheNameOfTheProtocolLibrary"),clearable:""},model:{value:e.dataForm.libName,callback:function(t){e.$set(e.dataForm,"libName",t)},expression:"dataForm.libName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"groupID",label:e.$t("protocol.protocolGrouping")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("protocol.pleaseSelectAProtocolGroup")},model:{value:e.dataForm.groupID,callback:function(t){e.$set(e.dataForm,"groupID",t)},expression:"dataForm.groupID"}},e._l(e.groupIdList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.groupName,value:e.groupID}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"defaultCfg",label:e.$t("protocol.defaultParameter")}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:e.$t("protocol.pleaseEnterDefaultParameters")},model:{value:e.dataForm.defaultCfg,callback:function(t){e.$set(e.dataForm,"defaultCfg",t)},expression:"dataForm.defaultCfg"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"funcCode",label:e.$t("protocol.functionCode")}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"small"},on:{click:e.handleAddFuncodeList}},[e._v("\n                        "+e._s(e.$t("add"))+"\n                    ")]),t("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{size:"small",border:"",data:e.funcCodeList.concat(e.fixFuncCodeList),"row-style":{height:"20px"},"cell-style":{padding:"2px"},"max-height":300}},[t("el-table-column",{attrs:{prop:"FuncCode",label:e.$t("protocol.index"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{readonly:1==e.dataForm.attribute?99==o.row.FuncCode:98==o.row.FuncCode||99==o.row.FuncCode,placeholder:e.$t("protocol.pleaseEnterTheIndex"),clearable:"",onkeyup:"value=value.replace(/[^0-9]/g,'')",onpaste:"value=value.replace(/[^0-9]/g,'')"},model:{value:o.row.FuncCode,callback:function(t){e.$set(o.row,"FuncCode",t)},expression:"scope.row.FuncCode"}})]}}])}),t("el-table-column",{attrs:{prop:"description",label:e.$t("product.description"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{readonly:1==e.dataForm.attribute?99==o.row.FuncCode:98==o.row.FuncCode||99==o.row.FuncCode,placeholder:e.$t("product.pleaseEnterTheDescription"),clearable:""},model:{value:o.row.description,callback:function(t){e.$set(o.row,"description",t)},expression:"scope.row.description"}})]}}])}),t("el-table-column",{attrs:{label:e.$t("handle"),align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(o){return[1!=e.dataForm.attribute&&98==o.row.FuncCode||99==o.row.FuncCode?e._e():t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDeleteFuncodeList(o.$index)}}},[e._v("\n                                    "+e._s(e.$t("delete"))+"\n                                ")])]}}])})],1)],1)],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:function(t){e.visible=!1}}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},r=[],n=(o("8e6e"),o("456d"),o("5df3"),o("4f7f"),o("2909")),i=o("ade3"),l=(o("c5f6"),o("ac6a"),o("ed08")),c=o("b047"),d=o.n(c);function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){Object(i["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var p={props:["id","copySource"],data:function(){return{loading:!1,visible:!1,dataForm:{id:"",name:"",manuf:"",attribute:0,type:0,libName:"",groupID:"",defaultCfg:"",funcCode:"",iscopy:!0},attributeList:[{label:this.$t("protocol.collectionProtocol"),value:0},{label:this.$t("protocol.forwardingProtocol"),value:1},{label:this.$t("protocol.maintenanceAgreement"),value:2}],typeList:[{label:"TCP",value:0},{label:this.$t("channelInfo.com"),value:1},{label:"OPC",value:2}],groupIdList:[],funcCodeList:[{FuncCode:1,description:""}],fixFuncCodeList:[{FuncCode:98,description:this.$t("protocol.calculationPoint")},{FuncCode:99,description:this.$t("protocol.deviceCommunicationInterruption")}]}},computed:{dataRule:function(){return{name:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],manuf:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],libName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],groupID:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){this.visible=!0,this.loading=!0},handleDialogOpenChange:function(){this.$refs["dataForm"].resetFields(),this.dataForm.id=this.id,this.getGroupDataList()},getGroupDataList:function(){var e=this;if(this.groupIdList=[],!this.$hasPermission("protocol:select:permission.do"))return this.loading=!1,void this.$message.warning("暂无协议分组查询权限, 请联系管理员");this.$http.get("/protocol/getGroup.do",{}).then((function(t){var o=t.data;if(0!=o.code)return e.loading=!1,e.$message.error(o.data||o.msg);o.data.forEach((function(t){-1!=t.upGroupID&&e.groupIdList.push(t)})),e.dataForm.id?e.getInfo():e.copySource?(e.dataForm.name=e.copySource.name,e.dataForm.manuf=e.copySource.manuf,e.dataForm.attribute=e.copySource.attribute,e.dataForm.type=e.copySource.type,e.dataForm.libName=e.copySource.libName,e.dataForm.groupID=e.copySource.groupID,e.dataForm.defaultCfg=e.copySource.defaultCfg,e.dataForm.iscopy=!0,0==e.dataForm.attribute?(e.funcCodeList=JSON.parse(e.copySource.funcCode).data.slice(0,JSON.parse(e.copySource.funcCode).data.length-2),e.fixFuncCodeList=[{FuncCode:98,description:e.$t("protocol.calculationPoint")},{FuncCode:99,description:e.$t("protocol.deviceCommunicationInterruption")}]):1==e.dataForm.attribute?(e.funcCodeList=JSON.parse(e.copySource.funcCode).data.slice(0,JSON.parse(e.copySource.funcCode).data.length-1),e.fixFuncCodeList=JSON.parse(e.copySource.funcCode).data.slice(JSON.parse(e.copySource.funcCode).data.length-1,JSON.parse(e.copySource.funcCode).data.length)):(e.funcCodeList=JSON.parse(e.copySource.funcCode).data,e.fixFuncCodeList=[]),e.loading=!1):(0==e.dataForm.attribute?e.fixFuncCodeList=[{FuncCode:98,description:e.$t("protocol.calculationPoint")},{FuncCode:99,description:e.$t("protocol.deviceCommunicationInterruption")}]:1==e.dataForm.attribute?e.fixFuncCodeList=[{FuncCode:99,description:e.$t("protocol.deviceCommunicationInterruption")}]:(e.funcCodeList=[],e.fixFuncCodeList=[]),e.dataForm.groupID=e.groupIdList.length>0?e.groupIdList[0].id:"",e.loading=!1)})).catch((function(e){return!1}))},handleAddFuncodeList:function(){var e={FuncCode:this.funcCodeList.length>0?Number(this.funcCodeList[this.funcCodeList.length-1].FuncCode)+1:1,description:""};this.funcCodeList.push(e)},handleDeleteFuncodeList:function(e){this.funcCodeList.splice(e,1)},getInfo:function(){var e=this;if(this.funcCodeList=[],!this.$hasPermission("protocol:select:permission.do"))return this.loading=!1,void this.$message.warning("暂无协议信息查询权限, 请联系管理员");this.$http.get("/protocol/selectById.do",{params:{id:this.dataForm.id}}).then((function(t){var o=t.data;if(0!==o.code)return e.loading=!1,e.$message.error(o.data||o.msg);if(e.dataForm=s(s({},e.dataForm),o.data),o.data.funcCode){var a=JSON.parse(o.data.funcCode).data;a.forEach((function(t){98!=t.FuncCode&&99!=t.FuncCode&&e.funcCodeList.push(t)}))}e.loading=!1})).catch((function(t){return e.loading=!1,!1}))},dataFormSubmitHandle:d()((function(){var e=this,t="",o=!0,a=null,r=[],i=[],c=this.funcCodeList.concat(this.fixFuncCodeList);this.$refs["dataForm"].validate((function(d){if(!d)return!1;if(e.dataForm.defaultCfg&&!Object(l["r"])(e.dataForm.defaultCfg))return e.$message.error("请填写正确的默认参数");c.forEach((function(e){r.push(Number(e.FuncCode)),i.push(e.description),null!=e.FuncCode&&void 0!=e.FuncCode&&e.description||(o=!1)}));var u=Object(n["a"])(new Set(r)),s=Object(n["a"])(new Set(i));if(!o)return e.$message.warning(e.$t("protocol.functionCodeIndexAndDescriptionCannotBeEmpty"));if(u.length!=c.length)return e.$message.warning(e.$t("protocol.theFunctionCodeIndexCannotBeDuplicated"));if(s.length!=c.length)return e.$message.warning(e.$t("protocol.functionCodeDescriptionCannotBeDuplicated"));if(e.dataForm.id){if(!e.$hasPermission("protocol:update:permission.do"))return void e.$message.warning("暂无协议修改权限, 请联系管理员");t="/protocol/update.do",a=[{id:e.dataForm.id,attribute:e.dataForm.attribute,defaultCfg:e.dataForm.defaultCfg,funcCode:JSON.stringify({data:c}),groupID:e.dataForm.groupID,libName:e.dataForm.libName,manuf:e.dataForm.manuf,name:e.dataForm.name,type:e.dataForm.type}]}else{if(!e.$hasPermission("protocol:insert:permission.do"))return void e.$message.warning("暂无协议新增权限, 请联系管理员");a=[{attribute:e.dataForm.attribute,defaultCfg:e.dataForm.defaultCfg,funcCode:JSON.stringify({data:c}),groupID:e.dataForm.groupID,libName:e.dataForm.libName,manuf:e.dataForm.manuf,name:e.dataForm.name,type:e.dataForm.type}],t="/protocol/insert.do",e.copySource&&(t="/protocol/insert.do?oid="+e.copySource.id)}e.loading=!0,e.$http[e.dataForm.id?"put":"post"](t,a).then((function(t){var o=t.data;if(0!==o.code)return e.loading=!1,e.$message.error(o.data||o.msg);e.loading=!1,e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(t){return e.loading=!1,!1}))}))}),1e3,{leading:!0,trailing:!1})}},m=p,f=o("2877"),g=Object(f["a"])(m,a,r,!1,null,null,null);t["default"]=g.exports}}]);