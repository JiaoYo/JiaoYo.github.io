(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-85e64112"],{"3f22":function(e,t,n){"use strict";n("bbf6")},"710e":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e._self._c;return t("section",[t("el-header",{staticStyle:{height:"50px"}},[t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("span",[e._v("Â Â Â Â ")]),t("span",[e._v(e._s(e.$t("chlwatch.gwsn")))]),t("span",{staticClass:"colorConfig"},[e._v(e._s(e.dataForm.sn))]),t("span",[e._v("Â Â Â Â ")]),t("span",[e._v(e._s(e.$t("chlwatch.lineStatus")))]),t("span",{staticClass:"statusWrap",style:{backgroundColor:0==e.dataForm.status?"#ffa500":"#0f0"}}),t("span",{class:0==e.dataForm.status?"colorConfig redConfig":"colorConfig"},[e._v(e._s(0==e.dataForm.status?"å…³é—­":1==e.dataForm.status?"è¿è¡Œ":2==e.dataForm.status?"æ­£åœ¨è¿è¡Œ(æ— æ³•è·å–é…ç½®)":"å…³é—­"))]),t("span",[e._v("Â Â Â Â ")]),0==e.dataForm.type?t("span",[e._v(e._s("COM:"))]):e._e(),0==e.dataForm.type?t("span",{staticClass:"colorConfig",staticStyle:{"margin-left":"5px"}},[e._v(e._s(e.dataForm.com))]):e._e(),0==e.dataForm.type?t("span",[e._v("Â Â Â Â ")]):e._e(),t("span",[e._v(e._s("æ³¢ç‰¹ç‡:"))]),t("span",{staticClass:"colorConfig",staticStyle:{"margin-left":"5px"}},[e._v(e._s(e.dataForm.baud))])])]),e._m(0),t("el-dialog",{attrs:{visible:e.checkSnAndPwdVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.checkSnAndPwdVisible=t}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleCheckSnAndPwdConfirmChange.apply(null,arguments)}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.checkSnAndPwdLoading,expression:"checkSnAndPwdLoading"}],ref:"checkSnAndPwdRef",attrs:{rules:e.rules,model:e.checkSnAndPwdForm,"label-width":"80px"}},[t("el-row",[t("el-col",{attrs:{xl:24,md:24,sm:24}},[t("el-form-item",{attrs:{prop:"sn",label:"ç½‘å…³ç¼–å·"}},[t("el-input",{attrs:{readonly:""},model:{value:e.checkSnAndPwdForm.sn,callback:function(t){e.$set(e.checkSnAndPwdForm,"sn",t)},expression:"checkSnAndPwdForm.sn"}})],1)],1),t("el-col",{attrs:{xl:24,md:24,sm:24}},[t("el-form-item",{attrs:{prop:"pwd",label:"ç½‘å…³å¯†ç "}},[t("el-input",{ref:"input",attrs:{placeholder:"è¯·è¾“å…¥ç½‘å…³å¯†ç ",clearable:"","show-password":""},model:{value:e.checkSnAndPwdForm.pwd,callback:function(t){e.$set(e.checkSnAndPwdForm,"pwd",t)},expression:"checkSnAndPwdForm.pwd"}})],1)],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleCheckSnAndPwdConfirmChange}},[e._v(e._s(e.$t("confirm")))])],1)],1),t("el-dialog",{attrs:{title:"æç¤º",visible:e.dialogVisible,width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleCloseDialogChange},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("span",[e._v("æ‚¨å·²ç»ä¸‰åˆ†é’Ÿæ— æ“ä½œï¼Œè¿æ¥å·²è‡ªåŠ¨æ–­å¼€")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleCloseDialogChange}},[e._v("å…³é—­")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleReconnectChange}},[e._v("é‡æ–°è¿æ¥")])],1)])],1)},i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"box"},[t("div",{staticClass:"xterm-box",attrs:{id:"xterm"}})])}],r=(n("4917"),n("f559"),n("96cf"),n("1da1")),o=(n("6b54"),n("a481"),n("fcf3")),a=n("47d0"),c=(n("173c"),n("abb2"),n("a78e")),l=n.n(c),d=n("ed08"),u={name:"xterm",data:function(){return{dataForm:{sn:"",com:"",baud:null,type:null,status:null},term:null,socket:"",WebSocketUrl:"",lockReconnect:!1,timeout:28e3,timeoutObj:null,timeoutnum:null,pasteHandler:null,idleTimeout:18e4,idleTimer:null,lastActivityTime:null,checkSnAndPwdVisible:!0,checkSnAndPwdLoading:!1,checkSnAndPwdForm:{sn:"",pwd:""},dialogVisible:!1,rules:{pwd:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},mounted:function(){if(!l.a.get("token"))return this.$router.replace({name:"login"}).catch((function(e){return!1})),!1;var e=this.$route.query;this.checkSnAndPwdForm.sn=e.sn,this.checkSnAndPwdForm.pwd="",this.dataForm.sn=e.sn,this.dataForm.type=e.type,this.dataForm.com=e.com,this.dataForm.baud=e.baud,this.dataForm.status=e.status,this.checkSnAndPwdLoading=!1,this.checkSnAndPwdVisible=!0},beforeDestroy:function(){this.close(),this.timeoutObj&&clearTimeout(this.timeoutObj),this.timeoutnum&&clearTimeout(this.timeoutnum),this.idleTimer&&clearTimeout(this.idleTimer),this.term&&(this.term.textarea.removeEventListener("paste",this.pasteHandler),this.term.element.removeEventListener("paste",this.pasteHandler))},methods:{stringToHex:function(e){for(var t=/[\u4E00-\u9FA5]/,n=[],s=0;s<e.length;s++){var i="";i=t.test(e.charAt(s))?encodeURI(e.charAt(s)).replace(/%/g,""):e.charCodeAt(s).toString(16),n.push(i)}return e=n.join(""),e},handleCheckSnAndPwdConfirmChange:function(){var e=this,t=this;t.$refs["checkSnAndPwdRef"].validate((function(n){if(!n)return!1;t.checkSnAndPwdLoading=!0,t.$http.get("/info/tgwinfo/tgwinfoNameAndPwd",{params:{gwsn:t.checkSnAndPwdForm.sn,pwd:t.checkSnAndPwdForm.pwd}}).then((function(n){var s=n.data;if("fail"==s.msg)t.$message.error(s.data),t.checkSnAndPwdForm.safePassword="",t.checkSnAndPwdLoading=!1;else{t.checkSnAndPwdLoading=!1,t.checkSnAndPwdVisible=!1;var i=e.$randomStrFun(),r=String(parseInt((new Date).getTime().toString().substring(0,10))),o={sn:t.checkSnAndPwdForm.sn,pwd:t.checkSnAndPwdForm.pwd},a=Object(d["o"])(JSON.stringify(o));t.WebSocketUrl=window.SITE_CONFIG["socketUrl"]+"tcpWebsocket/"+t.stringToHex(a)+"/"+t.$md5(t.stringToHex(a)+i+r)+"/"+r,t.init(t.WebSocketUrl)}})).catch((function(e){return!1}))}))},reconnect:function(){var e=this;e.lockReconnect||(e.lockReconnect=!0,e.timeoutnum&&clearTimeout(e.timeoutnum),e.timeoutnum=setTimeout((function(){e.init(e.WebSocketUrl),e.lockReconnect=!1}),2e3))},start:function(){var e=this;e.timeoutObj&&clearTimeout(e.timeoutObj),e.timeoutObj=setInterval((function(){1==e.socket.readyState&&e.socket&&e.socket.send("")}),e.timeout)},resetIdleTimer:function(){var e=this;clearTimeout(this.idleTimer),this.lastActivityTime=Date.now(),this.idleTimer=setTimeout((function(){e.closeConnection()}),this.idleTimeout)},closeConnection:function(){this.close(),this.dialogVisible=!0},initXterm:function(){var e=this;e.term&&e.term.dispose(),e.term=new o["Terminal"]({rendererType:"canvas",rows:35,convertEol:!0,scrollback:10,disableStdin:!1,cursorStyle:"underline",cursorBlink:!0,theme:{foreground:"yellow",background:"#060101",cursor:"help"}}),e.term.open(document.getElementById("xterm"));var t=new a["FitAddon"];e.term.loadAddon(t),t.fit();var n="",s=0;e.term.attachCustomKeyEventHandler(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(i){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.resetIdleTimer(),"keydown"!==i.type||"v"!==i.key||!i.ctrlKey){t.next=2;break}return t.next=1,navigator.clipboard.readText();case 1:if(r=t.sent,!r){t.next=2;break}return e.term.write(r),n=n.substring(0,s)+r+n.substring(s),s+=r.length,t.abrupt("return",!1);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.term.onData((function(t){if(e.resetIdleTimer(),t.length>1&&!t.startsWith(""))return e.term.write(t),n=n.substring(0,s)+t+n.substring(s),void(s+=t.length);if("\r"===t)e.socket.send(n+"\r\n"),e.term.write("\r\n"),n="",s=0;else if(""===t){if(n.length>0){var i=n.charAt(s-1);n=n.substring(0,s-1)+n.substring(s),s--,i.match(/[\u4e00-\u9fa5]/)?e.term.write("\b \b\b \b"):e.term.write("\b \b")}}else"[A"===t||"[B"===t?(e.term.write("\r[K"),e.socket.send(t+"\r\n"),n="",s=0):"[C"===t?s<n.length&&(s++,e.term.write(t)):"[D"===t?s>0&&(s--,e.term.write(t)):"\t"===t?e.socket.send(n+t+"\r\n"):""===t?(e.socket.send("\r\n"),n="",s=0,e.term.write("^C\r\n")):t>=String.fromCharCode(32)&&t<=String.fromCharCode(126)&&(n=n.substring(0,s)+t+n.substring(s),s++,e.term.write(t))}))},init:function(e){this.socket=new WebSocket(e),this.socket.onopen=this.open,this.socket.onerror=this.error,this.socket.onmessage=this.getMessage,this.socket.onsend=this.send},open:function(){this.initXterm(),this.resetIdleTimer(),this.start()},error:function(){this.reconnect()},close:function(){this.socket&&this.socket.close(),this.term&&(this.term.options.disableStdin=!0),this.idleTimer&&clearTimeout(this.idleTimer)},getMessage:function(e){"è¿æ¥æˆåŠŸ"!=e["data"]&&this.term.write(e["data"])},send:function(e){this.socket&&this.socket.send(e)},handleCloseDialogChange:function(){this.close(),this.dialogVisible=!1,window.close()},handleReconnectChange:function(){}}},m=u,h=(n("3f22"),n("2877")),f=Object(h["a"])(m,s,i,!1,null,"202f310e",null);t["default"]=f.exports},bbf6:function(e,t,n){}}]);