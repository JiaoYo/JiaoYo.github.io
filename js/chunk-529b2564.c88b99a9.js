(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-529b2564"],{"0c53":function(e,t,a){"use strict";a("cccd3")},"2bc0":function(e,t,a){"use strict";a("d19c")},4579:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose,footer:null},on:{"update:visible":function(t){e.visible=t}}},[t("el-steps",{attrs:{active:e.activeStep}},[t("el-step",{attrs:{title:"上传文件",icon:"el-icon-upload"}}),t("el-step",{attrs:{title:"新增驱动",icon:"el-icon-circle-check"}})],1),0==e.activeStep?t("div",[t("el-row",{staticStyle:{margin:"10px 0"}},[t("el-col",{attrs:{xs:24,sm:24,md:12,lg:12,xl:12}},[t("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"","show-file-list":!1,"http-request":e.uploadSectionFile,"file-list":e.fileList,"before-upload":e.beforeUpload,multiple:"",limit:300,"on-exceed":e.handleExceed}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")]),e._v(", 只能上传so文件")])])],1),t("el-col",{attrs:{xs:24,sm:24,md:12,lg:12,xl:12}},[t("el-input",{attrs:{type:"textarea",readonly:"",autosize:{minRows:8,maxRows:8},placeholder:"上传文件名称"},model:{value:e.fileNames,callback:function(t){e.fileNames=t},expression:"fileNames"}})],1)],1),t("el-row",[t("el-col",{attrs:{xs:24,sm:24,md:12,lg:12,xl:12}},[t("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"",accept:"application/json","http-request":e.uploadSectionJSONFile,"on-remove":e.handleJSONRemove,"file-list":e.fileJSONList,"before-upload":e.beforeJSONUpload}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")]),e._v(", 只能上传json文件")])])],1)],1)],1):e._e(),1==e.activeStep?t("div",[t("el-row",[t("el-col",{attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[t("vxe-table",{ref:"recordTable",staticStyle:{width:"100%"},attrs:{size:"medium",border:"",resizable:"","auto-resize":"","sync-resize":"","show-overflow":"","show-header-overflow":"","highlight-hover-row":"","highlight-current-row":"",data:e.dataList,"max-height":"400"}},[t("vxe-table-column",{key:"1",attrs:{field:"name",title:"驱动名称","header-align":"center",align:"center",width:"230",fixed:"left","show-overflow-tooltip":!0}}),t("vxe-table-column",{key:"2",attrs:{field:"platform",title:"平台","header-align":"center",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[e.fileJSONList.length>0?t("span",[e._v(e._s(0==a.row.platform?"A7":1==a.row.platform?"arm9":2==a.row.platform?"x86-linux":3==a.row.platform?"A53":4==a.row.platform?"A9":"--"))]):t("el-select",{on:{change:function(t){return e.handlePlantFormChange(a.row)}},model:{value:a.row.platform,callback:function(t){e.$set(a.row,"platform",t)},expression:"scope.row.platform"}},e._l(e.plantformList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}],null,!1,372935393)}),t("vxe-table-column",{key:"3",attrs:{field:"mainVer",title:"主版本","header-align":"center",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[e.fileJSONList.length>0?t("span",[e._v(e._s(a.row.mainVer))]):t("el-input-number",{attrs:{min:1},model:{value:a.row.mainVer,callback:function(t){e.$set(a.row,"mainVer",t)},expression:"scope.row.mainVer"}})]}}],null,!1,3535865292)}),t("vxe-table-column",{key:"4",attrs:{field:"subVer",title:"子版本","header-align":"center",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[e.fileJSONList.length>0?t("span",[e._v(e._s(a.row.subVer))]):t("el-input-number",{attrs:{min:1},model:{value:a.row.subVer,callback:function(t){e.$set(a.row,"subVer",t)},expression:"scope.row.subVer"}})]}}],null,!1,2168432108)})],1)],1)],1)],1):e._e(),t("template",{slot:"footer"},[0==e.activeStep?t("div",[t("el-button",{on:{click:e.handleClose}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleNextStepChange}},[e._v("下一步")])],1):e._e(),1==e.activeStep?t("div",[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1):e._e()])],2)},i=[],r=(a("20d6"),a("2909")),l=(a("6762"),a("2fdb"),a("ac6a"),a("7f7f"),a("b047")),o=a.n(l),s={props:["platform","drivePropId"],data:function(){return{visible:!1,activeStep:0,fileList:[],fileNames:"",fileNameList:[],fileJSONList:[],dataList:[],storeDataList:[],plantformList:[{label:"A7",value:0},{label:"arm9",value:1},{label:"x86-linux",value:2},{label:"A53",value:3},{label:"A9",value:4}],plantMainSunVerMap:{}}},methods:{init:function(){var e=this;this.visible=!0,this.$nextTick((function(){e.activeStep=0,e.fileList=[],e.dataList=[],e.fileNameList=[],e.fileNames="",e.fileJSONList=[],e.plantMainSunVerMap={}}))},beforeUpload:function(e){if(-1==e.name.indexOf(".so"))return this.$message.error(this.$t("upload.tip",{format:"so"})),!1},handleRemove:function(e,t){this.fileNameList=this.fileNameList.filter((function(t){return t+".so"!==e.name})),this.fileList=t,this.fileNames=this.fileNameList.length>0?this.fileNameList.join(","):""},handleExceed:function(e,t){this.$message.warning("$t('driver.currentlyLimitFielsToSelect') ".concat(e.length," $t('driver.filesTotalSelected') ").concat(e.length+t.length," $t('driver.files')"))},uploadSectionFile:function(e){this.fileList.push(e.file),this.fileNameList.push(e.file.name.substring(0,e.file.name.lastIndexOf(".so"))),this.fileNames=this.fileNameList.join(",")},beforeJSONUpload:function(e){if("application/json"!=e.type||-1==e.name.indexOf(".json"))return this.$message.error(this.$t("upload.tip",{format:"json"})),!1},handleJSONRemove:function(e,t){this.fileJSONList=t},uploadSectionJSONFile:function(e){this.fileJSONList.push(e.file),this.getUploadJsonData(e.file)},getUploadJsonData:function(e){var t=this;t.storeDataList=[];var a=new FileReader;a.readAsText(e,"UTF-8"),a.onload=function(e){var a=JSON.parse(e.target.result);a.length>0&&a.forEach((function(e){t.storeDataList.push({name:e.libName,platform:e.platform,mainVer:e.mainVer,subVer:e.subVer})}))}},handleNextStepChange:function(){var e=this,t=!0,a=[];if(e.dataList=[],0==e.fileNameList.length||0==e.fileList.length)return e.$message.warning(e.$t("driver.pleaseUploadSoFileFirst"));if(e.fileJSONList.length>0)if(e.storeDataList.length<e.fileNameList.length){var n=e.storeDataList.map((function(e){return e.name}));a=n.filter((function(t){return!e.fileNameList.includes(t)})),a.length>0?(t=!1,e.storeDataList.forEach((function(t){a.includes(t.name)||e.dataList.push(t)}))):e.dataList=e.storeDataList}else{e.fileNameList.forEach((function(t){e.storeDataList.forEach((function(a){t==a.name&&e.dataList.push(a)}))}));var i=e.storeDataList.map((function(e){return e.name}));a=i.filter((function(t){return!e.fileNameList.includes(t)})),a.length>0&&(t=!1)}else{t=!0;var l=parseInt(e.platform);e.$http.get("/drivers/driversVersion.do",{params:{libNames:e.fileNameList.join(",")}}).then((function(t){var a=t.data;if(0!=a.code)return e.$message.error(a.data||a.msg);if("{}"!=JSON.stringify(a.data)){for(var n in e.plantMainSunVerMap={},a.data)a.data[n].length>0&&a.data[n].forEach((function(t){e.plantMainSunVerMap.hasOwnProperty(t.libName+"&"+t.platform)?(e.plantMainSunVerMap[t.libName+"&"+t.platform].mainVer.push(t.mainVer),e.plantMainSunVerMap[t.libName+"&"+t.platform].subVer.push(t.subVer)):e.plantMainSunVerMap[t.libName+"&"+t.platform]={mainVer:[t.mainVer],subVer:[t.subVer]}}));e.fileNameList.forEach((function(t){var a=-1,n=-1,i=-1;0==l||1==l||2==l||3==l||4==l?e.plantMainSunVerMap.hasOwnProperty(t+"&"+l)&&e.plantMainSunVerMap[t+"&"+l].mainVer.length>0&&(n=Math.max.apply(Math,Object(r["a"])(e.plantMainSunVerMap[t+"&"+l].mainVer)),a=e.plantMainSunVerMap[t+"&"+l].mainVer.findIndex((function(e){return e==n})),i=e.plantMainSunVerMap[t+"&"+l].subVer[a]):e.plantMainSunVerMap.hasOwnProperty(t+"&0")&&e.plantMainSunVerMap[t+"&0"].mainVer.length>0&&(n=Math.max.apply(Math,Object(r["a"])(e.plantMainSunVerMap[t+"&0"].mainVer)),a=e.plantMainSunVerMap[t+"&0"].mainVer.findIndex((function(e){return e==n})),i=e.plantMainSunVerMap[t+"&0"].subVer[a]),e.dataList.push({name:t,platform:0==l||1==l||2==l||3==l||4==l?l:0,mainVer:-1!=a?n:1,subVer:-1!=a?i:1})}))}else e.fileNameList.forEach((function(t){e.dataList.push({name:t,platform:0==l||1==l||2==l||3==l||4==l?l:0,mainVer:null,subVer:null})}))}))}t?e.activeStep=1:e.fileJSONList.length>0&&e.$confirm(e.$t("driver.missingFromSoFile")+a.join("、")+e.$t("driver.waitFiles")+","+e.$t("driver.whetherToContinue"),e.$t("prompt.title"),{confirmButtonText:e.$t("confirm"),cancelButtonText:e.$t("cancel"),type:"warning"}).then((function(){e.activeStep=1})).catch((function(){}))},handlePlantFormChange:function(e){var t=-1,a=-1,n=-1;this.plantMainSunVerMap.hasOwnProperty(e.name+"&"+e.platform)&&this.plantMainSunVerMap[e.name+"&"+e.platform].mainVer.length>0&&(a=Math.max.apply(Math,Object(r["a"])(this.plantMainSunVerMap[e.name+"&"+e.platform].mainVer)),t=this.plantMainSunVerMap[e.name+"&"+e.platform].mainVer.findIndex((function(e){return e==a})),n=this.plantMainSunVerMap[e.name+"&"+e.platform].subVer[t]),-1!=t?(e.mainVer=a,e.subVer=n):(e.mainVer=1,e.subVer=1)},handleClose:function(){this.fileList=[],this.dataList=[],this.fileNameList=[],this.fileNames="",this.fileJSONList=[],this.plantMainSunVerMap={},this.visible=!1},dataFormSubmitHandle:o()((function(){var e=this,t=this,a=[],n=[];if(t.$hasPermission("drivers:upload:permission.do"))if(t.fileJSONList.length>0){t.dataList.forEach((function(e){t.fileList.forEach((function(i){if(e.name+".so"==i.name){var r=new FormData;r.append("file",i),r.append("platform",e.platform),r.append("mainVer",e.mainVer),r.append("subVer",e.subVer),t.$http.post("/drivers/upload.do",r).then((function(t){var i=t.data;0!=i.code&&(a.push(e.name),n.push(e))}))}}))}));var i=function(){if(!(a.length>0))return t.$message.success(t.$t("prompt.success")),t.handleClose(),t.$emit("refreshDataList");e.$confirm(a.join(",")+e.$t("driver.soFileUploadFailsWantToContinueUpload"),e.$t("prompt.title"),{confirmButtonText:e.$t("confirm"),cancelButtonText:e.$t("cancel"),type:"warning"}).then((function(){a=[],n=[],n.forEach((function(e){t.fileList.forEach((function(i){if(e.name+".so"==i.name){var r=new FormData;r.append("file",i),r.append("platform",e.platform),r.append("mainVer",e.mainVer),r.append("subVer",e.subVer),t.$http.post("/drivers/upload.do",r).then((function(t){var i=t.data;0!=i.code&&(a.push(e.name),n.push(r))}))}}))}))})).catch((function(){return t.handleClose(),t.$emit("refreshDataList")}))};i()}else{var r=!0;if(t.dataList.forEach((function(e){e.mainVer&&e.subVer||(r=!1)})),!r)return t.$message.warning(t.$t("driver.mainversionAndSubversionCannotBeEmpty"));t.dataList.forEach((function(e){t.fileList.forEach((function(i){if(e.name+".so"==i.name){var r=new FormData;r.append("file",i),r.append("platform",e.platform),r.append("mainVer",e.mainVer),r.append("subVer",e.subVer),t.$http.post("/drivers/upload.do",r).then((function(t){var i=t.data;0!=i.code&&(a.push(e.name),n.push(e))}))}}))}));var l=function(){if(!(a.length>0))return t.$message.success(t.$t("prompt.success")),t.handleClose(),t.$emit("refreshDataList");e.$confirm(a.join(",")+e.$t("driver.soFileUploadFailsWantToContinueUpload"),e.$t("prompt.title"),{confirmButtonText:e.$t("confirm"),cancelButtonText:e.$t("cancel"),type:"warning"}).then((function(){a=[],n=[],n.forEach((function(e){t.fileList.forEach((function(i){if(e.name+".so"==i.name){var r=new FormData;r.append("file",i),r.append("platform",e.platform),r.append("mainVer",e.mainVer),r.append("subVer",e.subVer),t.$http.post("/drivers/upload.do",r).then((function(t){var i=t.data;0!=i.code&&(a.push(e.name),n.push(r))}))}}))}))})).catch((function(){return t.handleClose(),t.$emit("refreshDataList")}))};l()}else t.$message.warning("暂无驱动上传权限, 请联系管理员")}),1e3,{leading:!0,trailing:!1})}},p=s,u=(a("2bc0"),a("0c53"),a("2877")),f=Object(u["a"])(p,n,i,!1,null,"4cbfe774",null);t["default"]=f.exports},cccd3:function(e,t,a){},d19c:function(e,t,a){}}]);