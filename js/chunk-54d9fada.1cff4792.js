(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-54d9fada"],{5770:function(e,t,r){"use strict";r("9a54")},8850:function(e,t,r){"use strict";r.r(t);r("a481");var a=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataRule,"label-width":"en-US"===e.$i18n.locale?"120px":"80px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.projectName"),prop:"prjName"}},[t("el-input",{attrs:{placeholder:e.$t("project.projectName"),clearable:""},on:{input:function(t){e.dataForm.prjName=e.dataForm.prjName.replace(/\s+/g,"")}},model:{value:e.dataForm.prjName,callback:function(t){e.$set(e.dataForm,"prjName","string"===typeof t?t.trim():t)},expression:"dataForm.prjName"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.location"),prop:"prjAddr"}},[t("el-input",{attrs:{placeholder:e.$t("project.location")},model:{value:e.dataForm.prjAddr,callback:function(t){e.$set(e.dataForm,"prjAddr",t)},expression:"dataForm.prjAddr"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.detailLocation"),prop:"prjaddress"}},[t("el-input",{attrs:{placeholder:e.$t("project.enterDetailLocation"),clearable:""},model:{value:e.dataForm.prjaddress,callback:function(t){e.$set(e.dataForm,"prjaddress",t)},expression:"dataForm.prjaddress"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.creator"),prop:"createName"}},[t("el-input",{attrs:{placeholder:e.$t("project.creator"),readonly:""},model:{value:e.dataForm.createName,callback:function(t){e.$set(e.dataForm,"createName",t)},expression:"dataForm.createName"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"deptName",label:e.$t("user.deptName")}},[t("el-popover",{ref:"deptListPopover",attrs:{placement:"bottom-start",trigger:"click",disabled:0==e.superAdmin},model:{value:e.deptListVisible,callback:function(t){e.deptListVisible=t},expression:"deptListVisible"}},[t("el-input",{attrs:{size:"small",clearable:""},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),t("el-tree",{ref:"deptListTree",attrs:{id:"singleTree",data:e.deptIdList,props:{label:"name",children:"children"},"node-key":"id","highlight-current":!0,"expand-on-click-node":!1,accordion:"","filter-node-method":e.filterNode},on:{"current-change":e.deptListTreeCurrentChangeHandle}})],1),t("el-input",{directives:[{name:"popover",rawName:"v-popover:deptListPopover",arg:"deptListPopover"}],attrs:{readonly:!0,placeholder:e.$t("user.deptName")},model:{value:e.dataForm.deptName,callback:function(t){e.$set(e.dataForm,"deptName",t)},expression:"dataForm.deptName"}})],1)],1)],1)],1)],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},i=[],o=(r("8e6e"),r("456d"),r("ade3")),d=(r("ac6a"),r("7f7f"),r("b047")),s=r.n(d);function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){Object(o["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p={props:{id:{type:String,default:""},createName:{type:String,default:""}},data:function(){return{map:null,mapZoom:18,marker:null,localsearch:null,visible:!1,loading:!1,mapLocation:{address:void 0},filterText:"",deptIdList:[],deptListVisible:!1,dataForm:{id:"",prjName:"",prjDesc:"",prjAddr:"",prjUrl:"",prjaddress:"",latitude:"30.310701",longitude:"120.382155",createName:"",deptId:"",deptName:""},superAdmin:0}},computed:{dataRule:function(){return{prjName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjDesc:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjAddr:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjaddress:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){var e=this;this.superAdmin=this.$store.state.user.superAdmin,this.$hasPermission("dept:select:permission.do")?(this.loading=!0,this.getSystemDeptList((function(t){e.filterText="",e.deptIdList=t.data.list,e.visible=!0,e.dataForm.id=e.id,e.mapZoom=18,e.$nextTick((function(){e.$refs["dataForm"].resetFields(),e.dataForm.id?e.getInfo():(e.dataForm.deptId=e.$store.state.user.deptId,e.$refs.deptListTree&&(e.$refs.deptListTree.setCurrentKey(e.dataForm.deptId),setTimeout((function(){e.dataForm.deptName=e.$refs.deptListTree.getCurrentNode()?e.$refs.deptListTree.getCurrentNode().name:""}),200))),e.dataForm.createName=e.$store.state.user.name,e.loading=!1}))}))):(this.filterText="",this.deptIdList=[],this.visible=!0,this.dataForm.id=this.id,this.mapZoom=18,this.$nextTick((function(){e.$refs["dataForm"].resetFields(),e.dataForm.id?e.getInfo():(e.dataForm.deptId=e.$store.state.user.deptId,e.$refs.deptListTree&&(e.$refs.deptListTree.setCurrentKey(e.dataForm.deptId),setTimeout((function(){e.dataForm.deptName=e.$refs.deptListTree.getCurrentNode()?e.$refs.deptListTree.getCurrentNode().name:""}),200))),e.dataForm.createName=e.$store.state.user.name,setTimeout((function(){e.$message.warning("暂无部门查询权限, 请联系管理员")}),500)})))},getSystemDeptList:function(e){var t=this;this.deptIdList=[],this.$http.get("/sys/dept/getDeptList.do",{params:{pageNum:1,pageSize:1e4}}).then((function(r){var a=r.data;if(0!=a.code)return t.$message.error(a.data||a.msg);e(a)}))},deptListTreeCurrentChangeHandle:function(e,t){this.dataForm.deptId=e.id,this.dataForm.deptName=e.name,this.deptListVisible=!1},filterNode:function(e,t,r){if(!e)return!0;r.level;var a=[];this.getReturnNode(r,a,e);var i=!1;return a.forEach((function(e){i=i||e})),i},getReturnNode:function(e,t,r){var a=e.data&&e.data.name&&-1!==e.data.name.indexOf(r);a&&t.push(a),!a&&1!=e.level&&e.parent&&this.getReturnNode(e.parent,t,r)},getInfo:function(){var e=this;if(e.$hasPermission("tprjinfo:select:permission.do"))return e.dataForm.id?(e.loading=!0,void e.$http.get("/info/tprjinfo/".concat(e.dataForm.id)).then((function(t){var r=t.data;if(0!==r.code)return e.loading=!1,e.$message.error(r.data||r.msg);e.dataForm=l(l({},e.dataForm),r.data),e.dataForm.createName=e.createName,e.$refs.deptListTree&&(e.$refs.deptListTree.setCurrentKey(e.dataForm.deptId),setTimeout((function(){e.dataForm.deptName=e.$refs.deptListTree.getCurrentNode()?e.$refs.deptListTree.getCurrentNode().name:""}),200)),e.handlerMap()})).catch((function(t){return e.loading=!1,!1}))):(this.visible=!1,this.$message.error(this.$t("failedToGetProjectId")));e.$message.warning("暂无根据项目ID查询权限, 请联系管理员")},handleClose:function(){if(this.map){var e=document.getElementById("containerTprj");e&&(e.innerHTML=""),this.map=null}this.visible=!1},dataFormSubmitHandle:s()((function(){var e=this;this.$refs["dataForm"].validate((function(t){if(!t)return!1;var r={};if(e.dataForm.id){if(r={deptId:e.dataForm.deptId,id:e.dataForm.id,latitude:e.dataForm.latitude,longitude:e.dataForm.longitude,prjAddr:e.dataForm.prjAddr,prjDesc:e.dataForm.prjDesc,prjName:e.dataForm.prjName,prjUrl:e.dataForm.prjUrl,prjaddress:e.dataForm.prjaddress},!e.$hasPermission("info:tprjinfo:update"))return void e.$message.warning("暂无项目修改权限, 请联系管理员")}else if(r=e.dataForm,!e.$hasPermission("info:tprjinfo:save"))return void e.$message.warning("暂无项目保存权限, 请联系管理员");e.loading=!0,e.$http[e.dataForm.id?"put":"post"]("/info/tprjinfo/",r).then((function(t){var r=t.data;if(e.loading=!1,0!==r.code)return e.$message.error(r.data||r.msg);e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(t){return e.loading=!1,!1}))}))}),1e3,{leading:!0,trailing:!1})},watch:{filterText:function(e){this.$refs.deptListTree.filter(e)}}},m=p,c=(r("5770"),r("2877")),u=Object(c["a"])(m,a,i,!1,null,null,null);t["default"]=u.exports},"9a54":function(e,t,r){}}]);