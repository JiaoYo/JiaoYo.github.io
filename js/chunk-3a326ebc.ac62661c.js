(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a326ebc"],{"4c12":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a("3835"),n={bd09ToGcj02:function(e,t){var a=e-.0065,r=t-.006,n=Math.sqrt(a*a+r*r)-2e-5*Math.sin(r*Math.PI),o=Math.atan2(r,a)-3e-6*Math.cos(a*Math.PI);return[n*Math.cos(o),n*Math.sin(o)]},gcj02ToWgs84:function(e,t){if(this._outOfChina(e,t))return[e,t];var a=this._transformLat(e-105,t-35),r=this._transformLng(e-105,t-35),n=t/180*Math.PI,o=Math.sin(n),i=.006693421622965943,s=6378245,d=Math.sqrt(1-i*o*o),l=180*a/(s*(1-i)/Math.pow(d,3)*Math.PI),p=180*r/(s/d*Math.cos(n)*Math.PI);return[e-p,t-l]},bd09ToWgs84:function(e,t){var a=this.bd09ToGcj02(e,t),n=Object(r["a"])(a,2),o=n[0],i=n[1];return this.gcj02ToWgs84(o,i)},_transformLat:function(e,t){var a=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return a+=2*(20*Math.sin(6*e*Math.PI)+20*Math.sin(2*e*Math.PI))/3,a+=2*(20*Math.sin(t*Math.PI)+40*Math.sin(t/3*Math.PI))/3,a+=2*(160*Math.sin(t/12*Math.PI)+320*Math.sin(t*Math.PI/30))/3,a},_transformLng:function(e,t){var a=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return a+=2*(20*Math.sin(6*e*Math.PI)+20*Math.sin(2*e*Math.PI))/3,a+=2*(20*Math.sin(e*Math.PI)+40*Math.sin(e/3*Math.PI))/3,a+=2*(150*Math.sin(e/12*Math.PI)+300*Math.sin(e/30*Math.PI))/3,a},_outOfChina:function(e,t){return!(e>73.66&&e<135.05&&t>3.86&&t<53.55)}}},7636:function(e,t,a){"use strict";a("c272")},8044:function(e,t,a){"use strict";a.r(t);a("a481");var r=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataRule,"label-width":"en-US"===e.$i18n.locale?"120px":"80px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.projectName"),prop:"prjName"}},[t("el-input",{attrs:{placeholder:e.$t("project.projectName"),clearable:""},on:{input:function(t){e.dataForm.prjName=e.dataForm.prjName.replace(/\s+/g,"")}},model:{value:e.dataForm.prjName,callback:function(t){e.$set(e.dataForm,"prjName","string"===typeof t?t.trim():t)},expression:"dataForm.prjName"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.location"),prop:"prjAddr"}},[t("el-input",{attrs:{placeholder:e.$t("project.location"),readonly:""},model:{value:e.dataForm.prjAddr,callback:function(t){e.$set(e.dataForm,"prjAddr",t)},expression:"dataForm.prjAddr"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.detailLocation"),prop:"prjaddress"}},[t("el-input",{attrs:{placeholder:e.$t("project.enterDetailLocation"),clearable:""},model:{value:e.dataForm.prjaddress,callback:function(t){e.$set(e.dataForm,"prjaddress",t)},expression:"dataForm.prjaddress"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.creator"),prop:"createName"}},[t("el-input",{attrs:{placeholder:e.$t("project.creator"),readonly:""},model:{value:e.dataForm.createName,callback:function(t){e.$set(e.dataForm,"createName",t)},expression:"dataForm.createName"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"deptName",label:e.$t("user.deptName")}},[t("el-popover",{ref:"deptListPopover",attrs:{placement:"bottom-start",trigger:"click",disabled:0==e.superAdmin},model:{value:e.deptListVisible,callback:function(t){e.deptListVisible=t},expression:"deptListVisible"}},[t("el-input",{attrs:{size:"small",clearable:""},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),t("el-tree",{ref:"deptListTree",attrs:{id:"singleTree",data:e.deptIdList,props:{label:"name",children:"children"},"node-key":"id","highlight-current":!0,"expand-on-click-node":!1,accordion:"","filter-node-method":e.filterNode},on:{"current-change":e.deptListTreeCurrentChangeHandle}})],1),t("el-input",{directives:[{name:"popover",rawName:"v-popover:deptListPopover",arg:"deptListPopover"}],attrs:{readonly:!0,placeholder:e.$t("user.deptName")},model:{value:e.dataForm.deptName,callback:function(t){e.$set(e.dataForm,"deptName",t)},expression:"dataForm.deptName"}})],1)],1)],1)],1)],1),t("el-col",{attrs:{span:12}},[e.visible?t("div",{staticClass:"app-container"},[t("el-autocomplete",{staticStyle:{width:"100%"},attrs:{clearable:"","fetch-suggestions":function(t,a){e.getSearchList(t,a)},placeholder:e.$t("project.enterPosition"),"trigger-on-focus":!1},on:{select:e.handleSelect},model:{value:e.mapLocation.address,callback:function(t){e.$set(e.mapLocation,"address",t)},expression:"mapLocation.address"}}),t("div",{staticStyle:{margin:"5px"}},[t("div",{staticStyle:{width:"100%",height:"240px"},attrs:{id:"containerTprj"}})])],1):e._e()])],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},n=[],o=(a("8e6e"),a("456d"),a("ade3")),i=(a("386d"),a("96cf"),a("1da1")),s=(a("ac6a"),a("7f7f"),a("bc3a")),d=a.n(s),l=a("862d3"),p=a.n(l),c=a("b047"),u=a.n(c);a("4c12");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(o["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var h={props:{id:{type:String,default:""},createName:{type:String,default:""}},data:function(){return{map:null,mapZoom:18,marker:null,localsearch:null,visible:!1,loading:!1,mapLocation:{address:void 0},filterText:"",deptIdList:[],deptListVisible:!1,dataForm:{id:"",prjName:"",prjDesc:"",prjAddr:"",prjUrl:"",prjaddress:"",latitude:"30.304349",longitude:"120.374391",createName:"",deptId:"",deptName:""},superAdmin:0}},computed:{dataRule:function(){return{prjName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjDesc:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjAddr:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjaddress:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){var e=this;this.superAdmin=this.$store.state.user.superAdmin,this.$hasPermission("dept:select:permission.do")?(this.loading=!0,this.getSystemDeptList((function(t){e.filterText="",e.deptIdList=t.data.list,e.visible=!0,e.dataForm.id=e.id,e.mapZoom=18,e.$nextTick((function(){e.$refs["dataForm"].resetFields(),e.dataForm.id?e.getInfo():(e.handlerMap(),e.dataForm.deptId=e.$store.state.user.deptId,e.$refs.deptListTree&&(e.$refs.deptListTree.setCurrentKey(e.dataForm.deptId),setTimeout((function(){e.dataForm.deptName=e.$refs.deptListTree.getCurrentNode()?e.$refs.deptListTree.getCurrentNode().name:""}),200)),e.getCurrentlocation()),e.dataForm.createName=e.$store.state.user.name}))}))):(this.filterText="",this.deptIdList=[],this.visible=!0,this.dataForm.id=this.id,this.mapZoom=18,this.$nextTick((function(){e.$refs["dataForm"].resetFields(),e.dataForm.id?e.getInfo():(e.handlerMap(),e.dataForm.deptId=e.$store.state.user.deptId,e.$refs.deptListTree&&(e.$refs.deptListTree.setCurrentKey(e.dataForm.deptId),setTimeout((function(){e.dataForm.deptName=e.$refs.deptListTree.getCurrentNode()?e.$refs.deptListTree.getCurrentNode().name:""}),200)),e.getCurrentlocation()),e.dataForm.createName=e.$store.state.user.name,setTimeout((function(){e.$message.warning("暂无部门查询权限, 请联系管理员")}),500)})))},getSystemDeptList:function(e){var t=this;this.deptIdList=[],this.$http.get("/sys/dept/getDeptList.do",{params:{pageNum:1,pageSize:1e4}}).then((function(a){var r=a.data;if(0!=r.code)return t.$message.error(r.data||r.msg);e(r)}))},deptListTreeCurrentChangeHandle:function(e,t){this.dataForm.deptId=e.id,this.dataForm.deptName=e.name,this.deptListVisible=!1},filterNode:function(e,t,a){if(!e)return!0;a.level;var r=[];this.getReturnNode(a,r,e);var n=!1;return r.forEach((function(e){n=n||e})),n},getReturnNode:function(e,t,a){var r=e.data&&e.data.name&&-1!==e.data.name.indexOf(a);r&&t.push(r),!r&&1!=e.level&&e.parent&&this.getReturnNode(e.parent,t,a)},handlerMap:function(){var e=this;d.a.get("/mapconfig.json?_t="+(new Date).getTime()).then(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=a.data,r&&r.gaodeKey&&(window._AMapSecurityConfig={securityJsCode:r.securityJsCode},p.a.load({key:r.gaodeKey,version:"2.0",plugins:["AMap.AutoComplete","AMap.PlaceSearch","AMap.Geocoder","AMap.CitySearch"]}).then((function(t){e.map=new t.Map("containerTprj",{viewMode:"3D",resizeEnable:!0,zoom:e.mapZoom,center:[e.dataForm.longitude||120.374391,e.dataForm.latitude||30.304349]}),e.geocodeMap=new t.Geocoder,e.map.on("click",(function(t){e.makerCenter({lat:t.lnglat.getLat(),lng:t.lnglat.getLng()})})),e.$nextTick((function(){e.dataForm.id?e.getPrjInfoLocation():e.getCurrentlocation()}))})).catch((function(e){})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getCurrentlocation:function(){var e=this;if(!e.map)return!1;e.loading=!1;var t={point:{lat:30.304349,lng:120.374391}};e.dataForm.longitude=t.point.lng,e.dataForm.latitude=t.point.lat,e.makerCenter(t.point)},getPrjInfoLocation:function(){if(!this.map)return!1;this.mapZoom=18;var e={lat:null,lng:null};this.dataForm.longitude&&this.dataForm.latitude?(e.lat=this.dataForm.latitude,e.lng=this.dataForm.longitude):(e.lat=30.303899,e.lng=120.373885),this.makerCenter(e)},getSuggestsAddressList:function(e){var t=[];if(e&&e.length>0)for(var a=0;a<e.length;a++){var r={};r.value=e[a].district?e[a].name+"("+e[a].district+")":e[a].name,r.point={lat:e[a].location?e[a].location.lat:0,lng:e[a].location?e[a].location.lng:0},t.push(r)}return t},getSearchList:function(e,t){var a=this;if(!a.map)return!1;var r={city:"",datatype:"all"},n=new AMap.Autocomplete(r);n.search(e,(function(e,r){if("complete"===e&&r.tips){var n=a.getSuggestsAddressList(r.tips);t(n)}else t([])}))},handleSelect:function(e){var t=e.point;this.dataForm.longitude=t.lng,this.dataForm.latitude=t.lat,this.makerCenter(t)},makerCenter:function(e){var t=this;t.map&&(t.map.clearMap(),t.dataForm.longitude=e.lng,t.dataForm.latitude=e.lat,t.map.setCenter(new AMap.LngLat(e.lng,e.lat)),t.marker=new AMap.Marker({position:new AMap.LngLat(e.lng,e.lat),map:t.map}),t.geocodeMap.getAddress(new AMap.LngLat(e.lng,e.lat),(function(e,a){"complete"===e&&a.regeocode?(t.mapLocation.address=a.regeocode.formattedAddress,t.dataForm.prjAddr=a.regeocode.addressComponent.province+a.regeocode.addressComponent.city+a.regeocode.addressComponent.district,t.dataForm.prjaddress=a.regeocode.formattedAddress):t.mapLocation.address=""}))),t.loading=!1},getInfo:function(){var e=this;return e.$hasPermission("tprjinfo:select:permission.do")?e.dataForm.id?(e.loading=!0,void e.$http.get("/info/tprjinfo/".concat(e.dataForm.id)).then((function(t){var a=t.data;if(0!==a.code)return e.loading=!1,e.$message.error(a.data||a.msg);e.dataForm=f(f({},e.dataForm),a.data),e.dataForm.createName=e.createName,e.$refs.deptListTree&&(e.$refs.deptListTree.setCurrentKey(e.dataForm.deptId),setTimeout((function(){e.dataForm.deptName=e.$refs.deptListTree.getCurrentNode()?e.$refs.deptListTree.getCurrentNode().name:""}),200)),e.handlerMap()})).catch((function(t){return e.loading=!1,!1}))):(this.visible=!1,this.$message.error(this.$t("failedToGetProjectId"))):(e.$message.warning("暂无根据项目ID查询权限, 请联系管理员"),void e.handlerMap())},handleClose:function(){if(this.map){var e=document.getElementById("containerTprj");e&&(e.innerHTML=""),this.map=null}this.visible=!1},dataFormSubmitHandle:u()((function(){var e=this;this.$refs["dataForm"].validate((function(t){if(!t)return!1;var a={};if(e.dataForm.id){if(a={deptId:e.dataForm.deptId,id:e.dataForm.id,latitude:e.dataForm.latitude,longitude:e.dataForm.longitude,prjAddr:e.dataForm.prjAddr,prjDesc:e.dataForm.prjDesc,prjName:e.dataForm.prjName,prjUrl:e.dataForm.prjUrl,prjaddress:e.dataForm.prjaddress},!e.$hasPermission("info:tprjinfo:update"))return void e.$message.warning("暂无项目修改权限, 请联系管理员")}else if(a=e.dataForm,!e.$hasPermission("info:tprjinfo:save"))return void e.$message.warning("暂无项目保存权限, 请联系管理员");e.loading=!0,e.$http[e.dataForm.id?"put":"post"]("/info/tprjinfo/",a).then((function(t){var a=t.data;if(e.loading=!1,0!==a.code)return e.$message.error(a.data||a.msg);e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(t){return e.loading=!1,!1}))}))}),1e3,{leading:!0,trailing:!1})},watch:{filterText:function(e){this.$refs.deptListTree.filter(e)}}},g=h,v=(a("7636"),a("2877")),M=Object(v["a"])(g,r,n,!1,null,null,null);t["default"]=M.exports},"862d3":function(e,t,a){"use strict";(function(t,a){e.exports=a()})(0,(function(){function e(e){var r=[];return e.AMapUI&&r.push(t(e.AMapUI)),e.Loca&&r.push(a(e.Loca)),Promise.all(r)}function t(e){return new Promise((function(t,a){var s=[];if(e.plugins)for(var d=0;d<e.plugins.length;d+=1)-1==n.AMapUI.plugins.indexOf(e.plugins[d])&&s.push(e.plugins[d]);if(o.AMapUI===r.failed)a("前次请求 AMapUI 失败");else if(o.AMapUI===r.notload){o.AMapUI=r.loading,n.AMapUI.version=e.version||n.AMapUI.version,d=n.AMapUI.version;var l=document.body||document.head,p=document.createElement("script");p.type="text/javascript",p.src="https://webapi.amap.com/ui/"+d+"/main.js",p.onerror=function(e){o.AMapUI=r.failed,a("请求 AMapUI 失败")},p.onload=function(){if(o.AMapUI=r.loaded,s.length)window.AMapUI.loadUI(s,(function(){for(var e=0,a=s.length;e<a;e++){var r=s[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();i.AMapUI.length;)i.AMapUI.splice(0,1)[0]()}));else for(t();i.AMapUI.length;)i.AMapUI.splice(0,1)[0]()},l.appendChild(p)}else o.AMapUI===r.loaded?e.version&&e.version!==n.AMapUI.version?a("不允许多个版本 AMapUI 混用"):s.length?window.AMapUI.loadUI(s,(function(){for(var e=0,a=s.length;e<a;e++){var r=s[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t():e.version&&e.version!==n.AMapUI.version?a("不允许多个版本 AMapUI 混用"):i.AMapUI.push((function(e){e?a(e):s.length?window.AMapUI.loadUI(s,(function(){for(var e=0,a=s.length;e<a;e++){var r=s[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t()}))}))}function a(e){return new Promise((function(t,a){if(o.Loca===r.failed)a("前次请求 Loca 失败");else if(o.Loca===r.notload){o.Loca=r.loading,n.Loca.version=e.version||n.Loca.version;var s=n.Loca.version,d=n.AMap.version.startsWith("2"),l=s.startsWith("2");if(d&&!l||!d&&l)a("JSAPI 与 Loca 版本不对应！！");else{d=n.key,l=document.body||document.head;var p=document.createElement("script");p.type="text/javascript",p.src="https://webapi.amap.com/loca?v="+s+"&key="+d,p.onerror=function(e){o.Loca=r.failed,a("请求 AMapUI 失败")},p.onload=function(){for(o.Loca=r.loaded,t();i.Loca.length;)i.Loca.splice(0,1)[0]()},l.appendChild(p)}}else o.Loca===r.loaded?e.version&&e.version!==n.Loca.version?a("不允许多个版本 Loca 混用"):t():e.version&&e.version!==n.Loca.version?a("不允许多个版本 Loca 混用"):i.Loca.push((function(e){e?a(e):a()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(r||(r={}));var n={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},o={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},i={AMap:[],AMapUI:[],Loca:[]},s=[],d=function(e){"function"==typeof e&&(o.AMap===r.loaded?e(window.AMap):s.push(e))};return{load:function(t){return new Promise((function(a,i){if(o.AMap==r.failed)i("");else if(o.AMap==r.notload){var l=t.key,p=t.version,c=t.plugins;l?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),n.key=l,n.AMap.version=p||n.AMap.version,n.AMap.plugins=c||n.AMap.plugins,o.AMap=r.loading,p=document.body||document.head,window.___onAPILoaded=function(n){if(delete window.___onAPILoaded,n)o.AMap=r.failed,i(n);else for(o.AMap=r.loaded,e(t).then((function(){a(window.AMap)}))["catch"](i);s.length;)s.splice(0,1)[0]()},c=document.createElement("script"),c.type="text/javascript",c.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+n.AMap.version+"&key="+l+"&plugin="+n.AMap.plugins.join(","),c.onerror=function(e){o.AMap=r.failed,i(e)},p.appendChild(c)):i("请填写key")}else if(o.AMap==r.loaded)if(t.key&&t.key!==n.key)i("多个不一致的 key");else if(t.version&&t.version!==n.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(l=[],t.plugins)for(p=0;p<t.plugins.length;p+=1)-1==n.AMap.plugins.indexOf(t.plugins[p])&&l.push(t.plugins[p]);l.length?window.AMap.plugin(l,(function(){e(t).then((function(){a(window.AMap)}))["catch"](i)})):e(t).then((function(){a(window.AMap)}))["catch"](i)}else if(t.key&&t.key!==n.key)i("多个不一致的 key");else if(t.version&&t.version!==n.AMap.version)i("不允许多个版本 JSAPI 混用");else{var u=[];if(t.plugins)for(p=0;p<t.plugins.length;p+=1)-1==n.AMap.plugins.indexOf(t.plugins[p])&&u.push(t.plugins[p]);d((function(){u.length?window.AMap.plugin(u,(function(){e(t).then((function(){a(window.AMap)}))["catch"](i)})):e(t).then((function(){a(window.AMap)}))["catch"](i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,n={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},o={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},i={AMap:[],AMapUI:[],Loca:[]}}}}))},c272:function(e,t,a){}}]);