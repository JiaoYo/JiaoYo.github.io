(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a726f152"],{"1caa":function(e,t,r){},"6ac8":function(e,t,r){"use strict";r("1caa")},b1c8:function(e,t,r){"use strict";r.r(t);r("a481");var a=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataRule,"label-width":"en-US"===e.$i18n.locale?"120px":"80px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmitHandle()}}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.projectName"),prop:"prjName"}},[t("el-input",{attrs:{placeholder:e.$t("project.projectName"),clearable:""},on:{input:function(t){e.dataForm.prjName=e.dataForm.prjName.replace(/\s+/g,"")}},model:{value:e.dataForm.prjName,callback:function(t){e.$set(e.dataForm,"prjName","string"===typeof t?t.trim():t)},expression:"dataForm.prjName"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.location"),prop:"prjAddr"}},[t("el-input",{attrs:{placeholder:e.$t("project.location"),readonly:""},model:{value:e.dataForm.prjAddr,callback:function(t){e.$set(e.dataForm,"prjAddr",t)},expression:"dataForm.prjAddr"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.detailLocation"),prop:"prjaddress"}},[t("el-input",{attrs:{placeholder:e.$t("project.enterDetailLocation"),clearable:""},model:{value:e.dataForm.prjaddress,callback:function(t){e.$set(e.dataForm,"prjaddress",t)},expression:"dataForm.prjaddress"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("project.creator"),prop:"createName"}},[t("el-input",{attrs:{placeholder:e.$t("project.creator"),readonly:""},model:{value:e.dataForm.createName,callback:function(t){e.$set(e.dataForm,"createName",t)},expression:"dataForm.createName"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{prop:"deptName",label:e.$t("user.deptName")}},[t("el-popover",{ref:"deptListPopover",attrs:{placement:"bottom-start",trigger:"click"},model:{value:e.deptListVisible,callback:function(t){e.deptListVisible=t},expression:"deptListVisible"}},[t("el-input",{attrs:{size:"small",clearable:""},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),t("el-tree",{ref:"deptListTree",attrs:{id:"singleTree",data:e.deptIdList,props:{label:"name",children:"children"},"node-key":"id","highlight-current":!0,"expand-on-click-node":!1,accordion:"","filter-node-method":e.filterNode},on:{"current-change":e.deptListTreeCurrentChangeHandle}})],1),t("el-input",{directives:[{name:"popover",rawName:"v-popover:deptListPopover",arg:"deptListPopover"}],attrs:{readonly:!0,placeholder:e.$t("user.deptName")},model:{value:e.dataForm.deptName,callback:function(t){e.$set(e.dataForm,"deptName",t)},expression:"dataForm.deptName"}})],1)],1)],1)],1)],1),t("el-col",{attrs:{span:12}},[e.visible?t("div",{staticClass:"app-container"},[t("div",{staticStyle:{margin:"5px"}},[t("div",{staticStyle:{width:"100%",height:"300px"},attrs:{id:"container"}})])]):e._e()])],1),t("template",{slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmitHandle()}}},[e._v(e._s(e.$t("confirm")))])],1)],2)},o=[],i=(r("8e6e"),r("456d"),r("ade3")),n=(r("ac6a"),r("7f7f"),r("96cf"),r("1da1")),d=r("b047"),s=r.n(d);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p={props:{id:{type:String,default:""},createName:{type:String,default:""}},data:function(){return{map:null,stamenLayer:null,geocodeService:null,currentMarker:null,coordinates:[],mapZoom:15,visible:!1,loading:!1,mapCenter:{lng:0,lat:0},mapLocation:{address:void 0,coordinate:void 0},filterText:"",deptIdList:[],deptListVisible:!1,dataForm:{id:"",prjName:"",prjDesc:"",prjAddr:"",prjUrl:"",prjaddress:"",latitude:"30.310701",longitude:"120.382155",createName:"",deptId:"",deptName:""},detailLocation:null}},computed:{dataRule:function(){return{prjName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjDesc:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjAddr:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],prjaddress:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{handlerBMap:function(){var e=this;e.map=L.map("container"),e.map.setView([37.56018,121.18340899999998],3),e.stamenLayer=L.tileLayer("https://dingiiot.com/mapleaflet/{z}/{x}/{y}/tile.png",{attribution:"",minZoom:1,maxZoom:18}).addTo(e.map),L.Control.geocoder({defaultMarkGeocode:!0}).addTo(e.map),e.geocodeService=L.esri.Geocoding.geocodeService(),e.map.on("click",(function(t){var r=t.latlng;e.coordinates.push(r),e.addIcon(r),e.reverseGeocode(r)})),e.$nextTick((function(){e.dataForm.id||e.getCurrentlocation()}))},addIcon:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.currentMarker&&this.map.removeLayer(this.currentMarker),this.currentMarker=L.marker([t.lat,t.lng],{icon:new L.Icon({className:"lmap-icon",iconUrl:r("1d18"),iconSize:[24,24],iconAnchor:[12,12]})}).addTo(this.map),e.next=1,this.reverseGeocode(t);case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),reverseGeocode:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=this,r.geocodeService.reverse().latlng(t).language("ru").run((function(e,t){t&&(r.dataForm.prjaddress=t.address.Match_addr)}));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),getCurrentlocation:function(){var e=this;e.loading=!1;var t={point:{lat:"30.310701",lng:"120.382155"}};e.dataForm.longitude=t.point.lng,e.dataForm.latitude=t.point.lat,e.addIcon(t.point)},getPrjInfoLocation:function(){this.dataForm.latitude,this.dataForm.longitude;this.mapCenter.lng=this.dataForm.longitude,this.mapCenter.lat=this.dataForm.latitude,this.loading=!1},init:function(){var e=this;this.loading=!0,this.getSystemDeptList((function(t){e.filterText="",e.deptIdList=t.data.list,e.visible=!0,e.dataForm.id=e.id,e.$nextTick((function(){e.handlerBMap(),e.$refs["dataForm"].resetFields(),e.dataForm.id?e.getInfo():(e.dataForm.deptId=e.$store.state.user.deptId,e.$refs.deptListTree.setCurrentKey(e.dataForm.deptId),setTimeout((function(){e.dataForm.deptName=e.$refs.deptListTree.getCurrentNode()?e.$refs.deptListTree.getCurrentNode().name:""}),200),e.$nextTick((function(){e.getCurrentlocation()}))),e.dataForm.createName=e.$store.state.user.name}))}))},getSystemDeptList:function(e){var t=this;this.deptIdList=[],this.$http.get("/sys/dept/getDeptList.do",{params:{pageNum:1,pageSize:1e4}}).then((function(r){var a=r.data;if(0!=a.code)return t.$message.error(a.data||a.msg);e(a)}))},deptListTreeCurrentChangeHandle:function(e,t){this.dataForm.deptId=e.id,this.dataForm.deptName=e.name,this.deptListVisible=!1},filterNode:function(e,t,r){if(!e)return!0;r.level;var a=[];this.getReturnNode(r,a,e);var o=!1;return a.forEach((function(e){o=o||e})),o},getReturnNode:function(e,t,r){var a=e.data&&e.data.name&&-1!==e.data.name.indexOf(r);a&&t.push(a),!a&&1!=e.level&&e.parent&&this.getReturnNode(e.parent,t,r)},getInfo:function(){var e=this;if(!this.dataForm.id)return this.visible=!1,this.$message.error(this.$t("failedToGetProjectId"));this.loading=!0,this.$http.get("/info/tprjinfo/".concat(this.dataForm.id)).then((function(t){var r=t.data;if(0!==r.code)return e.loading=!1,e.$message.error(r.data||r.msg);e.dataForm=c(c({},e.dataForm),r.data),e.dataForm.createName=e.createName,e.$refs.deptListTree.setCurrentKey(e.dataForm.deptId),setTimeout((function(){e.dataForm.deptName=e.$refs.deptListTree.getCurrentNode()?e.$refs.deptListTree.getCurrentNode().name:""}),200),e.getPrjInfoLocation()})).catch((function(t){return e.loading=!1,!1}))},handleClose:function(){this.visible=!1},dataFormSubmitHandle:s()((function(){var e=this;this.$refs["dataForm"].validate((function(t){if(!t)return!1;var r={};r=e.dataForm.id?{deptId:e.dataForm.deptId,id:e.dataForm.id,latitude:e.dataForm.latitude,longitude:e.dataForm.longitude,prjAddr:e.dataForm.prjAddr,prjDesc:e.dataForm.prjDesc,prjName:e.dataForm.prjName,prjUrl:e.dataForm.prjUrl,prjaddress:e.dataForm.prjaddress}:e.dataForm,e.$http[e.dataForm.id?"put":"post"]("/info/tprjinfo/",r).then((function(t){var r=t.data;if(0!==r.code)return e.$message.error(r.data||r.msg);e.$message({message:e.$t("prompt.success"),type:"success",duration:500,onClose:function(){e.visible=!1,e.$emit("refreshDataList")}})})).catch((function(e){return!1}))}))}),1e3,{leading:!0,trailing:!1})},watch:{filterText:function(e){this.$refs.deptListTree.filter(e)}}},m=p,u=(r("6ac8"),r("2877")),f=Object(u["a"])(m,a,o,!1,null,null,null);t["default"]=f.exports}}]);