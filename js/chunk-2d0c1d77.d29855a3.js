(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c1d77"],{4885:function(e,t,a){"use strict";a.r(t);a("7f7f");var n=function(){var e=this,t=e._self._c;return t("section",[t("div",{attrs:{id:"integralmoduleContainer"}},[t("el-form",{attrs:{inline:!0,model:e.dataForm},nativeOn:{submit:function(e){e.preventDefault()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.querySearch()}}},[t("el-form-item",{attrs:{label:e.$t("integralmodule.integralVariableInput")}},[t("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:e.handleTagScroll,expression:"handleTagScroll"}],staticStyle:{width:"100%"},attrs:{size:"small",placeholder:e.$t("integralmodule.pleaseSelectIntegrationVariableInput"),clearable:""},on:{change:e.querySearch,"visible-change":e.handleTagVisibleChange,clear:e.handleTagClearChange},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}},[[t("div",{staticStyle:{width:"100%",position:"absolute",left:"0",top:"0","z-index":"99","background-color":"#fff"}},[t("el-input",{ref:"tagInput",staticStyle:{width:"98%","margin-left":"1%","margin-top":"5px","margin-bottom":"5px"},attrs:{size:"small",clearable:"",placeholder:e.$t("gwsn.pleaseEnterSearchContent")},model:{value:e.tagSearch,callback:function(t){e.tagSearch=t},expression:"tagSearch"}})],1),t("div",{staticStyle:{width:"100%",height:"42px"}}),e._l(e.allTagList,(function(a){return t("el-option",{key:a.label,attrs:{label:a.label,value:a.value,disabled:!!a.hasOwnProperty("disabled")&&a.disabled}},[t("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center","max-width":"577px"}},[t("span",{style:{display:"inline-block",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",minWidth:"160px"},attrs:{title:a.label}},[e._v(e._s(a.label))]),t("span",{staticStyle:{color:"#8492a6","font-size":"13px",display:"inline-block","margin-left":"20px","text-align":"right",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis","max-width":"200px"},attrs:{title:a.tagcomment||e.$t("integralmodule.none")}},[e._v("\n                                    "+e._s(a.tagcomment||e.$t("integralmodule.none"))+"\n                                ")])])])}))]],2)],1),e.$hasPermission("calculus:select:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",icon:"el-icon-search"},on:{click:function(t){return e.querySearch()}}},[e._v(e._s(e.$t("query")))])],1):e._e(),e.$hasPermission("calculus:insert:permission.do")&&e.isShowSetting?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.addOrUpdateHandle()}}},[e._v("\n                    "+e._s(e.$t("add"))+"\n                ")])],1):e._e(),e.$hasPermission("calculus:delete:permission.do")&&e.isShowSetting?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"danger",icon:"el-icon-delete",disabled:0===e.integralIds.length||0===e.dataList.length},on:{click:function(t){return e.integralDelete()}}},[e._v("\n                    "+e._s(e.$t("deleteBatch"))+"\n                ")])],1):e._e(),e.$hasPermission("calculus:select:permission.do")?t("el-form-item",[t("el-button",{attrs:{size:"small",type:"success"},on:{click:function(t){return e.getDataList()}}},[t("i",{staticClass:"el-icon-refresh"})])],1):e._e()],1)],1),e.scrollTableHeight?t("div",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataListLoading,expression:"dataListLoading"}],ref:"recordTable",staticStyle:{width:"100%"},attrs:{size:"mini",data:e.dataList,border:"","max-height":e.scrollTableHeight,"row-key":e.getRowKey},on:{"selection-change":e.dataListSelectionHandle}},[e.$hasPermission("calculus:delete:permission.do")?t("el-table-column",{attrs:{type:"selection","header-align":"center",align:"center",width:"50","reserve-selection":!0}}):e._e(),t("el-table-column",{attrs:{prop:"tagName",label:e.$t("integralmodule.integralVariableInput"),"header-align":"center",align:"center","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"enable",label:e.$t("integralmodule.integralOutputMode"),"header-align":"center",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(0==t.row.enable?e.$t("integralmodule.close"):1==t.row.enable?e.$t("integralmodule.instantOutput"):2==t.row.row?e.$t("integralmodule.endOutput"):e.$t("integralmodule.close"))+"\n                ")]}}],null,!1,4195353151)}),t("el-table-column",{attrs:{prop:"intervalTime",label:e.$t("integralmodule.samplingInterval"),"header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"durationMin",label:e.$t("integralmodule.pointsDuration"),"header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.durationMin+(1==t.row.durationType?e.$t("integralmodule.minute"):2==t.row.durationType?e.$t("integralmodule.hour"):3==t.row.durationType?e.$t("integralmodule.day"):4==t.row.durationType?e.$t("integralmodule.week"):5==t.row.durationType?e.$t("integralmodule.month"):6==t.row.durationType?e.$t("integralmodule.quarter"):7==t.row.durationType?e.$t("integralmodule.year"):8==t.row.durationType?e.$t("integralmodule.permanentAccumulation"):e.$t("integralmodule.minute")))+"\n                ")]}}],null,!1,1491002758)}),t("el-table-column",{attrs:{prop:"outVolumeWeight",label:e.$t("integralmodule.integralVariableOutput"),"header-align":"center",align:"center","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"outAvg",label:e.$t("integralmodule.averageOutput"),"header-align":"center",align:"center","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"outMax",label:e.$t("integralmodule.maximumOutput"),"header-align":"center",align:"center","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"outMin",label:e.$t("integralmodule.minimumOutput"),"header-align":"center",align:"center","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"outVariance",label:e.$t("integralmodule.varianceOutput"),"header-align":"center",align:"center","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"outClcCount",label:e.$t("integralmodule.numberOfPoints"),"header-align":"center",align:"center","show-overflow-tooltip":!0}}),(e.$hasPermission("calculus:update:permission.do")||e.$hasPermission("calculus:delete:permission.do"))&&e.isShowSetting?t("el-table-column",{attrs:{label:e.$t("handle"),fixed:"right","header-align":"center",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.$hasPermission("calculus:update:permission.do")?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.addOrUpdateHandle(a.row.id)}}},[e._v(e._s(e.$t("update"))+"\n                    ")]):e._e(),e.$hasPermission("calculus:delete:permission.do")?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.integralDelete(a.row.id)}}},[e._v(e._s(e.$t("delete"))+"\n                    ")]):e._e()]}}],null,!1,3371092100)}):e._e()],1),t("el-pagination",{staticStyle:{"text-align":"right","margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[20,50,100,200],"page-size":e.limit,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.pageSizeChangeHandle,"current-change":e.pageCurrentChangeHandle}})],1):e._e(),e.addOrUpdateVisible?t("add-or-update",{ref:"addOrUpdate",on:{refreshDataList:e.getDataList}}):e._e()],1)},i=[],l=a("53ca"),o=(a("ac6a"),a("c5f6"),a("a481"),a("4328")),r=a.n(o),s=a("b047"),g=a.n(s),d=a("ed34"),c={name:"integralmodule",directives:{loadmore:{inserted:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-Math.ceil(this.scrollTop)<=this.clientHeight;e&&0!==this.scrollTop&&t.value()}))}}},data:function(){return{isShowSetting:!1,page:1,limit:20,total:0,tagPage:1,tagTotal:0,tagSearch:"",allTagList:[],addOrUpdateVisible:!1,integralIds:[],dataListLoading:!1,dataList:[],dataForm:{name:"",type:""},scrollTableHeight:0}},components:{AddOrUpdate:d["default"]},methods:{pageSizeChangeHandle:function(e){this.page=1,this.limit=e,this.getDataList()},pageCurrentChangeHandle:function(e){this.page=e,this.getDataList()},querySearch:function(){var e=this;this.$hasSessionStorageGwsn()?(this.page=1,this.getDataList()):this.$message({showClose:!1,message:this.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})},getDataList:g()((function(){var e=this,t={page:e.page,limit:e.limit,gwsn:sessionStorage.getItem("gwsn"),sort:"id desc"};if(e.$hasSessionStorageGwsn()){if(e.dataForm.name&&(t["tagName"]=e.dataForm.name),e.dataList=[],e.total=0,!e.$hasPermission("calculus:select:permission.do"))return void setTimeout((function(){e.$message.warning("暂无积分运算查询权限, 请联系管理员")}),200);e.dataListLoading=!0,e.$http.get("/calculus/getPage.do",{params:t}).then((function(a){var n=a.data;if(0!=n.code)return e.page=t.page,e.dataListLoading=!1,e.$message.error(n.data||n.msg),!1;e.page=t.page,e.dataListLoading=!1,e.dataList=n.data.rows||[],e.total=Number(n.data.total)||0})).catch((function(a){return e.page=t.page,e.dataListLoading=!1,!1}))}else e.$message({showClose:!1,message:e.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})}),500,{leading:!0,trailing:!1}),getRowKey:function(e){return e.id},dataListSelectionHandle:function(e){var t=this;this.integralIds=[],e.forEach((function(e){t.integralIds.push(e.id)}))},addOrUpdateHandle:function(e){var t=this;if(this.$hasSessionStorageGwsn()){if(e){if(!this.$hasPermission("calculus:update:permission.do"))return void this.$message.warning("暂无积分运算修改权限, 请联系管理员")}else if(!this.$hasPermission("calculus:insert:permission.do"))return void this.$message.warning("暂无积分运算新增权限, 请联系管理员");this.addOrUpdateVisible=!0,this.$nextTick((function(){t.$refs.addOrUpdate.dataForm.id=e,t.$refs.addOrUpdate.init()}))}else this.$message({showClose:!1,message:this.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),t.$router.replace({path:"/tgw-tgwinfo"})}})},integralDelete:g()((function(e){var t=this;if(t.$hasSessionStorageGwsn()){if(e&&(t.integralIds=[],t.integralIds.push(e)),0===t.integralIds.length)return t.$message.error(t.$t("deleteInfo.noData"));if(!t.$hasPermission("calculus:delete:permission.do"))return void t.$message.warning("暂无积分运算删除权限, 请联系管理员");t.$confirm(t.$t("deleteInfo.noticeTitle"),t.$t("deleteInfo.noticePrompt"),{confirmButtonText:t.$t("deleteInfo.confirm"),cancelButtonText:t.$t("deleteInfo.cancel"),type:"warning"}).then((function(){t.dataListLoading=!0,t.$http.post("/calculus/delete.do",r.a.stringify({ids:t.integralIds.join(",")})).then((function(e){var a=e.data;if(0!=a.code)return t.dataListLoading=!1,t.$message.error(a.data||t.$t("deleteInfo.deleteFail"));t.integralIds=[],t.dataListLoading=!1,t.$message.success(t.$t("deleteInfo.deleteSuccess")),t.getDataList(),t.$refs.recordTable.clearSelection()})).catch((function(e){return t.dataListLoading=!1,t.getDataList(),t.$refs.recordTable.clearSelection(),!1}))})).catch((function(e){}))}else t.$message({showClose:!1,message:t.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),t.$router.replace({path:"/tgw-tgwinfo"})}})}),1e3,{leading:!0,trailing:!1}),getAllTagList:function(){var e=this,t={page:e.tagPage,limit:200,gwsn:sessionStorage.getItem("gwsn")};if(e.tagSearch&&(t["sname"]=this.tagSearch.replace(/_/g,"\\_").replace(/%/g,"\\%")),e.$hasSessionStorageGwsn()){if(!e.$hasPermission("taginfo:select:permission.do"))return void e.$message.warning("暂无测点查询权限, 请联系管理员");e.loading=!0,1==e.tagPage&&(e.allTagList=[]),e.$http.get("/info/taginfo/selectTags.do",{params:t}).then((function(t){var a=t.data;if(0!=a.code)return e.loading=!1,e.$message.error(a.data||a.msg);"object"==Object(l["a"])(a.data)?(e.tagTotal=Number(a.data.total),a.data.rows.length>0&&a.data.rows.forEach((function(t){var a={label:t.tagname,value:t.tagid,tagcomment:t.tagcomment,disabled:!1};e.allTagList.push(a)})),0==e.allTagList.length&&e.allTagList.push({label:e.$t("noMatchingDataYet"),value:e.$t("noMatchingDataYet"),tagcomment:"",disabled:!0})):0==e.allTagList.length&&e.allTagList.push({label:e.$t("noMatchingDataYet"),value:e.$t("noMatchingDataYet"),tagcomment:"",disabled:!0}),e.loading=!1})).catch((function(t){e.loading=!1}))}else e.$message({showClose:!1,message:e.$t("gatewayNotObtained"),type:"warning",duration:1500,onClose:function(){return sessionStorage.clear(),e.$router.replace({path:"/tgw-tgwinfo"})}})},handleTagClearChange:function(){this.tagSearch="",this.dataForm.name="",this.querySearch()},handleTagVisibleChange:function(e){var t=this;e&&this.$nextTick((function(){t.$refs.tagInput.focus()}))},handleTagScroll:function(){this.allTagList.length<this.tagTotal&&(this.tagPage++,this.getAllTagList())},watchTagSearch:g()((function(){var e=document.getElementsByClassName("el-scrollbar__wrap").length;document.getElementsByClassName("el-scrollbar__wrap")[e-1].scrollTo(0,0),this.tagPage=1,this.getAllTagList(),this.$refs.tagInput.focus()}),500)},created:function(){this.getAllTagList(),this.page=Number(sessionStorage.getItem("page21"))||1,this.limit=Number(sessionStorage.getItem("limit21"))||20},mounted:function(){var e=this;e.isShowSetting=0!=sessionStorage.getItem("per"),e.$erd.listenTo(document.getElementById("integralmoduleContainer"),(function(t){var a=document.getElementById("integralmoduleContainer").offsetHeight;e.scrollTableHeight=window.innerHeight-145-a})),e.getDataList(),window.onresize=function(){return function(){var t=document.getElementById("integralmoduleContainer").offsetHeight;e.scrollTableHeight=window.innerHeight-145-t}()}},watch:{total:function(){this.total==(this.page-1)*this.limit&&0!=this.total&&(this.page-=1,sessionStorage.setItem("page21",this.page),this.getDataList())},tagSearch:function(e,t){this.watchTagSearch()}}},u=c,m=a("2877"),h=Object(m["a"])(u,n,i,!1,null,null,null);t["default"]=h.exports}}]);