import{Q as ge,p as fe,_ as he,a as we}from"./pako.esm-DAgV4jdA.js";import{_ as ye}from"./export-Czj95sIr.js";import{d as X,a2 as V,N as be,i as w,s as ve,bj as xe,o as y,b as Y,I as W,bq as m,f as a,w as t,h as n,B as q,g as T,t as E,$ as K,c as C,S as Q,e as F,a9 as ke,F as Te,X as Pe,cu as De,bY as Ce,E as Se,bZ as Ne,a6 as ze,G as Le,H as $e}from"./index-OwKwL0YQ.js";import{_ as Ie}from"./round-search-t5QaGbA0.js";import{c as Be,d as qe,e as Ee}from"./control_management-CUs9g0cB.js";import{u as Z,a as Fe}from"./table-DPZNXlmB.js";import{e as Ge}from"./exportExcel-Bv4G4H50.js";import{u as Ae,L as J}from"./echarts-DlksXQCF.js";import{_ as Re}from"./DatePicker-DvhJJ245.js";import{_ as Ue}from"./FormItemGridItem-XJmkGy_O.js";import{_ as Me}from"./Grid-BdHIGgCt.js";import{_ as He}from"./DataTable-CMS0RBhd.js";import"./Forward-BwSYcc1D.js";import"./RadioGroup-C1Zubmrz.js";const Oe=X({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(_){const g=_;V(()=>g.data,async r=>{S(),N()});const G=be(),c=w(null),{domRef:b,updateOptions:v,showLoading:S,hideLoading:l}=Ae(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:"#6a7985",textStyle:{color:"rgb(224, 224, 224)"},valueFormatter:function(r){return(r+""!="undefined"?r:"--")+"mw"}},legend:{data:["实际功率","预测功率"]},grid:{left:"2%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} mw"}},series:[{color:"#e90445",name:"实际功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new J(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.9)",shadowBlur:20},data:[]},{color:"#009688",name:"预测功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new J(0,0,0,1,[{offset:0,color:"rgba(0, 150, 136,0.3)"},{offset:1,color:"rgba(0, 150, 136,0)"}],!1),shadowColor:"rgba(0, 150, 136,0.9)",shadowBlur:20},data:[]}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function N(){await new Promise(r=>{setTimeout(r,1e3)}),v(r=>(r.xAxis.data=g.data.map(d=>d.dbtime),r.series[0].data=g.data.map(d=>d.power),r.series[1].data=g.data.map(d=>d.prePower),r))}function A(){v((r,d)=>{const P=d();return r.legend.data=P.legend.data,r.series[0].name=P.series[0].name,r.series[1].name=P.series[1].name,r})}async function R(){N()}return V(()=>G.locale,()=>{A()}),R(),ve(()=>{c.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),xe(()=>{c.value!==null&&(clearInterval(c.value),c.value=null)}),(r,d)=>(y(),Y("div",{ref_key:"domRef",ref:b,class:"h-600px overflow-hidden"},null,512))}}),je=W(Oe,[["__scopeId","data-v-edcb8878"]]),Ve=_=>(Le("data-v-42c44b0f"),_=_(),$e(),_),Ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Qe={class:"font-size-14px mb-10px"},Ze=Ve(()=>F("span",null,"二维码",-1)),Je=X({name:"realtimequery_powerquery",__name:"index",setup(_){const{columns:g,columnChecks:G,data:c,getData:b,loading:v,mobilePagination:S,searchParams:l,resetSearchParams:N}=Z({apiFn:Be,apiParams:{page:1,pageSize:20,limit:20,startTime:m(1,Date.now()-2592e5),endTime:m(1,Date.now()),_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"dbtime",title:"时间",align:"center",width:100},{key:"power",title:"实际功率",align:"center",width:140},{key:"prePower",title:"预测功率",align:"center",width:140},{key:"operate",title:"误差",align:"center",width:100,render(o){const e=o.prePower-o.power>=0?o.prePower-o.power:o.power-o.prePower;return a("span",null,[e?parseFloat(e.toFixed(6)):""])}}]}),{drawerVisible:A,operateType:R,editingData:r,handleAdd:d,handleEdit:P,checkedRowKeys:x,onBatchDeleted:Xe,onDeleted:Ye}=Fe(c,b),ee=async()=>{k.value=="0"?await L():(await b(),c.value.length==0?M():h.value=[])},f=w([]),z=w(""),L=async()=>{const{data:o,error:e}=await Ee({startTime:l.startTime,endTime:l.endTime});e||(f.value=o.sort((s,p)=>new Date(s.dbtime).getTime()-new Date(p.dbtime).getTime()),f.value.length==0?M():h.value=[])},U=w([Date.now()-864e5*3,Date.now()]);async function ae(o,e){l.startTime=m(1,e[0]),l.endTime=m(1,e[1]),H.startTime=m(1,e[0]),H.endTime=m(1,e[1])}const te=o=>{o=="1"?b():L()};L();const ne=()=>{const o={dbtime:"时间",power:"实际功率",prePower:"预测功率",error:"误差"},e=[];c.value.forEach(s=>{x.value.includes(s.id)&&e.push({...s,error:s.prePower-s.power>=0?s.prePower-s.power:s.power-s.prePower||""})}),Ge(e,o,"预测数据")},k=w("0"),$=w(!1),oe=()=>{var p,D;if(f.value.length==0)return(p=window.$message)==null?void 0:p.warning("暂无数据。请查询数据后重试。");if(f.value.length>96||m(0,l.startTime)!=m(0,l.endTime))return(D=window.$message)==null?void 0:D.warning("数据量过多。请缩小数据范围至一天内并重试。");const o={data:f.value.map(u=>({dbtime:u.dbtime,prePower:u.prePower,power:u.power})),type:0,dateTime:m(0,l.startTime)},s=fe.gzip(JSON.stringify(o),{to:"string"}).reduce((u,I)=>u+String.fromCharCode(I),"");z.value=`http://172.20.1.162/?${btoa(s)}`,console.log("编码",z.value),$.value=!0},se=()=>{var e;const o=document.getElementById("qrcode");if(o){const s=document.createElement("a");s.href=o.toDataURL("image/png"),s.download="qrcode.png",s.click(),(e=window.$message)==null||e.success("下载成功")}else console.error("无法找到二维码 canvas 元素")},{columns:re,data:h,getData:M,loading:We,mobilePagination:le,searchParams:H}=Z({apiFn:qe,apiParams:{page:1,pageSize:20,limit:20,startTime:l.startTime,endTime:l.endTime,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{key:"dbtime",title:"时间",align:"center",width:100},{key:"code",title:"错误码",align:"center",width:140},{key:"errormsg",title:"错误信息",align:"center",width:140}]});return(o,e)=>{const s=Re,p=Ue,D=Ie,u=he,I=Me,ie=Te,B=Pe,ce=De,O=He,j=Ce,de=ye,me=Se,pe=Ne,ue=we,_e=ze;return y(),Y("div",Ke,[a(B,{bordered:!1,size:"small"},{default:t(()=>[a(ie,{ref:"formRef",model:n(l),"label-placement":"left","show-feedback":!1},{default:t(()=>[a(I,{"y-gap":16,responsive:"screen","item-responsive":""},{default:t(()=>[a(p,{span:"24 s:12 m:7",label:"起止时间",path:"startTime"},{default:t(()=>[a(s,{value:U.value,"onUpdate:value":e[0]||(e[0]=i=>U.value=i),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":ae,"default-time":["00:00:00","23:59:59"]},null,8,["value"])]),_:1}),a(p,{span:"24 s:12 m:5",label:"",path:"endTime",class:"pr-24px"},{default:t(()=>[a(n(q),{type:"primary",ghost:"",onClick:ee},{icon:t(()=>[a(D,{class:"text-icon"})]),default:t(()=>[T(" "+E(n(K)("common.search")),1)]),_:1}),n(h).length==0&&k.value=="0"?(y(),C(n(q),{key:0,type:"primary",ghost:"",onClick:oe,class:"ml-20px"},{icon:t(()=>[a(u,{class:"text-icon"})]),default:t(()=>[T(" "+E("生成二维码"))]),_:1})):Q("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(h).length>0?(y(),C(B,{key:0,bordered:!1,size:"small","header-style":{paddingTop:"0px"},class:"sm:flex-1-hidden card-wrapper h-100%"},{header:t(()=>[F("div",Qe,[a(ce,{class:"text-icon c-#e67e22"}),T(" 未查询到预测数据。详情请查看错误日志。 ")]),T(" 功率预测错误日志 ")]),default:t(()=>[a(O,{columns:n(re),data:n(h),size:"small",loading:n(v),remote:"","row-key":i=>i.id,pagination:n(h).length?n(le):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["columns","data","loading","row-key","pagination"])]),_:1})):(y(),C(B,{key:1,bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:t(()=>[a(pe,{type:"card",animated:"",value:k.value,"onUpdate:value":[e[2]||(e[2]=i=>k.value=i),te],class:"h-100%","tab-style":{height:"40px"},"pane-wrapper-style":{flex:1}},{suffix:t(()=>[k.value=="1"?(y(),C(me,{key:0,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[a(n(q),{onClick:ne,size:"small",disabled:n(x).length==0},{icon:t(()=>[a(de,{class:"text-icon"})]),default:t(()=>[T(" "+E(n(K)("common.export")),1)]),_:1},8,["disabled"])]),_:1})):Q("",!0)]),default:t(()=>[a(j,{name:"0",tab:"图表"},{default:t(()=>[a(je,{data:f.value},null,8,["data"])]),_:1}),a(j,{name:"1",tab:"表格",class:"h-100%"},{default:t(()=>[a(O,{"checked-row-keys":n(x),"onUpdate:checkedRowKeys":e[1]||(e[1]=i=>ke(x)?x.value=i:null),columns:n(g),data:n(c),size:"small",loading:n(v),remote:"","row-key":i=>i.id,pagination:n(c).length?n(S):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1})),a(_e,{show:$.value,"onUpdate:show":e[3]||(e[3]=i=>$.value=i),title:"",preset:"card",class:"w-auto"},{header:t(()=>[F("div",null,[Ze,a(ue,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:se})])]),default:t(()=>[a(ge,{id:"qrcode",style:{margin:"0 auto"},value:z.value,margin:3,size:500,level:"H"},null,8,["value"])]),_:1},8,["show"])])}}}),_a=W(Je,[["__scopeId","data-v-42c44b0f"]]);export{_a as default};
