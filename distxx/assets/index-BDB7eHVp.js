import{_ as ct}from"./table-column-setting.vue_vue_type_script_setup_true_lang-BK40fshd.js";import{_ as ut}from"./round-refresh-Bgt_7Q3D.js";import{_ as pt}from"./round-delete-BVi0-V0R.js";import{Y as De,o as Z,b as Fe,e as lt,d as Ce,Z as ye,r as _e,a0 as Se,p as ze,q as mt,a2 as Re,a as at,$ as D,ah as nt,f as e,v as ot,w as l,g as k,t as A,h as t,a3 as H,x as it,a9 as he,aq as Ke,ad as Pe,aj as we,a4 as Ue,A as me,B as V,ab as $e,a5 as Me,F as Ve,E as je,a6 as Oe,aJ as ft,i as Ie,a1 as Ye,c as Ne,S as Le,N as vt,a7 as gt,s as bt,y as ht,a8 as be,aa as yt,X as _t}from"./index-CikIHrS9.js";import{_ as wt}from"./round-add-5V8A2Jjn.js";import{_ as Ft}from"./round-search-BXiE8_rT.js";import{u as Be,a as qe}from"./table-zZpDQDxt.js";import{p as pe,d as st,a as kt,b as Ze,c as He}from"./gather-DA62DHaW.js";import{_ as Ee}from"./FormItemGridItem-DQuLiYjl.js";import{_ as Ge}from"./Grid-C_1VcKZu.js";import{_ as Je}from"./DataTable-3XIZO1ar.js";import{N as Qe}from"./Popconfirm-CFUv4OFk.js";import{_ as Tt}from"./InputGroupLabel-DGR_kA8i.js";import"./RadioGroup-BXqgiCu1.js";import"./Forward-D3gQX6Y3.js";function Nt(L){return De({url:"/transTag/selectPage.do",method:"get",params:L})}function dt(L){return De({url:"/transTag/insert.do",method:"post",data:L})}function xe(L){return De({url:"/transTag/update.do",method:"post",data:L})}function et(L){return De({url:"/transTag/delete.do",method:"delete",params:L})}const Lt={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Pt=lt("path",{fill:"currentColor",d:"M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36M20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83l3.75 3.75z"},null,-1),It=[Pt];function Dt(L,Q){return Z(),Fe("svg",Lt,[...It])}const Ct={name:"ic-round-edit",render:Dt},Ut=Ce({__name:"add_model",props:ye({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ye(["submitted"],["update:visible"]),setup(L,{emit:Q}){const a=_e({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:{},dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),m=Se(L,"visible"),W=Q,n=L,d=_e(X());function X(){return{chlId:void 0,devId:void 0,tagDevId:"",tagName:"",tagId:void 0,tagDesc:"",tagUnit:"",tagType:1,tagK:1,objAddr:"0",collectType:1,dataType:4,dataFormat:0}}async function y(){var b;const{data:i,error:s}=await ft({page:1,limit:1e4,type:1});s||(a.deveicelList=i.list.map(h=>({...h,label:h.devName,value:h.id+"_"+h.chlId})),n.operateType==="add"&&a.deveicelList.length>0&&!d.tagDevId&&(d.tagDevId=(b=a.deveicelList[0])==null?void 0:b.value,d.devId=Number(d.tagDevId.split("_")[0]),d.chlId=Number(d.tagDevId.split("_")[1]),d.collectType=void 0),P())}async function P(){const{data:i,error:s}=await we({chlId:d.chlId});s||(a.functionList=JSON.parse(i).data,d.collectType=a.functionList[0].FuncCode)}function K(){Object.assign(d,X()),y(),n.operateType==="edit"&&n.rowData&&(Object.assign(d,n.rowData),_(n.rowData))}const{formRef:ee,validate:F,restoreValidation:te}=ze();mt(),Re(m,()=>{m.value&&(K(),te())});const x=()=>{m.value=!1};function _(i,s){console.log(i),i==0||i==1||i==2||i==3||i==4||i==7?a.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:i==5||i==6||i==8||i==9||i==10||i==12||i==13?a.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:a.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],a.collectionPointForm.dataFormatList.find(b=>b.value===d.dataFormat)||(d.dataFormat=a.collectionPointForm.dataFormatList[0].value)}const S=async()=>{var i,s;if(await F(),console.log(d),n.operateType==="add"){const{data:b,error:h}=await dt([d]);h||(x(),(i=window.$message)==null||i.success("添加成功"),W("submitted"))}else{const{data:b,error:h}=await xe([d]);h||(x(),(s=window.$message)==null||s.success("编辑成功"),W("submitted"))}},j={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},z={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},C={devId:z,tagName:j,tagDesc:j,tagK:z,objAddr:j,collectType:z,dataType:z,dataFormat:z},Y=at(()=>({add:D("common.add"),edit:D("common.edit")})[n.operateType]),{columns:oe,columnChecks:le,data:O,getData:$,loading:T,mobilePagination:w,searchParams:U,resetSearchParams:ke}=Be({apiFn:nt,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",multiple:!1,align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140},{key:"devId",title:"所属设备",align:"center",width:140,render:i=>{var s;return e("span",null,[((s=a.collectionPointForm.deveicelList.find(b=>b.id===i.devId))==null?void 0:s.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),Te=()=>{$()},{drawerVisible:g,operateType:f,editingData:N,handleAdd:ie,handleEdit:B,checkedRowKeys:ae,onBatchDeleted:Ae,onDeleted:se}=qe(O,$);async function de(){const{data:i,error:s}=await Pe();s||(console.log("data",i),i.length>0&&(a.collectionPointForm.channelList=i.filter(b=>b.chlType!==1).map(b=>({label:b.chlName,value:b.id,devicePojoList:b.devicePojoList||[]}))))}de();const fe=i=>{var b;U.chlid=i,U.devId=null;let s=(b=a.collectionPointForm.channelList.find(h=>h.value==i))==null?void 0:b.devicePojoList;a.collectionPointForm.deveicelList=s,ce(),$()};function re(){var i,s;if(a.collectionPointForm.channelList.length>0)if(U.chlid)a.collectionPointForm.visible=!0;else{let b=a.collectionPointForm.channelList[0];U.chlid=b.value,a.collectionPointForm.deveicelList=b.devicePojoList,ce(),ae.value=[d.tagId],a.collectionPointForm.checkedRows.tagName=d.tagName,a.collectionPointForm.checkedRows.id=d.tagId}else return(i=window.$message)==null||i.destroyAll(),(s=window.$message)==null||s.warning("暂无通道，请您先创建通道在进行查询"),!1}async function ce(){const{data:i,error:s}=await we({chlId:U.chlid});s||(a.collectionPointForm.functionList=JSON.parse(i).data,a.collectionPointForm.visible=!0,$())}function I(){a.collectionPointForm.visible=!1}function ve(i,s,b){console.log(s),a.collectionPointForm.checkedRows=s[0]}function ge(){var i,s;if(ae.value.length===0)return(i=window.$message)==null||i.destroyAll(),(s=window.$message)==null||s.warning("请您先选择采集点"),!1;d.tagName=a.collectionPointForm.checkedRows.tagName,d.tagId=a.collectionPointForm.checkedRows.id,d.tagDesc||(d.tagDesc=a.collectionPointForm.checkedRows.tagDesc),a.collectionPointForm.visible=!1}return(i,s)=>{const b=Ue,h=Ee,r=me,o=V,c=$e,u=Me,M=me,R=Ge,q=Ve,E=V,ne=je,G=Oe,ue=Je,J=ot("no-space");return Z(),Fe(Ke,null,[e(G,{show:m.value,"onUpdate:show":s[9]||(s[9]=p=>m.value=p),title:Y.value,preset:"card",class:"w-50%"},{footer:l(()=>[e(ne,{size:16,justify:"center"},{default:l(()=>[e(E,{onClick:x,class:"w-100px"},{default:l(()=>[k(A(t(D)("common.cancel")),1)]),_:1}),e(E,{type:"primary",class:"w-100px",onClick:S},{default:l(()=>[k(A(t(D)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(q,{ref_key:"formRef",ref:ee,model:d,rules:C,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:l(()=>[e(R,{responsive:"screen","item-responsive":""},{default:l(()=>[e(h,{span:"24 m:12",label:"所属设备",path:"belongingChannel"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择所属设备",value:d.devId,"onUpdate:value":s[0]||(s[0]=p=>d.devId=p),"value-field":"id",options:a.deveicelList},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:l(()=>[e(c,null,{default:l(()=>[e(r,{value:d.tagName,"onUpdate:value":s[1]||(s[1]=p=>d.tagName=p),style:{width:"80%"},readonly:""},null,8,["value"]),e(o,{type:"primary",ghost:"",onClick:re},{default:l(()=>[k("请选择")]),_:1})]),_:1})]),_:1}),e(h,{span:"24 m:12",label:"测点类型",path:"dataType"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择测点类型",value:d.tagType,"onUpdate:value":s[2]||(s[2]=p=>d.tagType=p),options:t(H)(t(pe))},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:l(()=>[e(u,{clearable:"",value:d.tagK,"onUpdate:value":s[3]||(s[3]=p=>d.tagK=p),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(h,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择转发功能码",value:d.collectType,"onUpdate:value":s[4]||(s[4]=p=>d.collectType=p),options:a.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:l(()=>[e(M,{clearable:"",value:d.objAddr,"onUpdate:value":s[5]||(s[5]=p=>d.objAddr=p),placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(h,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择数据类型",value:d.dataType,"onUpdate:value":[s[6]||(s[6]=p=>d.dataType=p),_],options:t(H)(t(st))},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择数据格式",value:d.dataFormat,"onUpdate:value":s[7]||(s[7]=p=>d.dataFormat=p),options:a.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:l(()=>[e(M,{clearable:"",value:d.tagUnit,"onUpdate:value":s[8]||(s[8]=p=>d.tagUnit=p),placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(G,{show:a.collectionPointForm.visible,"onUpdate:show":s[16]||(s[16]=p=>a.collectionPointForm.visible=p),title:"选择采集点",preset:"card",class:"w-60%"},{footer:l(()=>[e(ne,{size:16,justify:"end"},{default:l(()=>[e(E,{onClick:I},{default:l(()=>[k(A(t(D)("common.cancel")),1)]),_:1}),e(E,{type:"primary",onClick:ge},{default:l(()=>[k(A(t(D)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(q,{model:a.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:l(()=>[e(R,{responsive:"screen","item-responsive":""},{default:l(()=>[e(h,{span:"24 m:12",label:"所属通道"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择所属通道",value:t(U).chlid,"onUpdate:value":s[10]||(s[10]=p=>t(U).chlid=p),options:a.collectionPointForm.channelList,onUpdateValue:fe},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"所属设备"},{default:l(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择所属设备",value:t(U).devId,"onUpdate:value":s[11]||(s[11]=p=>t(U).devId=p),"label-field":"devName","value-field":"id",options:a.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"测点类型"},{default:l(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(U).tagType,"onUpdate:value":s[12]||(s[12]=p=>t(U).tagType=p),options:t(H)(t(pe))},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"测点功能码"},{default:l(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:t(U).collectType,"onUpdate:value":s[13]||(s[13]=p=>t(U).collectType=p),options:a.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"测点名称"},{default:l(()=>[it(e(M,{clearable:"",value:t(U).fuzzy,"onUpdate:value":s[14]||(s[14]=p=>t(U).fuzzy=p),placeholder:"请输入测点名称"},null,8,["value"]),[[J]])]),_:1}),e(h,{span:"24 m:12",label:" "},{default:l(()=>[e(E,{onClick:Te},{default:l(()=>[k(A(t(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(ue,{"checked-row-keys":t(ae),"onUpdate:checkedRowKeys":[s[15]||(s[15]=p=>he(ae)?ae.value=p:null),ve],columns:t(oe),data:t(O),size:"small","max-height":500,loading:t(T),remote:"","row-key":p=>p.id,pagination:t(w)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1},8,["show"])],64)}}}),jt={class:"flex"},At=Ce({__name:"add_multipe_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:ye(["submitted"],["update:visible"]),setup(L,{emit:Q}){const a=_e({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:[],dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),m=Se(L,"visible"),W=Q,n=_e(d());function d(){return{chlId:void 0,devId:void 0,tagDevId:"",tagName:"",tagNames:"",tagId:"",tagDesc:"",tagDescs:"",tagUnit:"",tagType:0,tagK:1,objAddr:"0",collectType:1,dataType:4,dataFormat:0}}async function X(){var c,u;const{data:r,error:o}=await Pe({type:1});if(!o){const M=[];r.forEach(R=>{R.devicePojoList&&R.devicePojoList.length>0&&R.devicePojoList.forEach(q=>{M.push({label:`${q.devName}`,value:`${q.id}_${R.id}`})})}),a.deveicelList=M,n.tagDevId=a.deveicelList[0].value,n.devId=Number((c=n.tagDevId)==null?void 0:c.split("_")[0]),n.chlId=Number((u=n.tagDevId)==null?void 0:u.split("_")[1]),n.collectType=void 0,y()}}async function y(){const{data:r,error:o}=await we({chlId:n.chlId});o||(a.functionList=JSON.parse(r).data,n.collectType=a.functionList[0].FuncCode)}function P(){Object.assign(n,d()),X(),a.collectionPointForm.checkedRows=[],I.value=[]}const{formRef:K,validate:ee,restoreValidation:F}=ze();Re(m,()=>{m.value&&(P(),F())});const te=()=>{m.value=!1};function x(r,o){console.log(r),r==0||r==1||r==2||r==3||r==4||r==7?a.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:r==5||r==6||r==8||r==9||r==10||r==12||r==13?a.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:a.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],a.collectionPointForm.dataFormatList.find(c=>c.value===n.dataFormat)||(n.dataFormat=a.collectionPointForm.dataFormatList[0].value)}const _=async()=>{var q,E;await ee();let r=n.tagNames.split(","),o=(q=n.tagDescs)==null?void 0:q.split(","),c=(E=n.tagId)==null?void 0:E.split(","),u=[];delete n.tagNames,delete n.tagDescs,delete n.tagId,r.forEach((ne,G)=>{var J,p;let ue={...n,tagName:ne,tagDesc:n.tagDesc?n.tagDesc:o[G],tagId:Number(c[G]),objAddr:n.objAddr?+n.objAddr+G:G+"",devId:Number((J=n.tagDevId)==null?void 0:J.split("_")[0]),chlId:Number((p=n.tagDevId)==null?void 0:p.split("_")[1])};u.push(ue)});const{data:M,error:R}=await dt(u);R||(te(),W("submitted"))},S={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},j={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},z={tagDevId:S,tagName:S,tagDesc:[{trigger:["input","blur"],validator:(r,o)=>!/\$/.test(o),message:"不能含有非法字符"},{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]}],tagK:j,objAddr:S,collectType:j,dataType:j,dataFormat:j},C=at(()=>({add:"批量新增",edit:D("common.edit")}).add),{columns:Y,columnChecks:oe,data:le,getData:O,loading:$,mobilePagination:T,searchParams:w,resetSearchParams:U}=Be({apiFn:nt,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140,render:r=>{var o;return e("span",null,[((o=pe.find(c=>c.value===r.tagType))==null?void 0:o.label)||""])}},{key:"belongingEquipment",title:"所属设备",align:"center",width:140,render:r=>{var o;return e("span",null,[((o=a.collectionPointForm.deveicelList.find(c=>c.id===r.devId))==null?void 0:o.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),ke=()=>{O()},{drawerVisible:Te,operateType:g,editingData:f,handleAdd:N,handleEdit:ie,checkedRowKeys:B,onBatchDeleted:ae,onDeleted:Ae}=qe(le,O);async function se(){const{data:r,error:o}=await Pe();o||(console.log("data",r),r.length>0&&(a.collectionPointForm.channelList=r.filter(c=>c.chlType!==1).map(c=>({label:c.chlName,value:c.id,devicePojoList:c.devicePojoList||[]}))))}const de=r=>{var c;w.chlid=r,w.devId=null;let o=(c=a.collectionPointForm.channelList.find(u=>u.value==r))==null?void 0:c.devicePojoList;a.collectionPointForm.deveicelList=o,re(),O()};se();function fe(){var r,o;if(B.value=I.value.map(c=>c.id),a.collectionPointForm.channelList.length>0)if(w.chlid)a.collectionPointForm.visible=!0;else{let c=a.collectionPointForm.channelList[0];w.chlid=c.value,a.collectionPointForm.deveicelList=c.devicePojoList,re()}else return(r=window.$message)==null||r.destroyAll(),(o=window.$message)==null||o.warning("暂无通道，请您先创建通道在进行查询"),!1}async function re(){const{data:r,error:o}=await we({chlId:w.chlid});o||(a.collectionPointForm.functionList=JSON.parse(r).data,a.collectionPointForm.visible=!0,O())}function ce(){a.collectionPointForm.visible=!1}const I=Ie([]),ve=[{title(){return e("div",{class:"flex"},[e("span",{class:"flex-1"},[`已选${I.value.length}个`]),e("span",{class:"c-red cursor-pointer",onClick:s},[k("清空")])])},align:"center",render:r=>{var o;return e("span",null,[r.tagName,k("--"),(o=a.collectionPointForm.channelList.find(c=>c.value==r.chlId))==null?void 0:o.label])}}];function ge(r,o,c){console.log(o),o=o.filter(u=>u!=null),w.devId&&(I.value=I.value.filter(u=>u.devId!=w.devId||u.page!=w.page)),w.chlid&&(I.value=I.value.filter(u=>u.chlId!=w.chlid||u.page!=w.page)),I.value.push(...o.filter(u=>u!=null)),I.value=[...new Set(I.value)],I.value.forEach(u=>{u.page=u.page?u.page:w.page})}function i(){var r,o,c,u,M;if(a.collectionPointForm.checkedRows=B.value,n.tagNames="",n.tagDescs="",n.tagId="",B.value.length===0)return(r=window.$message)==null||r.destroyAll(),(o=window.$message)==null||o.warning("请您先选择采集点"),!1;I.value.forEach(R=>{n.tagNames+=R.tagName+",",n.tagDescs+=R.tagDesc+",",n.tagId+=R.id+","}),n.tagName=I.value[0].tagName,n.tagNames=(c=n.tagNames)==null?void 0:c.substring(0,n.tagNames.length-1),n.tagDescs=(u=n.tagDescs)==null?void 0:u.substring(0,n.tagDescs.length-1),n.tagId=(M=n.tagId)==null?void 0:M.substring(0,n.tagId.length-1),a.collectionPointForm.visible=!1}const s=()=>{I.value=[],B.value=[]},b=()=>{B.value=[]},h=()=>({style:{height:"40px"}});return(r,o)=>{const c=Ue,u=Ee,M=me,R=V,q=$e,E=Me,ne=me,G=Ge,ue=Ve,J=V,p=je,We=Oe,Xe=Je,rt=ot("no-space");return Z(),Fe(Ke,null,[e(We,{show:m.value,"onUpdate:show":o[9]||(o[9]=v=>m.value=v),title:C.value,preset:"card",class:"w-50%"},{footer:l(()=>[e(p,{size:16,justify:"center"},{default:l(()=>[e(J,{onClick:te,class:"w-100px"},{default:l(()=>[k(A(t(D)("common.cancel")),1)]),_:1}),e(J,{type:"primary",class:"w-100px",onClick:_},{default:l(()=>[k(A(t(D)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(ue,{ref_key:"formRef",ref:K,model:n,rules:z,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:l(()=>[e(G,{responsive:"screen","item-responsive":""},{default:l(()=>[e(u,{span:"24 m:12",label:"所属设备",path:"tagDevId"},{default:l(()=>[e(c,{filterable:"",placeholder:"请选择所属设备",value:n.tagDevId,"onUpdate:value":o[0]||(o[0]=v=>n.tagDevId=v),options:a.deveicelList},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:l(()=>[e(q,{style:{width:"100%"}},{default:l(()=>[e(M,{value:n.tagName,"onUpdate:value":o[1]||(o[1]=v=>n.tagName=v),readonly:""},null,8,["value"]),e(R,{type:"primary",ghost:"",onClick:fe},{default:l(()=>[k(A(a.collectionPointForm.checkedRows.length>1?`+${a.collectionPointForm.checkedRows.length}`:"请选择"),1)]),_:1})]),_:1})]),_:1}),e(u,{span:"24 m:12",label:"测点类型",path:"dataType"},{default:l(()=>[e(c,{filterable:"",placeholder:"请选择测点类型",value:n.tagType,"onUpdate:value":o[2]||(o[2]=v=>n.tagType=v),options:t(H)(t(pe))},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:l(()=>[e(E,{clearable:"",value:n.tagK,"onUpdate:value":o[3]||(o[3]=v=>n.tagK=v),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(u,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:l(()=>[e(c,{filterable:"",placeholder:"请选择转发功能码",value:n.collectType,"onUpdate:value":o[4]||(o[4]=v=>n.collectType=v),options:a.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:l(()=>[e(ne,{clearable:"",value:n.objAddr,"onUpdate:value":o[5]||(o[5]=v=>n.objAddr=v),placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(u,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:l(()=>[e(c,{filterable:"",placeholder:"请选择数据类型",value:n.dataType,"onUpdate:value":[o[6]||(o[6]=v=>n.dataType=v),x],options:t(H)(t(st))},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:l(()=>[e(c,{filterable:"",placeholder:"请选择数据格式",value:n.dataFormat,"onUpdate:value":o[7]||(o[7]=v=>n.dataFormat=v),options:a.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:l(()=>[e(ne,{clearable:"",value:n.tagUnit,"onUpdate:value":o[8]||(o[8]=v=>n.tagUnit=v),placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(We,{show:a.collectionPointForm.visible,"onUpdate:show":o[16]||(o[16]=v=>a.collectionPointForm.visible=v),title:"选择采集点",preset:"card",class:"w-65%",onAfterLeave:b},{footer:l(()=>[e(p,{size:16,justify:"end"},{default:l(()=>[e(J,{onClick:ce},{default:l(()=>[k(A(t(D)("common.cancel")),1)]),_:1}),e(J,{type:"primary",onClick:i},{default:l(()=>[k(A(t(D)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(ue,{model:a.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:l(()=>[e(G,{responsive:"screen","item-responsive":""},{default:l(()=>[e(u,{span:"24 m:12",label:"所属通道"},{default:l(()=>[e(c,{filterable:"",placeholder:"请选择所属通道",value:t(w).chlid,"onUpdate:value":o[10]||(o[10]=v=>t(w).chlid=v),options:a.collectionPointForm.channelList,onUpdateValue:de},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"所属设备"},{default:l(()=>[e(c,{filterable:"",clearable:"",placeholder:"请选择所属设备","label-field":"devName","value-field":"id",value:t(w).devId,"onUpdate:value":o[11]||(o[11]=v=>t(w).devId=v),options:a.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点类型"},{default:l(()=>[e(c,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(w).tagType,"onUpdate:value":o[12]||(o[12]=v=>t(w).tagType=v),options:t(H)(t(pe))},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点功能码"},{default:l(()=>[e(c,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:t(w).collectType,"onUpdate:value":o[13]||(o[13]=v=>t(w).collectType=v),options:a.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(u,{span:"24 m:12",label:"测点名称"},{default:l(()=>[it(e(ne,{clearable:"",value:t(w).fuzzy,"onUpdate:value":o[14]||(o[14]=v=>t(w).fuzzy=v),placeholder:"请输入测点名称"},null,8,["value"]),[[rt]])]),_:1}),e(u,{span:"24 m:12",label:" "},{default:l(()=>[e(J,{onClick:ke},{default:l(()=>[k(A(t(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),lt("div",jt,[e(Xe,{"checked-row-keys":t(B),"onUpdate:checkedRowKeys":[o[15]||(o[15]=v=>he(B)?B.value=v:null),ge],columns:t(Y),data:t(le),size:"small","max-height":500,loading:t($),remote:"","row-key":v=>v.id,pagination:t(T),class:"flex-1","row-props":h},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Xe,{columns:ve,data:I.value,size:"small","max-height":540,loading:t($),remote:"","row-key":v=>v.id,class:"w-20% ml-10px","row-props":h},null,8,["data","loading","row-key"])])]),_:1},8,["show"])],64)}}}),xt=Ce({__name:"batchEdit_model",props:ye({checkedRowKeys:{type:Array,default:[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ye(["submitted"],["update:visible"]),setup(L,{emit:Q}){const a=L,m=Se(L,"visible");Re(()=>m.value,x=>{y.value={editType:0,editMode:0,startV:"0",step:"1",tagK:0}});const W=Q,{formRef:n,validate:d,restoreValidation:X}=ze(),y=Ie({editType:0,editMode:0,startV:"0",step:"1",tagK:0}),P=async()=>{var x,_;if(await d(),y.value.editType==0){console.log(a.checkedRowKeys);let S=[];a.checkedRowKeys.forEach((C,Y)=>{S.push({id:C,objAddr:+y.value.startV+Y*+y.value.step+""})});const{data:j,error:z}=await xe(S);z||(m.value=!1,(x=window.$message)==null||x.success("批量修改成功"),W("submitted"))}else if(y.value.editType==1){let S=[];a.checkedRowKeys.forEach((C,Y)=>{S.push({id:C,tagK:y.value.tagK})});const{data:j,error:z}=await xe(S);z||(m.value=!1,(_=window.$message)==null||_.success("批量修改成功"),W("submitted"))}},K={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},ee={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},F={editType:K,editMode:K,startV:ee,step:ee},te=Ie(!1);return(x,_)=>{const S=Ue,j=Ee,z=me,C=Me,Y=Ge,oe=Ve,le=V,O=je,$=Oe;return Z(),Fe(Ke,null,[e($,{show:m.value,"onUpdate:show":_[6]||(_[6]=T=>m.value=T),title:"批量修改",preset:"card",class:"w-40%"},{footer:l(()=>[e(O,{size:16,justify:"center"},{default:l(()=>[e(le,{onClick:_[5]||(_[5]=T=>m.value=!1),class:"w-100px"},{default:l(()=>[k(A(x.$t("common.cancel")),1)]),_:1}),e(le,{type:"primary",class:"w-100px",onClick:P},{default:l(()=>[k(A(x.$t("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(oe,{ref_key:"formRef",ref:n,"label-width":120,"label-placement":"left",model:y.value,rules:F},{default:l(()=>[e(Y,{responsive:"screen","item-responsive":""},{default:l(()=>[e(j,{span:"24 m:12",label:"修改类型",path:"editType"},{default:l(()=>[e(S,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editType,"onUpdate:value":_[0]||(_[0]=T=>y.value.editType=T),options:t(H)(t(Ye)({0:"寄存器地址",1:"系数K"}))},null,8,["value","options"])]),_:1}),y.value.editType==0?(Z(),Ne(j,{key:0,span:"24 m:12",label:"修改步长",path:"editMode"},{default:l(()=>[e(S,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editMode,"onUpdate:value":_[1]||(_[1]=T=>y.value.editMode=T),options:t(H)(t(Ye)({0:"步长"}))},null,8,["value","options"])]),_:1})):Le("",!0),y.value.editType==0?(Z(),Ne(j,{key:1,span:"24 m:12",label:"起始值",path:"startV"},{default:l(()=>[e(z,{clearable:"",value:y.value.startV,"onUpdate:value":_[2]||(_[2]=T=>y.value.startV=T),placeholder:"请输入起始值"},null,8,["value"])]),_:1})):Le("",!0),y.value.editType==0?(Z(),Ne(j,{key:2,span:"24 m:12",label:"步长",path:"step"},{default:l(()=>[e(z,{clearable:"",value:y.value.step,"onUpdate:value":_[3]||(_[3]=T=>y.value.step=T),placeholder:"请输入步长"},null,8,["value"])]),_:1})):Le("",!0),y.value.editType==1?(Z(),Ne(j,{key:3,span:"24 m:12",label:"修改的值",path:"step"},{default:l(()=>[e(C,{clearable:"",value:y.value.tagK,"onUpdate:value":_[4]||(_[4]=T=>y.value.tagK=T),placeholder:"请输入修改的值"},null,8,["value"])]),_:1})):Le("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e($,{show:te.value,"onUpdate:show":_[7]||(_[7]=T=>te.value=T),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),St={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function tt(L){return typeof L=="function"||Object.prototype.toString.call(L)==="[object Object]"&&!yt(L)}const Zt=Ce({name:"configsetting_forwardingservice_forwardingpointmanagement",__name:"index",setup(L){const Q=vt(),a=gt(),m=_e({channelList:[],channelAndDevObj:{},deveicelList:[],transFunctionOptions:[],addMultipeModelVisible:!1});async function W(){const{data:g,error:f}=await Pe({type:1});f||(m.channelList=g,m.channelList.forEach(N=>{m.channelAndDevObj[N.id]=N.devicePojoList}),m.channelList.length>0&&(F.chlid=m.channelList[0].id,F.chlid&&(m.deveicelList=m.channelAndDevObj[F.chlid]),n(),P()),m.deveicelList=m.channelAndDevObj[F.chlid])}async function n(){const{data:g,error:f}=await we({chlId:F.chlid});f||(m.transFunctionOptions=JSON.parse(g).data)}const{columns:d,columnChecks:X,data:y,getData:P,loading:K,mobilePagination:ee,searchParams:F,resetSearchParams:te}=Be({apiFn:Nt,apiParams:{page:1,pageSize:200,limit:200,chlid:null,devId:null,tagType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"测点ID",align:"center",width:80},{key:"tagName",title:"测点名称",align:"center",minWidth:100},{key:"tagType",title:"测点类型",align:"center",width:140,render:g=>e("span",null,[kt[g.tagType]||""])},{key:"devName",title:"所属设备",align:"center",width:140,render:g=>{var f,N;return e("span",null,[((N=(f=m.deveicelList)==null?void 0:f.find(ie=>ie.id===g.devId))==null?void 0:N.devName)||""])}},{key:"collectname",title:"转发功能码",align:"center",width:140,render:g=>{var f;return e("span",null,[(f=g.collectname)==null?void 0:f.replace(/\(.*?\)/g,"")])}},{key:"dataType",title:"数据类型",align:"center",width:140,render:g=>e("span",null,[g.dataType?Ze[Number(g.dataType)]:Ze[0]])},{key:"dataFormat",title:"数据格式",align:"center",width:140,render:g=>e("span",null,[g.dataType?He[Number(g.dataFormat)]:He[0]])},{key:"tagK",title:"系数K",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140},{key:"operate",title:D("common.operate"),align:"center",width:140,fixed:"right",render:g=>{let f;return e("div",{class:"flex-center gap-8px"},[e(V,{type:"primary",ghost:!0,size:"small",onClick:()=>O(g.id)},tt(f=D("common.edit"))?f:{default:()=>[f]}),e(Qe,{onPositiveClick:()=>le(g.id)},{default:()=>D("common.confirmDelete"),trigger:()=>{let N;return e(V,{type:"error",ghost:!0,size:"small"},tt(N=D("common.delete"))?N:{default:()=>[N]})}})])}}]});bt(()=>{const g=a.currentRoute.value.query.channelId;F.chlid=Number(g)*1||null,W();const f=a.currentRoute.value.query.deviceId;F.devId=Number(f)*1||null});const{drawerVisible:x,operateType:_,editingData:S,handleAdd:j,handleEdit:z,checkedRowKeys:C,onBatchDeleted:Y,onDeleted:oe}=qe(y,P),le=async g=>{const{data:f,error:N}=await et({ids:g});N||oe()},O=g=>{z(g)},$=g=>{g===""&&P()},T=Ie(!1),w=()=>{T.value=!0};function U(g,f){var N;g&&(F.chlid=Number(g),F.devId=null,F.collectType=void 0,m.deveicelList=m.channelAndDevObj[g],(!m.deveicelList||m.deveicelList.length==0)&&((N=window.$message)==null||N.warning("该通道下无设备! 请选择其他通道")),n(),P())}function ke(){m.addMultipeModelVisible=!0}const Te=async()=>{const g=C.value.join(","),{data:f,error:N}=await et({ids:g});N||oe(),C.value=[]};return(g,f)=>{const N=Tt,ie=Ue,B=me,ae=Ft,Ae=$e,se=je,de=_t,fe=wt,re=Ct,ce=pt,I=ut,ve=ct,ge=Je;return Z(),Fe("div",St,[e(de,{bordered:!1,size:"small"},{default:l(()=>[e(se,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:l(()=>[e(Ae,null,{default:l(()=>[e(N,null,{default:l(()=>[k("所属通道")]),_:1}),e(ie,{filterable:"",placeholder:"请选择通道",value:t(F).chlid,"onUpdate:value":f[0]||(f[0]=i=>t(F).chlid=i),"label-field":"chlName","value-field":"id",options:m.channelList,onUpdateValue:U},null,8,["value","options"]),e(N,null,{default:l(()=>[k("所属设备")]),_:1}),e(ie,{filterable:"",clearable:"",placeholder:"请选择设备",value:t(F).devId,"onUpdate:value":[f[1]||(f[1]=i=>t(F).devId=i),t(P)],"label-field":"devName","value-field":"id",options:m.deveicelList},null,8,["value","options","onUpdate:value"]),e(N,null,{default:l(()=>[k("测点类型")]),_:1}),e(ie,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(F).tagType,"onUpdate:value":[f[2]||(f[2]=i=>t(F).tagType=i),t(P)],style:{width:"80%"},options:t(H)(t(pe))},null,8,["value","options","onUpdate:value"]),e(B,{clearable:"",value:t(F).fuzzy,"onUpdate:value":[f[3]||(f[3]=i=>t(F).fuzzy=i),$],placeholder:"请输入测点名称或描述",style:{width:"100%"},onKeyup:ht(t(P),["enter"])},null,8,["value","onKeyup"]),e(t(V),{type:"primary",ghost:"",onClick:t(P)},{icon:l(()=>[e(ae,{class:be(["text-icon",{"animate-spin":t(K)}])},null,8,["class"])]),default:l(()=>[k(" "+A(t(D)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(de,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[e(se,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"})]),"header-extra":l(()=>[e(se,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[e(t(V),{onClick:ke,size:"small",ghost:"",type:"primary"},{icon:l(()=>[e(fe,{class:be(["text-icon",{"animate-spin":t(K)}])},null,8,["class"])]),default:l(()=>[k(" "+A("批量新增"))]),_:1}),e(t(V),{onClick:w,size:"small",ghost:"",type:"primary",disabled:!t(C).length},{icon:l(()=>[e(re,{class:be(["text-icon",{"animate-spin":t(K)}])},null,8,["class"])]),default:l(()=>[k(" "+A("批量修改"))]),_:1},8,["disabled"]),e(t(Qe),{onPositiveClick:Te},{trigger:l(()=>[e(t(V),{size:"small",ghost:"",type:"error",disabled:t(C).length==0},{icon:l(()=>[e(ce,{class:be(["text-icon",{"animate-spin":t(K)}])},null,8,["class"])]),default:l(()=>[k(" "+A(t(D)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:l(()=>[k(" 确认删除选中的项吗？ ")]),_:1}),e(t(V),{onClick:t(P),size:"small",ghost:"",type:"primary"},{icon:l(()=>[e(I,{class:be(["text-icon",{"animate-spin":t(K)}])},null,8,["class"])]),_:1},8,["onClick"]),e(ve,{columns:t(X),"onUpdate:columns":f[4]||(f[4]=i=>he(X)?X.value=i:null)},null,8,["columns"])]),_:1})]),default:l(()=>[e(ge,{"checked-row-keys":t(C),"onUpdate:checkedRowKeys":f[5]||(f[5]=i=>he(C)?C.value=i:null),columns:t(d),data:t(y),size:"small",class:"sm:h-full","flex-height":!t(Q).isMobile,loading:t(K),remote:"","row-key":i=>i.id,pagination:t(ee)},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ut,{visible:t(x),"onUpdate:visible":f[6]||(f[6]=i=>he(x)?x.value=i:null),onSubmitted:t(P),"operate-type":t(_),"row-data":t(S)},null,8,["visible","onSubmitted","operate-type","row-data"]),e(At,{visible:m.addMultipeModelVisible,"onUpdate:visible":f[7]||(f[7]=i=>m.addMultipeModelVisible=i),onSubmitted:t(P)},null,8,["visible","onSubmitted"]),e(xt,{visible:T.value,"onUpdate:visible":f[8]||(f[8]=i=>T.value=i),onSubmitted:t(P),checkedRowKeys:t(C)},null,8,["visible","onSubmitted","checkedRowKeys"])]),_:1})])}}});export{Zt as default};
