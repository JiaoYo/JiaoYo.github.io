import{_ as Te}from"./table-column-setting.vue_vue_type_script_setup_true_lang-DWV3nJxT.js";import{_ as Ue,a as Ce}from"./round-settings-NgTo5mDa.js";import{_ as ze}from"./round-delete-DENK_RVf.js";import{_ as Ie}from"./round-add-BaZYFmC_.js";import{_ as Ee}from"./round-search-C_gAF5H8.js";import{d as se,Z as ae,i as D,a0 as ve,r as we,p as Je,q as qe,a2 as _e,ac as Ve,a as je,$ as O,v as Me,o as W,c as ee,w as n,f as a,g as M,t as x,h as i,y as Ne,x as Be,a3 as L,S as Y,b as ne,aq as me,e as fe,ar as Ae,as as Re,at as Se,au as he,av as Fe,ap as Ge,aw as Le,A as ge,ag as We,a5 as Ke,a4 as oe,E as le,F as Oe,ax as Xe,B as A,a6 as be,s as Ze,ay as He,az as Qe,aA as ce,aB as Ye,a1 as ea,a7 as aa,aC as la,aD as ta,aE as Pe,a8 as ue,a9 as pe,aa as na,ab as oa,X as sa}from"./index-HZqiqJ25.js";import{u as ia,a as ra}from"./table-BJ7Pa9Rb.js";import{y as ca}from"./common-MSeL61YF.js";import{e as ua,f as pa,g as da,h as ma,s as fa,i as ha,j as va}from"./gather-CsIKLpli.js";import{_ as De}from"./FormItemGridItem-ti7ONDuQ.js";import{_ as _a}from"./Cascader-Cwv4X7aq.js";import{_ as ga,a as ba}from"./RadioGroup-BNp-M84I.js";import{_ as xe}from"./Grid-Cn-aZgeW.js";import{_ as $e}from"./DataTable-BUWIQkps.js";import{N as ke}from"./Popconfirm-DTgCiXXD.js";import{_ as ya}from"./InputGroupLabel-BR1CjQOt.js";import"./Forward-BjHo1o6m.js";const wa=fe("span",null,"批量新增：格式为（转发通道1-10）",-1),Pa=se({__name:"add_model",props:ae({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ae(["submitted"],["update:visible"]),setup($,{emit:H}){const S=[{value:1,label:"转发通道"}],P=D(!1),g=ve($,"visible"),N=H,d=$,e=we(y());function y(){return{chlName:"转发通道1",chlType:1,chlAddr:1,chlProtocol:"{DB0993DD-089D-4a9e-94B2-90E335A16055}",chlColtFreq:3e5,chlWaitTime:20,chlDesc:void 0,protocolType:1,chlValid:1,chlEnableBkup:0,chlMainParam:{com_name:void 0,timeout:void 0,baud:void 0,check_bit:void 0,stop_bit:void 0,data_bit:void 0,role:void 0,ip_addr:void 0,port:void 0,reserve0:void 0,reserve1:void 0,reserve2:void 0,reserve3:void 0},chlBkupParam:{com_name:void 0,timeout:void 0,baud:void 0,check_bit:void 0,stop_bit:void 0,data_bit:void 0,role:void 0,ip_addr:void 0,port:void 0,reserve0:void 0,reserve1:void 0,reserve2:void 0,reserve3:void 0}}}function T(){Object.assign(e,y()),d.operateType==="edit"&&d.rowData?(Object.assign(e,d.rowData),e.chlMainParam=JSON.parse(e.chlMainParam),e.chlBkupParam&&JSON.stringify(e.chlBkupParam)!=="{}"?e.chlBkupParam=JSON.parse(e.chlBkupParam):e.chlBkupParam=Object.assign({},e.chlBkupParam)):F("5",void 0)}const{formRef:B,validate:J,restoreValidation:w}=Je();qe(),_e(g,()=>{g.value&&(d.operateType==="add"&&Ve(()=>{setTimeout(()=>{P.value=!0},200)}),T(),w())});const k=()=>{g.value=!1,P.value=!1},R=async()=>{var m,l,c,v,o,p,f;if(await J(),e.protocolType==0?(e.chlMainParam=JSON.stringify({reserve0:e.chlMainParam.reserve0,reserve1:e.chlMainParam.reserve1,reserve2:e.chlMainParam.reserve2,reserve3:e.chlMainParam.reserve3,role:e.chlMainParam.role,ip_addr:e.chlMainParam.ip_addr,port:e.chlMainParam.port,timeout:e.chlMainParam.timeout}),e.chlEnableBkup===1?e.chlBkupParam=JSON.stringify({reserve0:e.chlBkupParam.reserve0,reserve1:e.chlBkupParam.reserve1,reserve2:e.chlBkupParam.reserve2,reserve3:e.chlBkupParam.reserve3,role:e.chlBkupParam.role,ip_addr:e.chlBkupParam.ip_addr,port:e.chlBkupParam.port,timeout:e.chlBkupParam.timeout}):e.chlBkupParam=JSON.stringify({})):(e.chlMainParam=JSON.stringify({reserve0:e.chlMainParam.reserve0,reserve1:e.chlMainParam.reserve1,timeout:e.chlMainParam.timeout,com_name:e.chlMainParam.com_name,baud:e.chlMainParam.baud,check_bit:e.chlMainParam.check_bit,stop_bit:e.chlMainParam.stop_bit,data_bit:e.chlMainParam.data_bit}),e.chlEnableBkup===1?e.chlBkupParam=JSON.stringify({reserve0:e.chlBkupParam.reserve0,reserve1:e.chlBkupParam.reserve1,timeout:e.chlBkupParam.timeout,com_name:e.chlBkupParam.com_name,baud:e.chlBkupParam.baud,check_bit:e.chlBkupParam.check_bit,stop_bit:e.chlBkupParam.stop_bit,data_bit:e.chlBkupParam.data_bit}):e.chlBkupParam=JSON.stringify({})),d.operateType==="add"){let U=[],C=[],E=[],z=e.chlName;if(((m=e.chlName)==null?void 0:m.indexOf("-"))!=-1){let X=Math.abs(z==null?void 0:z.substring(z.lastIndexOf("-")).replace(/[^0-9]/gi,"")),I=z.split(/-(?![^-]*-)/),q=z.substring(0,z.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],_=q.replace(/[^0]/g,""),V=q,t=I[0],G=t.substring(0,t.length-t.match(/(\d+)[^0-9]*$/)[1].length),ie=X-q+1;for(let ye=0;ye<ie;ye++){let j=V++,re=JSON.parse(JSON.stringify(e));re.chlName=parseInt(q)==0?_.length>0?String(j).length>=_.length?G+j:G+_.substring(0,_.length-String(j).length)+j:G+j:_.length>0?j>=10?G+_.substring(0,_.length-String(j).length+1)+j:G+_.substring(0,_.length)+j:G+j,U.push(re),C.push(re.chlName)}}else U=[e],C=[e.chlName];const{data:te,error:Q}=await Ae(U);if(!Q){const X=await Re({page:1,limit:1e3,chlType:1,_t:new Date().getTime()});if(X.data.list.length>0)if(X.data.list.forEach(I=>{C.includes(I.chlName)&&E.push(I.id)}),E.length==0)(l=window.$message)==null||l.destroyAll(),(c=window.$message)==null||c.success("添加成功"),k(),N("submitted");else{const I=await Se({guid:U[0].chlProtocol});if(!I.error){const q=E.map(async _=>{var G;const V=I.data.map(ie=>({...ie,chlId:_}));return(await he(V)).error?((G=window.$message)==null||G.error("通道添加成功，规约信息添加失败"),Promise.reject(new Error("通道添加成功，规约信息添加失败"))):Promise.resolve()});Promise.all(q).then(()=>{var _,V;(_=window.$message)==null||_.destroyAll(),(V=window.$message)==null||V.success("添加成功"),k(),N("submitted")}).catch(_=>{console.error(_)})}}else(v=window.$message)==null||v.destroyAll(),(o=window.$message)==null||o.success("添加成功"),k(),N("submitted")}}else{const{data:U,error:C}=await Fe([e]);C||((p=window.$message)==null||p.destroyAll(),(f=window.$message)==null||f.success("修改成功"),k(),N("submitted"))}};let K=we([]);const Z=async()=>{const{data:m}=await Ge({type:1}),l=JSON.parse(m);console.log(l);function c(v){return Object.keys(v).map(o=>{const p=v[o];return{label:o,value:o,children:p.map(f=>{const[U,C]=Object.entries(f)[0];return{label:U,value:U,children:C.map(E=>({label:E.name,value:E.gUID,id:E.id}))}})}})}K=c(l)},F=async(m,l)=>{console.log(m,l);const{data:c,error:v}=await Le({id:l?l.id:5});if(!v){e.protocolType=c.type;let o=JSON.parse(c.defaultCfg);e.chlMainParam=Object.assign(e.chlMainParam,o),e.chlEnableBkup===1&&(e.chlBkupParam=Object.assign(e.chlBkupParam,o))}};Z();const s={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},r={type:"number",required:!0,trigger:["blur","change"],message:"不能为空"},u={required:!0,validator(m,l){let c="^((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$";return new RegExp(c).test(l)?!0:new Error("IP地址错误")},trigger:["input","blur"]},b={chlName:s,chlType:r,chlAddr:r,chlWaitTime:r,chlColtFreq:r,protocolType:r,chlValid:r,chlEnableBkup:r,chlProtocol:s,chlMainParam:{role:r,com_name:r,timeout:r,baud:r,check_bit:r,stop_bit:r,data_bit:r,ip_addr:[s,u],port:r},chlBkupParam:{role:r,com_name:r,timeout:r,baud:r,check_bit:r,stop_bit:r,data_bit:r,ip_addr:[s,u],port:r}},h=je(()=>({add:O("common.add"),edit:O("common.edit")})[d.operateType]);return(m,l)=>{const c=ge,v=We,o=De,p=Ke,f=oe,U=_a,C=ga,E=le,z=ba,te=xe,Q=Oe,X=Xe,I=A,q=le,_=be,V=Me("no-space");return W(),ee(_,{show:g.value,"onUpdate:show":l[25]||(l[25]=t=>g.value=t),title:h.value,preset:"card",class:"w-50%",onAfterLeave:k},{footer:n(()=>[a(q,{size:16,justify:"end"},{default:n(()=>[a(I,{onClick:k},{default:n(()=>[M(x(i(O)("common.cancel")),1)]),_:1}),a(I,{type:"primary",onClick:R},{default:n(()=>[M(x(i(O)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(X,{style:{"max-height":"80vh"}},{default:n(()=>[a(Q,{ref_key:"formRef",ref:B,model:e,rules:b,"label-placement":"left","label-width":140,"require-mark-placement":"left",onKeyup:Ne(R,["enter"])},{default:n(()=>[a(te,{responsive:"screen","item-responsive":""},{default:n(()=>[a(o,{span:"24 m:12",label:"通道名称",path:"chlName"},{default:n(()=>[a(v,{show:P.value,placement:"top-start"},{trigger:n(()=>[Be(a(c,{clearable:"",value:e.chlName,"onUpdate:value":l[0]||(l[0]=t=>e.chlName=t),placeholder:"请输入通道名称"},null,8,["value"]),[[V]])]),default:n(()=>[wa]),_:1},8,["show"])]),_:1}),a(o,{span:"24 m:12",label:"通道描述",path:"chlDesc"},{default:n(()=>[a(c,{clearable:"",value:e.chlDesc,"onUpdate:value":l[1]||(l[1]=t=>e.chlDesc=t),placeholder:"请输入通道描述"},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"通道地址",path:"chlAddr"},{default:n(()=>[a(p,{clearable:"",value:e.chlAddr,"onUpdate:value":l[2]||(l[2]=t=>e.chlAddr=t),placeholder:"请输入通道地址",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"通道类型",path:"chlType"},{default:n(()=>[a(f,{filterable:"",clearable:"",placeholder:"请选择通道类型",value:e.chlType,"onUpdate:value":l[3]||(l[3]=t=>e.chlType=t),disabled:"",options:S},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"交互频率(ms)",path:"chlColtFreq"},{default:n(()=>[a(p,{clearable:"",value:e.chlColtFreq,"onUpdate:value":l[4]||(l[4]=t=>e.chlColtFreq=t),placeholder:"请输入交互频率",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"每帧间隔(ms)",path:"chlWaitTime"},{default:n(()=>[a(p,{clearable:"",value:e.chlWaitTime,"onUpdate:value":l[5]||(l[5]=t=>e.chlWaitTime=t),placeholder:"请输入每帧间隔",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"协议名称",path:"chlProtocol"},{default:n(()=>[a(U,{value:e.chlProtocol,"onUpdate:value":[l[6]||(l[6]=t=>e.chlProtocol=t),F],placeholder:"请选择协议名称","expand-trigger":"click",options:i(K),"check-strategy":"child","show-path":!1},null,8,["value","options"])]),_:1}),a(o,{span:"24 m:12",label:"协议类型",path:"protocolType"},{default:n(()=>[a(f,{filterable:"",placeholder:"请选择协议类型",value:e.protocolType,"onUpdate:value":l[7]||(l[7]=t=>e.protocolType=t),options:i(L)(i(ua))},null,8,["value","options"])]),_:1}),d.operateType=="edit"?(W(),ee(o,{key:0,span:"24 m:24",label:"通道有效性",path:"chlValid"},{default:n(()=>[a(z,{value:e.chlValid,"onUpdate:value":l[8]||(l[8]=t=>e.chlValid=t),name:"radiogroup"},{default:n(()=>[a(E,null,{default:n(()=>[a(C,{label:"是",value:1}),a(C,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):Y("",!0),e.protocolType!==0?(W(),ne(me,{key:1},[a(o,{span:"24 m:12",label:"串口名称",path:"chlMainParam.com_name"},{default:n(()=>[a(f,{filterable:"",placeholder:"请选择",value:e.chlMainParam.com_name,"onUpdate:value":l[9]||(l[9]=t=>e.chlMainParam.com_name=t),options:i(L)(i(pa))},null,8,["value","options"])]),_:1}),a(o,{span:"24 m:12",label:"波特率",path:"chlMainParam.baud"},{default:n(()=>[a(f,{filterable:"",placeholder:"请选择",value:e.chlMainParam.baud,"onUpdate:value":l[10]||(l[10]=t=>e.chlMainParam.baud=t),options:i(L)(i(da))},null,8,["value","options"])]),_:1}),a(o,{span:"24 m:12",label:"数据位",path:"chlMainParam.data_bit"},{default:n(()=>[a(f,{filterable:"",placeholder:"请选择",value:e.chlMainParam.data_bit,"onUpdate:value":l[11]||(l[11]=t=>e.chlMainParam.data_bit=t),options:i(L)(i(ma))},null,8,["value","options"])]),_:1}),a(o,{span:"24 m:12",label:"停止位",path:"chlMainParam.stop_bit"},{default:n(()=>[a(f,{filterable:"",placeholder:"请选择",value:e.chlMainParam.stop_bit,"onUpdate:value":l[12]||(l[12]=t=>e.chlMainParam.stop_bit=t),options:i(L)(i(fa))},null,8,["value","options"])]),_:1}),a(o,{span:"24 m:12",label:"校验位",path:"chlMainParam.check_bit"},{default:n(()=>[a(f,{filterable:"",placeholder:"请选择",value:e.chlMainParam.check_bit,"onUpdate:value":l[13]||(l[13]=t=>e.chlMainParam.check_bit=t),options:i(L)(i(ha))},null,8,["value","options"])]),_:1}),a(o,{span:"24 m:12",label:"保留0"},{default:n(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve0,"onUpdate:value":l[14]||(l[14]=t=>e.chlMainParam.reserve0=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"超时",path:"chlMainParam.timeout"},{default:n(()=>[a(p,{clearable:"",value:e.chlMainParam.timeout,"onUpdate:value":l[15]||(l[15]=t=>e.chlMainParam.timeout=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"保留1"},{default:n(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve1,"onUpdate:value":l[16]||(l[16]=t=>e.chlMainParam.reserve1=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1})],64)):Y("",!0),e.protocolType==0?(W(),ee(o,{key:2,span:"24 m:12",label:"通讯方向",path:"chlMainParam.role"},{default:n(()=>[a(f,{filterable:"",placeholder:"请选择",value:e.chlMainParam.role,"onUpdate:value":l[17]||(l[17]=t=>e.chlMainParam.role=t),options:i(L)(i(va))},null,8,["value","options"])]),_:1})):Y("",!0),e.protocolType==0?(W(),ne(me,{key:3},[a(o,{span:"24 m:12",label:"保留0"},{default:n(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve0,"onUpdate:value":l[18]||(l[18]=t=>e.chlMainParam.reserve0=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"IP/域名",path:"chlMainParam.ip_addr"},{default:n(()=>[a(c,{clearable:"",value:e.chlMainParam.ip_addr,"onUpdate:value":l[19]||(l[19]=t=>e.chlMainParam.ip_addr=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"保留1"},{default:n(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve1,"onUpdate:value":l[20]||(l[20]=t=>e.chlMainParam.reserve1=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"端口号",path:"chlMainParam.port"},{default:n(()=>[a(p,{clearable:"",min:1,max:65535,value:e.chlMainParam.port,"onUpdate:value":l[21]||(l[21]=t=>e.chlMainParam.port=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"保留2"},{default:n(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve2,"onUpdate:value":l[22]||(l[22]=t=>e.chlMainParam.reserve2=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"超时",path:"chlMainParam.timeout"},{default:n(()=>[a(p,{clearable:"",value:e.chlMainParam.timeout,"onUpdate:value":l[23]||(l[23]=t=>e.chlMainParam.timeout=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(o,{span:"24 m:12",label:"保留3"},{default:n(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve3,"onUpdate:value":l[24]||(l[24]=t=>e.chlMainParam.reserve3=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1})],64)):Y("",!0)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),ka={class:"font-size-16px"},Ma=se({__name:"regulations_model",props:ae({channelId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ae(["submitted"],["update:visible"]),setup($,{emit:H}){const S=D({}),P=D([]),g=D([]),N=D(!1),d=D(!1),e=D(!1),y=ve($,"visible"),T=H,B=$;_e(()=>B.channelId,s=>{}),Ze(async()=>{await J(),await k()});const J=async()=>{try{d.value=!0;const{data:s,error:r}=await He({id:B.channelId});r||(S.value=s)}catch{d.value=!1}},w=async s=>{let r=[];try{const{data:u,error:b}=await Se({guid:S.value.chlProtocol});if(!b){if(u.forEach(h=>{h.foptions&&(h.foptions=h.foptions?JSON.parse(h.foptions):h.foptions)}),N.value)if(s.length>0){let h=u.sort((l,c)=>l.fno>c.fno?1:-1),m=s.sort((l,c)=>l.fno>c.fno?1:-1);g.value=h.filter(l=>m.some(c=>c.fname===l.fname&&c.fno===l.fno)),u.forEach(l=>{s.forEach(c=>{l.fname==c.fname&&l.fno==c.fno&&(l.fdesc=c.fdesc,l.fdataflag=c.fdataflag,l.fpno=c.fpno,l.fvalue=c.fvalue)}),r.push({chlId:B.channelId,fname:l.fname,fpno:s[0].fpno,fno:l.fno,fdesc:l.fdesc,fdataflag:l.fdataflag,fvalue:l.fvalue,foptions:l.foptions})}),r=r.sort((l,c)=>l.fno>c.fno?1:-1),P.value=r}else P.value=u;else P.value=u;d.value=!1}}catch{d.value=!1}},k=async()=>{try{const{data:s,error:r}=await Qe({chlId:B.channelId});r||(s.forEach(u=>{u.foptions&&(u.foptions=JSON.parse(u.foptions))}),s.length>0?N.value=!0:N.value=!1,await w(s),d.value=!1)}catch{d.value=!1}},R=[{key:"fno",title:"编号",align:"center",width:60},{key:"fdesc",title:"参数描述",align:"center",width:160},{key:"fvalue",title:"参数类型",align:"center",width:100,render(s,r){var u;return ce(oe,{value:s.fdataflag,options:[{label:"文本",value:2},{label:"10进制",value:10},{label:"16进制",value:16}],onUpdateValue:b=>{s.fdataflag=b},disabled:((u=s.foptions)==null?void 0:u.length)>0})}},{key:"foptions",title:"参数值",align:"center",width:160,render(s,r){return s.foptions?ce(oe,{value:s.fvalue,onUpdateValue:u=>{s.fvalue=u},options:s.foptions,labelField:"desc",valueField:"value"}):ce(ge,{value:s.fvalue,onUpdateValue:u=>{s.fvalue=u}})}}],K=async()=>{var r,u,b,h;let s=JSON.parse(JSON.stringify(P.value));if(N.value){g.value.forEach(v=>{v.chlId=B.channelId,v.foptions&&(v.foptions=JSON.stringify(v.foptions))});let m=s.filter(v=>!g.value.some(o=>o.fname===v.fname&&o.fno===v.fno));const{data:l,error:c}=await Ye(g.value);c||(m.length>0?await Z(m):((r=window.$message)==null||r.destroyAll(),(u=window.$message)==null||u.success("配置成功"),y.value=!1,T("submitted")))}else{s.forEach(c=>{c.chlId=B.channelId,c.foptions&&(c.foptions=JSON.stringify(c.foptions))});const{data:m,error:l}=await he(s);l||((b=window.$message)==null||b.destroyAll(),(h=window.$message)==null||h.success("配置成功"),y.value=!1,T("submitted"))}},Z=async s=>{var b,h;s.forEach(m=>{m.chlId=B.channelId,m.foptions&&(m.foptions=JSON.stringify(m.foptions))});const{data:r,error:u}=await he(s);u||((b=window.$message)==null||b.destroyAll(),(h=window.$message)==null||h.success("配置成功"),y.value=!1,T("submitted"))},F=s=>{};return(s,r)=>{const u=$e,b=A,h=le,m=be;return W(),ee(m,{show:y.value,"onUpdate:show":r[2]||(r[2]=l=>y.value=l),preset:"card",class:"w-40% h-700px"},{header:n(()=>[fe("span",null,[M("规约特征配置"),fe("span",ka,"(通道："+x(S.value.chlName)+" 协议："+x(S.value.name)+")",1)])]),footer:n(()=>[a(h,{size:16,justify:"end"},{default:n(()=>[a(b,{disabled:!N.value,class:"w-140px mb-10px",onClick:r[0]||(r[0]=l=>w([]))},{default:n(()=>[M(x("还原默认设置"))]),_:1},8,["disabled"]),a(b,{onClick:r[1]||(r[1]=l=>y.value=!1),class:"w-100px"},{default:n(()=>[M(x(s.$t("common.cancel")),1)]),_:1}),a(b,{type:"primary",disabled:e.value,class:"w-100px",onClick:K},{default:n(()=>[M(x(s.$t("common.confirm")),1)]),_:1},8,["disabled"])]),_:1})]),default:n(()=>[a(u,{columns:R,data:P.value,size:"small",loading:d.value,remote:"","row-key":l=>l.id,class:"h-full","flex-height":"",onScroll:F},null,8,["data","loading","row-key"])]),_:1},8,["show"])}}}),Na=se({__name:"merge_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:ae(["submitted"],["update:visible"]),setup($,{emit:H}){const P=ea({0:"采集104tcp",1:"采集104udp"}),g=ve($,"visible"),N=D(null),d=D({targetDevice:void 0,EquipmentMerged:void 0}),e=()=>{},T={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}},B=D(!1);return(J,w)=>{const k=oe,R=De,K=xe,Z=Oe,F=A,s=le,r=be;return W(),ne(me,null,[a(r,{show:g.value,"onUpdate:show":w[3]||(w[3]=u=>g.value=u),title:"通道合并",preset:"card",class:"w-40%"},{footer:n(()=>[a(s,{size:16,justify:"center"},{default:n(()=>[a(F,{onClick:w[2]||(w[2]=u=>g.value=!1),class:"w-100px"},{default:n(()=>[M(x(J.$t("common.cancel")),1)]),_:1}),a(F,{type:"primary",class:"w-100px",onClick:e},{default:n(()=>[M(x(J.$t("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(Z,{ref_key:"formRef",ref:N,"label-width":120,"label-placement":"left",model:d.value,rules:T},{default:n(()=>[a(K,{responsive:"screen","item-responsive":""},{default:n(()=>[a(R,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:n(()=>[a(k,{filterable:"",clearable:"",placeholder:"请选择通道",value:d.value.targetDevice,"onUpdate:value":w[0]||(w[0]=u=>d.value.targetDevice=u),options:i(L)(i(P))},null,8,["value","options"])]),_:1}),a(R,{span:"24 m:12",label:"待合并通道",path:"EquipmentMerged"},{default:n(()=>[a(k,{multiple:"",filterable:"",clearable:"",placeholder:"请选择通道",value:d.value.EquipmentMerged,"onUpdate:value":w[1]||(w[1]=u=>d.value.EquipmentMerged=u),options:i(L)(i(P))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),a(r,{show:B.value,"onUpdate:show":w[4]||(w[4]=u=>B.value=u),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),Ba={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function de($){return typeof $=="function"||Object.prototype.toString.call($)==="[object Object]"&&!na($)}const Fa=se({name:"configsetting_forwardingservice_forwardingchannelmanagement",__name:"index",setup($){const H=aa(),S=D(!1),P=D(),g=D(!1),{columns:N,columnChecks:d,data:e,getData:y,loading:T,mobilePagination:B,searchParams:J,resetSearchParams:w}=ia({apiFn:la,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,chlType:1,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",fixed:"left",width:48},{key:"id",title:"通道ID",align:"center",fixed:"left",width:60},{key:"chlName",title:"通道名称",align:"center",width:140},{key:"chlAddr",title:"通道地址",align:"center",width:140},{key:"chlType",title:"通道类型",align:"center",width:100,render:o=>a("span",null,[M("转发通道")])},{key:"name",title:"协议名称",align:"center",minWidth:200,render:o=>a("div",{class:"flex-center justify-center gap-8px"},[a(Ue,{class:"text-icon cursor-pointer",color:o.pro>0?"#ff7f50":"",onClick:()=>v(o.id)},null),a("span",null,[o.name])])},{key:"chlMainParam",title:"主通道参数",align:"center",width:240,render:o=>a("span",{class:"font-size-14px"},[o.protocolType===0?JSON.stringify({ip_addr:JSON.parse(o.chlMainParam).ip_addr,port:JSON.parse(o.chlMainParam).port}):JSON.stringify({COM_NAME:JSON.parse(o.chlMainParam).com_name})||{}])},{key:"chlColtFreq",title:"交互频率(ms)",align:"center",width:140},{key:"chlWaitTime",title:"每帧间隔(ms)",align:"center",width:140},{key:"chlValid",title:"有效性",align:"center",width:140,render:o=>{let p;return a(ta,{type:o.chlValid===1?"success":"error"},de(p=O(ca[o.chlValid]))?p:{default:()=>[p]})}},{key:"chlDesc",title:"通道描述",align:"center",width:140},{key:"operate",title:O("common.operate"),align:"center",width:250,fixed:"right",render:o=>{let p;return a("div",{class:"flex-center gap-8px"},[a(A,{type:"primary",ghost:!0,size:"small",onClick:()=>b(o.id)},{default:()=>["子设备管理"]}),a(A,{type:"primary",ghost:!0,size:"small",onClick:()=>l(o.id)},de(p=O("common.edit"))?p:{default:()=>[p]}),a(ke,{onPositiveClick:()=>m(o.id)},{default:()=>O("common.confirmDelete"),trigger:()=>{let f;return a(A,{type:"error",ghost:!0,size:"small"},de(f=O("common.delete"))?f:{default:()=>[f]})}})])}}]}),{drawerVisible:k,operateType:R,editingData:K,handleAdd:Z,handleEdit:F,checkedRowKeys:s,onBatchDeleted:r,onDeleted:u}=ra(e,y);_e(()=>J.fuzzy,o=>{o||y()});const b=o=>{H.push({path:"/configsetting/forwardingservice/forwardingdevicemanagement",query:{channelId:o}})},h=()=>{y()},m=async o=>{const{data:p,error:f}=await Pe({ids:o});f||u()},l=o=>{F(o)},c=async()=>{const{data:o,error:p}=await Pe({ids:s.value.join(",")});p||u()},v=o=>{P.value=o,S.value=!0};return(o,p)=>{const f=ya,U=ge,C=Ee,E=oa,z=le,te=Ie,Q=ze,X=Ce,I=Te,q=$e,_=sa,V=Me("no-space");return W(),ne("div",Ba,[a(_,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[a(z,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:n(()=>[a(E,null,{default:n(()=>[a(f,null,{default:n(()=>[M("通道名称")]),_:1}),Be(a(U,{clearable:"",value:i(J).fuzzy,"onUpdate:value":p[0]||(p[0]=t=>i(J).fuzzy=t),placeholder:"请输入通道名称",style:{width:"100%"},onKeyup:Ne(h,["enter"])},null,8,["value"]),[[V]]),a(i(A),{type:"primary",ghost:"",onClick:h},{icon:n(()=>[a(C,{class:ue(["text-icon",{"animate-spin":i(T)}])},null,8,["class"])]),default:n(()=>[M(" "+x(i(O)("common.search")),1)]),_:1})]),_:1})]),_:1})]),"header-extra":n(()=>[a(z,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[a(i(A),{onClick:i(Z),size:"small",ghost:"",type:"primary"},{icon:n(()=>[a(te,{class:ue(["text-icon",{"animate-spin":i(T)}])},null,8,["class"])]),default:n(()=>[M(" "+x(i(O)("common.add")),1)]),_:1},8,["onClick"]),a(i(ke),{onPositiveClick:c},{trigger:n(()=>[a(i(A),{size:"small",ghost:"",type:"error",disabled:i(s).length===0},{icon:n(()=>[a(Q,{class:"text-icon"})]),default:n(()=>[M(" "+x(i(O)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:n(()=>[M(" "+x(i(O)("common.confirmDelete")),1)]),_:1}),a(i(A),{onClick:p[1]||(p[1]=t=>S.value=!0),size:"small",ghost:"",type:"primary",disabled:i(s).length!==1},{icon:n(()=>[a(X,{class:ue(["text-icon",{"animate-spin":i(T)}])},null,8,["class"])]),default:n(()=>[M(" 规约特征配置 ")]),_:1},8,["disabled"]),a(I,{columns:i(d),"onUpdate:columns":p[2]||(p[2]=t=>pe(d)?d.value=t:null)},null,8,["columns"])]),_:1})]),default:n(()=>[a(q,{"checked-row-keys":i(s),"onUpdate:checkedRowKeys":p[3]||(p[3]=t=>pe(s)?s.value=t:null),columns:i(N),data:i(e),size:"small",loading:i(T),remote:"","row-key":t=>t.id,pagination:i(B),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),a(Pa,{visible:i(k),"onUpdate:visible":p[4]||(p[4]=t=>pe(k)?k.value=t:null),onSubmitted:i(y),"operate-type":i(R),"row-data":i(K)},null,8,["visible","onSubmitted","operate-type","row-data"]),S.value?(W(),ee(Ma,{key:0,visible:S.value,"onUpdate:visible":p[5]||(p[5]=t=>S.value=t),channelId:i(s).length==0?P.value:i(s)[0],onSubmitted:i(y)},null,8,["visible","channelId","onSubmitted"])):Y("",!0),a(Na,{visible:g.value,"onUpdate:visible":p[6]||(p[6]=t=>g.value=t)},null,8,["visible"])]),_:1})])}}});export{Fa as default};
