import{_ as be}from"./table-column-setting.vue_vue_type_script_setup_true_lang-C5rtfvJ5.js";import{_ as he}from"./round-refresh-WUj80J64.js";import{_ as ye}from"./round-add-DUJXnBlA.js";import{_ as we}from"./round-search-Bax3PIKr.js";import{d as X,Z as J,i as A,a0 as ne,r as ee,p as Ne,q as De,a2 as ie,ac as re,a as Ie,$ as k,v as ue,o as G,c as te,w as t,f as e,g as S,t as V,h as l,x as ce,S as ke,y as xe,e as Ce,aF as Me,aG as Se,a4 as Z,A as de,ag as qe,E as K,F as le,B as O,a6 as ae,ad as pe,a1 as me,b as _e,a3 as H,aq as $e,a7 as Ue,aH as Oe,aD as ze,s as Te,aI as Ae,a8 as Q,a9 as W,aa as Ve,ab as Be,X as Ee}from"./index-BfAsC10q.js";import{u as Re,a as Fe}from"./table-DlIAyHtY.js";import{_ as oe}from"./FormItemGridItem-CM5zeY-x.js";import{_ as Pe,a as je}from"./RadioGroup-BmSMxSTA.js";import{_ as se}from"./Grid-C5N5wDNZ.js";import{y as Le}from"./common-HjFER1-E.js";import{N as Ge}from"./Popconfirm-DB_vq6iQ.js";import{_ as Ke}from"./InputGroupLabel-Dynm-jlT.js";import{_ as Je}from"./DataTable-DAbQR8IX.js";import"./Forward-Cz-tjaGb.js";const He=Ce("span",null,"批量新增：格式为（采集设备1-10）",-1),Xe=X({__name:"add_model",props:J({operateType:{},rowData:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(w,{emit:R}){const x=A(!1),b=ne(w,"visible"),v=R,u=w,n=ee(N());function N(){return{devName:"采集设备1",chlId:void 0,devCommAddr:"1",devPubAddr:"1",devValid:1,devDesc:"",reserve0:"",reserve1:""}}const B=ee({channelList:[]});async function y(){const{data:c,error:s}=await pe({type:0});s||(B.channelList=c)}async function q(){await y(),u.operateType==="edit"&&u.rowData?Object.assign(n,u.rowData):(Object.assign(n,N()),n.chlId=u.chlId||B.channelList[0].id)}const{formRef:m,validate:i,restoreValidation:$}=Ne();De(),ie(()=>u.rowData,()=>{q()}),ie(b,()=>{b.value&&(re(()=>{u.operateType==="add"&&re(()=>{setTimeout(()=>{x.value=!0},200)})}),q(),$())});const D=()=>{b.value=!1,x.value=!1},z=async()=>{var c;if(await i(),u.operateType==="add"){let s=[],_=n.devName;if(((c=n.devName)==null?void 0:c.indexOf("-"))!=-1){let o=Math.abs(_==null?void 0:_.substring(_.lastIndexOf("-")).replace(/[^0-9]/gi,"")),a=_.split(/-(?![^-]*-)/),r=_.substring(0,_.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],d=r.replace(/[^0]/g,""),L=r,E=a[0],I=E.substring(0,E.length-E.match(/(\d+)[^0-9]*$/)[1].length),P=o-r+1;for(let j=0;j<P;j++){let g=L++,p=JSON.parse(JSON.stringify(n));p.devName=parseInt(r)==0?d.length>0?String(g).length>=d.length?I+g:I+d.substring(0,d.length-String(g).length)+g:I+g:d.length>0?g>=10?I+d.substring(0,d.length-String(g).length+1)+g:I+d.substring(0,d.length)+g:I+g,s.push(p)}}else s=[n];const{data:M,error:T}=await Me(s);T?console.log("error",T):(console.log("success",M),D(),v("submitted"))}else{const{data:s,error:_}=await Se([n]);_?console.log("error",_):(console.log("success",s),D(),v("submitted"))}},C={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},F={devName:C,chlId:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},devCommAddr:C,devPubAddr:C},h=Ie(()=>({add:k("common.add"),edit:k("common.edit")})[u.operateType]);return(c,s)=>{const _=Z,M=oe,T=de,o=qe,a=Pe,r=K,d=je,L=se,E=le,I=O,P=K,j=ae,g=ue("no-space");return G(),te(j,{show:b.value,"onUpdate:show":s[5]||(s[5]=p=>b.value=p),title:h.value,preset:"card",class:"w-30%",onAfterLeave:D},{footer:t(()=>[e(P,{size:16,justify:"center"},{default:t(()=>[e(I,{onClick:D,class:"w-100px"},{default:t(()=>[S(V(l(k)("common.cancel")),1)]),_:1}),e(I,{type:"primary",class:"w-100px",onClick:z},{default:t(()=>[S(V(l(k)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(E,{ref_key:"formRef",ref:m,model:n,rules:F,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:xe(z,["enter"])},{default:t(()=>[e(L,{responsive:"screen","item-responsive":""},{default:t(()=>[e(M,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(_,{filterable:"",placeholder:"请选择所属通道",value:n.chlId,"onUpdate:value":s[0]||(s[0]=p=>n.chlId=p),"label-field":"chlName","value-field":"id",options:B.channelList},null,8,["value","options"])]),_:1}),e(M,{span:"24 m:24",label:"设备名称",path:"devName"},{default:t(()=>[e(o,{show:x.value,placement:"right-start"},{trigger:t(()=>[ce(e(T,{clearable:"",value:n.devName,"onUpdate:value":s[1]||(s[1]=p=>n.devName=p),placeholder:"请输入设备名称"},null,8,["value"]),[[g]])]),default:t(()=>[He]),_:1},8,["show"])]),_:1}),e(M,{span:"24 m:24",label:"通讯地址",path:"devCommAddr"},{default:t(()=>[e(T,{clearable:"",value:n.devCommAddr,"onUpdate:value":s[2]||(s[2]=p=>n.devCommAddr=p),placeholder:"请输入通讯地址"},null,8,["value"])]),_:1}),u.operateType=="edit"?(G(),te(M,{key:0,span:"24 m:12",label:"设备有效性",path:"devValid"},{default:t(()=>[e(d,{value:n.devValid,"onUpdate:value":s[3]||(s[3]=p=>n.devValid=p),name:"radiogroup"},{default:t(()=>[e(r,null,{default:t(()=>[e(a,{label:"是",value:1}),e(a,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):ke("",!0),e(M,{span:"24 m:24",label:"设备描述",path:"devDesc"},{default:t(()=>[e(T,{clearable:"",value:n.devDesc,"onUpdate:value":s[4]||(s[4]=p=>n.devDesc=p),placeholder:"请输入设备描述",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ze=X({__name:"merge_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:J(["submitted"],["update:visible"]),setup(w,{emit:R}){const b=me({0:"采集104tcp",1:"采集104udp"}),v=ne(w,"visible"),u=A(null),n=A({targetDevice:void 0,EquipmentMerged:void 0}),N=()=>{},y={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}},q=A(!1);return(m,i)=>{const $=Z,D=oe,z=se,C=le,U=O,F=K,h=ae;return G(),_e($e,null,[e(h,{show:v.value,"onUpdate:show":i[3]||(i[3]=c=>v.value=c),title:"设备合并",preset:"card",class:"w-40%"},{footer:t(()=>[e(F,{size:16,justify:"center"},{default:t(()=>[e(U,{onClick:i[2]||(i[2]=c=>v.value=!1),class:"w-100px"},{default:t(()=>[S(V(m.$t("common.cancel")),1)]),_:1}),e(U,{type:"primary",class:"w-100px",onClick:N},{default:t(()=>[S(V(m.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(C,{ref_key:"formRef",ref:u,"label-width":120,"label-placement":"left",model:n.value,rules:y},{default:t(()=>[e(z,{responsive:"screen","item-responsive":""},{default:t(()=>[e(D,{span:"24 m:12",label:"目标设备",path:"targetDevice"},{default:t(()=>[e($,{filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.targetDevice,"onUpdate:value":i[0]||(i[0]=c=>n.value.targetDevice=c),options:l(H)(l(b))},null,8,["value","options"])]),_:1}),e(D,{span:"24 m:12",label:"待合并设备",path:"EquipmentMerged"},{default:t(()=>[e($,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.EquipmentMerged,"onUpdate:value":i[1]||(i[1]=c=>n.value.EquipmentMerged=c),options:l(H)(l(b))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(h,{show:q.value,"onUpdate:show":i[4]||(i[4]=c=>q.value=c),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),Qe=X({__name:"move_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:J(["submitted"],["update:visible"]),setup(w,{emit:R}){const b=me({0:"采集104tcp",1:"采集104udp"}),v=ne(w,"visible"),u=A(null),n=A({targetDevice:void 0,EquipmentMerged:void 0}),N=()=>{},y={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}};return(q,m)=>{const i=Z,$=oe,D=se,z=le,C=O,U=K,F=ae;return G(),te(F,{show:v.value,"onUpdate:show":m[3]||(m[3]=h=>v.value=h),title:"设备移动至通道",preset:"card",class:"w-40%"},{footer:t(()=>[e(U,{size:16,justify:"center"},{default:t(()=>[e(C,{onClick:m[2]||(m[2]=h=>v.value=!1),class:"w-100px"},{default:t(()=>[S(V(q.$t("common.cancel")),1)]),_:1}),e(C,{type:"primary",class:"w-100px",onClick:N},{default:t(()=>[S(V(q.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(z,{ref_key:"formRef",ref:u,"label-width":120,"label-placement":"left",model:n.value,rules:y},{default:t(()=>[e(D,{responsive:"screen","item-responsive":""},{default:t(()=>[e($,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:t(()=>[e(i,{filterable:"",clearable:"",placeholder:"请选择通道",value:n.value.targetDevice,"onUpdate:value":m[0]||(m[0]=h=>n.value.targetDevice=h),options:l(H)(l(b))},null,8,["value","options"])]),_:1}),e($,{span:"24 m:12",label:"待移动设备",path:"EquipmentMerged"},{default:t(()=>[e(i,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.EquipmentMerged,"onUpdate:value":m[1]||(m[1]=h=>n.value.EquipmentMerged=h),options:l(H)(l(b))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),We={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Y(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!Ve(w)}const mt=X({name:"configsetting_collectionservices_subdevicemanagement",__name:"index",setup(w){const R=Ue(),x=ee({channelList:[],chlIdAndNameMap:{}}),{columns:b,columnChecks:v,data:u,getData:n,loading:N,mobilePagination:B,searchParams:y,resetSearchParams:q}=Re({apiFn:Oe,apiParams:{page:1,pageSize:20,limit:20,type:0,chlId:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",fixed:"left",width:48},{key:"id",title:"设备ID",align:"center",fixed:"left",width:60},{key:"devName",title:"设备名称",align:"center",width:100},{key:"chlId",title:"所属通道",align:"center",width:140,render:o=>e("span",null,[x.chlIdAndNameMap[o.chlId]])},{key:"devDesc",title:"设备描述",align:"center",width:140,render:o=>e("span",null,[o.devDesc?o.devDesc:"无"])},{key:"devCommAddr",title:"设备通信地址",align:"center",width:140},{key:"devValid",title:"有效性",align:"center",width:140,render:o=>{let a;return e(ze,{type:o.devValid==0?"error":"success"},Y(a=k(Le[o.devValid]))?a:{default:()=>[a]})}},{key:"operate",title:k("common.operate"),align:"center",width:250,fixed:"right",render:o=>{let a;return e("div",{class:"flex-center gap-8px"},[e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>T(o)},{default:()=>["采集测点管理"]}),e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>s(o.id)},Y(a=k("common.edit"))?a:{default:()=>[a]}),e(Ge,{onPositiveClick:()=>c(o.id)},{default:()=>k("common.confirmDelete"),trigger:()=>{let r;return e(O,{type:"error",ghost:!0,size:"small"},Y(r=k("common.delete"))?r:{default:()=>[r]})}})])}}]});async function m(){const{data:o,error:a}=await pe({type:0});if(!a){x.channelList=o,o.forEach(d=>{x.chlIdAndNameMap[d.id]=d.chlName});const r=R.currentRoute.value.query.channelId;r&&(y.chlId=Number(r)),n()}}Te(()=>{m()});const{drawerVisible:i,operateType:$,editingData:D,handleAdd:z,handleEdit:C,checkedRowKeys:U,onBatchDeleted:F,onDeleted:h}=Fe(u,n),c=async o=>{const{data:a,error:r}=await Ae({ids:o});r||h()},s=o=>{C(o)},_=A(!1),M=A(!1),T=o=>{R.push({path:"/configsetting/collectionservices/pointmanagement",query:{channelId:o.chlId,deviceId:o.id}})};return(o,a)=>{const r=Ke,d=Z,L=de,E=we,I=Be,P=K,j=ye,g=he,p=be,fe=Je,ve=Ee,ge=ue("no-space");return G(),_e("div",We,[e(ve,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(P,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(I,null,{default:t(()=>[e(r,null,{default:t(()=>[S("所属通道")]),_:1}),e(d,{filterable:"",clearable:"",placeholder:"请选择通道",value:l(y).chlId,"onUpdate:value":a[0]||(a[0]=f=>l(y).chlId=f),"label-field":"chlName","value-field":"id",options:x.channelList},null,8,["value","options"]),e(r,null,{default:t(()=>[S("设备名称")]),_:1}),ce(e(L,{clearable:"",value:l(y).fuzzy,"onUpdate:value":a[1]||(a[1]=f=>l(y).fuzzy=f),placeholder:"请输入设备名称",style:{width:"100%"}},null,8,["value"]),[[ge]]),e(l(O),{type:"primary",ghost:"",onClick:l(n)},{icon:t(()=>[e(E,{class:Q(["text-icon",{"animate-spin":l(N)}])},null,8,["class"])]),default:t(()=>[S(" "+V(l(k)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":t(()=>[e(P,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[e(l(O),{onClick:l(z),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(j,{class:Q(["text-icon",{"animate-spin":l(N)}])},null,8,["class"])]),default:t(()=>[S(" "+V(l(k)("common.add")),1)]),_:1},8,["onClick"]),e(l(O),{onClick:l(n),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(g,{class:Q(["text-icon",{"animate-spin":l(N)}])},null,8,["class"])]),_:1},8,["onClick"]),e(p,{columns:l(v),"onUpdate:columns":a[2]||(a[2]=f=>W(v)?v.value=f:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(fe,{"checked-row-keys":l(U),"onUpdate:checkedRowKeys":a[3]||(a[3]=f=>W(U)?U.value=f:null),columns:l(b),data:l(u),size:"small",loading:l(N),remote:"","row-key":f=>f.id,pagination:l(u).length?l(B):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Xe,{visible:l(i),"onUpdate:visible":a[4]||(a[4]=f=>W(i)?i.value=f:null),onSubmitted:l(n),"operate-type":l($),"row-data":l(D),chlId:l(y).chlId},null,8,["visible","onSubmitted","operate-type","row-data","chlId"]),e(Ze,{visible:_.value,"onUpdate:visible":a[5]||(a[5]=f=>_.value=f)},null,8,["visible"]),e(Qe,{visible:M.value,"onUpdate:visible":a[6]||(a[6]=f=>M.value=f)},null,8,["visible"])]),_:1})])}}});export{mt as default};
