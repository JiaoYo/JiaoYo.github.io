import{_ as ct}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CQ0a8Mvb.js";import{_ as ut}from"./round-refresh-BeE5HiEb.js";import{_ as pt}from"./round-delete-B1TnDQXo.js";import{Y as Ce,o as Z,b as ke,e as me,d as Ue,Z as _e,r as we,a0 as ze,p as Re,q as mt,a2 as $e,a as at,$ as I,ah as nt,f as e,v as ot,w as l,g as _,t as A,h as t,a3 as H,x as it,a9 as ye,aq as Ke,ad as Pe,aj as Fe,a4 as je,A as fe,B as V,ab as Me,a5 as Ve,F as Oe,E as Ae,a6 as Be,aJ as ft,i as Ie,a1 as Ze,c as Le,S as De,N as vt,a7 as gt,s as bt,y as ht,a8 as he,aa as yt,X as _t}from"./index-CGiaWMMy.js";import{_ as wt}from"./round-add-DaZ8zWuN.js";import{_ as Ft}from"./round-search-BVUrvYAd.js";import{u as qe,a as Ee}from"./table-CZOSmR4C.js";import{p as pe,d as st,a as kt,b as He,c as Qe}from"./gather-8q3rGvBS.js";import{_ as Ge}from"./FormItemGridItem-BUpS4xty.js";import{_ as Je}from"./Grid-wJzQLXId.js";import{_ as We}from"./DataTable-g-OZy44s.js";import{N as et}from"./Popconfirm-Dnp__lUp.js";import{_ as Tt}from"./InputGroupLabel-Q82hfWjl.js";import"./RadioGroup-CerJ-tsr.js";import"./Forward-BA3X35TR.js";function Nt(L){return Ce({url:"/transTag/selectPage.do",method:"get",params:L})}function dt(L){return Ce({url:"/transTag/insert.do",method:"post",data:L})}function Se(L){return Ce({url:"/transTag/update.do",method:"post",data:L})}function tt(L){return Ce({url:"/transTag/delete.do",method:"delete",params:L})}const Lt={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Dt=me("path",{fill:"currentColor",d:"M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36M20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83l3.75 3.75z"},null,-1),Pt=[Dt];function It(L,Q){return Z(),ke("svg",Lt,[...Pt])}const Ct={name:"ic-round-edit",render:It},Ut=me("span",null,[_("物模型标识"),me("br"),_("(测点描述)")],-1),jt=Ue({__name:"add_model",props:_e({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:_e(["submitted"],["update:visible"]),setup(L,{emit:Q}){const a=we({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:{},dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),m=ze(L,"visible"),W=Q,n=L,d=we(X());function X(){return{chlId:void 0,devId:void 0,tagDevId:"",tagName:"",tagId:void 0,tagDesc:"",tagUnit:"",tagType:1,tagK:1,objAddr:"0",collectType:1,dataType:4,dataFormat:0}}async function y(){var b;const{data:s,error:i}=await ft({page:1,limit:1e4,type:1});i||(a.deveicelList=s.list.map(h=>({...h,label:h.devName,value:h.id+"_"+h.chlId})),n.operateType==="add"&&a.deveicelList.length>0&&!d.tagDevId&&(d.tagDevId=(b=a.deveicelList[0])==null?void 0:b.value,d.devId=Number(d.tagDevId.split("_")[0]),d.chlId=Number(d.tagDevId.split("_")[1]),d.collectType=void 0),D())}async function D(){const{data:s,error:i}=await Fe({chlId:d.chlId});i||(a.functionList=JSON.parse(s).data,d.collectType=a.functionList[0].FuncCode)}function $(){Object.assign(d,X()),y(),n.operateType==="edit"&&n.rowData&&(Object.assign(d,n.rowData),w(n.rowData))}const{formRef:ee,validate:k,restoreValidation:te}=Re();mt(),$e(m,()=>{m.value&&($(),te())});const x=()=>{m.value=!1};function w(s,i){console.log(s),s==0||s==1||s==2||s==3||s==4||s==7?a.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:s==5||s==6||s==8||s==9||s==10||s==12||s==13?a.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:a.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],a.collectionPointForm.dataFormatList.find(b=>b.value===d.dataFormat)||(d.dataFormat=a.collectionPointForm.dataFormatList[0].value)}const S=async()=>{var s,i;if(await k(),console.log(d),n.operateType==="add"){const{data:b,error:h}=await dt([d]);h||(x(),(s=window.$message)==null||s.success("添加成功"),W("submitted"))}else{const{data:b,error:h}=await Se([d]);h||(x(),(i=window.$message)==null||i.success("编辑成功"),W("submitted"))}},j={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},z={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},C={devId:z,tagName:j,tagDesc:j,tagK:z,objAddr:j,collectType:z,dataType:z,dataFormat:z},Y=at(()=>({add:I("common.add"),edit:I("common.edit")})[n.operateType]),{columns:ne,columnChecks:le,data:O,getData:M,loading:T,mobilePagination:F,searchParams:U,resetSearchParams:Te}=qe({apiFn:nt,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",multiple:!1,align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140},{key:"devId",title:"所属设备",align:"center",width:140,render:s=>{var i;return e("span",null,[((i=a.collectionPointForm.deveicelList.find(b=>b.id===s.devId))==null?void 0:i.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),Ne=()=>{M()},{drawerVisible:g,operateType:f,editingData:N,handleAdd:oe,handleEdit:B,checkedRowKeys:ae,onBatchDeleted:xe,onDeleted:ie}=Ee(O,M);async function se(){const{data:s,error:i}=await Pe();i||(console.log("data",s),s.length>0&&(a.collectionPointForm.channelList=s.filter(b=>b.chlType!==1).map(b=>({label:b.chlName,value:b.id,devicePojoList:b.devicePojoList||[]}))))}se();const ve=s=>{var b;U.chlid=s,U.devId=null;let i=(b=a.collectionPointForm.channelList.find(h=>h.value==s))==null?void 0:b.devicePojoList;a.collectionPointForm.deveicelList=i,re(),M()};function de(){var s,i;if(a.collectionPointForm.channelList.length>0)if(U.chlid)a.collectionPointForm.visible=!0;else{let b=a.collectionPointForm.channelList[0];U.chlid=b.value,a.collectionPointForm.deveicelList=b.devicePojoList,re(),ae.value=[d.tagId],a.collectionPointForm.checkedRows.tagName=d.tagName,a.collectionPointForm.checkedRows.id=d.tagId}else return(s=window.$message)==null||s.destroyAll(),(i=window.$message)==null||i.warning("暂无通道，请您先创建通道在进行查询"),!1}async function re(){const{data:s,error:i}=await Fe({chlId:U.chlid});i||(a.collectionPointForm.functionList=JSON.parse(s).data,a.collectionPointForm.visible=!0,M())}function P(){a.collectionPointForm.visible=!1}function ge(s,i,b){console.log(i),a.collectionPointForm.checkedRows=i[0]}function be(){var s,i;if(ae.value.length===0)return(s=window.$message)==null||s.destroyAll(),(i=window.$message)==null||i.warning("请您先选择采集点"),!1;d.tagName=a.collectionPointForm.checkedRows.tagName,d.tagId=a.collectionPointForm.checkedRows.id,d.tagDesc||(d.tagDesc=a.collectionPointForm.checkedRows.tagDesc),a.collectionPointForm.visible=!1}return(s,i)=>{const b=je,h=Ge,r=fe,o=V,p=Me,c=fe,q=Ve,R=Je,E=Oe,K=V,ce=Ae,G=Be,ue=We,J=ot("no-space");return Z(),ke(Ke,null,[e(G,{show:m.value,"onUpdate:show":i[10]||(i[10]=u=>m.value=u),title:Y.value,preset:"card",class:"w-50%"},{footer:l(()=>[e(ce,{size:16,justify:"center"},{default:l(()=>[e(K,{onClick:x,class:"w-100px"},{default:l(()=>[_(A(t(I)("common.cancel")),1)]),_:1}),e(K,{type:"primary",class:"w-100px",onClick:S},{default:l(()=>[_(A(t(I)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(E,{ref_key:"formRef",ref:ee,model:d,rules:C,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:l(()=>[e(R,{responsive:"screen","item-responsive":""},{default:l(()=>[e(h,{span:"24 m:12",label:"所属设备",path:"belongingChannel"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择所属设备",value:d.devId,"onUpdate:value":i[0]||(i[0]=u=>d.devId=u),"value-field":"id",options:a.deveicelList},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:l(()=>[e(p,null,{default:l(()=>[e(r,{value:d.tagName,"onUpdate:value":i[1]||(i[1]=u=>d.tagName=u),style:{width:"80%"},readonly:""},null,8,["value"]),e(o,{type:"primary",ghost:"",onClick:de},{default:l(()=>[_("请选择")]),_:1})]),_:1})]),_:1}),e(h,{span:"24 m:12",label:"物模型标识(测点描述)",path:"tagDesc"},{label:l(()=>[Ut]),default:l(()=>[e(c,{clearable:"",value:d.tagDesc,"onUpdate:value":i[2]||(i[2]=u=>d.tagDesc=u),placeholder:"请输入物模型标识(测点描述)"},null,8,["value"])]),_:1}),e(h,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:l(()=>[e(c,{clearable:"",value:d.tagUnit,"onUpdate:value":i[3]||(i[3]=u=>d.tagUnit=u),placeholder:"请输入单位"},null,8,["value"])]),_:1}),e(h,{span:"24 m:12",label:"测点类型",path:"dataType"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择测点类型",value:d.tagType,"onUpdate:value":i[4]||(i[4]=u=>d.tagType=u),options:t(H)(t(pe))},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:l(()=>[e(q,{clearable:"",value:d.tagK,"onUpdate:value":i[5]||(i[5]=u=>d.tagK=u),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(h,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择转发功能码",value:d.collectType,"onUpdate:value":i[6]||(i[6]=u=>d.collectType=u),options:a.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:l(()=>[e(c,{clearable:"",value:d.objAddr,"onUpdate:value":i[7]||(i[7]=u=>d.objAddr=u),placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(h,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择数据类型",value:d.dataType,"onUpdate:value":[i[8]||(i[8]=u=>d.dataType=u),w],options:t(H)(t(st))},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择数据格式",value:d.dataFormat,"onUpdate:value":i[9]||(i[9]=u=>d.dataFormat=u),options:a.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(G,{show:a.collectionPointForm.visible,"onUpdate:show":i[17]||(i[17]=u=>a.collectionPointForm.visible=u),title:"选择采集点",preset:"card",class:"w-60%"},{footer:l(()=>[e(ce,{size:16,justify:"end"},{default:l(()=>[e(K,{onClick:P},{default:l(()=>[_(A(t(I)("common.cancel")),1)]),_:1}),e(K,{type:"primary",onClick:be},{default:l(()=>[_(A(t(I)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(E,{model:a.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:l(()=>[e(R,{responsive:"screen","item-responsive":""},{default:l(()=>[e(h,{span:"24 m:12",label:"所属通道"},{default:l(()=>[e(b,{filterable:"",placeholder:"请选择所属通道",value:t(U).chlid,"onUpdate:value":i[11]||(i[11]=u=>t(U).chlid=u),options:a.collectionPointForm.channelList,onUpdateValue:ve},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"所属设备"},{default:l(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择所属设备",value:t(U).devId,"onUpdate:value":i[12]||(i[12]=u=>t(U).devId=u),"label-field":"devName","value-field":"id",options:a.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"测点类型"},{default:l(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(U).tagType,"onUpdate:value":i[13]||(i[13]=u=>t(U).tagType=u),options:t(H)(t(pe))},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"测点功能码"},{default:l(()=>[e(b,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:t(U).collectType,"onUpdate:value":i[14]||(i[14]=u=>t(U).collectType=u),options:a.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(h,{span:"24 m:12",label:"测点名称"},{default:l(()=>[it(e(c,{clearable:"",value:t(U).fuzzy,"onUpdate:value":i[15]||(i[15]=u=>t(U).fuzzy=u),placeholder:"请输入测点名称"},null,8,["value"]),[[J]])]),_:1}),e(h,{span:"24 m:12",label:" "},{default:l(()=>[e(K,{onClick:Ne},{default:l(()=>[_(A(t(I)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(ue,{"checked-row-keys":t(ae),"onUpdate:checkedRowKeys":[i[16]||(i[16]=u=>ye(ae)?ae.value=u:null),ge],columns:t(ne),data:t(O),size:"small","max-height":500,loading:t(T),remote:"","row-key":u=>u.id,pagination:t(F)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1},8,["show"])],64)}}}),At=me("span",null,[_("物模型标识"),me("br"),_("(测点描述)")],-1),xt={class:"flex"},St=Ue({__name:"add_multipe_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:_e(["submitted"],["update:visible"]),setup(L,{emit:Q}){const a=we({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:[],dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),m=ze(L,"visible"),W=Q,n=we(d());function d(){return{chlId:void 0,devId:void 0,tagDevId:"",tagName:"",tagNames:"",tagId:"",tagDesc:"",tagDescs:"",tagUnit:"",tagType:0,tagK:1,objAddr:"0",collectType:1,dataType:4,dataFormat:0}}async function X(){var p,c;const{data:r,error:o}=await Pe({type:1});if(!o){const q=[];r.forEach(R=>{R.devicePojoList&&R.devicePojoList.length>0&&R.devicePojoList.forEach(E=>{q.push({label:`${E.devName}`,value:`${E.id}_${R.id}`})})}),a.deveicelList=q,n.tagDevId=a.deveicelList[0].value,n.devId=Number((p=n.tagDevId)==null?void 0:p.split("_")[0]),n.chlId=Number((c=n.tagDevId)==null?void 0:c.split("_")[1]),n.collectType=void 0,y()}}async function y(){const{data:r,error:o}=await Fe({chlId:n.chlId});o||(a.functionList=JSON.parse(r).data,n.collectType=a.functionList[0].FuncCode)}function D(){Object.assign(n,d()),X(),a.collectionPointForm.checkedRows=[],P.value=[]}const{formRef:$,validate:ee,restoreValidation:k}=Re();$e(m,()=>{m.value&&(D(),k())});const te=()=>{m.value=!1};function x(r,o){console.log(r),r==0||r==1||r==2||r==3||r==4||r==7?a.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:r==5||r==6||r==8||r==9||r==10||r==12||r==13?a.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:a.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],a.collectionPointForm.dataFormatList.find(p=>p.value===n.dataFormat)||(n.dataFormat=a.collectionPointForm.dataFormatList[0].value)}const w=async()=>{var E,K;await ee();let r=n.tagNames.split(","),o=(E=n.tagDescs)==null?void 0:E.split(","),p=(K=n.tagId)==null?void 0:K.split(","),c=[];delete n.tagNames,delete n.tagDescs,delete n.tagId,r.forEach((ce,G)=>{var J,u;let ue={...n,tagName:ce,tagDesc:n.tagDesc?n.tagDesc:o[G],tagId:Number(p[G]),objAddr:n.objAddr?+n.objAddr+G:G+"",devId:Number((J=n.tagDevId)==null?void 0:J.split("_")[0]),chlId:Number((u=n.tagDevId)==null?void 0:u.split("_")[1])};c.push(ue)});const{data:q,error:R}=await dt(c);R||(te(),W("submitted"))},S={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},j={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},z={tagDevId:S,tagName:S,tagDesc:[{trigger:["input","blur"],validator:(r,o)=>!/\$/.test(o),message:"不能含有非法字符"},{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]}],tagK:j,objAddr:S,collectType:j,dataType:j,dataFormat:j},C=at(()=>({add:"批量新增",edit:I("common.edit")}).add),{columns:Y,columnChecks:ne,data:le,getData:O,loading:M,mobilePagination:T,searchParams:F,resetSearchParams:U}=qe({apiFn:nt,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140,render:r=>{var o;return e("span",null,[((o=pe.find(p=>p.value===r.tagType))==null?void 0:o.label)||""])}},{key:"belongingEquipment",title:"所属设备",align:"center",width:140,render:r=>{var o;return e("span",null,[((o=a.collectionPointForm.deveicelList.find(p=>p.id===r.devId))==null?void 0:o.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),Te=()=>{O()},{drawerVisible:Ne,operateType:g,editingData:f,handleAdd:N,handleEdit:oe,checkedRowKeys:B,onBatchDeleted:ae,onDeleted:xe}=Ee(le,O);async function ie(){const{data:r,error:o}=await Pe();o||(console.log("data",r),r.length>0&&(a.collectionPointForm.channelList=r.filter(p=>p.chlType!==1).map(p=>({label:p.chlName,value:p.id,devicePojoList:p.devicePojoList||[]}))))}const se=r=>{var p;F.chlid=r,F.devId=null;let o=(p=a.collectionPointForm.channelList.find(c=>c.value==r))==null?void 0:p.devicePojoList;a.collectionPointForm.deveicelList=o,de(),O()};ie();function ve(){var r,o;if(B.value=P.value.map(p=>p.id),a.collectionPointForm.channelList.length>0)if(F.chlid)a.collectionPointForm.visible=!0;else{let p=a.collectionPointForm.channelList[0];F.chlid=p.value,a.collectionPointForm.deveicelList=p.devicePojoList,de()}else return(r=window.$message)==null||r.destroyAll(),(o=window.$message)==null||o.warning("暂无通道，请您先创建通道在进行查询"),!1}async function de(){const{data:r,error:o}=await Fe({chlId:F.chlid});o||(a.collectionPointForm.functionList=JSON.parse(r).data,a.collectionPointForm.visible=!0,O())}function re(){a.collectionPointForm.visible=!1}const P=Ie([]),ge=[{title(){return e("div",{class:"flex"},[e("span",{class:"flex-1"},[`已选${P.value.length}个`]),e("span",{class:"c-red cursor-pointer",onClick:i},[_("清空")])])},align:"center",render:r=>{var o;return e("span",null,[r.tagName,_("--"),(o=a.collectionPointForm.channelList.find(p=>p.value==r.chlId))==null?void 0:o.label])}}];function be(r,o,p){console.log(o),o=o.filter(c=>c!=null),F.devId&&(P.value=P.value.filter(c=>c.devId!=F.devId||c.page!=F.page)),F.chlid&&(P.value=P.value.filter(c=>c.chlId!=F.chlid||c.page!=F.page)),P.value.push(...o.filter(c=>c!=null)),P.value=[...new Set(P.value)],P.value.forEach(c=>{c.page=c.page?c.page:F.page})}function s(){var r,o,p,c,q;if(a.collectionPointForm.checkedRows=B.value,n.tagNames="",n.tagDescs="",n.tagId="",B.value.length===0)return(r=window.$message)==null||r.destroyAll(),(o=window.$message)==null||o.warning("请您先选择采集点"),!1;P.value.forEach(R=>{n.tagNames+=R.tagName+",",n.tagDescs+=R.tagDesc+",",n.tagId+=R.id+","}),n.tagName=P.value[0].tagName,n.tagNames=(p=n.tagNames)==null?void 0:p.substring(0,n.tagNames.length-1),n.tagDescs=(c=n.tagDescs)==null?void 0:c.substring(0,n.tagDescs.length-1),n.tagId=(q=n.tagId)==null?void 0:q.substring(0,n.tagId.length-1),a.collectionPointForm.visible=!1}const i=()=>{P.value=[],B.value=[]},b=()=>{B.value=[]},h=()=>({style:{height:"40px"}});return(r,o)=>{const p=je,c=Ge,q=fe,R=V,E=Me,K=fe,ce=Ve,G=Je,ue=Oe,J=V,u=Ae,Xe=Be,Ye=We,rt=ot("no-space");return Z(),ke(Ke,null,[e(Xe,{show:m.value,"onUpdate:show":o[10]||(o[10]=v=>m.value=v),title:C.value,preset:"card",class:"w-50%"},{footer:l(()=>[e(u,{size:16,justify:"center"},{default:l(()=>[e(J,{onClick:te,class:"w-100px"},{default:l(()=>[_(A(t(I)("common.cancel")),1)]),_:1}),e(J,{type:"primary",class:"w-100px",onClick:w},{default:l(()=>[_(A(t(I)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(ue,{ref_key:"formRef",ref:$,model:n,rules:z,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:l(()=>[e(G,{responsive:"screen","item-responsive":""},{default:l(()=>[e(c,{span:"24 m:12",label:"所属设备",path:"tagDevId"},{default:l(()=>[e(p,{filterable:"",placeholder:"请选择所属设备",value:n.tagDevId,"onUpdate:value":o[0]||(o[0]=v=>n.tagDevId=v),options:a.deveicelList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:l(()=>[e(E,{style:{width:"100%"}},{default:l(()=>[e(q,{value:n.tagName,"onUpdate:value":o[1]||(o[1]=v=>n.tagName=v),readonly:""},null,8,["value"]),e(R,{type:"primary",ghost:"",onClick:ve},{default:l(()=>[_(A(a.collectionPointForm.checkedRows.length>1?`+${a.collectionPointForm.checkedRows.length}`:"请选择"),1)]),_:1})]),_:1})]),_:1}),e(c,{span:"24 m:12",label:"物模型标识(测点描述)",path:"tagDesc"},{label:l(()=>[At]),default:l(()=>[e(K,{clearable:"",value:n.tagDesc,"onUpdate:value":o[2]||(o[2]=v=>n.tagDesc=v),placeholder:"请输入物模型标识(测点描述)"},null,8,["value"])]),_:1}),e(c,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:l(()=>[e(K,{clearable:"",value:n.tagUnit,"onUpdate:value":o[3]||(o[3]=v=>n.tagUnit=v),placeholder:"请输入单位"},null,8,["value"])]),_:1}),e(c,{span:"24 m:12",label:"测点类型",path:"dataType"},{default:l(()=>[e(p,{filterable:"",placeholder:"请选择测点类型",value:n.tagType,"onUpdate:value":o[4]||(o[4]=v=>n.tagType=v),options:t(H)(t(pe))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:l(()=>[e(ce,{clearable:"",value:n.tagK,"onUpdate:value":o[5]||(o[5]=v=>n.tagK=v),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(c,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:l(()=>[e(p,{filterable:"",placeholder:"请选择转发功能码",value:n.collectType,"onUpdate:value":o[6]||(o[6]=v=>n.collectType=v),options:a.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:l(()=>[e(K,{clearable:"",value:n.objAddr,"onUpdate:value":o[7]||(o[7]=v=>n.objAddr=v),placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(c,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:l(()=>[e(p,{filterable:"",placeholder:"请选择数据类型",value:n.dataType,"onUpdate:value":[o[8]||(o[8]=v=>n.dataType=v),x],options:t(H)(t(st))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:l(()=>[e(p,{filterable:"",placeholder:"请选择数据格式",value:n.dataFormat,"onUpdate:value":o[9]||(o[9]=v=>n.dataFormat=v),options:a.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(Xe,{show:a.collectionPointForm.visible,"onUpdate:show":o[17]||(o[17]=v=>a.collectionPointForm.visible=v),title:"选择采集点",preset:"card",class:"w-65%",onAfterLeave:b},{footer:l(()=>[e(u,{size:16,justify:"end"},{default:l(()=>[e(J,{onClick:re},{default:l(()=>[_(A(t(I)("common.cancel")),1)]),_:1}),e(J,{type:"primary",onClick:s},{default:l(()=>[_(A(t(I)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(ue,{model:a.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:l(()=>[e(G,{responsive:"screen","item-responsive":""},{default:l(()=>[e(c,{span:"24 m:12",label:"所属通道"},{default:l(()=>[e(p,{filterable:"",placeholder:"请选择所属通道",value:t(F).chlid,"onUpdate:value":o[11]||(o[11]=v=>t(F).chlid=v),options:a.collectionPointForm.channelList,onUpdateValue:se},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"所属设备"},{default:l(()=>[e(p,{filterable:"",clearable:"",placeholder:"请选择所属设备","label-field":"devName","value-field":"id",value:t(F).devId,"onUpdate:value":o[12]||(o[12]=v=>t(F).devId=v),options:a.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点类型"},{default:l(()=>[e(p,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(F).tagType,"onUpdate:value":o[13]||(o[13]=v=>t(F).tagType=v),options:t(H)(t(pe))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点功能码"},{default:l(()=>[e(p,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:t(F).collectType,"onUpdate:value":o[14]||(o[14]=v=>t(F).collectType=v),options:a.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点名称"},{default:l(()=>[it(e(K,{clearable:"",value:t(F).fuzzy,"onUpdate:value":o[15]||(o[15]=v=>t(F).fuzzy=v),placeholder:"请输入测点名称"},null,8,["value"]),[[rt]])]),_:1}),e(c,{span:"24 m:12",label:" "},{default:l(()=>[e(J,{onClick:Te},{default:l(()=>[_(A(t(I)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),me("div",xt,[e(Ye,{"checked-row-keys":t(B),"onUpdate:checkedRowKeys":[o[16]||(o[16]=v=>ye(B)?B.value=v:null),be],columns:t(Y),data:t(le),size:"small","max-height":500,loading:t(M),remote:"","row-key":v=>v.id,pagination:t(T),class:"flex-1","row-props":h},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Ye,{columns:ge,data:P.value,size:"small","max-height":540,loading:t(M),remote:"","row-key":v=>v.id,class:"w-20% ml-10px","row-props":h},null,8,["data","loading","row-key"])])]),_:1},8,["show"])],64)}}}),zt=Ue({__name:"batchEdit_model",props:_e({checkedRowKeys:{type:Array,default:[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:_e(["submitted"],["update:visible"]),setup(L,{emit:Q}){const a=L,m=ze(L,"visible");$e(()=>m.value,x=>{y.value={editType:0,editMode:0,startV:"0",step:"1",tagK:0}});const W=Q,{formRef:n,validate:d,restoreValidation:X}=Re(),y=Ie({editType:0,editMode:0,startV:"0",step:"1",tagK:0}),D=async()=>{var x,w;if(await d(),y.value.editType==0){console.log(a.checkedRowKeys);let S=[];a.checkedRowKeys.forEach((C,Y)=>{S.push({id:C,objAddr:+y.value.startV+Y*+y.value.step+""})});const{data:j,error:z}=await Se(S);z||(m.value=!1,(x=window.$message)==null||x.success("批量修改成功"),W("submitted"))}else if(y.value.editType==1){let S=[];a.checkedRowKeys.forEach((C,Y)=>{S.push({id:C,tagK:y.value.tagK})});const{data:j,error:z}=await Se(S);z||(m.value=!1,(w=window.$message)==null||w.success("批量修改成功"),W("submitted"))}},$={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},ee={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},k={editType:$,editMode:$,startV:ee,step:ee},te=Ie(!1);return(x,w)=>{const S=je,j=Ge,z=fe,C=Ve,Y=Je,ne=Oe,le=V,O=Ae,M=Be;return Z(),ke(Ke,null,[e(M,{show:m.value,"onUpdate:show":w[6]||(w[6]=T=>m.value=T),title:"批量修改",preset:"card",class:"w-40%"},{footer:l(()=>[e(O,{size:16,justify:"center"},{default:l(()=>[e(le,{onClick:w[5]||(w[5]=T=>m.value=!1),class:"w-100px"},{default:l(()=>[_(A(x.$t("common.cancel")),1)]),_:1}),e(le,{type:"primary",class:"w-100px",onClick:D},{default:l(()=>[_(A(x.$t("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(ne,{ref_key:"formRef",ref:n,"label-width":120,"label-placement":"left",model:y.value,rules:k},{default:l(()=>[e(Y,{responsive:"screen","item-responsive":""},{default:l(()=>[e(j,{span:"24 m:12",label:"修改类型",path:"editType"},{default:l(()=>[e(S,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editType,"onUpdate:value":w[0]||(w[0]=T=>y.value.editType=T),options:t(H)(t(Ze)({0:"寄存器地址",1:"系数K"}))},null,8,["value","options"])]),_:1}),y.value.editType==0?(Z(),Le(j,{key:0,span:"24 m:12",label:"修改步长",path:"editMode"},{default:l(()=>[e(S,{filterable:"",clearable:"",placeholder:"请选择",value:y.value.editMode,"onUpdate:value":w[1]||(w[1]=T=>y.value.editMode=T),options:t(H)(t(Ze)({0:"步长"}))},null,8,["value","options"])]),_:1})):De("",!0),y.value.editType==0?(Z(),Le(j,{key:1,span:"24 m:12",label:"起始值",path:"startV"},{default:l(()=>[e(z,{clearable:"",value:y.value.startV,"onUpdate:value":w[2]||(w[2]=T=>y.value.startV=T),placeholder:"请输入起始值"},null,8,["value"])]),_:1})):De("",!0),y.value.editType==0?(Z(),Le(j,{key:2,span:"24 m:12",label:"步长",path:"step"},{default:l(()=>[e(z,{clearable:"",value:y.value.step,"onUpdate:value":w[3]||(w[3]=T=>y.value.step=T),placeholder:"请输入步长"},null,8,["value"])]),_:1})):De("",!0),y.value.editType==1?(Z(),Le(j,{key:3,span:"24 m:12",label:"修改的值",path:"step"},{default:l(()=>[e(C,{clearable:"",value:y.value.tagK,"onUpdate:value":w[4]||(w[4]=T=>y.value.tagK=T),placeholder:"请输入修改的值"},null,8,["value"])]),_:1})):De("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(M,{show:te.value,"onUpdate:show":w[7]||(w[7]=T=>te.value=T),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),Rt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function lt(L){return typeof L=="function"||Object.prototype.toString.call(L)==="[object Object]"&&!yt(L)}const Qt=Ue({name:"configsetting_forwardingservice_forwardingpointmanagement",__name:"index",setup(L){const Q=vt(),a=gt(),m=we({channelList:[],channelAndDevObj:{},deveicelList:[],transFunctionOptions:[],addMultipeModelVisible:!1});async function W(){const{data:g,error:f}=await Pe({type:1});f||(m.channelList=g,m.channelList.forEach(N=>{m.channelAndDevObj[N.id]=N.devicePojoList}),m.channelList.length>0&&(k.chlid=m.channelList[0].id,k.chlid&&(m.deveicelList=m.channelAndDevObj[k.chlid]),n(),D()),m.deveicelList=m.channelAndDevObj[k.chlid])}async function n(){const{data:g,error:f}=await Fe({chlId:k.chlid});f||(m.transFunctionOptions=JSON.parse(g).data)}const{columns:d,columnChecks:X,data:y,getData:D,loading:$,mobilePagination:ee,searchParams:k,resetSearchParams:te}=qe({apiFn:Nt,apiParams:{page:1,pageSize:200,limit:200,chlid:null,devId:null,tagType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"测点ID",align:"center",width:80},{key:"tagName",title:"测点名称",align:"center",minWidth:100},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",minWidth:140},{key:"tagType",title:"测点类型",align:"center",width:140,render:g=>e("span",null,[kt[g.tagType]||""])},{key:"devName",title:"所属设备",align:"center",width:140,render:g=>{var f,N;return e("span",null,[((N=(f=m.deveicelList)==null?void 0:f.find(oe=>oe.id===g.devId))==null?void 0:N.devName)||""])}},{key:"collectname",title:"转发功能码",align:"center",width:140,render:g=>{var f;return e("span",null,[(f=g.collectname)==null?void 0:f.replace(/\(.*?\)/g,"")])}},{key:"dataType",title:"数据类型",align:"center",width:140,render:g=>e("span",null,[g.dataType?He[Number(g.dataType)]:He[0]])},{key:"dataFormat",title:"数据格式",align:"center",width:140,render:g=>e("span",null,[g.dataType?Qe[Number(g.dataFormat)]:Qe[0]])},{key:"tagK",title:"系数K",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140},{key:"operate",title:I("common.operate"),align:"center",width:140,fixed:"right",render:g=>{let f;return e("div",{class:"flex-center gap-8px"},[e(V,{type:"primary",ghost:!0,size:"small",onClick:()=>O(g.id)},lt(f=I("common.edit"))?f:{default:()=>[f]}),e(et,{onPositiveClick:()=>le(g.id)},{default:()=>I("common.confirmDelete"),trigger:()=>{let N;return e(V,{type:"error",ghost:!0,size:"small"},lt(N=I("common.delete"))?N:{default:()=>[N]})}})])}}]});bt(()=>{const g=a.currentRoute.value.query.channelId;k.chlid=Number(g)*1||null,W();const f=a.currentRoute.value.query.deviceId;k.devId=Number(f)*1||null});const{drawerVisible:x,operateType:w,editingData:S,handleAdd:j,handleEdit:z,checkedRowKeys:C,onBatchDeleted:Y,onDeleted:ne}=Ee(y,D),le=async g=>{const{data:f,error:N}=await tt({ids:g});N||ne()},O=g=>{z(g)},M=g=>{g===""&&D()},T=Ie(!1),F=()=>{T.value=!0};function U(g,f){var N;g&&(k.chlid=Number(g),k.devId=null,k.collectType=void 0,m.deveicelList=m.channelAndDevObj[g],(!m.deveicelList||m.deveicelList.length==0)&&((N=window.$message)==null||N.warning("该通道下无设备! 请选择其他通道")),n(),D())}function Te(){m.addMultipeModelVisible=!0}const Ne=async()=>{const g=C.value.join(","),{data:f,error:N}=await tt({ids:g});N||ne(),C.value=[]};return(g,f)=>{const N=Tt,oe=je,B=fe,ae=Ft,xe=Me,ie=Ae,se=_t,ve=wt,de=Ct,re=pt,P=ut,ge=ct,be=We;return Z(),ke("div",Rt,[e(se,{bordered:!1,size:"small"},{default:l(()=>[e(ie,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:l(()=>[e(xe,null,{default:l(()=>[e(N,null,{default:l(()=>[_("所属通道")]),_:1}),e(oe,{filterable:"",placeholder:"请选择通道",value:t(k).chlid,"onUpdate:value":f[0]||(f[0]=s=>t(k).chlid=s),"label-field":"chlName","value-field":"id",options:m.channelList,onUpdateValue:U},null,8,["value","options"]),e(N,null,{default:l(()=>[_("所属设备")]),_:1}),e(oe,{filterable:"",clearable:"",placeholder:"请选择设备",value:t(k).devId,"onUpdate:value":[f[1]||(f[1]=s=>t(k).devId=s),t(D)],"label-field":"devName","value-field":"id",options:m.deveicelList},null,8,["value","options","onUpdate:value"]),e(N,null,{default:l(()=>[_("测点类型")]),_:1}),e(oe,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:t(k).tagType,"onUpdate:value":[f[2]||(f[2]=s=>t(k).tagType=s),t(D)],style:{width:"80%"},options:t(H)(t(pe))},null,8,["value","options","onUpdate:value"]),e(B,{clearable:"",value:t(k).fuzzy,"onUpdate:value":[f[3]||(f[3]=s=>t(k).fuzzy=s),M],placeholder:"请输入测点名称或描述",style:{width:"100%"},onKeyup:ht(t(D),["enter"])},null,8,["value","onKeyup"]),e(t(V),{type:"primary",ghost:"",onClick:t(D)},{icon:l(()=>[e(ae,{class:he(["text-icon",{"animate-spin":t($)}])},null,8,["class"])]),default:l(()=>[_(" "+A(t(I)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(se,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:l(()=>[e(ie,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"})]),"header-extra":l(()=>[e(ie,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[e(t(V),{onClick:Te,size:"small",ghost:"",type:"primary"},{icon:l(()=>[e(ve,{class:he(["text-icon",{"animate-spin":t($)}])},null,8,["class"])]),default:l(()=>[_(" "+A("批量新增"))]),_:1}),e(t(V),{onClick:F,size:"small",ghost:"",type:"primary",disabled:!t(C).length},{icon:l(()=>[e(de,{class:he(["text-icon",{"animate-spin":t($)}])},null,8,["class"])]),default:l(()=>[_(" "+A("批量修改"))]),_:1},8,["disabled"]),e(t(et),{onPositiveClick:Ne},{trigger:l(()=>[e(t(V),{size:"small",ghost:"",type:"error",disabled:t(C).length==0},{icon:l(()=>[e(re,{class:he(["text-icon",{"animate-spin":t($)}])},null,8,["class"])]),default:l(()=>[_(" "+A(t(I)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:l(()=>[_(" 确认删除选中的项吗？ ")]),_:1}),e(t(V),{onClick:t(D),size:"small",ghost:"",type:"primary"},{icon:l(()=>[e(P,{class:he(["text-icon",{"animate-spin":t($)}])},null,8,["class"])]),_:1},8,["onClick"]),e(ge,{columns:t(X),"onUpdate:columns":f[4]||(f[4]=s=>ye(X)?X.value=s:null)},null,8,["columns"])]),_:1})]),default:l(()=>[e(be,{"checked-row-keys":t(C),"onUpdate:checkedRowKeys":f[5]||(f[5]=s=>ye(C)?C.value=s:null),columns:t(d),data:t(y),size:"small",class:"sm:h-full","flex-height":!t(Q).isMobile,loading:t($),remote:"","row-key":s=>s.id,pagination:t(ee)},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(jt,{visible:t(x),"onUpdate:visible":f[6]||(f[6]=s=>ye(x)?x.value=s:null),onSubmitted:t(D),"operate-type":t(w),"row-data":t(S)},null,8,["visible","onSubmitted","operate-type","row-data"]),e(St,{visible:m.addMultipeModelVisible,"onUpdate:visible":f[7]||(f[7]=s=>m.addMultipeModelVisible=s),onSubmitted:t(D)},null,8,["visible","onSubmitted"]),e(zt,{visible:T.value,"onUpdate:visible":f[8]||(f[8]=s=>T.value=s),onSubmitted:t(D),checkedRowKeys:t(C)},null,8,["visible","onSubmitted","checkedRowKeys"])]),_:1})])}}});export{Qt as default};
