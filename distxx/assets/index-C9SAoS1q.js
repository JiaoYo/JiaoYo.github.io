import{_ as be}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CQ0a8Mvb.js";import{_ as he}from"./round-refresh-BeE5HiEb.js";import{_ as ye}from"./round-add-DaZ8zWuN.js";import{_ as we}from"./round-search-BVUrvYAd.js";import{d as X,Z as J,i as T,a0 as ne,r as ee,p as Ne,q as Ie,a2 as ie,ac as ke,a as De,$ as k,v as re,o as G,c as te,w as t,f as e,g as M,t as V,h as l,x as de,S as Ce,y as xe,e as Me,aF as Se,aG as qe,a4 as Z,A as ue,ag as $e,E as K,F as le,B as O,a6 as ae,ad as ce,a1 as pe,b as me,a3 as H,aq as Ue,a7 as Oe,aH as ze,aD as Ae,s as Te,aI as Ve,a8 as Q,a9 as W,aa as Be,ab as Ee,X as Re}from"./index-CGiaWMMy.js";import{u as Pe,a as Fe}from"./table-CZOSmR4C.js";import{_ as oe}from"./FormItemGridItem-BUpS4xty.js";import{_ as je,a as Le}from"./RadioGroup-CerJ-tsr.js";import{_ as se}from"./Grid-wJzQLXId.js";import{y as Ge}from"./common-DrCS2Ulo.js";import{N as Ke}from"./Popconfirm-Dnp__lUp.js";import{_ as Je}from"./InputGroupLabel-Q82hfWjl.js";import{_ as He}from"./DataTable-g-OZy44s.js";import"./Forward-BA3X35TR.js";const Xe=Me("span",null,"批量新增：格式为（转发设备1-10）",-1),Ze=X({__name:"add_model",props:J({operateType:{},rowData:{},chlId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(y,{emit:P}){const D=T(!1),g=ne(y,"visible"),_=P,u=y,n=ee(w());function w(){return{devName:"转发设备1",chlId:void 0,devCommAddr:"1",devPubAddr:"1",devValid:1,devDesc:"",reserve0:"",reserve1:""}}const B=ee({channelList:[]});async function b(){const{data:d,error:i}=await ce({type:1});i||(B.channelList=d)}async function S(){await b(),u.operateType==="edit"&&u.rowData?Object.assign(n,u.rowData):(Object.assign(n,w()),n.chlId=u.chlId||B.channelList[0].id)}const{formRef:p,validate:r,restoreValidation:q}=Ne();Ie(),ie(()=>u.rowData,()=>{S()}),ie(g,()=>{g.value&&(u.operateType==="add"&&ke(()=>{setTimeout(()=>{D.value=!0},200)}),S(),q())});const N=()=>{g.value=!1,D.value=!1},z=async()=>{var d;if(await r(),u.operateType==="add"){let i=[],f=n.devName;if(((d=n.devName)==null?void 0:d.indexOf("-"))!=-1){let j=Math.abs(f==null?void 0:f.substring(f.lastIndexOf("-")).replace(/[^0-9]/gi,"")),o=f.split(/-(?![^-]*-)/),a=f.substring(0,f.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],s=a.replace(/[^0]/g,""),A=a,E=o[0],I=E.substring(0,E.length-E.match(/(\d+)[^0-9]*$/)[1].length),L=j-a+1;for(let R=0;R<L;R++){let v=A++,c=JSON.parse(JSON.stringify(n));c.devName=parseInt(a)==0?s.length>0?String(v).length>=s.length?I+v:I+s.substring(0,s.length-String(v).length)+v:I+v:s.length>0?v>=10?I+s.substring(0,s.length-String(v).length+1)+v:I+s.substring(0,s.length)+v:I+v,i.push(c)}}else i=[n];const{data:x,error:U}=await Se(i);U?console.log("error",U):(console.log("success",x),N(),_("submitted"))}else{const{data:i,error:f}=await qe([n]);f?console.log("error",f):(console.log("success",i),N(),_("submitted"))}},C={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},F={devName:C,chlId:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},devCommAddr:C,devPubAddr:C},h=De(()=>({add:k("common.add"),edit:k("common.edit")})[u.operateType]);return(d,i)=>{const f=Z,x=oe,U=ue,j=$e,o=je,a=K,s=Le,A=se,E=le,I=O,L=K,R=ae,v=re("no-space");return G(),te(R,{show:g.value,"onUpdate:show":i[5]||(i[5]=c=>g.value=c),title:h.value,preset:"card",class:"w-30%",onAfterLeave:N},{footer:t(()=>[e(L,{size:16,justify:"center"},{default:t(()=>[e(I,{onClick:N,class:"w-100px"},{default:t(()=>[M(V(l(k)("common.cancel")),1)]),_:1}),e(I,{type:"primary",class:"w-100px",onClick:z},{default:t(()=>[M(V(l(k)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(E,{ref_key:"formRef",ref:p,model:n,rules:F,"label-placement":"left","label-width":100,"require-mark-placement":"left",onKeyup:xe(z,["enter"])},{default:t(()=>[e(A,{responsive:"screen","item-responsive":""},{default:t(()=>[e(x,{span:"24 m:24",label:"所属通道",path:"chlId"},{default:t(()=>[e(f,{filterable:"",placeholder:"请选择所属通道",value:n.chlId,"onUpdate:value":i[0]||(i[0]=c=>n.chlId=c),"label-field":"chlName","value-field":"id",options:B.channelList},null,8,["value","options"])]),_:1}),e(x,{span:"24 m:24",label:"设备名称",path:"devName"},{default:t(()=>[e(j,{show:D.value,placement:"right-start"},{trigger:t(()=>[de(e(U,{clearable:"",value:n.devName,"onUpdate:value":i[1]||(i[1]=c=>n.devName=c),placeholder:"请输入设备名称"},null,8,["value"]),[[v]])]),default:t(()=>[Xe]),_:1},8,["show"])]),_:1}),e(x,{span:"24 m:24",label:"通讯地址",path:"devCommAddr"},{default:t(()=>[e(U,{clearable:"",value:n.devCommAddr,"onUpdate:value":i[2]||(i[2]=c=>n.devCommAddr=c),placeholder:"请输入通讯地址"},null,8,["value"])]),_:1}),u.operateType=="edit"?(G(),te(x,{key:0,span:"24 m:24",label:"设备有效性",path:"devValid"},{default:t(()=>[e(s,{value:n.devValid,"onUpdate:value":i[3]||(i[3]=c=>n.devValid=c),name:"radiogroup"},{default:t(()=>[e(a,null,{default:t(()=>[e(o,{label:"是",value:1}),e(o,{label:"否",value:0})]),_:1})]),_:1},8,["value"])]),_:1})):Ce("",!0),e(x,{span:"24 m:24",label:"设备描述",path:"devDesc"},{default:t(()=>[e(U,{clearable:"",value:n.devDesc,"onUpdate:value":i[4]||(i[4]=c=>n.devDesc=c),placeholder:"请输入设备描述",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Qe=X({__name:"merge_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:J(["submitted"],["update:visible"]),setup(y,{emit:P}){const g=pe({0:"采集104tcp",1:"采集104udp"}),_=ne(y,"visible"),u=T(null),n=T({targetDevice:void 0,EquipmentMerged:void 0}),w=()=>{},b={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}},S=T(!1);return(p,r)=>{const q=Z,N=oe,z=se,C=le,$=O,F=K,h=ae;return G(),me(Ue,null,[e(h,{show:_.value,"onUpdate:show":r[3]||(r[3]=d=>_.value=d),title:"设备合并",preset:"card",class:"w-40%"},{footer:t(()=>[e(F,{size:16,justify:"center"},{default:t(()=>[e($,{onClick:r[2]||(r[2]=d=>_.value=!1),class:"w-100px"},{default:t(()=>[M(V(p.$t("common.cancel")),1)]),_:1}),e($,{type:"primary",class:"w-100px",onClick:w},{default:t(()=>[M(V(p.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(C,{ref_key:"formRef",ref:u,"label-width":120,"label-placement":"left",model:n.value,rules:b},{default:t(()=>[e(z,{responsive:"screen","item-responsive":""},{default:t(()=>[e(N,{span:"24 m:12",label:"目标设备",path:"targetDevice"},{default:t(()=>[e(q,{filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.targetDevice,"onUpdate:value":r[0]||(r[0]=d=>n.value.targetDevice=d),options:l(H)(l(g))},null,8,["value","options"])]),_:1}),e(N,{span:"24 m:12",label:"待合并设备",path:"EquipmentMerged"},{default:t(()=>[e(q,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.EquipmentMerged,"onUpdate:value":r[1]||(r[1]=d=>n.value.EquipmentMerged=d),options:l(H)(l(g))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(h,{show:S.value,"onUpdate:show":r[4]||(r[4]=d=>S.value=d),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),We=X({__name:"move_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:J(["submitted"],["update:visible"]),setup(y,{emit:P}){const g=pe({0:"采集104tcp",1:"采集104udp"}),_=ne(y,"visible"),u=T(null),n=T({targetDevice:void 0,EquipmentMerged:void 0}),w=()=>{},b={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}};return(S,p)=>{const r=Z,q=oe,N=se,z=le,C=O,$=K,F=ae;return G(),te(F,{show:_.value,"onUpdate:show":p[3]||(p[3]=h=>_.value=h),title:"设备移动至通道",preset:"card",class:"w-40%"},{footer:t(()=>[e($,{size:16,justify:"center"},{default:t(()=>[e(C,{onClick:p[2]||(p[2]=h=>_.value=!1),class:"w-100px"},{default:t(()=>[M(V(S.$t("common.cancel")),1)]),_:1}),e(C,{type:"primary",class:"w-100px",onClick:w},{default:t(()=>[M(V(S.$t("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(z,{ref_key:"formRef",ref:u,"label-width":120,"label-placement":"left",model:n.value,rules:b},{default:t(()=>[e(N,{responsive:"screen","item-responsive":""},{default:t(()=>[e(q,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:t(()=>[e(r,{filterable:"",clearable:"",placeholder:"请选择通道",value:n.value.targetDevice,"onUpdate:value":p[0]||(p[0]=h=>n.value.targetDevice=h),options:l(H)(l(g))},null,8,["value","options"])]),_:1}),e(q,{span:"24 m:12",label:"待移动设备",path:"EquipmentMerged"},{default:t(()=>[e(r,{multiple:"",filterable:"",clearable:"",placeholder:"请选择设备",value:n.value.EquipmentMerged,"onUpdate:value":p[1]||(p[1]=h=>n.value.EquipmentMerged=h),options:l(H)(l(g))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),Ye={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Y(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Be(y)}const _t=X({name:"configsetting_forwardingservice_forwardingdevicemanagement",__name:"index",setup(y){const P=Oe(),D=ee({channelList:[],chlIdAndNameMap:{}}),{columns:g,columnChecks:_,data:u,getData:n,loading:w,mobilePagination:B,searchParams:b,resetSearchParams:S}=Pe({apiFn:ze,apiParams:{page:1,pageSize:20,limit:20,type:1,chlId:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"设备ID",align:"center",width:60},{key:"devName",title:"设备名称",align:"center",width:100},{key:"chlId",title:"所属通道",align:"center",width:140,render:o=>e("span",null,[D.chlIdAndNameMap[o.chlId]])},{key:"devDesc",title:"设备描述",align:"center",width:140,render:o=>e("span",null,[o.devDesc?o.devDesc:"无"])},{key:"devCommAddr",title:"设备通信地址",align:"center",width:140},{key:"devPubAddr",title:"设备公共地址",align:"center",width:140},{key:"devValid",title:"有效性",align:"center",width:140,render:o=>{let a;return e(Ae,{type:o.devValid==0?"error":"success"},Y(a=k(Ge[o.devValid]))?a:{default:()=>[a]})}},{key:"operate",title:k("common.operate"),align:"center",width:240,fixed:"right",render:o=>{let a;return e("div",{class:"flex-center gap-8px"},[e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>j(o)},{default:()=>["转发测点管理"]}),e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>i(o.id)},Y(a=k("common.edit"))?a:{default:()=>[a]}),e(Ke,{onPositiveClick:()=>d(o.id)},{default:()=>k("common.confirmDelete"),trigger:()=>{let s;return e(O,{type:"error",ghost:!0,size:"small"},Y(s=k("common.delete"))?s:{default:()=>[s]})}})])}}]});async function p(){const{data:o,error:a}=await ce({type:1});if(!a){D.channelList=o,o.forEach(A=>{D.chlIdAndNameMap[A.id]=A.chlName});const s=P.currentRoute.value.query.channelId;s&&(b.chlId=Number(s)),n()}}Te(()=>{p()});const{drawerVisible:r,operateType:q,editingData:N,handleAdd:z,handleEdit:C,checkedRowKeys:$,onBatchDeleted:F,onDeleted:h}=Fe(u,n),d=async o=>{const{data:a,error:s}=await Ve({ids:o});s||h()},i=o=>{C(o)},f=o=>{b.chlId=o,n()},x=T(!1),U=T(!1),j=o=>{P.push({path:"/configsetting/forwardingservice/forwardingpointmanagement",query:{channelId:o.chlId,deviceId:o.id}})};return(o,a)=>{const s=Je,A=Z,E=ue,I=we,L=Ee,R=K,v=ye,c=he,_e=be,fe=He,ve=Re,ge=re("no-space");return G(),me("div",Ye,[e(ve,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(R,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[e(L,null,{default:t(()=>[e(s,null,{default:t(()=>[M("所属通道")]),_:1}),e(A,{filterable:"",clearable:"",placeholder:"请选择通道",value:l(b).chlId,"onUpdate:value":a[0]||(a[0]=m=>l(b).chlId=m),"label-field":"chlName","value-field":"id",options:D.channelList,onUpdateValue:f},null,8,["value","options"]),e(s,null,{default:t(()=>[M("设备名称")]),_:1}),de(e(E,{clearable:"",value:l(b).fuzzy,"onUpdate:value":a[1]||(a[1]=m=>l(b).fuzzy=m),placeholder:"请输入设备名称",style:{width:"100%"}},null,8,["value"]),[[ge]]),e(l(O),{type:"primary",ghost:"",onClick:l(n)},{icon:t(()=>[e(I,{class:Q(["text-icon",{"animate-spin":l(w)}])},null,8,["class"])]),default:t(()=>[M(" "+V(l(k)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":t(()=>[e(R,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[e(l(O),{onClick:l(z),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(v,{class:Q(["text-icon",{"animate-spin":l(w)}])},null,8,["class"])]),default:t(()=>[M(" "+V(l(k)("common.add")),1)]),_:1},8,["onClick"]),e(l(O),{onClick:l(n),size:"small",ghost:"",type:"primary"},{icon:t(()=>[e(c,{class:Q(["text-icon",{"animate-spin":l(w)}])},null,8,["class"])]),_:1},8,["onClick"]),e(_e,{columns:l(_),"onUpdate:columns":a[2]||(a[2]=m=>W(_)?_.value=m:null)},null,8,["columns"])]),_:1})]),default:t(()=>[e(fe,{"checked-row-keys":l($),"onUpdate:checkedRowKeys":a[3]||(a[3]=m=>W($)?$.value=m:null),columns:l(g),data:l(u),size:"small",loading:l(w),remote:"","row-key":m=>m.id,pagination:l(B),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Ze,{visible:l(r),"onUpdate:visible":a[4]||(a[4]=m=>W(r)?r.value=m:null),onSubmitted:l(n),"operate-type":l(q),"row-data":l(N),chlId:l(b).chlId},null,8,["visible","onSubmitted","operate-type","row-data","chlId"]),e(Qe,{visible:x.value,"onUpdate:visible":a[5]||(a[5]=m=>x.value=m)},null,8,["visible"]),e(We,{visible:U.value,"onUpdate:visible":a[6]||(a[6]=m=>U.value=m)},null,8,["visible"])]),_:1})])}}});export{_t as default};
