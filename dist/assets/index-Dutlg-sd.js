import{Q as ye,p as ve,_ as be,a as xe}from"./pako.esm-FnpM7ev7.js";import{d as te,a2 as Z,N as ke,i as _,s as ne,bj as Te,o as y,b as oe,I as se,bq as i,f as a,$ as J,B as M,w as t,g as D,h as s,a8 as De,t as X,c as L,S as Y,a9 as W,e as O,aa as Se,ab as Ce,E as Pe,cu as Ne,X as Le,bY as ze,bZ as $e,A as Ie,ax as Be,a6 as Ue,G as je,H as Ae}from"./index-BMYn0QvM.js";import{_ as Re}from"./table-column-setting.vue_vue_type_script_setup_true_lang-C09DWfAm.js";import{_ as qe}from"./round-search-CMO8sK7V.js";import{g as Me,d as Oe,e as Ve}from"./control_management-dO2oJYVL.js";import{u as ee,a as Ee}from"./table-CnhV1qOX.js";import{u as Ge,L as ae}from"./echarts-jwBB9U5j.js";import{_ as He}from"./DatePicker-16epLFhf.js";import{_ as Fe}from"./DataTable-CvQhns6s.js";import"./Forward-CKlitZqf.js";import"./RadioGroup-HkP3qHRJ.js";const Ke=te({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(r){const g=r;Z(()=>g.data,async n=>{z(),$()});const v=ke(),m=_(null),{domRef:b,updateOptions:x,showLoading:z,hideLoading:u}=Ge(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(n){return(n+""!="undefined"?n:"--")+"mw"}},legend:{data:["预测功率","干预后预测功率"]},grid:{left:"5%",right:"8%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} mw"}},series:[{color:"#e90445",name:"预测功率",type:"line",emphasis:{focus:"series"},areaStyle:{color:new ae(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.8)",shadowBlur:20},data:[]},{color:"#addb0b",name:"干预后预测功率",type:"line",emphasis:{focus:"series"},areaStyle:{color:new ae(0,0,0,1,[{offset:0,color:"rgba(173, 219, 11,0.3)"},{offset:1,color:"rgba(173, 219, 11,0)"}],!1),shadowColor:"rgba(173, 219, 11,0.8)",shadowBlur:20},data:[]}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function $(){await new Promise(n=>{setTimeout(n,1e3)}),x(n=>(n.xAxis.data=g.data.map(d=>d.dbtime),n.series[0].data=g.data.map(d=>d.prePower),n.series[1].data=g.data.map(d=>d.manuPower),n))}function V(){x((n,d)=>{const S=d();return n.legend.data=S.legend.data,n.series[0].name=S.series[0].name,n.series[1].name=S.series[1].name,n})}async function E(){$()}return Z(()=>v.locale,()=>{V()}),E(),ne(()=>{m.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),Te(()=>{m.value!==null&&(clearInterval(m.value),m.value=null)}),(n,d)=>(y(),oe("div",{ref_key:"domRef",ref:b,class:"h-600px overflow-hidden"},null,512))}}),Qe=se(Ke,[["__scopeId","data-v-a0369a05"]]),Ze=r=>(je("data-v-e71f582e"),r=r(),Ae(),r),Je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Xe={class:"font-size-14px mb-10px"},Ye=Ze(()=>O("span",null,"二维码",-1));function We(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!Se(r)}const ea=te({name:"stationmanagement_predictionsettingslist",__name:"index",setup(r){const{columns:g,columnChecks:v,data:m,getData:b,loading:x,mobilePagination:z,searchParams:u,resetSearchParams:$}=ee({apiFn:Me,apiParams:{page:1,pageSize:20,limit:20,type:0,startTime:i(1,Date.now()-864e5),endTime:i(1,Date.now()),_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{key:"optime",title:"操作时间",align:"center",width:100},{key:"matime",title:"干预数据日期",align:"center",width:140},{key:"operate",title:"操作",align:"center",width:100,render(l){let e;return a(M,{ghost:!0,size:"small",onClick:()=>le(l)},We(e=J("common.look"))?e:{default:()=>[e]})}}]}),{drawerVisible:V,operateType:E,editingData:n,handleAdd:d,handleEdit:S,checkedRowKeys:I,onBatchDeleted:aa,onDeleted:ta}=Ee(m,b),B=_(!1),U=_(),le=l=>{B.value=!0,U.value=l},G=_([Date.now()-864e5*1,Date.now()]);async function ie(l,e){u.startTime=i(1,e[0]),u.endTime=i(1,e[1]),H.startTime=i(1,e[0]),H.endTime=i(1,e[1])}const f=_("0"),re=()=>{f.value=="0"?j():f.value=="1"&&b()},h=_([]),j=async()=>{const{data:l,error:e}=await Ve({startTime:u.startTime,endTime:u.endTime});e||(h.value=l.sort((p,T)=>new Date(p.dbtime).getTime()-new Date(T.dbtime).getTime()),h.value.length==0?me():k.value=[])},ce=l=>{l=="0"?j():l=="1"&&b()};ne(()=>{j()});const{columns:de,data:k,getData:me,loading:na,mobilePagination:ue,searchParams:H}=ee({apiFn:Oe,apiParams:{page:1,pageSize:20,limit:20,startTime:i(1,Date.now()-864e5*3),endTime:i(1,Date.now()),_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{key:"dbtime",title:"时间",align:"center",width:100},{key:"code",title:"错误码",align:"center",width:140},{key:"errormsg",title:"错误信息",align:"center",width:140}]}),A=_(!1),R=_(""),pe=()=>{var C,P;if(h.value.length==0)return(C=window.$message)==null?void 0:C.warning("暂无数据。请查询数据后重试。");if(h.value.length>96||i(0,u.startTime)!=i(0,u.endTime))return(P=window.$message)==null?void 0:P.warning("数据量过大。请限制在一天的数据范围内后重试。");const l=c=>{const w=new Date(c),q=w.getHours().toString().padStart(2,"0"),N=w.getMinutes().toString().padStart(2,"0");return`${q}:${N}`},e={data:h.value.map(c=>({t:l(c.dbtime),pP:c.prePower,mP:c.manuPower})),type:1,dateTime:i(0,u.startTime)},T=ve.gzip(JSON.stringify(e),{to:"string"}).reduce((c,w)=>c+String.fromCharCode(w),"");R.value=`https://dingiiot.com/powerPrediction/?${btoa(T)}`,console.log("编码",R.value),A.value=!0},_e=()=>{var e;const l=document.getElementById("qrcode");if(l){const p=document.createElement("a");p.href=l.toDataURL("image/png"),p.download="qrcode.png",p.click(),(e=window.$message)==null||e.success("下载成功")}else console.error("无法找到二维码 canvas 元素")};return(l,e)=>{const p=He,T=qe,C=be,P=Ce,c=Pe,w=Re,q=Ne,N=Fe,F=Le,K=ze,ge=$e,fe=Ie,he=Be,Q=Ue,we=xe;return y(),oe("div",Je,[a(F,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[a(c,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[D(" 起止时间 "),a(P,null,{default:t(()=>[a(p,{value:G.value,"onUpdate:value":e[0]||(e[0]=o=>G.value=o),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":ie,"default-time":["00:00:00","23:59:59"]},null,8,["value"]),a(s(M),{type:"primary",ghost:"",onClick:re},{icon:t(()=>[a(T,{class:De(["text-icon",{"animate-spin":s(x)}])},null,8,["class"])]),default:t(()=>[D(" "+X(s(J)("common.search")),1)]),_:1}),s(k).length==0&&f.value=="0"?(y(),L(s(M),{key:0,type:"primary",ghost:"",onClick:pe,class:"ml-20px"},{icon:t(()=>[a(C,{class:"text-icon"})]),default:t(()=>[D(" "+X("生成二维码"))]),_:1})):Y("",!0)]),_:1})]),_:1})]),"header-extra":t(()=>[f.value=="1"?(y(),L(c,{key:0,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[a(w,{columns:s(v),"onUpdate:columns":e[1]||(e[1]=o=>W(v)?v.value=o:null)},null,8,["columns"])]),_:1})):Y("",!0)]),default:t(()=>[a(ge,{type:"line",animated:"",value:f.value,"onUpdate:value":[e[3]||(e[3]=o=>f.value=o),ce],class:"h-100%","pane-wrapper-style":{flex:1}},{default:t(()=>[a(K,{name:"0",tab:"人工干预数据图表对比",class:"h-100%"},{default:t(()=>[s(k).length>0?(y(),L(F,{key:0,bordered:!1,size:"small","header-style":{paddingTop:"0px"},class:"sm:flex-1-hidden card-wrapper h-100%"},{header:t(()=>[O("div",Xe,[a(q,{class:"text-icon c-#e67e22"}),D(" 未查询到预测数据。详情请查看错误日志。 ")]),D(" 功率预测错误日志 ")]),default:t(()=>[a(N,{columns:s(de),data:s(k),size:"small",loading:s(x),remote:"","row-key":o=>o.id,pagination:s(k).length?s(ue):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["columns","data","loading","row-key","pagination"])]),_:1})):(y(),L(Qe,{key:1,data:h.value},null,8,["data"]))]),_:1}),a(K,{name:"1",tab:"人工干预记录列表",class:"h-100%"},{default:t(()=>[a(N,{"checked-row-keys":s(I),"onUpdate:checkedRowKeys":e[2]||(e[2]=o=>W(I)?I.value=o:null),columns:s(g),data:s(m),size:"small",remote:"","row-key":o=>o.id,pagination:s(m).length?s(z):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1}),a(Q,{show:B.value,"onUpdate:show":e[5]||(e[5]=o=>B.value=o),title:"具体信息",preset:"card",class:"w-800px"},{default:t(()=>[a(he,{class:"h-480px"},{default:t(()=>[a(fe,{value:U.value.content,"onUpdate:value":e[4]||(e[4]=o=>U.value.content=o),rows:"20",type:"textarea",readonly:""},null,8,["value"])]),_:1})]),_:1},8,["show"]),a(Q,{show:A.value,"onUpdate:show":e[6]||(e[6]=o=>A.value=o),title:"",preset:"card",class:"w-auto"},{header:t(()=>[O("div",null,[Ye,a(we,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:_e})])]),default:t(()=>[a(ye,{id:"qrcode",style:{margin:"0 auto"},value:R.value,margin:3,size:500,level:"H"},null,8,["value"])]),_:1},8,["show"])])}}}),ga=se(ea,[["__scopeId","data-v-e71f582e"]]);export{ga as default};
