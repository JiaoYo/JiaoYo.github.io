import{Q as ve,p as be,_ as xe,a as ke}from"./pako.esm-Cmzoturh.js";import{_ as Te}from"./table-column-setting.vue_vue_type_script_setup_true_lang-viHAmCxt.js";import{d as ae,a2 as X,N as De,i as p,s as te,bb as ne,o as f,b as E,I as oe,a8 as Z,dF as Ce,ba as r,f as a,$ as W,B as A,a9 as Se,c2 as Pe,w as t,g as T,h as s,aa as ze,t as R,c as z,S as j,ab as Y,e as O,ac as Ne,cC as Le,bz as $e,ad as Ie,E as Me,cD as Be,X as Ue,c5 as Ae,c6 as Re,A as je,az as Ee,a6 as Oe,G as Ve,H as qe}from"./index-DLNUCcPL.js";import{_ as Ge}from"./round-search-B-4rQdSi.js";import{u as Fe,L as ee}from"./echarts-CSxCq58f.js";import{_ as He}from"./DatePicker-lNHPIgCH.js";import{_ as Ke}from"./DataTable-CN6TpDw8.js";import"./Forward-D55si25S.js";import"./RadioGroup-RlP9nCM5.js";const Qe=ae({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(i){const h=i;X(()=>h.data,async n=>{N(),L()});const y=De(),u=p(null),{domRef:v,updateOptions:b,showLoading:N,hideLoading:c}=Fe(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(n){return(n+""!="undefined"?n:"--")+"mw"}},legend:{data:["预测功率","干预后预测功率"]},grid:{left:"5%",right:"8%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} mw"}},series:[{color:"#e90445",name:"预测功率",type:"line",emphasis:{focus:"series"},areaStyle:{color:new ee(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.8)",shadowBlur:20},data:[]},{color:"#addb0b",name:"干预后预测功率",type:"line",emphasis:{focus:"series"},areaStyle:{color:new ee(0,0,0,1,[{offset:0,color:"rgba(173, 219, 11,0.3)"},{offset:1,color:"rgba(173, 219, 11,0)"}],!1),shadowColor:"rgba(173, 219, 11,0.8)",shadowBlur:20},data:[]}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function L(){await new Promise(n=>{setTimeout(n,1e3)}),b(n=>(n.xAxis.data=h.data.map(d=>d.dbtime),n.series[0].data=h.data.map(d=>d.prePower),n.series[1].data=h.data.map(d=>d.manuPower),n))}function V(){b((n,d)=>{const D=d();return n.legend.data=D.legend.data,n.series[0].name=D.series[0].name,n.series[1].name=D.series[1].name,n})}async function q(){L()}return X(()=>y.locale,()=>{V()}),q(),te(()=>{u.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),ne(()=>{u.value!==null&&(clearInterval(u.value),u.value=null)}),(n,d)=>(f(),E("div",{ref_key:"domRef",ref:v,class:"h-600px overflow-hidden"},null,512))}}),Je=oe(Qe,[["__scopeId","data-v-a0369a05"]]),Xe=i=>(Ve("data-v-7bdeaf7b"),i=i(),qe(),i),Ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},We={class:"font-size-14px mb-10px"},Ye={key:0},ea=Xe(()=>O("span",null,"二维码",-1));function aa(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!Ne(i)}const ta=ae({name:"stationmanagement_predictionsettingslist",__name:"index",setup(i){const{columns:h,columnChecks:y,data:u,getData:v,loading:b,mobilePagination:N,searchParams:c,resetSearchParams:L}=Z({apiFn:Ce,apiParams:{page:1,pageSize:20,limit:20,type:0,startTime:r(1,Date.now()-864e5),endTime:r(1,Date.now()),_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{key:"optime",title:"操作时间",align:"center",width:100},{key:"matime",title:"干预数据日期",align:"center",width:140},{key:"operate",title:"操作",align:"center",width:100,render(l){let e;return a(A,{ghost:!0,size:"small",onClick:()=>se(l)},aa(e=W("common.look"))?e:{default:()=>[e]})}}]}),{drawerVisible:V,operateType:q,editingData:n,handleAdd:d,handleEdit:D,checkedRowKeys:$,onBatchDeleted:na,onDeleted:oa}=Se(u,v),I=p(!1),M=p(),se=l=>{I.value=!0,M.value=l},G=p([Date.now()-864e5*1,Date.now()]);async function le(l,e){c.startTime=r(1,e[0]),c.endTime=r(1,e[1]),F.startTime=r(1,e[0]),F.endTime=r(1,e[1])}const _=p("0"),ie=()=>{_.value=="0"?B():_.value=="1"&&v()},g=p([]),B=async()=>{const{data:l,error:e}=await Le({startTime:c.startTime,endTime:c.endTime});e||(g.value=l.sort((m,w)=>new Date(m.dbtime).getTime()-new Date(w.dbtime).getTime()),$e({startTime:c.startTime,endTime:c.endTime}),g.value.length==0?de():x.value=[])},re=l=>{l=="0"?B():l=="1"&&v()};te(()=>{B()}),ne(()=>{});const{columns:ce,data:x,getData:de,loading:sa,mobilePagination:me,searchParams:F}=Z({apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,startTime:r(1,Date.now()-864e5*3),endTime:r(1,Date.now()),_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{key:"dbtime",title:"时间",align:"center",width:100},{key:"code",title:"错误码",align:"center",width:140},{key:"errormsg",title:"错误信息",align:"center",width:140}]}),U=p(!1),C=p(""),ue=()=>{var w,S;if(g.value.length==0)return(w=window.$message)==null?void 0:w.warning("暂无数据。请查询数据后重试。");if(g.value.length>96)return(S=window.$message)==null?void 0:S.warning("数据量过多，请缩小查询范围（最多可导出96条数据）");const l={data:g.value.map(k=>({t:k.dbtime,pP:Math.floor(Math.random()*1e4+100),mP:Math.floor(Math.random()*1e4+100)})),type:1,dateTime:r(1,c.startTime)+" --- "+r(1,c.endTime)},m=be.gzip(JSON.stringify(l),{to:"string"}).reduce((k,P)=>k+String.fromCharCode(P),"");C.value=`https://dingiiot.com/powerPrediction/?${btoa(m)}`,console.log(C.value.length),console.log("地址",C.value),U.value=!0},pe=()=>{var e;const l=document.getElementById("qrcode");if(l){const m=document.createElement("a");m.href=l.toDataURL("image/png"),m.download="qrcode.png",m.click(),(e=window.$message)==null||e.success("下载成功")}else console.error("无法找到二维码 canvas 元素")};return(l,e)=>{const m=He,w=Ge,S=xe,k=Ie,P=Me,_e=Be,H=Ke,K=Ue,Q=Ae,ge=Te,fe=Re,he=je,we=Ee,J=Oe,ye=ke;return f(),E("div",Ze,[a(K,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[a(P,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:t(()=>[T(" 起止时间 "),a(k,null,{default:t(()=>[a(m,{value:G.value,"onUpdate:value":e[0]||(e[0]=o=>G.value=o),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":le,"default-time":["00:00:00","23:59:59"]},null,8,["value"]),a(s(A),{type:"primary",ghost:"",onClick:ie},{icon:t(()=>[a(w,{class:ze(["text-icon",{"animate-spin":s(b)}])},null,8,["class"])]),default:t(()=>[T(" "+R(s(W)("common.search")),1)]),_:1}),s(x).length==0&&_.value=="0"?(f(),z(s(A),{key:0,type:"primary",ghost:"",onClick:ue,class:"ml-20px"},{icon:t(()=>[a(S,{class:"text-icon"})]),default:t(()=>[T(" "+R("生成二维码"))]),_:1})):j("",!0)]),_:1})]),_:1})]),default:t(()=>[a(fe,{type:"line",animated:"",value:_.value,"onUpdate:value":[e[3]||(e[3]=o=>_.value=o),re],class:"h-100%","pane-wrapper-style":{flex:1}},{suffix:t(()=>[_.value=="0"?(f(),E("span",Ye,"共"+R(g.value.length)+"条数据",1)):j("",!0),_.value=="1"?(f(),z(P,{key:1,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[a(ge,{columns:s(y),"onUpdate:columns":e[2]||(e[2]=o=>Y(y)?y.value=o:null)},null,8,["columns"])]),_:1})):j("",!0)]),default:t(()=>[a(Q,{name:"0",tab:"人工干预数据图表对比",class:"h-100%"},{default:t(()=>[s(x).length>0?(f(),z(K,{key:0,bordered:!1,size:"small","header-style":{paddingTop:"0px"},class:"sm:flex-1-hidden card-wrapper h-100%"},{header:t(()=>[O("div",We,[a(_e,{class:"text-icon c-#e67e22"}),T(" 未查询到预测数据。详情请查看错误日志。 ")]),T(" 功率预测错误日志 ")]),default:t(()=>[a(H,{columns:s(ce),data:s(x),size:"small",loading:s(b),remote:"","row-key":o=>o.id,pagination:s(x).length?s(me):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["columns","data","loading","row-key","pagination"])]),_:1})):(f(),z(Je,{key:1,data:g.value},null,8,["data"]))]),_:1}),a(Q,{name:"1",tab:"人工干预记录列表",class:"h-100%"},{default:t(()=>[a(H,{"checked-row-keys":s($),"onUpdate:checkedRowKeys":e[1]||(e[1]=o=>Y($)?$.value=o:null),columns:s(h),data:s(u),size:"small",remote:"","row-key":o=>o.id,pagination:s(u).length?s(N):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1}),a(J,{show:I.value,"onUpdate:show":e[5]||(e[5]=o=>I.value=o),title:"具体信息",preset:"card",class:"w-800px"},{default:t(()=>[a(we,{class:"h-480px"},{default:t(()=>[a(he,{value:M.value.content,"onUpdate:value":e[4]||(e[4]=o=>M.value.content=o),rows:"20",type:"textarea",readonly:""},null,8,["value"])]),_:1})]),_:1},8,["show"]),a(J,{show:U.value,"onUpdate:show":e[6]||(e[6]=o=>U.value=o),title:"",preset:"card",class:"w-auto"},{header:t(()=>[O("div",null,[ea,a(ye,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:pe})])]),default:t(()=>[a(ve,{id:"qrcode",style:{margin:"0 auto"},value:C.value,margin:3,size:500,level:"H"},null,8,["value"])]),_:1},8,["show"])])}}}),ga=oe(ta,[["__scopeId","data-v-7bdeaf7b"]]);export{ga as default};
