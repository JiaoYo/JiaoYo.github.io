import{_ as pe}from"./table-column-setting.vue_vue_type_script_setup_true_lang-E-q-Wp8X.js";import{_ as ue}from"./round-refresh-Cyr_Ii9w.js";import{Y as $,o as P,b as W,e as de,d as X,Z as K,a0 as me,a1 as _e,r as Y,p as fe,q as ge,a2 as G,a as ye,c as he,w as n,f as e,g as _,t as w,h as t,a3 as ve,A as Z,a4 as J,a5 as be,F as we,B as m,E as Q,a6 as xe,a7 as ke,$ as b,s as Ce,y as De,a8 as T,a9 as R,aa as Ne,ab as ze,X as Se}from"./index-DIyxtJcW.js";import{_ as Te}from"./round-delete-BxFeN5TC.js";import{_ as $e}from"./round-add-D-WWL_iY.js";import{_ as Be}from"./round-search-BGhpS_o8.js";import{u as Ue,a as Oe}from"./table-DklkWdRv.js";import{_ as je}from"./FormItemGridItem-B9B_mJk9.js";import{_ as Ie}from"./Grid-CRykCFhL.js";import{e as Le}from"./exportExcel-Bv4G4H50.js";import{N as A}from"./Popconfirm-BtJ_zDog.js";import{_ as Me}from"./InputGroupLabel-fWv-af5D.js";import{_ as Re}from"./DataTable-D8ENyBVV.js";import"./RadioGroup-DX5jOXNE.js";import"./Forward-r4EUSAJj.js";function Pe(l){return $({url:"/script/selectPage.do",method:"get",params:l})}function Ve(l){return $({url:"/script/insert.do",method:"post",data:l})}function qe(l){return $({url:"/script/update.do",method:"post",data:l})}function Fe(l){return $({url:"/script/delete.do",method:"delete",params:l})}const Ee={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Ke=de("path",{fill:"currentColor",d:"M8.71 7.71L11 5.41V15a1 1 0 0 0 2 0V5.41l2.29 2.3a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42l-4-4a1 1 0 0 0-.33-.21a1 1 0 0 0-.76 0a1 1 0 0 0-.33.21l-4 4a1 1 0 1 0 1.42 1.42M21 14a1 1 0 0 0-1 1v4a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-4a1 1 0 0 0-2 0v4a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-4a1 1 0 0 0-1-1"},null,-1),Ge=[Ke];function Ae(l,D){return P(),W("svg",Ee,[...Ge])}const He={name:"uil-export",render:Ae},We=X({__name:"add_model",props:K({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(l,{emit:D}){const y=me(l,"visible"),x=_e({1:"Lua周期执行"}),h=D,c=l,s=Y(N());function N(){return{sname:"",stype:void 0,sdesc:"",executionCycle:3e3}}function f(){Object.assign(s,N()),c.operateType==="edit"&&c.rowData&&Object.assign(s,c.rowData)}const{formRef:q,validate:k,restoreValidation:B}=fe();ge(),G(()=>c.rowData,()=>{f()}),G(y,()=>{y.value&&(f(),B())});const C=()=>{y.value=!1},U=async()=>{if(await k(),c.operateType==="add"){const{data:d,error:i}=await Ve([s]);i||(C(),h("submitted"))}else{const{data:d,error:i}=await qe([s]);i||(C(),h("submitted"))}},O={sname:{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},executionCycle:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]}},j=ye(()=>({add:"新增",edit:"修改"})[c.operateType]);return(d,i)=>{const z=Z,v=je,S=J,I=be,L=Ie,M=we,a=m,o=Q,r=xe;return P(),he(r,{show:y.value,"onUpdate:show":i[4]||(i[4]=p=>y.value=p),title:j.value,preset:"card",class:"w-50%"},{footer:n(()=>[e(o,{size:16,justify:"center"},{default:n(()=>[e(a,{onClick:C,class:"w-100px"},{default:n(()=>[_(w(d.$t("common.cancel")),1)]),_:1}),e(a,{type:"primary",class:"w-100px",onClick:U},{default:n(()=>[_(w(d.$t("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(M,{ref_key:"formRef",ref:q,model:s,rules:O,"label-placement":"left","label-width":140,"require-mark-placement":"left"},{default:n(()=>[e(L,{responsive:"screen","item-responsive":""},{default:n(()=>[e(v,{span:"24 m:12",label:"脚本名称",path:"sname"},{default:n(()=>[e(z,{clearable:"",value:s.sname,"onUpdate:value":i[0]||(i[0]=p=>s.sname=p),placeholder:"请输入脚本名称",style:{width:"100%"}},null,8,["value"])]),_:1}),e(v,{span:"24 m:12",label:"脚本备注",path:"sdesc"},{default:n(()=>[e(z,{clearable:"",value:s.sdesc,"onUpdate:value":i[1]||(i[1]=p=>s.sdesc=p),placeholder:"请输入脚本备注",style:{width:"100%"}},null,8,["value"])]),_:1}),e(v,{span:"24 m:12",label:"脚本类型",path:"stype"},{default:n(()=>[e(S,{filterable:"",clearable:"",placeholder:"请选择参数项模板",value:s.stype,"onUpdate:value":i[2]||(i[2]=p=>s.stype=p),options:t(ve)(t(x))},null,8,["value","options"])]),_:1}),e(v,{span:"24 m:12",label:"执行周期(ms)",path:"executionCycle"},{default:n(()=>[e(I,{clearable:"",value:s.executionCycle,"onUpdate:value":i[3]||(i[3]=p=>s.executionCycle=p),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Xe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function H(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!Ne(l)}const ut=X({name:"configsetting_luascriptoperation",__name:"index",setup(l){const D=ke(),y=Y({scriptTypeListOptions:[{label:"Lua周期执行",value:0}]}),{columns:V,columnChecks:x,data:h,getData:c,loading:s,mobilePagination:N,searchParams:f,resetSearchParams:q}=Ue({apiFn:Pe,apiParams:{page:1,pageSize:20,limit:20,fuzzy:void 0,stype:null,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48},{key:"sname",title:"脚本名称",align:"center",minWidth:180},{key:"sdesc",title:"脚本备注",align:"center",width:180},{key:"stype",title:"脚本类型",align:"center",width:180,render:a=>e("span",null,[a.stype==0?"条件触发执行":"Lua周期执行"])},{key:"executeCircle",title:"执行周期(ms)",align:"center",width:180},{key:"operate",title:b("common.operate"),align:"center",width:24,fixed:"right",render:a=>{let o;return e("div",{class:"flex-center gap-8px"},[e(m,{type:"primary",ghost:!0,size:"small",onClick:()=>L(a.id)},{default:()=>["编辑脚本函数"]}),e(m,{type:"primary",ghost:!0,size:"small",onClick:()=>I(a.id)},H(o=b("common.edit"))?o:{default:()=>[o]}),e(A,{onPositiveClick:()=>v(a.id)},{default:()=>b("common.confirmDelete"),trigger:()=>{let r;return e(m,{type:"error",ghost:!0,size:"small"},H(r=b("common.delete"))?r:{default:()=>[r]})}})])}}]});Ce(()=>{});const{drawerVisible:k,operateType:B,editingData:C,handleAdd:U,handleEdit:F,checkedRowKeys:g,onBatchDeleted:O,onDeleted:j}=Oe(h,c),d=()=>{c()},i=()=>{const a={sname:"脚本名称",sdesc:"脚本备注",stype:"脚本类型",executionCycle:"执行周期(ms)"},o=h.value.map(r=>(r.scriptType=r.stype==1?"Lua周期执行":"条件触发执行",r));Le(o,a,"脚本列表")};async function z(){console.log(g.value),S(g.value,a=>{O()})}const v=a=>{console.log(a),S([a],o=>{j()})};async function S(a,o){const r=await Fe({ids:a.join(",")});console.log("data",r),o&&o(r)}const I=a=>{F(a)},L=a=>{let o=D.resolve({path:"/scriptcode",query:{id:a}});window.open(o.href,"_blank")};function M(){f.fuzzy=void 0,d()}return(a,o)=>{const r=Me,p=J,ee=Z,te=Be,ne=ze,E=Q,oe=$e,ae=Te,se=He,le=ue,ie=pe,re=Re,ce=Se;return P(),W("div",Xe,[e(ce,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:n(()=>[e(E,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:n(()=>[e(ne,null,{default:n(()=>[e(r,null,{default:n(()=>[_("脚本类型")]),_:1}),e(p,{filterable:"",clearable:"",placeholder:"请选择",value:t(f).stype,"onUpdate:value":[o[0]||(o[0]=u=>t(f).stype=u),d],options:y.scriptTypeListOptions},null,8,["value","options"]),e(r,null,{default:n(()=>[_("脚本名称")]),_:1}),e(ee,{clearable:"",value:t(f).fuzzy,"onUpdate:value":o[1]||(o[1]=u=>t(f).fuzzy=u),placeholder:"请输入脚本名称",onKeyup:De(d,["enter"]),onClear:M},null,8,["value"]),e(t(m),{type:"primary",ghost:"",onClick:t(c)},{icon:n(()=>[e(te,{class:T(["text-icon",{"animate-spin":t(s)}])},null,8,["class"])]),default:n(()=>[_(" 搜索 ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),"header-extra":n(()=>[e(E,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[e(t(m),{onClick:t(U),size:"small",ghost:"",type:"primary"},{icon:n(()=>[e(oe,{class:T(["text-icon",{"animate-spin":t(s)}])},null,8,["class"])]),default:n(()=>[_(" "+w("新增"))]),_:1},8,["onClick"]),e(t(A),{onPositiveClick:z},{trigger:n(()=>[e(t(m),{size:"small",ghost:"",type:"error",disabled:t(g).length==0},{icon:n(()=>[e(ae,{class:"text-icon"})]),default:n(()=>[_(" "+w(t(b)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:n(()=>[_(" "+w(t(b)("common.confirmDelete")),1)]),_:1}),e(t(m),{onClick:i,size:"small",disabled:t(g).length==0},{icon:n(()=>[e(se,{class:T(["text-icon",{"animate-spin":t(s)}])},null,8,["class"])]),default:n(()=>[_(" "+w("导出"))]),_:1},8,["disabled"]),e(t(m),{onClick:t(c),size:"small",ghost:"",type:"primary"},{icon:n(()=>[e(le,{class:T(["text-icon",{"animate-spin":t(s)}])},null,8,["class"])]),_:1},8,["onClick"]),e(ie,{columns:t(x),"onUpdate:columns":o[2]||(o[2]=u=>R(x)?x.value=u:null)},null,8,["columns"])]),_:1})]),default:n(()=>[e(re,{"checked-row-keys":t(g),"onUpdate:checkedRowKeys":o[3]||(o[3]=u=>R(g)?g.value=u:null),columns:t(V),data:t(h),size:"small",loading:t(s),remote:"","row-key":u=>u.id,pagination:t(N)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(We,{visible:t(k),"onUpdate:visible":o[4]||(o[4]=u=>R(k)?k.value=u:null),onSubmitted:t(c),"operate-type":t(B),"row-data":t(C)},null,8,["visible","onSubmitted","operate-type","row-data"])]),_:1})])}}});export{ut as default};
