(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-8a1f3baa"],{"001b":function(e,t,a){},"3da8":function(e,t){e.exports={messages:{CN:{singleUpgrade:"单个升级",batchUpgrade:"批量升级",selectAnUpgradeFile:"请选择升级文件",selectFile:"选择文件",search:"查询",upgrade:"升级",stopUpgrade:"停止升级",no:"序号",deviceName:"设备名称",communicationStatus:"通讯状态",operatingStatus:"运行状态",currVersion:"当前版本",targetVersion:"目标版本",upgradeProgress:"升级进度",currentStatus:"当前状态",activationStatus:"激活状态",startTime:"起始时间",endTime:"结束时间",noData:"暂无数据",standby:"待机",run:"运行",fault:"故障",communicationInterruption:"通讯中断",offline:"离线",unknown:"未知",feedbackResult:"反馈结果",hint:"提示",wantUpgrade:"确定要升级吗？升级完成后网关会自动重启。",confirm:"确定",cancel:"取消",restartTheGateway:"重启网关",areYouSureRestartTheGgateway:"确定要重启网关吗？",restartGatewaySuccessfully:"重启网关成功",restartGatewayFailed:"重启网关失败",filenameWrong:"文件名错误,请重新上传文件!",fileFormatError:"文件格式错误,请重新上传文件!",fileSizeExceed:"上传文件大小不能超过 64MB!",upgradeOperationTime:"升级操作时间",upgradeRecord:"升级记录",status:"状态",success:"成功",fail:"失败",copiedSuccessfully:"复制成功",copyFailed:"复制失败",upgradeOperationRecord:"升级操作记录",refresh:"刷新",copy:"复制"},US:{singleUpgrade:"Single Upgrade",batchUpgrade:"Batch Upgrade",selectAnUpgradeFile:"Select An Upgrade File",selectFile:"Select File",search:"Search",upgrade:"Upgrade",stopUpgrade:"Stop Upgrade",no:"No",deviceName:"Device Name",communicationStatus:"Communication Status",operatingStatus:"Operating Status",currVersion:"Curr.ver",targetVersion:"Target. ver",upgradeProgress:"Upgrade Progress",currentStatus:"Current Status",activationStatus:"Activation Status",startTime:"Start Time",endTime:"End Time",noData:"No Data",standby:"Standby",run:"Run",fault:"Fault",communicationInterruption:"Communication interruption",offline:"Offline",unknown:"Unknown",feedbackResult:"Feedback results",hint:"Hint",wantUpgrade:"After the upgrade is completed, the gateway will automatically restart.",confirm:"Confirm",cancel:"Cancel",restartTheGateway:"Restart the gateway",areYouSureRestartTheGgateway:"Are you sure you want to restart the gateway?",restartGatewaySuccessfully:"Restart gateway successfully",restartGatewayFailed:"Failed to restart gateway",filenameWrong:"The file name is wrong, please re-upload the file!",fileFormatError:"File format error, please re-upload the file!",fileSizeExceed:"Upload file size cannot exceed 64MB!",upgradeOperationTime:"Upgrade operation time",upgradeRecord:"Upgrade record",status:"Status",success:"Success",fail:"Failure",copiedSuccessfully:"Copied successfully",copyFailed:"Copied failed",upgradeOperationRecord:"Upgrade operation record",refresh:"Refresh",copy:"Copy"}}}},bb5a:function(e,t,a){"use strict";var s=a("001b");a.n(s).a},f81a:function(e,t,a){"use strict";a.r(t);a("4160"),a("b0c0"),a("ac1f"),a("1276"),a("159b");var s=a("5530"),r=a("b311"),o=a.n(r),i=a("2f62"),n=a("e199"),c=a("b775"),l={name:"firmwareupgrade",i18n:a("3da8"),data:function(){return{scrollHeight:0,fileList:[],feedbackDesc:"",copyData:"",dataListLoading:!1,dataList:[]}},computed:Object(s.a)(Object(s.a)({},Object(i.e)("setting",["theme","isMobile","layout","systemName","lang","pageWidth"])),Object(i.e)("account",["user"])),methods:Object(s.a)(Object(s.a)(Object(s.a)({},Object(i.d)("setting",["setSystemName"])),Object(i.b)("setting",["setLang"])),{},{handleExportChange:function(){},beforeUpload:function(e){console.log("file",e);var t=/^ioserver_bin.*\.tar\.gz$/.test(e.name),a="application/x-gzip"===e.type||"application/gzip"===e.type,s=e.size/1024/1024<64;return t||(this.$message.config({maxCount:1}),this.$message.destroy(),this.$message.error(this.$t("filenameWrong"))),a||(this.$message.config({maxCount:1}),this.$message.destroy(),this.$message.error(this.$t("fileFormatError"))),s||(this.$message.config({maxCount:1}),this.$message.destroy(),this.$message.error(this.$t("fileSizeExceed"))),t&&a&&s},uploadFirmwareUpgradeFile:function(e){var t=this,a=e.file,s={},r=new FormData;r.append("file_type",1),r.append("file_path",""),r.append("file_name",a.name),r.append("file_bin",a),Object(n.fb)(r).then((function(e){var a=e.data;if(0!=a.code)return t.$message.config({maxCount:1}),t.$message.destroy(),t.$message.error(a.msg);t.$message.config({maxCount:1}),t.$message.destroy(),t.$message.success("success"),t.$confirm({title:t.$t("hint"),content:t.$t("wantUpgrade"),okText:t.$t("confirm"),okType:"danger",cancelText:t.$t("cancel"),onOk:function(){Object(n.P)(s).then((function(e){var a=e.data;if(a&&0!=a.code)return t.$message.config({maxCount:1}),t.$message.destroy(),t.$message.error(a.msg);t.$message.config({maxCount:1}),t.$message.destroy(),t.$message[a.data.result?"success":"error"](a.data.result?t.$t("restartGatewaySuccessfully"):t.$t("restartGatewayFailed")),setTimeout((function(){localStorage.removeItem("admin.routes"),localStorage.removeItem("admin.permissions"),localStorage.removeItem("admin.roles"),Object(c.d)(),t.$router.push("/login")}),1e3)}))},onCancel:function(){console.log("Cancel")}})}))},handleUpgradeChange:function(){var e=this,t={};e.$confirm({title:e.$t("hint"),content:e.$t("areYouSureRestartTheGgateway"),okText:e.$t("confirm"),okType:"danger",cancelText:e.$t("cancel"),onOk:function(){Object(n.P)(t).then((function(t){var a=t.data;if(a&&0!=a.code)return e.$message.config({maxCount:1}),e.$message.destroy(),e.$message.error(a.msg);e.$message.config({maxCount:1}),e.$message.destroy(),e.$message[a.data.result?"success":"error"](a.data.result?e.$t("restartGatewaySuccessfully"):e.$t("restartGatewayFailed")),setTimeout((function(){localStorage.removeItem("admin.routes"),localStorage.removeItem("admin.permissions"),localStorage.removeItem("admin.roles"),Object(c.d)(),e.$router.push("/login")}),1e3)}))},onCancel:function(){console.log("Cancel")}})},getGwUpgradeRecordDataList:function(){var e=this,t=[];e.dataListLoading=!0,Object(n.s)({}).then((function(a){var s=a.data;return s?0!=s.code&&7!=s.code?(e.dataListLoading=!1,e.$message.config({maxCount:1}),e.$message.destroy(),e.$message.error(s.msg)):7==s.code?(e.dataListLoading=!1,!1):(e.dataListLoading=!1,s.data.forEach((function(e){var a=e.split(",");t.push({desc:a[0],time:a[1].split("upgrade operation time:")[1],status:"result: successed"==a[2]?"successed":"failed"})})),void(e.dataList=t)):(e.dataListLoading=!1,!1)})).catch((function(t){console.log(t),e.dataListLoading=!1}))},formatterDesc:function(e){var t=String(e).split("ver:"),a=t[1].split(";time:"),s=t[2].split(";time:");return t[0]+"ver:"+'<span style="color: #8BC63E; font-weight: bolder;">'.concat(a[0],"</span>")+";time:"+a[1]+'<span style="color: #8BC63E; font-weight: bolder;">'.concat(s[0],"</span>")+";time:"+s[1]},handleCopyChange:function(){var e=this,t="";e.dataList.forEach((function(a){t+=e.$t("upgradeOperationTime")+': "'+a.time+'", '+e.$t("upgradeRecord")+': "'+a.desc+'", '+e.$t("status")+": "+("successed"==a.status?'"'+e.$t("success")+'"':'"'+e.$t("fail")+'"')+"\n"})),e.copyData=t;var a=new o.a(".copyRecord",{text:function(){return e.copyData}});a.on("success",(function(t){console.log(t),e.$message.config({maxCount:1}),e.$message.destroy(),e.$message.success(e.$t("copiedSuccessfully")),a.destroy()})),a.on("error",(function(t){console.log(t),e.$message.error(e.$t("copyFailed")),a.destroy()}))}}),mounted:function(){var e=this;this.scrollHeight=window.innerHeight-145,this.getGwUpgradeRecordDataList(),window.onresize=function(){e.scrollHeight=window.innerHeight-145}}},d=(a("bb5a"),a("0c7c")),u=Object(d.a)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",[a("a-space",[a("div",{staticStyle:{"font-weight":"bolder"}},[e._v(" "+e._s(e.$t("selectAnUpgradeFile"))+"： "),a("a-upload",{attrs:{action:"",customRequest:e.uploadFirmwareUpgradeFile,"file-list":e.fileList,"before-upload":e.beforeUpload}},[a("a-button",[a("a-icon",{attrs:{type:"upload"}}),e._v(e._s(e.$t("selectFile")))],1)],1)],1),a("a-button",{attrs:{type:"primary",icon:"play-circle"},on:{click:e.handleUpgradeChange}},[e._v(e._s(e.$t("restartTheGateway")))])],1),a("div",{staticStyle:{"margin-top":"20px",display:"flex","align-items":"center"}},[a("a-space",[a("h4",{staticStyle:{"font-weight":"bolder",margin:"0"}},[e._v(e._s(e.$t("upgradeOperationRecord")))]),a("a-button",{attrs:{icon:"reload",type:"primary"},on:{click:e.getGwUpgradeRecordDataList}},[e._v(e._s(e.$t("refresh")))]),a("a-button",{staticClass:"copyRecord",attrs:{icon:"copy",disabled:0==e.dataList.length},on:{click:e.handleCopyChange}},[e._v(e._s(e.$t("copy")))])],1)],1),a("vxe-table",{ref:"recordTable",staticStyle:{"margin-top":"10px"},attrs:{border:"",resizable:"","auto-resize":"","sync-resize":"","show-overflow":"",size:"small","highlight-current-row":"","highlight-hover-row":"","empty-text":e.$t("noData"),data:e.dataList,"max-height":e.scrollHeight-73,loading:e.dataListLoading}},[a("vxe-column",{attrs:{field:"time",title:e.$t("upgradeOperationTime"),width:"160",align:"center",fixed:"left"}}),a("vxe-column",{attrs:{field:"desc",title:e.$t("upgradeRecord"),"min-width":"180",align:"center","show-overflow":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{domProps:{innerHTML:e._s(e.formatterDesc(t.row.desc))}})]}}])}),a("vxe-column",{attrs:{field:"status",title:e.$t("status"),width:"100",align:"center","show-overflow":"",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a-tag",{attrs:{color:"successed"==t.row.status?"green":"red"}},[e._v(" "+e._s("successed"==t.row.status?e.$t("success"):e.$t("fail"))+" ")])]}}])})],1)],1)}),[],!1,null,"efe71516",null).exports;t.default=u}}]);