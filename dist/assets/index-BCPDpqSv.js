import{_ as me}from"./table-column-setting.vue_vue_type_script_setup_true_lang-C5T6qI4Z.js";import{_ as be}from"./round-search-CxXrOyeP.js";import{aK as _e,bg as ye,bh as N,bi as B,aO as M,aQ as S,aP as ee,bj as Ce,aN as ke,d as ge,aU as xe,aV as fe,bk as Ie,a as se,bl as Se,bm as $,a_ as we,i as P,aA as f,bn as Te,bo as ze,b3 as $e,bp as Pe,bq as Ee,br as Re,bs as Ae,bt as We,bu as De,bv as Ne,bw as Be,f as g,aD as He,b8 as oe,s as Le,b9 as qe,ad as Oe,bb as ie,bc as ce,an as de,a2 as je,o as ue,b as Fe,w as y,g as U,h as u,a3 as Me,y as Ve,B as Ke,a8 as Ue,e as pe,D as Je,x as Ge,bx as Qe,t as Xe,c as Ye,S as Ze,a9 as he,a4 as eo,A as oo,ab as to,E as no,ax as ao,X as ro,I as lo}from"./index-CUNPF4fr.js";import{u as so,a as io}from"./table-CeWmGbcP.js";import{a as co,p as uo}from"./gather-BcBfSMFi.js";import{_ as po}from"./InputGroupLabel-nrGc56zv.js";import{_ as ho}from"./Tree-BTZj9OQb.js";import{_ as go}from"./DataTable-DCVZic8E.js";import{_ as fo}from"./Split-B1J0hDHz.js";import"./RadioGroup-Dt9BXj20.js";import"./Forward-D2lkVYwM.js";const vo=m=>{const{lineHeight:t,borderRadius:C,fontWeightStrong:k,baseColor:l,dividerColor:w,actionColor:V,textColor1:s,textColor2:_,closeColorHover:T,closeColorPressed:v,closeIconColor:E,closeIconColorHover:D,closeIconColorPressed:d,infoColor:n,successColor:R,warningColor:z,errorColor:A,fontSize:H}=m;return Object.assign(Object.assign({},ye),{fontSize:H,lineHeight:t,titleFontWeight:k,borderRadius:C,border:`1px solid ${w}`,color:V,titleTextColor:s,iconColor:_,contentTextColor:_,closeBorderRadius:C,closeColorHover:T,closeColorPressed:v,closeIconColor:E,closeIconColorHover:D,closeIconColorPressed:d,borderInfo:`1px solid ${N(l,B(n,{alpha:.25}))}`,colorInfo:N(l,B(n,{alpha:.08})),titleTextColorInfo:s,iconColorInfo:n,contentTextColorInfo:_,closeColorHoverInfo:T,closeColorPressedInfo:v,closeIconColorInfo:E,closeIconColorHoverInfo:D,closeIconColorPressedInfo:d,borderSuccess:`1px solid ${N(l,B(R,{alpha:.25}))}`,colorSuccess:N(l,B(R,{alpha:.08})),titleTextColorSuccess:s,iconColorSuccess:R,contentTextColorSuccess:_,closeColorHoverSuccess:T,closeColorPressedSuccess:v,closeIconColorSuccess:E,closeIconColorHoverSuccess:D,closeIconColorPressedSuccess:d,borderWarning:`1px solid ${N(l,B(z,{alpha:.33}))}`,colorWarning:N(l,B(z,{alpha:.08})),titleTextColorWarning:s,iconColorWarning:z,contentTextColorWarning:_,closeColorHoverWarning:T,closeColorPressedWarning:v,closeIconColorWarning:E,closeIconColorHoverWarning:D,closeIconColorPressedWarning:d,borderError:`1px solid ${N(l,B(A,{alpha:.25}))}`,colorError:N(l,B(A,{alpha:.08})),titleTextColorError:s,iconColorError:A,contentTextColorError:_,closeColorHoverError:T,closeColorPressedError:v,closeIconColorError:E,closeIconColorHoverError:D,closeIconColorPressedError:d})},mo={name:"Alert",common:_e,self:vo},bo=M("alert",`
 line-height: var(--n-line-height);
 border-radius: var(--n-border-radius);
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-color);
 text-align: start;
 word-break: break-word;
`,[S("border",`
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 transition: border-color .3s var(--n-bezier);
 border: var(--n-border);
 pointer-events: none;
 `),ee("closable",[M("alert-body",[S("title",`
 padding-right: 24px;
 `)])]),S("icon",{color:"var(--n-icon-color)"}),M("alert-body",{padding:"var(--n-padding)"},[S("title",{color:"var(--n-title-text-color)"}),S("content",{color:"var(--n-content-text-color)"})]),Ce({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),S("icon",`
 position: absolute;
 left: 0;
 top: 0;
 align-items: center;
 justify-content: center;
 display: flex;
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 margin: var(--n-icon-margin);
 `),S("close",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 right: 0;
 top: 0;
 margin: var(--n-close-margin);
 `),ee("show-icon",[M("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),ee("right-adjust",[M("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),M("alert-body",`
 border-radius: var(--n-border-radius);
 transition: border-color .3s var(--n-bezier);
 `,[S("title",`
 transition: color .3s var(--n-bezier);
 font-size: 16px;
 line-height: 19px;
 font-weight: var(--n-title-font-weight);
 `,[ke("& +",[S("content",{marginTop:"9px"})])]),S("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),S("icon",{transition:"color .3s var(--n-bezier)"})]),_o=Object.assign(Object.assign({},fe.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),yo=ge({name:"Alert",inheritAttrs:!1,props:_o,setup(m){const{mergedClsPrefixRef:t,mergedBorderedRef:C,inlineThemeDisabled:k,mergedRtlRef:l}=xe(m),w=fe("Alert","-alert",bo,mo,m,t),V=Ie("Alert",l,t),s=se(()=>{const{common:{cubicBezierEaseInOut:d},self:n}=w.value,{fontSize:R,borderRadius:z,titleFontWeight:A,lineHeight:H,iconSize:K,iconMargin:j,iconMarginRtl:L,closeIconSize:J,closeBorderRadius:G,closeSize:Q,closeMargin:X,closeMarginRtl:te,padding:ne}=n,{type:x}=m,{left:ae,right:re}=Se(j);return{"--n-bezier":d,"--n-color":n[$("color",x)],"--n-close-icon-size":J,"--n-close-border-radius":G,"--n-close-color-hover":n[$("closeColorHover",x)],"--n-close-color-pressed":n[$("closeColorPressed",x)],"--n-close-icon-color":n[$("closeIconColor",x)],"--n-close-icon-color-hover":n[$("closeIconColorHover",x)],"--n-close-icon-color-pressed":n[$("closeIconColorPressed",x)],"--n-icon-color":n[$("iconColor",x)],"--n-border":n[$("border",x)],"--n-title-text-color":n[$("titleTextColor",x)],"--n-content-text-color":n[$("contentTextColor",x)],"--n-line-height":H,"--n-border-radius":z,"--n-font-size":R,"--n-title-font-weight":A,"--n-icon-size":K,"--n-icon-margin":j,"--n-icon-margin-rtl":L,"--n-close-size":Q,"--n-close-margin":X,"--n-close-margin-rtl":te,"--n-padding":ne,"--n-icon-margin-left":ae,"--n-icon-margin-right":re}}),_=k?we("alert",se(()=>m.type[0]),s,m):void 0,T=P(!0),v=()=>{const{onAfterLeave:d,onAfterHide:n}=m;d&&d(),n&&n()};return{rtlEnabled:V,mergedClsPrefix:t,mergedBordered:C,visible:T,handleCloseClick:()=>{var d;Promise.resolve((d=m.onClose)===null||d===void 0?void 0:d.call(m)).then(n=>{n!==!1&&(T.value=!1)})},handleAfterLeave:()=>{v()},mergedTheme:w,cssVars:k?void 0:s,themeClass:_==null?void 0:_.themeClass,onRender:_==null?void 0:_.onRender}},render(){var m;return(m=this.onRender)===null||m===void 0||m.call(this),f(Ee,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:t,$slots:C}=this,k={class:[`${t}-alert`,this.themeClass,this.closable&&`${t}-alert--closable`,this.showIcon&&`${t}-alert--show-icon`,!this.title&&this.closable&&`${t}-alert--right-adjust`,this.rtlEnabled&&`${t}-alert--rtl`],style:this.cssVars,role:"alert"};return this.visible?f("div",Object.assign({},Te(this.$attrs,k)),this.closable&&f(ze,{clsPrefix:t,class:`${t}-alert__close`,onClick:this.handleCloseClick}),this.bordered&&f("div",{class:`${t}-alert__border`}),this.showIcon&&f("div",{class:`${t}-alert__icon`,"aria-hidden":"true"},$e(C.icon,()=>[f(Re,{clsPrefix:t},{default:()=>{switch(this.type){case"success":return f(Ne,null);case"info":return f(De,null);case"warning":return f(We,null);case"error":return f(Ae,null);default:return null}}})])),f("div",{class:[`${t}-alert-body`,this.mergedBordered&&`${t}-alert-body--bordered`]},Pe(C.header,l=>{const w=l||this.title;return w?f("div",{class:`${t}-alert-body__title`},w):null}),C.default&&f("div",{class:`${t}-alert-body__content`},C))):null}})}}),Co={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ko={class:"flex flex-col"},xo=ge({name:"configsetting_realtimedata_devicedata",__name:"index",setup(m){const{columns:t,columnChecks:C,data:k,getData:l,loading:w,mobilePagination:V,searchParams:s,resetSearchParams:_}=so({apiFn:Be,apiParams:{page:1,pageSize:200,limit:200,tagType:null,chlid:null,devId:null,fuzzy:"",chlType:0,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"序号",align:"center",width:80},{key:"devId",title:"设备名称",align:"center",width:100,render:e=>{var o;return g("span",null,[(o=E.value.find(a=>a.id==e.devId))==null?void 0:o.devName])}},{key:"tagName",title:"测点名称",align:"center"},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center"},{key:"value",title:"测点值",align:"center",width:140,render:e=>{var o;return f("span",{style:{color:e.quality===100?"red":e.quality==49?"#409eff":e.quality==50?"#909399":"#67c23a"}},parseFloat((o=e.value)==null?void 0:o.toFixed(6))||e.value)}},{key:"quality",title:"质量",align:"center",width:120,render:e=>(e.quality==100||e.quality==49||e.quality==0)&&f(He,{style:{background:e.quality===100?"red":e.quality==49?"#409eff":"#67c23a",color:"#fff"}},e.quality==0?"Good":e.quality==49?"人工置数":e.quality==100?"Bad":"")},{key:"dbtime",title:"采集时间",align:"center",minWidth:120,render:e=>{var o,a;return f("span",{title:oe(0,+e.dbtime)},e.dbtime?(a=oe(2,+e.dbtime))==null?void 0:a.substring(10,(o=oe(2,+e.dbtime))==null?void 0:o.length):"")}},{key:"tagType",title:"测点类型",align:"center",width:140,render:e=>g("span",null,[co[e.tagType]])},{key:"objAddr",title:"地址",align:"center",width:140}]}),T=e=>{e===""&&l()};Le(async()=>{await D(),K(),n()}),qe(()=>{var e;(e=d.value)==null||e.close(),z.value.close()});const v=P(),E=P([]),D=async()=>{const{data:e,error:o}=await Oe();if((e==null?void 0:e.length)==0)return;function a(r){return r.map(p=>{var h;return{label:p.chlName,key:p.id,dev_status:null,children:(h=p.devicePojoList)!=null&&h.length?p.devicePojoList.map(i=>(E.value.push(i),{label:i.devName,dev_status:null,chlType:p.chlType,key:i.id})):[]}})}v.value=a(e),s.chlid=v.value[0].key,s.devId=v.value[0].children[0].key,j.value=[v.value[0].children[0].key],L.value=v.value[0].children[0].label,l()},d=P(null),n=()=>{var p;(p=d.value)==null||p.close();const e=new ie;let o="";e.appendAsciiStr("$Link+Qi^123987WWg#getchlstatus"),o=e.end();const a=new Date().getTime(),r=new ce(de.replace("https","wss")+`/ChannelStatusWebsocket/getchlstatus/${o}/${a}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});d.value=r,r.connect(),r.onclose(()=>{}),r.onerror(()=>{}),r.onopen(()=>{}),r.onmessage(h=>{let i=[];console.log(h,"通道状态websocket接受数据"),le(h.data)&&(i=JSON.parse(h.data).data,v.value.forEach(c=>{i.forEach(b=>{var q;b.chl_id==c.key&&(c.dev_status=b.chl_status),b.chl_id==1&&(c.dev_status=1),(q=c.children)==null||q.forEach(O=>{var F;(F=b.devs)==null||F.forEach(W=>{W.dev_id==O.key&&(O.dev_status=W.dev_status),W.dev_id==1&&(O.dev_status=1)})})})}))})},R=P(!1),z=P(null),A=P(""),H=P(!0),K=()=>{var p;(p=z.value)==null||p.close(),H.value=!0;const e=new ie;let o="";const a=new Date().getTime();e.appendAsciiStr("$Link+Qi^123987WWg#"+a),o=e.end();const r=new ce(de.replace("https","wss")+`/realTimeDataWebsocket/${L.value}/${o}/${a}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});z.value=r,r.connect(),r.onclose(()=>{}),r.onerror(()=>{}),r.onopen(()=>{}),r.onmessage(h=>{R.value=!1;let i=[];console.log(h,"实时数据websocket接受数据"),le(h.data)&&(i=JSON.parse(h.data).data[L.value],i==null||i.forEach(c=>{k.value.forEach(b=>{c.i==b.id&&(b.quality=c.q,b.value=c.v,b.dbtime=c.t)})}),R.value=i.every(c=>c.v==0||c.v==null),A.value=X())})},j=P([]),L=P(""),J=async(e,o,a)=>{var h,i,c,b,q;j.value=[(h=a.node)==null?void 0:h.key],s.chlType=(i=a.node)==null?void 0:i.chlType;function r(O,F){for(const W of O)if(W.children){for(const Z of W.children)if(Z.key===F)return W.key}return null}const p=await r(v.value,(c=a.node)==null?void 0:c.key);s.chlid=p,s.devId=(b=a.node)==null?void 0:b.key,L.value=(q=a.node)==null?void 0:q.label,l(),K()},G=e=>{e&&k.value.length>0?K():z.value.close()};je(()=>s.tagType,e=>{e||l()});const Q=({option:e})=>e.key==0?"":e.dev_status!==null?f("span",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:e.hasOwnProperty("dev_status")&&e.dev_status==1?"#00b42a":e.dev_status==2?"#ff0000":"#ccc"}}):"",X=e=>{const o=new Date,a=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),p=String(o.getDate()).padStart(2,"0"),h=String(o.getHours()).padStart(2,"0"),i=String(o.getMinutes()).padStart(2,"0"),c=String(o.getSeconds()).padStart(2,"0");return`${a}-${r}-${p} ${h}:${i}:${c}`},{drawerVisible:te,operateType:ne,editingData:x,handleAdd:ae,handleEdit:re,checkedRowKeys:Y,onBatchDeleted:Io,onDeleted:So}=io(k,l),le=e=>{try{return JSON.parse(e),!0}catch{return!1}};return(e,o)=>{const a=po,r=eo,p=oo,h=be,i=to,c=yo,b=no,q=me,O=ho,F=ao,W=go,Z=fo,ve=ro;return ue(),Fe("div",Co,[g(ve,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:y(()=>[g(b,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:y(()=>[g(i,null,{default:y(()=>[g(a,null,{default:y(()=>[U("测点类型")]),_:1}),g(r,{filterable:"",clearable:"",placeholder:"请选择",value:u(s).tagType,"onUpdate:value":o[0]||(o[0]=I=>u(s).tagType=I),options:u(Me)(u(uo))},null,8,["value","options"]),g(p,{clearable:"",value:u(s).fuzzy,"onUpdate:value":[o[1]||(o[1]=I=>u(s).fuzzy=I),T],placeholder:"请输入测点名称或描述",style:{width:"150%"},onKeyup:Ve(u(l),["enter"])},null,8,["value","onKeyup"]),g(u(Ke),{type:"primary",ghost:"",onClick:u(l)},{icon:y(()=>[g(h,{class:Ue(["text-icon",{"animate-spin":u(w)}])},null,8,["class"])]),default:y(()=>[U(" 搜索 ")]),_:1},8,["onClick"])]),_:1}),pe("div",ko,[g(u(Je),{checked:H.value,"onUpdate:checked":[o[2]||(o[2]=I=>H.value=I),G]},{default:y(()=>[U(" 实时刷新 ")]),_:1},8,["checked"]),Ge(pe("span",{class:"font-size-14px color-blank",style:{"font-weight":"600"}}," 刷新时间："+Xe(A.value),513),[[Qe,A.value]])]),L.value=="系统设备"&&R.value?(ue(),Ye(c,{key:0,type:"error"},{default:y(()=>[U(" 检测到预测服务异常 ")]),_:1})):Ze("",!0)]),_:1})]),"header-extra":y(()=>[g(b,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:y(()=>[g(q,{columns:u(C),"onUpdate:columns":o[3]||(o[3]=I=>he(C)?C.value=I:null)},null,8,["columns"])]),_:1})]),default:y(()=>[g(Z,{direction:"horizontal",class:"sm:h-full","default-size":.15,max:.35,min:.1,"resize-trigger-size":6},{1:y(()=>[g(F,{style:{"max-height":"700px"}},{default:y(()=>[g(O,{"block-line":"","default-expand-all":"",data:v.value,"checked-keys":j.value,"expand-on-click":!1,"render-prefix":Q,"check-strategy":"child","onUpdate:checkedKeys":J,checkable:""},null,8,["data","checked-keys"])]),_:1})]),2:y(()=>[g(W,{"checked-row-keys":u(Y),"onUpdate:checkedRowKeys":o[4]||(o[4]=I=>he(Y)?Y.value=I:null),columns:u(t),data:u(k),size:"small",loading:u(w),remote:"","row-key":I=>I.id,"flex-height":!0,"scroll-x":"",pagination:u(k).length?u(V):void 0,class:"sm:h-full"},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1})]),_:1})])}}}),Bo=lo(xo,[["__scopeId","data-v-b3b65bdb"]]);export{Bo as default};
