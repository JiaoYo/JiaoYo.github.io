import{_ as be}from"./table-column-setting.vue_vue_type_script_setup_true_lang-viHAmCxt.js";import{_ as _e}from"./round-search-B-4rQdSi.js";import{aM as ye,bi as Ce,bj as B,bk as H,aQ as M,aS as S,aR as oe,bl as ke,aP as xe,d as me,aW as Te,aX as ve,bm as Se,a as ce,bn as Ie,bo as $,b0 as we,i as A,aC as g,bp as ze,bq as $e,b5 as Pe,br as Ee,bs as Re,bt as Ae,bu as De,bv as We,bw as Ne,bx as Be,a8 as He,by as Le,f as h,aF as qe,ba as J,s as je,bb as Oe,bz as te,af as Me,bd as de,be as ue,ap as pe,a2 as Fe,a9 as Ve,o as he,b as Ke,w as C,g as G,h as i,a3 as Ue,y as Je,B as Ge,aa as Qe,e as ge,D as Xe,x as Ye,bA as Ze,t as eo,c as oo,S as to,ab as fe,a4 as no,A as ao,ad as ro,E as lo,az as so,X as io,I as co}from"./index-DLNUCcPL.js";import{a as uo,p as po}from"./gather-CgUFEzv8.js";import{_ as ho}from"./InputGroupLabel-glUzqV0j.js";import{_ as go}from"./Tree-DRnxY3nm.js";import{_ as fo}from"./DataTable-CN6TpDw8.js";import{_ as mo}from"./Split-DhHGxLSL.js";import"./RadioGroup-RlP9nCM5.js";import"./Forward-D55si25S.js";const vo=v=>{const{lineHeight:t,borderRadius:k,fontWeightStrong:x,baseColor:l,dividerColor:I,actionColor:F,textColor1:s,textColor2:_,closeColorHover:w,closeColorPressed:f,closeIconColor:P,closeIconColorHover:D,closeIconColorPressed:c,infoColor:n,successColor:z,warningColor:E,errorColor:R,fontSize:L}=v;return Object.assign(Object.assign({},Ce),{fontSize:L,lineHeight:t,titleFontWeight:x,borderRadius:k,border:`1px solid ${I}`,color:F,titleTextColor:s,iconColor:_,contentTextColor:_,closeBorderRadius:k,closeColorHover:w,closeColorPressed:f,closeIconColor:P,closeIconColorHover:D,closeIconColorPressed:c,borderInfo:`1px solid ${B(l,H(n,{alpha:.25}))}`,colorInfo:B(l,H(n,{alpha:.08})),titleTextColorInfo:s,iconColorInfo:n,contentTextColorInfo:_,closeColorHoverInfo:w,closeColorPressedInfo:f,closeIconColorInfo:P,closeIconColorHoverInfo:D,closeIconColorPressedInfo:c,borderSuccess:`1px solid ${B(l,H(z,{alpha:.25}))}`,colorSuccess:B(l,H(z,{alpha:.08})),titleTextColorSuccess:s,iconColorSuccess:z,contentTextColorSuccess:_,closeColorHoverSuccess:w,closeColorPressedSuccess:f,closeIconColorSuccess:P,closeIconColorHoverSuccess:D,closeIconColorPressedSuccess:c,borderWarning:`1px solid ${B(l,H(E,{alpha:.33}))}`,colorWarning:B(l,H(E,{alpha:.08})),titleTextColorWarning:s,iconColorWarning:E,contentTextColorWarning:_,closeColorHoverWarning:w,closeColorPressedWarning:f,closeIconColorWarning:P,closeIconColorHoverWarning:D,closeIconColorPressedWarning:c,borderError:`1px solid ${B(l,H(R,{alpha:.25}))}`,colorError:B(l,H(R,{alpha:.08})),titleTextColorError:s,iconColorError:R,contentTextColorError:_,closeColorHoverError:w,closeColorPressedError:f,closeIconColorError:P,closeIconColorHoverError:D,closeIconColorPressedError:c})},bo={name:"Alert",common:ye,self:vo},_o=M("alert",`
 line-height: var(--n-line-height);
 border-radius: var(--n-border-radius);
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-color);
 text-align: start;
 word-break: break-word;
`,[S("border",`
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 transition: border-color .3s var(--n-bezier);
 border: var(--n-border);
 pointer-events: none;
 `),oe("closable",[M("alert-body",[S("title",`
 padding-right: 24px;
 `)])]),S("icon",{color:"var(--n-icon-color)"}),M("alert-body",{padding:"var(--n-padding)"},[S("title",{color:"var(--n-title-text-color)"}),S("content",{color:"var(--n-content-text-color)"})]),ke({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),S("icon",`
 position: absolute;
 left: 0;
 top: 0;
 align-items: center;
 justify-content: center;
 display: flex;
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 margin: var(--n-icon-margin);
 `),S("close",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 right: 0;
 top: 0;
 margin: var(--n-close-margin);
 `),oe("show-icon",[M("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),oe("right-adjust",[M("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),M("alert-body",`
 border-radius: var(--n-border-radius);
 transition: border-color .3s var(--n-bezier);
 `,[S("title",`
 transition: color .3s var(--n-bezier);
 font-size: 16px;
 line-height: 19px;
 font-weight: var(--n-title-font-weight);
 `,[xe("& +",[S("content",{marginTop:"9px"})])]),S("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),S("icon",{transition:"color .3s var(--n-bezier)"})]),yo=Object.assign(Object.assign({},ve.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),Co=me({name:"Alert",inheritAttrs:!1,props:yo,setup(v){const{mergedClsPrefixRef:t,mergedBorderedRef:k,inlineThemeDisabled:x,mergedRtlRef:l}=Te(v),I=ve("Alert","-alert",_o,bo,v,t),F=Se("Alert",l,t),s=ce(()=>{const{common:{cubicBezierEaseInOut:c},self:n}=I.value,{fontSize:z,borderRadius:E,titleFontWeight:R,lineHeight:L,iconSize:V,iconMargin:W,iconMarginRtl:Q,closeIconSize:X,closeBorderRadius:Y,closeSize:Z,closeMargin:ne,closeMarginRtl:ae,padding:re}=n,{type:T}=v,{left:le,right:K}=Ie(W);return{"--n-bezier":c,"--n-color":n[$("color",T)],"--n-close-icon-size":X,"--n-close-border-radius":Y,"--n-close-color-hover":n[$("closeColorHover",T)],"--n-close-color-pressed":n[$("closeColorPressed",T)],"--n-close-icon-color":n[$("closeIconColor",T)],"--n-close-icon-color-hover":n[$("closeIconColorHover",T)],"--n-close-icon-color-pressed":n[$("closeIconColorPressed",T)],"--n-icon-color":n[$("iconColor",T)],"--n-border":n[$("border",T)],"--n-title-text-color":n[$("titleTextColor",T)],"--n-content-text-color":n[$("contentTextColor",T)],"--n-line-height":L,"--n-border-radius":E,"--n-font-size":z,"--n-title-font-weight":R,"--n-icon-size":V,"--n-icon-margin":W,"--n-icon-margin-rtl":Q,"--n-close-size":Z,"--n-close-margin":ne,"--n-close-margin-rtl":ae,"--n-padding":re,"--n-icon-margin-left":le,"--n-icon-margin-right":K}}),_=x?we("alert",ce(()=>v.type[0]),s,v):void 0,w=A(!0),f=()=>{const{onAfterLeave:c,onAfterHide:n}=v;c&&c(),n&&n()};return{rtlEnabled:F,mergedClsPrefix:t,mergedBordered:k,visible:w,handleCloseClick:()=>{var c;Promise.resolve((c=v.onClose)===null||c===void 0?void 0:c.call(v)).then(n=>{n!==!1&&(w.value=!1)})},handleAfterLeave:()=>{f()},mergedTheme:I,cssVars:x?void 0:s,themeClass:_==null?void 0:_.themeClass,onRender:_==null?void 0:_.onRender}},render(){var v;return(v=this.onRender)===null||v===void 0||v.call(this),g(Re,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:t,$slots:k}=this,x={class:[`${t}-alert`,this.themeClass,this.closable&&`${t}-alert--closable`,this.showIcon&&`${t}-alert--show-icon`,!this.title&&this.closable&&`${t}-alert--right-adjust`,this.rtlEnabled&&`${t}-alert--rtl`],style:this.cssVars,role:"alert"};return this.visible?g("div",Object.assign({},ze(this.$attrs,x)),this.closable&&g($e,{clsPrefix:t,class:`${t}-alert__close`,onClick:this.handleCloseClick}),this.bordered&&g("div",{class:`${t}-alert__border`}),this.showIcon&&g("div",{class:`${t}-alert__icon`,"aria-hidden":"true"},Pe(k.icon,()=>[g(Ae,{clsPrefix:t},{default:()=>{switch(this.type){case"success":return g(Be,null);case"info":return g(Ne,null);case"warning":return g(We,null);case"error":return g(De,null);default:return null}}})])),g("div",{class:[`${t}-alert-body`,this.mergedBordered&&`${t}-alert-body--bordered`]},Ee(k.header,l=>{const I=l||this.title;return I?g("div",{class:`${t}-alert-body__title`},I):null}),k.default&&g("div",{class:`${t}-alert-body__content`},k))):null}})}}),ko={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},xo={class:"flex flex-col"},To=me({name:"configsetting_realtimedata_devicedata",__name:"index",setup(v){const{columns:t,columnChecks:k,data:x,getData:l,loading:I,mobilePagination:F,searchParams:s,resetSearchParams:_}=He({apiFn:Le,apiParams:{page:1,pageSize:200,limit:200,tagType:null,chlid:null,devId:null,fuzzy:"",chlType:0,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"序号",align:"center",width:80},{key:"devId",title:"设备名称",align:"center",width:100,render:e=>{var o;return h("span",null,[(o=P.value.find(a=>a.id==e.devId))==null?void 0:o.devName])}},{key:"tagName",title:"测点名称",align:"center"},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center"},{key:"value",title:"测点值",align:"center",width:140,render:e=>{var o;return g("span",{style:{color:e.quality===100?"red":e.quality==49?"#409eff":e.quality==50?"#909399":"#67c23a"}},parseFloat((o=e.value)==null?void 0:o.toFixed(6))||e.value)}},{key:"quality",title:"质量",align:"center",width:120,render:e=>(e.quality==100||e.quality==49||e.quality==0)&&g(qe,{style:{background:e.quality===100?"red":e.quality==49?"#409eff":"#67c23a",color:"#fff"}},e.quality==0?"Good":e.quality==49?"人工置数":e.quality==100?"Bad":"")},{key:"dbtime",title:"采集时间",align:"center",minWidth:120,render:e=>{var o,a;return g("span",{title:J(0,+e.dbtime)},e.dbtime?(a=J(2,+e.dbtime))==null?void 0:a.substring(10,(o=J(2,+e.dbtime))==null?void 0:o.length):"")}},{key:"tagType",title:"测点类型",align:"center",width:140,render:e=>h("span",null,[uo[e.tagType]])},{key:"objAddr",title:"地址",align:"center",width:140}]}),w=e=>{e===""&&l()};je(async()=>{await D(),L(),n()}),Oe(()=>{var e;(e=c.value)==null||e.close(),z.value.close(),te({startTime:"",endTime:""})});const f=A(),P=A([]),D=async()=>{const{data:e,error:o}=await Me();if((e==null?void 0:e.length)==0)return;function a(r){return r.map(u=>{var p;return{label:u.chlName,key:u.id,dev_status:null,children:(p=u.devicePojoList)!=null&&p.length?u.devicePojoList.map(d=>(P.value.push(d),{label:d.devName,dev_status:null,chlType:u.chlType,key:d.id})):[]}})}f.value=a(e),s.chlid=f.value[0].key,s.devId=f.value[0].children[0].key,V.value=[f.value[0].children[0].key],W.value=f.value[0].children[0].label,ie(),l()},c=A(null),n=()=>{var u;(u=c.value)==null||u.close();const e=new de;let o="";e.appendAsciiStr("$Link+Qi^123987WWg#getchlstatus"),o=e.end();const a=new Date().getTime(),r=new ue(pe.replace("https","wss")+`/ChannelStatusWebsocket/getchlstatus/${o}/${a}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});c.value=r,r.connect(),r.onclose(()=>{}),r.onerror(()=>{}),r.onopen(()=>{}),r.onmessage(p=>{let d=[];console.log(p,"通道状态websocket接受数据"),se(p.data)&&(d=JSON.parse(p.data).data,f.value.forEach(m=>{d.forEach(b=>{var q;b.chl_id==m.key&&(m.dev_status=b.chl_status),b.chl_id==1&&(m.dev_status=1),(q=m.children)==null||q.forEach(N=>{var O;(O=b.devs)==null||O.forEach(j=>{j.dev_id==N.key&&(N.dev_status=j.dev_status),j.dev_id==1&&(N.dev_status=1)})})})}))})},z=A(null),E=A(""),R=A(!0),L=()=>{var u;(u=z.value)==null||u.close(),R.value=!0;const e=new de;let o="";const a=new Date().getTime();e.appendAsciiStr("$Link+Qi^123987WWg#"+a),o=e.end();const r=new ue(pe.replace("https","wss")+`/realTimeDataWebsocket/${W.value}/${o}/${a}`,{maxReconnectAttempts:3,heartbeatInterval:1e3*30});z.value=r,r.connect(),r.onclose(()=>{}),r.onerror(()=>{}),r.onopen(()=>{}),r.onmessage(p=>{let d=[];console.log(p,"实时数据websocket接受数据"),se(p.data)&&(d=JSON.parse(p.data).data[W.value],d==null||d.forEach(m=>{x.value.forEach(b=>{m.i==b.id&&(b.quality=m.q,b.value=m.v,b.dbtime=m.t)})}),E.value=Z())})},V=A([]),W=A(""),Q=async(e,o,a)=>{var p,d,m,b,q,N;V.value=[(p=a.node)==null?void 0:p.key],((d=a.node)==null?void 0:d.label)=="系统设备"?ie():te({startTime:"",endTime:""}),s.chlType=(m=a.node)==null?void 0:m.chlType;function r(O,j){for(const U of O)if(U.children){for(const ee of U.children)if(ee.key===j)return U.key}return null}const u=await r(f.value,(b=a.node)==null?void 0:b.key);s.chlid=u,s.devId=(q=a.node)==null?void 0:q.key,W.value=(N=a.node)==null?void 0:N.label,l(),L()},X=e=>{e&&x.value.length>0?L():z.value.close()};Fe(()=>s.tagType,e=>{e||l()});const Y=({option:e})=>e.key==0?"":e.dev_status!==null?g("span",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:e.hasOwnProperty("dev_status")&&e.dev_status==1?"#00b42a":e.dev_status==2?"#ff0000":"#ccc"}}):"",Z=e=>{const o=new Date,a=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),u=String(o.getDate()).padStart(2,"0"),p=String(o.getHours()).padStart(2,"0"),d=String(o.getMinutes()).padStart(2,"0"),m=String(o.getSeconds()).padStart(2,"0");return`${a}-${r}-${u} ${p}:${d}:${m}`},{drawerVisible:ne,operateType:ae,editingData:re,handleAdd:T,handleEdit:le,checkedRowKeys:K,onBatchDeleted:So,onDeleted:Io}=Ve(x,l),se=e=>{try{return JSON.parse(e),!0}catch{return!1}},ie=async()=>{te({startTime:J(1,new Date().getTime()-18e5),endTime:J(1,new Date().getTime())})};return(e,o)=>{const a=ho,r=no,u=ao,p=_e,d=ro,m=Co,b=lo,q=be,N=go,O=so,j=fo,U=mo,ee=io;return he(),Ke("div",ko,[h(ee,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:C(()=>[h(b,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:C(()=>[h(d,null,{default:C(()=>[h(a,null,{default:C(()=>[G("测点类型")]),_:1}),h(r,{filterable:"",clearable:"",placeholder:"请选择",value:i(s).tagType,"onUpdate:value":o[0]||(o[0]=y=>i(s).tagType=y),options:i(Ue)(i(po))},null,8,["value","options"]),h(u,{clearable:"",value:i(s).fuzzy,"onUpdate:value":[o[1]||(o[1]=y=>i(s).fuzzy=y),w],placeholder:"请输入测点名称或描述",style:{width:"150%"},onKeyup:Je(i(l),["enter"])},null,8,["value","onKeyup"]),h(i(Ge),{type:"primary",ghost:"",onClick:i(l)},{icon:C(()=>[h(p,{class:Qe(["text-icon",{"animate-spin":i(I)}])},null,8,["class"])]),default:C(()=>[G(" 搜索 ")]),_:1},8,["onClick"])]),_:1}),ge("div",xo,[h(i(Xe),{checked:R.value,"onUpdate:checked":[o[2]||(o[2]=y=>R.value=y),X]},{default:C(()=>[G(" 实时刷新 ")]),_:1},8,["checked"]),Ye(ge("span",{class:"font-size-14px color-blank",style:{"font-weight":"600"}}," 刷新时间："+eo(E.value),513),[[Ze,E.value]])]),W.value=="系统设备"&&i(x).every(y=>y.quality==0||y.quality==null)?(he(),oo(m,{key:0,type:"error"},{default:C(()=>[G(" 检测到预测服务异常 ")]),_:1})):to("",!0)]),_:1})]),"header-extra":C(()=>[h(b,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:C(()=>[h(q,{columns:i(k),"onUpdate:columns":o[3]||(o[3]=y=>fe(k)?k.value=y:null)},null,8,["columns"])]),_:1})]),default:C(()=>[h(U,{direction:"horizontal",class:"sm:h-full","default-size":.15,max:.35,min:.1,"resize-trigger-size":6},{1:C(()=>[h(O,{style:{"max-height":"700px"}},{default:C(()=>[h(N,{"block-line":"","default-expand-all":"",data:f.value,"checked-keys":V.value,"expand-on-click":!1,"render-prefix":Y,"check-strategy":"child","onUpdate:checkedKeys":Q,checkable:""},null,8,["data","checked-keys"])]),_:1})]),2:C(()=>[h(j,{"checked-row-keys":i(K),"onUpdate:checkedRowKeys":o[4]||(o[4]=y=>fe(K)?K.value=y:null),columns:i(t),data:i(x),size:"small",loading:i(I),remote:"","row-key":y=>y.id,"flex-height":!0,"scroll-x":"",pagination:i(x).length?i(F):void 0,class:"sm:h-full"},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1})]),_:1})])}}}),Bo=co(To,[["__scopeId","data-v-2415d7ea"]]);export{Bo as default};
