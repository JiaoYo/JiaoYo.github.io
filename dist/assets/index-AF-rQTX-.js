import{_ as Ce}from"./table-column-setting.vue_vue_type_script_setup_true_lang-C5T6qI4Z.js";import{_ as ze,a as Je}from"./round-settings-TdGRnxzl.js";import{_ as Ee}from"./round-delete-DtKNWdqK.js";import{_ as Ie}from"./round-add-DHq7LewR.js";import{_ as Ve}from"./round-search-CxXrOyeP.js";import{d as re,Z as le,i as O,a0 as _e,r as we,p as qe,q as je,a2 as ge,ac as Ae,ap as Fe,a as Re,$ as U,v as Be,o as L,c as ae,w as o,f as a,g as N,t as $,h as i,y as Se,x as Oe,a3 as G,S as ee,b as se,aq as fe,e as he,ar as Ge,as as Le,at as $e,au as ve,av as We,aw as Ke,A as be,ag as Xe,a5 as Ze,a4 as ie,E as te,F as xe,ax as He,B as V,a6 as ye,s as Qe,ay as Ye,az as ea,aA as pe,aB as aa,a1 as la,a7 as ta,aC as na,aD as oa,aE as ke,a8 as de,a9 as me,aa as sa,ab as ia,X as ra}from"./index-CUNPF4fr.js";import{u as ca,a as ua}from"./table-CeWmGbcP.js";import{e as pa,f as da,g as ma,h as fa,s as ha,i as va,j as _a}from"./gather-BcBfSMFi.js";import{_ as De}from"./FormItemGridItem-Cu1Fv0hk.js";import{_ as ga}from"./Cascader-DYgUhkDo.js";import{_ as ba,a as ya}from"./RadioGroup-Dt9BXj20.js";import{_ as Te}from"./Grid-B_xMmVkO.js";import{_ as Ue}from"./DataTable-DCVZic8E.js";import{N as Me}from"./Popconfirm-TqA8qQDw.js";import{_ as Pa}from"./InputGroupLabel-nrGc56zv.js";import"./Forward-D2lkVYwM.js";const wa=he("span",null,"批量新增：格式为（采集通道1-10）",-1),ka=re({__name:"add_model",props:le({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:le(["submitted"],["update:visible"]),setup(x,{emit:H}){const B=[{value:0,label:"采集通道"}],b=O(!1),_=_e(x,"visible"),k=H,d=x,e=we(y());function y(){return{chlName:"采集通道1",chlType:0,chlAddr:1,chlProtocol:"{348E12D3-308A-40da-B1AA-489F326C5695}",chlColtFreq:500,chlWaitTime:300,chlDesc:void 0,protocolType:1,chlValid:1,chlEnableBkup:0,chlMainParam:{com_name:"",timeout:void 0,baud:void 0,check_bit:void 0,stop_bit:void 0,data_bit:void 0,role:void 0,ip_addr:void 0,port:void 0,reserve0:void 0,reserve1:void 0,reserve2:void 0,reserve3:void 0},chlBkupParam:{com_name:"",timeout:void 0,baud:void 0,check_bit:void 0,stop_bit:void 0,data_bit:void 0,role:void 0,ip_addr:void 0,port:void 0,reserve0:void 0,reserve1:void 0,reserve2:void 0,reserve3:void 0}}}function D(){Object.assign(e,y()),d.operateType==="edit"&&d.rowData?(Object.assign(e,d.rowData),e.chlMainParam=JSON.parse(e.chlMainParam),e.chlValid=e.chlValid==2?2:1,e.chlBkupParam&&JSON.stringify(e.chlBkupParam)!=="{}"?e.chlBkupParam=JSON.parse(e.chlBkupParam):e.chlBkupParam=Object.assign({},e.chlBkupParam)):j("2",void 0)}const{formRef:M,validate:z,restoreValidation:P}=qe();je(),ge(_,async()=>{_.value&&(d.operateType==="add"&&Ae(()=>{setTimeout(()=>{b.value=!0},200)}),await X(),D(),P())});const w=()=>{_.value=!1,b.value=!1},q=async()=>{var m,l,c,f,n,p,h,A,F;if(await z(),e.protocolType==0?(e.chlMainParam=JSON.stringify({reserve0:e.chlMainParam.reserve0,reserve1:e.chlMainParam.reserve1,reserve2:e.chlMainParam.reserve2,reserve3:e.chlMainParam.reserve3,role:e.chlMainParam.role,ip_addr:e.chlMainParam.ip_addr,port:e.chlMainParam.port,timeout:e.chlMainParam.timeout}),e.chlEnableBkup===1?e.chlBkupParam=JSON.stringify({reserve0:e.chlBkupParam.reserve0,reserve1:e.chlBkupParam.reserve1,reserve2:e.chlBkupParam.reserve2,reserve3:e.chlBkupParam.reserve3,role:e.chlBkupParam.role,ip_addr:e.chlBkupParam.ip_addr,port:e.chlBkupParam.port,timeout:e.chlBkupParam.timeout}):e.chlBkupParam=JSON.stringify({})):(e.chlMainParam=JSON.stringify({reserve0:e.chlMainParam.reserve0,reserve1:e.chlMainParam.reserve1,timeout:e.chlMainParam.timeout,com_name:e.chlMainParam.com_name,baud:e.chlMainParam.baud,check_bit:e.chlMainParam.check_bit,stop_bit:e.chlMainParam.stop_bit,data_bit:e.chlMainParam.data_bit}),e.chlEnableBkup===1?e.chlBkupParam=JSON.stringify({reserve0:e.chlBkupParam.reserve0,reserve1:e.chlBkupParam.reserve1,timeout:e.chlBkupParam.timeout,com_name:e.chlBkupParam.com_name,baud:e.chlBkupParam.baud,check_bit:e.chlBkupParam.check_bit,stop_bit:e.chlBkupParam.stop_bit,data_bit:e.chlBkupParam.data_bit}):e.chlBkupParam=JSON.stringify({})),d.operateType==="add"){let S=[],J=[],Z=[],C=e.chlName;if(((m=e.chlName)==null?void 0:m.indexOf("-"))!=-1){let K=Math.abs(C==null?void 0:C.substring(C.lastIndexOf("-")).replace(/[^0-9]/gi,"")),T=C.split(/-(?![^-]*-)/),E=C.substring(0,C.lastIndexOf("-")).match(/(\d+)[^0-9]*$/)[1],t=E.replace(/[^0]/g,""),Y=E,oe=T[0],R=oe.substring(0,oe.length-oe.match(/(\d+)[^0-9]*$/)[1].length),ce=K-E+1;for(let Pe=0;Pe<ce;Pe++){let I=Y++,ue=JSON.parse(JSON.stringify(e));ue.chlName=parseInt(E)==0?t.length>0?String(I).length>=t.length?R+I:R+t.substring(0,t.length-String(I).length)+I:R+I:t.length>0?I>=10?R+t.substring(0,t.length-String(I).length+1)+I:R+t.substring(0,t.length)+I:R+I,S.push(ue),J.push(ue.chlName)}}else S=[e],J=[e.chlName];const{data:ne,error:Q}=await Ge(S);if(Q)e.chlMainParam=JSON.parse(e.chlMainParam),e.chlBkupParam=JSON.parse(e.chlBkupParam);else{const K=await Le({page:1,limit:1e3,chlType:0,_t:new Date().getTime()});if(K.data.list.length>0)if(K.data.list.forEach(T=>{J.includes(T.chlName)&&Z.push(T.id)}),Z.length==0)(l=window.$message)==null||l.destroyAll(),(c=window.$message)==null||c.success("添加成功"),w(),k("submitted");else{const T=await $e({guid:S[0].chlProtocol});if(!T.error){if(T.data.length==0){(f=window.$message)==null||f.destroyAll(),(n=window.$message)==null||n.success("通道添加成功，未查询到该协议的规约信息"),w(),k("submitted");return}const E=Z.map(async t=>{var R;const Y=T.data.map(ce=>({...ce,chlId:t}));return(await ve(Y)).error?((R=window.$message)==null||R.error("通道添加成功，规约信息添加失败"),Promise.reject(new Error("通道添加成功，规约信息添加失败"))):Promise.resolve()});Promise.all(E).then(()=>{var t,Y;(t=window.$message)==null||t.destroyAll(),(Y=window.$message)==null||Y.success("添加成功"),w(),k("submitted")}).catch(t=>{console.error(t)})}}else(p=window.$message)==null||p.destroyAll(),(h=window.$message)==null||h.success("添加成功"),w(),k("submitted")}}else{const{data:S,error:J}=await We([e]);J?(e.chlMainParam=JSON.parse(e.chlMainParam),e.chlBkupParam=JSON.parse(e.chlBkupParam)):((A=window.$message)==null||A.destroyAll(),(F=window.$message)==null||F.success("修改成功"),w(),k("submitted"))}};let W=we([]);const X=async()=>{const{data:m}=await Fe({type:0}),l=JSON.parse(m);function c(f){return Object.keys(f).map(n=>{const p=f[n];return{label:n,value:n,children:p.map(h=>{const[A,F]=Object.entries(h)[0];return{label:A,value:A,children:F.map(S=>({label:S.name,value:S.gUID,id:S.id}))}})}})}W=c(l)},j=async(m,l)=>{console.log(m,l);const{data:c,error:f}=await Ke({id:l?l.id:2});if(!f){e.protocolType=c.type;let n=JSON.parse(c.defaultCfg);e.chlMainParam=Object.assign(e.chlMainParam,n),e.chlEnableBkup===1&&(e.chlBkupParam=Object.assign(e.chlBkupParam,n))}},s={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},r={type:"number",required:!0,trigger:["blur","change"],message:"不能为空"},u={required:!0,validator(m,l){let c="^((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$";return new RegExp(c).test(l)?!0:new Error("IP地址错误")},trigger:["input","blur"]},g={chlName:s,chlType:r,chlAddr:r,chlWaitTime:r,chlColtFreq:r,protocolType:r,chlValid:r,chlEnableBkup:r,chlProtocol:s,chlMainParam:{role:r,com_name:s,timeout:r,baud:r,check_bit:r,stop_bit:r,data_bit:r,ip_addr:[s,u],port:r},chlBkupParam:{role:r,com_name:s,timeout:r,baud:r,check_bit:r,stop_bit:r,data_bit:r,ip_addr:[s,u],port:r}},v=Re(()=>({add:U("common.add"),edit:U("common.edit")})[d.operateType]);return(m,l)=>{const c=be,f=Xe,n=De,p=Ze,h=ie,A=ga,F=ba,S=te,J=ya,Z=Te,C=xe,ne=He,Q=V,K=te,T=ye,E=Be("no-space");return L(),ae(T,{show:_.value,"onUpdate:show":l[25]||(l[25]=t=>_.value=t),title:v.value,preset:"card",class:"w-50%",onAfterLeave:w},{footer:o(()=>[a(K,{size:16,justify:"end"},{default:o(()=>[a(Q,{onClick:w},{default:o(()=>[N($(i(U)("common.cancel")),1)]),_:1}),a(Q,{type:"primary",onClick:q},{default:o(()=>[N($(i(U)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(ne,{style:{"max-height":"80vh"}},{default:o(()=>[a(C,{ref_key:"formRef",ref:M,model:e,rules:g,"label-placement":"left","label-width":140,"require-mark-placement":"left",onKeyup:Se(q,["enter"])},{default:o(()=>[a(Z,{responsive:"screen","item-responsive":""},{default:o(()=>[a(n,{span:"24 m:12",label:"通道名称",path:"chlName"},{default:o(()=>[a(f,{show:b.value,placement:"top-start"},{trigger:o(()=>[Oe(a(c,{clearable:"",value:e.chlName,"onUpdate:value":l[0]||(l[0]=t=>e.chlName=t),placeholder:"请输入通道名称"},null,8,["value"]),[[E]])]),default:o(()=>[wa]),_:1},8,["show"])]),_:1}),a(n,{span:"24 m:12",label:"通道描述",path:"chlDesc"},{default:o(()=>[a(c,{clearable:"",value:e.chlDesc,"onUpdate:value":l[1]||(l[1]=t=>e.chlDesc=t),placeholder:"请输入通道描述"},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"通道地址",path:"chlAddr"},{default:o(()=>[a(p,{clearable:"",value:e.chlAddr,"onUpdate:value":l[2]||(l[2]=t=>e.chlAddr=t),placeholder:"请输入通道地址",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"通道类型",path:"chlType"},{default:o(()=>[a(h,{filterable:"",clearable:"",placeholder:"请选择通道类型",value:e.chlType,"onUpdate:value":l[3]||(l[3]=t=>e.chlType=t),disabled:"",options:B},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"交互频率(ms)",path:"chlColtFreq"},{default:o(()=>[a(p,{clearable:"",value:e.chlColtFreq,"onUpdate:value":l[4]||(l[4]=t=>e.chlColtFreq=t),placeholder:"请输入交互频率",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"每帧间隔(ms)",path:"chlWaitTime"},{default:o(()=>[a(p,{clearable:"",value:e.chlWaitTime,"onUpdate:value":l[5]||(l[5]=t=>e.chlWaitTime=t),placeholder:"请输入每帧间隔",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"协议名称",path:"chlProtocol"},{default:o(()=>[a(A,{value:e.chlProtocol,"onUpdate:value":[l[6]||(l[6]=t=>e.chlProtocol=t),j],placeholder:"请选择协议名称","expand-trigger":"click",options:i(W),"check-strategy":"child","show-path":!1},null,8,["value","options"])]),_:1}),a(n,{span:"24 m:12",label:"协议类型",path:"protocolType"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择协议类型",value:e.protocolType,"onUpdate:value":l[7]||(l[7]=t=>e.protocolType=t),options:i(G)(i(pa))},null,8,["value","options"])]),_:1}),d.operateType=="edit"?(L(),ae(n,{key:0,span:"24 m:24",label:"通道有效性",path:"chlValid"},{default:o(()=>[a(J,{value:e.chlValid,"onUpdate:value":l[8]||(l[8]=t=>e.chlValid=t),name:"radiogroup"},{default:o(()=>[a(S,null,{default:o(()=>[a(F,{label:"是",value:1}),a(F,{label:"否",value:2})]),_:1})]),_:1},8,["value"])]),_:1})):ee("",!0),e.protocolType!==0?(L(),se(fe,{key:1},[a(n,{span:"24 m:12",label:"串口名称",path:"chlMainParam.com_name"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.com_name,"onUpdate:value":l[9]||(l[9]=t=>e.chlMainParam.com_name=t),options:i(G)(i(da))},null,8,["value","options"])]),_:1}),a(n,{span:"24 m:12",label:"波特率",path:"chlMainParam.baud"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.baud,"onUpdate:value":l[10]||(l[10]=t=>e.chlMainParam.baud=t),options:i(G)(i(ma))},null,8,["value","options"])]),_:1}),a(n,{span:"24 m:12",label:"数据位",path:"chlMainParam.data_bit"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.data_bit,"onUpdate:value":l[11]||(l[11]=t=>e.chlMainParam.data_bit=t),options:i(G)(i(fa))},null,8,["value","options"])]),_:1}),a(n,{span:"24 m:12",label:"停止位",path:"chlMainParam.stop_bit"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.stop_bit,"onUpdate:value":l[12]||(l[12]=t=>e.chlMainParam.stop_bit=t),options:i(G)(i(ha))},null,8,["value","options"])]),_:1}),a(n,{span:"24 m:12",label:"校验位",path:"chlMainParam.check_bit"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.check_bit,"onUpdate:value":l[13]||(l[13]=t=>e.chlMainParam.check_bit=t),options:i(G)(i(va))},null,8,["value","options"])]),_:1}),a(n,{span:"24 m:12",label:"保留0"},{default:o(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve0,"onUpdate:value":l[14]||(l[14]=t=>e.chlMainParam.reserve0=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"超时",path:"chlMainParam.timeout"},{default:o(()=>[a(p,{clearable:"",value:e.chlMainParam.timeout,"onUpdate:value":l[15]||(l[15]=t=>e.chlMainParam.timeout=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"保留1"},{default:o(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve1,"onUpdate:value":l[16]||(l[16]=t=>e.chlMainParam.reserve1=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1})],64)):ee("",!0),e.protocolType==0?(L(),ae(n,{key:2,span:"24 m:12",label:"通讯方向",path:"chlMainParam.role"},{default:o(()=>[a(h,{filterable:"",placeholder:"请选择",value:e.chlMainParam.role,"onUpdate:value":l[17]||(l[17]=t=>e.chlMainParam.role=t),options:i(G)(i(_a))},null,8,["value","options"])]),_:1})):ee("",!0),e.protocolType==0?(L(),se(fe,{key:3},[a(n,{span:"24 m:12",label:"保留0"},{default:o(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve0,"onUpdate:value":l[18]||(l[18]=t=>e.chlMainParam.reserve0=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"IP/域名",path:"chlMainParam.ip_addr"},{default:o(()=>[a(c,{clearable:"",value:e.chlMainParam.ip_addr,"onUpdate:value":l[19]||(l[19]=t=>e.chlMainParam.ip_addr=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"保留1"},{default:o(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve1,"onUpdate:value":l[20]||(l[20]=t=>e.chlMainParam.reserve1=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"端口号",path:"chlMainParam.port"},{default:o(()=>[a(p,{clearable:"",min:1,max:65535,value:e.chlMainParam.port,"onUpdate:value":l[21]||(l[21]=t=>e.chlMainParam.port=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"保留2"},{default:o(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve2,"onUpdate:value":l[22]||(l[22]=t=>e.chlMainParam.reserve2=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"超时",path:"chlMainParam.timeout"},{default:o(()=>[a(p,{clearable:"",value:e.chlMainParam.timeout,"onUpdate:value":l[23]||(l[23]=t=>e.chlMainParam.timeout=t),placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(n,{span:"24 m:12",label:"保留3"},{default:o(()=>[a(c,{clearable:"",value:e.chlMainParam.reserve3,"onUpdate:value":l[24]||(l[24]=t=>e.chlMainParam.reserve3=t),placeholder:"可空",style:{width:"100%"}},null,8,["value"])]),_:1})],64)):ee("",!0)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ma={class:"font-size-16px"},Na=re({__name:"regulations_model",props:le({channelId:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:le(["submitted"],["update:visible"]),setup(x,{emit:H}){const B=O({}),b=O([]),_=O([]),k=O(!1),d=O(!1),e=O(!1),y=_e(x,"visible"),D=H,M=x;ge(()=>M.channelId,s=>{}),Qe(async()=>{await z(),await w()});const z=async()=>{try{d.value=!0;const{data:s,error:r}=await Ye({id:M.channelId});r||(B.value=s)}catch{d.value=!1}},P=async s=>{let r=[];try{const{data:u,error:g}=await $e({guid:B.value.chlProtocol});if(!g){if(u.forEach(v=>{v.foptions&&(v.foptions=v.foptions?JSON.parse(v.foptions):v.foptions)}),k.value)if(s.length>0){let v=u.sort((l,c)=>l.fno>c.fno?1:-1),m=s.sort((l,c)=>l.fno>c.fno?1:-1);_.value=v.filter(l=>m.some(c=>c.fname===l.fname&&c.fno===l.fno)),u.forEach(l=>{s.forEach(c=>{l.fname==c.fname&&l.fno==c.fno&&(l.id=c.id,l.fdesc=c.fdesc,l.fdataflag=c.fdataflag,l.fpno=c.fpno,l.fvalue=c.fvalue)}),r.push({chlId:M.channelId,fname:l.fname,fpno:s[0].fpno,fno:l.fno,fdesc:l.fdesc,fdataflag:l.fdataflag,fvalue:l.fvalue,foptions:l.foptions})}),r=r.sort((l,c)=>l.fno>c.fno?1:-1),b.value=r}else b.value=u;else b.value=u;d.value=!1}}catch{d.value=!1}},w=async()=>{try{const{data:s,error:r}=await ea({chlId:M.channelId});r||(s.forEach(u=>{u.foptions&&(u.foptions=JSON.parse(u.foptions))}),s.length>0?k.value=!0:k.value=!1,await P(s),d.value=!1)}catch{d.value=!1}},q=[{key:"fno",title:"编号",align:"center",width:60},{key:"fdesc",title:"参数描述",align:"center",width:160},{key:"fvalue",title:"参数类型",align:"center",width:100,render(s,r){var u;return pe(ie,{value:s.fdataflag,options:[{label:"文本",value:2},{label:"10进制",value:10},{label:"16进制",value:16}],onUpdateValue:g=>{s.fdataflag=g},disabled:((u=s.foptions)==null?void 0:u.length)>0})}},{key:"foptions",title:"参数值",align:"center",width:160,render(s,r){return s.foptions?pe(ie,{value:s.fvalue,onUpdateValue:u=>{s.fvalue=u},options:s.foptions,labelField:"desc",valueField:"value"}):pe(be,{value:s.fvalue,onUpdateValue:u=>{s.fvalue=u}})}}],W=async()=>{var r,u,g,v;let s=JSON.parse(JSON.stringify(b.value));if(k.value){_.value.forEach(f=>{f.chlId=M.channelId,f.foptions&&(f.foptions=JSON.stringify(f.foptions)),b.value.forEach(n=>{f.fname===n.fname&&f.fno===n.fno&&(f.fvalue=n.fvalue,f.fdataflag=n.fdataflag)})});let m=s.filter(f=>!_.value.some(n=>n.fname===f.fname&&n.fno===f.fno));const{data:l,error:c}=await aa(_.value);c||(m.length>0?await X(m):((r=window.$message)==null||r.destroyAll(),(u=window.$message)==null||u.success("配置成功"),y.value=!1,D("submitted")))}else{s.forEach(c=>{c.chlId=M.channelId,c.foptions&&(c.foptions=JSON.stringify(c.foptions))});const{data:m,error:l}=await ve(s);l||((g=window.$message)==null||g.destroyAll(),(v=window.$message)==null||v.success("配置成功"),y.value=!1,D("submitted"))}},X=async s=>{var g,v;s.forEach(m=>{m.chlId=M.channelId,m.foptions&&(m.foptions=JSON.stringify(m.foptions))});const{data:r,error:u}=await ve(s);u||((g=window.$message)==null||g.destroyAll(),(v=window.$message)==null||v.success("配置成功"),y.value=!1,D("submitted"))},j=s=>{};return(s,r)=>{const u=Ue,g=V,v=te,m=ye;return L(),ae(m,{show:y.value,"onUpdate:show":r[2]||(r[2]=l=>y.value=l),preset:"card",class:"w-40% h-700px"},{header:o(()=>[he("span",null,[N("规约特征配置"),he("span",Ma,"(通道："+$(B.value.chlName)+" 协议："+$(B.value.name)+")",1)])]),footer:o(()=>[a(v,{size:16,justify:"end"},{default:o(()=>[a(g,{disabled:!k.value,class:"w-140px mb-10px",onClick:r[0]||(r[0]=l=>P([]))},{default:o(()=>[N($("还原默认设置"))]),_:1},8,["disabled"]),a(g,{onClick:r[1]||(r[1]=l=>y.value=!1),class:"w-100px"},{default:o(()=>[N($(s.$t("common.cancel")),1)]),_:1}),a(g,{type:"primary",disabled:e.value,class:"w-100px",onClick:W},{default:o(()=>[N($(s.$t("common.confirm")),1)]),_:1},8,["disabled"])]),_:1})]),default:o(()=>[a(u,{columns:q,data:b.value,size:"small",loading:d.value,remote:"","row-key":l=>l.id,class:"h-full","flex-height":"",onScroll:j},null,8,["data","loading","row-key"])]),_:1},8,["show"])}}}),Ba=re({__name:"merge_model",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:le(["submitted"],["update:visible"]),setup(x,{emit:H}){const b=la({0:"采集104tcp",1:"采集104udp"}),_=_e(x,"visible"),k=O(null),d=O({targetDevice:void 0,EquipmentMerged:void 0}),e=()=>{},D={targetDevice:{type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},EquipmentMerged:{type:"array",required:!0,message:"不能为空",trigger:["input","blur"]}},M=O(!1);return(z,P)=>{const w=ie,q=De,W=Te,X=xe,j=V,s=te,r=ye;return L(),se(fe,null,[a(r,{show:_.value,"onUpdate:show":P[3]||(P[3]=u=>_.value=u),title:"通道合并",preset:"card",class:"w-40%"},{footer:o(()=>[a(s,{size:16,justify:"center"},{default:o(()=>[a(j,{onClick:P[2]||(P[2]=u=>_.value=!1),class:"w-100px"},{default:o(()=>[N($(z.$t("common.cancel")),1)]),_:1}),a(j,{type:"primary",class:"w-100px",onClick:e},{default:o(()=>[N($(z.$t("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(X,{ref_key:"formRef",ref:k,"label-width":120,"label-placement":"left",model:d.value,rules:D},{default:o(()=>[a(W,{responsive:"screen","item-responsive":""},{default:o(()=>[a(q,{span:"24 m:12",label:"目标通道",path:"targetDevice"},{default:o(()=>[a(w,{filterable:"",clearable:"",placeholder:"请选择通道",value:d.value.targetDevice,"onUpdate:value":P[0]||(P[0]=u=>d.value.targetDevice=u),options:i(G)(i(b))},null,8,["value","options"])]),_:1}),a(q,{span:"24 m:12",label:"待合并通道",path:"EquipmentMerged"},{default:o(()=>[a(w,{multiple:"",filterable:"",clearable:"",placeholder:"请选择通道",value:d.value.EquipmentMerged,"onUpdate:value":P[1]||(P[1]=u=>d.value.EquipmentMerged=u),options:i(G)(i(b))},null,8,["value","options"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),a(r,{show:M.value,"onUpdate:show":P[4]||(P[4]=u=>M.value=u),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),Sa={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Ne(x){return typeof x=="function"||Object.prototype.toString.call(x)==="[object Object]"&&!sa(x)}const Ra=re({name:"configsetting_collectionservices_channelmanagement",__name:"index",setup(x){const H=ta(),B=O(!1),b=O(),_=O(!1),{columns:k,columnChecks:d,data:e,getData:y,loading:D,mobilePagination:M,searchParams:z,resetSearchParams:P}=ca({apiFn:na,apiParams:{page:1,pageSize:20,limit:20,fuzzy:null,chlType:0,_t:new Date().getTime()},columns:()=>[{type:"selection",align:"center",width:48,fixed:"left"},{key:"id",title:"通道ID",align:"center",width:60,fixed:"left"},{key:"chlName",title:"通道名称",align:"center",width:140},{key:"chlAddr",title:"通道地址",align:"center",width:140},{key:"chlType",title:"通道类型",align:"center",width:100,render:n=>a("span",null,["采集通道"])},{key:"name",title:"协议名称",align:"center",minWidth:200,render:n=>a("div",{class:"flex-center justify-center gap-8px"},[a(ze,{class:"text-icon cursor-pointer",color:n.pro>0?"#ff7f50":"",onClick:()=>f(n.id)},null),a("span",null,[n.name])])},{key:"chlMainParam",title:"主通道参数",align:"center",width:300,render:n=>a("span",{class:"font-size-14px"},[n.protocolType===0?JSON.stringify({ip_addr:JSON.parse(n.chlMainParam).ip_addr,port:JSON.parse(n.chlMainParam).port}):JSON.stringify({COM_NAME:JSON.parse(n.chlMainParam).com_name})||{}])},{key:"chlColtFreq",title:"交互频率(ms)",align:"center",width:140},{key:"chlWaitTime",title:"每帧间隔(ms)",align:"center",width:140},{key:"chlValid",title:"有效性",align:"center",width:140,render:n=>a(oa,{type:n.chlValid===2?"error":"success"},{default:()=>[n.chlValid==2?"否":"是"]})},{key:"chlDesc",title:"通道描述",align:"center",width:140},{key:"operate",title:U("common.operate"),align:"center",width:240,fixed:"right",render:n=>{let p;return a("div",{class:"flex-center gap-8px"},[a(V,{type:"primary",ghost:!0,size:"small",onClick:()=>g(n.id)},{default:()=>["子设备管理"]}),a(V,{type:"primary",ghost:!0,size:"small",onClick:()=>l(n.id)},Ne(p=U("common.edit"))?p:{default:()=>[p]}),a(Me,{onPositiveClick:()=>m(n.id)},{default:()=>U("common.confirmDelete"),trigger:()=>{let h;return a(V,{type:"error",ghost:!0,size:"small"},Ne(h=U("common.delete"))?h:{default:()=>[h]})}})])}}]}),{drawerVisible:w,operateType:q,editingData:W,handleAdd:X,handleEdit:j,checkedRowKeys:s,onBatchDeleted:r,onDeleted:u}=ua(e,y);ge(()=>z.fuzzy,n=>{n||y()});const g=n=>{H.push({path:"/configsetting/collectionservices/subdevicemanagement",query:{channelId:n}})},v=()=>{y()},m=async n=>{const{data:p,error:h}=await ke({ids:n});h||u()},l=n=>{j(n)},c=async()=>{const{data:n,error:p}=await ke({ids:s.value.join(",")});p||u()},f=n=>{b.value=n,B.value=!0};return(n,p)=>{const h=Pa,A=be,F=Ve,S=ia,J=te,Z=Ie,C=Ee,ne=Je,Q=Ce,K=Ue,T=ra,E=Be("no-space");return L(),se("div",Sa,[a(T,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:o(()=>[a(J,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:o(()=>[a(S,null,{default:o(()=>[a(h,null,{default:o(()=>[N("通道名称")]),_:1}),Oe(a(A,{clearable:"",value:i(z).fuzzy,"onUpdate:value":p[0]||(p[0]=t=>i(z).fuzzy=t),placeholder:"请输入通道名称",style:{width:"100%"},onKeyup:Se(v,["enter"])},null,8,["value"]),[[E]]),a(i(V),{type:"primary",ghost:"",onClick:v},{icon:o(()=>[a(F,{class:de(["text-icon",{"animate-spin":i(D)}])},null,8,["class"])]),default:o(()=>[N(" "+$(i(U)("common.search")),1)]),_:1})]),_:1})]),_:1})]),"header-extra":o(()=>[a(J,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[a(i(V),{onClick:i(X),size:"small",ghost:"",type:"primary"},{icon:o(()=>[a(Z,{class:de(["text-icon",{"animate-spin":i(D)}])},null,8,["class"])]),default:o(()=>[N(" "+$(i(U)("common.add")),1)]),_:1},8,["onClick"]),a(i(Me),{onPositiveClick:c},{trigger:o(()=>[a(i(V),{size:"small",ghost:"",type:"error",disabled:i(s).length===0},{icon:o(()=>[a(C,{class:"text-icon"})]),default:o(()=>[N(" "+$(i(U)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:o(()=>[N(" "+$(i(U)("common.confirmDelete")),1)]),_:1}),a(i(V),{onClick:p[1]||(p[1]=t=>B.value=!0),size:"small",ghost:"",type:"primary",disabled:i(s).length!==1},{icon:o(()=>[a(ne,{class:de(["text-icon",{"animate-spin":i(D)}])},null,8,["class"])]),default:o(()=>[N(" 规约特征配置 ")]),_:1},8,["disabled"]),a(Q,{columns:i(d),"onUpdate:columns":p[2]||(p[2]=t=>me(d)?d.value=t:null)},null,8,["columns"])]),_:1})]),default:o(()=>[a(K,{"checked-row-keys":i(s),"onUpdate:checkedRowKeys":p[3]||(p[3]=t=>me(s)?s.value=t:null),columns:i(k),data:i(e),size:"small",loading:i(D),remote:"","row-key":t=>t.id,pagination:i(e).length?i(M):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),a(ka,{visible:i(w),"onUpdate:visible":p[4]||(p[4]=t=>me(w)?w.value=t:null),onSubmitted:i(y),"operate-type":i(q),"row-data":i(W)},null,8,["visible","onSubmitted","operate-type","row-data"]),B.value?(L(),ae(Na,{key:0,visible:B.value,"onUpdate:visible":p[5]||(p[5]=t=>B.value=t),channelId:i(s).length==0?b.value:i(s)[0],onSubmitted:i(y)},null,8,["visible","channelId","onSubmitted"])):ee("",!0),a(Ba,{visible:_.value,"onUpdate:visible":p[6]||(p[6]=t=>_.value=t)},null,8,["visible"])]),_:1})])}}});export{Ra as default};
