import{_ as ut}from"./table-column-setting.vue_vue_type_script_setup_true_lang-CUOEVEOG.js";import{_ as pt}from"./round-refresh-Bax5XYpm.js";import{_ as mt}from"./round-delete-w9tybVQM.js";import{Y as De,o as X,b as ke,e as at,d as Ce,Z as de,r as we,a0 as Re,p as $e,q as ft,a2 as Ke,a as nt,$ as D,a8 as Me,ak as ot,f as e,a9 as Ve,v as it,w as a,g as F,t as j,h as l,a3 as Y,x as st,ab as _e,av as Oe,ag as Ie,am as Fe,a4 as Ue,A as ce,B as O,ad as Be,a5 as qe,F as Ee,E as je,a6 as Ge,ae as Je,aO as vt,i as Pe,a1 as Ze,c as Le,S as Ne,N as gt,a7 as ht,s as bt,y as yt,aa as ye,ac as _t,X as wt}from"./index-C4Xe5hxh.js";import{_ as Ft}from"./round-add-BDlDPg6T.js";import{_ as kt}from"./round-search-hnCStK2c.js";import{p as se,d as dt,a as Tt,b as He,c as Qe}from"./gather-CjQLIZz1.js";import{_ as We}from"./FormItemGridItem-CQhANOnq.js";import{_ as Xe}from"./Grid-Buhl17jd.js";import{N as et}from"./Popconfirm-l9_AREXS.js";import{_ as Lt}from"./InputGroupLabel-CkZYP9r6.js";function Nt(T){return De({url:"/transTag/selectPage.do",method:"get",params:T})}function ct(T){return De({url:"/transTag/insert.do",method:"post",data:T})}function ze(T){return De({url:"/transTag/update.do",method:"post",data:T})}function tt(T){return De({url:"/transTag/delete.do",method:"delete",params:T})}const It={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Pt=at("path",{fill:"currentColor",d:"M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36M20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83l3.75 3.75z"},null,-1),Dt=[Pt];function Ct(T,Z){return X(),ke("svg",It,[...Dt])}const Ut={name:"ic-round-edit",render:Ct},jt=Ce({__name:"add_model",props:de({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:de(["submitted"],["update:visible"]),setup(T,{emit:Z}){const n=we({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:{},dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),p=Re(T,"visible"),V=Z,z=T,t=we(q());function q(){return{chlId:void 0,devId:void 0,tagDevId:"",tagName:"",tagId:void 0,tagDesc:"",tagUnit:"",tagType:1,tagK:1,objAddr:"0",collectType:1,dataType:4,dataFormat:0}}async function b(){var h;const{data:i,error:s}=await vt({page:1,limit:1e4,type:1});s||(n.deveicelList=i.list.map(_=>({..._,label:_.devName,value:_.id+"_"+_.chlId})),z.operateType==="add"&&n.deveicelList.length>0&&!t.tagDevId&&(t.tagDevId=(h=n.deveicelList[0])==null?void 0:h.value,t.devId=Number(t.tagDevId.split("_")[0]),t.chlId=Number(t.tagDevId.split("_")[1]),t.collectType=void 0),N())}async function N(){const{data:i,error:s}=await Fe({chlId:t.chlId});s||(n.functionList=JSON.parse(i).data,t.collectType=n.functionList[0].FuncCode)}function K(){Object.assign(t,q()),b(),z.operateType==="edit"&&z.rowData&&(Object.assign(t,z.rowData),w(z.rowData))}const{formRef:H,validate:y,restoreValidation:ee}=$e();ft(),Ke(p,()=>{p.value&&(K(),ee())});const U=()=>{p.value=!1};function w(i,s){console.log(i),i==0||i==1||i==2||i==3||i==4||i==7?n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:i==5||i==6||i==8||i==9||i==10||i==12||i==13?n.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],n.collectionPointForm.dataFormatList.find(h=>h.value===t.dataFormat)||(t.dataFormat=n.collectionPointForm.dataFormatList[0].value)}const R=async()=>{var i,s;if(await y(),console.log(t),z.operateType==="add"){const{data:h,error:_}=await ct([t]);_||(U(),(i=window.$message)==null||i.success("添加成功"),V("submitted"))}else{const{data:h,error:_}=await ze([t]);_||(U(),(s=window.$message)==null||s.success("编辑成功"),V("submitted"))}},A={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},I={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},C={devId:I,tagName:A,tagDesc:A,tagK:I,objAddr:A,collectType:I,dataType:I,dataFormat:I},E=nt(()=>({add:D("common.add"),edit:D("common.edit")})[z.operateType]),{columns:Q,columnChecks:ne,data:G,getData:$,loading:k,mobilePagination:re,searchParams:m,resetSearchParams:Ae}=Me({apiFn:ot,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",multiple:!1,align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140},{key:"devId",title:"所属设备",align:"center",width:140,render:i=>{var s;return e("span",null,[((s=n.collectionPointForm.deveicelList.find(h=>h.id===i.devId))==null?void 0:s.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),ue=()=>{$()},{drawerVisible:g,operateType:f,editingData:L,handleAdd:te,handleEdit:xe,checkedRowKeys:x,onBatchDeleted:Se,onDeleted:pe}=Ve(G,$);async function oe(){const{data:i,error:s}=await Ie();s||(console.log("data",i),i.length>0&&(n.collectionPointForm.channelList=i.filter(h=>h.chlType!==1).map(h=>({label:h.chlName,value:h.id,devicePojoList:h.devicePojoList||[]}))))}oe();const me=i=>{var h;m.chlid=i,m.devId=null;let s=(h=n.collectionPointForm.channelList.find(_=>_.value==i))==null?void 0:h.devicePojoList;n.collectionPointForm.deveicelList=s,le(),$()};function fe(){var i,s;if(n.collectionPointForm.channelList.length>0)if(m.chlid)n.collectionPointForm.visible=!0;else{let h=n.collectionPointForm.channelList[0];m.chlid=h.value,n.collectionPointForm.deveicelList=h.devicePojoList,le(),x.value=[t.tagId],n.collectionPointForm.checkedRows.tagName=t.tagName,n.collectionPointForm.checkedRows.id=t.tagId}else return(i=window.$message)==null||i.destroyAll(),(s=window.$message)==null||s.warning("暂无通道，请您先创建通道在进行查询"),!1}async function le(){const{data:i,error:s}=await Fe({chlId:m.chlid});s||(n.collectionPointForm.functionList=JSON.parse(i).data,n.collectionPointForm.visible=!0,$())}function ve(){n.collectionPointForm.visible=!1}function P(i,s,h){console.log(s),n.collectionPointForm.checkedRows=s[0]}function ge(){var i,s;if(x.value.length===0)return(i=window.$message)==null||i.destroyAll(),(s=window.$message)==null||s.warning("请您先选择采集点"),!1;t.tagName=n.collectionPointForm.checkedRows.tagName,t.tagId=n.collectionPointForm.checkedRows.id,t.tagDesc||(t.tagDesc=n.collectionPointForm.checkedRows.tagDesc),n.collectionPointForm.visible=!1}return(i,s)=>{const h=Ue,_=We,Te=ce,d=O,o=Be,u=qe,c=ce,B=Xe,S=Ee,M=O,ae=je,J=Ge,ie=Je,W=it("no-space");return X(),ke(Oe,null,[e(J,{show:p.value,"onUpdate:show":s[9]||(s[9]=r=>p.value=r),title:E.value,preset:"card",class:"w-50%"},{footer:a(()=>[e(ae,{size:16,justify:"center"},{default:a(()=>[e(M,{onClick:U,class:"w-100px"},{default:a(()=>[F(j(l(D)("common.cancel")),1)]),_:1}),e(M,{type:"primary",class:"w-100px",onClick:R},{default:a(()=>[F(j(l(D)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(S,{ref_key:"formRef",ref:H,model:t,rules:C,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(B,{responsive:"screen","item-responsive":""},{default:a(()=>[e(_,{span:"24 m:12",label:"所属设备",path:"belongingChannel"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择所属设备",value:t.devId,"onUpdate:value":s[0]||(s[0]=r=>t.devId=r),"value-field":"id",options:n.deveicelList},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:a(()=>[e(o,null,{default:a(()=>[e(Te,{value:t.tagName,"onUpdate:value":s[1]||(s[1]=r=>t.tagName=r),style:{width:"80%"},readonly:""},null,8,["value"]),e(d,{type:"primary",ghost:"",onClick:fe},{default:a(()=>[F("请选择")]),_:1})]),_:1})]),_:1}),e(_,{span:"24 m:12",label:"测点类型",path:"dataType"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择测点类型",value:t.tagType,"onUpdate:value":s[2]||(s[2]=r=>t.tagType=r),options:l(Y)(l(se))},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:a(()=>[e(u,{clearable:"",value:t.tagK,"onUpdate:value":s[3]||(s[3]=r=>t.tagK=r),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(_,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择转发功能码",value:t.collectType,"onUpdate:value":s[4]||(s[4]=r=>t.collectType=r),options:n.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:a(()=>[e(c,{clearable:"",value:t.objAddr,"onUpdate:value":s[5]||(s[5]=r=>t.objAddr=r),placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(_,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择数据类型",value:t.dataType,"onUpdate:value":[s[6]||(s[6]=r=>t.dataType=r),w],options:l(Y)(l(dt))},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择数据格式",value:t.dataFormat,"onUpdate:value":s[7]||(s[7]=r=>t.dataFormat=r),options:n.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:a(()=>[e(c,{clearable:"",value:t.tagUnit,"onUpdate:value":s[8]||(s[8]=r=>t.tagUnit=r),placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(J,{show:n.collectionPointForm.visible,"onUpdate:show":s[16]||(s[16]=r=>n.collectionPointForm.visible=r),title:"选择采集点",preset:"card",class:"w-60%"},{footer:a(()=>[e(ae,{size:16,justify:"end"},{default:a(()=>[e(M,{onClick:ve},{default:a(()=>[F(j(l(D)("common.cancel")),1)]),_:1}),e(M,{type:"primary",onClick:ge},{default:a(()=>[F(j(l(D)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(S,{model:n.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(B,{responsive:"screen","item-responsive":""},{default:a(()=>[e(_,{span:"24 m:12",label:"所属通道"},{default:a(()=>[e(h,{filterable:"",placeholder:"请选择所属通道",value:l(m).chlid,"onUpdate:value":s[10]||(s[10]=r=>l(m).chlid=r),options:n.collectionPointForm.channelList,onUpdateValue:me},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:12",label:"所属设备"},{default:a(()=>[e(h,{filterable:"",clearable:"",placeholder:"请选择所属设备",value:l(m).devId,"onUpdate:value":s[11]||(s[11]=r=>l(m).devId=r),"label-field":"devName","value-field":"id",options:n.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:12",label:"测点类型"},{default:a(()=>[e(h,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:l(m).tagType,"onUpdate:value":s[12]||(s[12]=r=>l(m).tagType=r),options:l(Y)(l(se))},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:12",label:"测点功能码"},{default:a(()=>[e(h,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:l(m).collectType,"onUpdate:value":s[13]||(s[13]=r=>l(m).collectType=r),options:n.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:12",label:"测点名称"},{default:a(()=>[st(e(c,{clearable:"",value:l(m).fuzzy,"onUpdate:value":s[14]||(s[14]=r=>l(m).fuzzy=r),placeholder:"请输入测点名称"},null,8,["value"]),[[W]])]),_:1}),e(_,{span:"24 m:12",label:" "},{default:a(()=>[e(M,{onClick:ue},{default:a(()=>[F(j(l(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(ie,{"checked-row-keys":l(x),"onUpdate:checkedRowKeys":[s[15]||(s[15]=r=>_e(x)?x.value=r:null),P],columns:l(Q),data:l(G),size:"small","max-height":500,loading:l(k),remote:"","row-key":r=>r.id,pagination:l(re)},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1},8,["show"])],64)}}}),At={class:"flex"},xt=Ce({__name:"add_multipe_model",props:de(["devId","chlid"],{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:de(["submitted"],["update:visible"]),setup(T,{emit:Z}){const n=we({deveicelList:[],functionList:[],collectionPointForm:{visible:!1,channelList:[],deveicelList:[],functionList:[],checkedRows:[],dataFormatList:[{label:"12",value:0},{label:"21",value:1}]}}),p=Re(T,"visible"),V=T,z=Z,t=we(q());function q(){return{chlId:void 0,devId:void 0,tagDevId:"",tagName:"",tagNames:"",tagId:"",tagDesc:"",tagDescs:"",tagUnit:"",tagType:0,tagK:1,objAddr:"0",collectType:1,dataType:4,dataFormat:0}}async function b(){var u,c;const{data:d,error:o}=await Ie({type:1});if(!o){const B=[];d.forEach(S=>{S.devicePojoList&&S.devicePojoList.length>0&&S.devicePojoList.forEach(M=>{B.push({label:`${S.chlName}__${M.devName}`,value:`${M.id}_${S.id}`})})}),n.deveicelList=B,t.tagDevId=V.devId&&V.chlid?V.devId+"_"+V.chlid:n.deveicelList[0].value,t.devId=Number((u=t.tagDevId)==null?void 0:u.split("_")[0]),t.chlId=Number((c=t.tagDevId)==null?void 0:c.split("_")[1]),t.collectType=void 0,N()}}async function N(){const{data:d,error:o}=await Fe({chlId:t.chlId});o||(n.functionList=JSON.parse(d).data,t.collectType=n.functionList[0].FuncCode)}function K(){Object.assign(t,q()),b(),n.collectionPointForm.checkedRows=[],P.value=[]}const{formRef:H,validate:y,restoreValidation:ee}=$e();Ke(p,()=>{p.value&&(K(),ee())});const U=()=>{p.value=!1};function w(d,o){console.log(d),d==0||d==1||d==2||d==3||d==4||d==7?n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1}]:d==5||d==6||d==8||d==9||d==10||d==12||d==13?n.collectionPointForm.dataFormatList=[{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}]:n.collectionPointForm.dataFormatList=[{label:"12",value:0},{label:"21",value:1},{label:"1234",value:2},{label:"2143",value:3},{label:"3412",value:4},{label:"4321",value:5}],n.collectionPointForm.dataFormatList.find(u=>u.value===t.dataFormat)||(t.dataFormat=n.collectionPointForm.dataFormatList[0].value)}const R=async()=>{var M,ae,J;await y();let d=t.tagNames.split(","),o=(M=t.tagDescs)==null?void 0:M.split(","),u=(ae=t.tagId)==null?void 0:ae.split(","),c=[];delete t.tagNames,delete t.tagDescs,delete t.tagId,d.forEach((ie,W)=>{var he,be;let r={...t,tagName:ie,tagDesc:t.tagDesc?t.tagDesc:o[W],tagId:Number(u[W]),objAddr:t.objAddr?+t.objAddr+W:W+"",devId:Number((he=t.tagDevId)==null?void 0:he.split("_")[0]),chlId:Number((be=t.tagDevId)==null?void 0:be.split("_")[1])};c.push(r)});const{data:B,error:S}=await ct(c);S||(U(),(J=window.$message)==null||J.success("添加成功"),z("submitted"))},A={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},I={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},C={tagDevId:A,tagName:A,tagDesc:[{trigger:["input","blur"],validator:(d,o)=>!/\$/.test(o),message:"不能含有非法字符"},{type:"string",required:!0,message:"不能为空",trigger:["input","blur"]}],tagK:I,objAddr:A,collectType:I,dataType:I,dataFormat:I},E=nt(()=>({add:"批量新增",edit:D("common.edit")}).add),{columns:Q,columnChecks:ne,data:G,getData:$,loading:k,mobilePagination:re,searchParams:m,resetSearchParams:Ae}=Me({apiFn:ot,apiParams:{page:1,pageSize:20,limit:20,chlid:null,devId:null,tagType:null,collectType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",align:"center",width:48},{key:"tagName",title:"测点名称",align:"center",fixed:"left",width:160},{key:"tagDesc",title:"物模型标识(测点描述)",align:"center",width:160},{key:"tagType",title:"测点类型",align:"center",width:140,render:d=>{var o;return e("span",null,[((o=se.find(u=>u.value===d.tagType))==null?void 0:o.label)||""])}},{key:"belongingEquipment",title:"所属设备",align:"center",width:140,render:d=>{var o;return e("span",null,[((o=n.collectionPointForm.deveicelList.find(u=>u.id===d.devId))==null?void 0:o.devName)||""])}},{key:"collectname",title:"采集功能码",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140}]}),ue=()=>{$()},{drawerVisible:g,operateType:f,editingData:L,handleAdd:te,handleEdit:xe,checkedRowKeys:x,onBatchDeleted:Se,onDeleted:pe}=Ve(G,$);async function oe(){const{data:d,error:o}=await Ie();o||(console.log("data",d),d.length>0&&(n.collectionPointForm.channelList=d.filter(u=>u.chlType!==1).map(u=>({label:u.chlName,value:u.id,devicePojoList:u.devicePojoList||[]}))))}const me=d=>{var u;m.chlid=d,m.devId=null;let o=(u=n.collectionPointForm.channelList.find(c=>c.value==d))==null?void 0:u.devicePojoList;n.collectionPointForm.deveicelList=o,le(),$()};oe();function fe(){var d,o;if(x.value=P.value.map(u=>u.id),n.collectionPointForm.channelList.length>0)if(m.chlid)n.collectionPointForm.visible=!0;else{let u=n.collectionPointForm.channelList[0];m.chlid=u.value,n.collectionPointForm.deveicelList=u.devicePojoList,le()}else return(d=window.$message)==null||d.destroyAll(),(o=window.$message)==null||o.warning("暂无通道，请您先创建通道在进行查询"),!1}async function le(){const{data:d,error:o}=await Fe({chlId:m.chlid});o||(n.collectionPointForm.functionList=JSON.parse(d).data,n.collectionPointForm.visible=!0,$())}function ve(){n.collectionPointForm.visible=!1}const P=Pe([]),ge=[{title(){return e("div",{class:"flex"},[e("span",{class:"flex-1"},[`已选${P.value.length}个`]),e("span",{class:"c-red cursor-pointer",onClick:h},[F("清空")])])},align:"center",render:d=>{var o;return e("span",null,[d.tagName,F("--"),(o=n.collectionPointForm.channelList.find(u=>u.value==d.chlId))==null?void 0:o.label])}}];function i(d,o,u){console.log(o),o=o.filter(c=>c!=null),m.devId&&(P.value=P.value.filter(c=>c.devId!=m.devId||c.page!=m.page)),m.chlid&&(P.value=P.value.filter(c=>c.chlId!=m.chlid||c.page!=m.page)),P.value.push(...o.filter(c=>c!=null)),P.value=[...new Set(P.value)],P.value.forEach(c=>{c.page=c.page?c.page:m.page})}function s(){var d,o,u,c,B;if(n.collectionPointForm.checkedRows=x.value,t.tagNames="",t.tagDescs="",t.tagId="",x.value.length===0)return(d=window.$message)==null||d.destroyAll(),(o=window.$message)==null||o.warning("请您先选择采集点"),!1;P.value.forEach(S=>{t.tagNames+=S.tagName+",",t.tagDescs+=S.tagDesc+",",t.tagId+=S.id+","}),t.tagName=P.value[0].tagName,t.tagNames=(u=t.tagNames)==null?void 0:u.substring(0,t.tagNames.length-1),t.tagDescs=(c=t.tagDescs)==null?void 0:c.substring(0,t.tagDescs.length-1),t.tagId=(B=t.tagId)==null?void 0:B.substring(0,t.tagId.length-1),n.collectionPointForm.visible=!1}const h=()=>{P.value=[],x.value=[]},_=()=>{x.value=[]},Te=()=>({style:{height:"40px"}});return(d,o)=>{const u=Ue,c=We,B=ce,S=O,M=Be,ae=qe,J=ce,ie=Xe,W=Ee,r=O,he=je,be=Ge,Ye=Je,rt=it("no-space");return X(),ke(Oe,null,[e(be,{show:p.value,"onUpdate:show":o[9]||(o[9]=v=>p.value=v),title:E.value,preset:"card",class:"w-50%"},{footer:a(()=>[e(he,{size:16,justify:"center"},{default:a(()=>[e(r,{onClick:U,class:"w-100px"},{default:a(()=>[F(j(l(D)("common.cancel")),1)]),_:1}),e(r,{type:"primary",class:"w-100px",onClick:R},{default:a(()=>[F(j(l(D)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(W,{ref_key:"formRef",ref:H,model:t,rules:C,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(ie,{responsive:"screen","item-responsive":""},{default:a(()=>[e(c,{span:"24 m:12",label:"所属设备",path:"tagDevId"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择所属设备",value:t.tagDevId,"onUpdate:value":o[0]||(o[0]=v=>t.tagDevId=v),options:n.deveicelList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点名称",path:"tagName"},{default:a(()=>[e(M,{style:{width:"100%"}},{default:a(()=>[e(B,{value:t.tagName,"onUpdate:value":o[1]||(o[1]=v=>t.tagName=v),readonly:""},null,8,["value"]),e(S,{type:"primary",ghost:"",onClick:fe},{default:a(()=>[F(j(n.collectionPointForm.checkedRows.length>1?`+${n.collectionPointForm.checkedRows.length}`:"请选择"),1)]),_:1})]),_:1})]),_:1}),e(c,{span:"24 m:12",label:"测点类型",path:"dataType"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择测点类型",value:t.tagType,"onUpdate:value":o[2]||(o[2]=v=>t.tagType=v),options:l(Y)(l(se))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"系数(K)",path:"tagK"},{default:a(()=>[e(ae,{clearable:"",value:t.tagK,"onUpdate:value":o[3]||(o[3]=v=>t.tagK=v),placeholder:"请输入系数(K)",style:{width:"100%"}},null,8,["value"])]),_:1}),e(c,{span:"24 m:12",label:"转发功能码",path:"collectType"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择转发功能码",value:t.collectType,"onUpdate:value":o[4]||(o[4]=v=>t.collectType=v),options:n.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"寄存器地址",path:"objAddr"},{default:a(()=>[e(J,{clearable:"",value:t.objAddr,"onUpdate:value":o[5]||(o[5]=v=>t.objAddr=v),placeholder:"请输入寄存器地址"},null,8,["value"])]),_:1}),e(c,{span:"24 m:12",label:"数据类型",path:"dataType"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择数据类型",value:t.dataType,"onUpdate:value":[o[6]||(o[6]=v=>t.dataType=v),w],options:l(Y)(l(dt))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"数据格式",path:"dataFormat"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择数据格式",value:t.dataFormat,"onUpdate:value":o[7]||(o[7]=v=>t.dataFormat=v),options:n.collectionPointForm.dataFormatList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"单位",path:"tagUnit"},{default:a(()=>[e(J,{clearable:"",value:t.tagUnit,"onUpdate:value":o[8]||(o[8]=v=>t.tagUnit=v),placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),e(be,{show:n.collectionPointForm.visible,"onUpdate:show":o[16]||(o[16]=v=>n.collectionPointForm.visible=v),title:"选择采集点",preset:"card",class:"w-65%",onAfterLeave:_},{footer:a(()=>[e(he,{size:16,justify:"end"},{default:a(()=>[e(r,{onClick:ve},{default:a(()=>[F(j(l(D)("common.cancel")),1)]),_:1}),e(r,{type:"primary",onClick:s},{default:a(()=>[F(j(l(D)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(W,{model:n.collectionPointForm,"label-placement":"left","label-width":160,"require-mark-placement":"left"},{default:a(()=>[e(ie,{responsive:"screen","item-responsive":""},{default:a(()=>[e(c,{span:"24 m:12",label:"所属通道"},{default:a(()=>[e(u,{filterable:"",placeholder:"请选择所属通道",value:l(m).chlid,"onUpdate:value":o[10]||(o[10]=v=>l(m).chlid=v),options:n.collectionPointForm.channelList,onUpdateValue:me},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"所属设备"},{default:a(()=>[e(u,{filterable:"",clearable:"",placeholder:"请选择所属设备","label-field":"devName","value-field":"id",value:l(m).devId,"onUpdate:value":o[11]||(o[11]=v=>l(m).devId=v),options:n.collectionPointForm.deveicelList},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点类型"},{default:a(()=>[e(u,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:l(m).tagType,"onUpdate:value":o[12]||(o[12]=v=>l(m).tagType=v),options:l(Y)(l(se))},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点功能码"},{default:a(()=>[e(u,{filterable:"",clearable:"",placeholder:"请选择测点功能码",value:l(m).collectType,"onUpdate:value":o[13]||(o[13]=v=>l(m).collectType=v),options:n.collectionPointForm.functionList,"label-field":"description","value-field":"FuncCode"},null,8,["value","options"])]),_:1}),e(c,{span:"24 m:12",label:"测点名称"},{default:a(()=>[st(e(J,{clearable:"",value:l(m).fuzzy,"onUpdate:value":o[14]||(o[14]=v=>l(m).fuzzy=v),placeholder:"请输入测点名称"},null,8,["value"]),[[rt]])]),_:1}),e(c,{span:"24 m:12",label:" "},{default:a(()=>[e(r,{onClick:ue},{default:a(()=>[F(j(l(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),at("div",At,[e(Ye,{"checked-row-keys":l(x),"onUpdate:checkedRowKeys":[o[15]||(o[15]=v=>_e(x)?x.value=v:null),i],columns:l(Q),data:l(G),size:"small","max-height":500,loading:l(k),remote:"","row-key":v=>v.id,pagination:l(re),class:"flex-1","row-props":Te},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"]),e(Ye,{columns:ge,data:P.value,size:"small","max-height":540,loading:l(k),remote:"","row-key":v=>v.id,class:"w-20% ml-10px","row-props":Te},null,8,["data","loading","row-key"])])]),_:1},8,["show"])],64)}}}),St=Ce({__name:"batchEdit_model",props:de({checkedRowKeys:{type:Array,default:[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:de(["submitted"],["update:visible"]),setup(T,{emit:Z}){const n=T,p=Re(T,"visible");Ke(()=>p.value,U=>{b.value={editType:0,editMode:0,startV:"0",step:"1",tagK:0}});const V=Z,{formRef:z,validate:t,restoreValidation:q}=$e(),b=Pe({editType:0,editMode:0,startV:"0",step:"1",tagK:0}),N=async()=>{var U,w;if(await t(),b.value.editType==0){console.log(n.checkedRowKeys);let R=[];n.checkedRowKeys.forEach((C,E)=>{R.push({id:C,objAddr:+b.value.startV+E*+b.value.step+""})});const{data:A,error:I}=await ze(R);I||(p.value=!1,(U=window.$message)==null||U.success("批量修改成功"),V("submitted"))}else if(b.value.editType==1){let R=[];n.checkedRowKeys.forEach((C,E)=>{R.push({id:C,tagK:b.value.tagK})});const{data:A,error:I}=await ze(R);I||(p.value=!1,(w=window.$message)==null||w.success("批量修改成功"),V("submitted"))}},K={type:"number",required:!0,message:"不能为空",trigger:["input","blur"]},H={type:"string",required:!0,message:"不能为空",trigger:["input","blur"]},y={editType:K,editMode:K,startV:H,step:H},ee=Pe(!1);return(U,w)=>{const R=Ue,A=We,I=ce,C=qe,E=Xe,Q=Ee,ne=O,G=je,$=Ge;return X(),ke(Oe,null,[e($,{show:p.value,"onUpdate:show":w[6]||(w[6]=k=>p.value=k),title:"批量修改",preset:"card",class:"w-40%"},{footer:a(()=>[e(G,{size:16,justify:"center"},{default:a(()=>[e(ne,{onClick:w[5]||(w[5]=k=>p.value=!1),class:"w-100px"},{default:a(()=>[F(j(U.$t("common.cancel")),1)]),_:1}),e(ne,{type:"primary",class:"w-100px",onClick:N},{default:a(()=>[F(j(U.$t("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(Q,{ref_key:"formRef",ref:z,"label-width":120,"label-placement":"left",model:b.value,rules:y},{default:a(()=>[e(E,{responsive:"screen","item-responsive":""},{default:a(()=>[e(A,{span:"24 m:12",label:"修改类型",path:"editType"},{default:a(()=>[e(R,{filterable:"",clearable:"",placeholder:"请选择",value:b.value.editType,"onUpdate:value":w[0]||(w[0]=k=>b.value.editType=k),options:l(Y)(l(Ze)({0:"寄存器地址",1:"系数K"}))},null,8,["value","options"])]),_:1}),b.value.editType==0?(X(),Le(A,{key:0,span:"24 m:12",label:"修改步长",path:"editMode"},{default:a(()=>[e(R,{filterable:"",clearable:"",placeholder:"请选择",value:b.value.editMode,"onUpdate:value":w[1]||(w[1]=k=>b.value.editMode=k),options:l(Y)(l(Ze)({0:"步长"}))},null,8,["value","options"])]),_:1})):Ne("",!0),b.value.editType==0?(X(),Le(A,{key:1,span:"24 m:12",label:"起始值",path:"startV"},{default:a(()=>[e(I,{clearable:"",value:b.value.startV,"onUpdate:value":w[2]||(w[2]=k=>b.value.startV=k),placeholder:"请输入起始值"},null,8,["value"])]),_:1})):Ne("",!0),b.value.editType==0?(X(),Le(A,{key:2,span:"24 m:12",label:"步长",path:"step"},{default:a(()=>[e(I,{clearable:"",value:b.value.step,"onUpdate:value":w[3]||(w[3]=k=>b.value.step=k),placeholder:"请输入步长"},null,8,["value"])]),_:1})):Ne("",!0),b.value.editType==1?(X(),Le(A,{key:3,span:"24 m:12",label:"修改的值",path:"step"},{default:a(()=>[e(C,{clearable:"",value:b.value.tagK,"onUpdate:value":w[4]||(w[4]=k=>b.value.tagK=k),placeholder:"请输入修改的值"},null,8,["value"])]),_:1})):Ne("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e($,{show:ee.value,"onUpdate:show":w[7]||(w[7]=k=>ee.value=k),title:"批量添加",preset:"card",class:"w-30%"},null,8,["show"])],64)}}}),zt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function lt(T){return typeof T=="function"||Object.prototype.toString.call(T)==="[object Object]"&&!_t(T)}const Wt=Ce({name:"configsetting_forwardingservice_forwardingpointmanagement",__name:"index",setup(T){const Z=gt(),n=ht(),p=we({channelList:[],channelAndDevObj:{},deveicelList:[],transFunctionOptions:[],addMultipeModelVisible:!1});async function V(){const{data:g,error:f}=await Ie({type:1});f||(p.channelList=g,p.channelList.forEach(L=>{p.channelAndDevObj[L.id]=L.devicePojoList}),p.channelList.length>0&&(y.chlid?p.deveicelList=p.channelAndDevObj[y.chlid]:y.chlid=p.channelList[0].id,z(),N()),p.deveicelList=p.channelAndDevObj[y.chlid],y.devId=p.deveicelList[0].id)}async function z(){const{data:g,error:f}=await Fe({chlId:y.chlid});f||(p.transFunctionOptions=JSON.parse(g).data)}const{columns:t,columnChecks:q,data:b,getData:N,loading:K,mobilePagination:H,searchParams:y,resetSearchParams:ee}=Me({apiFn:Nt,apiParams:{page:1,pageSize:200,limit:200,chlid:null,devId:null,tagType:null,fuzzy:null,_t:new Date().getTime()},immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"测点ID",align:"center",width:80},{key:"tagName",title:"测点名称",align:"center",minWidth:100},{key:"tagType",title:"测点类型",align:"center",width:140,render:g=>e("span",null,[Tt[g.tagType]||""])},{key:"devName",title:"所属设备",align:"center",width:140,render:g=>{var f,L;return e("span",null,[((L=(f=p.deveicelList)==null?void 0:f.find(te=>te.id===g.devId))==null?void 0:L.devName)||""])}},{key:"collectname",title:"转发功能码",align:"center",width:140,render:g=>{var f;return e("span",null,[(f=g.collectname)==null?void 0:f.replace(/\(.*?\)/g,"")])}},{key:"dataType",title:"数据类型",align:"center",width:140,render:g=>e("span",null,[g.dataType?He[Number(g.dataType)]:He[0]])},{key:"dataFormat",title:"数据格式",align:"center",width:140,render:g=>e("span",null,[g.dataType?Qe[Number(g.dataFormat)]:Qe[0]])},{key:"tagK",title:"系数K",align:"center",width:140},{key:"objAddr",title:"寄存器地址",align:"center",width:140},{key:"operate",title:D("common.operate"),align:"center",width:140,fixed:"right",render:g=>{let f;return e("div",{class:"flex-center gap-8px"},[e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>G(g.id)},lt(f=D("common.edit"))?f:{default:()=>[f]}),e(et,{onPositiveClick:()=>ne(g.id)},{default:()=>D("common.confirmDelete"),trigger:()=>{let L;return e(O,{type:"error",ghost:!0,size:"small"},lt(L=D("common.delete"))?L:{default:()=>[L]})}})])}}]});bt(()=>{const g=n.currentRoute.value.query.channelId;y.chlid=Number(g)*1||null,V();const f=n.currentRoute.value.query.deviceId;y.devId=Number(f)*1||null});const{drawerVisible:U,operateType:w,editingData:R,handleAdd:A,handleEdit:I,checkedRowKeys:C,onBatchDeleted:E,onDeleted:Q}=Ve(b,N),ne=async g=>{const{data:f,error:L}=await tt({ids:g});L||Q()},G=g=>{I(g)},$=g=>{g===""&&N()},k=Pe(!1),re=()=>{k.value=!0};function m(g,f){var L;g&&(y.chlid=Number(g),y.devId=null,y.collectType=void 0,p.deveicelList=p.channelAndDevObj[g],y.devId=p.deveicelList[0].id,(!p.deveicelList||p.deveicelList.length==0)&&((L=window.$message)==null||L.warning("该通道下无设备! 请选择其他通道")),z(),N())}function Ae(){p.addMultipeModelVisible=!0}const ue=async()=>{const g=C.value.join(","),{data:f,error:L}=await tt({ids:g});L||Q(),C.value=[]};return(g,f)=>{const L=Lt,te=Ue,xe=ce,x=kt,Se=Be,pe=je,oe=wt,me=Ft,fe=Ut,le=mt,ve=pt,P=ut,ge=Je;return X(),ke("div",zt,[e(oe,{bordered:!1,size:"small"},{default:a(()=>[e(pe,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"},{default:a(()=>[e(Se,null,{default:a(()=>[e(L,null,{default:a(()=>[F("所属通道")]),_:1}),e(te,{filterable:"",placeholder:"请选择通道",value:l(y).chlid,"onUpdate:value":f[0]||(f[0]=i=>l(y).chlid=i),"label-field":"chlName","value-field":"id",options:p.channelList,onUpdateValue:m},null,8,["value","options"]),e(L,null,{default:a(()=>[F("所属设备")]),_:1}),e(te,{filterable:"",clearable:"",placeholder:"请选择设备",value:l(y).devId,"onUpdate:value":[f[1]||(f[1]=i=>l(y).devId=i),l(N)],"label-field":"devName","value-field":"id",options:p.deveicelList},null,8,["value","options","onUpdate:value"]),e(L,null,{default:a(()=>[F("测点类型")]),_:1}),e(te,{filterable:"",clearable:"",placeholder:"请选择测点类型",value:l(y).tagType,"onUpdate:value":[f[2]||(f[2]=i=>l(y).tagType=i),l(N)],style:{width:"80%"},options:l(Y)(l(se))},null,8,["value","options","onUpdate:value"]),e(xe,{clearable:"",value:l(y).fuzzy,"onUpdate:value":[f[3]||(f[3]=i=>l(y).fuzzy=i),$],placeholder:"请输入测点名称或描述",style:{width:"100%"},onKeyup:yt(l(N),["enter"])},null,8,["value","onKeyup"]),e(l(O),{type:"primary",ghost:"",onClick:l(N)},{icon:a(()=>[e(x,{class:ye(["text-icon",{"animate-spin":l(K)}])},null,8,["class"])]),default:a(()=>[F(" "+j(l(D)("common.search")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(oe,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:a(()=>[e(pe,{align:"center",wrap:"",justify:"start",class:"lt-sm:w-200px"})]),"header-extra":a(()=>[e(pe,{align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:a(()=>[e(l(O),{onClick:Ae,size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(me,{class:ye(["text-icon",{"animate-spin":l(K)}])},null,8,["class"])]),default:a(()=>[F(" "+j("批量新增"))]),_:1}),e(l(O),{onClick:re,size:"small",ghost:"",type:"primary",disabled:!l(C).length},{icon:a(()=>[e(fe,{class:ye(["text-icon",{"animate-spin":l(K)}])},null,8,["class"])]),default:a(()=>[F(" "+j("批量修改"))]),_:1},8,["disabled"]),e(l(et),{onPositiveClick:ue},{trigger:a(()=>[e(l(O),{size:"small",ghost:"",type:"error",disabled:l(C).length==0},{icon:a(()=>[e(le,{class:ye(["text-icon",{"animate-spin":l(K)}])},null,8,["class"])]),default:a(()=>[F(" "+j(l(D)("common.batchDelete")),1)]),_:1},8,["disabled"])]),default:a(()=>[F(" 确认删除选中的项吗？ ")]),_:1}),e(l(O),{onClick:l(N),size:"small",ghost:"",type:"primary"},{icon:a(()=>[e(ve,{class:ye(["text-icon",{"animate-spin":l(K)}])},null,8,["class"])]),_:1},8,["onClick"]),e(P,{columns:l(q),"onUpdate:columns":f[4]||(f[4]=i=>_e(q)?q.value=i:null)},null,8,["columns"])]),_:1})]),default:a(()=>[e(ge,{"checked-row-keys":l(C),"onUpdate:checkedRowKeys":f[5]||(f[5]=i=>_e(C)?C.value=i:null),columns:l(t),data:l(b),size:"small",class:"sm:h-full","flex-height":!l(Z).isMobile,loading:l(K),remote:"","row-key":i=>i.id,pagination:l(H)},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(jt,{visible:l(U),"onUpdate:visible":f[6]||(f[6]=i=>_e(U)?U.value=i:null),onSubmitted:l(N),"operate-type":l(w),"row-data":l(R)},null,8,["visible","onSubmitted","operate-type","row-data"]),e(xt,{visible:p.addMultipeModelVisible,"onUpdate:visible":f[7]||(f[7]=i=>p.addMultipeModelVisible=i),devId:l(y).devId,chlid:l(y).chlid,onSubmitted:l(N)},null,8,["visible","devId","chlid","onSubmitted"]),e(St,{visible:k.value,"onUpdate:visible":f[8]||(f[8]=i=>k.value=i),onSubmitted:l(N),checkedRowKeys:l(C)},null,8,["visible","onSubmitted","checkedRowKeys"])]),_:1})])}}});export{Wt as default};
