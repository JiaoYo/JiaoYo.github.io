import{o as i,b as d,e as f,d as q,c5 as S,f as e,aD as Z,c as B,w as t,t as w,h as r,E as F,X as L,I as D,i as v,c6 as E,g as k,B as z,S as H,c7 as W,C as R,F as G}from"./index-m_y7kY8i.js";import{u as Q}from"./table-BlvCRrlW.js";import{_ as U}from"./DataTable-CqP-LMzm.js";import{_ as X,a as j}from"./Upload-CR5SiIew.js";import{a as A,_ as J}from"./Grid-BKpTNXut.js";import"./RadioGroup-DAMrkZ7E.js";import"./Forward-Ssfnwh7N.js";const K={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},O=f("path",{fill:"currentColor",d:"M16 18v2H8v-2zM11 7.99V16h2V7.99h3L12 4L8 7.99z"},null,-1),Y=[O];function ee(p,n){return i(),d("svg",K,[...Y])}const te={name:"ic-twotone-upgrade",render:ee},ne={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},oe=f("path",{fill:"currentColor",d:"M11 17h2v-4.2l1.6 1.6L16 13l-4-4l-4 4l1.4 1.4l1.6-1.6V17Zm-9 3V4h8l2 2h10v14H2Zm2-2h16V8h-8.825l-2-2H4v12Zm0 0V6v12Z"},null,-1),ae=[oe];function se(p,n){return i(),d("svg",ne,[...ae])}const le={name:"material-symbols-drive-folder-upload-outline-sharp",render:se},ce={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},re=f("path",{fill:"currentColor",d:"m12 13.4l-2.917 2.925q-.277.275-.704.275t-.704-.275q-.275-.275-.275-.7t.275-.7L10.6 12L7.675 9.108Q7.4 8.831 7.4 8.404t.275-.704q.275-.275.7-.275t.7.275L12 10.625L14.892 7.7q.277-.275.704-.275t.704.275q.3.3.3.713t-.3.687L13.375 12l2.925 2.917q.275.277.275.704t-.275.704q-.3.3-.712.3t-.688-.3z"},null,-1),ie=[re];function _e(p,n){return i(),d("svg",ce,[...ie])}const ue={name:"material-symbols-close-small-rounded",render:_e},de={class:"version"},pe=q({__name:"table",props:{type:{type:Number,default:0}},setup(p){const n=p,{columns:m,data:h,getData:y,loading:s,mobilePagination:b,searchParams:C}=Q({apiFn:S,apiParams:{page:1,pageSize:50,limit:50,type:n.type,_t:new Date().getTime()},showTotal:!0,columns:()=>[{key:"ver",title:"版本号",align:"center",minWidth:160},{key:"dbtime",title:"升级时间",align:"center",minWidth:160,render:_=>e("span",null,[_.dbtime.substring(10,0)])},{key:"status",title:"升级状态",align:"center",render:_=>e(Z,{type:_.status===0?"success":"error"},{default:()=>[_.status===0?"成功":"失败"]})}]});return(_,o)=>{const l=U,c=L;return i(),B(c,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{header:t(()=>[e(r(F),null,{default:t(()=>{var a;return[f("div",null,w(n.type===0?"后台服务":n.type===1?"web服务":"预测服务"),1),f("div",de,"当前版本："+w((a=r(h).find(u=>u.curver===0))==null?void 0:a.ver),1)]}),_:1})]),default:t(()=>[e(l,{columns:r(m),data:r(h),size:"small",loading:r(s),remote:"","row-key":a=>a.id,pagination:r(b),class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["columns","data","loading","row-key","pagination"])]),_:1})}}}),$=D(pe,[["__scopeId","data-v-519e5a0e"]]),me={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},fe={key:0,style:{width:"300px"}},he=q({name:"manage_upgrade",__name:"index",setup(p){const n=v(""),m=v(null),h=({file:o,data:l,headers:c,withCredentials:a,action:u,onFinish:g,onError:N,onProgress:V})=>{m.value=o.file,n.value=o.name},y=v(0),s=v(!1),b=o=>{s.value=!0,y.value=o},C=async()=>{var o,l;if(!n.value.endsWith(".tar.gz"))return(o=window.$message)==null?void 0:o.error("请上传tar.gz文件");try{const c=new FormData;c.append("fi",m.value);const{data:a,error:u}=await W({fname:n.value},c,b);if(u)return;(l=window.$message)==null||l.success(a),s.value=!1}catch{s.value=!1}},_=o=>{o.stopPropagation(),n.value="",m.value=null};return(o,l)=>{const c=ue,a=le,u=X,g=R,N=te,V=F,P=j,T=G,I=L,x=A,M=J;return i(),d("div",me,[e(I,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(T,{ref:"formRef",inline:"","label-placement":"left","label-width":100,"show-feedback":!1},{default:t(()=>[e(g,{label:"升级包选择",path:"fi"},{default:t(()=>[e(u,{action:"","custom-request":h,"show-file-list":!1,accept:".gz"},{default:t(()=>[n.value?(i(),d("div",{key:0,onClick:l[0]||(l[0]=E(()=>{},["stop"]))},[k(w(n.value)+" ",1),e(c,{class:"font-size-30px cursor-pointer",onClick:_})])):(i(),B(r(z),{key:1},{icon:t(()=>[e(a,{class:"text-icon"})]),default:t(()=>[k(" 上传文件")]),_:1}))]),_:1})]),_:1}),e(g,null,{default:t(()=>[e(V,{class:"w-full"},{default:t(()=>[e(r(z),{onClick:C,loading:s.value,disabled:!n.value,type:"primary",ghost:""},{icon:t(()=>[e(N,{class:"text-icon"})]),default:t(()=>[k(" "+w(s.value?"正在升级中":"升级"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),e(g,null,{default:t(()=>[s.value?(i(),d("div",fe,[e(P,{type:"line",percentage:y.value},null,8,["percentage"])])):H("",!0)]),_:1})]),_:1},512)]),_:1}),e(M,{"x-gap":"16",cols:3,class:"h-100%"},{default:t(()=>[e(x,null,{default:t(()=>[e($,{type:0,class:"h-100%"})]),_:1}),e(x,null,{default:t(()=>[e($,{type:1,class:"h-100%"})]),_:1}),e(x,null,{default:t(()=>[e($,{type:2,class:"h-100%"})]),_:1})]),_:1})])}}}),$e=D(he,[["__scopeId","data-v-6be3c429"]]);export{$e as default};
