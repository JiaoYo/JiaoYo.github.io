import{Q as we,p as ye,_ as be,a as ve}from"./pako.esm-o4WMb5NS.js";import{_ as xe}from"./export-BSv6Xp72.js";import{d as W,a2 as Z,N as Te,i as b,s as ee,be as ae,o as g,b as q,I as te,a8 as J,cx as ke,bd as m,f as a,a9 as Pe,bm as A,cy as De,w as t,h as n,B as F,g as k,t as C,$ as X,c as S,S as G,e as M,ab as Ce,cz as Se,F as Ne,X as ze,cA as $e,ae as Le,bY as Ie,E as Be,bZ as Ee,a6 as Ae,G as Fe,H as Ge}from"./index-C4Xe5hxh.js";import{_ as qe}from"./round-search-hnCStK2c.js";import{e as Me}from"./exportExcel-Bv4G4H50.js";import{u as Re,L as Y}from"./echarts-UVKnXDc0.js";import{_ as Ue}from"./DatePicker-DcWFcsyX.js";import{_ as He}from"./FormItemGridItem-CQhANOnq.js";import{_ as Oe}from"./Grid-Buhl17jd.js";const Ve=W({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(f){const h=f;Z(()=>h.data,async r=>{N(),z()});const R=Te(),c=b(null),{domRef:v,updateOptions:x,showLoading:N,hideLoading:l}=Re(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:"#6a7985",textStyle:{color:"rgb(224, 224, 224)"},valueFormatter:function(r){return(r+""!="undefined"?r:"--")+"mw"}},legend:{data:["实际功率","预测功率"]},grid:{left:"2%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} mw"}},series:[{color:"#e90445",name:"实际功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new Y(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.9)",shadowBlur:20},data:[]},{color:"#009688",name:"预测功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new Y(0,0,0,1,[{offset:0,color:"rgba(0, 150, 136,0.3)"},{offset:1,color:"rgba(0, 150, 136,0)"}],!1),shadowColor:"rgba(0, 150, 136,0.9)",shadowBlur:20},data:[]}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function z(){await new Promise(r=>{setTimeout(r,1e3)}),x(r=>(r.xAxis.data=h.data.map(d=>d.dbtime),r.series[0].data=h.data.map(d=>d.power),r.series[1].data=h.data.map(d=>d.prePower),r))}function U(){x((r,d)=>{const P=d();return r.legend.data=P.legend.data,r.series[0].name=P.series[0].name,r.series[1].name=P.series[1].name,r})}async function H(){z()}return Z(()=>R.locale,()=>{U()}),H(),ee(()=>{c.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),ae(()=>{c.value!==null&&(clearInterval(c.value),c.value=null)}),(r,d)=>(g(),q("div",{ref_key:"domRef",ref:v,class:"h-600px overflow-hidden"},null,512))}}),je=te(Ve,[["__scopeId","data-v-edcb8878"]]),Ke=f=>(Fe("data-v-cf07b44c"),f=f(),Ge(),f),Qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ze={class:"font-size-14px mb-10px"},Je={key:1},Xe=Ke(()=>M("span",null,"二维码",-1)),Ye=W({name:"realtimequery_powerquery",__name:"index",setup(f){const{columns:h,columnChecks:R,data:c,getData:v,loading:x,mobilePagination:N,searchParams:l,resetSearchParams:z}=J({apiFn:ke,apiParams:{page:1,pageSize:20,limit:20,startTime:m(1,Date.now()-864e5),endTime:m(1,Date.now()),_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"dbtime",title:"时间",align:"center",width:100},{key:"power",title:"实际功率",align:"center",width:140},{key:"prePower",title:"预测功率",align:"center",width:140},{key:"operate",title:"误差",align:"center",width:100,render(o){const e=o.prePower-o.power>=0?o.prePower-o.power:o.power-o.prePower;return a("span",null,[e?parseFloat(e.toFixed(6)):""])}}]}),{drawerVisible:U,operateType:H,editingData:r,handleAdd:d,handleEdit:P,checkedRowKeys:T,onBatchDeleted:We,onDeleted:ea}=Pe(c,v),ne=async()=>{w.value=="0"?await L():(await v(),c.value.length==0?V():y.value=[]),A({startTime:l.startTime,endTime:l.endTime})},p=b([]),$=b(""),L=async()=>{const{data:o,error:e}=await Se({startTime:l.startTime,endTime:l.endTime});e||(p.value=o.sort((s,u)=>new Date(s.dbtime).getTime()-new Date(u.dbtime).getTime()),p.value.length==0?V():y.value=[])},O=b([Date.now()-864e5*1,Date.now()]);async function oe(o,e){l.startTime=m(1,e[0]),l.endTime=m(1,e[1]),j.startTime=m(1,e[0]),j.endTime=m(1,e[1])}const se=o=>{o=="1"?v():L(),A({startTime:l.startTime,endTime:l.endTime})};ee(()=>{L(),A({startTime:l.startTime,endTime:l.endTime})}),ae(()=>{});const re=()=>{const o={dbtime:"时间",power:"实际功率",prePower:"预测功率",error:"误差"},e=[];c.value.forEach(s=>{T.value.includes(s.id)&&e.push({...s,error:s.prePower-s.power>=0?s.prePower-s.power:s.power-s.prePower||""})}),Me(e,o,"预测数据")},w=b("0"),I=b(!1),le=()=>{var u,D;if(p.value.length==0)return(u=window.$message)==null?void 0:u.warning("暂无数据。请查询数据后重试。");if(p.value.length>96)return(D=window.$message)==null?void 0:D.warning("数据量过多，请缩小查询范围（最多可导出96条数据）");const o={data:p.value.map(_=>({t:_.dbtime,pP:_.prePower,p:_.power})),type:0,dateTime:m(1,l.startTime)+" --- "+m(1,l.endTime)},s=ye.gzip(JSON.stringify(o),{to:"string"}).reduce((_,B)=>_+String.fromCharCode(B),"");$.value=`https://dingiiot.com/powerPrediction/?${btoa(s)}`,console.log("编码",$.value),I.value=!0},ie=()=>{var e;const o=document.getElementById("qrcode");if(o){const s=document.createElement("a");s.href=o.toDataURL("image/png"),s.download="qrcode.png",s.click(),(e=window.$message)==null||e.success("下载成功")}else console.error("无法找到二维码 canvas 元素")},{columns:ce,data:y,getData:V,loading:aa,mobilePagination:de,searchParams:j}=J({apiFn:De,apiParams:{page:1,pageSize:20,limit:20,startTime:l.startTime,endTime:l.endTime,_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{key:"dbtime",title:"时间",align:"center",width:100},{key:"code",title:"错误码",align:"center",width:140},{key:"errormsg",title:"错误信息",align:"center",width:140}]});return(o,e)=>{const s=Ue,u=He,D=qe,_=be,B=Oe,me=Ne,E=ze,pe=$e,K=Le,Q=Ie,ue=xe,_e=Be,ge=Ee,fe=ve,he=Ae;return g(),q("div",Qe,[a(E,{bordered:!1,size:"small"},{default:t(()=>[a(me,{ref:"formRef",model:n(l),"label-placement":"left","show-feedback":!1},{default:t(()=>[a(B,{"y-gap":16,responsive:"screen","item-responsive":""},{default:t(()=>[a(u,{span:"24 s:12 m:7",label:"起止时间",path:"startTime"},{default:t(()=>[a(s,{value:O.value,"onUpdate:value":e[0]||(e[0]=i=>O.value=i),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":oe,"default-time":["00:00:00","23:59:59"]},null,8,["value"])]),_:1}),a(u,{span:"24 s:12 m:5",label:"",path:"endTime",class:"pr-24px"},{default:t(()=>[a(n(F),{type:"primary",ghost:"",onClick:ne},{icon:t(()=>[a(D,{class:"text-icon"})]),default:t(()=>[k(" "+C(n(X)("common.search")),1)]),_:1}),n(y).length==0&&w.value=="0"?(g(),S(n(F),{key:0,type:"primary",ghost:"",onClick:le,class:"ml-20px"},{icon:t(()=>[a(_,{class:"text-icon"})]),default:t(()=>[k(" "+C("生成二维码"))]),_:1})):G("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(y).length>0?(g(),S(E,{key:0,bordered:!1,size:"small","header-style":{paddingTop:"0px"},class:"sm:flex-1-hidden card-wrapper h-100%"},{header:t(()=>[M("div",Ze,[a(pe,{class:"text-icon c-#e67e22"}),k(" 未查询到预测数据。详情请查看错误日志。 ")]),k(" 功率预测错误日志 ")]),default:t(()=>[a(K,{columns:n(ce),data:n(y),size:"small",loading:n(x),remote:"","row-key":i=>i.id,pagination:n(y).length?n(de):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["columns","data","loading","row-key","pagination"])]),_:1})):(g(),S(E,{key:1,bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:t(()=>[a(ge,{type:"card",animated:"",value:w.value,"onUpdate:value":[e[2]||(e[2]=i=>w.value=i),se],class:"h-100%","tab-style":{height:"40px"},"pane-wrapper-style":{flex:1}},{suffix:t(()=>[w.value=="1"?(g(),S(_e,{key:0,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[a(n(F),{onClick:re,size:"small",disabled:n(T).length==0},{icon:t(()=>[a(ue,{class:"text-icon"})]),default:t(()=>[k(" "+C(n(X)("common.export")),1)]),_:1},8,["disabled"])]),_:1})):G("",!0),w.value=="0"?(g(),q("span",Je,"共"+C(p.value.length)+"条数据",1)):G("",!0)]),default:t(()=>[a(Q,{name:"0",tab:"图表"},{default:t(()=>[a(je,{data:p.value},null,8,["data"])]),_:1}),a(Q,{name:"1",tab:"表格",class:"h-100%"},{default:t(()=>[a(K,{"checked-row-keys":n(T),"onUpdate:checkedRowKeys":e[1]||(e[1]=i=>Ce(T)?T.value=i:null),columns:n(h),data:n(c),size:"small",loading:n(x),remote:"","row-key":i=>i.id,pagination:n(c).length?n(N):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1})),a(he,{show:I.value,"onUpdate:show":e[3]||(e[3]=i=>I.value=i),title:"",preset:"card",class:"w-auto"},{header:t(()=>[M("div",null,[Xe,a(fe,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:ie})])]),default:t(()=>[a(we,{id:"qrcode",style:{margin:"0 auto"},value:$.value,margin:3,size:500,level:"H"},null,8,["value"])]),_:1},8,["show"])])}}}),ma=te(Ye,[["__scopeId","data-v-cf07b44c"]]);export{ma as default};
