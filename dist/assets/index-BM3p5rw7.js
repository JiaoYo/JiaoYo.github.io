import{Q as ce,p as de,_ as pe,a as me}from"./pako.esm-Beu7B0jR.js";import{_ as ue}from"./export-CmY8sCOJ.js";import{_ as _e}from"./round-search-BnajOtoe.js";import{d as j,a2 as U,N as fe,i as w,s as K,b9 as ge,o as v,b as A,I as Q,cz as we,b8 as g,f as a,w as o,h as r,B as I,g as B,t as P,$ as V,c as O,S as z,a9 as he,e as W,cA as ye,F as be,X as ve,c3 as xe,E as ke,c4 as Te,a6 as De,G as Pe,H as Ce}from"./index-BuIHZWoY.js";import{u as Se,a as Ne}from"./table-Cjc9MU6x.js";import{e as Le}from"./exportExcel-Bv4G4H50.js";import{u as $e,L as H}from"./echarts-DlVEK3P1.js";import{_ as Ie}from"./DatePicker-CWtLRcvJ.js";import{_ as Be}from"./FormItemGridItem-76Hw6OX0.js";import{_ as ze}from"./Grid-CLx151nh.js";import{_ as Ae}from"./DataTable-B-S_z7K-.js";import"./Forward-VYLTxKce.js";import"./RadioGroup-Be-YAEnB.js";const Ee=j({name:"LineChart",__name:"line-chart",props:{data:{type:Object,default:()=>({})}},setup(u){const _=u;U(()=>_.data,async s=>{C(),S()});const E=fe(),l=w(null),{domRef:h,updateOptions:x,showLoading:C,hideLoading:d}=$e(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},backgroundColor:"#6a7985",textStyle:{color:"rgb(224, 224, 224)"},valueFormatter:function(s){return(s+""!="undefined"?s:"--")+"MW"}},legend:{data:["实际功率","预测功率"]},grid:{left:"2%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:"{value} MW"}},series:[{color:"#e90445",name:"实际功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new H(0,0,0,1,[{offset:0,color:"rgba(233, 4, 69,0.3)"},{offset:1,color:"rgba(233, 4, 69,0)"}],!1),shadowColor:"rgba(233, 4, 69,0.9)",shadowBlur:20},data:[]},{color:"#009688",name:"预测功率",type:"line",emphasis:{focus:"series"},lineStyle:{width:1},areaStyle:{color:new H(0,0,0,1,[{offset:0,color:"rgba(0, 150, 136,0.3)"},{offset:1,color:"rgba(0, 150, 136,0)"}],!1),shadowColor:"rgba(0, 150, 136,0.9)",shadowBlur:20},data:[]}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}]}));async function S(){await new Promise(s=>{setTimeout(s,1e3)}),x(s=>(s.xAxis.data=_.data.map(i=>i.dbtime),s.series[0].data=_.data.map(i=>i.power),s.series[1].data=_.data.map(i=>i.prePower),s))}function q(){x((s,i)=>{const k=i();return s.legend.data=k.legend.data,s.series[0].name=k.series[0].name,s.series[1].name=k.series[1].name,s})}async function F(){S()}return U(()=>E.locale,()=>{q()}),F(),K(()=>{l.value=window.setInterval(()=>{console.log("mainHomeLineChart timer")},1e3*60*5)}),ge(()=>{l.value!==null&&(clearInterval(l.value),l.value=null)}),(s,i)=>(v(),A("div",{ref_key:"domRef",ref:h,class:"h-600px overflow-hidden"},null,512))}}),qe=Q(Ee,[["__scopeId","data-v-7a9326ee"]]),Fe=u=>(Pe("data-v-b758ac5f"),u=u(),Ce(),u),Ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Me={key:1},Re=Fe(()=>W("span",null,"二维码",-1)),Ue=j({name:"realtimequery_powerquery",__name:"index",setup(u){const{columns:_,columnChecks:E,data:l,getData:h,loading:x,mobilePagination:C,searchParams:d,resetSearchParams:S}=Se({apiFn:we,apiParams:{page:1,pageSize:20,limit:20,startTime:g(1,Date.now()-864e5),endTime:g(1,Date.now()),_t:new Date().getTime()},immediate:!1,showTotal:!0,columns:()=>[{type:"selection",width:60},{key:"dbtime",title:"时间",align:"center",width:100},{key:"power",title:"实际功率",align:"center",width:140},{key:"prePower",title:"预测功率",align:"center",width:140},{key:"operate",title:"误差",align:"center",width:100,render(t){const e=t.prePower-t.power>=0?t.prePower-t.power:t.power-t.prePower;return a("span",null,[e?parseFloat(e.toFixed(6)):""])}}]}),{drawerVisible:q,operateType:F,editingData:s,handleAdd:i,handleEdit:k,checkedRowKeys:y,onBatchDeleted:Ve,onDeleted:Oe}=Ne(l,h),J=async()=>{f.value=="0"?await N():await h()},b=w([]),T=w(""),N=async()=>{const{data:t,error:e}=await ye({startTime:d.startTime,endTime:d.endTime});e||(b.value=t.sort((n,p)=>new Date(n.dbtime).getTime()-new Date(p.dbtime).getTime()))},G=w([Date.now()-864e5*1,Date.now()]);async function X(t,e){d.startTime=g(1,e[0]),d.endTime=g(1,e[1])}const Z=t=>{t=="1"?h():N()};K(()=>{N()});const Y=()=>{const t={dbtime:"时间",power:"实际功率",prePower:"预测功率",error:"误差"},e=[];l.value.forEach(n=>{y.value.includes(n.id)&&e.push({...n,error:n.prePower-n.power>=0?n.prePower-n.power:n.power-n.prePower||""})}),Le(e,t,"预测数据")},f=w("0"),L=w(!1),ee=()=>{var p,D;if(b.value.length==0)return(p=window.$message)==null?void 0:p.warning("暂无数据。请查询数据后重试。");const t={data:b.value.map(m=>({t:m.dbtime,pP:m.prePower,p:m.power})),type:0,dateTime:g(1,d.startTime)+" --- "+g(1,d.endTime)},n=de.gzip(JSON.stringify(t),{to:"string"}).reduce((m,$)=>m+String.fromCharCode($),"");if(T.value=`https://dingiiot.com/powerPrediction/?${btoa(n)}`,T.value.length>2700)return(D=window.$message)==null?void 0:D.warning("二维码生成失败，请缩小查询范围后重试");console.log("地址",T.value),L.value=!0},ae=()=>{var e;const t=document.getElementById("qrcode");if(t){const n=document.createElement("a");n.href=t.toDataURL("image/png"),n.download="qrcode.png",n.click(),(e=window.$message)==null||e.success("下载成功")}else console.error("无法找到二维码 canvas 元素")};return(t,e)=>{const n=Ie,p=Be,D=_e,m=pe,$=ze,te=be,M=ve,R=xe,oe=Ae,ne=ue,se=ke,re=Te,le=me,ie=De;return v(),A("div",Ge,[a(M,{bordered:!1,size:"small"},{default:o(()=>[a(te,{ref:"formRef",model:r(d),"label-placement":"left","show-feedback":!1},{default:o(()=>[a($,{"y-gap":16,responsive:"screen","item-responsive":""},{default:o(()=>[a(p,{span:"24 s:12 m:7",label:"起止时间",path:"startTime"},{default:o(()=>[a(n,{value:G.value,"onUpdate:value":e[0]||(e[0]=c=>G.value=c),type:"datetimerange","value-format":"yyyy-MM-dd hh:mm:ss","onUpdate:formattedValue":X,"default-time":["00:00:00","23:59:59"]},null,8,["value"])]),_:1}),a(p,{span:"24 s:12 m:5",label:"",path:"endTime",class:"pr-24px"},{default:o(()=>[a(r(I),{type:"primary",ghost:"",onClick:J},{icon:o(()=>[a(D,{class:"text-icon"})]),default:o(()=>[B(" "+P(r(V)("common.search")),1)]),_:1}),f.value=="0"?(v(),O(r(I),{key:0,type:"primary",ghost:"",onClick:ee,class:"ml-20px"},{icon:o(()=>[a(m,{class:"text-icon"})]),default:o(()=>[B(" "+P("生成二维码"))]),_:1})):z("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(M,{bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:o(()=>[a(re,{type:"card",animated:"",value:f.value,"onUpdate:value":[e[2]||(e[2]=c=>f.value=c),Z],class:"h-100%","tab-style":{height:"40px"},"pane-wrapper-style":{flex:1}},{suffix:o(()=>[f.value=="1"?(v(),O(se,{key:0,align:"center",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:o(()=>[a(r(I),{onClick:Y,size:"small",disabled:r(y).length==0},{icon:o(()=>[a(ne,{class:"text-icon"})]),default:o(()=>[B(" "+P(r(V)("common.export")),1)]),_:1},8,["disabled"])]),_:1})):z("",!0),f.value=="0"?(v(),A("span",Me,"共"+P(b.value.length)+"条数据",1)):z("",!0)]),default:o(()=>[a(R,{name:"0",tab:"图表"},{default:o(()=>[a(qe,{data:b.value},null,8,["data"])]),_:1}),a(R,{name:"1",tab:"表格",class:"h-100%"},{default:o(()=>[a(oe,{"checked-row-keys":r(y),"onUpdate:checkedRowKeys":e[1]||(e[1]=c=>he(y)?y.value=c:null),columns:r(_),data:r(l),size:"small",loading:r(x),remote:"","row-key":c=>c.id,pagination:r(l).length?r(C):void 0,class:"sm:h-full","flex-height":!0,"scroll-x":""},null,8,["checked-row-keys","columns","data","loading","row-key","pagination"])]),_:1})]),_:1},8,["value"])]),_:1}),a(ie,{show:L.value,"onUpdate:show":e[3]||(e[3]=c=>L.value=c),title:"",preset:"card",class:"w-auto"},{header:o(()=>[W("div",null,[Re,a(le,{class:"text-icon ml-20px font-size-24px",style:{cursor:"pointer"},onClick:ae})])]),default:o(()=>[a(ce,{id:"qrcode",style:{margin:"0 auto"},value:T.value,margin:3,size:500,level:"L"},null,8,["value"])]),_:1},8,["show"])])}}}),na=Q(Ue,[["__scopeId","data-v-b758ac5f"]]);export{na as default};
