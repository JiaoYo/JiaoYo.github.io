import{E as e,a}from"./regexp-D-rE1x7-.js";import{b as l,d,fS as t,ak as s,k as o,L as i,e as r,o as u,c as m,w as n,h as p,g as c,fT as f,fA as b,G as h,Y as v}from"./index-BxLtnPqY.js";import{s as g}from"./user-BsjaHGO1.js";import{u as V}from"./useDept-BUpgySNS.js";import{a as _}from"./role-CFK81gR4.js";import{u as y}from"./useForm-BJmYEhb2.js";const x=d({__name:"AddUserModal",props:t({editData:{type:Object,default:()=>({})},operateType:{type:String,required:!0}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:t(["save-success"],["update:visible"]),setup(d,{emit:t}){const x=t,w=s(d,"visible"),I=d,{roleList:k,getRoleList:U}=function(){const e=l(!1),a=l([]),d=l(0);return{roleList:a,getRoleList:async()=>{try{e.value=!0;const l=await _({page:1,size:99});a.value=l.data.list.filter((e=>1===e.status)),d.value=l.data.total}finally{e.value=!1}},loading:e,total:d}}();U();const j=o((()=>k.value.map((e=>({label:e.name,value:e.code}))))),{deptList:L,OldDeptList:M,getDeptList:q}=V();q();const O={xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},D=l(),N=o((()=>"edit"==I.operateType?"编辑用户":"新增用户")),{form:T,resetForm:S}=y({id:"",username:"",nickname:"",gender:1,phone:"",email:"",deptId:1,deptName:"",roleIds:[],status:1,disabled:!1}),F={username:[{required:!0,message:"请输入用户名"},{min:2,max:4,message:"长度在 2 - 4个字符"}],nickname:[{required:!0,message:"请输入昵称"},{min:2,max:4,message:"长度在 2 - 4个字符"}],email:[{match:e,message:"邮箱格式不正确"}],phone:[{match:a,message:"手机号格式不正确"}],deptId:[{required:!0,message:"请选择所属部门"}],roleIds:[{required:!0,message:"请选择角色"}],status:[{required:!0,message:"请选择状态"}]};i((()=>w.value),(e=>{e&&R()}));const R=async()=>{"edit"==I.operateType&&(Object.assign(T,I.editData),T.roleIds=JSON.parse(T.roleIds))};R();const z=()=>{var e;null==(e=D.value)||e.resetFields(),S()},A=async()=>{var e,a;try{if(await(null==(e=D.value)?void 0:e.validate()))return!1;T.deptName=null==(a=M.value.find((e=>e.id==T.deptId)))?void 0:a.name;let l={...T};l.roleIds=JSON.stringify(l.roleIds),T.id||(l.password="123456"),await g(l),v.success(("edit"==I.operateType?"编辑":"新增")+"成功"),x("save-success")}catch(l){return!1}};return(e,a)=>{const l=r("a-input"),d=r("a-form-item"),t=r("a-col"),s=r("a-row"),o=r("a-radio"),i=r("a-radio-group"),v=r("a-tree-select"),g=r("a-select"),V=r("a-switch"),_=r("a-form"),y=r("a-modal");return u(),m(y,{visible:w.value,"onUpdate:visible":a[8]||(a[8]=e=>w.value=e),title:c(N),width:"90%","modal-style":{maxWidth:"600px"},"body-style":{maxHeight:"70vh"},onBeforeOk:A,onClose:z},{default:n((()=>[p(_,{ref_key:"formRef",ref:D,model:c(T),rules:F,size:"medium","auto-label-width":""},{default:n((()=>[p(s,null,{default:n((()=>[p(t,f(b(O)),{default:n((()=>[p(d,{label:"用户名",field:"username"},{default:n((()=>[p(l,{modelValue:c(T).username,"onUpdate:modelValue":a[0]||(a[0]=e=>c(T).username=e),modelModifiers:{trim:!0},placeholder:"请输入用户名","allow-clear":"",disabled:c(T).disabled,"max-length":10},null,8,["modelValue","disabled"])])),_:1})])),_:1},16),p(t,f(b(O)),{default:n((()=>[p(d,{label:"昵称",field:"nickname"},{default:n((()=>[p(l,{modelValue:c(T).nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>c(T).nickname=e),modelModifiers:{trim:!0},placeholder:"请输入昵称","allow-clear":"","max-length":10},null,8,["modelValue"])])),_:1})])),_:1},16),p(t,f(b(O)),{default:n((()=>[p(d,{label:"手机号码",field:"phone"},{default:n((()=>[p(l,{modelValue:c(T).phone,"onUpdate:modelValue":a[2]||(a[2]=e=>c(T).phone=e),modelModifiers:{trim:!0},placeholder:"请输入手机号码","allow-clear":"","max-length":11},null,8,["modelValue"])])),_:1})])),_:1},16),p(t,f(b(O)),{default:n((()=>[p(d,{label:"邮箱",field:"email"},{default:n((()=>[p(l,{modelValue:c(T).email,"onUpdate:modelValue":a[3]||(a[3]=e=>c(T).email=e),modelModifiers:{trim:!0},placeholder:"请输入邮箱","allow-clear":"","max-length":30},null,8,["modelValue"])])),_:1})])),_:1},16)])),_:1}),p(d,{label:"性别",field:"gender"},{default:n((()=>[p(i,{modelValue:c(T).gender,"onUpdate:modelValue":a[4]||(a[4]=e=>c(T).gender=e)},{default:n((()=>[p(o,{value:1},{default:n((()=>a[9]||(a[9]=[h("男")]))),_:1}),p(o,{value:2},{default:n((()=>a[10]||(a[10]=[h("女")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),p(d,{label:"所属部门",field:"deptId"},{default:n((()=>[p(v,{modelValue:c(T).deptId,"onUpdate:modelValue":a[5]||(a[5]=e=>c(T).deptId=e),data:c(L),"field-names":{key:"id",title:"name"},placeholder:"请选择所属部门","allow-clear":"","allow-search":"",disabled:c(T).disabled},null,8,["modelValue","data","disabled"])])),_:1}),p(d,{label:"角色",field:"roleIds",disabled:c(T).disabled},{default:n((()=>[p(g,{modelValue:c(T).roleIds,"onUpdate:modelValue":a[6]||(a[6]=e=>c(T).roleIds=e),options:c(j),placeholder:"请选择所属角色",multiple:"","allow-clear":"","allow-search":{retainInputValue:!0}},null,8,["modelValue","options"])])),_:1},8,["disabled"]),p(d,{label:"状态",field:"status"},{default:n((()=>[p(V,{modelValue:c(T).status,"onUpdate:modelValue":a[7]||(a[7]=e=>c(T).status=e),type:"round","checked-value":1,"unchecked-value":0,"checked-text":"正常","unchecked-text":"禁用"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])}}});export{x as _};
