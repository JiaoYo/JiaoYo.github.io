import{a as t}from"./index-CYLSZXsS.js";import{$ as e,b as n,g as l,d as i,W as s,a3 as o,e as r,o as a,c,w as d,h as u,G as h,i as f}from"./index-BxLtnPqY.js";function v(i=n(document.body)){let s,o="",r=null;const a=Symbol("watermark").toString(),c=e(null);const d=(t,e)=>{if(l(c))return u({text:t,attr:e}),a;const n=document.createElement("div");c.value=n,n.id=a,n.style.pointerEvents="none",n.style.top="0px",n.style.left="0px",n.style.position="absolute",n.style.zIndex="100000";const s=l(i);if(!s)return a;s.style.position="relative";const{clientHeight:o,clientWidth:r}=s;return u({text:t,width:r,height:o,attr:e}),s.appendChild(n),a};function u(t={}){const e=l(c);e&&(t.width&&(e.style.width=`${t.width}px`),t.height&&(e.style.height=`${t.height}px`),t.text&&(e.style.background=`url(${function(t,e){const n=document.createElement("canvas");n.width=200,n.height=120;const l=n.getContext("2d");return l&&(l.rotate(((null==e?void 0:e.rotate)??-20)*Math.PI/120),l.font=(null==e?void 0:e.font)??"18px Vedana",l.fillStyle=(null==e?void 0:e.fillStyle)??"rgba(0, 0, 0, 0.12)",l.textAlign="left",l.textBaseline="middle",l.fillText(t,n.width/20,n.height)),n.toDataURL("image/png")}(t.text,t.attr)}) left top repeat`),o=e.style.cssText)}const h=t((function(){const t=l(i);if(!t)return;const{clientHeight:e,clientWidth:n}=t;u({height:e,width:n})}),30),f=(t,e)=>{const n=l(c);n&&(r=new MutationObserver((l=>{if(l.length){const{removedNodes:i,type:s,target:a}=l[0],u=n.getAttribute("style");i[0]===n?(c.value=null,r.disconnect(),d(t,e)):"attributes"===s&&a===n&&u!==o&&n.setAttribute("style",o)}})),r.observe(l(i),{childList:!0,attributes:!0,subtree:!0}))};return{setWatermark:function(t,e){e&&(s=e),d(t,s),(null==s?void 0:s.forever)&&f(t,s),window.addEventListener("resize",h)},clear:()=>{const t=l(c);c.value=null,null==r||r.disconnect(),r??(r=null);const e=l(i);e&&(t&&e.removeChild(t),window.removeEventListener("resize",h))}}}const g=i({__name:"index",setup(t){const e=n(),{setWatermark:i,clear:g}=v(),{setWatermark:m,clear:p}=v(e);return s((()=>{m("admin",{forever:!0,fillStyle:"#2ecc71"})})),o((()=>{g(),p()})),(t,n)=>{const s=r("el-button"),o=r("el-card");return a(),c(o,{shadow:"never",class:"h-full"},{default:d((()=>[u(s,{onClick:n[0]||(n[0]=t=>l(i)("测试水印"))},{default:d((()=>n[2]||(n[2]=[h("设置全屏水印")]))),_:1}),u(s,{onClick:n[1]||(n[1]=t=>l(g)())},{default:d((()=>n[3]||(n[3]=[h("清除水印")]))),_:1}),f("div",{ref_key:"divRef",ref:e,style:{width:"600px",height:"600px"}},null,512)])),_:1})}}});export{g as _};
