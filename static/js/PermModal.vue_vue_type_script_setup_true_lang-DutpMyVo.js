import{d as e,b as a,k as s,e as l,o as t,c as i,w as n,h as r,g as d,H as o,G as c,a as u,J as p,Q as m,Y as y}from"./index-BxLtnPqY.js";import{g as f,u as k}from"./role-CFK81gR4.js";import{a as v}from"./menu-4mfY8c9i.js";const h=e({__name:"PermModal",setup(e,{expose:h}){const _=a(),g=a([]),b=(e,a)=>{const s=e.filter((e=>e.pid===a));return s.length?s.map((a=>({...a,children:b(e,a.id)}))):null};(async()=>{let e=(await v()).data.list.map((e=>({id:e.id,title:e.title,pid:e.pid,type:e.type}))),a=b(e,0);g.value=a,m((()=>{var e;null==(e=_.value)||e.expandAll()}))})();const x=s((()=>"分配权限")),z=a(!1),j=a(""),w=a([]);h({open:e=>{w.value=[],j.value=e.id,z.value=!0,f(e.id).then((e=>{w.value=JSON.parse(e.data.menus)}))}});const J=async()=>{await k({id:j.value,menus:JSON.stringify(w.value)}),y.success("更新成功")};return(e,a)=>{const s=l("a-tag"),m=l("a-tree"),y=l("a-modal");return t(),i(y,{visible:d(z),"onUpdate:visible":a[1]||(a[1]=e=>o(z)?z.value=e:null),title:d(x),fullscreen:d(p)(),"mask-closable":!0,onOk:J},{default:n((()=>[r(m,{ref_key:"treeRef",ref:_,"checked-keys":d(w),"onUpdate:checkedKeys":a[0]||(a[0]=e=>o(w)?w.value=e:null),size:"mini",checkable:"","check-strictly":!0,data:d(g),"field-names":{key:"id"}},{extra:n((e=>[1==e.type?(t(),i(s,{key:0,color:"orangered",size:"small"},{default:n((()=>a[2]||(a[2]=[c("目录")]))),_:1})):u("",!0),2==e.type?(t(),i(s,{key:1,color:"green",size:"small"},{default:n((()=>a[3]||(a[3]=[c("菜单")]))),_:1})):u("",!0),3==e.type?(t(),i(s,{key:2,color:"gray",size:"small"},{default:n((()=>a[4]||(a[4]=[c("按钮")]))),_:1})):u("",!0)])),_:1},8,["checked-keys","data"])])),_:1},8,["visible","title","fullscreen"])}}});export{h as _};
