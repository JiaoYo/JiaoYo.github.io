import{l as e}from"./vue-draggable-plus-DpVyg3hs.js";import{d as a,an as t,e as s,o as l,c as n,w as o,h as d,g as i,f as u,F as c,j as r,G as p,t as m,_ as g,b as v,V as h,k as f,ao as b,Y as x}from"./index-BCJ5rRXW.js";const _=g(a({name:"TableColumnSetting",__name:"index",props:{columns:{required:!0},columnsModifiers:{}},emits:["update:columns"],setup(a){const g=t(a,"columns");return(a,t)=>{const v=s("icon-settings"),h=s("a-button"),f=s("icon-drag-dot"),b=s("a-checkbox"),x=s("a-popover");return l(),n(x,{position:"bottom",trigger:"click","content-style":{padding:"5px"}},{content:o((()=>[d(i(e),{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),class:"settings"},{default:o((()=>[(l(!0),u(c,null,r(g.value,(e=>(l(),u("div",{key:e.dataIndex,class:"settingItem"},[d(f),d(b,{modelValue:e.checked,"onUpdate:modelValue":a=>e.checked=a},{default:o((()=>[p(m(e.title),1)])),_:2},1032,["modelValue","onUpdate:modelValue"])])))),128))])),_:1},8,["modelValue"])])),default:o((()=>[d(h,null,{icon:o((()=>[d(v)])),_:1})])),_:1})}}}),[["__scopeId","data-v-f0d2ba68"]]);function k(e){const{apiFn:a,apiParams:t,formatResult:s,columns:l,rowKey:n,immediate:o=!0,showtotal:d=!0}=e,i=v([]),u=v(!1),c=h({...t}),r=async(e={})=>{u.value=!0;const t=await a({...c});i.value=s?s(t.data.list):t.data.list,p.total=t.data.total,u.value=!1};o&&r();const p=h({current:c.page,pageSize:c.size,total:0,showTotal:!!d&&(e=>`共${e}条`),showPageSize:!0,pageSizeOptions:[2,5,10,20],onChange:e=>{p.current=e,c.page=e,r()},onPageSizeChange:e=>{p.pageSize=e,c.size=e,r()}}),m=v([]),g=v(!1),_=v("add"),k=v(null),w=v((e=>{const a=[];return e.forEach((e=>{a.push({dataIndex:e.dataIndex,title:e.title,checked:!0})})),a})(l)),z=f((()=>V(l,w.value))),V=(e,a)=>{const t=new Map;e.forEach((e=>{t.set(e.dataIndex,e)}));return a.filter((e=>e.checked)).map((e=>t.get(e.dataIndex)))};return{tableData:i,searchParams:c,loading:u,columns:z,pagination:p,selectedKeys:m,rowKey:n,visible:g,operateType:_,editData:k,getData:r,resetSearchParams:()=>{Object.assign(c,t),p.pageSize=c.size,p.current=c.page,r()},select:e=>{m.value=e},selectAll:e=>{const a=n??"id",t=i.value.filter((e=>!(null==e?void 0:e.disabled)));m.value=e?t.map((e=>e[a])):[]},handleAdd:()=>{_.value="add",g.value=!0},handleEdit:e=>{_.value="edit";const a=i.value.find((a=>a[n]===e))||null;k.value=b(a),g.value=!0},closeVisible:()=>{g.value=!1},successsDelete:async()=>{x.success("删除成功"),await r()},columnChecks:w}}export{_,k as u};
