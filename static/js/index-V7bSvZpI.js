import{d as e,I as a,n as l,W as s,b as u,e as o,o as t,f as d,h as r,w as n,i,t as p,c as m,x as c,G as v,Y as f,gX as w,_ as y}from"./index-BCJ5rRXW.js";import{E as k,a as h,P as _}from"./regexp-D-rE1x7-.js";const I={class:"info"},V={class:"content"},b={key:0},g={key:0},x={key:0},U={key:0,class:"arco-upload-list-picture custom-upload-avatar"},E=["src"],P={class:"arco-upload-list-picture-mask"},q={key:1,class:"arco-upload-picture-card"},N={class:"arco-upload-picture-card-text"},S=y(e({__name:"index",setup(e){const y=a(),S=l();s((()=>{L.value={url:y.avatar}}));const R=u({});R.value={nickname:y.userInfo.nickname,phone:y.userInfo.phone,email:y.userInfo.email,deptName:y.userInfo.deptName,avatar:y.userInfo.avatar,id:y.userInfo.id};const C=u(!1),F=()=>{C.value=!0},j=async()=>0==k.test(R.value.email)?f.error("邮箱格式不正确"):0==h.test(R.value.phone)?f.error("电话格式不正确"):void(R.value.nickname!=y.userInfo.nickname||R.value.phone!=y.userInfo.phone||R.value.email!=y.userInfo.email?(await y.SETUSERINFO(R.value),f.success("修改成功"),y.userInfo.nickname=R.value.nickname,C.value=!1):C.value=!1),L=u(),O=e=>{const{onProgress:a,onError:l,onSuccess:s,fileItem:u,name:o}=e;return L.value={...u},T(),{}},T=async()=>{const e=new FormData;e.append("file",L.value.file);const{data:a}=await w(e);if(!a)return f.success("头像修改失败");await y.SETUSERINFO({id:y.userInfo.id,avatar:"https://60.205.130.133"+a}),f.success("头像修改成功"),y.userInfo.avatar="https://60.205.130.133"+a},z=u(),D=u({oldpassword:"",newpassword:"",newpassword1:""}),G={oldpassword:[{required:!0,message:"请输入旧密码"},{match:_,message:"输入密码格式不正确"}],newpassword:[{required:!0,message:"请输入新密码"},{match:_,message:"输入密码格式不正确"},{validator:(e,a)=>{e==D.value.oldpassword?a("新密码不能和旧密码相同"):a()}}],newpassword1:[{required:!0,message:"请确认密码"},{match:_,message:"输入密码格式不正确"},{validator:(e,a)=>{e!==D.value.newpassword?a("两次密码不一致"):a()}}]},W=async()=>{var e;await(null==(e=z.value)?void 0:e.validate())||(await y.updatePassword({id:y.userInfo.id,oldPassword:D.value.oldpassword,newPassword:D.value.newpassword}),f.success("修改密码成功请重新登录！"),S.push({path:"/login",query:{redirect:S.currentRoute.value.fullPath}}))};return(e,a)=>{const l=o("a-input"),s=o("a-descriptions-item"),u=o("IconEdit"),f=o("IconPlus"),w=o("a-upload"),y=o("a-descriptions"),k=o("a-button"),h=o("a-tab-pane"),_=o("a-input-password"),S=o("a-form-item"),T=o("a-form"),X=o("a-tabs"),Y=o("a-card");return t(),d("div",I,[r(Y,null,{default:n((()=>[i("div",V,[r(X,{type:"rounded",size:"medium"},{default:n((()=>[r(h,{key:"1",title:"个人设置"},{default:n((()=>[r(y,{style:{"margin-top":"20px"},column:1},{default:n((()=>[r(s,{label:"用户名"},{default:n((()=>[C.value?(t(),m(l,{key:1,modelValue:R.value.nickname,"onUpdate:modelValue":a[0]||(a[0]=e=>R.value.nickname=e),style:{width:"200px"}},null,8,["modelValue"])):(t(),d("span",b,p(R.value.nickname),1))])),_:1}),r(s,{label:"邮箱"},{default:n((()=>[C.value?(t(),m(l,{key:1,modelValue:R.value.email,"onUpdate:modelValue":a[1]||(a[1]=e=>R.value.email=e),style:{width:"200px"}},null,8,["modelValue"])):(t(),d("span",g,p(R.value.email),1))])),_:1}),r(s,{label:"电话"},{default:n((()=>[C.value?(t(),m(l,{key:1,modelValue:R.value.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>R.value.phone=e),"max-length":11,style:{width:"200px"}},null,8,["modelValue"])):(t(),d("span",x,p(R.value.phone),1))])),_:1}),r(s,{label:"头像"},{default:n((()=>[r(w,{fileList:L.value?[L.value]:[],"show-file-list":!1,"custom-request":O},{"upload-button":n((()=>[i("div",{class:c("arco-upload-list-item"+(L.value&&"error"===L.value.status?" arco-upload-list-item-error":""))},[L.value&&L.value.url?(t(),d("div",U,[i("img",{src:L.value.url},null,8,E),i("div",P,[r(u)])])):(t(),d("div",q,[i("div",N,[r(f)])]))],2)])),_:1},8,["fileList"])])),_:1}),r(s,{label:"部门"},{default:n((()=>[v(p(R.value.deptName),1)])),_:1})])),_:1}),C.value?(t(),m(k,{key:1,type:"primary",onClick:j},{default:n((()=>a[7]||(a[7]=[v("保存")]))),_:1})):(t(),m(k,{key:0,onClick:F},{default:n((()=>a[6]||(a[6]=[v("修改")]))),_:1}))])),_:1}),r(h,{key:"2",title:"修改密码"},{default:n((()=>[r(T,{ref_key:"formRef",ref:z,model:D.value,rules:G,"label-col-props":{span:8},"wrapper-col-props":{span:16},style:{"margin-top":"20px"}},{default:n((()=>[r(S,{field:"oldpassword",label:"旧密码"},{default:n((()=>[r(_,{autocomplete:"",modelValue:D.value.oldpassword,"onUpdate:modelValue":a[3]||(a[3]=e=>D.value.oldpassword=e),placeholder:"请输入旧密码"},null,8,["modelValue"])])),_:1}),r(S,{field:"newpassword",label:"新密码"},{default:n((()=>[r(_,{autocomplete:"",modelValue:D.value.newpassword,"onUpdate:modelValue":a[4]||(a[4]=e=>D.value.newpassword=e),placeholder:"请输入新密码"},null,8,["modelValue"])])),_:1}),r(S,{field:"newpassword1",label:"确认密码"},{default:n((()=>[r(_,{autocomplete:"",modelValue:D.value.newpassword1,"onUpdate:modelValue":a[5]||(a[5]=e=>D.value.newpassword1=e),placeholder:"请确认新密码"},null,8,["modelValue"])])),_:1}),r(S,null,{default:n((()=>[r(k,{type:"primary",onClick:W},{default:n((()=>a[8]||(a[8]=[v("保存")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])])),_:1})])}}}),[["__scopeId","data-v-b6fdb45f"]]);export{S as default};
